var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{_ as s,u as i,A as r,k as n,m as o,V as a,l as h,p as l,a as c,o as d,X as p,Y as f,b as u}from"./index.1706233502046.js";import{g as m,a as w}from"./index.1706233502046115.js";import{l as g,M as v}from"./mapconfig.1706233502046.js";import{W as y,S as x,P as b,A as _,T as j,j as R,k as A,M as T,l as C,V as L}from"./three.module.1706233502046.js";class M{constructor(e,s,i,r){t(this,"view",null),t(this,"externalRenderers",null),t(this,"options",null),t(this,"offset",null),t(this,"_offset",null),t(this,"_offsetAdd",null),t(this,"positionflag",null),t(this,"object3d",null),t(this,"renderer",null),t(this,"scene",null),t(this,"camera",null),t(this,"material",null),this.view=e,this.externalRenderers=r,this.view=e;this.options=this.extend({},{width:500,height:500,altitude:0,interactive:!1},i,{point:s})}setup(e){this.renderer=new y({context:e.gl,premultipliedAlpha:!1}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setViewport(0,0,this.view.width,this.view.height),this.renderer.autoClear=!1,this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!1,this.renderer.autoClearStencil=!1;var t=this.renderer.setRenderTarget.bind(this.renderer);this.renderer.setRenderTarget=s=>{t(s),null==s&&e.bindRenderTarget()},this.scene=new x,this.camera=new b;const s=new _(1);s.position.copy(1e6,1e5,1e5),this.scene.add(s),this._setupScene(e)}_setupScene(e){const t=(new j).load(this.options.cloudurl);this.material=new R({map:t,opacity:.8}),this.material.depthWrite=!1,this.material.depthTest=!1,this.material.transparent=!0;const s=new A(this.options.width,this.options.height);this.object3d=new T(s,this.material);const i=this.coordinateToVector3([this.options.point.x,this.options.point.y],this.options.point.altitude);this.object3d.position.copy(i),this.scene.add(this.object3d);const r=Math.random(),n=r<=.3?"x":r<.6?"y":"z";this.positionflag=n;const o=Math.min(this.options.width,this.options.height);this.offset=o,this._offset=0,this._offsetAdd=r>.5,e.resetWebGLState()}coordinateToVector3(e,t=0){const s=e;let i=new C,r=new Array(16);return i.fromArray(this.externalRenderers.renderCoordinateTransformAt(this.view,[s[0],s[1],t],this.view.spatialReference,r)),new L(i.elements[12],i.elements[13],i.elements[14])}render(e){const t=e.camera;this.camera.position.set(t.eye[0],t.eye[1],t.eye[2]),this.camera.up.set(t.up[0],t.up[1],t.up[2]),this.camera.lookAt(new L(t.center[0],t.center[1],t.center[2]));const s=this.options.offset;this._offsetAdd?(this._offset+=s,this.object3d.position[this.positionflag]+=s,this._offset>=this.offset&&(this._offsetAdd=!1)):(this._offset-=s,this.object3d.position[this.positionflag]-=s,this._offset<=-this.offset&&(this._offsetAdd=!0)),this.camera.projectionMatrix.fromArray(t.projectionMatrix),this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),this.externalRenderers.requestRender(this.view),e.resetWebGLState()}extend(...e){for(let t=1;t<arguments.length;t++){const s=arguments[t];for(const t in s)e[t]=s[t]}return e}}const S=""+new URL("cloud.1706233502046.png",import.meta.url).href;const V={name:"map",components:{},setup(){const e=i();r();const t=n({});return o((async()=>{!async function(e){const[t,s,i,r,n,o,a,h,l,c,d,p,f]=await g(["esri/Map","esri/views/SceneView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/widgets/Expand","esri/Camera","esri/widgets/Home","esri/widgets/Fullscreen","esri/widgets/LayerList","esri/widgets/Legend","esri/views/3d/externalRenderers","esri/widgets/BasemapGallery","esri/geometry/SpatialReference"],{url:v.jsapiurl,css:v.jscssurl}),u=new t({basemap:"streets-night-vector",ground:{surfaceColor:"#021425"}}),w=new s({spatialReference:f.WebMercator,container:"viewDiv_threejs_cloud",map:u,viewingMode:"local"}),y=new p({view:w}),x=new n({view:w,content:y,expandIconClass:"esri-icon-basemap",expandTooltip:"LayerList",group:"top-left"});w.ui.add(x,"top-left");const b=new o({fov:e.camera.fov,heading:e.camera.heading,position:{x:e.camera.position.x,y:e.camera.position.y,z:e.camera.position.z,spatialReference:{wkid:3857}},tilt:e.camera.tilt});r.once((()=>!0===(null==w?void 0:w.stationary))).then((()=>{w.goTo(b,e.cameraoptions).then((()=>{})),m().then((e=>{e.map((e=>{let t={cloudurl:S,width:e.width,height:1e6,offset:5e3},s=new M(w,e,t,d);d.add(w,s)}))}))})),r.on((()=>w),"click",(e=>{console.log("view camera: ",w.camera)}))}(await w())})),a((()=>{})),h((()=>e.state.tagsViewRoutes.isTagsViewCurrenFull)),{...l(t)}}},k={class:"home-container"},W=[(e=>(p("data-v-6c0eeb85"),e=e(),f(),e))((()=>u("div",{id:"viewDiv_threejs_cloud"},null,-1)))];const P=s(V,[["render",function(e,t,s,i,r,n){return d(),c("div",k,W)}],["__scopeId","data-v-6c0eeb85"]]);export{P as default};
