var e=Object.defineProperty,t=(t,i,r)=>(((t,i,r)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r})(t,"symbol"!=typeof i?i+"":i,r),r);import{_ as i,u as r,A as s,k as n,m as o,Y as a,l,p as c,a as h,o as p,K as d,L as m,b as u}from"./index.1763356783981.js";import{k as v,l as f}from"./index.1763356783981115.js";import{l as g,M as w}from"./mapconfig.1763356783981.js";import{n as y,W as b,S as x,P as j,A as C,h as _,b as R,o as A,q as F,w as M,x as S,M as T,l as L,V}from"./three.module.1763356783981.js";class W{constructor(e,i,r,s){t(this,"view",null),t(this,"options",null),t(this,"vertexs",null),t(this,"fragments",null),t(this,"renderer",null),t(this,"scene",null),t(this,"camera",null),t(this,"material",null),t(this,"object3d",null),t(this,"externalRenderers",null),this.view=e,this.externalRenderers=s;this.options=this.extend({},{altitude:0,speed:.015,height:10},r,{points:i}),this.vertexs={normal_vertex:"\n  precision lowp float;\n  precision lowp int;\n  ".concat(y.fog_pars_vertex,"\n  varying vec2 vUv;\n  void main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    ").concat(y.fog_vertex,"\n  }\n")},this.fragments={rippleWall_fragment:"\n  precision lowp float;\n  precision lowp int;\n  uniform float time;\n  uniform float opacity;\n  uniform vec3 color;\n  uniform float num;\n  uniform float hiz;\n\n  varying vec2 vUv;\n\n  void main() {\n    vec4 fragColor = vec4(0.);\n    float sin = sin((vUv.y - time * hiz) * 10. * num);\n    float high = 0.92;\n    float medium = 0.4;\n    if (sin > high) {\n      fragColor = vec4(mix(vec3(.8, 1., 1.), color, (1. - sin) / (1. - high)), 1.);\n    } else if(sin > medium) {\n      fragColor = vec4(color, mix(1., 0., 1.-(sin - medium) / (high - medium)));\n    } else {\n      fragColor = vec4(color, 0.);\n    }\n\n    vec3 fade = mix(color, vec3(0., 0., 0.), vUv.y);\n    fragColor = mix(fragColor, vec4(fade, 1.), 0.85);\n    gl_FragColor = vec4(fragColor.rgb, fragColor.a * opacity * (1. - vUv.y));\n  }\n"}}setup(e){this.renderer=new b({context:e.gl,premultipliedAlpha:!1}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setViewport(0,0,this.view.width,this.view.height),this.renderer.autoClear=!1,this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!1,this.renderer.autoClearStencil=!1;var t=this.renderer.setRenderTarget.bind(this.renderer);this.renderer.setRenderTarget=i=>{t(i),null==i&&e.bindRenderTarget()},this.scene=new x,this.camera=new j;var i=new C(1);i.position.copy(1e6,1e5,1e5),this.scene.add(i),this._setupScene(e)}_setupScene(e){this.material=new _({uniforms:{time:{type:"pv2",value:0},color:{type:"uvs",value:new R(this.options.color)},opacity:{type:"pv2",value:.3},num:{type:"pv2",value:5},hiz:{type:"pv2",value:.15}},vertexShader:this.vertexs.normal_vertex,fragmentShader:this.fragments.rippleWall_fragment,blending:A,transparent:!0,depthWrite:!1,depthTest:!0,wireframe:void 0!==this.options.wireframe&&this.options.wireframe,side:F});const t=this.options.height,i=this.options.points,r=[];let s=[];i.forEach((e=>{const t=this.coordinateToVector3([e[0],e[1]]);r.push(t),s.push(t.x),s.push(t.y)}));for(var n=s,o=[],a=0,l=0;a<n.length-2;a+=2,l++)0===a?o[0]=Math.sqrt((n[2]-n[0])*(n[2]-n[0])+(n[3]-n[1])*(n[3]-n[1])):o[l]=o[l-1]+Math.sqrt((n[a+2]-n[a])*(n[a+2]-n[a])+(n[a+3]-n[a+1])*(n[a+3]-n[a+1]));let c=[],h=[],p=o[o.length-1];for(let m=0,u=c.length,v=h.length;m<r.length-1;m++){let e=r[m],i=r[m+1],s=o[m];c[u++]=e.x,c[u++]=e.y,c[u++]=0,h[v++]=0===m?0:o[m-1]/p,h[v++]=0,c[u++]=i.x,c[u++]=i.y,c[u++]=0,h[v++]=s/p,h[v++]=0,c[u++]=e.x,c[u++]=e.y,c[u++]=t,h[v++]=0===m?0:o[m-1]/p,h[v++]=1,c[u++]=e.x,c[u++]=e.y,c[u++]=t,h[v++]=0===m?0:o[m-1]/p,h[v++]=1,c[u++]=i.x,c[u++]=i.y,c[u++]=0,h[v++]=s/p,h[v++]=0,c[u++]=i.x,c[u++]=i.y,c[u++]=t,h[v++]=s/p,h[v++]=1}var d=new M;d.setAttribute("position",new S(new Float32Array(c),3)),d.setAttribute("uv",new S(new Float32Array(h),2)),this.object3d=new T(d,this.material),this.scene.add(this.object3d),e.resetWebGLState()}setMaterialColor(e){this.object3d&&(this.object3d.material.uniforms.color.value=e)}setwireframe(){this.object3d&&(this.object3d.material.wireframe=!this.object3d.material.wireframe)}setopacity(e){this.object3d&&(this.object3d.material.opacity=e)}setaltitude(e){this.object3d&&(this.object3d.position.z=e)}setscaleZ(e){this.object3d&&(this.object3d.scale.z=e)}addAttribute(e,t,i){return e.setAttribute(t,i),e}coordinateToVector3(e,t=0){const i=e;let r=new L,s=new Array(16);return r.fromArray(this.externalRenderers.renderCoordinateTransformAt(this.view,[i[0],i[1],t],this.view.spatialReference,s)),new V(r.elements[12],r.elements[13],r.elements[14])}render(e){const t=e.camera;this.camera.position.set(t.eye[0],t.eye[1],t.eye[2]),this.camera.up.set(t.up[0],t.up[1],t.up[2]),this.camera.lookAt(new V(t.center[0],t.center[1],t.center[2])),this.object3d&&(this.object3d.material.uniforms.time.value+=this.options.speed),this.camera.projectionMatrix.fromArray(t.projectionMatrix),this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),this.externalRenderers.requestRender(this.view),e.resetWebGLState()}extend(...e){for(let t=1;t<arguments.length;t++){const i=arguments[t];for(const t in i)e[t]=i[t]}return e}}const z={name:"map",components:{},setup(){const e=r();s();const t=n({});return o((async()=>{!async function(e){const[t,i,r,s,n,o,a,l,c,h,p,d,m]=await g(["esri/Map","esri/views/SceneView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/widgets/Expand","esri/Camera","esri/widgets/Home","esri/widgets/Fullscreen","esri/widgets/LayerList","esri/widgets/Legend","esri/views/3d/externalRenderers","esri/widgets/BasemapGallery","esri/geometry/SpatialReference"],{url:w.jsapiurl,css:w.jscssurl}),u=new t({basemap:"streets-night-vector",ground:{surfaceColor:"#021425"}}),f=new i({spatialReference:m.WebMercator,container:"viewDiv_threejs_rippleWall",map:u,viewingMode:"local"}),y=new d({view:f}),b=new n({view:f,content:y,expandIconClass:"esri-icon-basemap",expandTooltip:"LayerList",group:"top-left"});f.ui.add(b,"top-left");const x=new o({fov:e.camera.fov,heading:e.camera.heading,position:{x:e.camera.position.x,y:e.camera.position.y,z:e.camera.position.z,spatialReference:{wkid:3857}},tilt:e.camera.tilt});s.once((()=>!0===(null==f?void 0:f.stationary))).then((()=>{f.goTo(x,e.cameraoptions).then((()=>{})),v("buildingone").then((e=>{e.features.map((e=>{let t={points:e.geometry.paths[0],options:{color:"#0000FF",height:e.attributes.Height||100,altitude:0,speed:.1}};const i=new W(f,t.points,t.options,p);p.add(f,i)}))})),v("buildingtwo").then((e=>{e.features.map((e=>{let t={points:e.geometry.paths[0],options:{color:"#FFD700",height:e.attributes.Height||100,altitude:0,speed:.1}};const i=new W(f,t.points,t.options,p);p.add(f,i)}))})),v("buildingthree").then((e=>{e.features.map((e=>{let t={points:e.geometry.paths[0],options:{color:"#FF1493",height:e.attributes.Height||100,altitude:0,speed:.1}};const i=new W(f,t.points,t.options,p);p.add(f,i)}))})),v("buildingfour").then((e=>{e.features.map((e=>{let t={points:e.geometry.paths[0],options:{color:"#1E90FF",height:e.attributes.Height||100,altitude:0,speed:.1}};const i=new W(f,t.points,t.options,p);p.add(f,i)}))}))})),s.on((()=>f),"click",(e=>{}))}(await f())})),a((()=>{})),l((()=>e.state.tagsViewRoutes.isTagsViewCurrenFull)),{...c(t)}}},U={class:"home-container"},P=[(e=>(d("data-v-6069732a"),e=e(),m(),e))((()=>u("div",{id:"viewDiv_threejs_rippleWall"},null,-1)))];const k=i(z,[["render",function(e,t,i,r,s,n){return p(),h("div",U,P)}],["__scopeId","data-v-6069732a"]]);export{k as default};
