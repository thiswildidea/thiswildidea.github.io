import{at as e,_ as a,D as l,k as t,m as o,M as n,p as r,r as s,Q as u,a as d,h as i,w as m,g as p,I as c,H as g,o as b,au as f,F as h,e as _,f as y,v as w,i as C,t as v,b as F,x as k,y as z}from"./index.1705234809225.js";const V={name:"JobLog",setup(){const{proxy:a}=p(),s=l(null),u=t({total:0,tableData:[],loading:!0,ids:[],single:!0,multiple:!0,title:"",open:!1,modelForm:{},jobGroupOptions:[],JobOptions:[],statusOptions:[],queryParams:{pageNum:1,pageSize:10,name:void 0,jobGroup:void 0,status:void 0}}),d=()=>{var a;u.loading=!0,(a=u.queryParams,e({url:"/log/logJob/list",method:"get",params:a})).then((e=>{u.tableData=e.data.data,u.total=e.data.total,u.loading=!1}))};return o((()=>{d(),a.getDicts("sys_normal_disable").then((e=>{u.statusOptions=e.data})),a.getDicts("sys_job_group").then((e=>{u.jobGroupOptions=e.data}))})),n((()=>{})),{ruleFormRef:s,resetQuery:()=>{u.queryParams.name=void 0,u.queryParams.jobGroup=void 0,u.queryParams.status=void 0,d()},handleQuery:d,handleClean:()=>{c({message:"是否确认清空所有调度日志数据项?",title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return e({url:"/log/logJob/all",method:"delete"})})).then((()=>{d(),g.success("清空成功")}))},statusFormat:(e,l)=>a.selectDictLabel(u.statusOptions,e.status),jobGroupFormat:(e,l)=>a.selectDictLabel(u.jobGroupOptions,e.jobGroup),handleView:e=>{u.open=!0,u.modelForm=e},handleSelectionChange:e=>{u.ids=e.map((e=>e.logId)),u.single=1!=e.length,u.multiple=!e.length},handleCurrentChange:e=>{u.queryParams.pageNum=e,d()},handleSizeChange:e=>{u.queryParams.pageSize=e,d()},onTabelRowDel:a=>{const l=a.logId||u.ids;c({message:'是否确认删除定时任务编号为"'+l+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return(a=l,e({url:"/log/logJob/"+a,method:"delete"})).then((()=>{d(),g.success("删除成功")}));var a}))},...r(u)}}},j={class:"app-container"},q=C(" 搜索"),P=C(" 重置 "),x=C("删除"),G=C("清空"),S=C("详细"),D={key:0},O={key:1},I={class:"dialog-footer"},T=C("关 闭");const B=a(V,[["render",function(e,a,l,t,o,n){const r=s("el-input"),p=s("el-form-item"),c=s("el-option"),g=s("el-select"),V=s("SvgIcon"),B=s("el-button"),Q=s("el-form"),J=s("el-col"),L=s("el-row"),R=s("el-table-column"),N=s("el-tag"),U=s("el-table"),K=s("el-divider"),H=s("el-pagination"),M=s("el-card"),A=s("el-dialog"),E=u("loading");return b(),d("div",j,[i(M,{shadow:"always"},{default:m((()=>[i(Q,{model:e.queryParams,ref:"queryForm",inline:!0,"label-width":"68px"},{default:m((()=>[i(p,{label:"任务名称",prop:"jobName"},{default:m((()=>[i(r,{placeholder:"请输入任务名称模糊查询",clearable:"",size:"small",onKeyup:f(t.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.queryParams.name=a)},null,8,["onKeyup","modelValue"])])),_:1}),i(p,{label:"任务组名",prop:"jobGroup"},{default:m((()=>[i(g,{modelValue:e.queryParams.jobGroup,"onUpdate:modelValue":a[1]||(a[1]=a=>e.queryParams.jobGroup=a),placeholder:"请选择任务组名",clearable:"",size:"small"},{default:m((()=>[(b(!0),d(h,null,_(e.jobGroupOptions,(e=>(b(),y(c,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(p,{label:"任务状态",prop:"status"},{default:m((()=>[i(g,{modelValue:e.queryParams.status,"onUpdate:modelValue":a[2]||(a[2]=a=>e.queryParams.status=a),placeholder:"请选择任务状态",clearable:"",size:"small"},{default:m((()=>[(b(!0),d(h,null,_(e.statusOptions,(e=>(b(),y(c,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(p,null,{default:m((()=>[i(B,{type:"primary",size:"mini",onClick:t.handleQuery},{default:m((()=>[i(V,{name:"elementSearch"}),q])),_:1},8,["onClick"]),i(B,{size:"mini",onClick:t.resetQuery},{default:m((()=>[i(V,{name:"elementRefresh"}),P])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),i(L,{gutter:10,class:"mb8"},{default:m((()=>[i(J,{span:1.5},{default:m((()=>[i(B,{type:"danger",plain:"",size:"mini",disabled:e.multiple,onClick:t.onTabelRowDel},{default:m((()=>[i(V,{name:"elementDelete"}),x])),_:1},8,["disabled","onClick"])])),_:1},8,["span"]),i(J,{span:1.5},{default:m((()=>[i(B,{type:"danger",plain:"",size:"mini",onClick:t.handleClean},{default:m((()=>[i(V,{name:"elementDelete"}),G])),_:1},8,["onClick"])])),_:1},8,["span"])])),_:1}),w((b(),y(U,{data:e.tableData,onSelectionChange:t.handleSelectionChange},{default:m((()=>[i(R,{type:"selection",width:"55",align:"center"}),i(R,{label:"日志编号",width:"80",align:"center",prop:"logId"}),i(R,{label:"任务名称",align:"center",prop:"name","show-overflow-tooltip":!0}),i(R,{label:"任务组名",align:"center",prop:"jobGroup",formatter:t.jobGroupFormat,"show-overflow-tooltip":!0},null,8,["formatter"]),i(R,{label:"调用目标",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),i(R,{label:"日志信息",align:"center",prop:"logInfo","show-overflow-tooltip":!0}),i(R,{label:"执行状态",align:"center",prop:"status"},{default:m((e=>[i(N,{type:"0"===e.row.status?"success":"warning","disable-transitions":""},{default:m((()=>[C(v(t.statusFormat(e.row)||"-- --"),1)])),_:2},1032,["type"])])),_:1}),i(R,{label:"执行时间",align:"center",prop:"create_time",width:"180"},{default:m((a=>[F("span",null,v(e.dateStrFormat(a.row.create_time)),1)])),_:1}),i(R,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:m((e=>[i(B,{size:"mini",type:"text",onClick:a=>t.handleView(e.row)},{default:m((()=>[i(V,{name:"elementView"}),S])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[E,e.loading]]),w(F("div",null,[i(K),i(H,{background:"",total:e.total,"current-page":e.queryParams.pageNum,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])],512),[[k,e.total>0]])])),_:1}),i(A,{title:"调度日志详细",modelValue:e.open,"onUpdate:modelValue":a[4]||(a[4]=a=>e.open=a),width:"700px","append-to-body":""},{footer:m((()=>[F("div",I,[i(B,{onClick:a[3]||(a[3]=a=>e.open=!1)},{default:m((()=>[T])),_:1})])])),default:m((()=>[i(Q,{ref:"ruleFormRef",model:e.modelForm,"label-width":"100px",size:"mini"},{default:m((()=>[i(L,null,{default:m((()=>[i(J,{span:12},{default:m((()=>[i(p,{label:"日志序号："},{default:m((()=>[C(v(e.modelForm.logId),1)])),_:1})])),_:1}),i(J,{span:12},{default:m((()=>[i(p,{label:"任务分组："},{default:m((()=>[C(v(e.modelForm.jobGroup),1)])),_:1})])),_:1}),i(J,{span:12},{default:m((()=>[i(p,{label:"任务名称："},{default:m((()=>[C(v(e.modelForm.name),1)])),_:1})])),_:1}),i(J,{span:12},{default:m((()=>[i(p,{label:"执行时间："},{default:m((()=>[C(v(e.modelForm.create_time),1)])),_:1})])),_:1}),i(J,{span:12},{default:m((()=>[i(p,{label:"调用方法："},{default:m((()=>[C(v(e.modelForm.invokeTarget),1)])),_:1})])),_:1}),i(J,{span:12},{default:m((()=>[i(p,{label:"日志信息："},{default:m((()=>[C(v(e.modelForm.logInfo),1)])),_:1})])),_:1}),i(J,{span:24},{default:m((()=>[i(p,{label:"执行状态："},{default:m((()=>[0==e.modelForm.status?(b(),d("div",D,"正常")):1==e.modelForm.status?(b(),d("div",O,"失败")):z("",!0)])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}]]);export{B as default};
