import{at as C,_ as x,D as q,A as J,k as U,m as L,M as Q,p as K,r as l,U as P,a as w,h as u,w as a,g as H,I as k,H as S,o as i,au as W,F as I,e as M,f as b,v as _,i as h,t as N,x as X,b as Y}from"./index.1704797758166.js";import Z from"./editModule.1704797758166.js";function $(o){return C({url:"/monitor/job/list",method:"get",params:o})}function ee(o){return C({url:"/monitor/job/"+o,method:"delete"})}function te(o){return C({url:"/monitor/job/changeStatus",method:"put",data:o})}function oe(o){return C({url:"/monitor/job/start/"+o,method:"get"})}function ue(o){return C({url:"/monitor/job/stop/"+o,method:"get"})}const ne={name:"Job",components:{EditModule:Z},setup(){const{proxy:o}=H(),d=q(),z=q(null);J();const t=U({loading:!0,ids:[],single:!0,multiple:!0,title:"",tableData:[],total:0,open:!1,modelForm:{},jobGroupOptions:[],statusOptions:[],queryParams:{pageNum:1,pageSize:10,jobName:void 0,jobGroup:void 0,status:void 0}}),c=()=>{t.loading=!0,$(t.queryParams).then(e=>{t.tableData=e.data.data,t.total=e.data.total,t.loading=!1})},V=()=>{t.queryParams.jobName=void 0,t.queryParams.jobGroup=void 0,t.queryParams.status=void 0,c()},j=(e,s)=>o.selectDictLabel(t.statusOptions,e.status),g=(e,s)=>o.selectDictLabel(t.jobGroupOptions,e.jobGroup),y=e=>{e=[],t.title="\u6DFB\u52A0\u5B9A\u65F6\u4EFB\u52A1",d.value.openDialog(e)},F=e=>{t.title="\u4FEE\u6539\u5B9A\u65F6\u4EFB\u52A1",d.value.openDialog(e)},m=e=>{const s=e.jobId||t.ids;k({message:'\u662F\u5426\u786E\u8BA4\u5220\u9664\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+s+'"\u7684\u6570\u636E\u9879?',title:"\u8B66\u544A",showCancelButton:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(function(){return ee(s).then(()=>{c(),S.success("\u5220\u9664\u6210\u529F")})})},p=e=>{t.ids=e.map(s=>s.jobId),t.single=e.length!=1,t.multiple=!e.length},v=e=>{t.queryParams.pageSize=e,c()},E=e=>{t.queryParams.pageNum=e,c()},A=e=>{let s=e.status==="0"?"\u542F\u7528":"\u505C\u7528";k({message:'\u786E\u8BA4\u8981"'+s+'""'+e.jobName+'"\u4EFB\u52A1\u5417?',title:"\u8B66\u544A",showCancelButton:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(function(){return te({jobId:e.jobId,status:e.status})}).then(()=>{S({message:s+"\u6210\u529F",type:"success"})}).catch(function(){e.status=e.status==="0"?"1":"0"})},r=e=>{let s=e.entryId>0?"\u505C\u6B62":"\u542F\u52A8";k({message:"\u786E\u8BA4\u8981\u7ACB\u5373"+s+'"'+e.jobName+'"\u4EFB\u52A1\u5417?',title:"\u8B66\u544A",showCancelButton:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(function(){if(e.entryId>0)ue(e.jobId).then(D=>{c()});else return oe(e.jobId).then(D=>{c()})}).then(()=>{S({message:s+"\u6267\u884C\u6210\u529F",type:"success"})})};return L(()=>{c(),o.getDicts("sys_normal_disable").then(e=>{t.statusOptions=e.data}),o.getDicts("sys_job_group").then(e=>{t.jobGroupOptions=e.data}),o.mittBus.on("onEditJobModule",e=>{c()})}),Q(()=>{o.mittBus.off("onEditJobModule")}),{editModuleRef:d,ruleFormRef:z,handleSelectionChange:p,handleSizeChange:v,handleCurrentChange:E,handleQuery:c,resetQuery:V,onOpenAddModule:y,onOpenEditModule:F,statusFormat:j,jobGroupFormat:g,onTabelRowDel:m,handleRun:r,handleStatusChange:A,...K(t)}}},ae={class:"app-container"},le=h(" \u641C\u7D22"),se=h(" \u91CD\u7F6E "),re=h("\u65B0\u589E"),ie=h("\u5220\u9664"),de=h("\u7F16\u8F91"),ce=h("\u5220\u9664");function me(o,d,z,t,c,V){const j=l("el-input"),g=l("el-form-item"),y=l("el-option"),F=l("el-select"),m=l("SvgIcon"),p=l("el-button"),v=l("el-form"),E=l("el-col"),A=l("el-row"),r=l("el-table-column"),e=l("el-switch"),s=l("el-table"),D=l("el-divider"),G=l("el-pagination"),T=l("el-card"),O=l("EditModule"),f=P("auth"),R=P("loading");return i(),w("div",ae,[u(T,{shadow:"always"},{default:a(()=>[u(v,{model:o.queryParams,ref:"queryForm",inline:!0,"label-width":"68px"},{default:a(()=>[u(g,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"jobName"},{default:a(()=>[u(j,{placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0\u6A21\u7CCA\u67E5\u8BE2",clearable:"",size:"small",onKeyup:W(t.handleQuery,["enter"]),style:{width:"240px"},modelValue:o.queryParams.jobName,"onUpdate:modelValue":d[0]||(d[0]=n=>o.queryParams.jobName=n)},null,8,["onKeyup","modelValue"])]),_:1}),u(g,{label:"\u4EFB\u52A1\u7EC4\u540D",prop:"jobGroup"},{default:a(()=>[u(F,{modelValue:o.queryParams.jobGroup,"onUpdate:modelValue":d[1]||(d[1]=n=>o.queryParams.jobGroup=n),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u7EC4\u540D",clearable:"",size:"small",style:{width:"240px"}},{default:a(()=>[(i(!0),w(I,null,M(o.jobGroupOptions,n=>(i(),b(y,{key:n.dictValue,label:n.dictLabel,value:n.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(g,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:a(()=>[u(F,{modelValue:o.queryParams.status,"onUpdate:modelValue":d[2]||(d[2]=n=>o.queryParams.status=n),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",size:"small",style:{width:"240px"}},{default:a(()=>[(i(!0),w(I,null,M(o.statusOptions,n=>(i(),b(y,{key:n.dictValue,label:n.dictLabel,value:n.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(g,null,{default:a(()=>[u(p,{type:"primary",size:"mini",onClick:t.handleQuery},{default:a(()=>[u(m,{name:"elementSearch"}),le]),_:1},8,["onClick"]),u(p,{size:"mini",onClick:t.resetQuery},{default:a(()=>[u(m,{name:"elementRefresh"}),se]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),u(A,{gutter:10,class:"mb8"},{default:a(()=>[u(E,{span:1.5},{default:a(()=>[_((i(),b(p,{type:"primary",plain:"",size:"mini",onClick:t.onOpenAddModule},{default:a(()=>[u(m,{name:"elementPlus"}),re]),_:1},8,["onClick"])),[[f,"tool:job:add"]])]),_:1},8,["span"]),u(E,{span:1.5},{default:a(()=>[_((i(),b(p,{type:"danger",plain:"",size:"mini",disabled:o.multiple,onClick:t.onTabelRowDel},{default:a(()=>[u(m,{name:"elementDelete"}),ie]),_:1},8,["disabled","onClick"])),[[f,"tool:job:delete"]])]),_:1},8,["span"])]),_:1}),_((i(),b(s,{data:o.tableData,onSelectionChange:t.handleSelectionChange},{default:a(()=>[u(r,{type:"selection",width:"55",align:"center"}),u(r,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"jobId"}),u(r,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"jobName","show-overflow-tooltip":!0}),u(r,{label:"\u4EFB\u52A1\u7EC4\u540D",align:"center",prop:"jobGroup",formatter:t.jobGroupFormat},null,8,["formatter"]),u(r,{label:"\u4EFB\u52A1\u7C7B\u578B",align:"center",prop:"jobType"},{default:a(n=>[h(N(n.row.jobType==1?"\u63A5\u53E3":"\u51FD\u6570"),1)]),_:1}),u(r,{label:"\u8C03\u7528\u76EE\u6807",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),u(r,{label:"cron\u6267\u884C\u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression","show-overflow-tooltip":!0}),u(r,{label:"\u72B6\u6001",align:"center"},{default:a(n=>[u(e,{modelValue:n.row.status,"onUpdate:modelValue":B=>n.row.status=B,"active-value":"0","inactive-value":"1",onClick:B=>t.handleStatusChange(n.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),u(r,{label:"\u64CD\u4F5C",align:"center","class-name":"small-padding fixed-width"},{default:a(n=>[_((i(),b(p,{size:"mini",type:"text",onClick:B=>t.handleRun(n.row)},{default:a(()=>[u(m,{name:"elementSwitchButton"}),h(N(n.row.entryId>0?"\u505C\u6B62":"\u542F\u52A8"),1)]),_:2},1032,["onClick"])),[[f,"tool:job:run"]]),_((i(),b(p,{size:"mini",type:"text",onClick:B=>t.onOpenEditModule(n.row)},{default:a(()=>[u(m,{name:"elementEdit"}),de]),_:2},1032,["onClick"])),[[f,"tool:job:edit"]]),_((i(),b(p,{size:"mini",type:"text",onClick:B=>t.onTabelRowDel(n.row)},{default:a(()=>[u(m,{name:"elementDelete"}),ce]),_:2},1032,["onClick"])),[[f,"tool:job:delete"]])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[R,o.loading]]),_(Y("div",null,[u(D),u(G,{background:"",total:o.total,"current-page":o.queryParams.pageNum,"page-size":o.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])],512),[[X,o.total>0]])]),_:1}),u(O,{ref:"editModuleRef",title:o.title},null,8,["title"])])}const he=x(ne,[["render",me]]);export{he as default};
