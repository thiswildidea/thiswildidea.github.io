var t=Object.defineProperty,i=(i,e,r)=>(((i,e,r)=>{e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r})(i,"symbol"!=typeof e?e+"":e,r),r);import{_ as e,u as r,A as s,k as o,m as n,V as a,l,p as h,a as m,o as c,X as u,Y as f,b as p}from"./index.1705138355874.js";import{b as g,c as d}from"./index.1705138355874107.js";import{l as v,M as b}from"./mapconfig.1705138355874.js";var x="undefined"!=typeof Float32Array?Float32Array:Array;function A(t,i){var e=i[0],r=i[1],s=i[2],o=i[3],n=i[4],a=i[5],l=i[6],h=i[7],m=i[8],c=i[9],u=i[10],f=i[11],p=i[12],g=i[13],d=i[14],v=i[15],b=e*a-r*n,x=e*l-s*n,A=e*h-o*n,B=r*l-s*a,y=r*h-o*a,P=s*h-o*l,w=m*g-c*p,M=m*d-u*p,R=m*v-f*p,U=c*d-u*g,F=c*v-f*g,_=u*v-f*d,L=b*_-x*F+A*U+B*R-y*M+P*w;return L?(L=1/L,t[0]=(a*_-l*F+h*U)*L,t[1]=(l*R-n*_-h*M)*L,t[2]=(n*F-a*R+h*w)*L,t[3]=(s*F-r*_-o*U)*L,t[4]=(e*_-s*R+o*M)*L,t[5]=(r*R-e*F-o*w)*L,t[6]=(g*P-d*y+v*B)*L,t[7]=(d*A-p*P-v*x)*L,t[8]=(p*y-g*A+v*b)*L,t):null}function B(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y(t,i,e){var r=i[0],s=i[1],o=i[2],n=i[3],a=i[4],l=i[5],h=i[6],m=i[7],c=i[8],u=i[9],f=i[10],p=i[11],g=i[12],d=i[13],v=i[14],b=i[15],x=e[0],A=e[1],B=e[2],y=e[3];return t[0]=x*r+A*a+B*c+y*g,t[1]=x*s+A*l+B*u+y*d,t[2]=x*o+A*h+B*f+y*v,t[3]=x*n+A*m+B*p+y*b,x=e[4],A=e[5],B=e[6],y=e[7],t[4]=x*r+A*a+B*c+y*g,t[5]=x*s+A*l+B*u+y*d,t[6]=x*o+A*h+B*f+y*v,t[7]=x*n+A*m+B*p+y*b,x=e[8],A=e[9],B=e[10],y=e[11],t[8]=x*r+A*a+B*c+y*g,t[9]=x*s+A*l+B*u+y*d,t[10]=x*o+A*h+B*f+y*v,t[11]=x*n+A*m+B*p+y*b,x=e[12],A=e[13],B=e[14],y=e[15],t[12]=x*r+A*a+B*c+y*g,t[13]=x*s+A*l+B*u+y*d,t[14]=x*o+A*h+B*f+y*v,t[15]=x*n+A*m+B*p+y*b,t}function P(t,i,e){return t[0]=i[0]-e[0],t[1]=i[1]-e[1],t[2]=i[2]-e[2],t}function w(t,i){var e=i[0],r=i[1],s=i[2],o=e*e+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=i[0]*o,t[1]=i[1]*o,t[2]=i[2]*o,t}function M(t,i,e){var r=i[0],s=i[1],o=i[2],n=e[3]*r+e[7]*s+e[11]*o+e[15];return n=n||1,t[0]=(e[0]*r+e[4]*s+e[8]*o+e[12])/n,t[1]=(e[1]*r+e[5]*s+e[9]*o+e[13])/n,t[2]=(e[2]*r+e[6]*s+e[10]*o+e[14])/n,t}function R(t,i,e){var r=i[0],s=i[1],o=i[2];return t[0]=r*e[0]+s*e[3]+o*e[6],t[1]=r*e[1]+s*e[4]+o*e[7],t[2]=r*e[2]+s*e[5]+o*e[8],t}Math.hypot||(Math.hypot=function(){for(var t=0,i=arguments.length;i--;)t+=arguments[i]*arguments[i];return Math.sqrt(t)});var U,F,_=(U=new x(3),x!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0),F=U,function(t,i,e,r,s,o){var n,a;for(i||(i=3),e||(e=0),a=r?Math.min(r*i+e,t.length):t.length,n=e;n<a;n+=i)F[0]=t[n],F[1]=t[n+1],F[2]=t[n+2],s(F,F,o),t[n]=F[0],t[n+1]=F[1],t[n+2]=F[2];return t});class L{constructor(t,e,r,s,o,n){i(this,"view",null),i(this,"nring",null),i(this,"externalRenderers",null),i(this,"webMercatorUtils",null),i(this,"spead",null),i(this,"symbolsize",null),i(this,"color",null),i(this,"points",null),i(this,"needsUpdate",null),i(this,"numPoints",null),i(this,"callback",null),i(this,"localOrigin",null),i(this,"localOriginRender",null),i(this,"callbackPointermove",null),i(this,"vboBasePositions",null),i(this,"vboBaseNormals",null),i(this,"vboBaseOffset",null),i(this,"iboBase",null),i(this,"pointBasePositions",null),i(this,"pointBaseNormals",null),i(this,"pointBaseIndices",null),i(this,"pointBaseOffsets",null),i(this,"program",null),i(this,"programAttribVertexPosition",null),i(this,"programAttribVertexNormal",null),i(this,"programAttribOffset",null),i(this,"programUniformProjectionMatrix",null),i(this,"programUniformModelViewMatrix",null),i(this,"programUniformNormalMatrix",null),i(this,"programUniformAmbientColor",null),i(this,"programUniformLightingDirection",null),i(this,"programUniformDirectionalColor",null),i(this,"pointInstanceInputToRender",null),i(this,"tempMatrix4",null),i(this,"tempMatrix3",null),i(this,"tempVec3",null),i(this,"fshader",null),i(this,"vshader",null),i(this,"uDisplay",null),i(this,"uCurrentTime",null),this.view=t,this.externalRenderers=e,this.webMercatorUtils=r,this.nring=s.nring=s.nring,this.spead=s.spead=s.spead,this.symbolsize=s.size=s.size,this.color=s.color,this.points=s.points,this.needsUpdate=!1,this.numPoints=null,this.callback=o,this.callbackPointermove=n,this.localOrigin=null,this.localOriginRender=null,this.vboBasePositions=null,this.vboBaseNormals=null,this.vboBaseOffset=null,this.iboBase=null,this.pointBasePositions=null,this.pointBaseNormals=null,this.pointBaseIndices=null,this.pointBaseOffsets=null,this.program=null,this.programAttribVertexPosition=null,this.programAttribVertexNormal=null,this.programAttribOffset=null,this.programUniformProjectionMatrix=null,this.programUniformModelViewMatrix=null,this.programUniformNormalMatrix=null,this.programUniformAmbientColor=null,this.programUniformLightingDirection=null,this.programUniformDirectionalColor=null,this.pointInstanceInputToRender=null,this.tempMatrix4=new Float32Array(16),this.tempMatrix3=new Float32Array(9),this.tempVec3=new Float32Array(3),this.fshader="precision highp float;uniform float u_current_time;varying vec2 v_offset;const float PI = 3.14159;const float N_RINGS ="+parseFloat(this.nring).toFixed(1)+";const vec3 COLOR = vec3("+this.color[0]+","+this.color[1]+","+this.color[2]+");const float FREQ = "+parseFloat(this.spead).toFixed(1)+";void main() {  float l = length(v_offset);  float intensity = clamp(cos(l * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (l * 2.0 * N_RINGS - FREQ * u_current_time)), 0.0, 1.0);  gl_FragColor = vec4(COLOR * intensity, intensity); }",this.vshader="precision highp float;attribute vec3 aVertexPosition;attribute vec3 aVertexNormal;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;uniform mat3 uNormalMatrix;uniform vec3 uAmbientColor;uniform vec3 uLightingDirection;uniform vec3 uDirectionalColor;uniform mat3 u_transform;uniform mat3 u_display;attribute vec2 a_offset;varying vec2 v_offset;const float SIZE = 70.0;void main() {    gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aVertexPosition, 1.0);    vec3 transformedNormal = normalize(uNormalMatrix * aVertexNormal);    float directionalLightWeighting = max(dot(transformedNormal, uLightingDirection), 0.0);    gl_PointSize = 10.0;   v_offset = a_offset;}"}setup(t){this.initShaders(t),this.initData(t,this.points),t.resetWebGLState(),this.initevent()}render(t){var i=t.gl;i.enable(i.DEPTH_TEST),i.disable(i.CULL_FACE),i.disable(i.BLEND),i.useProgram(this.program),this.setCommonUniforms(t),this.bindPointBase(t),B(this.tempMatrix4),function(t,i,e){var r,s,o,n,a,l,h,m,c,u,f,p,g=e[0],d=e[1],v=e[2];i===t?(t[12]=i[0]*g+i[4]*d+i[8]*v+i[12],t[13]=i[1]*g+i[5]*d+i[9]*v+i[13],t[14]=i[2]*g+i[6]*d+i[10]*v+i[14],t[15]=i[3]*g+i[7]*d+i[11]*v+i[15]):(r=i[0],s=i[1],o=i[2],n=i[3],a=i[4],l=i[5],h=i[6],m=i[7],c=i[8],u=i[9],f=i[10],p=i[11],t[0]=r,t[1]=s,t[2]=o,t[3]=n,t[4]=a,t[5]=l,t[6]=h,t[7]=m,t[8]=c,t[9]=u,t[10]=f,t[11]=p,t[12]=r*g+a*d+c*v+i[12],t[13]=s*g+l*d+u*v+i[13],t[14]=o*g+h*d+f*v+i[14],t[15]=n*g+m*d+p*v+i[15])}(this.tempMatrix4,this.tempMatrix4,this.localOriginRender),y(this.tempMatrix4,t.camera.viewMatrix,this.tempMatrix4),i.uniformMatrix4fv(this.programUniformModelViewMatrix,!1,this.tempMatrix4),function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(this.tempMatrix3),i.uniformMatrix3fv(this.programUniformNormalMatrix,!1,this.tempMatrix3),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.drawElements(i.TRIANGLES,this.pointBaseIndices.length,i.UNSIGNED_SHORT,0),this.externalRenderers.requestRender(this.view),t.resetWebGLState()}getShader(t,i){var e,r="fshader"===i?this.fshader:this.vshader;if("fshader"===i)e=t.createShader(t.FRAGMENT_SHADER);else{if("vshader"!==i)return null;e=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(e,r),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)?e:null}linkProgram(t,i,e){var r=t.createProgram();return t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)?r:null}initShaders(t){var i=t.gl,e=this.getShader(i,"fshader"),r=this.getShader(i,"vshader");this.program=this.linkProgram(i,e,r),this.program,i.useProgram(this.program),this.programAttribVertexPosition=i.getAttribLocation(this.program,"aVertexPosition"),i.enableVertexAttribArray(this.programAttribVertexPosition),this.programAttribVertexNormal=i.getAttribLocation(this.program,"aVertexNormal"),i.enableVertexAttribArray(this.programAttribVertexNormal),this.programAttribOffset=i.getAttribLocation(this.program,"a_offset"),i.enableVertexAttribArray(this.programAttribOffset),this.programUniformProjectionMatrix=i.getUniformLocation(this.program,"uProjectionMatrix"),this.programUniformModelViewMatrix=i.getUniformLocation(this.program,"uModelViewMatrix"),this.programUniformNormalMatrix=i.getUniformLocation(this.program,"uNormalMatrix"),this.programUniformAmbientColor=i.getUniformLocation(this.program,"uAmbientColor"),this.programUniformLightingDirection=i.getUniformLocation(this.program,"uLightingDirection"),this.programUniformDirectionalColor=i.getUniformLocation(this.program,"uDirectionalColor"),this.uDisplay=i.getUniformLocation(this.program,"u_display"),this.uCurrentTime=i.getUniformLocation(this.program,"u_current_time")}async initData(t,i){const[e]=await v(["esri/geometry/SpatialReference"],{url:b.jsapiurl,css:b.jscssurl});var r=t.gl;this.numPoints=i.length;var s=this.view.extent.center.spatialReference;this.localOrigin=[this.view.extent.center.x,this.view.extent.center.y,0],this.localOriginRender=this.externalRenderers.toRenderCoordinates(this.view,this.localOrigin,0,s,new Float32Array(3),0,1),this.pointInstanceInputToRender=new Array(this.numPoints);for(var o=0;o<this.numPoints;++o){var n=i[o],a=this.webMercatorUtils.xyToLngLat(n.x,n.y),l=new e({wkid:4326}),h=[a[0],a[1],0],m=this.externalRenderers.renderCoordinateTransformAt(this.view,h,l,new Float64Array(16));this.pointInstanceInputToRender[o]=m}this.pointBasePositions=new Float64Array(3*this.numPoints*4),this.pointBaseNormals=new Float64Array(3*this.numPoints*4),this.pointBaseIndices=new Uint16Array(6*this.numPoints),this.pointBaseOffsets=new Float64Array(2*this.numPoints*4);for(let p=0;p<this.numPoints;p++){var c=new Float32Array(16);B(c),y(c,this.pointInstanceInputToRender[p],c);var u=new Float32Array(9);A(u,c);var f=12;this.pointBaseOffsets[8*p+0]=-.5,this.pointBaseOffsets[8*p+1]=-.5,this.pointBaseOffsets[8*p+2]=.5,this.pointBaseOffsets[8*p+3]=-.5,this.pointBaseOffsets[8*p+4]=-.5,this.pointBaseOffsets[8*p+5]=.5,this.pointBaseOffsets[8*p+6]=.5,this.pointBaseOffsets[8*p+7]=.5,this.pointBasePositions[p*f+0]=-1*this.symbolsize,this.pointBasePositions[p*f+1]=-1*this.symbolsize,this.pointBasePositions[p*f+2]=void 0!==i[p].z?i[p].z:1,this.pointBasePositions[p*f+3]=1*this.symbolsize,this.pointBasePositions[p*f+4]=-1*this.symbolsize,this.pointBasePositions[p*f+5]=void 0!==i[p].z?i[p].z:1,this.pointBasePositions[p*f+6]=-1*this.symbolsize,this.pointBasePositions[p*f+7]=1*this.symbolsize,this.pointBasePositions[p*f+8]=void 0!==i[p].z?i[p].z:1,this.pointBasePositions[p*f+9]=1*this.symbolsize,this.pointBasePositions[p*f+10]=1*this.symbolsize,this.pointBasePositions[p*f+11]=void 0!==i[p].z?i[p].z:1,_(this.pointBasePositions,0,p*f,4,M,c),_(this.pointBasePositions,0,p*f,4,P,this.localOriginRender),_(this.pointBaseNormals,0,p*f,4,R,u),_(this.pointBaseNormals,0,p*f,4,w,null);this.pointBaseIndices[6*p+0]=0+4*p,this.pointBaseIndices[6*p+1]=1+4*p,this.pointBaseIndices[6*p+2]=2+4*p,this.pointBaseIndices[6*p+3]=1+4*p,this.pointBaseIndices[6*p+4]=3+4*p,this.pointBaseIndices[6*p+5]=2+4*p}this.vboBasePositions=this.createVertexBuffer(r,this.pointBasePositions),this.vboBaseNormals=this.createVertexBuffer(r,this.pointBaseNormals),this.vboBaseOffset=this.createVertexBuffer(r,this.pointBaseOffsets),this.iboBase=this.createIndexBuffer(r,this.pointBaseIndices)}async initevent(){const[t,i]=await v(["esri/geometry/Point","esri/geometry/SpatialReference"],{url:b.jsapiurl,css:b.jscssurl});this.view&&(this.view.on("click",(e=>{if(this.points.length){var r=this.points.map((r=>{let s=new t({x:r.x,y:r.y,spatialReference:i.WebMercator});var o=this.view.toScreen(s);return Math.sqrt((o.x-e.x)*(o.x-e.x)+(o.y-e.y)*(o.y-e.y))})),s=0;r.forEach(((t,i)=>{t<r[s]&&(s=i)})),r[s]>35||this.callback(this.points[s])}else this.callback(null)})),this.view.on("pointer-move",(e=>{if(this.points.length){var r=this.points.map((r=>{let s=new t({x:r.x,y:r.y,spatialReference:i.WebMercator});var o=this.view.toScreen(s);return Math.sqrt((o.x-e.x)*(o.x-e.x)+(o.y-e.y)*(o.y-e.y))})),s=0;r.forEach(((t,i)=>{t<r[s]&&(s=i)})),r[s]>35||this.callbackPointermove(this.points[s])}else;})))}createVertexBuffer(t,i){var e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e);var r=new Float32Array(i);return t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),e}createIndexBuffer(t,i){var e=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),e}bindPointBase(t){var i=t.gl;i.bindBuffer(i.ARRAY_BUFFER,this.vboBasePositions),i.enableVertexAttribArray(this.programAttribVertexPosition),i.vertexAttribPointer(this.programAttribVertexPosition,3,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.vboBaseNormals),i.enableVertexAttribArray(this.programAttribVertexNormal),i.vertexAttribPointer(this.programAttribVertexNormal,3,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.vboBaseOffset),i.enableVertexAttribArray(this.programAttribOffset),i.vertexAttribPointer(this.programAttribOffset,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.iboBase)}getFlatColor(t,i){return i[0]=t.color[0]*t.intensity,i[1]=t.color[1]*t.intensity,i[2]=t.color[2]*t.intensity,i}setCommonUniforms(t){var i=t.gl;t.camera,i.uniform1f(this.uCurrentTime,performance.now()/1e3),i.uniform3fv(this.programUniformDirectionalColor,this.getFlatColor(t.sunLight.diffuse,this.tempVec3)),i.uniform3fv(this.programUniformAmbientColor,this.getFlatColor(t.sunLight.ambient,this.tempVec3)),i.uniform3fv(this.programUniformLightingDirection,t.sunLight.direction),i.uniformMatrix4fv(this.programUniformProjectionMatrix,!1,t.camera.projectionMatrix)}}const N={name:"map",components:{},setup(){const t=r();s();const i=o({});return n((async()=>{!async function(t){const[i,e,r,s,o,n,a,l,h,m,c,u,f,p]=await v(["esri/Map","esri/views/SceneView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/widgets/Expand","esri/Camera","esri/widgets/Home","esri/widgets/Fullscreen","esri/widgets/LayerList","esri/widgets/Legend","esri/views/3d/externalRenderers","esri/widgets/BasemapGallery","esri/geometry/support/webMercatorUtils","esri/geometry/SpatialReference"],{url:b.jsapiurl,css:b.jscssurl}),d=new i({basemap:"satellite",ground:{surfaceColor:"#021425"}}),x=new e({spatialReference:p.WebMercator,container:"viewDiv_fashPoint",map:d}),A=new u({view:x}),B=new o({view:x,content:A,expandIconClass:"esri-icon-basemap",expandTooltip:"LayerList",group:"top-left"});x.ui.add(B,"top-left");const y=new n({fov:t.camera.fov,heading:t.camera.heading,position:{x:t.camera.position.x,y:t.camera.position.y,z:t.camera.position.z,spatialReference:{wkid:3857}},tilt:t.camera.tilt});s.once((()=>!0===(null==x?void 0:x.stationary))).then((()=>{x.goTo(y,t.cameraoptions).then((()=>{g("flashPointdata").then((t=>{const i=new L(x,c,f,{color:[255,0,0,1],nring:4,spead:.5,size:75e4,view:x,points:t},(t=>{console.log(t)}),(t=>{}));c.add(x,i)}))}))})),s.on((()=>x),"click",(t=>{console.log("view camera: ",x.camera)}))}(await d())})),a((()=>{})),l((()=>t.state.tagsViewRoutes.isTagsViewCurrenFull)),{...h(i)}}},V={class:"home-container"},O=[(t=>(u("data-v-321034d6"),t=t(),f(),t))((()=>p("div",{id:"viewDiv_fashPoint"},null,-1)))];const E=e(N,[["render",function(t,i,e,r,s,o){return c(),m("div",V,O)}],["__scopeId","data-v-321034d6"]]);export{E as default};
