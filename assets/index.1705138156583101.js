import{_ as e,k as a,p as l,r as t,o as n,f as o,g as s,D as r,l as i,m as u,aG as d,M as p,Q as m,a as c,h,w as f,I as g,H as y,b,au as w,F as C,e as k,v as V,i as x,t as _,x as v}from"./index.1705138156583.js";import{l as P,e as q,f as z,h as N}from"./user.1705138156583.js";import{t as S}from"./dept.1705138156583.js";import D from"./editModule.17051381565838.js";import{l as I}from"./string.1705138156583.js";const O={name:"systemUser",components:{MDInput:e({name:"MDInput",props:{modelValue:String,placeholder:String,type:{type:String,required:!1,default:"like"}},emits:["update:modelValue"],setup(e,t){const{proxy:n}=s(),o=a({inputVal:""});return{initVal:()=>{if(console.log("initVal",!e.modelValue),e.modelValue){let a=e.modelValue;switch(e.type){case"like":-1!=a.indexOf("*")&&(a=a.substring(1,a.length-1));break;case"ne":a=a.substring(1);break;case"ge":case"le":a=a.substring(2)}o.inputVal=a}else o.inputVal=""},backValue:a=>{let l=a;switch(e.type){case"like":l="*"+l+"*";break;case"ne":l="!"+l;break;case"ge":l=">="+l;break;case"le":l="<="+l}n.$emit("update:modelValue",l)},...l(o)}}},[["render",function(e,a,l,s,r,i){const u=t("el-input");return n(),o(u,{placeholder:l.placeholder,modelValue:e.inputVal,"onUpdate:modelValue":[a[0]||(a[0]=a=>e.inputVal=a),s.backValue]},null,8,["placeholder","modelValue","onUpdate:modelValue"])}]]),EditModule:D},setup(){const{proxy:e}=s(),t=r(),n=a({tableData:{data:[],total:0},loading:!1,postOptions:[],defaultProps:{children:"children",label:"label"},sexOptions:[],roleOptions:[],statusOptions:[],deptName:void 0,single:!0,multiple:!0,ids:[],title:"",deptOptions:void 0,queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:void 0,deptId:void 0}});i((()=>n.deptName),(a=>{e.$refs.tree.filter(a)}));const o=async()=>{n.loading=!0,P(n.queryParams).then((e=>{200!=e.code&&(n.loading=!1),n.tableData.data=e.rows,n.tableData.total=e.total,n.loading=!1}))},m=async()=>{n.queryParams.pageNum=1,await o()};return u((()=>{o(),(async()=>{S().then((e=>{n.deptOptions=e.data}))})(),d("sys_normal_disable").then((e=>{n.statusOptions=e.data})),e.getDicts("sys_user_sex").then((e=>{n.sexOptions=e.data})),e.mittBus.on("onEditUserModule",(e=>{m()}))})),p((()=>{e.mittBus.off("onEditUserModule")})),{userFormRef:t,sexFormat:(a,l)=>e.selectDictLabel(n.sexOptions,a.sex),handleQuery:m,resetQuery:async()=>{n.queryParams.pageNum=1,n.queryParams.pageSize=10,n.queryParams.userName="",n.queryParams.phonenumber="",n.queryParams.status="",n.queryParams.deptId=0,m()},letterAvatar:I,handleSelectionChange:e=>{n.ids=e.map((e=>e.userId)),n.single=1!=e.length,n.multiple=!e.length},getList:o,handleAdd:e=>{n.title="添加用戶",t.value.openDialog(null)},handleUpdate:e=>{n.title="修改用户",t.value.openDialog(e)},handleDelete:e=>{const a=e.userId||n.ids;g({message:'是否确认删除用户编号为"'+a+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return z(a).then((()=>{o(),y.success("删除成功")}))}))},handleExport:()=>{const a=n.queryParams;g({message:"是否确认导出所有用户数据项?",title:"警告",confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return N(a)})).then((a=>{e.download(a.data)}))},handleStatusChange:e=>{let a="0"===e.status?"启用":"停用";g({title:"警告",message:'确认要"'+a+'""'+e.userName+'"用户吗?',showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:(l,t,n)=>{if("confirm"===l)return q(e.userId,e.status).then((()=>{y.success(a+"成功"),n()}));n()}}).catch((()=>{e.status="0"===e.status?"1":"0"}))},onHandleSizeChange:e=>{n.queryParams.pageSize=e,m()},onHandleCurrentChange:e=>{n.queryParams.pageNum=e,m()},filterNode:(e,a)=>!e||-1!==a.label.indexOf(e),handleNodeClick:e=>{n.queryParams.deptId=e.id,o(),n.queryParams.id=0},...l(n)}}},U={class:"system-user-container app-container"},B={class:"head-container"},M={class:"head-container"},E=x(" 搜索"),F=x(" 重置 "),Q=x("新增"),T=x("删除"),j=x("导出"),H=x("修改"),A=x("删除");const K=e(O,[["render",function(e,a,l,s,r,i){const u=t("el-input"),d=t("el-tree"),p=t("el-col"),g=t("el-form-item"),y=t("el-option"),P=t("el-select"),q=t("SvgIcon"),z=t("el-button"),N=t("el-form"),S=t("el-table-column"),D=t("el-image"),I=t("el-switch"),O=t("el-table"),K=t("el-divider"),L=t("el-pagination"),R=t("el-row"),$=t("el-card"),G=t("EditModule"),J=m("loading");return n(),c("div",U,[h($,{shadow:"always"},{default:f((()=>[h(R,{gutter:20},{default:f((()=>[h(p,{span:4,xs:24},{default:f((()=>[b("div",B,[h(u,{modelValue:e.deptName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.deptName=a),placeholder:"请输入部门名称",clearable:"",size:"small","prefix-icon":"el-icon-search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),b("div",M,[h(d,{data:e.deptOptions,props:e.defaultProps,"node-key":"id","expand-on-click-node":!1,"filter-node-method":s.filterNode,ref:"tree","default-expand-all":"",onNodeClick:s.handleNodeClick},null,8,["data","props","filter-node-method","onNodeClick"])])])),_:1}),h(p,{span:20,xs:24},{default:f((()=>[h(N,{model:e.queryParams,ref:"queryForm",inline:!0,"label-width":"78px"},{default:f((()=>[h(g,{label:"用户名称",prop:"userName"},{default:f((()=>[h(u,{placeholder:"用户名称模糊查询",clearable:"",size:"small",onKeyup:w(s.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.userName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.queryParams.userName=a)},null,8,["onKeyup","modelValue"])])),_:1}),h(g,{label:"手机号码",prop:"phonenumber"},{default:f((()=>[h(u,{modelValue:e.queryParams.phonenumber,"onUpdate:modelValue":a[2]||(a[2]=a=>e.queryParams.phonenumber=a),placeholder:"请输入手机号码",clearable:"",size:"small",style:{width:"240px"},onKeyup:w(s.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),h(g,{label:"状态",prop:"status"},{default:f((()=>[h(P,{modelValue:e.queryParams.status,"onUpdate:modelValue":a[3]||(a[3]=a=>e.queryParams.status=a),placeholder:"用户状态",clearable:"",size:"small",style:{width:"240px"}},{default:f((()=>[(n(!0),c(C,null,k(e.statusOptions,(e=>(n(),o(y,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(g,null,{default:f((()=>[h(z,{type:"primary",size:"mini",onClick:s.handleQuery},{default:f((()=>[h(q,{name:"elementSearch"}),E])),_:1},8,["onClick"]),h(z,{size:"mini",onClick:s.resetQuery},{default:f((()=>[h(q,{name:"elementRefresh"}),F])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),h(p,{span:1.5},{default:f((()=>[h(z,{type:"primary",plain:"",size:"mini",onClick:s.handleAdd},{default:f((()=>[h(q,{name:"elementPlus"}),Q])),_:1},8,["onClick"])])),_:1},8,["span"]),h(p,{span:1.5},{default:f((()=>[h(z,{type:"danger",plain:"",size:"mini",disabled:e.multiple,onClick:s.handleDelete},{default:f((()=>[h(q,{name:"elementDelete"}),T])),_:1},8,["disabled","onClick"])])),_:1},8,["span"]),h(p,{span:1.5},{default:f((()=>[h(z,{type:"warning",plain:"",size:"mini",onClick:s.handleExport},{default:f((()=>[h(q,{name:"elementDownload"}),j])),_:1},8,["onClick"])])),_:1},8,["span"]),V((n(),o(O,{data:e.tableData.data,stripe:"",onSelectionChange:s.handleSelectionChange,style:{width:"100%"}},{default:f((()=>[h(S,{type:"selection",width:"45",align:"center"}),h(S,{label:"用户编号",align:"center",key:"userId",prop:"userId"}),h(S,{label:"用户名",prop:"userName","show-overflow-tooltip":""}),h(S,{label:"头像","show-overflow-tooltip":""},{default:f((e=>[h(D,{class:"system-user-photo",src:e.row.avatar?e.row.avatar:s.letterAvatar(e.row.userName)},null,8,["src"])])),_:1}),h(S,{label:"用户性别",align:"center",prop:"sex",formatter:s.sexFormat},null,8,["formatter"]),h(S,{prop:"phonenumber",label:"手机","show-overflow-tooltip":""}),h(S,{prop:"email",label:"邮箱","show-overflow-tooltip":""}),h(S,{label:"状态",align:"center",key:"status"},{default:f((e=>[h(I,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":"0","inactive-value":"1",onClick:a=>s.handleStatusChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])])),_:1}),h(S,{prop:"create_time",label:"创建时间","show-overflow-tooltip":""},{default:f((a=>[x(_(e.dateStrFormat(a.row.createTime)),1)])),_:1}),h(S,{prop:"path",label:"操作",width:"150"},{default:f((e=>[h(z,{size:"mini",type:"text",onClick:a=>s.handleUpdate(e.row)},{default:f((()=>[h(q,{name:"elementEdit"}),H])),_:2},1032,["onClick"]),h(z,{size:"mini",type:"text",onClick:a=>s.handleDelete(e.row)},{default:f((()=>[h(q,{name:"elementDelete"}),A])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[J,e.loading]]),V(b("div",null,[h(K),h(L,{background:"",total:e.tableData.total,"page-sizes":[10,20,30],"current-page":e.queryParams.pageNum,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:s.onHandleSizeChange,onCurrentChange:s.onHandleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])],512),[[v,e.tableData.total>0]])])),_:1})])),_:1})])),_:1}),h(G,{ref:"userFormRef",title:e.title},null,8,["title"])])}],["__scopeId","data-v-59f84690"]]);export{K as default};
