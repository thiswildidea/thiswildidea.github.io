import{at as b,_ as ue,D as J,k as ae,m as ne,p as re,r as s,U as X,a as U,v as F,b as w,h as o,w as n,g as se,H as N,ax as y,I as Y,G as $,o as c,au as ee,F as Z,e as x,f as k,t as le,x as oe,i as m}from"./index.1704798071520.js";import{r as de,t as ie}from"./menu.1704798071520.js";import{r as me}from"./dept.1704798071520.js";function pe(l){return b({url:"/system/role/list",method:"get",params:l})}function te(l){return b({url:"/system/role/"+l,method:"get"})}function ce(l){return b({url:"/system/role",method:"post",data:l})}function he(l){return b({url:"/system/role",method:"put",data:l})}function fe(l){return b({url:"/system/role/dataScope",method:"put",data:l})}function Ce(l,a){return b({url:"/system/role/changeStatus",method:"put",data:{roleId:l,status:a}})}function ye(l){return b({url:"/system/role/"+l,method:"delete"})}function ge(l){return b({url:"/system/role/export",method:"get",params:l})}const Fe={name:"systemRole",setup(){const{proxy:l}=se(),a=J(null),D=J(null),r=J(null),t=ae({activeName:"first",loading:!0,ids:[],total:0,title:"",open:!1,roleList:[],showSearch:!0,single:!0,multiple:!0,statusOptions:[],menuOptions:[],menuCheckedKeys:[],deptOptions:[],openDataScope:!1,menuExpand:!1,menuNodeAll:!1,deptExpand:!0,deptNodeAll:!1,queryParams:{pageNum:1,pageSize:10,roleName:void 0,roleKey:void 0,status:void 0},dataScopeOptions:[{value:"1",label:"\u5168\u90E8\u6570\u636E\u6743\u9650"},{value:"2",label:"\u81EA\u5B9A\u6570\u636E\u6743\u9650"},{value:"3",label:"\u672C\u90E8\u95E8\u6570\u636E\u6743\u9650"},{value:"4",label:"\u672C\u90E8\u95E8\u53CA\u4EE5\u4E0B\u6570\u636E\u6743\u9650"},{value:"5",label:"\u4EC5\u672C\u4EBA\u6570\u636E\u6743\u9650"}],roleForm:{},rules:{roleName:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],roleKey:[{required:!0,message:"\u6743\u9650\u5B57\u7B26\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],roleSort:[{required:!0,message:"\u89D2\u8272\u987A\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),A=()=>{t.menuExpand=!1,t.menuNodeAll=!1,t.deptExpand=!0,t.deptNodeAll=!1,t.roleForm={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},t.roleForm={}},g=()=>{t.queryParams.pageNum=1,t.queryParams.pageSize=10,t.queryParams.roleName="",t.queryParams.roleKey="",t.queryParams.status="",E()},d=()=>{t.loading=!0,pe(t.queryParams).then(u=>{t.roleList=u.rows,t.total=u.total,t.loading=!1})},K=u=>{t.queryParams.pageSize=u,E()},z=u=>{t.queryParams.pageNum=u,E()},f=()=>{t.roleForm.roleId!=null&&(t.roleForm.deptIds=p(),fe(t.roleForm).then(u=>{N.success("\u4FEE\u6539\u6210\u529F"),t.openDataScope=!1,d()}))},p=()=>{const u=y(r);let e=u.getCheckedKeys(),i=u.getHalfCheckedKeys();return e.unshift.apply(e,i),e},E=()=>{t.queryParams.pageNum=1,d()},S=()=>{ie().then(u=>{t.menuOptions=u.menus})},P=u=>{t.ids=u.map(e=>e.roleId),t.single=u.length!=1,t.multiple=!u.length},C=u=>{let e=u.status==="0"?"\u542F\u7528":"\u505C\u7528";Y({closeOnClickModal:!1,closeOnPressEscape:!1,title:"\u8B66\u544A",message:'\u786E\u8BA4\u8981"'+e+'""'+u.roleName+'"\u89D2\u8272\u5417?',showCancelButton:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(function(){return Ce(u.roleId,u.status)}).then(()=>{N.success(e+"\u6210\u529F")}).catch(function(){u.status=u.status==="0"?"1":"0"})},I=u=>{A();const e=L(u.roleId);te(u.roleId).then(i=>{t.roleForm=i.data,t.openDataScope=!0,$(()=>{e.then(h=>{y(r).setCheckedKeys(h.checkedKeys)})}),t.title="\u5206\u914D\u6570\u636E\u6743\u9650"})},O=()=>{A(),S(),t.open=!0,t.title="\u6DFB\u52A0\u89D2\u8272"},R=u=>{const e=u.roleId;S();const i=q(e);te(e).then(h=>{t.roleForm=h.data,t.open=!0,t.title="\u4FEE\u6539\u89D2\u8272",$(()=>{i.then(B=>{t.menuCheckedKeys=B.checkedKeys,y(D).setCheckedKeys(B.checkedKeys)})})})},W=u=>{const e=u.roleId||t.ids;Y({message:'\u662F\u5426\u786E\u8BA4\u5220\u9664\u89D2\u8272\u7F16\u53F7\u4E3A"'+e+'"\u7684\u6570\u636E\u9879?',title:"\u8B66\u544A",showCancelButton:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(function(){return ye(e)}).then(()=>{d(),N.success("\u5220\u9664\u6210\u529F")})},M=()=>{const u=t.queryParams;Y({message:"\u662F\u5426\u786E\u8BA4\u5BFC\u51FA\u6240\u6709\u89D2\u8272\u6570\u636E\u9879?",title:"\u8B66\u544A",showCancelButton:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(function(){return ge(u)}).then(e=>{})},L=u=>me(u).then(e=>(t.deptOptions=e.data.depts,e.data)),q=u=>de(u).then(e=>e),Q=()=>{const u=y(a);!u||u.validate(e=>{e&&(t.roleForm!=null&&t.roleForm.roleId!=null?(t.roleForm.menuIds=v(),he(t.roleForm).then(()=>{N.success("\u4FEE\u6539\u6210\u529F"),t.open=!1,d()})):(t.roleForm.menuIds=v(),ce(t.roleForm).then(()=>{N.success("\u65B0\u589E\u6210\u529F"),t.open=!1,d()})))})},_=()=>{t.open=!1,A()},v=()=>{const u=y(D);if(!u)return;let e=u.getCheckedKeys(),i=u.getHalfCheckedKeys();return e.unshift.apply(e,i),e},H=()=>{t.openDataScope=!1,A()},j=u=>{const e=y(r);u!=="2"&&e.setCheckedKeys([])},T=(u,e)=>{if(e=="menu"){let i=t.menuOptions;for(let h=0;h<i.length;h++){const B=y(D);console.log("treeList",i[h]),B.store.nodesMap[i[h].id].expanded=u}}else if(e=="dept"){let i=t.deptOptions;for(let h=0;h<i.length;h++){const B=y(r);B.store.nodesMap[i[h].id].expanded=u}}},G=(u,e)=>{e=="menu"?y(D).setCheckedNodes(u?t.menuOptions:[]):e=="dept"&&y(r).setCheckedNodes(u?t.deptOptions:[])},V=(u,e)=>{e=="menu"?t.roleForm.value.menuCheckStrictly=!!u:e=="dept"&&(t.roleForm.value.deptCheckStrictly=!!u)};return ne(()=>{d(),l.getDicts("sys_normal_disable").then(u=>{t.statusOptions=u.data})}),{roleFormRef:a,menuRef:D,deptRef:r,handleAdd:O,handleUpdate:R,handleDelete:W,handleExport:M,handleSelectionChange:P,handleDataScope:I,handleStatusChange:C,handleSizeChange:K,handleCurrentChange:z,submitForm:Q,handleQuery:E,resetQuery:g,submitDataScope:f,getDeptAllCheckedKeys:p,getRoleMenuTreeselect:q,cancel:_,dataScopeSelectChange:j,cancelDataScope:H,getList:d,handleCheckedTreeExpand:T,handleCheckedTreeNodeAll:G,handleCheckedTreeConnect:V,...re(t)}}},ke={class:"app-container"},Ee=m(" \u641C\u7D22"),be=m(" \u91CD\u7F6E "),De=m("\u65B0\u589E"),_e=m("\u5220\u9664"),Ve=m("\u5BFC\u51FA"),Be=m("\u4FEE\u6539"),Se=m("\u6570\u636E\u6743\u9650"),Ae=m("\u5220\u9664"),ve=m("\u5C55\u5F00/\u6298\u53E0 "),we=m("\u5168\u9009/\u5168\u4E0D\u9009 "),Ne=m("\u7236\u5B50\u8054\u52A8"),Ke={class:"dialog-footer"},ze=m("\u786E \u5B9A"),qe=m("\u53D6 \u6D88"),Te=m("\u5C55\u5F00/\u6298\u53E0 "),Ue=m("\u5168\u9009/\u5168\u4E0D\u9009 "),Pe={class:"dialog-footer"},Ie=m("\u786E \u5B9A"),Oe=m("\u53D6 \u6D88");function Re(l,a,D,r,t,A){const g=s("el-input"),d=s("el-form-item"),K=s("el-option"),z=s("el-select"),f=s("SvgIcon"),p=s("el-button"),E=s("el-form"),S=s("el-col"),P=s("el-row"),C=s("el-table-column"),I=s("el-switch"),O=s("el-table"),R=s("el-divider"),W=s("el-pagination"),M=s("el-card"),L=s("el-input-number"),q=s("el-radio"),Q=s("el-radio-group"),_=s("el-checkbox"),v=s("el-tree"),H=s("el-tab-pane"),j=s("el-tabs"),T=s("el-dialog"),G=X("drag"),V=X("auth"),u=X("loading");return c(),U("div",ke,[F(w("div",null,null,512),[[G,[".app-container .el-dialog",".app-container .el-dialog__header"]]]),o(M,{shadow:"always"},{default:n(()=>[o(E,{model:l.queryParams,ref:"queryForm",inline:!0},{default:n(()=>[o(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:n(()=>[o(g,{placeholder:"\u89D2\u8272\u540D\u79F0\u6A21\u7CCA\u67E5\u8BE2",clearable:"",size:"small",onKeyup:ee(r.handleQuery,["enter"]),style:{width:"240px"},modelValue:l.queryParams.roleName,"onUpdate:modelValue":a[0]||(a[0]=e=>l.queryParams.roleName=e)},null,8,["onKeyup","modelValue"])]),_:1}),o(d,{label:"\u6743\u9650\u5B57\u7B26",prop:"roleKey"},{default:n(()=>[o(g,{placeholder:"\u6743\u9650\u5B57\u7B26\u6A21\u7CCA\u67E5\u8BE2",clearable:"",size:"small",onKeyup:ee(r.handleQuery,["enter"]),style:{width:"240px"},modelValue:l.queryParams.roleKey,"onUpdate:modelValue":a[1]||(a[1]=e=>l.queryParams.roleKey=e)},null,8,["onKeyup","modelValue"])]),_:1}),o(d,{label:"\u72B6\u6001",prop:"status"},{default:n(()=>[o(z,{modelValue:l.queryParams.status,"onUpdate:modelValue":a[2]||(a[2]=e=>l.queryParams.status=e),placeholder:"\u89D2\u8272\u72B6\u6001",clearable:"",size:"small",style:{width:"240px"}},{default:n(()=>[(c(!0),U(Z,null,x(l.statusOptions,e=>(c(),k(K,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,null,{default:n(()=>[o(p,{type:"primary",size:"mini",onClick:r.handleQuery},{default:n(()=>[o(f,{name:"elementSearch"}),Ee]),_:1},8,["onClick"]),o(p,{size:"mini",onClick:r.resetQuery},{default:n(()=>[o(f,{name:"elementRefresh"}),be]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),o(P,{gutter:10,"custom-class":"mb8"},{default:n(()=>[o(S,{span:1.5},{default:n(()=>[F((c(),k(p,{type:"primary",plain:"",size:"mini",onClick:r.handleAdd},{default:n(()=>[o(f,{name:"elementPlus"}),De]),_:1},8,["onClick"])),[[V,"system:role:add"]])]),_:1},8,["span"]),o(S,{span:1.5},{default:n(()=>[F((c(),k(p,{type:"danger",plain:"",size:"mini",disabled:l.multiple,onClick:r.handleDelete},{default:n(()=>[o(f,{name:"elementDelete"}),_e]),_:1},8,["disabled","onClick"])),[[V,"system:role:delete"]])]),_:1},8,["span"]),o(S,{span:1.5},{default:n(()=>[F((c(),k(p,{type:"warning",plain:"",size:"mini",onClick:r.handleExport},{default:n(()=>[o(f,{name:"elementDownload"}),Ve]),_:1},8,["onClick"])),[[V,"system:role:export"]])]),_:1},8,["span"])]),_:1}),F((c(),k(O,{data:l.roleList,onSelectionChange:r.handleSelectionChange},{default:n(()=>[o(C,{type:"selection",width:"55",align:"center"}),o(C,{label:"\u89D2\u8272\u7F16\u53F7",prop:"roleId",width:"120"}),o(C,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),o(C,{label:"\u6743\u9650\u5B57\u7B26",prop:"roleKey","show-overflow-tooltip":!0,width:"150"}),o(C,{label:"\u663E\u793A\u987A\u5E8F",prop:"roleSort",width:"100"}),o(C,{label:"\u72B6\u6001",align:"center",width:"100"},{default:n(e=>[o(I,{modelValue:e.row.status,"onUpdate:modelValue":i=>e.row.status=i,"active-value":"0","inactive-value":"1",onClick:i=>r.handleStatusChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),o(C,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"create_time",width:"180"},{default:n(e=>[w("span",null,le(l.dateStrFormat(e.row.createTime)),1)]),_:1}),o(C,{label:"\u64CD\u4F5C",align:"center","class-name":"small-padding fixed-width"},{default:n(e=>[F((c(),k(p,{size:"mini",type:"text",onClick:i=>r.handleUpdate(e.row)},{default:n(()=>[o(f,{name:"elementEdit"}),Be]),_:2},1032,["onClick"])),[[V,"system:role:edit"]]),o(p,{size:"mini",type:"text",onClick:i=>r.handleDataScope(e.row)},{default:n(()=>[o(f,{name:"elementCircleCheck"}),Se]),_:2},1032,["onClick"]),F((c(),k(p,{size:"mini",type:"text",onClick:i=>r.handleDelete(e.row)},{default:n(()=>[o(f,{name:"elementDelete"}),Ae]),_:2},1032,["onClick"])),[[V,"system:role:delete"]])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[u,l.loading]]),F(w("div",null,[o(R),o(W,{background:"",total:l.total,"current-page":l.queryParams.pageNum,"page-size":l.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])],512),[[oe,l.total>0]])]),_:1}),o(T,{title:l.title,modelValue:l.open,"onUpdate:modelValue":a[15]||(a[15]=e=>l.open=e),width:"769px"},{footer:n(()=>[w("span",Ke,[o(p,{type:"primary",size:"small",onClick:r.submitForm},{default:n(()=>[ze]),_:1},8,["onClick"]),o(p,{size:"small",onClick:r.cancel},{default:n(()=>[qe]),_:1},8,["onClick"])])]),default:n(()=>[o(E,{ref:"roleFormRef",model:l.roleForm,rules:l.rules,"label-width":"120px","label-position":"right"},{default:n(()=>[o(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:n(()=>[o(g,{modelValue:l.roleForm.roleName,"onUpdate:modelValue":a[3]||(a[3]=e=>l.roleForm.roleName=e),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u6743\u9650\u5B57\u7B26",prop:"roleKey"},{default:n(()=>[o(g,{modelValue:l.roleForm.roleKey,"onUpdate:modelValue":a[4]||(a[4]=e=>l.roleForm.roleKey=e),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u89D2\u8272\u987A\u5E8F",prop:"roleSort"},{default:n(()=>[o(L,{modelValue:l.roleForm.roleSort,"onUpdate:modelValue":a[5]||(a[5]=e=>l.roleForm.roleSort=e),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),o(d,{label:"\u72B6\u6001"},{default:n(()=>[o(Q,{modelValue:l.roleForm.status,"onUpdate:modelValue":a[6]||(a[6]=e=>l.roleForm.status=e)},{default:n(()=>[(c(!0),U(Z,null,x(l.statusOptions,e=>(c(),k(q,{key:e.dictValue,label:e.dictValue},{default:n(()=>[m(le(e.dictLabel),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{label:"\u6743\u9650\u8BBE\u7F6E"},{default:n(()=>[o(j,{modelValue:l.activeName,"onUpdate:modelValue":a[13]||(a[13]=e=>l.activeName=e),onTabClick:l.handleClick},{default:n(()=>[o(H,{label:"\u83DC\u5355\u6743\u9650",name:"first"},{default:n(()=>[o(_,{modelValue:l.menuExpand,"onUpdate:modelValue":a[7]||(a[7]=e=>l.menuExpand=e),onChange:a[8]||(a[8]=e=>r.handleCheckedTreeExpand(e,"menu"))},{default:n(()=>[ve]),_:1},8,["modelValue"]),o(_,{modelValue:l.menuNodeAll,"onUpdate:modelValue":a[9]||(a[9]=e=>l.menuNodeAll=e),onChange:a[10]||(a[10]=e=>r.handleCheckedTreeNodeAll(e,"menu"))},{default:n(()=>[we]),_:1},8,["modelValue"]),o(_,{modelValue:l.roleForm.menuCheckStrictly,"onUpdate:modelValue":a[11]||(a[11]=e=>l.roleForm.menuCheckStrictly=e),onChange:a[12]||(a[12]=e=>r.handleCheckedTreeConnect(e,"menu"))},{default:n(()=>[Ne]),_:1},8,["modelValue"]),o(v,{class:"tree-border",data:l.menuOptions,"show-checkbox":"",ref:"menuRef","node-key":"id","empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E","check-strictly":!l.roleForm.menuCheckStrictly,props:{label:"label",children:"children"},"default-checked-keys":l.menuCheckedKeys},null,8,["data","check-strictly","default-checked-keys"])]),_:1})]),_:1},8,["modelValue","onTabClick"])]),_:1}),o(d,{label:"\u5907\u6CE8"},{default:n(()=>[o(g,{modelValue:l.roleForm.remark,"onUpdate:modelValue":a[14]||(a[14]=e=>l.roleForm.remark=e),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),o(T,{title:l.title,modelValue:l.openDataScope,"onUpdate:modelValue":a[23]||(a[23]=e=>l.openDataScope=e),width:"769px"},{footer:n(()=>[w("span",Pe,[o(p,{type:"primary",size:"small",onClick:r.submitDataScope},{default:n(()=>[Ie]),_:1},8,["onClick"]),o(p,{size:"small",onClick:r.cancelDataScope},{default:n(()=>[Oe]),_:1},8,["onClick"])])]),default:n(()=>[o(E,{model:l.roleForm,"label-width":"80px"},{default:n(()=>[o(d,{label:"\u89D2\u8272\u540D\u79F0"},{default:n(()=>[o(g,{modelValue:l.roleForm.roleName,"onUpdate:modelValue":a[16]||(a[16]=e=>l.roleForm.roleName=e),disabled:!0},null,8,["modelValue"])]),_:1}),o(d,{label:"\u6743\u9650\u5B57\u7B26"},{default:n(()=>[o(g,{modelValue:l.roleForm.roleKey,"onUpdate:modelValue":a[17]||(a[17]=e=>l.roleForm.roleKey=e),disabled:!0},null,8,["modelValue"])]),_:1}),o(d,{label:"\u6743\u9650\u8303\u56F4"},{default:n(()=>[o(z,{modelValue:l.roleForm.dataScope,"onUpdate:modelValue":a[18]||(a[18]=e=>l.roleForm.dataScope=e),onChange:r.dataScopeSelectChange},{default:n(()=>[(c(!0),U(Z,null,x(l.dataScopeOptions,e=>(c(),k(K,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),F(o(d,{label:"\u6570\u636E\u6743\u9650"},{default:n(()=>[o(_,{modelValue:l.deptExpand,"onUpdate:modelValue":a[19]||(a[19]=e=>l.deptExpand=e),onChange:a[20]||(a[20]=e=>r.handleCheckedTreeExpand(e,"dept"))},{default:n(()=>[Te]),_:1},8,["modelValue"]),o(_,{modelValue:l.deptNodeAll,"onUpdate:modelValue":a[21]||(a[21]=e=>l.deptNodeAll=e),onChange:a[22]||(a[22]=e=>r.handleCheckedTreeNodeAll(e,"dept"))},{default:n(()=>[Ue]),_:1},8,["modelValue"]),o(v,{class:"tree-border",data:l.deptOptions,"show-checkbox":"","default-expand-all":"",ref:"deptRef","node-key":"id","empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E",props:{label:"label",children:"children"}},null,8,["data"])]),_:1},512),[[oe,l.roleForm.dataScope==2]])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}const He=ue(Fe,[["render",Re]]);export{He as default};
