import{g as e,a as l,u as a}from"./table.1704951491820.js";import{l as o}from"./type.1704951491820.js";import t from"./basicInfoForm.1704951491820.js";import d from"./genInfoForm.1704951491820.js";import{_ as n,D as u,k as i,p as m,r,f as s,w as f,H as b,o as p,h as c,a as V,e as w,b as h,t as g,F as y,g as v,i as _}from"./index.1704951491820.js";const T={name:"genEdit",components:{BasicInfoForm:t,GenInfoForm:d},setup(){const{proxy:t}=v(),d=u(),n=u(),r=i({isShowDialog:!1,activeName:"cloum",columns:[],tableTree:[],dictOptions:[],info:{}}),s=e=>new Promise((l=>{e.validate((e=>{l(e)}))})),f=e=>{t.mittBus.emit("onEditTableModule",e),r.isShowDialog=!1};return{genInfoRef:d,basicInfoRef:n,openDialog:a=>{a.tableId&&(e(a.tableId).then((e=>{let l=e.data.list.filter((e=>!["create_time","update_time","delete_time"].includes(e.columnName)));r.columns=l,r.info=e.data.info,r.info.columns=r.columns,console.log(r),r.isShowDialog=!0})),o({pageNum:1,pageSize:100}).then((e=>{r.dictOptions=e.data.data,console.log(r.dictOptions)})),l().then((e=>{r.tableTree=e.data,r.tableTree.unshift({tableId:0,className:"请选择"})})))},closeDialog:f,getTablesCol:e=>r.tableTree.filter((function(l){if(l.tableName===e)return l.columns})),getTables:()=>{l().then((e=>{r.tableTree=e.data,r.tableTree.unshift({tableId:0,className:"请选择"})}))},submitForm:()=>{console.log(n.value);const e=n.value.basicInfoForm,l=d.value.genInfoFormRef;Promise.all([e,l].map(s)).then((o=>{if(o.every((e=>!!e))){const o=Object.assign({},e.model,l.model);console.log(r.columns),o.columns=r.columns,o.params={treeCode:o.treeCode,treeName:o.treeName,treeParentCode:o.treeParentCode},a(o).then((e=>{b.success("修改成功"),f()}))}else b.error("表单校验未通过，请重新检查提交内容")}))},getFormPromise:s,handleChangeConfig:(e,l)=>{r.tableTree.filter((function(l){l.tableName===e.fkTableName&&(e.fkCol=l.columns)}))},...m(r)}}},U={style:{float:"left"}},N={style:{float:"right",color:"#8492a6","font-size":"13px"}},I={style:{float:"left"}},C={style:{float:"right",color:"#8492a6","font-size":"13px"}},k={style:{float:"left"}},x={style:{float:"right",color:"#8492a6","font-size":"13px"}},F={style:{float:"left"}},j={style:{float:"right",color:"#8492a6","font-size":"13px"}},E=_("提交"),L=_("返回");const D=n(T,[["render",function(e,l,a,o,t,d){const n=r("BasicInfoForm"),u=r("el-tab-pane"),i=r("el-table-column"),m=r("el-input"),b=r("el-option"),v=r("el-select"),_=r("el-checkbox"),T=r("el-table"),D=r("GenInfoForm"),R=r("el-tabs"),S=r("el-button"),z=r("el-form-item"),O=r("el-form"),P=r("el-dialog");return p(),s(P,{modelValue:e.isShowDialog,"onUpdate:modelValue":l[1]||(l[1]=l=>e.isShowDialog=l),title:"编辑表结构",width:"90%",center:""},{default:f((()=>[c(R,{modelValue:e.activeName,"onUpdate:modelValue":l[0]||(l[0]=l=>e.activeName=l)},{default:f((()=>[c(u,{label:"基本信息",name:"basic"},{default:f((()=>[c(n,{ref:"basicInfoRef",info:e.info},null,8,["info"])])),_:1}),c(u,{label:"字段信息",name:"cloum"},{default:f((()=>[c(T,{ref:"dragTable",data:e.columns,"row-key":"columnId",height:"450px"},{default:f((()=>[c(i,{label:"序号",type:"index",width:"50"}),c(i,{label:"字段列名",prop:"columnName",width:"150","show-overflow-tooltip":!0}),c(i,{fixed:"",label:"字段描述",width:"150"},{default:f((e=>[c(m,{modelValue:e.row.columnComment,"onUpdate:modelValue":l=>e.row.columnComment=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"物理类型",prop:"columnType",width:"120","show-overflow-tooltip":!0}),c(i,{label:"go类型",width:"120"},{default:f((e=>[c(v,{modelValue:e.row.goType,"onUpdate:modelValue":l=>e.row.goType=l},{default:f((()=>[c(b,{label:"int",value:"int"}),c(b,{label:"uint",value:"uint"}),c(b,{label:"int64",value:"int64"}),c(b,{label:"uint64",value:"uint64"}),c(b,{label:"float64",value:"float64"}),c(b,{label:"string",value:"string"}),c(b,{label:"Time",value:"Time"}),c(b,{label:"byte",value:"byte"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"go属性",width:"150"},{default:f((e=>[c(m,{modelValue:e.row.goField,"onUpdate:modelValue":l=>e.row.goField=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"json属性",width:"150"},{default:f((e=>[c(m,{modelValue:e.row.jsonField,"onUpdate:modelValue":l=>e.row.jsonField=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"插入",width:"50"},{default:f((e=>[c(_,{modelValue:e.row.isInsert,"onUpdate:modelValue":l=>e.row.isInsert=l,"true-label":"1","false-label":"0"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"编辑",width:"70","cell-style":{"text-align":"center"}},{default:f((e=>[c(_,{modelValue:e.row.isEdit,"onUpdate:modelValue":l=>e.row.isEdit=l,"true-label":"1","false-label":"0"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"列表",width:"70","cell-style":{"text-align":"center"}},{default:f((e=>[c(_,{modelValue:e.row.isList,"onUpdate:modelValue":l=>e.row.isList=l,"true-label":"1","false-label":"0"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"查询",width:"70","cell-style":{"text-align":"center"}},{default:f((e=>[c(_,{modelValue:e.row.isQuery,"onUpdate:modelValue":l=>e.row.isQuery=l,"true-label":"1","false-label":"0"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"必填",width:"50"},{default:f((e=>[c(_,{modelValue:e.row.isRequired,"onUpdate:modelValue":l=>e.row.isRequired=l,"true-label":"1","false-label":"0"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"查询方式",width:"120"},{default:f((e=>[c(v,{modelValue:e.row.queryType,"onUpdate:modelValue":l=>e.row.queryType=l},{default:f((()=>[c(b,{label:"=",value:"EQ"}),c(b,{label:"!=",value:"NE"}),c(b,{label:">",value:"GT"}),c(b,{label:">=",value:"GTE"}),c(b,{label:"<",value:"LT"}),c(b,{label:"<=",value:"LTE"}),c(b,{label:"LIKE",value:"LIKE"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"显示类型",width:"140"},{default:f((e=>[c(v,{modelValue:e.row.htmlType,"onUpdate:modelValue":l=>e.row.htmlType=l},{default:f((()=>[c(b,{label:"文本框",value:"input"}),c(b,{label:"下拉框",value:"select"}),c(b,{label:"单选框",value:"radio"}),c(b,{label:"文件选择",value:"file"}),c(b,{label:"文本域",value:"textarea"}),c(b,{label:"日期控件",value:"datetime"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"字典类型",width:"160"},{default:f((l=>[c(v,{modelValue:l.row.dictType,"onUpdate:modelValue":e=>l.row.dictType=e,clearable:"",filterable:"",placeholder:"请选择"},{default:f((()=>[(p(!0),V(y,null,w(e.dictOptions,(e=>(p(),s(b,{key:e.dictType,label:e.dictName,value:e.dictType},{default:f((()=>[h("span",U,g(e.dictName),1),h("span",N,g(e.dictType),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"关系表",width:"160"},{default:f((l=>[c(v,{modelValue:l.row.linkTableName,"onUpdate:modelValue":e=>l.row.linkTableName=e,clearable:"",filterable:"",placeholder:"请选择",onChange:e=>o.handleChangeConfig(l.row,l.$index)},{default:f((()=>[(p(!0),V(y,null,w(e.tableTree,(e=>(p(),s(b,{key:e.tableName,label:e.tableName,value:e.tableName},{default:f((()=>[h("span",I,g(e.tableName),1),h("span",C,g(e.tableComment),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),c(i,{label:"关系表key",width:"150"},{default:f((e=>[c(v,{modelValue:e.row.linkLabelId,"onUpdate:modelValue":l=>e.row.linkLabelId=l,clearable:"",filterable:"",placeholder:"请选择"},{default:f((()=>[(p(!0),V(y,null,w(e.row.fkCol,(e=>(p(),s(b,{key:e.columnName,label:e.columnName,value:e.jsonField},{default:f((()=>[h("span",k,g(e.jsonField),1),h("span",x,g(e.columnComment),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),c(i,{label:"关系表value",width:"150"},{default:f((e=>[c(v,{modelValue:e.row.linkLabelName,"onUpdate:modelValue":l=>e.row.linkLabelName=l,clearable:"",filterable:"",placeholder:"请选择"},{default:f((()=>[(p(!0),V(y,null,w(e.row.fkCol,(e=>(p(),s(b,{key:e.columnName,label:e.columnName,value:e.jsonField},{default:f((()=>[h("span",F,g(e.jsonField),1),h("span",j,g(e.columnComment),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"])])),_:1}),c(u,{label:"生成信息",name:"genInfo"},{default:f((()=>[c(D,{ref:"genInfoRef",info:e.info},null,8,["info"])])),_:1})])),_:1},8,["modelValue"]),c(O,{"label-width":"100px"},{default:f((()=>[c(z,{style:{"text-align":"center","margin-left":"-100px","margin-top":"10px"}},{default:f((()=>[c(S,{type:"primary",onClick:o.submitForm},{default:f((()=>[E])),_:1},8,["onClick"]),c(S,{onClick:o.closeDialog},{default:f((()=>[L])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}]]);export{D as default};
