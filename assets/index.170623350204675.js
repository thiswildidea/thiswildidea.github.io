var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);import{_ as i,u as s,A as a,k as r,m as n,V as o,l,p as h,a as c,o as d,X as u,Y as m,b as p}from"./index.1706233502046.js";import{d as v,e as w}from"./index.1706233502046115.js";import{l as g,M as f}from"./mapconfig.1706233502046.js";import{V as y,G as b,r as x,o as R,s as _,t as M,N as j,W as C,S as P,P as S,A as k,u as L,a as T,D,C as I,b as V}from"./three.module.1706233502046.js";class F{constructor(){t(this,"position",null),t(this,"velocity",null),t(this,"acceleration",null),t(this,"anchor",null),t(this,"mass",null),t(this,"r",null),t(this,"g",null),t(this,"b",null),t(this,"a",null),t(this,"time",null),t(this,"clock",null),t(this,"is_active",null),this.position=new y,this.velocity=new y,this.acceleration=new y,this.anchor=new y,this.mass=1,this.r=0,this.g=0,this.b=0,this.a=1,this.time=0,this.is_active=!1}init(e){this.position=e.clone(),this.velocity=e.clone(),this.anchor=e.clone(),this.acceleration.set(0,0,0),this.a=1,this.time=0}updatePosition(){this.time++,this.position.copy(this.velocity)}updateVelocity(){this.acceleration.divideScalar(this.mass),this.velocity.sub(this.acceleration)}applyForce(e){this.acceleration.add(e)}activate(){this.is_active=!0}inactivate(){this.is_active=!1}}class A{constructor(e,i,s){t(this,"camera",null),t(this,"scene",null),t(this,"position",null),t(this,"movers_num",null),t(this,"movers",null),t(this,"geometry",null),t(this,"material",null),t(this,"obj",null),t(this,"texture",null),t(this,"clock",null),t(this,"antigravity",null),this.camera=e,this.scene=i,this.position=s,this.movers_num=1e4,this.movers=[],this.geometry=null,this.material=null,this.obj=null,this.texture=null,this.antigravity=new y(0,0,-.02)}init(){let e=this.position;this.createTexture(),this.geometry=new b,this.material=new x({color:"#fd3109",size:2e3,transparent:!0,opacity:.5,map:this.texture,depthTest:!1,blending:R});for(var t=0;t<this.movers_num;t++){var i=new F;i.init(new y(e[0],e[1],e[2])),this.movers.push(i),this.geometry.vertices.push(i.position)}this.obj=new _(this.geometry,this.material)}update(){for(var e=[],t=0;t<this.movers.length;t++){var i=this.movers[t];i.is_active&&(i.applyForce(this.antigravity),i.updateVelocity(),i.updatePosition(),i.time>200&&i.inactivate()),e.push(i.position)}this.obj.geometry.vertices=e,this.obj.geometry.verticesNeedUpdate=!0}activateMover(){let e=this.position;for(var t=0,i=0;i<this.movers.length;i++){var s=this.movers[i];if(!s.is_active){var a=this.getRadian(Math.log(this.getRandomInt(200,256))/Math.log(256)*300),r=this.getRadian(this.getRandomInt(0,360)),n=this.getSpherical(a,r,5);if(s.activate(),s.init(new y(e[0],e[1],e[2])),s.applyForce(n),++t>20)break}}}createTexture(){var e=document.createElement("canvas"),t=e.getContext("2d"),i=null;e.width=200,e.height=200,(i=t.createRadialGradient(100,100,20,100,100,100)).addColorStop(.2,"rgba(255, 255, 255, 1)"),i.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=i,t.arc(100,100,100,0,Math.PI/180,!0),t.fill(),this.texture=new M(e),this.texture.minFilter=j,this.texture.needsUpdate=!0}getRandomInt(e,t){return Math.floor(Math.random()*(t-e))+e}getDegree(e){return e/Math.PI*180}getRadian(e){return e*Math.PI/180}getSpherical(e,t,i){var s=Math.cos(e)*Math.cos(t)*i,a=Math.cos(e)*Math.sin(t)*i,r=Math.sin(e)*i;return new y(s,a,r)}}class G{constructor(e,i,s){t(this,"view",null),t(this,"externalRenderers",null),t(this,"fire",null),t(this,"position",null),t(this,"renderer",null),t(this,"scene",null),t(this,"camera",null),t(this,"ambient",null),t(this,"sun",null),t(this,"clock",null),t(this,"last_time_activate",null),this.view=e,this.externalRenderers=i,this.position=s,this.fire=null}setup(e){this.renderer=new C({context:e.gl,premultipliedAlpha:!1}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setViewport(0,0,this.view.width,this.view.height),this.renderer.autoClear=!1,this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!1;let t=this.renderer.setRenderTarget.bind(this.renderer);this.renderer.setRenderTarget=i=>{t(i),null==i&&e.bindRenderTarget()},this.scene=new P;let i=e.camera;this.camera=new S(i.fovY,i.aspect,i.near,i.far);const s=new k(1);s.position.copy(1e6,1e5,1e5),this.scene.add(s);let a=new L(3e3,10,15790320,16777215);this.scene.add(a),this.ambient=new T(16777215,.5),this.scene.add(this.ambient),this.sun=new D(16777215,.5),this.sun.position.set(-600,300,6e4),this.scene.add(this.sun),this.last_time_activate=Date.now(),this.clock=new I;let r=[];this.externalRenderers.toRenderCoordinates(this.view,this.position,0,this.view.spatialReference,r,0,1),this.fire=new A(this.camera,this.scene,r),this.fire.init(),this.scene.add(this.fire.obj),e.resetWebGLState()}render(e){let t=e.camera;this.camera.position.set(t.eye[0],t.eye[1],t.eye[2]),this.camera.up.set(t.up[0],t.up[1],t.up[2]),this.camera.lookAt(new y(t.center[0],t.center[1],t.center[2])),this.camera.projectionMatrix.fromArray(t.projectionMatrix);let i=e.sunLight;(this.sun.position.set(i.direction[0],i.direction[1],i.direction[2]),this.sun.intensity=i.diffuse.intensity,this.sun.color=new V(i.diffuse.color[0],i.diffuse.color[1],i.diffuse.color[2]),this.ambient.intensity=i.ambient.intensity,this.ambient.color=new V(i.ambient.color[0],i.ambient.color[1],i.ambient.color[2]),this.fire)&&(this.fire.update(),Date.now()-this.last_time_activate>10&&(this.fire.activateMover(),this.last_time_activate=Date.now()));this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),this.externalRenderers.requestRender(this.view),e.resetWebGLState()}}const z={name:"map",components:{},setup(){const e=s();a();const t=r({});return n((async()=>{!async function(e){const[t,i,s,a,r,n,o,l,h,c,d,u,m]=await g(["esri/Map","esri/views/SceneView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/widgets/Expand","esri/Camera","esri/widgets/Home","esri/widgets/Fullscreen","esri/widgets/LayerList","esri/widgets/Legend","esri/views/3d/externalRenderers","esri/widgets/BasemapGallery","esri/geometry/SpatialReference"],{url:f.jsapiurl,css:f.jscssurl}),p=new t({basemap:"streets-night-vector",ground:{surfaceColor:"#021425"}}),w=new i({spatialReference:m.WebMercator,container:"viewDiv_threejs_fireParticle",map:p,viewingMode:"local"}),y=new u({view:w}),b=new r({view:w,content:y,expandIconClass:"esri-icon-basemap",expandTooltip:"LayerList",group:"top-left"});w.ui.add(b,"top-left");const x=new n({fov:e.camera.fov,heading:e.camera.heading,position:{x:e.camera.position.x,y:e.camera.position.y,z:e.camera.position.z,spatialReference:{wkid:3857}},tilt:e.camera.tilt});a.once((()=>!0===(null==w?void 0:w.stationary))).then((()=>{w.goTo(x,e.cameraoptions).then((()=>{})),v("fireParticledata").then((e=>{e.map((e=>{const t=new G(w,d,[e.x,e.y,e.z]);d.add(w,t)}))}))})),a.on((()=>w),"click",(e=>{}))}(await w())})),o((()=>{})),l((()=>e.state.tagsViewRoutes.isTagsViewCurrenFull)),{...h(t)}}},W={class:"home-container"},U=[(e=>(u("data-v-30c0b192"),e=e(),m(),e))((()=>p("div",{id:"viewDiv_threejs_fireParticle"},null,-1)))];const E=i(z,[["render",function(e,t,i,s,a,r){return d(),c("div",W,U)}],["__scopeId","data-v-30c0b192"]]);export{E as default};
