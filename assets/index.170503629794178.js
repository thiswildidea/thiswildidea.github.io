import{at as e,_ as a,D as l,k as t,m as o,p as n,r as s,Q as r,a as i,h as d,w as u,g as p,I as m,H as c,o as y,au as g,F as f,e as h,f as b,v as _,i as w,t as C,b as F,x as z,y as q}from"./index.1705036297941.js";const v={name:"Operlog",setup(){const{proxy:a}=p(),s=l(null),r=t({loading:!0,total:0,tableData:[],ids:[],single:!0,multiple:!0,title:"",open:!1,modelForm:{},typeOptions:[],statusOptions:[],queryParams:{pageNum:1,pageSize:10,title:void 0,operName:void 0,businessType:void 0}}),i=()=>{var a;r.loading=!0,(a=r.queryParams,e({url:"/log/oper/list",method:"get",params:a})).then((e=>{r.tableData=e.rows,r.total=e.total,r.loading=!1}))};return o((()=>{i(),a.getDicts("sys_common_status").then((e=>{r.statusOptions=e.data})),a.getDicts("sys_oper_type").then((e=>{r.typeOptions=e.data}))})),{ruleFormRef:s,statusFormat:(e,l)=>a.selectDictLabel(r.statusOptions,e.status),businessTypeFilter:e=>a.selectDictlistClass(r.typeOptions,e.businessType),typeFormat:(e,l)=>a.selectDictLabel(r.typeOptions,e.businessType),handleView:e=>{r.open=!0,r.modelForm=e},handleSelectionChange:e=>{r.ids=e.map((e=>e.operId)),r.single=1!=e.length,r.multiple=!e.length},handleSizeChange:e=>{r.queryParams.pageSize=e,i()},handleCurrentChange:e=>{r.queryParams.pageNum=e,i()},resetQuery:()=>{r.queryParams.title=void 0,r.queryParams.operName=void 0,r.queryParams.businessType=void 0,i()},handleQuery:i,handleClean:()=>{m({message:"是否确认清空所有操作日志数据项?",title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return e({url:"/log/oper/clean",method:"delete"})})).then((()=>{i(),c.success("清空成功")}))},onTabelRowDel:a=>{const l=a.operId||r.ids;m({message:'是否确认删除日志编号为"'+l+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return(a=l,e({url:"/log/oper/"+a,method:"delete"})).then((()=>{i(),c.success("删除成功")}));var a}))},...n(r)}}},T={class:"system-user-container app-container"},x=w(" 搜索"),P=w(" 重置 "),V=w("删除"),k=w("清空"),S=w("详细"),D={class:"dialog-footer"},N=w("关 闭");const O=a(v,[["render",function(e,a,l,t,o,n){const p=s("el-input"),m=s("el-form-item"),c=s("el-option"),v=s("el-select"),O=s("SvgIcon"),I=s("el-button"),Q=s("el-form"),B=s("el-col"),L=s("el-row"),R=s("el-table-column"),U=s("el-tag"),K=s("el-table"),M=s("el-divider"),j=s("el-pagination"),H=s("el-card"),A=s("el-dialog"),E=r("auth"),G=r("loading");return y(),i("div",T,[d(H,{shadow:"always"},{default:u((()=>[d(Q,{model:e.queryParams,ref:"queryForm",inline:!0,"label-width":"68px"},{default:u((()=>[d(m,{label:"系统模块",prop:"title"},{default:u((()=>[d(p,{placeholder:"请输入系统模块模糊查询",clearable:"",size:"small",onKeyup:g(t.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.title,"onUpdate:modelValue":a[0]||(a[0]=a=>e.queryParams.title=a)},null,8,["onKeyup","modelValue"])])),_:1}),d(m,{label:"操作人员",prop:"operName"},{default:u((()=>[d(p,{placeholder:"请输入操作人员模糊查询",clearable:"",size:"small",onKeyup:g(t.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.operName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.queryParams.operName=a)},null,8,["onKeyup","modelValue"])])),_:1}),d(m,{label:"类型",prop:"businessType"},{default:u((()=>[d(v,{modelValue:e.queryParams.businessType,"onUpdate:modelValue":a[2]||(a[2]=a=>e.queryParams.businessType=a),placeholder:"操作类型",clearable:"",size:"small",style:{width:"240px"}},{default:u((()=>[(y(!0),i(f,null,h(e.typeOptions,(e=>(y(),b(c,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(m,null,{default:u((()=>[d(I,{type:"primary",size:"mini",onClick:t.handleQuery},{default:u((()=>[d(O,{name:"elementSearch"}),x])),_:1},8,["onClick"]),d(I,{size:"mini",onClick:t.resetQuery},{default:u((()=>[d(O,{name:"elementRefresh"}),P])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),d(L,{gutter:10,class:"mb8"},{default:u((()=>[d(B,{span:1.5},{default:u((()=>[_((y(),b(I,{type:"danger",plain:"",size:"mini",disabled:e.multiple,onClick:t.onTabelRowDel},{default:u((()=>[d(O,{name:"elementDelete"}),V])),_:1},8,["disabled","onClick"])),[[E,"log:oper:delete"]])])),_:1},8,["span"]),d(B,{span:1.5},{default:u((()=>[_((y(),b(I,{type:"danger",plain:"",size:"mini",onClick:t.handleClean},{default:u((()=>[d(O,{name:"elementDelete"}),k])),_:1},8,["onClick"])),[[E,"log:oper:delete"]])])),_:1},8,["span"])])),_:1}),_((y(),b(K,{data:e.tableData,onSelectionChange:t.handleSelectionChange},{default:u((()=>[d(R,{type:"selection",width:"55",align:"center"}),d(R,{label:"日志编号",align:"center",prop:"operId"}),d(R,{label:"系统模块",align:"center",prop:"title"}),d(R,{label:"操作类型",align:"center",prop:"businessType"},{default:u((e=>[d(U,{type:t.businessTypeFilter(e.row),"disable-transitions":""},{default:u((()=>[w(C(t.typeFormat(e.row)),1)])),_:2},1032,["type"])])),_:1}),d(R,{label:"请求方法",align:"center",prop:"requestMethod"}),d(R,{label:"操作人员",align:"center",prop:"operName"}),d(R,{label:"主机",align:"center",prop:"operIp",width:"130","show-overflow-tooltip":!0}),d(R,{label:"操作地点",align:"center",prop:"operLocation","show-overflow-tooltip":!0}),d(R,{label:"操作状态",align:"center",prop:"status"},{default:u((e=>[d(U,{type:"1"===e.row.status?"danger":"success","disable-transitions":""},{default:u((()=>[w(C(t.statusFormat(e.row)),1)])),_:2},1032,["type"])])),_:1}),d(R,{label:"操作日期",align:"center"},{default:u((a=>[F("span",null,C(e.dateStrFormat(a.row.operTime)),1)])),_:1}),d(R,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:u((e=>[d(I,{size:"mini",type:"text",onClick:a=>t.handleView(e.row)},{default:u((()=>[d(O,{name:"elementView"}),S])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[G,e.loading]]),_(F("div",null,[d(M),d(j,{background:"",total:e.total,"current-page":e.queryParams.pageNum,"page-sizes":[10,20,30,40],"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])],512),[[z,e.total>0]])])),_:1}),d(A,{title:"操作日志详细",modelValue:e.open,"onUpdate:modelValue":a[4]||(a[4]=a=>e.open=a),width:"700px","append-to-body":""},{footer:u((()=>[F("span",D,[d(I,{onClick:a[3]||(a[3]=a=>e.open=!1),size:"small"},{default:u((()=>[N])),_:1})])])),default:u((()=>[d(Q,{ref:"ruleFormRef",model:e.modelForm,"label-width":"100px",size:"mini"},{default:u((()=>[d(L,null,{default:u((()=>[d(B,{span:12},{default:u((()=>[d(m,{label:"操作模块："},{default:u((()=>[w(C(e.modelForm.title)+" / "+C(t.typeFormat(e.modelForm)),1)])),_:1}),d(m,{label:"登录信息："},{default:u((()=>[w(C(e.modelForm.operName)+" / "+C(e.modelForm.operIp)+" / "+C(e.modelForm.operLocation),1)])),_:1})])),_:1}),d(B,{span:12},{default:u((()=>[d(m,{label:"请求地址："},{default:u((()=>[w(C(e.modelForm.operUrl),1)])),_:1})])),_:1}),d(B,{span:24},{default:u((()=>[d(m,{label:"操作方法："},{default:u((()=>[w(C(e.modelForm.requestMethod),1)])),_:1})])),_:1}),d(B,{span:24},{default:u((()=>[d(m,{label:"请求参数："},{default:u((()=>[w(C(e.modelForm.operParam),1)])),_:1})])),_:1}),d(B,{span:12},{default:u((()=>[d(m,{label:"操作状态："},{default:u((()=>[w(C(t.statusFormat(e.modelForm)),1)])),_:1})])),_:1}),d(B,{span:12},{default:u((()=>[d(m,{label:"操作时间："},{default:u((()=>[w(C(e.dateStrFormat(e.modelForm.createTime)),1)])),_:1})])),_:1}),d(B,{span:24},{default:u((()=>["1"===e.modelForm.status?(y(),b(m,{key:0,label:"异常信息："},{default:u((()=>[w(C(e.modelForm.errorMsg),1)])),_:1})):q("",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}]]);export{O as default};
