import{_ as e,D as l,k as a,m as t,p as o,r as n,Q as d,a as r,v as s,b as u,h as m,w as i,g as p,H as c,ay as h,I as y,G as f,o as C,au as g,F as k,e as b,f as V,t as _,x as S,i as x}from"./index.1704871113952.js";import{l as F,d as w,c as v,g as N,a as K,e as z,u as q,b as U}from"./role.1704871113952.js";import{r as P,t as D}from"./menu.1704871113952.js";import{r as O}from"./dept.1704871113952.js";const T={name:"systemRole",setup(){const{proxy:e}=p(),n=l(null),d=l(null),r=l(null),s=a({activeName:"first",loading:!0,ids:[],total:0,title:"",open:!1,roleList:[],showSearch:!0,single:!0,multiple:!0,statusOptions:[],menuOptions:[],menuCheckedKeys:[],deptOptions:[],openDataScope:!1,menuExpand:!1,menuNodeAll:!1,deptExpand:!0,deptNodeAll:!1,queryParams:{pageNum:1,pageSize:10,roleName:void 0,roleKey:void 0,status:void 0},dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],roleForm:{},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),u=()=>{s.menuExpand=!1,s.menuNodeAll=!1,s.deptExpand=!0,s.deptNodeAll=!1,s.roleForm={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},s.roleForm={}},m=()=>{s.loading=!0,F(s.queryParams).then((e=>{s.roleList=e.rows,s.total=e.total,s.loading=!1}))},i=()=>{const e=h(r);let l=e.getCheckedKeys(),a=e.getHalfCheckedKeys();return l.unshift.apply(l,a),l},C=()=>{s.queryParams.pageNum=1,m()},g=()=>{D().then((e=>{s.menuOptions=e.menus}))},k=e=>O(e).then((e=>(s.deptOptions=e.data.depts,e.data))),b=e=>P(e).then((e=>e)),V=()=>{const e=h(d);if(!e)return;let l=e.getCheckedKeys(),a=e.getHalfCheckedKeys();return l.unshift.apply(l,a),l};return t((()=>{m(),e.getDicts("sys_normal_disable").then((e=>{s.statusOptions=e.data}))})),{roleFormRef:n,menuRef:d,deptRef:r,handleAdd:()=>{u(),g(),s.open=!0,s.title="添加角色"},handleUpdate:e=>{const l=e.roleId;g();const a=b(l);N(l).then((e=>{s.roleForm=e.data,s.open=!0,s.title="修改角色",f((()=>{a.then((e=>{s.menuCheckedKeys=e.checkedKeys;h(d).setCheckedKeys(e.checkedKeys)}))}))}))},handleDelete:e=>{const l=e.roleId||s.ids;y({message:'是否确认删除角色编号为"'+l+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return K(l)})).then((()=>{m(),c.success("删除成功")}))},handleExport:()=>{const e=s.queryParams;y({message:"是否确认导出所有角色数据项?",title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return z(e)})).then((e=>{}))},handleSelectionChange:e=>{s.ids=e.map((e=>e.roleId)),s.single=1!=e.length,s.multiple=!e.length},handleDataScope:e=>{u();const l=k(e.roleId);N(e.roleId).then((e=>{s.roleForm=e.data,s.openDataScope=!0,f((()=>{l.then((e=>{h(r).setCheckedKeys(e.checkedKeys)}))})),s.title="分配数据权限"}))},handleStatusChange:e=>{let l="0"===e.status?"启用":"停用";y({closeOnClickModal:!1,closeOnPressEscape:!1,title:"警告",message:'确认要"'+l+'""'+e.roleName+'"角色吗?',showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return v(e.roleId,e.status)})).then((()=>{c.success(l+"成功")})).catch((function(){e.status="0"===e.status?"1":"0"}))},handleSizeChange:e=>{s.queryParams.pageSize=e,C()},handleCurrentChange:e=>{s.queryParams.pageNum=e,C()},submitForm:()=>{const e=h(n);e&&e.validate((e=>{e&&(null!=s.roleForm&&null!=s.roleForm.roleId?(s.roleForm.menuIds=V(),q(s.roleForm).then((()=>{c.success("修改成功"),s.open=!1,m()}))):(s.roleForm.menuIds=V(),U(s.roleForm).then((()=>{c.success("新增成功"),s.open=!1,m()}))))}))},handleQuery:C,resetQuery:()=>{s.queryParams.pageNum=1,s.queryParams.pageSize=10,s.queryParams.roleName="",s.queryParams.roleKey="",s.queryParams.status="",C()},submitDataScope:()=>{null!=s.roleForm.roleId&&(s.roleForm.deptIds=i(),w(s.roleForm).then((e=>{c.success("修改成功"),s.openDataScope=!1,m()})))},getDeptAllCheckedKeys:i,getRoleMenuTreeselect:b,cancel:()=>{s.open=!1,u()},dataScopeSelectChange:e=>{const l=h(r);"2"!==e&&l.setCheckedKeys([])},cancelDataScope:()=>{s.openDataScope=!1,u()},getList:m,handleCheckedTreeExpand:(e,l)=>{if("menu"==l){let l=s.menuOptions;for(let a=0;a<l.length;a++){const t=h(d);console.log("treeList",l[a]),t.store.nodesMap[l[a].id].expanded=e}}else if("dept"==l){let l=s.deptOptions;for(let a=0;a<l.length;a++){h(r).store.nodesMap[l[a].id].expanded=e}}},handleCheckedTreeNodeAll:(e,l)=>{if("menu"==l){h(d).setCheckedNodes(e?s.menuOptions:[])}else if("dept"==l){h(r).setCheckedNodes(e?s.deptOptions:[])}},handleCheckedTreeConnect:(e,l)=>{"menu"==l?s.roleForm.value.menuCheckStrictly=!!e:"dept"==l&&(s.roleForm.value.deptCheckStrictly=!!e)},...o(s)}}},I={class:"app-container"},E=x(" 搜索"),A=x(" 重置 "),B=x("新增"),R=x("删除"),L=x("导出"),Q=x("修改"),j=x("数据权限"),M=x("删除"),H=x("展开/折叠 "),G=x("全选/全不选 "),J=x("父子联动"),W={class:"dialog-footer"},X=x("确 定"),Y=x("取 消"),Z=x("展开/折叠 "),$=x("全选/全不选 "),ee={class:"dialog-footer"},le=x("确 定"),ae=x("取 消");const te=e(T,[["render",function(e,l,a,t,o,p){const c=n("el-input"),h=n("el-form-item"),y=n("el-option"),f=n("el-select"),F=n("SvgIcon"),w=n("el-button"),v=n("el-form"),N=n("el-col"),K=n("el-row"),z=n("el-table-column"),q=n("el-switch"),U=n("el-table"),P=n("el-divider"),D=n("el-pagination"),O=n("el-card"),T=n("el-input-number"),te=n("el-radio"),oe=n("el-radio-group"),ne=n("el-checkbox"),de=n("el-tree"),re=n("el-tab-pane"),se=n("el-tabs"),ue=n("el-dialog"),me=d("drag"),ie=d("auth"),pe=d("loading");return C(),r("div",I,[s(u("div",null,null,512),[[me,[".app-container .el-dialog",".app-container .el-dialog__header"]]]),m(O,{shadow:"always"},{default:i((()=>[m(v,{model:e.queryParams,ref:"queryForm",inline:!0},{default:i((()=>[m(h,{label:"角色名称",prop:"roleName"},{default:i((()=>[m(c,{placeholder:"角色名称模糊查询",clearable:"",size:"small",onKeyup:g(t.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.roleName,"onUpdate:modelValue":l[0]||(l[0]=l=>e.queryParams.roleName=l)},null,8,["onKeyup","modelValue"])])),_:1}),m(h,{label:"权限字符",prop:"roleKey"},{default:i((()=>[m(c,{placeholder:"权限字符模糊查询",clearable:"",size:"small",onKeyup:g(t.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.roleKey,"onUpdate:modelValue":l[1]||(l[1]=l=>e.queryParams.roleKey=l)},null,8,["onKeyup","modelValue"])])),_:1}),m(h,{label:"状态",prop:"status"},{default:i((()=>[m(f,{modelValue:e.queryParams.status,"onUpdate:modelValue":l[2]||(l[2]=l=>e.queryParams.status=l),placeholder:"角色状态",clearable:"",size:"small",style:{width:"240px"}},{default:i((()=>[(C(!0),r(k,null,b(e.statusOptions,(e=>(C(),V(y,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(h,null,{default:i((()=>[m(w,{type:"primary",size:"mini",onClick:t.handleQuery},{default:i((()=>[m(F,{name:"elementSearch"}),E])),_:1},8,["onClick"]),m(w,{size:"mini",onClick:t.resetQuery},{default:i((()=>[m(F,{name:"elementRefresh"}),A])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),m(K,{gutter:10,"custom-class":"mb8"},{default:i((()=>[m(N,{span:1.5},{default:i((()=>[s((C(),V(w,{type:"primary",plain:"",size:"mini",onClick:t.handleAdd},{default:i((()=>[m(F,{name:"elementPlus"}),B])),_:1},8,["onClick"])),[[ie,"system:role:add"]])])),_:1},8,["span"]),m(N,{span:1.5},{default:i((()=>[s((C(),V(w,{type:"danger",plain:"",size:"mini",disabled:e.multiple,onClick:t.handleDelete},{default:i((()=>[m(F,{name:"elementDelete"}),R])),_:1},8,["disabled","onClick"])),[[ie,"system:role:delete"]])])),_:1},8,["span"]),m(N,{span:1.5},{default:i((()=>[s((C(),V(w,{type:"warning",plain:"",size:"mini",onClick:t.handleExport},{default:i((()=>[m(F,{name:"elementDownload"}),L])),_:1},8,["onClick"])),[[ie,"system:role:export"]])])),_:1},8,["span"])])),_:1}),s((C(),V(U,{data:e.roleList,onSelectionChange:t.handleSelectionChange},{default:i((()=>[m(z,{type:"selection",width:"55",align:"center"}),m(z,{label:"角色编号",prop:"roleId",width:"120"}),m(z,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),m(z,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0,width:"150"}),m(z,{label:"显示顺序",prop:"roleSort",width:"100"}),m(z,{label:"状态",align:"center",width:"100"},{default:i((e=>[m(q,{modelValue:e.row.status,"onUpdate:modelValue":l=>e.row.status=l,"active-value":"0","inactive-value":"1",onClick:l=>t.handleStatusChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])])),_:1}),m(z,{label:"创建时间",align:"center",prop:"create_time",width:"180"},{default:i((l=>[u("span",null,_(e.dateStrFormat(l.row.createTime)),1)])),_:1}),m(z,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:i((e=>[s((C(),V(w,{size:"mini",type:"text",onClick:l=>t.handleUpdate(e.row)},{default:i((()=>[m(F,{name:"elementEdit"}),Q])),_:2},1032,["onClick"])),[[ie,"system:role:edit"]]),m(w,{size:"mini",type:"text",onClick:l=>t.handleDataScope(e.row)},{default:i((()=>[m(F,{name:"elementCircleCheck"}),j])),_:2},1032,["onClick"]),s((C(),V(w,{size:"mini",type:"text",onClick:l=>t.handleDelete(e.row)},{default:i((()=>[m(F,{name:"elementDelete"}),M])),_:2},1032,["onClick"])),[[ie,"system:role:delete"]])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[pe,e.loading]]),s(u("div",null,[m(P),m(D,{background:"",total:e.total,"current-page":e.queryParams.pageNum,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])],512),[[S,e.total>0]])])),_:1}),m(ue,{title:e.title,modelValue:e.open,"onUpdate:modelValue":l[15]||(l[15]=l=>e.open=l),width:"769px"},{footer:i((()=>[u("span",W,[m(w,{type:"primary",size:"small",onClick:t.submitForm},{default:i((()=>[X])),_:1},8,["onClick"]),m(w,{size:"small",onClick:t.cancel},{default:i((()=>[Y])),_:1},8,["onClick"])])])),default:i((()=>[m(v,{ref:"roleFormRef",model:e.roleForm,rules:e.rules,"label-width":"120px","label-position":"right"},{default:i((()=>[m(h,{label:"角色名称",prop:"roleName"},{default:i((()=>[m(c,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":l[3]||(l[3]=l=>e.roleForm.roleName=l),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),m(h,{label:"权限字符",prop:"roleKey"},{default:i((()=>[m(c,{modelValue:e.roleForm.roleKey,"onUpdate:modelValue":l[4]||(l[4]=l=>e.roleForm.roleKey=l),placeholder:"请输入权限字符"},null,8,["modelValue"])])),_:1}),m(h,{label:"角色顺序",prop:"roleSort"},{default:i((()=>[m(T,{modelValue:e.roleForm.roleSort,"onUpdate:modelValue":l[5]||(l[5]=l=>e.roleForm.roleSort=l),"controls-position":"right",min:0},null,8,["modelValue"])])),_:1}),m(h,{label:"状态"},{default:i((()=>[m(oe,{modelValue:e.roleForm.status,"onUpdate:modelValue":l[6]||(l[6]=l=>e.roleForm.status=l)},{default:i((()=>[(C(!0),r(k,null,b(e.statusOptions,(e=>(C(),V(te,{key:e.dictValue,label:e.dictValue},{default:i((()=>[x(_(e.dictLabel),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(h,{label:"权限设置"},{default:i((()=>[m(se,{modelValue:e.activeName,"onUpdate:modelValue":l[13]||(l[13]=l=>e.activeName=l),onTabClick:e.handleClick},{default:i((()=>[m(re,{label:"菜单权限",name:"first"},{default:i((()=>[m(ne,{modelValue:e.menuExpand,"onUpdate:modelValue":l[7]||(l[7]=l=>e.menuExpand=l),onChange:l[8]||(l[8]=e=>t.handleCheckedTreeExpand(e,"menu"))},{default:i((()=>[H])),_:1},8,["modelValue"]),m(ne,{modelValue:e.menuNodeAll,"onUpdate:modelValue":l[9]||(l[9]=l=>e.menuNodeAll=l),onChange:l[10]||(l[10]=e=>t.handleCheckedTreeNodeAll(e,"menu"))},{default:i((()=>[G])),_:1},8,["modelValue"]),m(ne,{modelValue:e.roleForm.menuCheckStrictly,"onUpdate:modelValue":l[11]||(l[11]=l=>e.roleForm.menuCheckStrictly=l),onChange:l[12]||(l[12]=e=>t.handleCheckedTreeConnect(e,"menu"))},{default:i((()=>[J])),_:1},8,["modelValue"]),m(de,{class:"tree-border",data:e.menuOptions,"show-checkbox":"",ref:"menuRef","node-key":"id","empty-text":"加载中，请稍后","check-strictly":!e.roleForm.menuCheckStrictly,props:{label:"label",children:"children"},"default-checked-keys":e.menuCheckedKeys},null,8,["data","check-strictly","default-checked-keys"])])),_:1})])),_:1},8,["modelValue","onTabClick"])])),_:1}),m(h,{label:"备注"},{default:i((()=>[m(c,{modelValue:e.roleForm.remark,"onUpdate:modelValue":l[14]||(l[14]=l=>e.roleForm.remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),m(ue,{title:e.title,modelValue:e.openDataScope,"onUpdate:modelValue":l[23]||(l[23]=l=>e.openDataScope=l),width:"769px"},{footer:i((()=>[u("span",ee,[m(w,{type:"primary",size:"small",onClick:t.submitDataScope},{default:i((()=>[le])),_:1},8,["onClick"]),m(w,{size:"small",onClick:t.cancelDataScope},{default:i((()=>[ae])),_:1},8,["onClick"])])])),default:i((()=>[m(v,{model:e.roleForm,"label-width":"80px"},{default:i((()=>[m(h,{label:"角色名称"},{default:i((()=>[m(c,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":l[16]||(l[16]=l=>e.roleForm.roleName=l),disabled:!0},null,8,["modelValue"])])),_:1}),m(h,{label:"权限字符"},{default:i((()=>[m(c,{modelValue:e.roleForm.roleKey,"onUpdate:modelValue":l[17]||(l[17]=l=>e.roleForm.roleKey=l),disabled:!0},null,8,["modelValue"])])),_:1}),m(h,{label:"权限范围"},{default:i((()=>[m(f,{modelValue:e.roleForm.dataScope,"onUpdate:modelValue":l[18]||(l[18]=l=>e.roleForm.dataScope=l),onChange:t.dataScopeSelectChange},{default:i((()=>[(C(!0),r(k,null,b(e.dataScopeOptions,(e=>(C(),V(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),s(m(h,{label:"数据权限"},{default:i((()=>[m(ne,{modelValue:e.deptExpand,"onUpdate:modelValue":l[19]||(l[19]=l=>e.deptExpand=l),onChange:l[20]||(l[20]=e=>t.handleCheckedTreeExpand(e,"dept"))},{default:i((()=>[Z])),_:1},8,["modelValue"]),m(ne,{modelValue:e.deptNodeAll,"onUpdate:modelValue":l[21]||(l[21]=l=>e.deptNodeAll=l),onChange:l[22]||(l[22]=e=>t.handleCheckedTreeNodeAll(e,"dept"))},{default:i((()=>[$])),_:1},8,["modelValue"]),m(de,{class:"tree-border",data:e.deptOptions,"show-checkbox":"","default-expand-all":"",ref:"deptRef","node-key":"id","empty-text":"加载中，请稍后",props:{label:"label",children:"children"}},null,8,["data"])])),_:1},512),[[S,2==e.roleForm.dataScope]])])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}]]);export{te as default};
