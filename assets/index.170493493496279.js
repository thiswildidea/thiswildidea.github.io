import{at as e,_ as l,D as a,k as t,m as o,p as n,r,Q as d,a as u,v as s,b as m,h as i,w as p,g as c,H as h,ay as y,I as f,G as g,o as C,au as k,F as b,e as V,f as _,t as S,x,i as F}from"./index.1704934934962.js";import{r as v,t as w}from"./menu.1704934934962.js";import{r as N}from"./dept.1704934934962.js";function K(l){return e({url:"/system/role/"+l,method:"get"})}const z={name:"systemRole",setup(){const{proxy:l}=c(),r=a(null),d=a(null),u=a(null),s=t({activeName:"first",loading:!0,ids:[],total:0,title:"",open:!1,roleList:[],showSearch:!0,single:!0,multiple:!0,statusOptions:[],menuOptions:[],menuCheckedKeys:[],deptOptions:[],openDataScope:!1,menuExpand:!1,menuNodeAll:!1,deptExpand:!0,deptNodeAll:!1,queryParams:{pageNum:1,pageSize:10,roleName:void 0,roleKey:void 0,status:void 0},dataScopeOptions:[{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}],roleForm:{},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),m=()=>{s.menuExpand=!1,s.menuNodeAll=!1,s.deptExpand=!0,s.deptNodeAll=!1,s.roleForm={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},s.roleForm={}},i=()=>{var l;s.loading=!0,(l=s.queryParams,e({url:"/system/role/list",method:"get",params:l})).then((e=>{s.roleList=e.rows,s.total=e.total,s.loading=!1}))},p=()=>{const e=y(u);let l=e.getCheckedKeys(),a=e.getHalfCheckedKeys();return l.unshift.apply(l,a),l},C=()=>{s.queryParams.pageNum=1,i()},k=()=>{w().then((e=>{s.menuOptions=e.menus}))},b=e=>N(e).then((e=>(s.deptOptions=e.data.depts,e.data))),V=e=>v(e).then((e=>e)),_=()=>{const e=y(d);if(!e)return;let l=e.getCheckedKeys(),a=e.getHalfCheckedKeys();return l.unshift.apply(l,a),l};return o((()=>{i(),l.getDicts("sys_normal_disable").then((e=>{s.statusOptions=e.data}))})),{roleFormRef:r,menuRef:d,deptRef:u,handleAdd:()=>{m(),k(),s.open=!0,s.title="添加角色"},handleUpdate:e=>{const l=e.roleId;k();const a=V(l);K(l).then((e=>{s.roleForm=e.data,s.open=!0,s.title="修改角色",g((()=>{a.then((e=>{s.menuCheckedKeys=e.checkedKeys;y(d).setCheckedKeys(e.checkedKeys)}))}))}))},handleDelete:l=>{const a=l.roleId||s.ids;f({message:'是否确认删除角色编号为"'+a+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return e({url:"/system/role/"+a,method:"delete"})})).then((()=>{i(),h.success("删除成功")}))},handleExport:()=>{const l=s.queryParams;f({message:"是否确认导出所有角色数据项?",title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return e({url:"/system/role/export",method:"get",params:l})})).then((e=>{}))},handleSelectionChange:e=>{s.ids=e.map((e=>e.roleId)),s.single=1!=e.length,s.multiple=!e.length},handleDataScope:e=>{m();const l=b(e.roleId);K(e.roleId).then((e=>{s.roleForm=e.data,s.openDataScope=!0,g((()=>{l.then((e=>{y(u).setCheckedKeys(e.checkedKeys)}))})),s.title="分配数据权限"}))},handleStatusChange:l=>{let a="0"===l.status?"启用":"停用";f({closeOnClickModal:!1,closeOnPressEscape:!1,title:"警告",message:'确认要"'+a+'""'+l.roleName+'"角色吗?',showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){return a=l.roleId,t=l.status,e({url:"/system/role/changeStatus",method:"put",data:{roleId:a,status:t}});var a,t})).then((()=>{h.success(a+"成功")})).catch((function(){l.status="0"===l.status?"1":"0"}))},handleSizeChange:e=>{s.queryParams.pageSize=e,C()},handleCurrentChange:e=>{s.queryParams.pageNum=e,C()},submitForm:()=>{const l=y(r);l&&l.validate((l=>{var a;l&&(null!=s.roleForm&&null!=s.roleForm.roleId?(s.roleForm.menuIds=_(),(a=s.roleForm,e({url:"/system/role",method:"put",data:a})).then((()=>{h.success("修改成功"),s.open=!1,i()}))):(s.roleForm.menuIds=_(),function(l){return e({url:"/system/role",method:"post",data:l})}(s.roleForm).then((()=>{h.success("新增成功"),s.open=!1,i()}))))}))},handleQuery:C,resetQuery:()=>{s.queryParams.pageNum=1,s.queryParams.pageSize=10,s.queryParams.roleName="",s.queryParams.roleKey="",s.queryParams.status="",C()},submitDataScope:()=>{var l;null!=s.roleForm.roleId&&(s.roleForm.deptIds=p(),(l=s.roleForm,e({url:"/system/role/dataScope",method:"put",data:l})).then((e=>{h.success("修改成功"),s.openDataScope=!1,i()})))},getDeptAllCheckedKeys:p,getRoleMenuTreeselect:V,cancel:()=>{s.open=!1,m()},dataScopeSelectChange:e=>{const l=y(u);"2"!==e&&l.setCheckedKeys([])},cancelDataScope:()=>{s.openDataScope=!1,m()},getList:i,handleCheckedTreeExpand:(e,l)=>{if("menu"==l){let l=s.menuOptions;for(let a=0;a<l.length;a++){const t=y(d);console.log("treeList",l[a]),t.store.nodesMap[l[a].id].expanded=e}}else if("dept"==l){let l=s.deptOptions;for(let a=0;a<l.length;a++){y(u).store.nodesMap[l[a].id].expanded=e}}},handleCheckedTreeNodeAll:(e,l)=>{if("menu"==l){y(d).setCheckedNodes(e?s.menuOptions:[])}else if("dept"==l){y(u).setCheckedNodes(e?s.deptOptions:[])}},handleCheckedTreeConnect:(e,l)=>{"menu"==l?s.roleForm.value.menuCheckStrictly=!!e:"dept"==l&&(s.roleForm.value.deptCheckStrictly=!!e)},...n(s)}}},q={class:"app-container"},U=F(" 搜索"),P=F(" 重置 "),D=F("新增"),I=F("删除"),O=F("导出"),T=F("修改"),E=F("数据权限"),A=F("删除"),B=F("展开/折叠 "),R=F("全选/全不选 "),L=F("父子联动"),Q={class:"dialog-footer"},j=F("确 定"),M=F("取 消"),H=F("展开/折叠 "),G=F("全选/全不选 "),J={class:"dialog-footer"},W=F("确 定"),X=F("取 消");const Y=l(z,[["render",function(e,l,a,t,o,n){const c=r("el-input"),h=r("el-form-item"),y=r("el-option"),f=r("el-select"),g=r("SvgIcon"),v=r("el-button"),w=r("el-form"),N=r("el-col"),K=r("el-row"),z=r("el-table-column"),Y=r("el-switch"),Z=r("el-table"),$=r("el-divider"),ee=r("el-pagination"),le=r("el-card"),ae=r("el-input-number"),te=r("el-radio"),oe=r("el-radio-group"),ne=r("el-checkbox"),re=r("el-tree"),de=r("el-tab-pane"),ue=r("el-tabs"),se=r("el-dialog"),me=d("drag"),ie=d("auth"),pe=d("loading");return C(),u("div",q,[s(m("div",null,null,512),[[me,[".app-container .el-dialog",".app-container .el-dialog__header"]]]),i(le,{shadow:"always"},{default:p((()=>[i(w,{model:e.queryParams,ref:"queryForm",inline:!0},{default:p((()=>[i(h,{label:"角色名称",prop:"roleName"},{default:p((()=>[i(c,{placeholder:"角色名称模糊查询",clearable:"",size:"small",onKeyup:k(t.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.roleName,"onUpdate:modelValue":l[0]||(l[0]=l=>e.queryParams.roleName=l)},null,8,["onKeyup","modelValue"])])),_:1}),i(h,{label:"权限字符",prop:"roleKey"},{default:p((()=>[i(c,{placeholder:"权限字符模糊查询",clearable:"",size:"small",onKeyup:k(t.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.roleKey,"onUpdate:modelValue":l[1]||(l[1]=l=>e.queryParams.roleKey=l)},null,8,["onKeyup","modelValue"])])),_:1}),i(h,{label:"状态",prop:"status"},{default:p((()=>[i(f,{modelValue:e.queryParams.status,"onUpdate:modelValue":l[2]||(l[2]=l=>e.queryParams.status=l),placeholder:"角色状态",clearable:"",size:"small",style:{width:"240px"}},{default:p((()=>[(C(!0),u(b,null,V(e.statusOptions,(e=>(C(),_(y,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(h,null,{default:p((()=>[i(v,{type:"primary",size:"mini",onClick:t.handleQuery},{default:p((()=>[i(g,{name:"elementSearch"}),U])),_:1},8,["onClick"]),i(v,{size:"mini",onClick:t.resetQuery},{default:p((()=>[i(g,{name:"elementRefresh"}),P])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),i(K,{gutter:10,"custom-class":"mb8"},{default:p((()=>[i(N,{span:1.5},{default:p((()=>[s((C(),_(v,{type:"primary",plain:"",size:"mini",onClick:t.handleAdd},{default:p((()=>[i(g,{name:"elementPlus"}),D])),_:1},8,["onClick"])),[[ie,"system:role:add"]])])),_:1},8,["span"]),i(N,{span:1.5},{default:p((()=>[s((C(),_(v,{type:"danger",plain:"",size:"mini",disabled:e.multiple,onClick:t.handleDelete},{default:p((()=>[i(g,{name:"elementDelete"}),I])),_:1},8,["disabled","onClick"])),[[ie,"system:role:delete"]])])),_:1},8,["span"]),i(N,{span:1.5},{default:p((()=>[s((C(),_(v,{type:"warning",plain:"",size:"mini",onClick:t.handleExport},{default:p((()=>[i(g,{name:"elementDownload"}),O])),_:1},8,["onClick"])),[[ie,"system:role:export"]])])),_:1},8,["span"])])),_:1}),s((C(),_(Z,{data:e.roleList,onSelectionChange:t.handleSelectionChange},{default:p((()=>[i(z,{type:"selection",width:"55",align:"center"}),i(z,{label:"角色编号",prop:"roleId",width:"120"}),i(z,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),i(z,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0,width:"150"}),i(z,{label:"显示顺序",prop:"roleSort",width:"100"}),i(z,{label:"状态",align:"center",width:"100"},{default:p((e=>[i(Y,{modelValue:e.row.status,"onUpdate:modelValue":l=>e.row.status=l,"active-value":"0","inactive-value":"1",onClick:l=>t.handleStatusChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])])),_:1}),i(z,{label:"创建时间",align:"center",prop:"create_time",width:"180"},{default:p((l=>[m("span",null,S(e.dateStrFormat(l.row.createTime)),1)])),_:1}),i(z,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:p((e=>[s((C(),_(v,{size:"mini",type:"text",onClick:l=>t.handleUpdate(e.row)},{default:p((()=>[i(g,{name:"elementEdit"}),T])),_:2},1032,["onClick"])),[[ie,"system:role:edit"]]),i(v,{size:"mini",type:"text",onClick:l=>t.handleDataScope(e.row)},{default:p((()=>[i(g,{name:"elementCircleCheck"}),E])),_:2},1032,["onClick"]),s((C(),_(v,{size:"mini",type:"text",onClick:l=>t.handleDelete(e.row)},{default:p((()=>[i(g,{name:"elementDelete"}),A])),_:2},1032,["onClick"])),[[ie,"system:role:delete"]])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[pe,e.loading]]),s(m("div",null,[i($),i(ee,{background:"",total:e.total,"current-page":e.queryParams.pageNum,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])],512),[[x,e.total>0]])])),_:1}),i(se,{title:e.title,modelValue:e.open,"onUpdate:modelValue":l[15]||(l[15]=l=>e.open=l),width:"769px"},{footer:p((()=>[m("span",Q,[i(v,{type:"primary",size:"small",onClick:t.submitForm},{default:p((()=>[j])),_:1},8,["onClick"]),i(v,{size:"small",onClick:t.cancel},{default:p((()=>[M])),_:1},8,["onClick"])])])),default:p((()=>[i(w,{ref:"roleFormRef",model:e.roleForm,rules:e.rules,"label-width":"120px","label-position":"right"},{default:p((()=>[i(h,{label:"角色名称",prop:"roleName"},{default:p((()=>[i(c,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":l[3]||(l[3]=l=>e.roleForm.roleName=l),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),i(h,{label:"权限字符",prop:"roleKey"},{default:p((()=>[i(c,{modelValue:e.roleForm.roleKey,"onUpdate:modelValue":l[4]||(l[4]=l=>e.roleForm.roleKey=l),placeholder:"请输入权限字符"},null,8,["modelValue"])])),_:1}),i(h,{label:"角色顺序",prop:"roleSort"},{default:p((()=>[i(ae,{modelValue:e.roleForm.roleSort,"onUpdate:modelValue":l[5]||(l[5]=l=>e.roleForm.roleSort=l),"controls-position":"right",min:0},null,8,["modelValue"])])),_:1}),i(h,{label:"状态"},{default:p((()=>[i(oe,{modelValue:e.roleForm.status,"onUpdate:modelValue":l[6]||(l[6]=l=>e.roleForm.status=l)},{default:p((()=>[(C(!0),u(b,null,V(e.statusOptions,(e=>(C(),_(te,{key:e.dictValue,label:e.dictValue},{default:p((()=>[F(S(e.dictLabel),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),i(h,{label:"权限设置"},{default:p((()=>[i(ue,{modelValue:e.activeName,"onUpdate:modelValue":l[13]||(l[13]=l=>e.activeName=l),onTabClick:e.handleClick},{default:p((()=>[i(de,{label:"菜单权限",name:"first"},{default:p((()=>[i(ne,{modelValue:e.menuExpand,"onUpdate:modelValue":l[7]||(l[7]=l=>e.menuExpand=l),onChange:l[8]||(l[8]=e=>t.handleCheckedTreeExpand(e,"menu"))},{default:p((()=>[B])),_:1},8,["modelValue"]),i(ne,{modelValue:e.menuNodeAll,"onUpdate:modelValue":l[9]||(l[9]=l=>e.menuNodeAll=l),onChange:l[10]||(l[10]=e=>t.handleCheckedTreeNodeAll(e,"menu"))},{default:p((()=>[R])),_:1},8,["modelValue"]),i(ne,{modelValue:e.roleForm.menuCheckStrictly,"onUpdate:modelValue":l[11]||(l[11]=l=>e.roleForm.menuCheckStrictly=l),onChange:l[12]||(l[12]=e=>t.handleCheckedTreeConnect(e,"menu"))},{default:p((()=>[L])),_:1},8,["modelValue"]),i(re,{class:"tree-border",data:e.menuOptions,"show-checkbox":"",ref:"menuRef","node-key":"id","empty-text":"加载中，请稍后","check-strictly":!e.roleForm.menuCheckStrictly,props:{label:"label",children:"children"},"default-checked-keys":e.menuCheckedKeys},null,8,["data","check-strictly","default-checked-keys"])])),_:1})])),_:1},8,["modelValue","onTabClick"])])),_:1}),i(h,{label:"备注"},{default:p((()=>[i(c,{modelValue:e.roleForm.remark,"onUpdate:modelValue":l[14]||(l[14]=l=>e.roleForm.remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),i(se,{title:e.title,modelValue:e.openDataScope,"onUpdate:modelValue":l[23]||(l[23]=l=>e.openDataScope=l),width:"769px"},{footer:p((()=>[m("span",J,[i(v,{type:"primary",size:"small",onClick:t.submitDataScope},{default:p((()=>[W])),_:1},8,["onClick"]),i(v,{size:"small",onClick:t.cancelDataScope},{default:p((()=>[X])),_:1},8,["onClick"])])])),default:p((()=>[i(w,{model:e.roleForm,"label-width":"80px"},{default:p((()=>[i(h,{label:"角色名称"},{default:p((()=>[i(c,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":l[16]||(l[16]=l=>e.roleForm.roleName=l),disabled:!0},null,8,["modelValue"])])),_:1}),i(h,{label:"权限字符"},{default:p((()=>[i(c,{modelValue:e.roleForm.roleKey,"onUpdate:modelValue":l[17]||(l[17]=l=>e.roleForm.roleKey=l),disabled:!0},null,8,["modelValue"])])),_:1}),i(h,{label:"权限范围"},{default:p((()=>[i(f,{modelValue:e.roleForm.dataScope,"onUpdate:modelValue":l[18]||(l[18]=l=>e.roleForm.dataScope=l),onChange:t.dataScopeSelectChange},{default:p((()=>[(C(!0),u(b,null,V(e.dataScopeOptions,(e=>(C(),_(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),s(i(h,{label:"数据权限"},{default:p((()=>[i(ne,{modelValue:e.deptExpand,"onUpdate:modelValue":l[19]||(l[19]=l=>e.deptExpand=l),onChange:l[20]||(l[20]=e=>t.handleCheckedTreeExpand(e,"dept"))},{default:p((()=>[H])),_:1},8,["modelValue"]),i(ne,{modelValue:e.deptNodeAll,"onUpdate:modelValue":l[21]||(l[21]=l=>e.deptNodeAll=l),onChange:l[22]||(l[22]=e=>t.handleCheckedTreeNodeAll(e,"dept"))},{default:p((()=>[G])),_:1},8,["modelValue"]),i(re,{class:"tree-border",data:e.deptOptions,"show-checkbox":"","default-expand-all":"",ref:"deptRef","node-key":"id","empty-text":"加载中，请稍后",props:{label:"label",children:"children"}},null,8,["data"])])),_:1},512),[[x,2==e.roleForm.dataScope]])])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}]]);export{Y as default};
