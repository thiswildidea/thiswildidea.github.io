var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);import{_ as i,u as s,A as n,k as r,m as o,V as a,l,p as h,a as c,o as d,X as p,Y as u,b as m}from"./index.1706230354914.js";import{i as w,j as f}from"./index.1706230354914115.js";import{l as g,M as v}from"./mapconfig.1706230354914.js";import{W as y,S as b,P as x,A as R,u as S,a as L,D as z,v as P,V as C,w as A,x as j,s as D,b as _,h as M}from"./three.module.1706230354914.js";class U{constructor(e,i,s,n){t(this,"view",null),t(this,"externalRenderers",null),t(this,"options",null),t(this,"renderer",null),t(this,"scene",null),t(this,"camera",null),t(this,"commonUniforms",null),t(this,"groupDots",null),t(this,"groupLines",null),t(this,"groupAnimDots",null),t(this,"ambient",null),t(this,"sun",null),t(this,"parColor",null),t(this,"parLength",null),t(this,"parSpeed",null),t(this,"isShow",null),t(this,"parSize",null),this.view=e,this.externalRenderers=i;this.options=this.extend({},{color:[255,0,0],len:.3,speed:.5,size:4,isShow:!0},s,{linePoints:n}),this.parColor=this.options.color,this.parLength=this.options.len,this.parSpeed=this.options.speed,this.parSize=this.options.size,this.isShow=this.options.isShow,this.commonUniforms={time:{value:0},number:{value:1},speed:{value:this.parSpeed},length:{value:this.parLength},size:{value:this.parSize},isshow:{value:this.isShow}},this.groupDots=null,this.groupLines=null,this.groupAnimDots=null}setup(e){this.renderer=new y({context:e.gl,premultipliedAlpha:!1}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setViewport(0,0,this.view.width,this.view.height),this.renderer.autoClear=!1,this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!1;let t=this.renderer.setRenderTarget.bind(this.renderer);this.renderer.setRenderTarget=i=>{t(i),null==i&&e.bindRenderTarget()},this.scene=new b;let i=e.camera;this.camera=new x(i.fovY,i.aspect,i.near,i.far);const s=new R(1);s.position.copy(1e6,1e5,1e5),this.scene.add(s);let n=new S(30,10,15790320,16777215);this.scene.add(n),this.ambient=new L(16777215,.5),this.scene.add(this.ambient),this.sun=new z(16777215,.5),this.sun.position.set(-600,300,6e4),this.scene.add(this.sun),this.groupDots=new P,this.groupLines=new P,this.groupAnimDots=new P,this.scene.add(this.groupDots,this.groupLines,this.groupAnimDots),this.addPathPoints(this.options.linePoints),e.resetWebGLState()}addPathPoints(e){var t=0,i=[];for(let l=0;l<e.length;l++){let i=new Array(3),s=new Array(3);this.externalRenderers.toRenderCoordinates(this.view,[e[l][0][0],e[l][0][1],10],0,this.view.spatialReference,i,0,1),this.externalRenderers.toRenderCoordinates(this.view,[e[l][1][0],e[l][1][1],10],0,this.view.spatialReference,s,0,1);let n=new C(i[0],i[1],i[2]);t+=new C(s[0],s[1],s[2]).clone().sub(n).length()}for(let l=0;l<e.length;l++){let s=e[l][0],n=e[l][1],r=new Array(3),o=new Array(3);this.externalRenderers.toRenderCoordinates(this.view,[s[0],s[1],10],0,this.view.spatialReference,r,0,1),this.externalRenderers.toRenderCoordinates(this.view,[n[0],n[1],10],0,this.view.spatialReference,o,0,1);let a=new C(r[0],r[1],r[2]),h=new C(o[0],o[1],o[2]),c=h.clone().sub(a).length()/t*3e3+1;i=i.concat(this.getLinePoints(a,h,c))}let s=(new A).setFromPoints(i),n=i.length,r=new Float32Array(n);for(let l=0;l<n;l+=1)r[l]=l/n;s.addAttribute("percent",new j(r,1));let o=this.createLineMaterial(),a=new D(s,o);this.groupLines.add(a)}getLinePoints(e,t,i){let s=[];for(let n=0;n<i;n++){let r=t.clone().sub(e),o=r.length();r=r.normalize().multiplyScalar(o*n/i);let a=e.clone().add(r);s.push(new C(a.x,a.y,a.z))}return s}createLineMaterial(){let e={time:this.commonUniforms.time,number:this.commonUniforms.number,speed:this.commonUniforms.speed,length:this.commonUniforms.length,size:this.commonUniforms.size,color:{value:new _(this.options.parColor)},isshow:this.commonUniforms.isshow},t=this.getShaderStr();return new M({uniforms:e,vertexShader:t.vs,fragmentShader:t.fs,transparent:!0,depthWrite:!1,depthTest:!1,alphaTest:!1})}getShaderStr(){let e={};return e.vs="\n        attribute float percent;\n        uniform float time;\n        uniform float number;\n        uniform float speed;\n        uniform float length;\n        varying float opacity;\n        uniform float size;\n        void main()\n        {\n          float l = clamp(1.0-length, 0.0, 1.0);\n          gl_PointSize = clamp(fract(percent*number + l - time*number*speed)-l, 0.0, 1.) * size * (1./length);\n          opacity = gl_PointSize/size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n        ",e.fs="\n        varying float opacity;\n        uniform vec3 color;\n        uniform bool isshow;\n        void main(){\n            if (opacity <=0.1){\n              if(isshow){\n                gl_FragColor = vec4(color, 0.1);\n              }else{\n                discard;\n              }\n            }else{\n              gl_FragColor = vec4(color, 1.0);\n            }\n        }\n        ",e}render(e){let t=e.camera;this.camera.position.set(t.eye[0],t.eye[1],t.eye[2]),this.camera.up.set(t.up[0],t.up[1],t.up[2]),this.camera.lookAt(new C(t.center[0],t.center[1],t.center[2])),this.camera.projectionMatrix.fromArray(t.projectionMatrix);let i=e.sunLight;this.sun.position.set(i.direction[0],i.direction[1],i.direction[2]),this.sun.intensity=i.diffuse.intensity,this.sun.color=new _(i.diffuse.color[0],i.diffuse.color[1],i.diffuse.color[2]),this.ambient.intensity=i.ambient.intensity,this.ambient.color=new _(i.ambient.color[0],i.ambient.color[1],i.ambient.color[2]),this.commonUniforms.time.value+=.01,this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),this.externalRenderers.requestRender(this.view),e.resetWebGLState()}extend(...e){for(let t=1;t<arguments.length;t++){const i=arguments[t];for(const t in i)e[t]=i[t]}return e}}const T={name:"map",components:{},setup(){const e=s();n();const t=r({});return o((async()=>{!async function(e){const[t,i,s,n,r,o,a,l,h,c,d,p,u]=await g(["esri/Map","esri/views/SceneView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/widgets/Expand","esri/Camera","esri/widgets/Home","esri/widgets/Fullscreen","esri/widgets/LayerList","esri/widgets/Legend","esri/views/3d/externalRenderers","esri/widgets/BasemapGallery","esri/geometry/SpatialReference"],{url:v.jsapiurl,css:v.jscssurl}),m=new t({basemap:"streets-night-vector",ground:{surfaceColor:"#021425"}}),f=new i({spatialReference:u.WebMercator,container:"viewDiv_threejs_odLine",map:m,viewingMode:"local"}),y=new p({view:f}),b=new r({view:f,content:y,expandIconClass:"esri-icon-basemap",expandTooltip:"LayerList",group:"top-left"});f.ui.add(b,"top-left");const x=new o({fov:e.camera.fov,heading:e.camera.heading,position:{x:e.camera.position.x,y:e.camera.position.y,z:e.camera.position.z,spatialReference:{wkid:3857}},tilt:e.camera.tilt});n.once((()=>!0===(null==f?void 0:f.stationary))).then((()=>{f.goTo(x,e.cameraoptions).then((()=>{})),w("odLinedata").then((e=>{e.map((e=>{let t={linePoints:e,options:{color:"#f1c232",len:.2,speed:.8,size:4,isShow:!0}};const i=new U(f,d,t.options,t.linePoints);d.add(f,i)}))}))})),n.on((()=>f),"click",(e=>{}))}(await f())})),a((()=>{})),l((()=>e.state.tagsViewRoutes.isTagsViewCurrenFull)),{...h(t)}}},F={class:"home-container"},V=[(e=>(p("data-v-50083645"),e=e(),u(),e))((()=>m("div",{id:"viewDiv_threejs_odLine"},null,-1)))];const W=i(T,[["render",function(e,t,i,s,n,r){return d(),c("div",F,V)}],["__scopeId","data-v-50083645"]]);export{W as default};
