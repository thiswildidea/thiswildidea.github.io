import{at as e,_ as t,D as a,A as l,k as o,m as n,M as u,p as s,r as i,Q as r,a as d,h as p,w as m,g as c,I as b,H as h,o as g,au as y,F as f,e as j,f as C,v as w,i as v,t as _,x as k,b as x}from"./index.1705987989573.js";import z from"./editModule.1705987989573.js";const q={name:"Job",components:{EditModule:z},setup(){const{proxy:t}=c(),i=a(),r=a(null);l();const d=o({loading:!0,ids:[],single:!0,multiple:!0,title:"",tableData:[],total:0,open:!1,modelForm:{},jobGroupOptions:[],statusOptions:[],queryParams:{pageNum:1,pageSize:10,jobName:void 0,jobGroup:void 0,status:void 0}}),p=()=>{var t;d.loading=!0,(t=d.queryParams,e({url:"/monitor/job/list",method:"get",params:t})).then((e=>{d.tableData=e.data.data,d.total=e.data.total,d.loading=!1}))};return n((()=>{p(),t.getDicts("sys_normal_disable").then((e=>{d.statusOptions=e.data})),t.getDicts("sys_job_group").then((e=>{d.jobGroupOptions=e.data})),t.mittBus.on("onEditJobModule",(e=>{p()}))})),u((()=>{t.mittBus.off("onEditJobModule")})),{editModuleRef:i,ruleFormRef:r,handleSelectionChange:e=>{d.ids=e.map((e=>e.jobId)),d.single=1!=e.length,d.multiple=!e.length},handleSizeChange:e=>{d.queryParams.pageSize=e,p()},handleCurrentChange:e=>{d.queryParams.pageNum=e,p()},handleQuery:p,resetQuery:()=>{d.queryParams.jobName=void 0,d.queryParams.jobGroup=void 0,d.queryParams.status=void 0,p()},onOpenAddModule:e=>{e=[],d.title="添加定时任务",i.value.openDialog(e)},onOpenEditModule:e=>{d.title="修改定时任务",i.value.openDialog(e)},statusFormat:(e,a)=>t.selectDictLabel(d.statusOptions,e.status),jobGroupFormat:(e,a)=>t.selectDictLabel(d.jobGroupOptions,e.jobGroup),onTabelRowDel:t=>{const a=t.jobId||d.ids;b({message:'是否确认删除定时任务编号为"'+a+'"的数据项?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return(t=a,e({url:"/monitor/job/"+t,method:"delete"})).then((()=>{p(),h.success("删除成功")}));var t}))},handleRun:t=>{let a=t.entryId>0?"停止":"启动";b({message:"确认要立即"+a+'"'+t.jobName+'"任务吗?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){if(!(t.entryId>0))return function(t){return e({url:"/monitor/job/start/"+t,method:"get"})}(t.jobId).then((e=>{p()}));var a;(a=t.jobId,e({url:"/monitor/job/stop/"+a,method:"get"})).then((e=>{p()}))})).then((()=>{h({message:a+"执行成功",type:"success"})}))},handleStatusChange:t=>{let a="0"===t.status?"启用":"停用";b({message:'确认要"'+a+'""'+t.jobName+'"任务吗?',title:"警告",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return a={jobId:t.jobId,status:t.status},e({url:"/monitor/job/changeStatus",method:"put",data:a});var a})).then((()=>{h({message:a+"成功",type:"success"})})).catch((function(){t.status="0"===t.status?"1":"0"}))},...s(d)}}},P={class:"app-container"},S=v(" 搜索"),V=v(" 重置 "),D=v("新增"),G=v("删除"),B=v("编辑"),I=v("删除");const M=t(q,[["render",function(e,t,a,l,o,n){const u=i("el-input"),s=i("el-form-item"),c=i("el-option"),b=i("el-select"),h=i("SvgIcon"),z=i("el-button"),q=i("el-form"),M=i("el-col"),O=i("el-row"),T=i("el-table-column"),N=i("el-switch"),R=i("el-table"),E=i("el-divider"),F=i("el-pagination"),Q=i("el-card"),U=i("EditModule"),L=r("auth"),A=r("loading");return g(),d("div",P,[p(Q,{shadow:"always"},{default:m((()=>[p(q,{model:e.queryParams,ref:"queryForm",inline:!0,"label-width":"68px"},{default:m((()=>[p(s,{label:"任务名称",prop:"jobName"},{default:m((()=>[p(u,{placeholder:"请输入任务名称模糊查询",clearable:"",size:"small",onKeyup:y(l.handleQuery,["enter"]),style:{width:"240px"},modelValue:e.queryParams.jobName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.queryParams.jobName=t)},null,8,["onKeyup","modelValue"])])),_:1}),p(s,{label:"任务组名",prop:"jobGroup"},{default:m((()=>[p(b,{modelValue:e.queryParams.jobGroup,"onUpdate:modelValue":t[1]||(t[1]=t=>e.queryParams.jobGroup=t),placeholder:"请选择任务组名",clearable:"",size:"small",style:{width:"240px"}},{default:m((()=>[(g(!0),d(f,null,j(e.jobGroupOptions,(e=>(g(),C(c,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(s,{label:"任务状态",prop:"status"},{default:m((()=>[p(b,{modelValue:e.queryParams.status,"onUpdate:modelValue":t[2]||(t[2]=t=>e.queryParams.status=t),placeholder:"请选择任务状态",clearable:"",size:"small",style:{width:"240px"}},{default:m((()=>[(g(!0),d(f,null,j(e.statusOptions,(e=>(g(),C(c,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(s,null,{default:m((()=>[p(z,{type:"primary",size:"mini",onClick:l.handleQuery},{default:m((()=>[p(h,{name:"elementSearch"}),S])),_:1},8,["onClick"]),p(z,{size:"mini",onClick:l.resetQuery},{default:m((()=>[p(h,{name:"elementRefresh"}),V])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"]),p(O,{gutter:10,class:"mb8"},{default:m((()=>[p(M,{span:1.5},{default:m((()=>[w((g(),C(z,{type:"primary",plain:"",size:"mini",onClick:l.onOpenAddModule},{default:m((()=>[p(h,{name:"elementPlus"}),D])),_:1},8,["onClick"])),[[L,"tool:job:add"]])])),_:1},8,["span"]),p(M,{span:1.5},{default:m((()=>[w((g(),C(z,{type:"danger",plain:"",size:"mini",disabled:e.multiple,onClick:l.onTabelRowDel},{default:m((()=>[p(h,{name:"elementDelete"}),G])),_:1},8,["disabled","onClick"])),[[L,"tool:job:delete"]])])),_:1},8,["span"])])),_:1}),w((g(),C(R,{data:e.tableData,onSelectionChange:l.handleSelectionChange},{default:m((()=>[p(T,{type:"selection",width:"55",align:"center"}),p(T,{label:"任务编号",align:"center",prop:"jobId"}),p(T,{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}),p(T,{label:"任务组名",align:"center",prop:"jobGroup",formatter:l.jobGroupFormat},null,8,["formatter"]),p(T,{label:"任务类型",align:"center",prop:"jobType"},{default:m((e=>[v(_(1==e.row.jobType?"接口":"函数"),1)])),_:1}),p(T,{label:"调用目标",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),p(T,{label:"cron执行表达式",align:"center",prop:"cronExpression","show-overflow-tooltip":!0}),p(T,{label:"状态",align:"center"},{default:m((e=>[p(N,{modelValue:e.row.status,"onUpdate:modelValue":t=>e.row.status=t,"active-value":"0","inactive-value":"1",onClick:t=>l.handleStatusChange(e.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])])),_:1}),p(T,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:m((e=>[w((g(),C(z,{size:"mini",type:"text",onClick:t=>l.handleRun(e.row)},{default:m((()=>[p(h,{name:"elementSwitchButton"}),v(_(e.row.entryId>0?"停止":"启动"),1)])),_:2},1032,["onClick"])),[[L,"tool:job:run"]]),w((g(),C(z,{size:"mini",type:"text",onClick:t=>l.onOpenEditModule(e.row)},{default:m((()=>[p(h,{name:"elementEdit"}),B])),_:2},1032,["onClick"])),[[L,"tool:job:edit"]]),w((g(),C(z,{size:"mini",type:"text",onClick:t=>l.onTabelRowDel(e.row)},{default:m((()=>[p(h,{name:"elementDelete"}),I])),_:2},1032,["onClick"])),[[L,"tool:job:delete"]])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[A,e.loading]]),w(x("div",null,[p(E),p(F,{background:"",total:e.total,"current-page":e.queryParams.pageNum,"page-size":e.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["total","current-page","page-size","onSizeChange","onCurrentChange"])],512),[[k,e.total>0]])])),_:1}),p(U,{ref:"editModuleRef",title:e.title},null,8,["title"])])}]]);export{M as default};
