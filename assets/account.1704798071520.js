import{at as g,_ as A,d as D,E as N,D as k,u as E,j as L,A as j,k as z,m as M,c as O,r as u,f as H,w as o,ax as n,ay as J,o as G,h as t,b as p,z as K,t as Q,S as _,az as W,aA as X,H as Y,g as Z}from"./index.1704798071520.js";import{l as ee}from"./string.1704798071520.js";function te(){return g({url:"/system/user/getCaptcha",method:"get"})}function oe(h){return g({url:"/system/user/login",method:"post",data:h})}function se(){return g({url:"/system/user/getInfo",method:"get"})}function ne(){return g({url:"/system/user/getRouters",method:"get"})}const ae={class:"login-content-code"},re=["src"],le=D({setup(h){const{t:v}=N(),{proxy:b}=Z(),I=k(null),R=k(null),w=E(),d=L(),y=j(),e=z({imgThree:"https://img1.baidu.com/it/u=2813520958,2218166536&fm=26&fmt=auto&gp=0.jpg",captchaImage:"",loginForm:{username:"admin",password:"admin123",captcha:"",captchaId:""},rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]},isShowPassword:!1,loading:{signIn:!1}});M(()=>{f()});const f=async()=>{let s=await te();e.captchaImage=s.base64Captcha,e.loginForm.captchaId=s.captchaId},S=O(()=>J(new Date)),B=()=>{I.value.validate(s=>{if(s)V();else return!1})},V=async()=>{e.loading.signIn=!0;let s;try{s=await oe(e.loginForm)}catch{R.value.reset(),e.loading.signIn=!1,e.loginForm.captcha="",f();return}let a=s.data;_.set("token",a.token);let r=await se(),c=await ne();_.set("menus",c.menus);let l=r.permissions;l.push("base");const i={username:r.user.userName,userId:r.user.userId,roleId:r.user.roles[0].roleId,deptId:r.user.dept.deptId,postId:r.user.postId,photo:r.user.avatar||ee(r.user.userName),time:new Date().getTime(),authBtnList:l,authPageList:l,lastLoginTime:new Date().getTime(),lastLoginIp:"127.0.0.1"};_.set("userInfo",i),await w.dispatch("userInfos/setUserInfos",i),w.state.themeConfig.themeConfig.isRequestRoutes?(await X(),F()):(await W(),F())},P=()=>{B()},F=()=>{var a,r,c,l;let s=S.value;(a=d.query)!=null&&a.redirect?y.push({path:(r=d.query)==null?void 0:r.redirect,query:Object.keys((c=d.query)==null?void 0:c.params).length>0?JSON.parse((l=d.query)==null?void 0:l.params):""}):y.push("/"),setTimeout(()=>{e.loading.signIn=!0;const i=v("message.signInText");Y.success(`${s}\uFF0C${i}`),b.mittBus.emit("onSignInClick")},300)};return(s,a)=>{const r=u("elementUser"),c=u("el-icon"),l=u("el-input"),i=u("el-form-item"),C=u("elementUnlock"),T=u("elementPosition"),x=u("el-col"),q=u("el-row"),U=u("el-button"),$=u("el-form");return G(),H($,{ref_key:"loginFormRef",ref:I,model:n(e).loginForm,rules:n(e).rules,class:"login-content-form"},{default:o(()=>[t(i,{class:"login-animation-one"},{default:o(()=>[t(l,{type:"text",placeholder:s.$t("message.account.accountPlaceholder1"),"prefix-icon":"el-icon-user",modelValue:n(e).loginForm.username,"onUpdate:modelValue":a[0]||(a[0]=m=>n(e).loginForm.username=m),clearable:"",autocomplete:"off"},{prefix:o(()=>[t(c,{class:"el-input__icon"},{default:o(()=>[t(r)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),t(i,{class:"login-animation-two"},{default:o(()=>[t(l,{type:n(e).isShowPassword?"text":"password",placeholder:s.$t("message.account.accountPlaceholder2"),modelValue:n(e).loginForm.password,"onUpdate:modelValue":a[2]||(a[2]=m=>n(e).loginForm.password=m),autocomplete:"off"},{prefix:o(()=>[t(c,{class:"el-input__icon"},{default:o(()=>[t(C)]),_:1})]),suffix:o(()=>[p("i",{class:K(["iconfont el-input__icon login-content-password",n(e).isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:a[1]||(a[1]=m=>n(e).isShowPassword=!n(e).isShowPassword)},null,2)]),_:1},8,["type","placeholder","modelValue"])]),_:1}),t(i,{class:"login-animation-three"},{default:o(()=>[t(q,{gutter:15},{default:o(()=>[t(x,{span:16},{default:o(()=>[t(l,{type:"text",maxlength:"6",placeholder:s.$t("message.account.accountPlaceholder3"),modelValue:n(e).loginForm.captcha,"onUpdate:modelValue":a[3]||(a[3]=m=>n(e).loginForm.captcha=m),clearable:"",autocomplete:"off"},{prefix:o(()=>[t(c,{class:"el-input__icon"},{default:o(()=>[t(T)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),t(x,{span:8},{default:o(()=>[p("div",ae,[p("img",{class:"login-content-code-img",onClick:f,width:"130px",height:"40px",src:n(e).captchaImage,style:{cursor:"pointer"}},null,8,re)])]),_:1})]),_:1})]),_:1}),t(i,{class:"login-animation-four"},{default:o(()=>[t(U,{type:"primary",class:"login-content-submit",round:"",onClick:P,loading:n(e).loading.signIn},{default:o(()=>[p("span",null,Q(s.$t("message.account.accountBtnText")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}}),ce=A(le,[["__scopeId","data-v-a4cd4430"]]);export{ce as default};
