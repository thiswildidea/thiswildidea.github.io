// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/identity/IdentityManagerBase":function(){define("exports ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/Evented ../core/events ../core/lang ../core/object ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo ../portal/support/urlUtils".split(" "),function(r,
p,q,F,P,N,ha,Z,T,ka,L,da,C,U,la,aa,V,ia,na,oa,ba,wa){const sa={},Da=a=>{const b=(new C.Url(a.owningSystemUrl)).host;a=(new C.Url(a.server)).host;const c=/.+\.arcgis\.com$/i;return c.test(b)&&c.test(a)},xa=(a,b)=>!!(Da(a)&&b&&b.some(c=>c.test(a.server)));let pa=null,ta=null;try{pa=window.localStorage,ta=window.sessionStorage}catch{}class qa extends ha{constructor(){super();this._portalConfig=globalThis.esriGeowConfig;this.serverInfos=[];this.oAuthInfos=[];this.credentials=[];this._soReqs=[];this._xoReqs=
[];this._portals=[];this._defaultOAuthInfo=null;this._defaultTokenValidity=60;this.dialog=null;this.formConstructor=V;this.tokenValidity=null;this.normalizeWebTierAuth=!1;this._appOrigin="null"!==window.origin?window.origin:window.location.origin;this._appUrlObj=C.urlToObject(window.location.href);this._busy=null;this._rejectOnPersistedPageShow=!1;this._oAuthLocationParams=null;this._gwTokenUrl="/sharing/rest/generateToken";this._agsRest="/rest/services";this._agsPortal=/\/sharing(\/|$)/i;this._agsAdmin=
/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;this._adminSvcs=/\/rest\/admin\/services(\/|$)/i;this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",
tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];this._legacyFed=[];this._regexSDirUrl=/http.+\/rest\/services\/?/gi;this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi;
this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;this._createDefaultOAuthInfo=!0;this._hasTestedIfAppIsOnPortal=!1;this._getOAuthLocationParams();window.addEventListener("pageshow",a=>{this._pageShowHandler(a)})}registerServers(a){const b=this.serverInfos;b?(a=a.filter(c=>!this.findServerInfo(c.server)),this.serverInfos=b.concat(a)):this.serverInfos=a;
a.forEach(c=>{c.owningSystemUrl&&this._portals.push(c.owningSystemUrl);c.hasPortal&&this._portals.push(c.server)})}registerOAuthInfos(a){const b=this.oAuthInfos;if(b){for(const c of a){const d=this.findOAuthInfo(c.portalUrl);d&&b.splice(b.indexOf(d),1)}this.oAuthInfos=b.concat(a)}else this.oAuthInfos=a}registerToken(a){a={...a};const b=this._sanitizeUrl(a.server),c=this._isServerRsrc(b);let d=this.findServerInfo(b),g=!0,m;d||(d=new ba,d.server=this._getServerInstanceRoot(b),c?d.hasServer=!0:(d.tokenServiceUrl=
this._getTokenSvcUrl(b),d.hasPortal=!0),this.registerServers([d]));(m=this._findCredential(b))?(delete a.server,Object.assign(m,a),g=!1):(m=new r.Credential({userId:a.userId,server:d.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:c?"server":"portal"}),m.resources=[b],this.credentials.push(m));m.emitTokenChange(!1);g||m.refreshServerTokens()}toJSON(){return T.fixJson({serverInfos:this.serverInfos.map(a=>a.toJSON()),oAuthInfos:this.oAuthInfos.map(a=>a.toJSON()),credentials:this.credentials.map(a=>
a.toJSON())})}initialize(a){if(a){"string"===typeof a&&(a=JSON.parse(a));var b=a.serverInfos,c=a.oAuthInfos;a=a.credentials;if(b){const d=[];b.forEach(g=>{g.server&&g.tokenServiceUrl&&d.push(g.declaredClass?g:new ba(g))});d.length&&this.registerServers(d)}if(c){const d=[];c.forEach(g=>{g.appId&&d.push(g.declaredClass?g:new oa(g))});d.length&&this.registerOAuthInfos(d)}a&&a.forEach(d=>{d.server&&d.token&&d.expires&&d.expires>Date.now()&&(d=d.declaredClass?d:new r.Credential(d),d.emitTokenChange(),
this.credentials.push(d))})}}findServerInfo(a){let b;a=this._sanitizeUrl(a);for(const c of this.serverInfos)if(this._hasSameServerInstance(c.server,a)){b=c;break}return b}findOAuthInfo(a){let b;a=this._sanitizeUrl(a);for(const c of this.oAuthInfos)if(this._hasSameServerInstance(c.portalUrl,a)){b=c;break}return b}findCredential(a,b){if(a){a=this._sanitizeUrl(a);var c=this._isServerRsrc(a)?"server":"portal";if(b)for(const g of this.credentials){if(this._hasSameServerInstance(g.server,a)&&b===g.userId&&
g.scope===c){var d=g;break}}else for(const g of this.credentials)if(this._hasSameServerInstance(g.server,a)&&-1!==this._getIdenticalSvcIdx(a,g)&&g.scope===c){d=g;break}return d}}getCredential(a,b){let c=!0;if(b){var d=!!b.token;var g=b.error;c=!1!==b.prompt}b={...b};a=this._sanitizeUrl(a);const m=new AbortController,u=L.createResolver();if(b.signal)L.onAbort(b.signal,()=>{m.abort()});L.onAbort(m,()=>{u.reject(new N("identity-manager:user-aborted","ABORTED"))});if(L.isAborted(m))return u.promise;b.signal=
m.signal;const x=this._isAdminResource(a);if((d=d?this.findCredential(a):null)&&g&&g.details&&498===g.details.httpStatus)d.destroy();else if(d)return a=new N("identity-manager:not-authorized","You are currently signed in as: '"+d.userId+"'. You do not have access to this resource: "+a,{error:g}),u.reject(a),u.promise;if(g=this._findCredential(a,b))return u.resolve(g),u.promise;let h=this.findServerInfo(a);if(h)!h.hasPortal&&h.server&&h.owningSystemUrl&&this._hasSameServerInstance(h.server,h.owningSystemUrl)&&
(h.hasPortal=!0),!h.hasServer&&this._isServerRsrc(a)&&(h._restInfoPms=this._getTokenSvcUrl(a),h.hasServer=!0);else{g=this._getTokenSvcUrl(a);if(!g)return a=new N("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),u.reject(a),u.promise;h=new ba;h.server=this._getServerInstanceRoot(a);"string"===typeof g?(h.tokenServiceUrl=g,h.hasPortal=!0):(h._restInfoPms=g,h.hasServer=!0);this.registerServers([h])}h.hasPortal&&void 0===h._selfReq&&(c||C.hasSameOrigin(h.tokenServiceUrl,
this._appOrigin)||this._gwDomains.some(t=>t.tokenServiceUrl===h.tokenServiceUrl))&&(h._selfReq={owningTenant:b?.owningTenant,selfDfd:this._getPortalSelf(h.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,h,b,u,x)}getResourceName(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,"$1")||this._gwGroup.test(a)&&
a.replace(this._gwGroup,"$1")||""}generateToken(a,b,c){const d=this._rePortalTokenSvc.test(a.tokenServiceUrl),g=new C.Url(this._appOrigin);var m=a.shortLivedTokenValidity;let u,x,h,t,H,w,M;b&&(M=this.tokenValidity||m||this._defaultTokenValidity,M>m&&0<m&&(M=m));c&&(u=c.isAdmin,x=c.serverUrl,h=c.token,H=c.signal,w=c.ssl,a.customParameters=c.customParameters);u?m=a.adminTokenServiceUrl:(m=a.tokenServiceUrl,t=new C.Url(m.toLowerCase()),a.webTierAuth&&c?.serverUrl&&!w&&"http"===g.scheme&&(C.hasSameOrigin(g.uri,
m,!0)||"https"===t.scheme&&g.host===t.host&&"7080"===g.port&&"7443"===t.port)&&(m=m.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));c={query:{request:"getToken",username:b?.username,password:b?.password,serverUrl:x,token:h,expiration:M,referer:u||d?this._appOrigin:null,client:u?"referer":null,f:"json",...a.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(a,c),signal:H,...c?.ioArgs};d||(c.withCredentials=!1);return P(m,c).then(J=>{J=J.data;if(!J?.token)return new N("identity-manager:authentication-failed",
"Unable to generate token");const z=a.server;sa[z]||(sa[z]={});b&&(sa[z][b.username]=b.password);J.validity=M;return J})}isBusy(){return!!this._busy}checkSignInStatus(a){return this.checkAppAccess(a,"").then(b=>b.credential)}checkAppAccess(a,b,c){let d=!1;return this.getCredential(a,{prompt:!1}).then(g=>{let m;const u={f:"json"};if("portal"===g.scope)if(b&&(this._doPortalSignIn(a)||c?.force))m=g.server+"/sharing/rest/oauth2/validateAppAccess",u.client_id=b;else if(g.token)m=g.server+"/sharing/rest";
else return{credential:g};else if(g.token)m=g.server+"/rest/services";else return{credential:g};g.token&&(u.token=g.token);return P(m,{query:u,authMode:"anonymous"}).then(x=>{if(!1===x.data.valid)throw new N("identity-manager:not-authorized",`You are currently signed in as: '${g.userId}'.`,x.data);d=!!x.data.viewOnlyUserTypeApp;return{credential:g}}).catch(x=>{if("identity-manager:not-authorized"===x.name)throw x;x=x.details?.httpStatus;if(498===x)throw g.destroy(),new N("identity-manager:not-authenticated",
"User is not signed in.");if(400===x)throw new N("identity-manager:invalid-request");return{credential:g}})}).then(g=>({credential:g.credential,viewOnly:d}))}setOAuthResponseHash(a){a&&("#"===a.charAt(0)&&(a=a.substring(1)),this._processOAuthPopupParams(C.queryToObject(a)))}setOAuthRedirectionHandler(a){this._oAuthRedirectFunc=a}setProtocolErrorHandler(a){this._protocolFunc=a}signIn(a,b,c={}){const d=L.createResolver(),g=()=>{x?.remove();h?.remove();t?.remove();u?.destroy();this.dialog?.destroy();
this.dialog=u=x=h=t=null},m=()=>{g();this._oAuthDfd=null;d.reject(new N("identity-manager:user-aborted","ABORTED"))};if(c.signal)L.onAbort(c.signal,()=>{m()});let u=new this.formConstructor;u.resource=this.getResourceName(a);u.server=b.server;this.dialog=new ia;this.dialog.content=u;this.dialog.open=!0;this.emit("dialog-create");let x=u.on("cancel",m),h=da.watch(()=>this.dialog.open,m),t=u.on("submit",H=>{this.generateToken(b,H,{isAdmin:c.isAdmin,signal:c.signal}).then(w=>{g();w=new r.Credential({userId:H.username,
server:b.server,token:w.token,expires:null!=w.expires?Number(w.expires):null,ssl:!!w.ssl,isAdmin:c.isAdmin,validity:w.validity});d.resolve(w)}).catch(w=>{u.error=w;u.signingIn=!1})});return d.promise}oAuthSignIn(a,b,c,d){const g=this._oAuthDfd=L.createResolver();if(d?.signal)L.onAbort(d.signal,()=>{const J=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;J&&!J.closed?J.close():this.dialog&&w()});g.resUrl_=a;g.sinfo_=b;g.oinfo_=c;let m;const u=c._oAuthCred;if(u.storage&&("authorization-code"===c.flowType||
"auto"===c.flowType&&8.4<=b.currentVersion)){let J=crypto.getRandomValues(new Uint8Array(32));m=C.base64UrlEncode(J);u.codeVerifier=m;J=crypto.getRandomValues(new Uint8Array(32));u.stateUID=C.base64UrlEncode(J);u.save()||(u.codeVerifier=m=null)}else u.codeVerifier=null;this._getCodeChallenge(m).then(J=>{const z=!d||!1!==d.oAuthPopupConfirmation;c.popup&&z?(x=new this.formConstructor,x.oAuthPrompt=!0,x.server=b.server,this.dialog=new ia,this.dialog.content=x,this.dialog.open=!0,this.emit("dialog-create"),
h=x.on("cancel",w),t=da.watch(()=>this.dialog.open,w),H=x.on("submit",()=>{M();this._doOAuthSignIn(a,b,c,J)})):this._doOAuthSignIn(a,b,c,J)});let x,h,t,H;const w=()=>{M();this._oAuthDfd=null;g.reject(new N("identity-manager:user-aborted","ABORTED"))},M=()=>{h?.remove();t?.remove();H?.remove();x?.destroy();this.dialog?.destroy();this.dialog=null};return g.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(a=>{a.destroy()});this.emit("credentials-destroy")}enablePostMessageAuth(a=
"https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove();this._postMessageAuthHandle=Z.on(window,"message",b=>{if((b.origin===this._appOrigin||b.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===b.data?.type){const c=b.source;this.getCredential(a).then(d=>{c.postMessage({type:"arcgis:auth:credential",credential:{expires:d.expires,server:d.server,ssl:d.ssl,token:d.token,userId:d.userId}},b.origin)}).catch(d=>{c.postMessage({type:"arcgis:auth:error",
error:{name:d.name,message:d.message}},b.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&(a=a.substring(1));a=C.queryToObject(a);var b=!1;if(a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username"))try{a.state=JSON.parse(a.state),a.state.portalUrl&&(this._oAuthLocationParams=a,b=!0)}catch{}else if(a.error&&a.error_description&&
(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0,a.state)))try{a.state=JSON.parse(a.state)}catch{}b&&(window.location.hash=a.state?.hash||"")}if(a=window.location.search){"?"===a.charAt(0)&&(a=a.substring(1));a=C.queryToObject(a);b=!1;if(a.code&&a.state)try{a.state=JSON.parse(a.state),a.state.portalUrl&&a.state.uid&&(this._oAuthLocationParams=a,b=!0)}catch{}else if(a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",
a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0,a.state)))try{a.state=JSON.parse(a.state)}catch{}if(b){const c={...a};"code error error_description message_code persist state".split(" ").forEach(d=>{delete c[d]});b=C.objectToQuery(c);window.history.replaceState(window.history.state,"",window.location.pathname+(b?`?${b}`:"")+(a.state?.hash||""))}}}_getOAuthToken(a,b,c,d,g){a=a.replace(/^http:/i,"https:");return P(`${a}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",
query:d&&g?{grant_type:"authorization_code",code:b,redirect_uri:d,client_id:c,code_verifier:g}:{grant_type:"refresh_token",refresh_token:b,client_id:c}}).then(m=>m.data)}_getCodeChallenge(a){return a&&globalThis.isSecureContext?(a=(new TextEncoder).encode(a),crypto.subtle.digest("SHA-256",a).then(b=>C.base64UrlEncode(new Uint8Array(b)))):Promise.resolve(null)}_pageShowHandler(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new N("identity-manager:user-aborted","ABORTED"),this._errbackFunc(a))}_findCredential(a,
b){let c=-1,d,g,m;const u=b?.token;b=b?.resource;const x=this._isServerRsrc(a)?"server":"portal",h=this.credentials.filter(t=>this._hasSameServerInstance(t.server,a)&&t.scope===x);a=b||a;if(h.length)if(1===h.length)if(b=h[0],g=this.findServerInfo(b.server),m=(d=g?.owningSystemUrl)?this.findCredential(d,b.userId):void 0,c=this._getIdenticalSvcIdx(a,b),u)-1!==c&&(b.resources.splice(c,1),this._removeResource(a,m));else return-1===c&&b.resources.push(a),this._addResource(a,m),b;else{let t,H;h.some(w=>
{H=this._getIdenticalSvcIdx(a,w);return-1!==H?(t=w,g=this.findServerInfo(t.server),m=(d=g?.owningSystemUrl)?this.findCredential(d,t.userId):void 0,c=H,!0):!1});if(u)t&&(t.resources.splice(c,1),this._removeResource(a,m));else if(t)return this._addResource(a,m),t}}_findOAuthInfo(a){let b=this.findOAuthInfo(a);if(!b)for(const c of this.oAuthInfos)if(this._isIdProvider(c.portalUrl,a)){b=c;break}return b}_addResource(a,b){b&&-1===this._getIdenticalSvcIdx(a,b)&&b.resources.push(a)}_removeResource(a,b){let c=
-1;b&&(c=this._getIdenticalSvcIdx(a,b),-1<c&&b.resources.splice(c,1))}_useProxy(a,b){return b?.isAdmin&&!C.hasSameOrigin(a.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!C.hasSameOrigin(a.tokenServiceUrl,this._appOrigin)}_getOrigin(a){a=new C.Url(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")}_getServerInstanceRoot(a){const b=a.toLowerCase();let c=b.indexOf(this._agsRest);-1===c&&this._isAdminResource(a)&&(c=this._agsAdmin.test(a)?
a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1!==c||wa.isSecureProxyService(b)||(c=b.indexOf("/sharing"));-1===c&&"/"===b.substr(-1)&&(c=b.length-1);return-1<c?a.substring(0,c):a}_hasSameServerInstance(a,b){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();b=this._getServerInstanceRoot(b).toLowerCase();a=this._normalizeAGOLorgDomain(a);b=this._normalizeAGOLorgDomain(b);a=a.substr(a.indexOf(":"));b=b.substr(b.indexOf(":"));return a===b}_normalizeAGOLorgDomain(a){const b=
/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,c=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,d=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;b.test(a)?a=a.replace(b,"https://www.arcgis.com"):c.test(a)?a=a.replace(c,"https://devext.arcgis.com"):d.test(a)&&(a=a.replace(d,"https://qaext.arcgis.com"));return a}_sanitizeUrl(a){const b=(q.request.proxyUrl||"").toLowerCase(),c=b?a.toLowerCase().indexOf(b+"?"):-1;-1!==c&&(a=a.substring(c+b.length+1));a=C.normalize(a);return C.urlToObject(a).path}_isRESTService(a){return a.includes(this._agsRest)}_isAdminResource(a){return this._agsAdmin.test(a)||
this._adminSvcs.test(a)}_isServerRsrc(a){return this._isRESTService(a)||this._isAdminResource(a)}_isIdenticalService(a,b){var c=!1;this._isRESTService(a)&&this._isRESTService(b)?(a=this._getSuffix(a).toLowerCase(),b=this._getSuffix(b).toLowerCase(),c=a===b,c||(c=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi,c=a.replaceAll(c,"$1")===b.replaceAll(c,"$1"))):this._isAdminResource(a)&&this._isAdminResource(b)?c=!0:this._isServerRsrc(a)||this._isServerRsrc(b)||!this._isPortalDomain(a)||(c=
!0);return c}_isPortalDomain(a){const b=new C.Url(a.toLowerCase());a=this._portalConfig;let c=this._gwDomains.some(d=>d.regex.test(b.uri));!c&&a&&(c=this._hasSameServerInstance(this._getServerInstanceRoot(a.restBaseUrl),b.uri));c||q.portalUrl&&(c=C.hasSameOrigin(b,q.portalUrl,!0));c||(c=this._portals.some(d=>this._hasSameServerInstance(d,b.uri)));return c=c||this._agsPortal.test(b.path)}_isIdProvider(a,b){let c=-1,d=-1;this._gwDomains.forEach((m,u)=>{-1===c&&m.regex.test(a)&&(c=u);-1===d&&m.regex.test(b)&&
(d=u)});let g=!1;if(-1<c&&-1<d)if(0===c||4===c){if(0===d||4===d)g=!0}else if(1===c){if(1===d||2===d)g=!0}else 2===c?2===d&&(g=!0):3===c&&3===d&&(g=!0);if(!g){const m=this.findServerInfo(b),u=m?.owningSystemUrl;u&&Da(m)&&this._isPortalDomain(u)&&this._isIdProvider(a,u)&&(g=!0)}return g}_getIdenticalSvcIdx(a,b){let c=-1;for(let d=0;d<b.resources.length;d++)if(this._isIdenticalService(a,b.resources[d])){c=d;break}return c}_getSuffix(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,
"$1")}_getTokenSvcUrl(a){if(this._isRESTService(a)||this._isAdminResource(a)){var b=this._getServerInstanceRoot(a);var c=b+"/admin/generateToken";a=b+"/rest/info";b=P(a,{query:{f:"json"}}).then(d=>d.data);return{adminUrl:c,promise:b}}if(this._isPortalDomain(a)){let d="";this._gwDomains.some(g=>{g.regex.test(a)&&(d=g.tokenServiceUrl);return!!d});d||this._portals.some(g=>{this._hasSameServerInstance(g,a)&&(d=g+this._gwTokenUrl);return!!d});d||(c=a.toLowerCase().indexOf("/sharing"),-1!==c&&(d=a.substring(0,
c)+this._gwTokenUrl));d||(d=this._getOrigin(a)+this._gwTokenUrl);d&&(c=(new C.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===c&&(d=d.replace(/:7080/i,":7443")),d=d.replace(/http:/i,"https:"));return d}if(a.toLowerCase().includes("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_processOAuthResponseParams(a,b,c){const d=b._oAuthCred;if(a.code){var g=d.codeVerifier;d.codeVerifier=null;d.stateUID=null;d.save();return this._getOAuthToken(c.server,a.code,b.appId,this._getRedirectURI(b,
!0),g).then(m=>{const u=new r.Credential({userId:m.username,server:c.server,token:m.access_token,expires:Date.now()+1E3*m.expires_in,ssl:m.ssl,oAuthState:a.state,_oAuthCred:d});b.userId=u.userId;d.storage=m.persist?pa:ta;d.refreshToken=m.refresh_token;d.token=null;d.expires=m.refresh_token_expires_in?Date.now()+1E3*m.refresh_token_expires_in:null;d.userId=u.userId;d.ssl=u.ssl;d.save();return u})}g=new r.Credential({userId:a.username,server:c.server,token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),
ssl:"true"===a.ssl,oAuthState:a.state,_oAuthCred:d});b.userId=g.userId;d.storage=a.persist?pa:ta;d.refreshToken=null;d.token=g.token;d.expires=g.expires;d.userId=g.userId;d.ssl=g.ssl;d.save();return Promise.resolve(g)}_processOAuthPopupParams(a){const b=this._oAuthDfd;this._oAuthDfd=null;if(b)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),a.error){const c="access_denied"===a.error;a=new N(c?"identity-manager:user-aborted":"identity-manager:authentication-failed",c?"ABORTED":
"OAuth: "+a.error+" - "+a.error_description);b.reject(a)}else this._processOAuthResponseParams(a,b.oinfo_,b.sinfo_).then(c=>{b.resolve(c)}).catch(c=>{b.reject(c)})}_setOAuthResponseQueryString(a){a&&("?"===a.charAt(0)&&(a=a.substring(1)),this._processOAuthPopupParams(C.queryToObject(a)))}_exchangeToken(a,b,c){return P(`${a}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:b,token:c}}).then(d=>d.data.token)}_getPlatformSelf(a,b){a=a.replace(/^http:/i,
"https:");return P(`${a}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":b,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then(c=>c.data)}_getPortalSelf(a,b){let c;this._gwDomains.some(d=>{d.regex.test(a)&&(c=d.customBaseUrl);return!!c});if(c)return Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:c,portalMode:"multitenant",supportsOAuth:!0});this._appOrigin.startsWith("https:")?
a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(b)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return P(a,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(d=>d.data)}_doPortalSignIn(a){const b=this._portalConfig,c=window.location.href,d=this.findServerInfo(a);return(b||this._isPortalDomain(c))&&(d?d.hasPortal||d.owningSystemUrl&&this._isPortalDomain(d.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(c,a)||b&&(this._hasSameServerInstance(this._getServerInstanceRoot(b.restBaseUrl),
a)||this._isIdProvider(b.restBaseUrl,a))||C.hasSameOrigin(c,a,!0))?!0:!1}_checkProtocol(a,b,c,d){let g=!0;d=d?b.adminTokenServiceUrl:b.tokenServiceUrl;d.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&C.getProxyRule(d)&&(g=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:b}):!1,g||(a=new N("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),c(a)));return g}_enqueue(a,b,c,d,g,m){d||(d=L.createResolver());
d.resUrl_=a;d.sinfo_=b;d.options_=c;d.admin_=g;d.refresh_=m;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(d)):this._xoReqs.push(d):this._doSignIn(d);return d.promise}_doSignIn(a){this._busy=a;this._rejectOnPersistedPageShow=!1;const b=h=>{var t=a.options_?.resource;const H=a.resUrl_,w=a.refresh_;let M=!1;this.credentials.includes(h)||(w&&this.credentials.includes(w)?
(w.userId=h.userId,w.token=h.token,w.expires=h.expires,w.validity=h.validity,w.ssl=h.ssl,w.creationTime=h.creationTime,M=!0,h=w):this.credentials.push(h));h.resources||(h.resources=[]);h.resources.includes(t||H)||h.resources.push(t||H);h.scope=this._isServerRsrc(H)?"server":"portal";h.emitTokenChange();t=this._soReqs;const J={};this._soReqs=[];t.forEach(z=>{if(!this._isIdenticalService(H,z.resUrl_)){const R=this._getSuffix(z.resUrl_);J[R]||(J[R]=!0,h.resources.push(z.resUrl_))}});a.resolve(h);t.forEach(z=>
{this._hasSameServerInstance(this._getServerInstanceRoot(H),z.resUrl_)?z.resolve(h):this._soReqs.push(z)});this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;M||this.emit("credential-create",{credential:h});this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},c=h=>{a.reject(h);this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},d=(h,
t,H,w)=>{const M=a.sinfo_,J=!a.options_||!1!==a.options_.prompt,z=M.hasPortal&&this._findOAuthInfo(a.resUrl_);let R,ua;if(h)b(new r.Credential({userId:h,server:M.server,token:H||null,expires:null!=w?Number(w):null,ssl:!!t}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),a.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},
this._appUrlObj.query["arcgis-auth-origin"]);const A=Z.on(window,"message",D=>{D.source===window.parent&&D.data&&("arcgis:auth:credential"===D.data.type?(A.remove(),D.data.credential.expires<Date.now()?c(new N("identity-manager:credential-request-failed","Parent application's token has expired.")):b(new r.Credential(D.data.credential))):"arcgis:auth:error"===D.data.type&&(A.remove(),"tokenExpiredError"===D.data.error.name?c(new N("identity-manager:credential-request-failed","Parent application's token has expired.")):
c(N.fromJSON(D.data.error))))});L.onAbort(a.options_?.signal,()=>{A.remove()})}else if(z){let A=z._oAuthCred;A||(h=new na(z,pa),t=new na(z,ta),h.isValid()&&t.isValid()?h.expires>t.expires?(A=h,t.destroy()):(A=t,h.destroy()):A=h.isValid()?h:t,z._oAuthCred=A);if(A.isValid()){R=new r.Credential({userId:A.userId,server:M.server,token:A.token,expires:A.expires,ssl:A.ssl,_oAuthCred:A});const D=z.appId!==A.appId&&this._doPortalSignIn(a.resUrl_);D||A.refreshToken?(a._pendingDfd=A.refreshToken?this._getOAuthToken(M.server,
A.refreshToken,A.appId).then(l=>{R.expires=Date.now()+1E3*l.expires_in;R.token=l.access_token;return R}):Promise.resolve(R),a._pendingDfd.then(l=>D?this._exchangeToken(l.server,z.appId,l.token).then(e=>{l.token=e;return l}).catch(()=>l):l).then(l=>{b(l)}).catch(()=>{A?.destroy();d()})):b(R)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(z.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===
A.stateUID&&A.codeVerifier))h=this._oAuthLocationParams,this._oAuthLocationParams=null,a._pendingDfd=this._processOAuthResponseParams(h,z,M).then(D=>{b(D)}).catch(c);else{const D=()=>{J?a._pendingDfd=this.oAuthSignIn(a.resUrl_,M,z,a.options_).then(b,c):(ua=new N("identity-manager:not-authenticated","User is not signed in."),c(ua))};this._doPortalSignIn(a.resUrl_)?a._pendingDfd=this._getPlatformSelf(M.server,z.appId).then(l=>{C.hasSameOrigin(l.portalUrl,this._appOrigin,!0)?(R=new r.Credential({userId:l.username,
server:M.server,expires:Date.now()+1E3*l.expires_in,token:l.token}),b(R)):D()}).catch(D):D()}}else J?this._checkProtocol(a.resUrl_,M,c,a.admin_)&&(h=a.options_,a.admin_&&(h=h||{},h.isAdmin=!0),a._pendingDfd=this.signIn(a.resUrl_,M,h).then(b,c)):(ua=new N("identity-manager:not-authenticated","User is not signed in."),c(ua))},g=()=>{const h=a.sinfo_;var t=h.owningSystemUrl;const H=a.options_;let w,M,J,z;H&&(w=H.token,M=H.error,J=H.prompt);z=this._findCredential(t,{token:w,resource:a.resUrl_});if(!z)for(const R of this.credentials)if(this._isIdProvider(t,
R.server)){z=R;break}z?(t=this.findCredential(a.resUrl_,z.userId))?b(t):xa(h,this._legacyFed)?(t=z.toJSON(),t.server=h.server,t.resources=null,b(new r.Credential(t))):(a._pendingDfd=this.generateToken(this.findServerInfo(z.server),null,{serverUrl:a.resUrl_,token:z.token,signal:a.options_.signal,ssl:z.ssl})).then(R=>{b(new r.Credential({userId:z?.userId,server:h.server,token:R.token,expires:null!=R.expires?Number(R.expires):null,ssl:!!R.ssl,isAdmin:a.admin_,validity:R.validity}))},c):(this._busy=null,
w&&(a.options_.token=null),(a._pendingDfd=this.getCredential(t.replace(/\/?$/,"/sharing"),{resource:a.resUrl_,owningTenant:h.owningTenant,signal:a.options_.signal,token:w,error:M,prompt:J})).then(()=>{this._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},R=>{a.resUrl_=a.sinfo_=a.refresh_=null;a.reject(R)}))};this._errbackFunc=c;const m=a.sinfo_.owningSystemUrl,u=this._isServerRsrc(a.resUrl_),x=a.sinfo_._restInfoPms;x?x.promise.then(h=>{const t=a.sinfo_;t._restInfoPms&&(t.adminTokenServiceUrl=t._restInfoPms.adminUrl,
t._restInfoPms=null,t.tokenServiceUrl=(ka.getDeepValue("authInfo.tokenServicesUrl",h)||ka.getDeepValue("authInfo.tokenServiceUrl",h)||ka.getDeepValue("tokenServiceUrl",h))??null,t.shortLivedTokenValidity=ka.getDeepValue("authInfo.shortLivedTokenValidity",h)??null,t.currentVersion=h.currentVersion,t.owningTenant=h.owningTenant,(h=t.owningSystemUrl=h.owningSystemUrl)&&this._portals.push(h));u&&t.owningSystemUrl?g():d()},()=>{a.sinfo_._restInfoPms=null;const h=new N("identity-manager:server-identification-failed",
"Unknown resource - could not find token service endpoint.");c(h)}):u&&m?g():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(h=>{const t={};let H,w,M,J;h&&(H=h.user?.username,t.username=H,t.allSSL=h.allSSL,w=h.supportsOAuth,J=parseFloat(h.currentVersion),"multitenant"===h.portalMode&&(M=h.customBaseUrl),a.sinfo_.currentVersion=J);a.sinfo_.webTierAuth=!!H;return H&&this.normalizeWebTierAuth?this.generateToken(a.sinfo_,null,{ssl:t.allSSL}).catch(()=>null).then(z=>{t.portalToken=z&&z.token;t.tokenExpiration=
z&&z.expires;return t}):!H&&w&&4.4<=J&&!this._findOAuthInfo(a.resUrl_)?this._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:M,owningTenant:a.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>t):t}).catch(()=>null).then(h=>{a.sinfo_._selfReq=null;h?d(h.username,h.allSSL,h.portalToken,h.tokenExpiration):d()}):d()}_generateOAuthInfo(a){let b=null,c=a.portalUrl;const d=a.customBaseUrl,g=a.owningTenant;if(a=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){b=
window.location.href;let m=b.indexOf("?");-1<m&&(b=b.slice(0,m));m=b.search(/\/(apps|home)\//);b=-1<m?b.slice(0,m):null}a&&b?(this._hasTestedIfAppIsOnPortal=!0,a=P(b+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new oa({appId:"arcgisonline",popupCallbackUrl:b+"/home/oauth-callback.html"})})):a=Promise.resolve();return a.then(()=>{if(this._defaultOAuthInfo)return c=c.replace(/^http:/i,"https:"),P(c+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:g,client_id:this._defaultOAuthInfo.appId,
redirect_uri:C.makeAbsolute(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(m=>{if(m.data.valid){const u=this._defaultOAuthInfo.clone();u.portalUrl=m.data.urlKey&&d?"https://"+m.data.urlKey.toLowerCase()+"."+d:c;u.popup=window!==window.top||!(C.hasSameOrigin(c,this._appOrigin)||this._gwDomains.some(x=>x.regex.test(c)&&x.regex.test(this._appOrigin)));this.oAuthInfos.push(u)}})})}_doOAuthSignIn(a,b,c,d){var g=c._oAuthCred,m={portalUrl:c.portalUrl};!c.popup&&c.preserveUrlHash&&window.location.hash&&
(m.hash=window.location.hash);g.stateUID&&(m.uid=g.stateUID);m={client_id:c.appId,response_type:g.codeVerifier?"code":"token",state:JSON.stringify(m),expiration:c.expiration,locale:c.locale,redirect_uri:this._getRedirectURI(c,!!g.codeVerifier)};c.forceLogin&&(m.force_login=!0);c.forceUserId&&c.userId&&(m.prepopulatedusername=c.userId);!c.popup&&this._doPortalSignIn(a)&&(m.redirectToUserOrgUrl=!0);g.codeVerifier&&(m.code_challenge=d||g.codeVerifier,m.code_challenge_method=d?"S256":"plain");d=c.portalUrl.replace(/^http:/i,
"https:")+"/sharing/oauth2/authorize";g=d+"?"+C.objectToQuery(m);if(c.popup){const u=window.open(g,"esriJSAPIOAuth",c.popupWindowFeatures);u?(u.focus(),this._oAuthDfd.oAuthWin_=u,this._oAuthIntervalId=setInterval(()=>{if(u.closed){clearInterval(this._oAuthIntervalId);this._oAuthOnPopupHandle.remove();const x=this._oAuthDfd;if(x){const h=new N("identity-manager:user-aborted","ABORTED");x.reject(h)}}},500),this._oAuthOnPopupHandle=Z.on(window,["arcgis:auth:hash","arcgis:auth:location:search"],x=>{"arcgis:auth:hash"===
x.type?this.setOAuthResponseHash(x.detail):this._setOAuthResponseQueryString(x.detail)})):(a=new N("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:m,authorizeUrl:d,resourceUrl:a,serverInfo:b,oAuthInfo:c}):window.location.href=g}_getRedirectURI(a,b){const c=window.location.href.replace(/#.*$/,"");if(a.popup)return C.makeAbsolute(a.popupCallbackUrl);if(b){const d=C.urlToObject(c);
d.query&&"code error error_description message_code persist state".split(" ").forEach(g=>{delete d.query[g]});return C.addQueryParameters(d.path,d.query)}return c}}qa.prototype.declaredClass="esri.identity.IdentityManagerBase";r.Credential=class extends ha.EventedAccessor{constructor(a){super(a);this._oAuthCred=null;this.tokenRefreshBuffer=2;a?._oAuthCred&&(this._oAuthCred=a._oAuthCred)}initialize(){this.resources=this.resources||[];null==this.creationTime&&(this.creationTime=Date.now())}refreshToken(){const a=
F.id.findServerInfo(this.server),b=a?.owningSystemUrl,c=!!b&&"server"===this.scope,d=c&&xa(a,F.id._legacyFed);var g=a.webTierAuth;const m=g&&F.id.normalizeWebTierAuth,u=sa[this.server]?.[this.userId];let x=this.resources&&this.resources[0],h=c?F.id.findServerInfo(b):null,t={username:this.userId,password:u},H;if(!g||m)if(c&&!h&&F.id.serverInfos.some(w=>{F.id._isIdProvider(b,w.server)&&(h=w);return!!h}),g=h?F.id.findCredential(h.server,this.userId):null,!c||g)if(d)g?.refreshToken();else{if(c)H={serverUrl:x,
token:g?.token,ssl:g&&g.ssl};else if(m)t=null,H={ssl:this.ssl};else if(u)this.isAdmin&&(H={isAdmin:!0});else{let w;x&&(x=F.id._sanitizeUrl(x),this._enqueued=1,w=F.id._enqueue(x,a,null,null,this.isAdmin,this),w.then(()=>{this._enqueued=0;this.refreshServerTokens()}).catch(()=>{this._enqueued=0}));return w}return F.id.generateToken(c?h:a,c?null:t,H).then(w=>{this.token=w.token;this.expires=null!=w.expires?Number(w.expires):null;this.creationTime=Date.now();this.validity=w.validity;this.emitTokenChange();
this.refreshServerTokens()}).catch(()=>{})}}refreshServerTokens(){"portal"===this.scope&&F.id.credentials.forEach(a=>{const b=F.id.findServerInfo(a.server),c=b?.owningSystemUrl;a!==this&&a.userId===this.userId&&c&&"server"===a.scope&&(F.id._hasSameServerInstance(this.server,c)||F.id._isIdProvider(c,this.server))&&(xa(b,F.id._legacyFed)?(a.token=this.token,a.expires=this.expires,a.creationTime=this.creationTime,a.validity=this.validity,a.emitTokenChange()):a.refreshToken())})}emitTokenChange(a){clearTimeout(this._refreshTimer);
const b=(this.server?F.id.findServerInfo(this.server):null)?.owningSystemUrl,c=b?F.id.findServerInfo(b):null;!1===a||b&&"portal"!==this.scope&&(!c?.webTierAuth||F.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const a=F.id.credentials.indexOf(this);-1<a&&
F.id.credentials.splice(a,1);this.emitTokenChange();this.emit("destroy")}toJSON(){const a=T.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),b=this.resources;b&&0<b.length&&(a.resources=b.slice());return a}_startRefreshTimer(){clearTimeout(this._refreshTimer);const a=6E4*this.tokenRefreshBuffer,b=2**31-1;let c=(this.validity?this.creationTime+6E4*this.validity:
this.expires)-Date.now();0>c?c=0:c>b&&(c=b);this._refreshTimer=setTimeout(this.refreshToken.bind(this),c>a?c-a:c)}};p.__decorate([U.property()],r.Credential.prototype,"creationTime",void 0);p.__decorate([U.property()],r.Credential.prototype,"expires",void 0);p.__decorate([U.property()],r.Credential.prototype,"isAdmin",void 0);p.__decorate([U.property()],r.Credential.prototype,"oAuthState",void 0);p.__decorate([U.property()],r.Credential.prototype,"resources",void 0);p.__decorate([U.property()],r.Credential.prototype,
"scope",void 0);p.__decorate([U.property()],r.Credential.prototype,"server",void 0);p.__decorate([U.property()],r.Credential.prototype,"ssl",void 0);p.__decorate([U.property()],r.Credential.prototype,"token",void 0);p.__decorate([U.property()],r.Credential.prototype,"tokenRefreshBuffer",void 0);p.__decorate([U.property()],r.Credential.prototype,"userId",void 0);p.__decorate([U.property()],r.Credential.prototype,"validity",void 0);r.Credential=p.__decorate([aa.subclass("esri.identity.Credential")],
r.Credential);r.IdentityManagerBase=qa;Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})})},"esri/identity/IdentityForm":function(){define("../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../intl/substitute ../widgets/Widget ../widgets/support/widgetUtils ../widgets/support/decorators/messageBundle ../widgets/support/jsxFactory".split(" "),function(r,p,q,F,P,N,ha,
Z,T,ka,L){q=class extends Z{constructor(da,C){super(da,C);this._passwordInputNode=this._usernameInputNode=null;this.signingIn=!1;this.error=this.resource=this.server=null;this.oAuthPrompt=!1}render(){const {error:da,server:C,resource:U,signingIn:la,oAuthPrompt:aa,messages:V}=this,ia=L.tsx("div",{class:"esri-identity-form__group"},ha.substitute(aa?V.oAuthInfo:V.info,{server:C&&/\.arcgis\.com/i.test(C)?"ArcGIS Online":C,resource:`(${U||V.lblItem})`})),na=aa?null:L.tsx("div",{class:"esri-identity-form__group",
key:"username"},L.tsx("label",{class:"esri-identity-form__label"},V.lblUser,L.tsx("input",{afterCreate:T.storeNode,autocomplete:"off",bind:this,class:"esri-input","data-node-ref":"_usernameInputNode",required:!0,spellcheck:!1,type:"text",value:""}))),oa=aa?null:L.tsx("div",{class:"esri-identity-form__group",key:"password"},L.tsx("label",{class:"esri-identity-form__label"},V.lblPwd,L.tsx("input",{afterCreate:T.storeNode,bind:this,class:"esri-input","data-node-ref":"_passwordInputNode",required:!0,
type:"password",value:""}))),ba=L.tsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},L.tsx("input",{class:"esri-button",disabled:!!la,type:"submit",value:la?V.lblSigning:V.lblOk}),L.tsx("input",{bind:this,class:this.classes("esri-button","esri-button--secondary"),onclick:this._cancel,type:"button",value:V.lblCancel})),wa=da?L.tsx("div",null,da.details?.httpStatus?V.invalidUser:V.noAuthService):null;return L.tsx("form",{bind:this,class:"esri-identity-form",onsubmit:this._submit},
ia,wa,na,oa,ba)}_cancel(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")}_submit(da){da.preventDefault();this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})}};r.__decorate([p.property(),ka.messageBundle("esri/identity/t9n/identity")],q.prototype,
"messages",void 0);r.__decorate([p.property()],q.prototype,"signingIn",void 0);r.__decorate([p.property()],q.prototype,"server",void 0);r.__decorate([p.property()],q.prototype,"resource",void 0);r.__decorate([p.property()],q.prototype,"error",void 0);r.__decorate([p.property()],q.prototype,"oAuthPrompt",void 0);return q=r.__decorate([N.subclass("esri.identity.IdentityForm")],q)})},"esri/identity/IdentityModal":function(){define("../chunks/tslib.es6 ../core/handleUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../widgets/Widget ../widgets/support/widget ../widgets/support/jsxFactory ../widgets/support/decorators/messageBundle".split(" "),
function(r,p,q,F,P,N,ha,Z,T,ka,L,da){function C(A,D){var l=Object.keys(A);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(A);D&&(e=e.filter(function(k){return Object.getOwnPropertyDescriptor(A,k).enumerable}));l.push.apply(l,e)}return l}function U(A){for(var D=1;D<arguments.length;D++){var l=null!=arguments[D]?arguments[D]:{};D%2?C(Object(l),!0).forEach(function(e){var k=l[e];a:if("object"===typeof e&&null!==e){var v=e[Symbol.toPrimitive];if(void 0!==v){e=v.call(e,"string");if("object"!==
typeof e)break a;throw new TypeError("@@toPrimitive must return a primitive value.");}e=String(e)}e="symbol"===typeof e?e:String(e);e in A?Object.defineProperty(A,e,{value:k,enumerable:!0,configurable:!0,writable:!0}):A[e]=k}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(l)):C(Object(l)).forEach(function(e){Object.defineProperty(A,e,Object.getOwnPropertyDescriptor(l,e))})}return A}P='input:not([inert]) select:not([inert]) textarea:not([inert]) a[href]:not([inert]) button:not([inert]) [tabindex]:not(slot):not([inert]) audio[controls]:not([inert]) video[controls]:not([inert]) [contenteditable]:not([contenteditable\x3d"false"]):not([inert]) details\x3esummary:first-of-type:not([inert]) details:not([inert])'.split(" ");
var la=P.join(","),aa=(N="undefined"===typeof Element)?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,V=!N&&Element.prototype.getRootNode?function(A){var D;return null===A||void 0===A?void 0:null===(D=A.getRootNode)||void 0===D?void 0:D.call(A)}:function(A){return null===A||void 0===A?void 0:A.ownerDocument},ia=function e(D,l){var k;void 0===l&&(l=!0);var v=null===D||void 0===D?void 0:null===(k=D.getAttribute)||void 0===k?void 0:
k.call(D,"inert");return""===v||"true"===v||l&&D&&e(D.parentNode)},na=function(D,l,e){if(ia(D))return[];var k=Array.prototype.slice.apply(D.querySelectorAll(la));l&&aa.call(D,la)&&k.unshift(D);return k=k.filter(e)},oa=function v(l,e,k){for(var B=[],y=Array.from(l);y.length;){var E=y.shift();if(!ia(E,!1))if("SLOT"===E.tagName){var K=E.assignedElements();K=v(K.length?K:E.children,!0,k);k.flatten?B.push.apply(B,K):B.push({scopeParent:E,candidates:K})}else{aa.call(E,la)&&k.filter(E)&&(e||!l.includes(E))&&
B.push(E);K=E.shadowRoot||"function"===typeof k.getShadowRoot&&k.getShadowRoot(E);var Q=!ia(K,!1)&&(!k.shadowRootFilter||k.shadowRootFilter(E));K&&Q?(K=v(!0===K?E.children:K.children,!0,k),k.flatten?B.push.apply(B,K):B.push({scopeParent:E,candidates:K})):y.unshift.apply(y,E.children)}}return B},ba=function(l){if(!l)throw Error("No node provided");if(0>l.tabIndex){var e;if(!(e=/^(AUDIO|VIDEO|DETAILS)$/.test(l.tagName))){var k;e=null===l||void 0===l?void 0:null===(k=l.getAttribute)||void 0===k?void 0:
k.call(l,"contenteditable");e=""===e||"true"===e}if(e&&isNaN(parseInt(l.getAttribute("tabindex"),10)))return 0}return l.tabIndex},wa=function(l,e){return l.tabIndex===e.tabIndex?l.documentOrder-e.documentOrder:l.tabIndex-e.tabIndex},sa=function(l){return"DETAILS"===l.tagName&&Array.prototype.slice.apply(l.children).some(function(e){return"SUMMARY"===e.tagName})},Da=function(l,e){for(var k=0;k<l.length;k++)if(l[k].checked&&l[k].form===e)return l[k]},xa=function(l){if(!l.name)return!0;var e=l.form||
V(l),k=function(B){return e.querySelectorAll('input[type\x3d"radio"][name\x3d"'+B+'"]')};if("undefined"!==typeof window&&"undefined"!==typeof window.CSS&&"function"===typeof window.CSS.escape)var v=k(window.CSS.escape(l.name));else try{v=k(l.name)}catch(B){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",B.message),!1}k=Da(v,l.form);return!k||k===l},pa=function(l){l=l.getBoundingClientRect();
var e=l.height;return 0===l.width&&0===e},ta=function(l,e){var k=e.displayCheck;e=e.getShadowRoot;if("hidden"===getComputedStyle(l).visibility)return!0;var v=aa.call(l,"details\x3esummary:first-of-type")?l.parentElement:l;if(aa.call(v,"details:not([open]) *"))return!0;if(!k||"full"===k||"legacy-full"===k){if("function"===typeof e){for(v=l;l;){var B=l.parentElement,y=V(l);if(B&&!B.shadowRoot&&!0===e(B))return pa(l);l=l.assignedSlot?l.assignedSlot:B||y===l.ownerDocument?B:y.host}l=v}e=l;var E;v=e&&
V(e);B=null===(E=v)||void 0===E?void 0:E.host;E=!1;if(v&&v!==e){var K,Q,W;for(E=!!(null!==(K=B)&&void 0!==K&&null!==(Q=K.ownerDocument)&&void 0!==Q&&Q.contains(B)||null!==e&&void 0!==e&&null!==(W=e.ownerDocument)&&void 0!==W&&W.contains(e));!E&&B;){var S,Y,ca;v=V(B);B=null===(S=v)||void 0===S?void 0:S.host;E=!(null===(Y=B)||void 0===Y||null===(ca=Y.ownerDocument)||void 0===ca||!ca.contains(B))}}if(E)return!l.getClientRects().length;if("legacy-full"!==k)return!0}else if("non-zero-area"===k)return pa(l);
return!1},qa=function(l,e){var k;(k=e.disabled||ia(e))||(k="INPUT"===e.tagName&&"hidden"===e.type);if(!(l=k||ta(e,l)||sa(e)))a:{if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(l=e.parentElement;l;){if("FIELDSET"===l.tagName&&l.disabled){for(k=0;k<l.children.length;k++){var v=l.children.item(k);if("LEGEND"===v.tagName){l=aa.call(l,"fieldset[disabled] *")?!0:!v.contains(e);break a}}l=!0;break a}l=l.parentElement}l=!1}return l?!1:!0},a=function(l,e){return"INPUT"===e.tagName&&"radio"===e.type&&
!xa(e)||0>ba(e)||!qa(l,e)?!1:!0},b=function(l){l=parseInt(l.getAttribute("tabindex"),10);return isNaN(l)||0<=l?!0:!1},c=function k(e){var v=[],B=[];e.forEach(function(y,E){var K=!!y.scopeParent,Q=K?y.scopeParent:y;var W=ba(Q);W=0>W&&K&&isNaN(parseInt(Q.getAttribute("tabindex"),10))?0:W;var S=K?k(y.candidates):Q;0===W?K?v.push.apply(v,S):v.push(Q):B.push({documentOrder:E,tabIndex:W,item:y,isScope:K,content:S})});return B.sort(wa).reduce(function(y,E){E.isScope?y.push.apply(y,E.content):y.push(E.content);
return y},[]).concat(v)},d=function(e,k){k=k||{};e=k.getShadowRoot?oa([e],k.includeContainer,{filter:a.bind(null,k),flatten:!1,getShadowRoot:k.getShadowRoot,shadowRootFilter:b}):na(e,k.includeContainer,a.bind(null,k));return c(e)},g=function(e,k){k=k||{};return k.getShadowRoot?oa([e],k.includeContainer,{filter:qa.bind(null,k),flatten:!0,getShadowRoot:k.getShadowRoot}):na(e,k.includeContainer,qa.bind(null,k))},m=function(e,k){k=k||{};if(!e)throw Error("No node provided");return!1===aa.call(e,la)?!1:
a(k,e)},u=P.concat("iframe").join(","),x=function(e,k){k=k||{};if(!e)throw Error("No node provided");return!1===aa.call(e,u)?!1:qa(k,e)},h={activateTrap:function(e,k){if(0<e.length){var v=e[e.length-1];v!==k&&v.pause()}v=e.indexOf(k);-1!==v&&e.splice(v,1);e.push(k)},deactivateTrap:function(e,k){k=e.indexOf(k);-1!==k&&e.splice(k,1);0<e.length&&e[e.length-1].unpause()}},t=function(e){return"Tab"===(null===e||void 0===e?void 0:e.key)||9===(null===e||void 0===e?void 0:e.keyCode)},H=function(e){return t(e)&&
!e.shiftKey},w=function(e){return t(e)&&e.shiftKey},M=function(e,k){var v=-1;e.every(function(B,y){return k(B)?(v=y,!1):!0});return v},J=function(e){for(var k=arguments.length,v=Array(1<k?k-1:0),B=1;B<k;B++)v[B-1]=arguments[B];return"function"===typeof e?e.apply(void 0,v):e},z=function(e){return e.target.shadowRoot&&"function"===typeof e.composedPath?e.composedPath()[0]:e.target},R=[],ua=function(e,k){var v=(null===k||void 0===k?void 0:k.document)||document,B=(null===k||void 0===k?void 0:k.trapStack)||
R,y=U({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:H,isKeyBackward:w},k),E=[],K=[],Q=[],W=null,S=null,Y=!1,ca=!1,Ga=void 0,Ea=void 0,ea=function(O,f,n){return O&&void 0!==O[f]?O[f]:y[n||f]},va=function(O,f){var n="function"===typeof(null===f||void 0===f?void 0:f.composedPath)?f.composedPath():void 0;return K.findIndex(function(G){var I=G.container;G=G.tabbableNodes;return I.contains(O)||(null===n||void 0===n?void 0:n.includes(I))||G.find(function(X){return X===
O})})},ya=function(O){var f=y[O];if("function"===typeof f){for(var n=arguments.length,G=Array(1<n?n-1:0),I=1;I<n;I++)G[I-1]=arguments[I];f=f.apply(void 0,G)}!0===f&&(f=void 0);if(!f){if(void 0===f||!1===f)return f;throw Error("`".concat(O,"` was specified but was not a node, or did not return a node"));}n=f;if("string"===typeof f&&(n=v.querySelector(f),!n))throw Error("`".concat(O,"` as selector refers to no known node"));return n},za=function(){var O=ya("initialFocus");if(!1===O)return!1;void 0!==
O&&x(O,y.tabbableOptions)||(O=0<=va(v.activeElement)?v.activeElement:(O=Q[0])&&O.firstTabbableNode||ya("fallbackFocus"));if(!O)throw Error("Your focus-trap needs to have at least one focusable element");return O},Ba=function(){K=E.map(function(O){var f=d(O,y.tabbableOptions),n=g(O,y.tabbableOptions),G=0<f.length?f[0]:void 0,I=0<f.length?f[f.length-1]:void 0,X=n.find(function(ja){return m(ja)}),fa=n.slice().reverse().find(function(ja){return m(ja)}),Aa=!!f.find(function(ja){return 0<ba(ja)});return{container:O,
tabbableNodes:f,focusableNodes:n,posTabIndexesFound:Aa,firstTabbableNode:G,lastTabbableNode:I,firstDomTabbableNode:X,lastDomTabbableNode:fa,nextTabbableNode:function(ja){var Ja=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,Ka=f.indexOf(ja);return 0>Ka?Ja?n.slice(n.indexOf(ja)+1).find(function(Ha){return m(Ha)}):n.slice(0,n.indexOf(ja)).reverse().find(function(Ha){return m(Ha)}):f[Ka+(Ja?1:-1)]}}});Q=K.filter(function(O){return 0<O.tabbableNodes.length});if(0>=Q.length&&!ya("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");
if(K.find(function(O){return O.posTabIndexesFound})&&1<K.length)throw Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.");},ra=function n(f){!1!==f&&f!==v.activeElement&&(f&&f.focus?(f.focus({preventScroll:!!y.preventScroll}),S=f,f.tagName&&"input"===f.tagName.toLowerCase()&&"function"===typeof f.select&&f.select()):n(za()))},La=function(f){var n=ya("setReturnFocus",f);
return n?n:!1===n?!1:f},Ma=function(f){var n=f.target,G=f.event;f=f.isBackward;var I=void 0===f?!1:f;n=n||z(G);Ba();f=null;if(0<Q.length){var X=va(n,G),fa=0<=X?K[X]:void 0;0>X?f=I?Q[Q.length-1].lastTabbableNode:Q[0].firstTabbableNode:I?(I=M(Q,function(Aa){return n===Aa.firstTabbableNode}),0>I&&(fa.container===n||x(n,y.tabbableOptions)&&!m(n,y.tabbableOptions)&&!fa.nextTabbableNode(n,!1))&&(I=X),0<=I?(G=Q[0===I?Q.length-1:I-1],f=0<=ba(n)?G.lastTabbableNode:G.lastDomTabbableNode):t(G)||(f=fa.nextTabbableNode(n,
!1))):(I=M(Q,function(Aa){return n===Aa.lastTabbableNode}),0>I&&(fa.container===n||x(n,y.tabbableOptions)&&!m(n,y.tabbableOptions)&&!fa.nextTabbableNode(n))&&(I=X),0<=I?(G=Q[I===Q.length-1?0:I+1],f=0<=ba(n)?G.firstTabbableNode:G.firstDomTabbableNode):t(G)||(f=fa.nextTabbableNode(n)))}else f=ya("fallbackFocus");return f},Fa=function(f){var n=z(f);0<=va(n,f)||(J(y.clickOutsideDeactivates,f)?ma.deactivate({returnFocus:y.returnFocusOnDeactivate}):J(y.allowOutsideClick,f)||f.preventDefault())},Na=function(f){var n=
z(f),G=0<=va(n,f);if(G||n instanceof Document)G&&(S=n);else{f.stopImmediatePropagation();f=!0;if(S)if(0<ba(S)){if(n=va(S),n=K[n].tabbableNodes,0<n.length&&(G=n.findIndex(function(X){return X===S}),0<=G))if(y.isKeyForward(Ea)){if(G+1<n.length){var I=n[G+1];f=!1}}else 0<=G-1&&(I=n[G-1],f=!1)}else K.some(function(X){return X.tabbableNodes.some(function(fa){return 0<ba(fa)})})||(f=!1);else f=!1;f&&(I=Ma({target:S,isBackward:y.isKeyBackward(Ea)}));I?ra(I):ra(S||za())}Ea=void 0},Sa=function(f){var n=1<
arguments.length&&void 0!==arguments[1]?arguments[1]:!1;Ea=f;if(n=Ma({event:f,isBackward:n}))t(f)&&f.preventDefault(),ra(n)},Oa=function(f){"Escape"!==(null===f||void 0===f?void 0:f.key)&&"Esc"!==(null===f||void 0===f?void 0:f.key)&&27!==(null===f||void 0===f?void 0:f.keyCode)||!1===J(y.escapeDeactivates,f)?(y.isKeyForward(f)||y.isKeyBackward(f))&&Sa(f,y.isKeyBackward(f)):(f.preventDefault(),ma.deactivate())},Pa=function(f){var n=z(f);0<=va(n,f)||J(y.clickOutsideDeactivates,f)||J(y.allowOutsideClick,
f)||(f.preventDefault(),f.stopImmediatePropagation())},Qa=function(){if(Y)return h.activateTrap(B,ma),Ga=y.delayInitialFocus?setTimeout(function(){ra(za())},0):ra(za()),v.addEventListener("focusin",Na,!0),v.addEventListener("mousedown",Fa,{capture:!0,passive:!1}),v.addEventListener("touchstart",Fa,{capture:!0,passive:!1}),v.addEventListener("click",Pa,{capture:!0,passive:!1}),v.addEventListener("keydown",Oa,{capture:!0,passive:!1}),ma},Ra=function(){if(Y)return v.removeEventListener("focusin",Na,
!0),v.removeEventListener("mousedown",Fa,!0),v.removeEventListener("touchstart",Fa,!0),v.removeEventListener("click",Pa,!0),v.removeEventListener("keydown",Oa,!0),ma};k=function(f){f.some(function(n){return Array.from(n.removedNodes).some(function(G){return G===S})})&&ra(za())};var Ia="undefined"!==typeof window&&"MutationObserver"in window?new MutationObserver(k):void 0,Ca=function(){Ia&&(Ia.disconnect(),Y&&!ca&&E.map(function(f){Ia.observe(f,{subtree:!0,childList:!0})}))};var ma={get active(){return Y},
get paused(){return ca},activate:function(f){if(Y)return this;var n=ea(f,"onActivate"),G=ea(f,"onPostActivate"),I=ea(f,"checkCanFocusTrap");I||Ba();Y=!0;ca=!1;W=v.activeElement;null===n||void 0===n||n();f=function(){I&&Ba();Qa();Ca();null===G||void 0===G||G()};if(I)return I(E.concat()).then(f,f),this;f();return this},deactivate:function(f){if(!Y)return this;var n=U({onDeactivate:y.onDeactivate,onPostDeactivate:y.onPostDeactivate,checkCanReturnFocus:y.checkCanReturnFocus},f);clearTimeout(Ga);Ga=void 0;
Ra();ca=Y=!1;Ca();h.deactivateTrap(B,ma);var G=ea(n,"onDeactivate"),I=ea(n,"onPostDeactivate");f=ea(n,"checkCanReturnFocus");var X=ea(n,"returnFocus","returnFocusOnDeactivate");null===G||void 0===G||G();n=function(){setTimeout(function(){X&&ra(La(W));null===I||void 0===I||I()},0)};if(X&&f)return f(La(W)).then(n,n),this;n();return this},pause:function(f){if(ca||!Y)return this;var n=ea(f,"onPause");f=ea(f,"onPostPause");ca=!0;null===n||void 0===n||n();Ra();Ca();null===f||void 0===f||f();return this},
unpause:function(f){if(!ca||!Y)return this;var n=ea(f,"onUnpause");f=ea(f,"onPostUnpause");ca=!1;null===n||void 0===n||n();Ba();Qa();Ca();null===f||void 0===f||f();return this},updateContainerElements:function(f){E=[].concat(f).filter(Boolean).map(function(n){return"string"===typeof n?v.querySelector(n):n});Y&&Ba();Ca();return this}};ma.updateContainerElements(e);return ma};T=class extends T{constructor(e,k){super(e,k);this.container=document.createElement("div");this.content=null;this.open=!1;this._focusTrap=
null;this._close=()=>{this.open=!1};document.body.appendChild(this.container);this.addHandles(q.watch(()=>this.open,()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}get title(){return this.messages?.auth.signIn}render(){var e=this.id;const {open:k,content:v,title:B,messages:y}=this;var E=k&&!!v;const K={["esri-identity-modal--open"]:E,["esri-identity-modal--closed"]:!E},Q=L.tsx("button",{"aria-label":y.close,bind:this,class:"esri-identity-modal__close-button",onclick:this._close,title:y.close,
type:"button"},L.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})),W=`${e}_title`;e=`${e}_content`;const S=B?L.tsx("h1",{class:"esri-identity-modal__title",id:W},B):null;E=E?L.tsx("div",{afterCreate:this._createFocusTrap,"aria-describedby":e,"aria-labelledby":W,bind:this,class:"esri-identity-modal__dialog",role:"dialog"},Q,S,this._renderContent(e)):null;return L.tsx("div",{class:this.classes("esri-identity-modal",K),tabIndex:-1},E)}_destroyFocusTrap(){this._focusTrap?.deactivate({onDeactivate:()=>
{}});this._focusTrap=null}_toggleFocusTrap(){const {_focusTrap:e,open:k}=this;e&&(k?e.activate():e.deactivate())}_createFocusTrap(e){this._destroyFocusTrap();const k=requestAnimationFrame(()=>{this._focusTrap=ua(e,{initialFocus:"input",onDeactivate:this._close});this._toggleFocusTrap()});this.addHandles(p.makeHandle(()=>cancelAnimationFrame(k)))}_renderContent(e){const k=this.content;return"string"===typeof k?L.tsx("div",{class:"esri-identity-modal__content",id:e,innerHTML:k}):ka.isWidget(k)?L.tsx("div",
{class:"esri-identity-modal__content",id:e},k.render()):k instanceof HTMLElement?L.tsx("div",{afterCreate:this._attachToNode,bind:k,class:"esri-identity-modal__content",id:e}):null}_attachToNode(e){e.appendChild(this)}};r.__decorate([F.property({readOnly:!0})],T.prototype,"container",void 0);r.__decorate([F.property()],T.prototype,"content",void 0);r.__decorate([F.property()],T.prototype,"open",void 0);r.__decorate([F.property(),da.messageBundle("esri/t9n/common")],T.prototype,"messages",void 0);
r.__decorate([F.property()],T.prototype,"title",null);return T=r.__decorate([Z.subclass("esri.identity.IdentityModal")],T)})},"esri/identity/OAuthCredential":function(){define(function(){class r{constructor(p,q){this.userId=this.token=this.stateUID=this.ssl=this.refreshToken=this.expires=this.codeVerifier=this.appId=this.storage=this.oAuthInfo=null;this.oAuthInfo=p;this.storage=q;this._init()}isValid(){let p=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token))if(null==this.expires&&
this.refreshToken)p=!0;else if(this.expires){const q=Date.now();this.expires>q&&(this.expires-q)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(p=!0)}return p}save(){if(!this.storage)return!1;const p=this._load(),q=this.oAuthInfo;if(q&&q.authNamespace&&q.portalUrl){let F=p[q.authNamespace];F||(F=p[q.authNamespace]={});this.appId||(this.appId=q.appId);F[q.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,
token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(p))}catch(P){return console.warn(P),!1}return!0}return!1}destroy(){const p=this._load(),q=this.oAuthInfo;if(q?.appId&&q?.portalUrl&&(null==this.expires||this.expires>Date.now())&&(this.refreshToken||this.token)){var F=q.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken";const P=new FormData;P.append("f","json");P.append("auth_token",this.refreshToken||this.token);P.append("client_id",
q.appId);P.append("token_type_hint",this.refreshToken?"refresh_token":"access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(F,P);else{const N=new XMLHttpRequest;N.open("POST",F);N.send(P)}}if(q&&q.authNamespace&&q.portalUrl&&this.storage&&(F=p[q.authNamespace])){delete F[q.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(p))}catch(P){console.log(P)}}q&&(this.oAuthInfo=q._oAuthCred=null)}_init(){var p=this._load();const q=this.oAuthInfo;q&&q.authNamespace&&
q.portalUrl&&(p=p[q.authNamespace])&&(p=p[q.portalUrl])&&(this.appId=p.appId,this.codeVerifier=p.codeVerifier,this.expires=p.expires,this.refreshToken=p.refreshToken,this.ssl=p.ssl,this.stateUID=p.stateUID,this.token=p.token,this.userId=p.userId)}_load(){let p={};if(this.storage){const q=this.storage.getItem("esriJSAPIOAuth");if(q)try{p=JSON.parse(q)}catch(F){console.warn(F)}}return p}}r.prototype.declaredClass="esri.identity.OAuthCredential";return r})},"esri/identity/OAuthInfo":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(r,p,q,F,P,N,ha){var Z;p=Z=class extends p.JSONSupport{constructor(T){super(T);this.appId=this._oAuthCred=null;this.authNamespace="/";this.expiration=20160;this.flowType="auto";this.forceUserId=this.forceLogin=!1;this.locale=null;this.minTimeUntilExpiration=30;this.popup=!1;this.popupCallbackUrl="oauth-callback.html";this.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";this.portalUrl="https://www.arcgis.com";this.preserveUrlHash=!1;this.userId=null}clone(){return Z.fromJSON(this.toJSON())}};
r.__decorate([q.property({json:{write:!0}})],p.prototype,"appId",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"authNamespace",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"expiration",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"flowType",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"forceLogin",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"forceUserId",void 0);r.__decorate([q.property({json:{write:!0}})],
p.prototype,"locale",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"minTimeUntilExpiration",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"popup",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"popupCallbackUrl",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"popupWindowFeatures",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"portalUrl",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"preserveUrlHash",
void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"userId",void 0);return p=Z=r.__decorate([ha.subclass("esri.identity.OAuthInfo")],p)})},"esri/identity/ServerInfo":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(r,p,q,F,P,N,ha){p=class extends p.JSONSupport{constructor(Z){super(Z);this.webTierAuth=
this.tokenServiceUrl=this.shortLivedTokenValidity=this.server=this.owningTenant=this.owningSystemUrl=this.hasServer=this.hasPortal=this.currentVersion=this.adminTokenServiceUrl=null}};r.__decorate([q.property({json:{write:!0}})],p.prototype,"adminTokenServiceUrl",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"currentVersion",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"hasPortal",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"hasServer",void 0);
r.__decorate([q.property({json:{write:!0}})],p.prototype,"owningSystemUrl",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"owningTenant",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"server",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"shortLivedTokenValidity",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"tokenServiceUrl",void 0);r.__decorate([q.property({json:{write:!0}})],p.prototype,"webTierAuth",void 0);return p=r.__decorate([ha.subclass("esri.identity.ServerInfo")],
p)})},"*noref":1}});define(["../kernel","./IdentityManagerBase"],function(r,p){class q extends p.IdentityManagerBase{}q.prototype.declaredClass="esri.identity.IdentityManager";p=new q;r.setId(p);return p});