// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../core/Error ../core/Loadable ../core/Logger ../core/Promise ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../chunks/vec3f64 ./Extent ./Geometry ./Point ./Polygon ./support/axisAngleDegrees ./support/MeshComponent ./support/meshErrors ./support/MeshGeoreferencedRelativeVertexSpace ./support/MeshGeoreferencedVertexSpace ./support/MeshLocalVertexSpace ./support/MeshTransform ./support/MeshVertexAttributes ./support/triangulationUtils ./support/meshUtils/bounds ./support/meshUtils/centerAt ./support/meshUtils/georeference ./support/meshUtils/loadExternal ./support/meshUtils/Metadata ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale ../layers/support/infoFor3D ../support/zipUtils".split(" "),
function(B,h,H,f,l,I,J,K,m,C,Z,aa,L,M,N,O,r,P,D,v,g,Q,w,x,y,z,R,t,S,T,U,E,V,p,W,X,F,Y){var k;C={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:w,"georeferenced-relative":Q,local:x}};f=k=class extends f.LoadableMixin(I.EsriPromiseMixin(O)){constructor(a){super(a);this.components=null;this.vertexSpace=new w;this.transform=null;this.metadata=new E.Metadata;this.hasZ=!0;this.hasM=!1;this.vertexAttributes=new z.MeshVertexAttributes;this.type="mesh"}initialize(){if(0===this.metadata.externalSources.length||
this.vertexAttributes.position.length)this.loadStatus="loaded";this.when(()=>{this.addHandles(K.watch(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(a=>a.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?0<this.vertexAttributes.position.length&&(!this.components||0<this.components.length):null!=this.metadata.displaySource?.extent}get _transformedExtent(){const {components:a,spatialReference:b,vertexAttributes:c,vertexSpace:d}=
this;var e=c.position;if(0===e.length||a&&0===a.length)return new N({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b});if("local"===d.type){const {_untransformedExtent:n,transform:q}=this;return t.getProjectedExtent(n,q,d,b)}if("georeferenced-relative"===d.type){const {transform:n}=this;e=T.project({positions:e,transform:n,vertexSpace:d,inSpatialReference:b,outSpatialReference:b});return t.getExtentFromPositions(e,b)}return t.getExtentFromPositions(e,b)}get _untransformedExtent(){return t.getExtentFromPositions(this.vertexAttributes.position,
this.spatialReference)}get anchor(){const {vertexSpace:a}=this;if(a.isRelative)return a.getOriginPoint(this.spatialReference);const {center:b,zmin:c}=this._transformedExtent;return new r({x:b.x,y:b.y,z:c,spatialReference:this.spatialReference})}get origin(){const {vertexSpace:a}=this;return a.isRelative?a.getOriginPoint(this.spatialReference):this._transformedExtent.center}get extent(){return this.loaded||null==this.metadata?.displaySource?.extent?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(a){if(!this.loaded)return l.getLogger(this).error("addComponent()",
(new g.MeshNotLoadedError).message);this.components||(this.components=[]);this.components.push(v.from(a));this.notifyChange("components")}removeComponent(a){if(!this.loaded)return l.getLogger(this).error("removeComponent()",(new g.MeshNotLoadedError).message);if(this.components&&(a=this.components.indexOf(a),-1!==a)){this.components.splice(a,1);this.notifyChange("components");return}l.getLogger(this).error("removeComponent()",(new g.ComponentNotFoundError).message)}rotate(a,b,c,d){D.composeAxes(a,
b,c,G);W.rotate(this,G,d);return this}offset(a,b,c,d){if(!this.loaded)return l.getLogger(this).error("offset()",(new g.MeshNotLoadedError).message),this;u[0]=a;u[1]=b;u[2]=c;V.offset(this,u,d);return this}scale(a,b){if(!this.loaded)return l.getLogger(this).error("scale()",(new g.MeshNotLoadedError).message),this;X.scale(this,a,b);return this}centerAt(a,b){if(!this.loaded)return l.getLogger(this).error("centerAt()",(new g.MeshNotLoadedError).message),this;S.centerAt(this,a,b);return this}load(a){const {metadata:{displaySource:b}}=
this;b&&this.addResolvingPromise(U.loadExternal(this,b,a));return Promise.resolve(this)}addExternalSources(a){this.metadata.externalSources.addMany(a)}updateDisplaySource(a){this.metadata.displaySource=a}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(a){let b=null;if(this.components){const c=new Map,d=new Map;b=this.components.map(e=>e.cloneWithDeduplication(c,d))}a={components:b,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),
vertexSpace:a,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new k(a)}cloneShallow(){return new k({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(a){var b=new Promise((d,e)=>B(["./support/meshUtils/exporters/gltf/gltfexport"],d,e));const c=this.load();
b=await Promise.all([b,c]);({toBinaryGLTF:b}=b[0]);return b(this,a)}get memoryUsage(){let a;a=0+this.vertexAttributes.memoryUsage;if(null!=this.components)for(const b of this.components)a+=b.memoryUsage;return a}_clearSources(){this.metadata.clearSources()}static createBox(a,b){if(!(a instanceof r))return l.getLogger("esri.geometry.Mesh").error(".createBox()",(new g.InvalidLocationError).message),null;a=new k(p.convertUnitGeometry(p.createUnitSizeBox(),a,b));return b?.imageFace&&"all"!==b.imageFace?
p.extractSingleFaceOfBox(a,b.imageFace):a}static createSphere(a,b){return a instanceof r?new k(p.convertUnitGeometry(p.createUnitSizeSphere(b?.densificationFactor||0),a,b)):(l.getLogger("esri.geometry.Mesh").error(".createSphere()",(new g.InvalidLocationError).message),null)}static createCylinder(a,b){return a instanceof r?new k(p.convertUnitGeometry(p.createUnitSizeCylinder(b?.densificationFactor||0),a,b)):(l.getLogger("esri.geometry.Mesh").error(".createCylinder()",(new g.InvalidLocationError).message),
null)}static createPlane(a,b){if(!(a instanceof r))return l.getLogger("esri.geometry.Mesh").error(".createPlane()",(new g.InvalidLocationError).message),null;const c=b?.facing??"up",d=p.convertPlaneSizeParameter(c,b?.size);return new k(p.convertUnitGeometry(p.createUnitSizePlane(c),a,{...b,size:d}))}static createFromPolygon(a,b){if(!(a instanceof P))return l.getLogger("esri.geometry.Mesh").error(".createFromPolygon()",(new g.InvalidPolygonError).message),null;const c=R.triangulate(a);return new k({vertexAttributes:new z.MeshVertexAttributes({position:c.position}),
components:[new v({faces:c.faces,shading:"flat",material:b?.material??null})],spatialReference:a.spatialReference,vertexSpace:new w})}static async createFromGLTF(a,b,c){if(!(a instanceof r))throw a=new g.InvalidLocationError,l.getLogger("esri.geometry.Mesh").error(".createfromGLTF()",a.message),a;const {loadGLTFMesh:d}=await J.whenOrAbort(new Promise((e,n)=>B(["./support/meshUtils/loadGLTFMesh"],e,n)),c);return new k(await d(a,b,c))}static async createFromFiles(a,b,c){var d=q=>l.getLogger("esri.geometry.Mesh").error(".createFromFiles()",
q.message);if(!(a instanceof r))throw c=new g.InvalidLocationError,d(c),c;const e=c?.layer;if(!e)throw c=new g.NoLayerError,d(c),c;b=await k.extractAndFilterFiles(b,e);const n=b.reduce((q,A)=>F.isFileEditFormat(e.infoFor3D,A)?q+1:q,0);if(0===n)throw c=new g.NoModelError,d(c),c;if(1<n)throw c=new g.MultipleModelsError,d(c),c;d=k.createWithExternalSource(a,b);[d]=await e.uploadAssets([d],c);return d}static async extractAndFilterFiles(a,b){const c=b?.infoFor3D;return c?(await Y.extractZipFiles(a)).filter(d=>
F.isFileSupported(c,d)):a}static createWithExternalSource(a,b,c){var d=c?.extent??null;const {x:e,y:n,z:q,spatialReference:A}=a;a=c?.transform?.clone()??new y;c=c?.vertexSpace??new x({origin:[e,n,q??0]});b={source:b,extent:d};d=new E.Metadata;d.externalSources.push(b);return new k({metadata:d,transform:a,vertexSpace:c,spatialReference:A})}static createIncomplete(a,b){const {x:c,y:d,z:e,spatialReference:n}=a;a=b?.transform?.clone()??new y;b=b?.vertexSpace??new x({origin:[c,d,e??0]});b=new k({transform:a,
vertexSpace:b,spatialReference:n});b.addResolvingPromise(Promise.reject(new H("mesh-incomplete","Mesh resources are not complete")));return b}};h.__decorate([m.property({type:[v],json:{write:!0}})],f.prototype,"components",void 0);h.__decorate([m.property({nonNullable:!0,types:C,constructOnly:!0,json:{write:!0}})],f.prototype,"vertexSpace",void 0);h.__decorate([m.property({type:y,json:{write:!0}})],f.prototype,"transform",void 0);h.__decorate([m.property({constructOnly:!0})],f.prototype,"metadata",
void 0);h.__decorate([m.property()],f.prototype,"hasExtent",null);h.__decorate([m.property()],f.prototype,"_transformedExtent",null);h.__decorate([m.property()],f.prototype,"_untransformedExtent",null);h.__decorate([m.property()],f.prototype,"anchor",null);h.__decorate([m.property()],f.prototype,"origin",null);h.__decorate([m.property({readOnly:!0,json:{read:!1}})],f.prototype,"extent",null);h.__decorate([m.property({readOnly:!0,json:{read:!1,write:!0,default:!0}})],f.prototype,"hasZ",void 0);h.__decorate([m.property({readOnly:!0,
json:{read:!1,write:!0,default:!1}})],f.prototype,"hasM",void 0);h.__decorate([m.property({type:z.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],f.prototype,"vertexAttributes",void 0);f=k=h.__decorate([L.subclass("esri.geometry.Mesh")],f);const u=M.create(),G=D.create();return f});