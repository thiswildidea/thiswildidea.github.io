// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("require exports ../core/Error ../core/promiseUtils ../core/accessorSupport/tracking ../core/accessorSupport/tracking/SimpleObservable ../chunks/vec3f64 ./ellipsoidUtils ./Extent ./Multipoint ../chunks/pe ./Point ./Polygon ./Polyline ./SpatialReference ./projection/projectBuffer ./projection/projectors ./projection/projectXYZToVector ./support/GeographicTransformation ./support/spatialReferenceUtils ./support/zscale".split(" "),function(N,h,aa,G,O,ba,ca,r,da,ea,H,fa,ha,ia,I,J,K,P,A,q,ja){function B(){return!!n&&
H.isLoaded()}function w(a){null==x&&(x=Promise.all([H.load(),(new Promise((c,b)=>N(["../chunks/geometryEngineBase"],c,b))).then(c=>c.geometryEngineBase),new Promise((c,b)=>N(["./geometryAdapters/hydrated"],c,b))]));return x.then(([,c,{hydratedAdapter:b}])=>{G.throwIfAborted(a);t=b;n=c.default;n._enableProjection(H.pe);L.notify()})}function Q(a,c,b=null,d=null){return Array.isArray(a)?0===a.length?[]:M(t,a,a[0].spatialReference,c,b,d):M(t,[a],a.spatialReference,c,b,d)[0]}function M(a,c,b,d,e=null,
k=null){if(null==b||null==d)return c;if(y(b,d,e))return c.map(f=>C(f,b,d));if(null==e&&r.isSphericalECEF(b))return c.map(f=>C(f,b,I.WGS84)).map(f=>z(f,d));if(null==e&&r.isSphericalECEF(d))return c.map(f=>z(f,I.WGS84)).map(f=>C(f,I.WGS84,d));if(null==e){const f=A.cacheKey(b,d);void 0!==D[f]?e=D[f]:(e=R(b,d,void 0),null==e&&(e=new A),D[f]=e)}if(null==n||null==a)throw new E;return null!=k?n._project(a,c,b,d,e,k):n._project(a,c,b,d,e)}function S(a,c){if(!B())for(const b of a)if(null!=b&&!q.equals(b.spatialReference,
c)&&q.isValid(b.spatialReference)&&q.isValid(c)&&!y(b.spatialReference,c))return O.trackAccess(L),{pending:w(),geometries:null};return{pending:null,geometries:a.map(b=>null==b?null:q.equals(b.spatialReference,c)?b:q.isValid(b.spatialReference)&&q.isValid(c)?z(b,c):null)}}function R(a,c,b=null){if(null==a||null==c)return null;if(null==n||null==t)throw new E;a=n._getTransformation(t,a,c,b,b?.spatialReference);return null!==a?A.fromGE(a):null}function z(a,c){try{const b=Q(a,c);if(null==b)return null;
"xmin"in a&&"xmin"in b&&(b.zmin=a.zmin,b.zmax=a.zmax);const d=ja.getGeometryZScaler(b.type,a.spatialReference,c);null!=d&&d(b);return b}catch(b){if(!(b instanceof E))throw b;return null}}function y(a,c,b){return b?!1:q.equals(a,c)?!0:q.isValid(a)&&q.isValid(c)&&!!K.getProjector(a,c,K.projectorCache)}async function T(a,c,b,d){if(B())return G.waitTick(d);if(Array.isArray(a))for(const {source:e,dest:k,geographicTransformation:f}of a){if(!y(e,k,f))return w(d)}else if(!y(a,c,b))return w(d);return G.waitTick(d)}
function C(a,c,b){return a?"x"in a?U(a,c,new fa,b,0):"xmin"in a?V(a,c,new da,b,0):"rings"in a?W(a,c,new ha,b,0):"paths"in a?X(a,c,new ia,b,0):"points"in a?Y(a,c,new ea,b,0):null:null}function U(a,c,b,d,e){m[0]=a.x;m[1]=a.y;const k=a.z;m[2]=void 0!==k?k:e;if(!J.projectBuffer(m,c,0,m,d,0,1))return null;b.x=m[0];b.y=m[1];b.spatialReference=d;void 0!==k||r.isSphericalPCPF(d)?(b.z=m[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);void 0===a.m?(b.m=void 0,b.hasM=!1):(b.m=a.m,b.hasM=!0);return b}function Y(a,c,b,d,
e){const {points:k,hasZ:f,hasM:g}=a;a=[];const u=k.length,l=[];for(var p of k)l.push(p[0],p[1],f?p[2]:e);if(!J.projectBuffer(l,c,0,l,d,0,u))return null;c=f||r.isSphericalPCPF(d);for(e=0;e<u;++e){p=3*e;const v=l[p],F=l[p+1];c&&g?a.push([v,F,l[p+2],k[e][3]]):c?a.push([v,F,l[p+2]]):g?a.push([v,F,k[e][2]]):a.push([v,F])}b.points=a;b.spatialReference=d;b.hasZ=f;b.hasM=g;return b}function X(a,c,b,d,e){const {paths:k,hasZ:f,hasM:g}=a;a=[];if(!Z(k,f??!1,g??!1,c,a,d,e))return null;c=f||r.isSphericalPCPF(d);
b.paths=a;b.spatialReference=d;b.hasZ=c;b.hasM=g;return b}function W(a,c,b,d,e){const {rings:k,hasZ:f,hasM:g}=a;a=[];if(!Z(k,f??!1,g??!1,c,a,d,e))return null;c=f||r.isSphericalPCPF(d);b.rings=a;b.spatialReference=d;b.hasZ=c;b.hasM=g;return b}function V(a,c,b,d,e){const {xmin:k,ymin:f,xmax:g,ymax:u,hasZ:l,hasM:p}=a;if(!P.projectXYZToVector(k,f,l?a.zmin:e,c,m,d))return null;const v=l||r.isSphericalPCPF(d);b.xmin=m[0];b.ymin=m[1];v&&(b.zmin=m[2]);if(!P.projectXYZToVector(g,u,l?a.zmax:e,c,m,d))return null;
b.xmax=m[0];b.ymax=m[1];v&&(b.zmax=m[2]);p&&(b.mmin=a.mmin,b.mmax=a.mmax);b.spatialReference=d;return b}function Z(a,c,b,d,e,k,f=0){const g=[];for(const u of a)for(const l of u)g.push(l[0],l[1],c?l[2]:f);if(!J.projectBuffer(g,d,0,g,k,0,g.length/3))return!1;d=0;e.length=0;c=c||r.isSphericalPCPF(k);for(const u of a){a=[];for(const l of u)c&&b?a.push([g[d++],g[d++],g[d++],l[3]]):c?a.push([g[d++],g[d++],g[d++]]):(b?a.push([g[d++],g[d++],l[2]]):a.push([g[d++],g[d++]]),d++);e.push(a)}return!0}let n=null,
t=null,x=null,D={};const L=new ba.SimpleObservable;class E extends aa{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}const m=ca.create();h.canProjectToWGS84ComparableLonLat=function(a){return null==a?!1:null!=K.getWGS84ComparableLonLatProjector(a)};h.canProjectWithoutEngine=y;h.getTransformation=R;h.getTransformations=function(a,c,b=null){if(null==n||null==t)throw new E;a=n._getTransformationBySuitability(t,a,c,b,b?.spatialReference);if(null!==
a){c=[];for(const d of a)c.push(A.fromGE(d));return c}return[]};h.initializeProjection=T;h.isLoaded=B;h.isLoadedOrLoad=function(){if(B())return!0;O.trackAccess(L);w();return!1};h.load=w;h.project=Q;h.projectExtent=function(a,c,b=c.spatialReference,d=0){return null!=a.spatialReference&&null!=b&&null!=V(a,a.spatialReference,c,b,d)};h.projectMany=M;h.projectMultipoint=function(a,c,b=c.spatialReference,d=0){return null!=a.spatialReference&&null!=b&&null!=Y(a,a.spatialReference,c,b,d)};h.projectOrLoad=
function(a,c){a=S([a],c);return null!=a.pending?{pending:a.pending,geometry:null}:null!=a.geometries?{pending:null,geometry:a.geometries[0]}:{pending:null,geometry:null}};h.projectOrLoadMany=S;h.projectPoint=function(a,c,b=c.spatialReference,d=0){return null!=b&&null!=a.spatialReference&&null!=U(a,a.spatialReference,c,b,d)};h.projectPolygon=function(a,c,b=c.spatialReference,d=0){return null!=a.spatialReference&&null!=b&&null!=W(a,a.spatialReference,c,b,d)};h.projectPolyline=function(a,c,b=c.spatialReference,
d=0){return null!=a.spatialReference&&null!=b&&null!=X(a,a.spatialReference,c,b,d)};h.projectWithZConversion=async function(a,c,b){const d=a.spatialReference;null!=d&&null!=c&&await T(d,c,null,b);return z(a,c)};h.projectWithoutEngine=C;h.test={get loadPromise(){return x}};h.tryProjectWithZConversion=z;h.unload=function(){x=t=n=null;D={}};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});