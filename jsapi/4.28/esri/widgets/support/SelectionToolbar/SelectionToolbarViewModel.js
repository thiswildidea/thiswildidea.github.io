// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/handleUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/layerUtils ../../../views/draw/support/layerUtils ../../../views/support/layerViewUtils ../Selector2D".split(" "),function(e,
k,c,t,l,m,u,f,y,z,A,v,w,n,h,x){c=class extends c.EventedAccessor{constructor(a){super(a);this.activeOperation=this._operationHandlesGroup=null;this.selector=new x;this.sources=null}initialize(){this.addHandles([u.watch(()=>this._sources,a=>{this.selector.sources=a;this.activeOperation&&(this.activeOperation.sources=a)})])}destroy(){this._operationHandlesGroup=m.removeMaybe(this._operationHandlesGroup);this.selector.destroy()}get _sources(){const {sources:a,view:g}=this;return g&&a?.length?a.flatMap(b=>
{if(h.isSelectableLayerView2D(b))return b;if(w.isKnowledgeGraphLayer(b)){var d=b.layers||[];const r=d.map(p=>{const q=n.findLayerView(g,p)||void 0;return h.isSelectableLayerView2D(q)?q:p});return r.length?r.toArray():d.length?d.toArray():b}d=n.findLayerView(g,b)||void 0;return h.isSelectableLayerView2D(d)?d:b}):[]}set cursor(a){this.activeOperation&&(this.activeOperation.cursor=a);this.selector.cursor=a;this._set("cursor",a)}get layers(){k.deprecatedProperty(l.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."});
return this.sources}set layers(a){k.deprecatedProperty(l.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."});this.sources=a}get state(){return this.activeOperation?"active":this.view?.ready&&this._sources.length?"ready":"disabled"}set view(a){this.selector.view=a;this._set("view",a)}async selectionFrom(a,g){const {_sources:b}=this;return this.view&&b.length?this.selector.selectionFrom({geometry:a,selectionOptions:g,sources:b}):[]}cancel(){"active"===this.state&&(this.activeOperation?.cancel(),
this._set("activeOperation",null))}activate(a){const {_sources:g,state:b}=this;if("disabled"!==b&&g?.length)return"active"===b&&this.cancel(),a=this.selector.draw({sources:g,operationOptions:a}),this._operationHandlesGroup=t.handlesGroup([a.once("complete",d=>this._onOperationComplete(d)),a.on("selection-change",d=>this._onOperationSelectionChange(d))]),this._set("activeOperation",a),a}_onOperationSelectionChange(a){this.emit("selection-change",a)}_onOperationComplete(a){this._operationHandlesGroup=
m.removeMaybe(this._operationHandlesGroup);this._set("activeOperation",null);this.emit("complete",a)}};e.__decorate([f.property()],c.prototype,"_sources",null);e.__decorate([f.property({readOnly:!0})],c.prototype,"activeOperation",void 0);e.__decorate([f.property()],c.prototype,"cursor",null);e.__decorate([f.property()],c.prototype,"layers",null);e.__decorate([f.property({readOnly:!0})],c.prototype,"selector",void 0);e.__decorate([f.property()],c.prototype,"sources",void 0);e.__decorate([f.property({readOnly:!0})],
c.prototype,"state",null);e.__decorate([f.property()],c.prototype,"view",null);return c=e.__decorate([v.subclass("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],c)});