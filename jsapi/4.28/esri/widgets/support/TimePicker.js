// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../intl ../../core/events ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./globalCss ./TimePickerViewModel ./widgetUtils ./decorators/messageBundle ./jsxFactory ../../chunks/datetime ../../intl/locale ../../intl/date".split(" "),function(g,f,x,k,C,D,E,y,z,p,q,F,A,r,m,t,n){const B=new Set(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp",
"Tab"]);f=class extends z{constructor(a,b){super(a,b);this.timeZoneName=this.timeZone=this.messages=this._activeTime=this._activePart=null;this.viewModel=new q}get _dateTimeFormatOptions(){return{hour:"numeric",minute:"numeric",timeZone:this.timeZone??void 0,timeZoneName:this.timeZoneName??void 0}}get _dateTimeOptions(){return{locale:t.getLocale(),numberingSystem:"latn",zone:this.timeZone||void 0}}get value(){return this.viewModel.value}set value(a){this.viewModel.value=a}render(){const a=this._activeTime||
this.viewModel.value;return r.tsx("div",{class:this.classes("esri-time-picker",p.globalCss.widget)},r.tsx("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes("esri-time-picker__input",p.globalCss.input),onblur:this._handleInputBlur,onclick:this._handleInputClick,onfocus:this._handleInputFocus,oninput:this._handleInputKeydown,onkeydown:this._handleInputKeydown,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:n.formatDate(a.valueOf(),
this._dateTimeFormatOptions)}))}_handleInputBlur(){this._activeTime?.isValid&&(this.viewModel.value=this._activeTime.toJSDate());this._activePart=this._activeTime=null}_handleInputUpdate(a){this._selectPart(a,this._activePart)}_selectPart(a,b){var d=this._activeTime;if(d&&a){d=n.formatDate(d.valueOf(),this._dateTimeFormatOptions);var e=d.indexOf(":");if("hours"===b)a.setSelectionRange(0,e);else{var c=e+1;e=c+2;"minutes"===b?a.setSelectionRange(c,e):(d=d.length,"meridiem"===b&&a.setSelectionRange(e+
1,d))}}}_handleInputFocus(a){this._activePart="hours";this._activeTime=m.DateTime.fromJSDate(this.viewModel.value,{zone:this.timeZone||void 0}).startOf("minute");this._selectPart(a.target,"hours")}_caretIndexToPartName(a){var b=this._activeTime?.toFormat("t",{locale:t.getLocale(),numberingSystem:"latn"});if(!b)return null;const d=b.indexOf(":");b=b.indexOf(" ");return a<=d?"hours":a>d&&a<=b?"minutes":"meridiem"}_handleInputKeydown(a){const {ctrlKey:b,metaKey:d,shiftKey:e}=a;var c=x.eventKey(a),l=
this._activeTime,h=this._activePart;const u=/\d/.test(c),v=/^a|p$/i.test(c),w=d||b;if((B.has(c)||u||"meridiem"===h&&v&&!w)&&null!=l){if("ArrowLeft"===c)this._activePart=this._prevPart();else if("ArrowRight"===c)this._activePart=this._nextPart();else if("Tab"===c){h=e?this._prevPart():this._nextPart();if(h===this._activePart)return;this._activePart=h}else"ArrowUp"===c?this._shift("up",h):"ArrowDown"===c?this._shift("down",h):u?this._setTime(l,h,Number(c)):v&&(c=c.toLowerCase(),l=l.hour,("a"===c&&12<=
l||"p"===c&&12>l)&&this._shift("up",h));a.preventDefault();a.stopImmediatePropagation()}else w||(a.preventDefault(),a.stopImmediatePropagation())}_handleInputClick(a){a=a.target;this._activePart=null;this.renderNow();this._activePart=this._caretIndexToPartName(a.selectionStart??0)}_getOrderedParts(){var a=this._activeTime;return null!=a&&n.formatDate(a.valueOf(),this._dateTimeFormatOptions).includes(" ")?["hours","minutes","meridiem"]:["hours","minutes"]}_prevPart(){const a=this._getOrderedParts(),
b=this._activePart?a.indexOf(this._activePart)-1:0;return a[Math.max(b,0)]}_nextPart(){const a=this._getOrderedParts(),b=this._activePart?a.indexOf(this._activePart)+1:0;return a[Math.min(b,a.length-1)]}_setTime(a,b,d){if("hours"===b){b=null!=a&&n.formatDate(a.valueOf(),this._dateTimeFormatOptions).includes(" ")?12:24;var e=`${a.hour%b}`;const c=Number(`${e}${d}`);2===e.length||c>b?this._activeTime=a.set({hour:d}):c<=b&&(this._activeTime=a.set({hour:c}))}else"minutes"===b&&(b=`${a.minute}`,e=Number(`${b}${d}`),
2===b.length||59<e?this._activeTime=a.set({minute:d}):59>e&&(this._activeTime=a.set({minute:e})))}_parseTime(a){if(!a)return null;let b=m.DateTime.fromFormat(a,"t",this._dateTimeOptions);if(b.isValid)return b;b=m.DateTime.fromISO(a,this._dateTimeOptions);if(b.isValid)return b;b=m.DateTime.fromRFC2822(a,this._dateTimeOptions);if(b.isValid)return b;b=m.DateTime.fromJSDate(new Date(a),this._dateTimeOptions);return b.isValid?b:null}_handleInputPaste(a){var b=a.clipboardData?.getData("text/plain");if(b=
this._parseTime(b))this._activeTime=b;a.preventDefault();a.stopImmediatePropagation()}_handleInputWheel(a){this._shift(0>a.deltaY?"up":"down",this._activePart)}_shift(a,b){b&&(this._activeTime=this._activeTime?.["up"===a?"plus":"minus"]({["hours"===b?"hour":"minutes"===b?"minute":"hours"]:"meridiem"===b?12:1})??null)}};g.__decorate([k.property()],f.prototype,"_dateTimeFormatOptions",null);g.__decorate([k.property()],f.prototype,"_dateTimeOptions",null);g.__decorate([k.property(),A.messageBundle("esri/widgets/support/t9n/TimePicker")],
f.prototype,"messages",void 0);g.__decorate([k.property()],f.prototype,"timeZone",void 0);g.__decorate([k.property()],f.prototype,"timeZoneName",void 0);g.__decorate([k.property()],f.prototype,"value",null);g.__decorate([k.property({type:q})],f.prototype,"viewModel",void 0);return f=g.__decorate([y.subclass("esri.widgets.support.TimePicker")],f)});