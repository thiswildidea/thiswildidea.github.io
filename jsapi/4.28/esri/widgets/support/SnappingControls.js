// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("require ../../chunks/tslib.es6 ../../core/arrayUtils ../../core/maybe ../../core/uid ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./componentsUtils ./globalCss ./LabeledSwitch ./legacyIcon ./widgetUtils ./decorators/messageBundle ./jsxFactory ./SnappingControls/SnappingControlsViewModel ./SnappingControls/VisibleElements".split(" "),function(l,g,q,r,u,h,f,G,v,w,x,y,p,z,H,A,d,B,t){var C=
z.legacyIcon.vertexGps;f=class extends w{constructor(a,b){super(a,b);this._layerListFilter=this._defaultViewModel=null;this.iconClass=C;this.icon=null;this.layerListOpen=!0;this.messages=null;this.visibleElements=new t;this._enableSnappingSwitchChange=e=>{this.snappingOptions.enabled=e};this._featureEnabledSwitchChange=e=>{this.snappingOptions.featureEnabled=e};this._selfEnabledSwitchChange=e=>{this.snappingOptions.selfEnabled=e};this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled);
requestAnimationFrame(()=>e.target.setFocus())};const {snappingOptions:c,view:m,viewModel:k}=a;this.viewModel=k??(this._defaultViewModel=new B({snappingOptions:c,view:m}))}normalizeCtorArgs(a){const {snappingOptions:b,view:c,viewModel:m,...k}=a;return k}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=r.destroyMaybe(this._defaultViewModel))}loadDependencies(){return Promise.all([x.loadCalciteComponents({accordion:()=>new Promise((a,b)=>l(["../../chunks/calcite-accordion"],
a,b)),"accordion-item":()=>new Promise((a,b)=>l(["../../chunks/calcite-accordion-item"],a,b)),action:()=>new Promise((a,b)=>l(["../../chunks/calcite-action"],a,b)),block:()=>new Promise((a,b)=>l(["../../chunks/calcite-block"],a,b)),button:()=>new Promise((a,b)=>l(["../../chunks/calcite-button"],a,b)),icon:()=>new Promise((a,b)=>l(["../../chunks/calcite-icon"],a,b)),input:()=>new Promise((a,b)=>l(["../../chunks/calcite-input"],a,b)),list:()=>new Promise((a,b)=>l(["../../chunks/calcite-list"],a,b)),
"list-item":()=>new Promise((a,b)=>l(["../../chunks/calcite-list-item"],a,b))}),p.loadLabeledSwitchComponents()])}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(a){this.viewModel.snappingOptions=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}set viewModel(a){if(a!==this._get("viewModel")){if(null==this._defaultViewModel||this._defaultViewModel!==
a)this._defaultViewModel=r.destroyMaybe(this._defaultViewModel);this._set("viewModel",a)}}render(){const {label:a}=this;return d.tsx("div",{"aria-label":a,class:this.classes("esri-snapping-controls",y.globalCss.widget)},d.tsx("div",{class:"esri-snapping-controls__container"},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList()]}_renderToggles(){const {visibleElements:a}=this;var b=[a.selfEnabledToggle?this._renderSelfEnabledToggle():null,a.featureEnabledToggle?
this._renderFeatureEnabledToggle():null].filter(q.isSome);b=[a.enabledToggle?this._renderEnabledToggle():null,0<b.length?d.tsx("div",{class:"esri-snapping-controls__nested-container"},b):null].filter(q.isSome);return 0===b.length?null:d.tsx("calcite-block",{class:"esri-snapping-controls__toggle-block",heading:a.header?this.label:"",key:"toggle-block",open:!0},b)}_renderEnabledToggle(){const {messages:a,viewModel:b}=this,{snappingOptions:c}=b;return d.tsx(p.LabeledSwitch,{checked:c.enabled,disabled:c.enabledToggled,
key:`${this.id}__enabled-toggle`,label:a.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){const {messages:a,viewModel:b}=this,{snappingOptions:c}=b;return d.tsx(p.LabeledSwitch,{checked:c.enabled&&c.selfEnabled,disabled:c.enabledToggled||!c.enabled,key:`${this.id}__self-enabled-toggle`,label:a.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){const {messages:a,viewModel:b}=this,{snappingOptions:c}=b;return d.tsx(p.LabeledSwitch,
{checked:c.enabled&&c.featureEnabled,disabled:c.enabledToggled||!c.enabled,key:`${this.id}__feature-enabled-toggle`,label:a.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const {messages:a,viewModel:b}=this,{snappingOptions:{enabled:c,enabledToggled:m}}=b;var k=({target:{value:n}})=>{this._layerListFilter=""===n?null:new RegExp(n,"i")};k=9<b.layerListViewModel.operationalItems.length?d.tsx("calcite-input",{class:"esri-snapping-controls__layer-list__filter",
clearable:!0,placeholder:a?.searchLayers,onCalciteInputInput:k}):null;const e=m||!c;return d.tsx("calcite-block",{class:"esri-snapping-controls__layer-list-block",collapsible:!0,disabled:e,heading:a.snappingLayers,key:"list-block",open:this.layerListOpen&&!e,onCalciteBlockToggle:n=>this.layerListOpen=n.target.open},k,this._renderToggleLayersButton(),d.tsx("calcite-list",{class:"esri-snapping-controls__layer-list"},this._renderLayerListItemCollection(b.layerListViewModel.operationalItems,this._layerListFilter)))}_renderLayerListItemCollection(a,
b){return a.map(c=>{if(b?this._itemTitleMatchesFilter(c,b):1)return 0<c.children.length?this._renderLayerListItemGroup(c):this._renderLayerListItem(c);const m=c.children.filter(k=>this._itemTitleMatchesFilter(k,b));return 0<m.length?this._renderLayerListItemGroup(c,m):null}).toArray().filter(q.isSome)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const {viewModel:{allLayersEnabled:a},messages:b}=this,c=a?b.disableAllLayers:b.enableAllLayers;return d.tsx("calcite-button",
{appearance:"transparent",class:"esri-snapping-controls__layer-list__button",label:c,name:"layer-toggle",onclick:this._onToggleLayersButtonClick,scale:"m"},c)}_renderLayerListItem(a){const {messages:{untitledLayer:b}}=this,c=a.enabled;return d.tsx("calcite-list-item",{class:"esri-snapping-controls__layer-list__item",key:`${this.id}-list-item-${a.uid}`,label:a.title||b,onCalciteListItemSelect:()=>{this._handleLayerListItemChange({checked:!c,value:a.layer.id})}},d.tsx("calcite-icon",{icon:c?"check-square-f":
"square",scale:"s",slot:"content-start"}))}_renderLayerListItemGroup(a,b){const {allChildrenEnabled:c,children:m,hasChildrenEnabled:k,title:e}=a,n=this.messages,D=e||n.untitledLayer,E=e&&""!==e?e:u.generateUID(),F=b??m;return d.tsx("calcite-list-item",{class:"esri-snapping-controls__layer-list__item",key:E},d.tsx("calcite-accordion",{appearance:"transparent",class:"esri-snapping-controls__layer-list__group"},d.tsx("calcite-accordion-item",{expanded:!!b,heading:D,key:a.uid},d.tsx("calcite-action",
{onclick:()=>{this.viewModel.toggleSnappingForLayers(a.childLayerIds,!c)},scale:"m",slot:"actions-start",text:c?n.disableAllLayers:n.enableAllLayers,textEnabled:!1},d.tsx("calcite-icon",{icon:c?"check-square-f":k?"minus-square":"square",scale:"s"})),d.tsx("calcite-list",null,this._renderLayerListItemCollection(F)))))}_itemTitleMatchesFilter(a,b){return null!=b&&b.test(a.title)}async _handleLayerListItemChange(a){a.checked?this.viewModel.enableSnappingForLayer(a.value):this.viewModel.disableSnappingForLayer(a.value)}};
g.__decorate([h.property()],f.prototype,"_defaultViewModel",void 0);g.__decorate([h.property()],f.prototype,"_layerListFilter",void 0);g.__decorate([h.property()],f.prototype,"iconClass",void 0);g.__decorate([h.property()],f.prototype,"icon",void 0);g.__decorate([h.property()],f.prototype,"label",null);g.__decorate([h.property({type:Boolean,nonNullable:!0})],f.prototype,"layerListOpen",void 0);g.__decorate([h.property(),A.messageBundle("esri/widgets/support/SnappingControls/t9n/SnappingControls")],
f.prototype,"messages",void 0);g.__decorate([h.property()],f.prototype,"snappingOptions",null);g.__decorate([h.property()],f.prototype,"view",null);g.__decorate([h.property()],f.prototype,"viewModel",null);g.__decorate([h.property({type:t,nonNullable:!0})],f.prototype,"visibleElements",void 0);return f=g.__decorate([v.subclass("esri.widgets.support.SnappingControls")],f)});