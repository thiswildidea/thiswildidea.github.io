// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../intl ../../core/events ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./datePickerUtils ./DatePickerViewModel ./globalCss ./legacyIcon ./Popover ./decorators/accessibleHandler ./decorators/messageBundle ./jsxFactory ./widgetUtils ../../chunks/datetime ../../intl/date ../../intl/locale".split(" "),
function(k,h,y,G,z,l,N,O,P,H,I,v,A,p,u,J,w,K,f,n,q,m,x){const L=new Set(" ;ArrowDown;ArrowLeft;ArrowRight;ArrowUp;End;Enter;Home;PageDown;PageUp".split(";"));h=class extends I{constructor(a,b){super(a,b);this._rootNode=this._inputOrButtonNode=this._calendarNode=null;this._requestDayPickerFocusOnCreate=!1;this._activeDate=null;this._calendarPopover=new J({owner:this,placement:"bottom-start",anchorElement:()=>this._rootNode,renderContentFunction:this._renderCalendar});this.dateInputEnabled=this._isOpen=
!1;this.messages=null;this.commitOnMonthChange=!1;this.viewModel=new A;this.disabled=!1;this.timeZone=void 0;this.toggle=this.toggle.bind(this)}initialize(){this.addHandles(z.watch(()=>({viewModel:this.viewModel,value:this.viewModel?.value}),({viewModel:a,value:b})=>{if(!this.destroyed&&a&&null!=this.onChange)this.onChange(b)},z.sync))}destroy(){this._calendarPopover.destroy()}get _dateTimeFormatOptions(){return{year:"numeric",month:"2-digit",day:"2-digit",timeZone:this.timeZone||void 0}}get value(){return this.viewModel.value}set value(a){this.viewModel.value=
a}get isOpen(){return this._isOpen}render(){return f.tsx("div",{afterCreate:n.storeNode,bind:this,class:this.classes("esri-date-picker",p.globalCss.widget),"data-node-ref":"_rootNode"},this.dateInputEnabled?this._renderInputAndButtonMode():this._renderButtonOnlyMode())}toggle(){this._isOpen?this.close():this.open()}open(a=!0){this._activeDate=q.DateTime.fromJSDate(this.viewModel.value);this._isOpen=!0;this._calendarPopover.open=!0;this._requestDayPickerFocusOnCreate=a}close(a=!0){this._activeDate=
null;this._isOpen=!1;this._calendarPopover.open=!1;a&&this._inputOrButtonNode?.focus()}_renderButtonOnlyMode(){const a=m.formatDate(this.viewModel.value,this._dateTimeFormatOptions),{disabled:b,_isOpen:g,messages:d}=this;return f.tsx("div",{afterCreate:n.storeNode,"aria-controls":g?this._getCalendarId():null,"aria-expanded":g.toString(),"aria-haspopup":"true","aria-label":d.setDate,"aria-pressed":g.toString(),bind:this,class:this.classes(p.globalCss.widgetButton,p.globalCss.select,"esri-date-picker__calendar-toggle"),
"data-node-ref":"_inputOrButtonNode",key:`date-button-${b}`,onclick:this.toggle,onkeydown:this._handleDateButtonKeyDown,role:"button",tabIndex:b?void 0:0},f.tsx("span",{class:"esri-date-picker__date"},a))}_renderInputAndButtonMode(){const a=m.formatDate(this.viewModel.value,this._dateTimeFormatOptions),{_isOpen:b,messages:g}=this;return f.tsx("div",{class:this.classes("esri-date-picker__input")},f.tsx("input",{afterCreate:n.storeNode,"aria-controls":b?this._getCalendarId():null,"aria-haspopup":"true",
"aria-label":g.setDate,bind:this,class:this.classes("esri-date-picker__text-input",p.globalCss.input),"data-node-ref":"_inputOrButtonNode",key:"date-input",onblur:this._handleDateInputBlur,onclick:this._handleDateInputClick,onkeydown:this._handleDateInputKeyDown,type:"text",value:a}),f.tsx("span",{"aria-hidden":"true",class:this.classes("esri-date-picker__icon--leading",u.legacyIcon.calendar)}))}_handleDateInputClick(){this.open(!1)}_handleDateInputKeyDown(a){const {key:b}=a;this._isOpen?"Enter"===
b?this._handleDateText(a):"Escape"===b&&this.close():"ArrowDown"===b&&(this.open(),a.preventDefault())}_handleDateButtonKeyDown(a){const {key:b,shiftKey:g}=a;this._isOpen&&"Tab"===b&&g?this.close():n.isActivationKey(b)&&this.toggle()}_handleDateInputBlur(a){this._isOpen||this._handleDateText(a)}_handleDateText(a){a=a.currentTarget;try{var b=v.parseDateIntoParts(a.value,this._dateTimeFormatOptions)}catch(g){G.getLogger(this).warn(g);a.value=m.formatDate(this.viewModel.value,this._dateTimeFormatOptions);
return}b=q.DateTime.fromObject(b);b.isValid?(this.viewModel.value=b.toJSDate(),this._activeDate=b):a.value=m.formatDate(this.viewModel.value,this._dateTimeFormatOptions)}_handleDatePickerKeydown(a){"Escape"===y.eventKey(a)&&(this.close(),a.preventDefault(),a.stopPropagation())}_renderCalendar(){const a=this._activeDate;if(!a)return null;const b=q.DateTime.fromJSDate(this.viewModel.value);return f.tsx("div",{afterCreate:n.storeNode,bind:this,class:this.classes("esri-date-picker__calendar",p.globalCss.widget),
"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onfocusout:this._onCalendarFocusOut,onkeydown:this._handleDatePickerKeydown,tabIndex:-1},this._renderMonthPicker(a),this._renderDayPicker(a,b),this._renderYearPicker(a))}_getCalendarId(){return`date-picker__calendar--${this.id}`}_onCalendarFocusOut(a){(a=a.relatedTarget)&&a instanceof Node&&(this._calendarNode?.contains(a)||this._rootNode?.contains(a))||this.close(!1)}_renderMonthPicker(a){var b=n.isRTL(this.container);
const g=b?u.legacyIcon.right:u.legacyIcon.left;b=b?u.legacyIcon.left:u.legacyIcon.right;const d=q.Info.months("long",{locale:x.getLocale()}).map((r,t)=>f.tsx("option",{selected:a.month-1===t,value:t.toString()},r)),{disabled:c,messages:e}=this;return f.tsx("div",{class:"esri-date-picker__month-picker"},f.tsx("div",{"aria-label":e.goToPreviousMonth,bind:this,class:p.globalCss.button,key:`previous-month-${c}`,onclick:this._setPreviousMonth,onkeydown:this._handlePreviousMonthKeyDown,role:"button",tabIndex:c?
void 0:0,title:e.goToPreviousMonth},f.tsx("span",{"aria-hidden":"true",class:g})),f.tsx("select",{"aria-label":e.selectMonth,"aria-live":"assertive",bind:this,class:this.classes("esri-date-picker__month-dropdown",p.globalCss.select),disabled:c,id:`${this.id}__month-picker`,onchange:this._setMonth,onkeydown:this._setMonth,title:e.selectMonth},d),f.tsx("div",{"aria-label":e.goToNextMonth,bind:this,class:p.globalCss.button,key:`next-month-${c}`,onclick:this._setNextMonth,onkeydown:this._setNextMonth,
role:"button",tabIndex:c?void 0:0,title:e.goToNextMonth},f.tsx("span",{"aria-hidden":"true",class:b})))}_renderDayPicker(a,b){const g=this._getWeekLabels(),d=this._getDayId(a);a=this._renderMonth(a,b);const {id:c,disabled:e}=this;return f.tsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":d,"aria-labelledby":`${c}__month-picker ${c}__selected-year`,bind:this,class:"esri-date-picker__day-picker",id:`${c}__day-picker`,key:`day-picker-${e}`,onkeydown:this._handleDayPickerKeydown,
role:"grid",tabIndex:e?void 0:0},f.tsx("div",{class:"esri-date-picker__week-item",role:"row"},g.map(r=>f.tsx("div",{"aria-label":r.name,class:this.classes("esri-date-picker__day-item","esri-date-picker__day-item--header"),role:"columnheader",title:r.name},r.abbr))),a)}_getDayId(a){return`${this.id}__${m.formatDate(a.valueOf(),this._dateTimeFormatOptions)}`}_handleDayPickerCreate(a){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,a.focus())}_getWeekLabels(){const a=[],
b={weekday:"long"},g={weekday:"narrow"};let d=q.DateTime.now().set({weekday:v.getFirstDayOfWeek(x.getLocale())});for(let c=0;7>c;c++)a.push({name:m.formatDate(d.valueOf(),b),abbr:m.formatDate(d.valueOf(),g)}),d=d.plus({day:1});return a}_handleDayPickerKeydown(a){const {ctrlKey:b,shiftKey:g}=a,d=y.eventKey(a);if(L.has(d)){var c=this._activeDate;c&&("ArrowLeft"===d?c=c.minus({day:1}):"ArrowRight"===d?c=c.plus({day:1}):"ArrowUp"===d?c=c.minus({week:1}):"ArrowDown"===d?c=c.plus({week:1}):"PageUp"===d?
c=c.minus({[g?"year":"month"]:1}):"PageDown"===d?c=c.plus({[g?"year":"month"]:1}):"Home"===d?c=c.startOf(b?"year":"month"):"End"===d?c=c.endOf(b?"year":"month"):n.isActivationKey(d)&&(this.viewModel.value=c.toJSDate(),this.close()),this._activeDate=c,a.preventDefault(),a.stopPropagation())}}_renderMonth(a,b){const g=q.DateTime.now(),d=a.startOf("month"),c=a.endOf("month");let e=d.minus({day:v.getLocaleDayOfWeek(x.getLocale(),d.weekday)});const r=[];for(let B=0;6>B;B++){const C=[];for(let D=0;7>D;D++){const E=
e.day,F=e.hasSame(a,"day");var t=e.hasSame(b,"day");const M=this._getDayId(e);t={["esri-date-picker__day-item--nearby-month"]:!q.Interval.fromDateTimes(d,c).contains(e),["esri-date-picker__day-item--today"]:e.hasSame(g,"day"),["esri-date-picker__day-item--active"]:F,["esri-date-picker__day-item--selected"]:t};C.push(f.tsx("div",{"aria-label":E.toString(),"aria-selected":F.toString(),bind:this,class:this.classes("esri-date-picker__day-item",t),"data-iso-date":e.toISO(),id:M,onclick:this._handleSelectedDate,
onkeydown:this._handleSelectedDate,role:"gridcell"},E));e=e.plus({day:1})}r.push(f.tsx("div",{class:"esri-date-picker__week-item",role:"row"},C))}return r}_renderYearPicker(a){const b={year:"numeric"},g=m.formatDate(a.valueOf(),b),d=m.formatDate(a.plus({year:1}).valueOf(),b);a=m.formatDate(a.minus({year:1}).valueOf(),b);const {disabled:c,messages:e}=this;return f.tsx("div",{class:"esri-date-picker__year-picker"},f.tsx("div",{"aria-label":e.goToPreviousYear,bind:this,class:"esri-date-picker__year-picker-item",
key:`previous-year-${c}`,onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:c?void 0:0,title:e.goToPreviousYear},a),f.tsx("div",{class:this.classes("esri-date-picker__year-picker-item","esri-date-picker__year-picker-item--selected"),id:`${this.id}__selected-year`},g),f.tsx("div",{"aria-label":e.goToNextYear,bind:this,class:"esri-date-picker__year-picker-item",key:`next-year-${c}`,onclick:this._setNextYear,onkeydown:this._handleNextYearKeyDown,tabIndex:c?void 0:0,title:e.goToNextYear},
d))}_setMonth(a){this._activeDate&&(this._activeDate=this._activeDate.set({month:Number(a.target.value)+1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate()))}_setPreviousMonth(){this._activeDate&&(this._activeDate=this._activeDate.minus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate()))}_handlePreviousMonthKeyDown(a){"Tab"===a.key&&a.shiftKey?(a.preventDefault(),this.close()):n.isActivationKey(a.key)&&this._setPreviousMonth()}_setNextMonth(){this._activeDate&&
(this._activeDate=this._activeDate.plus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate()))}_setPreviousYear(){this._activeDate=this._activeDate?.minus({year:1})??null}_setNextYear(){this._activeDate=this._activeDate?.plus({year:1})??null}_handleNextYearKeyDown(a){"Tab"!==a.key||a.shiftKey?n.isActivationKey(a.key)&&this._setNextYear():(a.preventDefault(),this.close())}_handleSelectedDate(a){this.viewModel.value=q.DateTime.fromISO(a.target.getAttribute("data-iso-date")).toJSDate();
this.close()}};k.__decorate([l.property()],h.prototype,"_activeDate",void 0);k.__decorate([l.property()],h.prototype,"_calendarPopover",void 0);k.__decorate([l.property()],h.prototype,"_isOpen",void 0);k.__decorate([l.property()],h.prototype,"_dateTimeFormatOptions",null);k.__decorate([l.property()],h.prototype,"dateInputEnabled",void 0);k.__decorate([l.property(),K.messageBundle("esri/widgets/support/t9n/DatePicker")],h.prototype,"messages",void 0);k.__decorate([l.property()],h.prototype,"value",
null);k.__decorate([l.property()],h.prototype,"commitOnMonthChange",void 0);k.__decorate([l.property({type:A})],h.prototype,"viewModel",void 0);k.__decorate([l.property()],h.prototype,"onChange",void 0);k.__decorate([l.property()],h.prototype,"disabled",void 0);k.__decorate([l.property()],h.prototype,"timeZone",void 0);k.__decorate([l.property()],h.prototype,"isOpen",null);k.__decorate([w.accessibleHandler()],h.prototype,"_setNextMonth",null);k.__decorate([w.accessibleHandler()],h.prototype,"_setPreviousYear",
null);k.__decorate([w.accessibleHandler()],h.prototype,"_handleSelectedDate",null);return h=k.__decorate([H.subclass("esri.widgets.support.DatePicker")],h)});