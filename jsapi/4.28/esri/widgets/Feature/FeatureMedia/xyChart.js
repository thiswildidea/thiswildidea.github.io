// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/LineSeries","../../../chunks/Theme","../../../chunks/tslib.es6","../../../chunks/Button"],function(z,x,k,K,L){class B extends x.XYSeries{constructor(){super(...arguments);Object.defineProperty(this,"_ph",{enumerable:!0,configurable:!0,writable:!0,value:0});Object.defineProperty(this,"_pw",{enumerable:!0,configurable:!0,writable:!0,value:0})}_makeGraphics(a,c){return this.makeColumn(c,a)}_makeFieldNames(){super._makeFieldNames();const a=this.get("xAxis"),c=this.get("yAxis");
a.isType("CategoryAxis")&&!this.get("openCategoryXField")&&(this._xOpenField=this._xField);a.isType("ValueAxis")&&!this.get("openValueXField")&&(this._xOpenField=this._xField);c.isType("CategoryAxis")&&!this.get("openCategoryYField")&&(this._yOpenField=this._yField);c.isType("ValueAxis")&&!this.get("openValueYField")&&(this._yOpenField=this._yField)}_prepareChildren(){super._prepareChildren();var a=this.get("xAxis");const c=this.get("yAxis");var b=this.dataItems.length;const d=Math.max(0,this.startIndex()-
2);b=Math.min(this.endIndex()+2,b-1);if(a.inited&&c.inited)for(a=d;a<=b;a++)this._createGraphics(this.dataItems[a])}_updateChildren(){var a=this.chart;a&&(this._ph=a.plotContainer.height(),this._pw=a.plotContainer.width());a=this.get("xAxis");var c=this.get("yAxis"),b=this.get("baseAxis"),d=this.columns.template;this.isDirty("fill")&&null==d.get("fill")&&d.set("fill",this.get("fill"));this.isDirty("stroke")&&null==d.get("stroke")&&d.set("stroke",this.get("stroke"));let e=0,g=0,l=0;k.each(b.series,
m=>{if(m instanceof B){const n=m.get("stacked");n&&0==l&&g++;!n&&m.get("clustered")&&g++}m===this&&(e=g-1);l++});this.get("clustered")||(e=0,g=1);0===g&&(g=1,e=0);var f=a.get("renderer");d=c.get("renderer");b=f.get("cellStartLocation",0);f=f.get("cellEndLocation",1);var h=d.get("cellStartLocation",0);d=d.get("cellEndLocation",1);this._aLocationX0=b+e/g*(f-b);this._aLocationX1=b+(e+1)/g*(f-b);this._aLocationY0=h+e/g*(d-h);this._aLocationY1=h+(e+1)/g*(d-h);if(a.inited&&c.inited){if(this._axesDirty||
this._valuesDirty||this._stackDirty||this.isDirty("vcx")||this.isDirty("vcy")||this._sizeDirty){a=this.dataItems.length;d=Math.max(0,this.startIndex()-2);c=Math.min(this.endIndex()+2,a-1);for(b=0;b<d;b++)this._toggleColumn(this.dataItems[b],!1);b=this.dataItems[d];for(f=d;f<=c;f++)if(h=this.dataItems[f],null!=h.get("valueX")&&null!=h.get("valueY")){b=h;if(0<f&&0<d)for(--f;0<=f;f--)if(h=this.dataItems[f],null!=h.get("valueX")&&null!=h.get("valueY")){b=h;break}break}else this._toggleColumn(h,!1);for(;d<=
c;d++)f=this.dataItems[d],this._updateGraphics(f,b),null!=f.get("valueX")&&null!=f.get("valueY")&&(b=f);for(c+=1;c<a;c++)this._toggleColumn(this.dataItems[c],!1)}}else this._skipped=!0;this.updateLegendMarker(this.get("tooltipDataItem"));super._updateChildren()}_createGraphics(a){let c=a.get("graphics");if(!c){c=this._makeGraphics(this.columns,a);a.set("graphics",c);c._setDataItem(a);var b=a.get("legendDataItem");b&&(b=b.get("markerRectangle"))&&b.setAll({fill:c.get("fill"),stroke:c.get("stroke")});
this.axisRanges.each(d=>{const e=d.container,g=a.get("rangeGraphics",[]);a.set("rangeGraphics",g);const l=this._makeGraphics(d.columns,a);g.push(l);l.setPrivate("list",d.columns);e.children.push(l)})}}_updateGraphics(a,c){var b=a.get("graphics"),d=this._xField,e=this._yField,g=a.get(d),l=a.get(e);if(null!=g&&null!=l){const A=this._xOpenField,H=this._yOpenField;var f=this.get("locationX",a.get("locationX",.5)),h=this.get("locationY",a.get("locationY",.5)),m=this.get("openLocationX",a.get("openLocationX",
f)),n=this.get("openLocationY",a.get("openLocationY",h));const F=b.get("width");var p=b.get("height"),q=this.get("stacked");const t=this.get("xAxis"),u=this.get("yAxis"),M=this.get("baseAxis");g=t.get("start");l=t.get("end");const N=u.get("start"),O=u.get("end");let r,y,v,w,C=this.get("vcy",1),D=this.get("vcx",1),I=!1,J=!1;u.isType("CategoryAxis")&&t.isType("CategoryAxis")?(q=this._aLocationX0+m-.5,f=this._aLocationX1+f-.5,F instanceof k.Percent&&(m=(f-q)*(1-F.value)/2,q+=m,f-=m),r=t.getDataItemPositionX(a,
A,q,D),y=t.getDataItemPositionX(a,d,f,D),q=this._aLocationY0+n-.5,f=this._aLocationY1+h-.5,p instanceof k.Percent&&(d=(f-q)*(1-p.value)/2,q+=d,f-=d),v=u.getDataItemPositionY(a,H,q,C),w=u.getDataItemPositionY(a,e,f,C),a.setRaw("point",{x:r+(y-r)/2,y:v+(w-v)/2})):t===M?(p=this._aLocationX0+m-.5,f=this._aLocationX1+f-.5,F instanceof k.Percent&&(m=(f-p)*(1-F.value)/2,p+=m,f-=m),r=t.getDataItemPositionX(a,A,p,D),y=t.getDataItemPositionX(a,d,f,D),v=u.getDataItemPositionY(a,e,h,C),w=this._yOpenField!==this._yField?
u.getDataItemPositionY(a,H,n,C):q?(d=a.get("stackToItemY"))?u.getDataItemPositionY(d,e,n,d.component.get("vcy")):u.basePosition():u.basePosition(),a.setRaw("point",{x:r+(y-r)/2,y:v}),J=!0):u===M&&(n=this._aLocationY0+n-.5,h=this._aLocationY1+h-.5,p instanceof k.Percent&&(p=(h-n)*(1-p.value)/2,n+=p,h-=p),v=u.getDataItemPositionY(a,H,n,C),w=u.getDataItemPositionY(a,e,h,C),y=t.getDataItemPositionX(a,d,f,D),r=this._xOpenField!==this._xField?t.getDataItemPositionX(a,A,m,D):q?(e=a.get("stackToItemX"))?
t.getDataItemPositionX(e,d,m,e.component.get("vcx")):t.basePosition():t.basePosition(),I=!0,a.setRaw("point",{x:y,y:v+(w-v)/2}));this._updateSeriesGraphics(a,b,r,y,v,w,I,J);r<g&&y<g||r>l&&y>l||v<N&&w<=N||v>=O&&w>O||k.isNaN(r)||k.isNaN(v)?this._toggleColumn(a,!1):this._toggleColumn(a,!0);(b=a.get("rangeGraphics"))&&k.each(b,P=>{this._updateSeriesGraphics(a,P,r,y,v,w,I,J)});this._applyGraphicsStates(a,c)}}_updateSeriesGraphics(a,c,b,d,e,g,l,f){var h=c.get("width"),m=c.get("height"),n=c.get("maxWidth"),
p=c.get("maxHeight");e=this.getPoint(b,e);g=this.getPoint(d,g);if(b=a.get("point"))d=this.getPoint(b.x,b.y),b.x=d.x+this._x,b.y=d.y+this._y;b=e.x;d=g.x;e=e.y;g=g.y;k.isNumber(h)&&(h=(d-b-h)/2,b+=h,d-=h);k.isNumber(n)&&n<Math.abs(d-b)&&(n=(d-b-n)/2,b+=n,d-=n);k.isNumber(m)&&(m=(g-e-m)/2,e+=m,g-=m);k.isNumber(p)&&p<Math.abs(g-e)&&(p=(g-e-p)/2,e+=p,g-=p);this.get("adjustBulletPosition")&&(l&&(d=Math.min(Math.max(0,d),this._pw),b=Math.min(Math.max(0,b),this._pw)),f&&(e=Math.min(Math.max(0,e),this._ph),
g=Math.min(Math.max(0,g),this._ph)));a.setRaw("left",b);a.setRaw("right",d);a.setRaw("top",e);a.setRaw("bottom",g);c.setPrivate("width",d-b);c.setPrivate("height",g-e);c.set("x",b);c.set("y",g-(g-e))}_handleDataSetChange(){super._handleDataSetChange();k.each(this._dataItems,a=>{this._toggleColumn(a,!1)})}_applyGraphicsStates(a,c){var b=a.get("graphics");const d=b.states.lookup("dropFromOpen"),e=b.states.lookup("riseFromOpen"),g=b.states.lookup("dropFromPrevious");b=b.states.lookup("riseFromPrevious");
if(d||g||e||b){const l=this.get("xAxis"),f=this.get("yAxis"),h=this.get("baseAxis");let m,n,p;h===l&&f.isType("ValueAxis")?(m=a.get(this._yOpenField),n=a.get(this._yField),p=c.get(this._yField)):h===f&&l.isType("ValueAxis")&&(m=a.get(this._xOpenField),n=a.get(this._xField),p=c.get(this._xField));k.isNumber(m)&&k.isNumber(n)&&(n<m?d&&d.apply():e&&e.apply(),k.isNumber(p)&&(n<p?g&&g.apply():b&&b.apply()))}}disposeDataItem(a){super.disposeDataItem(a);const c=a.get("graphics");c&&(this.columns.removeValue(c),
c.dispose());(a=a.get("rangeGraphics"))&&k.each(a,b=>{const d=b.getPrivate("list");d&&d.removeValue(b);b.dispose()})}hideDataItem(a,c){const b=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return K.__awaiter(this,void 0,void 0,function*(){const d=[b.hideDataItem.call(this,a,c)];var e=a.get("graphics");e&&d.push(e.hide(c));(e=a.get("rangeGraphics"))&&k.each(e,g=>{d.push(g.hide(c))});yield Promise.all(d)})}_toggleColumn(a,c){var b=a.get("graphics");b&&b.setPrivate("visible",c);(b=
a.get("rangeGraphics"))&&k.each(b,d=>{d.setPrivate("visible",c)});(a=a.bullets)&&k.each(a,d=>{d.setPrivate("hidden",!c)})}showDataItem(a,c){const b=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return K.__awaiter(this,void 0,void 0,function*(){const d=[b.showDataItem.call(this,a,c)];var e=a.get("graphics");e&&d.push(e.show(c));(e=a.get("rangeGraphics"))&&k.each(e,g=>{d.push(g.show(c))});yield Promise.all(d)})}updateLegendMarker(a){let c=this.get("legendDataItem");if(this.get("useLastColorForLegendMarker")&&
!a){const b=this.dataItems[this.endIndex()-1];b&&(a=b)}if(c){let b=this.columns.template;a&&(a=a.get("graphics"))&&(b=a);const d=c.get("markerRectangle");d&&(c.get("itemContainer").get("disabled")||k.each(k.visualSettings,e=>{d.set(e,b.get(e,this.get(e)))}))}}_getTooltipTarget(a){return"bullet"==this.get("seriesTooltipTarget")?super._getTooltipTarget(a):(a=a.get("graphics"))?a:this}}Object.defineProperty(B,"className",{enumerable:!0,configurable:!0,writable:!0,value:"BaseColumnSeries"});Object.defineProperty(B,
"classNames",{enumerable:!0,configurable:!0,writable:!0,value:x.XYSeries.classNames.concat([B.className])});class E extends x.Axis{constructor(){super(...arguments);Object.defineProperty(this,"_frequency",{enumerable:!0,configurable:!0,writable:!0,value:1});Object.defineProperty(this,"_itemMap",{enumerable:!0,configurable:!0,writable:!0,value:{}})}_afterNew(){this._settings.themeTags=k.mergeTags(this._settings.themeTags,["axis"]);this.fields.push("category");this.setPrivateRaw("name","category");
this.addTag("category");super._afterNew()}_prepareChildren(){super._prepareChildren();const a=this.dataItems.length;let c=0;this._valuesDirty&&(this._itemMap={},k.each(this.dataItems,b=>{b.setRaw("index",c);this._itemMap[b.get("category")]=b;c++}),this.setPrivateRaw("maxZoomFactor",a));this.setPrivateRaw("startIndex",Math.max(Math.round(this.get("start",0)*a),0));this.setPrivateRaw("endIndex",Math.min(Math.round(this.get("end",1)*a),a));(this._sizeDirty||this._valuesDirty||this.isDirty("start")||
this.isDirty("end")||this.isPrivateDirty("endIndex")||this.isPrivateDirty("startIndex")||this.isPrivateDirty("width")||this.isPrivateDirty("height"))&&0<this.dataItems.length&&(this._handleRangeChange(),this._prepareAxisItems(),this._updateAxisRanges())}_handleRangeChange(){k.each(this.series,a=>{var c=this.dataItems[this.startIndex()].get("category"),b=this.dataItems[this.endIndex()-1].get("category"),d=a.get("baseAxis");let e=a.get("xAxis"),g=a.get("yAxis");if(e instanceof E&&g instanceof E)a._markDirtyAxes();
else if(d===this){var l;let h,m=g;e===d?(a.get("categoryXField")&&(l="categoryX"),a.get("openCategoryXField")&&(h="openCategoryX")):g===d&&(a.get("categoryYField")&&(l="categoryY"),a.get("openCategoryYField")&&(h="openCategoryY"),m=e);if("ValueAxis"==m.className&&(l||h)){let n;for(let q=0,A=a.dataItems.length;q<A;q++){d=a.dataItems[q];if(l&&d.get(l)===c){var f=d;break}if(h&&d.get(h)===c){f=d;break}}for(c=a.dataItems.length-1;0<=c;c--){d=a.dataItems[c];if(l&&d.get(l)===b){n=d;break}if(h&&d.get(h)===
b){n=d;break}}l=0;b=a.dataItems.length;f&&(l=a.dataItems.indexOf(f));n&&(b=a.dataItems.indexOf(n)+1);a.setPrivate("startIndex",l);a.setPrivate("endIndex",b);let p=!1;for(f=l;f<b;f++){const q=a.dataItems[f];k.each(a.__valueXShowFields,A=>{null!=q.get(A)&&(p=!0)});k.each(a.__valueYShowFields,A=>{null!=q.get(A)&&(p=!0)});if(p)break}a.setPrivate("outOfSelection",!p)}a._markDirtyAxes()}})}_prepareAxisItems(){var a=this.get("renderer"),c=this.dataItems.length,b=this.startIndex();0<b&&b--;let d=this.endIndex();
d<c&&d++;a=a.axisLength()/Math.max(a.get("minGridDistance"),1/Number.MAX_SAFE_INTEGER);a=Math.max(1,Math.min(c,Math.ceil((d-b)/a)));b=Math.floor(b/a)*a;this._frequency=a;for(var e=0;e<c;e++)this.dataItems[e].hide();for(c=this.dataItems[b].get("index",0);b<d;b+=a)e=this.dataItems[b],this._createAssets(e,[]),e.isHidden()&&e.show(),this._prepareDataItem(e,c,a),c++;this._updateGhost()}_prepareDataItem(a,c,b){let d=this.get("renderer");var e=a.get("categoryLocation",0),g=a.get("endCategoryLocation",1),
l=a.get("index");k.isNumber(l)||(l=this.categoryToIndex(a.get("category")));e=this.indexToPosition(l,e);var f=a.get("endCategory");let h;f?(h=this.categoryToIndex(f),k.isNumber(h)||(h=l)):h=l;f=this.indexToPosition(h,g);l=a.get("isRange")?h:l+this._frequency-1;g=this.indexToPosition(l,g);d.updateLabel(a.get("label"),e,f,b);d.updateGrid(a.get("grid"),e,f);d.updateTick(a.get("tick"),e,f,b);d.updateFill(a.get("axisFill"),e,g);this._processBullet(a);d.updateBullet(a.get("bullet"),e,f);(b=this.get("fillRule"))&&
b(a,c)}startIndex(){let a=this.dataItems.length;return Math.min(Math.max(this.getPrivate("startIndex",0),0),a-1)}endIndex(){let a=this.dataItems.length;return Math.max(1,Math.min(this.getPrivate("endIndex",a),a))}baseValue(){}basePosition(){return 0}getX(a){return(a=this._itemMap[a])?this._settings.renderer.positionToCoordinate(this.indexToPosition(a.get("index",0))):NaN}getY(a){return(a=this._itemMap[a])?this._settings.renderer.positionToCoordinate(this.indexToPosition(a.get("index",0))):NaN}getDataItemPositionX(a,
c,b,d){a=a.get(c);return(a=this._itemMap[a])?this.indexToPosition(a.get("index",0),b):NaN}getDataItemCoordinateX(a,c,b,d){return this._settings.renderer.positionToCoordinate(this.getDataItemPositionX(a,c,b,d))}getDataItemPositionY(a,c,b,d){a=a.get(c);return(a=this._itemMap[a])?this.indexToPosition(a.get("index",0),b):NaN}getDataItemCoordinateY(a,c,b,d){return this._settings.renderer.positionToCoordinate(this.getDataItemPositionY(a,c,b,d))}indexToPosition(a,c){k.isNumber(c)||(c=.5);let b=this.dataItems.length,
d=this.get("startLocation",0),e=this.get("endLocation",1);c=(a+c-d)/(b-d-(1-e));(a=this.dataItems[a])&&(c+=a.get("deltaPosition",0));return c}categoryToIndex(a){return(a=this._itemMap[a])?a.get("index"):NaN}dataItemToPosition(a){return this.indexToPosition(a.get("index"))}roundAxisPosition(a,c){a+=(.5-c)/this.dataItems.length;return this.indexToPosition(this.axisPositionToIndex(a),c)}axisPositionToIndex(a){let c=this.dataItems.length;return k.fitToRange(Math.floor(a*c),0,c-1)}getTooltipText(a,c){if(a=
this.dataItems[this.axisPositionToIndex(a)])if(a=a.get("label"))return k.populateString(a,this.get("tooltipText",""))}_updateTooltipText(a,c){a._setDataItem(this.dataItems[this.axisPositionToIndex(c)]);a.label.text.markDirtyText()}getSeriesItem(a,c){if(0<this.dataItems.length){let d=this.getPrivate("name")+this.get("renderer").getPrivate("letter");var b=this.axisPositionToIndex(c);c=a.dataItems[b];let e=this.dataItems[b];b=e.get("category");if(c&&e&&c.get(d)===b)return c;for(let g=0,l=a.dataItems.length;g<
l;g++)if(c=a.dataItems[g],c.get(d)===b)return c}}zoomToIndexes(a,c,b){let d=this.dataItems.length;this.zoom(a/d,c/d,b)}zoomToCategories(a,c,b){this.zoomToIndexes(this.categoryToIndex(a),this.categoryToIndex(c)+1,b)}getCellWidthPosition(){return this._frequency/this.dataItems.length/(this.get("end",1)-this.get("start",0))}}Object.defineProperty(E,"className",{enumerable:!0,configurable:!0,writable:!0,value:"CategoryAxis"});Object.defineProperty(E,"classNames",{enumerable:!0,configurable:!0,writable:!0,
value:x.Axis.classNames.concat([E.className])});class G extends B{constructor(){super(...arguments);Object.defineProperty(this,"columns",{enumerable:!0,configurable:!0,writable:!0,value:new k.ListTemplate(k.Template.new({}),()=>L.RoundedRectangle._new(this._root,{position:"absolute",themeTags:k.mergeTags(this.columns.template.get("themeTags",[]),["series","column"])},[this.columns.template]))})}makeColumn(a,c){const b=this.mainContainer.children.push(c.make());b._setDataItem(a);c.push(b);return b}_processAxisRange(a){super._processAxisRange(a);
a.columns=new k.ListTemplate(k.Template.new({}),()=>L.RoundedRectangle._new(this._root,{position:"absolute",themeTags:k.mergeTags(a.columns.template.get("themeTags",[]),["series","column"])},[this.columns.template,a.columns.template]))}}Object.defineProperty(G,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ColumnSeries"});Object.defineProperty(G,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:B.classNames.concat([G.className])});z.AxisRendererXAm5=x.AxisRendererX;z.AxisRendererYAm5=
x.AxisRendererY;z.LineSeriesAm5=x.LineSeries;z.ValueAxisAm5=x.ValueAxis;z.XYChartAm5=x.XYChart;z.XYCursorAm5=x.XYCursor;z.CategoryAxisAm5=E;z.ColumnSeriesAm5=G;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})});