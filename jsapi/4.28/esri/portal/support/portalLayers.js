// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../core/Error ../../layers/support/associatedFeatureServiceUtils ../../layers/support/LayerLoadContext ../../layers/support/layerUtils ../../layers/support/lazyLayerLoader ../PortalItem ./loadUtils ./portalItemUtils".split(" "),function(g,r,t,u,h,v,m,f,k){async function w(a){await a.load();const b=new u.LayerLoadContext;a=await n(a,b);return x(a)}async function n(a,b){switch(a.type){case "Map Service":return y(a,b);case "Feature Service":return z(a,b);case "Feature Collection":return A(a);
case "Scene Service":return B(a,b);case "Image Service":return C(a,b);case "Stream Service":return{className:"StreamLayer"};case "Vector Tile Service":return{className:"VectorTileLayer"};case "GeoJson":return{className:"GeoJSONLayer"};case "CSV":return{className:"CSVLayer"};case "KML":return{className:"KMLLayer"};case "WFS":return{className:"WFSLayer"};case "WMTS":return{className:"WMTSLayer"};case "WMS":return{className:"WMSLayer"};case "Feed":return{className:"StreamLayer"};case "Group Layer":return{className:"GroupLayer"};
default:throw new r("portal:unknown-item-type","Unknown item type '${type}'",{type:a.type});}}async function x(a){return{constructor:await (0,v.layerLookupMap[a.className])(),properties:a.properties}}async function y(a,b){return await D(a,b)?{className:"TileLayer"}:{className:"MapImageLayer"}}async function z(a,b){a=await p(a,b);return"object"===typeof a?(b={},null!=a.id&&(b.layerId=a.id),{className:a.className||"FeatureLayer",properties:b}):{className:"GroupLayer"}}async function B(a,b){var c=await p(a,
b,async()=>{try{if(!a.url)return[];const {serverUrl:d}=await t.findAssociatedFeatureService(a.url,{sceneLayerItem:a});return(await b.fetchServiceMetadata(d))?.tables??[]}catch{return[]}});if("object"===typeof c){const d={};let e=void 0;null!=c.id?(d.layerId=c.id,e=`${a.url}/layers/${c.id}`):e=a.url;if(a.typeKeywords?.length)for(const q of Object.keys(h.sceneServiceLayerTypeToClassName))if(a.typeKeywords.includes(q))return{className:h.sceneServiceLayerTypeToClassName[q]};c=await b.fetchServiceMetadata(e);
return{className:h.sceneServiceLayerTypeToClassName[c?.layerType]||"SceneLayer",properties:d}}return!1===c&&"Voxel"===(await b.fetchServiceMetadata(a.url))?.layerType?{className:"VoxelLayer"}:{className:"GroupLayer"}}async function A(a){await a.load();const b=k.hasTypeKeyword(a,"Map Notes"),c=k.hasTypeKeyword(a,"Markup");if(b||c)return{className:"MapNotesLayer"};if(k.hasTypeKeyword(a,"Route Layer"))return{className:"RouteLayer"};a=await a.fetchData();return 1===f.getNumLayersAndTables(a)?{className:"FeatureLayer"}:
{className:"GroupLayer"}}async function C(a,b){await a.load();var c=a.typeKeywords?.map(d=>d.toLowerCase())??[];if(c.includes("elevation 3d layer"))return{className:"ElevationLayer"};if(c.includes("tiled imagery"))return{className:"ImageryTileLayer"};c=(await a.fetchData())?.layerType;if("ArcGISTiledImageServiceLayer"===c)return{className:"ImageryTileLayer"};if("ArcGISImageServiceLayer"===c)return{className:"ImageryLayer"};b=await b.fetchServiceMetadata(a.url);a=b.cacheType?.toLowerCase();b=b.capabilities?.toLowerCase().includes("tilesonly");
return"map"===a||b?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}}async function D(a,b){return(await b.fetchServiceMetadata(a.url)).tileInfo}async function p(a,b,c){const d=a.url;if(!d||/\/\d+$/.test(d))return{};await a.load();let e=await a.fetchData();if("Feature Service"===a.type)return b=await f.preprocessFSItemData(e,d,b),c=l(b),"object"===typeof c&&(a=f.getSubtypeGroupLayerIds(b),b=f.getOrientedImageryLayerIds(b),c.className=null!=c.id&&a.includes(c.id)?"SubtypeGroupLayer":null!=c.id&&
b?.includes(c.id)?"OrientedImageryLayer":"FeatureLayer"),c;"Scene Service"===a.type&&(e=await f.populateSceneServiceItemData(a,e,b));if(0<f.getNumLayersAndTables(e))return l(e);a=await b.fetchServiceMetadata(d);c&&(a.tables=await c());return l(a)}function l(a){return 1===f.getNumLayersAndTables(a)?{id:f.getFirstLayerOrTableId(a)}:!1}g.fromItem=async function(a){!a.portalItem||a.portalItem instanceof m||(a={...a,portalItem:new m(a.portalItem)});const b=await w(a.portalItem);return new b.constructor({portalItem:a.portalItem,
...b.properties})};g.selectLayerClassPath=n;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});