// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(d,f,t,u,n,v,g,C,D,E,w,h,l,x,y,z,A,p,m){const B=Array;d.Focus=class extends A.PointOfInterest{constructor(a){super(a);this._propertiesPool=new z.PropertiesPool({location:x,renderLocation:B},this);this._dirty=!0;this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([n.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),n.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);this.scheduler&&this.addHandles(this.scheduler.registerTask(m.TaskPriority.POINT_OF_INTEREST_FREQUENT,
this))}destroy(){this._propertiesPool=u.destroyMaybe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a}get running(){return this._dirty}runTask(){var a=this._get("renderLocation");const c=this.centerOnSurface.renderLocation;var b=this.renderCoordsHelper,e=this.state.contentCamera;this._dirty=!1;b.worldUpAtPosition(c,
q);b=Math.max(0,(Math.acos(h.dot(q,e.viewForward))-.5*Math.PI)*(e.aboveGround?1:-1));if(Number.isNaN(b))return a&&h.equals(a,c)||(a=this._propertiesPool.get("renderLocation"),h.copy(a,c),this._set("renderLocation",a)),m.Task.YIELD;b=1-t.clamp(b/(.5*Math.PI),0,1);b*=b*b;this._calculateScreenHorizontalEdgeOnSurface(r);e=this._propertiesPool.get("renderLocation");h.lerp(e,c,r,b);a&&h.equals(a,e)||this._set("renderLocation",e);return m.Task.YIELD}_calculateScreenHorizontalEdgeOnSurface(a){const c=this.state.contentCamera;
var b=c.getRenderCenter(v.createRenderScreenPointArray3());b[1]=c.aboveGround?c.padding[p.PaddingSide.BOTTOM]:c.fullHeight-c.padding[p.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(b,a))return a;const e=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return c.unprojectFromRenderScreen(b,k)&&(h.subtract(k,k,c.eye),b=h.normalize(k,k),this.renderCoordsHelper.intersectInfiniteManifold(y.wrap(c.eye,b),e,a))?a:this.renderCoordsHelper.setAltitude(a,e,c.eye)}updateRenderLocation(){this._dirty=
!0}};f.__decorate([g.property()],d.Focus.prototype,"_dirty",void 0);f.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,"scheduler",void 0);f.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,"centerOnSurface",void 0);f.__decorate([g.property({constructOnly:!0})],d.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);f.__decorate([g.property({readOnly:!0})],d.Focus.prototype,"updating",null);f.__decorate([g.property({readOnly:!0})],d.Focus.prototype,"location",
null);f.__decorate([g.property({readOnly:!0})],d.Focus.prototype,"renderLocation",void 0);d.Focus=f.__decorate([w.subclass("esri.views.3d.support.pointsOfInterest.Focus")],d.Focus);const q=l.create(),k=l.create(),r=l.create();Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});