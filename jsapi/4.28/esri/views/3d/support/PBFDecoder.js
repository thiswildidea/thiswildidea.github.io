// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../Graphic ../../../core/typedArrayUtil ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),function(k,p,l,q,m,r){function t(a){switch(a.type){case "polyline":a.paths.reduce((c,b)=>c+b.length,0)<l.nativeArrayMaxSize&&(a.paths=a.hasZ||a.hasM?a.paths.map(c=>c.map(b=>[b[0],b[1],b[2]])):a.paths.map(c=>c.map(b=>[b[0],b[1]])));break;case "polygon":a.rings.reduce((c,b)=>c+b.length,0)<l.nativeArrayMaxSize&&(a.rings=a.hasZ||
a.hasM?a.rings.map(c=>c.map(b=>[b[0],b[1],b[2]])):a.rings.map(c=>c.map(b=>[b[0],b[1]])))}}class u{constructor(a){this._controller=a;this._handle=new v(c=>a.schedule(c))}destroy(){this._handle.destroy()}invoke(a,c){if(!a.buffer||0===a.buffer.byteLength)return Promise.resolve(null);a.options.sourceSpatialReference&&a.options.sourceSpatialReference instanceof m&&(a.options={...a.options,sourceSpatialReference:a.options.sourceSpatialReference.toJSON()});return this._handle.invoke(a,c).then(b=>{let e=
0,g=0;const n=m.fromJSON(b.spatialReference);b.spatialReference=n;const h=async f=>{if(b.fields)for(;e<b.fields.length;)if(b.fields[e]=r.fromJSON(b.fields[e]),e++,f.madeProgress())return this._controller.reschedule(d=>h(d));for(;g<b.features.length;){const d=b.features[g];++g;d.uid=p.generateUID();if(null!=d.geometry&&(d.geometry.spatialReference=n,t(d.geometry),f.madeProgress()))return this._controller.reschedule(w=>h(w))}return b};return this._controller.schedule(f=>h(f))})}}class v extends q.WorkerHandle{constructor(a){super("PBFDecoderWorker",
"_parseFeatureQuery",{_parseFeatureQuery:c=>[c.buffer]},a)}}k.PBFDecoder=u;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});