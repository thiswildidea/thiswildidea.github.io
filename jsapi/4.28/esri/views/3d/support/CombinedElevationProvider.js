// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),function(g,l,r,t,u,v,p,z,A,B,w,x,q,y){function h(a,b,e,
d,f,c,m){for(const n of b)b=n.getElevation(e,d,f,c,m),null!=b&&(a=null!=a?Math.max(b,a):b);return a}g.CombinedElevationProvider=class extends t.EventedMixin(r){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(a){super(a);this._im=[];this._ground=[];this._scene=[];this.lastElevationQuery=null;this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=u.destroyMaybe(this._elevationQueryCached)}enableElevationCache(a){a||(this.lastElevationQuery=null);this.elevationCacheEnabled=
a}getElevation(a,b,e,d,f){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var c=this.lastElevationQuery;if(a===c.x&&b===c.y&&e===c.z&&q.equals(d,c.spatialReference)&&f===c.queryContext)return c.result}c=h(null,this._im,a,b,e,d,f);null==c&&(c=h(c,this._ground,a,b,e,d,f));"scene"===f&&(c=h(c,this._scene,a,b,e,d,f));this.elevationCacheEnabled&&(this.lastElevationQuery={x:a,y:b,z:e,spatialReference:d,queryContext:f,result:c});return c}getSphereElevationBounds(a,b){let e=Infinity,d=-Infinity;
for(const f of[this._im,this._ground,this._scene])f.forEach(c=>{c.getSphereElevationBounds&&(c=c.getSphereElevationBounds(a,b),null!=c&&(e=Math.min(e,c.min),d=Math.max(d,c.max)))});return{min:e,max:d}}getRootElevationBounds(){let a=Infinity,b=-Infinity;for(const e of[this._im,this._ground,this._scene])e.forEach(d=>{d.getRootElevationBounds&&(d=d.getRootElevationBounds(),null!=d&&(a=Math.min(a,d.min),b=Math.max(b,d.max)))});return{min:a,max:b}}async queryElevation(a,b,e,d,f,c=null,m=0){const n=this._getElevationQuery(d);
try{const k=await n.queryElevation(a,b,c,m);return"scene"===f?h(k,this._scene,a,b,e,d,f):k}catch(k){return v.throwIfAbortError(k),this.getElevation(a,b,e,d,f)}}register(a,b){this.addHandles(b.on("elevation-change",e=>this.emit("elevation-change",e)),b);this._providersFromContext(a).push(b)}unregister(a){this.removeHandles(a);for(const b of[this._im,this._ground,this._scene]){const e=b.indexOf(a);-1<e&&b.splice(e,1)}}_providersFromContext(a){switch(a){case "ground":return this._ground;case "im":return this._im;
case "scene":return this._scene}}_getElevationQuery(a=this.view.spatialReference){const b=this._elevationQueryCached;if(null!=b&&q.equals(a,b.spatialReference))return b;b?.destroy({completeTasks:!0});const {wkid:e,wkt:d,wkt2:f,latestWkid:c}=a;return this._elevationQueryCached=a=new y.ElevationQuery(this.view.resourceController.scheduler,new x({wkid:e,wkt:d,wkt2:f,latestWkid:c}),()=>this.view.map?.ground,{maximumAutoTileRequests:4})}};l.__decorate([p.property({constructOnly:!0})],g.CombinedElevationProvider.prototype,
"view",void 0);l.__decorate([p.property()],g.CombinedElevationProvider.prototype,"spatialReference",null);g.CombinedElevationProvider=l.__decorate([w.subclass("esri.views.3d.support.CombinedElevationProvider")],g.CombinedElevationProvider);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});