// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(u,z,v,c,h,p,q){const g=h.create(),f=h.create(),k=h.create(),d=h.create(),l=h.create(),n=h.create();var m=h.fromValues(0,0,1),w=h.fromValues(0,1,0),r=h.fromValues(1,0,0);const x=v.create();class A{constructor(a=p.ViewingMode.Global){this.viewingMode=a;this.center=h.create();this.distance=this.yaw=this.pitch=
0;this.lookAtDirection=h.clone(w)}pixelsPerPanAtZoom(a){return this.size/2/(this._zoomToPanScale*a)}zoomAtPixelsPerPan(a){return this.size/2/(this._zoomToPanScale*a)}pixelsPerRotateAtZoom(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)}compareTo(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===p.ViewingMode.Global){var e=c.length(this.center);const t=c.length(a.center);e=(e+t)/2;b.pan=q.angle(this.center,a.center)*e}else b.pan=c.distance(this.center,a.center);
e=Math.abs(a.yaw-this.yaw);e>=Math.PI&&(e=2*Math.PI-e);b.rotate=Math.max(e,Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=a.distance;return b}interpolate(a,b,e){this.viewingMode===p.ViewingMode.Global?q.slerp(a.center,b.center,e.pan,this.center):c.lerp(this.center,a.center,b.center,e.pan);this.distance=isFinite(b.distance)?u.lerp(a.distance,b.distance,e.zoom):a.distance;this.pitch=u.lerp(a.pitch,b.pitch,e.rotate);a=a.yaw;b=b.yaw;Math.abs(b-a)>=Math.PI&&(a+=2*(a<b?1:-1)*Math.PI);
this.yaw=u.lerp(a,b,e.rotate)}copyFrom(a){c.copy(this.center,a.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;c.copy(this.lookAtDirection,a.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode}copyFromRenderCamera(a){const b=this._lookAtOrientation(a.center,x);c.copy(this.center,a.center);c.subtract(d,a.center,a.eye);c.transformMat3(d,d,b);c.transformMat3(l,a.up,b);this.distance=c.length(d);0!==this.distance&&(d[0]/=this.distance,d[1]/=this.distance,
d[2]/=this.distance);this.pitch=this._eyeUpToPitch(d);this.yaw=this._eyeUpToYaw(d,l);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)}copyFromCommon(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(a){const b=this._lookAtOrientation(this.center,x);z.transpose(b,b);this._axisAngleVec3(r,this.pitch-Math.PI/2,w,d);this._axisAngleVec3(m,this.yaw,d);this._axisAngleVec3(r,this.pitch-Math.PI/2,m,l);this._axisAngleVec3(m,this.yaw,l);c.scale(d,d,
this.distance);c.transformMat3(d,d,b);c.transformMat3(l,l,b);a.center=this.center;a.eye=c.subtract(d,this.center,d);a.up=l}_axisAngleVec3(a,b,e,t=e){const y=Math.cos(b);b=Math.sin(b);c.scale(g,e,y);c.cross(f,a,e);c.scale(f,f,b);c.scale(k,a,(1-y)*c.dot(a,e));return c.add(t,c.add(t,g,f),k)}_lookAtOrientation(a,b=v.create()){this._upAtLookAt(a,k);c.cross(g,this.lookAtDirection,k);c.normalize(g,g);0===g[0]&&0===g[1]&&0===g[2]&&c.copy(g,r);c.cross(f,k,g);c.normalize(f,f);b[0]=g[0];b[1]=f[0];b[2]=k[0];
b[3]=g[1];b[4]=f[1];b[5]=k[1];b[6]=g[2];b[7]=f[2];b[8]=k[2];return b}_upAtLookAt(a,b){return this.viewingMode===p.ViewingMode.Local?c.copy(b,m):c.normalize(b,a)}_eyeUpToPitch(a){return Math.PI-q.angle(m,a)}_eyeUpToYaw(a,b){.5>Math.abs(b[2])?(c.copy(n,b),0<a[2]&&c.scale(n,n,-1)):c.copy(n,a);c.cross(f,n,m);c.normalize(f,f);return q.angle(r,f,m)}}return A});