// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../layers/VoxelWasm ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(h,q,r,t,E,F,G,H,I,u,c,f,v,w,x,y,z,A,k,m,B,C){h.ZoomStepController=class extends A.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=f.create();this._tmpCamera=new m.Camera;this._tmpRayDir=f.create();this._tmpCenter=f.create();this._constraintOptions={selection:w.ConstraintTypes.ALL,interactionType:x.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new m.Camera,interactionDirection:null,tiltMode:y.TiltMode.TUMBLE}}zoomStep(d,b){if(this.active){var e=
this.view.state,{interactionStartCamera:a}=this._constraintOptions;a&&(this.animation.finished?a.copyFrom(e.camera):this.animation.cameraAt(1,a));this._tmpCamera.copyFrom(e.camera);a=B.newIntersector(this.view.state.viewingMode);e=!1;0<d?(e=this.intersectionHelper.intersectScreenFreePointFallback(b,this._zoomLocation,0===this.view.map.ground.opacity?k.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,a,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):
this.intersectionHelper.intersectRay(this._tmpCamera.ray,a,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:c.copy(this._zoomLocation,this._tmpCamera.center);d=.6**d;b=this.view._stage.renderView.getMinimalDepthForArea(z.getVoxelWasm(this.view),b[0],b[1],this.view.state.camera,60);c.subtract(l,this._tmpCamera.eye,this._zoomLocation);c.normalize(l,l);a=r.clamp(Math.min(k.zoomDistanceModifier,1/Math.abs(c.dot(D,l)))*Math.abs(this.view.camera.position.z),k.zoomMinDistanceModifier,k.zoomMaxDistanceModifier);
if(b=null!=b?b:a)if(a=f.create(),c.subtract(a,this._zoomLocation,this._tmpCamera.eye),b<c.length(a)||!e)c.normalize(a,a),c.add(this._zoomLocation,this._tmpCamera.eye,c.scale(a,a,b));this._updateCamera(this._tmpCamera,d,this._zoomLocation);this.begin(this._tmpCamera)}}animationSettings(){return{duration:t.Milliseconds(600),easing:C.outExpo}}_updateCamera(d,b,e){c.subtract(this._tmpRayDir,e,d.eye);const a=c.length(this._tmpRayDir);let g=a*b;const n=Math.max(4,1.01*d.nearFar[0]);0!==g&&(1>=b&&g<n&&(g=
n,b=g/a),1E-6>Math.abs(a-g)||(c.scale(this._tmpRayDir,this._tmpRayDir,b),d.eye=c.subtract(p,e,this._tmpRayDir),d.center=c.lerp(p,d.center,e,1-b),v.applyAll(this.view,d,this._constraintOptions)))}};h.ZoomStepController=q.__decorate([u.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],h.ZoomStepController);const p=f.create(),D=f.fromValues(0,0,1),l=f.create();Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});