// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["exports"],function(k){class l{constructor(u,c,f){this._scale=u;this._shift=c;this._levelShift=f}getLevelRowColumn(u){const c=this.getLevelShift(u[0]),f=this._shift+c;return f?[u[0]-c,u[1]>>f,u[2]>>f]:u}getLevelShift(u){return Math.min(u,this._levelShift)}getOffset(u,c){let f=0;var h=0;const e=this._shift+this.getLevelShift(u[0]);e&&(h=(1<<e)-1,c/=this._scale*(1<<e-1),f=(u[2]&h)*c,h=(u[1]&h)*c);return[f,h]}getScale(u){return this._scale*
(1<<this._shift+this.getLevelShift(u))}}k.SchemaHelper=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/TileHandler3D":function(){define("../../../../core/MemCache ../../../../core/promiseUtils ../../../../chunks/mat3f32 ../../../../geometry/support/aaBoundingRect ./TileHandler ./VectorTile ./decluttering/jobsUtil ../../tiling/TileInfoViewPOT ../../tiling/TileKey".split(" "),function(k,l,u,c,f,h,e,g,a){class b extends f.TileHandler{constructor(m,
n,r,q){super(m,n,r);this._memCache=q;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map;this._tileInfoView=new g(m.tileInfo,m.fullExtent)}destroy(){super.destroy();this._ongoingRequestToController.forEach(m=>m.abort());this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()}async getVectorTile(m,n,r,q){n=new a(m,n,r,0);let p=this._memCache.get(n.id);if(null!=p)return p.retain(),p;r=await this._getVectorTileData(n);l.throwIfAborted(q);if(!this._layer)return null;
p=this._memCache.get(n.id);if(null!=p)return p.retain(),p;q=this._layer.tileInfo.getTileBounds(c.create(),n);m=this._tileInfoView.getTileResolution(m);p=new h.VectorTile(n,m,q[0],q[3],512,512,this._styleRepository,this._memCache);r?(p.setData(r),p.retain(),this._memCache.put(n.id,p,p.memoryUsed,k.minPriority)):p.setData(null);p.neededForCoverage=!0;p.transforms.tileUnitsToPixels=u.fromValues(.125,0,0,0,.125,0,0,0,1);e.declutterSingleTile(p);return p}_getVectorTileData(m){const n=m.id;if(this._ongoingTileRequests.has(n))return this._ongoingTileRequests.get(n);
const r=new AbortController;m=this._getParsedVectorTileData(m,{signal:r.signal}).then(q=>{this._ongoingTileRequests.delete(n);this._ongoingRequestToController.delete(n);return q}).catch(()=>{this._ongoingTileRequests.delete(n);this._ongoingRequestToController.delete(n);return null});this._ongoingTileRequests.set(n,m);this._ongoingRequestToController.set(n,r);return m}_getParsedVectorTileData(m,n){return this.fetchTileData(m,n).then(r=>this.parseTileData({key:m,data:r},n))}}return b})},"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ../../tiling/TileKey".split(" "),
function(k,l,u,c,f,h,e,g,a){function b(n){return()=>n.abort()}class m{constructor(n,r,q){this._layer=n;this._styleRepository=r;this.devicePixelRatio=q;this._inputSignalEventListener=this._startOptionsInputSignal=this._spriteSourceAbortController=this._connection=this._glyphMosaic=this._spriteMosaic=null}destroy(){this._connection?.close();this._layer=this._styleRepository=this._connection=null;this._spriteMosaic?.destroy();this._glyphMosaic=this._spriteMosaic=null;this._spriteSourceAbortController=
l.abortMaybe(this._spriteSourceAbortController);this._spriteSourcePromise=null;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._inputSignalEventListener=this._startOptionsInputSignal=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(n){this._requestSprite(n);var r=this._layer.currentStyleInfo.glyphsUrl;r=new e(r?c.addQueryParameters(r,
{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new h(1024,1024,r);this._broadcastPromise=f.open("WorkerTileHandler",{client:this,schedule:n.schedule,signal:n.signal}).then(q=>{this._layer&&(this._connection?.close(),this._connection=q,this._layer&&!this._connection.closed&&(q=q.broadcast("setStyle",this._layer.currentStyleInfo.style,n),Promise.all(q).catch(p=>u.throwIfNotAbortError(p))))})}_requestSprite(n){this._spriteSourceAbortController?.abort();const r=new AbortController;
this._spriteSourceAbortController=r;const q=n?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._startOptionsInputSignal=null;q&&(this._inputSignalEventListener=b(r),q.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const {signal:p}=r;this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,{...n,signal:p});this._spriteSourcePromise.then(x=>{u.throwIfAbortError(p);this._spriteMosaic=
new g(1024,1024,250);this._spriteMosaic.setSpriteSource(x)})}async updateStyle(n){await this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",n))}setSpriteSource(n){const r=new g(1024,1024,250);r.setSpriteSource(n);this._spriteMosaic=r;this._spriteSourcePromise=Promise.resolve(n);this._spriteSourceAbortController=null;return r}async setStyle(n,r){await this._broadcastPromise;this._styleRepository=n;this._requestSprite();n=new e(this._layer.currentStyleInfo.glyphsUrl?
c.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new h(1024,1024,n);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",r))}fetchTileData(n,r){return this._getRefKeys(n,r).then(q=>{const p=this._layer.sourceNameToSource,x=[];for(const y in p)x.push(y);return this._getSourcesData(x,q,r)})}parseTileData(n,r){const q=n&&n.data;if(!q)return Promise.resolve(null);const {sourceName2DataAndRefKey:p,
transferList:x}=q;return 0===Object.keys(p).length?Promise.resolve(null):this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:n.key.id,sourceName2DataAndRefKey:p,styleLayerUIDs:n.styleLayerUIDs},{...r,transferList:x}))}async getSprites(n){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(n)}getGlyphs(n){return this._glyphMosaic.getGlyphItems(n.font,n.codePoints)}async _getTilePayload(n,r,q){n=a.pool.acquire(n.id);const p=this._layer.sourceNameToSource[r],
{level:x,row:y,col:C}=n;a.pool.release(n);try{return{protobuff:await p.requestTile(x,y,C,q),sourceName:r}}catch(D){if(u.isAbortError(D))throw D;return{protobuff:null,sourceName:r}}}_getRefKeys(n,r){const q=this._layer.sourceNameToSource,p=[];for(const x in q){const y=q[x].getRefKey(n,r);p.push(y)}return Promise.allSettled(p)}_getSourcesData(n,r,q){const p=[];for(let y=0;y<r.length;y++){var x=r[y];x="fulfilled"===x.status?x.value:null;null==x||null==n[y]?p.push(null):(x=this._getTilePayload(x,n[y],
q),p.push(x))}return Promise.allSettled(p).then(y=>{const C={},D=[];for(let A=0;A<y.length;A++){var v=y[A];v="fulfilled"===v.status?v.value:null;const G=v?.protobuff;if(v&&G?.byteLength){var z=r[A];if(z="fulfilled"===z.status?z.value:null)C[v.sourceName]={refKey:z.id,protobuff:G},D.push(G)}}return{sourceName2DataAndRefKey:C,transferList:D}})}}k.TileHandler=m;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack",
"../webgl/Rect","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(k,l,u,c,f){class h{constructor(e,g,a){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=e;this.height=g;this._glyphSource=a;this._binPack=new k(e-4,g-4);this._glyphData.push(new Uint8Array(e*g));this._dirties.push(!0);this._textures.push(void 0)}getGlyphItems(e,g){const a=[],b=this._glyphSource,
m=new Set,n=1/256;for(const q of g)m.add(Math.floor(q*n));const r=[];m.forEach(q=>{const p=e+q;this._rangePromises.has(p)?r.push(this._rangePromises.get(p)):(q=b.getRange(e,q).then(()=>{this._rangePromises["delete"](p)},()=>{this._rangePromises["delete"](p)}),this._rangePromises.set(p,q),r.push(q))});return Promise.all(r).then(()=>{let q=this._glyphIndex[e];q||(q={},this._glyphIndex[e]=q);for(const D of g){var p=q[D];if(p){a[D]={sdf:!0,rect:p.rect,metrics:p.metrics,page:p.page,code:D};continue}var x=
b.getGlyph(e,D);if(!x?.metrics)continue;p=x.metrics;let v;if(0===p.width)v=new l(0,0,0,0);else{const z=p.width+6,A=p.height+6;var y=z%4?4-z%4:4,C=A%4?4-A%4:4;1===y&&(y=5);1===C&&(C=5);v=this._binPack.allocate(z+y,A+C);v.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new k(this.width-4,this.height-
4),v=this._binPack.allocate(z+y,A+C));y=this._glyphData[this._currentPage];x=x.bitmap;let G;if(x)for(let F=0;F<A;F++){C=z*F;G=this.width*(v.y+F+1)+v.x;for(let M=0;M<z;M++)y[G+M+1]=x.at(C+M)}}q[D]={rect:v,metrics:p,tileIDs:null,page:this._currentPage};a[D]={sdf:!0,rect:v,metrics:p,page:this._currentPage,code:D};this._dirties[this._currentPage]=!0}return a})}removeGlyphs(e){for(const g in this._glyphIndex){const a=this._glyphIndex[g];if(!a)continue;let b;for(const m in a)if(b=a[m],b.tileIDs["delete"](e),
0===b.tileIDs.size){const n=this._glyphData[b.page],r=b.rect;let q,p;for(let x=0;x<r.height;x++)for(q=this.width*(r.y+x)+r.x,p=0;p<r.width;p++)n[q+p]=0;delete a[m];this._dirties[b.page]=!0}}}bind(e,g,a,b=0){if(!this._textures[a]){var m=new f.TextureDescriptor;m.pixelFormat=u.PixelFormat.ALPHA;m.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE;m.width=this.width;m.height=this.height;this._textures[a]=new c.Texture(e,m,new Uint8Array(this.width*this.height))}m=this._textures[a];m.setSamplingMode(g);this._dirties[a]&&
m.setData(this._glyphData[a]);e.bindTexture(m,b);this._dirties[a]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0;this._binPack=null;for(const e of this._textures)e&&e.dispose();this._textures.length=0}}return h})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(k){class l{constructor(u,c){this._height=this._width=0;this._free=[];this._width=u;this._height=c;this._free.push(new k(0,0,u,c))}get width(){return this._width}get height(){return this._height}allocate(u,
c){if(u>this._width||c>this._height)return new k;let f=null,h=-1;for(let e=0;e<this._free.length;++e){const g=this._free[e];u<=g.width&&c<=g.height&&(null===f||g.y<=f.y&&g.x<=f.x)&&(f=g,h=e)}if(null===f)return new k;this._free.splice(h,1);f.width<f.height?(f.width>u&&this._free.push(new k(f.x+u,f.y,f.width-u,c)),f.height>c&&this._free.push(new k(f.x,f.y+c,f.width,f.height-c))):(f.width>u&&this._free.push(new k(f.x+u,f.y,f.width-u,f.height)),f.height>c&&this._free.push(new k(f.x,f.y+c,u,f.height-c)));
return new k(f.x,f.y,u,c)}release(u){for(let c=0;c<this._free.length;++c){const f=this._free[c];if(f.y===u.y&&f.height===u.height&&f.x+f.width===u.x)f.width+=u.width;else if(f.x===u.x&&f.width===u.width&&f.y+f.height===u.y)f.height+=u.height;else if(u.y===f.y&&u.height===f.height&&u.x+u.width===f.x)f.x=u.x,f.width+=u.width;else if(u.x===f.x&&u.width===f.width&&u.y+u.height===f.y)f.y=u.y,f.height+=u.height;else continue;this._free.splice(c,1);this.release(u)}this._free.push(u)}}return l})},"esri/views/2d/engine/webgl/Rect":function(){define(function(){class k{constructor(l=
0,u=0,c=0,f=0){this.x=l;this.y=u;this.width=c;this.height=f}get isEmpty(){return 0>=this.width||0>=this.height}union(l){this.x=Math.min(this.x,l.x);this.y=Math.min(this.y,l.y);this.width=Math.max(this.width,l.width);this.height=Math.max(this.height,l.height)}}return k})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(k,l){class u{constructor(e){this._metrics=[];if(e){for(var g=new Map,a=0;e.next();)switch(e.tag()){case 1:const m=
e.getMessage();for(;m.next();)switch(m.tag()){case 3:var b=m.getMessage();let n,r,q,p,x,y,C;for(;b.next();)switch(b.tag()){case 1:n=b.getUInt32();break;case 2:r=b.getBytes();break;case 3:q=b.getUInt32();break;case 4:p=b.getUInt32();break;case 5:x=b.getSInt32();break;case 6:y=b.getSInt32();break;case 7:C=b.getUInt32();break;default:b.skip()}b.release();n&&(b=r?.length??0,this._metrics[n]={width:q,height:p,left:x,top:y,advance:C,startOffset:a,length:b},g.set(n,r),a+=b);break;default:m.skip()}m.release();
break;default:e.skip()}e=new Uint8Array(a);a=this._metrics;for(const [m,n]of g){const {startOffset:r,length:q}=a[m];if(n)for(g=0;g<q;++g)e[r+g]=n[g]}this._allBitmaps=e}else this._allBitmaps=null}getMetrics(e){return this._metrics[e]}getBitmap(e){if(this._allBitmaps&&(e=this._metrics[e],void 0!==e)){var {startOffset:g,length:a}=e;if(0!==a)return new h(this._allBitmaps,g,a)}}}class c{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(e){return this._ranges[e]}addRange(e,g){this._ranges[e]=
g}}class f{constructor(e){this._glyphInfo={};this._baseURL=e}getRange(e,g){const a=this._getFontStack(e);if(a.getRange(g))return Promise.resolve();const b=256*g,m=b+255;if(this._baseURL)return e=this._baseURL.replace("{fontstack}",e).replace("{range}",b+"-"+m),k(e,{responseType:"array-buffer"}).then(n=>{a.addRange(g,new u(new l(new Uint8Array(n.data),new DataView(n.data))))}).catch(()=>{a.addRange(g,new u)});a.addRange(g,new u);return Promise.resolve()}getGlyph(e,g){if(e=this._getFontStack(e))if(e=
e.getRange(Math.floor(g/256)))return{metrics:e.getMetrics(g),bitmap:e.getBitmap(g)}}_getFontStack(e){let g=this._glyphInfo[e];g||(g=this._glyphInfo[e]=new c);return g}}class h{constructor(e,g,a){this._array=e;this._start=g;this.length=a}at(e){return 0<=e&&e<this.length?this._array[this._start+e]:void 0}}return f})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../symbols/cim/rasterizingUtils ./RectangleBinPack ../webgl/Rect ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(k,l,u,c,f,h){class e{constructor(g,a,b=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=g||0>=a)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=g;this._pageHeight=a;0<b&&(this._maxItemSize=b);this._binPack=new l(g-4,a-4)}destroy(){this.dispose()}dispose(){this._binPack=null;this._mosaicsData.length=
0;this._mosaicRects={};for(const g of this._textures)g&&g.dispose();this._textures.length=0}getWidth(g){return g>=this._size.length?-1:this._size[g][0]}getHeight(g){return g>=this._size.length?-1:this._size[g][1]}getPageSize(g){return g>=this._size.length?null:this._size[g]}setSpriteSource(g){this.dispose();this.pixelRatio=g.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new l(this._pageWidth-4,this._pageHeight-4);const a=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));
this._mosaicsData[0]=a;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=g}getSpriteItem(g,a=!1){var b=this._mosaicRects[g];if(b)return b;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let m;g&&g.startsWith("dasharray-")?([b,m]=this._rasterizeDash(g),a=!0):b=this._sprites.getSpriteInfo(g);if(!b?.width||!b.height||0>b.width||0>b.height)return null;const n=b.width,r=b.height,[q,p,x]=this._allocateImage(n,r);if(0>=
q.width)return null;this._copy(q,b,p,x,a,m);b={rect:q,width:n,height:r,sdf:b.sdf,simplePattern:!1,pixelRatio:b.pixelRatio,page:p};return this._mosaicRects[g]=b}getSpriteItems(g){const a={};for(const b of g)a[b.name]=this.getSpriteItem(b.name,b.repeat);return a}getMosaicItemPosition(g,a){a=(g=this.getSpriteItem(g,a))&&g.rect;if(!a)return null;a.width=g.width;a.height=g.height;return{tl:[a.x+2,a.y+2],br:[a.x+2+g.width,a.y+2+g.height],page:g.page}}bind(g,a,b=0,m=0){if(!(b>=this._size.length||b>=this._mosaicsData.length)){if(!this._textures[b]){var n=
new h.TextureDescriptor;n.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;n.width=this._size[b][0];n.height=this._size[b][1];this._textures[b]=new f.Texture(g,n,new Uint8Array(this._mosaicsData[b].buffer))}n=this._textures[b];n.setSamplingMode(a);this._dirties[b]&&n.setData(new Uint8Array(this._mosaicsData[b].buffer));g.bindTexture(n,m);this._dirties[b]=!1}}static _copyBits(g,a,b,m,n,r,q,p,x,y,C){let D=m*a+b;q=p*r+q;if(C)for(q-=r,C=-1;C<=y;C++,D=((C+y)%y+m)*a+b,q+=r)for(p=-1;p<=x;p++)n[q+p]=g[D+(p+x)%x];
else for(b=0;b<y;b++){for(m=0;m<x;m++)n[q+m]=g[D+m];D+=a;q+=r}}_copy(g,a,b,m,n,r){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(b>=this._mosaicsData.length)){var q=new Uint32Array(r?r.buffer:this._sprites.image.buffer),p=this._mosaicsData[b];p&&q||console.error("Source or target images are uninitialized!");e._copyBits(q,r?a.width:this._sprites.width,a.x,a.y,p,m[0],g.x+2,g.y+2,a.width,a.height,n);this._dirties[b]=!0}}_allocateImage(g,a){g+=2;a+=2;var b=Math.max(g,a);if(this._maxItemSize&&
this._maxItemSize<b)return b=new u(0,0,g,a),this._mosaicsData.push(new Uint32Array(g*a)),this._dirties.push(!0),this._size.push([g,a]),this._textures.push(void 0),[b,this._mosaicsData.length-1,[g,a]];b=g%4?4-g%4:4;let m=a%4?4-a%4:4;1===b&&(b=5);1===m&&(m=5);b=this._binPack.allocate(g+b,a+m);return 0>=b.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),
this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new l(this._pageWidth-4,this._pageHeight-4),this._allocateImage(g,a)):[b,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(g){var a=g.match(/\[(.*?)\]/);if(!a)return null;a=a[1].split(",").map(Number);g=g.slice(g.lastIndexOf("-")+1);const [b,m,n]=k.rasterizeDash(a,g);g=new Uint8Array(b.buffer);return[{x:0,y:0,width:m,height:n,sdf:!0,pixelRatio:1},g]}}return e})},
"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/mathUtils"],function(k,l,u){k.rasterizeDash=function(c,f){var h="Butt"===f,e="Square"===f;f=!h&&!e;1===c.length%2&&(c=[...c,...c]);var g=0;for(var a of c)g+=a;a=Math.round(15.5*g);g=new Float32Array(31*a);let b=0,m=0,n=.5,r=!0;for(var q of c){b=m;for(m+=15.5*q;n<=m;){for(c=.5;31>c;){const p=f?(c-15.5)*(c-15.5):Math.abs(c-15.5);g[(c-.5)*a+n-.5]=r?h?Math.max(Math.max(b+7.75-n,p),Math.max(n-m+7.75,p)):
p:f?Math.min((n-b)*(n-b)+p,(n-m)*(n-m)+p):e?Math.min(Math.max(n-b,p),Math.max(m-n,p)):Math.min(Math.max(n-b+7.75,p),Math.max(m+7.75-n,p));c++}n++}r=!r}h=g.length;q=new Uint8Array(4*h);for(e=0;e<h;++e)l.packFloatRGBA((f?Math.sqrt(g[e]):g[e])/15.5,q,4*e);return[q,a,31]};k.rasterizeSimpleFill=function(c,f,h){h=u.nextPowerOfTwo(Math.ceil(h));var e="vertical"===f||"horizontal"===f||"cross"===f||"esriSFSCross"===f||"esriSFSVertical"===f||"esriSFSHorizontal"===f?8*h:16*h;const g=2*h;c.width=e;c.height=e;
const a=c.getContext("2d");a.strokeStyle="#FFFFFF";a.lineWidth=h;a.beginPath();if("vertical"===f||"cross"===f||"esriSFSCross"===f||"esriSFSVertical"===f)a.moveTo(e/2,-g),a.lineTo(e/2,e+g);if("horizontal"===f||"cross"===f||"esriSFSCross"===f||"esriSFSHorizontal"===f)a.moveTo(-g,e/2),a.lineTo(e+g,e/2);if("forward-diagonal"===f||"diagonal-cross"===f||"esriSFSDiagonalCross"===f||"esriSFSForwardDiagonal"===f)a.moveTo(-g,-g),a.lineTo(e+g,e+g),a.moveTo(e-g,-g),a.lineTo(e+g,g),a.moveTo(-g,e-g),a.lineTo(g,
e+g);if("backward-diagonal"===f||"diagonal-cross"===f||"esriSFSBackwardDiagonal"===f||"esriSFSDiagonalCross"===f)a.moveTo(e+g,-g),a.lineTo(-g,e+g),a.moveTo(g,-g),a.lineTo(-g,g),a.moveTo(e+g,e-g),a.lineTo(e-g,e+g);a.stroke();f=a.getImageData(0,0,c.width,c.height);f=new Uint8Array(f.data);for(e=0;e<f.length;e+=4)h=f[e+3]/255,f[e]*=h,f[e+1]*=h,f[e+2]*=h;return[f,c.width,c.height]};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/jobsUtil":function(){define("exports ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),
function(k,l,u,c,f,h,e){k.declutterSingleTile=function(g){const a=[],b=new f.SymbolRepository(4096,a,()=>{const n=new l.VTLUniqueSymbol;n.show=!1;n.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1});n.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1});return n}),m=new c.SymbolDeclutterer(a,b,(n,r,q)=>new u.CollisionJob(n,r,q,g.styleRepository,g.key.level,0),(n,r)=>{h.writeOpacityToBuffers(n,r,!1)},()=>0,n=>(n=g.styleRepository.getStyleLayerByUID(n).getLayoutProperty("visibility"))&&
n.getValue()===e.Visibility.NONE?!1:!0);a.push(g);b.add(g);m.setScreenSize(512,512);m.continue(Infinity)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../chunks/mat3f32","./config","./util","../style/StyleDefinition"],function(k,l,u,c,f){class h{constructor(e,g,a,b,m,n){this._symbols=e;this._styleRepository=b;this._zoom=m;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=
new Map;this._allNeededMatrices=new Map;this._gridIndex=new c.GridIndex(g,a,u.collisionGridCellSize);this._si=Math.sin(Math.PI*n/180);this._co=Math.cos(Math.PI*n/180);for(const r of e)for(const q of r.symbols)this._allNeededMatrices.has(q.tile)||this._allNeededMatrices.set(q.tile,l.clone(q.tile.transforms.tileUnitsToPixels))}work(e){const g=this._gridIndex,a=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const v=this._symbols[this._currentLayerCursor],
z=this._getProperties(v.styleLayerUID);for(;this._currentSymbolCursor<v.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-a>e)return!1;var b=v.symbols[this._currentSymbolCursor];if(!b.unique.show)continue;var m=b,n=this._si,r=this._co,q=this._allNeededMatrices.get(b.tile),p=this._zoom;const {iconRotationAlignment:A,textRotationAlignment:G,iconTranslate:F,iconTranslateAnchor:M,textTranslate:J,textTranslateAnchor:K}=z;var x=0;for(const E of m.colliders){const [P,
Q]=0===E.partIndex?F:J;var y=0===E.partIndex?M:K,C=E.minLod<=p&&p<=E.maxLod;x+=C?0:1;E.enabled=C;E.xScreen=E.xTile*q[0]+E.yTile*q[3]+q[6];E.yScreen=E.xTile*q[1]+E.yTile*q[4]+q[7];y===f.TranslateAnchor.MAP?(E.xScreen+=r*P-n*Q,E.yScreen+=n*P+r*Q):(E.xScreen+=P,E.yScreen+=Q);f.RotationAlignment.VIEWPORT===(0===E.partIndex?A:G)?(E.dxScreen=E.dxPixels,E.dyScreen=E.dyPixels):(E.dxScreen=r*(E.dxPixels+E.width/2)-n*(E.dyPixels+E.height/2)-E.width/2,E.dyScreen=n*(E.dxPixels+E.width/2)+r*(E.dyPixels+E.height/
2)-E.height/2)}0<m.colliders.length&&x===m.colliders.length&&(m.unique.show=!1);m=b.unique;if(!m.show)continue;const {iconAllowOverlap:N,iconIgnorePlacement:H,textAllowOverlap:L,textIgnorePlacement:R}=z;for(const E of b.colliders)if(E.enabled&&(n=m.parts[E.partIndex],n.show)){if(r=!(E.partIndex?L:N))a:{r=E.xScreen+E.dxScreen;q=E.yScreen+E.dyScreen;p=r+E.width;x=q+E.height;const [P,Q,U,Y]=g.getCellSpan(r,q,p,x);for(y=Q;y<=Y;y++)for(C=P;C<=U;C++){var D=g.cells[y][C];for(const Z of D){D=Z.xScreen+Z.dxScreen;
const ba=Z.yScreen+Z.dyScreen,V=D+Z.width,W=ba+Z.height;if(!(p<D||r>V||x<ba||q>W)){r=!0;break a}}}r=!1}r&&(E.hard?m.show=!1:n.show=!1)}if(m.show)for(const E of b.colliders){if(!E.enabled)continue;if(E.partIndex?R:H)continue;if(!m.parts[E.partIndex].show)continue;b=E.xScreen+E.dxScreen;n=E.yScreen+E.dyScreen;const [P,Q,U,Y]=this._gridIndex.getCellSpan(b,n,b+E.width,n+E.height);for(b=Q;b<=Y;b++)for(n=P;n<=U;n++)this._gridIndex.cells[b][n].push(E)}}}return!0}_getProperties(e){var g=this._styleProps.get(e);
if(g)return g;g=this._zoom;const a=this._styleRepository.getStyleLayerByUID(e);var b=a.getLayoutValue("symbol-placement",g)!==f.SymbolPlacement.POINT;let m=a.getLayoutValue("icon-rotation-alignment",g);m===f.RotationAlignment.AUTO&&(m=b?f.RotationAlignment.MAP:f.RotationAlignment.VIEWPORT);let n=a.getLayoutValue("text-rotation-alignment",g);n===f.RotationAlignment.AUTO&&(n=b?f.RotationAlignment.MAP:f.RotationAlignment.VIEWPORT);b=a.getPaintValue("icon-translate",g);const r=a.getPaintValue("icon-translate-anchor",
g),q=a.getPaintValue("text-translate",g),p=a.getPaintValue("text-translate-anchor",g);g={iconAllowOverlap:a.getLayoutValue("icon-allow-overlap",g),iconIgnorePlacement:a.getLayoutValue("icon-ignore-placement",g),textAllowOverlap:a.getLayoutValue("text-allow-overlap",g),textIgnorePlacement:a.getLayoutValue("text-ignore-placement",g),iconRotationAlignment:m,textRotationAlignment:n,iconTranslateAnchor:r,iconTranslate:b,textTranslateAnchor:p,textTranslate:q};this._styleProps.set(e,g);return g}}k.CollisionJob=
h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","./config"],function(k,l){function u(f,h){if(f.priority-h.priority)return f.priority-h.priority;const e=f.tile.key,g=h.tile.key;return e.world-g.world?e.world-g.world:e.level-g.level?e.level-g.level:e.row-g.row?e.row-g.row:e.col-g.col?e.col-g.col:f.xTile-h.xTile?f.xTile-h.xTile:f.yTile-h.yTile}class c{get running(){return this._running}constructor(f,
h,e,g,a,b){this._visibleTiles=f;this._symbolRepository=h;this._createCollisionJob=e;this._assignTileSymbolsOpacity=g;this._symbolLayerSorter=a;this._isLayerVisible=b;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}setScreenSize(f,h){this._screenWidth===f&&this._screenHeight===h||this.restart();this._screenWidth=f;this._screenHeight=h}restart(){this._selectionJob=null;this._selectionJobCompleted=
!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}continue(f){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var h=performance.now();if(!this._selectionJob.work(f))return!1;this._selectionJobCompleted=!0;f=Math.max(0,f-(performance.now()-h));if(0===f)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,
this._screenHeight));if(!this._collisionJobCompleted){h=performance.now();if(!this._collisionJob.work(f))return!1;this._collisionJobCompleted=!0;f=Math.max(0,f-(performance.now()-h));if(0===f)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){h=performance.now();if(!this._opacityJob.work(f))return!1;this._opacityJobCompleted=!0;f=Math.max(0,f-(performance.now()-h));if(0===f)return!1}this._running=!1;return!0}_createSelectionJob(){const f=this._symbolRepository.uniqueSymbols;
for(let m=0;m<f.length;m++){const n=f[m];for(let r=0;r<n.uniqueSymbols.length;r++){const q=n.uniqueSymbols[r];for(const p of q.tileSymbols)p.selectedForRendering=!1}}const h=[];let e=0,g=0;const a=this._isLayerVisible,b=this._symbolLayerSorter;return{work:function(m){const n=performance.now();for(;g<f.length;g++,e=0){const q=f[g];var r=q.styleLayerUID;if(!a(r)){h[g]||(h[g]={styleLayerUID:r,symbols:[]});continue}h[g]=h[g]||{styleLayerUID:r,symbols:[]};const p=h[g];for(;e<q.uniqueSymbols.length;e++){r=
q.uniqueSymbols[e];if(99===e%100&&performance.now()-n>m)return!1;let x=null,y=!1,C=!1;for(const D of r.tileSymbols)if(!C||!y){const v=D.tile;if(!x||v.isCoverage||v.neededForCoverage&&!y){x=D;if(v.neededForCoverage||v.isCoverage)C=!0;v.isCoverage&&(y=!0)}}x.selectedForRendering=!0;if(C){p.symbols.push(x);r.show=!0;for(const D of r.parts)D.show=!0}else r.show=!1}}for(const q of h)q.symbols.sort(u);return!0},get sortedSymbols(){return h.sort(b)}}}_createOpacityJob(){function f(a,b){var m=a.symbols;for(const [,
r]of m){var n=r;m=b;for(const q of n){n=q.unique;for(const p of n.parts)p.startOpacity+=(m-p.startTime)/l.fadeDuration*(.5<p.targetOpacity?1:-1),p.startOpacity=Math.min(Math.max(p.startOpacity,0),1),p.startTime=m,p.targetOpacity=n.show&&p.show?1:0}}h(a,b);for(const r of a.childrenTiles)f(r,b)}const h=this._assignTileSymbolsOpacity,e=this._visibleTiles;let g=0;return{work(a){const b=performance.now();for(;g<e.length;g++){if(performance.now()-b>a)return!1;const m=e[g];if(null!=m.parentTile)continue;
const n=performance.now();f(m,n)}return!0}}}}k.SymbolDeclutterer=c;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","./util"],function(k,l){class u{constructor(c,f,h){this.tileCoordRange=c;this._visibleTiles=f;this._createUnique=h;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());
return this._uniqueSymbolLayerArray}add(c,f){this._uniqueSymbolLayerArray=null;let h=this._tiles.get(c.id);h||(h={symbols:new Map},this._tiles.set(c.id,h));var e=new Map;if(f)for(var g of f)h.symbols.has(g)&&(e.set(g,h.symbols.get(g)),h.symbols.delete(g));else for(var [a]of c.layerData)h.symbols.has(a)&&(e.set(a,h.symbols.get(a)),h.symbols.delete(a));this._removeSymbols(e);f=c.symbols;e=new Map;for(const [b,m]of f)if(g=m.length,32<=g){a=this.tileCoordRange;do a/=2,g/=4;while(8<g&&64<a);g=new l.GridIndex(this.tileCoordRange,
this.tileCoordRange,a);e.set(b,{flat:m,index:g});h.symbols.set(b,{flat:m,index:g});for(const n of m)g.getCell(n.xTile,n.yTile).push(n)}else e.set(b,{flat:m}),h.symbols.set(b,{flat:m});this._addSymbols(c.key,f)}deleteStyleLayers(c){this._uniqueSymbolLayerArray=null;for(const [f,h]of this._tiles){const e=new Map;for(const g of c)h.symbols.has(g)&&(e.set(g,h.symbols.get(g)),h.symbols.delete(g));this._removeSymbols(e);0===h.symbols.size&&this._tiles.delete(f)}}removeTile(c){this._uniqueSymbolLayerArray=
null;const f=this._tiles.get(c.id);if(f){var h=new Map;for(const [e]of c.symbols)f.symbols.has(e)&&(h.set(e,f.symbols.get(e)),f.symbols.delete(e));this._removeSymbols(h);0===f.symbols.size&&this._tiles.delete(c.id)}}_removeSymbols(c){for(const [h,{flat:e}]of c)for(const g of e){c=g.unique;var f=c.tileSymbols;const a=f.length-1;for(let b=0;b<a;b++)if(f[b]===g){f[b]=f[a];break}f.length=a;0===a&&(f=this._uniqueSymbolsReferences.get(h),f.delete(c),0===f.size&&this._uniqueSymbolsReferences.delete(h));
g.unique=null}}_addSymbols(c,f){if(0!==f.size){var h=this._visibleTiles;for(const e of h)e.parentTile||e.key.world!==c.world||e.key.level===c.level&&!e.key.equals(c)||this._matchSymbols(e,c,f);for(const [e,g]of f)for(const a of g)null==a.unique&&(c=this._createUnique(),a.unique=c,c.tileSymbols.push(a),f=this._uniqueSymbolsReferences.get(e),f||(f=new Set,this._uniqueSymbolsReferences.set(e,f)),f.add(c))}}_matchSymbols(c,f,h){if(c.key.level>f.level){var e=c.key.level-f.level;if(c.key.row>>e!==f.row||
c.key.col>>e!==f.col)return}if(f.level>c.key.level&&(e=f.level-c.key.level,f.row>>e!==c.key.row||f.col>>e!==c.key.col))return;if(f.equals(c.key))for(var g of c.childrenTiles)this._matchSymbols(g,f,h);else{g=new Map;for(const [m,n]of h){var a=[];for(const q of n)h=l.tileCoordChange(this.tileCoordRange,q.xTile,f.level,f.col,c.key.level,c.key.col),e=l.tileCoordChange(this.tileCoordRange,q.yTile,f.level,f.row,c.key.level,c.key.row),0<=h&&h<this.tileCoordRange&&0<=e&&e<this.tileCoordRange&&a.push({symbol:q,
xTransformed:h,yTransformed:e});h=[];e=c.key.level<f.level?1:1<<c.key.level-f.level;const r=this._tiles.get(c.id).symbols.get(m);if(r){const q=r.flat;for(const p of a){var b=!1;let x;const y=p.xTransformed,C=p.yTransformed;x=null!=r.index?r.index.getCell(y,C):q;a=p.symbol;const D=a.hash;for(const v of x)if(D===v.hash&&Math.abs(y-v.xTile)<=e&&Math.abs(C-v.yTile)<=e){b=v.unique;a.unique=b;b.tileSymbols.push(a);b=!0;break}b||h.push(a)}}0<h.length&&g.set(m,h)}for(const m of c.childrenTiles)this._matchSymbols(m,
f,g)}}_createUniqueSymbolLayerArray(){var c=this._uniqueSymbolsReferences;const f=Array(c.size);let h=0;for(const [e,g]of c){const a=Array(g.size);c=0;for(const b of g)a[c++]=b;f[h]={styleLayerUID:e,uniqueSymbols:a};h++}return f}}k.SymbolRepository=u;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(k,l,u){class c extends l{constructor(){super(...arguments);
this._fullCacheLodInfos=null;this._levelByScale={}}getTileParentId(f){f=u.pool.acquire(f);const h=0===f.level?null:u.getId(f.level-1,f.row>>1,f.col>>1,f.world);u.pool.release(f);return h}getTileCoverage(f,h,e=!0,g){f=super.getTileCoverage(f,h,e,g);if(!f)return f;const a=1<<f.lodInfo.level;f.spans=f.spans.filter(b=>0<=b.row&&b.row<a);return f}scaleToLevel(f){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[f])return this._levelByScale[f];var h=this._fullCacheLodInfos;
if(f>h[0].scale)return h[0].level;let e;for(let g=0;g<h.length-1;g++)if(e=h[g+1],f>e.scale)return h=h[g],h.level+(h.scale-f)/(h.scale-e.scale);return h[h.length-1].level}_initializeFullCacheLODs(f){f=0===f[0].level?f.map(h=>({level:h.level,resolution:h.resolution,scale:h.scale})):k.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(h=>({level:h.level,resolution:h.resolution,scale:h.scale}));for(let h=0;h<f.length;h++)this._levelByScale[f[h].scale]=f[h].level;
this._fullCacheLodInfos=f}}return c})},"esri/views/2d/engine/vectorTiles/VTLPainter3D":function(){define(["../../../../core/maybe","../vtlBrushes","./shaders/VTLMaterialManager","./style/StyleDefinition","../../../webgl/enums"],function(k,l,u,c,f){class h{constructor(e,g){this.spriteMosaic=e;this.glyphMosaic=g;this._brushCache=new Map;this._vtlMaterialManager=new u}dispose(){this._brushCache&&(this._brushCache.forEach(e=>e.dispose()),this._brushCache=null);this._vtlMaterialManager=k.disposeMaybe(this._vtlMaterialManager);
this.spriteMosaic.dispose();this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawSymbols(e,g,a){a=a.layers;e.renderPass="translucent";for(let m=0;m<a.length;m++){const n=a[m];if(n.type===c.StyleLayerType.SYMBOL){var b=n.getLayoutProperty("visibility");b&&b.getValue()===c.Visibility.NONE||(b=e.displayLevel,void 0!==n.minzoom&&n.minzoom>b+1E-6||void 0!==n.maxzoom&&n.maxzoom<=b-1E-6||(e.styleLayerUID=n.uid,e.styleLayer=n,this._drawWithBrush(e,g,"vtlSymbol")))}}}drawBackground(e,
g,a){if(0!==a.backgroundBucketIds.length){var {context:b,displayLevel:m,requiredLevel:n}=e;g.key.level=n;b.setBlendingEnabled(!0);b.setDepthTestEnabled(!1);b.setStencilTestEnabled(!1);e.renderPass="background";a.backgroundBucketIds.forEach(r=>{r=a.getLayerById(r);if(r.type===c.StyleLayerType.BACKGROUND){var q=r.getLayoutProperty("visibility");q&&q.getValue()===c.Visibility.NONE||void 0!==r.minzoom&&r.minzoom>m+1E-6||void 0!==r.maxzoom&&r.maxzoom<=m-1E-6||(e.styleLayerUID=r.uid,e.styleLayer=r,this._drawWithBrush(e,
g,"vtlBackground"))}})}}drawTile(e,g,a,b){const {context:m}=e;a=a.layers;m.setBlendingEnabled(!1);m.setDepthTestEnabled(!0);m.setDepthWriteEnabled(!0);m.setDepthFunction(f.CompareFunction.LEQUAL);e.renderPass="opaque";for(var n=a.length-1;0<=n;n--){var r=a[n];null!=b&&b!==r.type||this._renderStyleLayer(r,e,g,!1)}m.setDepthWriteEnabled(!1);m.setBlendingEnabled(!0);m.setBlendFunctionSeparate(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA);e.renderPass=
"translucent";for(n=0;n<a.length;n++)r=a[n],null!=b&&b!==r.type||this._renderStyleLayer(r,e,g,!1);m.setDepthTestEnabled(!1);m.bindVAO()}_renderStyleLayer(e,g,a,b){if(b||e&&a.layerData.has(e.uid))if(b=e.getLayoutProperty("visibility"),!b||b.getValue()!==c.Visibility.NONE){({renderPass:b}=g);switch(e.type){case c.StyleLayerType.BACKGROUND:if("background"!==b)return;var m="vtlBackground";break;case c.StyleLayerType.FILL:if("opaque"!==b&&"translucent"!==g.renderPass)return;m="vtlFill";break;case c.StyleLayerType.LINE:if("translucent"!==
b)return;m="vtlLine";break;case c.StyleLayerType.CIRCLE:if("translucent"!==b)return;m="vtlCircle";break;case c.StyleLayerType.SYMBOL:if("translucent"!==b)return;m="vtlSymbol"}b=g.displayLevel;void 0!==e.minzoom&&e.minzoom>b+1E-6||void 0!==e.maxzoom&&e.maxzoom<=b-1E-6||({context:b}=g,b.setStencilTestEnabled(!1),b.setStencilWriteMask(0),g.styleLayerUID=e.uid,g.styleLayer=e,this._drawWithBrush(g,a,m))}}_drawWithBrush(e,g,a){this._brushCache.has(a)||this._brushCache.set(a,new l.vtlBrushes[a]);this._brushCache.get(a).drawMany(e,
[g])}}return h})},"esri/views/2d/engine/vtlBrushes":function(){define("exports ./webgl/brushes/WGLBrushVTLBackground ./webgl/brushes/WGLBrushVTLCircle ./webgl/brushes/WGLBrushVTLFill ./webgl/brushes/WGLBrushVTLLine ./webgl/brushes/WGLBrushVTLSymbol".split(" "),function(k,l,u,c,f,h){k.vtlBrushes={vtlBackground:l.WGLBrushVTLBackground,vtlFill:c.WGLBrushVTLFill,vtlLine:f.WGLBrushVTLLine,vtlCircle:u.WGLBrushVTLCircle,vtlSymbol:h.WGLBrushVTLSymbol};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("exports ../../../../../core/mathUtils ../../../../../chunks/mat3f32 ../../../../../chunks/vec4f32 ../definitions ../enums ../number ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),function(k,l,u,c,f,h,e,g,a,b,m){class n extends g{constructor(){super(...arguments);this._color=c.fromValues(1,0,0,1);this._patternMatrix=u.create();this._programOptions={id:!1,
pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(r,q){const {context:p,painter:x,styleLayerUID:y,requestRender:C,allowDelayedRender:D}=r;this._loadWGLResources(r);const v=r.displayLevel;var z=r.styleLayer,A=z.backgroundMaterial;const G=x.vectorTilesMaterialManager;var F=z.getPaintValue("background-color",v);const M=z.getPaintValue("background-opacity",v),J=z.getPaintValue("background-pattern",v),K=void 0!==J,N=F[3]*M,H=r.spriteMosaic;let L,R;const E=(window.devicePixelRatio|
1)>f.vtlHighResCutoff?2:1;r=r.drawPhase===h.WGLDrawPhase.HITTEST;const P=this._programOptions;P.id=r;P.pattern=K;A=G.getMaterialProgram(p,A,P);if(D&&null!=C&&!A.compiled)C();else{p.bindVAO(this._vao);p.useProgram(A);if(K){F=H.getMosaicItemPosition(J,!0);if(null!=F){const {tl:Q,br:U,page:Y}=F;L=U[0]-Q[0];R=U[1]-Q[1];F=H.getPageSize(Y);null!=F&&(H.bind(p,b.TextureSamplingMode.LINEAR,Y,f.vtlTextureBindingUnitSprites),A.setUniform4f("u_tlbr",Q[0],Q[1],U[0],U[1]),A.setUniform2fv("u_mosaicSize",F),A.setUniform1i("u_texture",
f.vtlTextureBindingUnitSprites))}A.setUniform1f("u_opacity",M)}else this._color[0]=N*F[0],this._color[1]=N*F[1],this._color[2]=N*F[2],this._color[3]=N,A.setUniform4fv("u_color",this._color);A.setUniform1f("u_depth",z.z||0);r&&(z=e.u32to4Xu8(y+1),A.setUniform4fv("u_id",z));for(const Q of q)A.setUniform1f("u_coord_range",Q.rangeX),A.setUniformMatrix3fv("u_dvsMat3",Q.transforms.dvs),K&&(z=E*Q.width*Math.max(2**(Math.round(v)-Q.key.level),1),q=z/l.nextPowerOfTwo(L),z/=l.nextPowerOfTwo(R),this._patternMatrix[0]=
q,this._patternMatrix[4]=z,A.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),p.setStencilFunction(b.CompareFunction.EQUAL,0,255),p.drawArrays(b.PrimitiveType.TRIANGLE_STRIP,0,4)}}_loadWGLResources(r){if(!this._vao){var {context:q,styleLayer:p}=r;r=p.backgroundMaterial;var x=new Int8Array([0,0,1,0,0,1,1,1]);x=a.BufferObject.createVertex(q,b.Usage.STATIC_DRAW,x);this._vao=new m.VertexArrayObject(q,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:x})}}}k.WGLBrushVTLBackground=n;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec4f32":function(){define(["exports"],function(k){function l(){return new Float32Array(4)}function u(D){const v=new Float32Array(4);v[0]=D[0];v[1]=D[1];v[2]=D[2];v[3]=D[3];return v}function c(D,v,z,A){const G=new Float32Array(4);G[0]=D;G[1]=v;G[2]=z;G[3]=A;return G}function f(D,v){return new Float32Array(D,v,4)}function h(){return l()}function e(){return c(1,1,1,1)}function g(){return c(1,0,0,0)}function a(){return c(0,1,0,0)}function b(){return c(0,
0,1,0)}function m(){return c(0,0,0,1)}const n=l(),r=e(),q=g(),p=a(),x=b(),y=m(),C=Object.freeze(Object.defineProperty({__proto__:null,ONES:r,UNIT_W:y,UNIT_X:q,UNIT_Y:p,UNIT_Z:x,ZEROS:n,clone:u,create:l,createView:f,fromValues:c,ones:e,unitW:m,unitX:g,unitY:a,unitZ:b,zeros:h},Symbol.toStringTag,{value:"Module"}));k.ONES=r;k.UNIT_W=y;k.UNIT_X=q;k.UNIT_Y=p;k.UNIT_Z=x;k.ZEROS=n;k.clone=u;k.create=l;k.createView=f;k.fromValues=c;k.ones=e;k.unitW=m;k.unitX=g;k.unitY=a;k.unitZ=b;k.vec4f32=C;k.zeros=h})},
"esri/views/2d/engine/webgl/definitions":function(){define(["exports","../../../../core/has"],function(k,l){const u=256/360;l=l("featurelayer-force-marker-text-draw-order")?.5:3;k.angleFactor256=u;k.attributeDataAnimation=1;k.attributeDataDd0=3;k.attributeDataDd1=4;k.attributeDataFilterFlags=0;k.attributeDataGpgpu=2;k.attributeDataVv=3;k.attributeStoreTextureSize=1024;k.averageGlyphMosaicItem={metrics:{width:15,height:17,left:0,top:-7,advance:14}};k.bitsetFillHasPatternHeightPrecisionFactor=32;k.bitsetFillHasPatternWidthPrecisionFactor=
64;k.bitsetFillHasUnresolvedReplacementColor=8;k.bitsetFillRandomPatternOffset=4;k.bitsetGenericConsiderAlphaOnly=16;k.bitsetGenericLockColor=2;k.bitsetLineScaleDash=4;k.bitsetMarkerAlignmentMap=1;k.bitsetMarkerAlignmentScreen=0;k.bitsetMarkerOutlineAllowColorOverride=4;k.bitsetMarkerScaleSymbolsProportionally=8;k.bitsetTypeFillOutline=1;k.bufferDataMinimumSize=128;k.bufferDataPoolSize=4;k.chartMaxFields=10;k.collisionBoxPadding=16;k.collisionBucketSize=128;k.collisionEarlyRejectBucketSize=16;k.collisionMaxZoomDelta=
1;k.collisionPlacementPadding=8;k.collisionTileBoxSize=4;k.compressionFactorForU16=128;k.debugLabels=!1;k.displayRecordIntPerElement=8;k.dotDensityMaxFields=8;k.effectFlag0=4;k.enableEarlyLabelDiscard=!1;k.extrudeScale=64;k.filterFlag0=2;k.glyphSize=24;k.heuristicGlyphsPerFeature=10;k.heuristicGlyphsPerLine=50;k.highlightFlag=1;k.hittestRadius=l;k.magicLabelLineHeight=29;k.maxFilters=2;k.maxGpuUploadsPerFrame=2;k.maxRepresentableInt=16777216;k.maxSizeForU16Compression=511;k.minMaxZoomPrecisionFactor=
10;k.nanMagicNumber=1E-30;k.patchPixelBufferAllocSize=500;k.patternFillRasterizationScale=2;k.pictureFillColor=4294967295;k.randomInsidePolygonTextureSize=1024;k.rasterTileSize=256;k.sdfTextureSize=124;k.spritePadding=2;k.textPlacementPadding=8;k.textureBindingAttributeData0=1;k.textureBindingAttributeData1=2;k.textureBindingAttributeData2=3;k.textureBindingAttributeData3=4;k.textureBindingAttributeData4=5;k.textureBindingAttributeData5=6;k.textureBindingBitmap=0;k.textureBindingGlyphAtlas=0;k.textureBindingGpgpu=
12;k.textureBindingHighlight0=5;k.textureBindingHighlight1=6;k.textureBindingRenderer0=5;k.textureBindingRenderer1=6;k.textureBindingSpriteAtlas=0;k.textureUploadManagerBudget=4;k.textureUploadManagerChunkSize=128;k.thinLineHalfWidthThreshold=1.05;k.tileSize=512;k.vtlHighResCutoff=1.15;k.vtlTextureBindingUnitGlyphs=6;k.vtlTextureBindingUnitSprites=5;k.webglMaxInnerStops=6;k.webglMaxStops=8;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/enums":function(){define(["exports"],
function(k){k.WGLGeometryType=void 0;(function(l){l[l.FILL=0]="FILL";l[l.LINE=1]="LINE";l[l.MARKER=2]="MARKER";l[l.TEXT=3]="TEXT";l[l.LABEL=4]="LABEL"})(k.WGLGeometryType||(k.WGLGeometryType={}));k.WGLDrawPhase=void 0;(function(l){l[l.NONE=0]="NONE";l[l.MAP=1]="MAP";l[l.LABEL=2]="LABEL";l[l.LABEL_ALPHA=4]="LABEL_ALPHA";l[l.HITTEST=8]="HITTEST";l[l.HIGHLIGHT=16]="HIGHLIGHT";l[l.CLIP=32]="CLIP";l[l.DEBUG=64]="DEBUG";l[l.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(k.WGLDrawPhase||(k.WGLDrawPhase={}));k.VVType=
void 0;(function(l){l[l.SIZE=0]="SIZE";l[l.COLOR=1]="COLOR";l[l.OPACITY=2]="OPACITY";l[l.ROTATION=3]="ROTATION"})(k.VVType||(k.VVType={}));k.WGLVVFlag=void 0;(function(l){l[l.NONE=0]="NONE";l[l.OPACITY=1]="OPACITY";l[l.COLOR=2]="COLOR";l[l.ROTATION=4]="ROTATION";l[l.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";l[l.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";l[l.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";l[l.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(k.WGLVVFlag||(k.WGLVVFlag={}));k.WGLVVTarget=void 0;(function(l){l[l.MINMAX_TARGETS_OUTLINE=
128]="MINMAX_TARGETS_OUTLINE";l[l.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";l[l.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";l[l.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(k.WGLVVTarget||(k.WGLVVTarget={}));k.MosaicType=void 0;(function(l){l[l.SPRITE=0]="SPRITE";l[l.GLYPH=1]="GLYPH"})(k.MosaicType||(k.MosaicType={}));k.WGLSymbologyType=void 0;(function(l){l[l.DEFAULT=0]="DEFAULT";l[l.SIMPLE=1]="SIMPLE";l[l.DOT_DENSITY=2]="DOT_DENSITY";l[l.OUTLINE_FILL=3]="OUTLINE_FILL";l[l.OUTLINE_FILL_SIMPLE=
4]="OUTLINE_FILL_SIMPLE";l[l.HEATMAP=5]="HEATMAP";l[l.PIE_CHART=6]="PIE_CHART"})(k.WGLSymbologyType||(k.WGLSymbologyType={}));Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(k){function l(f,h,e){return Math.round(Math.max(Math.min(f,e),h))}const u=new Float32Array(1),c=new Uint32Array(u.buffer);k.i16=function(f){return l(f,-32768,32767)};k.i1616to32=function(f,h){return 65535&f|h<<16};k.i32=function(f){return l(f,
-2147483648,2147483647)};k.i8=function(f){return l(f,-128,127)};k.i8816to32=function(f,h,e){return f&255|(h&255)<<8|e<<16};k.i8888to32=function(f,h,e,g){return f&255|(h&255)<<8|(e&255)<<16|g<<24};k.numTo32=function(f){return f|0};k.toFloat32=function(f){c[0]=f;return u[0]};k.toUint32=function(f){u[0]=f;return c[0]};k.u16=function(f){return l(f,0,65535)};k.u32=function(f){return l(f,0,4294967295)};k.u32to4Xu8=function(f){return[f&255,(f&65280)>>>8,(f&16711680)>>>16,(f&4278190080)>>>24]};k.u4u4to8=
function(f,h){return 15&f|(15&h)<<4};k.u8=function(f){return l(f,0,255)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){class k{constructor(){this.name=this.constructor.name||"UnnamedBrush";this.brushEffect=null}prepareState(l,u){}draw(l,u,c){}drawMany(l,u,c){for(const f of u)f.visible&&this.draw(l,f,c)}}return k})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define("exports ../../vectorTiles/style/StyleDefinition ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),
function(k,l,u,c,f,h){class e extends f{constructor(){super(...arguments);this._programOptions={id:!1}}dispose(){}drawMany(g,a){const {context:b,displayLevel:m,requiredLevel:n,state:r,drawPhase:q,painter:p,spriteMosaic:x,styleLayerUID:y,requestRender:C,allowDelayedRender:D}=g;if(a.some(J=>J.layerData.get(y)?.circleIndexCount??!1)){g=g.styleLayer;var v=g.circleMaterial,z=p.vectorTilesMaterialManager,A=g.getPaintValue("circle-translate",m),G=g.getPaintValue("circle-translate-anchor",m),F=q===u.WGLDrawPhase.HITTEST,
M=this._programOptions;M.id=F;z=z.getMaterialProgram(b,v,M);if(D&&null!=C&&!z.compiled)C();else{b.useProgram(z);z.setUniformMatrix3fv("u_displayMat3",G===l.TranslateAnchor.VIEWPORT?r.displayMat3:r.displayViewMat3);z.setUniform2fv("u_circleTranslation",A);z.setUniform1f("u_depth",g.z);z.setUniform1f("u_antialiasingWidth",1.2);A=-1;F&&(F=c.u32to4Xu8(y+1),z.setUniform4fv("u_id",F));for(const J of a)J.layerData.has(y)&&(J.key.level!==A&&(A=J.key.level,v.setDataUniforms(z,m,g,A,x)),a=J.layerData.get(y),
a.circleIndexCount&&(a.prepareForRendering(b),F=a.vao,null!=F&&(b.bindVAO(F),z.setUniformMatrix3fv("u_dvsMat3",J.transforms.dvs),n!==J.key.level?b.setStencilFunction(h.CompareFunction.EQUAL,J.stencilRef,255):b.setStencilFunction(h.CompareFunction.GREATER,255,255),b.drawElements(h.PrimitiveType.TRIANGLES,a.circleIndexCount,h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a.circleIndexStart),J.triangleCount+=a.circleIndexCount/3)))}}}}k.WGLBrushVTLCircle=e;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define("exports ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(k,l,u,c,f,h,e){const g=1/65536;class a extends h{constructor(){super(...arguments);this._fillProgramOptions={id:!1,pattern:!1};this._outlineProgramOptions={id:!1}}dispose(){}drawMany(b,m){const {displayLevel:n,drawPhase:r,renderPass:q,spriteMosaic:p,styleLayerUID:x}=b;var y=
!1;for(var C of m)if(C.layerData.has(x)){var D=C.layerData.get(x);if(0<D.fillIndexCount||0<D.outlineIndexCount){y=!0;break}}if(y){y=b.styleLayer;var v=y.getPaintProperty("fill-pattern");D=(C=void 0!==v)&&v.isDataDriven;if(C&&!D){var z=v.getValue(n);z=p.getMosaicItemPosition(z,!0)}v=!C&&y.getPaintValue("fill-antialias",n);var A=!0,G=1;if(!C){var F=y.getPaintProperty("fill-color"),M=y.getPaintProperty("fill-opacity");F?.isDataDriven||M?.isDataDriven||(G=y.getPaintValue("fill-color",n),G=y.getPaintValue("fill-opacity",
n)*G[3],1<=G&&(A=!1))}if(!A||"opaque"!==q){var J;r===c.WGLDrawPhase.HITTEST&&(J=f.u32to4Xu8(x+1));F=y.getPaintValue("fill-translate",n);M=y.getPaintValue("fill-translate-anchor",n);(A||"translucent"!==q)&&this._drawFill(b,x,y,m,F,M,C,z,D,J);z=!y.hasDataDrivenOutlineColor&&y.outlineUsesFillColor&&1>G;v&&"opaque"!==q&&!z&&this._drawOutline(b,x,y,m,F,M,J)}}}_drawFill(b,m,n,r,q,p,x,y,C,D){if(!x||C||null!=y){var {context:v,displayLevel:z,state:A,drawPhase:G,painter:F,pixelRatio:M,spriteMosaic:J,requestRender:K,
allowDelayedRender:N}=b;b=n.fillMaterial;var H=F.vectorTilesMaterialManager,L=M>u.vtlHighResCutoff?2:1,R=G===c.WGLDrawPhase.HITTEST,E=this._fillProgramOptions;E.id=R;E.pattern=x;H=H.getMaterialProgram(v,b,E);if(N&&null!=K&&!H.compiled)K();else{v.useProgram(H);null!=y&&({page:y}=y,E=J.getPageSize(y),null!=E&&(J.bind(v,e.TextureSamplingMode.LINEAR,y,u.vtlTextureBindingUnitSprites),H.setUniform2fv("u_mosaicSize",E),H.setUniform1i("u_texture",u.vtlTextureBindingUnitSprites)));H.setUniformMatrix3fv("u_displayMat3",
p===l.TranslateAnchor.VIEWPORT?A.displayMat3:A.displayViewMat3);H.setUniform2fv("u_fillTranslation",q);H.setUniform1f("u_depth",n.z+g);R&&H.setUniform4fv("u_id",D);q=-1;for(const P of r)if(P.layerData.has(m)&&(P.key.level!==q&&(q=P.key.level,b.setDataUniforms(H,z,n,q,J)),r=P.layerData.get(m),r.fillIndexCount&&(r.prepareForRendering(v),p=r.fillVAO,null!=p))){v.bindVAO(p);H.setUniformMatrix3fv("u_dvsMat3",P.transforms.dvs);v.setStencilFunction(e.CompareFunction.EQUAL,P.stencilRef,255);x&&H.setUniform1f("u_patternFactor",
P.rangeX/(L*P.width*Math.max(2**(Math.round(z)-P.key.level),1)));if(C){p=r.patternMap;if(!p)continue;for(const [Q,U]of p)p=J.getPageSize(Q),null!=p&&(J.bind(v,e.TextureSamplingMode.LINEAR,Q,u.vtlTextureBindingUnitSprites),H.setUniform2fv("u_mosaicSize",p),H.setUniform1i("u_texture",u.vtlTextureBindingUnitSprites),v.drawElements(e.PrimitiveType.TRIANGLES,U[1],e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*U[0]))}else v.drawElements(e.PrimitiveType.TRIANGLES,r.fillIndexCount,e.DataType.UNSIGNED_INT,
Uint32Array.BYTES_PER_ELEMENT*r.fillIndexStart);P.triangleCount+=r.fillIndexCount/3}}}}_drawOutline(b,m,n,r,q,p,x){const {context:y,displayLevel:C,state:D,drawPhase:v,painter:z,pixelRatio:A,spriteMosaic:G,requestRender:F,allowDelayedRender:M}=b;b=n.outlineMaterial;var J=z.vectorTilesMaterialManager;const K=.75/A,N=v===c.WGLDrawPhase.HITTEST,H=this._outlineProgramOptions;H.id=N;J=J.getMaterialProgram(y,b,H);if(M&&null!=F&&!J.compiled)F();else{y.useProgram(J);J.setUniformMatrix3fv("u_displayMat3",p===
l.TranslateAnchor.VIEWPORT?D.displayMat3:D.displayViewMat3);J.setUniform2fv("u_fillTranslation",q);J.setUniform1f("u_depth",n.z+g);J.setUniform1f("u_outline_width",K);N&&J.setUniform4fv("u_id",x);q=-1;for(const L of r)L.layerData.has(m)&&(L.key.level!==q&&(q=L.key.level,b.setDataUniforms(J,C,n,q,G)),r=L.layerData.get(m),r.prepareForRendering(y),r.outlineIndexCount&&(p=r.outlineVAO,null!=p&&(y.bindVAO(p),J.setUniformMatrix3fv("u_dvsMat3",L.transforms.dvs),y.setStencilFunction(e.CompareFunction.EQUAL,
L.stencilRef,255),y.drawElements(e.PrimitiveType.TRIANGLES,r.outlineIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.outlineIndexStart),L.triangleCount+=r.outlineIndexCount/3)))}}}k.WGLBrushVTLFill=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define("exports ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(k,l,u,c,f,
h,e){class g extends h{constructor(){super(...arguments);this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(a,b){const {context:m,displayLevel:n,state:r,drawPhase:q,painter:p,pixelRatio:x,spriteMosaic:y,styleLayerUID:C,requestRender:D,allowDelayedRender:v}=a;if(b.some(P=>P.layerData.get(C)?.lineIndexCount??!1)){a=a.styleLayer;var z=a.lineMaterial,A=p.vectorTilesMaterialManager,G=a.getPaintValue("line-translate",n),F=a.getPaintValue("line-translate-anchor",n),M=a.getPaintProperty("line-pattern"),
J=void 0!==M,K=J&&M.isDataDriven;if(J&&!K){M=M.getValue(n);var N=y.getMosaicItemPosition(M)}var H;M=!1;if(!J){var L=a.getPaintProperty("line-dasharray");M=(H=void 0!==L)&&L.isDataDriven;H&&!M&&(N=L.getValue(n),N=a.getDashKey(N,a.getLayoutValue("line-cap",n)),N=y.getMosaicItemPosition(N))}L=1/x;var R=q===c.WGLDrawPhase.HITTEST,E=this._programOptions;E.id=R;E.pattern=J;E.sdf=H;H=A.getMaterialProgram(m,z,E);if(v&&null!=D&&!H.compiled)D();else{m.useProgram(H);H.setUniformMatrix3fv("u_displayViewMat3",
r.displayViewMat3);H.setUniformMatrix3fv("u_displayMat3",F===l.TranslateAnchor.VIEWPORT?r.displayMat3:r.displayViewMat3);H.setUniform2fv("u_lineTranslation",G);H.setUniform1f("u_depth",a.z);H.setUniform1f("u_antialiasing",L);R&&(G=f.u32to4Xu8(C+1),H.setUniform4fv("u_id",G));N&&null!=N&&({page:G}=N,F=y.getPageSize(G),null!=F&&(y.bind(m,e.TextureSamplingMode.LINEAR,G,u.vtlTextureBindingUnitSprites),H.setUniform2fv("u_mosaicSize",F),H.setUniform1i("u_texture",u.vtlTextureBindingUnitSprites)));G=-1;for(const P of b)if(P.layerData.has(C)&&
(P.key.level!==G&&(G=P.key.level,z.setDataUniforms(H,n,a,G,y)),H.setUniform1f("u_zoomFactor",2**(n-G)/x),b=P.layerData.get(C),b.lineIndexCount&&(b.prepareForRendering(m),F=b.vao,null!=F))){m.bindVAO(F);H.setUniformMatrix3fv("u_dvsMat3",P.transforms.dvs);m.setStencilFunction(e.CompareFunction.EQUAL,P.stencilRef,255);if(K||M){F=b.patternMap;if(!F)continue;for(const [Q,U]of F)F=y.getPageSize(Q),null!=F&&(y.bind(m,e.TextureSamplingMode.LINEAR,Q,u.vtlTextureBindingUnitSprites),H.setUniform2fv("u_mosaicSize",
F),H.setUniform1i("u_texture",u.vtlTextureBindingUnitSprites),m.drawElements(e.PrimitiveType.TRIANGLES,U[1],e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*U[0]))}else m.drawElements(e.PrimitiveType.TRIANGLES,b.lineIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*b.lineIndexStart);P.triangleCount+=b.lineIndexCount/3}}}}}k.WGLBrushVTLLine=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("exports ../../../../../chunks/vec2f32 ../../vectorTiles/decluttering/config ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../GeometryUtils ../number ./WGLBrush ../../../../webgl/enums".split(" "),
function(k,l,u,c,f,h,e,g,a,b){const m=1/65536;class n extends a{constructor(){super(...arguments);this._iconProgramOptions={id:!1,sdf:!1};this._sdfProgramOptions={id:!1};this._spritesTextureSize=l.create()}dispose(){}drawMany(r,q){const {drawPhase:p,styleLayerUID:x}=r,y=r.styleLayer;let C;p===h.WGLDrawPhase.HITTEST&&(C=g.u32to4Xu8(x+1));this._drawIcons(r,y,q,C);this._drawText(r,y,q,C)}_drawIcons(r,q,p,x){const {context:y,displayLevel:C,drawPhase:D,painter:v,spriteMosaic:z,state:A,styleLayerUID:G,
requestRender:F,allowDelayedRender:M}=r,J=q.iconMaterial;var K=v.vectorTilesMaterialManager,N=!1;for(var H of p)if(H.layerData.has(G)){var L=H.layerData.get(G);if(0<L.iconPerPageElementsMap.size){N=!0;break}}if(N){N=q.getPaintValue("icon-translate",C);H=q.getPaintValue("icon-translate-anchor",C);var R=q.getLayoutValue("icon-rotation-alignment",C);R===c.RotationAlignment.AUTO&&(R=q.getLayoutValue("symbol-placement",C)===c.SymbolPlacement.POINT?c.RotationAlignment.VIEWPORT:c.RotationAlignment.MAP);
var E=R===c.RotationAlignment.MAP;E=q.getLayoutValue("icon-keep-upright",C)&&E;var P=L.isIconSDF;L=D===h.WGLDrawPhase.HITTEST;var Q=this._iconProgramOptions;Q.id=L;Q.sdf=P;K=K.getMaterialProgram(y,J,Q);if(M&&null!=F&&!K.compiled)F();else{y.useProgram(K);K.setUniformMatrix3fv("u_displayViewMat3",R===c.RotationAlignment.MAP?A.displayViewMat3:A.displayMat3);K.setUniformMatrix3fv("u_displayMat3",H===c.TranslateAnchor.VIEWPORT?A.displayMat3:A.displayViewMat3);K.setUniform2fv("u_iconTranslation",N);K.setUniform1f("u_depth",
q.z);K.setUniform1f("u_mapRotation",e.degToByte(A.rotation));K.setUniform1f("u_keepUpright",E?1:0);K.setUniform1f("u_level",10*C);K.setUniform1i("u_texture",f.vtlTextureBindingUnitSprites);K.setUniform1f("u_fadeDuration",u.fadeDuration/1E3);L&&K.setUniform4fv("u_id",x);x=-1;for(const U of p)if(U.layerData.has(G)&&(U.key.level!==x&&(x=U.key.level,J.setDataUniforms(K,C,q,x,z)),L=U.layerData.get(G),0!==L.iconPerPageElementsMap.size&&(L.prepareForRendering(y),L.updateOpacityInfo(),p=L.iconVAO,null!=p))){y.bindVAO(p);
K.setUniformMatrix3fv("u_dvsMat3",U.transforms.dvs);K.setUniform1f("u_time",(performance.now()-L.lastOpacityUpdate)/1E3);for(const [Y,Z]of L.iconPerPageElementsMap)this._renderIconRange(r,K,Z,Y,U)}}}}_renderIconRange(r,q,p,x,y){const {context:C,spriteMosaic:D}=r;this._spritesTextureSize[0]=D.getWidth(x)/4;this._spritesTextureSize[1]=D.getHeight(x)/4;q.setUniform2fv("u_mosaicSize",this._spritesTextureSize);D.bind(C,b.TextureSamplingMode.LINEAR,x,f.vtlTextureBindingUnitSprites);this._setStencilState(r,
y);C.drawElements(b.PrimitiveType.TRIANGLES,p[1],b.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*p[0]);y.triangleCount+=p[1]/3}_drawText(r,q,p,x){const {context:y,displayLevel:C,drawPhase:D,glyphMosaic:v,painter:z,pixelRatio:A,spriteMosaic:G,state:F,styleLayerUID:M,requestRender:J,allowDelayedRender:K}=r,N=q.textMaterial,H=z.vectorTilesMaterialManager;var L=!1;for(var R of p)if(R.layerData.has(M)){var E=R.layerData.get(M);if(0<E.glyphPerPageElementsMap.size){L=!0;break}}if(L&&(E=q.getPaintProperty("text-opacity"),
!E||E.isDataDriven||0!==E.getValue(C))){E=q.getPaintProperty("text-color");var P=!E||E.isDataDriven||0<E.getValue(C)[3];E=q.getPaintProperty("text-halo-width");L=q.getPaintProperty("text-halo-color");var Q=(!E||E.isDataDriven||0<E.getValue(C))&&(!L||L.isDataDriven||0<L.getValue(C)[3]);if(P||Q){E=q.getLayoutValue("text-rotation-alignment",C);E===c.RotationAlignment.AUTO&&(E=q.getLayoutValue("symbol-placement",C)===c.SymbolPlacement.POINT?c.RotationAlignment.VIEWPORT:c.RotationAlignment.MAP);L=E===
c.RotationAlignment.MAP;L=q.getLayoutValue("text-keep-upright",C)&&L;R=D===h.WGLDrawPhase.HITTEST;var U=.8*3/A;this._glyphTextureSize||(this._glyphTextureSize=l.fromValues(v.width/4,v.height/4));var Y=q.getPaintValue("text-translate",C),Z=q.getPaintValue("text-translate-anchor",C),ba=this._sdfProgramOptions;ba.id=R;var V=H.getMaterialProgram(y,N,ba);if(K&&null!=J&&!V.compiled)J();else{y.useProgram(V);V.setUniformMatrix3fv("u_displayViewMat3",E===c.RotationAlignment.MAP?F.displayViewMat3:F.displayMat3);
V.setUniformMatrix3fv("u_displayMat3",Z===c.TranslateAnchor.VIEWPORT?F.displayMat3:F.displayViewMat3);V.setUniform2fv("u_textTranslation",Y);V.setUniform1f("u_depth",q.z+m);V.setUniform2fv("u_mosaicSize",this._glyphTextureSize);V.setUniform1f("u_mapRotation",e.degToByte(F.rotation));V.setUniform1f("u_keepUpright",L?1:0);V.setUniform1f("u_level",10*C);V.setUniform1i("u_texture",f.vtlTextureBindingUnitGlyphs);V.setUniform1f("u_antialiasingWidth",U);V.setUniform1f("u_fadeDuration",u.fadeDuration/1E3);
R&&V.setUniform4fv("u_id",x);x=-1;for(const W of p)W.layerData.has(M)&&(W.key.level!==x&&(x=W.key.level,N.setDataUniforms(V,C,q,x,G)),E=W.layerData.get(M),0!==E.glyphPerPageElementsMap.size&&(E.prepareForRendering(y),E.updateOpacityInfo(),p=E.textVAO,null!=p&&(y.bindVAO(p),V.setUniformMatrix3fv("u_dvsMat3",W.transforms.dvs),this._setStencilState(r,W),p=(performance.now()-E.lastOpacityUpdate)/1E3,V.setUniform1f("u_time",p),E.glyphPerPageElementsMap.forEach((ha,ia)=>{this._renderGlyphRange(y,ha,ia,
v,V,Q,P,W)}))))}}}}_renderGlyphRange(r,q,p,x,y,C,D,v){x.bind(r,b.TextureSamplingMode.LINEAR,p,f.vtlTextureBindingUnitGlyphs);C&&(y.setUniform1f("u_halo",1),r.drawElements(b.PrimitiveType.TRIANGLES,q[1],b.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*q[0]),v.triangleCount+=q[1]/3);D&&(y.setUniform1f("u_halo",0),r.drawElements(b.PrimitiveType.TRIANGLES,q[1],b.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*q[0]),v.triangleCount+=q[1]/3)}_setStencilState(r,q){const {context:p,is3D:x,stencilSymbols:y}=
r;p.setStencilTestEnabled(!0);y?(p.setStencilWriteMask(255),p.setStencilFunction(b.CompareFunction.ALWAYS,q.stencilRef,255)):(p.setStencilWriteMask(0),x?p.setStencilFunction(b.CompareFunction.EQUAL,q.stencilRef,255):p.setStencilFunction(b.CompareFunction.GREATER,255,255))}}k.WGLBrushVTLSymbol=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(k){function l(h,e){h%=e;return 0<=h?h:h+e}const u=128/Math.PI,
c=256/360,f=1/Math.LN2;k.between=function(h,e,g){return h>=e&&h<=g||h>=g&&h<=e};k.degToByte=function(h){return l(h*c,256)};k.interpolate=function(h,e,g){return h*(1-g)+e*g};k.log2=function(h){return Math.log(h)*f};k.positiveMod=l;k.radToByte=function(h){return l(h*u,256)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["../enums","./Programs"],function(k,l){class u{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(c=>
c.dispose());this._programByKey.clear()}getMaterialProgram(c,f,h){const e=f.key<<3|this._getMaterialOptionsValue(f.type,h);if(this._programByKey.has(e))return this._programByKey.get(e);var g=this._getProgramTemplate(f.type);({shaders:g}=g);const {vertexShader:a,fragmentShader:b}=g(h);h=f.getShaderHeader();g=f.getShaderMain();h=a.replace("#pragma header",h).replace("#pragma main",g);c=c.programCache.acquire(h,b,f.getAttributeLocations());this._programByKey.set(e,c);return c}_getMaterialOptionsValue(c,
f){switch(c){case k.ShaderProgramType.BACKGROUND:return(f.pattern?1:0)<<1|(f.id?1:0);case k.ShaderProgramType.FILL:return(f.pattern?1:0)<<1|(f.id?1:0);case k.ShaderProgramType.OUTLINE:return f.id?1:0;case k.ShaderProgramType.LINE:return(f.sdf?1:0)<<2|(f.pattern?1:0)<<1|(f.id?1:0);case k.ShaderProgramType.ICON:return(f.sdf?1:0)<<1|(f.id?1:0);case k.ShaderProgramType.CIRCLE:return f.id?1:0;case k.ShaderProgramType.TEXT:return f.id?1:0;default:return 0}}_getProgramTemplate(c){switch(c){case k.ShaderProgramType.BACKGROUND:return l.background;
case k.ShaderProgramType.CIRCLE:return l.circle;case k.ShaderProgramType.FILL:return l.fill;case k.ShaderProgramType.ICON:return l.icon;case k.ShaderProgramType.LINE:return l.line;case k.ShaderProgramType.OUTLINE:return l.outline;case k.ShaderProgramType.TEXT:return l.text;default:return null}}}return u})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(k,l,u){k.background={shaders:c=>({vertexShader:u.glslifyDefineMap({ID:c.id,
PATTERN:c.pattern})+l.resolveIncludes("background/background.vert"),fragmentShader:u.glslifyDefineMap({ID:c.id,PATTERN:c.pattern})+l.resolveIncludes("background/background.frag")})};k.circle={shaders:c=>({vertexShader:u.glslifyDefineMap({ID:c.id})+l.resolveIncludes("circle/circle.vert"),fragmentShader:u.glslifyDefineMap({ID:c.id})+l.resolveIncludes("circle/circle.frag")})};k.fill={shaders:c=>({vertexShader:u.glslifyDefineMap({ID:c.id,PATTERN:c.pattern})+l.resolveIncludes("fill/fill.vert"),fragmentShader:u.glslifyDefineMap({ID:c.id,
PATTERN:c.pattern})+l.resolveIncludes("fill/fill.frag")})};k.icon={shaders:c=>({vertexShader:u.glslifyDefineMap({ID:c.id,SDF:c.sdf})+l.resolveIncludes("icon/icon.vert"),fragmentShader:u.glslifyDefineMap({ID:c.id,SDF:c.sdf})+l.resolveIncludes("icon/icon.frag")})};k.line={shaders:c=>({vertexShader:u.glslifyDefineMap({ID:c.id,PATTERN:c.pattern,SDF:c.sdf})+l.resolveIncludes("line/line.vert"),fragmentShader:u.glslifyDefineMap({ID:c.id,PATTERN:c.pattern,SDF:c.sdf})+l.resolveIncludes("line/line.frag")})};
k.outline={shaders:c=>({vertexShader:u.glslifyDefineMap({ID:c.id})+l.resolveIncludes("outline/outline.vert"),fragmentShader:u.glslifyDefineMap({ID:c.id})+l.resolveIncludes("outline/outline.frag")})};k.text={shaders:c=>({vertexShader:u.glslifyDefineMap({ID:c.id})+l.resolveIncludes("text/text.vert"),fragmentShader:u.glslifyDefineMap({ID:c.id})+l.resolveIncludes("text/text.frag")})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports",
"./shaderRepository","../../../../../webgl/ShaderCompiler"],function(k,l,u){const c=new u.ShaderCompiler(function(f){let h=l;f.split("/").forEach(e=>{h&&(h=h[e])});return h});k.resolveIncludes=function(f){return c.resolveIncludes(f)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d u_opacity * color;\n#else\ngl_FragColor \x3d u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist \x3d length(v_offset);\nmediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_stroke_color \x3d stroke_color * stroke_opacity;\nv_stroke_width \x3d stroke_width;\nv_radius \x3d radius;\nv_blur \x3d max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset \x3d offset;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d v_color[3] * color;\n#else\ngl_FragColor \x3d v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include \x3cutil/util.glsl\x3e\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth \x3d nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight \x3d nextPOT(tlbr.w - tlbr.y);\nfloat scaleX \x3d 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY \x3d 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat \x3d mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord \x3d (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio \x3d 0.248062016;\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * softEdgeRatio * size;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d u_outlineColor;\nconst float outlineLimitRatio \x3d (16.0 / 86.0);\nfloat clampedOutlineSize \x3d softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor \x3d v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor \x3d v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color \x3d color;\nv_opacity \x3d opacity;\n#ifdef SDF\nv_halo_width \x3d halo_width;\n#endif\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *\x3d interpolatedOpacity;\nmediump float a_angle         \x3d a_levelInfo[1];\nmediump float a_minLevel      \x3d a_levelInfo[2];\nmediump float a_maxLevel      \x3d a_levelInfo[3];\nmediump vec2 a_tex            \x3d a_texAngleRange.xy;\nmediump float delta_z \x3d 0.0;\nmediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_opacity, 0.0);\nvec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\nv_size \x3d abs(offset);\n#ifdef SDF\noffset \x3d (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_tex \x3d a_tex.xy / u_mosaicSize;\n}"},
line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include \x3cutil/encoding.glsl\x3e\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\nlowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX \x3d fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\ngl_FragColor \x3d alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX \x3d fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor \x3d alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor \x3d alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\nconst mediump float tileCoordRatio \x3d 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth \x3d 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_blur \x3d blur + u_antialiasing;\nv_normal \x3d a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          \x3d tlbr / u_mosaicSize.xyxy;\nv_patternSize   \x3d vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio \x3d width / v_patternSize.y;\n#else\nv_widthRatio \x3d width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth \x3d (width + u_antialiasing) * 0.5;\nmediump vec2 dir \x3d a_dir_normal.xy * scale;\nmediump vec2 offset_ \x3d a_extrude_offset.zw * scale * offset;\nmediump vec2 dist \x3d v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist \x3d abs(v_normal.y);\nlowp float alpha \x3d smoothstep(1.0, 0.0, dist);\ngl_FragColor \x3d alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_normal \x3d a_xnormal;\nmediump vec2 dist \x3d u_outline_width * scale * a_offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor \x3d alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a \x3c 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nconst float sdfPixel \x3d 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo \x3e 0.5)\n{\nv_color \x3d halo_color * opacity;\nhalo_width *\x3d sdfPixel;\nhalo_blur *\x3d sdfPixel;\n}\nelse\n{\nv_color \x3d color * opacity;\nhalo_width \x3d 0.0;\nhalo_blur \x3d 0.0;\n}\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *\x3d interpolatedOpacity;\nmediump float a_angle       \x3d a_levelInfo[1];\nmediump float a_minLevel    \x3d a_levelInfo[2];\nmediump float a_maxLevel    \x3d a_levelInfo[3];\nmediump vec2 a_tex          \x3d a_texAngleRange.xy;\nmediump float a_visMinAngle    \x3d a_texAngleRange.z;\nmediump float a_visMaxAngle    \x3d a_texAngleRange.w;\nmediump float delta_z \x3d 0.0;\nmediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle \x3c a_visMaxAngle)\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_color[3], 0.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id \x3d u_id / 255.0;\n#endif\nv_edgeDistance \x3d edgePos - halo_width / size;\nv_edgeWidth \x3d (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["exports"],function(k){class l{constructor(u){this._readFile=u}resolveIncludes(u){return this._resolve(u)}_resolve(u,
c=new Map){if(c.has(u))return c.get(u);const f=this._read(u);if(!f)throw Error(`cannot find shader file ${u}`);const h=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let e=h.exec(f);const g=[];for(;null!=e;)g.push({path:e[1],start:e.index,length:e[0].length}),e=h.exec(f);let a=0,b="";g.forEach(m=>{b+=f.slice(a,m.start);b+=c.has(m.path)?"":this._resolve(m.path,c);a=m.start+m.length});b+=f.slice(a);c.set(u,b);return b}_read(u){return this._readFile(u)}}k.ShaderCompiler=l;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/programUtils":function(){define(["exports"],function(k){k.glslifyDefineMap=function(l){let u="";for(const f in l){var c=l[f];if("boolean"===typeof c)c&&(u+=`#define ${f}\n`);else if("number"===typeof c)u+=`#define ${f} ${c.toFixed()}\n`;else if("object"===typeof c){const {options:h,value:e}=c;if("number"===typeof h[e]){const {value:g,options:a,namespace:b}=c;c=b?`${b}_`:"";for(const m in a)u+=`#define ${c}${m} ${a[m].toFixed()}\n`;u+=`#define ${f} ${c}${g}\n`}else{const g=
c.options;let a=0;for(const b in g)u+=`#define ${g[b]} ${(a++).toFixed()}\n`;u+=`#define ${f} ${g[c.value]}\n`}}}return u};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition","./StyleLayer"],function(k,l){class u{constructor(c){this._style=c;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;c.layers||(c.layers=[]);this.version=parseFloat(c.version);
if(this.layers=c.layers.map((f,h,e)=>this._create(f,h,e)).filter(f=>!!f))for(let f=0;f<this.layers.length;f++)c=this.layers[f],this._layerByName[c.id]=c,this._uidToLayer.set(c.uid,c),c.type===k.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(c.id);this._identifyRefLayers()}isPainterDataDriven(c){return(c=this._layerByName[c])?c.isPainterDataDriven():!1}getStyleLayerId(c){return c>=this.layers.length?null:this.layers[c].id}getStyleLayerByUID(c){return this._uidToLayer.get(c)??null}getStyleLayerIndex(c){return(c=
this._layerByName[c])?this.layers.indexOf(c):-1}setStyleLayer(c,f){if(c?.id){var h=this._style;null!=f&&f>=this.layers.length&&(f=this.layers.length-1);var e=!0,g;if(g=this._layerByName[c.id]){const a=this.layers.indexOf(g);f||(f=a);f===a?(e=!1,g=u._recreateLayer(c,g),this.layers[f]=g,h.layers[f]=c):(this.layers.splice(a,1),h.layers.splice(a,1),g=this._create(c,f,this.layers),this.layers.splice(f,0,g),h.layers.splice(f,0,c))}else g=this._create(c,f,this.layers),!f||f>=this.layers.length?(this.layers.push(g),
h.layers.push(c)):(this.layers.splice(f,0,g),h.layers.splice(f,0,c));this._layerByName[c.id]=g;this._uidToLayer.set(g.uid,g);e&&this._recomputeZValues();this._identifyRefLayers()}}getStyleLayer(c){return(c=this._layerByName[c])?{type:c.typeName,id:c.id,source:c.source,"source-layer":c.sourceLayer,minzoom:c.minzoom,maxzoom:c.maxzoom,filter:c.filter,layout:c.layout,paint:c.paint}:null}deleteStyleLayer(c){const f=this._layerByName[c];f&&(delete this._layerByName[c],this._uidToLayer.delete(f.uid),c=this.layers.indexOf(f),
this.layers.splice(c,1),this._style.layers.splice(c,1),this._recomputeZValues(),this._identifyRefLayers())}getLayerById(c){return this._layerByName[c]}getLayoutProperties(c){return(c=this._layerByName[c])?c.layout:null}getPaintProperties(c){return(c=this._layerByName[c])?c.paint:null}setPaintProperties(c,f){if(c=this._layerByName[c]){var h=u._recreateLayer({type:c.typeName,id:c.id,source:c.source,"source-layer":c.sourceLayer,minzoom:c.minzoom,maxzoom:c.maxzoom,filter:c.filter,layout:c.layout,paint:f},
c),e=this.layers.indexOf(c);this.layers[e]=h;this._style.layers[e].paint=f;this._layerByName[c.id]=h;this._uidToLayer.set(c.uid,h)}}setLayoutProperties(c,f){if(c=this._layerByName[c]){var h=u._recreateLayer({type:c.typeName,id:c.id,source:c.source,"source-layer":c.sourceLayer,minzoom:c.minzoom,maxzoom:c.maxzoom,filter:c.filter,layout:f,paint:c.paint},c),e=this.layers.indexOf(c);this.layers[e]=h;this._style.layers[e].layout=f;this._layerByName[c.id]=h;this._uidToLayer.set(c.uid,h)}}setStyleLayerVisibility(c,
f){if(c=this._layerByName[c]){var h=c.layout||{};h.visibility=f;f=u._recreateLayer({type:c.typeName,id:c.id,source:c.source,"source-layer":c.sourceLayer,minzoom:c.minzoom,maxzoom:c.maxzoom,filter:c.filter,layout:h,paint:c.paint},c);var e=this.layers.indexOf(c);this.layers[e]=f;this._style.layers[e].layout=h;this._layerByName[c.id]=f;this._uidToLayer.set(c.uid,f)}}getStyleLayerVisibility(c){return(c=this._layerByName[c])?c.layout?.visibility??"visible":"none"}_recomputeZValues(){const c=this.layers,
f=1/(c.length+1);for(let h=0;h<c.length;h++)c[h].z=1-(1+h)*f}_identifyRefLayers(){const c=[],f=[];let h=0;for(const a of this.layers){const b=a.layout;if(a.type===k.StyleLayerType.FILL){var e=a,g=a.source+"|"+a.sourceLayer;g+="|"+(b?.visibility??"");g+="|"+a.minzoom;g+="|"+a.maxzoom;g+="|"+JSON.stringify(a.filter);if(e.hasDataDrivenFill||e.hasDataDrivenOutline)g+="|"+h;c.push({key:g,layer:a})}else if(a.type===k.StyleLayerType.LINE){e=a;g=a.paint;g=null!=g&&(null!=g["line-pattern"]||null!=g["line-dasharray"]);
let m=a.source+"|"+a.sourceLayer;m+="|"+(b?.visibility??"");m+="|"+a.minzoom;m+="|"+a.maxzoom;m+="|"+JSON.stringify(a.filter);m+="|"+(void 0!==b?b["line-cap"]:"");m+="|"+(void 0!==b?b["line-join"]:"");if(e.hasDataDrivenLine||g)m+="|"+h;f.push({key:m,layer:a})}++h}this._assignRefLayers(c);this._assignRefLayers(f)}_assignRefLayers(c){c.sort((b,m)=>b.key<m.key?-1:b.key>m.key?1:0);let f,h;const e=c.length;for(let b=0;b<e;b++){const m=c[b];if(m.key===f)m.layer.refLayerId=h;else if(f=m.key,h=m.layer.id,
m.layer.type===k.StyleLayerType.FILL){if(!m.layer.getPaintProperty("fill-outline-color"))for(var g=b+1;g<e;g++){var a=c[g];if(a.key===f){if(a.layer.getPaintProperty("fill-outline-color")){c[b]=a;c[g]=m;h=a.layer.id;break}}else break}}else if(m.layer.type===k.StyleLayerType.LINE)for(g=m.layer,a=b+1;a<e;a++){const n=c[a];if(n.key!==f)break;const r=n.layer;if(g.canUseThinTessellation&&!r.canUseThinTessellation||!g.canUseThinTessellation&&(r.getPaintProperty("line-pattern")||r.getPaintProperty("line-dasharray")))g=
r,c[b]=n,c[a]=m,h=n.layer.id}}}_create(c,f,h){f=1-1/(h.length+1)*(1+f);h=this._runningId++;switch(c.type){case "background":return new l.BackgroundStyleLayer(k.StyleLayerType.BACKGROUND,c,f,h);case "fill":return new l.FillStyleLayer(k.StyleLayerType.FILL,c,f,h);case "line":return new l.LineStyleLayer(k.StyleLayerType.LINE,c,f,h);case "symbol":return new l.SymbolStyleLayer(k.StyleLayerType.SYMBOL,c,f,h);case "raster":console.warn(`Unsupported vector tile raster layer ${c.id}`);break;case "circle":return new l.CircleStyleLayer(k.StyleLayerType.CIRCLE,
c,f,h)}return null}static _recreateLayer(c,f){switch(c.type){case "background":return new l.BackgroundStyleLayer(k.StyleLayerType.BACKGROUND,c,f.z,f.uid);case "fill":return new l.FillStyleLayer(k.StyleLayerType.FILL,c,f.z,f.uid);case "line":return new l.LineStyleLayer(k.StyleLayerType.LINE,c,f.z,f.uid);case "symbol":return new l.SymbolStyleLayer(k.StyleLayerType.SYMBOL,c,f.z,f.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${c.id}`);break;case "circle":return new l.CircleStyleLayer(k.StyleLayerType.CIRCLE,
c,f.z,f.uid)}return null}}return u})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../enums ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(k,l,u,c,f,h,e,g,a,b,m){k.CapType=void 0;(function(v){v[v.BUTT=0]="BUTT";v[v.ROUND=1]="ROUND";v[v.SQUARE=2]="SQUARE";v[v.UNKNOWN=4]="UNKNOWN"})(k.CapType||
(k.CapType={}));class n{constructor(v,z,A,G){this.type=v;this.typeName=z.type;this.id=z.id;this.source=z.source;this.sourceLayer=z["source-layer"];this.minzoom=z.minzoom;this.maxzoom=z.maxzoom;this.filter=z.filter;this.layout=z.layout;this.paint=z.paint;this.z=A;this.uid=G;switch(v){case a.StyleLayerType.BACKGROUND:this._layoutDefinition=a.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=a.StyleDefinition.backgroundPaintDefinition;break;case a.StyleLayerType.FILL:this._layoutDefinition=
a.StyleDefinition.fillLayoutDefinition;this._paintDefinition=a.StyleDefinition.fillPaintDefinition;break;case a.StyleLayerType.LINE:this._layoutDefinition=a.StyleDefinition.lineLayoutDefinition;this._paintDefinition=a.StyleDefinition.linePaintDefinition;break;case a.StyleLayerType.SYMBOL:this._layoutDefinition=a.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=a.StyleDefinition.symbolPaintDefinition;break;case a.StyleLayerType.CIRCLE:this._layoutDefinition=a.StyleDefinition.circleLayoutDefinition,
this._paintDefinition=a.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=g.createFilter(this.filter)}getLayoutProperty(v){return this._layoutProperties[v]}getPaintProperty(v){return this._paintProperties[v]}getLayoutValue(v,z,A){let G;const F=this._layoutProperties[v];F&&(G=F.getValue(z,A));void 0===G&&(G=this._layoutDefinition[v]["default"]);
return G}getPaintValue(v,z,A){let G;const F=this._paintProperties[v];F&&(G=F.getValue(z,A));void 0===G&&(G=this._paintDefinition[v]["default"]);return G}isPainterDataDriven(){const v=this._paintProperties;if(v)for(const z in v)if(v[z].isDataDriven)return!0;return!1}_parseLayout(v){const z={};for(const A in v){const G=this._layoutDefinition[A];G&&(z[A]=new b(G,v[A]))}return z}_parsePaint(v){const z={};for(const A in v){const G=this._paintDefinition[A];G&&(z[A]=new b(G,v[A]))}return z}computeAttributesKey(v,
z,A,G){let F=0,M=0;for(const J of z){z=3;if(!J||J!==G){const {isLayout:K,isOptional:N}=A[J];z=K?this.getLayoutProperty(J):this.getPaintProperty(J);z=z?.interpolator?2:z?.isDataDriven?1:N&&!z?3:0}M|=z<<F;F+=2}return M<<3|v}}class r extends n{constructor(v,z,A,G){super(v,z,A,G);this.backgroundMaterial=new u.VTLBackgroundMaterial(this.computeAttributesKey(l.ShaderProgramType.BACKGROUND,u.VTLBackgroundMaterial.ATTRIBUTES,u.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class q extends n{constructor(v,z,A,G){super(v,
z,A,G);v=this.getPaintProperty("fill-color");z=this.getPaintProperty("fill-opacity");A=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=v?.isDataDriven;this.hasDataDrivenOpacity=z?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||A?.isDataDriven;z=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!z;this.hasDataDrivenOutlineColor=z?.isDataDriven;this.hasDataDrivenOutline=z?z.isDataDriven:v?v.isDataDriven:!1;this.hasDataDrivenOutline=
(z?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;this.fillMaterial=new f.VTLFillMaterial(this.computeAttributesKey(l.ShaderProgramType.FILL,f.VTLFillMaterial.ATTRIBUTES,f.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new f.VTLOutlineMaterial(this.computeAttributesKey(l.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?f.VTLOutlineMaterial.ATTRIBUTES_FILL:f.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?f.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:
f.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}}class p extends n{constructor(v,z,A,G){super(v,z,A,G);v=this.getPaintProperty("line-pattern");this.lineMaterial=new h.VTLLineMaterial(this.computeAttributesKey(l.ShaderProgramType.LINE,h.VTLLineMaterial.ATTRIBUTES,h.VTLLineMaterial.ATTRIBUTES_INFO,v?"line-dasharray":""));this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||
this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&(v=this.getPaintProperty("line-width"),!v||"number"===typeof v&&.5*v<m.thinLineHalfWidthThreshold)&&(v=this.getPaintProperty("line-offset"),
!v||"number"===typeof v&&0===v)&&(this.canUseThinTessellation=!0)}getDashKey(v,z){switch(z){case k.CapType.BUTT:z="Butt";break;case k.CapType.ROUND:z="Round";break;case k.CapType.SQUARE:z="Square";break;default:z="Butt"}return`dasharray-[${v.toString()}]-${z}`}}class x extends n{constructor(v,z,A,G){super(v,z,A,G);this.iconMaterial=new e.VTLIconMaterial(this.computeAttributesKey(l.ShaderProgramType.ICON,e.VTLIconMaterial.ATTRIBUTES,e.VTLIconMaterial.ATTRIBUTES_INFO));this.textMaterial=new e.VTLTextMaterial(this.computeAttributesKey(l.ShaderProgramType.TEXT,
e.VTLTextMaterial.ATTRIBUTES,e.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||
this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class y extends n{constructor(v,z,A,G){super(v,z,A,G);this.circleMaterial=new c.VTLCircleMaterial(this.computeAttributesKey(l.ShaderProgramType.CIRCLE,c.VTLCircleMaterial.ATTRIBUTES,c.VTLCircleMaterial.ATTRIBUTES_INFO))}}class C{constructor(v,z,A){this.allowOverlap=v.getLayoutValue("icon-allow-overlap",
z);this.ignorePlacement=v.getLayoutValue("icon-ignore-placement",z);this.keepUpright=v.getLayoutValue("icon-keep-upright",z);this.optional=v.getLayoutValue("icon-optional",z);this.rotationAlignment=v.getLayoutValue("icon-rotation-alignment",z);this.rotationAlignment===a.RotationAlignment.AUTO&&(this.rotationAlignment=A?a.RotationAlignment.MAP:a.RotationAlignment.VIEWPORT);A=v.getLayoutProperty("icon-anchor");A?.isDataDriven?this._anchorProp=A:this.anchor=v.getLayoutValue("icon-anchor",z);A=v.getLayoutProperty("icon-offset");
A?.isDataDriven?this._offsetProp=A:this.offset=v.getLayoutValue("icon-offset",z);A=v.getLayoutProperty("icon-padding");A?.isDataDriven?this._paddingProp=A:this.padding=v.getLayoutValue("icon-padding",z);A=v.getLayoutProperty("icon-rotate");A?.isDataDriven?this._rotateProp=A:this.rotate=v.getLayoutValue("icon-rotate",z);A=v.getLayoutProperty("icon-size");A?.isDataDriven?this._sizeProp=A:this.size=v.getLayoutValue("icon-size",z)}update(v,z){this._anchorProp&&(this.anchor=this._anchorProp.getValue(v,
z));this._offsetProp&&(this.offset=this._offsetProp.getValue(v,z));this._paddingProp&&(this.padding=this._paddingProp.getValue(v,z));this._rotateProp&&(this.rotate=this._rotateProp.getValue(v,z));this._sizeProp&&(this.size=this._sizeProp.getValue(v,z))}}class D{constructor(v,z,A){this.allowOverlap=v.getLayoutValue("text-allow-overlap",z);this.ignorePlacement=v.getLayoutValue("text-ignore-placement",z);this.keepUpright=v.getLayoutValue("text-keep-upright",z);this.optional=v.getLayoutValue("text-optional",
z);this.rotationAlignment=v.getLayoutValue("text-rotation-alignment",z);this.rotationAlignment===a.RotationAlignment.AUTO&&(this.rotationAlignment=A?a.RotationAlignment.MAP:a.RotationAlignment.VIEWPORT);A=v.getLayoutProperty("text-anchor");A?.isDataDriven?this._anchorProp=A:this.anchor=v.getLayoutValue("text-anchor",z);A=v.getLayoutProperty("text-justify");A?.isDataDriven?this._justifyProp=A:this.justify=v.getLayoutValue("text-justify",z);A=v.getLayoutProperty("text-letter-spacing");A?.isDataDriven?
this._letterSpacingProp=A:this.letterSpacing=v.getLayoutValue("text-letter-spacing",z);A=v.getLayoutProperty("text-line-height");A?.isDataDriven?this._lineHeightProp=A:this.lineHeight=v.getLayoutValue("text-line-height",z);A=v.getLayoutProperty("text-max-angle");A?.isDataDriven?this._maxAngleProp=A:this.maxAngle=v.getLayoutValue("text-max-angle",z);A=v.getLayoutProperty("text-max-width");A?.isDataDriven?this._maxWidthProp=A:this.maxWidth=v.getLayoutValue("text-max-width",z);A=v.getLayoutProperty("text-offset");
A?.isDataDriven?this._offsetProp=A:this.offset=v.getLayoutValue("text-offset",z);A=v.getLayoutProperty("text-padding");A?.isDataDriven?this._paddingProp=A:this.padding=v.getLayoutValue("text-padding",z);A=v.getLayoutProperty("text-rotate");A?.isDataDriven?this._rotateProp=A:this.rotate=v.getLayoutValue("text-rotate",z);A=v.getLayoutProperty("text-size");A?.isDataDriven?this._sizeProp=A:this.size=v.getLayoutValue("text-size",z);A=v.getLayoutProperty("text-writing-mode");A?.isDataDriven?this._writingModeProp=
A:this.writingMode=v.getLayoutValue("text-writing-mode",z)}update(v,z){this._anchorProp&&(this.anchor=this._anchorProp.getValue(v,z));this._justifyProp&&(this.justify=this._justifyProp.getValue(v,z));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(v,z));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(v,z));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(v,z));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(v,z));this._offsetProp&&
(this.offset=this._offsetProp.getValue(v,z));this._paddingProp&&(this.padding=this._paddingProp.getValue(v,z));this._rotateProp&&(this.rotate=this._rotateProp.getValue(v,z));this._sizeProp&&(this.size=this._sizeProp.getValue(v,z));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(v,z))}}k.BackgroundStyleLayer=r;k.CircleStyleLayer=y;k.FillStyleLayer=q;k.IconLayout=C;k.LineStyleLayer=p;k.StyleLayer=n;k.SymbolStyleLayer=x;k.TextLayout=D;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,l,u,c){class f extends l.VTLMaterial{constructor(h){super(h)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES=[];f.GEOMETRY_LAYOUT=[new c.VertexElementDescriptor("a_pos",2,u.DataType.BYTE,
0,2)];f.ATTRIBUTES_INFO={};k.VTLBackgroundMaterial=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../MemoryBuffer","./enums","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,l,u,c,f){class h{constructor(a){this._locations=new Map;this._key=a}get key(){return this._key}get type(){return this._key&7}defines(){return[]}getStride(){this._layoutInfo||this._buildAttributesInfo();
return this._stride}getAttributeLocations(){0===this._locations.size&&this._buildAttributesInfo();return this._locations}getLayoutInfo(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo}getEncodingInfos(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo}getUniforms(){this._uniforms||this._buildAttributesInfo();return this._uniforms}getShaderHeader(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader}getShaderMain(){this._shaderMain||
this._buildAttributesInfo();return this._shaderMain}setDataUniforms(a,b,m,n,r){var q=this.getUniforms();for(const p of q){const {name:x,type:y,getValue:C}=p;q=C(m,b,n,r);if(null!==q)switch(y){case "float":a.setUniform1f(x,q);break;case "vec2":a.setUniform2fv(x,q);break;case "vec4":a.setUniform4fv(x,q)}}}encodeAttributes(a,b,m,n){const r=this.attributesInfo(),q=this.getEncodingInfos(),p=[];let x=0,y=0;for(const D of Object.keys(q)){var C=q[D];const {type:v,precisionFactor:z,isLayout:A}=r[D],G=A?m.getLayoutProperty(D):
m.getPaintProperty(D),F=G.interpolator?.getInterpolationRange(b);let M=0;for(const J of C){const {offset:K,bufferElementsToAdd:N}=J;if(0<N){for(C=0;C<N;C++)p.push(0);x+=y;y=J.bufferElementsToAdd}C=n??G.getValue(F?F[M]:b,a);switch(v){case u.EncodingType.R8_SIGNED:case u.EncodingType.R8_UNSIGNED:p[x]|=this._encodeByte(C*(z||1),8*K);break;case u.EncodingType.R16_SIGNED:case u.EncodingType.R16_UNSIGNED:p[x]|=this._encodeShort(C*(z||1),8*K);break;case u.EncodingType.R8G8_SIGNED:case u.EncodingType.R8G8_UNSIGNED:p[x]|=
this._encodeByte(C*(z||1),8*K);p[x]|=this._encodeByte(C*(z||1),8*K+8);break;case u.EncodingType.R16G16_SIGNED:case u.EncodingType.R16G16_UNSIGNED:p[x]|=this._encodeShort(C*(z||1),8*K);p[x]|=this._encodeShort(C*(z||1),8*K+16);break;case u.EncodingType.R8G8B8A8_SIGNED:case u.EncodingType.R8G8B8A8_UNSIGNED:p[x]|=this._encodeByte(C*(z||1),8*K);p[x]|=this._encodeByte(C*(z||1),8*K+8);p[x]|=this._encodeByte(C*(z||1),8*K+16);p[x]|=this._encodeByte(C*(z||1),8*K+24);break;case u.EncodingType.R8G8B8A8_COLOR:p[x]=
this._encodeColor(C);break;case u.EncodingType.R16G16B16A16_DASHARRAY:case u.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(x,p,C);break;default:throw Error("Unsupported encoding type");}M++}}return p}getAtributeState(a){const b=3+2*a;a=0|this._bit(b);return a|=this._bit(b+1)<<1}_buildAttributesInfo(){const a=[],b={};var m={},n=-1;const r=this.attributesInfo();var q=this.attributes();let p=-1;for(const D of q){p++;q=this.getAtributeState(p);if(q===u.AttributeStatus.UNIFORM||q===u.AttributeStatus.UNUSED)continue;
var x=r[D];const v=[];b[D]=v;x=x.type;for(let z=0;z<q;z++){const {dataType:A,bytesPerElement:G,count:F,normalized:M}=h._encodingInfo[x],J=G*F;var y=`${A}-${!0===M}`;let K=m[y],N=0;!K||4<K.count+F?(n++,K={dataIndex:n,count:0,offset:0},4!==F&&(m[y]=K),a.push({location:-1,name:"a_data_"+n,count:F,type:A,normalized:M}),N=Math.ceil(Math.max(J/4,1))):(y=a[K.dataIndex],y.count+=F,N=Math.ceil(Math.max(y.count*G/4,1))-Math.ceil(Math.max(K.offset/4,1)));v.push({dataIndex:K.dataIndex,offset:K.offset,bufferElementsToAdd:N});
K.offset+=J;K.count+=F}}for(const D of a)switch(D.type){case c.DataType.BYTE:case c.DataType.UNSIGNED_BYTE:D.count=4;break;case c.DataType.SHORT:case c.DataType.UNSIGNED_SHORT:D.count+=D.count%2}this._buildVertexBufferLayout(a);m=0;n=this._layoutInfo.geometry;for(var C of n)this._locations.set(C.name,m++);if(C=this._layoutInfo.opacity)for(const D of C)this._locations.set(D.name,m++);this._buildShaderInfo(a,b);this._propertyEncodingInfo=b}_buildVertexBufferLayout(a){const b={},m=this.geometryInfo();
let n=m[0].stride;if(0===a.length)b.geometry=m;else{const r=[];let q=n;for(const p of a)n+=e(p.type)*p.count;for(const p of m)r.push(new f.VertexElementDescriptor(p.name,p.count,p.type,p.offset,n,p.normalized));for(const p of a)r.push(new f.VertexElementDescriptor(p.name,p.count,p.type,q,n,p.normalized)),q+=e(p.type)*p.count;b.geometry=r}this.opacityInfo()&&(b.opacity=this.opacityInfo());this._layoutInfo=b;this._stride=n}_buildShaderInfo(a,b){let m="\n",n="\n";const r=[];for(var q of a)m+=`attribute ${this._getType(q.count)} ${q.name};\n`;
var p=this.attributes();a=this.attributesInfo();q=-1;for(const C of p){q++;const {name:D,type:v,precisionFactor:z,isLayout:A}=a[C];p=z&&1!==z?` * ${1/z}`:"";const {bytesPerElement:G,count:F}=h._encodingInfo[v];var x=M=>`a_data_${M.dataIndex}${g(F,M.offset,G)}`;switch(this.getAtributeState(q)){case u.AttributeStatus.UNIFORM:p=this._getType(F);var y=`u_${D}`;r.push({name:y,type:p,getValue:(J,K,N,H)=>{N=A?J.getLayoutValue(C,K):J.getPaintValue(C,K);if(v===u.EncodingType.R16G16B16A16_DASHARRAY){J=J.getDashKey(N,
J.getLayoutValue("line-cap",K));H=H.getMosaicItemPosition(J,!1);if(null==H)return null;const {tl:L,br:R}=H;return[L[0],R[1],R[0],L[1]]}if(v===u.EncodingType.R16G16B16A16_PATTERN){H=H.getMosaicItemPosition(N,!C.includes("line-"));if(null==H)return null;const {tl:L,br:R}=H;return[L[0],R[1],R[0],L[1]]}return v===u.EncodingType.R8G8B8A8_COLOR?(H=N[3],[H*N[0],H*N[1],H*N[2],H]):N}});m+=`uniform ${p} ${y};\n`;n+=`${p} ${D} = ${y};\n`;break;case u.AttributeStatus.DATA_DRIVEN:y=x(b[C][0]);n+=`${this._getType(F)} ${D} = ${y}${p};\n`;
break;case u.AttributeStatus.INTERPOLATED_DATA_DRIVEN:y=`u_t_${D}`;r.push({name:y,type:"float",getValue:(J,K,N,H)=>(A?J.getLayoutProperty(C):J.getPaintProperty(C)).interpolator.interpolationUniformValue(N,K)});m+=`uniform float ${y};\n`;const M=x(b[C][0]);x=x(b[C][1]);n+=`${this._getType(F)} ${D} = mix(${M}${p}, ${x}${p}, ${y});\n`}}this._shaderHeader=m;this._shaderMain=n;this._uniforms=r}_bit(a){return(this._key&1<<a)>>a}_getType(a){switch(a){case 1:return"float";case 2:return"vec2";case 3:return"vec3";
case 4:return"vec4"}throw Error("Invalid count");}_encodeColor(a){const b=255*a[3];return l.i8888to32(a[0]*b,a[1]*b,a[2]*b,b)}_encodePattern(a,b,m){if(m?.rect){var n=m.rect,r=m.width;m=m.height;b[a]=this._encodeShort(n.x+2,0);b[a]|=this._encodeShort(n.y+2+m,16);b[a+1]=this._encodeShort(n.x+2+r,0);b[a+1]|=this._encodeShort(n.y+2,16)}}_encodeByte(a,b){return(a&255)<<b}_encodeShort(a,b){return(a&65535)<<b}}h._encodingInfo={[u.EncodingType.R8_SIGNED]:{dataType:c.DataType.BYTE,bytesPerElement:1,count:1,
normalized:!1},[u.EncodingType.R8_UNSIGNED]:{dataType:c.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[u.EncodingType.R16_SIGNED]:{dataType:c.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[u.EncodingType.R16_UNSIGNED]:{dataType:c.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[u.EncodingType.R8G8_SIGNED]:{dataType:c.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},[u.EncodingType.R8G8_UNSIGNED]:{dataType:c.DataType.UNSIGNED_BYTE,bytesPerElement:1,
count:2,normalized:!1},[u.EncodingType.R16G16_SIGNED]:{dataType:c.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[u.EncodingType.R16G16_UNSIGNED]:{dataType:c.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[u.EncodingType.R8G8B8A8_SIGNED]:{dataType:c.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[u.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:c.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[u.EncodingType.R8G8B8A8_COLOR]:{dataType:c.DataType.UNSIGNED_BYTE,
bytesPerElement:1,count:4,normalized:!0},[u.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:c.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[u.EncodingType.R16G16B16A16_PATTERN]:{dataType:c.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const e=a=>{switch(a){case c.DataType.FLOAT:return 4;case c.DataType.INT:return 4;case c.DataType.UNSIGNED_INT:return 4;case c.DataType.SHORT:return 2;case c.DataType.UNSIGNED_SHORT:return 2;case c.DataType.BYTE:return 1;case c.DataType.UNSIGNED_BYTE:return 1}},
g=(a,b,m)=>{b/=m;if(1===a)switch(b){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===a)switch(b){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===a)switch(b){case 0:return".xyz";case 1:return".yzw"}return""};k.VTLMaterial=h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(function(){class k{constructor(l){this._array=[];0>=l&&console.error("strideInBytes must be positive!");
this._stride=l}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return(new Uint32Array(this._array)).buffer}static i1616to32(l,u){return 65535&l|u<<16}static i8888to32(l,u,c,f){return l&255|(u&255)<<8|(c&255)<<16|f<<24}static i8816to32(l,u,c){return l&255|(u&255)<<8|c<<16}}return k})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],
function(k){k.EncodingType=void 0;(function(l){l[l.R8_SIGNED=0]="R8_SIGNED";l[l.R8_UNSIGNED=1]="R8_UNSIGNED";l[l.R16_SIGNED=2]="R16_SIGNED";l[l.R16_UNSIGNED=3]="R16_UNSIGNED";l[l.R8G8_SIGNED=4]="R8G8_SIGNED";l[l.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";l[l.R16G16_SIGNED=6]="R16G16_SIGNED";l[l.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";l[l.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";l[l.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";l[l.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";l[l.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";
l[l.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(k.EncodingType||(k.EncodingType={}));k.AttributeStatus=void 0;(function(l){l[l.UNIFORM=0]="UNIFORM";l[l.DATA_DRIVEN=1]="DATA_DRIVEN";l[l.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";l[l.UNUSED=3]="UNUSED"})(k.AttributeStatus||(k.AttributeStatus={}));Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums",
"../../../../webgl/VertexElementDescriptor"],function(k,l,u,c,f){class h extends u.VTLMaterial{constructor(e){super(e)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");h.GEOMETRY_LAYOUT=[new f.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,4)];h.ATTRIBUTES_INFO=
{"circle-radius":{name:"radius",type:l.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:l.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:l.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:l.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:l.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:l.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",
type:l.EncodingType.R8_UNSIGNED,precisionFactor:32}};k.VTLCircleMaterial=h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,l,u,c,f){class h extends u.VTLMaterial{constructor(g){super(g)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}
h.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];h.GEOMETRY_LAYOUT=[new f.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,4)];h.ATTRIBUTES_INFO={"fill-color":{name:"color",type:l.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:l.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:l.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};class e extends u.VTLMaterial{constructor(g,a){super(g);this._usefillColor=a}geometryInfo(){return e.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?
e.ATTRIBUTES_FILL:e.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?e.ATTRIBUTES_INFO_FILL:e.ATTRIBUTES_INFO_OUTLINE}}e.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];e.ATTRIBUTES_FILL=["fill-color","fill-opacity"];e.GEOMETRY_LAYOUT=[new f.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,8),new f.VertexElementDescriptor("a_offset",2,c.DataType.BYTE,4,8),new f.VertexElementDescriptor("a_xnormal",2,c.DataType.BYTE,6,8)];e.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",
type:l.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:l.EncodingType.R8_UNSIGNED,precisionFactor:100}};e.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:l.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:l.EncodingType.R8_UNSIGNED,precisionFactor:100}};k.VTLFillMaterial=h;k.VTLOutlineMaterial=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./enums","./VTLMaterial",
"../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,l,u,c,f){class h extends u.VTLMaterial{constructor(e){super(e)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");h.GEOMETRY_LAYOUT=[new f.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,16),new f.VertexElementDescriptor("a_extrude_offset",
4,c.DataType.BYTE,4,16),new f.VertexElementDescriptor("a_dir_normal",4,c.DataType.BYTE,8,16),new f.VertexElementDescriptor("a_accumulatedDistance",2,c.DataType.UNSIGNED_SHORT,12,16)];h.ATTRIBUTES_INFO={"line-width":{name:"width",type:l.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:l.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:l.EncodingType.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:l.EncodingType.R8G8B8A8_COLOR},
"line-opacity":{name:"opacity",type:l.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:l.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:l.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:l.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};k.VTLLineMaterial=h;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports",
"./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,l,u,c,f){const h=[new f.VertexElementDescriptor("a_pos",2,c.DataType.SHORT,0,16),new f.VertexElementDescriptor("a_vertexOffset",2,c.DataType.SHORT,4,16),new f.VertexElementDescriptor("a_texAngleRange",4,c.DataType.UNSIGNED_BYTE,8,16),new f.VertexElementDescriptor("a_levelInfo",4,c.DataType.UNSIGNED_BYTE,12,16)],e=[new f.VertexElementDescriptor("a_opacityInfo",1,c.DataType.UNSIGNED_BYTE,0,1)];
class g extends u.VTLMaterial{constructor(b){super(b)}geometryInfo(){return h}opacityInfo(){return e}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}g.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");g.ATTRIBUTES_INFO={"icon-color":{name:"color",type:l.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:l.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:l.EncodingType.R8G8B8A8_COLOR},
"icon-halo-width":{name:"halo_width",type:l.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:l.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:l.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class a extends u.VTLMaterial{constructor(b){super(b)}geometryInfo(){return h}opacityInfo(){return e}attributes(){return a.ATTRIBUTES}attributesInfo(){return a.ATTRIBUTES_INFO}}a.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");
a.ATTRIBUTES_INFO={"text-color":{name:"color",type:l.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:l.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:l.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:l.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:l.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:l.EncodingType.R8_UNSIGNED,isLayout:!0}};k.VTLIconMaterial=
g;k.VTLTextMaterial=a;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(k,l){class u{constructor(c){this._expression=c}filter(c,f){if(!this._expression)return!0;try{return this._expression.evaluate(c,f)}catch(h){return console.log(h.message),!0}}static createFilter(c){if(!c)return null;this.isLegacyFilter(c)&&(c=this.convertLegacyFilter(c));try{const f=k.createExpression(c,
null,l.BooleanType);return new u(f)}catch(f){return console.log(f.message),null}}static isLegacyFilter(c){if(!Array.isArray(c)||0===c.length)return!0;switch(c[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===c.length&&"string"===typeof c[1]&&!Array.isArray(c[2]);case "in":return 3<=c.length&&"string"===typeof c[1]&&!Array.isArray(c[2]);case "!in":return!0;case "any":case "all":for(let f=1;f<c.length;f++)if(this.isLegacyFilter(c[f]))return!0;return!1;
case "none":return!0;case "has":return 2===c.length&&("$id"===c[1]||"$type"===c[1]);case "!has":return!0;default:return!1}}static convertLegacyFilter(c){if(!Array.isArray(c)||0===c.length)return!0;const f=c[0];if(1===c.length)return"any"!==f;switch(f){case "\x3d\x3d":return u.convertComparison("\x3d\x3d",c[1],c[2]);case "!\x3d":return u.negate(u.convertComparison("\x3d\x3d",c[1],c[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return u.convertComparison(f,c[1],c[2]);case "in":return u.convertIn(c[1],
c.slice(2));case "!in":return u.negate(u.convertIn(c[1],c.slice(2)));case "any":case "all":case "none":return u.convertCombining(f,c.slice(1));case "has":return u.convertHas(c[1]);case "!has":return u.negate(u.convertHas(c[1]));default:throw Error("Unexpected legacy filter.");}}static convertComparison(c,f,h){switch(f){case "$type":return[c,["geometry-type"],h];case "$id":return[c,["id"],h];default:return[c,["get",f],h]}}static convertIn(c,f){switch(c){case "$type":return["in",["geometry-type"],["literal",
f]];case "$id":return["in",["id"],["literal",f]];default:return["in",["get",c],["literal",f]]}}static convertHas(c){switch(c){case "$type":return!0;case "$id":return["has-id"];default:return["has",c]}}static convertCombining(c,f){return[c].concat(f.map(this.convertLegacyFilter))}static negate(c){return["!",c]}}return u})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../Color ../../../../../core/colorUtils ../../../../../geometry/support/TileClipper ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(k,l,u,c,f,h,e){function g(d,t,w){var B=typeof d;if("string"===B||"boolean"===B||"number"===B||null===d){if(w)switch(w.kind){case "string":"string"!==B&&(d=aa.toString(d));break;case "number":"number"!==B&&(d=aa.toNumber(d));break;case "color":d=aa.toColor(d)}d=["literal",d]}if(!Array.isArray(d)||0===d.length)throw Error("Expression must be a non empty array");B=d[0];if("string"!==typeof B)throw Error("First element of expression must be a string");const I=pa[B];if(void 0===I)throw Error(`Invalid expression operator "${B}"`);
if(!I)throw Error(`Unimplemented expression operator "${B}"`);return I.parse(d,t,w)}class a{constructor(d){this._parent=d;this._vars={}}add(d,t){this._vars[d]=t}get(d){return this._vars[d]?this._vars[d]:this._parent?this._parent.get(d):null}}class b{constructor(){this.type=e.ValueType}static parse(d){if(1<d.length)throw Error('"id" does not expect arguments');return new b}evaluate(d,t){return d?.id}}class m{constructor(){this.type=e.StringType}static parse(d){if(1<d.length)throw Error('"geometry-type" does not expect arguments');
return new m}evaluate(d,t){if(!d)return null;switch(d.type){case c.GeometryType.Point:return"Point";case c.GeometryType.LineString:return"LineString";case c.GeometryType.Polygon:return"Polygon";default:return null}}}class n{constructor(){this.type=e.ObjectType}static parse(d){if(1<d.length)throw Error('"properties" does not expect arguments');return new n}evaluate(d,t){return d?.values}}class r{constructor(){this.type=e.NumberType}static parse(d){if(1<d.length)throw Error('"zoom" does not expect arguments');
return new r}evaluate(d,t){return t}}class q{constructor(d,t,w){this._lhs=d;this._rhs=t;this._compare=w;this.type=e.BooleanType}static parse(d,t,w){if(3!==d.length&&4!==d.length)throw Error(`"${d[0]}" expects 2 or 3 arguments`);if(4===d.length)throw Error(`"${d[0]}" collator not supported`);return new q(g(d[1],t),g(d[2],t),w)}evaluate(d,t){return this._compare(this._lhs.evaluate(d,t),this._rhs.evaluate(d,t))}}class p extends q{static parse(d,t){return q.parse(d,t,(w,B)=>w===B)}}class x extends q{static parse(d,
t){return q.parse(d,t,(w,B)=>w!==B)}}class y extends q{static parse(d,t){return q.parse(d,t,(w,B)=>w<B)}}class C extends q{static parse(d,t){return q.parse(d,t,(w,B)=>w<=B)}}class D extends q{static parse(d,t){return q.parse(d,t,(w,B)=>w>B)}}class v extends q{static parse(d,t){return q.parse(d,t,(w,B)=>w>=B)}}class z{constructor(d){this._arg=d;this.type=e.BooleanType}static parse(d,t){if(2!==d.length)throw Error('"!" expects 1 argument');return new z(g(d[1],t))}evaluate(d,t){return!this._arg.evaluate(d,
t)}}class A{constructor(d){this._args=d;this.type=e.BooleanType}static parse(d,t){const w=[];for(let B=1;B<d.length;B++)w.push(g(d[B],t));return new A(w)}evaluate(d,t){for(const w of this._args)if(!w.evaluate(d,t))return!1;return!0}}class G{constructor(d){this._args=d;this.type=e.BooleanType}static parse(d,t){const w=[];for(let B=1;B<d.length;B++)w.push(g(d[B],t));return new G(w)}evaluate(d,t){for(const w of this._args)if(w.evaluate(d,t))return!0;return!1}}class F{constructor(d){this._args=d;this.type=
e.BooleanType}static parse(d,t){const w=[];for(let B=1;B<d.length;B++)w.push(g(d[B],t));return new F(w)}evaluate(d,t){for(const w of this._args)if(w.evaluate(d,t))return!1;return!0}}class M{constructor(d,t,w){this.type=d;this._args=t;this._fallback=w}static parse(d,t,w){if(4>d.length)throw Error('"case" expects at least 3 arguments');if(1===d.length%2)throw Error('"case" expects an odd number of arguments');let B;const I=[];for(let O=1;O<d.length-1;O+=2){const T=g(d[O],t),S=g(d[O+1],t,w);B||(B=S.type);
I.push({condition:T,output:S})}d=g(d[d.length-1],t,w);B||(B=d.type);return new M(B,I,d)}evaluate(d,t){for(const w of this._args)if(w.condition.evaluate(d,t))return w.output.evaluate(d,t);return this._fallback.evaluate(d,t)}}class J{constructor(d,t){this.type=d;this._args=t}static parse(d,t){if(2>d.length)throw Error('"coalesce" expects at least 1 argument');let w;const B=[];for(let I=1;I<d.length;I++){const O=g(d[I],t);w||(w=O.type);B.push(O)}return new J(w,B)}evaluate(d,t){for(const w of this._args){const B=
w.evaluate(d,t);if(null!==B)return B}return null}}class K{constructor(d,t,w,B,I){this.type=d;this._input=t;this._labels=w;this._outputs=B;this._fallback=I}static parse(d,t){if(3>d.length)throw Error('"match" expects at least 3 arguments');if(0===d.length%2)throw Error('"case" expects an even number of arguments');let w;const B=g(d[1],t),I=[],O={};let T;for(let ca=2;ca<d.length-1;ca+=2){var S=d[ca];Array.isArray(S)||(S=[S]);for(const fa of S){S=typeof fa;if("string"!==S&&"number"!==S)throw Error('"match" requires string or number literal as labels');
if(!T)T=S;else if(S!==T)throw Error('"match" requires labels to have the same type');O[fa]=I.length}S=g(d[ca+1],t);w||(w=S.type);I.push(S)}return new K(w,B,O,I,g(d[d.length-1],t))}evaluate(d,t){const w=this._input.evaluate(d,t);return(this._outputs[this._labels[w]]||this._fallback).evaluate(d,t)}}class N{constructor(d,t,w,B,I){this._operator=d;this.type=t;this.interpolation=w;this.input=B;this._stops=I}static parse(d,t,w){const B=d[0];if(5>d.length)throw Error(`"${B}" expects at least 4 arguments`);
const I=d[1];if(!Array.isArray(I)||0===I.length)throw Error(`"${I}" is not a valid interpolation`);switch(I[0]){case "linear":if(1!==I.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==I.length||"number"!==typeof I[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==I.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var O=1;5>O;O++){var T=
I[O];if("number"!==typeof T||0>T||1<T)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${d[0]}" unknown interpolation type "${I[0]}"`);}if(1!==d.length%2)throw Error(`"${B}" expects an even number of arguments`);O=g(d[2],t,e.NumberType);let S;"interpolate-hcl"===B||"interpolate-lab"===B?S=e.ColorType:w&&"value"!==w.kind&&(S=w);w=[];for(T=3;T<d.length;T+=2){const ca=d[T];if("number"!==typeof ca)throw Error(`"${B}" requires stop inputs as literal numbers`);
if(w.length&&w[w.length-1][0]>=ca)throw Error(`"${B}" requires strictly ascending stop inputs`);const fa=g(d[T+1],t,S);S||(S=fa.type);w.push([ca,fa])}if(S&&S!==e.ColorType&&S!==e.NumberType&&("array"!==S.kind||S.itemType!==e.NumberType))throw Error(`"${B}" cannot interpolate type ${e.typeToString(S)}`);return new N(B,S,I,O,w)}evaluate(d,t){var w=this._stops;if(1===w.length)return w[0][1].evaluate(d,t);var B=this.input.evaluate(d,t);if(B<=w[0][0])return w[0][1].evaluate(d,t);if(B>=w[w.length-1][0])return w[w.length-
1][1].evaluate(d,t);let I=0;for(;++I<w.length&&!(B<w[I][0]););const O=N.interpolationRatio(this.interpolation,B,w[I-1][0],w[I][0]);B=w[I-1][1].evaluate(d,t);const T=w[I][1].evaluate(d,t);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(B)&&Array.isArray(T))return B.map((S,ca)=>h.interpolate(S,T[ca],O));if("color"===this.type.kind&&B instanceof l&&T instanceof l)return B=new l(B),d=new l(T),new l([h.interpolate(B.r,d.r,O),h.interpolate(B.g,d.g,O),h.interpolate(B.b,d.b,
O),h.interpolate(B.a,d.a,O)]);if("number"===this.type.kind&&"number"===typeof B&&"number"===typeof T)return h.interpolate(B,T,O);throw Error(`"${this._operator}" cannot interpolate type ${e.typeToString(this.type)}`);}if("interpolate-hcl"===this._operator)return d=u.toLCH(B),t=u.toLCH(T),w=t.h-d.h,d=u.toRGB({h:d.h+O*(180<w||-180>w?w-360*Math.round(w/360):w),c:h.interpolate(d.c,t.c,O),l:h.interpolate(d.l,t.l,O)}),new l({a:h.interpolate(B.a,T.a,O),...d});if("interpolate-lab"===this._operator)return d=
u.toLAB(B),t=u.toLAB(T),d=u.toRGB({l:h.interpolate(d.l,t.l,O),a:h.interpolate(d.a,t.a,O),b:h.interpolate(d.b,t.b,O)}),new l({a:h.interpolate(B.a,T.a,O),...d});throw Error(`Unexpected operator "${this._operator}"`);}interpolationUniformValue(d,t){const w=this._stops;if(1===w.length||d>=w[w.length-1][0])return 0;let B=0;for(;++B<w.length&&!(d<w[B][0]););return N.interpolationRatio(this.interpolation,t,w[B-1][0],w[B][0])}getInterpolationRange(d){const t=this._stops;if(1===t.length)return d=t[0][0],[d,
d];var w=t[t.length-1][0];if(d>=w)return[w,w];for(w=0;++w<t.length&&!(d<t[w][0]););return[t[w-1][0],t[w][0]]}static interpolationRatio(d,t,w,B){let I=0;"linear"===d[0]?I=N._exponentialInterpolationRatio(t,1,w,B):"exponential"===d[0]?I=N._exponentialInterpolationRatio(t,d[1],w,B):"cubic-bezier"===d[0]&&(I=f.unitBezier(d[1],d[2],d[3],d[4])(N._exponentialInterpolationRatio(t,1,w,B),1E-5));0>I?I=0:1<I&&(I=1);return I}static _exponentialInterpolationRatio(d,t,w,B){B-=w;if(0===B)return 0;d-=w;return 1===
t?d/B:(t**d-1)/(t**B-1)}}class H{constructor(d,t,w){this.type=d;this._input=t;this._stops=w}static parse(d,t){if(5>d.length)throw Error('"step" expects at least 4 arguments');if(1!==d.length%2)throw Error('"step" expects an even number of arguments');const w=g(d[1],t,e.NumberType);let B;const I=[];I.push([-Infinity,g(d[2],t)]);for(let O=3;O<d.length;O+=2){const T=d[O];if("number"!==typeof T)throw Error('"step" requires stop inputs as literal numbers');if(I.length&&I[I.length-1][0]>=T)throw Error('"step" requires strictly ascending stop inputs');
const S=g(d[O+1],t);B||(B=S.type);I.push([T,S])}return new H(B,w,I)}evaluate(d,t){const w=this._stops;if(1===w.length)return w[0][1].evaluate(d,t);const B=this._input.evaluate(d,t);let I=0;for(;++I<w.length&&!(B<w[I][0]););return this._stops[I-1][1].evaluate(d,t)}}class L{constructor(d,t){this.type=d;this._output=t}static parse(d,t,w){if(4>d.length)throw Error('"let" expects at least 3 arguments');if(1===d.length%2)throw Error('"let" expects an odd number of arguments');const B=new a(t);for(let I=
1;I<d.length-1;I+=2){const O=d[I];if("string"!==typeof O)throw Error(`"let" requires a string to define variable names - found ${O}`);B.add(O,g(d[I+1],t))}d=g(d[d.length-1],B,w);return new L(d.type,d)}evaluate(d,t){return this._output.evaluate(d,t)}}class R{constructor(d,t){this.type=d;this.output=t}static parse(d,t,w){if(2!==d.length||"string"!==typeof d[1])throw Error('"var" requires just one literal string argument');t=t.get(d[1]);if(!t)throw Error(`${d[1]} must be defined before being used in a "var" expression`);
return new R(w||e.ValueType,t)}evaluate(d,t){return this.output.evaluate(d,t)}}class E{constructor(d,t,w){this.type=d;this._index=t;this._array=w}static parse(d,t){if(3!==d.length)throw Error('"at" expects 2 arguments');const w=g(d[1],t,e.NumberType);d=g(d[2],t);return new E(d.type.itemType,w,d)}evaluate(d,t){const w=this._index.evaluate(d,t);d=this._array.evaluate(d,t);if(0>w||w>=d.length)throw Error('"at" index out of bounds');if(w!==Math.floor(w))throw Error('"at" index must be an integer');return d[w]}}
class P{constructor(d,t){this._key=d;this._obj=t;this.type=e.ValueType}static parse(d,t){let w;switch(d.length){case 2:return w=g(d[1],t),new P(w);case 3:return w=g(d[1],t),d=g(d[2],t),new P(w,d);default:throw Error('"get" expects 1 or 2 arguments');}}evaluate(d,t){const w=this._key.evaluate(d,t);return this._obj?this._obj.evaluate(d,t)[w]:d?.values[w]}}class Q{constructor(d,t){this._key=d;this._obj=t;this.type=e.BooleanType}static parse(d,t){let w;switch(d.length){case 2:return w=g(d[1],t),new Q(w);
case 3:return w=g(d[1],t),d=g(d[2],t),new Q(w,d);default:throw Error('"has" expects 1 or 2 arguments');}}evaluate(d,t){const w=this._key.evaluate(d,t);return this._obj?(d=this._obj.evaluate(d,t),w in d):!!d?.values[w]}}class U{constructor(d,t){this._key=d;this._vals=t;this.type=e.BooleanType}static parse(d,t){if(3!==d.length)throw Error('"in" expects 2 arguments');return new U(g(d[1],t),g(d[2],t))}evaluate(d,t){const w=this._key.evaluate(d,t);return this._vals.evaluate(d,t).includes(w)}}class Y{constructor(d,
t,w){this._item=d;this._array=t;this._from=w;this.type=e.NumberType}static parse(d,t){if(3>d.length||4<d.length)throw Error('"index-of" expects 3 or 4 arguments');const w=g(d[1],t),B=g(d[2],t);return 4===d.length?(d=g(d[3],t,e.NumberType),new Y(w,B,d)):new Y(w,B)}evaluate(d,t){const w=this._item.evaluate(d,t),B=this._array.evaluate(d,t);if(this._from){d=this._from.evaluate(d,t);if(d!==Math.floor(d))throw Error('"index-of" index must be an integer');return B.indexOf(w,d)}return B.indexOf(w)}}class Z{constructor(d){this._arg=
d;this.type=e.NumberType}static parse(d,t){if(2!==d.length)throw Error('"length" expects 2 arguments');d=g(d[1],t);return new Z(d)}evaluate(d,t){d=this._arg.evaluate(d,t);if("string"===typeof d||Array.isArray(d))return d.length;throw Error('"length" expects string or array');}}class ba{constructor(d,t,w,B){this.type=d;this._array=t;this._from=w;this._to=B}static parse(d,t){if(3>d.length||4<d.length)throw Error('"slice" expects 2 or 3 arguments');const w=g(d[1],t),B=g(d[2],t,e.NumberType);if(B.type!==
e.NumberType)throw Error('"slice" index must return a number');if(4===d.length){d=g(d[3],t,e.NumberType);if(d.type!==e.NumberType)throw Error('"slice" index must return a number');return new ba(w.type,w,B,d)}return new ba(w.type,w,B)}evaluate(d,t){const w=this._array.evaluate(d,t);if(!Array.isArray(w)&&"string"!==typeof w)throw Error('"slice" input must be an array or a string');const B=this._from.evaluate(d,t);if(0>B||B>=w.length)throw Error('"slice" index out of bounds');if(B!==Math.floor(B))throw Error('"slice" index must be an integer');
if(this._to){d=this._to.evaluate(d,t);if(0>d||d>=w.length)throw Error('"slice" index out of bounds');if(d!==Math.floor(d))throw Error('"slice" index must be an integer');return w.slice(B,d)}return w.slice(B)}}class V{constructor(){this.type=e.BooleanType}static parse(d){if(1!==d.length)throw Error('"has-id" expects no arguments');return new V}evaluate(d,t){return void 0!==d?.id}}class W{constructor(d,t){this._args=d;this._calculate=t;this.type=e.NumberType}static parse(d,t,w){d=d.slice(1).map(B=>
g(B,t));return new W(d,w)}evaluate(d,t){let w;this._args&&(w=this._args.map(B=>B.evaluate(d,t)));return this._calculate(w)}}class ha extends W{static parse(d,t){switch(d.length){case 2:return W.parse(d,t,w=>-w[0]);case 3:return W.parse(d,t,w=>w[0]-w[1]);default:throw Error('"-" expects 1 or 2 arguments');}}}class ia extends W{static parse(d,t){return W.parse(d,t,w=>{let B=1;for(const I of w)B*=I;return B})}}class qa extends W{static parse(d,t){if(3===d.length)return W.parse(d,t,w=>w[0]/w[1]);throw Error('"/" expects 2 arguments');
}}class ra extends W{static parse(d,t){if(3===d.length)return W.parse(d,t,w=>w[0]%w[1]);throw Error('"%" expects 2 arguments');}}class sa extends W{static parse(d,t){if(3===d.length)return W.parse(d,t,w=>w[0]**w[1]);throw Error('"^" expects 1 or 2 arguments');}}class ta extends W{static parse(d,t){return W.parse(d,t,w=>{let B=0;for(const I of w)B+=I;return B})}}class X{constructor(d,t){this._args=d;this._calculate=t;this.type=e.NumberType}static parse(d,t){const w=d.slice(1).map(B=>g(B,t));return new X(w,
X.ops[d[0]])}evaluate(d,t){let w;this._args&&(w=this._args.map(B=>B.evaluate(d,t)));return this._calculate(w)}}X.ops={abs:d=>Math.abs(d[0]),acos:d=>Math.acos(d[0]),asin:d=>Math.asin(d[0]),atan:d=>Math.atan(d[0]),ceil:d=>Math.ceil(d[0]),cos:d=>Math.cos(d[0]),e:()=>Math.E,floor:d=>Math.floor(d[0]),ln:d=>Math.log(d[0]),ln2:()=>Math.LN2,log10:d=>Math.log(d[0])/Math.LN10,log2:d=>Math.log(d[0])/Math.LN2,max:d=>Math.max(...d),min:d=>Math.min(...d),pi:()=>Math.PI,round:d=>Math.round(d[0]),sin:d=>Math.sin(d[0]),
sqrt:d=>Math.sqrt(d[0]),tan:d=>Math.tan(d[0])};class ja{constructor(d){this._args=d;this.type=e.StringType}static parse(d,t){return new ja(d.slice(1).map(w=>g(w,t)))}evaluate(d,t){return this._args.map(w=>w.evaluate(d,t)).join("")}}class ea{constructor(d,t){this._arg=d;this._calculate=t;this.type=e.StringType}static parse(d,t){if(2!==d.length)throw Error(`${d[0]} expects 1 argument`);t=g(d[1],t);return new ea(t,ea.ops[d[0]])}evaluate(d,t){return this._calculate(this._arg.evaluate(d,t))}}ea.ops={downcase:d=>
d.toLowerCase(),upcase:d=>d.toUpperCase()};class ka{constructor(d){this._args=d;this.type=e.ColorType}static parse(d,t){if(4!==d.length)throw Error('"rgb" expects 3 arguments');d=d.slice(1).map(w=>g(w,t));return new ka(d)}evaluate(d,t){const w=this._validate(this._args[0].evaluate(d,t)),B=this._validate(this._args[1].evaluate(d,t));d=this._validate(this._args[2].evaluate(d,t));return new l({r:w,g:B,b:d})}_validate(d){if("number"!==typeof d||0>d||255<d)throw Error(`${d}: invalid color component`);
return Math.round(d)}}class la{constructor(d){this._args=d;this.type=e.ColorType}static parse(d,t){if(5!==d.length)throw Error('"rgba" expects 4 arguments');d=d.slice(1).map(w=>g(w,t));return new la(d)}evaluate(d,t){const w=this._validate(this._args[0].evaluate(d,t)),B=this._validate(this._args[1].evaluate(d,t)),I=this._validate(this._args[2].evaluate(d,t));d=this._validateAlpha(this._args[3].evaluate(d,t));return new l({r:w,g:B,b:I,a:d})}_validate(d){if("number"!==typeof d||0>d||255<d)throw Error(`${d}: invalid color component`);
return Math.round(d)}_validateAlpha(d){if("number"!==typeof d||0>d||1<d)throw Error(`${d}: invalid alpha color component`);return d}}class ma{constructor(d){this._color=d;this.type=e.arrayType(e.NumberType,4)}static parse(d,t){if(2!==d.length)throw Error('"to-rgba" expects 1 argument');d=g(d[1],t);return new ma(d)}evaluate(d,t){return(new l(this._color.evaluate(d,t))).toRgba()}}class da{constructor(d,t){this.type=d;this._args=t}static parse(d,t){var w=d[0];if(2>d.length)throw Error(`${w} expects at least one argument`);
let B=1,I;if("array"===w){if(2<d.length){switch(d[1]){case "string":I=e.StringType;break;case "number":I=e.NumberType;break;case "boolean":I=e.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}B++}else I=e.ValueType;if(3<d.length){var O=d[2];if(null!==O&&("number"!==typeof O||0>O||O!==Math.floor(O)))throw Error('"array" length argument must be a positive integer literal');B++}I=e.arrayType(I,O)}else switch(w){case "string":I=e.StringType;break;case "number":I=
e.NumberType;break;case "boolean":I=e.BooleanType;break;case "object":I=e.ObjectType}for(w=[];B<d.length;B++)O=g(d[B],t),w.push(O);return new da(I,w)}evaluate(d,t){let w;for(const B of this._args){const I=B.evaluate(d,t);w=e.getType(I);if(e.matchType(w,this.type))return I}throw Error(`Expected ${e.typeToString(this.type)} but got ${e.typeToString(w)}`);}}class aa{constructor(d,t){this.type=d;this._args=t}static parse(d,t){var w=d[0];const B=aa.types[w];if(B===e.BooleanType||B===e.StringType){if(2!==
d.length)throw Error(`${w} expects one argument`);}else if(2>d.length)throw Error(`${w} expects at least one argument`);w=[];for(let I=1;I<d.length;I++){const O=g(d[I],t);w.push(O)}return new aa(B,w)}evaluate(d,t){if(this.type===e.BooleanType)return!!this._args[0].evaluate(d,t);if(this.type===e.StringType)return e.valueToString(this._args[0].evaluate(d,t));if(this.type===e.NumberType){for(const B of this._args){var w=Number(B.evaluate(d,t));if(!isNaN(w))return w}return null}if(this.type===e.ColorType){for(w of this._args)try{const B=
aa.toColor(w.evaluate(d,t));if(B instanceof l)return B}catch{}return null}}static toBoolean(d){return!!d}static toString(d){return e.valueToString(d)}static toNumber(d){const t=Number(d);if(isNaN(t))throw Error(`"${d}" is not a number`);return t}static toColor(d){if(d instanceof l)return d;if("string"===typeof d){const t=l.fromString(d);if(t)return t;throw Error(`"${d}" is not a color`);}if(Array.isArray(d))return l.fromArray(d);throw Error(`"${d}" is not a color`);}}aa.types={"to-boolean":e.BooleanType,
"to-color":e.ColorType,"to-number":e.NumberType,"to-string":e.StringType};class na{constructor(d){this._val=d;this.type=e.getType(d)}static parse(d){if(2!==d.length)throw Error('"literal" expects 1 argument');return new na(d[1])}evaluate(d,t){return this._val}}class oa{constructor(d){this._arg=d;this.type=e.StringType}static parse(d,t){if(2!==d.length)throw Error('"typeof" expects 1 argument');return new oa(g(d[1],t))}evaluate(d,t){return e.typeToString(e.getType(this._arg.evaluate(d,t)))}}const pa=
{array:da,boolean:da,collator:null,format:null,image:null,literal:na,number:da,"number-format":null,object:da,string:da,"to-boolean":aa,"to-color":aa,"to-number":aa,"to-string":aa,typeof:oa,accumulated:null,"feature-state":null,"geometry-type":m,id:b,"line-progress":null,properties:n,at:E,get:P,has:Q,in:U,"index-of":Y,length:Z,slice:ba,"!":z,"!\x3d":x,"\x3c":y,"\x3c\x3d":C,"\x3d\x3d":p,"\x3e":D,"\x3e\x3d":v,all:A,any:G,case:M,coalesce:J,match:K,within:null,interpolate:N,"interpolate-hcl":N,"interpolate-lab":N,
step:H,let:L,var:R,concat:ja,downcase:ea,"is-supported-script":null,"resolved-locale":null,upcase:ea,rgb:ka,rgba:la,"to-rgba":ma,"-":ha,"*":ia,"/":qa,"%":ra,"^":sa,"+":ta,abs:X,acos:X,asin:X,atan:X,ceil:X,cos:X,e:X,floor:X,ln:X,ln2:X,log10:X,log2:X,max:X,min:X,pi:X,round:X,sin:X,sqrt:X,tan:X,zoom:r,"heatmap-density":null,"has-id":V,none:F};k.ALL=A;k.ANY=G;k.Add=ta;k.Assert=da;k.At=E;k.Calculate=X;k.Case=M;k.Coalesce=J;k.Coerce=aa;k.Concat=ja;k.Div=qa;k.EQ=p;k.GE=v;k.GT=D;k.GeomType=m;k.Get=P;k.Has=
Q;k.HasID=V;k.ID=b;k.In=U;k.IndexOf=Y;k.Interpolate=N;k.LE=C;k.LT=y;k.Length=Z;k.Let=L;k.Literal=na;k.Match=K;k.Mod=ra;k.Mul=ia;k.NE=x;k.NONE=F;k.NOT=z;k.Pow=sa;k.Properties=n;k.Rgb=ka;k.Rgba=la;k.Slice=ba;k.Step=H;k.String=ea;k.Sub=ha;k.ToRgba=ma;k.TypeOf=oa;k.Var=R;k.Zoom=r;k.createExpression=g;k.ops=pa;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(k){k.GeometryType=void 0;(function(a){a[a.Unknown=0]="Unknown";
a[a.Point=1]="Point";a[a.LineString=2]="LineString";a[a.Polygon=3]="Polygon"})(k.GeometryType||(k.GeometryType={}));class l{constructor(a,b){this.x=a;this.y=b}clone(){return new l(this.x,this.y)}equals(a,b){return a===this.x&&b===this.y}isEqual(a){return a.x===this.x&&a.y===this.y}setCoords(a,b){this.x=a;this.y=b}normalize(){var a=this.x;const b=this.y;a=Math.sqrt(a*a+b*b);this.x/=a;this.y/=a}rightPerpendicular(){const a=this.x;this.x=this.y;this.y=-a}move(a,b){this.x+=a;this.y+=b}assign(a){this.x=
a.x;this.y=a.y}assignAdd(a,b){this.x=a.x+b.x;this.y=a.y+b.y}assignSub(a,b){this.x=a.x-b.x;this.y=a.y-b.y}rotate(a,b){const m=this.x,n=this.y;this.x=m*a-n*b;this.y=m*b+n*a}scale(a){this.x*=a;this.y*=a}length(){const a=this.x,b=this.y;return Math.sqrt(a*a+b*b)}static distance(a,b){const m=b.x-a.x;a=b.y-a.y;return Math.sqrt(m*m+a*a)}static add(a,b){return new l(a.x+b.x,a.y+b.y)}static sub(a,b){return new l(a.x-b.x,a.y-b.y)}}class u{constructor(a,b,m){this.ratio=a;this.x=b;this.y=m}}class c{constructor(a,
b,m,n=8,r=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=n;this._pixelMargin=r;this._tileSize=512*n;this._dz=a;this._yPos=b;this._xPos=m}setPixelMargin(a){a!==this._pixelMargin&&(this._pixelMargin=a,this.setExtent(this._extent))}setExtent(a){this._extent=a;this._finalRatio=this._tileSize/a*(1<<this._dz);let b=this._pixelRatio*this._pixelMargin;b/=this._finalRatio;a>>=this._dz;b>a&&(b=a);this._margin=b;this._xmin=a*this._xPos-b;this._ymin=a*this._yPos-b;this._xmax=
this._xmin+a+2*b;this._ymax=this._ymin+a+2*b}reset(a){this._type=a;this._lines=[];this._starts=[];this._line=null;this._start=0}moveTo(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new l(a,b);this._firstPt=new l(a,b);this._dist=0}lineTo(a,b){const m=this._isIn(a,b),n=new l(a,b),r=l.distance(this._prevPt,n);if(m)if(this._prevIsIn)this._lineTo(a,b,!0);else{var q=this._prevPt;var p=n;a=this._intersect(p,q);this._start=this._dist+r*(1-this._r);this._lineTo(a.x,
a.y,!0);this._lineTo(p.x,p.y,!0)}else if(this._prevIsIn)p=this._prevPt,q=n,a=this._intersect(p,q),this._lineTo(a.x,a.y,!0),this._lineTo(q.x,q.y,!1);else{const y=this._prevPt;if(!(y.x<=this._xmin&&n.x<=this._xmin||y.x>=this._xmax&&n.x>=this._xmax||y.y<=this._ymin&&n.y<=this._ymin||y.y>=this._ymax&&n.y>=this._ymax)){a=[];if(y.x<this._xmin&&n.x>this._xmin||y.x>this._xmin&&n.x<this._xmin){b=(this._xmin-y.x)/(n.x-y.x);var x=y.y+b*(n.y-y.y);x<=this._ymin?p=!1:x>=this._ymax?p=!0:a.push(new u(b,this._xmin,
x))}if(y.x<this._xmax&&n.x>this._xmax||y.x>this._xmax&&n.x<this._xmax)b=(this._xmax-y.x)/(n.x-y.x),x=y.y+b*(n.y-y.y),x<=this._ymin?p=!1:x>=this._ymax?p=!0:a.push(new u(b,this._xmax,x));if(y.y<this._ymin&&n.y>this._ymin||y.y>this._ymin&&n.y<this._ymin)b=(this._ymin-y.y)/(n.y-y.y),x=y.x+b*(n.x-y.x),x<=this._xmin?q=!1:x>=this._xmax?q=!0:a.push(new u(b,x,this._ymin));if(y.y<this._ymax&&n.y>this._ymax||y.y>this._ymax&&n.y<this._ymax)b=(this._ymax-y.y)/(n.y-y.y),x=y.x+b*(n.x-y.x),x<=this._xmin?q=!1:x>=
this._xmax?q=!0:a.push(new u(b,x,this._ymax));if(0===a.length)q?p?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):p?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this._start=this._dist+r*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this._start=this._dist+r*a[0].ratio,q=0;q<a.length;q++)this._lineTo(a[q].x,a[q].y,!0)}this._lineTo(n.x,n.y,!1)}this._dist+=r;this._prevIsIn=
m;this._prevPt=n}close(){if(2<this._line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this._line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}}result(a=!0){this._pushLine();if(0===this._lines.length)return null;this._type===k.GeometryType.Polygon&&a&&e.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines}resultWithStarts(){if(this._type!==
k.GeometryType.LineString)throw Error("Only valid for lines");this._pushLine();const a=this._lines,b=a.length;if(0===b)return null;const m=[];for(let n=0;n<b;n++)m.push({line:a[n],start:this._starts[n]||0});return m}_isIn(a,b){return a>=this._xmin&&a<=this._xmax&&b>=this._ymin&&b<=this._ymax}_intersect(a,b){let m,n,r;if(b.x>=this._xmin&&b.x<=this._xmax)n=b.y<=this._ymin?this._ymin:this._ymax,r=(n-a.y)/(b.y-a.y),m=a.x+r*(b.x-a.x);else if(b.y>=this._ymin&&b.y<=this._ymax)m=b.x<=this._xmin?this._xmin:
this._xmax,r=(m-a.x)/(b.x-a.x),n=a.y+r*(b.y-a.y);else{n=b.y<=this._ymin?this._ymin:this._ymax;m=b.x<=this._xmin?this._xmin:this._xmax;const q=(m-a.x)/(b.x-a.x),p=(n-a.y)/(b.y-a.y);q<p?(r=q,n=a.y+q*(b.y-a.y)):(r=p,m=a.x+p*(b.x-a.x))}this._r=r;return new l(m,n)}_pushLine(){this._line&&(this._type===k.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===k.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):
this._type===k.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0}_moveTo(a,b,m){this._type!==k.GeometryType.Polygon?m&&(a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new l(a,b))):(m||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+
this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new l(a,b)),this._isV=this._isH=!1)}_lineTo(a,b,m){if(this._type!==k.GeometryType.Polygon)if(m){a=Math.round((a-(this._xmin+this._margin))*this._finalRatio);b=Math.round((b-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(m=this._line[this._line.length-1],m.equals(a,b)))return;this._line.push(new l(a,b))}else this._line&&0<this._line.length&&this._pushLine();else if(m||
(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line&&0<this._line.length){m=this._line[this._line.length-1];const n=m.x===a,r=m.y===b;n&&r||(this._isH&&n?(m.x=a,m.y=b,m=this._line[this._line.length-2],m.x===a&&m.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(m=this._line[this._line.length-
2],this._isH=m.x===a,this._isV=m.y===b)):(this._isH=m.x===a,this._isV=m.y===b)):this._isV&&r?(m.x=a,m.y=b,m=this._line[this._line.length-2],m.x===a&&m.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(m=this._line[this._line.length-2],this._isH=m.x===a,this._isV=m.y===b)):(this._isH=m.x===a,this._isV=m.y===b)):(this._line.push(new l(a,b)),this._isH=n,this._isV=r))}else this._line.push(new l(a,b))}}class f{setExtent(a){this._ratio=4096===a?1:4096/a}get validateTessellation(){return 1>
this._ratio}reset(a){this._lines=[];this._line=null}moveTo(a,b){this._line&&this._lines.push(this._line);this._line=[];const m=this._ratio;this._line.push(new l(a*m,b*m))}lineTo(a,b){const m=this._ratio;this._line.push(new l(a*m,b*m))}close(){const a=this._line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])}result(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines}}var h;(function(a){a[a.sideLeft=0]="sideLeft";a[a.sideRight=1]="sideRight";a[a.sideTop=2]="sideTop";
a[a.sideBottom=3]="sideBottom"})(h||(h={}));class e{static simplify(a,b,m){if(m){var n=-b,r=a+b,q=-b,p=a+b;a=[];b=[];var x=m.length;for(let y=0;y<x;++y){const C=m[y];if(!C||2>C.length)continue;let D=C[0],v;const z=C.length;for(let A=1;A<z;++A)v=C[A],D.x===v.x&&(D.x<=n&&(D.y>v.y?(a.push(y),a.push(A),a.push(h.sideLeft),a.push(-1)):(b.push(y),b.push(A),b.push(h.sideLeft),b.push(-1))),D.x>=r&&(D.y<v.y?(a.push(y),a.push(A),a.push(h.sideRight),a.push(-1)):(b.push(y),b.push(A),b.push(h.sideRight),b.push(-1)))),
D.y===v.y&&(D.y<=q&&(D.x<v.x?(a.push(y),a.push(A),a.push(h.sideTop),a.push(-1)):(b.push(y),b.push(A),b.push(h.sideTop),b.push(-1))),D.y>=p&&(D.x>v.x?(a.push(y),a.push(A),a.push(h.sideBottom),a.push(-1)):(b.push(y),b.push(A),b.push(h.sideBottom),b.push(-1)))),D=v}0!==a.length&&0!==b.length&&(e.fillParent(m,b,a),e.fillParent(m,a,b),n=[],e.calcDeltas(n,b,a),e.calcDeltas(n,a,b),e.addDeltas(n,m))}}static fillParent(a,b,m){const n=m.length,r=b.length;for(let C=0;C<r;C+=4){var q=b[C],p=b[C+1];const D=b[C+
2],v=a[q][p-1];q=a[q][p];p=8092;let z=-1;for(let A=0;A<n;A+=4){if(m[A+2]!==D)continue;var x=m[A];const G=m[A+1];var y=a[x][G-1];x=a[x][G];switch(D){case h.sideLeft:case h.sideRight:g(v.y,y.y,x.y)&&g(q.y,y.y,x.y)&&(y=Math.abs(x.y-y.y),y<p&&(p=y,z=A));break;case h.sideTop:case h.sideBottom:g(v.x,y.x,x.x)&&g(q.x,y.x,x.x)&&(y=Math.abs(x.x-y.x),y<p&&(p=y,z=A))}}b[C+3]=z}}static calcDeltas(a,b,m){const n=b.length;for(let r=0;r<n;r+=4){const q=e.calcDelta(r,b,m,[]);a.push(b[r]);a.push(b[r+1]);a.push(b[r+
2]);a.push(q)}}static calcDelta(a,b,m,n){a=b[a+3];if(-1===a)return 0;const r=n.length;if(1<r&&n[r-2]===a)return 0;n.push(a);return e.calcDelta(a,m,b,n)+1}static addDeltas(a,b){const m=a.length;let n=0;for(var r=0;r<m;r+=4){var q=a[r+3];q>n&&(n=q)}for(r=0;r<m;r+=4){q=b[a[r]];const p=a[r+1],x=n-a[r+3];switch(a[r+2]){case h.sideLeft:q[p-1].x-=x;q[p].x-=x;1===p&&(q[q.length-1].x-=x);p===q.length-1&&(q[0].x-=x);break;case h.sideRight:q[p-1].x+=x;q[p].x+=x;1===p&&(q[q.length-1].x+=x);p===q.length-1&&(q[0].x+=
x);break;case h.sideTop:q[p-1].y-=x;q[p].y-=x;1===p&&(q[q.length-1].y-=x);p===q.length-1&&(q[0].y-=x);break;case h.sideBottom:q[p-1].y+=x,q[p].y+=x,1===p&&(q[q.length-1].y+=x),p===q.length-1&&(q[0].y+=x)}}}}const g=(a,b,m)=>a>=b&&a<=m||a>=m&&a<=b;k.Point=l;k.SimpleBuilder=f;k.TileClipper=c;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/unitBezier":function(){define(["exports"],function(k){function l(f,h,e,g){function a(x,y){var C;let D,v;D=x;for(C=0;8>C;C++){v=((n*
D+m)*D+b)*D-x;if(Math.abs(v)<y)return D;var z=(3*n*D+2*m)*D+b;if(1E-6>Math.abs(z))break;D-=v/z}z=0;C=1;D=x;if(D<z)return z;if(D>C)return C;for(;z<C;){v=((n*D+m)*D+b)*D;if(Math.abs(v-x)<y)break;x>v?z=D:C=D;D=.5*(C-z)+z}return D}const b=3*f,m=3*(e-f)-b,n=1-b-m,r=3*h,q=3*(g-h)-r,p=1-r-q;return function(x,y=1E-6){x=a(x,y);return((p*x+q)*x+r)*x}}const u=/^cubic-bezier\((.*)\)/,c={};c.ease=l(.25,.1,.25,1);c.linear=l(0,0,1,1);c.easeIn=c["ease-in"]=l(.42,0,1,1);c.easeOut=c["ease-out"]=l(0,0,.58,1);c.easeInOut=
c["ease-in-out"]=l(.42,0,.58,1);k.easingFunctions=c;k.parse=function(f){let h=c[f]||null;!h&&(f=u.exec(f))&&(f=f[1].split(",").map(e=>parseFloat(e.trim())),4!==f.length||f.some(e=>isNaN(e))||(h=l.apply(l,f)));return h};k.unitBezier=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],function(k){function l(g,a){g%=a;return 0<=g?g:g+a}const u=Number.POSITIVE_INFINITY,c=Math.PI,f=128/c,h=256/360,e=1/Math.LN2;
k.between=function(g,a,b){return g>=a&&g<=b||g>=b&&g<=a};k.c2pi=2*c;k.cDegTo256=h;k.cDegToRad=c/180;k.cInfinity=u;k.cPi=c;k.cRadTo256=f;k.degToByte=function(g){return l(g*h,256)};k.interpolate=function(g,a,b){return g*(1-b)+a*b};k.log2=function(g){return Math.log(g)*e};k.positiveMod=l;k.radToByte=function(g){return l(g*f,256)};k.sqr=function(g){return g*g};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports",
"../../../../../Color"],function(k,l){function u(p,x){return{kind:"array",itemType:p,n:x}}function c(p){if("array"===p.kind){const x=c(p.itemType);return"number"===typeof p.n?`array<${x}, ${p.n}>`:"value"===p.itemType.kind?"array":`array<${x}>`}return p.kind}function f(p){if(null===p)return e;if("string"===typeof p)return a;if("boolean"===typeof p)return b;if("number"===typeof p)return g;if(p instanceof l)return m;if(Array.isArray(p)){let x;for(const y of p){const C=f(y);if(!x)x=C;else if(x!==C){x=
r;break}}return u(x||r,p.length)}return"object"===typeof p?n:r}function h(p,x){if("array"===x.kind)return"array"===p.kind&&(0===p.n&&"value"===p.itemType.kind||h(p.itemType,x.itemType))&&("number"!==typeof x.n||x.n===p.n);if("value"===x.kind)for(const y of q)if(h(p,y))return!0;return x.kind===p.kind}const e={kind:"null"},g={kind:"number"},a={kind:"string"},b={kind:"boolean"},m={kind:"color"},n={kind:"object"},r={kind:"value"},q=[e,g,a,b,m,n,u(r)];k.BooleanType=b;k.ColorType=m;k.NullType=e;k.NumberType=
g;k.ObjectType=n;k.StringType=a;k.ValueType=r;k.arrayType=u;k.getType=f;k.matchType=h;k.typeToString=c;k.valueToString=function(p){if(null===p)return"";const x=typeof p;return"string"===x?p:"number"===x||"boolean"===x?String(p):p instanceof l?p.toString():JSON.stringify(p)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],
function(k,l,u,c){class f{constructor(h,e){this.isDataDriven=!1;this.interpolator=null;switch(h.type){case "number":var g=!0;break;case "color":g=!0;break;case "array":g="number"===h.value;break;default:g=!1}null==e&&(e=h.default);if(Array.isArray(e)&&0<e.length&&u.ops[e[0]]){g={number:c.NumberType,color:c.ColorType,string:c.StringType,boolean:c.BooleanType,enum:c.StringType};try{var a="array"===h.type?c.arrayType(g[h.value]||c.ValueType,h.length):g[h.type];const b=u.createExpression(e,null,a);this.getValue=
this._buildExpression(b,h);this.isDataDriven=!0;b instanceof u.Interpolate&&b.input instanceof u.Zoom&&(this.interpolator=b)}catch(b){console.log(b.message),this.getValue=this._buildSimple(h.default)}}else{g&&"interval"===e.type&&(g=!1);if(a=e?.stops&&0<e.stops.length)for(const b of e.stops)b[1]=this._validate(b[1],h);if(this.isDataDriven=e?!!e.property:!1)if(void 0!==e.default&&(e.default=this._validate(e.default,h)),a)switch(e.type){case "identity":this.getValue=this._buildIdentity(e,h);break;case "categorical":this.getValue=
this._buildCategorical(e,h);break;default:this.getValue=g?this._buildInterpolate(e,h):this._buildInterval(e,h)}else this.getValue=this._buildIdentity(e,h);else a?this.getValue=g?this._buildZoomInterpolate(e):this._buildZoomInterval(e):(e=this._validate(e,h),this.getValue=this._buildSimple(e))}}_validate(h,e){if("number"===e.type){if(null!=e.minimum&&h<e.minimum)return e.minimum;if(null!=e.maximum&&h>e.maximum)return e.maximum}else"color"===e.type?h=f._parseColor(h):"enum"===e.type?"string"===typeof h&&
(h=e.values.indexOf(h)):"array"===e.type&&"enum"===e.value?h=h.map(g=>"string"===typeof g?e.values.indexOf(g):g):"string"===e.type&&(h=c.valueToString(h));return h}_buildSimple(h){return()=>h}_buildExpression(h,e){return(g,a)=>{try{const b=h.evaluate(a,g);return void 0===b?e.default:this._validate(b,e)}catch(b){return console.log(b.message),e.default}}}_buildIdentity(h,e){return(g,a)=>{let b;a&&(b=a.values[h.property]);void 0!==b&&(b=this._validate(b,e));return null!=b?b:void 0!==h.default?h.default:
e.default}}_buildCategorical(h,e){return(g,a)=>{let b;a&&(b=a.values[h.property]);b=this._categorical(b,h.stops);return void 0!==b?b:void 0!==h.default?h.default:e.default}}_buildInterval(h,e){return(g,a)=>{let b;a&&(b=a.values[h.property]);return"number"===typeof b?this._interval(b,h.stops):void 0!==h.default?h.default:e.default}}_buildInterpolate(h,e){return(g,a)=>{let b;a&&(b=a.values[h.property]);return"number"===typeof b?this._interpolate(b,h.stops,h.base||1):void 0!==h.default?h.default:e.default}}_buildZoomInterpolate(h){return e=>
this._interpolate(e,h.stops,h.base||1)}_buildZoomInterval(h){return e=>this._interval(e,h.stops)}_categorical(h,e){const g=e.length;for(let a=0;a<g;a++)if(e[a][0]===h)return e[a][1]}_interval(h,e){const g=e.length;let a=0;for(let b=0;b<g;b++)if(e[b][0]<=h)a=b;else break;return e[a][1]}_interpolate(h,e,g){const a=e.length;for(let n=0;n<a;n++){const r=e[n];if(r[0]<=h)var b=r;else{var m=r;break}}if(b&&m){e=m[0]-b[0];h-=b[0];g=1===g?h/e:(g**h-1)/(g**e-1);if(Array.isArray(b[1])){b=b[1];m=m[1];h=[];for(e=
0;e<b.length;e++)h.push(l.interpolate(b[e],m[e],g));return h}return l.interpolate(b[1],m[1],g)}if(b)return b[1];if(m)return m[1]}static _isEmpty(h){for(const e in h)if(h.hasOwnProperty(e))return!1;return!0}static _parseColor(h){if(Array.isArray(h))return h;"string"===typeof h&&(h=new k(h));if(h instanceof k&&!this._isEmpty(h))return k.toUnitRGBA(h)}}return f})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../2d/engine/vectorTiles/SchemaHelper ../../2d/engine/vectorTiles/TileHandler3D ../../2d/engine/vectorTiles/VTLPainter3D ../../2d/engine/vectorTiles/style/StyleRepository ./LayerView3D ./TiledLayerView3D ../terrain/terrainUtils ../../layers/LayerView".split(" "),function(k,
l,u,c,f,h,e,g,a,b,m,n,r,q,p,x,y,C){function D(v){return z=>v.immediate.schedule(z)}g=class extends x.TiledLayerView3D(p.LayerView3D(C)){constructor(){super(...arguments);this._tileHandlerController=null;this.type="vector-tile-3d";this.levelShift=u("disable-feature:vtl-level-shift")?0:1}initialize(){if(null==this.layer.fullExtent)this.addResolvingPromise(Promise.reject(new l("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));else{var {basemapTerrain:v,
spatialReference:z,state:A,viewingMode:G}=this.view,F="local"===G&&!y.vtlAssumes256PixelSizeAsDefault(z)||y.test.force512VTL,M=this.layer.tileInfo.spatialReference.isGeographic;F=F?this.layer.tileInfo:this.layer.tileInfo.getOrCreateCompatible(256,M?1:2);F=this._getTileInfoSupportError(F,this.layer.fullExtent);if(null!=F)return this.addResolvingPromise(Promise.reject(F));F=h.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{var H=v.tilingScheme,L=H.pixelSize;this.schemaHelper=new m.SchemaHelper(256===
L?1:2,v.spatialReference?.isGeographic&&256===L?1:0,this.levelShift+(v.spatialReference?.isGeographic||256!==L?0:1));L=256===L?this.layer.tileInfo.getOrCreateCompatible(256,this.layer.tileInfo.spatialReference.isGeographic?1:2):this.view.spatialReference?.isGeographic?this.layer.tileInfo.getOrCreateCompatible(512,.5):this.layer.tileInfo;if(H=this._getTileInfoCompatibilityError(L,H))throw H;this.tileInfo=L});this._tileHandlerController=new AbortController;M=this.view.resourceController;this._memCache=
M.memoryController.newCache(`vtl-${this.layer.uid}`,H=>{H.release()});this.addHandles(h.watch(()=>this.view.qualitySettings.memoryLimit,H=>this._memCache.maxSize=Math.ceil(H/10*1048576),h.syncAndInitial));var J=new q(this.layer.currentStyleInfo.style);this._tileHandler=new n(this.layer,J,A.contentPixelRatio,this._memCache);var K=this._tileHandlerController.signal,N=D(M);M=this._tileHandler.start({signal:K,schedule:N});J=this._tileHandler.spriteMosaic;J.then(H=>{!f.isAborted(K)&&this._tileHandler&&
(this.painter=new r(H,this._tileHandler.glyphMosaic))});M.then(()=>this._tileHandlerController=null);this._updatingHandles.add(()=>({style:this.layer.currentStyleInfo.style,pixelRatio:this.view.state?.contentPixelRatio}),({style:H,pixelRatio:L})=>{this._tileHandlerController&&this._tileHandlerController.abort();this._tileHandlerController=new AbortController;this._memCache.clear();H=new q(H);const R=new n(this.layer,H,L,this._memCache);L=R.start({signal:this._tileHandlerController.signal,schedule:N});
H=R.spriteMosaic;L.then(()=>this._tileHandlerController=null);this._updatingHandles.addPromise(Promise.all([L,H]).then(([,E])=>{const P=this._tileHandler,Q=this.painter;this.painter=new r(E,R.glyphMosaic);this._tileHandler=R;this.emit("data-changed");P.destroy();Q&&Q.dispose()}))});F=Promise.all([F,M,J]);this.addResolvingPromise(F)}}destroy(){this.painter=c.disposeMaybe(this.painter);this._tileHandlerController=c.abortMaybe(this._tileHandlerController);this._tileHandler=c.destroyMaybe(this._tileHandler);
this._memCache=c.destroyMaybe(this._memCache)}get contentZoom(){return u("disable-feature:vtl-level-shift")?1:this.view.qualitySettings.tiledSurface.vtlContentZoom}get displayLevelRange(){var v=this.tileInfo.lods;v=this.levelRangeFromScaleRange(this.layer.minScale||v[0].scale,this.layer.maxScale||v[v.length-1].scale);this.layer.maxScale?v.maxLevel++:v.maxLevel+=this.levelShift;return v}get dataScaleRange(){const v=this.tileInfo.lods;return{minScale:v[0].scale,maxScale:v[v.length-1].scale}}get dataLevelRange(){const {minScale:v,
maxScale:z}=this.dataScaleRange,A=this.levelRangeFromScaleRange(v,z);1===A.minLevel&&256===this.tileInfo.size[0]&&(A.minLevel=0);A.maxLevel+=this.levelShift;return A}async fetchTile(v,z,A,G){return this._tileHandler.getVectorTile(v,z,A,G)}};k.__decorate([e.property()],g.prototype,"layer",void 0);k.__decorate([e.property()],g.prototype,"levelShift",void 0);k.__decorate([e.property()],g.prototype,"contentZoom",null);k.__decorate([e.property()],g.prototype,"displayLevelRange",null);k.__decorate([e.property()],
g.prototype,"tileInfo",void 0);k.__decorate([e.property()],g.prototype,"dataScaleRange",null);k.__decorate([e.property()],g.prototype,"dataLevelRange",null);k.__decorate([e.property()],g.prototype,"updatingProgressValue",void 0);return g=k.__decorate([b.subclass("esri.views.3d.layers.VectorTileLayerView3D")],g)});