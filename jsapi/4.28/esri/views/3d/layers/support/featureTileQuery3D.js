// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),function(q,c,l,v,r,d,y,z,A,m,t,u,w){let f=class extends l{constructor(a){super(a)}get queryFeaturesDehydrated(){var a=
this.layer.capabilities;a=a&&a.query;const b=this.layer.parsedUrl;if(a&&a.supportsFormatPBF){null==this._decoder&&(this._decoder=new w.PBFDecoder(this.controller));const e={sourceSpatialReference:this.layer.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeLength:1024};return(p,g)=>u.runQuery(b,p,"pbf",this._createRequestOptions(g)).then(x=>{r.throwIfAborted(g);return null!=this._decoder?this._decoder.invoke({buffer:x.data,options:e},g.signal):Promise.reject(r.createAbortError())})}return(e,
p)=>u.executeQuery(b,e,this.layer.spatialReference,this._createRequestOptions(p)).then(g=>t.fromFeatureSetJSON(g.data))}queryFeatureCount(a,b){return this.layer.queryFeatureCount(a,b)}destroy(){this._decoder=v.destroyMaybe(this._decoder)}_createRequestOptions(a){return{...a,query:{...this.layer.customParameters,token:this.layer.apiKey,...a?.query}}}};c.__decorate([d.property({constructOnly:!0})],f.prototype,"layer",void 0);c.__decorate([d.property({constructOnly:!0})],f.prototype,"controller",void 0);
c.__decorate([d.property({readOnly:!0})],f.prototype,"queryFeaturesDehydrated",null);f=c.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],f);let h=class extends l{constructor(a){super(a)}queryFeaturesDehydrated(a,b){return this.layer.queryFeatures(a,b)}queryFeatureCount(a,b){return this.layer.queryFeatureCount(a,b)}};c.__decorate([d.property({constructOnly:!0})],h.prototype,"layer",void 0);c.__decorate([d.property({readOnly:!0})],h.prototype,"queryFeaturesDehydrated",
null);h=c.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],h);let n=class extends l{constructor(a){super(a)}queryFeaturesDehydrated(a,b){return this.layer.queryFeatures(a,b)}};c.__decorate([d.property({constructOnly:!0})],n.prototype,"layer",void 0);n=c.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],n);let k=class extends l{constructor(a){super(a)}queryFeaturesDehydrated(a,b){return this.source.queryFeaturesJSON(a,
b).then(t.fromFeatureSetJSON,e=>{if(e&&"query-features-json:unsupported"===e.name)return this.layer.queryFeatures(a,b);throw e;})}queryFeatureCount(a,b){return this.layer.queryFeatureCount(a,b)}};c.__decorate([d.property({constructOnly:!0})],k.prototype,"layer",void 0);c.__decorate([d.property({constructOnly:!0})],k.prototype,"source",void 0);k=c.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],k);q.createFeatureTileQuery3D=function(a,b){return"feature"===
a.type&&"feature-layer"===a.source.type?null!=a.infoFor3D?new h({layer:a}):new f({layer:a,controller:b}):"feature"===a.type&&"memory"===a.source.type||"csv"===a.type||"geojson"===a.type||"oriented-imagery"===a.type||"wfs"===a.type?new k({layer:a,source:a.source}):"ogc-feature"===a.type?new n({layer:a}):null};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});