// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./internal/MaterialUtil".split(" "),function(l,r,A,B,c,m,C,D,E,n,h,F,k,G){class t extends D.Material{constructor(a){super(a,new u);this.supportsEdges=!0;this._vertexAttributeLocations=
k.vertexAttributeLocations;this._configuration=new k.PathTechniqueConfiguration;this._vertexBufferLayout=t.getVertexBufferLayout()}getConfiguration(a,d){this._configuration.output=a;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=
this.parameters.hasOccludees;if(a===c.ShaderOutput.Color||a===c.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?m.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?m.NormalsDoubleSidedMode.WindingOrder:m.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=d.ssao;this._configuration.transparencyPassType=
d.transparencyPassType;this._configuration.multipassEnabled=d.multipassEnabled;this._configuration.cullAboveGround=d.multipassTerrain.cullAboveGround;return this._configuration}isVisibleForOutput(a){return a===c.ShaderOutput.Shadow||a===c.ShaderOutput.ShadowExcludeHighlight||a===c.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){return super.isVisible()&&0<this.parameters.opacity}intersect(a,d,p,e,g,v){if(E.isPathGeometry(a)){d=a.path;var f=[this.parameters.size[0],this.parameters.size[1]];
if(this.parameters.vvSize){const {offset:w,factor:x,minSize:y,maxSize:z}=this.parameters.vvSize;var b=d.sizeAttributeValue;f[0]*=r.clamp(w[0]+b*x[0],y[0],z[0]);f[1]*=r.clamp(w[2]+b*x[2],y[2],z[2])}b=Math.max(f[0],f[1]);a=a.boundingInfo;if(null==a)this._intersectTriangles(d,f,e,g,v);else{a=A.fromValues(a.bbMin[0]-b,a.bbMin[1]-b,a.bbMin[2]-b,a.bbMax[0]+b,a.bbMax[1]+b,a.bbMax[2]+b);b=[g[0]-e[0],g[1]-e[1],g[2]-e[2]];var q=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);G.intersectAabbInvDir(a,e,[q/b[0],q/b[1],
q/b[2]],p.tolerance)&&this._intersectTriangles(d,f,e,g,v)}}}_intersectTriangles(a,d,p,e,g){a.baked.size&&a.baked.size[0]===d[0]&&a.baked.size[1]===d[1]||a.baked.bake(d);a.baked.intersect(p,e,g)}createBufferWriter(){return new F.DefaultBufferWriter(this._vertexBufferLayout)}produces(a,d){switch(d){case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case c.ShaderOutput.Color:case c.ShaderOutput.Alpha:case c.ShaderOutput.Depth:case c.ShaderOutput.Normal:case c.ShaderOutput.Highlight:case c.ShaderOutput.ObjectAndLayerIdColor:return a===
(this.parameters.transparent?n.RenderSlot.TRANSPARENT_MATERIAL:n.RenderSlot.OPAQUE_MATERIAL)||a===n.RenderSlot.DRAPED_MATERIAL;default:return!1}}createGLMaterial(a){return new H(a)}static getVertexBufferLayout(){return B.newLayout().vec3f(h.VertexAttribute.POSITION).vec4f(h.VertexAttribute.PROFILERIGHT).vec4f(h.VertexAttribute.PROFILEUP).vec4f(h.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(h.VertexAttribute.FEATUREVALUE)}}class H extends C{_updateOccludeeState(a){a.hasOccludees!==this._material.parameters.hasOccludees&&
this._material.setParameters({hasOccludees:a.hasOccludees})}_updateShadowState(a){null!=this.technique&&a.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:a.shadowMap.enabled})}beginSlot(a){if(this._output===c.ShaderOutput.Color||this._output===c.ShaderOutput.Alpha)this._updateShadowState(a),this._updateOccludeeState(a);return this.ensureTechnique(k.PathTechnique,a)}}class u extends k.PathPassParameters{constructor(){super(...arguments);
this.doubleSided=!1;this.doubleSidedType="normal";this.receiveShadows=!1;this.castShadows=!0;this.hasOccludees=this.transparent=this.hasSlicePlane=!1}}l.PathMaterial=t;l.PathMaterialParameters=u;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});