// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),function(z,v,B,K,l,L,A,m,f,M,C,w,D){class N extends A.Material{constructor(a){super(a,new E);this._vertexAttributeLocations=
C.vertexAttributeLocations;this._configuration=new w.LineMarkerTechniqueConfiguration;this._layout=this.createLayout()}getConfiguration(a,c){this._configuration.output=a;this._configuration.space=c.slot===m.RenderSlot.DRAPED_MATERIAL?w.LineMarkerSpace.Draped:this.parameters.worldSpace?w.LineMarkerSpace.World:w.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;this._configuration.hasCap=this.parameters.cap!==D.CapType.BUTT;this._configuration.anchor=
this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.occluder=this.parameters.renderOccluded===A.RenderOccludedFlag.OccludeAndTransparentStencil;
this._configuration.transparencyPassType=c.transparencyPassType;this._configuration.multipassEnabled=c.multipassEnabled;this._configuration.cullAboveGround=c.multipassTerrain.cullAboveGround;return this._configuration}intersect(){}createLayout(){const a=K.newLayout().vec3f(f.VertexAttribute.POSITION).vec2f(f.VertexAttribute.UV0).vec3f(f.VertexAttribute.AUXPOS1);this.parameters.worldSpace&&a.vec3f(f.VertexAttribute.NORMAL);this.parameters.vvSize?a.f32(f.VertexAttribute.SIZEFEATUREATTRIBUTE):a.f32(f.VertexAttribute.SIZE);
this.parameters.vvColor?a.f32(f.VertexAttribute.COLORFEATUREATTRIBUTE):a.vec4f(f.VertexAttribute.COLOR);this.parameters.vvOpacity&&a.f32(f.VertexAttribute.OPACITYFEATUREATTRIBUTE);return a}createBufferWriter(){return new O(this._layout,this.parameters)}produces(a,c){return c===l.ShaderOutput.Color||c===l.ShaderOutput.Alpha||c===l.ShaderOutput.Highlight||c===l.ShaderOutput.Depth?a===m.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===A.RenderOccludedFlag.OccludeAndTransparentStencil?a===
m.RenderSlot.OPAQUE_MATERIAL||a===m.RenderSlot.OCCLUDER_MATERIAL||a===m.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:c===l.ShaderOutput.Color||c===l.ShaderOutput.Alpha?a===(this.parameters.writeDepth?m.RenderSlot.TRANSPARENT_MATERIAL:m.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):a===m.RenderSlot.OPAQUE_MATERIAL:!1}createGLMaterial(a){return new P(a)}}class P extends L.GLTextureMaterial{constructor(){super(...arguments);this._markerPrimitive=null}dispose(){super.dispose();this._markerTextureRepository.release(this._markerPrimitive);
this._markerPrimitive=null}_updateParameters(a){const c=this._material.parameters.markerPrimitive;c!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(c,this._markerPrimitive)}),this._markerPrimitive=c);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(C.LineMarkerTechnique,a)}_updateOccludeeState(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})}beginSlot(a){this._output!==
l.ShaderOutput.Color&&this._output!==l.ShaderOutput.Alpha||this._updateOccludeeState(a);return this._updateParameters(a)}}class E extends M.VisualVariablePassParameters{constructor(){super(...arguments);this.width=0;this.color=[1,1,1,1];this.markerPrimitive="arrow";this.placement="end";this.cap=D.CapType.BUTT;this.anchor=w.LineMarkerAnchor.Center;this.hideOnShortSegments=this.worldSpace=this.hasTip=!1;this.writeDepth=!0;this.hasOccludees=this.vvFastUpdate=this.hasSlicePlane=!1;this.markerTexture=
null}}class O{constructor(a,c){this.vertexBufferLayout=a;this._parameters=c}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(a,c,g,p,Q){const n=g.attributes.get(f.VertexAttribute.POSITION).data,F=n.length/3;let x=[1,0,0];c=g.attributes.get(f.VertexAttribute.NORMAL);this._parameters.worldSpace&&null!=c&&(x=c.data);let G=1,H=0;this._parameters.vvSize?H=g.attributes.get(f.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:g.attributes.has(f.VertexAttribute.SIZE)&&(G=g.attributes.get(f.VertexAttribute.SIZE).data[0]);
let q=[1,1,1,1],I=0;this._parameters.vvColor?I=g.attributes.get(f.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:g.attributes.has(f.VertexAttribute.COLOR)&&(q=g.attributes.get(f.VertexAttribute.COLOR).data);let J=0;this._parameters.vvOpacity&&(J=g.attributes.get(f.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const d=new Float32Array(p.buffer);let e=this.vertexBufferLayout.stride/4*Q;const t=(b,r,h,k)=>{d[e++]=b[0];d[e++]=b[1];d[e++]=b[2];d[e++]=h[0];d[e++]=h[1];d[e++]=r[0];d[e++]=r[1];d[e++]=
r[2];this._parameters.worldSpace&&(d[e++]=x[0],d[e++]=x[1],d[e++]=x[2]);this._parameters.vvSize?d[e++]=H:d[e++]=G;this._parameters.vvColor?d[e++]=I:(b=Math.min(4*k,q.length-4),d[e++]=q[b],d[e++]=q[b+1],d[e++]=q[b+2],d[e++]=q[b+3]);this._parameters.vvOpacity&&(d[e++]=J)};let y;(function(b){b[b.ASCENDING=1]="ASCENDING";b[b.DESCENDING=-1]="DESCENDING"})(y||(y={}));g=(b,r)=>{const h=v.set(R,n[3*b],n[3*b+1],n[3*b+2]),k=S;let u=b+r;do v.set(k,n[3*u],n[3*u+1],n[3*u+2]),u+=r;while(v.equals(h,k)&&0<=u&&u<
F);a&&(v.transformMat4(h,h,a),v.transformMat4(k,k,a));t(h,k,[-1,-1],b);t(h,k,[1,-1],b);t(h,k,[1,1],b);t(h,k,[-1,-1],b);t(h,k,[1,1],b);t(h,k,[-1,1],b)};p=this._parameters.placement;"begin"!==p&&"begin-end"!==p||g(0,y.ASCENDING);"end"!==p&&"begin-end"!==p||g(F-1,y.DESCENDING)}}const R=B.create(),S=B.create();z.LineMarkerMaterial=N;z.Parameters=E;Object.defineProperty(z,Symbol.toStringTag,{value:"Module"})});