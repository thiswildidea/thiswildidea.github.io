// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../../ViewingMode ../../support/orientedBoundingBox".split(" "),function(m,H,I,p,q,c,l,v,J,w){class K{constructor(){this._transform=q.create();this._transformInverse=new r({value:this._transform},p.invert,q.create);this._transformInverseTranspose=new r(this._transformInverse,p.transpose,q.create);this._transformTranspose=
new r({value:this._transform},p.transpose,q.create);this._transformInverseRotation=new r({value:this._transform},H.normalFromMat4Legacy,I.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(a){p.copy(this._transform,
a)}multiplyTransform(a){p.multiply(this._transform,this._transform,a)}set(a){p.copy(this._transform,a);this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(a,b){this.setTransformMatrix(a);this.multiplyTransform(b);this._invalidateLazyTransforms()}}class r{constructor(a,b,e){this._original=a;this._update=b;this._dirty=!0;this._transform=e()}invalidate(){this._dirty=!0}get value(){this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1);return this._transform}}class x{constructor(a=
0){this.offset=a;this.tmpVertex=l.create()}applyToVertex(a,b,e){a=c.set(t,a,b,e);b=c.add(u,a,this.localOrigin);e=this.offset/c.length(b);c.scaleAndAdd(this.tmpVertex,a,b,e);return this.tmpVertex}applyToAabb(a){var b=y;const e=z,g=A;for(var k=0;3>k;++k)b[k]=a[0+k]+this.localOrigin[k],e[k]=a[3+k]+this.localOrigin[k],g[k]=b[k];k=this.applyToVertex(b[0],b[1],b[2]);for(var d=0;3>d;++d)a[d]=k[d],a[d+3]=k[d];k=h=>{h=this.applyToVertex(h[0],h[1],h[2]);for(let n=0;3>n;++n)a[n]=Math.min(a[n],h[n]),a[n+3]=Math.max(a[n+
3],h[n])};for(d=1;8>d;++d){for(var f=0;3>f;++f)g[f]=0===(d&1<<f)?b[f]:e[f];k(g)}d=0;for(f=0;3>f;++f)0>b[f]*e[f]&&(d|=1<<f);if(0!==d&&7!==d)for(f=0;8>f;++f)if(0===(d&f)){for(let h=0;3>h;++h)g[h]=0!==(d&1<<h)?0:0!==(f&1<<h)?b[h]:e[h];k(g)}for(b=0;3>b;++b)a[b]-=this.localOrigin[b],a[b+3]-=this.localOrigin[b];return a}}class B{constructor(a=0){this.componentLocalOriginLength=0;this._tmpVertex=l.create();this._mbs=v.create();this._obb=w.create();this._offset=this._totalOffset=0;this._resetOffset(a)}_resetOffset(a){this._totalOffset=
this._offset=a}set offset(a){this._resetOffset(a)}get offset(){return this._offset}set componentOffset(a){this._totalOffset=this._offset+a}set localOrigin(a){this.componentLocalOriginLength=c.length(a)}applyToVertex(a,b,e){const g=c.set(t,a,b,e);a=c.set(u,a,b,e+this.componentLocalOriginLength);b=this._totalOffset/c.length(a);c.scaleAndAdd(this._tmpVertex,g,a,b);return this._tmpVertex}applyToAabb(a){const b=c.set(t,a[0],a[1],a[2]+this.componentLocalOriginLength),e=c.set(u,a[3],a[4],a[5]+this.componentLocalOriginLength);
var g=c.sign(y,b);const k=c.sign(z,e);var d=c.abs(A,b),f=c.abs(L,e);const h=c.min(C,d,f);h[0]=0>g[0]*k[0]?0:h[0];h[1]=0>g[1]*k[1]?0:h[1];h[2]=0>g[2]*k[2]?0:h[2];g=c.length(h);if(g<this._totalOffset)return a[0]-=0>b[0]?this._totalOffset:0,a[1]-=0>b[1]?this._totalOffset:0,a[2]-=0>b[2]?this._totalOffset:0,a[3]+=0<e[0]?this._totalOffset:0,a[4]+=0<e[1]?this._totalOffset:0,a[5]+=0<e[2]?this._totalOffset:0,a;d=c.max(C,d,f);d=c.length(d);d=this._totalOffset/d;f=this._totalOffset/g;a[0]+=b[0]*(0<b[0]?d:f);
a[1]+=b[1]*(0<b[1]?d:f);a[2]+=b[2]*(0<b[2]?d:f);a[3]+=e[0]*(0>e[0]?d:f);a[4]+=e[1]*(0>e[1]?d:f);a[5]+=e[2]*(0>e[2]?d:f);return a}applyToMbs(a){const b=c.length(a);c.scaleAndAdd(this._mbs,a,a,this._totalOffset/b);this._mbs[3]=a[3]+a[3]*this._totalOffset/b;return this._mbs}applyToObb(a){w.computeOffsetObb(a,this._totalOffset,this._totalOffset,J.ViewingMode.Global,this._obb);return this._obb}}class D{constructor(a=0){this.offset=a;this.sphere=v.create();this.tmpVertex=l.create()}applyToVertex(a,b,e){var g=
this.objectTransform.transform;a=c.set(t,a,b,e);g=c.transformMat4(a,a,g);a=this.offset/c.length(g);c.scaleAndAdd(g,g,g,a);c.transformMat4(this.tmpVertex,g,this.objectTransform.inverse);return this.tmpVertex}applyToMinMax(a,b){const e=this.offset/c.length(a);c.scaleAndAdd(a,a,a,e);a=this.offset/c.length(b);c.scaleAndAdd(b,b,b,a)}applyToAabb(a){var b=this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*b;a[1]+=a[1]*b;a[2]+=a[2]*b;b=this.offset/Math.sqrt(a[3]*a[3]+a[4]*a[4]+a[5]*a[5]);a[3]+=
a[3]*b;a[4]+=a[4]*b;a[5]+=a[5]*b;return a}applyToBoundingSphere(a){const b=c.length(a);c.scaleAndAdd(this.sphere,a,a,this.offset/b);this.sphere[3]=a[3]+a[3]*this.offset/b;return this.sphere}}const E=new D,F=new B,G=new x,t=l.create(),u=l.create(),y=l.create(),z=l.create(),A=l.create(),L=l.create(),C=l.create();m.I3SVerticalOffsetGlobalViewingMode=B;m.IntersectorTransform=K;m.Object3DVerticalOffsetGlobalViewingMode=D;m.TerrainVerticalOffsetGlobalViewingMode=x;m.getVerticalOffsetI3S=function(a){return null!=
a?(F.offset=a,F):null};m.getVerticalOffsetObject3D=function(a){return null!=a?(E.offset=a,E):null};m.getVerticalOffsetTerrain=function(a){return null!=a?(G.offset=a,G):null};m.terrainId="terrain";Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});