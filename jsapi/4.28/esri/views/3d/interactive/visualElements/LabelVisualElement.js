// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../Color ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./VisualElement ../../../interactive/support/viewUtils ../../../overlay/LineOverlayItem ../../../overlay/TextOverlayItem".split(" "),function(q,u,E,F,l,d,G,r,H,I,J,K){function v(a,e,f,g){a.eval(e,w,y);G.add(z,w,y);f.projectToRenderScreen(w,A);f.projectToRenderScreen(z,B);d.subtract(g,L,M);d.normalize(g,g)}
class N extends H.VisualElement{constructor(a){super(a);this._handles=new E;this._calloutItem=this._textItem=null;this._showText=this._showCallout=!0;this._geometry=null;this._text="-";this._fontSize=14;this._backgroundColor=new u([0,0,0,.6]);this._calloutColor=new u([0,0,0,.5]);this._textColor=new u([255,255,255]);this._distance=25;this._anchor="right";this.updatePositionOnCameraMove=!0;this.applyProperties(a)}get geometry(){return this._geometry}set geometry(a){this._geometry=a;this.updateLabelPosition()}get isDecoration(){return this._isDecoration}set isDecoration(a){this._isDecoration=
a;this._textItem&&(this._textItem.isDecoration=a);this._calloutItem&&(this._calloutItem.isDecoration=a)}get textItem(){return this._textItem}get text(){return this._text}set text(a){this._text=a;this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(a){this._fontSize=a;this.attached&&(this._textItem.fontSize=this._fontSize)}get backgroundColor(){return this._backgroundColor}set backgroundColor(a){this._backgroundColor=a;this.attached&&(this._textItem.backgroundColor=
this._backgroundColor)}get calloutColor(){return this._calloutColor}set calloutColor(a){this._calloutColor=a;this.attached&&(this._calloutItem.color=this._calloutColor.toRgba())}get textColor(){return this._textColor}set textColor(a){this._textColor=a;this.attached&&(this._textItem.textColor=this._textColor)}get distance(){return this._distance}set distance(a){this._distance!==a&&(this._distance=a,this.updateLabelPosition())}get anchor(){return this._anchor}set anchor(a){this._anchor!==a&&(this._anchor=
a,this.updateLabelPosition())}get _camera(){return this.view.state.cssCamera}overlaps(a){return this.attached?this.textItem.visible&&a.textItem.visible&&!!this.view.overlay?.overlaps(this._textItem,a.textItem):!1}updateLabelPosition(){if(this.attached){this._showCallout=this._showText=!1;var {geometry:a,view:e,visible:f}=this;if(null!=a&&e._stage)switch(a.type){case "point":if(!this._computeLabelPositionFromPoint(a.point,h))break;if(a.callout){var g=this._camera;const k=a.callout.distance;d.add(c,
c,[0,a.callout.offset]);g.renderToScreen(c,h);d.set(b,0,1);d.scale(b,b,k);d.add(b,b,c);g.renderToScreen(b,n);this._showCallout=this._updatePosition(h,n)}else this._textItem.position=[h[0],h[1]],this._textItem.anchor="center";this._showText=!0;break;case "corner":if(!this._computeLabelPositionFromCorner(a,this._distance,h,n))break;this._showCallout=this._updatePosition(h,n);this._showText=!0;break;case "segment":this._computeLabelPositionFromSegment(a,this._distance,this._anchor,h,n)&&(this._showText=
!0,g=this._updatePosition(h,n),this._showCallout=!1!==a.callout&&g,this._showCallout||(this._textItem.anchor="center"))}this.updateVisibility(f)}}_computeLabelPositionFromPoint(a,e){const f=this._camera;f.projectToRenderScreen(a,c);if(0>c[2]||1<c[2])return!1;f.renderToScreen(c,e);return!0}_computeLabelPositionFromCorner(a,e,f,g){if(!a)return!1;const k=this._camera;v(a.left,1,k,m);d.negate(m,m);v(a.right,0,k,C);d.add(b,m,C);d.negate(b,b);d.normalize(b,b);k.projectToRenderScreen(a.left.endRenderSpace,
c);if(0>c[2]||1<c[2])return!1;k.renderToScreen(c,f);d.scale(b,b,e);d.add(b,b,c);k.renderToScreen(b,g);return!0}_computeLabelPositionFromSegment(a,e,f,g,k){if(!a)return!1;const x=a.segment,t=this._camera;I.renderScreenSpaceTangent(x.startRenderSpace,x.endRenderSpace,t,m);d.set(b,-m[1],m[0]);let p=!1;switch(f){case "top":p=0>b[1];break;case "bottom":p=0<b[1];break;case "left":p=0<b[0];break;case "right":p=0>b[0]}p&&d.negate(b,b);if(0===d.length(b))switch(f){case "top":b[1]=1;break;case "bottom":b[1]=
-1;break;case "left":b[0]=-1;break;case "right":b[0]=1}x.eval(O[a.sampleLocation],D);t.projectToRenderScreen(D,c);if(0>c[2]||1<c[2])return!1;t.renderToScreen(c,g);d.scale(b,b,e);d.add(b,b,c);t.renderToScreen(b,k);return!0}_updatePosition(a,e){if(e){const f=e[0]-a[0],g=e[1]-a[1];this._textItem.position=[e[0],e[1]];this._textItem.anchor=Math.abs(f)>Math.abs(g)?0<f?"left":"right":0<g?"top":"bottom";this._calloutItem.startPosition=[a[0],a[1]];this._calloutItem.endPosition=[e[0],e[1]];return!0}this._textItem.position=
[a[0],a[1]];this._textItem.anchor="center";return!1}createResources(){this._textItem=new K({visible:!0,text:this._text,fontSize:this._fontSize,backgroundColor:this._backgroundColor,textColor:this._textColor,isDecoration:this._isDecoration});this._calloutItem=new J({color:this._calloutColor.toRgba(),visible:!0,width:2,isDecoration:this._isDecoration});this.updateLabelPosition();this.view.overlay?.items.addMany([this._textItem,this._calloutItem]);this.updatePositionOnCameraMove&&this._handles.add(F.watch(()=>
this.view.state.camera,()=>this.updateLabelPosition()))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]);this._handles.removeAll()}updateVisibility(a){this._textItem.visible=this._showText&&a;this._calloutItem.visible=this._showCallout&&a}}const w=r.create(),z=r.create(),y=r.create(),m=l.createRenderScreenPointArray(),C=l.createRenderScreenPointArray(),b=l.createRenderScreenPointArray(),D=r.create(),c=l.createRenderScreenPointArray3(),
h=l.createScreenPointArray(),n=l.createScreenPointArray(),A=l.createRenderScreenPointArray3(),M=A,B=l.createRenderScreenPointArray3(),L=B,O={start:0,center:.5,end:1};q.LabelVisualElement=N;q.mirrorPosition=function(a){switch(a){case "top":return"bottom";case "right":return"left";case "bottom":return"top";case "left":return"right"}};q.screenSpaceTangent=v;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});