// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/mathUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../geometry/support/axisAngleDegrees ../../../../../geometry/support/MeshTransform ../../../../ViewingMode ./undoRecords".split(" "),
function(e,b,n,p,l,d,x,y,z,q,u,h,r,t,v){e.ScaleRotateMeshAdapter=class extends n{constructor(a){super(a);this._interactionState=null}initialize(){this.addHandles([l.when(()=>{const a=this._interactionState;return a&&a.angle!==a.previousAngle?{interactionState:a,angle:a.state.angle}:null},({interactionState:a})=>{this._updateMeshRotation(a)},l.sync),l.when(()=>{const a=this._interactionState;return a&&a.scale!==a.previousScale?{interactionState:a,scale:a.state.scale}:null},({interactionState:a})=>
{this._updateMeshSize(a)},l.sync)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const a=this.geometry.transform;if(null==a)return this._interactionState?.angle??0;const f=h.axis(a.rotation)[2];return.999999<Math.abs(f)?p.deg2rad(h.angle(a.rotation))*Math.sign(f):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const a=
new g({angle:this.angle});this._interactionState=a;const f=()=>{this._interactionState=null};return{state:a,done:f,cancel:()=>{a.cancel();f()}}}createUndoRecord(){return v.createGraphicGeometryUndoRecord(this.graphic)}_updateMeshRotation(a){const {angle:f,previousAngle:m}=a;a.previousAngle=f;var {geometry:c}=this;const {vertexSpace:k}=c;a=p.rad2deg(f-m);k.isGeoreferenced?(this.geometry.rotate(0,0,a,{origin:this.geometry.anchor,geographic:!k.isRelative&&this.viewingMode===t.ViewingMode.Global}),this.graphic.notifyGeometryChanged()):
(c.transform??(c.transform=new r),{transform:c}=c,a=h.composeAxes(0,0,a,w),c.rotation=h.compose(c.rotation,a,c.rotation),this.graphic.notifyMeshTransformChanged())}_updateMeshSize(a){const {scale:f,previousScale:m}=a;a.previousScale=f;var {geometry:c}=this;const {vertexSpace:k}=c;a=f/m;k.isGeoreferenced?(this.geometry.scale(a,{origin:this.geometry.anchor,geographic:!k.isRelative&&this.viewingMode===t.ViewingMode.Global}),this.graphic.notifyGeometryChanged()):(c.transform??(c.transform=new r),{transform:c}=
c,c.scale=u.scale(c.scale,c.scale,a),this.graphic.notifyMeshTransformChanged())}};b.__decorate([d.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"graphic",void 0);b.__decorate([d.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"geometry",void 0);b.__decorate([d.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"viewingMode",void 0);b.__decorate([d.property()],e.ScaleRotateMeshAdapter.prototype,"initialAngle",null);b.__decorate([d.property()],e.ScaleRotateMeshAdapter.prototype,
"angle",null);b.__decorate([d.property()],e.ScaleRotateMeshAdapter.prototype,"angleClockwise",null);b.__decorate([d.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngle",null);b.__decorate([d.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngleClockwise",null);b.__decorate([d.property()],e.ScaleRotateMeshAdapter.prototype,"scale",null);b.__decorate([d.property()],e.ScaleRotateMeshAdapter.prototype,"_interactionState",void 0);e.ScaleRotateMeshAdapter=b.__decorate([q.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],
e.ScaleRotateMeshAdapter);let g=class extends n{get state(){const {angle:a,scale:f}=this;return{angle:a,scale:f}}constructor(a){super(a);this.previousAngle=this.initialAngle=this.angle=0;this.scale=this.previousScale=1;this.previousAngle=this.initialAngle=a.angle}cancel(){this.angle=this.initialAngle;this.scale=1}};b.__decorate([d.property()],g.prototype,"angle",void 0);b.__decorate([d.property()],g.prototype,"initialAngle",void 0);b.__decorate([d.property()],g.prototype,"previousAngle",void 0);b.__decorate([d.property()],
g.prototype,"previousScale",void 0);b.__decorate([d.property()],g.prototype,"scale",void 0);b.__decorate([d.property()],g.prototype,"state",null);g=b.__decorate([q.subclass("InteractionState")],g);const w=h.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});