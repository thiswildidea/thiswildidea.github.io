// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/quantityUtils ../../../../../core/unitUtils ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/boundedPlane ../../../../../geometry/support/vectorStacks ../../../../../support/elevationInfoUtils ../geometryUtils ../../../layers/graphics/elevationAlignmentUtils ../../../layers/graphics/ElevationContext ../../../../interactive/editGeometry/support/editPlaneUtils ../../../../support/automaticLengthMeasurementUtils".split(" "),function(q,r,
t,u,c,m,h,v,w,x,y,z,p){function A(a,d,e,l=0,b){b||(b=m.create());d.toRenderCoords(a.origin,e,b.origin);var g=h.sv3d.get();c.add(g,a.origin,a.basis1);c.add(g,g,a.basis2);d.toRenderCoords(g,e,g);var f=h.sv3d.get();c.add(f,a.origin,a.basis1);c.subtract(f,f,a.basis2);d.toRenderCoords(f,e,f);const k=h.sv3d.get();c.subtract(k,a.origin,a.basis1);c.subtract(k,k,a.basis2);d.toRenderCoords(k,e,k);const n=h.sv3d.get();c.subtract(n,a.origin,a.basis1);c.add(n,n,a.basis2);d.toRenderCoords(n,e,n);a=c.lerp(h.sv3d.get(),
g,f,.5);c.subtract(a,a,b.origin);d=c.lerp(h.sv3d.get(),k,n,.5);c.subtract(d,b.origin,d);c.lerp(b.basis1,a,d,.5);g=c.lerp(h.sv3d.get(),n,g,.5);c.subtract(g,g,b.origin);f=c.lerp(h.sv3d.get(),f,k,.5);c.subtract(f,b.origin,f);c.lerp(b.basis2,g,f,.5);f=c.cross(h.sv3d.get(),b.basis1,b.basis2);f=c.cross(f,f,b.basis1);c.normalize(f,f);c.scale(b.basis2,f,c.dot(b.basis2,f));c.scale(b.basis1,b.basis1,1+l/c.length(b.basis1));c.scale(b.basis2,b.basis2,1+l/c.length(b.basis2));m.updateUnboundedPlane(b);return b}
class B{constructor(a,d,e){this._tool=a;this._onDisplayBoundsChanged=d;this.mapBounds=m.create();this.mapBoundsStart=m.create();this.displayBounds=m.create();this._calculateMapBounds(e)}get displayBoundsMargin(){const {view:a,graphic:d}=this._tool,e=a.pointsOfInterest?.centerOnSurfaceFrequent.location??d.geometry?.extent?.center;return e?10*a.pixelSizeAt(e):0}backupMapBounds(){m.copy(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds();this._onDisplayBoundsChanged()}_calculateMapBounds(a){const {view:d,
attachmentOrigin:e}=this._tool;var l=a.geometry;const b=w.mainAxis(l);u.scale(b,b,-1);var g=d.spatialReference;l=l.spatialReference;g=e?d.pixelSizeAt(e)*t.getMetersPerCartesianUnitForSR(g)/t.getMetersPerUnitForSR(l):0;z.calculateOrientedBounds(b,a,80*g,this.mapBounds)}_calculateDisplayBounds(){const {view:a,attachmentOrigin:d,graphic:e}=this._tool;if(e.geometry){var l=d?.z??x.evaluateElevationAlignmentAtPoint(this.mapBounds.origin,a.elevationProvider,y.ElevationContext.fromElevationInfo(v.getGraphicEffectiveElevationInfo(e)),
a.renderCoordsHelper),b=m.copy(this.mapBounds);b.origin[2]=l??0;A(b,a.renderCoordsHelper,e.geometry.spatialReference,this.displayBoundsMargin,this.displayBounds)}}}q.TransformBounds=B;q.mapPlaneAutoHorizontalSizeByElevationMode=function(a,d,e,l){const b=h.sv3d.get();c.subtract(b,c.subtract(b,a.origin,a.basis1),a.basis2);const g=h.sv3d.get();c.scaleAndAdd(g,b,a.basis1,2);const f=h.sv3d.get();c.scaleAndAdd(f,g,a.basis2,2);const k=h.sv3d.get();c.scaleAndAdd(k,b,a.basis2,2);b[2]=g[2]=f[2]=k[2]=d;d=l?
"on-the-ground":"absolute-height";a=r.max(p.autoHorizontalDistanceByElevationMode(b,g,e,d),p.autoHorizontalDistanceByElevationMode(k,f,e,d));e=r.max(p.autoHorizontalDistanceByElevationMode(g,f,e,d),p.autoHorizontalDistanceByElevationMode(b,k,e,d));return null==e||null==a?null:[a,e]};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});