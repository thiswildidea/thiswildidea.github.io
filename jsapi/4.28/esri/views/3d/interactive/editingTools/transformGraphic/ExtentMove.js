// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/quantityUtils ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/vectorStacks ../../../analysis/Slice/ShiftManipulator ../../../analysis/Slice/sliceToolUtils ../dragEventPipeline3D ../ManipulatorType ../manipulations/MoveManipulation ../manipulations/MoveXYGraphicManipulation ../../../../interactive/dragEventPipeline ../../../../interactive/editGeometry/interfaces ../../../../interactive/editGeometry/support/editPlaneUtils ../../../../interactive/tooltip/TranslateTooltipInfos ../../../../support/automaticLengthMeasurementUtils ../../../../support/euclideanLengthMeasurementUtils".split(" "),
function(k,r,t,u,v,l,m,w,x,y,f,z,g,n,A,p,B,C){class D{constructor(a,b,c,e){this._tool=a;this._graphicState=b;this._editGeometryOperations=c;this._bounds=e;this._moveZTooltipInfo=this._moveXYTooltipInfo=null;a=this._tool;b=a.view;this.moveXYGraphicManipulation=new z.MoveXYGraphicManipulation({view:b,tool:a,graphicState:this._graphicState});a.addHandles(this._createMoveXYGraphicDragPipeline());this.moveZManipulator=new m.ShiftManipulator(b,m.OffsetMode.CENTER_ON_CALLOUT);this.moveZManipulator.state|=
w.IsShiftEdgeOnScreenFlag;a.manipulators.add(this.moveZManipulator);a.addHandles([this._createMoveZDragPipeline()]);a.addHandles([a.on("graphic-translate-stop",()=>{this._moveZTooltipInfo=this._moveXYTooltipInfo=null})])}destroy(){this.moveXYGraphicManipulation.destroy();this._tool.manipulators.remove(this.moveZManipulator);this.moveZManipulator.destroy()}forEachManipulator(a){this.moveXYGraphicManipulation.forEachManipulator(a);a(this.moveZManipulator,y.ManipulatorType.TRANSLATE_Z)}updateManipulators(a,
b){const c=this.moveZManipulator;a=t.rotateZ(l.sm4d.get(),a,Math.PI);a[12]=0;a[13]=0;a[14]=0;c.modelTransform=a;c.renderLocation=u.subtract(l.sv3d.get(),b.origin,b.basis1)}getUpdatedTooltipInfo(){return this.moveXYGraphicManipulation.grabbing||this.moveXYGraphicManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const a=this._tool.tooltipOptions;return this._moveXYTooltipInfo??(this._moveXYTooltipInfo=
new p.TranslateGraphicTooltipInfo({tooltipOptions:a}))}_computeMoveZTooltipInfo(){var a=this._tool,b=a.tooltipOptions;b=this._moveZTooltipInfo??(this._moveZTooltipInfo=new p.TranslateGraphicZTooltipInfo({tooltipOptions:b}));if(this.moveZManipulator.dragging){a=this._bounds;a=C.verticalSignedDistance(a.mapBoundsStart.origin,a.mapBounds.origin,this._tool.view.spatialReference);if(null==a)return null;b.distance=a}else b.distance=r.createLength(0,a.moveUnit);return b}_updateMoveTooltip(a,b){if(b===f.ManipulationType.XY||
b===f.ManipulationType.XY_AXIS)b=B.autoHorizontalDistanceByElevationModeBetweenPoints(a.mapStart,a.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height"),null!=b&&null!=this._moveXYTooltipInfo&&(this._moveXYTooltipInfo.distance=b);return a}_createMoveXYGraphicDragPipeline(){return this.moveXYGraphicManipulation.createDragPipeline((a,b,c)=>this._applyGraphicMoveSteps(b,c,f.ManipulationType.XY))}_createMoveZDragPipeline(){const a=this._editGeometryOperations.data.spatialReference;return g.createManipulatorDragEventPipeline(this.moveZManipulator,
(b,c,e)=>{b=v.clone(b.renderLocation);c=c.next(x.screenToZConstrained(this._tool.view,b,a)).next(g.addScreenDelta());this._applyGraphicMoveSteps(c,e,f.ManipulationType.Z)})}_applyGraphicMoveSteps(a,b,c){const e=this._tool,h=e.graphic;a=a.next(d=>{"start"===d.action&&(e.inputState={type:"move"},this._bounds.backupMapBounds(),e.emit("graphic-translate-start",{graphic:h,dxScreen:d.screenDeltaX,dyScreen:d.screenDeltaY}));return d}).next(g.addMapDelta()).next(this._moveDragUpdateGeometry()).next(d=>{const q=
{graphic:h,dxScreen:d.screenDeltaX,dyScreen:d.screenDeltaY};switch(d.action){case "start":case "update":(d.mapEnd.x-d.mapStart.x||d.mapEnd.y-d.mapStart.y||(d.mapEnd.z??0)-(d.mapStart.z??0))&&e.emit("graphic-translate",q);break;case "end":e.inputState=null,e.emit("graphic-translate-stop",q)}return d}).next(d=>this._updateMoveTooltip(d,c));b.next(()=>{null!=e.inputState&&e.emit("graphic-translate-stop",{graphic:h,dxScreen:0,dyScreen:0});e.cancel()});return a}_moveDragUpdateGeometry(){const a=this._tool;
return b=>{if(null==a.inputState||"move"!==a.inputState.type)return b;var c=[];for(const e of this._editGeometryOperations.data.components)c.push(...e.vertices);c=this._editGeometryOperations.moveVertices(c,b.mapDeltaX,b.mapDeltaY,b.mapDeltaZ,"start"===b.action?n.AccumulationBehaviour.NEW_STEP:n.AccumulationBehaviour.ACCUMULATE_STEPS);A.apply(c,this._bounds.mapBounds);a.graphic.geometry=this._editGeometryOperations.data.geometry;return b}}}k.ExtentMove=D;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})});