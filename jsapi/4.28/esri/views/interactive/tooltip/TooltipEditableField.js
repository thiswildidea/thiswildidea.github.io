// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../keybindings ./css ../../../widgets/Widget ../../../widgets/support/componentsUtils ../../../widgets/support/widgetUtils ../../../widgets/support/jsxFactory".split(" "),function(m,d,f,k,F,G,H,p,l,q,r,t,I,g){const e=`${q.base}-editable-field`;var u=`${e}--input`,v=`${e}--locked`,
w=`${e}__title`,x=`${e}__title__content`,y=`${e}__value`,z=`${e}__value__content`,A=`${e}__input`,B=`${e}__input--disabled`,C=`${e}__input--read-only`,D=`${e}__input-suffix`,E=`${e}__button`;d.TooltipEditableField=class extends r{constructor(){super(...arguments);this._input=null;this._afterInputCreate=a=>{this._input=a};this._selectText=()=>{requestAnimationFrame(()=>{this._input?.select()})};this._onKeyDown=a=>{a.key===l.tooltipKeys.discard&&this._discard()};this._onInputKeyDown=a=>{switch(a.key){case l.tooltipKeys.commit:return this._commit({type:"commit-and-exit",
allowLockingCurrentValue:!0});case l.tooltipKeys.next:return a.stopPropagation(),this._commit({type:a.shiftKey?"commit-and-previous":"commit-and-next",allowLockingCurrentValue:!1})}};this._onInput=a=>{this.field.inputValue=a.target.value};this._onLockClick=()=>{const {field:a}=this;a.locked?a.unlock():this._lock()}}loadDependencies(){return t.loadCalciteComponents({button:()=>new Promise((a,b)=>m(["../../../chunks/calcite-button"],a,b)),icon:()=>new Promise((a,b)=>m(["../../../chunks/calcite-icon"],
a,b))})}render(){const {mode:a,field:b}=this,c="input"===a,{locked:h}=b;return g.tsx("div",{class:this.classes({[e]:!0,[u]:"input"===a,[v]:h})},g.tsx("div",{class:w,key:"title"},g.tsx("div",{class:x,key:"title-content"},this._title,h&&!c?g.tsx("calcite-icon",{icon:"lock",key:"icon",scale:"s"}):null)),g.tsx("div",{class:y,key:"value"},c?this._renderInput():g.tsx("span",{key:"formatted-value"},this._feedbackValue)))}get _initialValue(){const {field:a}=this;return null!=a.actual?a.toInputUnits(a.actual,
this.context).value:null}get _feedbackValue(){const {context:a,field:b}=this,{actual:c,committed:h,format:n}=b;return null!=h?n(h,a):null!=c?n(c,a):""}get _displayValue(){const {field:a}=this,{inputValue:b,committed:c}=a;return null!=b?b:null!=c?this._toString(a.toInputUnits(c,this.context).value):this._toString(this._initialValue)}get _suffix(){const {suffix:a}=this.field;return"string"===typeof a?a:a(this.context)}get _title(){const {title:a}=this.field;return"string"===typeof a?a:a(this.context)}_renderInput(){const {disabled:a,
locked:b,readOnly:c}=this.field;return g.tsx("div",{class:z,key:"input-container",onkeydown:this._onKeyDown},g.tsx("input",{afterCreate:this._afterInputCreate,class:this.classes({[A]:!0,[B]:a,[C]:c}),disabled:a||c,onfocus:this._selectText,oninput:this._onInput,onkeydown:this._onInputKeyDown,readOnly:c,type:"text",value:this._displayValue}),g.tsx("div",{class:D,key:"suffix"},this._suffix),c?void 0:g.tsx("calcite-button",{appearance:"transparent",class:E,disabled:a,iconStart:b?"lock":"unlock",kind:"neutral",
onclick:this._onLockClick,scale:"s",tabIndex:-1}))}_commit({type:a,allowLockingCurrentValue:b}){const {_input:c,field:h}=this;c&&(h.locked&&""===h.inputValue?h.unlock():(b||null!=h.inputValue)&&this._lock(),this.context.onCommit(c,a))}_discard(){this._input&&(this.field.inputValue=null,this.context.onDiscard(this._input))}_lock(){const {field:a}=this;var b=this._parseNumber(a.inputValue);b=null!=b?a.createQuantity(b,this.context):null;a.lock(b)}_parseNumber(a){if(null==a)return null;a=parseFloat(a);
return isNaN(a)||!isFinite(a)?null:a}_toString(a){return null!=a?a.toFixed(3):"0"}};f.__decorate([k.property()],d.TooltipEditableField.prototype,"field",void 0);f.__decorate([k.property()],d.TooltipEditableField.prototype,"context",void 0);f.__decorate([k.property()],d.TooltipEditableField.prototype,"mode",void 0);f.__decorate([k.property()],d.TooltipEditableField.prototype,"_initialValue",null);f.__decorate([k.property()],d.TooltipEditableField.prototype,"_feedbackValue",null);f.__decorate([k.property()],
d.TooltipEditableField.prototype,"_input",void 0);f.__decorate([k.property()],d.TooltipEditableField.prototype,"_displayValue",null);f.__decorate([k.property()],d.TooltipEditableField.prototype,"_suffix",null);f.__decorate([k.property()],d.TooltipEditableField.prototype,"_title",null);d.TooltipEditableField=f.__decorate([p.subclass("esri.views.interactive.tooltip.TooltipEditableField")],d.TooltipEditableField);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});