// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../geometry ../../core/arrayUtils ../../core/has ../../core/lang ../../core/mathUtils ../../core/screenUtils ../../chunks/vec3f64 ../../geometry/projection ../../layers/graphics/hydratedFeatures ../../layers/graphics/sources/interfaces ../../support/elevationInfoUtils ../ViewingMode ../draw/support/drawUtils ../../geometry/Point".split(" "),function(k,Q,E,R,F,t,G,H,n,u,I,r,J,v,K){function w(b,d){let c=null,a=null;return f=>{if("cancel"===f.action)null!=a&&(a.execute({action:"cancel"}),
a=c=null);else{var e={action:f.action,screenStart:f.start,screenEnd:f.screenPoint};"start"===f.action&&null==c&&(c=new p,a=new p,d(b,c,a,f.pointerType,e));null!=c&&c.execute(e);"end"===f.action&&null!=c&&(a=c=null)}}}function x(b,d){let c=null;return a=>{"start"===a.action&&(c=L(b,a.mapStart.spatialReference,d));if(null==c)return null;const f=a.mapEnd.x-a.mapStart.x,e=a.mapEnd.y-a.mapStart.y,g=a.mapEnd.z-a.mapStart.z;c.move(f,e,g,a.action);return{...a,translationX:f,translationY:e,translationZ:g}}}
function y(b,d){return null==b?null:b.spatialReference.equals(d)?b.clone():n.project(b,d)}function L(b,d,c){const a=b.geometry;d=u.hydratedSpatialReference(d);if(null==a)return null;if("mesh"===a.type)return M(b,a,d,c);const f=y(a,d),e=a.spatialReference;return null==f?null:{move:(g,h,l)=>{g=v.move(f.clone(),g,h,l);g.spatialReference.equals(e)?b.geometry=g:b.geometry=n.project(g,e)}}}function M(b,d,c,a){if(d.vertexSpace.isRelative)return N(b,d,d.vertexSpace,c);if(!d.spatialReference.equals(c))return null;
let f=0,e=0,g=0;return{move:(h,l,q)=>{var m=h-f;const z=l-e,A=q-g;if(m||z||A)m=new K(d.origin.x+m,d.origin.y+z,(d.origin.z??0)+A,d.origin.spatialReference),d.centerAt(m,{geographic:d.vertexSpace.isRelative?void 0:a===J.ViewingMode.Global}),b.notifyGeometryChanged(),f=h,e=l,g=q}}}function N(b,d,c,a){const f=c.getOriginPoint(d.spatialReference),e=y(f,a),g=d.spatialReference;return null==e?null:{move:(h,l,q,m)=>{h=v.move(e.clone(),h,l,q);h.spatialReference.equals(g)?c.setOriginFromPoint(h):(h=n.project(h,
g),null!=h&&c.setOriginFromPoint(h));c.isGeoreferenced?b.notifyGeometryChanged():b.notifyMeshTransformChanged("end"===m?{action:I.MeshTransformUpdateAction.UpdateFastLocalOrigin}:{})}}}function B(b,d){const c=new Map;for(const a of d)c.set(a,F.clone(b[a]));return a=>{c.forEach((f,e)=>{b[e]=f});return a}}function C(b){return null!=b.geometry&&"mesh"===b.geometry.type?O(b,b.geometry):B(b,["geometry"])}function O(b,d){const {vertexSpace:c}=d;if(c.isGeoreferenced){const e=d.vertexAttributes.clonePositional();
return g=>{d.vertexAttributes=e;b.notifyGeometryChanged();return g}}const a=H.clone(c.origin),f=d.transform?.clone();return e=>{d.transform=f;d.vertexSpace.origin=a;b.notifyMeshTransformChanged();return e}}function D(b,d,c){const a=d.elevationProvider.getElevation(b.x,b.y,b.z??0,b.spatialReference,"scene")??0;b=u.clonePoint(b);b.z=a;b.hasZ=!0;b.z=r.getZForElevationMode(b,d,c);return b}const P=()=>{};class p{constructor(){this.execute=P}next(b,d=new p){null!=b&&(this.execute=c=>{c=b(c);null!=c&&d.execute(c)});
return d}}k.EventPipeline=p;k.addMapDelta=function(){let b=0,d=0,c=0;return a=>{"start"===a.action&&(b=a.mapStart.x,d=a.mapStart.y,c=a.mapStart.z);const f=a.mapEnd.x-b,e=a.mapEnd.y-d,g=a.mapEnd.z-c;b=a.mapEnd.x;d=a.mapEnd.y;c=a.mapEnd.z;return{...a,mapDeltaX:f,mapDeltaY:e,mapDeltaZ:g,mapDeltaSpatialReference:a.mapStart.spatialReference}}};k.addScreenDelta=function(){let b=0,d=0;return c=>{"start"===c.action&&(b=c.screenStart.x,d=c.screenStart.y);const a=c.screenEnd.x-b,f=c.screenEnd.y-d;b=c.screenEnd.x;
d=c.screenEnd.y;return{...c,screenDeltaX:a,screenDeltaY:f}}};k.constrainToMapAxis=function(b,d){const c=[b.x,b.y,b.z??0],a=[Math.cos(d),Math.sin(d)];b=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===b)return null;a[0]/=b;a[1]/=b;const f=e=>{const g=(e.x-c[0])*a[0]+(e.y-c[1])*a[1];e.x=c[0]+g*a[0];e.y=c[1]+g*a[1]};return e=>{f(e.mapStart);f(e.mapEnd);return{...e,axis:a}}};k.createDragEventPipelineCallback=w;k.createManipulatorDragEventPipeline=function(b,d){return b.events.on("drag",w(b,d))};k.dragAtLocation=
function(b,d){let c=null,a=0,f=0;return e=>{"start"===e.action&&(c=b.toScreen?.(d),null!=c&&(0>c.x||c.x>b.width||0>c.y||c.y>b.height?c=null:(a=e.screenStart.x-c.x,f=e.screenStart.y-c.y)));if(null==c)return null;var g=t.clamp(e.screenEnd.x-a,0,b.width);const h=t.clamp(e.screenEnd.y-f,0,b.height);g=G.createScreenPoint(g,h);e.screenStart=c;e.screenEnd=g;return e}};k.dragGraphic=x;k.dragGraphicMany=function(b,d){const c=b.map(a=>x(a,d)).filter(E.isSome);return a=>{const f=a.mapEnd.x-a.mapStart.x,e=a.mapEnd.y-
a.mapStart.y,g=a.mapEnd.z-a.mapStart.z;c.forEach(h=>h(a));return{...a,translationX:f,translationY:e,translationZ:g}}};k.resetGraphic=C;k.resetGraphicMany=function(b){const d=b.map(c=>C(c)).filter(c=>null!=c);return c=>{d.forEach(a=>a(c));return c}};k.resetProperties=B;k.sceneSnappingAtLocation=function(b,d,c=[]){if("2d"===b.type)return f=>f;let a=null;return f=>{"start"===f.action&&(a=b.toMap(f.screenStart,{exclude:c}),null!=a&&(a.z=r.getZForElevationMode(a,b,d)));const e=b.toMap(f.screenEnd,{exclude:c});
null!=e&&(e.z=r.getZForElevationMode(e,b,d));return{...f,scenePoints:null!=a&&null!=e?{sceneStart:a,sceneEnd:e}:null}}};k.sceneSnappingAtProjectedLocation=function(b,d){if("2d"===b.type)return a=>a;let c=null;return a=>{"start"===a.action&&(c=D(a.mapStart,b,d));const f=D(a.mapEnd,b,d);return{...a,scenePoints:null!=c&&null!=f?{sceneStart:c,sceneEnd:f}:null}}};k.screenToMap=function(b,d=null,c){let a=null;const f=null==d||b.spatialReference?.equals(d)?g=>g:g=>null!=g?n.project(g,d):g,e={exclude:[],
...c};return g=>{"start"===g.action&&(a=f(b.toMap(g.screenStart,e)));if(null==a)return null;const h=f(b.toMap(g.screenEnd,e));return null!=h?{...g,mapStart:a,mapEnd:h}:null}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});