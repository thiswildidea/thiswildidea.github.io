// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),function(f,u,q,g,A,B,C,v,w,m,x){return a=>{a=class extends a{constructor(){super(...arguments);this._rasterFieldPrefix="Raster.";this.tileInfo=
this.view=this.layer=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return m.projectDatasetExtent(this.layer.rasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return m.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(b){return!!m.projectDatasetExtent(this.layer.rasterInfo,
b)}async fetchPopupFeatures(b,c){const {layer:e}=this;if(!b)throw new q("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});var {popupEnabled:h}=e;c=x.getFetchPopupTemplate(e,c);if(!h||null==c)throw new q("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:h,popupTemplate:c});h=[];const {value:k,magdirValue:r,processedValue:y}=await e.identify(b,{timeExtent:this.timeExtent});let l="";if(k&&k.length){l="imagery-tile"===
e.type&&e.hasStandardTime()&&null!=k[0]?k.map(n=>e.getStandardTimeValue(n)).join(", "):k.join(", ");b={ObjectId:0};b["Raster.ServicePixelValue"]=y?.join(", ")??l;b["Raster.ServicePixelValue.Raw"]=l;c=e.rasterInfo.attributeTable;if(null!=c){const {fields:n,features:z}=c,t=n.find(({name:p})=>"value"===p.toLowerCase());if(c=t?z.find(p=>String(p.attributes[t.name])===l):null)for(var d in c.attributes)c.attributes.hasOwnProperty(d)&&(b[this._rasterFieldPrefix+d]=c.attributes[d])}d=e.rasterInfo.dataType;
if("vector-magdir"===d||"vector-uv"===d)b["Raster.Magnitude"]=r?.[0],b["Raster.Direction"]=r?.[1];d=new u(this.fullExtent.clone(),null,b);d.layer=e;d.sourceLayer=d.layer;h.push(d)}return h}};f.__decorate([g.property()],a.prototype,"layer",void 0);f.__decorate([g.property(w.combinedViewLayerTimeExtentProperty)],a.prototype,"timeExtent",void 0);f.__decorate([g.property()],a.prototype,"view",void 0);f.__decorate([g.property()],a.prototype,"fullExtent",null);f.__decorate([g.property()],a.prototype,"tileInfo",
void 0);f.__decorate([g.property({readOnly:!0})],a.prototype,"hasTilingEffects",null);f.__decorate([g.property()],a.prototype,"datumTransformation",null);return a=f.__decorate([v.subclass("esri.views.layers.ImageryTileLayerView")],a)}});