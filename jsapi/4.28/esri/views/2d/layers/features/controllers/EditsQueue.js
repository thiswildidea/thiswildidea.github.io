// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass".split(" "),function(d,k,r,m,n,x,y,z,t){d.EditsQueue=class extends r{constructor(b){super(b);this._queue=[];this._onGoingRequest=null;this._abortController=new AbortController}destroy(){this.clear()}get updating(){return!this.destroyed&&
(0<this._queue.length||null!=this._onGoingRequest)}clear(){if(this.destroyed)throw Error("instance is already destroyed");let b=this._queue.pop();for(;b;)b.resolver.reject(m.createAbortError()),b=this._queue.pop();this._queue.length=0;this._abortController.abort();this._abortController=new AbortController}async push(b){if(this.destroyed)throw Error("instance is already destroyed");const e=m.createResolver();this._queue.push({event:b,resolver:e});this.notifyChange("updating");Promise.resolve().then(()=>
{this._processNext()});return e.promise}async _processNext(){if(!this._onGoingRequest){for(var b=[],e=new Set,f=new Set,g=new Set,l=this._queue.shift();l;){const {event:{addedFeatures:c,deletedFeatures:u,updatedFeatures:v},resolver:w}=l;b.push(w);for(const {objectId:a,error:h}of c)h||null==a||(e.add(a),f.add(a),g.delete(a));for(const {objectId:a,error:h}of v)h||null==a||(f.add(a),g.delete(a));for(const {objectId:a,error:h}of u)h||null==a||(e.has(a)?e.delete(a):g.add(a),f.delete(a));l=this._queue.shift()}if(f.size||
g.size){var p=[],q=[];f.size&&f.forEach(c=>{p.push(c)});g.size&&g.forEach(c=>{q.push(c)});this._onGoingRequest=Promise.resolve().then(()=>this.processEdits(p,q,{signal:this._abortController.signal})).catch(()=>{});this.notifyChange("updating");await this._onGoingRequest;this._onGoingRequest=null;this.notifyChange("updating");b.forEach(c=>c());0<this._queue.length&&this._processNext()}else this.notifyChange("updating"),b.forEach(c=>c())}}};k.__decorate([n.property({constructOnly:!0})],d.EditsQueue.prototype,
"processEdits",void 0);k.__decorate([n.property({readOnly:!0})],d.EditsQueue.prototype,"updating",null);d.EditsQueue=k.__decorate([t.subclass("esri.views.2d.layers.features.controllers.EditsQueue")],d.EditsQueue);Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});