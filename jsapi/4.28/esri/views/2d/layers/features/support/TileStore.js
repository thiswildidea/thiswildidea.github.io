// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../../../../core/Evented ../../../../../core/has ../../../../../chunks/rbush ./Tile ../../../tiling/TileCoverage ../../../tiling/TileKey".split(" "),function(m,n,p,l,q,r){const f={added:[],removed:[]},k=new Set,t=new r(0,0,0,0);class u extends m{constructor(a){super();this._tiles=new Map;this._index=p.rbush(9,n("esri-csp-restrictions")?b=>({minX:b.bounds[0],minY:b.bounds[1],maxX:b.bounds[2],maxY:b.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);this.tiles=[];this.tileScheme=
a}destroy(){this.clear()}clear(){this.tiles.length=0;this._tiles.clear();this._index.clear()}has(a){return this._tiles.has(a)}get(a){return this._tiles.get(a)}boundsIntersections(a){return this._index.search({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]})}updateTiles(a){const b={added:[],removed:[]};for(const c of a.added)if(!this.has(c)){const d=new l.Tile(this.tileScheme,c);this._tiles.set(c,d);this._index.insert(d);b.added.push(d)}for(const c of a.removed)this.has(c)&&(a=this.get(c),this._tiles.delete(c),
this._index.remove(a),b.removed.push(a));this.tiles.length=0;this._tiles.forEach(c=>this.tiles.push(c));(b.added.length||b.removed.length)&&this.emit("update",b)}setViewState(a){if(a=this.tileScheme.getTileCoverage(a,0)){var {spans:b,lodInfo:c}=a,{level:d}=c;if(0<b.length)for(const {row:v,colFrom:w,colTo:x}of b)for(var e=w;e<=x;e++){const g=t.set(d,v,c.normalizeCol(e),c.getWorldForColumn(e)).id;k.add(g);if(!this.has(g)){const h=new l.Tile(this.tileScheme,g);this._tiles.set(g,h);this._index.insert(h);
this.tiles.push(h);f.added.push(h)}}for(d=this.tiles.length-1;0<=d;d--)e=this.tiles[d],k.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(d,1),this._index.remove(e),f.removed.push(e));(f.added.length||f.removed.length)&&this.emit("update",f);q.pool.release(a);k.clear();f.added.length=0;f.removed.length=0}}}return u});