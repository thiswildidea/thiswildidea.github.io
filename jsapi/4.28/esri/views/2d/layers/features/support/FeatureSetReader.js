// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/maybe ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/labelPoint ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/timeZoneUtils ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),function(m,e,g,h,r,n,p,t,
u,v,l,q,w,x){let k=0;e=h("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const y=e[0],z=e[1],A=e[2],B=e[3];e=h("featurelayer-simplify-payload-size-factors")??[1,2,4];const C=e[0],D=e[1],E=e[2],F=h("featurelayer-simplify-mobile-factor")??2,G=h("esri-mobile");class H{constructor(a,b){this.type="FeatureSetReader";this.arcadeDeclaredClass="esri.arcade.Feature";this.seen=!1;this._ty=this._tx=this.instance=0;this._sy=this._sx=1;this._deleted=null;this._joined=[];this._contextTimeZone=this._objectIdToIndex=
null;this._level=0;this.instance=a;this._layerSchema=b}static createInstance(){k++;return k=65535<k?0:k}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(a){this._contextTimeZone=a}set level(a){this._level=a}getAreaSimplificationThreshold(a,b){let c=1;const d=G?F:1;4E6<b?c=E*d:1E6<b?c=D*d:5E5<b?c=C*d:1E5<b&&(c=d);b=0;4E3<a?b=B*c:2E3<a?b=A*c:100<a?b=z:15<a&&(b=y);a=8;4>this._level?a=1:5>this._level?
a=2:6>this._level&&(a=4);return b*a}createQuantizedExtrudedGeometry(a,b){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(a,b):this._createQuantizedExtrudedQuad(a,b)}_createQuantizedExtrudedQuad(a,b){return new l([5],[a-1,b,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(a,b){return new l([2],[a-1,b+1,1,-1])}parseTimestampOffset(a){return a}setArcadeSpatialReference(a){this._arcadeSpatialReference=a}attachStorage(a){this._storage=a}getQuantizationTransform(){throw Error("Unable to find transform for featureSet");
}getStorage(){return this._storage}getComputedNumeric(a){return this.getComputedNumericAtIndex(0)}setComputedNumeric(a,b){return this.setComputedNumericAtIndex(b,0)}getComputedString(a){return this.getComputedStringAtIndex(0)}setComputedString(a,b){return this.setComputedStringAtIndex(0,b)}getComputedNumericAtIndex(a){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),a)}setComputedNumericAtIndex(a,b){this._storage.setComputedNumericAtIndex(this.getDisplayId(),a,b)}getComputedStringAtIndex(a){return this._storage.getComputedStringAtIndex(this.getDisplayId(),
a)}setComputedStringAtIndex(a,b){return this._storage.setComputedStringAtIndex(this.getDisplayId(),a,b)}transform(a,b,c,d){const f=this.copy();f._tx+=a;f._ty+=b;f._sx*=c;f._sy*=d;return f}readAttributeAsTimestamp(a){a=this.readAttribute(a);return"string"===typeof a?(new Date(a)).getTime():"number"===typeof a||null==a?a:null}readAttribute(a,b=!1){var c=this._readAttribute(a,b);if(void 0!==c)return c;for(const d of this._joined)if(d.setIndex(this.getIndex()),c=d._readAttribute(a,b),void 0!==c)return c}readAttributes(){const a=
this._readAttributes();for(const b of this._joined){b.setIndex(this.getIndex());const c=b._readAttributes();for(const d of Object.keys(c))a[d]=c[d]}return a}joinAttributes(a){this._joined.push(a)}readArcadeFeature(){return this}hasField(a){return this.fields.has(a)}geometry(){var a=this.readHydratedGeometry();a=v.convertToGeometry(a,this.geometryType,this.hasZ,this.hasM);if(a=x.fromJSON(a))a.spatialReference=this._arcadeSpatialReference;return a}autocastArcadeDate(a,b){return b&&b instanceof Date?
this.isUnknownDateTimeField(a)?g.ArcadeDate.unknownDateJSToArcadeDate(b):g.ArcadeDate.dateJSAndZoneToArcadeDate(b,this.contextTimeZone??q.system):b}isUnknownDateTimeField(a){return this._layerSchema.fieldsIndex.getTimeZone(a)===q.unknown}field(a){let b=this.fields.get(a);if(b)switch(b.type){case "date-only":case "esriFieldTypeDateOnly":return n.DateOnly.fromReader(this.readAttribute(a,!1));case "time-only":case "esriFieldTypeTimeOnly":return p.TimeOnly.fromReader(this.readAttribute(a,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return g.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(a,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(a,this.readAttribute(a,!0));default:return this.readAttribute(a,!1)}for(const c of this._joined)if(c.setIndex(this.getIndex()),b=c.fields.get(a))switch(b.type){case "date-only":case "esriFieldTypeDateOnly":return n.DateOnly.fromReader(c._readAttribute(a,!1));case "time-only":case "esriFieldTypeTimeOnly":return p.TimeOnly.fromReader(c._readAttribute(a,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return g.ArcadeDate.fromReaderAsTimeStampOffset(c._readAttribute(a,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(a,c._readAttribute(a,!0));default:return this.readAttribute(a,!1)}throw Error(`Field ${a} does not exist`);}setField(a,b){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(a=>a.name)}castToText(a=!1){if(!a)return JSON.stringify(this.readLegacyFeature());a=this.readLegacyFeature();if(!a)return JSON.stringify(null);a={geometry:a.geometry,attributes:{...(a.attributes??
{})}};for(const b in a.attributes){const c=a.attributes[b];c instanceof Date&&(a.attributes[b]=c.getTime())}return JSON.stringify(a)}gdbVersion(){return null}fullSchema(){return this._layerSchema}castAsJson(a=null){return{attributes:this._readAttributes(),geometry:!0===a?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(a,b=null){return Promise.resolve(this.castAsJson(b))}removeIds(a){if(null==this._objectIdToIndex){var b=new Map;const c=this.getCursor();for(;c.next();){const d=
c.getObjectId();r.assertIsSome(d);b.set(d,c.getIndex())}this._objectIdToIndex=b}b=this._objectIdToIndex;for(const c of a)b.has(c)&&this.removeAtIndex(b.get(c))}removeAtIndex(a){null==this._deleted&&(this._deleted=w.StaticBitSet.create(this.getSize()));this._deleted.set(a)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const a=this.getCursor();for(;a.next();)yield a.readOptimizedFeature()}_getExists(){return null==
this._deleted||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;var a=this.readUnquantizedGeometry();if(!a||a.hasIndeterminateRingOrder)return null;a=t.GeometryCursor.fromOptimized(a,this.geometryType);a.yFactor*=-1;return(a=u.getLabelPoint(a))?(a[1]*=-1,new l([],a)):null}copyInto(a){a.seen=this.seen;a._storage=this._storage;a._arcadeSpatialReference=this._arcadeSpatialReference;a._joined=this._joined;a._tx=this._tx;a._ty=this._ty;a._sx=
this._sx;a._sy=this._sy;a._deleted=this._deleted;a._objectIdToIndex=this._objectIdToIndex;a.contextTimeZone=this.contextTimeZone}}m.FeatureSetReader=H;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});