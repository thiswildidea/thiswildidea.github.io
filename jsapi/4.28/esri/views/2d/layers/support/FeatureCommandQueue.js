// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),function(g,d,m,v,w,x,t,u){function h(a){return a.some(b=>b.globalId)}function f(a){return a.filter(b=>!b.error).map(b=>b.objectId??b.globalId).filter(b=>null!=b)}function n(a,b){a=new Set(a);for(const c of b.values())a.add(c);
return a}function p(a,b){a=new Set(a);for(const c of b.values())a.delete(c);return a}d=class extends d{constructor(a){super(a);this._hasGlobalIds=!1;this._notifyUpdating=()=>{this.notifyChange("updating")}}normalizeCtorArgs(a){this._queueProcessor=new u.QueueProcessor({concurrency:1,process:a.process});return{}}destroy(){this.clear()}get updating(){return 0<this._queueProcessor.length}clear(){this._queueProcessor.clear()}push(a){const b=this._queueProcessor;var c=b.last();switch(a.type){case "update":case "refresh":if(c?.type===
a.type)return;b.push(a).then(this._notifyUpdating,this._notifyUpdating);break;case "edit":(c="processed-edit"===c?.type?c:null)&&b.popLast();a=this._mergeEdits(c,a);for(const e of a)e&&b.push(e).then(this._notifyUpdating,this._notifyUpdating)}this.notifyChange("updating")}_mergeEdits(a,b){const {addedFeatures:c,deletedFeatures:e,updatedFeatures:k}=b.edits;if(this._hasGlobalIds=this._hasGlobalIds||h(c)||h(k)||h(e))return b=[...c,...k],[a,{type:"processed-edit",edits:{addOrModified:b,removed:e}}];b=
new Set(f(a?.edits.addOrModified??[]));a=new Set(f(a?.edits.removed??[]));const q=new Set([...f(c),...f(k)]),r=new Set(f(e));b=Array.from(n(p(b,r),q)).map(l=>({objectId:l}));a=Array.from(n(p(a,q),r)).map(l=>({objectId:l}));return[{type:"processed-edit",edits:{addOrModified:b,removed:a}}]}};g.__decorate([m.property({readOnly:!0})],d.prototype,"updating",null);g.__decorate([m.property()],d.prototype,"process",void 0);return d=g.__decorate([t.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],
d)});