// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ../../tiling/TileKey".split(" "),function(u,z,A,f,d,e,b,c,g){function l(r){return()=>r.abort()}class n{constructor(r,v,k){this._layer=r;this._styleRepository=v;this.devicePixelRatio=k;this._inputSignalEventListener=this._startOptionsInputSignal=this._spriteSourceAbortController=
this._connection=this._glyphMosaic=this._spriteMosaic=null}destroy(){this._connection?.close();this._layer=this._styleRepository=this._connection=null;this._spriteMosaic?.destroy();this._glyphMosaic=this._spriteMosaic=null;this._spriteSourceAbortController=z.abortMaybe(this._spriteSourceAbortController);this._spriteSourcePromise=null;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._inputSignalEventListener=this._startOptionsInputSignal=
null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(r){this._requestSprite(r);var v=this._layer.currentStyleInfo.glyphsUrl;v=new b(v?f.addQueryParameters(v,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new e(1024,1024,v);this._broadcastPromise=d.open("WorkerTileHandler",{client:this,schedule:r.schedule,signal:r.signal}).then(k=>{this._layer&&(this._connection?.close(),this._connection=
k,this._layer&&!this._connection.closed&&(k=k.broadcast("setStyle",this._layer.currentStyleInfo.style,r),Promise.all(k).catch(h=>A.throwIfNotAbortError(h))))})}_requestSprite(r){this._spriteSourceAbortController?.abort();const v=new AbortController;this._spriteSourceAbortController=v;const k=r?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._startOptionsInputSignal=null;k&&(this._inputSignalEventListener=l(v),
k.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const {signal:h}=v;this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,{...r,signal:h});this._spriteSourcePromise.then(t=>{A.throwIfAbortError(h);this._spriteMosaic=new c(1024,1024,250);this._spriteMosaic.setSpriteSource(t)})}async updateStyle(r){await this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",r))}setSpriteSource(r){const v=new c(1024,1024,
250);v.setSpriteSource(r);this._spriteMosaic=v;this._spriteSourcePromise=Promise.resolve(r);this._spriteSourceAbortController=null;return v}async setStyle(r,v){await this._broadcastPromise;this._styleRepository=r;this._requestSprite();r=new b(this._layer.currentStyleInfo.glyphsUrl?f.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new e(1024,1024,r);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",
v))}fetchTileData(r,v){return this._getRefKeys(r,v).then(k=>{const h=this._layer.sourceNameToSource,t=[];for(const m in h)t.push(m);return this._getSourcesData(t,k,v)})}parseTileData(r,v){const k=r&&r.data;if(!k)return Promise.resolve(null);const {sourceName2DataAndRefKey:h,transferList:t}=k;return 0===Object.keys(h).length?Promise.resolve(null):this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:r.key.id,sourceName2DataAndRefKey:h,styleLayerUIDs:r.styleLayerUIDs},{...v,
transferList:t}))}async getSprites(r){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(r)}getGlyphs(r){return this._glyphMosaic.getGlyphItems(r.font,r.codePoints)}async _getTilePayload(r,v,k){r=g.pool.acquire(r.id);const h=this._layer.sourceNameToSource[v],{level:t,row:m,col:x}=r;g.pool.release(r);try{return{protobuff:await h.requestTile(t,m,x,k),sourceName:v}}catch(B){if(A.isAbortError(B))throw B;return{protobuff:null,sourceName:v}}}_getRefKeys(r,v){const k=this._layer.sourceNameToSource,
h=[];for(const t in k){const m=k[t].getRefKey(r,v);h.push(m)}return Promise.allSettled(h)}_getSourcesData(r,v,k){const h=[];for(let m=0;m<v.length;m++){var t=v[m];t="fulfilled"===t.status?t.value:null;null==t||null==r[m]?h.push(null):(t=this._getTilePayload(t,r[m],k),h.push(t))}return Promise.allSettled(h).then(m=>{const x={},B=[];for(let D=0;D<m.length;D++){var p=m[D];p="fulfilled"===p.status?p.value:null;const J=p?.protobuff;if(p&&J?.byteLength){var y=v[D];if(y="fulfilled"===y.status?y.value:null)x[p.sourceName]=
{refKey:y.id,protobuff:J},B.push(J)}}return{sourceName2DataAndRefKey:x,transferList:B}})}}u.TileHandler=n;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack","../webgl/Rect","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(u,z,A,f,d){class e{constructor(b,c,g){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex=
{};this._textures=[];this._rangePromises=new Map;this.width=b;this.height=c;this._glyphSource=g;this._binPack=new u(b-4,c-4);this._glyphData.push(new Uint8Array(b*c));this._dirties.push(!0);this._textures.push(void 0)}getGlyphItems(b,c){const g=[],l=this._glyphSource,n=new Set,r=1/256;for(const k of c)n.add(Math.floor(k*r));const v=[];n.forEach(k=>{const h=b+k;this._rangePromises.has(h)?v.push(this._rangePromises.get(h)):(k=l.getRange(b,k).then(()=>{this._rangePromises["delete"](h)},()=>{this._rangePromises["delete"](h)}),
this._rangePromises.set(h,k),v.push(k))});return Promise.all(v).then(()=>{let k=this._glyphIndex[b];k||(k={},this._glyphIndex[b]=k);for(const B of c){var h=k[B];if(h){g[B]={sdf:!0,rect:h.rect,metrics:h.metrics,page:h.page,code:B};continue}var t=l.getGlyph(b,B);if(!t?.metrics)continue;h=t.metrics;let p;if(0===h.width)p=new z(0,0,0,0);else{const y=h.width+6,D=h.height+6;var m=y%4?4-y%4:4,x=D%4?4-D%4:4;1===m&&(m=5);1===x&&(x=5);p=this._binPack.allocate(y+m,D+x);p.isEmpty&&(this._dirties[this._currentPage]||
(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new u(this.width-4,this.height-4),p=this._binPack.allocate(y+m,D+x));m=this._glyphData[this._currentPage];t=t.bitmap;let J;if(t)for(let M=0;M<D;M++){x=y*M;J=this.width*(p.y+M+1)+p.x;for(let F=0;F<y;F++)m[J+F+1]=t.at(x+F)}}k[B]={rect:p,metrics:h,tileIDs:null,page:this._currentPage};g[B]={sdf:!0,
rect:p,metrics:h,page:this._currentPage,code:B};this._dirties[this._currentPage]=!0}return g})}removeGlyphs(b){for(const c in this._glyphIndex){const g=this._glyphIndex[c];if(!g)continue;let l;for(const n in g)if(l=g[n],l.tileIDs["delete"](b),0===l.tileIDs.size){const r=this._glyphData[l.page],v=l.rect;let k,h;for(let t=0;t<v.height;t++)for(k=this.width*(v.y+t)+v.x,h=0;h<v.width;h++)r[k+h]=0;delete g[n];this._dirties[l.page]=!0}}}bind(b,c,g,l=0){if(!this._textures[g]){var n=new d.TextureDescriptor;
n.pixelFormat=A.PixelFormat.ALPHA;n.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;n.width=this.width;n.height=this.height;this._textures[g]=new f.Texture(b,n,new Uint8Array(this.width*this.height))}n=this._textures[g];n.setSamplingMode(c);this._dirties[g]&&n.setData(this._glyphData[g]);b.bindTexture(n,l);this._dirties[g]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0;this._binPack=null;for(const b of this._textures)b&&b.dispose();this._textures.length=0}}return e})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],
function(u){class z{constructor(A,f){this._height=this._width=0;this._free=[];this._width=A;this._height=f;this._free.push(new u(0,0,A,f))}get width(){return this._width}get height(){return this._height}allocate(A,f){if(A>this._width||f>this._height)return new u;let d=null,e=-1;for(let b=0;b<this._free.length;++b){const c=this._free[b];A<=c.width&&f<=c.height&&(null===d||c.y<=d.y&&c.x<=d.x)&&(d=c,e=b)}if(null===d)return new u;this._free.splice(e,1);d.width<d.height?(d.width>A&&this._free.push(new u(d.x+
A,d.y,d.width-A,f)),d.height>f&&this._free.push(new u(d.x,d.y+f,d.width,d.height-f))):(d.width>A&&this._free.push(new u(d.x+A,d.y,d.width-A,d.height)),d.height>f&&this._free.push(new u(d.x,d.y+f,A,d.height-f)));return new u(d.x,d.y,A,f)}release(A){for(let f=0;f<this._free.length;++f){const d=this._free[f];if(d.y===A.y&&d.height===A.height&&d.x+d.width===A.x)d.width+=A.width;else if(d.x===A.x&&d.width===A.width&&d.y+d.height===A.y)d.height+=A.height;else if(A.y===d.y&&A.height===d.height&&A.x+A.width===
d.x)d.x=A.x,d.width+=A.width;else if(A.x===d.x&&A.width===d.width&&A.y+A.height===d.y)d.y=A.y,d.height+=A.height;else continue;this._free.splice(f,1);this.release(A)}this._free.push(A)}}return z})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(u,z){class A{constructor(b){this._metrics=[];if(b){for(var c=new Map,g=0;b.next();)switch(b.tag()){case 1:const n=b.getMessage();for(;n.next();)switch(n.tag()){case 3:var l=n.getMessage();
let r,v,k,h,t,m,x;for(;l.next();)switch(l.tag()){case 1:r=l.getUInt32();break;case 2:v=l.getBytes();break;case 3:k=l.getUInt32();break;case 4:h=l.getUInt32();break;case 5:t=l.getSInt32();break;case 6:m=l.getSInt32();break;case 7:x=l.getUInt32();break;default:l.skip()}l.release();r&&(l=v?.length??0,this._metrics[r]={width:k,height:h,left:t,top:m,advance:x,startOffset:g,length:l},c.set(r,v),g+=l);break;default:n.skip()}n.release();break;default:b.skip()}b=new Uint8Array(g);g=this._metrics;for(const [n,
r]of c){const {startOffset:v,length:k}=g[n];if(r)for(c=0;c<k;++c)b[v+c]=r[c]}this._allBitmaps=b}else this._allBitmaps=null}getMetrics(b){return this._metrics[b]}getBitmap(b){if(this._allBitmaps&&(b=this._metrics[b],void 0!==b)){var {startOffset:c,length:g}=b;if(0!==g)return new e(this._allBitmaps,c,g)}}}class f{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(b){return this._ranges[b]}addRange(b,c){this._ranges[b]=c}}class d{constructor(b){this._glyphInfo={};this._baseURL=b}getRange(b,
c){const g=this._getFontStack(b);if(g.getRange(c))return Promise.resolve();const l=256*c,n=l+255;if(this._baseURL)return b=this._baseURL.replace("{fontstack}",b).replace("{range}",l+"-"+n),u(b,{responseType:"array-buffer"}).then(r=>{g.addRange(c,new A(new z(new Uint8Array(r.data),new DataView(r.data))))}).catch(()=>{g.addRange(c,new A)});g.addRange(c,new A);return Promise.resolve()}getGlyph(b,c){if(b=this._getFontStack(b))if(b=b.getRange(Math.floor(c/256)))return{metrics:b.getMetrics(c),bitmap:b.getBitmap(c)}}_getFontStack(b){let c=
this._glyphInfo[b];c||(c=this._glyphInfo[b]=new f);return c}}class e{constructor(b,c,g){this._array=b;this._start=c;this.length=g}at(b){return 0<=b&&b<this.length?this._array[this._start+b]:void 0}}return d})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../symbols/cim/rasterizingUtils ./RectangleBinPack ../webgl/Rect ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(u,z,A,f,d,e){class b{constructor(c,g,l=0){this._size=
[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=c||0>=g)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=c;this._pageHeight=g;0<l&&(this._maxItemSize=l);this._binPack=new z(c-4,g-4)}destroy(){this.dispose()}dispose(){this._binPack=null;this._mosaicsData.length=0;this._mosaicRects={};for(const c of this._textures)c&&
c.dispose();this._textures.length=0}getWidth(c){return c>=this._size.length?-1:this._size[c][0]}getHeight(c){return c>=this._size.length?-1:this._size[c][1]}getPageSize(c){return c>=this._size.length?null:this._size[c]}setSpriteSource(c){this.dispose();this.pixelRatio=c.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new z(this._pageWidth-4,this._pageHeight-4);const g=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=g;this._dirties.push(!0);
this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=c}getSpriteItem(c,g=!1){var l=this._mosaicRects[c];if(l)return l;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let n;c&&c.startsWith("dasharray-")?([l,n]=this._rasterizeDash(c),g=!0):l=this._sprites.getSpriteInfo(c);if(!l?.width||!l.height||0>l.width||0>l.height)return null;const r=l.width,v=l.height,[k,h,t]=this._allocateImage(r,v);if(0>=k.width)return null;this._copy(k,l,h,t,g,n);l=
{rect:k,width:r,height:v,sdf:l.sdf,simplePattern:!1,pixelRatio:l.pixelRatio,page:h};return this._mosaicRects[c]=l}getSpriteItems(c){const g={};for(const l of c)g[l.name]=this.getSpriteItem(l.name,l.repeat);return g}getMosaicItemPosition(c,g){g=(c=this.getSpriteItem(c,g))&&c.rect;if(!g)return null;g.width=c.width;g.height=c.height;return{tl:[g.x+2,g.y+2],br:[g.x+2+c.width,g.y+2+c.height],page:c.page}}bind(c,g,l=0,n=0){if(!(l>=this._size.length||l>=this._mosaicsData.length)){if(!this._textures[l]){var r=
new e.TextureDescriptor;r.wrapMode=f.TextureWrapMode.CLAMP_TO_EDGE;r.width=this._size[l][0];r.height=this._size[l][1];this._textures[l]=new d.Texture(c,r,new Uint8Array(this._mosaicsData[l].buffer))}r=this._textures[l];r.setSamplingMode(g);this._dirties[l]&&r.setData(new Uint8Array(this._mosaicsData[l].buffer));c.bindTexture(r,n);this._dirties[l]=!1}}static _copyBits(c,g,l,n,r,v,k,h,t,m,x){let B=n*g+l;k=h*v+k;if(x)for(k-=v,x=-1;x<=m;x++,B=((x+m)%m+n)*g+l,k+=v)for(h=-1;h<=t;h++)r[k+h]=c[B+(h+t)%t];
else for(l=0;l<m;l++){for(n=0;n<t;n++)r[k+n]=c[B+n];B+=g;k+=v}}_copy(c,g,l,n,r,v){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(l>=this._mosaicsData.length)){var k=new Uint32Array(v?v.buffer:this._sprites.image.buffer),h=this._mosaicsData[l];h&&k||console.error("Source or target images are uninitialized!");b._copyBits(k,v?g.width:this._sprites.width,g.x,g.y,h,n[0],c.x+2,c.y+2,g.width,g.height,r);this._dirties[l]=!0}}_allocateImage(c,g){c+=2;g+=2;var l=Math.max(c,g);if(this._maxItemSize&&
this._maxItemSize<l)return l=new A(0,0,c,g),this._mosaicsData.push(new Uint32Array(c*g)),this._dirties.push(!0),this._size.push([c,g]),this._textures.push(void 0),[l,this._mosaicsData.length-1,[c,g]];l=c%4?4-c%4:4;let n=g%4?4-g%4:4;1===l&&(l=5);1===n&&(n=5);l=this._binPack.allocate(c+l,g+n);return 0>=l.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),
this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new z(this._pageWidth-4,this._pageHeight-4),this._allocateImage(c,g)):[l,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(c){var g=c.match(/\[(.*?)\]/);if(!g)return null;g=g[1].split(",").map(Number);c=c.slice(c.lastIndexOf("-")+1);const [l,n,r]=u.rasterizeDash(g,c);c=new Uint8Array(l.buffer);return[{x:0,y:0,width:n,height:r,sdf:!0,pixelRatio:1},c]}}return b})},
"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../tiling/TileCoverage","../../tiling/TileKey"],function(u,z,A,f){const d=(b,c)=>b+1/(1<<2*c);class e{constructor(b,c){this._tiles=new Map;this._tileCache=new z.LRUCache(40,g=>g.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=b.acquireTile;this.releaseTile=b.releaseTile;this.tileInfoView=b.tileInfoView;this._container=c}destroy(){for(const [,b]of this._tiles)b.dispose();
this._tiles=null;this._tileCache.clear();this._tileCache=null}update(b){this._updateCacheSize(b);const c=this.tileInfoView;b=c.getTileCoverage(b.state,0,!0,"smallest");if(!b)return!0;const {spans:g,lodInfo:l}=b,{level:n}=l,r=this._tiles,v=new Set,k=new Set;for(const {row:t,colFrom:m,colTo:x}of g)for(let B=m;B<=x;B++){const p=f.getId(n,t,l.normalizeCol(B),l.getWorldForColumn(B)),y=this._getOrAcquireTile(p);v.add(p);y.processed()?this._addToContainer(y):k.add(new f(p))}for(const [t,m]of r)m.isCoverage=
v.has(t);for(var h of k)this._findPlaceholdersForMissingTiles(h,v);h=!1;for(const [t,m]of r)m.neededForCoverage=v.has(t),m.neededForCoverage||m.isHoldingForFade&&c.intersects(b,m.key)&&v.add(t),m.isFading&&(h=!0);for(const [t]of this._tiles)v.has(t)||this._releaseTile(t);A.pool.release(b);return!h}clear(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}_findPlaceholdersForMissingTiles(b,c){var g=[];for(const [,l]of this._tiles)this._addPlaceholderChild(g,
l,b,c);g=g.reduce(d,0);1E-6>Math.abs(1-g)||this._addPlaceholderParent(b.id,c)}_addPlaceholderChild(b,c,g,l){if(!(c.key.level<=g.level)&&c.hasData()){var n=c.key,r=n.level-g.level;g.row===n.row>>r&&g.col===n.col>>r&&g.world===n.world&&(this._addToContainer(c),l.add(c.id),b.push(c.key.level-g.level))}}_addPlaceholderParent(b,c){const g=this._tiles;for(;;){{const [n,r,v,k]=b.split("/");b=parseInt(n,10);b=0===b?null:`${b-1}/${parseInt(r,10)>>1}/${parseInt(v,10)>>1}/${parseInt(k,10)}`}if(!b||c.has(b))break;
const l=g.get(b);if(l&&l.hasData()){this._addToContainer(l);c.add(l.id);break}}}_getOrAcquireTile(b){let c=this._tiles.get(b);if(c)return c;(c=this._tileCache.pop(b))||(c=this.acquireTile(new f(b)));this._tiles.set(b,c);return c}_releaseTile(b){const c=this._tiles.get(b);this.releaseTile(c);this._removeFromContainer(c);this._tiles.delete(b);c.hasData()?this._tileCache.put(b,c,1):c.dispose()}_addToContainer(b){let c;const g=[],l=this._container;if(!l.contains(b)){var n=this._visibleTiles;for(const [,
r]of n)this._canConnectDirectly(b,r)&&g.push(r),null==c&&this._canConnectDirectly(r,b)&&(c=r);if(null!=c){for(const r of g)c.childrenTiles.delete(r),b.childrenTiles.add(r),r.parentTile=b;c.childrenTiles.add(b);b.parentTile=c}else for(const r of g)b.childrenTiles.add(r),r.parentTile=b;n.set(b.id,b);l.addChild(b)}}_removeFromContainer(b){this._visibleTiles.delete(b.id);this._container.removeChild(b);if(null!=b.parentTile){b.parentTile.childrenTiles.delete(b);for(const c of b.childrenTiles)null!=b.parentTile&&
b.parentTile.childrenTiles.add(c)}for(const c of b.childrenTiles)c.parentTile=b.parentTile;b.parentTile=null;b.childrenTiles.clear()}_canConnectDirectly(b,c){b=b.key;let {level:g,row:l,col:n,world:r}=c.key;for(c=this._visibleTiles;0<g;){g--;l>>=1;n>>=1;if(b.level===g&&b.row===l&&b.col===n&&b.world===r)return!0;if(c.has(`${g}/${l}/${n}/${r}`))break}return!1}_updateCacheSize(b){b=b.state.size;if(b[0]!==this._viewSize[0]||b[1]!==this._viewSize[1]){var c=Math.ceil(b[0]/512)+1,g=Math.ceil(b[1]/512)+1;
this._viewSize[0]=b[0];this._viewSize[1]=b[1];this._tileCache.maxSize=5*c*g}}}u.TileManager=e;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(u,z,A,f,d,e,b,c){class g extends c.TiledDisplayObject{constructor(n,r,v,k,h,t,m,x=null){super(n,r,v,k,h,
t,4096,4096);this.styleRepository=m;this._memCache=x;this.type="vector-tile";this._referenced=0;this._hasSymbolBuckets=!1;this._memoryUsedByLayerData=0;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this._processed=!1;this._referenced=1;this.id=n.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&
performance.now()-this.lastOpacityUpdate<b.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<b.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(n){this.changeDataImpl(n);this.requestRender();this.ready();this._processed=!0}deleteLayerData(n){let r=!1;for(const v of n)if(n=this.layerData.get(v))this._memoryUsedByLayerData-=n.memoryUsed,n.type===
d.BucketType.SYMBOL&&this.symbols.delete(v)&&(r=!0),n.destroy(),this.layerData.delete(v);this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData);r&&this.emit("symbols-changed");this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}dispose(){"unloaded"!==this.status&&(l.delete(this),g._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0===--this._referenced?
(this.dispose(),this.stage=null,!0):!1}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(n){let r=!1;if(n){const {bucketsWithData:v,emptyBuckets:k}=n;n=this._createRenderBuckets(v);if(k&&0<k.byteLength){const h=new Uint32Array(k);for(const t of h)this._deleteLayerData(t)}for(const [h,t]of n)this._deleteLayerData(h),t.type===d.BucketType.SYMBOL&&(this.symbols.set(h,t.symbols),r=!0),this._memoryUsedByLayerData+=
t.memoryUsed,this.layerData.set(h,t);this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const [,v]of this.layerData)v.type===d.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(n){this.stage={context:n,trashDisplayObject(r){r.processDetach()},untrashDisplayObject(){return!1}}}setTransform(n){super.setTransform(n);var r=this.resolution/(n.resolution*n.pixelRatio);const v=this.width/this.rangeX*r;r*=this.height/this.rangeY;
const k=[0,0];n.toScreen(k,[this.x,this.y]);const h=this.transforms.tileUnitsToPixels;A.identity(h);A.translate(h,h,k);A.rotate(h,h,Math.PI*n.rotation/180);A.scale(h,h,[v,r,1])}_createTransforms(){return{dvs:f.create(),tileMat3:f.create(),tileUnitsToPixels:f.create()}}static _destroyRenderBuckets(n){if(n){var r=new Set;for(const v of n.values())r.has(v)||(v.destroy(),r.add(v));n.clear()}}_createRenderBuckets(n){const r=new Map,v=new Map;for(const k of n){n=this._deserializeBucket(k,v);for(const h of n.layerUIDs)r.set(h,
n)}return r}_deserializeBucket(n,r){let v=r.get(n);if(v)return v;switch((new Uint32Array(n))[0]){case d.BucketType.FILL:v=new e.FillRenderBucket(n,this.styleRepository);break;case d.BucketType.LINE:v=new e.LineRenderBucket(n,this.styleRepository);break;case d.BucketType.SYMBOL:v=new e.SymbolRenderBucket(n,this.styleRepository,this);break;case d.BucketType.CIRCLE:v=new e.CircleRenderBucket(n,this.styleRepository)}r.set(n,v);return v}_deleteLayerData(n){if(this.layerData.has(n)){var r=this.layerData.get(n);
this._memoryUsedByLayerData-=r.memoryUsed;r.destroy();this.layerData.delete(n)}}}const l=new Map;u.VectorTile=g;u.printAllocations=function(){l.forEach((n,r)=>{console.log(`\n${r.key}:`);n[0].forEach(v=>console.log(v));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");n[1].forEach(v=>console.log(v))})};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(u,z,A,f,d,e,b,c){class g{constructor(k,h){this.layerUIDs=[];this.isDestroyed=!1;this._data=k;let t=1;k=new Uint32Array(k);this.layerUIDs=[];const m=k[t++];for(let x=0;x<m;x++)this.layerUIDs[x]=k[t++];this.bufferDataOffset=t;h&&(this.layer=h.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(k){null!=
this._data&&(this.doPrepareForRendering(k,this._data,this.bufferDataOffset),this._data=null)}}class l extends g{constructor(k,h){super(k,h);this.type=f.BucketType.LINE;this.lineIndexCount=this.lineIndexStart=0;k=new Uint32Array(k);h=this.bufferDataOffset;this.lineIndexStart=k[h++];this.lineIndexCount=k[h++];const t=k[h++];if(0<t){this.patternMap=new Map;for(let m=0;m<t;m++){const x=k[h++],B=k[h++],p=k[h++];this.patternMap.set(x,[B,p])}}this.bufferDataOffset=h}get memoryUsed(){return(this.data?.byteLength??
0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(k,h,t){var m=new Uint32Array(h);h=new Int32Array(m.buffer);var x=m[t++];h=e.BufferObject.createVertex(k,b.Usage.STATIC_DRAW,new Int32Array(h.buffer,4*t,x));t+=x;x=m[t++];m=e.BufferObject.createIndex(k,b.Usage.STATIC_DRAW,new Uint32Array(m.buffer,4*t,x));t+=x;t=this.layer.lineMaterial;this.vao=new c.VertexArrayObject(k,
t.getAttributeLocations(),t.getLayoutInfo(),{geometry:h},m)}}class n extends g{constructor(k,h){super(k,h);this.type=f.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=this.fillIndexStart=0;k=new Uint32Array(k);h=this.bufferDataOffset;this.fillIndexStart=k[h++];this.fillIndexCount=k[h++];this.outlineIndexStart=k[h++];this.outlineIndexCount=k[h++];const t=k[h++];if(0<t){this.patternMap=new Map;for(let m=0;m<t;m++){const x=k[h++],B=k[h++],p=k[h++];this.patternMap.set(x,
[B,p])}}this.bufferDataOffset=h}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=z.disposeMaybe(this.fillVAO);this.outlineVAO=z.disposeMaybe(this.outlineVAO)}doPrepareForRendering(k,h,t){var m=new Uint32Array(h),x=new Int32Array(m.buffer),B=m[t++];h=e.BufferObject.createVertex(k,
b.Usage.STATIC_DRAW,new Int32Array(x.buffer,4*t,B));t+=B;var p=m[t++];B=e.BufferObject.createIndex(k,b.Usage.STATIC_DRAW,new Uint32Array(m.buffer,4*t,p));t+=p;p=m[t++];x=e.BufferObject.createVertex(k,b.Usage.STATIC_DRAW,new Int32Array(x.buffer,4*t,p));t+=p;p=m[t++];m=e.BufferObject.createIndex(k,b.Usage.STATIC_DRAW,new Uint32Array(m.buffer,4*t,p));t+=p;p=this.layer;t=p.fillMaterial;p=p.outlineMaterial;this.fillVAO=new c.VertexArrayObject(k,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:h},
B);this.outlineVAO=new c.VertexArrayObject(k,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:x},m)}}class r extends g{constructor(k,h,t){super(k,h);this.type=f.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];h=new Uint32Array(k);const m=new Int32Array(k);k=new Float32Array(k);let x=this.bufferDataOffset;this.isIconSDF=!!h[x++];var B=h[x++];for(var p=
0;p<B;p++){var y=h[x++],D=h[x++],J=h[x++];this.iconPerPageElementsMap.set(y,[D,J])}B=h[x++];for(p=0;p<B;p++)y=h[x++],D=h[x++],J=h[x++],this.glyphPerPageElementsMap.set(y,[D,J]);B=h[x++];p=h[x++];this.iconOpacity=new Int32Array(B);this.textOpacity=new Int32Array(p);this.bufferDataOffset=x=d.deserializeSymbols(h,m,k,x,this.symbols,t)}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+A.estimateSize(this.iconOpacity)+A.estimateSize(this.textOpacity)}hasData(){return 0<
this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let k=0;for(const [,h]of this.iconPerPageElementsMap)k+=h[1];for(const [,h]of this.glyphPerPageElementsMap)k+=h[1];return k/3}doDestroy(){this.iconVAO=z.disposeMaybe(this.iconVAO);this.textVAO=z.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var k=this.iconOpacity,h=this.iconVAO.vertexBuffers.opacity;0<k.length&&k.byteLength===h.byteLength&&h.setSubData(k,0,0,k.length);
k=this.textOpacity;h=this.textVAO.vertexBuffers.opacity;0<k.length&&k.byteLength===h.byteLength&&h.setSubData(k,0,0,k.length)}}doPrepareForRendering(k,h,t){var m=new Uint32Array(h),x=new Int32Array(m.buffer),B=m[t++];h=e.BufferObject.createVertex(k,b.Usage.STATIC_DRAW,new Int32Array(x.buffer,4*t,B));t+=B;var p=m[t++];B=e.BufferObject.createIndex(k,b.Usage.STATIC_DRAW,new Uint32Array(m.buffer,4*t,p));t+=p;p=m[t++];x=e.BufferObject.createVertex(k,b.Usage.STATIC_DRAW,new Int32Array(x.buffer,4*t,p));
t+=p;p=m[t++];m=e.BufferObject.createIndex(k,b.Usage.STATIC_DRAW,new Uint32Array(m.buffer,4*t,p));t+=p;t=e.BufferObject.createVertex(k,b.Usage.STATIC_DRAW,this.iconOpacity.buffer);p=e.BufferObject.createVertex(k,b.Usage.STATIC_DRAW,this.textOpacity.buffer);var y=this.layer;const D=y.iconMaterial;y=y.textMaterial;this.iconVAO=new c.VertexArrayObject(k,D.getAttributeLocations(),D.getLayoutInfo(),{geometry:h,opacity:t},B);this.textVAO=new c.VertexArrayObject(k,y.getAttributeLocations(),y.getLayoutInfo(),
{geometry:x,opacity:p},m)}}class v extends g{constructor(k,h){super(k,h);this.type=f.BucketType.CIRCLE;this.circleIndexCount=this.circleIndexStart=0;k=new Uint32Array(k);h=this.bufferDataOffset;this.circleIndexStart=k[h++];this.circleIndexCount=k[h++];this.bufferDataOffset=h}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(k,
h,t){var m=new Uint32Array(h);h=new Int32Array(m.buffer);var x=m[t++];h=e.BufferObject.createVertex(k,b.Usage.STATIC_DRAW,new Int32Array(h.buffer,4*t,x));t+=x;x=m[t++];m=e.BufferObject.createIndex(k,b.Usage.STATIC_DRAW,new Uint32Array(m.buffer,4*t,x));t+=x;t=this.layer.circleMaterial;this.vao=new c.VertexArrayObject(k,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:h},m)}}u.CircleRenderBucket=v;u.FillRenderBucket=n;u.LineRenderBucket=l;u.RenderBucketBase=g;u.SymbolRenderBucket=r;Object.defineProperty(u,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../enums","./core"],function(u,z,A){class f{constructor(d,e,b){this._rows=Math.ceil(e/b);this._columns=Math.ceil(d/b);this._cellSize=b;this.cells=Array(this._rows);for(d=0;d<this._rows;d++)for(this.cells[d]=Array(this._columns),e=0;e<this._columns;e++)this.cells[d][e]=[]}getCell(d,e){e=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1);d=Math.min(Math.max(Math.floor(d/
this._cellSize),0),this._columns-1);return this.cells[e]&&this.cells[e][d]||null}getCellSpan(d,e,b,c){return[Math.min(Math.max(Math.floor(d/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(b/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(c/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}u.GridIndex=f;u.deserializeSymbols=
function(d,e,b,c,g,l){const n=e[c++];for(let k=0;k<n;k++){const h=new A.VTLSymbol(l);h.xTile=e[c++];h.yTile=e[c++];h.hash=e[c++];h.priority=e[c++];var r=e[c++];for(var v=0;v<r;v++){const t=e[c++],m=e[c++],x=e[c++],B=e[c++],p=!!e[c++],y=e[c++],D=b[c++],J=b[c++],M=e[c++],F=e[c++];h.colliders.push({xTile:t,yTile:m,dxPixels:x,dyPixels:B,hard:p,partIndex:y,width:M,height:F,minLod:D,maxLod:J})}r=d[c++];for(v=0;v<r;v++)h.textVertexRanges.push([d[c++],d[c++]]);r=d[c++];for(v=0;v<r;v++)h.iconVertexRanges.push([d[c++],
d[c++]]);g.push(h)}return c};u.tileCoordChange=function(d,e,b,c,g,l){b-=g;if(0<=b)return(e>>b)+(c-(l<<b))*(d>>b);b=-b;return e-(l-(c<<b))*(d>>b)<<b};u.writeOpacityToBuffers=function(d,e,b){for(const [k,h]of d.symbols){{var c=d,g=e,l=b,n=h;const t=c.layerData.get(k);if(t.type===z.BucketType.SYMBOL){for(const m of n){n=m.unique;var r=void 0;if(m.selectedForRendering){var v=n.parts[0];r=v.startOpacity;v=v.targetOpacity;c.allSymbolsFadingOut=c.allSymbolsFadingOut&&0===v;r=l?Math.floor(127*r)|v<<7:v?255:
0;r|=r<<24|r<<16|r<<8}else r=0;for(const [x,B]of m.iconVertexRanges)for(v=x;v<x+B;v+=4)t.iconOpacity[v/4]=r;m.selectedForRendering?(r=n.parts[1],n=r.startOpacity,r=r.targetOpacity,c.allSymbolsFadingOut=c.allSymbolsFadingOut&&0===r,n=l?Math.floor(127*n)|r<<7:r?255:0,r=n<<24|n<<16|n<<8|n):r=0;for(const [x,B]of m.textVertexRanges)for(n=x;n<x+B;n+=4)t.textOpacity[n/4]=r}t.lastOpacityUpdate=g;t.opacityChanged=!0}}}};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],
function(u){class z{constructor(f){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=f}}class A{constructor(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}u.VTLSymbol=z;u.VTLUniqueSymbol=A;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ./decluttering/SymbolFader ./style/StyleDefinition ../webgl/enums ../webgl/RenderableTile ../webgl/TileContainer ../../tiling/TileCoverage ../../tiling/TileKey ../../../webgl/enums".split(" "),
function(u,z,A,f,d,e,b,c,g,l,n){function r(k,h){if(k){const t=k.getLayoutProperty("visibility");if(!t||t.getValue()!==d.Visibility.NONE&&(void 0===k.minzoom||k.minzoom<h+1E-6)&&(void 0===k.maxzoom||k.maxzoom>=h-1E-6))return!0}return!1}class v extends c{constructor(k){super(k);this._backgroundTiles=[];this._pointToCallbacks=new Map}destroy(){this.removeAllChildren();this._spriteMosaic?.dispose();this._spriteMosaic=null;this._glyphMosaic?.dispose();this._glyphMosaic=null;null!=this._symbolFader&&(this._symbolFader.clear(),
this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[];this._pointToCallbacks.clear()}get fading(){return this._symbolFader?.fading??!1}setStyleResources(k,h,t){this._spriteMosaic=k;this._glyphMosaic=h;this._styleRepository=t;null==this._symbolFader&&(this._symbolFader=new f.SymbolFader(this._styleRepository,this.children));this._symbolFader.styleRepository=t}setSpriteMosaic(k){this._spriteMosaic?.dispose();this._spriteMosaic=k}deleteStyleLayers(k){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(k)}async hitTest(k){const h=
z.createResolver();this._pointToCallbacks.set(k,h);this.requestRender();return h.promise}createRenderParams(k){return{...super.createRenderParams(k),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(k){!this.visible||k.drawPhase!==e.WGLDrawPhase.MAP&&k.drawPhase!==e.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||super.doRender(k)}addChild(k){super.addChild(k);null!=this._symbolFader?this._symbolFader.addTile(k):
k.decluttered=!0;this.requestRender();return k}removeChild(k){null!=this._symbolFader&&this._symbolFader.removeTile(k);this.requestRender();return super.removeChild(k)}renderChildren(k){const {drawPhase:h}=k;if(h===e.WGLDrawPhase.DEBUG)super.renderChildren(k);else if(this._doRender(k),0<this._pointToCallbacks.size){k.drawPhase=e.WGLDrawPhase.HITTEST;const t=k.painter.effects.hittestVTL;t.bind(k);this._doRender(k);t.draw(k,this._pointToCallbacks);t.unbind(k);k.drawPhase=h}}removeAllChildren(){for(let k=
0;k<this.children.length;k++){const h=this.children[k];null!=this._symbolFader&&this._symbolFader.removeTile(h);h.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(k=>k.neededForCoverage&&k.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(k){const {context:h}=k;var t=this._styleRepository;if(t){var m=t.layers,x=!0;k.drawPhase===e.WGLDrawPhase.HITTEST&&(x=!1);0<t.backgroundBucketIds.length&&(k.renderPass="background",
this._renderBackgroundLayers(k,t.backgroundBucketIds));super.renderChildren(k);k.drawPhase===e.WGLDrawPhase.MAP&&this._fade(k.displayLevel,k.state);if((t=this.children.filter(p=>p.visible&&p.hasData()))&&0!==t.length){for(var B of t)B.triangleCount=0;h.setStencilWriteMask(0);h.setColorMask(!0,!0,!0,!0);h.setStencilOp(n.StencilOperation.KEEP,n.StencilOperation.KEEP,n.StencilOperation.REPLACE);h.setStencilTestEnabled(!0);h.setBlendingEnabled(!1);h.setDepthTestEnabled(!0);h.setDepthWriteEnabled(!0);
h.setDepthFunction(n.CompareFunction.LEQUAL);h.setClearDepth(1);h.clear(h.gl.DEPTH_BUFFER_BIT);k.renderPass="opaque";for(B=m.length-1;0<=B;B--)this._renderStyleLayer(m[B],k,t);h.setDepthWriteEnabled(!1);h.setBlendingEnabled(x);h.setBlendFunctionSeparate(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);k.renderPass="translucent";for(x=0;x<m.length;x++)this._renderStyleLayer(m[x],k,t)}h.bindVAO();h.setStencilTestEnabled(!0);h.setBlendingEnabled(!0)}}_fade(k,
h){null!=this._symbolFader&&(this._symbolFader.update(k,h)||this.requestRender())}_renderStyleLayer(k,h,t){const {painter:m,renderPass:x}=h;if(void 0!==k){var B=k.getLayoutProperty("visibility");if(!B||B.getValue()!==d.Visibility.NONE){switch(k.type){case d.StyleLayerType.BACKGROUND:return;case d.StyleLayerType.FILL:if("opaque"!==x&&"translucent"!==h.renderPass)return;var p="vtlFill";break;case d.StyleLayerType.LINE:if("translucent"!==x)return;p="vtlLine";break;case d.StyleLayerType.CIRCLE:if("translucent"!==
x)return;p="vtlCircle";break;case d.StyleLayerType.SYMBOL:if("translucent"!==x)return;p="vtlSymbol"}t=k.type===d.StyleLayerType.SYMBOL?t.filter(y=>y.decluttered):t.filter(y=>y.neededForCoverage);if("vtlSymbol"!==p&&(B=h.displayLevel,0===t.length||void 0!==k.minzoom&&k.minzoom>=B+1E-6||void 0!==k.maxzoom&&k.maxzoom<B-1E-6))return;B=k.uid;h.styleLayerUID=B;h.styleLayer=k;for(const y of t)if(y.layerData.has(B)){m.renderObjects(h,t,p);break}}}}_renderBackgroundLayers(k,h){const {context:t,displayLevel:m,
painter:x,state:B}=k,p=this._styleRepository;var y=!1;for(var D of h)if(p.getLayerById(D).type===d.StyleLayerType.BACKGROUND&&r(p.getLayerById(D),m)){y=!0;break}if(y){y=this._tileInfoView.getTileCoverage(k.state,0,!0,"smallest");var {spans:J,lodInfo:M}=y,{level:F}=M,G=A.create();D=[];if(this._renderPasses){var E=this._renderPasses[0];null!=this._clippingInfos&&(E.brushes[0].prepareState(k),E.brushes[0].drawMany(k,this._clippingInfos))}E=this._backgroundTiles;var K=0;for(const {row:O,colFrom:R,colTo:I}of J)for(let T=
R;T<=I;T++){if(K<E.length){var N=E[K];N.key.set(F,O,M.normalizeCol(T),M.getWorldForColumn(T));this._tileInfoView.getTileBounds(G,N.key,!1);N.x=G[0];N.y=G[3];N.resolution=this._tileInfoView.getTileResolution(F)}else{N=new l(F,O,M.normalizeCol(T),M.getWorldForColumn(T));const V=this._tileInfoView.getTileBounds(A.create(),N),Z=this._tileInfoView.getTileResolution(F);N=new b.RenderableTile(N,Z,V[0],V[3],512,512,4096,4096);E.push(N)}N.setTransform(B);D.push(N);K++}t.setStencilWriteMask(0);t.setColorMask(!0,
!0,!0,!0);t.setStencilOp(n.StencilOperation.KEEP,n.StencilOperation.KEEP,n.StencilOperation.REPLACE);t.setStencilFunction(n.CompareFunction.EQUAL,0,255);F=!0;k.drawPhase===e.WGLDrawPhase.HITTEST&&(F=!1);t.setStencilTestEnabled(F);for(const O of h)h=p.getLayerById(O),h.type===d.StyleLayerType.BACKGROUND&&r(h,m)&&(k.styleLayerUID=h.uid,k.styleLayer=h,x.renderObjects(k,D,"vtlBackground"));g.pool.release(y)}}}u.VectorTileContainer=v;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../core/signal ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),
function(u,z,A,f,d,e,b,c,g){class l{constructor(n,r){this.styleRepository=n;this._tileToHandle=new Map;this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._completed=!1;this._fading=z.signal(!1);this._symbolRepository=new b.SymbolRepository(4096,r,()=>new f.VTLUniqueSymbol);this._symbolDeclutterer=new e.SymbolDeclutterer(r,this._symbolRepository,(v,k,h)=>new d.CollisionJob(v,k,h,this.styleRepository,this._zoom,this._viewState.rotation),
(v,k)=>{v.allSymbolsFadingOut=!0;v.lastOpacityUpdate=k;c.writeOpacityToBuffers(v,k,!0);v.decluttered=!0;v.requestRender()},(v,k)=>this.styleRepository.getStyleLayerByUID(v.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(k.styleLayerUID).z,v=>{v=this.styleRepository.getStyleLayerByUID(v);return this._zoom+1E-6<v.minzoom||this._zoom-1E-6>=v.maxzoom?!1:(v=v.getLayoutProperty("visibility"))&&v.getValue()===g.Visibility.NONE?!1:!0})}get fading(){return this._fading.value}addTile(n){n.decluttered=
!1;this._tileToHandle.set(n,n.on("symbols-changed",()=>{this._symbolRepository.add(n);this.restartDeclutter()}));this._symbolRepository.add(n);this.restartDeclutter()}removeTile(n){const r=this._tileToHandle.get(n);r&&(this._symbolRepository.removeTile(n),this.restartDeclutter(),r.remove(),this._tileToHandle.delete(n))}update(n,r){this._zoom=n;this._viewState={scale:r.scale,rotation:r.rotation,center:[r.center[0],r.center[1]],size:[r.size[0],r.size[1]]};this._continueDeclutter();return this._completed}restartDeclutter(){this._completed=
!1;this._symbolDeclutterer.restart();this._notifyUnstable()}clear(){this._completed=!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(n=>n.remove());this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(n){this._symbolRepository.deleteStyleLayers(n)}_continueDeclutter(){if(!this._completed||
this.stale)this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],
this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(A.declutterBudget))&&this._scheduleNotifyStable()}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this._fading.value=!1},1.5*A.fadeDuration)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this._fading.value=
!0}}u.SymbolFader=l;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../chunks/mat3f32","./config","./util","../style/StyleDefinition"],function(u,z,A,f,d){class e{constructor(b,c,g,l,n,r){this._symbols=b;this._styleRepository=l;this._zoom=n;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new f.GridIndex(c,g,A.collisionGridCellSize);
this._si=Math.sin(Math.PI*r/180);this._co=Math.cos(Math.PI*r/180);for(const v of b)for(const k of v.symbols)this._allNeededMatrices.has(k.tile)||this._allNeededMatrices.set(k.tile,z.clone(k.tile.transforms.tileUnitsToPixels))}work(b){const c=this._gridIndex,g=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const p=this._symbols[this._currentLayerCursor],y=this._getProperties(p.styleLayerUID);for(;this._currentSymbolCursor<
p.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-g>b)return!1;var l=p.symbols[this._currentSymbolCursor];if(!l.unique.show)continue;var n=l,r=this._si,v=this._co,k=this._allNeededMatrices.get(l.tile),h=this._zoom;const {iconRotationAlignment:D,textRotationAlignment:J,iconTranslate:M,iconTranslateAnchor:F,textTranslate:G,textTranslateAnchor:E}=y;var t=0;for(const I of n.colliders){const [T,V]=0===I.partIndex?M:G;var m=0===I.partIndex?F:E,x=I.minLod<=
h&&h<=I.maxLod;t+=x?0:1;I.enabled=x;I.xScreen=I.xTile*k[0]+I.yTile*k[3]+k[6];I.yScreen=I.xTile*k[1]+I.yTile*k[4]+k[7];m===d.TranslateAnchor.MAP?(I.xScreen+=v*T-r*V,I.yScreen+=r*T+v*V):(I.xScreen+=T,I.yScreen+=V);d.RotationAlignment.VIEWPORT===(0===I.partIndex?D:J)?(I.dxScreen=I.dxPixels,I.dyScreen=I.dyPixels):(I.dxScreen=v*(I.dxPixels+I.width/2)-r*(I.dyPixels+I.height/2)-I.width/2,I.dyScreen=r*(I.dxPixels+I.width/2)+v*(I.dyPixels+I.height/2)-I.height/2)}0<n.colliders.length&&t===n.colliders.length&&
(n.unique.show=!1);n=l.unique;if(!n.show)continue;const {iconAllowOverlap:K,iconIgnorePlacement:N,textAllowOverlap:O,textIgnorePlacement:R}=y;for(const I of l.colliders)if(I.enabled&&(r=n.parts[I.partIndex],r.show)){if(v=!(I.partIndex?O:K))a:{v=I.xScreen+I.dxScreen;k=I.yScreen+I.dyScreen;h=v+I.width;t=k+I.height;const [T,V,Z,aa]=c.getCellSpan(v,k,h,t);for(m=V;m<=aa;m++)for(x=T;x<=Z;x++){var B=c.cells[m][x];for(const X of B){B=X.xScreen+X.dxScreen;const ba=X.yScreen+X.dyScreen,ea=B+X.width,U=ba+X.height;
if(!(h<B||v>ea||t<ba||k>U)){v=!0;break a}}}v=!1}v&&(I.hard?n.show=!1:r.show=!1)}if(n.show)for(const I of l.colliders){if(!I.enabled)continue;if(I.partIndex?R:N)continue;if(!n.parts[I.partIndex].show)continue;l=I.xScreen+I.dxScreen;r=I.yScreen+I.dyScreen;const [T,V,Z,aa]=this._gridIndex.getCellSpan(l,r,l+I.width,r+I.height);for(l=V;l<=aa;l++)for(r=T;r<=Z;r++)this._gridIndex.cells[l][r].push(I)}}}return!0}_getProperties(b){var c=this._styleProps.get(b);if(c)return c;c=this._zoom;const g=this._styleRepository.getStyleLayerByUID(b);
var l=g.getLayoutValue("symbol-placement",c)!==d.SymbolPlacement.POINT;let n=g.getLayoutValue("icon-rotation-alignment",c);n===d.RotationAlignment.AUTO&&(n=l?d.RotationAlignment.MAP:d.RotationAlignment.VIEWPORT);let r=g.getLayoutValue("text-rotation-alignment",c);r===d.RotationAlignment.AUTO&&(r=l?d.RotationAlignment.MAP:d.RotationAlignment.VIEWPORT);l=g.getPaintValue("icon-translate",c);const v=g.getPaintValue("icon-translate-anchor",c),k=g.getPaintValue("text-translate",c),h=g.getPaintValue("text-translate-anchor",
c);c={iconAllowOverlap:g.getLayoutValue("icon-allow-overlap",c),iconIgnorePlacement:g.getLayoutValue("icon-ignore-placement",c),textAllowOverlap:g.getLayoutValue("text-allow-overlap",c),textIgnorePlacement:g.getLayoutValue("text-ignore-placement",c),iconRotationAlignment:n,textRotationAlignment:r,iconTranslateAnchor:v,iconTranslate:l,textTranslateAnchor:h,textTranslate:k};this._styleProps.set(b,c);return c}}u.CollisionJob=e;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports",
"./config"],function(u,z){function A(d,e){if(d.priority-e.priority)return d.priority-e.priority;const b=d.tile.key,c=e.tile.key;return b.world-c.world?b.world-c.world:b.level-c.level?b.level-c.level:b.row-c.row?b.row-c.row:b.col-c.col?b.col-c.col:d.xTile-e.xTile?d.xTile-e.xTile:d.yTile-e.yTile}class f{get running(){return this._running}constructor(d,e,b,c,g,l){this._visibleTiles=d;this._symbolRepository=e;this._createCollisionJob=b;this._assignTileSymbolsOpacity=c;this._symbolLayerSorter=g;this._isLayerVisible=
l;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}setScreenSize(d,e){this._screenWidth===d&&this._screenHeight===e||this.restart();this._screenWidth=d;this._screenHeight=e}restart(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}continue(d){this._selectionJob||
(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var e=performance.now();if(!this._selectionJob.work(d))return!1;this._selectionJobCompleted=!0;d=Math.max(0,d-(performance.now()-e));if(0===d)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){e=performance.now();if(!this._collisionJob.work(d))return!1;this._collisionJobCompleted=!0;d=Math.max(0,
d-(performance.now()-e));if(0===d)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){e=performance.now();if(!this._opacityJob.work(d))return!1;this._opacityJobCompleted=!0;d=Math.max(0,d-(performance.now()-e));if(0===d)return!1}this._running=!1;return!0}_createSelectionJob(){const d=this._symbolRepository.uniqueSymbols;for(let n=0;n<d.length;n++){const r=d[n];for(let v=0;v<r.uniqueSymbols.length;v++){const k=r.uniqueSymbols[v];for(const h of k.tileSymbols)h.selectedForRendering=
!1}}const e=[];let b=0,c=0;const g=this._isLayerVisible,l=this._symbolLayerSorter;return{work:function(n){const r=performance.now();for(;c<d.length;c++,b=0){const k=d[c];var v=k.styleLayerUID;if(!g(v)){e[c]||(e[c]={styleLayerUID:v,symbols:[]});continue}e[c]=e[c]||{styleLayerUID:v,symbols:[]};const h=e[c];for(;b<k.uniqueSymbols.length;b++){v=k.uniqueSymbols[b];if(99===b%100&&performance.now()-r>n)return!1;let t=null,m=!1,x=!1;for(const B of v.tileSymbols)if(!x||!m){const p=B.tile;if(!t||p.isCoverage||
p.neededForCoverage&&!m){t=B;if(p.neededForCoverage||p.isCoverage)x=!0;p.isCoverage&&(m=!0)}}t.selectedForRendering=!0;if(x){h.symbols.push(t);v.show=!0;for(const B of v.parts)B.show=!0}else v.show=!1}}for(const k of e)k.symbols.sort(A);return!0},get sortedSymbols(){return e.sort(l)}}}_createOpacityJob(){function d(g,l){var n=g.symbols;for(const [,v]of n){var r=v;n=l;for(const k of r){r=k.unique;for(const h of r.parts)h.startOpacity+=(n-h.startTime)/z.fadeDuration*(.5<h.targetOpacity?1:-1),h.startOpacity=
Math.min(Math.max(h.startOpacity,0),1),h.startTime=n,h.targetOpacity=r.show&&h.show?1:0}}e(g,l);for(const v of g.childrenTiles)d(v,l)}const e=this._assignTileSymbolsOpacity,b=this._visibleTiles;let c=0;return{work(g){const l=performance.now();for(;c<b.length;c++){if(performance.now()-l>g)return!1;const n=b[c];if(null!=n.parentTile)continue;const r=performance.now();d(n,r)}return!0}}}}u.SymbolDeclutterer=f;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports",
"./util"],function(u,z){class A{constructor(f,d,e){this.tileCoordRange=f;this._visibleTiles=d;this._createUnique=e;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}add(f,d){this._uniqueSymbolLayerArray=null;let e=this._tiles.get(f.id);e||(e={symbols:new Map},this._tiles.set(f.id,e));var b=new Map;if(d)for(var c of d)e.symbols.has(c)&&
(b.set(c,e.symbols.get(c)),e.symbols.delete(c));else for(var [g]of f.layerData)e.symbols.has(g)&&(b.set(g,e.symbols.get(g)),e.symbols.delete(g));this._removeSymbols(b);d=f.symbols;b=new Map;for(const [l,n]of d)if(c=n.length,32<=c){g=this.tileCoordRange;do g/=2,c/=4;while(8<c&&64<g);c=new z.GridIndex(this.tileCoordRange,this.tileCoordRange,g);b.set(l,{flat:n,index:c});e.symbols.set(l,{flat:n,index:c});for(const r of n)c.getCell(r.xTile,r.yTile).push(r)}else b.set(l,{flat:n}),e.symbols.set(l,{flat:n});
this._addSymbols(f.key,d)}deleteStyleLayers(f){this._uniqueSymbolLayerArray=null;for(const [d,e]of this._tiles){const b=new Map;for(const c of f)e.symbols.has(c)&&(b.set(c,e.symbols.get(c)),e.symbols.delete(c));this._removeSymbols(b);0===e.symbols.size&&this._tiles.delete(d)}}removeTile(f){this._uniqueSymbolLayerArray=null;const d=this._tiles.get(f.id);if(d){var e=new Map;for(const [b]of f.symbols)d.symbols.has(b)&&(e.set(b,d.symbols.get(b)),d.symbols.delete(b));this._removeSymbols(e);0===d.symbols.size&&
this._tiles.delete(f.id)}}_removeSymbols(f){for(const [e,{flat:b}]of f)for(const c of b){f=c.unique;var d=f.tileSymbols;const g=d.length-1;for(let l=0;l<g;l++)if(d[l]===c){d[l]=d[g];break}d.length=g;0===g&&(d=this._uniqueSymbolsReferences.get(e),d.delete(f),0===d.size&&this._uniqueSymbolsReferences.delete(e));c.unique=null}}_addSymbols(f,d){if(0!==d.size){var e=this._visibleTiles;for(const b of e)b.parentTile||b.key.world!==f.world||b.key.level===f.level&&!b.key.equals(f)||this._matchSymbols(b,f,
d);for(const [b,c]of d)for(const g of c)null==g.unique&&(f=this._createUnique(),g.unique=f,f.tileSymbols.push(g),d=this._uniqueSymbolsReferences.get(b),d||(d=new Set,this._uniqueSymbolsReferences.set(b,d)),d.add(f))}}_matchSymbols(f,d,e){if(f.key.level>d.level){var b=f.key.level-d.level;if(f.key.row>>b!==d.row||f.key.col>>b!==d.col)return}if(d.level>f.key.level&&(b=d.level-f.key.level,d.row>>b!==f.key.row||d.col>>b!==f.key.col))return;if(d.equals(f.key))for(var c of f.childrenTiles)this._matchSymbols(c,
d,e);else{c=new Map;for(const [n,r]of e){var g=[];for(const k of r)e=z.tileCoordChange(this.tileCoordRange,k.xTile,d.level,d.col,f.key.level,f.key.col),b=z.tileCoordChange(this.tileCoordRange,k.yTile,d.level,d.row,f.key.level,f.key.row),0<=e&&e<this.tileCoordRange&&0<=b&&b<this.tileCoordRange&&g.push({symbol:k,xTransformed:e,yTransformed:b});e=[];b=f.key.level<d.level?1:1<<f.key.level-d.level;const v=this._tiles.get(f.id).symbols.get(n);if(v){const k=v.flat;for(const h of g){var l=!1;let t;const m=
h.xTransformed,x=h.yTransformed;t=null!=v.index?v.index.getCell(m,x):k;g=h.symbol;const B=g.hash;for(const p of t)if(B===p.hash&&Math.abs(m-p.xTile)<=b&&Math.abs(x-p.yTile)<=b){l=p.unique;g.unique=l;l.tileSymbols.push(g);l=!0;break}l||e.push(g)}}0<e.length&&c.set(n,e)}for(const n of f.childrenTiles)this._matchSymbols(n,d,c)}}_createUniqueSymbolLayerArray(){var f=this._uniqueSymbolsReferences;const d=Array(f.size);let e=0;for(const [b,c]of f){const g=Array(c.size);f=0;for(const l of c)g[f++]=l;d[e]=
{styleLayerUID:b,uniqueSymbols:g};e++}return d}}u.SymbolRepository=A;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports","../../../../chunks/mat3f32","./TiledDisplayObject"],function(u,z,A){class f extends A.TiledDisplayObject{_createTransforms(){return{dvs:z.create(),tileMat3:z.create()}}}u.RenderableTile=f;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition",
"./StyleLayer"],function(u,z){class A{constructor(f){this._style=f;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;f.layers||(f.layers=[]);this.version=parseFloat(f.version);if(this.layers=f.layers.map((d,e,b)=>this._create(d,e,b)).filter(d=>!!d))for(let d=0;d<this.layers.length;d++)f=this.layers[d],this._layerByName[f.id]=f,this._uidToLayer.set(f.uid,f),f.type===u.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(f.id);this._identifyRefLayers()}isPainterDataDriven(f){return(f=
this._layerByName[f])?f.isPainterDataDriven():!1}getStyleLayerId(f){return f>=this.layers.length?null:this.layers[f].id}getStyleLayerByUID(f){return this._uidToLayer.get(f)??null}getStyleLayerIndex(f){return(f=this._layerByName[f])?this.layers.indexOf(f):-1}setStyleLayer(f,d){if(f?.id){var e=this._style;null!=d&&d>=this.layers.length&&(d=this.layers.length-1);var b=!0,c;if(c=this._layerByName[f.id]){const g=this.layers.indexOf(c);d||(d=g);d===g?(b=!1,c=A._recreateLayer(f,c),this.layers[d]=c,e.layers[d]=
f):(this.layers.splice(g,1),e.layers.splice(g,1),c=this._create(f,d,this.layers),this.layers.splice(d,0,c),e.layers.splice(d,0,f))}else c=this._create(f,d,this.layers),!d||d>=this.layers.length?(this.layers.push(c),e.layers.push(f)):(this.layers.splice(d,0,c),e.layers.splice(d,0,f));this._layerByName[f.id]=c;this._uidToLayer.set(c.uid,c);b&&this._recomputeZValues();this._identifyRefLayers()}}getStyleLayer(f){return(f=this._layerByName[f])?{type:f.typeName,id:f.id,source:f.source,"source-layer":f.sourceLayer,
minzoom:f.minzoom,maxzoom:f.maxzoom,filter:f.filter,layout:f.layout,paint:f.paint}:null}deleteStyleLayer(f){const d=this._layerByName[f];d&&(delete this._layerByName[f],this._uidToLayer.delete(d.uid),f=this.layers.indexOf(d),this.layers.splice(f,1),this._style.layers.splice(f,1),this._recomputeZValues(),this._identifyRefLayers())}getLayerById(f){return this._layerByName[f]}getLayoutProperties(f){return(f=this._layerByName[f])?f.layout:null}getPaintProperties(f){return(f=this._layerByName[f])?f.paint:
null}setPaintProperties(f,d){if(f=this._layerByName[f]){var e=A._recreateLayer({type:f.typeName,id:f.id,source:f.source,"source-layer":f.sourceLayer,minzoom:f.minzoom,maxzoom:f.maxzoom,filter:f.filter,layout:f.layout,paint:d},f),b=this.layers.indexOf(f);this.layers[b]=e;this._style.layers[b].paint=d;this._layerByName[f.id]=e;this._uidToLayer.set(f.uid,e)}}setLayoutProperties(f,d){if(f=this._layerByName[f]){var e=A._recreateLayer({type:f.typeName,id:f.id,source:f.source,"source-layer":f.sourceLayer,
minzoom:f.minzoom,maxzoom:f.maxzoom,filter:f.filter,layout:d,paint:f.paint},f),b=this.layers.indexOf(f);this.layers[b]=e;this._style.layers[b].layout=d;this._layerByName[f.id]=e;this._uidToLayer.set(f.uid,e)}}setStyleLayerVisibility(f,d){if(f=this._layerByName[f]){var e=f.layout||{};e.visibility=d;d=A._recreateLayer({type:f.typeName,id:f.id,source:f.source,"source-layer":f.sourceLayer,minzoom:f.minzoom,maxzoom:f.maxzoom,filter:f.filter,layout:e,paint:f.paint},f);var b=this.layers.indexOf(f);this.layers[b]=
d;this._style.layers[b].layout=e;this._layerByName[f.id]=d;this._uidToLayer.set(f.uid,d)}}getStyleLayerVisibility(f){return(f=this._layerByName[f])?f.layout?.visibility??"visible":"none"}_recomputeZValues(){const f=this.layers,d=1/(f.length+1);for(let e=0;e<f.length;e++)f[e].z=1-(1+e)*d}_identifyRefLayers(){const f=[],d=[];let e=0;for(const g of this.layers){const l=g.layout;if(g.type===u.StyleLayerType.FILL){var b=g,c=g.source+"|"+g.sourceLayer;c+="|"+(l?.visibility??"");c+="|"+g.minzoom;c+="|"+
g.maxzoom;c+="|"+JSON.stringify(g.filter);if(b.hasDataDrivenFill||b.hasDataDrivenOutline)c+="|"+e;f.push({key:c,layer:g})}else if(g.type===u.StyleLayerType.LINE){b=g;c=g.paint;c=null!=c&&(null!=c["line-pattern"]||null!=c["line-dasharray"]);let n=g.source+"|"+g.sourceLayer;n+="|"+(l?.visibility??"");n+="|"+g.minzoom;n+="|"+g.maxzoom;n+="|"+JSON.stringify(g.filter);n+="|"+(void 0!==l?l["line-cap"]:"");n+="|"+(void 0!==l?l["line-join"]:"");if(b.hasDataDrivenLine||c)n+="|"+e;d.push({key:n,layer:g})}++e}this._assignRefLayers(f);
this._assignRefLayers(d)}_assignRefLayers(f){f.sort((l,n)=>l.key<n.key?-1:l.key>n.key?1:0);let d,e;const b=f.length;for(let l=0;l<b;l++){const n=f[l];if(n.key===d)n.layer.refLayerId=e;else if(d=n.key,e=n.layer.id,n.layer.type===u.StyleLayerType.FILL){if(!n.layer.getPaintProperty("fill-outline-color"))for(var c=l+1;c<b;c++){var g=f[c];if(g.key===d){if(g.layer.getPaintProperty("fill-outline-color")){f[l]=g;f[c]=n;e=g.layer.id;break}}else break}}else if(n.layer.type===u.StyleLayerType.LINE)for(c=n.layer,
g=l+1;g<b;g++){const r=f[g];if(r.key!==d)break;const v=r.layer;if(c.canUseThinTessellation&&!v.canUseThinTessellation||!c.canUseThinTessellation&&(v.getPaintProperty("line-pattern")||v.getPaintProperty("line-dasharray")))c=v,f[l]=r,f[g]=n,e=r.layer.id}}}_create(f,d,e){d=1-1/(e.length+1)*(1+d);e=this._runningId++;switch(f.type){case "background":return new z.BackgroundStyleLayer(u.StyleLayerType.BACKGROUND,f,d,e);case "fill":return new z.FillStyleLayer(u.StyleLayerType.FILL,f,d,e);case "line":return new z.LineStyleLayer(u.StyleLayerType.LINE,
f,d,e);case "symbol":return new z.SymbolStyleLayer(u.StyleLayerType.SYMBOL,f,d,e);case "raster":console.warn(`Unsupported vector tile raster layer ${f.id}`);break;case "circle":return new z.CircleStyleLayer(u.StyleLayerType.CIRCLE,f,d,e)}return null}static _recreateLayer(f,d){switch(f.type){case "background":return new z.BackgroundStyleLayer(u.StyleLayerType.BACKGROUND,f,d.z,d.uid);case "fill":return new z.FillStyleLayer(u.StyleLayerType.FILL,f,d.z,d.uid);case "line":return new z.LineStyleLayer(u.StyleLayerType.LINE,
f,d.z,d.uid);case "symbol":return new z.SymbolStyleLayer(u.StyleLayerType.SYMBOL,f,d.z,d.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${f.id}`);break;case "circle":return new z.CircleStyleLayer(u.StyleLayerType.CIRCLE,f,d.z,d.uid)}return null}}return A})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../enums ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(u,z,A,f,d,e,b,c,g,l,n){u.CapType=void 0;(function(p){p[p.BUTT=0]="BUTT";p[p.ROUND=1]="ROUND";p[p.SQUARE=2]="SQUARE";p[p.UNKNOWN=4]="UNKNOWN"})(u.CapType||(u.CapType={}));class r{constructor(p,y,D,J){this.type=p;this.typeName=y.type;this.id=y.id;this.source=y.source;this.sourceLayer=y["source-layer"];this.minzoom=y.minzoom;this.maxzoom=y.maxzoom;this.filter=y.filter;this.layout=y.layout;this.paint=y.paint;this.z=D;this.uid=J;switch(p){case g.StyleLayerType.BACKGROUND:this._layoutDefinition=
g.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=g.StyleDefinition.backgroundPaintDefinition;break;case g.StyleLayerType.FILL:this._layoutDefinition=g.StyleDefinition.fillLayoutDefinition;this._paintDefinition=g.StyleDefinition.fillPaintDefinition;break;case g.StyleLayerType.LINE:this._layoutDefinition=g.StyleDefinition.lineLayoutDefinition;this._paintDefinition=g.StyleDefinition.linePaintDefinition;break;case g.StyleLayerType.SYMBOL:this._layoutDefinition=g.StyleDefinition.symbolLayoutDefinition;
this._paintDefinition=g.StyleDefinition.symbolPaintDefinition;break;case g.StyleLayerType.CIRCLE:this._layoutDefinition=g.StyleDefinition.circleLayoutDefinition,this._paintDefinition=g.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=c.createFilter(this.filter)}getLayoutProperty(p){return this._layoutProperties[p]}getPaintProperty(p){return this._paintProperties[p]}getLayoutValue(p,
y,D){let J;const M=this._layoutProperties[p];M&&(J=M.getValue(y,D));void 0===J&&(J=this._layoutDefinition[p]["default"]);return J}getPaintValue(p,y,D){let J;const M=this._paintProperties[p];M&&(J=M.getValue(y,D));void 0===J&&(J=this._paintDefinition[p]["default"]);return J}isPainterDataDriven(){const p=this._paintProperties;if(p)for(const y in p)if(p[y].isDataDriven)return!0;return!1}_parseLayout(p){const y={};for(const D in p){const J=this._layoutDefinition[D];J&&(y[D]=new l(J,p[D]))}return y}_parsePaint(p){const y=
{};for(const D in p){const J=this._paintDefinition[D];J&&(y[D]=new l(J,p[D]))}return y}computeAttributesKey(p,y,D,J){let M=0,F=0;for(const G of y){y=3;if(!G||G!==J){const {isLayout:E,isOptional:K}=D[G];y=E?this.getLayoutProperty(G):this.getPaintProperty(G);y=y?.interpolator?2:y?.isDataDriven?1:K&&!y?3:0}F|=y<<M;M+=2}return F<<3|p}}class v extends r{constructor(p,y,D,J){super(p,y,D,J);this.backgroundMaterial=new A.VTLBackgroundMaterial(this.computeAttributesKey(z.ShaderProgramType.BACKGROUND,A.VTLBackgroundMaterial.ATTRIBUTES,
A.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class k extends r{constructor(p,y,D,J){super(p,y,D,J);p=this.getPaintProperty("fill-color");y=this.getPaintProperty("fill-opacity");D=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=p?.isDataDriven;this.hasDataDrivenOpacity=y?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||D?.isDataDriven;y=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!y;this.hasDataDrivenOutlineColor=y?.isDataDriven;
this.hasDataDrivenOutline=y?y.isDataDriven:p?p.isDataDriven:!1;this.hasDataDrivenOutline=(y?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;this.fillMaterial=new d.VTLFillMaterial(this.computeAttributesKey(z.ShaderProgramType.FILL,d.VTLFillMaterial.ATTRIBUTES,d.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new d.VTLOutlineMaterial(this.computeAttributesKey(z.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?d.VTLOutlineMaterial.ATTRIBUTES_FILL:d.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,
this.outlineUsesFillColor?d.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:d.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}}class h extends r{constructor(p,y,D,J){super(p,y,D,J);p=this.getPaintProperty("line-pattern");this.lineMaterial=new e.VTLLineMaterial(this.computeAttributesKey(z.ShaderProgramType.LINE,e.VTLLineMaterial.ATTRIBUTES,e.VTLLineMaterial.ATTRIBUTES_INFO,p?"line-dasharray":""));this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||
this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&(p=this.getPaintProperty("line-width"),!p||"number"===typeof p&&.5*p<n.thinLineHalfWidthThreshold)&&
(p=this.getPaintProperty("line-offset"),!p||"number"===typeof p&&0===p)&&(this.canUseThinTessellation=!0)}getDashKey(p,y){switch(y){case u.CapType.BUTT:y="Butt";break;case u.CapType.ROUND:y="Round";break;case u.CapType.SQUARE:y="Square";break;default:y="Butt"}return`dasharray-[${p.toString()}]-${y}`}}class t extends r{constructor(p,y,D,J){super(p,y,D,J);this.iconMaterial=new b.VTLIconMaterial(this.computeAttributesKey(z.ShaderProgramType.ICON,b.VTLIconMaterial.ATTRIBUTES,b.VTLIconMaterial.ATTRIBUTES_INFO));
this.textMaterial=new b.VTLTextMaterial(this.computeAttributesKey(z.ShaderProgramType.TEXT,b.VTLTextMaterial.ATTRIBUTES,b.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=
this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class m extends r{constructor(p,y,D,J){super(p,y,D,J);this.circleMaterial=new f.VTLCircleMaterial(this.computeAttributesKey(z.ShaderProgramType.CIRCLE,f.VTLCircleMaterial.ATTRIBUTES,
f.VTLCircleMaterial.ATTRIBUTES_INFO))}}class x{constructor(p,y,D){this.allowOverlap=p.getLayoutValue("icon-allow-overlap",y);this.ignorePlacement=p.getLayoutValue("icon-ignore-placement",y);this.keepUpright=p.getLayoutValue("icon-keep-upright",y);this.optional=p.getLayoutValue("icon-optional",y);this.rotationAlignment=p.getLayoutValue("icon-rotation-alignment",y);this.rotationAlignment===g.RotationAlignment.AUTO&&(this.rotationAlignment=D?g.RotationAlignment.MAP:g.RotationAlignment.VIEWPORT);D=p.getLayoutProperty("icon-anchor");
D?.isDataDriven?this._anchorProp=D:this.anchor=p.getLayoutValue("icon-anchor",y);D=p.getLayoutProperty("icon-offset");D?.isDataDriven?this._offsetProp=D:this.offset=p.getLayoutValue("icon-offset",y);D=p.getLayoutProperty("icon-padding");D?.isDataDriven?this._paddingProp=D:this.padding=p.getLayoutValue("icon-padding",y);D=p.getLayoutProperty("icon-rotate");D?.isDataDriven?this._rotateProp=D:this.rotate=p.getLayoutValue("icon-rotate",y);D=p.getLayoutProperty("icon-size");D?.isDataDriven?this._sizeProp=
D:this.size=p.getLayoutValue("icon-size",y)}update(p,y){this._anchorProp&&(this.anchor=this._anchorProp.getValue(p,y));this._offsetProp&&(this.offset=this._offsetProp.getValue(p,y));this._paddingProp&&(this.padding=this._paddingProp.getValue(p,y));this._rotateProp&&(this.rotate=this._rotateProp.getValue(p,y));this._sizeProp&&(this.size=this._sizeProp.getValue(p,y))}}class B{constructor(p,y,D){this.allowOverlap=p.getLayoutValue("text-allow-overlap",y);this.ignorePlacement=p.getLayoutValue("text-ignore-placement",
y);this.keepUpright=p.getLayoutValue("text-keep-upright",y);this.optional=p.getLayoutValue("text-optional",y);this.rotationAlignment=p.getLayoutValue("text-rotation-alignment",y);this.rotationAlignment===g.RotationAlignment.AUTO&&(this.rotationAlignment=D?g.RotationAlignment.MAP:g.RotationAlignment.VIEWPORT);D=p.getLayoutProperty("text-anchor");D?.isDataDriven?this._anchorProp=D:this.anchor=p.getLayoutValue("text-anchor",y);D=p.getLayoutProperty("text-justify");D?.isDataDriven?this._justifyProp=D:
this.justify=p.getLayoutValue("text-justify",y);D=p.getLayoutProperty("text-letter-spacing");D?.isDataDriven?this._letterSpacingProp=D:this.letterSpacing=p.getLayoutValue("text-letter-spacing",y);D=p.getLayoutProperty("text-line-height");D?.isDataDriven?this._lineHeightProp=D:this.lineHeight=p.getLayoutValue("text-line-height",y);D=p.getLayoutProperty("text-max-angle");D?.isDataDriven?this._maxAngleProp=D:this.maxAngle=p.getLayoutValue("text-max-angle",y);D=p.getLayoutProperty("text-max-width");D?.isDataDriven?
this._maxWidthProp=D:this.maxWidth=p.getLayoutValue("text-max-width",y);D=p.getLayoutProperty("text-offset");D?.isDataDriven?this._offsetProp=D:this.offset=p.getLayoutValue("text-offset",y);D=p.getLayoutProperty("text-padding");D?.isDataDriven?this._paddingProp=D:this.padding=p.getLayoutValue("text-padding",y);D=p.getLayoutProperty("text-rotate");D?.isDataDriven?this._rotateProp=D:this.rotate=p.getLayoutValue("text-rotate",y);D=p.getLayoutProperty("text-size");D?.isDataDriven?this._sizeProp=D:this.size=
p.getLayoutValue("text-size",y);D=p.getLayoutProperty("text-writing-mode");D?.isDataDriven?this._writingModeProp=D:this.writingMode=p.getLayoutValue("text-writing-mode",y)}update(p,y){this._anchorProp&&(this.anchor=this._anchorProp.getValue(p,y));this._justifyProp&&(this.justify=this._justifyProp.getValue(p,y));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(p,y));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(p,y));this._maxAngleProp&&(this.maxAngle=
this._maxAngleProp.getValue(p,y));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(p,y));this._offsetProp&&(this.offset=this._offsetProp.getValue(p,y));this._paddingProp&&(this.padding=this._paddingProp.getValue(p,y));this._rotateProp&&(this.rotate=this._rotateProp.getValue(p,y));this._sizeProp&&(this.size=this._sizeProp.getValue(p,y));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(p,y))}}u.BackgroundStyleLayer=v;u.CircleStyleLayer=m;u.FillStyleLayer=k;u.IconLayout=
x;u.LineStyleLayer=h;u.StyleLayer=r;u.SymbolStyleLayer=t;u.TextLayout=B;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(u,z,A,f){class d extends z.VTLMaterial{constructor(e){super(e)}geometryInfo(){return d.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return d.ATTRIBUTES}attributesInfo(){return d.ATTRIBUTES_INFO}}
d.ATTRIBUTES=[];d.GEOMETRY_LAYOUT=[new f.VertexElementDescriptor("a_pos",2,A.DataType.BYTE,0,2)];d.ATTRIBUTES_INFO={};u.VTLBackgroundMaterial=d;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../MemoryBuffer","./enums","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(u,z,A,f,d){class e{constructor(g){this._locations=new Map;this._key=g}get key(){return this._key}get type(){return this._key&
7}defines(){return[]}getStride(){this._layoutInfo||this._buildAttributesInfo();return this._stride}getAttributeLocations(){0===this._locations.size&&this._buildAttributesInfo();return this._locations}getLayoutInfo(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo}getEncodingInfos(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo}getUniforms(){this._uniforms||this._buildAttributesInfo();return this._uniforms}getShaderHeader(){this._shaderHeader||
this._buildAttributesInfo();return this._shaderHeader}getShaderMain(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain}setDataUniforms(g,l,n,r,v){var k=this.getUniforms();for(const h of k){const {name:t,type:m,getValue:x}=h;k=x(n,l,r,v);if(null!==k)switch(m){case "float":g.setUniform1f(t,k);break;case "vec2":g.setUniform2fv(t,k);break;case "vec4":g.setUniform4fv(t,k)}}}encodeAttributes(g,l,n,r){const v=this.attributesInfo(),k=this.getEncodingInfos(),h=[];let t=0,m=0;for(const B of Object.keys(k)){var x=
k[B];const {type:p,precisionFactor:y,isLayout:D}=v[B],J=D?n.getLayoutProperty(B):n.getPaintProperty(B),M=J.interpolator?.getInterpolationRange(l);let F=0;for(const G of x){const {offset:E,bufferElementsToAdd:K}=G;if(0<K){for(x=0;x<K;x++)h.push(0);t+=m;m=G.bufferElementsToAdd}x=r??J.getValue(M?M[F]:l,g);switch(p){case A.EncodingType.R8_SIGNED:case A.EncodingType.R8_UNSIGNED:h[t]|=this._encodeByte(x*(y||1),8*E);break;case A.EncodingType.R16_SIGNED:case A.EncodingType.R16_UNSIGNED:h[t]|=this._encodeShort(x*
(y||1),8*E);break;case A.EncodingType.R8G8_SIGNED:case A.EncodingType.R8G8_UNSIGNED:h[t]|=this._encodeByte(x*(y||1),8*E);h[t]|=this._encodeByte(x*(y||1),8*E+8);break;case A.EncodingType.R16G16_SIGNED:case A.EncodingType.R16G16_UNSIGNED:h[t]|=this._encodeShort(x*(y||1),8*E);h[t]|=this._encodeShort(x*(y||1),8*E+16);break;case A.EncodingType.R8G8B8A8_SIGNED:case A.EncodingType.R8G8B8A8_UNSIGNED:h[t]|=this._encodeByte(x*(y||1),8*E);h[t]|=this._encodeByte(x*(y||1),8*E+8);h[t]|=this._encodeByte(x*(y||1),
8*E+16);h[t]|=this._encodeByte(x*(y||1),8*E+24);break;case A.EncodingType.R8G8B8A8_COLOR:h[t]=this._encodeColor(x);break;case A.EncodingType.R16G16B16A16_DASHARRAY:case A.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(t,h,x);break;default:throw Error("Unsupported encoding type");}F++}}return h}getAtributeState(g){const l=3+2*g;g=0|this._bit(l);return g|=this._bit(l+1)<<1}_buildAttributesInfo(){const g=[],l={};var n={},r=-1;const v=this.attributesInfo();var k=this.attributes();let h=-1;for(const B of k){h++;
k=this.getAtributeState(h);if(k===A.AttributeStatus.UNIFORM||k===A.AttributeStatus.UNUSED)continue;var t=v[B];const p=[];l[B]=p;t=t.type;for(let y=0;y<k;y++){const {dataType:D,bytesPerElement:J,count:M,normalized:F}=e._encodingInfo[t],G=J*M;var m=`${D}-${!0===F}`;let E=n[m],K=0;!E||4<E.count+M?(r++,E={dataIndex:r,count:0,offset:0},4!==M&&(n[m]=E),g.push({location:-1,name:"a_data_"+r,count:M,type:D,normalized:F}),K=Math.ceil(Math.max(G/4,1))):(m=g[E.dataIndex],m.count+=M,K=Math.ceil(Math.max(m.count*
J/4,1))-Math.ceil(Math.max(E.offset/4,1)));p.push({dataIndex:E.dataIndex,offset:E.offset,bufferElementsToAdd:K});E.offset+=G;E.count+=M}}for(const B of g)switch(B.type){case f.DataType.BYTE:case f.DataType.UNSIGNED_BYTE:B.count=4;break;case f.DataType.SHORT:case f.DataType.UNSIGNED_SHORT:B.count+=B.count%2}this._buildVertexBufferLayout(g);n=0;r=this._layoutInfo.geometry;for(var x of r)this._locations.set(x.name,n++);if(x=this._layoutInfo.opacity)for(const B of x)this._locations.set(B.name,n++);this._buildShaderInfo(g,
l);this._propertyEncodingInfo=l}_buildVertexBufferLayout(g){const l={},n=this.geometryInfo();let r=n[0].stride;if(0===g.length)l.geometry=n;else{const v=[];let k=r;for(const h of g)r+=b(h.type)*h.count;for(const h of n)v.push(new d.VertexElementDescriptor(h.name,h.count,h.type,h.offset,r,h.normalized));for(const h of g)v.push(new d.VertexElementDescriptor(h.name,h.count,h.type,k,r,h.normalized)),k+=b(h.type)*h.count;l.geometry=v}this.opacityInfo()&&(l.opacity=this.opacityInfo());this._layoutInfo=
l;this._stride=r}_buildShaderInfo(g,l){let n="\n",r="\n";const v=[];for(var k of g)n+=`attribute ${this._getType(k.count)} ${k.name};\n`;var h=this.attributes();g=this.attributesInfo();k=-1;for(const x of h){k++;const {name:B,type:p,precisionFactor:y,isLayout:D}=g[x];h=y&&1!==y?` * ${1/y}`:"";const {bytesPerElement:J,count:M}=e._encodingInfo[p];var t=F=>`a_data_${F.dataIndex}${c(M,F.offset,J)}`;switch(this.getAtributeState(k)){case A.AttributeStatus.UNIFORM:h=this._getType(M);var m=`u_${B}`;v.push({name:m,
type:h,getValue:(G,E,K,N)=>{K=D?G.getLayoutValue(x,E):G.getPaintValue(x,E);if(p===A.EncodingType.R16G16B16A16_DASHARRAY){G=G.getDashKey(K,G.getLayoutValue("line-cap",E));N=N.getMosaicItemPosition(G,!1);if(null==N)return null;const {tl:O,br:R}=N;return[O[0],R[1],R[0],O[1]]}if(p===A.EncodingType.R16G16B16A16_PATTERN){N=N.getMosaicItemPosition(K,!x.includes("line-"));if(null==N)return null;const {tl:O,br:R}=N;return[O[0],R[1],R[0],O[1]]}return p===A.EncodingType.R8G8B8A8_COLOR?(N=K[3],[N*K[0],N*K[1],
N*K[2],N]):K}});n+=`uniform ${h} ${m};\n`;r+=`${h} ${B} = ${m};\n`;break;case A.AttributeStatus.DATA_DRIVEN:m=t(l[x][0]);r+=`${this._getType(M)} ${B} = ${m}${h};\n`;break;case A.AttributeStatus.INTERPOLATED_DATA_DRIVEN:m=`u_t_${B}`;v.push({name:m,type:"float",getValue:(G,E,K,N)=>(D?G.getLayoutProperty(x):G.getPaintProperty(x)).interpolator.interpolationUniformValue(K,E)});n+=`uniform float ${m};\n`;const F=t(l[x][0]);t=t(l[x][1]);r+=`${this._getType(M)} ${B} = mix(${F}${h}, ${t}${h}, ${m});\n`}}this._shaderHeader=
n;this._shaderMain=r;this._uniforms=v}_bit(g){return(this._key&1<<g)>>g}_getType(g){switch(g){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");}_encodeColor(g){const l=255*g[3];return z.i8888to32(g[0]*l,g[1]*l,g[2]*l,l)}_encodePattern(g,l,n){if(n?.rect){var r=n.rect,v=n.width;n=n.height;l[g]=this._encodeShort(r.x+2,0);l[g]|=this._encodeShort(r.y+2+n,16);l[g+1]=this._encodeShort(r.x+2+v,0);l[g+1]|=this._encodeShort(r.y+2,16)}}_encodeByte(g,
l){return(g&255)<<l}_encodeShort(g,l){return(g&65535)<<l}}e._encodingInfo={[A.EncodingType.R8_SIGNED]:{dataType:f.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[A.EncodingType.R8_UNSIGNED]:{dataType:f.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[A.EncodingType.R16_SIGNED]:{dataType:f.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[A.EncodingType.R16_UNSIGNED]:{dataType:f.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[A.EncodingType.R8G8_SIGNED]:{dataType:f.DataType.BYTE,
bytesPerElement:1,count:2,normalized:!1},[A.EncodingType.R8G8_UNSIGNED]:{dataType:f.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[A.EncodingType.R16G16_SIGNED]:{dataType:f.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[A.EncodingType.R16G16_UNSIGNED]:{dataType:f.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[A.EncodingType.R8G8B8A8_SIGNED]:{dataType:f.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[A.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:f.DataType.UNSIGNED_BYTE,
bytesPerElement:1,count:4,normalized:!1},[A.EncodingType.R8G8B8A8_COLOR]:{dataType:f.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[A.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:f.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[A.EncodingType.R16G16B16A16_PATTERN]:{dataType:f.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const b=g=>{switch(g){case f.DataType.FLOAT:return 4;case f.DataType.INT:return 4;case f.DataType.UNSIGNED_INT:return 4;
case f.DataType.SHORT:return 2;case f.DataType.UNSIGNED_SHORT:return 2;case f.DataType.BYTE:return 1;case f.DataType.UNSIGNED_BYTE:return 1}},c=(g,l,n)=>{l/=n;if(1===g)switch(l){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===g)switch(l){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===g)switch(l){case 0:return".xyz";case 1:return".yzw"}return""};u.VTLMaterial=e;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(function(){class u{constructor(z){this._array=
[];0>=z&&console.error("strideInBytes must be positive!");this._stride=z}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return(new Uint32Array(this._array)).buffer}static i1616to32(z,A){return 65535&z|A<<16}static i8888to32(z,A,f,d){return z&255|(A&255)<<8|(f&255)<<16|d<<24}static i8816to32(z,A,f){return z&255|(A&255)<<8|f<<16}}return u})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],
function(u){u.EncodingType=void 0;(function(z){z[z.R8_SIGNED=0]="R8_SIGNED";z[z.R8_UNSIGNED=1]="R8_UNSIGNED";z[z.R16_SIGNED=2]="R16_SIGNED";z[z.R16_UNSIGNED=3]="R16_UNSIGNED";z[z.R8G8_SIGNED=4]="R8G8_SIGNED";z[z.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";z[z.R16G16_SIGNED=6]="R16G16_SIGNED";z[z.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";z[z.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";z[z.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";z[z.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";z[z.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";
z[z.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(u.EncodingType||(u.EncodingType={}));u.AttributeStatus=void 0;(function(z){z[z.UNIFORM=0]="UNIFORM";z[z.DATA_DRIVEN=1]="DATA_DRIVEN";z[z.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";z[z.UNUSED=3]="UNUSED"})(u.AttributeStatus||(u.AttributeStatus={}));Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums",
"../../../../webgl/VertexElementDescriptor"],function(u,z,A,f,d){class e extends A.VTLMaterial{constructor(b){super(b)}geometryInfo(){return e.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return e.ATTRIBUTES}attributesInfo(){return e.ATTRIBUTES_INFO}}e.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");e.GEOMETRY_LAYOUT=[new d.VertexElementDescriptor("a_pos",2,f.DataType.SHORT,0,4)];e.ATTRIBUTES_INFO=
{"circle-radius":{name:"radius",type:z.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",
type:z.EncodingType.R8_UNSIGNED,precisionFactor:32}};u.VTLCircleMaterial=e;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(u,z,A,f,d){class e extends A.VTLMaterial{constructor(c){super(c)}geometryInfo(){return e.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return e.ATTRIBUTES}attributesInfo(){return e.ATTRIBUTES_INFO}}
e.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];e.GEOMETRY_LAYOUT=[new d.VertexElementDescriptor("a_pos",2,f.DataType.SHORT,0,4)];e.ATTRIBUTES_INFO={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};class b extends A.VTLMaterial{constructor(c,g){super(c);this._usefillColor=g}geometryInfo(){return b.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?
b.ATTRIBUTES_FILL:b.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?b.ATTRIBUTES_INFO_FILL:b.ATTRIBUTES_INFO_OUTLINE}}b.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];b.ATTRIBUTES_FILL=["fill-color","fill-opacity"];b.GEOMETRY_LAYOUT=[new d.VertexElementDescriptor("a_pos",2,f.DataType.SHORT,0,8),new d.VertexElementDescriptor("a_offset",2,f.DataType.BYTE,4,8),new d.VertexElementDescriptor("a_xnormal",2,f.DataType.BYTE,6,8)];b.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",
type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};b.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};u.VTLFillMaterial=e;u.VTLOutlineMaterial=b;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./enums","./VTLMaterial",
"../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(u,z,A,f,d){class e extends A.VTLMaterial{constructor(b){super(b)}geometryInfo(){return e.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return e.ATTRIBUTES}attributesInfo(){return e.ATTRIBUTES_INFO}}e.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");e.GEOMETRY_LAYOUT=[new d.VertexElementDescriptor("a_pos",2,f.DataType.SHORT,0,16),new d.VertexElementDescriptor("a_extrude_offset",
4,f.DataType.BYTE,4,16),new d.VertexElementDescriptor("a_dir_normal",4,f.DataType.BYTE,8,16),new d.VertexElementDescriptor("a_accumulatedDistance",2,f.DataType.UNSIGNED_SHORT,12,16)];e.ATTRIBUTES_INFO={"line-width":{name:"width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:z.EncodingType.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},
"line-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:z.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};u.VTLLineMaterial=e;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports",
"./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(u,z,A,f,d){const e=[new d.VertexElementDescriptor("a_pos",2,f.DataType.SHORT,0,16),new d.VertexElementDescriptor("a_vertexOffset",2,f.DataType.SHORT,4,16),new d.VertexElementDescriptor("a_texAngleRange",4,f.DataType.UNSIGNED_BYTE,8,16),new d.VertexElementDescriptor("a_levelInfo",4,f.DataType.UNSIGNED_BYTE,12,16)],b=[new d.VertexElementDescriptor("a_opacityInfo",1,f.DataType.UNSIGNED_BYTE,0,1)];
class c extends A.VTLMaterial{constructor(l){super(l)}geometryInfo(){return e}opacityInfo(){return b}attributes(){return c.ATTRIBUTES}attributesInfo(){return c.ATTRIBUTES_INFO}}c.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");c.ATTRIBUTES_INFO={"icon-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},
"icon-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class g extends A.VTLMaterial{constructor(l){super(l)}geometryInfo(){return e}opacityInfo(){return b}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}g.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");
g.ATTRIBUTES_INFO={"text-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,isLayout:!0}};u.VTLIconMaterial=
c;u.VTLTextMaterial=g;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(u,z){class A{constructor(f){this._expression=f}filter(f,d){if(!this._expression)return!0;try{return this._expression.evaluate(f,d)}catch(e){return console.log(e.message),!0}}static createFilter(f){if(!f)return null;this.isLegacyFilter(f)&&(f=this.convertLegacyFilter(f));try{const d=u.createExpression(f,
null,z.BooleanType);return new A(d)}catch(d){return console.log(d.message),null}}static isLegacyFilter(f){if(!Array.isArray(f)||0===f.length)return!0;switch(f[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===f.length&&"string"===typeof f[1]&&!Array.isArray(f[2]);case "in":return 3<=f.length&&"string"===typeof f[1]&&!Array.isArray(f[2]);case "!in":return!0;case "any":case "all":for(let d=1;d<f.length;d++)if(this.isLegacyFilter(f[d]))return!0;return!1;
case "none":return!0;case "has":return 2===f.length&&("$id"===f[1]||"$type"===f[1]);case "!has":return!0;default:return!1}}static convertLegacyFilter(f){if(!Array.isArray(f)||0===f.length)return!0;const d=f[0];if(1===f.length)return"any"!==d;switch(d){case "\x3d\x3d":return A.convertComparison("\x3d\x3d",f[1],f[2]);case "!\x3d":return A.negate(A.convertComparison("\x3d\x3d",f[1],f[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return A.convertComparison(d,f[1],f[2]);case "in":return A.convertIn(f[1],
f.slice(2));case "!in":return A.negate(A.convertIn(f[1],f.slice(2)));case "any":case "all":case "none":return A.convertCombining(d,f.slice(1));case "has":return A.convertHas(f[1]);case "!has":return A.negate(A.convertHas(f[1]));default:throw Error("Unexpected legacy filter.");}}static convertComparison(f,d,e){switch(d){case "$type":return[f,["geometry-type"],e];case "$id":return[f,["id"],e];default:return[f,["get",d],e]}}static convertIn(f,d){switch(f){case "$type":return["in",["geometry-type"],["literal",
d]];case "$id":return["in",["id"],["literal",d]];default:return["in",["get",f],["literal",d]]}}static convertHas(f){switch(f){case "$type":return!0;case "$id":return["has-id"];default:return["has",f]}}static convertCombining(f,d){return[f].concat(d.map(this.convertLegacyFilter))}static negate(f){return["!",f]}}return A})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../Color ../../../../../core/colorUtils ../../../../../geometry/support/TileClipper ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(u,z,A,f,d,e,b){function c(a,q,w){var C=typeof a;if("string"===C||"boolean"===C||"number"===C||null===a){if(w)switch(w.kind){case "string":"string"!==C&&(a=W.toString(a));break;case "number":"number"!==C&&(a=W.toNumber(a));break;case "color":a=W.toColor(a)}a=["literal",a]}if(!Array.isArray(a)||0===a.length)throw Error("Expression must be a non empty array");C=a[0];if("string"!==typeof C)throw Error("First element of expression must be a string");const H=na[C];if(void 0===H)throw Error(`Invalid expression operator "${C}"`);
if(!H)throw Error(`Unimplemented expression operator "${C}"`);return H.parse(a,q,w)}class g{constructor(a){this._parent=a;this._vars={}}add(a,q){this._vars[a]=q}get(a){return this._vars[a]?this._vars[a]:this._parent?this._parent.get(a):null}}class l{constructor(){this.type=b.ValueType}static parse(a){if(1<a.length)throw Error('"id" does not expect arguments');return new l}evaluate(a,q){return a?.id}}class n{constructor(){this.type=b.StringType}static parse(a){if(1<a.length)throw Error('"geometry-type" does not expect arguments');
return new n}evaluate(a,q){if(!a)return null;switch(a.type){case f.GeometryType.Point:return"Point";case f.GeometryType.LineString:return"LineString";case f.GeometryType.Polygon:return"Polygon";default:return null}}}class r{constructor(){this.type=b.ObjectType}static parse(a){if(1<a.length)throw Error('"properties" does not expect arguments');return new r}evaluate(a,q){return a?.values}}class v{constructor(){this.type=b.NumberType}static parse(a){if(1<a.length)throw Error('"zoom" does not expect arguments');
return new v}evaluate(a,q){return q}}class k{constructor(a,q,w){this._lhs=a;this._rhs=q;this._compare=w;this.type=b.BooleanType}static parse(a,q,w){if(3!==a.length&&4!==a.length)throw Error(`"${a[0]}" expects 2 or 3 arguments`);if(4===a.length)throw Error(`"${a[0]}" collator not supported`);return new k(c(a[1],q),c(a[2],q),w)}evaluate(a,q){return this._compare(this._lhs.evaluate(a,q),this._rhs.evaluate(a,q))}}class h extends k{static parse(a,q){return k.parse(a,q,(w,C)=>w===C)}}class t extends k{static parse(a,
q){return k.parse(a,q,(w,C)=>w!==C)}}class m extends k{static parse(a,q){return k.parse(a,q,(w,C)=>w<C)}}class x extends k{static parse(a,q){return k.parse(a,q,(w,C)=>w<=C)}}class B extends k{static parse(a,q){return k.parse(a,q,(w,C)=>w>C)}}class p extends k{static parse(a,q){return k.parse(a,q,(w,C)=>w>=C)}}class y{constructor(a){this._arg=a;this.type=b.BooleanType}static parse(a,q){if(2!==a.length)throw Error('"!" expects 1 argument');return new y(c(a[1],q))}evaluate(a,q){return!this._arg.evaluate(a,
q)}}class D{constructor(a){this._args=a;this.type=b.BooleanType}static parse(a,q){const w=[];for(let C=1;C<a.length;C++)w.push(c(a[C],q));return new D(w)}evaluate(a,q){for(const w of this._args)if(!w.evaluate(a,q))return!1;return!0}}class J{constructor(a){this._args=a;this.type=b.BooleanType}static parse(a,q){const w=[];for(let C=1;C<a.length;C++)w.push(c(a[C],q));return new J(w)}evaluate(a,q){for(const w of this._args)if(w.evaluate(a,q))return!0;return!1}}class M{constructor(a){this._args=a;this.type=
b.BooleanType}static parse(a,q){const w=[];for(let C=1;C<a.length;C++)w.push(c(a[C],q));return new M(w)}evaluate(a,q){for(const w of this._args)if(w.evaluate(a,q))return!1;return!0}}class F{constructor(a,q,w){this.type=a;this._args=q;this._fallback=w}static parse(a,q,w){if(4>a.length)throw Error('"case" expects at least 3 arguments');if(1===a.length%2)throw Error('"case" expects an odd number of arguments');let C;const H=[];for(let L=1;L<a.length-1;L+=2){const Q=c(a[L],q),P=c(a[L+1],q,w);C||(C=P.type);
H.push({condition:Q,output:P})}a=c(a[a.length-1],q,w);C||(C=a.type);return new F(C,H,a)}evaluate(a,q){for(const w of this._args)if(w.condition.evaluate(a,q))return w.output.evaluate(a,q);return this._fallback.evaluate(a,q)}}class G{constructor(a,q){this.type=a;this._args=q}static parse(a,q){if(2>a.length)throw Error('"coalesce" expects at least 1 argument');let w;const C=[];for(let H=1;H<a.length;H++){const L=c(a[H],q);w||(w=L.type);C.push(L)}return new G(w,C)}evaluate(a,q){for(const w of this._args){const C=
w.evaluate(a,q);if(null!==C)return C}return null}}class E{constructor(a,q,w,C,H){this.type=a;this._input=q;this._labels=w;this._outputs=C;this._fallback=H}static parse(a,q){if(3>a.length)throw Error('"match" expects at least 3 arguments');if(0===a.length%2)throw Error('"case" expects an even number of arguments');let w;const C=c(a[1],q),H=[],L={};let Q;for(let Y=2;Y<a.length-1;Y+=2){var P=a[Y];Array.isArray(P)||(P=[P]);for(const fa of P){P=typeof fa;if("string"!==P&&"number"!==P)throw Error('"match" requires string or number literal as labels');
if(!Q)Q=P;else if(P!==Q)throw Error('"match" requires labels to have the same type');L[fa]=H.length}P=c(a[Y+1],q);w||(w=P.type);H.push(P)}return new E(w,C,L,H,c(a[a.length-1],q))}evaluate(a,q){const w=this._input.evaluate(a,q);return(this._outputs[this._labels[w]]||this._fallback).evaluate(a,q)}}class K{constructor(a,q,w,C,H){this._operator=a;this.type=q;this.interpolation=w;this.input=C;this._stops=H}static parse(a,q,w){const C=a[0];if(5>a.length)throw Error(`"${C}" expects at least 4 arguments`);
const H=a[1];if(!Array.isArray(H)||0===H.length)throw Error(`"${H}" is not a valid interpolation`);switch(H[0]){case "linear":if(1!==H.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==H.length||"number"!==typeof H[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==H.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var L=1;5>L;L++){var Q=
H[L];if("number"!==typeof Q||0>Q||1<Q)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${a[0]}" unknown interpolation type "${H[0]}"`);}if(1!==a.length%2)throw Error(`"${C}" expects an even number of arguments`);L=c(a[2],q,b.NumberType);let P;"interpolate-hcl"===C||"interpolate-lab"===C?P=b.ColorType:w&&"value"!==w.kind&&(P=w);w=[];for(Q=3;Q<a.length;Q+=2){const Y=a[Q];if("number"!==typeof Y)throw Error(`"${C}" requires stop inputs as literal numbers`);
if(w.length&&w[w.length-1][0]>=Y)throw Error(`"${C}" requires strictly ascending stop inputs`);const fa=c(a[Q+1],q,P);P||(P=fa.type);w.push([Y,fa])}if(P&&P!==b.ColorType&&P!==b.NumberType&&("array"!==P.kind||P.itemType!==b.NumberType))throw Error(`"${C}" cannot interpolate type ${b.typeToString(P)}`);return new K(C,P,H,L,w)}evaluate(a,q){var w=this._stops;if(1===w.length)return w[0][1].evaluate(a,q);var C=this.input.evaluate(a,q);if(C<=w[0][0])return w[0][1].evaluate(a,q);if(C>=w[w.length-1][0])return w[w.length-
1][1].evaluate(a,q);let H=0;for(;++H<w.length&&!(C<w[H][0]););const L=K.interpolationRatio(this.interpolation,C,w[H-1][0],w[H][0]);C=w[H-1][1].evaluate(a,q);const Q=w[H][1].evaluate(a,q);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(C)&&Array.isArray(Q))return C.map((P,Y)=>e.interpolate(P,Q[Y],L));if("color"===this.type.kind&&C instanceof z&&Q instanceof z)return C=new z(C),a=new z(Q),new z([e.interpolate(C.r,a.r,L),e.interpolate(C.g,a.g,L),e.interpolate(C.b,a.b,L),
e.interpolate(C.a,a.a,L)]);if("number"===this.type.kind&&"number"===typeof C&&"number"===typeof Q)return e.interpolate(C,Q,L);throw Error(`"${this._operator}" cannot interpolate type ${b.typeToString(this.type)}`);}if("interpolate-hcl"===this._operator)return a=A.toLCH(C),q=A.toLCH(Q),w=q.h-a.h,a=A.toRGB({h:a.h+L*(180<w||-180>w?w-360*Math.round(w/360):w),c:e.interpolate(a.c,q.c,L),l:e.interpolate(a.l,q.l,L)}),new z({a:e.interpolate(C.a,Q.a,L),...a});if("interpolate-lab"===this._operator)return a=
A.toLAB(C),q=A.toLAB(Q),a=A.toRGB({l:e.interpolate(a.l,q.l,L),a:e.interpolate(a.a,q.a,L),b:e.interpolate(a.b,q.b,L)}),new z({a:e.interpolate(C.a,Q.a,L),...a});throw Error(`Unexpected operator "${this._operator}"`);}interpolationUniformValue(a,q){const w=this._stops;if(1===w.length||a>=w[w.length-1][0])return 0;let C=0;for(;++C<w.length&&!(a<w[C][0]););return K.interpolationRatio(this.interpolation,q,w[C-1][0],w[C][0])}getInterpolationRange(a){const q=this._stops;if(1===q.length)return a=q[0][0],[a,
a];var w=q[q.length-1][0];if(a>=w)return[w,w];for(w=0;++w<q.length&&!(a<q[w][0]););return[q[w-1][0],q[w][0]]}static interpolationRatio(a,q,w,C){let H=0;"linear"===a[0]?H=K._exponentialInterpolationRatio(q,1,w,C):"exponential"===a[0]?H=K._exponentialInterpolationRatio(q,a[1],w,C):"cubic-bezier"===a[0]&&(H=d.unitBezier(a[1],a[2],a[3],a[4])(K._exponentialInterpolationRatio(q,1,w,C),1E-5));0>H?H=0:1<H&&(H=1);return H}static _exponentialInterpolationRatio(a,q,w,C){C-=w;if(0===C)return 0;a-=w;return 1===
q?a/C:(q**a-1)/(q**C-1)}}class N{constructor(a,q,w){this.type=a;this._input=q;this._stops=w}static parse(a,q){if(5>a.length)throw Error('"step" expects at least 4 arguments');if(1!==a.length%2)throw Error('"step" expects an even number of arguments');const w=c(a[1],q,b.NumberType);let C;const H=[];H.push([-Infinity,c(a[2],q)]);for(let L=3;L<a.length;L+=2){const Q=a[L];if("number"!==typeof Q)throw Error('"step" requires stop inputs as literal numbers');if(H.length&&H[H.length-1][0]>=Q)throw Error('"step" requires strictly ascending stop inputs');
const P=c(a[L+1],q);C||(C=P.type);H.push([Q,P])}return new N(C,w,H)}evaluate(a,q){const w=this._stops;if(1===w.length)return w[0][1].evaluate(a,q);const C=this._input.evaluate(a,q);let H=0;for(;++H<w.length&&!(C<w[H][0]););return this._stops[H-1][1].evaluate(a,q)}}class O{constructor(a,q){this.type=a;this._output=q}static parse(a,q,w){if(4>a.length)throw Error('"let" expects at least 3 arguments');if(1===a.length%2)throw Error('"let" expects an odd number of arguments');const C=new g(q);for(let H=
1;H<a.length-1;H+=2){const L=a[H];if("string"!==typeof L)throw Error(`"let" requires a string to define variable names - found ${L}`);C.add(L,c(a[H+1],q))}a=c(a[a.length-1],C,w);return new O(a.type,a)}evaluate(a,q){return this._output.evaluate(a,q)}}class R{constructor(a,q){this.type=a;this.output=q}static parse(a,q,w){if(2!==a.length||"string"!==typeof a[1])throw Error('"var" requires just one literal string argument');q=q.get(a[1]);if(!q)throw Error(`${a[1]} must be defined before being used in a "var" expression`);
return new R(w||b.ValueType,q)}evaluate(a,q){return this.output.evaluate(a,q)}}class I{constructor(a,q,w){this.type=a;this._index=q;this._array=w}static parse(a,q){if(3!==a.length)throw Error('"at" expects 2 arguments');const w=c(a[1],q,b.NumberType);a=c(a[2],q);return new I(a.type.itemType,w,a)}evaluate(a,q){const w=this._index.evaluate(a,q);a=this._array.evaluate(a,q);if(0>w||w>=a.length)throw Error('"at" index out of bounds');if(w!==Math.floor(w))throw Error('"at" index must be an integer');return a[w]}}
class T{constructor(a,q){this._key=a;this._obj=q;this.type=b.ValueType}static parse(a,q){let w;switch(a.length){case 2:return w=c(a[1],q),new T(w);case 3:return w=c(a[1],q),a=c(a[2],q),new T(w,a);default:throw Error('"get" expects 1 or 2 arguments');}}evaluate(a,q){const w=this._key.evaluate(a,q);return this._obj?this._obj.evaluate(a,q)[w]:a?.values[w]}}class V{constructor(a,q){this._key=a;this._obj=q;this.type=b.BooleanType}static parse(a,q){let w;switch(a.length){case 2:return w=c(a[1],q),new V(w);
case 3:return w=c(a[1],q),a=c(a[2],q),new V(w,a);default:throw Error('"has" expects 1 or 2 arguments');}}evaluate(a,q){const w=this._key.evaluate(a,q);return this._obj?(a=this._obj.evaluate(a,q),w in a):!!a?.values[w]}}class Z{constructor(a,q){this._key=a;this._vals=q;this.type=b.BooleanType}static parse(a,q){if(3!==a.length)throw Error('"in" expects 2 arguments');return new Z(c(a[1],q),c(a[2],q))}evaluate(a,q){const w=this._key.evaluate(a,q);return this._vals.evaluate(a,q).includes(w)}}class aa{constructor(a,
q,w){this._item=a;this._array=q;this._from=w;this.type=b.NumberType}static parse(a,q){if(3>a.length||4<a.length)throw Error('"index-of" expects 3 or 4 arguments');const w=c(a[1],q),C=c(a[2],q);return 4===a.length?(a=c(a[3],q,b.NumberType),new aa(w,C,a)):new aa(w,C)}evaluate(a,q){const w=this._item.evaluate(a,q),C=this._array.evaluate(a,q);if(this._from){a=this._from.evaluate(a,q);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer');return C.indexOf(w,a)}return C.indexOf(w)}}class X{constructor(a){this._arg=
a;this.type=b.NumberType}static parse(a,q){if(2!==a.length)throw Error('"length" expects 2 arguments');a=c(a[1],q);return new X(a)}evaluate(a,q){a=this._arg.evaluate(a,q);if("string"===typeof a||Array.isArray(a))return a.length;throw Error('"length" expects string or array');}}class ba{constructor(a,q,w,C){this.type=a;this._array=q;this._from=w;this._to=C}static parse(a,q){if(3>a.length||4<a.length)throw Error('"slice" expects 2 or 3 arguments');const w=c(a[1],q),C=c(a[2],q,b.NumberType);if(C.type!==
b.NumberType)throw Error('"slice" index must return a number');if(4===a.length){a=c(a[3],q,b.NumberType);if(a.type!==b.NumberType)throw Error('"slice" index must return a number');return new ba(w.type,w,C,a)}return new ba(w.type,w,C)}evaluate(a,q){const w=this._array.evaluate(a,q);if(!Array.isArray(w)&&"string"!==typeof w)throw Error('"slice" input must be an array or a string');const C=this._from.evaluate(a,q);if(0>C||C>=w.length)throw Error('"slice" index out of bounds');if(C!==Math.floor(C))throw Error('"slice" index must be an integer');
if(this._to){a=this._to.evaluate(a,q);if(0>a||a>=w.length)throw Error('"slice" index out of bounds');if(a!==Math.floor(a))throw Error('"slice" index must be an integer');return w.slice(C,a)}return w.slice(C)}}class ea{constructor(){this.type=b.BooleanType}static parse(a){if(1!==a.length)throw Error('"has-id" expects no arguments');return new ea}evaluate(a,q){return void 0!==a?.id}}class U{constructor(a,q){this._args=a;this._calculate=q;this.type=b.NumberType}static parse(a,q,w){a=a.slice(1).map(C=>
c(C,q));return new U(a,w)}evaluate(a,q){let w;this._args&&(w=this._args.map(C=>C.evaluate(a,q)));return this._calculate(w)}}class oa extends U{static parse(a,q){switch(a.length){case 2:return U.parse(a,q,w=>-w[0]);case 3:return U.parse(a,q,w=>w[0]-w[1]);default:throw Error('"-" expects 1 or 2 arguments');}}}class pa extends U{static parse(a,q){return U.parse(a,q,w=>{let C=1;for(const H of w)C*=H;return C})}}class qa extends U{static parse(a,q){if(3===a.length)return U.parse(a,q,w=>w[0]/w[1]);throw Error('"/" expects 2 arguments');
}}class ra extends U{static parse(a,q){if(3===a.length)return U.parse(a,q,w=>w[0]%w[1]);throw Error('"%" expects 2 arguments');}}class sa extends U{static parse(a,q){if(3===a.length)return U.parse(a,q,w=>w[0]**w[1]);throw Error('"^" expects 1 or 2 arguments');}}class ta extends U{static parse(a,q){return U.parse(a,q,w=>{let C=0;for(const H of w)C+=H;return C})}}class S{constructor(a,q){this._args=a;this._calculate=q;this.type=b.NumberType}static parse(a,q){const w=a.slice(1).map(C=>c(C,q));return new S(w,
S.ops[a[0]])}evaluate(a,q){let w;this._args&&(w=this._args.map(C=>C.evaluate(a,q)));return this._calculate(w)}}S.ops={abs:a=>Math.abs(a[0]),acos:a=>Math.acos(a[0]),asin:a=>Math.asin(a[0]),atan:a=>Math.atan(a[0]),ceil:a=>Math.ceil(a[0]),cos:a=>Math.cos(a[0]),e:()=>Math.E,floor:a=>Math.floor(a[0]),ln:a=>Math.log(a[0]),ln2:()=>Math.LN2,log10:a=>Math.log(a[0])/Math.LN10,log2:a=>Math.log(a[0])/Math.LN2,max:a=>Math.max(...a),min:a=>Math.min(...a),pi:()=>Math.PI,round:a=>Math.round(a[0]),sin:a=>Math.sin(a[0]),
sqrt:a=>Math.sqrt(a[0]),tan:a=>Math.tan(a[0])};class ha{constructor(a){this._args=a;this.type=b.StringType}static parse(a,q){return new ha(a.slice(1).map(w=>c(w,q)))}evaluate(a,q){return this._args.map(w=>w.evaluate(a,q)).join("")}}class da{constructor(a,q){this._arg=a;this._calculate=q;this.type=b.StringType}static parse(a,q){if(2!==a.length)throw Error(`${a[0]} expects 1 argument`);q=c(a[1],q);return new da(q,da.ops[a[0]])}evaluate(a,q){return this._calculate(this._arg.evaluate(a,q))}}da.ops={downcase:a=>
a.toLowerCase(),upcase:a=>a.toUpperCase()};class ia{constructor(a){this._args=a;this.type=b.ColorType}static parse(a,q){if(4!==a.length)throw Error('"rgb" expects 3 arguments');a=a.slice(1).map(w=>c(w,q));return new ia(a)}evaluate(a,q){const w=this._validate(this._args[0].evaluate(a,q)),C=this._validate(this._args[1].evaluate(a,q));a=this._validate(this._args[2].evaluate(a,q));return new z({r:w,g:C,b:a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}}class ja{constructor(a){this._args=a;this.type=b.ColorType}static parse(a,q){if(5!==a.length)throw Error('"rgba" expects 4 arguments');a=a.slice(1).map(w=>c(w,q));return new ja(a)}evaluate(a,q){const w=this._validate(this._args[0].evaluate(a,q)),C=this._validate(this._args[1].evaluate(a,q)),H=this._validate(this._args[2].evaluate(a,q));a=this._validateAlpha(this._args[3].evaluate(a,q));return new z({r:w,g:C,b:H,a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}_validateAlpha(a){if("number"!==typeof a||0>a||1<a)throw Error(`${a}: invalid alpha color component`);return a}}class ka{constructor(a){this._color=a;this.type=b.arrayType(b.NumberType,4)}static parse(a,q){if(2!==a.length)throw Error('"to-rgba" expects 1 argument');a=c(a[1],q);return new ka(a)}evaluate(a,q){return(new z(this._color.evaluate(a,q))).toRgba()}}class ca{constructor(a,q){this.type=a;this._args=q}static parse(a,q){var w=a[0];if(2>a.length)throw Error(`${w} expects at least one argument`);
let C=1,H;if("array"===w){if(2<a.length){switch(a[1]){case "string":H=b.StringType;break;case "number":H=b.NumberType;break;case "boolean":H=b.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}C++}else H=b.ValueType;if(3<a.length){var L=a[2];if(null!==L&&("number"!==typeof L||0>L||L!==Math.floor(L)))throw Error('"array" length argument must be a positive integer literal');C++}H=b.arrayType(H,L)}else switch(w){case "string":H=b.StringType;break;case "number":H=
b.NumberType;break;case "boolean":H=b.BooleanType;break;case "object":H=b.ObjectType}for(w=[];C<a.length;C++)L=c(a[C],q),w.push(L);return new ca(H,w)}evaluate(a,q){let w;for(const C of this._args){const H=C.evaluate(a,q);w=b.getType(H);if(b.matchType(w,this.type))return H}throw Error(`Expected ${b.typeToString(this.type)} but got ${b.typeToString(w)}`);}}class W{constructor(a,q){this.type=a;this._args=q}static parse(a,q){var w=a[0];const C=W.types[w];if(C===b.BooleanType||C===b.StringType){if(2!==
a.length)throw Error(`${w} expects one argument`);}else if(2>a.length)throw Error(`${w} expects at least one argument`);w=[];for(let H=1;H<a.length;H++){const L=c(a[H],q);w.push(L)}return new W(C,w)}evaluate(a,q){if(this.type===b.BooleanType)return!!this._args[0].evaluate(a,q);if(this.type===b.StringType)return b.valueToString(this._args[0].evaluate(a,q));if(this.type===b.NumberType){for(const C of this._args){var w=Number(C.evaluate(a,q));if(!isNaN(w))return w}return null}if(this.type===b.ColorType){for(w of this._args)try{const C=
W.toColor(w.evaluate(a,q));if(C instanceof z)return C}catch{}return null}}static toBoolean(a){return!!a}static toString(a){return b.valueToString(a)}static toNumber(a){const q=Number(a);if(isNaN(q))throw Error(`"${a}" is not a number`);return q}static toColor(a){if(a instanceof z)return a;if("string"===typeof a){const q=z.fromString(a);if(q)return q;throw Error(`"${a}" is not a color`);}if(Array.isArray(a))return z.fromArray(a);throw Error(`"${a}" is not a color`);}}W.types={"to-boolean":b.BooleanType,
"to-color":b.ColorType,"to-number":b.NumberType,"to-string":b.StringType};class la{constructor(a){this._val=a;this.type=b.getType(a)}static parse(a){if(2!==a.length)throw Error('"literal" expects 1 argument');return new la(a[1])}evaluate(a,q){return this._val}}class ma{constructor(a){this._arg=a;this.type=b.StringType}static parse(a,q){if(2!==a.length)throw Error('"typeof" expects 1 argument');return new ma(c(a[1],q))}evaluate(a,q){return b.typeToString(b.getType(this._arg.evaluate(a,q)))}}const na=
{array:ca,boolean:ca,collator:null,format:null,image:null,literal:la,number:ca,"number-format":null,object:ca,string:ca,"to-boolean":W,"to-color":W,"to-number":W,"to-string":W,typeof:ma,accumulated:null,"feature-state":null,"geometry-type":n,id:l,"line-progress":null,properties:r,at:I,get:T,has:V,in:Z,"index-of":aa,length:X,slice:ba,"!":y,"!\x3d":t,"\x3c":m,"\x3c\x3d":x,"\x3d\x3d":h,"\x3e":B,"\x3e\x3d":p,all:D,any:J,case:F,coalesce:G,match:E,within:null,interpolate:K,"interpolate-hcl":K,"interpolate-lab":K,
step:N,let:O,var:R,concat:ha,downcase:da,"is-supported-script":null,"resolved-locale":null,upcase:da,rgb:ia,rgba:ja,"to-rgba":ka,"-":oa,"*":pa,"/":qa,"%":ra,"^":sa,"+":ta,abs:S,acos:S,asin:S,atan:S,ceil:S,cos:S,e:S,floor:S,ln:S,ln2:S,log10:S,log2:S,max:S,min:S,pi:S,round:S,sin:S,sqrt:S,tan:S,zoom:v,"heatmap-density":null,"has-id":ea,none:M};u.ALL=D;u.ANY=J;u.Add=ta;u.Assert=ca;u.At=I;u.Calculate=S;u.Case=F;u.Coalesce=G;u.Coerce=W;u.Concat=ha;u.Div=qa;u.EQ=h;u.GE=p;u.GT=B;u.GeomType=n;u.Get=T;u.Has=
V;u.HasID=ea;u.ID=l;u.In=Z;u.IndexOf=aa;u.Interpolate=K;u.LE=x;u.LT=m;u.Length=X;u.Let=O;u.Literal=la;u.Match=E;u.Mod=ra;u.Mul=pa;u.NE=t;u.NONE=M;u.NOT=y;u.Pow=sa;u.Properties=r;u.Rgb=ia;u.Rgba=ja;u.Slice=ba;u.Step=N;u.String=da;u.Sub=oa;u.ToRgba=ka;u.TypeOf=ma;u.Var=R;u.Zoom=v;u.createExpression=c;u.ops=na;Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports","../Color","../chunks/vec4","../chunks/vec4f64"],function(u,z,A,f){function d(m,
x){const B=[];let p,y;if(m[0].length!==x.length)throw Error("dimensions do not match");const D=m.length,J=m[0].length;let M=0;for(p=0;p<D;p++){for(y=M=0;y<J;y++)M+=m[p][y]*x[y];B.push(M)}return B}function e(m){m=[m.r/255,m.g/255,m.b/255].map(x=>.04045>=x?x/12.92:((x+.055)/1.055)**2.4);m=d(h,m);return{x:100*m[0],y:100*m[1],z:100*m[2]}}function b(m){m=d(t,[m.x/100,m.y/100,m.z/100]).map(x=>Math.min(1,Math.max(.0031308>=x?12.92*x:1.055*x**(1/2.4)-.055,0)));return{r:Math.round(255*m[0]),g:Math.round(255*
m[1]),b:Math.round(255*m[2])}}function c(m){m=[m.x/95.047,m.y/100,m.z/108.883].map(x=>x>(6/29)**3?x**(1/3):1/3*(29/6)**2*x+4/29);return{l:116*m[1]-16,a:500*(m[0]-m[1]),b:200*(m[1]-m[2])}}function g(m){const x=m.l;m=[(x+16)/116+m.a/500,(x+16)/116,(x+16)/116-m.b/200].map(B=>B>6/29?B**3:3*(6/29)**2*(B-4/29));return{x:95.047*m[0],y:100*m[1],z:108.883*m[2]}}function l(m){if("r"in m&&"g"in m&&"b"in m)return m;if("l"in m&&"c"in m&&"h"in m){var x=m.c,B=m.h;return b(g({l:m.l,a:x*Math.cos(B),b:x*Math.sin(B)}))}if("l"in
m&&"a"in m&&"b"in m)return b(g(m));if("x"in m&&"y"in m&&"z"in m)return b(m);if("h"in m&&"s"in m&&"v"in m){B=(m.h+360)%360/60;x=m.v/100*255;m=m.s/100*x;const p=m*(1-Math.abs(B%2-1));switch(Math.floor(B)){case 0:B={r:m,g:p,b:0};break;case 1:B={r:p,g:m,b:0};break;case 2:B={r:0,g:m,b:p};break;case 3:B={r:0,g:p,b:m};break;case 4:B={r:p,g:0,b:m};break;case 5:case 6:B={r:m,g:0,b:p};break;default:B={r:0,g:0,b:0}}B.r=Math.round(B.r+x-m);B.g=Math.round(B.g+x-m);B.b=Math.round(B.b+x-m);return B}return m}function n(m){if("h"in
m&&"s"in m&&"v"in m)return m;var x=l(m);m=x.r;const B=x.g,p=x.b;x=Math.max(m,B,p);const y=x-Math.min(m,B,p);m=0===y?0:x===m?(B-p)/y%6:x===B?(p-m)/y+2:(m-B)/y+4;0>m&&(m+=6);return{h:60*m,s:100*(0===y?0:y/x),v:100/255*x}}function r(m){return"l"in m&&"a"in m&&"b"in m?m:c(e(l(m)))}function v(m){let {r:x,g:B,b:p,a:y}=m;1>y&&(x=Math.round(y*x+255*(1-y)),B=Math.round(y*B+255*(1-y)),p=Math.round(y*p+255*(1-y)));return new z({r:x,g:B,b:p})}function k(m,x){const {r:B,g:p,b:y}=x?.ignoreAlpha?m:v(m);return.2126*
B+.7152*p+.0722*y}const h=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],t=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];u.BrightnessThreshold=void 0;(function(m){m[m.Low=160]="Low";m[m.High=225]="High"})(u.BrightnessThreshold||(u.BrightnessThreshold={}));u.colorEquals=function(m,x){return m===x||null!=m&&m.equals(x)};u.colorVectorEquals=function(m,x){return m===x||null!=m&&null!=x&&A.equals(m,x)};u.colorVectorToColorAndOpacity=function(m){return f.fromValues(m[0],
m[1],m[2],3<m.length?m[3]:1)};u.darken=function(m,x){var B=r(m);B.l*=1-x;x=l(B);B=m.clone();B.setColor(x);B.a=m.a;return B};u.desaturate=function(m,x){var B=n(m);B.s*=x;x=l(B);B=m.clone();B.setColor(x);B.a=m.a;return B};u.getColorLuminance=k;u.getColorTheme=function(m){return v(m).isBright?"light":"dark"};u.getContrast=function(m,x=u.BrightnessThreshold.High){return k(m,{ignoreAlpha:!0})>x?new z([0,0,0,m.a]):new z([255,255,255,m.a])};u.multiplyOpacity=function(m,x){m=m.clone();m.a*=x;return m};u.multiplyOpacityToUnitRGBA=
function(m,x){m=z.toUnitRGBA(m);m[3]*=x;return m};u.toHSV=n;u.toLAB=r;u.toLCH=function(m){if(!("l"in m&&"c"in m&&"h"in m)){var x=c(e(l(m)));m=x.l;var B=x.a;const p=x.b;x=Math.sqrt(B*B+p*p);B=Math.atan2(p,B);B=0<B?B:B+2*Math.PI;m={l:m,c:x,h:B}}return m};u.toRGB=l;u.unitRGBAFromColor=function(m){return z.toUnitRGBA(m)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(u,z){function A(h,
t){return{kind:"array",itemType:h,n:t}}function f(h){if("array"===h.kind){const t=f(h.itemType);return"number"===typeof h.n?`array<${t}, ${h.n}>`:"value"===h.itemType.kind?"array":`array<${t}>`}return h.kind}function d(h){if(null===h)return b;if("string"===typeof h)return g;if("boolean"===typeof h)return l;if("number"===typeof h)return c;if(h instanceof z)return n;if(Array.isArray(h)){let t;for(const m of h){const x=d(m);if(!t)t=x;else if(t!==x){t=v;break}}return A(t||v,h.length)}return"object"===
typeof h?r:v}function e(h,t){if("array"===t.kind)return"array"===h.kind&&(0===h.n&&"value"===h.itemType.kind||e(h.itemType,t.itemType))&&("number"!==typeof t.n||t.n===h.n);if("value"===t.kind)for(const m of k)if(e(h,m))return!0;return t.kind===h.kind}const b={kind:"null"},c={kind:"number"},g={kind:"string"},l={kind:"boolean"},n={kind:"color"},r={kind:"object"},v={kind:"value"},k=[b,c,g,l,n,r,A(v)];u.BooleanType=l;u.ColorType=n;u.NullType=b;u.NumberType=c;u.ObjectType=r;u.StringType=g;u.ValueType=
v;u.arrayType=A;u.getType=d;u.matchType=e;u.typeToString=f;u.valueToString=function(h){if(null===h)return"";const t=typeof h;return"string"===t?h:"number"===t||"boolean"===t?String(h):h instanceof z?h.toString():JSON.stringify(h)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(u,z,A,f){class d{constructor(e,
b){this.isDataDriven=!1;this.interpolator=null;switch(e.type){case "number":var c=!0;break;case "color":c=!0;break;case "array":c="number"===e.value;break;default:c=!1}null==b&&(b=e.default);if(Array.isArray(b)&&0<b.length&&A.ops[b[0]]){c={number:f.NumberType,color:f.ColorType,string:f.StringType,boolean:f.BooleanType,enum:f.StringType};try{var g="array"===e.type?f.arrayType(c[e.value]||f.ValueType,e.length):c[e.type];const l=A.createExpression(b,null,g);this.getValue=this._buildExpression(l,e);this.isDataDriven=
!0;l instanceof A.Interpolate&&l.input instanceof A.Zoom&&(this.interpolator=l)}catch(l){console.log(l.message),this.getValue=this._buildSimple(e.default)}}else{c&&"interval"===b.type&&(c=!1);if(g=b?.stops&&0<b.stops.length)for(const l of b.stops)l[1]=this._validate(l[1],e);if(this.isDataDriven=b?!!b.property:!1)if(void 0!==b.default&&(b.default=this._validate(b.default,e)),g)switch(b.type){case "identity":this.getValue=this._buildIdentity(b,e);break;case "categorical":this.getValue=this._buildCategorical(b,
e);break;default:this.getValue=c?this._buildInterpolate(b,e):this._buildInterval(b,e)}else this.getValue=this._buildIdentity(b,e);else g?this.getValue=c?this._buildZoomInterpolate(b):this._buildZoomInterval(b):(b=this._validate(b,e),this.getValue=this._buildSimple(b))}}_validate(e,b){if("number"===b.type){if(null!=b.minimum&&e<b.minimum)return b.minimum;if(null!=b.maximum&&e>b.maximum)return b.maximum}else"color"===b.type?e=d._parseColor(e):"enum"===b.type?"string"===typeof e&&(e=b.values.indexOf(e)):
"array"===b.type&&"enum"===b.value?e=e.map(c=>"string"===typeof c?b.values.indexOf(c):c):"string"===b.type&&(e=f.valueToString(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,b){return(c,g)=>{try{const l=e.evaluate(g,c);return void 0===l?b.default:this._validate(l,b)}catch(l){return console.log(l.message),b.default}}}_buildIdentity(e,b){return(c,g)=>{let l;g&&(l=g.values[e.property]);void 0!==l&&(l=this._validate(l,b));return null!=l?l:void 0!==e.default?e.default:b.default}}_buildCategorical(e,
b){return(c,g)=>{let l;g&&(l=g.values[e.property]);l=this._categorical(l,e.stops);return void 0!==l?l:void 0!==e.default?e.default:b.default}}_buildInterval(e,b){return(c,g)=>{let l;g&&(l=g.values[e.property]);return"number"===typeof l?this._interval(l,e.stops):void 0!==e.default?e.default:b.default}}_buildInterpolate(e,b){return(c,g)=>{let l;g&&(l=g.values[e.property]);return"number"===typeof l?this._interpolate(l,e.stops,e.base||1):void 0!==e.default?e.default:b.default}}_buildZoomInterpolate(e){return b=>
this._interpolate(b,e.stops,e.base||1)}_buildZoomInterval(e){return b=>this._interval(b,e.stops)}_categorical(e,b){const c=b.length;for(let g=0;g<c;g++)if(b[g][0]===e)return b[g][1]}_interval(e,b){const c=b.length;let g=0;for(let l=0;l<c;l++)if(b[l][0]<=e)g=l;else break;return b[g][1]}_interpolate(e,b,c){const g=b.length;for(let r=0;r<g;r++){const v=b[r];if(v[0]<=e)var l=v;else{var n=v;break}}if(l&&n){b=n[0]-l[0];e-=l[0];c=1===c?e/b:(c**e-1)/(c**b-1);if(Array.isArray(l[1])){l=l[1];n=n[1];e=[];for(b=
0;b<l.length;b++)e.push(z.interpolate(l[b],n[b],c));return e}return z.interpolate(l[1],n[1],c)}if(l)return l[1];if(n)return n[1]}static _isEmpty(e){for(const b in e)if(e.hasOwnProperty(b))return!1;return!0}static _parseColor(e){if(Array.isArray(e))return e;"string"===typeof e&&(e=new u(e));if(e instanceof u&&!this._isEmpty(e))return u.toUnitRGBA(e)}}return d})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(u,z,A,f,d,e,b,c,g,l,n,r,v,k,h,t,m){const x=A.ofType({key:"type",base:null,typeMap:{rect:h,path:m,geometry:t}});u.LayerView2DMixin=B=>{B=class extends B{constructor(){super(...arguments);this.attached=!1;this.clips=new x;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const p=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&p&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new d("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new v.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([e.watch(()=>this.suspended,y=>{this.container&&(this.container.visible=!y);this.view&&!y&&this.updateRequested&&this.view.requestUpdate()},e.syncAndInitial),e.watch(()=>this.layer?.opacity??1,y=>{this.container&&(this.container.opacity=
y)},e.syncAndInitial),e.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",y=>{this.container&&(this.container.blendMode=y)},e.syncAndInitial),e.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,y=>{this.container&&(this.container.effect=y)},e.syncAndInitial),e.watch(()=>this.highlightOptions,y=>this.container.highlightOptions=y,e.syncAndInitial),e.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},e.syncAndInitial),e.watch(()=>
({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:y})=>{y=null!=y?this.isVisibleAtScale(y):!1;y!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",y)},e.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(y=>{y===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();this.updateRequested=!1}get spatialReferenceSupported(){const p=
this.view?.spatialReference;return null==p||this.supportsSpatialReference(p)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=
!1)}isVisibleAtScale(p){const y=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!y)return!0;const {minScale:D,maxScale:J}=y;return r.isInScaleRange(p,D,J)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(p){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",p),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(p)))}hitTest(p,
y){return Promise.resolve(null)}supportsSpatialReference(p){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const p=super.getSuspendInfo(),y=!this.spatialReferenceSupported,D=this.visibleAtCurrentScale;y&&(p.spatialReferenceNotSupported=y);D&&(p.outsideScaleRange=D);return p}addAttachHandles(p){this.addHandles(p,"attach")}};z.__decorate([b.property()],B.prototype,"attached",void 0);z.__decorate([b.property({type:x,set(p){p=
f.referenceSetter(p,this._get("clips"),x);this._set("clips",p)}})],B.prototype,"clips",void 0);z.__decorate([b.property()],B.prototype,"container",void 0);z.__decorate([b.property()],B.prototype,"moving",void 0);z.__decorate([b.property({readOnly:!0})],B.prototype,"spatialReferenceSupported",null);z.__decorate([b.property({readOnly:!0})],B.prototype,"updateParameters",void 0);z.__decorate([b.property()],B.prototype,"updateRequested",void 0);z.__decorate([b.property()],B.prototype,"updating",null);
z.__decorate([b.property()],B.prototype,"view",void 0);z.__decorate([b.property({readOnly:!0})],B.prototype,"visibleAtCurrentScale",void 0);z.__decorate([b.property({type:k})],B.prototype,"highlightOptions",void 0);return B=z.__decorate([n.subclass("esri.views.2d.layers.LayerView2D")],B)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(u,z,A){function f(d,e){e=A.getMetersPerUnitForSR(e);
return d/(e*A.inchesPerMeter*96)}u.getExtentForScale=function(d,e){const b=d.extent;d=d.width-(d.padding?d.padding.left+d.padding.right:0);e=f(e,b.spatialReference);return b.clone().expand(e*d/b.width)};u.getResolutionForScale=f;u.getResolutionInMetersForScale=function(d){return d/(96*A.inchesPerMeter)};u.getScale=function(d,e){e=e||d.extent;d=d.width;const b=A.getMetersPerUnitForSR(e?.spatialReference);return e&&d?e.width/d*b*A.inchesPerMeter*96:0};u.getScaleForResolution=function(d,e){e=A.getMetersPerUnitForSR(e);
return d*e*A.inchesPerMeter*96};u.isInScaleRange=function(d,e,b){if(e=0===e||z.floatEqualAbsolute(d,e)||d<e)e=0===b||z.floatEqualAbsolute(d,b)||d>b;return e};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(u,z,A,f,d,e,b){var c;A=c=class extends b{constructor(g){super(g);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new c({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};u.__decorate([z.property({type:[Number,String],json:{write:!0}})],A.prototype,"left",void 0);u.__decorate([z.property({type:[Number,String],
json:{write:!0}})],A.prototype,"right",void 0);u.__decorate([z.property({type:[Number,String],json:{write:!0}})],A.prototype,"top",void 0);u.__decorate([z.property({type:[Number,String],json:{write:!0}})],A.prototype,"bottom",void 0);return A=c=u.__decorate([e.subclass("esri.views.layers.support.ClipRect")],A)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(u,z,A,f,d,e,b){z=class extends z.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};u.__decorate([A.property({readOnly:!0})],z.prototype,"version",null);return z=u.__decorate([b.subclass("esri.views.layers.support.ClipArea")],z)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(u,z,A,f,d,e,b,c,g,l,n,r){var v;z={base:c,key:"type",typeMap:{extent:n,polygon:r}};l=v=class extends l{constructor(k){super(k);this.type="geometry";this.geometry=null}clone(){return new v({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};u.__decorate([A.property({types:z,json:{read:g.fromJSON,write:!0}})],l.prototype,"geometry",void 0);return l=v=u.__decorate([b.subclass("esri.views.layers.support.Geometry")],l)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(u,z,A,f,d,e,b){A=class extends b{constructor(c){super(c);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};u.__decorate([z.property({type:[[[Number]]],json:{write:!0}})],A.prototype,"path",void 0);return A=u.__decorate([e.subclass("esri.views.layers.support.Path")],A)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(u,z,A){class f extends z{constructor(){super(...arguments);
this._fullCacheLodInfos=null;this._levelByScale={}}getTileParentId(d){d=A.pool.acquire(d);const e=0===d.level?null:A.getId(d.level-1,d.row>>1,d.col>>1,d.world);A.pool.release(d);return e}getTileCoverage(d,e,b=!0,c){d=super.getTileCoverage(d,e,b,c);if(!d)return d;const g=1<<d.lodInfo.level;d.spans=d.spans.filter(l=>0<=l.row&&l.row<g);return d}scaleToLevel(d){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[d])return this._levelByScale[d];var e=this._fullCacheLodInfos;
if(d>e[0].scale)return e[0].level;let b;for(let c=0;c<e.length-1;c++)if(b=e[c+1],d>b.scale)return e=e[c],e.level+(e.scale-d)/(e.scale-b.scale);return e[e.length-1].level}_initializeFullCacheLODs(d){d=0===d[0].level?d.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale})):u.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale}));for(let e=0;e<d.length;e++)this._levelByScale[d[e].scale]=d[e].level;
this._fullCacheLodInfos=d}}return f})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../engine/vectorTiles/enums ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/style/StyleRepository ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(u,
z,A,f,d,e,b,c,g,l,n,r,v,k,h,t,m,x,B,p,y,D,J){function M(F){if(null==F)return 0;switch(F.type){case "partial":return Object.keys(F.diff).length;case "complete":return Math.max(Object.keys(F.oldValue).length,Object.keys(F.newValue).length);case "collection":return Object.keys(F.added).length+Object.keys(F.changed).length+Object.keys(F.removed).length}}c=class extends p.LayerView2DMixin(J){constructor(){super(...arguments);this._styleChanges=[];this._tileHandlerPromise=this._parseQueue=this._fetchQueue=
null;this._isTileHandlerReady=!1}get fading(){return this._vectorTileContainer?.fading??!1}async hitTest(F,G){if(!this._tileHandlerPromise)return null;await this._tileHandlerPromise;G=await this._vectorTileContainer.hitTest(G);if(!G||0===G.length)return null;G=G[0]-1;var E=this._styleRepository;const K=E.getStyleLayerByUID(G);if(!K)return null;E=E.getStyleLayerIndex(K.id);return[{type:"graphic",mapPoint:F,layer:this.layer,graphic:new z({attributes:{layerId:E,layerName:K.id,layerUID:G},layer:this.layer,
sourceLayer:this.layer})}]}update(F){this._tileHandlerPromise&&this._isTileHandlerReady&&(F.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=F.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=F.state,this._parseQueue.state=F.state,this._tileManager.update(F)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){const {style:F}=
this.layer.currentStyleInfo;this._styleRepository=new B(F);this._tileInfoView=new y(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new m.VectorTileContainer(this._tileInfoView);this._tileHandler=new k.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1);this.container.addChild(this._vectorTileContainer);this._start();this.addAttachHandles([this.layer.on("paint-change",G=>{if(G.isDataDriven)this._styleChanges.push({type:v.StyleUpdateType.PAINTER_CHANGED,data:G}),
this.requestUpdate();else{const K=this._styleRepository;var E=K.getLayerById(G.layer);E&&(E=E.type===x.StyleLayerType.SYMBOL,K.setPaintProperties(G.layer,G.paint),E&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}}),this.layer.on("layout-change",G=>{const E=this._styleRepository,K=E.getLayerById(G.layer);if(K){var N=l.diff(K.layout,G.layout);null!=N&&(l.hasDiff(N,"visibility")&&1===M(N)?(E.setLayoutProperties(G.layer,G.layout),K.type===x.StyleLayerType.SYMBOL&&
this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()):(this._styleChanges.push({type:v.StyleUpdateType.LAYOUT_CHANGED,data:G}),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",G=>{const E=this._styleRepository,K=E.getLayerById(G.layer);K&&(E.setStyleLayerVisibility(G.layer,G.visibility),K.type===x.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",
G=>{this._styleChanges.push({type:v.StyleUpdateType.LAYER_CHANGED,data:G});this.requestUpdate()}),this.layer.on("delete-style-layer",G=>{this._styleChanges.push({type:v.StyleUpdateType.LAYER_REMOVED,data:G});this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",G=>{this._styleChanges.push({type:v.StyleUpdateType.SPRITES_CHANGED,data:G});G=this._styleRepository.layers;for(const E of G)switch(E.type){case x.StyleLayerType.SYMBOL:E.getLayoutProperty("icon-image")&&
this._styleChanges.push({type:v.StyleUpdateType.LAYOUT_CHANGED,data:{layer:E.id,layout:E.layout}});break;case x.StyleLayerType.LINE:E.getPaintProperty("line-pattern")&&this._styleChanges.push({type:v.StyleUpdateType.PAINTER_CHANGED,data:{layer:E.id,paint:E.paint,isDataDriven:E.isPainterDataDriven()}});break;case x.StyleLayerType.FILL:E.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:v.StyleUpdateType.PAINTER_CHANGED,data:{layer:E.id,paint:E.paint,isDataDriven:E.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop();
this.container.removeAllChildren();this._vectorTileContainer=d.destroyMaybe(this._vectorTileContainer);this._tileHandler=d.destroyMaybe(this._tileHandler)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(F){return r.equals(this.layer.tileInfo?.spatialReference,F)}canResume(){let F=super.canResume();const {currentStyleInfo:G}=this.layer;if(F&&G?.layerDefinition){const E=this.view.scale,{minScale:K,maxScale:N}=G.layerDefinition;
G?.layerDefinition&&(K&&K<E&&(F=!1),N&&N>E&&(F=!1))}return F}isUpdating(){return this.fading}acquireTile(F){const G=this._createVectorTile(F);this._updatingHandles.addPromise(this._fetchQueue.push(G.key).then(E=>this._parseQueue.push({key:G.key,data:E})).then(E=>{G.once("attach",()=>this.requestUpdate());G.setData(E);this.requestUpdate()}).catch(E=>{e.isAbortError(E)||f.getLogger(this).error(E)}));return G}releaseTile(F){F=F.key.id;this._fetchQueue.abort(F);this._parseQueue.abort(F);this.requestUpdate()}_start(){this._stop();
this._tileManager=new h.TileManager({acquireTile:E=>this.acquireTile(E),releaseTile:E=>this.releaseTile(E),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var F=new AbortController,G=this._tileHandler.start({signal:F.signal}).then(()=>{this._fetchQueue=new D({tileInfoView:this._tileInfoView,process:(E,K)=>this._getTileData(E,K),concurrency:15});this._parseQueue=new D({tileInfoView:this._tileInfoView,process:(E,K)=>this._parseTileData(E,K),concurrency:8});
this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(E=>{this._vectorTileContainer.setStyleResources(E,this._tileHandler.glyphMosaic,this._styleRepository);this.requestUpdate()});this._tileHandlerAbortController=F;this._tileHandlerPromise=G}}_stop(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var F=this._tileHandlerAbortController;F&&F.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue=d.destroyMaybe(this._fetchQueue);
this._parseQueue=d.destroyMaybe(this._parseQueue);this._tileManager=d.destroyMaybe(this._tileManager);this._vectorTileContainer.removeAllChildren()}}async _getTileData(F,G){return this._tileHandler.fetchTileData(F,G)}async _parseTileData(F,G){return this._tileHandler.parseTileData(F,G)}async _applyStyleChanges(){this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var F=this._styleChanges;try{await this._tileHandler.updateStyle(F)}catch(O){f.getLogger(this).error("error applying vector-tiles style update",
O.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0}const G=this._styleRepository,E=new Set;F.forEach(O=>{O.type===v.StyleUpdateType.LAYER_REMOVED&&(O=G.getLayerById(O.data.layer))&&E.add(O.uid)});const K=new Set;F.forEach(O=>{let R;switch(O.type){case v.StyleUpdateType.PAINTER_CHANGED:G.setPaintProperties(O.data.layer,O.data.paint);R=O.data.layer;break;case v.StyleUpdateType.LAYOUT_CHANGED:G.setLayoutProperties(O.data.layer,O.data.layout);R=O.data.layer;break;
case v.StyleUpdateType.LAYER_REMOVED:G.deleteStyleLayer(O.data.layer);return;case v.StyleUpdateType.LAYER_CHANGED:G.setStyleLayer(O.data.layer,O.data.index);R=O.data.layer.id;break;case v.StyleUpdateType.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(O.data.spriteSource))}R&&(O=G.getLayerById(R))&&K.add(O.uid)});F=this._vectorTileContainer.children;if(0<E.size){const O=Array.from(E);this._vectorTileContainer.deleteStyleLayers(O);for(var N of F)N.deleteLayerData(O)}this._fetchQueue.resume();
this._parseQueue.resume();if(0<K.size){const O=Array.from(K);N=[];for(const R of F)F=this._updatingHandles.addPromise(this._fetchQueue.push(R.key).then(I=>this._parseQueue.push({key:R.key,data:I,styleLayerUIDs:O})).then(I=>R.setData(I))),N.push(F);await Promise.all(N)}this._styleChanges=[];this._isTileHandlerReady=!0;this.requestUpdate()}async _loadStyle(){var {style:F}=this.layer.currentStyleInfo;F=A.clone(F);this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();
this._parseQueue.clear();this._styleRepository=new B(F);this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=new AbortController;const {signal:G}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,F),await this._tileHandlerPromise}catch(E){if(!e.isAbortError(E))throw E;}G.aborted||(F=await this._tileHandler.spriteMosaic,this._vectorTileContainer.setStyleResources(F,
this._tileHandler.glyphMosaic,this._styleRepository));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.requestUpdate()}_createVectorTile(F){const G=this._tileInfoView.getTileBounds(n.create(),F),E=this._tileInfoView.getTileResolution(F.level);return new t.VectorTile(F,E,G[0],G[3],512,512,this._styleRepository)}};u.__decorate([b.property()],c.prototype,"_isTileHandlerReady",void 0);return c=u.__decorate([g.subclass("esri.views.2d.layers.VectorTileLayerView2D")],
c)});