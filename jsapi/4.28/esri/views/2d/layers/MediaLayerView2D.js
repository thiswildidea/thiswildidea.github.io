// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/MediaElementView":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection ../../geometry/support/aaBoundingRect ../../geometry/support/normalizeUtilsSync".split(" "),function(e,b,m,x,h,d,c,v,C,E,G,f){e.MediaElementView=class extends m{constructor(g){super(g)}get bounds(){const g=
this.coords;return null==g?.extent?null:G.fromExtent(g.extent)}get coords(){return E.projectOrLoad(this.element.georeference?.coords,this.spatialReference).geometry}get normalizedCoords(){return C.fromJSON(f.normalizeCentralMeridianSync(this.coords))}get normalizedBounds(){const g=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=g?G.fromExtent(g):null}};b.__decorate([x.property()],e.MediaElementView.prototype,"spatialReference",void 0);b.__decorate([x.property()],e.MediaElementView.prototype,
"element",void 0);b.__decorate([x.property()],e.MediaElementView.prototype,"bounds",null);b.__decorate([x.property()],e.MediaElementView.prototype,"coords",null);b.__decorate([x.property()],e.MediaElementView.prototype,"normalizedCoords",null);b.__decorate([x.property()],e.MediaElementView.prototype,"normalizedBounds",null);e.MediaElementView=b.__decorate([v.subclass("esri.layers.support.MediaElementView")],e.MediaElementView);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Overlay":function(){define("../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../chunks/mat3f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../symbols/cim/enums ../DisplayObject ./animatedFormats/utils ../../../webgl/BufferObject ../../../webgl/contextUtils ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexArrayObject".split(" "),
function(e,b,m,x,h,d,c,v,C,E,G,f,g,p,H,N,J,K,y){function w(q){return q?{...q,playAnimation:q.playing,repeatType:q.repeatType?z[q.repeatType]:void 0}:{}}const l=v.create(),z={none:G.AnimatedSymbolRepeatType.None,loop:G.AnimatedSymbolRepeatType.Loop,oscillate:G.AnimatedSymbolRepeatType.Oscillate};class D extends f.DisplayObject{constructor(q){super();this.elementView=q;this.isWrapAround=!1;this.perspectiveTransform=E.create();this._playHandle=null;this._vertices=new Float32Array(20);this._handles=[];
this._handles.push(c.watch(()=>this.elementView.element.opacity,u=>this.opacity=u,c.initial),c.watch(()=>[this.elementView.coords],()=>{this.requestRender()},c.initial),c.watch(()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions],()=>{this._playHandle?.remove();this.texture=h.disposeMaybe(this.texture);this.requestRender()},c.initial),c.when(()=>this.elementView.element.loaded,()=>{const u=this.elementView.element;this.ready();"video"===u.type&&null!=u.content&&
this._handles.push(b.on(u.content,"play",()=>this.requestRender()))},c.initial));q.element.load().catch(u=>{m.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new e("element-load-error","Element cannot be displayed",{element:q,error:u}))})}destroy(){this._playHandle?.remove();this._handles.forEach(q=>q.remove());this.texture=h.disposeMaybe(this.texture)}get dvsMat3(){return this.parent.dvsMat3}beforeRender(q){const {context:u}=q,n=this.elementView.element.content;if(null!=n){var r=n instanceof
HTMLImageElement;const I=n instanceof HTMLVideoElement,L=r?n.naturalWidth:I?n.videoWidth:n.width;r=r?n.naturalHeight:I?n.videoHeight:n.height;this._updatePerspectiveTransform(L,r);if(this.texture)I&&!n.paused&&(this.texture.setData(n),this.requestRender(),(u.type===H.ContextType.WEBGL2||x.isPowerOfTwo(L)&&x.isPowerOfTwo(r))&&this.texture.generateMipmap());else{const B=new K.TextureDescriptor;B.wrapMode=N.TextureWrapMode.CLAMP_TO_EDGE;B.preMultiplyAlpha=!0;B.width=L;B.height=r;if("getFrame"in n){const F=
A=>{this.texture?this.texture.setData(A):this.texture=new J.Texture(u,B,A);this.requestRender()};"animationOptions"in this.elementView.element&&(this._playHandle=g.play(n,w(this.elementView.element.animationOptions),null,F))}else this.texture=new J.Texture(u,B,n);(u.type===H.ContextType.WEBGL2||x.isPowerOfTwo(L)&&x.isPowerOfTwo(r))&&this.texture.generateMipmap();I&&!n.paused&&this.requestRender()}}super.beforeRender(q)}_createTransforms(){return null}updateDrawCoords(q,u){var n=this.elementView.coords;
if(null!=n){var [r,I,L,B]=n.rings[0];n=this._vertices;var {x:F,y:A}=q;(q=0!==u)?n.set([I[0]-F,I[1]-A,r[0]-F,r[1]-A,L[0]-F,L[1]-A,B[0]-F,B[1]-A,B[0]-F,B[1]-A,I[0]+u-F,I[1]-A,I[0]+u-F,I[1]-A,r[0]+u-F,r[1]-A,L[0]+u-F,L[1]-A,B[0]+u-F,B[1]-A]):n.set([I[0]-F,I[1]-A,r[0]-F,r[1]-A,L[0]-F,L[1]-A,B[0]-F,B[1]-A]);this.isWrapAround=q}}getVAO(q,u,n){if(null==this.elementView.coords)return null;var r=this._vertices;this._vao?this._geometryVbo.setData(r):(this._geometryVbo=p.BufferObject.createVertex(q,N.Usage.DYNAMIC_DRAW,
r),r=p.BufferObject.createVertex(q,N.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),this._vao=new y.VertexArrayObject(q,n,u,{geometry:this._geometryVbo,tex:r}));return this._vao}_updatePerspectiveTransform(q,u){const n=this._vertices;d.getProjectiveTransform(l,[0,0,q,0,0,u,q,u],[n[0],n[1],n[4],n[5],n[2],n[3],n[6],n[7]]);C.set(this.perspectiveTransform,l[6]/l[8]*q,l[7]/l[8]*u)}}return D})},"esri/core/perspectiveUtils":function(){define("exports ../chunks/mat3 ../chunks/mat3f64 ../chunks/vec2 ../chunks/vec3 ../chunks/vec3f64".split(" "),
function(e,b,m,x,h,d){function c(f,g,p,H,N,J,K,y,w){b.set(f,g,H,J,p,N,K,1,1,1);h.set(v,y,w,1);b.adjoint(C,f);const [l,z,D]=h.transformMat3(v,v,b.transpose(C,C));b.set(C,l,0,0,0,z,0,0,0,D);return b.multiply(f,C,f)}const v=d.create(),C=m.create(),E=m.create(),G=m.create();e.getProjectiveTransform=function(f,g,p){c(E,g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7]);c(G,p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7]);b.multiply(f,b.adjoint(E,E),G);0!==f[8]&&(f[0]/=f[8],f[1]/=f[8],f[2]/=f[8],f[3]/=f[8],f[4]/=f[8],f[5]/=
f[8],f[6]/=f[8],f[7]/=f[8],f[8]/=f[8]);return f};e.transformProjective=function(f,g,p){h.set(v,g[0],g[1],1);h.transformMat3(v,v,b.transpose(C,p));return 0===v[2]?x.set(f,v[0],v[1]):x.set(f,v[0]/v[2],v[1]/v[2])};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f64":function(){define(["exports"],function(e){function b(){return[1,0,0,0,1,0,0,0,1]}function m(c){return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]]}function x(c,v,C,E,G,f,g,p,H){return[c,v,C,E,G,f,g,p,H]}
function h(c,v){return new Float64Array(c,v,9)}const d=Object.freeze(Object.defineProperty({__proto__:null,clone:m,create:b,createView:h,fromValues:x},Symbol.toStringTag,{value:"Module"}));e.clone=m;e.create=b;e.createView=h;e.fromValues=x;e.mat3f64=d})},"esri/views/2d/engine/webgl/OverlayContainer":function(){define("../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../chunks/vec3f32 ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../viewpointUtils ../brushes ./enums ./WGLContainer".split(" "),
function(e,b,m,x,h,d,c,v,C,E,G){class f extends G{constructor(){super(...arguments);this._localOrigin=e.createScreenPoint(0,0);this._viewStateId=-1;this._dvsMat3=m.create()}get dvsMat3(){return this._dvsMat3}beforeRender(g){this._updateMatrices(g);this._updateOverlays(g,this.children);for(const p of this.children)p.beforeRender(g)}prepareRenderPasses(g){const p=g.registerRenderPass({name:"overlay",brushes:[C.brushes.overlay],target:()=>this.children,drawPhase:E.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(g),
p]}_updateMatrices(g){var {state:p}=g;const {id:H,size:N,pixelRatio:J,resolution:K,rotation:y,viewpoint:w,displayMat3:l}=p;if(this._viewStateId!==H){g=Math.PI/180*y;var z=J*N[0],D=J*N[1],{x:q,y:u}=w.targetGeometry;p=d.normalizeMapX(q,p.spatialReference);this._localOrigin.x=p;this._localOrigin.y=u;p=K*z;var n=K*D,r=b.identity(this._dvsMat3);b.multiply(r,r,l);b.translate(r,r,x.fromValues(z/2,D/2));b.scale(r,r,h.fromValues(z/p,-D/n,1));b.rotate(r,r,-g);this._viewStateId=H}}_updateOverlays(g,p){const {state:H}=
g,{rotation:N,spatialReference:J,worldScreenWidth:K,size:y,viewpoint:w}=H;g=this._localOrigin;let l=0;var z=c.getInfo(J);if(z&&J.isWrappable){var D=180/Math.PI*N,q=Math.round(y[0]*Math.abs(Math.cos(D))+y[1]*Math.abs(Math.sin(D)));const [n,r]=z.valid;z=v.getWorldWidth(J);const {x:I,y:L}=w.targetGeometry;D=[0,0];H.toScreen(D,[I,L]);const B=[0,0];q=q>K?.5*K:.5*q;var u=Math.floor((I+.5*z)/z);const F=n+u*z;u=r+u*z;const A=[D[0]+q,0];H.toMap(B,A);B[0]>u&&(l=z);A[0]=D[0]-q;H.toMap(B,A);B[0]<F&&(l=-z);for(const Q of p){p=
Q.elementView.bounds;if(null==p)continue;const [U,,V]=p;U<n&&V>n?Q.updateDrawCoords(g,z):V>r&&U<r?Q.updateDrawCoords(g,-z):Q.updateDrawCoords(g,l)}}else for(D of p)D.updateDrawCoords(g,l)}}return f})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(e,b,m,x,h,d,c,v,C,E,G,f,g,p,H,N,J){const K=m.ofType({key:"type",base:null,typeMap:{rect:H,path:J,geometry:N}});e.LayerView2DMixin=y=>{y=class extends y{constructor(){super(...arguments);this.attached=!1;this.clips=new K;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const w=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&w&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new h("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new g.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([d.watch(()=>this.suspended,l=>{this.container&&(this.container.visible=!l);this.view&&!l&&this.updateRequested&&this.view.requestUpdate()},d.syncAndInitial),d.watch(()=>this.layer?.opacity??1,l=>{this.container&&(this.container.opacity=
l)},d.syncAndInitial),d.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",l=>{this.container&&(this.container.blendMode=l)},d.syncAndInitial),d.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,l=>{this.container&&(this.container.effect=l)},d.syncAndInitial),d.watch(()=>this.highlightOptions,l=>this.container.highlightOptions=l,d.syncAndInitial),d.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},d.syncAndInitial),d.watch(()=>
({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:l})=>{l=null!=l?this.isVisibleAtScale(l):!1;l!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",l)},d.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(l=>{l===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();this.updateRequested=!1}get spatialReferenceSupported(){const w=
this.view?.spatialReference;return null==w||this.supportsSpatialReference(w)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=
!1)}isVisibleAtScale(w){const l=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!l)return!0;const {minScale:z,maxScale:D}=l;return f.isInScaleRange(w,z,D)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(w){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",w),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(w)))}hitTest(w,
l){return Promise.resolve(null)}supportsSpatialReference(w){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const w=super.getSuspendInfo(),l=!this.spatialReferenceSupported,z=this.visibleAtCurrentScale;l&&(w.spatialReferenceNotSupported=l);z&&(w.outsideScaleRange=z);return w}addAttachHandles(w){this.addHandles(w,"attach")}};b.__decorate([c.property()],y.prototype,"attached",void 0);b.__decorate([c.property({type:K,set(w){w=
x.referenceSetter(w,this._get("clips"),K);this._set("clips",w)}})],y.prototype,"clips",void 0);b.__decorate([c.property()],y.prototype,"container",void 0);b.__decorate([c.property()],y.prototype,"moving",void 0);b.__decorate([c.property({readOnly:!0})],y.prototype,"spatialReferenceSupported",null);b.__decorate([c.property({readOnly:!0})],y.prototype,"updateParameters",void 0);b.__decorate([c.property()],y.prototype,"updateRequested",void 0);b.__decorate([c.property()],y.prototype,"updating",null);
b.__decorate([c.property()],y.prototype,"view",void 0);b.__decorate([c.property({readOnly:!0})],y.prototype,"visibleAtCurrentScale",void 0);b.__decorate([c.property({type:p})],y.prototype,"highlightOptions",void 0);return y=b.__decorate([G.subclass("esri.views.2d.layers.LayerView2D")],y)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(e,b,m){function x(h,d){d=m.getMetersPerUnitForSR(d);
return h/(d*m.inchesPerMeter*96)}e.getExtentForScale=function(h,d){const c=h.extent;h=h.width-(h.padding?h.padding.left+h.padding.right:0);d=x(d,c.spatialReference);return c.clone().expand(d*h/c.width)};e.getResolutionForScale=x;e.getResolutionInMetersForScale=function(h){return h/(96*m.inchesPerMeter)};e.getScale=function(h,d){d=d||h.extent;h=h.width;const c=m.getMetersPerUnitForSR(d?.spatialReference);return d&&h?d.width/h*c*m.inchesPerMeter*96:0};e.getScaleForResolution=function(h,d){d=m.getMetersPerUnitForSR(d);
return h*d*m.inchesPerMeter*96};e.isInScaleRange=function(h,d,c){if(d=0===d||b.floatEqualAbsolute(h,d)||h<d)d=0===c||b.floatEqualAbsolute(h,c)||h>c;return d};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(e,b,m,x,h,d,c){var v;m=v=class extends c{constructor(C){super(C);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new v({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};e.__decorate([b.property({type:[Number,String],json:{write:!0}})],m.prototype,"left",void 0);e.__decorate([b.property({type:[Number,String],
json:{write:!0}})],m.prototype,"right",void 0);e.__decorate([b.property({type:[Number,String],json:{write:!0}})],m.prototype,"top",void 0);e.__decorate([b.property({type:[Number,String],json:{write:!0}})],m.prototype,"bottom",void 0);return m=v=e.__decorate([d.subclass("esri.views.layers.support.ClipRect")],m)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(e,b,m,x,h,d,c){b=class extends b.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};e.__decorate([m.property({readOnly:!0})],b.prototype,"version",null);return b=e.__decorate([c.subclass("esri.views.layers.support.ClipArea")],b)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(e,b,m,x,h,d,c,v,C,E,G,f){var g;b={base:v,key:"type",typeMap:{extent:G,polygon:f}};E=g=class extends E{constructor(p){super(p);this.type="geometry";this.geometry=null}clone(){return new g({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};e.__decorate([m.property({types:b,json:{read:C.fromJSON,write:!0}})],E.prototype,"geometry",void 0);return E=g=e.__decorate([c.subclass("esri.views.layers.support.Geometry")],E)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(e,b,m,x,h,d,c){m=class extends c{constructor(v){super(v);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};e.__decorate([b.property({type:[[[Number]]],json:{write:!0}})],m.prototype,"path",void 0);return m=e.__decorate([d.subclass("esri.views.layers.support.Path")],m)})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../renderers/ClassBreaksRenderer ../../../renderers/DictionaryRenderer ../../../renderers/DotDensityRenderer ../../../renderers/HeatmapRenderer ../../../renderers/PieChartRenderer ../../../renderers/Renderer ../../../renderers/SimpleRenderer ../../../renderers/UniqueValueRenderer ../../../renderers/support/jsonUtils ../../../core/Logger ../../../symbols ../../../core/Collection ../../../core/has ../../../core/MapUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../geometry/support/intersectsBase ../../../layers/support/MediaElementView ../../../core/Error ../../../core/scheduling ../../../core/accessorSupport/tracking/Flags ../../../config ../../../request ../../../core/urlUtils ../../../layers/effects/EffectView ../engine/DisplayObject ../engine/webgl/effects/highlight/HighlightGradient ../../../core/Evented ../../../core/mathUtils ../../webgl/contextUtils ../engine/webgl/BufferPool ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../chunks/vec4f32 ../engine/webgl/Utils ../engine/webgl/shaders/BackgroundPrograms ../../webgl/enums ../../webgl/checkWebGLError ../../../chunks/builtins ../engine/webgl/definitions ../../../core/RandomLCG ../engine/webgl/materialKey/MaterialKey ../engine/webgl/techniques/Technique ../engine/webgl/techniques/dotDensity/TechniqueDotDensity ../engine/webgl/techniques/heatmap/TechniqueHeatmap ../engine/webgl/techniques/pieChart/TechniquePieChart ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/GLObjectType ../../webgl/Texture ../../webgl/VertexArrayObject ../engine/webgl/brushes/WGLBrushHeatmap ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/shaders/TileInfoPrograms ../engine/webgl/brushes/WGLGeometryBrushMarker ../engine/webgl/number ../engine/vectorTiles/style/StyleDefinition ../../../chunks/vec2f32 ../engine/vectorTiles/enums ../engine/vectorTiles/shaders/sources/resolver ../engine/webgl/shaders/BitBlitPrograms ../engine/webgl/shaders/sources/resolver ../engine/webgl/TextureManager ../engine/webgl/shaders/StencilPrograms ../engine/webgl/effects/BlendEffect ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../../core/floatRGBA ../../3d/webgl-engine/lib/OrderIndependentTransparency ../../webgl/testSVGPremultipliedAlpha ../LabelManager ./graphics/GraphicsView2D ../engine/webgl/AttributeStoreView ../../../chunks/earcut ../../../layers/graphics/featureConversionUtils ../../../core/unitUtils ../../../renderers/support/lengthUtils ../../../chunks/vec3f32 ../../../geometry/support/normalizeUtils ../navigation/MapViewNavigation ../../../core/asyncUtils ../engine/webgl/shaders/MagnifierPrograms ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../engine/webgl/Overlay ../engine/webgl/OverlayContainer ./LayerView2D ../../layers/LayerView ../../../geometry/Extent".split(" "),function(e,
b,m,x,h,d,c,v,C,E,G,f,g,p,H,N,J,K,y,w,l,z,D,q,u,n,r,I,L,B,F,A,Q,U,V,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,Y,Z,aa,ba,ca,da,ea){function W(a,k,t){a.getTileBounds(O,k.key,!0);R.xmin=O[0];R.ymin=O[1];R.xmax=O[2];R.ymax=O[3];return n.extentIntersectsPolygon(R,t)}let T=class extends ca.LayerView2DMixin(da){constructor(){super(...arguments);this._tileStrategy=this._fetchQueue=
this._overlayContainer=null;this._elementReferences=new Map;this.layer=this._debugGraphicsView=null;this.elements=new H}attach(){this.addAttachHandles([y.on(()=>this.layer.effectiveSource,"refresh",()=>{this._tileStrategy.refresh(a=>this._updateTile(a));this.requestUpdate()}),y.on(()=>this.layer.effectiveSource,"change",({element:a})=>this._elementUpdateHandler(a))]);this._overlayContainer=new ba;this.container.addChild(this._overlayContainer);this._fetchQueue=new Y({tileInfoView:this.view.featuresTilingScheme,
concurrency:10,process:(a,k)=>this._queryElements(a,k)});this._tileStrategy=new Z({cachePolicy:"purge",resampling:!0,acquireTile:a=>this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme});this.requestUpdate()}detach(){this.elements.removeAll();this._tileStrategy.destroy();this._fetchQueue.destroy();this._overlayContainer.removeAllChildren();this.container.removeAllChildren();this._elementReferences.clear();this._debugGraphicsView?.destroy()}supportsSpatialReference(a){return!0}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(a){this._tileStrategy.update(a);
this._debugGraphicsView?.update(a)}async hitTest(a,k){k=[];var t=a.normalize();t=[t.x,t.y];for(const {projectedElement:{normalizedCoords:M,element:S}}of this._elementReferences.values())null!=M&&u.ringsContainsCoords(M.rings,t)&&k.push({type:"media",element:S,layer:this.layer,mapPoint:a,sourcePoint:S.toSource(a)});return k.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset();this._tileStrategy.refresh(a=>this._updateTile(a))}_acquireTile(a){a=
new fa(a.clone());this._updateTile(a);return a}_updateTile(a){this._updatingHandles.addPromise(this._fetchQueue.push(a.key).then(k=>{const [t,M]=a.setElements(k);this._referenceElements(a,t);this._dereferenceElements(a,M);this.requestUpdate()},k=>{K.isAbortError(k)||g.getLogger(this).error(k)}))}_releaseTile(a){this._fetchQueue.abort(a.key.id);a.elements&&this._dereferenceElements(a,a.elements);this.requestUpdate()}async _queryElements(a,k){const t=this.layer.effectiveSource;if(null==t)return[];this.view.featuresTilingScheme.getTileBounds(O,
a,!0);a=new ea({xmin:O[0],ymin:O[1],xmax:O[2],ymax:O[3],spatialReference:this.view.spatialReference});return t.queryElements(a,k)}_referenceElements(a,k){if(null!=this.layer.source)for(const t of k)this._referenceElement(a,t)}_referenceElement(a,k){J.getOrCreateMapValue(this._elementReferences,k.uid,()=>{const t=new r.MediaElementView({element:k,spatialReference:this.view.spatialReference}),M=new aa(t);this._overlayContainer.addChild(M);this.elements.add(k);return{tiles:new Set,projectedElement:t,
overlay:M,debugGraphic:null}}).tiles.add(a)}_dereferenceElements(a,k){for(const t of k)this._dereferenceElement(a,t)}_dereferenceElement(a,k){const t=this._elementReferences.get(k.uid);t.tiles.delete(a);t.tiles.size||(this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.projectedElement.destroy(),this._elementReferences.delete(k.uid),this.elements.remove(k),this._debugGraphicsView?.graphics.remove(t.debugGraphic))}_elementUpdateHandler(a){var k=this._elementReferences.get(a.uid);if(k){const S=
k.projectedElement.normalizedCoords;if(null==S)this._overlayContainer.removeChild(k.overlay),k.overlay.destroy(),k.projectedElement.destroy(),this._elementReferences.delete(a.uid),this.elements.remove(a),this._debugGraphicsView?.graphics.remove(k.debugGraphic);else{var t=[],M=[];for(const P of this._tileStrategy.tiles){const X=W(this.view.featuresTilingScheme,P,S);k.tiles.has(P)?X||M.push(P):X&&t.push(P)}for(const P of t)this._referenceElement(P,a);for(const P of M)this._dereferenceElement(P,a);k=
this._elementReferences.get(a.uid);k?.debugGraphic&&(k.debugGraphic.geometry=k.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:k.debugGraphic,property:"geometry"}))}}else if(k=(new r.MediaElementView({element:a,spatialReference:this.view.spatialReference})).normalizedCoords,null!=k)for(t of this._tileStrategy.tiles)W(this.view.featuresTilingScheme,t,k)&&this._referenceElement(t,a)}};e.__decorate([w.property()],T.prototype,"layer",void 0);e.__decorate([w.property({readOnly:!0})],
T.prototype,"elements",void 0);T=e.__decorate([D.subclass("esri.views.2d.layers.MediaLayerView2D")],T);const O=q.create(),R={xmin:0,ymin:0,xmax:0,ymax:0};class fa{constructor(a){this.key=a;this.elements=null;this.isReady=!1;this.visible=!0}setElements(a){const k=[],t=new Set(this.elements);this.elements=a;for(const M of a)t.has(M)?t.delete(M):k.push(M);this.isReady=!0;return[k,Array.from(t)]}destroy(){}}return T});