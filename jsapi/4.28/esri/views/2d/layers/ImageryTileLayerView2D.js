// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterDatasets/multidimensionalUtils":function(){define(["exports","../../../core/arrayUtils","../DimensionalDefinition"],function(l,E,w){function h(k,p,y){const B=p.shift();0===y.length&&y.push({sliceId:-1,multidimensionalDefinition:[]});const G=y.length;for(let N=0;N<G;N++){const a=y.shift().multidimensionalDefinition;B.values?.forEach(c=>{y.push({sliceId:-1,multidimensionalDefinition:[...a,{variableName:k,dimensionName:B.name,values:[c]}]})})}p.length&&h(k,
p,y)}function n(k,p){return Array.isArray(k)?p[0]===p[1]?k[0]===p[0]||k[1]===p[0]:k[0]>=p[0]&&k[0]<=p[1]&&k[1]>=p[0]&&k[1]<=p[1]:k>=p[0]&&k<=p[1]}function C(k,p){return k[0]<=p[0]&&k[1]>=p[0]||k[0]<=p[1]&&k[1]>=p[1]||k[0]>=p[0]&&k[1]<=p[1]}function A(k){return 1===k.length?[k[0],k[0]]:[k[0],k[k.length-1]]}function D(k,p,y){if(!p?.subsetDefinitions?.length)return k;if(y){const {variables:G}=p;if(G.length&&!G.includes(y))return null;p=p.subsetDefinitions.find(N=>N.dimensionName===k.name&&N.variableName===
y);if(!p?.values?.length)return k;p=A(p.values)}else p=p.dimensions.find(({name:G})=>G===k.name)?.extent;const B=p;if(!B?.length)return k;p=k.values.filter(G=>n(G,B));return{...k,extent:[...B],values:p}}function x(k,p,y){if(!p?.subsetDefinitions?.length)return!1;const {variables:B}=p;if(B.length&&k.some(({variableName:G})=>G&&!B.includes(G)))return!0;for(let G=0;G<k.length;G++){const N=k[G],a=p.subsetDefinitions.find(c=>(""===N.variableName||c.variableName===N.variableName)&&c.dimensionName===N.dimensionName);
if(a?.values.length){const c=A(a.values);if(!N.isSlice&&2===N.values.length&&!Array.isArray(N.values[0])&&N.values[0]!==N.values[1]&&y){if(!C(N.values,c))return!0}else if(N.values.some(d=>!n(d,c)))return!0}}return!1}function r(k,p){var y=k.dimensions.find(({name:a})=>"StdTime"===a);if(null==y||null==p.start&&null==p.end)return p;p=p.clone();const {start:B,end:G}=p.toJSON(),N=B===G?[B]:null!=B&&null!=G?[B,G]:[B??G];if(2===N.length&&y?.extent.length&&(N[0]=Math.max(N[0],y.extent[0]),N[1]=Math.min(N[1],
y.extent[1]??y.extent[0]),N[1]<N[0]))return null;y=new w({variableName:"",dimensionName:"StdTime",isSlice:1===N.length,values:N});if(x([y],k,!0))return null;p.start=new Date(N[0]);p.end=new Date(N[1]??N[0]);return p}function v(k,p={}){const {multidimensionalInfo:y,keyProperties:B}=k;if(null==y)return null;const {variableName:G,multidimensionalSubset:N,multidimensionalDefinition:a}=p;k=null!=a?a[0]?.variableName:null;const c=G||k||B?.DefaultVariable;({variables:k}=y);N?.variables?.length&&(k=k.filter(({name:d})=>
N.variables.includes(d)));return c?k.find(({name:d})=>d===c)??k[0]:k[0]}function b(k,p){var {values:y}=p;if(y?.length){p=Array.isArray(y[0]);var B=Array.isArray(k);return p!==B?-1:p&&B?y.findIndex(N=>N[0]===k[0]&&N[1]===k[1]):y.indexOf(k)}({extent:B}=p);if(Array.isArray(k)||k<B[0]||k>B[1])return-1;y=p.interval||1;if("ISO8601"!==p.unit)return Math.round((k-B[0])/y);B=B[0];let G=-1;switch(p.intervalUnit?.toLowerCase()||"seconds"){case "seconds":G=Math.round((k-B)/1E3/y);break;case "minutes":G=Math.round((k-
B)/6E4/y);break;case "hours":G=Math.round((k-B)/36E5/y);break;case "days":G=Math.round((k-B)/864E5/y);break;case "months":p=(new Date(k)).getUTCFullYear()-(new Date(B)).getUTCFullYear();y=(new Date(B)).getUTCMonth();B=(new Date(k)).getUTCMonth();G=0===p?B-y:B+11-y+12*(p-1);break;case "years":G=Math.round(((new Date(k)).getUTCFullYear()-(new Date(B)).getUTCFullYear())/y);break;case "decades":G=Math.round(((new Date(k)).getUTCFullYear()-(new Date(B)).getUTCFullYear())/10/y)}return G}function t(k){var p=
k.values?.length;if(p)return p;const {extent:y,unit:B}=k;p=k.interval||1;var G=y?y[1]-y[0]:0;if("ISO8601"!==B)return Math.round(G/p);switch(k.intervalUnit?.toLowerCase()??"seconds"){case "seconds":p=Math.round(G/1E3/p);break;case "minutes":p=Math.round(G/6E4/p);break;case "hours":p=Math.round(G/36E5/p);break;case "days":p=Math.round(G/864E5/p);break;case "months":k=(new Date(y[1])).getUTCFullYear()-(new Date(y[0])).getUTCFullYear();p=(new Date(y[0])).getUTCMonth();G=(new Date(y[1])).getUTCMonth();
p=0===k?G-p+1:G+11-p+12*(k-1)+1;break;case "years":p=Math.round(((new Date(y[1])).getUTCFullYear()-(new Date(y[0])).getUTCFullYear())/p);break;case "decades":p=Math.round(((new Date(y[1])).getUTCFullYear()-(new Date(y[0])).getUTCFullYear())/10/p);break;default:p=0}return p}l.createSlices=function(k,p){const y=[];let B=0;(p?k.variables.filter(G=>G.name.toLowerCase()===p.toLowerCase()):[...k.variables].sort((G,N)=>G.name>N.name?1:-1)).forEach(G=>{const N=[],a=[...G.dimensions].sort((c,d)=>c.name>d.name?
-1:1);h(G.name,a,N);N.forEach(c=>{y.push({...c,sliceId:B++})})});return y};l.getDefaultMultidimensionalDefinition=function(k,p={}){var y=v(k,p);if(!y)return null;k=[];const {dimensions:B,name:G}=y;if(0===B.length)return[new w({variableName:G,dimensionName:"",values:[],isSlice:!0})];for(y=0;y<B.length;y++){const N=D(B[y],p.multidimensionalSubset,G);if(!N)return null;const {values:a,extent:c}=N;let d=a?.[0]??c[0];"stdz"===N.name.toLowerCase()&&!N.hasRanges&&Math.abs(c[1])<=Math.abs(c[0])&&(d=a?.length?
a[a.length-1]:c[1]);k.push(new w({variableName:G,dimensionName:N.name,values:[d],isSlice:p.useRangeForRangedDimensionInfo?!!N.hasRanges:!0}))}return k};l.getDefaultVariablInfo=v;l.getSliceIds=function(k,p,y){let B=k;p&&(p=[...p].sort((G,N)=>G.dimensionName<N.dimensionName?-1:1),p.forEach(({dimensionName:G,values:N,isSlice:a})=>{N.length&&(B=B.filter(c=>{c=c.multidimensionalDefinition.find(m=>m.dimensionName===G);if(null==c)return!1;const d=c.values[0];return"number"===typeof d?"number"===typeof N[0]?
N.includes(d):N.some(m=>m[0]<=d&&m[1]>=d):"number"===typeof N[0]?N.some(m=>d[0]<=m&&d[1]>=m):a?N.some(m=>m[0]===d[0]&&m[0]===d[1]):N.some(m=>m[0]>=d[0]&&m[0]<=d[1]||m[1]>=d[0]&&m[1]<=d[1]||m[0]<d[0]&&m[1]>d[1])}))}));if(B.length&&null!=y?.start&&null!=y.end){const G=y.start.getTime(),N=y.end.getTime(),a=B[0].multidimensionalDefinition.findIndex(c=>"StdTime"===c.dimensionName);-1<a&&(B=B.filter(c=>{c=c.multidimensionalDefinition[a].values[0];return G<=c&&N>=c}))}return B.map(G=>G.sliceId)};l.getSliceIndex=
function(k,p){let y=0;var B=k[0].variableName;p=[...p.variables].sort((N,a)=>N.name>a.name?1:-1);for(var G=0;G<p.length;G++){const N=p[G],a=[...N.dimensions].sort((c,d)=>c.name>d.name?-1:1);if(N.name!==B)y+=a.map(c=>t(c)).reduce((c,d)=>c*d);else{B=a.map(c=>t(c));p=a.length;for(let c=0;c<p;c++){G=k.find(d=>d.dimensionName===a[c].name);if(null==G)return null;G=b(G.values[0],a[c]);if(-1===G)return null;B.shift();y=c===p-1?y+G:y+G*B.reduce((d,m)=>d*m)}break}}return y};l.getSubsetVariablesFromMdInfo=function(k,
p){if(null==p||null==k)return null;p=p.variables.map(y=>({...y}));k?.variables?.length&&(p=p.filter(({name:y})=>k.variables.includes(y)),p.forEach(y=>{y.dimensions=y.dimensions.map(B=>D(B,k,y.name)).filter(E.isSome)}));return p};l.hasExcludedVariableOrDimension=x;l.intersectMultimensionalSubset=function(k,p){if(null==k)return{isOutside:!1};const {geometry:y,timeExtent:B,multidimensionalDefinition:G}=p;p=null;if(null!=B&&(p=r(k,B),null==p))return{isOutside:!0};const {areaOfInterest:N}=k;if(N&&y){const a=
"point"===y.type?y:"extent"===y.type?y.center:"polygon"===y.type?y.centroid:null;if(a&&!N.contains(a))return{isOutside:!0}}return null!=G&&G.length&&x(G,k,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:y,timeExtent:p,multidimensionalDefinition:G}}};l.isMultiSliceOrRangeDefinition=function(k){return k?.length?k.some(p=>{if(null==p.values)return!0;const y=p.values.length;return 0===y||1<y||!p.isSlice&&Array.isArray(p.values[0])}):!1};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/DimensionalDefinition":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(l,E,w,h,n,C){var A;E=A=class extends E.JSONSupport{constructor(D){super(D);this.dimensionName=this.variableName=null;this.values=[];this.isSlice=!1}clone(){return new A({variableName:this.variableName,dimensionName:this.dimensionName,
values:w.clone(this.values),isSlice:this.isSlice})}};l.__decorate([h.property({type:String,json:{write:!0}})],E.prototype,"variableName",void 0);l.__decorate([h.property({type:String,json:{write:!0}})],E.prototype,"dimensionName",void 0);l.__decorate([h.property({type:n.types.array(n.types.oneOf([n.types.native(Number),n.types.array(n.types.native(Number))])),json:{write:!0}})],E.prototype,"values",void 0);l.__decorate([h.property({type:Boolean,json:{write:!0}})],E.prototype,"isSlice",void 0);return E=
A=l.__decorate([C.subclass("esri.layers.support.DimensionalDefinition")],E)})},"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),
function(l,E,w,h,n,C,A,D,x,r,v,b,t){w=class extends w{constructor(){super(...arguments);this._loadImagery=(k,p,y,B,G)=>v.loadImagery(this.layer,k,p,y,B,G);this._createFlowMesh=(k,p,y,B)=>this.layer.createFlowMesh({meshType:k,flowData:y,simulationSettings:p},{signal:B});this.attached=!1;this.type="flow";this.timeExtent=null;this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const {layer:k}=this,p=()=>{this._loadImagery=
(y,B,G,N,a)=>v.loadImagery(k,y,B,G,N,a);this._updateVisualization()};"multidimensionalDefinition"in k?this.addHandles(h.watch(()=>k.multidimensionalDefinition,p)):this.addHandles([h.watch(()=>k.mosaicRule,p),h.watch(()=>k.rasterFunction,p),h.watch(()=>k.definitionExpression,p)]);this.container=new b;this._strategy=new t({flowContainer:this.container});this._updateVisualization()}detach(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()}update(k){k.stationary?
this._strategy.update(k):this.layerView.requestUpdate()}hitTest(k){return new E({attributes:{},geometry:k.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){var k=this.layer.renderer;null!=k&&"flow"===k.type&&(k=r(k,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=k,this.layerView.requestUpdate())}};l.__decorate([n.property()],w.prototype,"_strategy",void 0);l.__decorate([n.property()],w.prototype,
"attached",void 0);l.__decorate([n.property()],w.prototype,"container",void 0);l.__decorate([n.property()],w.prototype,"layer",void 0);l.__decorate([n.property()],w.prototype,"layerView",void 0);l.__decorate([n.property()],w.prototype,"type",void 0);l.__decorate([n.property()],w.prototype,"updating",null);l.__decorate([n.property()],w.prototype,"timeExtent",void 0);return w=l.__decorate([x.subclass("esri.views.2d.engine.flow.FlowView2D")],w)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils",
"./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],function(l,E,w,h,n){return function(C,A){const {flowSpeed:D,trailLength:x}=C,r=l.getFlowSimulationSettings(C);let v=null;const b={opacity:l.getOpacity(C),size:l.getSize(C)};let t=l.getColor(C);"none"===C.background?b.color=t:("constant"===t.kind&&(t={kind:"ramp",stops:[0,1],values:[0,0,0,1,t.value[0],t.value[1],t.value[2],t.value[3]],count:2}),v=new E.Imagery({loadImagery:A.loadImagery,timeExtent:A.timeExtent,color:t,
opacity:{kind:"constant",value:[1]}}),b.color=l.getForegroundColor());A={loadImagery:A.loadImagery,createFlowMesh:A.createFlowMesh,simulationSettings:r,timeExtent:A.timeExtent,trailLength:x,flowSpeed:D,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:b.color,opacity:b.opacity,size:b.size};C="butt"===C.trailCap||4>=l.getMax(l.getSize(C))?new n(A):new w.Particles(A);return null!=v?new h.Stack([v,C]):C}})},"esri/views/2d/engine/flow/utils":function(){define(["exports",
"../../../../core/screenUtils"],function(l,E){function w(D){return"constant"===D.kind?D.value[0]:D.values[D.values.length-1]}function h(D){D=D.toRgba();return[D[0]/255,D[1]/255,D[2]/255,D[3]]}function n(D){if(!D.hasVisualVariables("size"))return{kind:"constant",value:[E.pt2px(D.trailWidth)]};const x=D.getVisualVariablesForType("size")[0];D=[];const r=[];if(x.stops){for(v of x.stops)D.push(v.value),r.push(E.pt2px(v.size));var v=x.stops.length}else D.push(x.minDataValue,x.maxDataValue),r.push(E.pt2px(x.minSize),
E.pt2px(x.maxSize)),v=2;return{kind:"ramp",stops:D,values:r,count:v}}function C(D,x,r,v){switch(x){case "int":D.setUniform1iv(r,v);break;case "float":D.setUniform1fv(r,v);break;case "vec2":D.setUniform2fv(r,v);break;case "vec3":D.setUniform3fv(r,v);break;case "vec4":D.setUniform4fv(r,v)}}function A(D,x){return D===x?!0:null!=D&&null!=x?D.equals(x):!1}l.areStreamlinesCompatible=function(D,x){var r=D.simulationSettings,v=x.simulationSettings;let b;b=(b=(b=(b=(b=(b=(b=(b=(b=(b=(b=r.collisions===v.collisions)&&
r.density===v.density)&&r.interpolate===v.interpolate)&&r.lineCollisionWidth===v.lineCollisionWidth)&&r.lineSpacing===v.lineSpacing)&&r.maxTurnAngle===v.maxTurnAngle)&&r.minSpeedThreshold===v.minSpeedThreshold)&&r.segmentLength===v.segmentLength)&&r.smoothing===v.smoothing)&&r.velocityScale===v.velocityScale)&&r.verticesPerLine===v.verticesPerLine;return b&&A(D.timeExtent,x.timeExtent)?r=(r=(r=(r=(r=D.loadImagery===x.loadImagery)&&D.createFlowMesh===x.createFlowMesh)&&D.color.kind===x.color.kind)&&
D.opacity.kind===x.opacity.kind)&&D.size.kind===x.size.kind:!1};l.getColor=function(D){if(!D.hasVisualVariables("color"))return{kind:"constant",value:h(D.color)};D=D.getVisualVariablesForType("color")[0];const x=[],r=[];for(const v of D.stops)x.push(v.value),Array.prototype.push.apply(r,h(v.color));return{kind:"ramp",stops:x,values:r,count:D.stops.length}};l.getFlowSimulationSettings=function(D){var x=n(D);x=w(x);const r=Math.max(x/2,5),v=Math.round(E.pt2px(D.maxPathLength)/r)+1,{density:b}=D;return{smoothing:E.pt2px(D.smoothing),
interpolate:!0,velocityScale:"flow-from"===D.flowRepresentation?1:-1,verticesPerLine:v,minSpeedThreshold:.001,segmentLength:r,maxTurnAngle:1,collisions:!0,lineCollisionWidth:x,lineSpacing:10,density:b}};l.getForegroundColor=function(D){return{kind:"constant",value:[.1,.1,.1,1]}};l.getMax=w;l.getOpacity=function(D){if(!D.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};D=D.getVisualVariablesForType("opacity")[0];const x=[],r=[];for(const v of D.stops)x.push(v.value),r.push(v.opacity);
return{kind:"ramp",stops:x,values:r,count:D.stops.length}};l.getSize=n;l.setUniform=C;l.setUniforms=function(D,x,r,v){"constant"===v.kind?C(D,r,`u_${x}`,v.value):(C(D,"float",`u_${x}_stops`,v.stops),C(D,r,`u_${x}_values`,v.values),D.setUniform1i(`u_${x}_count`,v.count))};l.timeExtentsEqual=A;l.toRgba=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(l,E,w,h,n,C,A,D,x){class r{constructor(p){this._params=p;this.animated=!1}isCompatible(p){if(!(p instanceof r&&w.timeExtentsEqual(this._params.timeExtent,p._params.timeExtent)))return!1;let y;return y=(y=(y=this._params.loadImagery===p._params.loadImagery)&&this._params.color.kind===p._params.color.kind)&&this._params.opacity.kind===p._params.opacity.kind}async load(p,y){const {extent:B,size:G}=p;E.throwIfAborted(y);p=await this._params.loadImagery(B,G[0],G[1],this._params.timeExtent,y);
return new k(p,{color:this._params.color,opacity:this._params.opacity})}render(p,y,B){({context:p}=p);const {program:G}=B;p.setFaceCullingEnabled(!1);p.setBlendingEnabled(!0);p.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);p.useProgram(G);G.setUniformMatrix3fv("u_dvsMat3",y.dvsMat3);p.bindTexture(B.texture,0);G.setUniform1i("u_texture",0);G.setUniform1f("u_Min",B.min);G.setUniform1f("u_Max",B.max);w.setUniforms(G,"color","vec4",this._params.color);w.setUniforms(G,"opacity",
"float",this._params.opacity);p.bindVAO(B.vertexArray);p.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4)}}const v=new Map;v.set("a_position",0);v.set("a_texcoord",1);const b={geometry:[new x.VertexElementDescriptor("a_position",2,n.DataType.UNSIGNED_SHORT,0,8),new x.VertexElementDescriptor("a_texcoord",2,n.DataType.UNSIGNED_SHORT,4,8)]},t={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:v};class k{constructor(p,y){this._flowData=p;this._values=y}attach(p){var {context:y}=p;const {width:B,
height:G}=this._flowData;var N={geometry:h.BufferObject.createVertex(y,n.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,B,0,1,1,0,G,0,0,B,G,1,0]))};N=new D.VertexArrayObject(y,v,b,N);var a=[];"ramp"===this._values.color.kind&&a.push("vvColor");"ramp"===this._values.opacity.kind&&a.push("vvOpacity");p=p.painter.materialManager.getProgram(t,a);a=1E6;let c=-1E6;for(var d=0;d<G;d++)for(var m=0;m<B;m++)if(0!==this._flowData.mask[d*B+m]){var g=this._flowData.data[2*(d*B+m)],q=this._flowData.data[2*(d*B+m)+
1];g=Math.sqrt(g*g+q*q);a=Math.min(a,g);c=Math.max(c,g)}d=new Uint8Array(4*B*G);for(m=0;m<G;m++)for(g=0;g<B;g++)if(0!==this._flowData.mask[m*B+g]){q=this._flowData.data[2*(m*B+g)];const e=this._flowData.data[2*(m*B+g)+1];d[4*(m*B+g)]=(Math.sqrt(q*q+e*e)-a)/(c-a)*255;d[4*(m*B+g)+1]=0;d[4*(m*B+g)+2]=0;d[4*(m*B+g)+3]=255}else d[4*(m*B+g)]=0,d[4*(m*B+g)+1]=0,d[4*(m*B+g)+2]=0,d[4*(m*B+g)+3]=0;m=new A.TextureDescriptor;m.internalFormat=n.PixelFormat.RGBA;m.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;m.flipped=
!0;m.width=B;m.height=G;y=new C.Texture(y,m,d);this.vertexArray=N;this.program=p;this.texture=y;this.min=a;this.max=c;this._flowData=null}detach(){this.vertexArray.dispose();this.texture.dispose()}get ready(){return this.program.compiled}}l.Imagery=r;l.ImageryResources=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(l,E,w,h,n,C,A){class D{constructor(t){this._params=t}get animated(){return 0<this._params.flowSpeed}isCompatible(t){return t instanceof D?w.areStreamlinesCompatible(this._params,t._params):!1}async load(t,k){const {extent:p,size:y}=t;E.throwIfAborted(k);t=await this._params.loadImagery(p,y[0],y[1],this._params.timeExtent,k);const {vertexData:B,indexData:G}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,t,k);return new b(B,G,{color:this._params.color,opacity:this._params.opacity,
size:this._params.size})}render(t,k,p){({context:t}=t);const {program:y}=p;t.setFaceCullingEnabled(!1);t.setBlendingEnabled(!0);t.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);t.useProgram(y);y.setUniform1f("u_time",k.time);y.setUniform1f("u_trailLength",this._params.trailLength);y.setUniform1f("u_flowSpeed",this._params.flowSpeed);y.setUniform1f("u_featheringSize",this._params.featheringSize);y.setUniform1f("u_featheringOffset",this._params.featheringOffset);y.setUniform1f("u_introFade",
this._params.introFade?1:0);y.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);y.setUniform1f("u_decayRate",this._params.decayRate);y.setUniformMatrix3fv("u_dvsMat3",k.dvsMat3);y.setUniformMatrix3fv("u_displayViewMat3",k.displayViewMat3);w.setUniforms(y,"color","vec4",this._params.color);w.setUniforms(y,"opacity","float",this._params.opacity);w.setUniforms(y,"size","float",this._params.size);t.bindVAO(p.vertexArray);t.drawElements(n.PrimitiveType.TRIANGLES,p.indexCount,n.DataType.UNSIGNED_INT,
0)}}const x=new Map;x.set("a_xyts0",0);x.set("a_xyts1",1);x.set("a_typeIdDurationSeed",2);x.set("a_extrudeInfo",3);const r={geometry:[new A.VertexElementDescriptor("a_xyts0",4,n.DataType.FLOAT,0,64),new A.VertexElementDescriptor("a_xyts1",4,n.DataType.FLOAT,16,64),new A.VertexElementDescriptor("a_typeIdDurationSeed",4,n.DataType.FLOAT,32,64),new A.VertexElementDescriptor("a_extrudeInfo",4,n.DataType.FLOAT,48,64)]},v={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:x};class b{constructor(t,
k,p){this._vertexData=t;this._indexData=k;this._values=p}attach(t){var {context:k}=t,p=h.BufferObject.createVertex(k,n.Usage.STATIC_DRAW,this._vertexData);const y=h.BufferObject.createIndex(k,n.Usage.STATIC_DRAW,this._indexData);k=new C.VertexArrayObject(k,x,r,{geometry:p},y);p=[];"ramp"===this._values.color.kind&&p.push("vvColor");"ramp"===this._values.opacity.kind&&p.push("vvOpacity");"ramp"===this._values.size.kind&&p.push("vvSize");t=t.painter.materialManager.getProgram(v,p);this.vertexArray=
k;this.program=t;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}l.Particles=D;l.ParticlesResources=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports"],function(l){class E{constructor(h){this._styles=h}get animated(){return this._styles.reduce((h,n)=>h||n.animated,!1)}isCompatible(h){if(!(h instanceof E)||this._styles.length!==
h._styles.length)return!1;const n=this._styles.length;for(let C=0;C<n;C++)if(!this._styles[C].isCompatible(h._styles[C]))return!1;return!0}async load(h,n){const C=await Promise.all(this._styles.map(A=>A.load(h,n)));return new w(C)}render(h,n,C){for(let A=0;A<this._styles.length;A++)this._styles[A].render(h,n,C.resources[A])}}class w{constructor(h){this.resources=h}attach(h){for(const n of this.resources)n.attach(h)}detach(){for(const h of this.resources)h.detach()}get ready(){return this.resources.reduce((h,
n)=>h&&n.ready,!0)}}l.Stack=E;l.StackResources=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(l,E,w,h,n,C){class A{constructor(b){this._params=b}get animated(){return 0<this._params.flowSpeed}isCompatible(b){return b instanceof
A?E.areStreamlinesCompatible(this._params,b._params):!1}async load(b,t){const {extent:k,size:p}=b;l.throwIfAborted(t);b=await this._params.loadImagery(k,p[0],p[1],this._params.timeExtent,t);const {vertexData:y,indexData:B}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,b,t);return new v(y,B,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(b,t,k){({context:b}=b);const {program:p}=k;b.setFaceCullingEnabled(!1);b.setBlendingEnabled(!0);
b.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);b.useProgram(p);p.setUniform1f("u_time",t.time);p.setUniform1f("u_trailLength",this._params.trailLength);p.setUniform1f("u_flowSpeed",this._params.flowSpeed);p.setUniform1f("u_featheringSize",this._params.featheringSize);p.setUniform1f("u_featheringOffset",this._params.featheringOffset);p.setUniform1f("u_introFade",this._params.introFade?1:0);p.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);p.setUniform1f("u_decayRate",
this._params.decayRate);p.setUniformMatrix3fv("u_dvsMat3",t.dvsMat3);p.setUniformMatrix3fv("u_displayViewMat3",t.displayViewMat3);E.setUniforms(p,"color","vec4",this._params.color);E.setUniforms(p,"opacity","float",this._params.opacity);E.setUniforms(p,"size","float",this._params.size);b.bindVAO(k.vertexArray);b.drawElements(h.PrimitiveType.TRIANGLES,k.indexCount,h.DataType.UNSIGNED_INT,0)}}const D=new Map;D.set("a_positionAndSide",0);D.set("a_timeInfo",1);D.set("a_extrude",2);D.set("a_speed",3);
const x={geometry:[new C.VertexElementDescriptor("a_positionAndSide",3,h.DataType.FLOAT,0,36),new C.VertexElementDescriptor("a_timeInfo",3,h.DataType.FLOAT,12,36),new C.VertexElementDescriptor("a_extrude",2,h.DataType.FLOAT,24,36),new C.VertexElementDescriptor("a_speed",1,h.DataType.FLOAT,32,36)]},r={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:D};class v{constructor(b,t,k){this._vertexData=b;this._indexData=t;this._values=k}attach(b){var {context:t}=b,k=w.BufferObject.createVertex(t,
h.Usage.STATIC_DRAW,this._vertexData);const p=w.BufferObject.createIndex(t,h.Usage.STATIC_DRAW,this._indexData);t=new n.VertexArrayObject(t,D,x,{geometry:k},p);k=[];"ramp"===this._values.color.kind&&k.push("vvColor");"ramp"===this._values.opacity.kind&&k.push("vvOpacity");"ramp"===this._values.size.kind&&k.push("vvSize");b=b.painter.materialManager.getProgram(r,k);this.vertexArray=t;this.program=b;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}
return A})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(l,E,w,h,n,C,A,D,x){function r(a,c){const d=t(c.data,c.width,c.height,a.smoothing);return a.interpolate?(m,g)=>{const q=Math.floor(m),e=Math.floor(g);if(0>q||q>=c.width||0>e||
e>=c.height)return[0,0];m-=q;g-=e;const u=q<c.width-1?q+1:q,z=e<c.height-1?e+1:e;return[(d[2*(e*c.width+q)]*(1-g)+d[2*(z*c.width+q)]*g)*(1-m)+(d[2*(e*c.width+u)]*(1-g)+d[2*(z*c.width+u)]*g)*m,(d[2*(e*c.width+q)+1]*(1-g)+d[2*(z*c.width+q)+1]*g)*(1-m)+(d[2*(e*c.width+u)+1]*(1-g)+d[2*(z*c.width+u)+1]*g)*m]}:(m,g)=>{m=Math.round(m);g=Math.round(g);return 0>m||m>=c.width||0>g||g>=c.height?[0,0]:[d[2*(g*c.width+m)],d[2*(g*c.width+m)+1]]}}function v(a,c,d,m,g,q,e,u,z){const H=[];let J=0,[I,K]=c(d,m);I*=
a.velocityScale;K*=a.velocityScale;H.push({x:d,y:m,t:J,speed:Math.sqrt(I*I+K*K)});for(let U=0;U<a.verticesPerLine;U++){let [R,Y]=c(d,m);R*=a.velocityScale;Y*=a.velocityScale;const X=Math.sqrt(R*R+Y*Y);if(X<a.minSpeedThreshold)break;const ca=R/X,ba=Y/X;d+=ca*a.segmentLength;m+=ba*a.segmentLength;J+=a.segmentLength/X;if(Math.acos(ca*M+ba*S)>a.maxTurnAngle)break;if(a.collisions){var M=Math.round(d*z);var S=Math.round(m*z);if(0>M||M>e-1||0>S||S>u-1)break;const aa=q[S*e+M];if(-1!==aa&&aa!==g)break;q[S*
e+M]=g}H.push({x:d,y:m,t:J,speed:X});M=ca;S=ba}return H}function b(a,c,d,m){const g=[],q=new A,e=1/Math.max(a.lineCollisionWidth,1),u=Math.round(d*e),z=Math.round(m*e),H=new Int32Array(u*z);for(var J=0;J<H.length;J++)H[J]=-1;J=[];for(let I=0;I<m;I+=a.lineSpacing)for(let K=0;K<d;K+=a.lineSpacing)J.push({x:K,y:I,sort:q.getFloat()});J.sort((I,K)=>I.sort-K.sort);for(const {x:I,y:K}of J)q.getFloat()<a.density&&(d=v(a,c,I,K,g.length,H,u,z,e),2>d.length||g.push(d));return g}function t(a,c,d,m){if(0===m)return a;
const g=Math.round(3*m),q=Array(2*g+1);var e=0;for(var u=-g;u<=g;u++){var z=Math.exp(-u*u/(m*m));q[u+g]=z;e+=z}for(m=-g;m<=g;m++)q[m+g]/=e;e=new Float32Array(a.length);for(m=0;m<d;m++)for(u=0;u<c;u++){var H=z=0;for(var J=-g;J<=g;J++)if(!(0>u+J||u+J>=c)){var I=q[J+g];z+=I*a[2*(m*c+(u+J))];H+=I*a[2*(m*c+(u+J))+1]}e[2*(m*c+u)]=z;e[2*(m*c+u)+1]=H}a=new Float32Array(a.length);for(m=0;m<c;m++)for(u=0;u<d;u++){H=z=0;for(J=-g;J<=g;J++)0>u+J||u+J>=d||(I=q[J+g],z+=I*e[2*((u+J)*c+m)],H+=I*e[2*((u+J)*c+m)+1]);
a[2*(u*c+m)]=z;a[2*(u*c+m)+1]=H}return a}function k(a,c){const d=new A;var m=a.reduce((u,z)=>u+z.length,0);m=new Float32Array(4*m);const g=Array(a.length);let q=0,e=0;for(const u of a){a=q;for(const z of u)m[4*q]=z.x,m[4*q+1]=z.y,m[4*q+2]=z.t,m[4*q+3]=z.speed,q++;g[e++]={startVertex:a,numberOfVertices:u.length,totalTime:u[u.length-1].t,timeSeed:c?d.getFloat():0}}return{lineVertices:m,lineDescriptors:g}}function p(a,c){function d(M,S,U,R,Y,X,ca,ba){const aa=9*z;let ea=0;u[aa+ea++]=M;u[aa+ea++]=S;u[aa+
ea++]=1;u[aa+ea++]=U;u[aa+ea++]=X;u[aa+ea++]=ca;u[aa+ea++]=R/2;u[aa+ea++]=Y/2;u[aa+ea++]=ba;z++;u[aa+ea++]=M;u[aa+ea++]=S;u[aa+ea++]=-1;u[aa+ea++]=U;u[aa+ea++]=X;u[aa+ea++]=ca;u[aa+ea++]=-R/2;u[aa+ea++]=-Y/2;u[aa+ea++]=ba;z++}const {lineVertices:m,lineDescriptors:g}=a;var q=a=0;for(var e of g)a+=2*e.numberOfVertices,q+=6*(e.numberOfVertices-1);const u=new Float32Array(9*a);e=new Uint32Array(q);let z=0;a=0;for(const M of g){const {totalTime:S,timeSeed:U}=M;let R=q=null,Y=null;var H=null,J=null,I=null;
for(let X=0;X<M.numberOfVertices;X++){H=m[4*(M.startVertex+X)];const ca=m[4*(M.startVertex+X)+1],ba=m[4*(M.startVertex+X)+2],aa=m[4*(M.startVertex+X)+3];let ea=null,ka=null;var K=null;let f=null;0<X&&(ea=H-q,ka=ca-R,K=Math.sqrt(ea*ea+ka*ka),ea/=K,ka/=K,1<X?(J=ea+J,I=ka+I,K=Math.sqrt(J*J+I*I),J/=K,I/=K,K=Math.min(1/(J*ea+I*ka),c),J*=K,I*=K,K=-I,f=J):(K=-ka,f=ea),null!==K&&null!==f&&(d(q,R,Y,K,f,S,U,aa),e[a++]=z-2,e[a++]=z,e[a++]=z-1,e[a++]=z,e[a++]=z+1,e[a++]=z-1));q=H;R=ca;Y=ba;J=ea;I=ka;H=aa}d(q,
R,Y,-I,J,S,U,H)}return{vertexData:u,indexData:e}}function y(a){function c(L,O){var T=ba+ea,P=aa+ka,V=Math.sqrt(T*T+P*P);T/=V;P/=V;var W=ba*T+aa*P,Q=ea+f,da=ka+F;V=Math.sqrt(Q*Q+da*da);Q/=V;da/=V;var Z=ea*Q+ka*da;V=K;var ja=M,ia=S,ha=U;P=-(P/W);T/=W;W=R;var la=Y,ma=X,na=ca;da=-(da/Z);Q/=Z;Z=16*J;let fa=0;for(const pa of[1,2])for(const qa of[1,2,3,4])z[Z+fa++]=V,z[Z+fa++]=ja,z[Z+fa++]=ia,z[Z+fa++]=ha,z[Z+fa++]=W,z[Z+fa++]=la,z[Z+fa++]=ma,z[Z+fa++]=na,z[Z+fa++]=pa,z[Z+fa++]=qa,z[Z+fa++]=L,z[Z+fa++]=
O,z[Z+fa++]=P/2,z[Z+fa++]=T/2,z[Z+fa++]=da/2,z[Z+fa++]=Q/2,J++;H[I++]=J-8;H[I++]=J-7;H[I++]=J-6;H[I++]=J-7;H[I++]=J-5;H[I++]=J-6;H[I++]=J-4;H[I++]=J-3;H[I++]=J-2;H[I++]=J-3;H[I++]=J-1;H[I++]=J-2}function d(L,O,T,P,V,W){ba=ea;aa=ka;ea=f;ka=F;null==ba&&null==aa&&(ba=ea,aa=ka);if(null!=R&&null!=Y){f=L-R;F=O-Y;const Q=Math.sqrt(f*f+F*F);f/=Q;F/=Q}null!=ba&&null!=aa&&c(V,W);K=R;M=Y;S=X;U=ca;R=L;Y=O;X=T;ca=P}function m(L,O){ba=ea;aa=ka;ea=f;ka=F;null==ba&&null==aa&&(ba=ea,aa=ka);null!=ba&&null!=aa&&c(L,
O)}const {lineVertices:g,lineDescriptors:q}=a;let e=a=0;for(var u of q){const L=u.numberOfVertices-1;a+=8*L;e+=12*L}const z=new Float32Array(16*a),H=new Uint32Array(e);let J=0,I=0,K,M,S,U,R,Y,X,ca,ba,aa,ea,ka,f,F;for(const L of q){F=f=ka=ea=aa=ba=ca=X=Y=R=U=S=M=K=null;const {totalTime:O,timeSeed:T}=L;for(u=0;u<L.numberOfVertices;u++)d(g[4*(L.startVertex+u)],g[4*(L.startVertex+u)+1],g[4*(L.startVertex+u)+2],g[4*(L.startVertex+u)+3],O,T);m(O,T)}return{vertexData:z,indexData:H}}function B(a,c){const d=
c.pixels,{width:m,height:g}=c,q=new Float32Array(m*g*2),e=c.mask||new Uint8Array(m*g*2);c.mask||e.fill(255);if("vector-uv"===a)for(a=0;a<m*g;a++)q[2*a]=d[0][a],q[2*a+1]=-d[1][a];else if("vector-magdir"===a)for(a=0;a<m*g;a++){c=d[0][a];const u=n.deg2rad(d[1][a]),z=Math.sin(u-Math.PI/2);q[2*a]=Math.cos(u-Math.PI/2)*c;q[2*a+1]=z*c}return{data:q,mask:e,width:m,height:g}}async function G(a,c,d,m,g,q){const e={requestProjectedLocalDirections:!0,signal:q};null!=g&&(e.timeExtent=g);if("imagery"===a.type)return await a.load({signal:q}),
g=a.rasterInfo.dataType,a=await a.fetchImage(c,d,m,e),null==a?.pixelData?.pixelBlock?{data:new Float32Array(d*m*2),mask:new Uint8Array(d*m),width:d,height:m}:B(g,a.pixelData.pixelBlock);await a.load({signal:q});g=a.rasterInfo.dataType;a=await a.fetchPixels(c,d,m,e);return null==a?.pixelBlock?{data:new Float32Array(d*m*2),mask:new Uint8Array(d*m),width:d,height:m}:B(g,a.pixelBlock)}const N=h.getLogger("esri.views.2d.engine.flow.dataUtils");l.createAnimatedLinesData=k;l.createFlowMesh=async function(a,
c,d,m){const g=performance.now();var q=r(c,d);const e=performance.now();d=b(c,q,d.width,d.height);c=performance.now();q=k(d,!0);d=performance.now();a="Streamlines"===a?p(q,10):y(q);q=performance.now();w("esri-2d-profiler")&&(N.info("I.1","_createFlowFieldFromData (ms)",Math.round(e-g)),N.info("I.2","_getStreamlines (ms)",Math.round(c-e)),N.info("I.3","createAnimatedLinesData (ms)",Math.round(d-c)),N.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(q-d)),N.info("I.5","createFlowMesh (ms)",
Math.round(q-g)),N.info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();C.throwIfAborted(m);return a};l.createParticlesMesh=y;l.createStreamlinesMesh=p;l.loadImagery=async function(a,c,d,m,g,q){const e=performance.now();var u=D.getInfo(c.spatialReference);if(!u)return d=await G(a,c,d,m,g,q),w("esri-2d-profiler")&&N.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-e)),w("esri-2d-profiler")&&N.info("I.9","Number of parts",
1),d;const [z,H]=u.valid,J=Math.ceil(c.width/(H-z)),I=c.width/J,K=Math.round(d/J);let M=c.xmin;const S=[];u=performance.now();for(let U=0;U<J;U++){const R=new x({xmin:M,xmax:M+I,ymin:c.ymin,ymax:c.ymax,spatialReference:c.spatialReference});S.push(G(a,R,K,m,g,q));M+=I}a=await Promise.all(S);w("esri-2d-profiler")&&N.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-u));w("esri-2d-profiler")&&N.info("I.9","Number of parts",a.length);m={data:new Float32Array(d*m*2),mask:new Uint8Array(d*
m),width:d,height:m};c=0;for(const U of a){for(a=0;a<U.height;a++)for(g=0;g<U.width;g++)c+g>=d||(m.data[2*(a*d+c+g)]=U.data[2*(a*U.width+g)],m.data[2*(a*d+c+g)+1]=U.data[2*(a*U.width+g)+1],m.mask[a*d+c+g]=U.mask[a*U.width+g]);c+=U.width}w("esri-2d-profiler")&&N.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-e));return m};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["./BrushFlow","../webgl/enums",
"../webgl/WGLContainer"],function(l,E,w){class h extends w{constructor(){super(...arguments);this.flowStyle=null}doRender(n){super.doRender(n)}prepareRenderPasses(n){const C=n.registerRenderPass({name:"flow",brushes:[l],target:()=>this.children,drawPhase:E.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(n),C]}}return h})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../chunks/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(l,E,w){class h extends E{constructor(){super(...arguments);
this._visualState={time:0,dvsMat3:l.create(),displayViewMat3:l.create()}}dispose(){}prepareState(n){({context:n}=n);n.setColorMask(!0,!0,!0,!0);n.setStencilFunction(w.CompareFunction.EQUAL,0,255)}draw(n,C){const {requestRender:A,allowDelayedRender:D}=n,{displayData:x}=C;if(null!=x&&("loaded"===x.state.name&&x.attach(n),"attached"===x.state.name)){var r=x.state.resources;D&&!r.ready&&null!=A?A():(this._visualState.time=n.time/1E3,this._visualState.dvsMat3=C.transforms.dvs,this._visualState.displayViewMat3=
n.state.displayViewMat3,x.flowStyle.render(n,this._visualState,r),x.flowStyle.animated&&null!=A&&A())}}}return h})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(l,E,w,h,n,C,A,D,x,r,v,b,t,k,p){function y(B,G){const N=new b({x:(B.xmax+B.xmin)/2,y:(B.ymax+B.ymin)/2,spatialReference:B.spatialReference});var a=B.xmax-B.xmin;const c=B.ymax-B.ymin,d=Math.abs(Math.cos(n.deg2rad(G))),m=Math.abs(Math.sin(n.deg2rad(G)));G=d*a+m*c;a=m*a+d*c;B=new p({xmin:N.x-G/2,ymin:N.y-a/2,xmax:N.x+G/2,ymax:N.y+a/2,spatialReference:B.spatialReference});B.centerAt(N);return B}E=class extends w{constructor(B){super(B);this._flowDisplayObject=new k.FlowDisplayObject;this._loading=
null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear();this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(B){var {flowStyle:G}=this.flowContainer;if(null==G)this._clear();else{var {extent:N,rotation:a,resolution:c,pixelRatio:d}=B.state;B=y(N,a);B.expand(1.15);G=new t(G,B,[Math.round((B.xmax-B.xmin)/c),Math.round((B.ymax-B.ymin)/c)],d);if(null!=this._loading){if(this._loading.update(G))return;this._loading.detach();this._loading=
null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(G)||(G.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},m=>{C.isAbortError(m)||(h.getLogger(this).error("A resource failed to load.",m),this._loading=null)}),this._loading=G)}}_clear(){this._flowDisplayObject.clear();null!=this._loading&&(this._loading.detach(),this._loading=null)}};l.__decorate([A.property()],E.prototype,"_loading",void 0);
l.__decorate([A.property()],E.prototype,"flowContainer",void 0);l.__decorate([A.property()],E.prototype,"updating",null);return E=l.__decorate([v.subclass("esri.views.2d.engine.flow.FlowStrategy")],E)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../core/Logger"],function(l){class E{constructor(w,h,n,C){this.state={name:"created"};this.flowStyle=w;this.extent=h;this.size=n;this.pixelRatio=C}async load(){const w=new AbortController;this.state={name:"loading",abortController:w};
this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},w.signal)}}attach(w){if("loaded"!==this.state.name)l.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var h=this.state.resources;h.attach(w);this.state={name:"attached",resources:h}}}detach(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),
this.state={name:"detached"})}update(w){if(!this.flowStyle.isCompatible(w.flowStyle)||!this.extent.equals(w.extent)||this.size[0]!==w.size[0]||this.size[1]!==w.size[1]||this.pixelRatio!==w.pixelRatio)return!1;this.flowStyle=w.flowStyle;return!0}}return E})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/mat3","../../../../chunks/mat3f32","../DisplayObject"],function(l,E,w,h,n){class C extends n.DisplayObject{constructor(){super(...arguments);
this._displayData=null}get displayData(){return this._displayData}set displayData(A){this._displayData=A;this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(A){var {displayData:D}=this;if(null!=D){var x=[0,0];A.toScreen(x,[D.extent.xmin,D.extent.ymax]);D=(D.extent.xmax-D.extent.xmin)/D.size[0]/A.resolution;var r=E.deg2rad(A.rotation),{dvs:v}=this.transforms;w.fromTranslation(v,[-1,1,0]);w.scale(v,v,[2/(A.size[0]*
A.pixelRatio),-2/(A.size[1]*A.pixelRatio),1]);w.translate(v,v,[x[0],x[1],0]);w.rotate(v,v,r);w.scale(v,v,[D*A.pixelRatio,D*A.pixelRatio,1])}}_createTransforms(){return{dvs:h.create()}}}l.FlowDisplayObject=C;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(l,E,w,h,n,C,A,D,x,r,v,b,t,k,p,y,B){const G=w.ofType({key:"type",base:null,typeMap:{rect:p,path:B,geometry:y}});l.LayerView2DMixin=N=>{N=class extends N{constructor(){super(...arguments);this.attached=!1;this.clips=new G;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const a=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&a&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new n("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new t.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([C.watch(()=>this.suspended,c=>{this.container&&(this.container.visible=!c);this.view&&!c&&this.updateRequested&&this.view.requestUpdate()},C.syncAndInitial),C.watch(()=>this.layer?.opacity??1,c=>{this.container&&(this.container.opacity=
c)},C.syncAndInitial),C.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",c=>{this.container&&(this.container.blendMode=c)},C.syncAndInitial),C.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,c=>{this.container&&(this.container.effect=c)},C.syncAndInitial),C.watch(()=>this.highlightOptions,c=>this.container.highlightOptions=c,C.syncAndInitial),C.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},C.syncAndInitial),C.watch(()=>
({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:c})=>{c=null!=c?this.isVisibleAtScale(c):!1;c!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",c)},C.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(c=>{c===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();this.updateRequested=!1}get spatialReferenceSupported(){const a=
this.view?.spatialReference;return null==a||this.supportsSpatialReference(a)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=
!1)}isVisibleAtScale(a){const c=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!c)return!0;const {minScale:d,maxScale:m}=c;return b.isInScaleRange(a,d,m)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))}hitTest(a,
c){return Promise.resolve(null)}supportsSpatialReference(a){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const a=super.getSuspendInfo(),c=!this.spatialReferenceSupported,d=this.visibleAtCurrentScale;c&&(a.spatialReferenceNotSupported=c);d&&(a.outsideScaleRange=d);return a}addAttachHandles(a){this.addHandles(a,"attach")}};E.__decorate([A.property()],N.prototype,"attached",void 0);E.__decorate([A.property({type:G,set(a){a=
h.referenceSetter(a,this._get("clips"),G);this._set("clips",a)}})],N.prototype,"clips",void 0);E.__decorate([A.property()],N.prototype,"container",void 0);E.__decorate([A.property()],N.prototype,"moving",void 0);E.__decorate([A.property({readOnly:!0})],N.prototype,"spatialReferenceSupported",null);E.__decorate([A.property({readOnly:!0})],N.prototype,"updateParameters",void 0);E.__decorate([A.property()],N.prototype,"updateRequested",void 0);E.__decorate([A.property()],N.prototype,"updating",null);
E.__decorate([A.property()],N.prototype,"view",void 0);E.__decorate([A.property({readOnly:!0})],N.prototype,"visibleAtCurrentScale",void 0);E.__decorate([A.property({type:k})],N.prototype,"highlightOptions",void 0);return N=E.__decorate([v.subclass("esri.views.2d.layers.LayerView2D")],N)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(l,E,w){function h(n,C){C=w.getMetersPerUnitForSR(C);
return n/(C*w.inchesPerMeter*96)}l.getExtentForScale=function(n,C){const A=n.extent;n=n.width-(n.padding?n.padding.left+n.padding.right:0);C=h(C,A.spatialReference);return A.clone().expand(C*n/A.width)};l.getResolutionForScale=h;l.getResolutionInMetersForScale=function(n){return n/(96*w.inchesPerMeter)};l.getScale=function(n,C){C=C||n.extent;n=n.width;const A=w.getMetersPerUnitForSR(C?.spatialReference);return C&&n?C.width/n*A*w.inchesPerMeter*96:0};l.getScaleForResolution=function(n,C){C=w.getMetersPerUnitForSR(C);
return n*C*w.inchesPerMeter*96};l.isInScaleRange=function(n,C,A){if(C=0===C||E.floatEqualAbsolute(n,C)||n<C)C=0===A||E.floatEqualAbsolute(n,A)||n>A;return C};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(l,E,w,h,n,C,A){var D;w=D=class extends A{constructor(x){super(x);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new D({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};l.__decorate([E.property({type:[Number,String],json:{write:!0}})],w.prototype,"left",void 0);l.__decorate([E.property({type:[Number,String],
json:{write:!0}})],w.prototype,"right",void 0);l.__decorate([E.property({type:[Number,String],json:{write:!0}})],w.prototype,"top",void 0);l.__decorate([E.property({type:[Number,String],json:{write:!0}})],w.prototype,"bottom",void 0);return w=D=l.__decorate([C.subclass("esri.views.layers.support.ClipRect")],w)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(l,E,w,h,n,C,A){E=class extends E.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};l.__decorate([w.property({readOnly:!0})],E.prototype,"version",null);return E=l.__decorate([A.subclass("esri.views.layers.support.ClipArea")],E)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(l,E,w,h,n,C,A,D,x,r,v,b){var t;E={base:D,key:"type",typeMap:{extent:v,polygon:b}};r=t=class extends r{constructor(k){super(k);this.type="geometry";this.geometry=null}clone(){return new t({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};l.__decorate([w.property({types:E,json:{read:x.fromJSON,write:!0}})],r.prototype,"geometry",void 0);return r=t=l.__decorate([A.subclass("esri.views.layers.support.Geometry")],r)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(l,E,w,h,n,C,A){w=class extends A{constructor(D){super(D);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};l.__decorate([E.property({type:[[[Number]]],json:{write:!0}})],w.prototype,"path",void 0);return w=l.__decorate([C.subclass("esri.views.layers.support.Path")],w)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),
function(l,E,w,h,n,C,A,D,x){w=class extends D.BaseImageryTileSubView2D{constructor(){super(...arguments);this.type="raster"}attach(){super.attach();this.container=new A.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this.updateRasterFunctionParameters()}detach(){super.detach();this.container.removeAllChildren();this.container=null}canUseWebGLForProcessing(){const {symbolizer:r}=this.layer;var v=r.lookup?.colormapLut?.indexedColormap;v=v&&v.length>
this._maxIndexedColormapSize;return this.useWebGLForProcessing&&r.canRenderInWebGL&&!v&&!("majority"===this.layer.interpolation&&x.canUseMajorityInterpolationOnDataSource(this.layer))}fetchTile(r,v){return this.layer.fetchTile(r.level,r.row,r.col,v)}updateRasterFunctionParameters(){const {raster:r,type:v}=this.layer,{container:b}=this;if("Function"!==r.datasetFormat||"wcs"===v)b.rasterFunctionChain=null,b.children.forEach(a=>{({bitmap:a}=a);a&&(a.suspended=!0,a.processed=!1,a.projected&&(a.invalidateTexture(),
a.rasterTexture=null))}),this._rasterFunctionState="na";else{var t=this._rasterFunctionState,{rasterFunction:k,primaryRasters:p}=r,y=k.supportsGPU&&(!p||1>=p.rasters.length),B=y?k.flatWebGLFunctionChain:null,{renderer:G}=this.layer;y=!y||!B?.functions.length||"raster-stretch"===G?.type&&G.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();b.rasterFunctionChain=y?null:B;var N=null==k?"na":b.rasterFunctionChain?"gpu":"cpu";b.children.forEach(a=>{({bitmap:a}=a);a&&(a.suspended=t!==N,a.processed=
!1,a.processedTexture=null)});this._rasterFunctionState=N}}async updateTileSource(r,v){const b=this._getBandIds(),t=this._getLayerInterpolation(),k=this.canUseWebGLForProcessing(),{source:p,globalSymbolizerParams:y,suspended:B,coords:G,resolution:N}=v;v=this.layerView.hasTilingEffects?y:v.symbolizerParams;({bitmap:r}=r);[r.x,r.y]=G;r.resolution=N;if(null!=p?.pixelBlock){var a={extent:p.extent,pixelBlock:p.pixelBlock,srcPixelSize:p.srcTilePixelSize};r.rawPixelData=a;k?(r.source=p.pixelBlock,r.isRendereredSource=
!1):(a=await this.layer.applyRenderer(a,"stretch"===y?.type?y:void 0),r.source=a,r.isRendereredSource=!0);r.symbolizerParameters=k?v:null;r.transformGrid=k?p.transformGrid:null}else a=this.createEmptyTilePixelBlock(),r.source=a,r.symbolizerParameters=k?v:null,r.transformGrid=null;r.bandIds=k?b:null;r.width=this._tileInfoView.tileInfo.size[0];r.height=this._tileInfoView.tileInfo.size[1];r.interpolation=t;r.suspended=B;r.invalidateTexture()}async updateTileSymbolizerParameters(r,v){const {local:b,global:t}=
v;v=this._getBandIds();const k=this._getLayerInterpolation(),p=this.canUseWebGLForProcessing();({bitmap:r}=r);const {rawPixelData:y}=r;p||null==y?(r.isRendereredSource&&null!=y&&(r.source=y.pixelBlock),r.isRendereredSource=!1):(r.source=await this.layer.applyRenderer(y,"stretch"===t?.type?t:void 0),r.isRendereredSource=!0);r.symbolizerParameters=p?this.layerView.hasTilingEffects?t:b:null;r.bandIds=p?v:null;r.interpolation=k;r.suspended=!1}_getLayerInterpolation(){const {interpolation:r,renderer:v}=
this.layer;if(!v)return r;const b=v.type;return"raster-colormap"===b||"unique-value"===b||"class-breaks"===b?"nearest":"raster-stretch"===v.type&&null!=v.colorRamp?"bilinear"===r||"cubic"===r?"bilinear":"nearest":r}};l.__decorate([E.property()],w.prototype,"container",void 0);l.__decorate([E.property()],w.prototype,"layer",void 0);l.__decorate([E.property()],w.prototype,"type",void 0);return w=l.__decorate([C.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],w)})},"esri/views/2d/engine/imagery/RasterTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ../../viewpointUtils ./BrushRasterBitmap ./RasterTile ../webgl/enums ../webgl/TileContainer".split(" "),
function(l,E,w,h,n,C,A){class D extends A{constructor(){super(...arguments);this.isCustomTilingScheme=!1}createTile(x){const r=this._getTileBounds(x),[v,b]=this._tileInfoView.tileInfo.size,t=this._tileInfoView.getTileResolution(x.level);return new n.RasterTile(x,t,r[0],r[3],v,b)}prepareRenderPasses(x){const r=x.registerRenderPass({name:"imagery (tile)",brushes:[h],target:()=>this.children.map(v=>v.bitmap),drawPhase:C.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(x),r]}doRender(x){if(this.visible&&
x.drawPhase===C.WGLDrawPhase.MAP){var {rasterFunctionChain:r}=this;if(r){if(!r.hasFocalFunction){const [v,b]=this._tileInfoView.tileInfo.size;x.renderPass="raster";x.rasterFunction={name:"Reproject",parameters:{targetImageSize:[v,b],requireBilinear:!1},pixelType:"f32",id:0,isNoopProcess:!1};super.doRender(x)}if(r?.functions.length){const {functions:v,hasBranches:b}=r;for(r=0;r<v.length;r++){const t=v[r];"Constant"!==t.name&&"Identity"!==t.name&&(x.renderPass="raster",x.rasterFunction=t,x.hasBranches=
b,super.doRender(x))}}x.rasterFunction=null;x.renderPass="bitmap"}else x.renderPass="raster-bitmap";super.doRender(x)}}_getTileBounds(x){const r=this._tileInfoView.getTileBounds(E.create(),x);if(this.isCustomTilingScheme&&x.world){var {tileInfo:v}=this._tileInfoView,b=w.getWorldWidth(v.spatialReference);if(b){var t=v.lodAt(x.level);if(!t)return r;({resolution:t}=t);v=(b=b/t%v.size[0])?(v.size[0]-b)*t:0;r[0]-=v*x.world;r[2]-=v*x.world}}return r}}l.RasterTileContainer=D;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/imagery/BrushRasterBitmap":function(){define("../../../../core/maybe ./RasterBitmap ./colorizer/rasterColorizer ./processor/rasterProcessor ../webgl/definitions ../webgl/VertexStream ../webgl/brushes/WGLBrush ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/rasterUtils".split(" "),function(l,E,w,h,n,C,A,D,x,r){class v extends A{constructor(){super(...arguments);this.name="raster";this._quad=null;this._rendererUniformInfos=new Map;this._fbo=
null}dispose(){l.disposeMaybe(this._quad);l.disposeMaybe(this._fbo)}prepareState(b){const {context:t,renderPass:k}=b;b="raster"===k;t.setBlendingEnabled(!b);t.setBlendFunctionSeparate(D.BlendFactor.ONE,D.BlendFactor.ONE_MINUS_SRC_ALPHA,D.BlendFactor.ONE,D.BlendFactor.ONE_MINUS_SRC_ALPHA);t.setColorMask(!0,!0,!0,!0);t.setStencilWriteMask(0);t.setStencilTestEnabled(!b)}draw(b,t){if(E.hasSource(t)&&!t.suspended){var {renderPass:k}=b;if("raster-bitmap"===k)this._drawBitmap(b,t);else{if("raster"===k)return this._process(b,
t);this._drawBitmap(b,t,!0)}}}_process(b,t){var {rasterFunction:k}=b;k="Reproject"===k.name;if(!(k?t.rasterTexture&&t.projected:t.processed)){var {timeline:p,context:y}=b;p.begin(this.name);var B=y.getBoundFramebufferObject(),G=y.getViewport();k||(t.processedTexture=l.disposeMaybe(t.processedTexture));y.setStencilFunction(D.CompareFunction.EQUAL,t.stencilRef,255);t.updateTexture(b);this._initQuad(y);var [N,a]=t.getRasterTextureSize(k),{isStandardRasterTileSize:c,fbo:d}=this._getRasterFBO(y,N,a);h.process(b,
this._quad,d,t);c||d.dispose();y.bindFramebuffer(B);y.setViewport(G.x,G.y,G.width,G.height);p.end(this.name)}}_drawBitmap(b,t,k=!1){const {timeline:p,context:y}=b;p.begin(this.name);y.setStencilFunction(D.CompareFunction.EQUAL,t.stencilRef,255);t.updateTexture(b);if(k&&!t.processedTexture){t.updateProcessedTexture();if(!t.processedTexture){p.end(this.name);return}t.processed=!0}this._initBitmapCommonUniforms(t);var B=t.symbolizerParameters.type;const G=w.getColorizer(B),{requestRender:N,allowDelayedRender:a}=
b,{defines:c,program:d}=G.createProgram(b,t,t.projected&&k);a&&null!=N&&!d.compiled?N():(y.useProgram(d),B=this._getUniformInfos(B,y,d,c),this._quad||(this._quad=new C(y,[0,0,1,0,0,1,1,1])),G.bindTextureAndUniforms(b,d,t,B,k),this._quad.draw(),p.end(this.name))}_initBitmapCommonUniforms(b){if(!b.commonUniforms){const t=r.getBasicGridUniforms(1,[0,0]),{transformGrid:k,width:p,height:y}=b,B=r.getCommonUniforms(k,[p,y],[b.source.width,b.source.height],1,!1);b.commonUniforms={...t,...B,u_coordScale:b.coordScale}}}_getRasterFBO(b,
t,k){const p=t===n.tileSize&&k===n.tileSize;return p?(this._fbo||(this._fbo=this._createNewFBO(b,t,k)),{isStandardRasterTileSize:p,fbo:this._fbo}):{isStandardRasterTileSize:p,fbo:this._createNewFBO(b,t,k)}}_createNewFBO(b,t,k){t=h.createTextureDescriptor(b,t,k);return new x.FramebufferObject(b,t)}_initQuad(b){this._quad||(this._quad=new C(b,[0,0,1,0,0,1,1,1]))}_getUniformInfos(b,t,k,p){b=0<p.length?b+"-"+p.join("-"):b;if(this._rendererUniformInfos.has(b))return this._rendererUniformInfos.get(b);t=
r.getUniformLocationInfos(t,k);this._rendererUniformInfos.set(b,t);return t}}return v})},"esri/views/2d/engine/imagery/RasterBitmap":function(){define("exports ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../DisplayObject ../../../webgl/enums ../../../webgl/rasterUtils".split(" "),function(l,E,w,h,n,C,A,D){const x={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,
1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class r extends C.DisplayObject{constructor(b=null,t=null,k=null){super();this._colormapTextureInvalidated=this._textureInvalidated=!0;this._colormap=this._colormapTexture=this._transformGridTexture=this._rasterTextureBandIds=this._rasterTexture=null;this._supportsBilinearTexture=!0;this._processedTexture=null;this.functionTextures=[];this.projected=!1;this.stencilRef=0;this.coordScale=[1,1];this._processed=!1;this.height=this._symbolizerParameters=
null;this.isRendereredSource=!1;this.pixelRatio=1;this.rotation=this.resolution=0;this.rawPixelData=this._source=null;this._suspended=!1;this.width=this._transformGrid=this._interpolation=this._bandIds=null;this.y=this.x=0;this.source=b;this.transformGrid=t;this.interpolation=k}destroy(){this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(b){this._processedTexture!==b&&(this._disposeTextures(!0),this._processedTexture=b)}get rasterTexture(){return this._rasterTexture}set rasterTexture(b){this._rasterTexture!==
b&&(this._rasterTexture?.dispose(),this._rasterTexture=b);null==b&&(this.projected=!1)}get processed(){return this._processed}set processed(b){this._processed=b;b||(E.disposeMaybe(this.processedTexture),this.invalidateTexture())}get symbolizerParameters(){return this._symbolizerParameters||x}set symbolizerParameters(b){this._symbolizerParameters!==b&&(this._symbolizerParameters=b,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}get source(){return this._source}set source(b){this._source!==
b&&(this._source=b,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=null),this.commonUniforms=null,this.projected=!1,this.invalidateTexture())}get suspended(){return this._suspended}set suspended(b){this._suspended&&!b&&this.stage&&(this.ready(),this.requestRender());this._suspended=b}get bandIds(){return this._bandIds}set bandIds(b){this._bandIds=b;this._isBandIdschanged(b)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||
"nearest"}set interpolation(b){this._interpolation=b;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(b||"nearest")?A.TextureSamplingMode.LINEAR:A.TextureSamplingMode.NEAREST)}get transformGrid(){return this._transformGrid}set transformGrid(b){this._transformGrid!==b&&(this._transformGrid=b,this._transformGridTexture=E.disposeMaybe(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(b=
!1){b=b||this.projected;return[b?this.width:this.source?.width||this.width,b?this.height:this.source?.height||this.height]}getRasterCellSize(){const b=this.rawPixelData?.srcPixelSize,{projected:t,resolution:k}=this;return b&&!t?[b.x,b.y]:[k,k]}_createTransforms(){return{dvs:h.create()}}setTransform(b){const t=w.identity(this.transforms.dvs),[k,p]=b.toScreenNoRotation([0,0],[this.x,this.y]);var y=this.resolution/this.pixelRatio/b.resolution;const B=y*this.width;y*=this.height;const G=Math.PI*this.rotation/
180;w.translate(t,t,n.fromValues(k,p));w.translate(t,t,n.fromValues(B/2,y/2));w.rotate(t,t,-G);w.translate(t,t,n.fromValues(-B/2,-y/2));w.scaleByVec2(t,t,n.fromValues(B,y));w.multiply(this.transforms.dvs,b.displayViewMat3,t)}getTextures({forProcessing:b=!1,useProcessedTexture:t=!1}={}){const k=t?this._processedTexture??this._rasterTexture:this._rasterTexture,p=[],y=[];if(!k)return{names:p,textures:y};this._transformGridTexture&&!this.projected&&(y.push(this._transformGridTexture),p.push("u_transformGrid"));
if(t)return y.push(k),p.push("u_image"),this._colormapTexture&&(y.push(this._colormapTexture),p.push("u_colormap")),{names:p,textures:y};y.push(k);p.push("u_image");this._colormapTexture&&!b&&(y.push(this._colormapTexture),p.push("u_colormap"));return{names:p,textures:y}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:b}){if(this.stage){var t=this._isValidSource(this.source);t&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(b));
this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(b),this._rasterTexture&&(t?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=D.createTransformTexture(b,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}else this._disposeTextures()}updateProcessedTexture(){const {functionTextures:b}=this;0!==b.length&&(this.processedTexture=b.shift(),b.forEach(t=>t?.dispose()),b.length=0)}_createOrDestroyRasterTexture(b){const t=
this.source?.extractBands(this.bandIds);if(this._isValidSource(t)){var k=!this._isBandIdschanged(this.bandIds);if(this._rasterTexture){if(k)return;this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}this._supportsBilinearTexture=!!b.capabilities.textureFloat?.textureFloatLinear;k=this._getTextureSamplingMethod(this.interpolation);this._rasterTexture=D.createRasterTexture(b,t,k,this.isRendereredSource||!b.capabilities.textureFloat?.textureFloat);this._processed=this.projected=
!1;this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)}_isBandIdschanged(b){const t=this._rasterTextureBandIds;return!(null==t&&null==b||t&&b&&t.join("")===b.join(""))}_isValidSource(b){return null!=b&&0<b.pixels?.length}_getTextureSamplingMethod(b){var {type:t}=this.symbolizerParameters;t="lut"===t||"hillshade"===t||"stretch"===t&&1===this.symbolizerParameters.bandCount;return!this._supportsBilinearTexture||
t||"bilinear"!==b&&"cubic"!==b?"nearest":"bilinear"}_updateColormapTexture(b){const t=this._colormap,k=this.symbolizerParameters.colormap;if(!k)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!t)this._colormapTexture=D.createColormapTexture(b,k),this._colormap=k;else if(k.length!==t.length||k.some((p,y)=>p!==t[y]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=D.createColormapTexture(b,
k),this._colormap=k}_disposeTextures(b=!1){!this._transformGridTexture||b&&!this.projected||(this._transformGridTexture.dispose(),this._transformGridTexture=null);!b&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormap=this._colormapTexture=null,this._colormapTextureInvalidated=!0);!b&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=null);this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}class v extends r{get source(){return this._source}}
l.RasterBitmap=r;l.RasterBitmapWithSource=v;l.hasSource=function(b){return null!=b.source};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../chunks/vec2f64 ./contextUtils ./enums ./Texture ./TextureDescriptor".split(" "),function(l,E,w,h,n,C){l.createColormapTexture=function(A,D){const x=new C.TextureDescriptor;x.internalFormat=h.PixelFormat.RGBA;x.width=D.length/4;x.height=1;x.samplingMode=h.TextureSamplingMode.NEAREST;
x.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;return new n.Texture(A,x,D)};l.createRasterTexture=function(A,D,x="nearest",r=!1){const v=(r=!(r&&"u8"===D.pixelType))?h.PixelType.FLOAT:h.PixelType.UNSIGNED_BYTE,b=null==D.pixels||0===D.pixels.length?null:r?D.getAsRGBAFloat():D.getAsRGBA(),t=A.capabilities.textureFloat?.textureFloatLinear,k=new C.TextureDescriptor;k.width=D.width;k.height=D.height;k.internalFormat=A.type===w.ContextType.WEBGL2&&r?h.SizedPixelFormat.RGBA32F:h.PixelFormat.RGBA;k.samplingMode=
!t||"bilinear"!==x&&"cubic"!==x?h.TextureSamplingMode.NEAREST:h.TextureSamplingMode.LINEAR;k.dataType=v;k.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;return new n.Texture(A,k,b)};l.createTransformTexture=function(A,D){const {spacing:x,offsets:r,coefficients:v,size:[b,t]}=D;var k=1<x[0];D=new C.TextureDescriptor;D.width=k?4*b:b;D.height=t;D.internalFormat=A.type===w.ContextType.WEBGL2?h.SizedPixelFormat.RGBA32F:h.PixelFormat.RGBA;D.dataType=h.PixelType.FLOAT;D.samplingMode=h.TextureSamplingMode.NEAREST;
D.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;const p=new Float32Array(k?b*t*16:2*r.length);if(k&&null!=v)for(let y=0,B=0;y<v.length;y++)p[B++]=v[y],2===y%3&&(p[B++]=1);else for(k=0;k<t;k++)for(let y=0;y<b;y++){const B=4*(k*b+y),G=2*(y*t+k);p[B]=r[G];p[B+1]=r[G+1];p[B+3]=-1===r[G]?0:1}return new n.Texture(A,D,p)};l.getBasicGridUniforms=function(A,D){return{u_scale:A,u_offset:D}};l.getColormapUniforms=function(A,D){return{u_colormapOffset:D||0,u_colormapMaxIndex:A?A.length/4-1:0}};l.getCommonUniforms=
function(A,D,x,r=1,v=!0){return{u_flipY:v,u_applyTransform:!!A,u_opacity:r,u_transformSpacing:A?A.spacing:E.ZEROS,u_transformGridSize:A?A.size:E.ZEROS,u_targetImageSize:D,u_srcImageSize:x}};l.getShadedReliefUniforms=function(A){return{u_hillshadeType:A.hillshadeType,u_sinZcosAs:A.sinZcosAs,u_sinZsinAs:A.sinZsinAs,u_cosZs:A.cosZs,u_weights:A.weights,u_factor:A.factor,u_minValue:A.minValue,u_maxValue:A.maxValue}};l.getStretchUniforms=function(A){return{u_bandCount:A.bandCount,u_minOutput:A.outMin,u_maxOutput:A.outMax,
u_minCutOff:A.minCutOff,u_maxCutOff:A.maxCutOff,u_factor:A.factor,u_useGamma:A.useGamma,u_gamma:A.gamma,u_gammaCorrection:A.gammaCorrection}};l.getUniformLocationInfos=function(A,D){A=A.gl;D=D.glName;const x=new Map;if(null==D)return x;const r=A.getProgramParameter(D,A.ACTIVE_UNIFORMS);let v;for(let b=0;b<r;b++)(v=A.getActiveUniform(D,b))&&x.set(v.name,{location:A.getUniformLocation(D,v.name),info:v});return x};l.setTextures=function(A,D,x,r){x.length===r.length&&(r.some(v=>null==v)||x.some(v=>null==
v)||x.forEach((v,b)=>{D.setUniform1i(v,b);A.bindTexture(r[b],b)}))};l.setUniforms=function(A,D,x){Object.keys(x).forEach(r=>{var v=D.get(r)||D.get(r+"[0]");if(v){var b=x[r];if(null!==v&&null!=b)switch({info:v}=v,v.type){case h.UniformType.FLOAT:1<v.size?A.setUniform1fv(r,b):A.setUniform1f(r,b);break;case h.UniformType.FLOAT_VEC2:A.setUniform2fv(r,b);break;case h.UniformType.FLOAT_VEC3:A.setUniform3fv(r,b);break;case h.UniformType.FLOAT_VEC4:A.setUniform4fv(r,b);break;case h.UniformType.FLOAT_MAT3:A.setUniformMatrix3fv(r,
b);break;case h.UniformType.FLOAT_MAT4:A.setUniformMatrix4fv(r,b);break;case h.UniformType.INT:1<v.size?A.setUniform1iv(r,b):A.setUniform1i(r,b);break;case h.UniformType.BOOL:A.setUniform1i(r,b?1:0);break;case h.UniformType.INT_VEC2:case h.UniformType.BOOL_VEC2:A.setUniform2iv(r,b);break;case h.UniformType.INT_VEC3:case h.UniformType.BOOL_VEC3:A.setUniform3iv(r,b);break;case h.UniformType.INT_VEC4:case h.UniformType.BOOL_VEC4:A.setUniform4iv(r,b)}}})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/imagery/colorizer/rasterColorizer":function(){define(["exports","./lut","./shadedrelief","./stretch"],function(l,E,w,h){const n=new Map;n.set("lut",E);n.set("hillshade",w);n.set("stretch",h);l.getColorizer=function(C){return n.get(C)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/lut":function(){define(["./utils","../../../../webgl/rasterUtils"],function(l,E){const w={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",
0],["a_texcoord",1]])};return{createProgram:function(h,n,C){n=C?[]:l.getProjectionDefines(n.transformGrid);h=h.painter.materialManager.getProgram(w,n);return{defines:n,program:h}},bindTextureAndUniforms:function(h,n,C,A,D=!1){const {names:x,textures:r}=C.getTextures({useProcessedTexture:D});E.setTextures(h.context,n,x,r);E.setUniforms(n,A,C.commonUniforms);n.setUniformMatrix3fv("u_dvsMat3",C.transforms.dvs);const {colormap:v,colormapOffset:b}=C.symbolizerParameters;h=E.getColormapUniforms(v,b);E.setUniforms(n,
A,h)}}})},"esri/views/2d/engine/imagery/colorizer/utils":function(){define(["exports"],function(l){l.getInterpolationDefines=function(E,w,h){h=!h.capabilities.textureFloat?.textureFloatLinear;const n=[];"cubic"===E?n.push("bicubic"):"bilinear"===E&&(w?(n.push("bilinear"),n.push("nnedge")):h&&n.push("bilinear"));return n};l.getProjectionDefines=function(E){const w=[];E&&(w.push("applyProjection"),1===E.spacing[0]&&w.push("lookupProjection"));return w};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/imagery/colorizer/shadedrelief":function(){define(["./utils","../../../../webgl/rasterUtils"],function(l,E){const w={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,n,C){const {colormap:A}=n.symbolizerParameters;C=C?[]:l.getProjectionDefines(n.transformGrid);n=l.getInterpolationDefines(n.interpolation,!0,h.context);n=[...C,...n];null!=A&&n.push("applyColormap");h=h.painter.materialManager.getProgram(w,
n);return{defines:n,program:h}},bindTextureAndUniforms:function(h,n,C,A,D=!1){const {names:x,textures:r}=C.getTextures({useProcessedTexture:D});E.setTextures(h.context,n,x,r);E.setUniforms(n,A,C.commonUniforms);n.setUniformMatrix3fv("u_dvsMat3",C.transforms.dvs);h=C.symbolizerParameters;const {colormap:v,colormapOffset:b}=h;null!=v&&(C=E.getColormapUniforms(v,b),E.setUniforms(n,A,C));h=E.getShadedReliefUniforms(h);E.setUniforms(n,A,h)}}})},"esri/views/2d/engine/imagery/colorizer/stretch":function(){define(["./utils",
"../../../../webgl/rasterUtils"],function(l,E){const w={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,n,C){const {colormap:A,bandCount:D}=n.symbolizerParameters;var x=C?[]:l.getProjectionDefines(n.transformGrid);const r=l.getInterpolationDefines(n.interpolation,1===D,h.context);x=[...x,...r];n.isRendereredSource&&!C?x.push("noop"):null!=A&&x.push("applyColormap");h=h.painter.materialManager.getProgram(w,x);return{defines:x,
program:h}},bindTextureAndUniforms:function(h,n,C,A,D=!1){const {names:x,textures:r}=C.getTextures({useProcessedTexture:D});E.setTextures(h.context,n,x,r);E.setUniforms(n,A,C.commonUniforms);n.setUniformMatrix3fv("u_dvsMat3",C.transforms.dvs);h=C.symbolizerParameters;const {colormap:v,colormapOffset:b}=h;null!=v&&(C=E.getColormapUniforms(v,b),E.setUniforms(n,A,C));h=E.getStretchUniforms(h);E.setUniforms(n,A,h)}}})},"esri/views/2d/engine/imagery/processor/rasterProcessor":function(){define("exports ./aspectProcessor ./bandArithmeticProcessor ./compositeBandProcessor ./contrastProcessor ./convolutionProcessor ./curvatureProcessor ./extractBandProcessor ./focalStatisticsProcessor ./localProcessor ./maskProcessor ./ndviProcessor ./remapProcessor ./reprojectProcessor ./slopeProcessor ./stretchProcessor ../../../../webgl/contextUtils ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(l,E,w,h,n,C,A,D,x,r,v,b,t,k,p,y,B,G,N,a){function c(m,g,q){const e=new a.TextureDescriptor;e.width=g;e.height=q;e.internalFormat=m.type===B.ContextType.WEBGL2?G.SizedPixelFormat.RGBA32F:G.PixelFormat.RGBA;e.samplingMode=G.TextureSamplingMode.NEAREST;e.dataType=G.PixelType.FLOAT;e.isImmutable=m.type===B.ContextType.WEBGL2;e.wrapMode=G.TextureWrapMode.CLAMP_TO_EDGE;return e}const d=new Map;d.set("aspect",E);d.set("bandarithmetic",w);d.set("compositeband",h);d.set("convolution",C);d.set("contrastbrightness",
n);d.set("curvature",A);d.set("extractband",D);d.set("statistics",x);d.set("local",r);d.set("mask",v);d.set("ndvi",b);d.set("remap",t);d.set("slope",p);d.set("stretch",y);l.createTextureDescriptor=c;l.process=function(m,g,q,e){const u=m.rasterFunction.name.toLowerCase(),z="reproject"===u?k:d.get(u.toLowerCase());if(null!=z){{const {context:K,requestRender:M,allowDelayedRender:S}=m;var H=z.createProgram(m,e);S&&null!=M&&!H.compiled?(M(),H=null):(K.bindFramebuffer(q),K.setViewport(0,0,q.width,q.height),
K.useProgram(H))}if(H){z.bindTextureAndUniforms(m,H,e);g.draw();var [J,I]=e.getRasterTextureSize("reproject"===u);g=c(m.context,J,I);g=new N.Texture(m.context,g);q.copyToTexture(0,0,J,I,0,0,g);"reproject"===u?(e.rasterTexture=g,e.projected=!0):e.functionTextures[m.hasBranches?m.rasterFunction.id:0]=g}}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/processor/aspectProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",
attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){return w.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);w=n.getRasterTextureSize();h.setUniform2fv("u_srcImageSize",w);n=n.getRasterCellSize();h.setUniform2fv("u_cellSize",n)}}})},"esri/views/2d/engine/imagery/processor/utils":function(){define(["exports","../../../../webgl/rasterUtils"],function(l,E){function w(C,
A,D){const {context:x,rasterFunction:r,hasBranches:v}=C;({raster:C}=r.parameters);E.setTextures(x,A,["u_image"],[D.functionTextures[v?C?.id??-1:0]??D.rasterTexture])}const h=[1,1],n=[2,0,0,0,2,0,-1,-1,0];l.setCoordsAndTransforms=function(C){C.setUniform2fv("u_coordScale",h);C.setUniformMatrix3fv("u_dvsMat3",n)};l.setMultipleImageTextures=function(C,A,D){var {rasters:x}=C.rasterFunction.parameters;if(x){if(2>x.length)return w(C,A,D);var r=x.filter(v=>"Constant"!==v.name).map(v=>null!=v.id&&"Identity"!==
v.name?D.functionTextures[v.id]:D.rasterTexture);E.setTextures(C.context,A,["u_image","u_image1","u_image2"].slice(0,r.length),r);if(r.length!==x.length)if(2===x.length)r=x.findIndex(v=>"Constant"===v.name),C=0===r?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],{value:x}=x[r].parameters,A.setUniform1f("u_image1Const",x),A.setUniformMatrix3fv("u_imageSwap",C);else if(3===x.length){const v=[];x.forEach((b,t)=>"Constant"===b.name&&v.push(t));1===v.length?({value:x}=x[v[0]].parameters,A.setUniform1f("u_image1Const",
x),A.setUniformMatrix3fv("u_imageSwap",0===v[0]?[0,1,0,0,0,1,1,0,0]:1===v[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1])):2===v.length&&({value:C}=x[v[0]].parameters,A.setUniform1f("u_image1Const",C),{value:C}=x[v[1]].parameters,A.setUniform1f("u_image2Const",C),x=x.findIndex(b=>"Constant"!==b.name),A.setUniformMatrix3fv("u_imageSwap",0===x?[1,0,0,0,1,0,0,0,1]:1===x?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0]))}}};l.setSingleImageTextures=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/imagery/processor/bandArithmeticProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){const {painter:n,rasterFunction:C}=w;({indexType:w}=C.parameters);return n.materialManager.getProgram(E,[w])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);({bandIndexMat3:w}=w.rasterFunction.parameters);
h.setUniformMatrix3fv("u_bandIndexMat3",w)}}})},"esri/views/2d/engine/imagery/processor/compositeBandProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){return w.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(w,h,n){l.setMultipleImageTextures(w,h,n);l.setCoordsAndTransforms(h)}}})},"esri/views/2d/engine/imagery/processor/contrastProcessor":function(){define(["./utils"],
function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/contrast",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){return w.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);const {contrastOffset:C,brightnessOffset:A}=w.rasterFunction.parameters;h.setUniform1f("u_contrastOffset",C);h.setUniform1f("u_brightnessOffset",A)}}})},"esri/views/2d/engine/imagery/processor/convolutionProcessor":function(){define(["./utils"],
function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){const {painter:n,rasterFunction:C}=w,{kernelRows:A,kernelCols:D}=C.parameters;return n.materialManager.getProgram(E,[{name:"rows",value:A},{name:"cols",value:D}])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);h.setUniform2fv("u_srcImageSize",[n.width,n.height]);const {kernel:C,clampRange:A}=
w.rasterFunction.parameters;h.setUniform1fv("u_kernel",C);h.setUniform2fv("u_clampRange",A)}}})},"esri/views/2d/engine/imagery/processor/curvatureProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){const {painter:n,rasterFunction:C}=w;({curvatureType:w}=C.parameters);return n.materialManager.getProgram(E,[w])},bindTextureAndUniforms:function(w,
h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);const C=n.getRasterTextureSize();h.setUniform2fv("u_srcImageSize",C);({zFactor:w}=w.rasterFunction.parameters);n=n.getRasterCellSize();h.setUniform1f("u_zlFactor",200*w/n[0]/n[1])}}})},"esri/views/2d/engine/imagery/processor/extractBandProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,
h){return w.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);({bandIndexMat3:w}=w.rasterFunction.parameters);h.setUniformMatrix3fv("u_bandIndexMat3",w)}}})},"esri/views/2d/engine/imagery/processor/focalStatisticsProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/focalstatistics",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,
h){const {painter:n,rasterFunction:C}=w,{kernelRows:A,kernelCols:D,fillNoDataOnly:x,statisticsType:r}=C.parameters;w=[{name:"rows",value:A},{name:"cols",value:D},r];x&&w.push("fill");return n.materialManager.getProgram(E,w)},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);h.setUniform2fv("u_srcImageSize",[n.width,n.height]);({clampRange:w}=w.rasterFunction.parameters);h.setUniform2fv("u_clampRange",w)}}})},"esri/views/2d/engine/imagery/processor/localProcessor":function(){define(["./utils",
"../../../../webgl/contextUtils"],function(l,E){const w={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])},h=new Set("sinh cosh tanh asinh acosh atanh".split(" "));return{createProgram:function(n){const {painter:C,rasterFunction:A}=n,{imageCount:D,operationName:x,rasters:r,isOutputRounded:v}=A.parameters;var b=x.toLowerCase();n.context.type===E.ContextType.WEBGL1&&h.has(b)&&(b=`polyfill${b}`);n=[b];2===D&&n.push("twoImages");b=r.filter(t=>"Constant"===
t.name);b.length&&(n.push("oneConstant"),2===b.length&&n.push("twoConstant"));v&&n.push("roundOutput");return C.materialManager.getProgram(w,n)},bindTextureAndUniforms:function(n,C,A){l.setMultipleImageTextures(n,C,A);l.setCoordsAndTransforms(C);({domainRange:n}=n.rasterFunction.parameters);C.setUniform2fv("u_domainRange",n)}}})},"esri/views/2d/engine/imagery/processor/maskProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",
0],["a_texcoord",1]])};return{createProgram:function(w,h){const {painter:n,rasterFunction:C}=w;return n.materialManager.getProgram(E,1<C.parameters.bandCount?["multiBand"]:[])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);const {includedRanges:C,noDataValues:A}=w.rasterFunction.parameters;h.setUniform1fv("u_includedRanges",C);h.setUniform1fv("u_noDataValues",A)}}})},"esri/views/2d/engine/imagery/processor/ndviProcessor":function(){define(["./utils"],
function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){const {painter:n,rasterFunction:C}=w;return n.materialManager.getProgram(E,C.parameters.scaled?["scaled"]:[])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);({bandIndexMat3:w}=w.rasterFunction.parameters);h.setUniformMatrix3fv("u_bandIndexMat3",w)}}})},"esri/views/2d/engine/imagery/processor/remapProcessor":function(){define(["./utils"],
function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){return w.painter.materialManager.getProgram(E,[])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);const {noDataRanges:C,rangeMaps:A,allowUnmatched:D,clampRange:x}=w.rasterFunction.parameters;h.setUniform1fv("u_noDataRanges",C);h.setUniform1fv("u_rangeMaps",A);h.setUniform1f("u_unmatchMask",
D?1:0);h.setUniform2fv("u_clampRange",x)}}})},"esri/views/2d/engine/imagery/processor/reprojectProcessor":function(){define(["../../../../../chunks/vec2f64","../../../../webgl/rasterUtils"],function(l,E){const w={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(h,n){const {painter:C}=h,A=[],{interpolation:D,transformGrid:x}=n;n=!!h.rasterFunction?.parameters?.requireBilinear;h="bilinear"===D?!h.context.capabilities.textureFloat?.textureFloatLinear:
n;"cubic"===D?A.push("bicubic"):h&&A.push("bilinear");x&&(A.push("applyProjection"),1===x.spacing[0]&&A.push("lookupProjection"));return C.materialManager.getProgram(w,A)},bindTextureAndUniforms:function(h,n,C){const {names:A,textures:D}=C.getTextures({forProcessing:!0});E.setTextures(h.context,n,A,D);n.setUniform1f("u_scale",1);n.setUniform2fv("u_offset",[0,0]);n.setUniform2fv("u_coordScale",[1,1]);n.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]);n.setUniform1i("u_flipY",0);n.setUniform1f("u_opacity",
1);const {width:x,height:r,source:v,transformGrid:b}=C;n.setUniform2fv("u_srcImageSize",[v.width,v.height]);n.setUniform2fv("u_targetImageSize",[x,r]);n.setUniform2fv("u_transformSpacing",b?b.spacing:l.ZEROS);n.setUniform2fv("u_transformGridSize",b?b.size:l.ZEROS)}}})},"esri/views/2d/engine/imagery/processor/slopeProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,
h){const {painter:n,rasterFunction:C}=w;({slopeType:w}=C.parameters);return n.materialManager.getProgram(E,"percent-rise"===w?["percentRise"]:[])},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);const C=n.getRasterTextureSize();h.setUniform2fv("u_srcImageSize",C);n=n.getRasterCellSize();h.setUniform2fv("u_cellSize",n);const {zFactor:A,slopeType:D,pixelSizePower:x,pixelSizeFactor:r}=w.rasterFunction.parameters;h.setUniform1f("u_zFactor",A);h.setUniform1f("u_pixelSizePower",
"adjusted"===D?x:0);h.setUniform1f("u_pixelSizeFactor","adjusted"===D?r:0)}}})},"esri/views/2d/engine/imagery/processor/stretchProcessor":function(){define(["./utils"],function(l){const E={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(w,h){const {useGamma:n,bandCount:C,isOutputRounded:A}=w.rasterFunction.parameters;h=[];n&&h.push("useGamma");1<C&&h.push("multiBand");A&&h.push("roundOutput");return w.painter.materialManager.getProgram(E,
h)},bindTextureAndUniforms:function(w,h,n){l.setSingleImageTextures(w,h,n);l.setCoordsAndTransforms(h);const {width:C,height:A}=n;w=w.rasterFunction.parameters;h.setUniform2fv("u_srcImageSize",[C,A]);h.setUniform1f("u_minOutput",w.outMin);h.setUniform1f("u_maxOutput",w.outMax);h.setUniform1fv("u_factor",w.factor);h.setUniform1fv("u_minCutOff",w.minCutOff);h.setUniform1fv("u_maxCutOff",w.maxCutOff);h.setUniform1fv("u_gamma",w.gamma);h.setUniform1fv("u_gammaCorrection",w.gammaCorrection)}}})},"esri/views/2d/engine/imagery/RasterTile":function(){define(["exports",
"../../../../chunks/mat3f32","./RasterBitmap","../webgl/TiledDisplayObject"],function(l,E,w,h){class n extends h.TiledDisplayObject{constructor(C,A,D,x,r,v,b=null){super(C,A,D,x,r,v);this.bitmap=null;this.bitmap=new w.RasterBitmap(b,null,null);this.bitmap.coordScale=[r,v];this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy();this.bitmap.destroy();this.stage=this.bitmap=null}set stencilRef(C){this.bitmap.stencilRef=C}get stencilRef(){return this.bitmap.stencilRef}setTransform(C){super.setTransform(C);
this.bitmap.transforms.dvs=this.transforms.dvs}_createTransforms(){return{dvs:E.create(),tileMat3:E.create()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}l.RasterTile=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../geometry/Point ../../../../layers/support/PixelBlock ../../../../layers/support/TileInfo ../../../../layers/support/rasterDatasets/RawBlockCache ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/definitions ../../../webgl/capabilities ../../../../geometry/Extent".split(" "),
function(l,E,w,h,n,C,A,D,x,r,v,b,t,k,p,y,B,G,N,a,c,d,m,g){const q=[0,0];l.BaseImageryTileSubView2D=class extends h{constructor(){super(...arguments);this._updatingHandles=new b.UpdatingHandles;this._blockCacheRegistryId=this._blockCacheRegistryUrl=this._fetchQueue=this._tileInfoView=this._tileStrategy=this._emptyTilePixelBlock=null;this._srcResolutions=[];this.previousLOD=null;this._needBlockCacheUpdate=!1;this._abortController=this._symbolizerParams=this._globalSymbolizerParams=null;this._isCustomTilingScheme=
!1;this._maxIndexedColormapSize=0;this._rasterFunctionState="na";this.attached=this._globalUpdateRequested=!1;this.timeExtent=null;this.redrawOrRefetch=C.debounce(async(e={})=>{if(this.previousLOD&&!this.layerView.suspended){var u=this._rasterFunctionState;e.reprocess&&(await this._updatingHandles.addPromise(this.layer.updateRasterFunction()),this.updateRasterFunctionParameters());var z=this._rasterFunctionState,{type:H}=this;return e.refetch||"raster"!==H&&e.reprocess||"cpu"===z||"cpu"===u?this._updatingHandles.addPromise(this.doRefresh()):
this._updatingHandles.addPromise(this._redrawImage(e.signal))}})}destroy(){this._updatingHandles.destroy()}get useWebGLForProcessing(){return this._get("useWebGLForProcessing")??!0}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){return this._get("useProgressiveUpdate")??!0}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy();this.container.removeAllChildren();const u=this._getCacheSize(e);this._tileStrategy=
new c({cachePolicy:"purge",acquireTile:z=>this.acquireTile(z),releaseTile:z=>this.releaseTile(z),cacheSize:u,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",e);this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause();this._fetchQueue.state=e.state;this._tileStrategy.update(e);this._fetchQueue.resume();const {extent:u,resolution:z,scale:H}=e.state;e=this._tileInfoView.getClosestInfoForScale(H);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const J=
this._srcResolutions[e.level],I=u.toJSON?u:g.fromJSON(u);y.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,I,z,J,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;this.previousLOD?.level!==e.level&&(this.previousLOD=e,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){if(this.layerView.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),
this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.layerView.requestUpdate()});const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e);this.layerView.requestUpdate()}get updating(){return this._globalUpdateRequested||this._updatingHandles?.updating}attach(){var e=m.getWebGLCapabilities("2d");this._maxIndexedColormapSize=4*(e.maxTextureSize||4096);e.supportsTextureFloat||
(this.useWebGLForProcessing=!1);this._initializeTileInfo();this._tileInfoView=new G(this.layerView.tileInfo,this.layerView.fullExtent);e=this._computeFetchConcurrency();this._fetchQueue=new a({tileInfoView:this._tileInfoView,concurrency:e,process:(u,z)=>this._fetchTile(u,z)});e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new c({cachePolicy:"purge",acquireTile:u=>this.acquireTile(u),releaseTile:u=>this.releaseTile(u),cacheSize:e,tileInfoView:this._tileInfoView});this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy();
this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;y.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){e=this.container.createTile(e);this._updatingHandles.addPromise(this._enqueueTileFetch(e));this.layerView.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;
return e}releaseTile(e){this._fetchQueue.abort(e.key.id);this.container.removeChild(e);e.once("detach",()=>{e.destroy();this.layerView.requestUpdate()});this.layerView.requestUpdate()}createEmptyTilePixelBlock(e=null){const u=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(u&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const [z,H]=e;e=new k({width:z,height:H,pixels:[new Uint8Array(z*H)],mask:new Uint8Array(z*H),pixelType:"u8"});
u&&(this._emptyTilePixelBlock=e);return e}_getBandIds(){if(!("rasterFunctionChain"in this.container&&this.container.rasterFunctionChain))return this.layer.bandIds;const {bandIds:e,raster:u}=this.layer,z="rasterFunction"in u?u.rasterFunction.rawInputBandIds:null;return e?.length&&z?.length&&1!==u.rasterInfo.bandCount?e.map(H=>z[Math.min(H,z.length-1)]):e||z}updateRasterFunctionParameters(){}_fetchTile(e,u){u=null!=u?u.signal:null;const z=this.canUseWebGLForProcessing(),{layerView:H}=this,{tileInfo:J}=
H,I=!J.isWrappable&&null!=B.getWorldWidth(H.view.spatialReference);return this.fetchTile(e,{allowPartialFill:!0,datumTransformation:H.datumTransformation,interpolation:z?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:z&&this.layer.raster.hasUniqueSourceStorageInfo,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:u,srcResolution:this._srcResolutions[e.level],timeExtent:H.timeExtent,tileInfo:J,disableWrapAround:I})}_getCacheSize(e){return e?
40:0}_initializeTileInfo(){const {layerView:e}=this;var u=e.view.spatialReference;if(this._canUseLayerLODs()){const {origin:U,lods:R}=this.layer.tileInfo;var z=R.map(({scale:Y})=>Y);u=p.create({spatialReference:u,size:d.tileSize,scales:z,origin:U});e.set("tileInfo",u);this._srcResolutions=R.map(({resolution:Y})=>({x:Y,y:Y}))}else{var {scales:H,srcResolutions:J,isCustomTilingScheme:I}=B.computeProjectedScales(this.layer.rasterInfo,u,{tileSize:d.tileSize,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1});
z=p.create({spatialReference:u,size:d.tileSize,scales:H});var K=0===z.origin.x,{xmin:M,ymax:S}=e.fullExtent;if(K||I&&z.origin.x>M)z.origin=new t({x:M,y:S,spatialReference:u});this._isCustomTilingScheme=I;e.set("tileInfo",z);this._srcResolutions=J??[]}}_canUseLayerLODs(){const {layer:e,layerView:u}=this;if("Map"!==e.raster.tileType)return!1;const {lods:z}=e.tileInfo,H=u.view.constraints?.effectiveLODs;return H?.length===z.length&&H.every(({scale:J},I)=>.001>Math.abs(J-z[I].scale))}_computeFetchConcurrency(){var {blockBoundary:e}=
this.layer.rasterInfo.storageInfo;e=e[e.length-1];return 64<(e.maxCol-e.minCol+1)*(e.maxRow-e.minRow+1)?2:10}async _enqueueTileFetch(e,u){if(!this._fetchQueue.has(e.key.id)){try{const z=await this._fetchQueue.push(e.key),H=this._getBandIds();let J=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){J=!1;try{await this._redrawImage(this._abortController?.signal)}catch(M){C.isAbortError(M)&&
n.getLogger(this).error(M)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const I=this._tileInfoView.getTileCoords(q,e.key),K=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:z,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:J,bandIds:H,coords:I,resolution:K});e.once("attach",()=>
this.layerView.requestUpdate());this.container.addChild(e)}catch(z){C.isAbortError(z)||n.getLogger(this).error(z)}this.layerView.requestUpdate()}}async _redrawImage(e){0!==this.container.children.length&&(await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null),e=this.container.children.map(async u=>this.updateTileSymbolizerParameters(u,{local:this._symbolizerParams,global:this._globalSymbolizerParams})),
await Promise.allSettled(e),this.container.requestRender())}async _updateGlobalSymbolizerParams(e){e=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:e});if(e?.pixelBlock){var {resolution:u}=this.previousLOD,z=this._getBandIds();e=this.layer.symbolizer.generateWebGLParameters({pixelBlock:e.pixelBlock.extractBands(z),isGCS:this.layerView.view.spatialReference.isGeographic,
resolution:{x:u,y:u},bandIds:z});!this.canUseWebGLForProcessing()&&e&&"stretch"===e.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(e.factor=e.factor.map(H=>255*H),e.outMin=Math.round(255*e.outMin),e.outMax=Math.round(255*e.outMax));this._globalSymbolizerParams=e}}_updateSymbolizerParams(){const {resolution:e}=this.previousLOD,u=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,
resolution:{x:e,y:e},bandIds:u})}_updateBlockCacheRegistry(e=!1){const {layer:u,layerView:z}=this,{url:H,raster:J}=u;var {multidimensionalDefinition:I}=u.normalizeRasterFetchOptions({multidimensionalDefinition:u.multidimensionalDefinition,timeExtent:z.timeExtent});I=J.rasterInfo.multidimensionalInfo?J.getSliceIndex(I):null;I=y.getRasterId(H,I);if(I!==this._blockCacheRegistryUrl){null!=this._blockCacheRegistryUrl&&y.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryId=
y.register(I,J.rasterInfo);if(e){({view:e}=z);const K=this._tileInfoView.getClosestInfoForScale(e.scale);y.update(I,this._blockCacheRegistryId,e.extent,e.resolution,this._srcResolutions[K.level],J.ioConfig.sampling)}this._blockCacheRegistryUrl=I}}async doRefresh(){if(this.attached){await this.layer.updateRenderer();this.layerView.hasTilingEffects||this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();var e=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||
!this.useProgressiveUpdate;this._tileStrategy.refresh(u=>e.push(this._enqueueTileFetch(u)));await this._updatingHandles.addPromise(Promise.allSettled(e))}}};E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"_globalUpdateRequested",void 0);E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"attached",void 0);E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"container",void 0);E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"layer",void 0);
E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"layerView",void 0);E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"type",void 0);E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",null);E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null);E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,"timeExtent",void 0);E.__decorate([A.property()],l.BaseImageryTileSubView2D.prototype,
"updating",null);l.BaseImageryTileSubView2D=E.__decorate([v.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],l.BaseImageryTileSubView2D);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),
function(l,E,w,h,n,C,A,D,x,r){var v;w=v=class extends w.JSONSupport{static createEmptyBand(b,t){return new (v.getPixelArrayConstructor(b))(t)}static getPixelArrayConstructor(b){let t;switch(b){case "u1":case "u2":case "u4":case "u8":t=Uint8Array;break;case "u16":t=Uint16Array;break;case "u32":t=Uint32Array;break;case "s8":t=Int8Array;break;case "s16":t=Int16Array;break;case "s32":t=Int32Array;break;case "f32":t=Float32Array;break;case "f64":t=Float64Array;break;case "c64":case "c128":case "unknown":t=
Float32Array}return t}constructor(b){super(b);this.height=this.width=null;this.pixelType="f32";this.mask=this.validPixelCount=null;this.premultiplyAlpha=this.maskIsAlpha=!1;this.statistics=null;this.depthCount=1}castPixelType(b){if(!b)return"f32";b=b.toLowerCase();["u1","u2","u4"].includes(b)?b="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(b)||(b="f32");return b}getPlaneCount(){return this.pixels?.length}addData(b){if(!b.pixels||b.pixels.length!==this.width*this.height)throw new E("pixelblock:invalid-or-missing-pixels",
"add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(b.pixels);this.statistics.push(b.statistics??new x.SimpleBandStatistics)}getAsRGBA(){const b=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(b);break;default:this._fillFrom8Bit(b)}return new Uint8ClampedArray(b)}getAsRGBAFloat(){const b=
new Float32Array(this.width*this.height*4);this._fillFrom32Bit(b);return b}updateStatistics(){if(this.pixels){this.statistics=this.pixels.map(k=>this._calculateBandStatistics(k,this.mask));var b=this.mask,t=0;if(null!=b)for(let k=0;k<b.length;k++)b[k]&&t++;else t=this.width*this.height;this.validPixelCount=t}}clamp(b){if(b&&"f64"!==b&&"f32"!==b&&this.pixels){var [t,k]=r.getPixelValueRange(b),p=this.pixels,y=this.width*this.height,B=p.length,G=[];for(let d=0;d<B;d++){var N=v.createEmptyBand(b,y);var a=
p[d];for(let m=0;m<y;m++){var c=a[m];N[m]=c>k?k:c<t?t:c}G.push(N)}this.pixels=G;this.pixelType=b}}extractBands(b){const {pixels:t,statistics:k}=this;if(null==b||0===b.length||!t||0===t.length)return this;var p=t.length,y=b.some(d=>d>=t.length),B=p===b.length&&!b.some((d,m)=>d!==m);if(y||B)return this;p=this.bandMasks?.length===p?b.map(d=>this.bandMasks[d]):void 0;let {mask:G,validPixelCount:N}=this;const {width:a,height:c}=this;if(p){if(1===p.length)G=p[0];else for(y=a*c,G=(new Uint8Array(y)).fill(255),
B=0;B<p.length;B++){const d=p[B];for(let m=0;m<y;m++)d[m]||(G[m]=0)}N=G.filter(d=>!!d).length}return new v({pixelType:this.pixelType,width:a,height:c,mask:G,bandMasks:p,validPixelCount:N,maskIsAlpha:this.maskIsAlpha,pixels:b.map(d=>t[d]),statistics:k&&b.map(d=>k[d])})}clone(){const b=new v({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});null!=this.mask&&(b.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):
this.mask.slice(0));this.bandMasks&&(b.bandMasks=this.bandMasks.map(p=>new Uint8Array(p)));let t;const k=v.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){b.pixels=[];const p=!!this.pixels[0].slice;for(t=0;t<this.pixels.length;t++)b.pixels[t]=p?this.pixels[t].slice(0,this.pixels[t].length):new k(this.pixels[t])}if(this.statistics)for(b.statistics=[],t=0;t<this.statistics.length;t++)b.statistics[t]=h.clone(this.statistics[t]);b.premultiplyAlpha=this.premultiplyAlpha;
return b}_fillFrom8Bit(b){const {mask:t,maskIsAlpha:k,premultiplyAlpha:p,pixels:y}=this;if(b&&y?.length){var B,G;var N=B=G=y[0];3<=y.length?(B=y[1],G=y[2]):2===y.length&&(B=y[1]);var a=new Uint32Array(b),c=this.width*this.height;if(N.length!==c)n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=t&&t.length===c)if(k)for(b=0;b<c;b++){const d=t[b];if(d){const m=d/255;a[b]=p?d<<24|G[b]*m<<16|B[b]*m<<8|N[b]*m:d<<24|G[b]<<16|B[b]<<8|N[b]}}else for(b=
0;b<c;b++)t[b]&&(a[b]=-16777216|G[b]<<16|B[b]<<8|N[b]);else for(b=0;b<c;b++)a[b]=-16777216|G[b]<<16|B[b]<<8|N[b]}else n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFromNon8Bit(b){const {pixels:t,mask:k,statistics:p}=this;if(b&&t?.length){var y=this.pixelType,B=1,G=0;B=1;if(p&&0<p.length){for(var N of p)null!=N.minValue&&(G=Math.min(G,N.minValue)),null!=N.maxValue&&null!=N.minValue&&(B=Math.max(B,N.maxValue-N.minValue));B=255/B}else B=255,
"s8"===y?(G=-128,B=127):"u16"===y?B=65535:"s16"===y?(G=-32768,B=32767):"u32"===y?B=4294967295:"s32"===y?(G=-2147483648,B=2147483647):"f32"===y?(G=-3.4*1E39,B=3.4*1E39):"f64"===y&&(G=-Number.MAX_VALUE,B=Number.MAX_VALUE),B=255/(B-G);b=new Uint32Array(b);y=this.width*this.height;var a,c,d;N=a=c=t[0];if(N.length!==y)return n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=t.length)if(a=t[1],3<=t.length&&(c=t[2]),null!=k&&k.length===y)for(d=0;d<y;d++)k[d]&&
(b[d]=-16777216|(c[d]-G)*B<<16|(a[d]-G)*B<<8|(N[d]-G)*B);else for(d=0;d<y;d++)b[d]=-16777216|(c[d]-G)*B<<16|(a[d]-G)*B<<8|(N[d]-G)*B;else if(null!=k&&k.length===y)for(d=0;d<y;d++)a=(N[d]-G)*B,k[d]&&(b[d]=-16777216|a<<16|a<<8|a);else for(d=0;d<y;d++)a=(N[d]-G)*B,b[d]=-16777216|a<<16|a<<8|a}else n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFrom32Bit(b){const {pixels:t,mask:k}=this;if(!b||!t?.length)return n.getLogger(this).error("getAsRGBAFloat()",
"Unable to convert to RGBA. The input pixel block is empty.");let p,y,B,G;p=y=B=t[0];3<=t.length?(y=t[1],B=t[2]):2===t.length&&(y=t[1]);const N=this.width*this.height;if(p.length!==N)return n.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let a=0;if(null!=k&&k.length===N)for(G=0;G<N;G++)b[a++]=p[G],b[a++]=y[G],b[a++]=B[G],b[a++]=k[G]&1;else for(G=0;G<N;G++)b[a++]=p[G],b[a++]=y[G],b[a++]=B[G],b[a++]=1}_calculateBandStatistics(b,t){let k=Infinity,p=
-Infinity;const y=b.length;let B,G=0;if(null!=t)for(B=0;B<y;B++)t[B]&&(G=b[B],k=G<k?G:k,p=G>p?G:p);else for(B=0;B<y;B++)G=b[B],k=G<k?G:k,p=G>p?G:p;return new x.SimpleBandStatistics(k,p)}};l.__decorate([C.property({json:{write:!0}})],w.prototype,"width",void 0);l.__decorate([C.property({json:{write:!0}})],w.prototype,"height",void 0);l.__decorate([C.property({json:{write:!0}})],w.prototype,"pixelType",void 0);l.__decorate([A.cast("pixelType")],w.prototype,"castPixelType",null);l.__decorate([C.property({json:{write:!0}})],
w.prototype,"validPixelCount",void 0);l.__decorate([C.property({json:{write:!0}})],w.prototype,"mask",void 0);l.__decorate([C.property({json:{write:!0}})],w.prototype,"maskIsAlpha",void 0);l.__decorate([C.property({json:{write:!0}})],w.prototype,"pixels",void 0);l.__decorate([C.property()],w.prototype,"premultiplyAlpha",void 0);l.__decorate([C.property({json:{write:!0}})],w.prototype,"statistics",void 0);l.__decorate([C.property({json:{write:!0}})],w.prototype,"depthCount",void 0);l.__decorate([C.property({json:{write:!0}})],
w.prototype,"noDataValues",void 0);l.__decorate([C.property({json:{write:!0}})],w.prototype,"bandMasks",void 0);return w=v=l.__decorate([D.subclass("esri.layers.support.PixelBlock")],w)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(l){class E{constructor(w=null,h=null,n=null){this.minValue=w;this.maxValue=h;this.noDataValue=n}}l.SimpleBandStatistics=E;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],
function(l){function E(h){return w[h]??[-3.4028234663852886E38,3.4028234663852886E38]}const w={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};l.convertNoDataToMask=function(h,n,C){if(!(h.depthCount&&1<h.depthCount)){var {pixels:A,statistics:D,pixelType:x}=h,r=A[0].length,v=h.bandMasks??
[];r=h.mask??(new Uint8Array(r)).fill(255);var b="f32"===x||"f64"===x,t=E(x),k=!1;for(let B=0;B<A.length;B++){const G="number"===typeof n?n:n[B];if(null==G)continue;var p=D?.[B]?.maxValue??t[1];if((D?.[B]?.minValue??t[0])>G+Number.EPSILON||p<G-Number.EPSILON)continue;p=v[B]||r.slice();const N=A[B];var y=C?.customFloatTolerance;if(b&&0!==y){y||(y=9.999999E37<=Math.abs(G)?2E-7*Math.abs(G):"f32"===x?2**-23:Number.EPSILON);for(let a=0;a<N.length;a++)p[a]&&Math.abs(N[a]-G)<y&&(N[a]=0,p[a]=0,r[a]=0,k=!0)}else for(y=
0;y<N.length;y++)p[y]&&N[y]===G&&(N[y]=0,p[y]=0,r[y]=0,k=!0);v[B]=p}k&&(h.bandMasks=h.bandMasks||1<h.pixels.length?v:null,h.mask=r);k&&"updateStatistics"in h&&h.updateStatistics()}};l.getPixelValueRange=E;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["exports","../../../geometry","./EphemeralBlockCache","../rasterFunctions/rasterProjectionHelper","../../../geometry/Point"],function(l,E,w,h,n){function C(x,r){return(x=
A.get(x))?x[r]??null:null}const A=new Map,D=new w;l.decreaseRefCount=function(x,r,v){const b=A.get(x);if(!b)return null==r?D.decreaseRefCount(x,v):0;if(null==r||null==b[r])return D.decreaseRefCount(x,v);r=b[r]?.cache;x=r?.get(v);if(r&&x){x.refCount--;if(0===x.refCount){r.delete(v);for(r=0;r<b.length;r++)b[r]?.cache.delete(v);x.controller&&x.controller.abort()}return x.refCount}return 0};l.deleteBlock=function(x,r,v){const b=A.get(x);b?null==r||null==b[r]?D.deleteBlock(x,v):b[r]?.cache.delete(v):null==
r&&D.deleteBlock(x,v)};l.deleteRaster=function(x){A.delete(x)};l.getBlock=function(x,r,v){const b=A.get(x);if(!b)return null==r?D.getBlock(x,v):null;if(null==r||null==b[r]){for(r=0;r<b.length;r++){var t=b[r]?.cache.get(v);if(t)return t.refCount++,t.block}return D.getBlock(x,v)}if(x=b[r]?.cache.get(v))return x.refCount++,x.block;for(x=0;x<b.length;x++){if(x===r||!b[x])continue;t=b[x]?.cache;const k=t?.get(v);if(t&&k)return k.refCount++,t.set(v,k),k.block}return null};l.getRasterId=function(x,r){return null==
r?x:`${x}?sliceId=${r}`};l.putBlock=function(x,r,v,b,t=null){const k=A.get(x);if(k)if(null==r||null==k[r])D.putBlock(x,v,b,t);else{var p={refCount:1,block:b,isResolved:!1,isRejected:!1,controller:t};b.then(()=>p.isResolved=!0).catch(()=>p.isRejected=!0);k[r]?.cache.set(v,p)}else null==r&&D.putBlock(x,v,b,t)};l.register=function(x,r){r={extent:null,rasterInfo:r,cache:new Map};const v=A.get(x);if(v)return v.push(r),v.length-1;A.set(x,[r]);return 0};l.unregister=function(x,r){const v=A.get(x);v&&(v[r]=
null,v.some(b=>null!=b)||A.delete(x))};l.update=function(x,r,v,b,t,k,p=null){if(x=C(x,r)){r=x.extent;var {cache:y,rasterInfo:B}=x;if(!r||r.xmin!==v.xmin||r.xmax!==v.xmax||r.ymin!==v.ymin||r.ymax!==v.ymax){b=b??0;r=v.clone().normalize();var {spatialReference:G,transform:N}=B,a=new Set;for(let e=0;e<r.length;e++){var c=r[e];if(c.xmax-c.xmin<=b||c.ymax-c.ymin<=b)continue;var d=h.projectExtent(c,G,p);null!=N&&(d=N.inverseTransform(d));var m=new n({x:b,y:b,spatialReference:c.spatialReference});if(null==
t&&(t=h.projectResolution(m,G,c,p),!t))return;const {pyramidLevel:u,pyramidResolution:z,excessiveReading:H}=h.snapPyramid(t,B,k||"closest");if(H)return;({storageInfo:c}=B);var {origin:g}=c;m=Math.max(0,Math.floor((d.xmin-g.x)/z.x));g=Math.max(0,Math.floor((g.y-d.ymax)/z.y));const J=0<u?c.pyramidBlockWidth:c.blockWidth,I=0<u?c.pyramidBlockHeight:c.blockHeight;c=Math.max(0,Math.floor(m/J)-1);var q=Math.max(0,Math.floor(g/I)-1);m=Math.floor((m+Math.ceil((d.xmax-d.xmin)/z.x-.1)-1)/J)+1;d=Math.floor((g+
Math.ceil((d.ymax-d.ymin)/z.y-.1)-1)/I)+1;for(g=q;g<=d;g++)for(q=c;q<=m;q++)a.add(`${u}/${g}/${q}`)}y.forEach((e,u)=>{a.has(u)||(e=y.get(u),(null==e||e.isResolved||e.isRejected)&&y.delete(u))});x.extent={xmin:v.xmin,ymin:v.ymin,xmax:v.xmax,ymax:v.ymax}}}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){class l{constructor(E=15E3,w=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=
E;this._interval=Math.min(E,w)}decreaseRefCount(E,w){E=E+"/"+w;w=this._cachedBlocks;if(w.has(E)){const h=w.get(E);h.refCount--;0>=h.refCount&&(w.delete(E),h.controller&&h.controller.abort());return h.refCount}return 0}getBlock(E,w){E=E+"/"+w;w=this._cachedBlocks;if(w.has(E)){const h=w.get(E);h.ts=Date.now();h.refCount++;w.delete(E);w.set(E,h);return h.block}return null}putBlock(E,w,h,n){const C=this._cachedBlocks;E=E+"/"+w;C.has(E)?(h=C.get(E),h.ts=Date.now(),h.refCount++):C.set(E,{block:h,ts:Date.now(),
refCount:1,controller:n});this._trim();this._updateTimer()}deleteBlock(E,w){const h=this._cachedBlocks;E=E+"/"+w;h.has(E)&&h.delete(E)}updateMaxSize(E){this._size=E;this._trim()}empty(){this._cachedBlocks.clear();this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null==this._timer){var E=this._cachedBlocks;this._timer=setInterval(()=>{const w=Array.from(E),h=Date.now();for(let n=0;n<w.length;n++)if(w[n][1].ts<=h-this._duration)E.delete(w[n][0]);else break;0===E.size&&
this._clearTimer()},this._interval)}}_trim(){const E=this._cachedBlocks;if(!(-1===this._size||this._size>=E.size)){var w=Array.from(E);for(let h=0;h<w.length-this._size;h++)E.delete(w[h][0])}}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}return l})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(l,E,w,h,n,C,A,D,x,r,v,b){function t(f,F,L){return!A.canProjectWithoutEngine(f,F,L)}function k(f,F,L){if((f=t(f,F,L))&&!A.isLoaded())throw new h("rasterprojectionhelper-project","projection engine is not loaded");return f}function p(f,F,L){k(f.spatialReference,F);return L?A.getTransformation(F,f.spatialReference,f):A.getTransformation(f.spatialReference,F,f)}function y(f,F,L,O=null){const T=f.spatialReference;if(T.equals(F))return f;k(T,F,O);L=L.center;L=new x({xmin:L.x-f.x/2,xmax:L.x+f.x/
2,ymin:L.y-f.y/2,ymax:L.y+f.y/2,spatialReference:T});O=A.project(L,F,O);L=I(F);null==O||null!=L&&O.width>=L?(F=n.getMetersPerUnitForSR(T)/n.getMetersPerUnitForSR(F),f={x:f.x*F,y:f.y*F}):f={x:O.width,y:O.height};return f}function B(f,F=.01){return n.getMetersPerUnitForSR(f)?F/n.getMetersPerUnitForSR(f):0}function G(f,F,L=null,O=!0){const T=f.spatialReference;if(T.equals(F))return f;k(T,F,L);L=A.project(f,F,L);if(!O||!L)return L;N([f],[L],T,F);return L}function N(f,F,L,O){const T=K(L,!0),P=K(O,!0);
L=B(L,500);O=B(O,500);if(L&&null!=T&&null!=P)for(let V=0;V<f.length;V++){const W=F[V];if(!W)continue;const {x:Q}=f[V],{x:da}=W;da>=P[1]-O&&Math.abs(Q-T[0])<L?W.x-=P[1]-P[0]:da<=P[0]+O&&Math.abs(Q-T[1])<L&&(W.x+=P[1]-P[0])}}function a(f){const {inSR:F,outSR:L,datumTransformation:O,preferPE:T}=f;if(F.equals(L))return{points:f}=q(f,null),f;if(F.isWebMercator&&L.isWGS84||F.isWGS84&&L.isWebMercator){const {cols:Q,rows:da,xres:Z,yres:ja,usePixelCenter:ia,inSR:ha,outSR:la}=f;let {xmin:ma,ymax:na}=f;ia&&
(ma+=Z/2,na-=ja/2);f=[];const fa=[];var P=Math.max(Q,da);for(var V=0;V<P;V++){var W=A.project(new r({x:ma+Z*Math.min(Q,V),y:na-ja*Math.min(da,V),spatialReference:ha}),la);V<=Q&&f.push(W.x);V<=da&&fa.push(W.y)}P=[];for(V=0;V<Q;V++)for(W=0;W<da;W++)P.push([f[V],fa[W]]);return P}return k(F,L,O)&&T&&(F.isGeographic||null!=m(F))?d(f):c(f)}function c(f){var {points:F}=q(f,null);const {inSR:L,outSR:O,datumTransformation:T}=f;f=F.map(P=>new r(P[0],P[1],L));F=A.project(f,O,T);T&&N(f,F,L,O);return F.map(P=>
P?[P.x,P.y]:[NaN,NaN])}function d(f){const {inSR:F,outSR:L,datumTransformation:O}=f;var T=m(F);const {points:P,mask:V}=q(f,T);F.isGeographic||(f=F.wkid?C.PeFactory.coordsys(F.wkid):C.PeFactory.fromString(F.isGeographic?C.PeDefs.PE_TYPE_GEOGCS:C.PeDefs.PE_TYPE_PROJCS,F.wkt2||F.wkt),C.PeCSTransformations.projToGeog(f,P.length,P));if(null!=O&&O.steps.length){var W;L.isGeographic&&(W=P.map(([Q])=>179.9955<Q?1:-179.9955>Q?-1:0));O.steps.forEach(Q=>{const da=Q.wkid?C.PeFactory.geogtran(Q.wkid):C.PeFactory.fromString(C.PeDefs.PE_TYPE_GEOGTRAN,
Q.wkt);C.PeGTTransformations.geogToGeog(da,P.length,P,null,Q.isInverse?C.PeDefs.PE_TRANSFORM_2_TO_1:C.PeDefs.PE_TRANSFORM_1_TO_2)});if(W)for(f=0;f<P.length;f++){T=W[f];const Q=P[f][0],da=179.9955<Q?1:-179.9955>Q?-1:0;T&&da&&T!==da&&(P[f][0]=0<T?Q+360:Q-360)}}L.isGeographic||(W=m(L,!0),e(P,null!=W&&W.isEnvelope?[W.bbox[1],W.bbox[3]]:[-90,90]),W=L.wkid?C.PeFactory.coordsys(L.wkid):C.PeFactory.fromString(L.isGeographic?C.PeDefs.PE_TYPE_GEOGCS:C.PeDefs.PE_TYPE_PROJCS,L.wkt2||L.wkt),C.PeCSTransformations.geogToProj(W,
P.length,P));W=P;if(V&&P.length!==V.length){W=[];for(let Q=0,da=0;Q<V.length;Q++)V[Q]?W.push(P[da++]):W.push([NaN,NaN])}return W}function m(f,F=!1){var L=f.wkid||f.wkt2||f.wkt;if(!L||f.isGeographic)return null;L=String(L);if(ea.has(L))return L=ea.get(L),F?L?.gcs:L?.pcs;var O=f.wkid?C.PeFactory.coordsys(f.wkid):C.PeFactory.fromString(f.isGeographic?C.PeDefs.PE_TYPE_GEOGCS:C.PeDefs.PE_TYPE_PROJCS,f.wkt2||f.wkt);f=B(f,1E-4);f=g(O,f);O=g(O,0,!0);ea.set(L,{pcs:f,gcs:O});return F?O:f}function g(f,F=0,L=
!1){var O=C.PePCSInfo.generate(f),T=L?f.horizonGcsGenerate():f.horizonPcsGenerate();if(!O||!T?.length)return null;f=!1;var P=T.find(Z=>1===Z.getInclusive()&&1===Z.getKind());if(!P){P=T.find(Z=>1===Z.getInclusive()&&0===Z.getKind());if(!P)return null;f=!0}L=L?0:(2===O.getNorthPoleLocation()?1:0)|(2===O.getSouthPoleLocation()?2:0);O=O.isPannableRectangle();P=P.getCoord();if(f)return{isEnvelope:f,isPannable:O,vertices:P,coef:null,bbox:[P[0][0]-F,P[0][1]-F,P[1][0]+F,P[1][1]+F],poleLocation:L};F=0;f=[];
let [V,W]=P[0],[Q,da]=P[0];for(let Z=0,ja=P.length;Z<ja;Z++){F++;F===ja&&(F=0);const [ia,ha]=P[Z],[la,ma]=P[F];if(ma===ha)f.push([ia,la,ha,ma,2]);else{T=(la-ia)/(ma-ha||1E-4);const na=ia-T*ha;ha<ma?f.push([T,na,ha,ma,0]):f.push([T,na,ma,ha,1])}V=V<ia?V:ia;W=W<ha?W:ha;Q=Q>ia?Q:ia;da=da>ha?da:ha}return{isEnvelope:!1,isPannable:O,vertices:P,coef:f,bbox:[V,W,Q,da],poleLocation:L}}function q(f,F){const L=[],{cols:O,rows:T,xres:P,yres:V,usePixelCenter:W}=f;let {xmin:Q,ymax:da}=f;W&&(Q+=P/2,da-=V/2);if(null==
F){for(f=0;f<O;f++)for(F=0;F<T;F++)L.push([Q+P*f,da-V*F]);return{points:L}}f=new Uint8Array(O*T);if(F.isEnvelope){const {bbox:[na,fa,pa,qa]}=F;for(let ra=0,sa=0;ra<O;ra++){var Z=Q+P*ra,ja=F.isPannable||Z>=na&&Z<=pa;for(var ia=0;ia<T;ia++,sa++){var ha=da-V*ia;ja&&ha>=fa&&ha<=qa&&(L.push([Z,ha]),f[sa]=1)}}return{points:L,mask:f}}Z=F.coef;F=[];for(ja=0;ja<T;ja++){var la=da-V*ja;ia=[];ha=[];for(var ma=0;ma<Z.length;ma++){const [na,fa,pa,qa,ra]=Z[ma];la===pa&&pa===qa?(ia.push(na),ia.push(fa),ha.push(2),
ha.push(2)):la>=pa&&la<=qa&&(ia.push(na*la+fa),ha.push(ra))}la=ia;if(2<ia.length){ma=2===ha[0]?0:ha[0];let na=ia[0];la=[];for(let fa=1;fa<ha.length;fa++)if(2!==ha[fa]||fa===ha.length-1)ha[fa]!==ma&&(la.push(0===ma?Math.min(na,ia[fa-1]):Math.max(na,ia[fa-1])),ma=ha[fa],na=ia[fa]),fa===ha.length-1&&la.push(0===ha[fa]?Math.min(na,ia[fa]):Math.max(na,ia[fa]));la.sort((fa,pa)=>fa-pa)}else ia[0]>ia[1]&&(la=[ia[1],ia[0]]);F.push(la)}for(let na=0,fa=0;na<O;na++)for(Z=Q+P*na,ja=0;ja<T;ja++,fa++)if(ia=da-V*
ja,ha=F[ja],2===ha.length)Z>=ha[0]&&Z<=ha[1]&&(L.push([Z,ia]),f[fa]=1);else if(2<ha.length){la=!1;for(ma=0;ma<ha.length;ma+=2)if(Z>=ha[ma]&&Z<=ha[ma+1]){la=!0;break}la&&(L.push([Z,ia]),f[fa]=1)}return{points:L,mask:f}}function e(f,F){const [L,O]=F;for(F=0;F<f.length;F++){const T=f[F][1];if(T<L||T>O)f[F]=[NaN,NaN]}}function u(f,F){const L=I(f[0].spatialReference);if(2>f.length||null==L)return f[0];F=F??B(f[0].spatialReference);f=f.filter(W=>W.width>F);if(1===f.length)return f[0];let {xmin:O,xmax:T,
ymin:P,ymax:V}=f[0];for(let W=1;W<f.length;W++){const Q=f[W];T=Q.xmax+L*W;P=Math.min(P,Q.ymin);V=Math.max(V,Q.ymax)}return new x({xmin:O,xmax:T,ymin:P,ymax:V,spatialReference:f[0].spatialReference})}function z(f,F,L=null,O=!0){var T=f.spatialReference;if(T.equals(F))return f;var P=S(f);const V=I(T,!0);var W=I(F);if(0===P||null==V||null==W)return P=J(f,F,L,O),null==V&&null!=W&&Math.abs(P.width-W)<B(F)&&A.isLoaded()&&(T=m(T),null!=T&&T.poleLocation===ca.None&&f.width<(T.bbox[2]-T.bbox[0])/2)?H(f,F)||
P:P;W=f.clone().normalize();if(1===W.length&&f.xmax<V&&f.xmax-V/2>B(T)){const {xmin:Q,xmax:da}=f;for(let Z=0;Z<=P;Z++)W[Z]=new x({xmin:0===Z?Q:-V/2,xmax:Z===P?da-V*Z:V/2,ymin:f.ymin,ymax:f.ymax,spatialReference:T})}f=W.map(Q=>J(Q,F,L,O));return u(f.filter(w.isSome))}function H(f,F){const L=I(F);if(null==L)return null;let {xmin:O,ymin:T,xmax:P,ymax:V}=f;var W=f.spatialReference;f=new v({spatialReference:W,rings:[[[O,T],[P,T],[P,V],[O,V],[O,T]]]});f=A.project(f,F);if(2!==f.rings.length||!f.rings[0].length||
!f.rings[1].length)return null;({rings:f}=f);W=B(W);F=new x({spatialReference:F});for(let Q=0;2>Q;Q++){O=P=f[Q][0][0];T=V=f[Q][0][1];for(let da=0;da<f[Q].length;da++)O=O>f[Q][da][0]?f[Q][da][0]:O,P=P<f[Q][da][0]?f[Q][da][0]:P,T=T>f[Q][da][1]?f[Q][da][1]:T,V=V<f[Q][da][1]?f[Q][da][1]:V;if(0===Q)F.ymin=T,F.ymax=V,F.xmin=O,F.xmax=P;else if(F.ymin=Math.min(F.ymin,T),F.ymax=Math.max(F.ymax,V),Math.abs(P-L/2)<W)F.xmin=O,F.xmax+=L;else if(Math.abs(O+L/2)<W)F.xmax=P+L;else return null}return F}function J(f,
F,L=null,O=!0,T=!0){const P=f.spatialReference;if(P.equals(F)||!F)return f;k(P,F,L);const V=A.project(f,F,L);if(T&&F.isWebMercator&&V&&(V.ymax=Math.min(2.0037508342787E7,V.ymax),V.ymin=Math.max(-2.0037508342787E7,V.ymin),V.ymin>=V.ymax))return null;if(!O||!V)return V;var W=K(P,!0);O=K(F,!0);if(null==W||null==O)return V;T=B(P,.001);const Q=B(P,500);var da=B(F,.001);if(Math.abs(V.xmin-O[0])<da&&Math.abs(V.xmax-O[1])<da){da=Math.abs(f.xmin-W[0]);W=Math.abs(W[1]-f.xmax);if(da<T&&W>Q){V.xmin=O[0];var Z=
[];Z.push(new r(f.xmax,f.ymin,P));Z.push(new r(f.xmax,(f.ymin+f.ymax)/2,P));Z.push(new r(f.xmax,f.ymax,P));Z=Z.map(ja=>G(ja,F,L)).filter(ja=>!isNaN(ja?.x)).map(ja=>ja.x);V.xmax=Math.max.apply(null,Z)}W<T&&da>Q&&(V.xmax=O[1],O=[],O.push(new r(f.xmin,f.ymin,P)),O.push(new r(f.xmin,(f.ymin+f.ymax)/2,P)),O.push(new r(f.xmin,f.ymax,P)),f=O.map(ja=>G(ja,F,L)).filter(ja=>!isNaN(ja?.x)).map(ja=>ja.x),V.xmin=Math.min.apply(null,f))}else f=B(F,.001),Math.abs(V.xmin-O[0])<f&&(V.xmin=O[0]),Math.abs(V.xmax-O[1])<
f&&(V.xmax=O[1]);return V}function I(f,F=!1){return f?f.isWebMercator?2*(F?2.0037508342787E7:2.0037508342788905E7):f.wkid&&f.isGeographic?360:2*aa[f.wkid]||null:null}function K(f,F=!1){if(f.isGeographic)return[-180,180];f=I(f,F);return null!=f?[-f/2,f/2]:null}function M(f,F,L,O){f=(f-F)/L;0!==f-Math.floor(f)?f=Math.floor(f):O&&--f;return f}function S(f,F=!1){var L=I(f.spatialReference);if(null==L)return 0;const O=F?0:-(L/2),T=B(f.spatialReference),P=!F&&Math.abs(f.xmin+L/2)<T?-L/2:f.xmin;f=M(!F&&
Math.abs(f.xmax-L/2)<T?L/2:f.xmax,O,L,!0);L=M(P,O,L,!1);return f-L}function U(f){const {projectedExtent:F,srcBufferExtent:L,pixelSize:O,datumTransformation:T,rasterTransform:P}=f;var V=F.spatialReference;const W=L.spatialReference;var Q=k(V,W);const {xmin:da,ymin:Z,xmax:ja,ymax:ia}=F,ha=I(W),la=null!=ha&&(f.hasWrapAround||"gcs-shift"===P?.type);f=f.spacing||[32,32];var ma=f[0]*O.x,na=f[1]*O.y;const fa=1===f[0],pa=Math.ceil((ja-da)/ma-.1/f[0])+(fa?0:1),qa=Math.ceil((ia-Z)/na-.1/f[1])+(fa?0:1);ma=a({cols:pa,
rows:qa,xmin:da,ymax:ia,xres:ma,yres:na,inSR:V,outSR:W,datumTransformation:T,preferPE:4>=f[0],usePixelCenter:fa});na=[];let ra,sa=0;const wa=fa?-1:NaN,{xmin:xa,xmax:va,ymax:ya,width:za,height:Aa}=L,Ba=B(W,500),Ca=null!=ha&&0<xa&&va>ha/2;var ta=!1;Q&&(ta=m(V),ta=null!=ta&&0<ta.poleLocation);for(V=0;V<pa;V++){Q=[];for(let ua=0;ua<qa;ua++){var oa=ma[V*qa+ua];la&&oa[0]>va&&oa[0]>ha/2-Ba?oa[0]-=ha:la&&0===V&&0>oa[0]&&Ca&&!P&&(oa[0]+=ha);!oa||isNaN(oa[0])||isNaN(oa[1])?(na.push(wa),na.push(wa),Q.push(null),
sa++):(P&&(oa=P.inverseTransform(new r({x:oa[0],y:oa[1],spatialReference:W})),oa=[oa.x,oa.y]),Q.push(oa),0<V&&la&&ra[ua]&&oa[0]<ra[ua][0]&&(oa[0]+=ha,ta&&oa[0]>va&&oa[0]>ha&&(oa[0]-=ha)),na.push((oa[0]-xa)/za),na.push((ya-oa[1])/Aa))}ra=Q}return{offsets:na,error:null,coefficients:null,outofBoundPointCount:sa,spacing:f,size:fa?[pa,qa]:[pa-1,qa-1]}}function R(f,F,L){const {cols:O,rows:T}=F;F=new Float32Array((O-1)*(T-1)*12);const P=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),V=new Float32Array([-1,
1,0,0,-1,1,1,0,0]);for(let ia=0;ia<O-1;ia++){for(var W=0;W<T-1;W++){var Q=ia*T*2+2*W,da=f[Q];const ha=f[Q+1];var Z=f[Q+2],ja=f[Q+3];Q+=2*T;const la=f[Q],ma=f[Q+1],na=f[Q+2];Q=f[Q+3];let fa=0,pa=12*(W*(O-1)+ia);for(let qa=0;3>qa;qa++)F[pa++]=P[fa++]*da+P[fa++]*Z+P[fa++]*na;fa=0;for(Z=0;3>Z;Z++)F[pa++]=P[fa++]*ha+P[fa++]*ja+P[fa++]*Q;fa=0;for(ja=0;3>ja;ja++)F[pa++]=V[fa++]*da+V[fa++]*la+V[fa++]*na;fa=0;for(da=0;3>da;da++)F[pa++]=V[fa++]*ha+V[fa++]*ma+V[fa++]*Q}if(L)for(W=0;W<F.length;W++)isNaN(F[W])&&
(F[W]=-1)}return F}function Y(f,F){f=f.clone().normalize();return 1===f.length?f[0]:u(f,F)}function X(f,F){const {pixelSize:L,extent:O}=f;f=p(O,F,!1);const T=Y(O,(L.x+L.y)/16);return z(T,F,f)}var ca;(function(f){f[f.None=0]="None";f[f.North=1]="North";f[f.South=2]="South";f[f.Both=3]="Both"})(ca||(ca={}));const ba=(f,F,L,O=0)=>{if(1===L[0])return[0,0];var T=1,P=-1,V=1,W=-1;for(var Q=0;Q<f.length;Q+=2)isNaN(f[Q])||(T=T>f[Q]?f[Q]:T,P=P>f[Q]?P:f[Q],V=V>f[Q+1]?f[Q+1]:V,W=W>f[Q+1]?W:f[Q+1]);const {cols:da,
rows:Z}=F;F=(P-T)/da/L[0];L=(W-V)/Z/L[1];O*=2;V=0;W=!1;T=[0,0];for(P=0;P<da-3;P++){for(Q=0;Q<Z-3;Q++){var ja=P*Z*2+2*Q;const ia=Math.abs(((f[ja]+f[ja+4]+f[ja+4*Z]+f[ja+4*Z+4])/4-f[ja+2*Z+2])/F);ja=Math.abs(((f[ja+1]+f[ja+5]+f[ja+4*Z+1]+f[ja+4*Z+5])/4-f[ja+2*Z+3])/L);ia+ja>V&&(V=ia+ja,T=[ia,ja]);if(O&&V>O){W=!0;break}}if(W)break}return T},aa={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,
54100:2.0037508342789244E7,54101:2.0037508342789244E7},ea=new Map,ka=new Map;l.computeProjectedScales=function(f,F,L){var O=L?.tileSize??512,T=L?.alignGlobalDatasetWithAGOL??!0,P=!!L?.limitToSrcResolution;const {extent:V,spatialReference:W,pixelSize:Q}=f;L=y(new r({x:Q.x,y:Q.y,spatialReference:W}),F,V);if(null==L)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const da=(L.x+L.y)/2,Z=n.getMetersPerUnitForSR(F);var ja=da*Z*96*39.37,ia=F.isGeographic?256/O*2.958287637958547E8:
256/O*5.91657527591555E8,ha="vector-magdir"===f.dataType||"vector-uv"===f.dataType,la=X(f,F),ma=Math.min(Math.ceil(Math.log(Math.min(f.width,f.height)/32)/Math.LN2),Math.ceil(Math.log(ia/2/ja)/Math.LN2));if(!ha&&T&&(F.isGeographic||F.isWebMercator)&&(T=I(F),ha=0<S(la)||null!=T&&la.width>T/4,!ha&&null!=T)){ha=-1;if(3>ma)ha=2**ma*da*O;else if(f.storageInfo){const {maximumPyramidLevel:na=0,pyramidScalingFactor:fa=2}=f.storageInfo;ha=fa**na*da*O}O=Math.ceil(T/ha);ha=1===O||2===O&&T/2-la.xmax<ha}O=ja;
f=Math.min(2,Math.max(1.414,f.storageInfo?.pyramidScalingFactor||2));if(ha)O=ia,ia=F.isGeographic?1.341104507446289E-6:.29858214164761665,ma=96*ia*Z*39.37,F=y(new r({x:ia,y:ia,spatialReference:{wkid:F.isGeographic?4326:3857}}),W,la),F.x*=O/ma,F.y*=O/ma;else{F={x:Q.x,y:Q.y};for(la=0;O<.5005*ia&&la<ma;)la++,O*=f,F.x*=f,F.y*=f;1.001>=Math.max(O,ia)/Math.min(O,ia)&&(O=ia)}ia=[O];la=[{x:F.x,y:F.y}];for(ja=Math.min(70.5310735,ja)/1.001;O>=ja;)O/=f,F.x/=f,F.y/=f,ia.push(O),la.push({x:F.x,y:F.y});if(P){const na=
.001*Q.x;P=la.findIndex(fa=>fa.x>=Q.x-na&&fa.x<=Q.x+na);-1<P?(la.length=P+1,ia.length=P+1):(P=la.findIndex(fa=>fa.x<=Q.x+na),0<P&&(la.length=P,ia.length=P))}return{projectedPixelSize:L,scales:ia,srcResolutions:la,isCustomTilingScheme:!ha}};l.defaultGridSpacing=32;l.defaultProjectionToleranceInPixels=4;l.getDefaultDatumTransformationForDataset=p;l.getProjectedGridPoints=a;l.getProjectionOffsetGrid=function(f){var F=f.isAdaptive&&null==f.spacing;let L=f.spacing||[32,32],O=U(f);var T={cols:O.size[0]+
1,rows:O.size[1]+1};const P=0<O.outofBoundPointCount&&O.outofBoundPointCount<O.offsets.length/2;let V=O.outofBoundPointCount===O.offsets.length/2||F&&P?[0,0]:ba(O.offsets,T,L,4);const W=(V[0]+V[1])/2;var Q=f.projectedExtent.spatialReference;const da=f.srcBufferExtent.spatialReference;F&&(P||4<W)&&(t(Q,da,f.datumTransformation)&&(Q.isGeographic||null!=m(Q)),L=[4,4],O=U({...f,spacing:L}),T={cols:O.size[0]+1,rows:O.size[1]+1},V=ba(O.offsets,T,L,4));O.error=V;1<L[0]&&(O.coefficients=R(O.offsets,T,P));
!f.includeGCSGrid||Q.isGeographic||Q.isWebMercator||(da.isGeographic?O.gcsGrid={offsets:O.offsets,coefficients:O.coefficients,spacing:L}:(F=m(Q),null==F||F.isEnvelope||(Q&&!Q.isGeographic&&(F=String(Q.wkid||Q.wkt2||Q.wkt),ka.has(F)?Q=ka.get(F):(Q=(Q.wkid?C.PeFactory.coordsys(Q.wkid):C.PeFactory.fromString(C.PeDefs.PE_TYPE_PROJCS,Q.wkt2||Q.wkt)).getGeogcs().getCode(),ka.set(F,Q)),Q=new b({wkid:Q})),Q=z(f.projectedExtent,Q),{offsets:f}=U({...f,srcBufferExtent:Q,spacing:L}),T=R(f,T,P),O.gcsGrid={offsets:f,
coefficients:T,spacing:L})));return O};l.getRasterDatasetAlignmentInfo=function(f){const F=f.storageInfo.origin.x;var L=I(f.spatialReference,!0);if(null==L)return{originX:F,halfWorldWidth:null,pyramidsInfo:null};const O=L/2,{nativePixelSize:T,storageInfo:P,extent:V}=f,{maximumPyramidLevel:W,blockWidth:Q,pyramidScalingFactor:da}=P;let Z=T.x;const ja=[];f=null!=f.transform&&"gcs-shift"===f.transform.type;const ia=F+(f?0:O);L=f?L-F:O-F;for(let ha=0;ha<=W;ha++){const la=(V.xmax-F)/Z/Q,ma=L/Z/Q;ja.push({resolutionX:Z,
blockWidth:Q,datsetColumnCount:0===la-Math.floor(la)?la:Math.ceil(la),worldColumnCountFromOrigin:0===ma-Math.floor(ma)?ma:Math.ceil(ma),leftMargin:Math.round(ia/Z)%Q,rightPadding:(Q-Math.round(L/Z)%Q)%Q,originColumnOffset:Math.floor(ia/Z/Q)});Z*=da}return{originX:F,halfWorldWidth:O,pyramidsInfo:ja,hasGCSSShiftTransform:f}};l.getWorldWidth=I;l.getWorldWrapCount=S;l.load=async function(){A.isLoaded()||await A.load()};l.minimumGridSpacing=4;l.projectDatasetExtent=X;l.projectExtent=z;l.projectPoint=G;
l.projectPolygon=function(f,F,L){if("extent"===f.type){const {xmin:O,ymin:T,xmax:P,ymax:V,spatialReference:W}=f;f=new v({rings:[[[O,V],[P,V],[P,T],[O,T],[O,V]]],spatialReference:W})}if(f.spatialReference.equals(F))return f;k(f.spatialReference,F,L);return A.project(f,F,L)};l.projectResolution=y;l.requirePE=t;l.shiftExtent=function(f){var {spatialReference:F}=f;F=D.getInfo(F);if(!F)return f;const [L,O]=F.valid;F=O-L;let T=0;f.xmin<L?T=Math.ceil((L-f.xmin)/F):f.xmin>O&&(T=-Math.ceil((f.xmin-O)/F));
return new x({spatialReference:f.spatialReference,xmin:f.xmin+T*F,ymin:f.ymin,xmax:f.xmax+T*F,ymax:f.ymax})};l.snapExtent=Y;l.snapPyramid=function(f,F,L){const {storageInfo:O,pixelSize:T}=F;var P=0;let V=!1;var {pyramidResolutions:W}=O,Q="mixed"===O.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,O.tileInfo.dpi/96)):1;Q=(f.x+f.y)/2/Q;if(null!=W&&W.length){f=W[W.length-1];f=(f.x+f.y)/2;var da=(T.x+T.y)/2;if(Q<=da)P=0;else if(Q>=f)P=W.length,V=8<Q/f;else{f=da;for(let Z=1;Z<=W.length;Z++){da=(W[Z-
1].x+W[Z-1].y)/2;if(Q<=da){Q===da?P=Z:"down"===L?(P=Z-1,V=8<Q/f):P="up"===L?Z:Q-f>da-Q||2<Q/f?Z:Z-1;break}f=da}}L=0===P?T:W[P-1];V&&(W=Math.min(L.x,L.y),Q=n.getMetersPerUnitForSR(F.spatialReference),19567<W*Q&&(V=!1));return{pyramidLevel:P,pyramidResolution:new r({x:L.x,y:L.y,spatialReference:F.spatialReference}),excessiveReading:V}}P=Math.log(f.x/T.x)/Math.LN2;Q=Math.log(f.y/T.y)/Math.LN2;W=F.storageInfo.maximumPyramidLevel||0;P="down"===L?Math.floor(Math.min(P,Q)):"up"===L?Math.ceil(Math.max(P,
Q)):Math.round((P+Q)/2);0>P?P=0:P>W&&(V=P>W+3,P=W);L=2**P;F=new r({x:L*F.nativePixelSize.x,y:L*F.nativePixelSize.y,spatialReference:F.spatialReference});return{pyramidLevel:P,pyramidResolution:F,excessiveReading:V}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(l,E,w,h,n,C,A,D,x,r){h=class extends r.BaseImageryTileSubView2D{constructor(){super(...arguments);this._handle=null;this.type="rasterVF"}canUseWebGLForProcessing(){return!1}async fetchTile(v,b){b={...b,interpolation:"nearest",requestProjectedLocalDirections:!0};v=await this.layer.fetchTile(v.level,v.row,v.col,b);"vector-magdir"===this.layer.rasterInfo.dataType&&v?.pixelBlock&&(v.pixelBlock=await this.layer.convertVectorFieldData(v.pixelBlock,b));return v}updateTileSource(v,b){const t=b.symbolizerParams,
{tileData:k}=v;k.key=v.key;k.width=this._tileInfoView.tileInfo.size[0];k.height=this._tileInfoView.tileInfo.size[1];({symbolTileSize:v}=t);({source:b}=b);k.offset=this._getTileSymbolOffset(k.key,v);null!=b?.pixelBlock?(k.rawPixelData={extent:b.extent,pixelBlock:b.pixelBlock},k.symbolizerParameters=t,k.source=this._sampleVectorFieldData(b.pixelBlock,t,k.offset)):(b=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo.size[0]-k.offset[0])/v),Math.round((this._tileInfoView.tileInfo.size[1]-
k.offset[1])/v)]),k.source=b,k.symbolizerParameters=t);k.invalidateVAO();return Promise.resolve()}updateTileSymbolizerParameters(v,b){var t=b.local;({symbolTileSize:b}=t);({tileData:v}=v);v.offset=this._getTileSymbolOffset(v.key,b);const k=v.symbolizerParameters.symbolTileSize;v.symbolizerParameters=t;t=v.rawPixelData?.pixelBlock;null!=t&&k!==b&&(v.source=this._sampleVectorFieldData(t,v.symbolizerParameters,v.offset));return Promise.resolve()}attach(){super.attach();this.container=new x.RasterVFTileContainer(this._tileInfoView);
this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=E.watch(()=>this.layer.renderer,v=>this._updateSymbolType(v))}detach(){super.detach();this.container.removeAllChildren();this._handle?.remove();this.container=this._handle=null}_getTileSymbolOffset(v,b){const t=v.col*this._tileInfoView.tileInfo.size[0]%b;v=v.row*this._tileInfoView.tileInfo.size[1]%b;return[t>b/2?b-t:-t,v>b/2?b-v:-v]}_sampleVectorFieldData(v,b,t){({symbolTileSize:b}=
b);return D.sampleVectorField(v,"vector-uv",b,t)}_updateSymbolType(v){"vector-field"===v.type&&(this.container.symbolTypes="wind-barb"===v.style?["scalar","triangle"]:"simple-scalar"===v.style?["scalar"]:["triangle"])}};l.__decorate([w.property()],h.prototype,"container",void 0);l.__decorate([w.property()],h.prototype,"layer",void 0);l.__decorate([w.property()],h.prototype,"type",void 0);return h=l.__decorate([A.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],h)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports",
"../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(l,E,w,h){function n(g,q){return y.get(g)/y.get(q)||1}function C(g,q="geographic"){const [e,u]=g;g=Math.sqrt(e*e+u*u);let z=Math.atan2(u,e)*B;z=(360+z)%360;"geographic"===q&&(z=(450-z)%360);return[g,z]}function A(g,q="geographic"){let e=g[1];"geographic"===q&&(e=(450-e)%360);e%=360;g=g[0];return[g*Math.cos(e/B),g*Math.sin(e/B)]}function D(g,q,e="geographic",u=1){if(!h.isValidPixelBlock(g))return g;const {pixels:z,width:H,height:J}=g;
var I=H*J;const K=z[0],M=z[1],S=g.pixelType.startsWith("f")?g.pixelType:"f32",U=w.createEmptyBand(S,I);I=w.createEmptyBand(S,I);let R=0;for(let Y=0;Y<J;Y++)for(let X=0;X<H;X++)"vector-uv"===q?([U[R],I[R]]=C([K[R],M[R]],e),U[R]*=u):([U[R],I[R]]=A([K[R],M[R]],e),U[R]*=u,I[R]*=u),R++;g=new w({pixelType:S,width:g.width,height:g.height,mask:g.mask,validPixelCount:g.validPixelCount,maskIsAlpha:g.maskIsAlpha,pixels:[U,I]});g.updateStatistics();return g}function x(g=0,q=0,e=Math.PI,u=!0){u&&(e=(2*Math.PI-
e)%(2*Math.PI));u=u?-1:1;const z=-7*u,H=-2*u,J=-16*u,[I,K]=v(0,q+13*u,e,21.75),[M,S]=v(g-5.5,q+z,e,21.75),[U,R]=v(g+5.5,q+z,e,21.75),[Y,X]=v(g-1.5,q+H,e,21.75),[ca,ba]=v(g+1.5,q+H,e,21.75),[aa,ea]=v(g-1.5,q+J,e,21.75),[ka,f]=v(g+1.5,q+J,e,21.75);return[I,K,M,S,Y,X,ca,ba,U,R,aa,ea,ka,f]}function r(g=0,q=Math.PI,e=!0){e&&(q=(2*Math.PI-q)%(2*Math.PI));var u=e?-1:1,z=5*u;const H=20*u,J=25*u;u*=2;const I=e?1:-1;e=5*I;let [K,M]=[0+e,0-H],[S,U]=[K+2*I,M],[R,Y]=[S-0*I,U+u],[X,ca]=[0-e,0-J],[ba,aa]=[X+0*I,
ca-u],ea=Math.ceil(g/5),ka=Math.floor(ea/10);ea-=8*ka;g=[];const f=[];for(let da=0;da<ea/2;da++,ka--){0>=ka&&1===ea%2&&da===(ea-1)/2&&(X=0,ba=X+0*I,ca=(ca+M)/2,aa=ca-u);const [Z,ja]=v(X,ca,q,45);if(0<ka){const [ia,ha]=v(S,ca,q,45),[la,ma]=v(K,M,q,45);g.push(ia);g.push(ha);g.push(Z);g.push(ja);g.push(la);g.push(ma)}else{const [ia,ha]=v(S,U,q,45),[la,ma]=v(R,Y,q,45),[na,fa]=v(ba,aa,q,45);f.push(Z);f.push(ja);f.push(na);f.push(fa);f.push(la);f.push(ma);f.push(ia);f.push(ha)}ca+=z;M+=z;U+=z;Y+=z;aa+=
z}const [F,L]=v(0+e,0+H,q,45);z=7*I;const [O,T]=v(0+z,0+H,q,45),[P,V]=v(0+e,0-J,q,45),[W,Q]=v(0+z,0-J,q,45);return{pennants:g,barbs:f,shaft:[F,L,O,T,P,V,W,Q]}}function v(g,q,e,u=1){return[Math.sqrt(g*g+q*q)/u,(2*Math.PI+(2*Math.PI+Math.atan2(q,g))%(2*Math.PI)-e)%(2*Math.PI)]}function b(g,q,e,u){e=n(u||"knots",e);for(u=1;u<q.length;u++)if(u===q.length-1){if(g<q[u]*e)break}else if(g<=q[u]*e)break;return Math.min(u-1,q.length-2)}function t(g,q,e,u,z){let H=0;switch(q){case "beaufort_kn":H=b(g,a,"knots",
e);break;case "beaufort_km":H=b(g,a,"kilometer-per-hour",e);break;case "beaufort_ft":H=b(g,a,"feet-per-second",e);break;case "beaufort_m":H=b(g,a,"meter-per-second",e);break;case "classified_arrow":H=b(g,z??[],u,e);break;case "ocean_current_m":H=b(g,c,"meter-per-second",e);break;case "ocean_current_kn":H=b(g,d,"knots",e)}return H}function k(g,q){const {style:e,inputUnit:u,outputUnit:z,breakValues:H}=q,J=G.fromJSON(u),I=G.fromJSON(z);let K=0,M=0;const {width:S,height:U,mask:R}=g,Y=g.pixels[0];g=g.pixels[1];
var X=null!=R?R.filter(aa=>0<aa).length:S*U;const ca=new Float32Array(42*X);X=new Uint32Array(15*X);q=q.invertDirection?x(0,0,0,!1):N;for(let aa=0;aa<U;aa++)for(let ea=0;ea<S;ea++){var ba=aa*S+ea;if(!R||R[aa*S+ea]){const ka=(g[ba]+360)%360/180*Math.PI,f=t(Y[ba],e,J,I,H);for(let F=0;F<q.length;F+=2)ca[K++]=(ea+.5)/S,ca[K++]=(aa+.5)/U,ca[K++]=q[F],ca[K++]=q[F+1]+ka,ca[K++]=f,ca[K++]=Y[ba];ba=7*(K/42-1);X[M++]=ba;X[M++]=ba+1;X[M++]=ba+2;X[M++]=ba+0;X[M++]=ba+4;X[M++]=ba+3;X[M++]=ba+0;X[M++]=ba+2;X[M++]=
ba+3;X[M++]=ba+2;X[M++]=ba+5;X[M++]=ba+3;X[M++]=ba+5;X[M++]=ba+6;X[M++]=ba+3}}return{vertexData:ca,indexData:X}}function p(g,q){let e=0,u=0;const {width:z,height:H,mask:J}=g;g=g.pixels[0];const I=[],K=[];var M=G.fromJSON(q.inputUnit);M=n(M,"knots");q="wind_speed"===q.style?5:Number.MAX_VALUE;for(let U=0;U<H;U++)for(let R=0;R<z;R++){var S=g[U*z+R]*M;if((!J||J[U*z+R])&&S<q){for(let Y=0;4>Y;Y++)I[e++]=(R+.5)/z,I[e++]=(U+.5)/H,I[e++]=2>Y?-.5:.5,I[e++]=0===Y%2?-.5:.5,I[e++]=0,I[e++]=S;S=4*(e/24-1);K[u++]=
S;K[u++]=S+1;K[u++]=S+2;K[u++]=S+1;K[u++]=S+2;K[u++]=S+3}}return{vertexData:new Float32Array(I),indexData:new Uint32Array(K)}}const y=new Map;y.set("meter-per-second",1);y.set("kilometer-per-hour",.277778);y.set("knots",.514444);y.set("feet-per-second",.3048);y.set("mile-per-hour",.44704);const B=180/Math.PI,G=new E.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),N=x(0,
0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],c=[0,.5,1,1.5,2],d=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],m=[];l.convertToLocalDirections=function(g,q,e,u="geographic"){if(!h.isValidPixelBlock(g)||null==e)return g;g="vector-magdir"===q?g.clone():D(g,q);const z=g.pixels[1];for(let H=0;H<z.length;H++)z[H]="geographic"===u?(z[H]+e[H]+270)%360:(z[H]+360-e[H])%360;return"vector-magdir"===q?g:D(g,"vector-magdir")};l.convertVectorFieldData=D;l.convertVectorFieldUnit=function(g,q,e=1){if(1===e||!h.isValidPixelBlock(g))return g;
g=g.clone();const {pixels:u,width:z,height:H}=g,J=u[0],I=u[1];let K=0;for(let M=0;M<H;M++)for(let S=0;S<z;S++)"vector-uv"===q?(J[K]*=e,I[K]*=e):J[K]*=e,K++;g.updateStatistics();return g};l.createVFMesh=function(g,q){if("simple_scalar"===q.style)q=p(g,q);else if("wind_speed"===q.style){if(0===m.length)for(var e=0;30>e;e++)m.push(r(5*e,0,!q.invertDirection));q=G.fromJSON(q.inputUnit);q=n(q,"knots");const {width:J,height:I,mask:K}=g;e=g.pixels[0];g=g.pixels[1];const M=[],S=[];let U=0,R=0;for(let Y=0;Y<
I;Y++)for(let X=0;X<J;X++){var u=Y*J+X,z=e[u]*q;if((!K||K[Y*J+X])&&5<=z){const ca=(g[u]+360)%360/180*Math.PI,{pennants:ba,barbs:aa,shaft:ea}=m[Math.min(Math.floor(z/5),29)];if(0===ba.length+aa.length)continue;u=M.length/6;const ka=(X+.5)/J,f=(Y+.5)/I;for(var H=0;H<ba.length;H+=2)M[U++]=ka,M[U++]=f,M[U++]=ba[H],M[U++]=ba[H+1]+ca,M[U++]=0,M[U++]=z;for(H=0;H<aa.length;H+=2)M[U++]=ka,M[U++]=f,M[U++]=aa[H],M[U++]=aa[H+1]+ca,M[U++]=0,M[U++]=z;for(H=0;H<ea.length;H+=2)M[U++]=ka,M[U++]=f,M[U++]=ea[H],M[U++]=
ea[H+1]+ca,M[U++]=0,M[U++]=z;for(z=0;z<ba.length/6;z++)S[R++]=u,S[R++]=u+1,S[R++]=u+2,u+=3;for(z=0;z<aa.length/8;z++)S[R++]=u,S[R++]=u+1,S[R++]=u+2,S[R++]=u+1,S[R++]=u+2,S[R++]=u+3,u+=4;S[R++]=u+0;S[R++]=u+1;S[R++]=u+2;S[R++]=u+1;S[R++]=u+3;S[R++]=u+2;u+=4}}q={vertexData:new Float32Array(M),indexData:new Uint32Array(S)}}else q=k(g,q);return q};l.createVFMeshScalar=p;l.getUnitConversionFactor=n;l.sampleVectorField=function(g,q,e,u=[0,0],z=.5){const {width:H,height:J,mask:I}=g,[K,M]=g.pixels,[S,U]=
u;g=Math.round((H-S)/e);u=Math.round((J-U)/e);var R=g*u;const Y=new Float32Array(R),X=new Float32Array(R);R=new Uint8Array(R);q="vector-uv"===q;for(let ba=0;ba<u;ba++)for(let aa=0;aa<g;aa++){let ea=0;const ka=ba*g+aa,f=Math.max(0,ba*e+U),F=Math.max(0,aa*e+S),L=Math.min(J,f+e),O=Math.min(H,F+e);for(let T=f;T<L;T++)for(let P=F;P<O;P++){var ca=T*H+P;if(!I||I[ca]){ea++;ca=q?[K[ca],M[ca]]:[K[ca],(360+M[ca])%360];const [V,W]=q?ca:A(ca);Y[ka]+=V;X[ka]+=W}}if(ea>=(L-f)*(O-F)*(1-z)){R[ka]=1;const [T,P]=C([Y[ka]/
ea,X[ka]/ea]);Y[ka]=T;X[ka]=P}else R[ka]=0,Y[ka]=0,X[ka]=0}e=new w({width:g,height:u,pixels:[Y,X],mask:R});e.updateStatistics();return e};l.snapImageToSymbolTile=function(g,q,e,u,z){if(null==z||!z.spatialReference.equals(g.spatialReference))return{extent:g,width:Math.round(q/u),height:Math.round(e/u),resolution:g.width/q};const H=z.xmin;z=z.ymax;q=(g.xmax-g.xmin)/q*u;e=(g.ymax-g.ymin)/e*u;g.xmin=H+Math.floor((g.xmin-H)/q)*q;g.xmax=H+Math.ceil((g.xmax-H)/q)*q;g.ymin=z+Math.floor((g.ymin-z)/e)*e;g.ymax=
z+Math.ceil((g.ymax-z)/e)*e;return{extent:g,width:Math.round(g.width/q),height:Math.round(g.height/e),resolution:(q+e)/2}};l.unitKebabDict=G;l.uvComponentToVector=C;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(l,E,w){function h(a){return null!=a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function n(a,c,d,
m,g){const q=a.length;g=E.createEmptyBand(g,q);if(c)for(let e=0;e<q;e++)c[e]&&(g[e]=d[a[e]-m]);else for(c=0;c<q;c++)g[c]=d[a[c]-m];return g}function C(a,c,d,m){const g=null!=d&&2<=d.length?new Set(d):null;d=1===d?.length?d[0]:null;const q=!!c?.length;for(let e=0;e<a.length;e++)if(m[e]){const u=a[e];if(q){let z=!1;for(let H=0;H<c.length;H+=2)if(u>=c[H]&&u<=c[H+1]){z=!0;break}z||(m[e]=0)}m[e]&&(u===d||g?.has(u))&&(m[e]=0)}}function A(a,c){const d=a[0].length;for(let m=0;m<d;m++)if(c[m]){let g=!1;for(let q=
0;q<a.length;q++)if(a[q][m]){g=!0;break}g||(c[m]=0)}}function D(a,c){const d=a[0].length;for(let m=0;m<d;m++)if(c[m]){let g=!1;for(let q=0;q<a.length;q++)if(0===a[q][m]){g=!0;break}g&&(c[m]=0)}}function x(a,c,d,m,g,q,e,u){return{xmin:g<=d*a?0:g<d*a+a?g-d*a:a,ymin:q<=m*c?0:q<m*c+c?q-m*c:c,xmax:g+e<=d*a?0:g+e<d*a+a?g+e-d*a:a,ymax:q+u<=m*c?0:q+u<m*c+c?q+u-m*c:c}}function r(a,c,d,m,g,q){const {width:e,height:u}=d.block,{x:z,y:H}=d.offset,{width:J,height:I}=d.mosaic;d=x(e,u,m,g,z,H,J,I);let K=0;var M=
0;if(q){var S=q.hasGCSSShiftTransform?360:q.halfWorldWidth??0,U=e*q.resolutionX;const R=q.startX+m*U;R<S&&R+U>S?M=q.rightPadding:R>=S&&(K=q.leftMargin-q.rightPadding,M=0)}d.xmax-=M;if("number"===typeof c)for(q=d.ymin;q<d.ymax;q++)for(M=(g*u+q-H)*J+(m*e-z)+K,S=d.xmin;S<d.xmax;S++)a[M+S]=c;else for(q=d.ymin;q<d.ymax;q++)for(M=(g*u+q-H)*J+(m*e-z)+K,S=q*e,U=d.xmin;U<d.xmax;U++)a[M+U]=c[S+U]}function v(a,c,d={}){const {clipOffset:m,clipSize:g,alignmentInfo:q,blockWidths:e}=d;if(e)return b(a,c,{blockWidths:e});
var u=a.find(ca=>h(ca));if(null==u)return null;d=g?g.width:c.width;const z=g?g.height:c.height;var H=u.width,J=u.height;const I=c.width/H,K=c.height/J;c={offset:m||{x:0,y:0},mosaic:g||c,block:{width:H,height:J}};H=u.pixelType;var M=E.getPixelArrayConstructor(H);u=u.pixels.length;J=[];for(var S=0;S<u;S++){var U=new M(d*z);for(var R=0;R<K;R++)for(var Y=0;Y<I;Y++){var X=a[R*I+Y];h(X)&&(X=X.pixels[S],r(U,X,c,Y,R,q))}J.push(U)}M=a.some(ca=>null==ca||null!=ca.mask&&0<ca.mask.length);U=a.some(ca=>ca?.bandMasks&&
1<ca.bandMasks.length);M=M?new Uint8Array(d*z):void 0;U=U?[]:void 0;if(M){for(S=0;S<K;S++)for(R=0;R<I;R++)Y=a[S*I+R],X=null!=Y?Y.mask:null,null!=X?r(M,X,c,R,S,q):Y?r(M,255,c,R,S,q):r(M,0,c,R,S,q);if(U)for(S=0;S<u;S++){R=new Uint8Array(d*z);for(Y=0;Y<K;Y++)for(X=0;X<I;X++){const ca=a[Y*I+X],ba=ca?.bandMasks?.[S]??ca?.mask;null!=ba?r(R,ba,c,X,Y,q):ca?r(R,255,c,X,Y,q):r(R,0,c,X,Y,q)}U.push(R)}}a=new E({width:d,height:z,pixels:J,pixelType:H,bandMasks:U,mask:M});a.updateStatistics();return a}function b(a,
c,d){const m=a.find(R=>null!=R);if(null==m)return null;var g=a.some(R=>null!=R?!!R.mask:!0);const {width:q,height:e}=c;c=g?new Uint8Array(q*e):null;({blockWidths:d}=d);const u=[],z=m.getPlaneCount(),H=E.getPixelArrayConstructor(m.pixelType);if(g)for(let R=0,Y=0;R<a.length;Y+=d[R],R++)if(g=a[R],h(g)){var J=g.mask;for(var I=0;I<e;I++)for(var K=0;K<d[R];K++)c[I*q+K+Y]=null==J?255:J[I*g.width+K]}J=(g=a.some(R=>R?.bandMasks&&1<R.bandMasks.length))?[]:void 0;I=q*e;for(K=0;K<z;K++){const R=new H(I),Y=g?
new Uint8Array(I):void 0;for(let X=0,ca=0;X<a.length;ca+=d[X],X++){const ba=a[X];if(h(ba)){var M=ba.pixels[K];if(null!=M){for(var S=0;S<e;S++)for(var U=0;U<d[X];U++)R[S*q+U+ca]=M[S*ba.width+U];if(Y)for(M=ba.bandMasks?.[K]??ba.mask,S=0;S<e;S++)for(U=0;U<d[X];U++)Y[S*q+U+ca]=M?M[S*ba.width+U]:255}}}u.push(R);J&&Y&&J.push(Y)}a=new E({width:q,height:e,mask:c,bandMasks:J,pixels:u,pixelType:m.pixelType});a.updateStatistics();return a}function t(a){if(!h(a))return null;const c=a.clone(),{width:d,height:m,
pixels:g}=a;var q=g[0];const e=c.pixels[0];a=a.mask;for(let H=2;H<m-1;H++){const J=new Map;for(var u=H-2;u<H+2;u++)for(var z=0;4>z;z++){const I=u*d+z;y(J,q[I],a?a[I]:1)}e[H*d]=k(J);e[H*d+1]=e[H*d+2]=e[H*d];for(u=3;u<d-1;u++)z=(H-2)*d+u+1,y(J,q[z],a?a[z]:1),z=(H-1)*d+u+1,y(J,q[z],a?a[z]:1),z=H*d+u+1,y(J,q[z],a?a[z]:1),z=(H+1)*d+u+1,y(J,q[z],a?a[z]:1),z=(H-2)*d+u-3,p(J,q[z],a?a[z]:1),z=(H-1)*d+u-3,p(J,q[z],a?a[z]:1),z=H*d+u-3,p(J,q[z],a?a[z]:1),z=(H+1)*d+u-3,p(J,q[z],a?a[z]:1),e[H*d+u]=k(J);e[H*d+u+
1]=e[H*d+u]}for(q=0;q<d;q++)e[q]=e[d+q]=e[2*d+q],e[(m-1)*d+q]=e[(m-2)*d+q];c.updateStatistics();return c}function k(a){if(0===a.size)return 0;let c=0,d=-1,m=0;const g=a.keys();let q=g.next();for(;!q.done;)m=a.get(q.value),m>c&&(d=q.value,c=m),q=g.next();return d}function p(a,c,d){0!==d&&(d=a.get(c),1===d?a.delete(c):a.set(c,d-1))}function y(a,c,d){0!==d&&a.set(c,a.has(c)?a.get(c)+1:1)}function B(a,c,d){let {x:m,y:g}=c;const {width:q,height:e}=d;if(0===m&&0===g&&e===a.height&&q===a.width)return a;
const {width:u,height:z}=a;c=Math.max(0,g);const H=Math.max(0,m),J=Math.min(m+q,u),I=Math.min(g+e,z);if(0>J||0>I||!h(a))return null;m=Math.max(0,-m);g=Math.max(0,-g);var {pixels:K}=a,M=q*e,S=K.length;const U=[];for(var R=0;R<S;R++){var Y=K[R],X=E.createEmptyBand(a.pixelType,M);for(let ca=c;ca<I;ca++){const ba=ca*u;let aa=(ca+g-c)*q+m;for(let ea=H;ea<J;ea++)X[aa++]=Y[ba+ea]}U.push(X)}K=new Uint8Array(M);M=a.mask;for(S=c;S<I;S++)for(R=S*u,Y=(S+g-c)*q+m,X=H;X<J;X++)K[Y++]=M?M[R+X]:1;a=new E({width:d.width,
height:d.height,pixelType:a.pixelType,pixels:U,mask:K});a.updateStatistics();return a}function G(a,c=!0){if(!h(a))return null;const {pixels:d,width:m,height:g,mask:q,pixelType:e}=a;a=[];const u=Math.round(m/2),z=Math.round(g/2),H=g-1,J=m-1;for(var I=0;I<d.length;I++){var K=d[I],M=E.createEmptyBand(e,u*z),S=0;for(var U=0;U<g;U+=2)for(var R=0;R<m;R+=2){var Y=K[U*m+R];if(c){var X=R===J?Y:K[U*m+R+1];const ca=U===H?Y:K[U*m+R+m],ba=R===J?ca:U===H?X:K[U*m+R+m+1];M[S++]=(Y+X+ca+ba)/4}else M[S++]=Y}a.push(M)}I=
null;if(null!=q)for(I=new Uint8Array(u*z),K=0,M=0;M<g;M+=2)for(S=0;S<m;S+=2)U=q[M*m+S],c?(R=S===J?U:q[M*m+S+1],Y=M===H?U:q[M*m+S+m],X=S===J?Y:M===H?R:q[M*m+S+m+1],I[K++]=U*R*Y*X?1:0):I[K++]=U;return new E({width:u,height:z,pixelType:e,pixels:a,mask:I})}function N(a,c,d,m,g=0){const {width:q,height:e}=a,{width:u,height:z}=c;a=m.cols;m=m.rows;c=Math.ceil(u/a-.1/a);const H=Math.ceil(z/m-.1/m);let J,I,K,M,S;const U=c*a;var R=U*H*m;const Y=new Float32Array(R),X=new Float32Array(R),ca=new Uint32Array(R),
ba=new Uint32Array(R);let aa=0,ea,ka;for(let L=0;L<H;L++)for(let O=0;O<c;O++){var f=12*(L*c+O);R=d[f];J=d[f+1];I=d[f+2];K=d[f+3];M=d[f+4];S=d[f+5];for(var F=0;F<m;F++){aa=(L*m+F)*U+O*a;ka=(F+.5)/m;for(let T=0;T<F;T++)ea=(T+.5)/a,Y[aa+T]=(R*ea+J*ka+I)*q+g,X[aa+T]=(K*ea+M*ka+S)*e+g,ca[aa+T]=Math.floor(Y[aa+T]),ba[aa+T]=Math.floor(X[aa+T])}f+=6;R=d[f];J=d[f+1];I=d[f+2];K=d[f+3];M=d[f+4];S=d[f+5];for(f=0;f<m;f++)for(aa=(L*m+f)*U+O*a,ka=(f+.5)/m,F=f;F<a;F++)ea=(F+.5)/a,Y[aa+F]=(R*ea+J*ka+I)*q+g,X[aa+F]=
(K*ea+M*ka+S)*e+g,ca[aa+F]=Math.floor(Y[aa+F]),ba[aa+F]=Math.floor(X[aa+F])}return{offsets_x:Y,offsets_y:X,offsets_xi:ca,offsets_yi:ba,gridWidth:U}}l.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(l.NoDataInterpretation||(l.NoDataInterpretation={}));l.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(l.MissingBandAction||(l.MissingBandAction={}));l.approximateTransform=function(a,c,d,m,g="nearest"){if(!h(a))return null;
"majority"===g&&(a=t(a));const {pixels:q,mask:e,bandMasks:u,pixelType:z}=a,H=a.width;var J=a.height;const I=E.getPixelArrayConstructor(z),K=q.length,{width:M,height:S}=c;a=!1;for(var U=0;U<d.length;U+=3)-1===d[U]&&-1===d[U+1]&&-1===d[U+2]&&(a=!0);const {offsets_x:R,offsets_y:Y,offsets_xi:X,offsets_yi:ca,gridWidth:ba}=N({width:H,height:J},c,d,m,"majority"===g?.5:0);let aa;c=(ka,f,F,L)=>{const O=ka instanceof Float32Array||ka instanceof Float64Array?0:.5;for(let T=0;T<S;T++){aa=T*ba;for(let P=0;P<M;P++){if(0>
R[aa]||0>Y[aa])ka[T*M+P]=0;else if(L)ka[T*M+P]=f[X[aa]+ca[aa]*H];else{const V=Math.floor(R[aa]),W=Math.floor(Y[aa]),Q=Math.ceil(R[aa]),da=Math.ceil(Y[aa]),Z=R[aa]-V,ja=Y[aa]-W;ka[T*M+P]=!F||F[V+W*H]&&F[Q+W*H]&&F[V+da*H]&&F[Q+da*H]?(1-ja)*((1-Z)*f[V+W*H]+Z*f[Q+W*H])+ja*((1-Z)*f[V+da*H]+Z*f[Q+da*H])+O:f[X[aa]+ca[aa]*H]}aa++}}};d=[];m=u?.length===K;J=[];for(U=0;U<K;U++){if(m){var ea=new Uint8Array(M*S);c(ea,u[U],u[U],!0);J.push(ea)}ea=new I(M*S);c(ea,q[U],m?u[U]:e,"nearest"===g||"majority"===g);d.push(ea)}g=
new E({width:M,height:S,pixelType:z,pixels:d,bandMasks:m?J:void 0});if(null!=e)g.mask=new Uint8Array(M*S),c(g.mask,e,e,!0);else if(a)for(g.mask=new Uint8Array(M*S),a=0;a<M*S;a++)g.mask[a]=0>R[a]||0>Y[a]?0:1;g.updateStatistics();return g};l.clip=B;l.colorize=function(a,c){if(!h(a)||!c||!c.indexedColormap&&!c.indexed2DColormap)return a;const d=a.clone();var m=d.pixels;let g=d.mask;const q=d.width*d.height;if(1!==m.length)return a;const {indexedColormap:e,indexed2DColormap:u,offset:z,alphaSpecified:H}=
c;a=0;m=m[0];c=new Uint8Array(m.length);const J=new Uint8Array(m.length),I=new Uint8Array(m.length);var K=0;if(e){const M=e.length-1;if(null!=g)for(a=0;a<q;a++)g[a]&&(K=4*(m[a]-z),K<z||K>M?g[a]=0:(c[a]=e[K],J[a]=e[K+1],I[a]=e[K+2],g[a]=e[K+3]));else{g=new Uint8Array(q);for(a=0;a<q;a++)K=4*(m[a]-z),K<z||K>M?g[a]=0:(c[a]=e[K],J[a]=e[K+1],I[a]=e[K+2],g[a]=e[K+3]);d.mask=g}}else if(u)if(null!=g)for(a=0;a<q;a++)g[a]&&(K=u[m[a]],c[a]=K[0],J[a]=K[1],I[a]=K[2],g[a]=K[3]);else{g=new Uint8Array(q);for(a=0;a<
q;a++)K=u[m[a]],c[a]=K[0],J[a]=K[1],I[a]=K[2],g[a]=K[3];d.mask=g}d.pixels=[c,J,I];d.statistics=null;d.pixelType="u8";d.maskIsAlpha=H;return d};l.compositeBands=function(a){if(!a?.length||a.some(z=>!h(z)))return null;if(1===a.length)return a[0]?.clone()??null;const {width:c,height:d,pixelType:m}=a[0];if(a.some(z=>z.width!==c||z.height!==d))return null;const g=a.map(({mask:z})=>z).filter(z=>null!=z);let q=null;g.length&&(q=new Uint8Array(c*d),q.set(g[0]),1<g.length&&D(g.slice(1),q));const e=[];a.forEach(({pixels:z})=>
e.push(...z));const u=[];a.map(({statistics:z})=>z).filter(z=>z?.length).forEach(z=>u.push(...z));return new E({pixelType:m,width:c,height:d,mask:q,pixels:e,statistics:u.length?u:null})};l.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){c=c.sort((H,J)=>H[0]-J[0]);var d=0;0>c[0][0]&&(d=c[0][0]);var m=Math.max(256,c[c.length-1][0]-d+1),g=new Uint8Array(4*m),q=[],e=0,u=0,z=5===c[0].length;if(65536<m)return c.forEach(H=>{q[H[0]-d]=z?H.slice(1):H.slice(1).concat([255])}),{indexed2DColormap:q,
offset:d,alphaSpecified:z};if(a.fillUnspecified)for(a=c[u],e=a[0]-d;e<m;e++)g[4*e]=a[1],g[4*e+1]=a[2],g[4*e+2]=a[3],g[4*e+3]=z?a[4]:255,e===a[0]-d&&(a=u===c.length-1?a:c[++u]);else for(e=0;e<c.length;e++)a=c[e],u=4*(a[0]-d),g[u]=a[1],g[u+1]=a[2],g[u+2]=a[3],g[u+3]=z?a[4]:255;return{indexedColormap:g,offset:d,alphaSpecified:z}}}};l.createMaskLUT=function(a,c,d){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var m=a.includes("16")?65536:256;a=a.includes("s")?-m/2:0;m=new Uint8Array(m);if(c)for(let q=
0;q<c.length;q++){var g=Math.ceil(c[2*q]-a);const e=Math.floor(c[2*q+1]-a);for(;g<=e;g++)m[g]=255}else m.fill(255);if(d)for(c=0;c<d.length;c++)m[d[c]-a]=0;return{lut:m,offset:a}};l.createRemapLUT=function(a){const {srcPixelType:c,inputRanges:d,outputValues:m,allowUnmatched:g,noDataRanges:q,isLastInputRangeInclusive:e,outputPixelType:u}=a;if("u8"!==c&&"s8"!==c&&"u16"!==c&&"s16"!==c)return null;var z=c.includes("16")?65536:256;a=c.includes("s")?-z/2:0;const H=E.createEmptyBand(u,z);z=new Uint8Array(z);
g&&z.fill(255);const [J,I]=w.getPixelValueRange(u);if(d?.length&&m?.length){var K=d.map(R=>R-1E-6);K[0]=d[0];e&&(K[K.length-1]=d[d.length-1]);for(var M=0;M<K.length;M++){var S=m[M]>I?I:m[M]<J?J:m[M],U=Math.ceil(K[2*M]-a);const R=Math.floor(K[2*M+1]-a);for(;U<=R;U++)H[U]=S,z[U]=255}}if(q?.length)for(K=0;K<q.length;K++)for(S=Math.ceil(q[2*K]-a),M=Math.floor(q[2*K+1]-a);S<=M;S++)z[S]=0;return{lut:H,offset:a,mask:z}};l.extractBands=function(a,c){return c?.length&&h(a)?a.extractBands(c):a};l.getClipBounds=
x;l.getLocalArithmeticNorthRotations=function(a,c){const {coefficients:d,spacing:m}=c,{offsets_x:g,offsets_y:q,gridWidth:e}=N(a,a,d,{rows:m[0],cols:m[1]}),{width:u,height:z}=a;a=new Float32Array(u*z);c=180/Math.PI;for(let I=0;I<z;I++)for(let K=0;K<u;K++){var H=I*e+K,J=0===I?H:H-e;const M=I===z-1?H:H+e;H=g[J]-g[M];J=q[M]-q[J];isNaN(H)||isNaN(J)?a[I*u+K]=90:(J=Math.atan2(J,H)*c,J=(360+J)%360,a[I*u+K]=J)}return a};l.interpolateOffsets=N;l.isValidPixelBlock=h;l.lookupBandValues=n;l.lookupPixels=function(a,
c){if(!h(a))return null;const {pixels:d,mask:m}=a,g=d.length;let q=c.lut;const {offset:e}=c;q&&1===q[0].length&&(q=d.map(()=>q));const u=[];c=c.outputPixelType||"u8";for(let z=0;z<g;z++){const H=n(d[z],m,q[z],e||0,c);u.push(H)}a=new E({width:a.width,height:a.height,pixels:u,mask:m,pixelType:c});a.updateStatistics();return a};l.mask=function(a,c){if(!h(a))return null;const {width:d,height:m,pixels:g}=a;var q=d*m;const e=new Uint8Array(q);a.mask?e.set(a.mask):e.fill(255);a=g.length;const {includedRanges:u,
noDataValues:z,outputPixelType:H,matchAll:J,lookups:I}=c;if(I){q=[];for(c=0;c<a;c++){var K=I[c];K=n(g[c],e,K.lut,K.offset||0,"u8");q.push(K)}1===q.length?e.set(q[0]):J?A(q,e):D(q,e)}else if(J){c=[];for(K=0;K<a;K++){const M=new Uint8Array(q);M.set(e);C(g[K],u?.slice(2*K,2*K+2),z?.[K],M);c.push(M)}1===c.length?e.set(c[0]):A(c,e)}else for(q=0;q<a;q++)C(g[q],u?.slice(2*q,2*q+2),z?.[q],e);return new E({width:d,height:m,pixelType:H,pixels:g,mask:e})};l.maxMapSizeGpu=6;l.mosaic=v;l.mosaicPixelData=function(a,
c){if(!a||0===a.length)return null;var d=a.find(I=>I.pixelBlock);if(null==d?.pixelBlock)return null;var m=(d.extent.xmax-d.extent.xmin)/d.pixelBlock.width;const g=(d.extent.ymax-d.extent.ymin)/d.pixelBlock.height,q=.01*Math.min(m,g),e=a.sort((I,K)=>Math.abs(I.extent.ymax-K.extent.ymax)>q?K.extent.ymax-I.extent.ymax:Math.abs(I.extent.xmin-K.extent.xmin)>q?I.extent.xmin-K.extent.xmin:0);var u=Math.min.apply(null,e.map(I=>I.extent.xmin));const z=Math.min.apply(null,e.map(I=>I.extent.ymin)),H=Math.max.apply(null,
e.map(I=>I.extent.xmax)),J=Math.max.apply(null,e.map(I=>I.extent.ymax));a={x:Math.round((c.xmin-u)/m),y:Math.round((J-c.ymax)/g)};u={width:Math.round((H-u)/m),height:Math.round((J-z)/g)};m={width:Math.round((c.xmax-c.xmin)/m),height:Math.round((c.ymax-c.ymin)/g)};if(Math.round(u.width/d.pixelBlock.width)*Math.round(u.height/d.pixelBlock.height)!==e.length||0>a.x||0>a.y||u.width<m.width||u.height<m.height)return null;d=e.map(I=>I.pixelBlock);d=v(d,u,{clipOffset:a,clipSize:m});return{extent:c,pixelBlock:d}};
l.remap=function(a,c){if(!h(a))return null;const {width:d,height:m}=a,{inputRanges:g,outputValues:q,outputPixelType:e,noDataRanges:u,allowUnmatched:z,isLastInputRangeInclusive:H}=c;c=a.pixels[0];const J=E.createEmptyBand(e,c.length),I=a.mask,K=new Uint8Array(d*m);I?K.set(I):K.fill(255);const M=a.pixelType.startsWith("f")?1E-6:0;a=g.map(aa=>aa-M);a[0]=g[0];a[a.length-1]=g[g.length-1]+(H?1E-6:0);var S=g.length/2;const [U,R]=w.getPixelValueRange(e);for(var Y=0;Y<m;Y++)for(var X=0;X<d;X++){var ca=Y*d+
X;if(K[ca]){var ba=c[ca];let aa=!1;for(let ea=S-1;0<=ea;ea--)if(ba===a[2*ea]||ba>a[2*ea]&&ba<a[2*ea+1]){J[ca]=q[ea];aa=!0;break}aa||(z?J[ca]=ba>R?R:ba<U?U:ba:K[ca]=0)}}if(a=u?.length)for(S=0;S<m;S++)for(Y=0;Y<d;Y++)if(X=S*d+Y,!I||I[X])for(ca=c[X],ba=0;ba<a;ba+=2)if(ca>=u[ba]&&ca<=u[ba+1]){J[X]=0;K[X]=0;break}return new E({width:d,height:m,pixelType:e,pixels:[J],mask:K})};l.remapColor=function(a,c){if(!h(a))return null;a=a.clone();var {pixels:d}=a;const m=a.width*a.height,g=c.length,q=Math.floor(g/
2),e=c[Math.floor(q)];d=d[0];let u,z,H,J,I,K,M=!1;const S=new Uint8Array(m),U=new Uint8Array(m),R=new Uint8Array(m);let Y=a.mask;const X=4===c[0].mappedColor.length;Y||(Y=new Uint8Array(m),Y.fill(X?255:1),a.mask=Y);for(I=0;I<m;I++)if(Y[I]){u=d[I];M=!1;K=q;z=e;H=0;for(J=g-1;1<J-H;){if(u===z.value){M=!0;break}u>z.value?H=K:J=K;K=Math.floor((H+J)/2);z=c[Math.floor(K)]}M||(u===c[H].value?(z=c[H],M=!0):u===c[J].value?(z=c[J],M=!0):u<c[H].value?(M=!1,z=null):u>c[H].value&&(u<c[J].value?(z=c[H],M=!0):J===
g-1?(M=!1,z=null):(z=c[J],M=!0)));M?(S[I]=z.mappedColor[0],U[I]=z.mappedColor[1],R[I]=z.mappedColor[2],Y[I]=z.mappedColor[3]):S[I]=U[I]=R[I]=Y[I]=0}a.pixels=[S,U,R];a.mask=Y;a.pixelType="u8";a.maskIsAlpha=X;return a};l.resampleByMajority=t;l.setValidBoundary=function(a,c,d){if(!h(a))return null;const {width:m,height:g}=a,q=c.x;c=c.y;const e=d.width+q;d=d.height+c;if(0>q||0>c||e>m||d>g||0===q&&0===c&&e===m&&d===g)return a;a.mask||(a.mask=new Uint8Array(m*g));const u=a.mask;for(let z=0;z<g;z++){const H=
z*m;for(let J=0;J<m;J++)u[H+J]=z<c||z>=d||J<q||J>=e?0:1}a.updateStatistics();return a};l.split=function(a,c,d){if(!h(a))return null;const {width:m,height:g}=c;let {width:q,height:e}=a;const u=new Map,z={x:0,y:0};d=null==d?1:1+d;for(let H=0;H<d;H++){const J=Math.ceil(q/m),I=Math.ceil(e/g);for(let K=0;K<I;K++){z.y=K*g;for(let M=0;M<J;M++){z.x=M*m;const S=B(a,z,c);u.set(`${H}/${K}/${M}`,S)}}H<d-1&&(a=G(a));q=Math.round(q/2);e=Math.round(e/2)}return u};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/imagery/RasterVFTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ./BrushVectorField ./RasterVFTile ../webgl/enums ../webgl/TileContainer".split(" "),function(l,E,w,h,n,C){class A extends C{constructor(){super(...arguments);this.isCustomTilingScheme=!1;this.symbolTypes=["triangle"]}createTile(D){const x=this._tileInfoView.getTileBounds(E.create(),D),[r,v]=this._tileInfoView.tileInfo.size,b=this._tileInfoView.getTileResolution(D.level);return new h.RasterVFTile(D,
b,x[0],x[3],r,v)}prepareRenderPasses(D){const x=D.registerRenderPass({name:"imagery (vf tile)",brushes:[w],target:()=>this.children.map(r=>r.tileData),drawPhase:n.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(D),x]}doRender(D){this.visible&&D.drawPhase===n.WGLDrawPhase.MAP&&this.symbolTypes.forEach(x=>{D.renderPass=x;super.doRender(D)})}}l.RasterVFTileContainer=A;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../webgl/brushes/WGLBrush",
"../../../webgl/enums"],function(l,E){const w=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,
1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),h=new Float32Array([0,92/255,230/255,1]),n={beaufort_ft:w,beaufort_m:w,beaufort_km:w,beaufort_mi:w,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,
.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,
.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,
1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:h,single_arrow:h,wind_speed:new Float32Array([0,0,0,1])},C=[0,20];class A extends l{constructor(){super(...arguments);this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",
0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:D}){D.setBlendingEnabled(!0);D.setBlendFunctionSeparate(E.BlendFactor.ONE,E.BlendFactor.ONE_MINUS_SRC_ALPHA,E.BlendFactor.ONE,E.BlendFactor.ONE_MINUS_SRC_ALPHA);D.setColorMask(!0,!0,!0,!0);D.setStencilWriteMask(0);D.setStencilTestEnabled(!0);D.setStencilOp(E.StencilOperation.KEEP,E.StencilOperation.KEEP,E.StencilOperation.REPLACE)}draw(D,
x){if(null!=x.source&&0!==x.source.validPixelCount){var {context:r,timeline:v}=D;v.begin(this.name);r.setStencilFunction(E.CompareFunction.EQUAL,x.stencilRef,255);x.updateVectorFieldVAO(D);if("scalar"===D.renderPass){var b=x.vaoData.scalar;b&&this._drawScalars(D,x,b.vao,b.elementCount)}else(b=x.vaoData.magdir)&&this._drawTriangles(D,x,b.vao,b.elementCount);v.end(this.name)}}_drawTriangles(D,x,r,v){const {context:b,painter:t,requestRender:k,allowDelayedRender:p}=D,{symbolizerParameters:y}=x;var B=
y.dataRange?["dataRange"]:[];"geographic"===y.rotationType&&B.push("rotationGeographic");B=t.materialManager.getProgram(this._desc.magdir,B);if(p&&null!=k&&!B.compiled)k();else{b.useProgram(B);var {coordScale:G,opacity:N,transforms:a}=x;B.setUniform2fv("u_coordScale",G);B.setUniform1f("u_opacity",N);B.setUniformMatrix3fv("u_dvsMat3",a.dvs);var {style:c,dataRange:d,rotation:m,symbolPercentRange:g}=y;B.setUniform4fv("u_colors",n[c]);B.setUniform2fv("u_dataRange",d||C);B.setUniform1f("u_rotation",m);
B.setUniform2fv("u_symbolPercentRange",g);D=this._getSymbolSize(D,x);B.setUniform2fv("u_symbolSize",D);b.bindVAO(r);b.drawElements(E.PrimitiveType.TRIANGLES,v,E.DataType.UNSIGNED_INT,0)}}_drawScalars(D,x,r,v){const {context:b,painter:t,requestRender:k,allowDelayedRender:p}=D,{symbolizerParameters:y}=x;var B=[];"wind_speed"===y.style?B.push("innerCircle"):y.dataRange&&B.push("dataRange");"geographic"===y.rotationType&&B.push("rotationGeographic");B=t.materialManager.getProgram(this._desc.scalar,B);
if(p&&null!=k&&!B.compiled)k();else{b.useProgram(B);var {coordScale:G,opacity:N,transforms:a}=x;B.setUniform2fv("u_coordScale",G);B.setUniform1f("u_opacity",N);B.setUniformMatrix3fv("u_dvsMat3",a.dvs);var {dataRange:c,symbolPercentRange:d}=y;B.setUniform2fv("u_dataRange",c||C);B.setUniform2fv("u_symbolPercentRange",d);D=this._getSymbolSize(D,x);B.setUniform2fv("u_symbolSize",D);b.bindVAO(r);b.drawElements(E.PrimitiveType.TRIANGLES,v,E.DataType.UNSIGNED_INT,0)}}_getSymbolSize(D,x){D=x.key?2**(D.displayLevel-
x.key.level):x.resolution/D.state.resolution;const {symbolTileSize:r}=x.symbolizerParameters;return[r/(Math.round((x.width-x.offset[0])/r)*r)/D,r/(Math.round((x.height-x.offset[1])/r)*r)/D]}}return A})},"esri/views/2d/engine/imagery/RasterVFTile":function(){define(["exports","../../../../chunks/mat3","../../../../chunks/mat3f32","./RasterVFDisplayObject","../webgl/TiledDisplayObject"],function(l,E,w,h,n){class C extends n.TiledDisplayObject{constructor(A,D,x,r,v,b,t=null){super(A,D,x,r,v,b);this.tileData=
new h.RasterVFDisplayObject(t);this.tileData.coordScale=[v,b];this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy();this.tileData.destroy();this.stage=this.tileData=null}set stencilRef(A){this.tileData.stencilRef=A}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{dvs:w.create(),tileMat3:w.create()}}setTransform(A){super.setTransform(A);const D=this.resolution/(A.resolution*A.pixelRatio),x=this.transforms.tileMat3,[r,v]=this.tileData.offset,[b,t]=A.toScreenNoRotation([0,
0],[this.x+r*this.resolution,this.y-v*this.resolution]),{symbolTileSize:k}=this.tileData.symbolizerParameters;E.set(x,Math.round((this.width-this.tileData.offset[0])/k)*k/this.rangeX*D,0,0,0,Math.round((this.height-this.tileData.offset[1])/k)*k/this.rangeY*D,0,b,t,1);E.multiply(this.transforms.dvs,A.displayViewMat3,x);this.tileData.transforms.dvs=this.transforms.dvs}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}l.RasterVFTile=C;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(l,E,w,h,n,C,A,D,x,r,v){class b extends A.DisplayObject{constructor(t=null){super();this._symbolizerParameters=
this._source=null;this._vaoInvalidated=!0;this.coordScale=[1,1];this.offset=this.key=this.height=null;this.stencilRef=0;this.resolution=null;this.pixelRatio=1;this.rotation=this.y=this.x=0;this.width=this.vaoData=this.rawPixelData=null;this.source=t}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(t){JSON.stringify(this._symbolizerParameters)!==
JSON.stringify(t)&&(this._symbolizerParameters=t,this.invalidateVAO())}get source(){return this._source}set source(t){this._source=t;this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(t){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:k}=this.symbolizerParameters;
switch(k){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":k=C.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(t.context,k)};break;case "simple_scalar":k=C.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(t.context,k)};break;case "wind_speed":k=C.createVFMesh(this.source,
this.symbolizerParameters);k=this._createVectorFieldVAO(t.context,k);const p=C.createVFMeshScalar(this.source,this.symbolizerParameters);t=this._createVectorFieldVAO(t.context,p);this.vaoData={magdir:k,scalar:t}}}this.ready();this.requestRender()}}_createTransforms(){return{dvs:h.create()}}setTransform(t){const k=w.identity(this.transforms.dvs),[p,y]=t.toScreenNoRotation([0,0],[this.x,this.y]);var B=this.resolution/this.pixelRatio/t.resolution;const G=B*this.width;B*=this.height;const N=Math.PI*this.rotation/
180;w.translate(k,k,n.fromValues(p,y));w.translate(k,k,n.fromValues(G/2,B/2));w.rotate(k,k,-N);w.translate(k,k,n.fromValues(-G/2,-B/2));w.scaleByVec2(k,k,n.fromValues(G,B));w.multiply(this.transforms.dvs,t.displayViewMat3,k)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(t,k){const {vertexData:p,indexData:y}=k;k=x.BufferObject.createVertex(t,r.Usage.STATIC_DRAW,new Float32Array(p));const B=x.BufferObject.createIndex(t,r.Usage.STATIC_DRAW,new Uint32Array(y)),
G=D.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:r.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:r.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:r.DataType.FLOAT,normalized:!1}]});return{vao:new v.VertexArrayObject(t,G.attributes,G.bufferLayouts,{geometry:k},B),elementCount:y.length}}}l.RasterVFDisplayObject=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/ImageryTileLayerView":function(){define("../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(l,E,w,h,n,C,A,D,x,r,v){return b=>{b=class extends b{constructor(){super(...arguments);this._rasterFieldPrefix="Raster.";this.tileInfo=this.view=this.layer=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return r.projectDatasetExtent(this.layer.rasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return r.getDefaultDatumTransformationForDataset(this.layer.fullExtent,
this.view.spatialReference,!0)}supportsSpatialReference(t){return!!r.projectDatasetExtent(this.layer.rasterInfo,t)}async fetchPopupFeatures(t,k){const {layer:p}=this;if(!t)throw new w("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:p});var {popupEnabled:y}=p;k=v.getFetchPopupTemplate(p,k);if(!y||null==k)throw new w("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:y,popupTemplate:k});y=[];const {value:B,magdirValue:G,
processedValue:N}=await p.identify(t,{timeExtent:this.timeExtent});let a="";if(B&&B.length){a="imagery-tile"===p.type&&p.hasStandardTime()&&null!=B[0]?B.map(d=>p.getStandardTimeValue(d)).join(", "):B.join(", ");t={ObjectId:0};t["Raster.ServicePixelValue"]=N?.join(", ")??a;t["Raster.ServicePixelValue.Raw"]=a;k=p.rasterInfo.attributeTable;if(null!=k){const {fields:d,features:m}=k,g=d.find(({name:q})=>"value"===q.toLowerCase());if(k=g?m.find(q=>String(q.attributes[g.name])===a):null)for(var c in k.attributes)k.attributes.hasOwnProperty(c)&&
(t[this._rasterFieldPrefix+c]=k.attributes[c])}c=p.rasterInfo.dataType;if("vector-magdir"===c||"vector-uv"===c)t["Raster.Magnitude"]=G?.[0],t["Raster.Direction"]=G?.[1];c=new E(this.fullExtent.clone(),null,t);c.layer=p;c.sourceLayer=c.layer;y.push(c)}return y}};l.__decorate([h.property()],b.prototype,"layer",void 0);l.__decorate([h.property(x.combinedViewLayerTimeExtentProperty)],b.prototype,"timeExtent",void 0);l.__decorate([h.property()],b.prototype,"view",void 0);l.__decorate([h.property()],b.prototype,
"fullExtent",null);l.__decorate([h.property()],b.prototype,"tileInfo",void 0);l.__decorate([h.property({readOnly:!0})],b.prototype,"hasTilingEffects",null);l.__decorate([h.property()],b.prototype,"datumTransformation",null);return b=l.__decorate([D.subclass("esri.views.layers.ImageryTileLayerView")],b)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(l,E){function w(h,n){return h.popupTemplate?h.popupTemplate:null!=n&&n.defaultPopupTemplateEnabled&&
null!=h.defaultPopupTemplate?h.defaultPopupTemplate:null}l.getFetchPopupTemplate=w;l.getRequiredFields=async function(h,n=h.popupTemplate){if(null==n)return[];const C=await n.getRequiredFields(h.fieldsIndex);({lastEditInfoEnabled:n}=n);const {objectIdField:A,typeIdField:D,globalIdField:x,relationships:r}=h;if(C.includes("*"))return["*"];n=n?E.getFeatureEditFields(h):[];const v=E.fixFields(h.fieldsIndex,[...C,...n]);D&&v.push(D);v&&A&&h.fieldsIndex?.has(A)&&!v.includes(A)&&v.push(A);v&&x&&h.fieldsIndex?.has(x)&&
!v.includes(x)&&v.push(x);r&&r.forEach(b=>{({keyField:b}=b);v&&b&&h.fieldsIndex?.has(b)&&!v.includes(b)&&v.push(b)});return v};l.hasPopupTemplate=function(h,n){return null!=w(h,{defaultPopupTemplateEnabled:n})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(l,E,w,h,n,C,A,D,x){return r=>{r=class extends r{initialize(){this.addHandles(h.on(()=>this.layer,"refresh",v=>{this.doRefresh(v.dataChanged).catch(b=>{w.isAbortError(b)||E.getLogger(this).error(b)})}),"RefreshableLayerView")}};l.__decorate([n.property()],r.prototype,"layer",void 0);return r=l.__decorate([x.subclass("esri.layers.mixins.RefreshableLayerView")],r)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/rasterDatasets/multidimensionalUtils ../engine/flow/FlowView2D ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ./support/util ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(l,
E,w,h,n,C,A,D,x,r,v,b,t,k,p,y,B,G,N){A=class extends B(N(t.LayerView2DMixin(G))){constructor(){super(...arguments);this._useProgressiveUpdate=this._useWebGLForProcessing=!0;this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(a){this._useWebGLForProcessing=a;this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=a)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(a){this._useProgressiveUpdate=
a;this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=a)}get displayParameters(){const {layer:a}=this,c=this._get("displayParameters");return a.renderer?{bandIds:a.bandIds,renderer:a.renderer,interpolation:a.interpolation,multidimensionalDefinition:a.multidimensionalDefinition,rasterFunction:"imagery-tile"===a.type?a.rasterFunction:null}:c}update(a){this.subview?.update(a);this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage();
this._updateSubview();this.addAttachHandles([n.watch(()=>this.displayParameters,(a,c)=>{const d=a.interpolation!==c?.interpolation&&("majority"===a.interpolation||"majority"===c?.interpolation)&&y.canUseMajorityInterpolationOnDataSource(this.layer),m=a.renderer!==c?.renderer&&this._getSubviewType(c?.renderer)!==this._getSubviewType(a.renderer);m&&this._updateSubview();const g=a.rasterFunction!==c?.rasterFunction,q=g&&!this._useWebGLForProcessing;this.subview.redrawOrRefetch({refetch:a.multidimensionalDefinition!==
c?.multidimensionalDefinition||d||m||q,reprocess:g}).catch(e=>{h.isAbortError(e)||w.getLogger(this).error(e)});this.notifyChange("updating")}),n.watch(()=>this.layer.multidimensionalSubset??null,(a,c)=>{const {multidimensionalDefinition:d}=this.layer;null!=d&&v.hasExcludedVariableOrDimension(d,a)!==v.hasExcludedVariableOrDimension(d,c)&&(this.subview.redrawOrRefetch({refetch:!0}).catch(m=>{h.isAbortError(m)||w.getLogger(this).error(m)}),this.notifyChange("updating"))},n.sync),n.watch(()=>this.timeExtent,
()=>{this.subview.timeExtent=this.timeExtent;this.subview.redrawOrRefetch({refetch:!0}).catch(a=>{h.isAbortError(a)||w.getLogger(this).error(a)})},n.initial)])}detach(){this.layer.decreaseRasterJobHandlerUsage();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}async hitTest(a,c){return[{type:"graphic",layer:this.layer,mapPoint:a,graphic:new E({attributes:{},geometry:a.clone()})}]}doRefresh(){return this.subview?
this.subview.doRefresh():Promise.resolve()}_updateSubview(){var {renderer:a}=this.layer;if(a){a=this._getSubviewType(a);if(this.subview){if(this.subview.type===a){this._attachSubview(this.subview);return}this._detachSubview(this.subview);this.subview?.destroy();this.subview=null}var {layer:c}=this;a="rasterVF"===a?new p({layer:c,layerView:this}):"flow"===a?new b({layer:c,layerView:this}):new k({layer:c,layerView:this});"useWebGLForProcessing"in a&&(a.useWebGLForProcessing=this._useWebGLForProcessing);
"useProgressiveUpdate"in a&&(a.useProgressiveUpdate=this._useProgressiveUpdate);"previousLOD"in a&&({subview:c}=this,a.previousLOD=c&&"previousLOD"in c?c.previousLOD:null);this._attachSubview(a);this.subview=a;this.requestUpdate()}}_attachSubview(a){a&&!a.attached&&(a.attach(),a.attached=!0,this.container.addChildAt(a.container,0))}_detachSubview(a){a?.attached&&(this.container.removeChild(a.container),a.detach(),a.attached=!1)}_getSubviewType(a){a=a?.type;return"vector-field"===a?"rasterVF":"flow"===
a?"flow":"raster"}};l.__decorate([C.property()],A.prototype,"subview",void 0);l.__decorate([C.property()],A.prototype,"useWebGLForProcessing",null);l.__decorate([C.property()],A.prototype,"useProgressiveUpdate",null);l.__decorate([C.property({readOnly:!0})],A.prototype,"displayParameters",null);return A=l.__decorate([r.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],A)});