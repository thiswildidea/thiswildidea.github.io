// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),function(n,N,B,D,u,A,S,G,T,U,Q,p,y){B=class extends B{constructor(){super(...arguments);
this._loadImagery=(I,J,v,q,L)=>Q.loadImagery(this.layer,I,J,v,q,L);this._createFlowMesh=(I,J,v,q)=>this.layer.createFlowMesh({meshType:I,flowData:v,simulationSettings:J},{signal:q});this.attached=!1;this.type="flow";this.timeExtent=null;this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const {layer:I}=this,J=()=>{this._loadImagery=(v,q,L,K,a)=>Q.loadImagery(I,v,q,L,K,a);this._updateVisualization()};"multidimensionalDefinition"in
I?this.addHandles(D.watch(()=>I.multidimensionalDefinition,J)):this.addHandles([D.watch(()=>I.mosaicRule,J),D.watch(()=>I.rasterFunction,J),D.watch(()=>I.definitionExpression,J)]);this.container=new p;this._strategy=new y({flowContainer:this.container});this._updateVisualization()}detach(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()}update(I){I.stationary?this._strategy.update(I):this.layerView.requestUpdate()}hitTest(I){return new N({attributes:{},
geometry:I.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){var I=this.layer.renderer;null!=I&&"flow"===I.type&&(I=U(I,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=I,this.layerView.requestUpdate())}};n.__decorate([u.property()],B.prototype,"_strategy",void 0);n.__decorate([u.property()],B.prototype,"attached",void 0);n.__decorate([u.property()],B.prototype,"container",void 0);n.__decorate([u.property()],
B.prototype,"layer",void 0);n.__decorate([u.property()],B.prototype,"layerView",void 0);n.__decorate([u.property()],B.prototype,"type",void 0);n.__decorate([u.property()],B.prototype,"updating",null);n.__decorate([u.property()],B.prototype,"timeExtent",void 0);return B=n.__decorate([T.subclass("esri.views.2d.engine.flow.FlowView2D")],B)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils","./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],function(n,
N,B,D,u){return function(A,S){const {flowSpeed:G,trailLength:T}=A,U=n.getFlowSimulationSettings(A);let Q=null;const p={opacity:n.getOpacity(A),size:n.getSize(A)};let y=n.getColor(A);"none"===A.background?p.color=y:("constant"===y.kind&&(y={kind:"ramp",stops:[0,1],values:[0,0,0,1,y.value[0],y.value[1],y.value[2],y.value[3]],count:2}),Q=new N.Imagery({loadImagery:S.loadImagery,timeExtent:S.timeExtent,color:y,opacity:{kind:"constant",value:[1]}}),p.color=n.getForegroundColor());S={loadImagery:S.loadImagery,
createFlowMesh:S.createFlowMesh,simulationSettings:U,timeExtent:S.timeExtent,trailLength:T,flowSpeed:G,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:p.color,opacity:p.opacity,size:p.size};A="butt"===A.trailCap||4>=n.getMax(n.getSize(A))?new u(S):new B.Particles(S);return null!=Q?new D.Stack([Q,A]):A}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/screenUtils"],function(n,N){function B(G){return"constant"===G.kind?G.value[0]:
G.values[G.values.length-1]}function D(G){G=G.toRgba();return[G[0]/255,G[1]/255,G[2]/255,G[3]]}function u(G){if(!G.hasVisualVariables("size"))return{kind:"constant",value:[N.pt2px(G.trailWidth)]};const T=G.getVisualVariablesForType("size")[0];G=[];const U=[];if(T.stops){for(Q of T.stops)G.push(Q.value),U.push(N.pt2px(Q.size));var Q=T.stops.length}else G.push(T.minDataValue,T.maxDataValue),U.push(N.pt2px(T.minSize),N.pt2px(T.maxSize)),Q=2;return{kind:"ramp",stops:G,values:U,count:Q}}function A(G,T,
U,Q){switch(T){case "int":G.setUniform1iv(U,Q);break;case "float":G.setUniform1fv(U,Q);break;case "vec2":G.setUniform2fv(U,Q);break;case "vec3":G.setUniform3fv(U,Q);break;case "vec4":G.setUniform4fv(U,Q)}}function S(G,T){return G===T?!0:null!=G&&null!=T?G.equals(T):!1}n.areStreamlinesCompatible=function(G,T){var U=G.simulationSettings,Q=T.simulationSettings;let p;p=(p=(p=(p=(p=(p=(p=(p=(p=(p=(p=U.collisions===Q.collisions)&&U.density===Q.density)&&U.interpolate===Q.interpolate)&&U.lineCollisionWidth===
Q.lineCollisionWidth)&&U.lineSpacing===Q.lineSpacing)&&U.maxTurnAngle===Q.maxTurnAngle)&&U.minSpeedThreshold===Q.minSpeedThreshold)&&U.segmentLength===Q.segmentLength)&&U.smoothing===Q.smoothing)&&U.velocityScale===Q.velocityScale)&&U.verticesPerLine===Q.verticesPerLine;return p&&S(G.timeExtent,T.timeExtent)?U=(U=(U=(U=(U=G.loadImagery===T.loadImagery)&&G.createFlowMesh===T.createFlowMesh)&&G.color.kind===T.color.kind)&&G.opacity.kind===T.opacity.kind)&&G.size.kind===T.size.kind:!1};n.getColor=function(G){if(!G.hasVisualVariables("color"))return{kind:"constant",
value:D(G.color)};G=G.getVisualVariablesForType("color")[0];const T=[],U=[];for(const Q of G.stops)T.push(Q.value),Array.prototype.push.apply(U,D(Q.color));return{kind:"ramp",stops:T,values:U,count:G.stops.length}};n.getFlowSimulationSettings=function(G){var T=u(G);T=B(T);const U=Math.max(T/2,5),Q=Math.round(N.pt2px(G.maxPathLength)/U)+1,{density:p}=G;return{smoothing:N.pt2px(G.smoothing),interpolate:!0,velocityScale:"flow-from"===G.flowRepresentation?1:-1,verticesPerLine:Q,minSpeedThreshold:.001,
segmentLength:U,maxTurnAngle:1,collisions:!0,lineCollisionWidth:T,lineSpacing:10,density:p}};n.getForegroundColor=function(G){return{kind:"constant",value:[.1,.1,.1,1]}};n.getMax=B;n.getOpacity=function(G){if(!G.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};G=G.getVisualVariablesForType("opacity")[0];const T=[],U=[];for(const Q of G.stops)T.push(Q.value),U.push(Q.opacity);return{kind:"ramp",stops:T,values:U,count:G.stops.length}};n.getSize=u;n.setUniform=A;n.setUniforms=function(G,
T,U,Q){"constant"===Q.kind?A(G,U,`u_${T}`,Q.value):(A(G,"float",`u_${T}_stops`,Q.stops),A(G,U,`u_${T}_values`,Q.values),G.setUniform1i(`u_${T}_count`,Q.count))};n.timeExtentsEqual=S;n.toRgba=D;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(n,N,B,D,u,A,S,G,T){class U{constructor(J){this._params=J;this.animated=!1}isCompatible(J){if(!(J instanceof U&&B.timeExtentsEqual(this._params.timeExtent,J._params.timeExtent)))return!1;let v;return v=(v=(v=this._params.loadImagery===J._params.loadImagery)&&this._params.color.kind===J._params.color.kind)&&this._params.opacity.kind===J._params.opacity.kind}async load(J,v){const {extent:q,size:L}=J;N.throwIfAborted(v);J=await this._params.loadImagery(q,L[0],L[1],this._params.timeExtent,v);
return new I(J,{color:this._params.color,opacity:this._params.opacity})}render(J,v,q){({context:J}=J);const {program:L}=q;J.setFaceCullingEnabled(!1);J.setBlendingEnabled(!0);J.setBlendFunction(u.BlendFactor.ONE,u.BlendFactor.ONE_MINUS_SRC_ALPHA);J.useProgram(L);L.setUniformMatrix3fv("u_dvsMat3",v.dvsMat3);J.bindTexture(q.texture,0);L.setUniform1i("u_texture",0);L.setUniform1f("u_Min",q.min);L.setUniform1f("u_Max",q.max);B.setUniforms(L,"color","vec4",this._params.color);B.setUniforms(L,"opacity",
"float",this._params.opacity);J.bindVAO(q.vertexArray);J.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4)}}const Q=new Map;Q.set("a_position",0);Q.set("a_texcoord",1);const p={geometry:[new T.VertexElementDescriptor("a_position",2,u.DataType.UNSIGNED_SHORT,0,8),new T.VertexElementDescriptor("a_texcoord",2,u.DataType.UNSIGNED_SHORT,4,8)]},y={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:Q};class I{constructor(J,v){this._flowData=J;this._values=v}attach(J){var {context:v}=J;const {width:q,
height:L}=this._flowData;var K={geometry:D.BufferObject.createVertex(v,u.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,q,0,1,1,0,L,0,0,q,L,1,0]))};K=new G.VertexArrayObject(v,Q,p,K);var a=[];"ramp"===this._values.color.kind&&a.push("vvColor");"ramp"===this._values.opacity.kind&&a.push("vvOpacity");J=J.painter.materialManager.getProgram(y,a);a=1E6;let b=-1E6;for(var d=0;d<L;d++)for(var g=0;g<q;g++)if(0!==this._flowData.mask[d*q+g]){var e=this._flowData.data[2*(d*q+g)],f=this._flowData.data[2*(d*q+g)+
1];e=Math.sqrt(e*e+f*f);a=Math.min(a,e);b=Math.max(b,e)}d=new Uint8Array(4*q*L);for(g=0;g<L;g++)for(e=0;e<q;e++)if(0!==this._flowData.mask[g*q+e]){f=this._flowData.data[2*(g*q+e)];const h=this._flowData.data[2*(g*q+e)+1];d[4*(g*q+e)]=(Math.sqrt(f*f+h*h)-a)/(b-a)*255;d[4*(g*q+e)+1]=0;d[4*(g*q+e)+2]=0;d[4*(g*q+e)+3]=255}else d[4*(g*q+e)]=0,d[4*(g*q+e)+1]=0,d[4*(g*q+e)+2]=0,d[4*(g*q+e)+3]=0;g=new S.TextureDescriptor;g.internalFormat=u.PixelFormat.RGBA;g.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE;g.flipped=
!0;g.width=q;g.height=L;v=new A.Texture(v,g,d);this.vertexArray=K;this.program=J;this.texture=v;this.min=a;this.max=b;this._flowData=null}detach(){this.vertexArray.dispose();this.texture.dispose()}get ready(){return this.program.compiled}}n.Imagery=U;n.ImageryResources=I;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(n,N,B,D,u,A,S){class G{constructor(y){this._params=y}get animated(){return 0<this._params.flowSpeed}isCompatible(y){return y instanceof G?B.areStreamlinesCompatible(this._params,y._params):!1}async load(y,I){const {extent:J,size:v}=y;N.throwIfAborted(I);y=await this._params.loadImagery(J,v[0],v[1],this._params.timeExtent,I);const {vertexData:q,indexData:L}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,y,I);return new p(q,L,{color:this._params.color,opacity:this._params.opacity,
size:this._params.size})}render(y,I,J){({context:y}=y);const {program:v}=J;y.setFaceCullingEnabled(!1);y.setBlendingEnabled(!0);y.setBlendFunction(u.BlendFactor.ONE,u.BlendFactor.ONE_MINUS_SRC_ALPHA);y.useProgram(v);v.setUniform1f("u_time",I.time);v.setUniform1f("u_trailLength",this._params.trailLength);v.setUniform1f("u_flowSpeed",this._params.flowSpeed);v.setUniform1f("u_featheringSize",this._params.featheringSize);v.setUniform1f("u_featheringOffset",this._params.featheringOffset);v.setUniform1f("u_introFade",
this._params.introFade?1:0);v.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);v.setUniform1f("u_decayRate",this._params.decayRate);v.setUniformMatrix3fv("u_dvsMat3",I.dvsMat3);v.setUniformMatrix3fv("u_displayViewMat3",I.displayViewMat3);B.setUniforms(v,"color","vec4",this._params.color);B.setUniforms(v,"opacity","float",this._params.opacity);B.setUniforms(v,"size","float",this._params.size);y.bindVAO(J.vertexArray);y.drawElements(u.PrimitiveType.TRIANGLES,J.indexCount,u.DataType.UNSIGNED_INT,
0)}}const T=new Map;T.set("a_xyts0",0);T.set("a_xyts1",1);T.set("a_typeIdDurationSeed",2);T.set("a_extrudeInfo",3);const U={geometry:[new S.VertexElementDescriptor("a_xyts0",4,u.DataType.FLOAT,0,64),new S.VertexElementDescriptor("a_xyts1",4,u.DataType.FLOAT,16,64),new S.VertexElementDescriptor("a_typeIdDurationSeed",4,u.DataType.FLOAT,32,64),new S.VertexElementDescriptor("a_extrudeInfo",4,u.DataType.FLOAT,48,64)]},Q={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:T};class p{constructor(y,
I,J){this._vertexData=y;this._indexData=I;this._values=J}attach(y){var {context:I}=y,J=D.BufferObject.createVertex(I,u.Usage.STATIC_DRAW,this._vertexData);const v=D.BufferObject.createIndex(I,u.Usage.STATIC_DRAW,this._indexData);I=new A.VertexArrayObject(I,T,U,{geometry:J},v);J=[];"ramp"===this._values.color.kind&&J.push("vvColor");"ramp"===this._values.opacity.kind&&J.push("vvOpacity");"ramp"===this._values.size.kind&&J.push("vvSize");y=y.painter.materialManager.getProgram(Q,J);this.vertexArray=
I;this.program=y;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}n.Particles=G;n.ParticlesResources=p;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports"],function(n){class N{constructor(D){this._styles=D}get animated(){return this._styles.reduce((D,u)=>D||u.animated,!1)}isCompatible(D){if(!(D instanceof N)||this._styles.length!==
D._styles.length)return!1;const u=this._styles.length;for(let A=0;A<u;A++)if(!this._styles[A].isCompatible(D._styles[A]))return!1;return!0}async load(D,u){const A=await Promise.all(this._styles.map(S=>S.load(D,u)));return new B(A)}render(D,u,A){for(let S=0;S<this._styles.length;S++)this._styles[S].render(D,u,A.resources[S])}}class B{constructor(D){this.resources=D}attach(D){for(const u of this.resources)u.attach(D)}detach(){for(const D of this.resources)D.detach()}get ready(){return this.resources.reduce((D,
u)=>D&&u.ready,!0)}}n.Stack=N;n.StackResources=B;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(n,N,B,D,u,A){class S{constructor(p){this._params=p}get animated(){return 0<this._params.flowSpeed}isCompatible(p){return p instanceof
S?N.areStreamlinesCompatible(this._params,p._params):!1}async load(p,y){const {extent:I,size:J}=p;n.throwIfAborted(y);p=await this._params.loadImagery(I,J[0],J[1],this._params.timeExtent,y);const {vertexData:v,indexData:q}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,p,y);return new Q(v,q,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(p,y,I){({context:p}=p);const {program:J}=I;p.setFaceCullingEnabled(!1);p.setBlendingEnabled(!0);
p.setBlendFunction(D.BlendFactor.ONE,D.BlendFactor.ONE_MINUS_SRC_ALPHA);p.useProgram(J);J.setUniform1f("u_time",y.time);J.setUniform1f("u_trailLength",this._params.trailLength);J.setUniform1f("u_flowSpeed",this._params.flowSpeed);J.setUniform1f("u_featheringSize",this._params.featheringSize);J.setUniform1f("u_featheringOffset",this._params.featheringOffset);J.setUniform1f("u_introFade",this._params.introFade?1:0);J.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);J.setUniform1f("u_decayRate",
this._params.decayRate);J.setUniformMatrix3fv("u_dvsMat3",y.dvsMat3);J.setUniformMatrix3fv("u_displayViewMat3",y.displayViewMat3);N.setUniforms(J,"color","vec4",this._params.color);N.setUniforms(J,"opacity","float",this._params.opacity);N.setUniforms(J,"size","float",this._params.size);p.bindVAO(I.vertexArray);p.drawElements(D.PrimitiveType.TRIANGLES,I.indexCount,D.DataType.UNSIGNED_INT,0)}}const G=new Map;G.set("a_positionAndSide",0);G.set("a_timeInfo",1);G.set("a_extrude",2);G.set("a_speed",3);
const T={geometry:[new A.VertexElementDescriptor("a_positionAndSide",3,D.DataType.FLOAT,0,36),new A.VertexElementDescriptor("a_timeInfo",3,D.DataType.FLOAT,12,36),new A.VertexElementDescriptor("a_extrude",2,D.DataType.FLOAT,24,36),new A.VertexElementDescriptor("a_speed",1,D.DataType.FLOAT,32,36)]},U={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:G};class Q{constructor(p,y,I){this._vertexData=p;this._indexData=y;this._values=I}attach(p){var {context:y}=p,I=B.BufferObject.createVertex(y,
D.Usage.STATIC_DRAW,this._vertexData);const J=B.BufferObject.createIndex(y,D.Usage.STATIC_DRAW,this._indexData);y=new u.VertexArrayObject(y,G,T,{geometry:I},J);I=[];"ramp"===this._values.color.kind&&I.push("vvColor");"ramp"===this._values.opacity.kind&&I.push("vvOpacity");"ramp"===this._values.size.kind&&I.push("vvSize");p=p.painter.materialManager.getProgram(U,I);this.vertexArray=y;this.program=p;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}
return S})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(n,N,B,D,u,A,S,G,T){function U(a,b){const d=y(b.data,b.width,b.height,a.smoothing);return a.interpolate?(g,e)=>{const f=Math.floor(g),h=Math.floor(e);if(0>f||f>=b.width||0>h||
h>=b.height)return[0,0];g-=f;e-=h;const k=f<b.width-1?f+1:f,m=h<b.height-1?h+1:h;return[(d[2*(h*b.width+f)]*(1-e)+d[2*(m*b.width+f)]*e)*(1-g)+(d[2*(h*b.width+k)]*(1-e)+d[2*(m*b.width+k)]*e)*g,(d[2*(h*b.width+f)+1]*(1-e)+d[2*(m*b.width+f)+1]*e)*(1-g)+(d[2*(h*b.width+k)+1]*(1-e)+d[2*(m*b.width+k)+1]*e)*g]}:(g,e)=>{g=Math.round(g);e=Math.round(e);return 0>g||g>=b.width||0>e||e>=b.height?[0,0]:[d[2*(e*b.width+g)],d[2*(e*b.width+g)+1]]}}function Q(a,b,d,g,e,f,h,k,m){const r=[];let w=0,[t,z]=b(d,g);t*=
a.velocityScale;z*=a.velocityScale;r.push({x:d,y:g,t:w,speed:Math.sqrt(t*t+z*z)});for(let R=0;R<a.verticesPerLine;R++){let [M,Y]=b(d,g);M*=a.velocityScale;Y*=a.velocityScale;const X=Math.sqrt(M*M+Y*Y);if(X<a.minSpeedThreshold)break;const ca=M/X,ba=Y/X;d+=ca*a.segmentLength;g+=ba*a.segmentLength;w+=a.segmentLength/X;if(Math.acos(ca*C+ba*P)>a.maxTurnAngle)break;if(a.collisions){var C=Math.round(d*m);var P=Math.round(g*m);if(0>C||C>h-1||0>P||P>k-1)break;const aa=f[P*h+C];if(-1!==aa&&aa!==e)break;f[P*
h+C]=e}r.push({x:d,y:g,t:w,speed:X});C=ca;P=ba}return r}function p(a,b,d,g){const e=[],f=new S,h=1/Math.max(a.lineCollisionWidth,1),k=Math.round(d*h),m=Math.round(g*h),r=new Int32Array(k*m);for(var w=0;w<r.length;w++)r[w]=-1;w=[];for(let t=0;t<g;t+=a.lineSpacing)for(let z=0;z<d;z+=a.lineSpacing)w.push({x:z,y:t,sort:f.getFloat()});w.sort((t,z)=>t.sort-z.sort);for(const {x:t,y:z}of w)f.getFloat()<a.density&&(d=Q(a,b,t,z,e.length,r,k,m,h),2>d.length||e.push(d));return e}function y(a,b,d,g){if(0===g)return a;
const e=Math.round(3*g),f=Array(2*e+1);var h=0;for(var k=-e;k<=e;k++){var m=Math.exp(-k*k/(g*g));f[k+e]=m;h+=m}for(g=-e;g<=e;g++)f[g+e]/=h;h=new Float32Array(a.length);for(g=0;g<d;g++)for(k=0;k<b;k++){var r=m=0;for(var w=-e;w<=e;w++)if(!(0>k+w||k+w>=b)){var t=f[w+e];m+=t*a[2*(g*b+(k+w))];r+=t*a[2*(g*b+(k+w))+1]}h[2*(g*b+k)]=m;h[2*(g*b+k)+1]=r}a=new Float32Array(a.length);for(g=0;g<b;g++)for(k=0;k<d;k++){r=m=0;for(w=-e;w<=e;w++)0>k+w||k+w>=d||(t=f[w+e],m+=t*h[2*((k+w)*b+g)],r+=t*h[2*((k+w)*b+g)+1]);
a[2*(k*b+g)]=m;a[2*(k*b+g)+1]=r}return a}function I(a,b){const d=new S;var g=a.reduce((k,m)=>k+m.length,0);g=new Float32Array(4*g);const e=Array(a.length);let f=0,h=0;for(const k of a){a=f;for(const m of k)g[4*f]=m.x,g[4*f+1]=m.y,g[4*f+2]=m.t,g[4*f+3]=m.speed,f++;e[h++]={startVertex:a,numberOfVertices:k.length,totalTime:k[k.length-1].t,timeSeed:b?d.getFloat():0}}return{lineVertices:g,lineDescriptors:e}}function J(a,b){function d(C,P,R,M,Y,X,ca,ba){const aa=9*m;let ea=0;k[aa+ea++]=C;k[aa+ea++]=P;k[aa+
ea++]=1;k[aa+ea++]=R;k[aa+ea++]=X;k[aa+ea++]=ca;k[aa+ea++]=M/2;k[aa+ea++]=Y/2;k[aa+ea++]=ba;m++;k[aa+ea++]=C;k[aa+ea++]=P;k[aa+ea++]=-1;k[aa+ea++]=R;k[aa+ea++]=X;k[aa+ea++]=ca;k[aa+ea++]=-M/2;k[aa+ea++]=-Y/2;k[aa+ea++]=ba;m++}const {lineVertices:g,lineDescriptors:e}=a;var f=a=0;for(var h of e)a+=2*h.numberOfVertices,f+=6*(h.numberOfVertices-1);const k=new Float32Array(9*a);h=new Uint32Array(f);let m=0;a=0;for(const C of e){const {totalTime:P,timeSeed:R}=C;let M=f=null,Y=null;var r=null,w=null,t=null;
for(let X=0;X<C.numberOfVertices;X++){r=g[4*(C.startVertex+X)];const ca=g[4*(C.startVertex+X)+1],ba=g[4*(C.startVertex+X)+2],aa=g[4*(C.startVertex+X)+3];let ea=null,ka=null;var z=null;let c=null;0<X&&(ea=r-f,ka=ca-M,z=Math.sqrt(ea*ea+ka*ka),ea/=z,ka/=z,1<X?(w=ea+w,t=ka+t,z=Math.sqrt(w*w+t*t),w/=z,t/=z,z=Math.min(1/(w*ea+t*ka),b),w*=z,t*=z,z=-t,c=w):(z=-ka,c=ea),null!==z&&null!==c&&(d(f,M,Y,z,c,P,R,aa),h[a++]=m-2,h[a++]=m,h[a++]=m-1,h[a++]=m,h[a++]=m+1,h[a++]=m-1));f=r;M=ca;Y=ba;w=ea;t=ka;r=aa}d(f,
M,Y,-t,w,P,R,r)}return{vertexData:k,indexData:h}}function v(a){function b(x,E){var O=ba+ea,F=aa+ka,V=Math.sqrt(O*O+F*F);O/=V;F/=V;var W=ba*O+aa*F,H=ea+c,da=ka+l;V=Math.sqrt(H*H+da*da);H/=V;da/=V;var Z=ea*H+ka*da;V=z;var ja=C,ia=P,ha=R;F=-(F/W);O/=W;W=M;var la=Y,ma=X,na=ca;da=-(da/Z);H/=Z;Z=16*w;let fa=0;for(const pa of[1,2])for(const qa of[1,2,3,4])m[Z+fa++]=V,m[Z+fa++]=ja,m[Z+fa++]=ia,m[Z+fa++]=ha,m[Z+fa++]=W,m[Z+fa++]=la,m[Z+fa++]=ma,m[Z+fa++]=na,m[Z+fa++]=pa,m[Z+fa++]=qa,m[Z+fa++]=x,m[Z+fa++]=
E,m[Z+fa++]=F/2,m[Z+fa++]=O/2,m[Z+fa++]=da/2,m[Z+fa++]=H/2,w++;r[t++]=w-8;r[t++]=w-7;r[t++]=w-6;r[t++]=w-7;r[t++]=w-5;r[t++]=w-6;r[t++]=w-4;r[t++]=w-3;r[t++]=w-2;r[t++]=w-3;r[t++]=w-1;r[t++]=w-2}function d(x,E,O,F,V,W){ba=ea;aa=ka;ea=c;ka=l;null==ba&&null==aa&&(ba=ea,aa=ka);if(null!=M&&null!=Y){c=x-M;l=E-Y;const H=Math.sqrt(c*c+l*l);c/=H;l/=H}null!=ba&&null!=aa&&b(V,W);z=M;C=Y;P=X;R=ca;M=x;Y=E;X=O;ca=F}function g(x,E){ba=ea;aa=ka;ea=c;ka=l;null==ba&&null==aa&&(ba=ea,aa=ka);null!=ba&&null!=aa&&b(x,
E)}const {lineVertices:e,lineDescriptors:f}=a;let h=a=0;for(var k of f){const x=k.numberOfVertices-1;a+=8*x;h+=12*x}const m=new Float32Array(16*a),r=new Uint32Array(h);let w=0,t=0,z,C,P,R,M,Y,X,ca,ba,aa,ea,ka,c,l;for(const x of f){l=c=ka=ea=aa=ba=ca=X=Y=M=R=P=C=z=null;const {totalTime:E,timeSeed:O}=x;for(k=0;k<x.numberOfVertices;k++)d(e[4*(x.startVertex+k)],e[4*(x.startVertex+k)+1],e[4*(x.startVertex+k)+2],e[4*(x.startVertex+k)+3],E,O);g(E,O)}return{vertexData:m,indexData:r}}function q(a,b){const d=
b.pixels,{width:g,height:e}=b,f=new Float32Array(g*e*2),h=b.mask||new Uint8Array(g*e*2);b.mask||h.fill(255);if("vector-uv"===a)for(a=0;a<g*e;a++)f[2*a]=d[0][a],f[2*a+1]=-d[1][a];else if("vector-magdir"===a)for(a=0;a<g*e;a++){b=d[0][a];const k=u.deg2rad(d[1][a]),m=Math.sin(k-Math.PI/2);f[2*a]=Math.cos(k-Math.PI/2)*b;f[2*a+1]=m*b}return{data:f,mask:h,width:g,height:e}}async function L(a,b,d,g,e,f){const h={requestProjectedLocalDirections:!0,signal:f};null!=e&&(h.timeExtent=e);if("imagery"===a.type)return await a.load({signal:f}),
e=a.rasterInfo.dataType,a=await a.fetchImage(b,d,g,h),null==a?.pixelData?.pixelBlock?{data:new Float32Array(d*g*2),mask:new Uint8Array(d*g),width:d,height:g}:q(e,a.pixelData.pixelBlock);await a.load({signal:f});e=a.rasterInfo.dataType;a=await a.fetchPixels(b,d,g,h);return null==a?.pixelBlock?{data:new Float32Array(d*g*2),mask:new Uint8Array(d*g),width:d,height:g}:q(e,a.pixelBlock)}const K=D.getLogger("esri.views.2d.engine.flow.dataUtils");n.createAnimatedLinesData=I;n.createFlowMesh=async function(a,
b,d,g){const e=performance.now();var f=U(b,d);const h=performance.now();d=p(b,f,d.width,d.height);b=performance.now();f=I(d,!0);d=performance.now();a="Streamlines"===a?J(f,10):v(f);f=performance.now();B("esri-2d-profiler")&&(K.info("I.1","_createFlowFieldFromData (ms)",Math.round(h-e)),K.info("I.2","_getStreamlines (ms)",Math.round(b-h)),K.info("I.3","createAnimatedLinesData (ms)",Math.round(d-b)),K.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(f-d)),K.info("I.5","createFlowMesh (ms)",
Math.round(f-e)),K.info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();A.throwIfAborted(g);return a};n.createParticlesMesh=v;n.createStreamlinesMesh=J;n.loadImagery=async function(a,b,d,g,e,f){const h=performance.now();var k=G.getInfo(b.spatialReference);if(!k)return d=await L(a,b,d,g,e,f),B("esri-2d-profiler")&&K.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-h)),B("esri-2d-profiler")&&K.info("I.9","Number of parts",
1),d;const [m,r]=k.valid,w=Math.ceil(b.width/(r-m)),t=b.width/w,z=Math.round(d/w);let C=b.xmin;const P=[];k=performance.now();for(let R=0;R<w;R++){const M=new T({xmin:C,xmax:C+t,ymin:b.ymin,ymax:b.ymax,spatialReference:b.spatialReference});P.push(L(a,M,z,g,e,f));C+=t}a=await Promise.all(P);B("esri-2d-profiler")&&K.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-k));B("esri-2d-profiler")&&K.info("I.9","Number of parts",a.length);g={data:new Float32Array(d*g*2),mask:new Uint8Array(d*
g),width:d,height:g};b=0;for(const R of a){for(a=0;a<R.height;a++)for(e=0;e<R.width;e++)b+e>=d||(g.data[2*(a*d+b+e)]=R.data[2*(a*R.width+e)],g.data[2*(a*d+b+e)+1]=R.data[2*(a*R.width+e)+1],g.mask[a*d+b+e]=R.mask[a*R.width+e]);b+=R.width}B("esri-2d-profiler")&&K.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-h));return g};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["./BrushFlow","../webgl/enums",
"../webgl/WGLContainer"],function(n,N,B){class D extends B{constructor(){super(...arguments);this.flowStyle=null}doRender(u){super.doRender(u)}prepareRenderPasses(u){const A=u.registerRenderPass({name:"flow",brushes:[n],target:()=>this.children,drawPhase:N.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(u),A]}}return D})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../chunks/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(n,N,B){class D extends N{constructor(){super(...arguments);
this._visualState={time:0,dvsMat3:n.create(),displayViewMat3:n.create()}}dispose(){}prepareState(u){({context:u}=u);u.setColorMask(!0,!0,!0,!0);u.setStencilFunction(B.CompareFunction.EQUAL,0,255)}draw(u,A){const {requestRender:S,allowDelayedRender:G}=u,{displayData:T}=A;if(null!=T&&("loaded"===T.state.name&&T.attach(u),"attached"===T.state.name)){var U=T.state.resources;G&&!U.ready&&null!=S?S():(this._visualState.time=u.time/1E3,this._visualState.dvsMat3=A.transforms.dvs,this._visualState.displayViewMat3=
u.state.displayViewMat3,T.flowStyle.render(u,this._visualState,U),T.flowStyle.animated&&null!=S&&S())}}}return D})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q,p,y,I,J){function v(q,L){const K=new p({x:(q.xmax+q.xmin)/2,y:(q.ymax+q.ymin)/2,spatialReference:q.spatialReference});var a=q.xmax-q.xmin;const b=q.ymax-q.ymin,d=Math.abs(Math.cos(u.deg2rad(L))),g=Math.abs(Math.sin(u.deg2rad(L)));L=d*a+g*b;a=g*a+d*b;q=new J({xmin:K.x-L/2,ymin:K.y-a/2,xmax:K.x+L/2,ymax:K.y+a/2,spatialReference:q.spatialReference});q.centerAt(K);return q}N=class extends B{constructor(q){super(q);this._flowDisplayObject=new I.FlowDisplayObject;this._loading=
null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear();this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(q){var {flowStyle:L}=this.flowContainer;if(null==L)this._clear();else{var {extent:K,rotation:a,resolution:b,pixelRatio:d}=q.state;q=v(K,a);q.expand(1.15);L=new y(L,q,[Math.round((q.xmax-q.xmin)/b),Math.round((q.ymax-q.ymin)/b)],d);if(null!=this._loading){if(this._loading.update(L))return;this._loading.detach();this._loading=
null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(L)||(L.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},g=>{A.isAbortError(g)||(D.getLogger(this).error("A resource failed to load.",g),this._loading=null)}),this._loading=L)}}_clear(){this._flowDisplayObject.clear();null!=this._loading&&(this._loading.detach(),this._loading=null)}};n.__decorate([S.property()],N.prototype,"_loading",void 0);
n.__decorate([S.property()],N.prototype,"flowContainer",void 0);n.__decorate([S.property()],N.prototype,"updating",null);return N=n.__decorate([Q.subclass("esri.views.2d.engine.flow.FlowStrategy")],N)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../core/Logger"],function(n){class N{constructor(B,D,u,A){this.state={name:"created"};this.flowStyle=B;this.extent=D;this.size=u;this.pixelRatio=A}async load(){const B=new AbortController;this.state={name:"loading",abortController:B};
this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},B.signal)}}attach(B){if("loaded"!==this.state.name)n.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var D=this.state.resources;D.attach(B);this.state={name:"attached",resources:D}}}detach(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),
this.state={name:"detached"})}update(B){if(!this.flowStyle.isCompatible(B.flowStyle)||!this.extent.equals(B.extent)||this.size[0]!==B.size[0]||this.size[1]!==B.size[1]||this.pixelRatio!==B.pixelRatio)return!1;this.flowStyle=B.flowStyle;return!0}}return N})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/mat3","../../../../chunks/mat3f32","../DisplayObject"],function(n,N,B,D,u){class A extends u.DisplayObject{constructor(){super(...arguments);
this._displayData=null}get displayData(){return this._displayData}set displayData(S){this._displayData=S;this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(S){var {displayData:G}=this;if(null!=G){var T=[0,0];S.toScreen(T,[G.extent.xmin,G.extent.ymax]);G=(G.extent.xmax-G.extent.xmin)/G.size[0]/S.resolution;var U=N.deg2rad(S.rotation),{dvs:Q}=this.transforms;B.fromTranslation(Q,[-1,1,0]);B.scale(Q,Q,[2/(S.size[0]*
S.pixelRatio),-2/(S.size[1]*S.pixelRatio),1]);B.translate(Q,Q,[T[0],T[1],0]);B.rotate(Q,Q,U);B.scale(Q,Q,[G*S.pixelRatio,G*S.pixelRatio,1])}}_createTransforms(){return{dvs:D.create()}}}n.FlowDisplayObject=A;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q,p,y,I,J,v,q){const L=B.ofType({key:"type",base:null,typeMap:{rect:J,path:q,geometry:v}});n.LayerView2DMixin=K=>{K=class extends K{constructor(){super(...arguments);this.attached=!1;this.clips=new L;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const a=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&a&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new u("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new y.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([A.watch(()=>this.suspended,b=>{this.container&&(this.container.visible=!b);this.view&&!b&&this.updateRequested&&this.view.requestUpdate()},A.syncAndInitial),A.watch(()=>this.layer?.opacity??1,b=>{this.container&&(this.container.opacity=
b)},A.syncAndInitial),A.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",b=>{this.container&&(this.container.blendMode=b)},A.syncAndInitial),A.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,b=>{this.container&&(this.container.effect=b)},A.syncAndInitial),A.watch(()=>this.highlightOptions,b=>this.container.highlightOptions=b,A.syncAndInitial),A.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},A.syncAndInitial),A.watch(()=>
({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:b})=>{b=null!=b?this.isVisibleAtScale(b):!1;b!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",b)},A.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(b=>{b===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();this.updateRequested=!1}get spatialReferenceSupported(){const a=
this.view?.spatialReference;return null==a||this.supportsSpatialReference(a)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=
!1)}isVisibleAtScale(a){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;const {minScale:d,maxScale:g}=b;return p.isInScaleRange(a,d,g)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))}hitTest(a,
b){return Promise.resolve(null)}supportsSpatialReference(a){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const a=super.getSuspendInfo(),b=!this.spatialReferenceSupported,d=this.visibleAtCurrentScale;b&&(a.spatialReferenceNotSupported=b);d&&(a.outsideScaleRange=d);return a}addAttachHandles(a){this.addHandles(a,"attach")}};N.__decorate([S.property()],K.prototype,"attached",void 0);N.__decorate([S.property({type:L,set(a){a=
D.referenceSetter(a,this._get("clips"),L);this._set("clips",a)}})],K.prototype,"clips",void 0);N.__decorate([S.property()],K.prototype,"container",void 0);N.__decorate([S.property()],K.prototype,"moving",void 0);N.__decorate([S.property({readOnly:!0})],K.prototype,"spatialReferenceSupported",null);N.__decorate([S.property({readOnly:!0})],K.prototype,"updateParameters",void 0);N.__decorate([S.property()],K.prototype,"updateRequested",void 0);N.__decorate([S.property()],K.prototype,"updating",null);
N.__decorate([S.property()],K.prototype,"view",void 0);N.__decorate([S.property({readOnly:!0})],K.prototype,"visibleAtCurrentScale",void 0);N.__decorate([S.property({type:I})],K.prototype,"highlightOptions",void 0);return K=N.__decorate([Q.subclass("esri.views.2d.layers.LayerView2D")],K)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(n,N,B){function D(u,A){A=B.getMetersPerUnitForSR(A);
return u/(A*B.inchesPerMeter*96)}n.getExtentForScale=function(u,A){const S=u.extent;u=u.width-(u.padding?u.padding.left+u.padding.right:0);A=D(A,S.spatialReference);return S.clone().expand(A*u/S.width)};n.getResolutionForScale=D;n.getResolutionInMetersForScale=function(u){return u/(96*B.inchesPerMeter)};n.getScale=function(u,A){A=A||u.extent;u=u.width;const S=B.getMetersPerUnitForSR(A?.spatialReference);return A&&u?A.width/u*S*B.inchesPerMeter*96:0};n.getScaleForResolution=function(u,A){A=B.getMetersPerUnitForSR(A);
return u*A*B.inchesPerMeter*96};n.isInScaleRange=function(u,A,S){if(A=0===A||N.floatEqualAbsolute(u,A)||u<A)A=0===S||N.floatEqualAbsolute(u,S)||u>S;return A};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(n,N,B,D,u,A,S){var G;B=G=class extends S{constructor(T){super(T);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new G({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};n.__decorate([N.property({type:[Number,String],json:{write:!0}})],B.prototype,"left",void 0);n.__decorate([N.property({type:[Number,String],
json:{write:!0}})],B.prototype,"right",void 0);n.__decorate([N.property({type:[Number,String],json:{write:!0}})],B.prototype,"top",void 0);n.__decorate([N.property({type:[Number,String],json:{write:!0}})],B.prototype,"bottom",void 0);return B=G=n.__decorate([A.subclass("esri.views.layers.support.ClipRect")],B)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(n,N,B,D,u,A,S){N=class extends N.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};n.__decorate([B.property({readOnly:!0})],N.prototype,"version",null);return N=n.__decorate([S.subclass("esri.views.layers.support.ClipArea")],N)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q,p){var y;N={base:G,key:"type",typeMap:{extent:Q,polygon:p}};U=y=class extends U{constructor(I){super(I);this.type="geometry";this.geometry=null}clone(){return new y({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};n.__decorate([B.property({types:N,json:{read:T.fromJSON,write:!0}})],U.prototype,"geometry",void 0);return U=y=n.__decorate([S.subclass("esri.views.layers.support.Geometry")],U)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(n,N,B,D,u,A,S){B=class extends S{constructor(G){super(G);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};n.__decorate([N.property({type:[[[Number]]],json:{write:!0}})],B.prototype,"path",void 0);return B=n.__decorate([A.subclass("esri.views.layers.support.Path")],B)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(n,N,B,D,u,A,S,G,T,U){N=class extends T{get hasHighlight(){return this.children.some(Q=>Q.hasData)}renderChildren(Q){if(Q.drawPhase===G.WGLDrawPhase.HIGHLIGHT&&(this.attributeView.update(),this.children.some(y=>y.hasData))){this.attributeView.bindTextures(Q.context);super.renderChildren(Q);var {painter:p}=Q;p=p.effects.highlight;p.bind(Q);Q.context.setColorMask(!0,!0,!0,!0);Q.context.clear(U.ClearBufferBit.COLOR_BUFFER_BIT);this._renderChildren(Q,p.defines.concat(["highlightAll"]));p.draw(Q);
p.unbind()}}};return N=n.__decorate([S.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],N)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q,p,y,I,J){B=class extends B{constructor(){super(...arguments);this.attached=!1;this.container=new y.Container;this.updateRequested=!1;this.type="imagery";this._bitmapView=new p.BitmapContainer}destroy(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(v){this.strategy.update(v).catch(q=>{u.isAbortError(q)||D.getLogger(this).error(q)})}hitTest(v){return new N({attributes:{},geometry:v.clone(),
layer:this.layer})}attach(){this.container.addChild(this._bitmapView);this.strategy=new J({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}detach(){this.strategy.destroy();this._bitmapView.removeAllChildren();this.container.removeAllChildren();this.updateRequested=
!1}redraw(){this.strategy.updateExports(async v=>{const {source:q}=v;if(q&&!(q instanceof ImageBitmap)){var L=await this.layer.applyRenderer({extent:q.extent,pixelBlock:q.originalPixelBlock??q.pixelBlock});q.filter=K=>this.layer.pixelFilter?this.layer.applyFilter(K):{...L,extent:q.extent}}}).catch(v=>{u.isAbortError(v)||D.getLogger(this).error(v)})}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;
var v=this.strategy.bitmaps;if(1===v.length&&v[0].source)return{extent:v[0].source.extent,pixelBlock:v[0].source.originalPixelBlock};if(1<v.length){const q=this.view.extent;v=v.map(L=>L.source).filter(L=>L.extent&&L.extent.intersects(q)).map(L=>({extent:L.extent,pixelBlock:L.originalPixelBlock}));v=Q.mosaicPixelData(v,q);return null!=v?{extent:v.extent,pixelBlock:v.pixelBlock}:null}return null}async _fetchImage(v,q,L,K){K=K||{};K.timeExtent=this.timeExtent;K.requestAsImageElement=!0;K.returnImageBitmap=
!0;v=await this.layer.fetchImage(v,q,L,K);if(v.imageBitmap)return v.imageBitmap;K=await this.layer.applyRenderer(v.pixelData,{signal:K.signal});K=new I(K.pixelBlock,K.extent?.clone(),v.pixelData.pixelBlock);K.filter=a=>this.layer.applyFilter(a);return K}};n.__decorate([A.property()],B.prototype,"attached",void 0);n.__decorate([A.property()],B.prototype,"container",void 0);n.__decorate([A.property()],B.prototype,"layer",void 0);n.__decorate([A.property()],B.prototype,"strategy",void 0);n.__decorate([A.property()],
B.prototype,"timeExtent",void 0);n.__decorate([A.property()],B.prototype,"view",void 0);n.__decorate([A.property()],B.prototype,"updateRequested",void 0);n.__decorate([A.property()],B.prototype,"updating",null);n.__decorate([A.property()],B.prototype,"type",void 0);return B=n.__decorate([U.subclass("esri.views.2d.layers.imagery.ImageryView2D")],B)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(n,N,B){function D(a){return null!=
a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function u(a,b,d,g,e){const f=a.length;e=N.createEmptyBand(e,f);if(b)for(let h=0;h<f;h++)b[h]&&(e[h]=d[a[h]-g]);else for(b=0;b<f;b++)e[b]=d[a[b]-g];return e}function A(a,b,d,g){const e=null!=d&&2<=d.length?new Set(d):null;d=1===d?.length?d[0]:null;const f=!!b?.length;for(let h=0;h<a.length;h++)if(g[h]){const k=a[h];if(f){let m=!1;for(let r=0;r<b.length;r+=2)if(k>=b[r]&&k<=b[r+1]){m=!0;break}m||(g[h]=0)}g[h]&&(k===d||
e?.has(k))&&(g[h]=0)}}function S(a,b){const d=a[0].length;for(let g=0;g<d;g++)if(b[g]){let e=!1;for(let f=0;f<a.length;f++)if(a[f][g]){e=!0;break}e||(b[g]=0)}}function G(a,b){const d=a[0].length;for(let g=0;g<d;g++)if(b[g]){let e=!1;for(let f=0;f<a.length;f++)if(0===a[f][g]){e=!0;break}e&&(b[g]=0)}}function T(a,b,d,g,e,f,h,k){return{xmin:e<=d*a?0:e<d*a+a?e-d*a:a,ymin:f<=g*b?0:f<g*b+b?f-g*b:b,xmax:e+h<=d*a?0:e+h<d*a+a?e+h-d*a:a,ymax:f+k<=g*b?0:f+k<g*b+b?f+k-g*b:b}}function U(a,b,d,g,e,f){const {width:h,
height:k}=d.block,{x:m,y:r}=d.offset,{width:w,height:t}=d.mosaic;d=T(h,k,g,e,m,r,w,t);let z=0;var C=0;if(f){var P=f.hasGCSSShiftTransform?360:f.halfWorldWidth??0,R=h*f.resolutionX;const M=f.startX+g*R;M<P&&M+R>P?C=f.rightPadding:M>=P&&(z=f.leftMargin-f.rightPadding,C=0)}d.xmax-=C;if("number"===typeof b)for(f=d.ymin;f<d.ymax;f++)for(C=(e*k+f-r)*w+(g*h-m)+z,P=d.xmin;P<d.xmax;P++)a[C+P]=b;else for(f=d.ymin;f<d.ymax;f++)for(C=(e*k+f-r)*w+(g*h-m)+z,P=f*h,R=d.xmin;R<d.xmax;R++)a[C+R]=b[P+R]}function Q(a,
b,d={}){const {clipOffset:g,clipSize:e,alignmentInfo:f,blockWidths:h}=d;if(h)return p(a,b,{blockWidths:h});var k=a.find(ca=>D(ca));if(null==k)return null;d=e?e.width:b.width;const m=e?e.height:b.height;var r=k.width,w=k.height;const t=b.width/r,z=b.height/w;b={offset:g||{x:0,y:0},mosaic:e||b,block:{width:r,height:w}};r=k.pixelType;var C=N.getPixelArrayConstructor(r);k=k.pixels.length;w=[];for(var P=0;P<k;P++){var R=new C(d*m);for(var M=0;M<z;M++)for(var Y=0;Y<t;Y++){var X=a[M*t+Y];D(X)&&(X=X.pixels[P],
U(R,X,b,Y,M,f))}w.push(R)}C=a.some(ca=>null==ca||null!=ca.mask&&0<ca.mask.length);R=a.some(ca=>ca?.bandMasks&&1<ca.bandMasks.length);C=C?new Uint8Array(d*m):void 0;R=R?[]:void 0;if(C){for(P=0;P<z;P++)for(M=0;M<t;M++)Y=a[P*t+M],X=null!=Y?Y.mask:null,null!=X?U(C,X,b,M,P,f):Y?U(C,255,b,M,P,f):U(C,0,b,M,P,f);if(R)for(P=0;P<k;P++){M=new Uint8Array(d*m);for(Y=0;Y<z;Y++)for(X=0;X<t;X++){const ca=a[Y*t+X],ba=ca?.bandMasks?.[P]??ca?.mask;null!=ba?U(M,ba,b,X,Y,f):ca?U(M,255,b,X,Y,f):U(M,0,b,X,Y,f)}R.push(M)}}a=
new N({width:d,height:m,pixels:w,pixelType:r,bandMasks:R,mask:C});a.updateStatistics();return a}function p(a,b,d){const g=a.find(M=>null!=M);if(null==g)return null;var e=a.some(M=>null!=M?!!M.mask:!0);const {width:f,height:h}=b;b=e?new Uint8Array(f*h):null;({blockWidths:d}=d);const k=[],m=g.getPlaneCount(),r=N.getPixelArrayConstructor(g.pixelType);if(e)for(let M=0,Y=0;M<a.length;Y+=d[M],M++)if(e=a[M],D(e)){var w=e.mask;for(var t=0;t<h;t++)for(var z=0;z<d[M];z++)b[t*f+z+Y]=null==w?255:w[t*e.width+
z]}w=(e=a.some(M=>M?.bandMasks&&1<M.bandMasks.length))?[]:void 0;t=f*h;for(z=0;z<m;z++){const M=new r(t),Y=e?new Uint8Array(t):void 0;for(let X=0,ca=0;X<a.length;ca+=d[X],X++){const ba=a[X];if(D(ba)){var C=ba.pixels[z];if(null!=C){for(var P=0;P<h;P++)for(var R=0;R<d[X];R++)M[P*f+R+ca]=C[P*ba.width+R];if(Y)for(C=ba.bandMasks?.[z]??ba.mask,P=0;P<h;P++)for(R=0;R<d[X];R++)Y[P*f+R+ca]=C?C[P*ba.width+R]:255}}}k.push(M);w&&Y&&w.push(Y)}a=new N({width:f,height:h,mask:b,bandMasks:w,pixels:k,pixelType:g.pixelType});
a.updateStatistics();return a}function y(a){if(!D(a))return null;const b=a.clone(),{width:d,height:g,pixels:e}=a;var f=e[0];const h=b.pixels[0];a=a.mask;for(let r=2;r<g-1;r++){const w=new Map;for(var k=r-2;k<r+2;k++)for(var m=0;4>m;m++){const t=k*d+m;v(w,f[t],a?a[t]:1)}h[r*d]=I(w);h[r*d+1]=h[r*d+2]=h[r*d];for(k=3;k<d-1;k++)m=(r-2)*d+k+1,v(w,f[m],a?a[m]:1),m=(r-1)*d+k+1,v(w,f[m],a?a[m]:1),m=r*d+k+1,v(w,f[m],a?a[m]:1),m=(r+1)*d+k+1,v(w,f[m],a?a[m]:1),m=(r-2)*d+k-3,J(w,f[m],a?a[m]:1),m=(r-1)*d+k-3,J(w,
f[m],a?a[m]:1),m=r*d+k-3,J(w,f[m],a?a[m]:1),m=(r+1)*d+k-3,J(w,f[m],a?a[m]:1),h[r*d+k]=I(w);h[r*d+k+1]=h[r*d+k]}for(f=0;f<d;f++)h[f]=h[d+f]=h[2*d+f],h[(g-1)*d+f]=h[(g-2)*d+f];b.updateStatistics();return b}function I(a){if(0===a.size)return 0;let b=0,d=-1,g=0;const e=a.keys();let f=e.next();for(;!f.done;)g=a.get(f.value),g>b&&(d=f.value,b=g),f=e.next();return d}function J(a,b,d){0!==d&&(d=a.get(b),1===d?a.delete(b):a.set(b,d-1))}function v(a,b,d){0!==d&&a.set(b,a.has(b)?a.get(b)+1:1)}function q(a,b,
d){let {x:g,y:e}=b;const {width:f,height:h}=d;if(0===g&&0===e&&h===a.height&&f===a.width)return a;const {width:k,height:m}=a;b=Math.max(0,e);const r=Math.max(0,g),w=Math.min(g+f,k),t=Math.min(e+h,m);if(0>w||0>t||!D(a))return null;g=Math.max(0,-g);e=Math.max(0,-e);var {pixels:z}=a,C=f*h,P=z.length;const R=[];for(var M=0;M<P;M++){var Y=z[M],X=N.createEmptyBand(a.pixelType,C);for(let ca=b;ca<t;ca++){const ba=ca*k;let aa=(ca+e-b)*f+g;for(let ea=r;ea<w;ea++)X[aa++]=Y[ba+ea]}R.push(X)}z=new Uint8Array(C);
C=a.mask;for(P=b;P<t;P++)for(M=P*k,Y=(P+e-b)*f+g,X=r;X<w;X++)z[Y++]=C?C[M+X]:1;a=new N({width:d.width,height:d.height,pixelType:a.pixelType,pixels:R,mask:z});a.updateStatistics();return a}function L(a,b=!0){if(!D(a))return null;const {pixels:d,width:g,height:e,mask:f,pixelType:h}=a;a=[];const k=Math.round(g/2),m=Math.round(e/2),r=e-1,w=g-1;for(var t=0;t<d.length;t++){var z=d[t],C=N.createEmptyBand(h,k*m),P=0;for(var R=0;R<e;R+=2)for(var M=0;M<g;M+=2){var Y=z[R*g+M];if(b){var X=M===w?Y:z[R*g+M+1];
const ca=R===r?Y:z[R*g+M+g],ba=M===w?ca:R===r?X:z[R*g+M+g+1];C[P++]=(Y+X+ca+ba)/4}else C[P++]=Y}a.push(C)}t=null;if(null!=f)for(t=new Uint8Array(k*m),z=0,C=0;C<e;C+=2)for(P=0;P<g;P+=2)R=f[C*g+P],b?(M=P===w?R:f[C*g+P+1],Y=C===r?R:f[C*g+P+g],X=P===w?Y:C===r?M:f[C*g+P+g+1],t[z++]=R*M*Y*X?1:0):t[z++]=R;return new N({width:k,height:m,pixelType:h,pixels:a,mask:t})}function K(a,b,d,g,e=0){const {width:f,height:h}=a,{width:k,height:m}=b;a=g.cols;g=g.rows;b=Math.ceil(k/a-.1/a);const r=Math.ceil(m/g-.1/g);
let w,t,z,C,P;const R=b*a;var M=R*r*g;const Y=new Float32Array(M),X=new Float32Array(M),ca=new Uint32Array(M),ba=new Uint32Array(M);let aa=0,ea,ka;for(let x=0;x<r;x++)for(let E=0;E<b;E++){var c=12*(x*b+E);M=d[c];w=d[c+1];t=d[c+2];z=d[c+3];C=d[c+4];P=d[c+5];for(var l=0;l<g;l++){aa=(x*g+l)*R+E*a;ka=(l+.5)/g;for(let O=0;O<l;O++)ea=(O+.5)/a,Y[aa+O]=(M*ea+w*ka+t)*f+e,X[aa+O]=(z*ea+C*ka+P)*h+e,ca[aa+O]=Math.floor(Y[aa+O]),ba[aa+O]=Math.floor(X[aa+O])}c+=6;M=d[c];w=d[c+1];t=d[c+2];z=d[c+3];C=d[c+4];P=d[c+
5];for(c=0;c<g;c++)for(aa=(x*g+c)*R+E*a,ka=(c+.5)/g,l=c;l<a;l++)ea=(l+.5)/a,Y[aa+l]=(M*ea+w*ka+t)*f+e,X[aa+l]=(z*ea+C*ka+P)*h+e,ca[aa+l]=Math.floor(Y[aa+l]),ba[aa+l]=Math.floor(X[aa+l])}return{offsets_x:Y,offsets_y:X,offsets_xi:ca,offsets_yi:ba,gridWidth:R}}n.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(n.NoDataInterpretation||(n.NoDataInterpretation={}));n.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(n.MissingBandAction||
(n.MissingBandAction={}));n.approximateTransform=function(a,b,d,g,e="nearest"){if(!D(a))return null;"majority"===e&&(a=y(a));const {pixels:f,mask:h,bandMasks:k,pixelType:m}=a,r=a.width;var w=a.height;const t=N.getPixelArrayConstructor(m),z=f.length,{width:C,height:P}=b;a=!1;for(var R=0;R<d.length;R+=3)-1===d[R]&&-1===d[R+1]&&-1===d[R+2]&&(a=!0);const {offsets_x:M,offsets_y:Y,offsets_xi:X,offsets_yi:ca,gridWidth:ba}=K({width:r,height:w},b,d,g,"majority"===e?.5:0);let aa;b=(ka,c,l,x)=>{const E=ka instanceof
Float32Array||ka instanceof Float64Array?0:.5;for(let O=0;O<P;O++){aa=O*ba;for(let F=0;F<C;F++){if(0>M[aa]||0>Y[aa])ka[O*C+F]=0;else if(x)ka[O*C+F]=c[X[aa]+ca[aa]*r];else{const V=Math.floor(M[aa]),W=Math.floor(Y[aa]),H=Math.ceil(M[aa]),da=Math.ceil(Y[aa]),Z=M[aa]-V,ja=Y[aa]-W;ka[O*C+F]=!l||l[V+W*r]&&l[H+W*r]&&l[V+da*r]&&l[H+da*r]?(1-ja)*((1-Z)*c[V+W*r]+Z*c[H+W*r])+ja*((1-Z)*c[V+da*r]+Z*c[H+da*r])+E:c[X[aa]+ca[aa]*r]}aa++}}};d=[];g=k?.length===z;w=[];for(R=0;R<z;R++){if(g){var ea=new Uint8Array(C*
P);b(ea,k[R],k[R],!0);w.push(ea)}ea=new t(C*P);b(ea,f[R],g?k[R]:h,"nearest"===e||"majority"===e);d.push(ea)}e=new N({width:C,height:P,pixelType:m,pixels:d,bandMasks:g?w:void 0});if(null!=h)e.mask=new Uint8Array(C*P),b(e.mask,h,h,!0);else if(a)for(e.mask=new Uint8Array(C*P),a=0;a<C*P;a++)e.mask[a]=0>M[a]||0>Y[a]?0:1;e.updateStatistics();return e};n.clip=q;n.colorize=function(a,b){if(!D(a)||!b||!b.indexedColormap&&!b.indexed2DColormap)return a;const d=a.clone();var g=d.pixels;let e=d.mask;const f=d.width*
d.height;if(1!==g.length)return a;const {indexedColormap:h,indexed2DColormap:k,offset:m,alphaSpecified:r}=b;a=0;g=g[0];b=new Uint8Array(g.length);const w=new Uint8Array(g.length),t=new Uint8Array(g.length);var z=0;if(h){const C=h.length-1;if(null!=e)for(a=0;a<f;a++)e[a]&&(z=4*(g[a]-m),z<m||z>C?e[a]=0:(b[a]=h[z],w[a]=h[z+1],t[a]=h[z+2],e[a]=h[z+3]));else{e=new Uint8Array(f);for(a=0;a<f;a++)z=4*(g[a]-m),z<m||z>C?e[a]=0:(b[a]=h[z],w[a]=h[z+1],t[a]=h[z+2],e[a]=h[z+3]);d.mask=e}}else if(k)if(null!=e)for(a=
0;a<f;a++)e[a]&&(z=k[g[a]],b[a]=z[0],w[a]=z[1],t[a]=z[2],e[a]=z[3]);else{e=new Uint8Array(f);for(a=0;a<f;a++)z=k[g[a]],b[a]=z[0],w[a]=z[1],t[a]=z[2],e[a]=z[3];d.mask=e}d.pixels=[b,w,t];d.statistics=null;d.pixelType="u8";d.maskIsAlpha=r;return d};n.compositeBands=function(a){if(!a?.length||a.some(m=>!D(m)))return null;if(1===a.length)return a[0]?.clone()??null;const {width:b,height:d,pixelType:g}=a[0];if(a.some(m=>m.width!==b||m.height!==d))return null;const e=a.map(({mask:m})=>m).filter(m=>null!=
m);let f=null;e.length&&(f=new Uint8Array(b*d),f.set(e[0]),1<e.length&&G(e.slice(1),f));const h=[];a.forEach(({pixels:m})=>h.push(...m));const k=[];a.map(({statistics:m})=>m).filter(m=>m?.length).forEach(m=>k.push(...m));return new N({pixelType:g,width:b,height:d,mask:f,pixels:h,statistics:k.length?k:null})};n.createColormapLUT=function(a){if(a){var b=a.colormap;if(b&&0!==b.length){b=b.sort((r,w)=>r[0]-w[0]);var d=0;0>b[0][0]&&(d=b[0][0]);var g=Math.max(256,b[b.length-1][0]-d+1),e=new Uint8Array(4*
g),f=[],h=0,k=0,m=5===b[0].length;if(65536<g)return b.forEach(r=>{f[r[0]-d]=m?r.slice(1):r.slice(1).concat([255])}),{indexed2DColormap:f,offset:d,alphaSpecified:m};if(a.fillUnspecified)for(a=b[k],h=a[0]-d;h<g;h++)e[4*h]=a[1],e[4*h+1]=a[2],e[4*h+2]=a[3],e[4*h+3]=m?a[4]:255,h===a[0]-d&&(a=k===b.length-1?a:b[++k]);else for(h=0;h<b.length;h++)a=b[h],k=4*(a[0]-d),e[k]=a[1],e[k+1]=a[2],e[k+2]=a[3],e[k+3]=m?a[4]:255;return{indexedColormap:e,offset:d,alphaSpecified:m}}}};n.createMaskLUT=function(a,b,d){if("u8"!==
a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var g=a.includes("16")?65536:256;a=a.includes("s")?-g/2:0;g=new Uint8Array(g);if(b)for(let f=0;f<b.length;f++){var e=Math.ceil(b[2*f]-a);const h=Math.floor(b[2*f+1]-a);for(;e<=h;e++)g[e]=255}else g.fill(255);if(d)for(b=0;b<d.length;b++)g[d[b]-a]=0;return{lut:g,offset:a}};n.createRemapLUT=function(a){const {srcPixelType:b,inputRanges:d,outputValues:g,allowUnmatched:e,noDataRanges:f,isLastInputRangeInclusive:h,outputPixelType:k}=a;if("u8"!==b&&"s8"!==b&&
"u16"!==b&&"s16"!==b)return null;var m=b.includes("16")?65536:256;a=b.includes("s")?-m/2:0;const r=N.createEmptyBand(k,m);m=new Uint8Array(m);e&&m.fill(255);const [w,t]=B.getPixelValueRange(k);if(d?.length&&g?.length){var z=d.map(M=>M-1E-6);z[0]=d[0];h&&(z[z.length-1]=d[d.length-1]);for(var C=0;C<z.length;C++){var P=g[C]>t?t:g[C]<w?w:g[C],R=Math.ceil(z[2*C]-a);const M=Math.floor(z[2*C+1]-a);for(;R<=M;R++)r[R]=P,m[R]=255}}if(f?.length)for(z=0;z<f.length;z++)for(P=Math.ceil(f[2*z]-a),C=Math.floor(f[2*
z+1]-a);P<=C;P++)m[P]=0;return{lut:r,offset:a,mask:m}};n.extractBands=function(a,b){return b?.length&&D(a)?a.extractBands(b):a};n.getClipBounds=T;n.getLocalArithmeticNorthRotations=function(a,b){const {coefficients:d,spacing:g}=b,{offsets_x:e,offsets_y:f,gridWidth:h}=K(a,a,d,{rows:g[0],cols:g[1]}),{width:k,height:m}=a;a=new Float32Array(k*m);b=180/Math.PI;for(let t=0;t<m;t++)for(let z=0;z<k;z++){var r=t*h+z,w=0===t?r:r-h;const C=t===m-1?r:r+h;r=e[w]-e[C];w=f[C]-f[w];isNaN(r)||isNaN(w)?a[t*k+z]=90:
(w=Math.atan2(w,r)*b,w=(360+w)%360,a[t*k+z]=w)}return a};n.interpolateOffsets=K;n.isValidPixelBlock=D;n.lookupBandValues=u;n.lookupPixels=function(a,b){if(!D(a))return null;const {pixels:d,mask:g}=a,e=d.length;let f=b.lut;const {offset:h}=b;f&&1===f[0].length&&(f=d.map(()=>f));const k=[];b=b.outputPixelType||"u8";for(let m=0;m<e;m++){const r=u(d[m],g,f[m],h||0,b);k.push(r)}a=new N({width:a.width,height:a.height,pixels:k,mask:g,pixelType:b});a.updateStatistics();return a};n.mask=function(a,b){if(!D(a))return null;
const {width:d,height:g,pixels:e}=a;var f=d*g;const h=new Uint8Array(f);a.mask?h.set(a.mask):h.fill(255);a=e.length;const {includedRanges:k,noDataValues:m,outputPixelType:r,matchAll:w,lookups:t}=b;if(t){f=[];for(b=0;b<a;b++){var z=t[b];z=u(e[b],h,z.lut,z.offset||0,"u8");f.push(z)}1===f.length?h.set(f[0]):w?S(f,h):G(f,h)}else if(w){b=[];for(z=0;z<a;z++){const C=new Uint8Array(f);C.set(h);A(e[z],k?.slice(2*z,2*z+2),m?.[z],C);b.push(C)}1===b.length?h.set(b[0]):S(b,h)}else for(f=0;f<a;f++)A(e[f],k?.slice(2*
f,2*f+2),m?.[f],h);return new N({width:d,height:g,pixelType:r,pixels:e,mask:h})};n.maxMapSizeGpu=6;n.mosaic=Q;n.mosaicPixelData=function(a,b){if(!a||0===a.length)return null;var d=a.find(t=>t.pixelBlock);if(null==d?.pixelBlock)return null;var g=(d.extent.xmax-d.extent.xmin)/d.pixelBlock.width;const e=(d.extent.ymax-d.extent.ymin)/d.pixelBlock.height,f=.01*Math.min(g,e),h=a.sort((t,z)=>Math.abs(t.extent.ymax-z.extent.ymax)>f?z.extent.ymax-t.extent.ymax:Math.abs(t.extent.xmin-z.extent.xmin)>f?t.extent.xmin-
z.extent.xmin:0);var k=Math.min.apply(null,h.map(t=>t.extent.xmin));const m=Math.min.apply(null,h.map(t=>t.extent.ymin)),r=Math.max.apply(null,h.map(t=>t.extent.xmax)),w=Math.max.apply(null,h.map(t=>t.extent.ymax));a={x:Math.round((b.xmin-k)/g),y:Math.round((w-b.ymax)/e)};k={width:Math.round((r-k)/g),height:Math.round((w-m)/e)};g={width:Math.round((b.xmax-b.xmin)/g),height:Math.round((b.ymax-b.ymin)/e)};if(Math.round(k.width/d.pixelBlock.width)*Math.round(k.height/d.pixelBlock.height)!==h.length||
0>a.x||0>a.y||k.width<g.width||k.height<g.height)return null;d=h.map(t=>t.pixelBlock);d=Q(d,k,{clipOffset:a,clipSize:g});return{extent:b,pixelBlock:d}};n.remap=function(a,b){if(!D(a))return null;const {width:d,height:g}=a,{inputRanges:e,outputValues:f,outputPixelType:h,noDataRanges:k,allowUnmatched:m,isLastInputRangeInclusive:r}=b;b=a.pixels[0];const w=N.createEmptyBand(h,b.length),t=a.mask,z=new Uint8Array(d*g);t?z.set(t):z.fill(255);const C=a.pixelType.startsWith("f")?1E-6:0;a=e.map(aa=>aa-C);a[0]=
e[0];a[a.length-1]=e[e.length-1]+(r?1E-6:0);var P=e.length/2;const [R,M]=B.getPixelValueRange(h);for(var Y=0;Y<g;Y++)for(var X=0;X<d;X++){var ca=Y*d+X;if(z[ca]){var ba=b[ca];let aa=!1;for(let ea=P-1;0<=ea;ea--)if(ba===a[2*ea]||ba>a[2*ea]&&ba<a[2*ea+1]){w[ca]=f[ea];aa=!0;break}aa||(m?w[ca]=ba>M?M:ba<R?R:ba:z[ca]=0)}}if(a=k?.length)for(P=0;P<g;P++)for(Y=0;Y<d;Y++)if(X=P*d+Y,!t||t[X])for(ca=b[X],ba=0;ba<a;ba+=2)if(ca>=k[ba]&&ca<=k[ba+1]){w[X]=0;z[X]=0;break}return new N({width:d,height:g,pixelType:h,
pixels:[w],mask:z})};n.remapColor=function(a,b){if(!D(a))return null;a=a.clone();var {pixels:d}=a;const g=a.width*a.height,e=b.length,f=Math.floor(e/2),h=b[Math.floor(f)];d=d[0];let k,m,r,w,t,z,C=!1;const P=new Uint8Array(g),R=new Uint8Array(g),M=new Uint8Array(g);let Y=a.mask;const X=4===b[0].mappedColor.length;Y||(Y=new Uint8Array(g),Y.fill(X?255:1),a.mask=Y);for(t=0;t<g;t++)if(Y[t]){k=d[t];C=!1;z=f;m=h;r=0;for(w=e-1;1<w-r;){if(k===m.value){C=!0;break}k>m.value?r=z:w=z;z=Math.floor((r+w)/2);m=b[Math.floor(z)]}C||
(k===b[r].value?(m=b[r],C=!0):k===b[w].value?(m=b[w],C=!0):k<b[r].value?(C=!1,m=null):k>b[r].value&&(k<b[w].value?(m=b[r],C=!0):w===e-1?(C=!1,m=null):(m=b[w],C=!0)));C?(P[t]=m.mappedColor[0],R[t]=m.mappedColor[1],M[t]=m.mappedColor[2],Y[t]=m.mappedColor[3]):P[t]=R[t]=M[t]=Y[t]=0}a.pixels=[P,R,M];a.mask=Y;a.pixelType="u8";a.maskIsAlpha=X;return a};n.resampleByMajority=y;n.setValidBoundary=function(a,b,d){if(!D(a))return null;const {width:g,height:e}=a,f=b.x;b=b.y;const h=d.width+f;d=d.height+b;if(0>
f||0>b||h>g||d>e||0===f&&0===b&&h===g&&d===e)return a;a.mask||(a.mask=new Uint8Array(g*e));const k=a.mask;for(let m=0;m<e;m++){const r=m*g;for(let w=0;w<g;w++)k[r+w]=m<b||m>=d||w<f||w>=h?0:1}a.updateStatistics();return a};n.split=function(a,b,d){if(!D(a))return null;const {width:g,height:e}=b;let {width:f,height:h}=a;const k=new Map,m={x:0,y:0};d=null==d?1:1+d;for(let r=0;r<d;r++){const w=Math.ceil(f/g),t=Math.ceil(h/e);for(let z=0;z<t;z++){m.y=z*e;for(let C=0;C<w;C++){m.x=C*g;const P=q(a,m,b);k.set(`${r}/${z}/${C}`,
P)}}r<d-1&&(a=L(a));f=Math.round(f/2);h=Math.round(h/2)}return k};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),function(n,N,B,D,u,
A,S,G,T,U){var Q;B=Q=class extends B.JSONSupport{static createEmptyBand(p,y){return new (Q.getPixelArrayConstructor(p))(y)}static getPixelArrayConstructor(p){let y;switch(p){case "u1":case "u2":case "u4":case "u8":y=Uint8Array;break;case "u16":y=Uint16Array;break;case "u32":y=Uint32Array;break;case "s8":y=Int8Array;break;case "s16":y=Int16Array;break;case "s32":y=Int32Array;break;case "f32":y=Float32Array;break;case "f64":y=Float64Array;break;case "c64":case "c128":case "unknown":y=Float32Array}return y}constructor(p){super(p);
this.height=this.width=null;this.pixelType="f32";this.mask=this.validPixelCount=null;this.premultiplyAlpha=this.maskIsAlpha=!1;this.statistics=null;this.depthCount=1}castPixelType(p){if(!p)return"f32";p=p.toLowerCase();["u1","u2","u4"].includes(p)?p="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(p)||(p="f32");return p}getPlaneCount(){return this.pixels?.length}addData(p){if(!p.pixels||p.pixels.length!==this.width*this.height)throw new N("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");
this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(p.pixels);this.statistics.push(p.statistics??new T.SimpleBandStatistics)}getAsRGBA(){const p=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(p);break;default:this._fillFrom8Bit(p)}return new Uint8ClampedArray(p)}getAsRGBAFloat(){const p=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(p);
return p}updateStatistics(){if(this.pixels){this.statistics=this.pixels.map(I=>this._calculateBandStatistics(I,this.mask));var p=this.mask,y=0;if(null!=p)for(let I=0;I<p.length;I++)p[I]&&y++;else y=this.width*this.height;this.validPixelCount=y}}clamp(p){if(p&&"f64"!==p&&"f32"!==p&&this.pixels){var [y,I]=U.getPixelValueRange(p),J=this.pixels,v=this.width*this.height,q=J.length,L=[];for(let d=0;d<q;d++){var K=Q.createEmptyBand(p,v);var a=J[d];for(let g=0;g<v;g++){var b=a[g];K[g]=b>I?I:b<y?y:b}L.push(K)}this.pixels=
L;this.pixelType=p}}extractBands(p){const {pixels:y,statistics:I}=this;if(null==p||0===p.length||!y||0===y.length)return this;var J=y.length,v=p.some(d=>d>=y.length),q=J===p.length&&!p.some((d,g)=>d!==g);if(v||q)return this;J=this.bandMasks?.length===J?p.map(d=>this.bandMasks[d]):void 0;let {mask:L,validPixelCount:K}=this;const {width:a,height:b}=this;if(J){if(1===J.length)L=J[0];else for(v=a*b,L=(new Uint8Array(v)).fill(255),q=0;q<J.length;q++){const d=J[q];for(let g=0;g<v;g++)d[g]||(L[g]=0)}K=L.filter(d=>
!!d).length}return new Q({pixelType:this.pixelType,width:a,height:b,mask:L,bandMasks:J,validPixelCount:K,maskIsAlpha:this.maskIsAlpha,pixels:p.map(d=>y[d]),statistics:I&&p.map(d=>I[d])})}clone(){const p=new Q({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});null!=this.mask&&(p.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));this.bandMasks&&(p.bandMasks=this.bandMasks.map(J=>new Uint8Array(J)));
let y;const I=Q.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){p.pixels=[];const J=!!this.pixels[0].slice;for(y=0;y<this.pixels.length;y++)p.pixels[y]=J?this.pixels[y].slice(0,this.pixels[y].length):new I(this.pixels[y])}if(this.statistics)for(p.statistics=[],y=0;y<this.statistics.length;y++)p.statistics[y]=D.clone(this.statistics[y]);p.premultiplyAlpha=this.premultiplyAlpha;return p}_fillFrom8Bit(p){const {mask:y,maskIsAlpha:I,premultiplyAlpha:J,pixels:v}=this;if(p&&
v?.length){var q,L;var K=q=L=v[0];3<=v.length?(q=v[1],L=v[2]):2===v.length&&(q=v[1]);var a=new Uint32Array(p),b=this.width*this.height;if(K.length!==b)u.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=y&&y.length===b)if(I)for(p=0;p<b;p++){const d=y[p];if(d){const g=d/255;a[p]=J?d<<24|L[p]*g<<16|q[p]*g<<8|K[p]*g:d<<24|L[p]<<16|q[p]<<8|K[p]}}else for(p=0;p<b;p++)y[p]&&(a[p]=-16777216|L[p]<<16|q[p]<<8|K[p]);else for(p=0;p<b;p++)a[p]=-16777216|
L[p]<<16|q[p]<<8|K[p]}else u.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFromNon8Bit(p){const {pixels:y,mask:I,statistics:J}=this;if(p&&y?.length){var v=this.pixelType,q=1,L=0;q=1;if(J&&0<J.length){for(var K of J)null!=K.minValue&&(L=Math.min(L,K.minValue)),null!=K.maxValue&&null!=K.minValue&&(q=Math.max(q,K.maxValue-K.minValue));q=255/q}else q=255,"s8"===v?(L=-128,q=127):"u16"===v?q=65535:"s16"===v?(L=-32768,q=32767):"u32"===v?q=4294967295:
"s32"===v?(L=-2147483648,q=2147483647):"f32"===v?(L=-3.4*1E39,q=3.4*1E39):"f64"===v&&(L=-Number.MAX_VALUE,q=Number.MAX_VALUE),q=255/(q-L);p=new Uint32Array(p);v=this.width*this.height;var a,b,d;K=a=b=y[0];if(K.length!==v)return u.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=y.length)if(a=y[1],3<=y.length&&(b=y[2]),null!=I&&I.length===v)for(d=0;d<v;d++)I[d]&&(p[d]=-16777216|(b[d]-L)*q<<16|(a[d]-L)*q<<8|(K[d]-L)*q);else for(d=0;d<v;d++)p[d]=-16777216|
(b[d]-L)*q<<16|(a[d]-L)*q<<8|(K[d]-L)*q;else if(null!=I&&I.length===v)for(d=0;d<v;d++)a=(K[d]-L)*q,I[d]&&(p[d]=-16777216|a<<16|a<<8|a);else for(d=0;d<v;d++)a=(K[d]-L)*q,p[d]=-16777216|a<<16|a<<8|a}else u.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFrom32Bit(p){const {pixels:y,mask:I}=this;if(!p||!y?.length)return u.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let J,v,q,L;J=v=q=y[0];
3<=y.length?(v=y[1],q=y[2]):2===y.length&&(v=y[1]);const K=this.width*this.height;if(J.length!==K)return u.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let a=0;if(null!=I&&I.length===K)for(L=0;L<K;L++)p[a++]=J[L],p[a++]=v[L],p[a++]=q[L],p[a++]=I[L]&1;else for(L=0;L<K;L++)p[a++]=J[L],p[a++]=v[L],p[a++]=q[L],p[a++]=1}_calculateBandStatistics(p,y){let I=Infinity,J=-Infinity;const v=p.length;let q,L=0;if(null!=y)for(q=0;q<v;q++)y[q]&&(L=p[q],I=L<I?
L:I,J=L>J?L:J);else for(q=0;q<v;q++)L=p[q],I=L<I?L:I,J=L>J?L:J;return new T.SimpleBandStatistics(I,J)}};n.__decorate([A.property({json:{write:!0}})],B.prototype,"width",void 0);n.__decorate([A.property({json:{write:!0}})],B.prototype,"height",void 0);n.__decorate([A.property({json:{write:!0}})],B.prototype,"pixelType",void 0);n.__decorate([S.cast("pixelType")],B.prototype,"castPixelType",null);n.__decorate([A.property({json:{write:!0}})],B.prototype,"validPixelCount",void 0);n.__decorate([A.property({json:{write:!0}})],
B.prototype,"mask",void 0);n.__decorate([A.property({json:{write:!0}})],B.prototype,"maskIsAlpha",void 0);n.__decorate([A.property({json:{write:!0}})],B.prototype,"pixels",void 0);n.__decorate([A.property()],B.prototype,"premultiplyAlpha",void 0);n.__decorate([A.property({json:{write:!0}})],B.prototype,"statistics",void 0);n.__decorate([A.property({json:{write:!0}})],B.prototype,"depthCount",void 0);n.__decorate([A.property({json:{write:!0}})],B.prototype,"noDataValues",void 0);n.__decorate([A.property({json:{write:!0}})],
B.prototype,"bandMasks",void 0);return B=Q=n.__decorate([G.subclass("esri.layers.support.PixelBlock")],B)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(n){class N{constructor(B=null,D=null,u=null){this.minValue=B;this.maxValue=D;this.noDataValue=u}}n.SimpleBandStatistics=N;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],function(n){function N(D){return B[D]??[-3.4028234663852886E38,
3.4028234663852886E38]}const B={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};n.convertNoDataToMask=function(D,u,A){if(!(D.depthCount&&1<D.depthCount)){var {pixels:S,statistics:G,pixelType:T}=D,U=S[0].length,Q=D.bandMasks??[];U=D.mask??(new Uint8Array(U)).fill(255);var p="f32"===T||
"f64"===T,y=N(T),I=!1;for(let q=0;q<S.length;q++){const L="number"===typeof u?u:u[q];if(null==L)continue;var J=G?.[q]?.maxValue??y[1];if((G?.[q]?.minValue??y[0])>L+Number.EPSILON||J<L-Number.EPSILON)continue;J=Q[q]||U.slice();const K=S[q];var v=A?.customFloatTolerance;if(p&&0!==v){v||(v=9.999999E37<=Math.abs(L)?2E-7*Math.abs(L):"f32"===T?2**-23:Number.EPSILON);for(let a=0;a<K.length;a++)J[a]&&Math.abs(K[a]-L)<v&&(K[a]=0,J[a]=0,U[a]=0,I=!0)}else for(v=0;v<K.length;v++)J[v]&&K[v]===L&&(K[v]=0,J[v]=
0,U[v]=0,I=!0);Q[q]=J}I&&(D.bandMasks=D.bandMasks||1<D.pixels.length?Q:null,D.mask=U);I&&"updateStatistics"in D&&D.updateStatistics()}};n.getPixelValueRange=N;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q,p,y,I,J){const v=T.create(),q=[0,0],L=new J(0,0,0,0);N=class extends N{constructor(K){super(K);this._imagePromise=null;this.bitmaps=[];this.hidpi=!1;this.imageMaxHeight=this.imageMaxWidth=2048;this.imageNormalizationSupported=this.imageRotationSupported=!1;this.update=D.debounce(async(a,b)=>{D.throwIfAborted(b);if(a.stationary&&!this.destroyed){var d=a.state,g=U.getInfo(d.spatialReference);a=this.hidpi?a.pixelRatio:1;var e=this.imageNormalizationSupported&&d.worldScreenWidth&&
d.worldScreenWidth<d.size[0],f=this.imageMaxWidth??0,h=this.imageMaxHeight??0;e?(q[0]=d.worldScreenWidth,q[1]=d.size[1]):this.imageRotationSupported?(q[0]=d.size[0],q[1]=d.size[1]):p.getOuterSize(q,d);g=g&&(d.extent.xmin<g.valid[0]||d.extent.xmax>g.valid[1]);var k=!this.imageNormalizationSupported&&g,m=!(Math.floor(q[0]*a)>f||Math.floor(q[1]*a)>h)&&!k,r=this.imageRotationSupported?d.rotation:0;g=this.container.children.slice();m?(e=e?d.paddedViewState.center:d.center,this._imagePromise&&console.error("Image promise was not defined!"),
this._imagePromise=this._singleExport(d,q,e,d.resolution,r,a,b)):(e=Math.min(f,h),k&&(e=Math.min(d.worldScreenWidth,e)),this._imagePromise=this._tiledExport(d,e,a,b));try{const w=await this._imagePromise??[];D.throwIfAborted(b);b=[];this._imagePromise=null;if(!this.destroyed){this.bitmaps=w;for(const t of g)w.includes(t)||b.push(t.fadeOut().then(()=>{t.remove();t.destroy()}));for(const t of w)b.push(t.fadeIn());await Promise.all(b)}}catch(w){this._imagePromise=null,D.throwIfAbortError(w)}}},5E3);
this.updateExports=D.debounce(async a=>{const b=[];for(const d of this.container.children){if(!d.visible||!d.stage)return;b.push(a(d).then(()=>{d.invalidateTexture();d.requestRender()}))}this._imagePromise=D.eachAlways(b).then(()=>this._imagePromise=null);await this._imagePromise})}destroy(){this.bitmaps.forEach(K=>K.destroy());this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(K,a,b,d,g,e){b=await this.fetchSource(K,Math.floor(a*g),Math.floor(b*g),{rotation:d,
pixelRatio:g,signal:e});D.throwIfAborted(e);const f=new y.Bitmap(null,!0);f.x=K.xmin;f.y=K.ymax;f.resolution=K.width/a;f.rotation=d;f.pixelRatio=g;f.opacity=0;this.container.addChild(f);await f.setSourceAsync(b,e);D.throwIfAborted(e);return f}async _singleExport(K,a,b,d,g,e,f){p.getBBox(v,b,d,a);K=T.toExtent(v,K.spatialReference);return[await this._export(K,a[0],a[1],g,e,f)]}_tiledExport(K,a,b,d){var g=Q.create({size:a,spatialReference:K.spatialReference,scales:[K.scale]});const e=new I(g);g=e.getTileCoverage(K);
if(!g)return null;const f=[];g.forEach((h,k,m,r)=>{L.set(h,k,m,0);e.getTileBounds(v,L);const w=T.toExtent(v,K.spatialReference);f.push(this._export(w,a,a,0,b,d).then(t=>{0!==r&&(L.set(h,k,m,r),e.getTileBounds(v,L),t.x=v[0],t.y=v[3]);return t}))});return Promise.all(f)}};n.__decorate([u.property()],N.prototype,"_imagePromise",void 0);n.__decorate([u.property()],N.prototype,"bitmaps",void 0);n.__decorate([u.property()],N.prototype,"container",void 0);n.__decorate([u.property()],N.prototype,"fetchSource",
void 0);n.__decorate([u.property()],N.prototype,"hidpi",void 0);n.__decorate([u.property()],N.prototype,"imageMaxWidth",void 0);n.__decorate([u.property()],N.prototype,"imageMaxHeight",void 0);n.__decorate([u.property()],N.prototype,"imageRotationSupported",void 0);n.__decorate([u.property()],N.prototype,"imageNormalizationSupported",void 0);n.__decorate([u.property()],N.prototype,"requestUpdate",void 0);n.__decorate([u.property()],N.prototype,"updating",null);return N=n.__decorate([G.subclass("esri.views.2d.layers.support.ExportStrategy")],
N)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(n){const N=Math.PI/180;n.getBBox=function(B,D,u,A){const [S,G]=D,[T,U]=A;D=.5*u;B[0]=S-D*T;B[1]=G-D*U;B[2]=S+D*T;B[3]=G+D*U;return B};n.getOuterSize=function(B,D){var u=D.rotation*N;const A=Math.abs(Math.cos(u));u=Math.abs(Math.sin(u));const [S,G]=D.size;B[0]=Math.round(G*u+S*A);B[1]=Math.round(G*A+S*u);return B};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFContainer ./ImageryVFStrategy".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q,p,y,I,J,v,q,L){D=class extends D{constructor(){super(...arguments);this.attached=!1;this.container=new q.RasterVFContainer;this.type="imageryVF";this._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""};this._fetchpixels=async(K,a,b,d)=>{const g=await this._projectFullExtentPromise,{symbolTileSize:e}=this.layer.renderer,{extent:f,width:h,height:k}=v.snapImageToSymbolTile(K,a,b,e,g);if(null!=g&&!g.intersects(K))return{extent:f,pixelBlock:null};
K={bbox:`${f.xmin}, ${f.ymin}, ${f.xmax}, ${f.ymax}`,exportParametersVersion:this.layer.exportImageServiceParameters.version,symbolTileSize:e,time:JSON.stringify(this.timeExtent||"")};if(this._canReuseVectorFieldData(K)&&(a=this.getPixelData(),null!=a&&`${a.extent.xmin}, ${a.extent.ymin}, ${a.extent.xmax}, ${a.extent.ymax}`===K.bbox))return a;({pixelData:d}=await this.layer.fetchImage(f,h,k,{timeExtent:this.timeExtent,requestAsImageElement:!1,signal:d}));this._dataParameters=K;d=d?.pixelBlock;if(null==
d)return{extent:f,pixelBlock:null};d="vector-uv"===this.layer.rasterInfo.dataType?v.convertVectorFieldData(d,"vector-uv"):d;return{extent:f,pixelBlock:d}}}get updating(){return!this.attached||this._strategy.updating}attach(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference);this._strategy=new L({container:this.container,fetchPixels:this._fetchpixels});this.addHandles(S.watch(()=>this.layer.renderer,K=>this._updateSymbolizerParams(K),S.syncAndInitial),"attach")}detach(){this._strategy.destroy();
this.container.children.forEach(K=>K.destroy());this.container.removeAllChildren();this.removeHandles("attach");this._strategy=this.container=this._projectFullExtentPromise=null}getPixelData(){const K=this.container.children[0]?.rawPixelData;if(this.updating||!K)return null;const {extent:a,pixelBlock:b}=K;return{extent:a,pixelBlock:b}}hitTest(K){return new N({attributes:{},geometry:K.clone(),layer:this.layer})}update(K){this._strategy.update(K,this._symbolizerParams).catch(a=>{A.isAbortError(a)||
u.getLogger(this).error(a)})}redraw(){const {renderer:K}=this.layer;K&&(this._updateSymbolizerParams(K),this._strategy.redraw(this._symbolizerParams))}_canReuseVectorFieldData(K){const a=this._dataParameters.time===K.time,b=this._dataParameters.symbolTileSize===K.symbolTileSize,d=this._dataParameters.bbox===K.bbox;return this._dataParameters.exportParametersVersion===K.exportParametersVersion&&a&&b&&d}async _getProjectedFullExtent(K){try{return J.projectExtent(this.layer.fullExtent,K)}catch(a){try{const b=
(await B(this.layer.url,{query:{option:"footprints",outSR:I.srToRESTValue(K),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return b?y.fromJSON(b):null}catch{return null}}}_updateSymbolizerParams(K){"vector-field"===K.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))}};n.__decorate([G.property()],D.prototype,"attached",void 0);n.__decorate([G.property()],D.prototype,"container",void 0);n.__decorate([G.property()],D.prototype,"layer",
void 0);n.__decorate([G.property()],D.prototype,"timeExtent",void 0);n.__decorate([G.property()],D.prototype,"type",void 0);n.__decorate([G.property()],D.prototype,"view",void 0);n.__decorate([G.property()],D.prototype,"updating",null);return D=n.__decorate([p.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],D)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q,p){function y(c,l,x){return!S.canProjectWithoutEngine(c,l,x)}function I(c,l,x){if((c=y(c,l,x))&&!S.isLoaded())throw new D("rasterprojectionhelper-project","projection engine is not loaded");return c}function J(c,l,x){I(c.spatialReference,l);return x?S.getTransformation(l,c.spatialReference,c):S.getTransformation(c.spatialReference,l,c)}function v(c,l,x,E=null){const O=c.spatialReference;if(O.equals(l))return c;I(O,l,E);x=x.center;x=new T({xmin:x.x-c.x/2,xmax:x.x+c.x/
2,ymin:x.y-c.y/2,ymax:x.y+c.y/2,spatialReference:O});E=S.project(x,l,E);x=t(l);null==E||null!=x&&E.width>=x?(l=u.getMetersPerUnitForSR(O)/u.getMetersPerUnitForSR(l),c={x:c.x*l,y:c.y*l}):c={x:E.width,y:E.height};return c}function q(c,l=.01){return u.getMetersPerUnitForSR(c)?l/u.getMetersPerUnitForSR(c):0}function L(c,l,x=null,E=!0){const O=c.spatialReference;if(O.equals(l))return c;I(O,l,x);x=S.project(c,l,x);if(!E||!x)return x;K([c],[x],O,l);return x}function K(c,l,x,E){const O=z(x,!0),F=z(E,!0);
x=q(x,500);E=q(E,500);if(x&&null!=O&&null!=F)for(let V=0;V<c.length;V++){const W=l[V];if(!W)continue;const {x:H}=c[V],{x:da}=W;da>=F[1]-E&&Math.abs(H-O[0])<x?W.x-=F[1]-F[0]:da<=F[0]+E&&Math.abs(H-O[1])<x&&(W.x+=F[1]-F[0])}}function a(c){const {inSR:l,outSR:x,datumTransformation:E,preferPE:O}=c;if(l.equals(x))return{points:c}=f(c,null),c;if(l.isWebMercator&&x.isWGS84||l.isWGS84&&x.isWebMercator){const {cols:H,rows:da,xres:Z,yres:ja,usePixelCenter:ia,inSR:ha,outSR:la}=c;let {xmin:ma,ymax:na}=c;ia&&
(ma+=Z/2,na-=ja/2);c=[];const fa=[];var F=Math.max(H,da);for(var V=0;V<F;V++){var W=S.project(new U({x:ma+Z*Math.min(H,V),y:na-ja*Math.min(da,V),spatialReference:ha}),la);V<=H&&c.push(W.x);V<=da&&fa.push(W.y)}F=[];for(V=0;V<H;V++)for(W=0;W<da;W++)F.push([c[V],fa[W]]);return F}return I(l,x,E)&&O&&(l.isGeographic||null!=g(l))?d(c):b(c)}function b(c){var {points:l}=f(c,null);const {inSR:x,outSR:E,datumTransformation:O}=c;c=l.map(F=>new U(F[0],F[1],x));l=S.project(c,E,O);O&&K(c,l,x,E);return l.map(F=>
F?[F.x,F.y]:[NaN,NaN])}function d(c){const {inSR:l,outSR:x,datumTransformation:E}=c;var O=g(l);const {points:F,mask:V}=f(c,O);l.isGeographic||(c=l.wkid?A.PeFactory.coordsys(l.wkid):A.PeFactory.fromString(l.isGeographic?A.PeDefs.PE_TYPE_GEOGCS:A.PeDefs.PE_TYPE_PROJCS,l.wkt2||l.wkt),A.PeCSTransformations.projToGeog(c,F.length,F));if(null!=E&&E.steps.length){var W;x.isGeographic&&(W=F.map(([H])=>179.9955<H?1:-179.9955>H?-1:0));E.steps.forEach(H=>{const da=H.wkid?A.PeFactory.geogtran(H.wkid):A.PeFactory.fromString(A.PeDefs.PE_TYPE_GEOGTRAN,
H.wkt);A.PeGTTransformations.geogToGeog(da,F.length,F,null,H.isInverse?A.PeDefs.PE_TRANSFORM_2_TO_1:A.PeDefs.PE_TRANSFORM_1_TO_2)});if(W)for(c=0;c<F.length;c++){O=W[c];const H=F[c][0],da=179.9955<H?1:-179.9955>H?-1:0;O&&da&&O!==da&&(F[c][0]=0<O?H+360:H-360)}}x.isGeographic||(W=g(x,!0),h(F,null!=W&&W.isEnvelope?[W.bbox[1],W.bbox[3]]:[-90,90]),W=x.wkid?A.PeFactory.coordsys(x.wkid):A.PeFactory.fromString(x.isGeographic?A.PeDefs.PE_TYPE_GEOGCS:A.PeDefs.PE_TYPE_PROJCS,x.wkt2||x.wkt),A.PeCSTransformations.geogToProj(W,
F.length,F));W=F;if(V&&F.length!==V.length){W=[];for(let H=0,da=0;H<V.length;H++)V[H]?W.push(F[da++]):W.push([NaN,NaN])}return W}function g(c,l=!1){var x=c.wkid||c.wkt2||c.wkt;if(!x||c.isGeographic)return null;x=String(x);if(ea.has(x))return x=ea.get(x),l?x?.gcs:x?.pcs;var E=c.wkid?A.PeFactory.coordsys(c.wkid):A.PeFactory.fromString(c.isGeographic?A.PeDefs.PE_TYPE_GEOGCS:A.PeDefs.PE_TYPE_PROJCS,c.wkt2||c.wkt);c=q(c,1E-4);c=e(E,c);E=e(E,0,!0);ea.set(x,{pcs:c,gcs:E});return l?E:c}function e(c,l=0,x=
!1){var E=A.PePCSInfo.generate(c),O=x?c.horizonGcsGenerate():c.horizonPcsGenerate();if(!E||!O?.length)return null;c=!1;var F=O.find(Z=>1===Z.getInclusive()&&1===Z.getKind());if(!F){F=O.find(Z=>1===Z.getInclusive()&&0===Z.getKind());if(!F)return null;c=!0}x=x?0:(2===E.getNorthPoleLocation()?1:0)|(2===E.getSouthPoleLocation()?2:0);E=E.isPannableRectangle();F=F.getCoord();if(c)return{isEnvelope:c,isPannable:E,vertices:F,coef:null,bbox:[F[0][0]-l,F[0][1]-l,F[1][0]+l,F[1][1]+l],poleLocation:x};l=0;c=[];
let [V,W]=F[0],[H,da]=F[0];for(let Z=0,ja=F.length;Z<ja;Z++){l++;l===ja&&(l=0);const [ia,ha]=F[Z],[la,ma]=F[l];if(ma===ha)c.push([ia,la,ha,ma,2]);else{O=(la-ia)/(ma-ha||1E-4);const na=ia-O*ha;ha<ma?c.push([O,na,ha,ma,0]):c.push([O,na,ma,ha,1])}V=V<ia?V:ia;W=W<ha?W:ha;H=H>ia?H:ia;da=da>ha?da:ha}return{isEnvelope:!1,isPannable:E,vertices:F,coef:c,bbox:[V,W,H,da],poleLocation:x}}function f(c,l){const x=[],{cols:E,rows:O,xres:F,yres:V,usePixelCenter:W}=c;let {xmin:H,ymax:da}=c;W&&(H+=F/2,da-=V/2);if(null==
l){for(c=0;c<E;c++)for(l=0;l<O;l++)x.push([H+F*c,da-V*l]);return{points:x}}c=new Uint8Array(E*O);if(l.isEnvelope){const {bbox:[na,fa,pa,qa]}=l;for(let ra=0,sa=0;ra<E;ra++){var Z=H+F*ra,ja=l.isPannable||Z>=na&&Z<=pa;for(var ia=0;ia<O;ia++,sa++){var ha=da-V*ia;ja&&ha>=fa&&ha<=qa&&(x.push([Z,ha]),c[sa]=1)}}return{points:x,mask:c}}Z=l.coef;l=[];for(ja=0;ja<O;ja++){var la=da-V*ja;ia=[];ha=[];for(var ma=0;ma<Z.length;ma++){const [na,fa,pa,qa,ra]=Z[ma];la===pa&&pa===qa?(ia.push(na),ia.push(fa),ha.push(2),
ha.push(2)):la>=pa&&la<=qa&&(ia.push(na*la+fa),ha.push(ra))}la=ia;if(2<ia.length){ma=2===ha[0]?0:ha[0];let na=ia[0];la=[];for(let fa=1;fa<ha.length;fa++)if(2!==ha[fa]||fa===ha.length-1)ha[fa]!==ma&&(la.push(0===ma?Math.min(na,ia[fa-1]):Math.max(na,ia[fa-1])),ma=ha[fa],na=ia[fa]),fa===ha.length-1&&la.push(0===ha[fa]?Math.min(na,ia[fa]):Math.max(na,ia[fa]));la.sort((fa,pa)=>fa-pa)}else ia[0]>ia[1]&&(la=[ia[1],ia[0]]);l.push(la)}for(let na=0,fa=0;na<E;na++)for(Z=H+F*na,ja=0;ja<O;ja++,fa++)if(ia=da-V*
ja,ha=l[ja],2===ha.length)Z>=ha[0]&&Z<=ha[1]&&(x.push([Z,ia]),c[fa]=1);else if(2<ha.length){la=!1;for(ma=0;ma<ha.length;ma+=2)if(Z>=ha[ma]&&Z<=ha[ma+1]){la=!0;break}la&&(x.push([Z,ia]),c[fa]=1)}return{points:x,mask:c}}function h(c,l){const [x,E]=l;for(l=0;l<c.length;l++){const O=c[l][1];if(O<x||O>E)c[l]=[NaN,NaN]}}function k(c,l){const x=t(c[0].spatialReference);if(2>c.length||null==x)return c[0];l=l??q(c[0].spatialReference);c=c.filter(W=>W.width>l);if(1===c.length)return c[0];let {xmin:E,xmax:O,
ymin:F,ymax:V}=c[0];for(let W=1;W<c.length;W++){const H=c[W];O=H.xmax+x*W;F=Math.min(F,H.ymin);V=Math.max(V,H.ymax)}return new T({xmin:E,xmax:O,ymin:F,ymax:V,spatialReference:c[0].spatialReference})}function m(c,l,x=null,E=!0){var O=c.spatialReference;if(O.equals(l))return c;var F=P(c);const V=t(O,!0);var W=t(l);if(0===F||null==V||null==W)return F=w(c,l,x,E),null==V&&null!=W&&Math.abs(F.width-W)<q(l)&&S.isLoaded()&&(O=g(O),null!=O&&O.poleLocation===ca.None&&c.width<(O.bbox[2]-O.bbox[0])/2)?r(c,l)||
F:F;W=c.clone().normalize();if(1===W.length&&c.xmax<V&&c.xmax-V/2>q(O)){const {xmin:H,xmax:da}=c;for(let Z=0;Z<=F;Z++)W[Z]=new T({xmin:0===Z?H:-V/2,xmax:Z===F?da-V*Z:V/2,ymin:c.ymin,ymax:c.ymax,spatialReference:O})}c=W.map(H=>w(H,l,x,E));return k(c.filter(B.isSome))}function r(c,l){const x=t(l);if(null==x)return null;let {xmin:E,ymin:O,xmax:F,ymax:V}=c;var W=c.spatialReference;c=new Q({spatialReference:W,rings:[[[E,O],[F,O],[F,V],[E,V],[E,O]]]});c=S.project(c,l);if(2!==c.rings.length||!c.rings[0].length||
!c.rings[1].length)return null;({rings:c}=c);W=q(W);l=new T({spatialReference:l});for(let H=0;2>H;H++){E=F=c[H][0][0];O=V=c[H][0][1];for(let da=0;da<c[H].length;da++)E=E>c[H][da][0]?c[H][da][0]:E,F=F<c[H][da][0]?c[H][da][0]:F,O=O>c[H][da][1]?c[H][da][1]:O,V=V<c[H][da][1]?c[H][da][1]:V;if(0===H)l.ymin=O,l.ymax=V,l.xmin=E,l.xmax=F;else if(l.ymin=Math.min(l.ymin,O),l.ymax=Math.max(l.ymax,V),Math.abs(F-x/2)<W)l.xmin=E,l.xmax+=x;else if(Math.abs(E+x/2)<W)l.xmax=F+x;else return null}return l}function w(c,
l,x=null,E=!0,O=!0){const F=c.spatialReference;if(F.equals(l)||!l)return c;I(F,l,x);const V=S.project(c,l,x);if(O&&l.isWebMercator&&V&&(V.ymax=Math.min(2.0037508342787E7,V.ymax),V.ymin=Math.max(-2.0037508342787E7,V.ymin),V.ymin>=V.ymax))return null;if(!E||!V)return V;var W=z(F,!0);E=z(l,!0);if(null==W||null==E)return V;O=q(F,.001);const H=q(F,500);var da=q(l,.001);if(Math.abs(V.xmin-E[0])<da&&Math.abs(V.xmax-E[1])<da){da=Math.abs(c.xmin-W[0]);W=Math.abs(W[1]-c.xmax);if(da<O&&W>H){V.xmin=E[0];var Z=
[];Z.push(new U(c.xmax,c.ymin,F));Z.push(new U(c.xmax,(c.ymin+c.ymax)/2,F));Z.push(new U(c.xmax,c.ymax,F));Z=Z.map(ja=>L(ja,l,x)).filter(ja=>!isNaN(ja?.x)).map(ja=>ja.x);V.xmax=Math.max.apply(null,Z)}W<O&&da>H&&(V.xmax=E[1],E=[],E.push(new U(c.xmin,c.ymin,F)),E.push(new U(c.xmin,(c.ymin+c.ymax)/2,F)),E.push(new U(c.xmin,c.ymax,F)),c=E.map(ja=>L(ja,l,x)).filter(ja=>!isNaN(ja?.x)).map(ja=>ja.x),V.xmin=Math.min.apply(null,c))}else c=q(l,.001),Math.abs(V.xmin-E[0])<c&&(V.xmin=E[0]),Math.abs(V.xmax-E[1])<
c&&(V.xmax=E[1]);return V}function t(c,l=!1){return c?c.isWebMercator?2*(l?2.0037508342787E7:2.0037508342788905E7):c.wkid&&c.isGeographic?360:2*aa[c.wkid]||null:null}function z(c,l=!1){if(c.isGeographic)return[-180,180];c=t(c,l);return null!=c?[-c/2,c/2]:null}function C(c,l,x,E){c=(c-l)/x;0!==c-Math.floor(c)?c=Math.floor(c):E&&--c;return c}function P(c,l=!1){var x=t(c.spatialReference);if(null==x)return 0;const E=l?0:-(x/2),O=q(c.spatialReference),F=!l&&Math.abs(c.xmin+x/2)<O?-x/2:c.xmin;c=C(!l&&
Math.abs(c.xmax-x/2)<O?x/2:c.xmax,E,x,!0);x=C(F,E,x,!1);return c-x}function R(c){const {projectedExtent:l,srcBufferExtent:x,pixelSize:E,datumTransformation:O,rasterTransform:F}=c;var V=l.spatialReference;const W=x.spatialReference;var H=I(V,W);const {xmin:da,ymin:Z,xmax:ja,ymax:ia}=l,ha=t(W),la=null!=ha&&(c.hasWrapAround||"gcs-shift"===F?.type);c=c.spacing||[32,32];var ma=c[0]*E.x,na=c[1]*E.y;const fa=1===c[0],pa=Math.ceil((ja-da)/ma-.1/c[0])+(fa?0:1),qa=Math.ceil((ia-Z)/na-.1/c[1])+(fa?0:1);ma=a({cols:pa,
rows:qa,xmin:da,ymax:ia,xres:ma,yres:na,inSR:V,outSR:W,datumTransformation:O,preferPE:4>=c[0],usePixelCenter:fa});na=[];let ra,sa=0;const wa=fa?-1:NaN,{xmin:xa,xmax:va,ymax:ya,width:za,height:Aa}=x,Ba=q(W,500),Ca=null!=ha&&0<xa&&va>ha/2;var ta=!1;H&&(ta=g(V),ta=null!=ta&&0<ta.poleLocation);for(V=0;V<pa;V++){H=[];for(let ua=0;ua<qa;ua++){var oa=ma[V*qa+ua];la&&oa[0]>va&&oa[0]>ha/2-Ba?oa[0]-=ha:la&&0===V&&0>oa[0]&&Ca&&!F&&(oa[0]+=ha);!oa||isNaN(oa[0])||isNaN(oa[1])?(na.push(wa),na.push(wa),H.push(null),
sa++):(F&&(oa=F.inverseTransform(new U({x:oa[0],y:oa[1],spatialReference:W})),oa=[oa.x,oa.y]),H.push(oa),0<V&&la&&ra[ua]&&oa[0]<ra[ua][0]&&(oa[0]+=ha,ta&&oa[0]>va&&oa[0]>ha&&(oa[0]-=ha)),na.push((oa[0]-xa)/za),na.push((ya-oa[1])/Aa))}ra=H}return{offsets:na,error:null,coefficients:null,outofBoundPointCount:sa,spacing:c,size:fa?[pa,qa]:[pa-1,qa-1]}}function M(c,l,x){const {cols:E,rows:O}=l;l=new Float32Array((E-1)*(O-1)*12);const F=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),V=new Float32Array([-1,
1,0,0,-1,1,1,0,0]);for(let ia=0;ia<E-1;ia++){for(var W=0;W<O-1;W++){var H=ia*O*2+2*W,da=c[H];const ha=c[H+1];var Z=c[H+2],ja=c[H+3];H+=2*O;const la=c[H],ma=c[H+1],na=c[H+2];H=c[H+3];let fa=0,pa=12*(W*(E-1)+ia);for(let qa=0;3>qa;qa++)l[pa++]=F[fa++]*da+F[fa++]*Z+F[fa++]*na;fa=0;for(Z=0;3>Z;Z++)l[pa++]=F[fa++]*ha+F[fa++]*ja+F[fa++]*H;fa=0;for(ja=0;3>ja;ja++)l[pa++]=V[fa++]*da+V[fa++]*la+V[fa++]*na;fa=0;for(da=0;3>da;da++)l[pa++]=V[fa++]*ha+V[fa++]*ma+V[fa++]*H}if(x)for(W=0;W<l.length;W++)isNaN(l[W])&&
(l[W]=-1)}return l}function Y(c,l){c=c.clone().normalize();return 1===c.length?c[0]:k(c,l)}function X(c,l){const {pixelSize:x,extent:E}=c;c=J(E,l,!1);const O=Y(E,(x.x+x.y)/16);return m(O,l,c)}var ca;(function(c){c[c.None=0]="None";c[c.North=1]="North";c[c.South=2]="South";c[c.Both=3]="Both"})(ca||(ca={}));const ba=(c,l,x,E=0)=>{if(1===x[0])return[0,0];var O=1,F=-1,V=1,W=-1;for(var H=0;H<c.length;H+=2)isNaN(c[H])||(O=O>c[H]?c[H]:O,F=F>c[H]?F:c[H],V=V>c[H+1]?c[H+1]:V,W=W>c[H+1]?W:c[H+1]);const {cols:da,
rows:Z}=l;l=(F-O)/da/x[0];x=(W-V)/Z/x[1];E*=2;V=0;W=!1;O=[0,0];for(F=0;F<da-3;F++){for(H=0;H<Z-3;H++){var ja=F*Z*2+2*H;const ia=Math.abs(((c[ja]+c[ja+4]+c[ja+4*Z]+c[ja+4*Z+4])/4-c[ja+2*Z+2])/l);ja=Math.abs(((c[ja+1]+c[ja+5]+c[ja+4*Z+1]+c[ja+4*Z+5])/4-c[ja+2*Z+3])/x);ia+ja>V&&(V=ia+ja,O=[ia,ja]);if(E&&V>E){W=!0;break}}if(W)break}return O},aa={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,
54100:2.0037508342789244E7,54101:2.0037508342789244E7},ea=new Map,ka=new Map;n.computeProjectedScales=function(c,l,x){var E=x?.tileSize??512,O=x?.alignGlobalDatasetWithAGOL??!0,F=!!x?.limitToSrcResolution;const {extent:V,spatialReference:W,pixelSize:H}=c;x=v(new U({x:H.x,y:H.y,spatialReference:W}),l,V);if(null==x)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const da=(x.x+x.y)/2,Z=u.getMetersPerUnitForSR(l);var ja=da*Z*96*39.37,ia=l.isGeographic?256/E*2.958287637958547E8:
256/E*5.91657527591555E8,ha="vector-magdir"===c.dataType||"vector-uv"===c.dataType,la=X(c,l),ma=Math.min(Math.ceil(Math.log(Math.min(c.width,c.height)/32)/Math.LN2),Math.ceil(Math.log(ia/2/ja)/Math.LN2));if(!ha&&O&&(l.isGeographic||l.isWebMercator)&&(O=t(l),ha=0<P(la)||null!=O&&la.width>O/4,!ha&&null!=O)){ha=-1;if(3>ma)ha=2**ma*da*E;else if(c.storageInfo){const {maximumPyramidLevel:na=0,pyramidScalingFactor:fa=2}=c.storageInfo;ha=fa**na*da*E}E=Math.ceil(O/ha);ha=1===E||2===E&&O/2-la.xmax<ha}E=ja;
c=Math.min(2,Math.max(1.414,c.storageInfo?.pyramidScalingFactor||2));if(ha)E=ia,ia=l.isGeographic?1.341104507446289E-6:.29858214164761665,ma=96*ia*Z*39.37,l=v(new U({x:ia,y:ia,spatialReference:{wkid:l.isGeographic?4326:3857}}),W,la),l.x*=E/ma,l.y*=E/ma;else{l={x:H.x,y:H.y};for(la=0;E<.5005*ia&&la<ma;)la++,E*=c,l.x*=c,l.y*=c;1.001>=Math.max(E,ia)/Math.min(E,ia)&&(E=ia)}ia=[E];la=[{x:l.x,y:l.y}];for(ja=Math.min(70.5310735,ja)/1.001;E>=ja;)E/=c,l.x/=c,l.y/=c,ia.push(E),la.push({x:l.x,y:l.y});if(F){const na=
.001*H.x;F=la.findIndex(fa=>fa.x>=H.x-na&&fa.x<=H.x+na);-1<F?(la.length=F+1,ia.length=F+1):(F=la.findIndex(fa=>fa.x<=H.x+na),0<F&&(la.length=F,ia.length=F))}return{projectedPixelSize:x,scales:ia,srcResolutions:la,isCustomTilingScheme:!ha}};n.defaultGridSpacing=32;n.defaultProjectionToleranceInPixels=4;n.getDefaultDatumTransformationForDataset=J;n.getProjectedGridPoints=a;n.getProjectionOffsetGrid=function(c){var l=c.isAdaptive&&null==c.spacing;let x=c.spacing||[32,32],E=R(c);var O={cols:E.size[0]+
1,rows:E.size[1]+1};const F=0<E.outofBoundPointCount&&E.outofBoundPointCount<E.offsets.length/2;let V=E.outofBoundPointCount===E.offsets.length/2||l&&F?[0,0]:ba(E.offsets,O,x,4);const W=(V[0]+V[1])/2;var H=c.projectedExtent.spatialReference;const da=c.srcBufferExtent.spatialReference;l&&(F||4<W)&&(y(H,da,c.datumTransformation)&&(H.isGeographic||null!=g(H)),x=[4,4],E=R({...c,spacing:x}),O={cols:E.size[0]+1,rows:E.size[1]+1},V=ba(E.offsets,O,x,4));E.error=V;1<x[0]&&(E.coefficients=M(E.offsets,O,F));
!c.includeGCSGrid||H.isGeographic||H.isWebMercator||(da.isGeographic?E.gcsGrid={offsets:E.offsets,coefficients:E.coefficients,spacing:x}:(l=g(H),null==l||l.isEnvelope||(H&&!H.isGeographic&&(l=String(H.wkid||H.wkt2||H.wkt),ka.has(l)?H=ka.get(l):(H=(H.wkid?A.PeFactory.coordsys(H.wkid):A.PeFactory.fromString(A.PeDefs.PE_TYPE_PROJCS,H.wkt2||H.wkt)).getGeogcs().getCode(),ka.set(l,H)),H=new p({wkid:H})),H=m(c.projectedExtent,H),{offsets:c}=R({...c,srcBufferExtent:H,spacing:x}),O=M(c,O,F),E.gcsGrid={offsets:c,
coefficients:O,spacing:x})));return E};n.getRasterDatasetAlignmentInfo=function(c){const l=c.storageInfo.origin.x;var x=t(c.spatialReference,!0);if(null==x)return{originX:l,halfWorldWidth:null,pyramidsInfo:null};const E=x/2,{nativePixelSize:O,storageInfo:F,extent:V}=c,{maximumPyramidLevel:W,blockWidth:H,pyramidScalingFactor:da}=F;let Z=O.x;const ja=[];c=null!=c.transform&&"gcs-shift"===c.transform.type;const ia=l+(c?0:E);x=c?x-l:E-l;for(let ha=0;ha<=W;ha++){const la=(V.xmax-l)/Z/H,ma=x/Z/H;ja.push({resolutionX:Z,
blockWidth:H,datsetColumnCount:0===la-Math.floor(la)?la:Math.ceil(la),worldColumnCountFromOrigin:0===ma-Math.floor(ma)?ma:Math.ceil(ma),leftMargin:Math.round(ia/Z)%H,rightPadding:(H-Math.round(x/Z)%H)%H,originColumnOffset:Math.floor(ia/Z/H)});Z*=da}return{originX:l,halfWorldWidth:E,pyramidsInfo:ja,hasGCSSShiftTransform:c}};n.getWorldWidth=t;n.getWorldWrapCount=P;n.load=async function(){S.isLoaded()||await S.load()};n.minimumGridSpacing=4;n.projectDatasetExtent=X;n.projectExtent=m;n.projectPoint=L;
n.projectPolygon=function(c,l,x){if("extent"===c.type){const {xmin:E,ymin:O,xmax:F,ymax:V,spatialReference:W}=c;c=new Q({rings:[[[E,V],[F,V],[F,O],[E,O],[E,V]]],spatialReference:W})}if(c.spatialReference.equals(l))return c;I(c.spatialReference,l,x);return S.project(c,l,x)};n.projectResolution=v;n.requirePE=y;n.shiftExtent=function(c){var {spatialReference:l}=c;l=G.getInfo(l);if(!l)return c;const [x,E]=l.valid;l=E-x;let O=0;c.xmin<x?O=Math.ceil((x-c.xmin)/l):c.xmin>E&&(O=-Math.ceil((c.xmin-E)/l));
return new T({spatialReference:c.spatialReference,xmin:c.xmin+O*l,ymin:c.ymin,xmax:c.xmax+O*l,ymax:c.ymax})};n.snapExtent=Y;n.snapPyramid=function(c,l,x){const {storageInfo:E,pixelSize:O}=l;var F=0;let V=!1;var {pyramidResolutions:W}=E,H="mixed"===E.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,E.tileInfo.dpi/96)):1;H=(c.x+c.y)/2/H;if(null!=W&&W.length){c=W[W.length-1];c=(c.x+c.y)/2;var da=(O.x+O.y)/2;if(H<=da)F=0;else if(H>=c)F=W.length,V=8<H/c;else{c=da;for(let Z=1;Z<=W.length;Z++){da=(W[Z-
1].x+W[Z-1].y)/2;if(H<=da){H===da?F=Z:"down"===x?(F=Z-1,V=8<H/c):F="up"===x?Z:H-c>da-H||2<H/c?Z:Z-1;break}c=da}}x=0===F?O:W[F-1];V&&(W=Math.min(x.x,x.y),H=u.getMetersPerUnitForSR(l.spatialReference),19567<W*H&&(V=!1));return{pyramidLevel:F,pyramidResolution:new U({x:x.x,y:x.y,spatialReference:l.spatialReference}),excessiveReading:V}}F=Math.log(c.x/O.x)/Math.LN2;H=Math.log(c.y/O.y)/Math.LN2;W=l.storageInfo.maximumPyramidLevel||0;F="down"===x?Math.floor(Math.min(F,H)):"up"===x?Math.ceil(Math.max(F,
H)):Math.round((F+H)/2);0>F?F=0:F>W&&(V=F>W+3,F=W);x=2**F;l=new U({x:x*l.nativePixelSize.x,y:x*l.nativePixelSize.y,spatialReference:l.spatialReference});return{pyramidLevel:F,pyramidResolution:l,excessiveReading:V}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(n,N,B,D){function u(e,f){return v.get(e)/v.get(f)||1}function A(e,f="geographic"){const [h,
k]=e;e=Math.sqrt(h*h+k*k);let m=Math.atan2(k,h)*q;m=(360+m)%360;"geographic"===f&&(m=(450-m)%360);return[e,m]}function S(e,f="geographic"){let h=e[1];"geographic"===f&&(h=(450-h)%360);h%=360;e=e[0];return[e*Math.cos(h/q),e*Math.sin(h/q)]}function G(e,f,h="geographic",k=1){if(!D.isValidPixelBlock(e))return e;const {pixels:m,width:r,height:w}=e;var t=r*w;const z=m[0],C=m[1],P=e.pixelType.startsWith("f")?e.pixelType:"f32",R=B.createEmptyBand(P,t);t=B.createEmptyBand(P,t);let M=0;for(let Y=0;Y<w;Y++)for(let X=
0;X<r;X++)"vector-uv"===f?([R[M],t[M]]=A([z[M],C[M]],h),R[M]*=k):([R[M],t[M]]=S([z[M],C[M]],h),R[M]*=k,t[M]*=k),M++;e=new B({pixelType:P,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[R,t]});e.updateStatistics();return e}function T(e=0,f=0,h=Math.PI,k=!0){k&&(h=(2*Math.PI-h)%(2*Math.PI));k=k?-1:1;const m=-7*k,r=-2*k,w=-16*k,[t,z]=Q(0,f+13*k,h,21.75),[C,P]=Q(e-5.5,f+m,h,21.75),[R,M]=Q(e+5.5,f+m,h,21.75),[Y,X]=Q(e-1.5,f+r,h,21.75),[ca,ba]=
Q(e+1.5,f+r,h,21.75),[aa,ea]=Q(e-1.5,f+w,h,21.75),[ka,c]=Q(e+1.5,f+w,h,21.75);return[t,z,C,P,Y,X,ca,ba,R,M,aa,ea,ka,c]}function U(e=0,f=Math.PI,h=!0){h&&(f=(2*Math.PI-f)%(2*Math.PI));var k=h?-1:1,m=5*k;const r=20*k,w=25*k;k*=2;const t=h?1:-1;h=5*t;let [z,C]=[0+h,0-r],[P,R]=[z+2*t,C],[M,Y]=[P-0*t,R+k],[X,ca]=[0-h,0-w],[ba,aa]=[X+0*t,ca-k],ea=Math.ceil(e/5),ka=Math.floor(ea/10);ea-=8*ka;e=[];const c=[];for(let da=0;da<ea/2;da++,ka--){0>=ka&&1===ea%2&&da===(ea-1)/2&&(X=0,ba=X+0*t,ca=(ca+C)/2,aa=ca-k);
const [Z,ja]=Q(X,ca,f,45);if(0<ka){const [ia,ha]=Q(P,ca,f,45),[la,ma]=Q(z,C,f,45);e.push(ia);e.push(ha);e.push(Z);e.push(ja);e.push(la);e.push(ma)}else{const [ia,ha]=Q(P,R,f,45),[la,ma]=Q(M,Y,f,45),[na,fa]=Q(ba,aa,f,45);c.push(Z);c.push(ja);c.push(na);c.push(fa);c.push(la);c.push(ma);c.push(ia);c.push(ha)}ca+=m;C+=m;R+=m;Y+=m;aa+=m}const [l,x]=Q(0+h,0+r,f,45);m=7*t;const [E,O]=Q(0+m,0+r,f,45),[F,V]=Q(0+h,0-w,f,45),[W,H]=Q(0+m,0-w,f,45);return{pennants:e,barbs:c,shaft:[l,x,E,O,F,V,W,H]}}function Q(e,
f,h,k=1){return[Math.sqrt(e*e+f*f)/k,(2*Math.PI+(2*Math.PI+Math.atan2(f,e))%(2*Math.PI)-h)%(2*Math.PI)]}function p(e,f,h,k){h=u(k||"knots",h);for(k=1;k<f.length;k++)if(k===f.length-1){if(e<f[k]*h)break}else if(e<=f[k]*h)break;return Math.min(k-1,f.length-2)}function y(e,f,h,k,m){let r=0;switch(f){case "beaufort_kn":r=p(e,a,"knots",h);break;case "beaufort_km":r=p(e,a,"kilometer-per-hour",h);break;case "beaufort_ft":r=p(e,a,"feet-per-second",h);break;case "beaufort_m":r=p(e,a,"meter-per-second",h);
break;case "classified_arrow":r=p(e,m??[],k,h);break;case "ocean_current_m":r=p(e,b,"meter-per-second",h);break;case "ocean_current_kn":r=p(e,d,"knots",h)}return r}function I(e,f){const {style:h,inputUnit:k,outputUnit:m,breakValues:r}=f,w=L.fromJSON(k),t=L.fromJSON(m);let z=0,C=0;const {width:P,height:R,mask:M}=e,Y=e.pixels[0];e=e.pixels[1];var X=null!=M?M.filter(aa=>0<aa).length:P*R;const ca=new Float32Array(42*X);X=new Uint32Array(15*X);f=f.invertDirection?T(0,0,0,!1):K;for(let aa=0;aa<R;aa++)for(let ea=
0;ea<P;ea++){var ba=aa*P+ea;if(!M||M[aa*P+ea]){const ka=(e[ba]+360)%360/180*Math.PI,c=y(Y[ba],h,w,t,r);for(let l=0;l<f.length;l+=2)ca[z++]=(ea+.5)/P,ca[z++]=(aa+.5)/R,ca[z++]=f[l],ca[z++]=f[l+1]+ka,ca[z++]=c,ca[z++]=Y[ba];ba=7*(z/42-1);X[C++]=ba;X[C++]=ba+1;X[C++]=ba+2;X[C++]=ba+0;X[C++]=ba+4;X[C++]=ba+3;X[C++]=ba+0;X[C++]=ba+2;X[C++]=ba+3;X[C++]=ba+2;X[C++]=ba+5;X[C++]=ba+3;X[C++]=ba+5;X[C++]=ba+6;X[C++]=ba+3}}return{vertexData:ca,indexData:X}}function J(e,f){let h=0,k=0;const {width:m,height:r,
mask:w}=e;e=e.pixels[0];const t=[],z=[];var C=L.fromJSON(f.inputUnit);C=u(C,"knots");f="wind_speed"===f.style?5:Number.MAX_VALUE;for(let R=0;R<r;R++)for(let M=0;M<m;M++){var P=e[R*m+M]*C;if((!w||w[R*m+M])&&P<f){for(let Y=0;4>Y;Y++)t[h++]=(M+.5)/m,t[h++]=(R+.5)/r,t[h++]=2>Y?-.5:.5,t[h++]=0===Y%2?-.5:.5,t[h++]=0,t[h++]=P;P=4*(h/24-1);z[k++]=P;z[k++]=P+1;z[k++]=P+2;z[k++]=P+1;z[k++]=P+2;z[k++]=P+3}}return{vertexData:new Float32Array(t),indexData:new Uint32Array(z)}}const v=new Map;v.set("meter-per-second",
1);v.set("kilometer-per-hour",.277778);v.set("knots",.514444);v.set("feet-per-second",.3048);v.set("mile-per-hour",.44704);const q=180/Math.PI,L=new N.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),K=T(0,0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],b=[0,.5,1,1.5,2],d=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],g=[];n.convertToLocalDirections=function(e,f,h,k="geographic"){if(!D.isValidPixelBlock(e)||
null==h)return e;e="vector-magdir"===f?e.clone():G(e,f);const m=e.pixels[1];for(let r=0;r<m.length;r++)m[r]="geographic"===k?(m[r]+h[r]+270)%360:(m[r]+360-h[r])%360;return"vector-magdir"===f?e:G(e,"vector-magdir")};n.convertVectorFieldData=G;n.convertVectorFieldUnit=function(e,f,h=1){if(1===h||!D.isValidPixelBlock(e))return e;e=e.clone();const {pixels:k,width:m,height:r}=e,w=k[0],t=k[1];let z=0;for(let C=0;C<r;C++)for(let P=0;P<m;P++)"vector-uv"===f?(w[z]*=h,t[z]*=h):w[z]*=h,z++;e.updateStatistics();
return e};n.createVFMesh=function(e,f){if("simple_scalar"===f.style)f=J(e,f);else if("wind_speed"===f.style){if(0===g.length)for(var h=0;30>h;h++)g.push(U(5*h,0,!f.invertDirection));f=L.fromJSON(f.inputUnit);f=u(f,"knots");const {width:w,height:t,mask:z}=e;h=e.pixels[0];e=e.pixels[1];const C=[],P=[];let R=0,M=0;for(let Y=0;Y<t;Y++)for(let X=0;X<w;X++){var k=Y*w+X,m=h[k]*f;if((!z||z[Y*w+X])&&5<=m){const ca=(e[k]+360)%360/180*Math.PI,{pennants:ba,barbs:aa,shaft:ea}=g[Math.min(Math.floor(m/5),29)];if(0===
ba.length+aa.length)continue;k=C.length/6;const ka=(X+.5)/w,c=(Y+.5)/t;for(var r=0;r<ba.length;r+=2)C[R++]=ka,C[R++]=c,C[R++]=ba[r],C[R++]=ba[r+1]+ca,C[R++]=0,C[R++]=m;for(r=0;r<aa.length;r+=2)C[R++]=ka,C[R++]=c,C[R++]=aa[r],C[R++]=aa[r+1]+ca,C[R++]=0,C[R++]=m;for(r=0;r<ea.length;r+=2)C[R++]=ka,C[R++]=c,C[R++]=ea[r],C[R++]=ea[r+1]+ca,C[R++]=0,C[R++]=m;for(m=0;m<ba.length/6;m++)P[M++]=k,P[M++]=k+1,P[M++]=k+2,k+=3;for(m=0;m<aa.length/8;m++)P[M++]=k,P[M++]=k+1,P[M++]=k+2,P[M++]=k+1,P[M++]=k+2,P[M++]=
k+3,k+=4;P[M++]=k+0;P[M++]=k+1;P[M++]=k+2;P[M++]=k+1;P[M++]=k+3;P[M++]=k+2;k+=4}}f={vertexData:new Float32Array(C),indexData:new Uint32Array(P)}}else f=I(e,f);return f};n.createVFMeshScalar=J;n.getUnitConversionFactor=u;n.sampleVectorField=function(e,f,h,k=[0,0],m=.5){const {width:r,height:w,mask:t}=e,[z,C]=e.pixels,[P,R]=k;e=Math.round((r-P)/h);k=Math.round((w-R)/h);var M=e*k;const Y=new Float32Array(M),X=new Float32Array(M);M=new Uint8Array(M);f="vector-uv"===f;for(let ba=0;ba<k;ba++)for(let aa=
0;aa<e;aa++){let ea=0;const ka=ba*e+aa,c=Math.max(0,ba*h+R),l=Math.max(0,aa*h+P),x=Math.min(w,c+h),E=Math.min(r,l+h);for(let O=c;O<x;O++)for(let F=l;F<E;F++){var ca=O*r+F;if(!t||t[ca]){ea++;ca=f?[z[ca],C[ca]]:[z[ca],(360+C[ca])%360];const [V,W]=f?ca:S(ca);Y[ka]+=V;X[ka]+=W}}if(ea>=(x-c)*(E-l)*(1-m)){M[ka]=1;const [O,F]=A([Y[ka]/ea,X[ka]/ea]);Y[ka]=O;X[ka]=F}else M[ka]=0,Y[ka]=0,X[ka]=0}h=new B({width:e,height:k,pixels:[Y,X],mask:M});h.updateStatistics();return h};n.snapImageToSymbolTile=function(e,
f,h,k,m){if(null==m||!m.spatialReference.equals(e.spatialReference))return{extent:e,width:Math.round(f/k),height:Math.round(h/k),resolution:e.width/f};const r=m.xmin;m=m.ymax;f=(e.xmax-e.xmin)/f*k;h=(e.ymax-e.ymin)/h*k;e.xmin=r+Math.floor((e.xmin-r)/f)*f;e.xmax=r+Math.ceil((e.xmax-r)/f)*f;e.ymin=m+Math.floor((e.ymin-m)/h)*h;e.ymax=m+Math.ceil((e.ymax-m)/h)*h;return{extent:e,width:Math.round(e.width/f),height:Math.round(e.height/h),resolution:(f+h)/2}};n.unitKebabDict=L;n.uvComponentToVector=A;Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports","./BrushVectorField","../webgl/enums","../webgl/WGLContainer"],function(n,N,B,D){class u extends D{constructor(){super(...arguments);this.symbolTypes=["triangle"]}prepareRenderPasses(A){const S=A.registerRenderPass({name:"imagery (vf)",brushes:[N],target:()=>this.children,drawPhase:B.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(A),S]}doRender(A){this.visible&&A.drawPhase===
B.WGLDrawPhase.MAP&&this.symbolTypes.forEach(S=>{A.renderPass=S;super.doRender(A)})}}n.RasterVFContainer=u;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../webgl/brushes/WGLBrush","../../../webgl/enums"],function(n,N){const B=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,
.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),D=new Float32Array([0,92/255,230/255,1]),u={beaufort_ft:B,beaufort_m:B,beaufort_km:B,
beaufort_mi:B,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,
.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,
.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,
.6941176470588235,.6941176470588235,1]),simple_scalar:D,single_arrow:D,wind_speed:new Float32Array([0,0,0,1])},A=[0,20];class S extends n{constructor(){super(...arguments);this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:G}){G.setBlendingEnabled(!0);G.setBlendFunctionSeparate(N.BlendFactor.ONE,
N.BlendFactor.ONE_MINUS_SRC_ALPHA,N.BlendFactor.ONE,N.BlendFactor.ONE_MINUS_SRC_ALPHA);G.setColorMask(!0,!0,!0,!0);G.setStencilWriteMask(0);G.setStencilTestEnabled(!0);G.setStencilOp(N.StencilOperation.KEEP,N.StencilOperation.KEEP,N.StencilOperation.REPLACE)}draw(G,T){if(null!=T.source&&0!==T.source.validPixelCount){var {context:U,timeline:Q}=G;Q.begin(this.name);U.setStencilFunction(N.CompareFunction.EQUAL,T.stencilRef,255);T.updateVectorFieldVAO(G);if("scalar"===G.renderPass){var p=T.vaoData.scalar;
p&&this._drawScalars(G,T,p.vao,p.elementCount)}else(p=T.vaoData.magdir)&&this._drawTriangles(G,T,p.vao,p.elementCount);Q.end(this.name)}}_drawTriangles(G,T,U,Q){const {context:p,painter:y,requestRender:I,allowDelayedRender:J}=G,{symbolizerParameters:v}=T;var q=v.dataRange?["dataRange"]:[];"geographic"===v.rotationType&&q.push("rotationGeographic");q=y.materialManager.getProgram(this._desc.magdir,q);if(J&&null!=I&&!q.compiled)I();else{p.useProgram(q);var {coordScale:L,opacity:K,transforms:a}=T;q.setUniform2fv("u_coordScale",
L);q.setUniform1f("u_opacity",K);q.setUniformMatrix3fv("u_dvsMat3",a.dvs);var {style:b,dataRange:d,rotation:g,symbolPercentRange:e}=v;q.setUniform4fv("u_colors",u[b]);q.setUniform2fv("u_dataRange",d||A);q.setUniform1f("u_rotation",g);q.setUniform2fv("u_symbolPercentRange",e);G=this._getSymbolSize(G,T);q.setUniform2fv("u_symbolSize",G);p.bindVAO(U);p.drawElements(N.PrimitiveType.TRIANGLES,Q,N.DataType.UNSIGNED_INT,0)}}_drawScalars(G,T,U,Q){const {context:p,painter:y,requestRender:I,allowDelayedRender:J}=
G,{symbolizerParameters:v}=T;var q=[];"wind_speed"===v.style?q.push("innerCircle"):v.dataRange&&q.push("dataRange");"geographic"===v.rotationType&&q.push("rotationGeographic");q=y.materialManager.getProgram(this._desc.scalar,q);if(J&&null!=I&&!q.compiled)I();else{p.useProgram(q);var {coordScale:L,opacity:K,transforms:a}=T;q.setUniform2fv("u_coordScale",L);q.setUniform1f("u_opacity",K);q.setUniformMatrix3fv("u_dvsMat3",a.dvs);var {dataRange:b,symbolPercentRange:d}=v;q.setUniform2fv("u_dataRange",b||
A);q.setUniform2fv("u_symbolPercentRange",d);G=this._getSymbolSize(G,T);q.setUniform2fv("u_symbolSize",G);p.bindVAO(U);p.drawElements(N.PrimitiveType.TRIANGLES,Q,N.DataType.UNSIGNED_INT,0)}}_getSymbolSize(G,T){G=T.key?2**(G.displayLevel-T.key.level):T.resolution/G.state.resolution;const {symbolTileSize:U}=T.symbolizerParameters;return[U/(Math.round((T.width-T.offset[0])/U)*U)/G,U/(Math.round((T.height-T.offset[1])/U)*U)/G]}}return S})},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../engine/imagery/RasterVFDisplayObject".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q){N=class extends N{constructor(p){super(p);this._loading=null;this.update=D.debounce((y,I)=>this._update(y,I).catch(J=>{D.isAbortError(J)||B.getLogger(this).error(J)}))}get updating(){return!!this._loading}redraw(p){if(this.container.children.length){var y=this.container.children[0];y.symbolizerParameters=p;y.invalidateVAO();this.container.symbolTypes="wind_speed"===p.style?["scalar","triangle"]:"simple_scalar"===p.style?["scalar"]:["triangle"];this.container.requestRender()}}async _update(p,
y,I){if(p.stationary){var {extent:J,spatialReference:v}=p.state,q=new U({xmin:J.xmin,ymin:J.ymin,xmax:J.xmax,ymax:J.ymax,spatialReference:v}),[L,K]=p.state.size;this._loading=this.fetchPixels(q,L,K,I);I=await this._loading;this._addToDisplay(I,y,p.state);this._loading=null}}_addToDisplay(p,y,I){if(null==p.pixelBlock)this.container.children.forEach(L=>L.destroy()),this.container.removeAllChildren();else{var {extent:J,pixelBlock:v}=p,q=new Q.RasterVFDisplayObject(v);q.offset=[0,0];q.symbolizerParameters=
y;q.rawPixelData=p;q.invalidateVAO();q.x=J.xmin;q.y=J.ymax;q.pixelRatio=I.pixelRatio;q.rotation=I.rotation;q.resolution=I.resolution;q.width=v.width*y.symbolTileSize;q.height=v.height*y.symbolTileSize;this.container.children.forEach(L=>L.destroy());this.container.removeAllChildren();this.container.symbolTypes="wind_speed"===y.style?["scalar","triangle"]:"simple_scalar"===y.style?["scalar"]:["triangle"];this.container.addChild(q)}}};n.__decorate([u.property()],N.prototype,"fetchPixels",void 0);n.__decorate([u.property()],
N.prototype,"container",void 0);n.__decorate([u.property()],N.prototype,"_loading",void 0);n.__decorate([u.property()],N.prototype,"updating",null);return N=n.__decorate([T.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],N)})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q){class p extends S.DisplayObject{constructor(y=null){super();this._symbolizerParameters=this._source=null;this._vaoInvalidated=!0;this.coordScale=[1,1];this.offset=this.key=this.height=null;this.stencilRef=0;this.resolution=null;this.pixelRatio=1;this.rotation=this.y=this.x=0;this.width=this.vaoData=this.rawPixelData=null;this.source=y}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(y){JSON.stringify(this._symbolizerParameters)!==
JSON.stringify(y)&&(this._symbolizerParameters=y,this.invalidateVAO())}get source(){return this._source}set source(y){this._source=y;this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(y){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:I}=this.symbolizerParameters;
switch(I){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":I=A.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(y.context,I)};break;case "simple_scalar":I=A.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(y.context,I)};break;case "wind_speed":I=A.createVFMesh(this.source,
this.symbolizerParameters);I=this._createVectorFieldVAO(y.context,I);const J=A.createVFMeshScalar(this.source,this.symbolizerParameters);y=this._createVectorFieldVAO(y.context,J);this.vaoData={magdir:I,scalar:y}}}this.ready();this.requestRender()}}_createTransforms(){return{dvs:D.create()}}setTransform(y){const I=B.identity(this.transforms.dvs),[J,v]=y.toScreenNoRotation([0,0],[this.x,this.y]);var q=this.resolution/this.pixelRatio/y.resolution;const L=q*this.width;q*=this.height;const K=Math.PI*this.rotation/
180;B.translate(I,I,u.fromValues(J,v));B.translate(I,I,u.fromValues(L/2,q/2));B.rotate(I,I,-K);B.translate(I,I,u.fromValues(-L/2,-q/2));B.scaleByVec2(I,I,u.fromValues(L,q));B.multiply(this.transforms.dvs,y.displayViewMat3,I)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(y,I){const {vertexData:J,indexData:v}=I;I=T.BufferObject.createVertex(y,U.Usage.STATIC_DRAW,new Float32Array(J));const q=T.BufferObject.createIndex(y,U.Usage.STATIC_DRAW,new Uint32Array(v)),
L=G.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:U.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:U.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:U.DataType.FLOAT,normalized:!1}]});return{vao:new Q.VertexArrayObject(y,L.attributes,L.bufferLayouts,{geometry:I},q),elementCount:v.length}}}n.RasterVFDisplayObject=p;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/ImageryLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),
function(n,N,B,D,u,A,S,G,T,U,Q){return p=>{p=class extends p{constructor(){super(...arguments);this.view=null}async fetchPopupFeatures(y,I){const {layer:J}=this;if(!y)throw new N("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:J});var {popupEnabled:v}=J;const q=Q.getFetchPopupTemplate(J,I);if(!v||null==q)throw new N("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:v,popupTemplate:q});const L=await q.getRequiredFields();
v=new U;v.timeExtent=this.timeExtent;v.geometry=y;v.outFields=L;v.outSpatialReference=y.spatialReference;const {resolution:K,spatialReference:a}=this.view;y="2d"===this.view.type?new G(K,K,a):new G(.5*K,.5*K,a);const {returnTopmostRaster:b,showNoDataRecords:d}=q.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};return J.queryVisibleRasters(v,{returnDomainValues:!0,returnTopmostRaster:b,pixelSize:y,showNoDataRecords:d,signal:null!=I?I.signal:null}).then(g=>g)}canResume(){return!super.canResume()||
this.timeExtent?.isEmpty?!1:!0}};n.__decorate([B.property()],p.prototype,"layer",void 0);n.__decorate([B.property()],p.prototype,"suspended",void 0);n.__decorate([B.property(T.combinedViewLayerTimeExtentProperty)],p.prototype,"timeExtent",void 0);n.__decorate([B.property()],p.prototype,"view",void 0);return p=n.__decorate([S.subclass("esri.views.layers.ImageryLayerView")],p)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(n,N){function B(D,
u){return D.popupTemplate?D.popupTemplate:null!=u&&u.defaultPopupTemplateEnabled&&null!=D.defaultPopupTemplate?D.defaultPopupTemplate:null}n.getFetchPopupTemplate=B;n.getRequiredFields=async function(D,u=D.popupTemplate){if(null==u)return[];const A=await u.getRequiredFields(D.fieldsIndex);({lastEditInfoEnabled:u}=u);const {objectIdField:S,typeIdField:G,globalIdField:T,relationships:U}=D;if(A.includes("*"))return["*"];u=u?N.getFeatureEditFields(D):[];const Q=N.fixFields(D.fieldsIndex,[...A,...u]);
G&&Q.push(G);Q&&S&&D.fieldsIndex?.has(S)&&!Q.includes(S)&&Q.push(S);Q&&T&&D.fieldsIndex?.has(T)&&!Q.includes(T)&&Q.push(T);U&&U.forEach(p=>{({keyField:p}=p);Q&&p&&D.fieldsIndex?.has(p)&&!Q.includes(p)&&Q.push(p)});return Q};n.hasPopupTemplate=function(D,u){return null!=B(D,{defaultPopupTemplateEnabled:u})};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(n,N,B,D,u,A,S,G,T){return U=>{U=class extends U{initialize(){this.addHandles(D.on(()=>this.layer,"refresh",Q=>{this.doRefresh(Q.dataChanged).catch(p=>{B.isAbortError(p)||N.getLogger(this).error(p)})}),"RefreshableLayerView")}};n.__decorate([u.property()],U.prototype,"layer",void 0);return U=n.__decorate([T.subclass("esri.layers.mixins.RefreshableLayerView")],U)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/handleUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../support/GraphicsCollection ../engine/flow/FlowView2D ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./imagery/ImageryView2D ./imagery/VectorFieldView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(n,
N,B,D,u,A,S,G,T,U,Q,p,y,I,J,v,q,L,K,a){S=class extends L(a(y.LayerView2DMixin(K))){constructor(){super(...arguments);this._exportImageVersion=-1;this._highlightGraphics=new Q.GraphicsCollection;this._highlightView=void 0;this.subview=this.layer=null}get pixelData(){const {subview:b}=this;return this.updating||!b?null:"getPixelData"in b?b.getPixelData():null}async hitTest(b,d){return this.subview?[{type:"graphic",graphic:this.subview.hitTest(b),layer:this.layer,mapPoint:b}]:null}update(b){this.subview?.update(b)}attach(){this.layer.increaseRasterJobHandlerUsage();
this._setSubView();this.view&&(this._highlightView=new I({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new J(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container));this.addAttachHandles([u.watch(()=>this.layer.exportImageServiceParameters.version,b=>{b&&this._exportImageVersion!==b&&(this._exportImageVersion=b,this.requestUpdate())},u.sync),u.watch(()=>this.timeExtent,b=>{const {subview:d}=this;d&&(d.timeExtent=
b,"redraw"in d?this.requestUpdate():d.redrawOrRefetch())},u.sync),this.layer.on("redraw",()=>{const {subview:b}=this;b&&("redraw"in b?b.redraw():b.redrawOrRefetch())}),u.watch(()=>this.layer.renderer,()=>this._setSubView())])}detach(){this.layer.decreaseRasterJobHandlerUsage();this.container.removeAllChildren();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null;this._highlightView?.destroy();this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(b,
d){if(!((Array.isArray(b)?b[0]:B.isCollection(b)?b.at(0):b)instanceof N))return D.makeHandle();let g=[];Array.isArray(b)||B.isCollection(b)?g=b.map(e=>e.clone()):b instanceof N&&(g=[b.clone()]);this._highlightGraphics.addMany(g);return D.makeHandle(()=>this._highlightGraphics.removeMany(g))}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||this.subview.updating}_setSubView(){if(this.view){var b=this.layer.renderer?.type,d="imagery";"vector-field"===b?d="imageryVF":"flow"===
b&&(d="flow");if(this.subview){({type:b}=this.subview);if(b===d){this._attachSubview(this.subview);"flow"===b?this.subview.redrawOrRefetch():"imagery"===b&&"lerc"===this.layer.format?this.subview.redraw():this.requestUpdate();return}this._detachSubview(this.subview);this.subview?.destroy()}this.subview="imagery"===d?new v({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===d?new q({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new p({layer:this.layer,layerView:this});
this._attachSubview(this.subview);this.requestUpdate()}}_attachSubview(b){b&&!b.attached&&(b.attach(),b.attached=!0,this.container.addChildAt(b.container,0))}_detachSubview(b){b?.attached&&(this.container.removeChild(b.container),b.detach(),b.attached=!1)}};n.__decorate([A.property()],S.prototype,"pixelData",null);n.__decorate([A.property()],S.prototype,"subview",void 0);return S=n.__decorate([U.subclass("esri.views.2d.layers.ImageryLayerView2D")],S)});