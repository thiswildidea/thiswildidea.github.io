// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/screenUtils ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f32 ../../alignmentUtils ../../number ../../Rect ../../collisions/BoundingBox".split(" "),function(E,K,w,y,z,H,L,r,M,C){function D(a,b){a.forEach(c=>z.transformMat2d(c,c,b));return{upperLeft:r.i1616to32(8*a[0][0],8*a[0][1]),upperRight:r.i1616to32(8*a[1][0],8*a[1][1]),lowerLeft:r.i1616to32(8*a[2][0],8*a[2][1]),lowerRight:r.i1616to32(8*
a[3][0],8*a[3][1])}}const N=Math.PI/180;class G{constructor(a,b,c,d){this._rotationT=y.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const l=c.rect,g=new Float32Array(8);a*=d;b*=d;const h=c.code?l.width*d:c.metrics.width,k=c.code?l.height*d:c.metrics.height;this.width=h;this.height=k;g[0]=a;g[1]=b;g[2]=a+h;g[3]=b;g[4]=a;g[5]=b+k;g[6]=a+h;g[7]=b+k;this._data=g;this._setTextureCoords(l);this._scale=d;this._mosaic=c;this.x=a;this.y=b;this.maxOffset=Math.max(a+
h,b+k)}get mosaic(){return this._mosaic}set angle(a){this._angle=a;w.fromRotation(this._rotationT,-a);this._setOffsets(this._data)}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||this._setOffsets(this._data);return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:l,
width:g}=this._mosaic.metrics;var a=g*this._scale,b=Math.abs(l)*this._scale,c=new Float32Array(8);c[0]=this.x;c[1]=this.y;c[2]=this.x+a;c[3]=this.y;c[4]=this.x;c[5]=this.y+b;c[6]=this.x+a;c[7]=this.y+b;a=w.multiply(y.create(),this._rotationT,this._transform);y.transformMany(c,c,a);b=a=Infinity;let h=0;var d=0;for(let k=0;4>k;k++){const m=c[2*k],e=c[2*k+1];a=Math.min(a,m);b=Math.min(b,e);h=Math.max(h,m);d=Math.max(d,e)}c=h-a;d-=b;this._bounds=new C(a+c/2,b+d/2,c,d)}return this._bounds}setTransform(a){this._transform=
a;this._offsets=null}_setOffsets(a){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const b=this._offsets,c=new Float32Array(8),d=w.multiply(y.create(),this._rotationT,this._transform);y.transformMany(c,a,d);b.upperLeft=r.i1616to32(8*c[0],8*c[1]);b.upperRight=r.i1616to32(8*c[2],8*c[3]);b.lowerLeft=r.i1616to32(8*c[4],8*c[5]);b.lowerRight=r.i1616to32(8*c[6],8*c[7])}_setTextureCoords({x:a,y:b,width:c,height:d}){this._texcoords={upperLeft:r.i1616to32(a,b),upperRight:r.i1616to32(a+
c,b),lowerLeft:r.i1616to32(a,b+d),lowerRight:r.i1616to32(a+c,b+d)}}}class I{constructor(a,b,c){this._rotation=0;this._decorate(a,b,c);this.glyphs=a;this.bounds=this._createBounds(a);this.isMultiline=1<b.length;this._hasRotation=0!==c.angle;this._transform=this._createGlyphTransform(this.bounds,c);if((this._borderLineSize=c.borderLineSize)||c.hasBackground)[this.bounds,this.background]=this.shapeBackground(this._transform);for(const d of a)d.setTransform(this._transform)}setRotation(a){if(0!==a||0!==
this._rotation){this._rotation=a;var b=this._transform;a=w.fromRotation(y.create(),a);w.multiply(b,a,b);for(const c of this.glyphs)c.setTransform(this._transform)}}_decorate(a,b,c){if(c.decoration&&"none"!==c.decoration&&a.length){var d=c.scale;c="underline"===c.decoration?30:20;var l=a[0].textureBinding;for(const m of b){const e=m.startX*d,f=m.startY*d;b=a;var g=b.push;var h=(m.width+m.glyphWidthEnd)*d;var k=l;h={code:0,page:0,sdf:!0,rect:new M(0,0,11,8),textureBinding:k,metrics:{advance:0,height:4,
width:h,left:0,top:0}};g.call(b,new G(e,f+c*d,h,1))}}}shapeBackground(a){const {xmin:b,ymin:c,xmax:d,ymax:l,x:g,y:h,width:k,height:m}=this.bounds;var e=Math.min(k,m)+16-1.5;e=(1.5+Math.min(K.pt2px(this._borderLineSize||0),e))/2;var f=this._borderLineSize?e:0;const p=[b-8,c-8],n=[d+8,c-8],q=[b-8,l+8],t=[d+8,l+8],u=D([[p[0]-e,p[1]-e],[n[0]+e,n[1]-e],[p[0]+f,p[1]+f],[n[0]-f,n[1]+f]],a),v=D([[q[0]+f,q[1]-f],[t[0]-f,t[1]-f],[q[0]-e,q[1]+e],[t[0]+e,t[1]+e]],a),A=D([[p[0]-e,p[1]-e],[p[0]+f,p[1]+f],[q[0]-
e,q[1]+e],[q[0]+f,q[1]-f]],a);f=D([[n[0]-f,n[1]+f],[n[0]+e,n[1]-e],[t[0]-f,t[1]-f],[t[0]+e,t[1]+e]],a);a={main:D([p,n,q,t],a),top:u,bot:v,left:A,right:f};return[new C(g,h,k+2*e,m+2*e),a]}get boundsT(){var a=this.bounds;const b=z.set(H.create(),a.x,a.y);z.transformMat2d(b,b,this._transform);return this._hasRotation?(a=Math.max(a.width,a.height),new C(b[0],b[1],a,a)):new C(b[0],b[1],a.width,a.height)}_createBounds(a){let b=Infinity,c=Infinity,d=0;var l=0;for(const g of a)b=Math.min(b,g.xTopLeft),c=
Math.min(c,g.yTopLeft),d=Math.max(d,g.xBottomRight),l=Math.max(l,g.yBottomRight);a=d-b;l-=c;return new C(b+a/2,c+l/2,a,l)}_createGlyphTransform(a,b){const c=N*b.angle,d=y.create(),l=H.create();w.translate(d,d,z.set(l,b.xOffset,-b.yOffset));b.isCIM?w.rotate(d,d,c):(w.translate(d,d,z.set(l,a.x,a.y)),w.rotate(d,d,c),w.translate(d,d,z.set(l,-a.x,-a.y)));return d}}class F{constructor(a,b,c,d,l,g){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(b,c));this.end=Math.max(0,Math.max(b,
c));this.end<a.length&&(this.glyphWidthEnd=a[this.end].metrics.width);this.width=d;this.yMin=l;this.yMax=g}}E.ShapedGlyph=G;E.ShapingInfo=I;E.shapeGlyphs=function(a,b,c){const d=c.scale,l=[],g=[];var h=1/c.scale*c.maxLineWidth;var k=b?a.length-1:0,m=b?-1:a.length;b=b?-1:1;var e=k,f=0,p=0;let n=e,q=n,t=0,u=Infinity,v=0;for(;e!==m;){const {code:B,metrics:x}=a[e];var A=Math.abs(x.top);10!==B&&32!==B&&(u=Math.min(u,A),v=Math.max(v,A+x.height));10===B?(e!==k&&(g.push(new F(a,n,e-b,f,u,v)),u=Infinity,v=
0),f=0,n=e+b,q=e+b,p=0):32===B?(q=e+b,p=0,t=x.advance,f+=x.advance):(f>h&&(q!==n?(A=q-2*b,f-=t,g.push(new F(a,n,A,f-p,u,v)),u=Infinity,v=0,n=q,f=p):(g.push(new F(a,n,e-b,f,u,v)),u=Infinity,v=0,q=n=e,f=0)),f+=x.advance,p+=x.advance);e+=b}h=new F(a,n,e-b,f,u,v);0<=h.start&&h.end<a.length&&g.push(h);for(h=0;h<g.length;h++);k=g[0].yMin;h=g[g.length-1].yMax+c.lineHeight*(g.length-1)+("underline"===c.decoration?4:0)-k;const {vAlign:J,hAlign:O}=c;m=J===L.VAlign.Baseline?1:0;h=(1-m)*-k+h/2*(m?0:J-1)+-26*
(m?1:0);for(k=0;k<g.length;k++){const {start:B,end:x,width:P}=g[k];m=P/2*(O+1)*-1-3;b=k*c.lineHeight+h-3;g[k].startX=m;g[k].startY=b;for(e=B;e<=x;e++)f=a[e],10!==f.code&&(p=new G(m+f.metrics.left,b-f.metrics.top,f,d),m+=f.metrics.advance,l.push(p))}return new I(l,g,c)};Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})});