// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),function(f,E,F,m,v,n,G,q,H,r,I,J){class w extends I(J){constructor(a,b,d,e,g,c,l,x,h,t,z,A,B,C,u,D,y,p,k,K,L,M,N,O){super();this.angle=e;this.height=l;this.width=c;this.xOffset=b*k;this.yOffset=d*k;this._markerPlacement=
K||void 0;this._effects=L||void 0;this._anchorX=D;this._anchorY=y;this._minMaxZoom=q.i1616to32(Math.round(M*n.minMaxZoomPrecisionFactor),Math.round(N*n.minMaxZoomPrecisionFactor));b=(C===m.Alignment.MAP?n.bitsetMarkerAlignmentMap:n.bitsetMarkerAlignmentScreen)|(z?n.bitsetGenericLockColor:0)|(B?n.bitsetMarkerOutlineAllowColorOverride:0)|(A?n.bitsetMarkerScaleSymbolsProportionally:0);d=u&&u.sdf;a=H.MarkerMaterialKey.load(a);a.sdf=d;a.pattern=!0;a.textureBinding=u.textureBinding;this._materialKey=a.data;
this._fillColor=g;this._outlineColor=h;this._sizeOutlineWidth=q.i8888to32(Math.round(Math.min(Math.sqrt(128*c),255)),Math.round(Math.min(Math.sqrt(128*l),255)),Math.round(Math.min(Math.sqrt(128*t),255)),Math.round(Math.min(Math.sqrt(128*x),255)));a.symbologyType===G.WGLSymbologyType.PIE_CHART?(this._computedWidth=c*p*k,this._computedHeight=l*p*k,this._texUpperLeft=q.i1616to32(0,1),this._texUpperRight=q.i1616to32(1,1),this._texBottomLeft=q.i1616to32(0,0),this._texBottomRight=q.i1616to32(1,0)):this._computeSize(c,
l,p,t,k,u,a.hasSizeVV(),O);this._bitestAndDistRatio=q.i1616to32(b,Math.round(64*p));g=F.create();c=E.create();this._applyTransformation(c,g)}static fromCIMMarker(a,b,d){const e=a.size,g=(b&&b.width||1)/(b&&b.height||1)*a.scaleX;var c=a.scaleSymbolsProportionally&&a.frameHeight?e/a.frameHeight:1;const l=v.premultiplyAlphaRGBA(a.color),x=v.premultiplyAlphaRGBA(a.outlineColor),h=f.pt2px(e),t=h*g,z=f.pt2px(a.offsetX||0),A=f.pt2px(a.offsetY||0);c*=f.pt2px(a.outlineWidth||0);const B=a.alignment||m.Alignment.SCREEN,
C=f.pt2px(a.referenceSize),[u,D]=r.getMinMaxZoom(a.scaleInfo,d);d=a.rotation||0;a.rotateClockwise||(d=-d);let y=0,p=0;const k=a.anchorPoint;k&&(a.isAbsoluteAnchorPoint?e&&(y=k.x/(e*g),p=k.y/e):(y=k.x,p=k.y));b=new w(a.materialKey,z,A,d,l,t,h,C,x,c,a.colorLocked,a.scaleSymbolsProportionally,!1,B,b,y,p,a.sizeRatio,a.scaleFactor??1,a.markerPlacement,a.effects,u,D,!0);b._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/t:1;b._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/h:1;return b}static fromPictureMarker(a,
b){const d=Math.round(f.pt2px(a.width)),e=Math.round(f.pt2px(a.height)),g=n.pictureFillColor,c=Math.round(f.pt2px(a.xoffset||0)),l=Math.round(f.pt2px(a.yoffset||0));b=new w(a.materialKey,c,l,a.angle,g,d,e,e,0,0,!1,!1,!1,m.Alignment.SCREEN,b,0,0,1,1,null,null,r.defaultMinZoom,r.defaultMaxZoom,!1);b._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/a.width:1;b._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/a.height:1;return b}static fromSimpleMarker(a,b){const d=a.style,e=v.premultiplyAlphaRGBAArray(a.color),
g=Math.round(f.pt2px(a.size));let c=g;"esriSMSTriangle"===d&&(c*=b.height/b.width);const l=Math.round(f.pt2px(a.xoffset||0)),x=Math.round(f.pt2px(a.yoffset||0));var h=a.outline;const t=(h?.color&&v.premultiplyAlphaRGBAArray(h.color))|0;h=(h?.width&&Math.round(f.pt2px(h.width)))|0;b=new w(a.materialKey,l,x,a.angle??0,e,g,c,c,t,h,!1,!1,"esriSMSCross"===d||"esriSMSX"===d,m.Alignment.SCREEN,b,0,0,2,1,null,null,r.defaultMinZoom,r.defaultMaxZoom,!1);b.boundsType="esriSMSCircle"===d?"circle":"square";b._vertexBoundsScaleX=
a.maxVVSize?a.maxVVSize/a.size:1;b._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/a.size:1;return b}static fromLineSymbolMarker(a,b){const d=v.premultiplyAlphaRGBAArray(a.color),e=Math.round(f.pt2px(6*a.lineWidth)),g="cross"===a.style||"x"===a.style;switch(a.placement){case "begin-end":var c=m.ExtremityPlacement.Both;break;case "begin":c=m.ExtremityPlacement.JustBegin;break;case "end":c=m.ExtremityPlacement.JustEnd;break;default:c=m.ExtremityPlacement.None}c={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,
offset:0,extremityPlacement:c,offsetAlongLine:0};b=new w(a.materialKey,0,0,0,d,e,e,e/6,d,g?Math.round(f.pt2px(a.lineWidth)):0,!1,!1,g,m.Alignment.MAP,b,0,0,2,1,c,null,r.defaultMinZoom,r.defaultMaxZoom,!1);b.boundsType="circle"===a.style?"circle":"square";return b}}return w});