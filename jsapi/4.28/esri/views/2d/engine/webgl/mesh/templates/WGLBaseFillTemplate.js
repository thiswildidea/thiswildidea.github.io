// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../enums ../../number ../../Utils ../../materialKey/MaterialKey ./templateUtils ./WGLLineTemplate".split(" "),function(n,p,q,l,m,r){return t=>class extends t{constructor(...a){super(...a);this.forceLibtess=!1;this._bitset=0;this._lineTemplate=null;this.geometryType=n.WGLGeometryType.FILL}_maybeAddLineTemplate(a){this._lineTemplate=r.fromFillOutline(a)}_write(a,b,d,c){d="esriGeometryPoint"===b.geometryType;const e=l.FillMaterialKey.load(this._materialKey);a.recordStart(b.getDisplayId(),
this._materialKey,this.geometryType,d);this._writeGeometry(a,b,e,c,d);l.hasOutlineFillSymbology(e)&&null!=this._lineTemplate&&this._lineTemplate.writeGeometry(a,b,c,d);a.recordEnd()}_writeGeometry(a,b,d,c,e){c=this._getGeometry(b,c,e);null!=c&&(e=[],100<c.maxLength||this.forceLibtess||!m.triangulate(e,c)?(c=m.triangulateLibtess(c),this._writeVertices(a,b,c,[c.length/2],d)):e.length&&this._writeVertices(a,b,c.coords,c.lengths,d,e))}_writeVertex(a,b,d,c,e,f){const g=p.i1616to32(1*c,1*e);a.vertexBounds(c,
e,0,0);a.vertexWrite(g);a.vertexWrite(b);d.symbologyType===n.WGLSymbologyType.DOT_DENSITY?a.vertexWriteF32(1/Math.abs(f.readGeometryArea())):(a.vertexWrite(this.fillColor),b=l.hasSimpleSymbology(d),b||(a.vertexWrite(this.tl),a.vertexWrite(this.br)),a.vertexWrite(this.aux21),a.vertexWrite(this.aux22),a.vertexWrite(this.aux3),b||a.vertexWrite(this._minMaxZoom))}_writeVertices(a,b,d,c,e,f){var g=b.getDisplayId();g|=this._bitset<<24;var h=c.reduce((k,u)=>k+u);const v=q.getStrides(e.geometryType,e.symbologyType).geometry/
4;c=a.vertexCount();a.vertexEnsureSize(v*h);h=0;if(f)for(const k of f)this._writeVertex(a,g,e,d[2*k],d[2*k+1],b),h++;else for(f=0;f<d.length;f+=2)this._writeVertex(a,g,e,Math.round(d[f]),Math.round(d[f+1]),b),h++;a.indexEnsureSize(h);for(b=0;b<h;b++)a.indexWrite(b+c)}_getGeometry(a,b,d){return(a=b?.asOptimized()||a.readGeometryForDisplay())?m.clipMarshall(a,d?256:8):null}}});