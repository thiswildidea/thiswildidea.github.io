// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define(["./enums","./shaders/MaterialPrograms"],function(g,k){const m=({rendererInfo:a,drawPhase:c},b,d)=>`${b.getVariationHash()}-${(c===g.WGLDrawPhase.HITTEST||c===g.WGLDrawPhase.LABEL_ALPHA?1:0)|(c===g.WGLDrawPhase.HIGHLIGHT?2:0)}-${a.getVariationHash()}-${null!=d&&d.join(".")}`,n=(a,c,b,d={})=>{d={...d};c={...c.getVariation()};var h={...a.rendererInfo.getVariation()},e=a.drawPhase;d={...d,...c,...h,highlight:a.drawPhase===g.WGLDrawPhase.HIGHLIGHT,id:e===g.WGLDrawPhase.HITTEST||e===g.WGLDrawPhase.LABEL_ALPHA};
if(null!=b)for(const f of b)d[f]=!0;return d};class p{constructor(a){this._rctx=a;this._programByKey=new Map}dispose(){this._programByKey.forEach(a=>a.dispose());this._programByKey.clear()}getProgram(a,c=[]){const b=a.vsPath+"."+a.fsPath+JSON.stringify(c);if(this._programByKey.has(b))return this._programByKey.get(b);c={...c.map(f=>"string"===typeof f?{name:f,value:!0}:f).reduce((f,l)=>({...f,[l.name]:l.value}),{})};const {vsPath:d,fsPath:h,attributes:e}=a;a=k.createProgramTemplate(d,h,e,c);a=this._rctx.programCache.acquire(a.shaders.vertexShader,
a.shaders.fragmentShader,a.attributes);if(!a)throw Error("Unable to get program for key: ${key}");this._programByKey.set(b,a);return a}getMaterialProgram(a,c,b,d,h){const e=m(a,c,h);if(this._programByKey.has(e))return this._programByKey.get(e);a=n(a,c,h,{ignoresSamplerPrecision:a.context.driverTest.ignoresSamplerPrecision.result});b=k.createProgramTemplate(b,b,d,a);b=this._rctx.programCache.acquire(b.shaders.vertexShader,b.shaders.fragmentShader,b.attributes);if(!b)throw Error("Unable to get program for key: ${key}");
this._programByKey.set(e,b);return b}}return p});