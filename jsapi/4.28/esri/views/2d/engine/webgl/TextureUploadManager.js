// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/promiseUtils","./definitions","../../../webgl/contextUtils"],function(k,h,l,m){class n{constructor(c,a){this._queue=[];this._context=c;this._refreshable=a}destroy(){this._queue=[]}enqueueTextureUpdate(c,a){const b=h.createResolver(),e=l.textureUploadManagerChunkSize,f=Math.ceil(c.height/e);h.throwIfAborted(a);if(this._context.type===m.ContextType.WEBGL1)this._queue.push({type:"no-chunk",request:c,resolver:b,options:a});else for(let d=0;d<f;d++){const g=d===f-1;
this._queue.push({type:"chunk",request:c,resolver:b,chunk:d,chunkOffset:d*e,destHeight:g?c.height-e*d:e,chunkIsLast:g,options:a})}h.onAbortOrThrow(a,d=>b.reject(d));return b.promise}upload(){let c=0;for(;this._queue.length;){var a=performance.now();const b=this._queue.shift();if(b&&(null==b.options.signal||!b.options.signal.aborted)){switch(b.type){case "chunk":this._uploadChunk(b);break;case "no-chunk":this._uploadNoChunk(b)}a=performance.now()-a;c+=a;if(c+a>=l.textureUploadManagerBudget)break}}this._queue.length&&
this._refreshable.requestRender()}_uploadChunk(c){const {request:a,resolver:b,chunkOffset:e,chunkIsLast:f,destHeight:d}=c,{data:g,texture:p,width:q}=a;null!=g&&(p.updateData(0,0,e,q,d,g,e),f&&b.resolve())}_uploadNoChunk(c){const {request:a,resolver:b}=c,{data:e,texture:f}=a;f.setData(e);b.resolve()}}k.TextureUploadManager=n;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});