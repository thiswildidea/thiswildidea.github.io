// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],function(k,g,m){class n{constructor(a,b,c){this._debugMap=new Map;this._width=a*c;this._height=b*c;this._pixelRatio=c;a=Math.ceil(this._width/1);b=Math.ceil(this._height/1);this._cols=a;this._rows=b;this._cells=m.StaticBitSet.create(a*b)}insertMetrics(a){const b=this._hasCollision(a);0===b&&this._markMetrics(a);return b}getCellId(a,b){return a+b*this._cols}has(a){return this._cells.has(a)}hasRange(a,
b){return this._cells.hasRange(a,b)}set(a){this._cells.set(a)}setRange(a,b){this._cells.setRange(a,b)}_collide(a,b,c,d){a-=c/2;b-=d/2;c=a+c;var f=b+d;if(0>c||0>f||a>this._width||b>this._height)return 1;d=g.clamp(Math.floor(a/1),0,this._cols);var e=g.clamp(Math.floor(b/1),0,this._rows);a=g.clamp(Math.ceil(c/1),0,this._cols);b=g.clamp(Math.ceil(f/1),0,this._rows);for(c=e;c<=b;c++)for(f=d;f<=a;f++)if(e=this.getCellId(f,c),this.has(e))return 2;return 0}_mark(a,b,c,d,f){a-=c/2;b-=d/2;c=a+c;var e=b+d;d=
g.clamp(Math.floor(a/1),0,this._cols);var h=g.clamp(Math.floor(b/1),0,this._rows);a=g.clamp(Math.ceil(c/1),0,this._cols);b=g.clamp(Math.ceil(e/1),0,this._rows);for(c=h;c<=b;c++)for(e=d;e<=a;e++)h=this.getCellId(e,c),this._debugMap.set(h,f),this.set(h);return!1}_hasCollision(a){const b=a.id;let c=0,d=0;a.save();do{const f=a.boundsCount;c+=f;for(let e=0;e<f;e++){const h=a.boundsComputedAnchorX(e),l=a.boundsComputedAnchorY(e),p=(a.boundsWidth(e)+2)*this._pixelRatio,q=(a.boundsHeight(e)+2)*this._pixelRatio;
switch(this._collide(h,l,p,q)){case 2:return 2;case 1:d++}}}while(a.peekId()===b&&a.next());a.restore();return c===d?1:0}_markMetrics(a){const b=a.id;a.save();do{const c=a.boundsCount;for(let d=0;d<c;d++){const f=a.boundsComputedAnchorX(d),e=a.boundsComputedAnchorY(d),h=(a.boundsWidth(d)+2)*this._pixelRatio,l=(a.boundsHeight(d)+2)*this._pixelRatio;this._mark(f,e,h,l,a.id)}}while(a.peekId()===b&&a.next());a.restore()}}k.CollisionBitsetGrid=n;k.hasCollision=2;k.none=0;k.outsideExtent=1;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})});