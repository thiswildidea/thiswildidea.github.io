// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/screenUtils ../../../../core/unitUtils ../../../../renderers/support/lengthUtils ./Utils ./techniques/Technique ./techniques/utils ../../../webgl/capabilities".split(" "),function(m,h,n,p,k,q,r,t){function l(c,a){const b=a.length;if(c<a[0].value||1===b)return a[0].size;for(let d=1;d<b;d++)if(c<a[d].value)return a[d-1].size+(c-a[d-1].value)/(a[d].value-a[d-1].value)*(a[d].size-a[d-1].size);return a[b-1].size}class u{constructor(){this.symbolLevels=[];this.vvColorValues=
new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.outsideLabelsVisible=!1;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this._technique=q.Technique}getSizeVVFieldStops(c){var a=this._vvSizeFieldStops;if(a)switch(a.type){case "static":return a;case "level-dependent":var b;if(null!=(b=
a.levels[c]))a=b;else{{let d=Infinity;b=0;for(const f in a.levels){const e=parseFloat(f),g=Math.abs(c-e);g<d&&(d=g,b=e)}Infinity===d?a={sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])}:(c=2**((c-b)/2),a=a.levels[b],b=new Float32Array(a.values),b[2]*=c,b[3]*=c,a={sizes:a.sizes,values:b})}}return a}}get vvMaterialParameters(){return this._vvMaterialParameters}update(c){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,c)}setInfo(c,a,b){this._updateEffects(b);
this._vvInfo=a;this._technique=r.getTechniqueFromRenderer(c);this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,c)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:t.getWebGLCapabilities("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(c){this.outsideLabelsVisible=
null!=c?c.excludedLabelsVisible:!1}_updateVisualVariables(c,a){const b=this._vvMaterialParameters;b.vvOpacityEnabled=!1;b.vvSizeEnabled=!1;b.vvColorEnabled=!1;b.vvRotationEnabled=!1;if(c){var d=c.size;if(d){b.vvSizeEnabled=!0;if(d.minMaxValue){const e=d.minMaxValue;let g;if(k.isDefined(e.minSize)&&k.isDefined(e.maxSize))if(k.isNumber(e.minSize)&&k.isNumber(e.maxSize)){g=h.pt2px(e.minSize);var f=h.pt2px(e.maxSize)}else f=a.scale,g=h.pt2px(l(f,e.minSize.stops)),f=h.pt2px(l(f,e.maxSize.stops));this.vvSizeMinMaxValue.set([e.minDataValue,
e.maxDataValue,g,f])}d.scaleStops&&(this.vvSizeScaleStopsValue=h.pt2px(l(a.scale,d.scaleStops.stops)));d.unitValue&&(this.vvSizeUnitValueToPixelsRatio=n.getMetersPerUnitForSR(a.spatialReference)/p.meterIn[d.unitValue.unit]/a.resolution);d.fieldStops&&(this._vvSizeFieldStops=d.fieldStops)}if(a=c.color)b.vvColorEnabled=!0,this.vvColorValues.set(a.values),this.vvColors.set(a.colors);if(a=c.opacity)b.vvOpacityEnabled=!0,this.vvOpacityValues.set(a.values),this.vvOpacities.set(a.opacities);if(c=c.rotation)b.vvRotationEnabled=
!0,b.vvRotationType=c.type}}}m.WGLRendererInfo=u;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});