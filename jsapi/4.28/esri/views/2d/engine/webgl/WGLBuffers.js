// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define(["./Utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],function(h,k,l,m){class n{constructor(a){this.geometryMap=h.createGeometryData(()=>({indexBuffer:k.BufferObject.createIndex(a,l.Usage.STATIC_DRAW),vao:null}),(b,c)=>({vertexBuffer:k.BufferObject.createVertex(a,h.cVboInfo[c])}))}dispose(){for(let a=0;5>a;a++){const b=this.geometryMap[a];if(b){b.data.vao?.disposeVAOOnly();b.data.indexBuffer?.dispose();for(const c in b.buffers)b.buffers[c]?.data.vertexBuffer.dispose()}}}get(a){const b=
this.geometryMap[a];return{getVAO(c,d,e){if(!b.data.vao){const f={};for(const g in b.buffers)f[g]=b.buffers[g].data.vertexBuffer;b.data.vao=new m.VertexArrayObject(c,e,d,f,b.data.indexBuffer)}return b.data.vao}}}has(a){return null!=this.geometryMap[a]}upload(a,b){b.forEach((c,d)=>{this._upload(c,d,a)})}_upload(a,b,c){a.indices&&(a.indices.allDirty?this._uploadIndices(c,b):null!=a.indices.from&&null!=a.indices.count&&this._uploadIndices(c,b,a.indices.from,a.indices.count));if(a.vertices){a=a.vertices;
for(const d in a){const e=a[d];e.allDirty?this._uploadVertices(c,b,d):null!=e.from&&null!=e.count&&this._uploadVertices(c,b,d,e.from,e.count)}}}_uploadVertices(a,b,c,d,e){const f=this.geometryMap[b];if(f&&(a=a.geometries[b].vertexBuffer[c])){var {data:g,stride:p}=a;f.buffers[c]&&0<g.length&&(a=p/g.BYTES_PER_ELEMENT,null!=d&&null!=e?f.buffers[c].data.vertexBuffer.setSubData(g,d*a,d*a,(d+e)*a):f.buffers[c].data.vertexBuffer.setData(g))}}_uploadIndices(a,b,c,d){const e=this.geometryMap[b];e&&(a=a.geometries[b].indexBuffer,
e.data.indexBuffer&&0<a.length&&(null!=c&&null!=d?e.data.indexBuffer.setSubData(a,c,c,c+d):e.data.indexBuffer.setData(a)))}}return n});