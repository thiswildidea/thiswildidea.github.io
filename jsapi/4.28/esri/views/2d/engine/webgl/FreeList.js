// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define(["exports"],function(h){class k{get largestRange(){return this._largestRange}constructor(a){this._largestRange=null;this._parent=a;this._updateLargestRange()}rangeCreated(a){if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a}rangeResized(a,b){if(a===this._largestRange)a.count<b&&this._updateLargestRange();else if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a}findBestRange(a){let b=this._parent._freeHead,c=null;for(;null!==b;)b.count>=
a&&(!c||b.count-a<c.count-a)&&(c=b),b=b.next;return c}findAdjacentRanges(a,b){let c=!0,d=!1,e=null,f=this._parent._freeHead;for(;c&&!d;){const l=null!==f?f.from:this._parent._size;a>=(null!==e?e.from+e.count:0)&&a+b<=l?(c=!1,d=!0):null!==f?(e=f,f=f.next):c=!1}return[e,f]}_updateLargestRange(){let a=null,b=this._parent._freeHead;for(;null!==b;){if(!a||b.count>a.count)a=b;b=b.next}this._largestRange=a}}class g{constructor(a,b){this._allocated=0;this._size=a;this._freeHead=0<a?{from:0,count:a,prev:null,
next:null}:null;this._bookKeeper=b||new k(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}allocate(a){const b=this._bookKeeper.findBestRange(a);if(null==b)return-1;const c=b.from,d=b.count;b.from+=a;b.count-=a;this._bookKeeper.rangeResized(b,c,d);this._allocated+=a;0===b.count&&(a=null!==b.prev?this._freeHead:b.next,g._removeRange(b),this._freeHead=a);return c}free(a,b){const [c,d]=this._bookKeeper.findAdjacentRanges(a,b);a={from:a,count:b,prev:c??null,next:d??null};null!=c&&(c.next=
a);null!=d&&(d.prev=a);this._bookKeeper.rangeCreated(a);this._allocated-=b;if(null!=d&&a.from+a.count===d.from){b=a.from;var e=a.count;g._fuse(a,d);g._removeRange(d);this._bookKeeper.rangeResized(a,b,e);this._bookKeeper.rangeResized(d,void 0,0)}null!=c&&c.from+c.count===a.from&&(b=c.from,e=c.count,g._fuse(c,a),g._removeRange(a),this._bookKeeper.rangeResized(c,b,e),this._bookKeeper.rangeResized(a,void 0,0));this._freeHead=null!==a.prev?this._freeHead:a}get fragmentation(){const a=this._size-this._allocated;
return 0===a?0:1-this._bookKeeper.largestRange.count/a}static _removeRange(a){null!==a.prev?null!==a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null:null!==a.next&&(a.next.prev=null)}static _fuse(a,b){a.count+=b.count;a.next=b.next;b.from+=b.count;b.count=0;null!==b.next&&(b.next.prev=a)}}h.FreeList=g;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});