// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/has","../definitions","../VertexStream","./Effect"],function(l,m,h,n,p){class q extends p.Effect{constructor(){super(...arguments);this.defines=[];this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(c,d){if(d?.size){var {context:b,renderingOptions:a}=c;this._quad||(this._quad=new n(b,[0,0,1,0,0,1,1,1]));var g=b.getBoundFramebufferObject(),{x:k,y:e,width:r,
height:t}=b.getViewport();d.bindTextures(b);var f=d.getBlock(h.attributeDataAnimation);if(null!=f){var u=f.getFBO(b);f=f.getFBO(b,1);b.setViewport(0,0,d.size,d.size);this._computeDelta(c,f,a.labelsAnimationTime);this._updateAnimationState(c,f,u);b.bindFramebuffer(g);b.setViewport(k,e,r,t)}}}_computeDelta(c,d,b){const {context:a,painter:g,displayLevel:k}=c,e=g.materialManager.getProgram(this._desc,["delta"]);a.bindFramebuffer(d);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);a.useProgram(e);
d=m("featurelayer-animation-enabled")?b:1;e.setUniform1i("u_maskTexture",h.textureBindingAttributeData0);e.setUniform1i("u_sourceTexture",h.textureBindingAttributeData1);e.setUniform1f("u_timeDelta",c.deltaTime);e.setUniform1f("u_animationTime",d);e.setUniform1f("u_zoomLevel",Math.round(10*k));this._quad.draw()}_updateAnimationState(c,d,b){const {context:a,painter:g}=c;c=g.materialManager.getProgram(this._desc,["update"]);a.bindTexture(d.colorTexture,1);a.useProgram(c);c.setUniform1i("u_sourceTexture",
1);a.bindFramebuffer(b);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._quad.draw()}}l.AnimationEffect=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});