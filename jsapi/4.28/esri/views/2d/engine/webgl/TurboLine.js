// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define(["exports","../../../../symbols/cim/enums","./definitions"],function(ea,r,ia){function fa(d,c){return d.x===c.x&&d.y===c.y}function L(d,c){d.x=c.y;d.y=-c.x;return d}function I(d,c){d.x=-c.y;d.y=c.x;return d}function ha(d,c){d.x=c.x;d.y=c.y;return d}function ba(d,c){d.x=-c.x;d.y=-c.y;return d}function ca(d){return Math.sqrt(d.x*d.x+d.y*d.y)}function U(d,c,l,z){d.x=c.x*l+c.y*z;d.y=c.x*z-c.y*l;return d}class ja{constructor(d,c,l){this._writeVertex=d;this._writeTriangle=c;this._canUseThinTessellation=
l;this._prevNormal={x:void 0,y:void 0};this._nextNormal={x:void 0,y:void 0};this._textureNormalLeft={x:0,y:1};this._textureNormalRight={x:0,y:-1};this._textureNormal={x:void 0,y:void 0};this._joinNormal={x:void 0,y:void 0};this._inner={x:void 0,y:void 0};this._outer={x:void 0,y:void 0};this._roundStart={x:void 0,y:void 0};this._roundEnd={x:void 0,y:void 0};this._startBreak={x:void 0,y:void 0};this._endBreak={x:void 0,y:void 0};this._innerPrev={x:void 0,y:void 0};this._innerNext={x:void 0,y:void 0};
this._bevelStart={x:void 0,y:void 0};this._bevelEnd={x:void 0,y:void 0};this._bevelMiddle={x:void 0,y:void 0}}tessellate(d,c){if(d){var l=d.length;if(!(1>=l)){var z=0;for(let A=1;A<l;A++)fa(d[A],d[z])||++z===A||(d[z]=d[A]);d.length=z+1}}this._canUseThinTessellation&&c.halfWidth<ia.thinLineHalfWidthThreshold&&!c.offset?this._tessellateThin(d,c):this._tessellate(d,c)}_tessellateThin(d,c){if(!(2>d.length)){var l=c.wrapDistance||65535;c=c.initialDistance||0;var z=!1,A=d[0].x,D=d[0].y,Y=d.length;for(let J=
1;J<Y;++J){z&&(z=!1,c=0);let e=d[J].x,b=d[J].y;var B=e-A;let a=b-D;var M=Math.sqrt(B*B+a*a);B/=M;a/=M;if(c+M>l){z=!0;var Q=(l-c)/M;M=l-c;e=(1-Q)*A+Q*e;b=(1-Q)*D+Q*b;--J}Q=this._writeVertex(A,D,0,0,B,a,a,-B,0,-1,c);A=this._writeVertex(A,D,0,0,B,a,-a,B,0,1,c);c+=M;M=this._writeVertex(e,b,0,0,B,a,a,-B,0,-1,c);B=this._writeVertex(e,b,0,0,B,a,-a,B,0,1,c);this._writeTriangle(Q,A,M);this._writeTriangle(A,M,B);A=e;D=b}}}_tessellate(d,c){var l=d[d.length-1];const z=fa(d[0],l);if(!(d.length<(z?3:2))){var A=
c.pixelCoordRatio,D=null!=c.capType?c.capType:r.CapType.BUTT,Y=null!=c.joinType?c.joinType:r.JoinType.MITER,B=null!=c.miterLimit?Math.min(c.miterLimit,4):2,M=null!=c.roundLimit?Math.min(c.roundLimit,1.05):1.05,Q=null!=c.halfWidth?c.halfWidth:2,J=!!c.textured,e=null,b=this._prevNormal,a=this._nextNormal,V=-1,R=-1,g=this._joinNormal,Z=this._textureNormalLeft,aa=this._textureNormalRight,w=this._textureNormal,p=-1,q=-1,da=c.wrapDistance||65535,m=c.initialDistance||0,ka=this._writeVertex,la=this._writeTriangle;
c=(C,N,O,W,S,T)=>{C=ka(x,y,t,u,O,W,C,N,S,T,m);0<=p&&0<=q&&0<=C&&la(p,q,C);p=q;return q=C};if(z){var P=d[d.length-2];a.x=l.x-P.x;a.y=l.y-P.y;R=ca(a);a.x/=R;a.y/=R}l=!1;for(let C=0;C<d.length;++C){l&&(l=!1,m=0);P&&(b.x=-a.x,b.y=-a.y,V=R,m+V>da&&(l=!0));l?(e=(da-m)/V,V=da-m,P={x:(1-e)*P.x+e*d[C].x,y:(1-e)*P.y+e*d[C].y},--C):P=d[C];var x=P.x;var y=P.y;var f=0>=C&&!l,n=C===d.length-1;f||(m+=V);(e=n?z?d[1]:null:d[C+1])?(a.x=e.x-x,a.y=e.y-y,R=ca(a),a.x/=R,a.y/=R):(a.x=void 0,a.y=void 0);if(!z){if(f){I(g,
a);var t=g.x;var u=g.y;D===r.CapType.SQUARE&&(c(-a.y-a.x,a.x-a.y,a.x,a.y,0,-1),c(a.y-a.x,-a.x-a.y,a.x,a.y,0,1));D===r.CapType.ROUND&&(c(-a.y-a.x,a.x-a.y,a.x,a.y,-1,-1),c(a.y-a.x,-a.x-a.y,a.x,a.y,-1,1));if(D===r.CapType.ROUND||D===r.CapType.BUTT)c(-a.y,a.x,a.x,a.y,0,-1),c(a.y,-a.x,a.x,a.y,0,1);continue}if(n){L(g,b);t=g.x;u=g.y;if(D===r.CapType.ROUND||D===r.CapType.BUTT)c(b.y,-b.x,-b.x,-b.y,0,-1),c(-b.y,b.x,-b.x,-b.y,0,1);D===r.CapType.SQUARE&&(c(b.y-b.x,-b.x-b.y,-b.x,-b.y,0,-1),c(-b.y-b.x,b.x-b.y,
-b.x,-b.y,0,1));D===r.CapType.ROUND&&(c(b.y-b.x,-b.x-b.y,-b.x,-b.y,1,-1),c(-b.y-b.x,b.x-b.y,-b.x,-b.y,1,1));continue}}var k=void 0;f=-(b.x*a.y-b.y*a.x);.01>Math.abs(f)?0<b.x*a.x+b.y*a.y?(g.x=b.x,g.y=b.y,f=1,k=Number.MAX_VALUE,e=!0):(I(g,a),k=f=1,e=!1):(g.x=(b.x+a.x)/f,g.y=(b.y+a.y)/f,k=ca(g),e=(k-1)*Q*A,e=4<k||e>V&&e>R);t=g.x;u=g.y;var h=Y;switch(Y){case r.JoinType.BEVEL:1.05>k&&(h=r.JoinType.MITER);break;case r.JoinType.ROUND:k<M&&(h=r.JoinType.MITER);break;case r.JoinType.MITER:k>B&&(h=r.JoinType.BEVEL)}switch(h){case r.JoinType.MITER:c(g.x,
g.y,-b.x,-b.y,0,-1);c(-g.x,-g.y,-b.x,-b.y,0,1);if(n)break;J&&(e=l?0:m,p=this._writeVertex(x,y,t,u,a.x,a.y,g.x,g.y,0,-1,e),q=this._writeVertex(x,y,t,u,a.x,a.y,-g.x,-g.y,0,1,e));break;case r.JoinType.BEVEL:f=0>f;var E=void 0;f?(h=p,p=q,q=h,E=Z,h=aa):(E=aa,h=Z);var F=void 0,K=void 0;e?(F=f?I(this._innerPrev,b):L(this._innerPrev,b),K=f?L(this._innerNext,a):I(this._innerNext,a)):F=K=f?ba(this._inner,g):ha(this._inner,g);k=f?L(this._bevelStart,b):I(this._bevelStart,b);c(F.x,F.y,-b.x,-b.y,E.x,E.y);F=c(k.x,
k.y,-b.x,-b.y,h.x,h.y);if(n)break;n=f?I(this._bevelEnd,a):L(this._bevelEnd,a);e?(e=this._writeVertex(x,y,t,u,-b.x,-b.y,0,0,0,0,m),p=this._writeVertex(x,y,t,u,a.x,a.y,K.x,K.y,E.x,E.y,m),q=this._writeVertex(x,y,t,u,a.x,a.y,n.x,n.y,h.x,h.y,m),this._writeTriangle(F,e,q)):(J?(e=this._bevelMiddle,e.x=(k.x+n.x)/2,e.y=(k.y+n.y)/2,U(w,e,-b.x,-b.y),c(e.x,e.y,-b.x,-b.y,w.x,w.y),U(w,e,a.x,a.y),p=this._writeVertex(x,y,t,u,a.x,a.y,e.x,e.y,w.x,w.y,m),q=this._writeVertex(x,y,t,u,a.x,a.y,K.x,K.y,E.x,E.y,m)):(e=p,
p=q,q=e),c(n.x,n.y,a.x,a.y,h.x,h.y));f&&(e=p,p=q,q=e);break;case r.JoinType.ROUND:f=0>f;var H=void 0;f?(h=p,p=q,q=h,h=Z,H=aa):(h=aa,H=Z);var v=f?ba(this._inner,g):ha(this._inner,g);e?(K=f?I(this._innerPrev,b):L(this._innerPrev,b),E=f?L(this._innerNext,a):I(this._innerNext,a)):E=K=v;F=f?L(this._roundStart,b):I(this._roundStart,b);var X=f?I(this._roundEnd,a):L(this._roundEnd,a);K=c(K.x,K.y,-b.x,-b.y,h.x,h.y);F=c(F.x,F.y,-b.x,-b.y,H.x,H.y);if(n)break;n=this._writeVertex(x,y,t,u,-b.x,-b.y,0,0,0,0,m);
e||this._writeTriangle(p,q,n);v=ba(this._outer,v);H=this._writeVertex(x,y,t,u,a.x,a.y,X.x,X.y,H.x,H.y,m);let N,O;if(X=2<k){var G=void 0;k!==Number.MAX_VALUE?(v.x/=k,v.y/=k,G=b.x*v.x+b.y*v.y,G=(k*(G*G-1)+1)/G):G=-1;N=f?L(this._startBreak,b):I(this._startBreak,b);N.x+=b.x*G;N.y+=b.y*G;O=f?I(this._endBreak,a):L(this._endBreak,a);O.x+=a.x*G;O.y+=a.y*G}U(w,v,-b.x,-b.y);k=this._writeVertex(x,y,t,u,-b.x,-b.y,v.x,v.y,w.x,w.y,m);U(w,v,a.x,a.y);v=J?this._writeVertex(x,y,t,u,a.x,a.y,v.x,v.y,w.x,w.y,m):k;G=n;
const W=J?this._writeVertex(x,y,t,u,a.x,a.y,0,0,0,0,m):n;let S=-1,T=-1;X&&(U(w,N,-b.x,-b.y),S=this._writeVertex(x,y,t,u,-b.x,-b.y,N.x,N.y,w.x,w.y,m),U(w,O,a.x,a.y),T=this._writeVertex(x,y,t,u,a.x,a.y,O.x,O.y,w.x,w.y,m));J?X?(this._writeTriangle(G,F,S),this._writeTriangle(G,S,k),this._writeTriangle(W,v,T),this._writeTriangle(W,T,H)):(this._writeTriangle(G,F,k),this._writeTriangle(W,v,H)):X?(this._writeTriangle(n,F,S),this._writeTriangle(n,S,T),this._writeTriangle(n,T,H)):(this._writeTriangle(n,F,k),
this._writeTriangle(n,v,H));e?p=this._writeVertex(x,y,t,u,a.x,a.y,E.x,E.y,h.x,h.y,m):(p=J?this._writeVertex(x,y,t,u,a.x,a.y,E.x,E.y,h.x,h.y,m):K,this._writeTriangle(p,W,H));q=H;f&&(e=p,p=q,q=e)}}}}}ea.LineTessellation=ja;Object.defineProperty(ea,Symbol.toStringTag,{value:"Module"})});