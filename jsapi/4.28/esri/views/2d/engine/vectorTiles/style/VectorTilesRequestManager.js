// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../../../../request ../../../../../core/lang ../../../../../core/MapUtils ../../../../../core/promiseUtils ../../../../../core/urlUtils".split(" "),function(g,m,n,p,h,k){function q(a,b){return p.getOrCreateMapValue(e,a,()=>new r(a)).getData(b).then(c=>{e.delete(a);return c}).catch(c=>{e.delete(a);throw c;})}class r{constructor(a){this._tileUrl=a;this._abortController=this._promise=null;this._abortOptions=[]}getData(a){null===this._promise&&(this._abortController=new AbortController,
this._promise=this._makeRequest(this._tileUrl,this._abortController.signal));const b=this._abortOptions;b.push(a);h.onAbort(a,()=>{b.every(c=>h.isAborted(c))&&this._abortController.abort()});return this._promise.then(c=>n.clone(c))}async _makeRequest(a,b){({data:a}=await m(a,{responseType:"array-buffer",signal:b}));return a}}const e=new Map;g.request=function(a,b,c,l,t){a=k.urlToObject(a);const d=a.query;if(d)for(const [f,u]of Object.entries(d))switch(u){case "{x}":d[f]=l.toString();break;case "{y}":d[f]=
c.toString();break;case "{z}":d[f]=b.toString()}b=k.addQueryParameters(a.path.replaceAll(/\{z\}/gi,b.toString()).replaceAll(/\{y\}/gi,c.toString()).replaceAll(/\{x\}/gi,l.toString()),{...a.query});return q(b,t)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});