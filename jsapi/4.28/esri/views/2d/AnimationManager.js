// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/Accessor ../../core/maybe ../../core/scheduling ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../ViewAnimation ./unitBezier ./viewpointUtils ../../geometry/Point".split(" "),function(f,e,n,p,q,r,g,x,y,z,t,l,k,u,v){class w{constructor(a,b,c,d){const h=a.targetGeometry,m=b.targetGeometry;d?"string"===typeof d&&
(d=k.parse(d)||k.easingFunctions.ease):d=k.easingFunctions.ease;this.easing=d;this.duration=c;this.sCenterX=h.x;this.sCenterY=h.y;this.sScale=a.scale;this.sRotation=a.rotation;this.tCenterX=m.x;this.tCenterY=m.y;this.tScale=b.scale;this.tRotation=b.rotation;this.dCenterX=this.tCenterX-this.sCenterX;this.dCenterY=this.tCenterY-this.sCenterY;this.dScale=this.tScale-this.sScale;this.dRotation=this.tRotation-this.sRotation;180<this.dRotation?this.dRotation-=360:-180>this.dRotation&&(this.dRotation+=360)}applyRatio(a,
b){var c=this.easing(b);let d,h;1<=b?(b=this.tCenterX,d=this.tCenterY,h=this.tRotation,c=this.tScale):(b=this.sCenterX+c*this.dCenterX,d=this.sCenterY+c*this.dCenterY,h=this.sRotation+c*this.dRotation,c=this.sScale+c*this.dScale);a.targetGeometry.x=b;a.targetGeometry.y=d;a.scale=c;a.rotation=h}}e=class extends p{constructor(a){super(a);this.animation=this.updateFunction=null;this.duration=200;this.transition=null;this.easing=k.easingFunctions.ease;this.view=null;this.viewpoint=new n({targetGeometry:new v,
scale:0,rotation:0});this._updateTask=r.addFrameTask({postRender:this._postRender.bind(this)});this._updateTask.pause()}destroy(){this._updateTask=q.removeMaybe(this._updateTask)}animate(a,b,c){this.stop();u.copy(this.viewpoint,b);this.transition=new w(this.viewpoint,a.target,c?.duration||this.duration,c?.easing||this.easing);b=()=>{this.animation===a&&this._updateTask&&("finished"===a.state&&(this.transition?.applyRatio(this.viewpoint,1),this.view?.state&&(this.view.state.viewpoint=this.viewpoint.clone())),
this.updateFunction=this.animation=null)};a.when(b,b);this._startTime=performance.now();this._updateTask.resume();return this.animation=a}animateContinous(a,b){this.stop();this.updateFunction=b;this.viewpoint=a;const c=new l({target:a.clone()});a=()=>{this.animation===c&&this._updateTask&&(this.updateFunction=this.animation=null)};c.when(a,a);this._startTime=performance.now();this._updateTask.resume();return this.animation=c}stop(){this.animation&&(this.animation.stop(),this.updateFunction=this.animation=
null)}_postRender(a){var b=this.animation;if(b&&b.state!==l.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,a.deltaTime);else{a=this.transition;b=(performance.now()-this._startTime)/a.duration;const c=1<=b;a.applyRatio(this.viewpoint,b);c&&this.animation?.finish()}this.view?.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};f.__decorate([g.property()],e.prototype,"animation",void 0);f.__decorate([g.property()],e.prototype,"duration",
void 0);f.__decorate([g.property()],e.prototype,"transition",void 0);f.__decorate([g.property()],e.prototype,"easing",void 0);f.__decorate([g.property()],e.prototype,"view",void 0);f.__decorate([g.property()],e.prototype,"viewpoint",void 0);return e=f.__decorate([t.subclass("esri.views.2d.AnimationManager")],e)});