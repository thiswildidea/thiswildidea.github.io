// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/projection/projectBoundingRect":function(){define(["exports","../../chunks/vec3f64","./projectBuffer","../support/aaBoundingRect","../support/spatialReferenceUtils"],function(a,b,g,d,k){const m=b.create();a.projectBoundingRect=function(f,c,l,e){if(null==f)return!1;if(k.equals(c,e))return d.copy(l,f),!0;m[0]=f[0];m[1]=f[1];m[2]=0;if(!g.projectBuffer(m,c,0,m,e,0,1))return!1;l[0]=m[0];l[1]=m[1];m[0]=f[2];m[1]=f[3];m[2]=0;if(!g.projectBuffer(m,c,0,m,e,0,1))return!1;l[2]=
m[0];l[3]=m[1];return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../chunks/vec3f64","./projectBuffer"],function(a,b,g){const d=b.create();a.projectPointToVector=function(k,m,f,c=0){d[0]=k.x;d[1]=k.y;const l=k.z;d[2]=void 0!==l?l:c;return g.projectBuffer(d,k.spatialReference,0,m,f,0,1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports",
"../../chunks/vec3f64","./projectBuffer"],function(a,b,g){const d=b.create();a.projectVectorToVector=function(k,m,f,c){if(null==m||null==c||2>k.length)return!1;2===k.length&&(d[0]=k[0],d[1]=k[1],d[2]=0,k=d);return g.projectBuffer(k,m,0,f,c,0,1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(aa=ca){return{plane:h.create(aa.plane),origin:l.clone(aa.origin),basis1:l.clone(aa.basis1),basis2:l.clone(aa.basis2)}}function q(aa,da,ma){const ua=na.get();ua.origin=aa;ua.basis1=da;ua.basis2=ma;ua.plane=h.wrap(0,0,0,0);y(ua);return ua}function t(aa,da=n()){return r(aa.origin,aa.basis1,aa.basis2,da)}function v(aa,da){c.copy(da.origin,aa.origin);c.copy(da.basis1,aa.basis1);c.copy(da.basis2,aa.basis2);h.copy(da.plane,aa.plane)}function r(aa,da,ma,
ua=n()){c.copy(ua.origin,aa);c.copy(ua.basis1,da);c.copy(ua.basis2,ma);y(ua);1E-6<Math.abs(c.dot(ua.basis1,ua.basis2)/(c.length(ua.basis1)*c.length(ua.basis2)))&&S.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(c.dot(ua.basis1,P(ua)))&&S.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-c.dot(P(ua),ua.origin)-ua.plane[3])&&S.warn("fromValues()","Plane offset is not consistent with plane origin");return ua}function y(aa){h.fromVectorsAndPoint(aa.basis2,
aa.basis1,aa.origin,aa.plane)}function z(aa,da,ma){aa!==ma&&t(aa,ma);aa=c.scale(x.sv3d.get(),P(aa),da);c.add(ma.origin,ma.origin,aa);ma.plane[3]-=da;return ma}function D(aa,da,ma){C(da,ma);z(ma,T(aa,aa.origin),ma);return ma}function C(aa,da=n()){const ma=(aa[2]-aa[0])/2,ua=(aa[3]-aa[1])/2;c.set(da.origin,aa[0]+ma,aa[1]+ua,0);c.set(da.basis1,ma,0,0);c.set(da.basis2,0,ua,0);h.fromValues(0,0,1,0,da.plane);return da}function E(aa,da,ma){return h.intersectRay(aa.plane,da,ma)?R(aa,ma):!1}function A(aa,
da,ma){if(E(aa,da,ma))return ma;aa=F(aa,da,x.sv3d.get());c.add(ma,da.origin,c.scale(x.sv3d.get(),da.direction,c.distance(da.origin,aa)/c.length(da.direction)));return ma}function F(aa,da,ma){const ua=ba.get();var sa=ba.get();V(aa,da,ua,sa);sa=Number.POSITIVE_INFINITY;for(const Aa of Y){var ra=N(aa,Aa,ia.get());const qa=x.sv3d.get();h.intersectLineSegment(ua,ra,qa)&&(ra=c.direction(x.sv3d.get(),da.origin,qa),ra=Math.abs(d.acosClamped(c.dot(da.direction,ra))),ra<sa&&(sa=ra,c.copy(ma,qa)))}return sa===
Number.POSITIVE_INFINITY?G(aa,da,ma):ma}function G(aa,da,ma){if(E(aa,da,ma))return ma;const ua=ba.get(),sa=ba.get();V(aa,da,ua,sa);let ra=Number.POSITIVE_INFINITY;for(const qa of Y){var Aa=N(aa,qa,ia.get());const la=x.sv3d.get();h.intersectLineSegmentClamp(ua,Aa,la)&&(Aa=u.distance2(da,la),h.isPointInside(sa,la)&&Aa<ra&&(ra=Aa,c.copy(ma,la)))}B(aa,da.origin)<ra&&I(aa,da.origin,ma);return ma}function I(aa,da,ma){var ua=h.projectPoint(aa.plane,da,x.sv3d.get());da=p.projectPointClamp(W(aa,aa.basis1),
ua,-1,1,x.sv3d.get());ua=p.projectPointClamp(W(aa,aa.basis2),ua,-1,1,x.sv3d.get());c.subtract(ma,c.add(x.sv3d.get(),da,ua),aa.origin);return ma}function H(aa,da,ma){const {origin:ua,basis1:sa,basis2:ra}=aa,Aa=c.subtract(x.sv3d.get(),da,ua);da=w.projectPointSignedLength(sa,Aa);const qa=w.projectPointSignedLength(ra,Aa);aa=w.projectPointSignedLength(P(aa),Aa);return c.set(ma,da,qa,aa)}function B(aa,da){da=H(aa,da,x.sv3d.get());const {basis1:ma,basis2:ua}=aa;aa=c.length(ma);var sa=c.length(ua);aa=Math.max(Math.abs(da[0])-
aa,0);sa=Math.max(Math.abs(da[1])-sa,0);da=da[2];return aa*aa+sa*sa+da*da}function K(aa,da){return Math.sqrt(B(aa,da))}function L(aa,da){let ma=Number.NEGATIVE_INFINITY;for(const sa of Y){var ua=N(aa,sa,ia.get());ua=p.distance2(ua,da);ua>ma&&(ma=ua)}return Math.sqrt(ma)}function J(aa,da){return h.isPointInside(aa.plane,da)&&R(aa,da)}function M(aa,da,ma,ua){switch(ma){case e.Axis.X:c.copy(ua,aa.basis1);c.normalize(ua,ua);break;case e.Axis.Y:c.copy(ua,aa.basis2);c.normalize(ua,ua);break;case e.Axis.Z:c.copy(ua,
P(aa))}return ua}function T(aa,da){const ma=-aa.plane[3];return w.projectPointSignedLength(P(aa),da)-ma}function Q(aa,da,ma,ua){const sa=T(aa,da);aa=c.scale(ka,P(aa),ma-sa);c.add(ua,da,aa);return ua}function O(aa,da){return c.exactEquals(aa.basis1,da.basis1)&&c.exactEquals(aa.basis2,da.basis2)&&c.exactEquals(aa.origin,da.origin)}function U(aa,da,ma){aa!==ma&&t(aa,ma);m.invert(ea,da);m.transpose(ea,ea);c.transformMat4(ma.basis1,aa.basis1,ea);c.transformMat4(ma.basis2,aa.basis2,ea);c.transformMat4(h.normal(ma.plane),
h.normal(aa.plane),ea);c.transformMat4(ma.origin,aa.origin,da);h.setOffsetFromPoint(ma.plane,ma.plane,ma.origin);return ma}function Z(aa,da,ma,ua){aa!==ua&&t(aa,ua);m.fromRotation(fa,da,ma);c.transformMat4(ua.basis1,aa.basis1,fa);c.transformMat4(ua.basis2,aa.basis2,fa);y(ua);return ua}function P(aa){return h.normal(aa.plane)}function R(aa,da){const ma=c.subtract(x.sv3d.get(),da,aa.origin);da=c.squaredLength(aa.basis1);const ua=c.squaredLength(aa.basis2),sa=c.dot(aa.basis1,ma);aa=c.dot(aa.basis2,ma);
return 0>-sa-da&&0>sa-da&&0>-aa-ua&&0>aa-ua}function W(aa,da){const ma=ia.get();c.copy(ma.origin,aa.origin);c.copy(ma.vector,da);return ma}function N(aa,da,ma){const {basis1:ua,basis2:sa,origin:ra}=aa;aa=c.scale(x.sv3d.get(),ua,da.origin[0]);const Aa=c.scale(x.sv3d.get(),sa,da.origin[1]);c.add(ma.origin,aa,Aa);c.add(ma.origin,ma.origin,ra);aa=c.scale(x.sv3d.get(),ua,da.direction[0]);da=c.scale(x.sv3d.get(),sa,da.direction[1]);c.scale(ma.vector,c.add(aa,aa,da),2);return ma}function V(aa,da,ma,ua){aa=
P(aa);h.fromVectorsAndPoint(aa,da.direction,da.origin,ma);h.fromVectorsAndPoint(h.normal(ma),aa,da.origin,ua)}const S=g.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class X{constructor(){this.plane=h.create();this.origin=l.create();this.basis1=l.create();this.basis2=l.create()}}b=X;const ca={plane:h.create(),origin:l.fromValues(0,0,0),basis1:l.fromValues(1,0,0),basis2:l.fromValues(0,1,0)},ba=new k.ObjectStack(h.create),ia=new k.ObjectStack(p.create),ka=l.create(),na=new k.ObjectStack(()=>
n()),Y=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ea=f.create(),fa=f.create();k=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:b,altitudeAt:T,axisAt:M,closestPoint:G,closestPointOnSilhouette:F,copy:t,copyWithoutVerify:v,create:n,distance:K,distance2:B,distanceToSilhouette:L,elevate:z,equals:O,extrusionContainsPoint:J,fromAABoundingRect:C,fromValues:r,intersectRay:E,intersectRayClosestSilhouette:A,
normal:P,projectPoint:I,projectPointLocal:H,rotate:Z,setAltitudeAt:Q,setExtent:D,transform:U,up:ca,updateUnboundedPlane:y,wrap:q},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=b;a.altitudeAt=T;a.axisAt=M;a.boundedPlane=k;a.closestPoint=G;a.closestPointOnSilhouette=F;a.copy=t;a.copyWithoutVerify=v;a.create=n;a.distance=K;a.distance2=B;a.distanceToSilhouette=L;a.elevate=z;a.equals=O;a.extrusionContainsPoint=J;a.fromAABoundingRect=C;a.fromValues=r;a.intersectRay=E;a.intersectRayClosestSilhouette=
A;a.normal=P;a.projectPoint=I;a.projectPointLocal=H;a.rotate=Z;a.setAltitudeAt=Q;a.setExtent=D;a.transform=U;a.up=ca;a.updateUnboundedPlane=y;a.wrap=q})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(a,b){class g{constructor(d){this._allocator=d;this._items=[];this._itemsPtr=0;this._grow()}get(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]}_reset(){this._items.length=Math.min(Math.min(3*
Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0}_grow(){for(let d=0;d<Math.max(8,Math.min(this._items.length,1024));d++)this._items.push(this._allocator())}}a.ObjectStack=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,g,d,k,m){function f(x){return x?{origin:k.clone(x.origin),
vector:k.clone(x.vector)}:{origin:k.create(),vector:k.create()}}function c(x,n){const q=w.get();q.origin=x;q.vector=n;return q}function l(x,n,q=f()){d.copy(q.origin,x);d.copy(q.vector,n);return q}function e(x,n){n=d.subtract(m.sv3d.get(),n,x.origin);var q=d.dot(x.vector,n);const t=d.dot(x.vector,x.vector);q=b.clamp(q/t,0,1);x=d.subtract(m.sv3d.get(),d.scale(m.sv3d.get(),x.vector,q),n);return d.dot(x,x)}function p(x,n,q,t,v){const {vector:r,origin:y}=x;n=d.subtract(m.sv3d.get(),n,y);n=d.dot(r,n)/d.squaredLength(r);
d.scale(v,r,b.clamp(n,q,t));return d.add(v,v,x.origin)}function h(x,n,q,t){const v=x.origin;var r=d.add(m.sv3d.get(),v,x.vector);x=n.origin;var y=d.add(m.sv3d.get(),x,n.vector),z=m.sv3d.get();n=m.sv3d.get();z[0]=v[0]-x[0];z[1]=v[1]-x[1];z[2]=v[2]-x[2];n[0]=y[0]-x[0];n[1]=y[1]-x[1];n[2]=y[2]-x[2];if(1E-6>Math.abs(n[0])&&1E-6>Math.abs(n[1])&&1E-6>Math.abs(n[2]))return!1;y=m.sv3d.get();y[0]=r[0]-v[0];y[1]=r[1]-v[1];y[2]=r[2]-v[2];if(1E-6>Math.abs(y[0])&&1E-6>Math.abs(y[1])&&1E-6>Math.abs(y[2]))return!1;
r=z[0]*n[0]+z[1]*n[1]+z[2]*n[2];var D=n[0]*y[0]+n[1]*y[1]+n[2]*y[2];const C=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],E=(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])*C-D*D;if(1E-6>Math.abs(E))return!1;z=(r*D-(z[0]*y[0]+z[1]*y[1]+z[2]*y[2])*C)/E;r=(r+D*z)/C;q&&(z=b.clamp(z,0,1),r=b.clamp(r,0,1));q=m.sv3d.get();D=m.sv3d.get();q[0]=v[0]+z*y[0];q[1]=v[1]+z*y[1];q[2]=v[2]+z*y[2];D[0]=x[0]+r*n[0];D[1]=x[1]+r*n[1];D[2]=x[2]+r*n[2];t.tA=z;t.tB=r;t.pA=q;t.pB=D;t.distance2=d.squaredDistance(q,D);return!0}const u={tA:0,tB:0,pA:k.create(),
pB:k.create(),distance2:0},w=new g.ObjectStack(()=>f());a.closestLineSegmentDistance2=function(x,n){return h(x,n,!0,u)?u.distance2:null};a.closestLineSegmentPoint=function(x,n,q){return h(x,n,!0,u)?(d.copy(q,u.pA),!0):!1};a.closestRayDistance2=function(x,n){if(h(x,c(n.origin,n.direction),!1,u)){const {tA:q,pB:t,distance2:v}=u;if(0<=q&&1>=q)return v;if(0>q)return d.squaredDistance(x.origin,t);if(1<q)return d.squaredDistance(d.add(m.sv3d.get(),x.origin,x.vector),t)}return null};a.copy=function(x,n=
f()){return l(x.origin,x.vector,n)};a.create=f;a.distance=function(x,n){return Math.sqrt(e(x,n))};a.distance2=e;a.fromPoints=function(x,n,q=f()){d.copy(q.origin,x);d.subtract(q.vector,n,x);return q};a.fromValues=l;a.pointAt=function(x,n,q){return d.add(q,x.origin,d.scale(q,x.vector,n))};a.projectPoint=function(x,n,q){return p(x,n,0,1,q)};a.projectPointClamp=p;a.wrap=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports",
"../../core/VectorStack"],function(a,b){const g=b.VectorStack.createVec2f64(),d=b.VectorStack.createVec3f64(),k=b.VectorStack.createVec4f64(),m=b.VectorStack.createMat3f64(),f=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=m;a.sm4d=f;a.sq4d=b;a.sv2d=g;a.sv3d=d;a.sv4d=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define("exports ./ByteSizeUnit ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(a,b,g,d,k,m,f,c,l){class e{constructor(h,u,w){this._itemByteSize=h;this._itemCreate=u;this._buffers=[];this._items=[];this._itemsPtr=0;this._itemsPerBuffer=Math.ceil(w/this._itemByteSize)}get(){0===this._itemsPtr&&g.nextTick(()=>this._reset());const h=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=h;){const u=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let w=0;w<this._itemsPerBuffer;++w)this._items.push(this._itemCreate(u,w*this._itemByteSize));
this._buffers.push(u)}return this._items[this._itemsPtr++]}_reset(){const h=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>h;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(h=p){return new e(16,f.createView,h)}static createVec3f64(h=p){return new e(24,c.createView,h)}static createVec4f64(h=p){return new e(32,l.createView,h)}static createMat3f64(h=p){return new e(72,d.createView,h)}static createMat4f64(h=
p){return new e(128,k.createView,h)}static createQuatf64(h=p){return new e(32,m.createView,h)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const p=4*b.ByteSizeUnit.KILOBYTES;a.VectorStack=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/ByteSizeUnit":function(){define(["exports"],function(a){a.ByteSizeUnit=void 0;var b=a.ByteSizeUnit||(a.ByteSizeUnit={});b[b.KILOBYTES=1024]="KILOBYTES";b[b.MEGABYTES=1048576]="MEGABYTES";b[b.GIGABYTES=
1073741824]="GIGABYTES";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function g(f){return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8]]}function d(f,c,l,e,p,h,u,w,x){return[f,c,l,e,p,h,u,w,x]}function k(f,c){return new Float64Array(f,c,9)}const m=Object.freeze(Object.defineProperty({__proto__:null,clone:g,create:b,createView:k,fromValues:d},Symbol.toStringTag,{value:"Module"}));
a.clone=g;a.create=b;a.createView=k;a.fromValues=d;a.mat3f64=m})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function b(){return[0,0,0,1]}function g(c){return[c[0],c[1],c[2],c[3]]}function d(c,l,e,p){return[c,l,e,p]}function k(c,l){return new Float64Array(c,l,4)}const m=b(),f=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:g,create:b,createView:k,fromValues:d},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=m;a.clone=g;a.create=b;a.createView=k;a.fromValues=
d;a.quatf64=f})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function g(n){return[n[0],n[1]]}function d(n,q){return[n,q]}function k(n,q=[0,0]){const t=Math.min(2,n.length);for(let v=0;v<t;++v)q[v]=n[v];return q}function m(n,q){return new Float64Array(n,q,2)}function f(){return[0,0]}function c(){return[1,1]}function l(){return[1,0]}function e(){return[0,1]}const p=[0,0],h=[1,1],u=[1,0],w=[0,1],x=Object.freeze(Object.defineProperty({__proto__:null,ONES:h,
UNIT_X:u,UNIT_Y:w,ZEROS:p,clone:g,create:b,createView:m,fromArray:k,fromValues:d,ones:c,unitX:l,unitY:e,zeros:f},Symbol.toStringTag,{value:"Module"}));a.ONES=h;a.UNIT_X=u;a.UNIT_Y=w;a.ZEROS=p;a.clone=g;a.create=b;a.createView=m;a.fromArray=k;a.fromValues=d;a.ones=c;a.unitX=l;a.unitY=e;a.vec2f64=x;a.zeros=f})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/common ../../chunks/sphere ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(B=F){return[B[0],B[1],B[2],B[3]]}function h(B,K){return u(K[0],K[1],K[2],K[3],B)}function u(B,K,L,J,M=p()){M[0]=B;M[1]=K;M[2]=L;M[3]=J;return M}function w(B,K,L){var J=K[0]*K[0]+K[1]*K[1]+K[2]*K[2];J=1E-5<Math.abs(J-1)&&1E-12<J?1/Math.sqrt(J):1;L[0]=K[0]*J;L[1]=K[1]*J;L[2]=K[2]*J;L[3]=-(L[0]*B[0]+L[1]*B[1]+L[2]*B[2]);return L}function x(B,K,L,J=p()){var M=L[0]-K[0],T=L[1]-K[1],Q=L[2]-K[2];L=B[0]-K[0];const O=B[1]-K[1],U=B[2]-K[2];K=T*U-Q*O;Q=Q*L-M*U;M=M*O-
T*L;T=K*K+Q*Q+M*M;T=1E-5<Math.abs(T-1)&&1E-12<T?1/Math.sqrt(T):1;J[0]=K*T;J[1]=Q*T;J[2]=M*T;J[3]=-(J[0]*B[0]+J[1]*B[1]+J[2]*B[2]);return J}function n(B,K,L,J=0,M=Math.floor(1/3*L),T=Math.floor(2/3*L)){if(3>L)return!1;K(y,J);let Q=M,O=!1;for(;Q<L-1&&!O;)K(z,Q),Q++,O=!g.exactEquals(y,z);if(!O)return!1;Q=Math.max(Q,T);for(O=!1;Q<L&&!O;)K(D,Q),Q++,g.subtract(C,y,z),g.normalize(C,C),g.subtract(E,z,D),g.normalize(E,E),O=!g.exactEquals(y,D)&&!g.exactEquals(z,D)&&.99619469809>Math.abs(g.dot(C,E));if(!O)return 0===
J&&1===M&&2===T?!1:n(B,K,L,0,1,2);x(y,z,D,B);return!0}function q(B,K,L){B=g.scale(l.sv3d.get(),B,g.dot(B,K));g.subtract(L,K,B);return L}function t(B,K){return g.dot(B,K)+B[3]}function v(B,K,L,J,M){const T=g.dot(B,L);if(0===T)return!1;B=-(g.dot(B,K)+B[3])/T;J&G.CLAMP&&(B=b.clamp(B,0,1));if(!(J&G.INFINITE_MIN)&&0>B||!(J&G.INFINITE_MAX)&&1<B)return!1;g.add(M,K,g.scale(M,L,B));return!0}const r=k.exactEquals;k=k.equals;const y=d.create(),z=d.create(),D=d.create(),C=d.create(),E=d.create(),A=(()=>{const B=
d.create();return(K,L,J)=>{g.cross(B,K,L);if(g.squaredLength(B)<m.getEpsilon())return!1;g.normalize(B,B);const [M,T,Q]=B,O=J.origin,U=Math.abs(M),Z=Math.abs(T),P=Math.abs(Q),[R,W,N]=K,[V,S,X]=L;K=K[3];L=L[3];U>Z&&U>P?(O[1]=(L*N-K*X)/M,O[2]=(K*S-L*W)/M):Z>P?(O[0]=(K*X-L*N)/T,O[2]=(L*R-K*V)/T):(O[0]=(L*W-K*S)/Q,O[1]=(K*V-L*R)/Q);g.copy(J.direction,B);return!0}})(),F=[0,0,1,0];var G;(function(B){B[B.NONE=0]="NONE";B[B.CLAMP=1]="CLAMP";B[B.INFINITE_MIN=4]="INFINITE_MIN";B[B.INFINITE_MAX=8]="INFINITE_MAX"})(G||
(G={}));const I=G.INFINITE_MIN|G.INFINITE_MAX,H=G.INFINITE_MAX;a.clip=function(B,K){const L=g.dot(B,K.ray.direction);B=-t(B,K.ray.origin);if(0>B&&0<=L)return!1;if(-1E-6<L&&1E-6>L)return 0<B;if((0>B||0>L)&&!(0>B&&0>L))return!0;B/=L;0<L?B<K.c1&&(K.c1=B):B>K.c0&&(K.c0=B);return K.c0<=K.c1};a.clipInfinite=function(B,K){const L=g.dot(B,K.ray.direction);B=-t(B,K.ray.origin);if(-1E-6<L&&1E-6>L)return 0<B;B/=L;0<L?B<K.c1&&(K.c1=B):B>K.c0&&(K.c0=B);return K.c0<=K.c1};a.copy=h;a.create=p;a.distance=function(B,
K){return Math.abs(t(B,K))};a.equals=k;a.exactEquals=r;a.fromArray=function(B,K,L=!0){const J=K.length/3;return n(B,(M,T)=>g.set(M,K[3*T],K[3*T+1],K[3*T+2]),L?J-1:J)};a.fromManyPoints=n;a.fromNormalAndOffset=function(B,K,L){g.copy(L,B);L[3]=K;return L};a.fromPoints=x;a.fromPositionAndNormal=w;a.fromValues=u;a.fromVectorsAndPoint=function(B,K,L,J){g.cross(D,K,B);return w(L,D,J)};a.intersectLine=function(B,K,L,J){L=g.subtract(l.sv3d.get(),L,K);return v(B,K,L,I,J)};a.intersectLineSegment=function(B,
K,L){return v(B,K.origin,K.vector,G.NONE,L)};a.intersectLineSegmentClamp=function(B,K,L){return v(B,K.origin,K.vector,G.CLAMP,L)};a.intersectPlanes=A;a.intersectRay=function(B,K,L){return null!=K?v(B,K.origin,K.direction,H,L):!1};a.isPointInside=function(B,K){return 0<=t(B,K)};a.isPointOutside=function(B,K){return 0>t(B,K)};a.isSphereFullyInside=function(B,K){return 0<=t(B,f.getCenter(K))-K[3]};a.isSphereFullyOutside=function(B,K){return 0>t(B,f.getCenter(K))+K[3]};a.isVertical=function(B){return Math.abs(B[2])<
m.getEpsilon()};a.negate=function(B,K){K[0]=-B[0];K[1]=-B[1];K[2]=-B[2];K[3]=-B[3];return K};a.normal=function(B){return B};a.projectPoint=function(B,K,L){const J=g.scale(l.sv3d.get(),B,-B[3]);K=g.subtract(l.sv3d.get(),K,J);B=q(B,K,l.sv3d.get());g.add(L,B,J);return L};a.projectPointLocal=function(B,K,L,J){var M=l.sv3d.get(),T=l.sv3d.get();e.tangentFrame(B,M,T);K=g.subtract(l.sv3d.get(),L,K);M=c.projectPointSignedLength(M,K);T=c.projectPointSignedLength(T,K);B=c.projectPointSignedLength(B,K);return g.set(J,
M,T,B)};a.projectVector=q;a.setOffsetFromPoint=function(B,K,L){K!==B&&h(B,K);B[3]=-g.dot(B,L);return B};a.signedDistance=t;a.up=F;a.wrap=function(B=F[0],K=F[1],L=F[2],J=F[3]){return u(B,K,L,J,l.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ./common ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(){return l.create()}function n(ba,ia=x()){return c.copy(ia,ba)}function q(ba,ia){return l.fromValues(ba[0],ba[1],ba[2],ia)}function t(ba){return ba}function v(ba){ba[0]=ba[1]=ba[2]=ba[3]=0}function r(ba,ia){ba[0]=ba[1]=ba[2]=0;ba[3]=ia;return ba}function y(ba){return ba[3]}function z(ba){return ba}function D(ba,ia,ka,na){return l.fromValues(ba,ia,ka,na)}function C(ba,ia,ka){ba!==ka&&m.copy(ka,ba);ka[3]=ba[3]+ia;return ka}function E(ba,ia,ka){g.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported");
return ba===ka?ka:n(ba,ka)}function A(ba,ia,ka){if(null==ia||!G(ba,ia,W))return!1;let {t0:na,t1:Y}=W;if(0>na||Y<na&&0<Y)na=Y;if(0>na)return!1;if(ka){const {origin:ea,direction:fa}=ia;ka[0]=ea[0]+fa[0]*na;ka[1]=ea[1]+fa[1]*na;ka[2]=ea[2]+fa[2]*na}return!0}function F(ba,ia,ka){ia=h.fromPoints(ia,ka);if(!G(ba,ia,W))return[];const {origin:na,direction:Y}=ia,{t0:ea,t1:fa}=W;ia=aa=>{const da=f.create();m.scaleAndAdd(da,na,Y,aa);return L(ba,da,da)};return Math.abs(ea-fa)<e.getEpsilon()?[ia(ea)]:[ia(ea),
ia(fa)]}function G(ba,ia,ka){const {origin:na,direction:Y}=ia,ea=N;ea[0]=na[0]-ba[0];ea[1]=na[1]-ba[1];ea[2]=na[2]-ba[2];ia=Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2];if(0===ia)return!1;const fa=2*(Y[0]*ea[0]+Y[1]*ea[1]+Y[2]*ea[2]);ba=fa*fa-4*ia*(ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2]-ba[3]*ba[3]);if(0>ba)return!1;ba=Math.sqrt(ba);ka.t0=(-fa-ba)/(2*ia);ka.t1=(-fa+ba)/(2*ia);return!0}function I(ba,ia){return A(ba,ia,null)}function H(ba,ia,ka){if(A(ba,ia,ka))return ka;ba=B(ba,ia,w.sv3d.get());m.add(ka,ia.origin,m.scale(w.sv3d.get(),
ia.direction,m.distance(ia.origin,ba)/m.length(ia.direction)));return ka}function B(ba,ia,ka){const na=w.sv3d.get(),Y=w.sm4d.get();m.cross(na,ia.origin,ia.direction);const ea=ba[3];m.cross(ka,na,ia.origin);m.scale(ka,ka,1/m.length(ka)*ea);ba=M(ba,ia.origin);ia=u.angle(ia.origin,ka);k.fromRotation(Y,ia+ba,na);m.transformMat4(ka,ka,Y);return ka}function K(ba,ia,ka){if(A(ba,ia,ka))return ka;h.closestPoint(ia,ba,ka);return L(ba,ka,ka)}function L(ba,ia,ka){ia=m.subtract(w.sv3d.get(),ia,ba);ia=m.scale(w.sv3d.get(),
ia,ba[3]/m.length(ia));return m.add(ka,ia,ba)}function J(ba,ia){ia=m.subtract(w.sv3d.get(),ia,ba);ia=m.squaredLength(ia);return Math.sqrt(Math.abs(ia-ba[3]*ba[3]))}function M(ba,ia){ia=m.subtract(w.sv3d.get(),ia,ba);ia=m.length(ia);ba=ba[3];return d.acosClamped(ba/(ba+Math.abs(ba-ia)))}function T(ba,ia,ka,na){ba=m.subtract(V,ia,ba);switch(ka){case p.Axis.X:return ka=d.cartesianToSpherical(ba,V)[2],m.set(na,-Math.sin(ka),Math.cos(ka),0);case p.Axis.Y:return ba=d.cartesianToSpherical(ba,V),ka=ba[1],
ba=ba[2],ia=Math.sin(ka),m.set(na,-ia*Math.cos(ba),-ia*Math.sin(ba),Math.cos(ka));case p.Axis.Z:return m.normalize(na,ba)}}function Q(ba,ia){ia=m.subtract(S,ia,ba);return m.length(ia)-ba[3]}function O(ba,ia,ka,na){const Y=Q(ba,ia);ba=T(ba,ia,p.Axis.Z,S);ka=m.scale(S,ba,ka-Y);return m.add(na,ia,ka)}function U(ba,ia){ia=m.squaredDistance(ba,ia);ba=ba[3];return ia<=ba*ba}function Z(ba,ia,ka=x()){const na=m.distance(ba,ia),Y=ba[3],ea=ia[3];if(na+ea<Y)return c.copy(ka,ba),ka;if(na+Y<ea)return c.copy(ka,
ia),ka;m.lerp(ka,ba,ia,(na+ea-Y)/(2*na));ka[3]=(na+Y+ea)/2;return ka}b=x();const P=c.equals,R=c.equals,W={t0:0,t1:0},N=f.create(),V=f.create(),S=f.create(),X=x(),ca=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:b,altitudeAt:Q,angleToSilhouette:M,axisAt:T,clear:v,closestPoint:K,closestPointOnSilhouette:B,containsPoint:U,copy:n,create:x,distanceToSilhouette:J,elevate:C,equals:R,exactEquals:P,fromCenterAndRadius:q,fromRadius:r,fromValues:D,getCenter:z,getRadius:y,intersectLine:F,intersectRay:A,
intersectRayClosestSilhouette:H,intersectsRay:I,projectPoint:L,setAltitudeAt:O,setExtent:E,tmpSphere:X,union:Z,wrap:t},Symbol.toStringTag,{value:"Module"}));a.NullSphere=b;a.altitudeAt=Q;a.angleToSilhouette=M;a.axisAt=T;a.clear=v;a.closestPoint=K;a.closestPointOnSilhouette=B;a.containsPoint=U;a.copy=n;a.create=x;a.distanceToSilhouette=J;a.elevate=C;a.equals=R;a.exactEquals=P;a.fromCenterAndRadius=q;a.fromRadius=r;a.fromValues=D;a.getCenter=z;a.getRadius=y;a.intersectLine=F;a.intersectRay=A;a.intersectRayClosestSilhouette=
H;a.intersectsRay=I;a.projectPoint=L;a.setAltitudeAt=O;a.setExtent=E;a.sphere=ca;a.tmpSphere=X;a.union=Z;a.wrap=t})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,g,d,k,m){function f(h){return h?c(k.clone(h.origin),k.clone(h.direction)):c(k.create(),k.create())}function c(h,u){return{origin:h,direction:u}}function l(h,u,w=f()){d.copy(w.origin,h);d.copy(w.direction,u);
return w}function e(h,u){h=d.cross(m.sv3d.get(),d.normalize(m.sv3d.get(),h.direction),d.subtract(m.sv3d.get(),u,h.origin));return d.dot(h,h)}const p=new g.ObjectStack(()=>f());a.closestPoint=function(h,u,w){u=d.dot(h.direction,d.subtract(w,u,h.origin));d.add(w,h.origin,d.scale(w,h.direction,u));return w};a.copy=function(h,u=f()){return l(h.origin,h.direction,u)};a.create=f;a.distance=function(h,u){return Math.sqrt(e(h,u))};a.distance2=e;a.equals=function(h,u){return b.equals(h.origin,u.origin)&&b.equals(h.direction,
u.direction)};a.fromPoints=function(h,u,w=f()){d.copy(w.origin,h);d.subtract(w.direction,u,h);return w};a.fromValues=l;a.wrap=function(h,u){const w=p.get();w.origin=h;w.direction=u;return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,b,g,d){const k=d.create(),m=d.create();a.angle=function(f,c){f=g.dot(f,c)/(g.length(f)*g.length(c));return-b.acosClamped(f)};
a.angleAroundAxis=function(f,c,l){g.normalize(k,f);g.normalize(m,c);f=g.dot(k,m);f=b.acosClamped(f);c=g.cross(k,k,m);return 0>g.dot(c,l)?2*Math.PI-f:f};a.projectPoint=function(f,c,l){c=g.dot(f,c)/g.dot(f,f);return g.scale(l,f,c)};a.projectPointSignedLength=function(f,c){return g.dot(f,c)/g.length(f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],
function(a,b,g,d){const k=d.create(),m=d.create(),f=d.create(),c=d.create(),l=d.create();a.angle=function(e,p,h){e=g.normalize(c,e);p=g.normalize(l,p);const u=b.acosClamped(g.dot(e,p));return h&&(e=g.cross(f,e,p),0>g.dot(e,h))?-u:u};a.bilerp=function(e,p,h,u,w,x){e+=(p-e)*w;return e+(h+(u-h)*w-e)*x};a.cosCapped=function(e,p){return e>p?Math.cos(p):Math.cos(e)};a.fovx2fovy=function(e,p,h){return 2*Math.atan(h*Math.tan(.5*e)/p)};a.fovy2fovx=function(e,p,h){return 2*Math.atan(p*Math.tan(.5*e)/h)};a.makeOrthonormal=
function(e,p,h){h=h||e;const u=g.dot(e,p);g.set(h,e[0]-u*p[0],e[1]-u*p[1],e[2]-u*p[2]);g.normalize(h,h)};a.makePiecewiseLinearFunction=function(e){const p=e.length;return h=>{if(h<=e[0][0])return e[0][1];if(h>=e[p-1][0])return e[p-1][1];let u=1;for(;h>e[u][0];)u++;const w=e[u][0];h=(w-h)/(w-e[u-1][0]);return h*e[u-1][1]+(1-h)*e[u][1]}};a.maxScale=function(e){return Math.sqrt(Math.max(e[0]*e[0]+e[4]*e[4]+e[8]*e[8],e[1]*e[1]+e[5]*e[5]+e[9]*e[9],e[2]*e[2]+e[6]*e[6]+e[10]*e[10]))};a.planeFromPoints=function(e,
p,h,u){g.subtract(k,p,e);g.subtract(m,h,e);g.cross(u,k,m);g.normalize(u,u);u[3]=-g.dot(e,u)};a.scaleFromMatrix=function(e,p){g.set(e,Math.sqrt(p[0]*p[0]+p[4]*p[4]+p[8]*p[8]),Math.sqrt(p[1]*p[1]+p[5]*p[5]+p[9]*p[9]),Math.sqrt(p[2]*p[2]+p[6]*p[6]+p[10]*p[10]));return e};a.slerp=function(e,p,h,u=d.create()){const w=g.length(e);var x=g.length(p),n=g.dot(e,p)/(w*x);if(.9999999999999999>n){n=Math.acos(n);const q=((1-h)*w+h*x)/Math.sin(n);x=q/x*Math.sin(h*n);g.scale(c,e,q/w*Math.sin((1-h)*n));g.scale(l,
p,x);return g.add(u,c,l)}return g.lerp(u,e,p,h)};a.slerpTangent=function(e,p,h,u=d.create(),w=d.create()){const x=g.length(e),n=g.length(p);var q=g.dot(e,p)/(x*n);if(.9999999999999999>q){q=Math.acos(q);const t=Math.sin(q),v=Math.sin(h*q),r=Math.sin((1-h)*q),y=(1-h)*x+h*n,z=y/t,D=z/n*v;g.scale(c,e,z/x*r);g.scale(l,p,D);g.add(u,c,l);g.scale(c,e,1/x*(-Math.cos((1-h)*q)*q*y+r*(-x+n)));g.scale(l,p,1/n*(Math.cos(h*q)*q*y+v*(-x+n)));g.add(w,c,l);g.scale(w,w,1/t);return w}g.lerp(u,e,p,h);g.subtract(w,p,e);
g.normalize(w,w);return w};a.tangentFrame=function(e,p,h){Math.abs(e[0])>Math.abs(e[1])?g.set(p,0,1,0):g.set(p,1,0,0);g.cross(h,e,p);g.normalize(p,p);g.cross(p,h,e);g.normalize(h,h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../ellipsoidUtils ../SpatialReference ../spatialReferenceEllipsoidUtils ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(t){return{operations:t,value:t.create()}}function h(t,v,r=p(t)){r.operations=t;t.copy(v,r.value);return r}function u(t,v,r,y){return t.operations.setAltitudeAt(t.value,v,r,y)}const w=2**50,x=d.create(),n={operations:null,value:null},q=d.create();a.altitudeAt=function(t,v){return t.operations.altitudeAt(t.value,v)};a.axisAt=function(t,v,r,y){return t.operations.axisAt(t.value,v,r,y)};a.closestPoint=function(t,v,r){return t.operations.closestPoint(t.value,v,
r)};a.closestPointOnSilhouette=function(t,v,r){return t.operations.closestPointOnSilhouette(t.value,v,r)};a.coordinateSystemFromOneAxisAndNormalVector=function(t,v,r,y,z){g.copy(r,t);g.copy(q,v);g.normalize(q,q);g.cross(y,q,r);g.cross(z,y,r)};a.create=function(t){const {value:v,operations:r}=t;return{operations:r,value:r.create(v)}};a.createFromOperations=p;a.createGlobal=function(t){return h(e.sphere,e.fromValues(0,0,0,k.getReferenceEllipsoid(t).radius))};a.createLocal=function(){return h(l.boundedPlane,
l.fromValues([0,0,0],[w,0,0],[0,w,0]))};a.distanceToSilhouette=function(t,v){return t.operations.distanceToSilhouette(t.value,v)};a.elevate=function(t,v,r){return t.operations.elevate(t.value,v,r.value)};a.fromValues=h;a.intersectRay=function(t,v,r){return t.operations.intersectRay(t.value,v,r)};a.intersectRayClosestSilhouette=function(t,v,r){return t.operations.intersectRayClosestSilhouette(t.value,v,r)};a.intersectsRay=function(t,v){return t.operations.intersectRay(t.value,v,null)};a.normalAt=function(t,
v,r){return t.operations.axisAt(t.value,v,c.Axis.Z,r)};a.renderSRFromViewSR=function(t,v){return t?f.getSphericalPCPF(v):v.isGeographic?m.PlateCarree:v};a.setAltitudeAt=u;a.setAltitudeOfTransformation=function(t,v,r,y){v!==y&&b.copy(y,v);g.set(x,y[12],y[13],y[14]);u(t,x,r,x);y[12]=x[0];y[13]=x[1];y[14]=x[2];return y};a.setExtent=function(t,v,r){t.operations.setExtent(t.value,v,r.value);return r};a.vectorCoordinates=function(t,v,r,y,z){z[0]=g.dot(t,v);z[1]=g.dot(t,r);z[2]=g.dot(t,y);return z};a.wrap=
function(t,v){n.operations=t;n.value=v;return n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(a,b,g,d){const k=new g(b.SphericalECEFSpatialReferenceLike),m=new g(b.SphericalPCPFMarsLike),f=new g(b.SphericalPCPFMoonLike);b=new g(b.WGS84ECEFSpatialReferenceLike);a.SphericalECEFSpatialReference=k;a.SphericalPCPFMars=m;a.SphericalPCPFMoon=
f;a.WGS84ECEFSpatialReference=b;a.getSphericalPCPF=function(c){return c&&(d.isMars(c)||d.equals(c,m))?m:c&&(d.isMoon(c)||d.equals(c,f))?f:k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(a,b,g){function d(k,m){m=g.getMetersPerUnitForSR(m);return k/(m*g.inchesPerMeter*96)}a.getExtentForScale=function(k,m){const f=k.extent;k=k.width-(k.padding?k.padding.left+k.padding.right:
0);m=d(m,f.spatialReference);return f.clone().expand(m*k/f.width)};a.getResolutionForScale=d;a.getResolutionInMetersForScale=function(k){return k/(96*g.inchesPerMeter)};a.getScale=function(k,m){m=m||k.extent;k=k.width;const f=g.getMetersPerUnitForSR(m?.spatialReference);return m&&k?m.width/k*f*g.inchesPerMeter*96:0};a.getScaleForResolution=function(k,m){m=g.getMetersPerUnitForSR(m);return k*m*g.inchesPerMeter*96};a.isInScaleRange=function(k,m,f){if(m=0===m||b.floatEqualAbsolute(k,m)||k<m)m=0===f||
b.floatEqualAbsolute(k,f)||k>f;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/LayerConstants":function(){define(["exports"],function(a){a.fallbackObjectIDAttribute="OBJECTID";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/tslib.es6 ../core/ArrayPool ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(u,w){return w?p[u].valueToClassName[w].split(" "):[]}const p={widthBreakpoint:{getValue(u){const w=u.viewSize[0];u=u.breakpoints;const x=this.values;return w<=u.xsmall?x.xsmall:w<=u.small?x.small:w<=u.medium?x.medium:w<=u.large?x.large:x.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(u){const w=u.viewSize[1];u=u.breakpoints;const x=this.values;return w<=u.xsmall?x.xsmall:w<=u.small?x.small:w<=u.medium?x.medium:w<=u.large?x.large:x.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(u){u=u.viewSize;const w=this.values;return u[1]>=u[0]?w.portrait:w.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},h={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
u=>{u=class extends u{constructor(...w){super(...w);this.heightBreakpoint=this.widthBreakpoint=this.orientation=null;this.breakpoints=h}initialize(){this.addHandles(d.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),d.initial))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(w){var x=this._get("breakpoints");if(w!==x){x=(x=w)&&x.xsmall<x.small&&x.small<x.medium&&x.medium<x.large;if(!x){const n=JSON.stringify(h,null,2);console.warn("provided breakpoints are not valid, using defaults:"+
n)}w=x?w:h;this._set("breakpoints",{...w})}}_updateClassNames(){if(this.container){var w=g.acquire(),x=g.acquire(),n=!1,q;for(q in p){const t=this[q],v=p[q].getValue({viewSize:this.size,breakpoints:this.breakpoints});t!==v&&(n=!0,this[q]=v,e(q,t).forEach(r=>x.push(r)),e(q,v).forEach(r=>w.push(r)))}n&&(this._applyClassNameChanges(w,x),g.release(w),g.release(x))}}_applyClassNameChanges(w,x){const n=this.container;n&&(x.forEach(q=>n.classList.remove(q)),w.forEach(q=>n.classList.add(q)))}_removeActiveClassNames(){const w=
this.container;if(w)for(var x in p)e(x,this[x]).forEach(n=>w.classList.remove(n))}};b.__decorate([k.property()],u.prototype,"breakpoints",null);b.__decorate([k.property()],u.prototype,"orientation",void 0);b.__decorate([k.property()],u.prototype,"widthBreakpoint",void 0);b.__decorate([k.property()],u.prototype,"heightBreakpoint",void 0);return u=b.__decorate([l.subclass("esri.views.BreakpointsOwner")],u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/DOMContainer":function(){define("exports ../chunks/tslib.es6 ../intl ../core/domUtils ../core/events ../core/has ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../intl/locale ../intl/messages".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){function t(r){r&&(d.empty(r),r.parentNode&&r.parentNode.removeChild(r))}const v=[0,0];a.DOMContainer=r=>{r=class extends r{constructor(...y){super(...y);this._freqInfo={freq:16,time:750};this._overlayRenderTaskHandle=null;this.height=0;this.position=this.overlay=this.messagesCommon=null;this.resizing=!1;this.surface=this.root=null;this.suspended=!0;this.userContent=this.ui=null;this.width=0;this.widthBreakpoint=null;this.addHandles([l.watch(()=>this.cursor,
z=>{const {surface:D}=this;D&&D.setAttribute("data-cursor",z)}),l.watch(()=>this.navigating,z=>{const {surface:D}=this;D&&D.setAttribute("data-navigating",z.toString())})])}initialize(){const y=m("mac"),z=async()=>{y&&(await l.whenOnce(()=>this.ready),this.messagesCommon=await q.fetchMessageBundle("esri/t9n/common").catch(()=>{}))};z();this.addHandles([l.watch(()=>this.ui,(D,C)=>this._handleUIChange(D,C),l.initial),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),
n.onLocaleChange(z)])}destroy(){this.destroyed||(this.ui=c.destroyMaybe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(y){var z=this._get("container");const D=d.byId(y);D||"string"!==typeof y||f.getLogger(this).error("#container",`element with id '${y}' not found`);if(z!==D)if(this._stopMeasuring(),z&&(z.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&
(this.overlay.destroy(),this._set("overlay",null)),this.root&&(t(this.root),this._set("root",null)),this.userContent&&(d.reparent(this.userContent,z),t(this.userContent),this._set("userContent",null))),D){D.classList.add("esri-view");y=document.createElement("div");y.className="esri-view-user-storage";d.reparent(D,y);D.appendChild(y);this._set("userContent",y);y=document.createElement("div");y.className="esri-view-root";D.insertBefore(y,D.firstChild);this._set("root",y);z=document.createElement("div");
z.className="esri-view-surface";z.setAttribute("role","application");z.tabIndex=0;y.appendChild(z);this._set("surface",z);var C=new x;y.appendChild(C.surface);this._set("overlay",C);this.addHandles(l.watch(()=>C.needsRender,E=>{this._overlayRenderTaskHandle=E&&!this._overlayRenderTaskHandle?e.addFrameTask({render:()=>this.overlay?.render()}):c.removeMaybe(this._overlayRenderTaskHandle)}));this.forceDOMReadyCycle();this._set("container",D);this._startMeasuring()}else this._set("width",0),this._set("height",
0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const y=document.activeElement===this.surface;return document.hasFocus()&&y}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(y,z,D){const C=this.position;y-=C?C[0]:0;z-=C?C[1]:0;D?(D[0]=y,D[1]=z):D=[y,z];return D}containerToPage(y,z,D){const C=this.position;y+=C?C[0]:0;z+=C?C[1]:0;D?(D[0]=y,D[1]=z):D=[y,z];return D}_handleUIChange(y,
z){this.removeHandles("ui");z&&z!==y&&z.destroy();y&&(y.view=this,this.addHandles(l.watch(()=>this.root,D=>{if(D){const C=document.createElement("div");D.appendChild(C);D=C}else D=null;y.container=D},l.initial),"ui"));this._set("ui",y)}_stopMeasuring(){this.removeHandles("measuring");this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const y=this._freqInfo;y.freq=16;y.time=750;this.addHandles([k.on(window,"resize",()=>{y.freq=16;y.time=750}),e.addFrameTask({prepare:z=>{const D=this._measure(),
C=this._freqInfo;C.time+=z.deltaTime;D&&(C.freq=16,this._get("resizing")||this._set("resizing",!0));C.time<C.freq||(C.time=0,this._position()||D?C.freq=16:C.freq=Math.min(750,2*C.freq),!D&&512<=C.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()}_measure(){var y=this.container;const z=y?y.clientWidth:0;y=y?y.clientHeight:0;if(0===z||0===y)return this.suspended||this._set("suspended",!0),!1;const D=this.width,C=this.height;if(z===D&&y===C)return this.suspended&&
this._set("suspended",!1),!1;this._set("width",z);this._set("height",y);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:D,oldHeight:C,width:z,height:y});return!0}_position(){var y=this.container;const z=this.position;var D;if(D=y)D=(y.ownerDocument||window.document).defaultView,y=y.getBoundingClientRect(),v[0]=y.left+(D?.pageXOffset??0),v[1]=y.top+(D?.pageYOffset??0),D=v;y=D;return y?z&&y[0]===z[0]&&y[1]===z[1]?!1:(this._set("position",[y[0],y[1]]),!0):!1}forceDOMReadyCycle(){}};
b.__decorate([p.property()],r.prototype,"container",null);b.__decorate([p.property({readOnly:!0})],r.prototype,"focused",null);b.__decorate([p.property({readOnly:!0})],r.prototype,"height",void 0);b.__decorate([p.property()],r.prototype,"messagesCommon",void 0);b.__decorate([p.property({type:x})],r.prototype,"overlay",void 0);b.__decorate([p.property({readOnly:!0})],r.prototype,"position",void 0);b.__decorate([p.property({readOnly:!0})],r.prototype,"resizing",void 0);b.__decorate([p.property({readOnly:!0})],
r.prototype,"root",void 0);b.__decorate([p.property({value:null,readOnly:!0})],r.prototype,"size",null);b.__decorate([p.property({readOnly:!0})],r.prototype,"surface",void 0);b.__decorate([p.property({readOnly:!0})],r.prototype,"suspended",void 0);b.__decorate([p.property()],r.prototype,"ui",void 0);b.__decorate([p.property({readOnly:!0})],r.prototype,"userContent",void 0);b.__decorate([p.property({readOnly:!0})],r.prototype,"width",void 0);b.__decorate([p.property()],r.prototype,"widthBreakpoint",
void 0);return r=b.__decorate([w.subclass("esri.views.DOMContainer")],r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/support/UpdatingHandles ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){b=class extends b{constructor(){super(...arguments);this.items=new g;this._watchUpdatingTracking=new l.UpdatingHandles;this._callbacks=new Map;this._projector=p.createProjector();this._hiddenProjector=p.createProjector()}get needsRender(){return 0<this.items.length}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const h=document.createElement("div");h.className="esri-overlay-surface";this._set("surface",h);this._hiddenSurface=document.createElement("div");
this._hiddenSurface.setAttribute("style","visibility: hidden;");h.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,u=>{for(const w of u.added){const x=()=>w.render();this._callbacks.set(w,x);this._projector.append(this.surface,x)}for(const w of u.removed)u=this._projector.detach(this._callbacks.get(w)),this.surface.removeChild(u.domNode),this._callbacks.delete(w)})}addItem(h){this.items.add(h)}removeItem(h){this.items.remove(h)}destroy(){this.items.removeAll();
this._callbacks.forEach(h=>this._projector.detach(h));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(h){const u=this._hiddenSurface,w=this._hiddenProjector;let x;const n=()=>x=h.render();w.append(u,n);w.renderNow();const q={left:0,top:0,right:0,bottom:0};if(x?.domNode){const t=x.domNode.getBoundingClientRect();q.left=t.left;q.top=t.top;q.right=t.right;q.bottom=t.bottom}for(w.detach(n);u.firstChild;)u.removeChild(u.firstChild);
return q}overlaps(h,u){h=this.computeBoundingRect(h);u=this.computeBoundingRect(u);return Math.max(h.left,u.left)<=Math.min(h.right,u.right)&&Math.max(h.top,u.top)<=Math.min(h.bottom,u.bottom)}get hasVisibleItems(){return this.items.some(h=>h.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(h,u){const w=!!u?.disableDecorations;if(this.items.some(n=>n.visible&&!(w&&n.isDecoration))){var x=h.getContext("2d");x.save();x.font=this._fontString();this.items.forEach(n=>
{w&&n.isDecoration||(x.save(),n.renderCanvas(x),x.restore())});x.restore()}}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};a.__decorate([d.property({readOnly:!0})],b.prototype,"surface",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,"items",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,"needsRender",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"_watchUpdatingTracking",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,
"updating",null);return b=a.__decorate([c.subclass("esri.views.overlay.ViewOverlay")],b)})},"esri/views/GroundView":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./3d/support/cameraUtils ./support/GroundViewElevationSampler".split(" "),function(a,b,g,d,k,m,f,c,l,e,p){b=class extends b{constructor(h){super(h);
this.view=null;this.layerViews=new g}initialize(){this.addHandles(d.when(()=>this.view?.map?.ground,h=>h.load()));this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const h of this.layerViews)h.destroy();this.layerViews.length=0}get elevationSampler(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new p({view:this.view}):null}get extent(){const h=this.view;
return h&&"2d"!==h.type&&h.ready?e.toExtent(h,h.state.camera,h.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return this.suspended?!1:this.layerViews.some(h=>h.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating");this.addHandles(this.layerViews.map(h=>d.watch(()=>h.updating,()=>this._updateUpdating(),d.sync)).toArray(),"updating");this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};
a.__decorate([k.property({readOnly:!0})],b.prototype,"elevationSampler",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([k.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([k.property({type:g,readOnly:!0})],b.prototype,"layerViews",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"suspended",null);return b=a.__decorate([l.subclass("esri.views.GroundView")],
b)})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Point ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectPointToVectorWithEngine ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToPointWithEngine ../../../geometry/projection/projectVectorToVector ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C){function E(Y){return Y.spatialReference??h.WGS84}function A(Y){return"global"===Y.viewingMode?y.cameraUtilsSpherical:r.cameraUtilsPlanar}function F(Y,ea,fa){const aa=Y.state.camera,da=aa.width/2/aa.pixelRatio;Y.renderCoordsHelper.viewingMode===t.ViewingMode.Global&&null!=fa&&(ea*=Math.cos(k.deg2rad(fa)));ea/=Y.renderCoordsHelper.unitInMeters;return da/(96*39.37/ea)/Math.tan(aa.fovX/2)}function G(Y,ea,fa){const aa=Y.state.camera;ea=96*39.37/
(aa.width/2/aa.pixelRatio/(ea*Math.tan(aa.fovX/2)));Y.renderCoordsHelper.viewingMode===t.ViewingMode.Global&&null!=fa&&(ea/=Math.cos(k.deg2rad(fa)));return ea*Y.renderCoordsHelper.unitInMeters}async function I(Y,ea,fa,aa,da,ma){ea=await T(Y,aa.heading,aa.tilt,ea,fa,da,ma);m.throwIfAborted(ma);return V(Y,ea,aa.fov,ma)}function H(Y,ea,fa,aa,da){return A(Y).directionToHeadingTilt(ea,fa,aa,da)}function B(Y,ea){return!!(Y.basemapTerrain&&Y.renderCoordsHelper.fromRenderCoords(ea,ba,Y.spatialReference)&&
Y.elevationProvider&&(D.getElevationAtPoint(Y.elevationProvider,ba)??0)>ba[2]-1)}async function K(Y,ea,fa){if(B(Y,ea))return!0;const {elevationProvider:aa,spatialReference:da,renderCoordsHelper:ma}=Y;if(null==aa||!ma.fromRenderCoords(ea,ba,da))return!1;const [ua,sa,ra]=ba;Y=await aa.queryElevation(ua,sa,ra,da,"ground",fa)??0;m.throwIfAborted(fa);return Y>ra-1}async function L(Y,ea,fa){const aa=c.create();if(null==ea)return f.copy(aa,Y.state.camera.center);if(ea instanceof e){const {renderSpatialReference:da,
basemapTerrain:ma,elevationProvider:ua}=Y,sa=ea.spatialReference;await w.projectPointToVectorWithEngine(ea,aa,da,0,{signal:fa});m.throwIfAborted(fa);null==ea.z&&null!=ma&&null!=ua&&(ea=await ua.queryElevation(ea.x,ea.y,ea.z??0,sa,"ground",fa),m.throwIfAborted(fa),null!=ea&&Y.renderCoordsHelper.setAltitude(aa,ea));return aa}return f.copy(aa,ea)}function J(Y,ea){const fa=c.create();if(null==ea)return f.copy(fa,Y.state.camera.center);if(ea instanceof e){if(!u.projectPointToVector(ea,fa,Y.renderSpatialReference))return null;
const {basemapTerrain:aa,elevationProvider:da}=Y;null==ea.z&&null!=aa&&null!=da&&(ea=D.getElevationAtPoint(da,ea),null!=ea&&Y.renderCoordsHelper.setAltitude(fa,ea));return fa}return f.copy(fa,ea)}function M(Y,ea,fa,aa,da,ma){const ua=aa instanceof e?aa:null;aa=J(Y,aa);return Q(Y,ea,fa,ua,aa,da,ma)}async function T(Y,ea,fa,aa,da,ma,ua){const sa=aa instanceof e?aa:null;aa=await L(Y,aa,ua);m.throwIfAborted(ua);return O(Y,ea,fa,sa,aa,da,ma,ua)}function Q(Y,ea,fa,aa,da,ma,ua){if(null==da)return null;aa??
(aa=x.projectVectorToPoint(da,Y.renderSpatialReference,E(Y)));if(null==aa)return null;const sa=U(Y,ea,fa,da,ma,ua);if(Z(Y,fa,ua)&&B(Y,sa.eye)){const {tilt:ra,mode:Aa}=P(Y,fa,da,ma);return Q(Y,ea,ra,aa,da,ma,Aa)}return{...sa,center:c.clone(da)}}async function O(Y,ea,fa,aa,da,ma,ua,sa){aa??(aa=await n.projectVectorToPointWithEngine(da,Y.renderSpatialReference,E(Y),{signal:sa}));m.throwIfAborted(sa);const ra=U(Y,ea,fa,da,ma,ua);if(Z(Y,fa,ua)&&await K(Y,ra.eye,sa)){m.throwIfAborted(sa);const {tilt:Aa,
mode:qa}=P(Y,fa,da,ma);return O(Y,ea,Aa,aa,da,ma,qa,sa)}return{...ra,center:c.clone(da)}}function U(Y,ea,fa,aa,da,ma){da=Math.max(da,Y.state.constraints.minimumPoiDistance);var ua=fa;fa=da;var sa=0;if(ma=ma===a.OrientationMode.ADJUST)if(sa=Y.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(fa/sa)/Math.LN2)ma=!0;else{var ra=Y.renderSpatialReference,Aa=E(Y);ma=x.projectVectorToPoint(aa,ra,Aa);ra=x.projectVectorToPoint(Y.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,ra,Aa);null==
ma||null==ra?ma=!1:(sa*=Math.tan(.5*Y.state.camera.fov),ma=5<ra.distance(ma)/sa)}ma?(ea=0,ua=A(Y).eyeTiltToLookAtTilt(ua,aa,fa),Y.state.constraints.tilt?(ma=Y.state.constraints.tilt(fa),ma.max=Math.min(ma.max,.5*Math.PI),sa=Math.min(ua,ma.min*(1-.7)+.7*ma.max)):sa=ua):sa=A(Y).eyeTiltToLookAtTilt(ua,aa,fa);ua=sa=Y.state.constraints.clampTilt(fa,sa);fa=ua=A(Y).lookAtTiltToEyeTilt(ua,aa,fa);Y=A(Y).eyeForCenterWithHeadingTilt;return Y(aa,da,ea,fa)}function Z(Y,ea,fa){const aa=Y.map.ground.navigationConstraint;
return fa===a.OrientationMode.ADJUST&&"global"===Y.viewingMode&&0<ea&&(null==aa||"stay-above"===aa.type)}function P(Y,ea,fa,aa){{let ma=A(Y).eyeTiltToLookAtTilt(ea,fa,aa);if(Y.state.constraints.tilt){var da=Y.state.constraints.tilt(aa);ma=Math.min(ma,.5*Math.PI);da=da.min*(1-.7)+.7*ma}else da=ma}Y=A(Y).lookAtTiltToEyeTilt(da,fa,aa);return{tilt:Y,mode:1>ea-Y?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST}}function R(Y,ea){const {state:fa,spatialReference:aa}=Y;Y=ea.spatialReference;return fa.isGlobal&&
C.isSpatialReferenceSupported(Y,t.ViewingMode.Global)||fa.isLocal&&aa.equals(Y)}function W(Y,ea){let fa;if(Y.state.isGlobal){const ma=new e(ea.xmin,ea.ymin,ea.spatialReference),ua=new e(ea.xmax,ea.ymax,ea.spatialReference),sa=ea.spatialReference.isGeographic?ka:ia;var aa=new e({x:sa.center(ma.x,ua.x),y:(ua.y+ma.y)/2,z:null!=ea.zmax&&null!=ea.zmin?(ea.zmax+ea.zmin)/2:void 0,spatialReference:ea.spatialReference});const ra=l.getReferenceEllipsoid(ea.spatialReference);var da=z.getGreatCircleSpanAt(aa,
ma,ua);fa=da.lon;da=da.lat;sa.diff(ma.x,ua.x)>sa.range/2&&(fa+=ra.halfCircumference);fa=Math.min(fa,ra.halfCircumference);da=Math.min(da,ra.halfCircumference)}else aa=Y.renderSpatialReference??ea.spatialReference,aa.equals(ea.spatialReference)||(ea=p.project(ea,aa)),fa=ea.xmax-ea.xmin,da=ea.ymax-ea.ymin,aa=new e({x:ea.xmin+.5*fa,y:ea.ymin+.5*da,z:null!=ea.zmax&&null!=ea.zmin?(ea.zmax+ea.zmin)/2:void 0,spatialReference:aa});Y=Y.state.camera;return{center:aa,distance:Math.max(1/Math.tan(Y.fovX/2)*fa*
.5,1/Math.tan(Y.fovY/2)*da*.5,1/Math.tan(Y.fov/2)*(null!=ea.zmax&&null!=ea.zmin?ea.zmax-ea.zmin:0)*.5)/1}}function N(Y,ea,fa,aa){if(null==ea)return null;Y=x.projectVectorToPoint(ea.eye,Y.renderSpatialReference,E(Y));if(null==Y)return null;aa??(aa=new b);aa.position=Y;aa.heading=ea.heading;aa.tilt=ea.tilt;aa.fov=fa;return aa}async function V(Y,ea,fa,aa){Y=await n.projectVectorToPointWithEngine(ea.eye,Y.renderSpatialReference,E(Y),{signal:aa});m.throwIfAborted(aa);return new b(Y,ea.heading,ea.tilt,
fa)}const S=d.getLogger("esri.views.3d.support.cameraUtils"),X=c.create(),ca={heading:0,tilt:0},ba=c.create(),ia=new g.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),ka=new g.Cyclical(-180,180);a.OrientationMode=void 0;(function(Y){Y[Y.LOCKED=0]="LOCKED";Y[Y.ADJUST=1]="ADJUST"})(a.OrientationMode||(a.OrientationMode={}));const na=c.create();a.computeScale=function(Y,ea){q.projectVectorToVector(ea.center,Y.renderSpatialReference,X,h.WGS84);return G(Y,ea.distance,X[1])};a.directionToHeadingTilt=
H;a.distanceToScale=G;a.externalToInternal=function(Y,ea){if(null==ea)return null;var fa=Y.renderSpatialReference;const aa=A(Y).headingTiltToDirectionUp,da=c.create();if(!u.projectPointToVector(ea.position,da,fa))return null;fa=aa(da,ea.heading,ea.tilt);f.scale(fa.direction,fa.direction,Y.state.camera.distance);f.add(fa.direction,fa.direction,da);Y=v.cameraOnContentAlongViewDirection(Y,da,fa.direction,fa.up);Y.fov=k.deg2rad(ea.fov);return Y};a.fromCenterDistanceAsync=I;a.fromCenterDistanceSync=function(Y,
ea,fa,aa,da,ma){ea=M(Y,aa.heading,aa.tilt,ea,fa,da);return N(Y,ea,aa.fov,ma)};a.fromCenterScale=async function(Y,ea,fa,aa,da,ma){fa=F(Y,fa,ea.latitude);return I(Y,ea,fa,aa,da,ma)};a.fromExtentAsync=async function(Y,ea,fa,aa,da,ma){ea=R(Y,ea)?ea:await p.projectWithZConversion(ea,Y.spatialReference,{signal:ma});m.throwIfAborted(ma);const {center:ua,distance:sa}=W(Y,ea);fa=await T(Y,fa,aa,ua,sa,da,ma);m.throwIfAborted(ma);return V(Y,fa,Y.camera.fov,ma)};a.fromExtentSync=function(Y,ea,fa,aa,da,ma){let ua;
try{ua=R(Y,ea)?ea:p.project(ea,Y.spatialReference)}catch(Aa){return null}const {center:sa,distance:ra}=W(Y,ua);ea=M(Y,fa,aa,sa,ra,da);return null==ea?null:N(Y,ea,Y.camera.fov,ma)};a.getObserverForPointAtDistanceAsync=T;a.getObserverForPointAtDistanceSync=M;a.getViewSR=E;a.headingTiltToDirectionUp=function(Y,ea,fa,aa,da){return A(Y).headingTiltToDirectionUp(ea,fa,aa,da)};a.internalToExternal=function(Y,ea,fa){const aa=Y.renderSpatialReference,da=H(Y,ea.eye,ea.viewForward,ea.up,ca);Y=E(Y);q.projectVectorToVector(ea.eye,
aa,na,Y)||(Y=h.WGS84,q.projectVectorToVector(ea.eye,aa,na,Y));if(null==fa)return new b(new e(na,Y),da.heading,da.tilt,k.rad2deg(ea.fov));fa.position.x=na[0];fa.position.y=na[1];fa.position.z=na[2];fa.position.spatialReference=Y;fa.heading=da.heading;fa.tilt=da.tilt;fa.fov=k.rad2deg(ea.fov);return fa};a.scaleToDistance=F;a.scaleToZoom=function(Y,ea){if(Y=Y.basemapTerrain?.tilingScheme)return Y.levelAtScale(ea);S.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=
function(Y,ea,fa){const aa=x.projectVectorToPoint(fa,Y.renderSpatialReference,E(Y));if(null==aa)return null;var da=Math.tan(ea.fovX/2),ma=Math.tan(ea.fovY/2);ea=f.dist(ea.eye,fa);da*=2*ea;ma*=2*ea;return"global"===Y.viewingMode?y.toExtent(Y,aa,da,ma):r.toExtent(Y,aa,da,ma)};a.zoomToScale=function(Y,ea){if(Y=Y.basemapTerrain?.tilingScheme)return Y.scaleAtLevel(ea);S.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/projection/projectPointToVectorWithEngine":function(){define("exports ../../chunks/vec3f64 ../projection ./projectBuffer ../support/spatialReferenceUtils ../../layers/graphics/dehydratedPoint".split(" "),function(a,b,g,d,k,m){const f=b.create();a.projectPointToVectorWithEngine=async function(c,l,e,p,h){p??(p=0);const u=c.spatialReference;g.canProjectWithoutEngine(u,e)||null==u||null==e||k.equals(u,e)?(f[0]=c.x,f[1]=c.y,f[2]=c.z??p,d.projectBuffer(f,c.spatialReference,0,l,e,0,1)):(c=
m.makeDehydratedPoint(c.x,c.y,c.z??p,u),e=await g.projectWithZConversion(c,e,h),l[0]=e.x,l[1]=e.y,l[2]=e.z??0)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(a){a.makeDehydratedPoint=function(b,g,d,k){return{x:b,y:g,z:d,hasZ:null!=d,hasM:!1,spatialReference:k,type:"point"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToPoint":function(){define(["exports",
"../../chunks/vec3f64","../Point","./projectBuffer"],function(a,b,g,d){const k=b.create();a.projectVectorToPoint=function(m,f,c){if(null==f||null==c)return null;const l=new g({spatialReference:c});return d.projectBuffer(m,f,0,k,c,0,1)?(l.x=k[0],l.y=k[1],l.z=k[2],l):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToPointWithEngine":function(){define(["exports","../Point","../projection","./projectVectorToPoint"],function(a,b,g,d){a.projectVectorToPointWithEngine=
async function(k,m,f,c){const l=d.projectVectorToPoint(k,m,f);if(null!=l)return l;k=new b({x:k[0],y:k[1],z:k[2],spatialReference:m,hasZ:!0});return g.projectWithZConversion(k,f,c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(a,b,g,d,k,m){function f(w,
x){return w.elevationProvider?w.elevationProvider.getElevation(x[0],x[1],x[2],w.renderCoordsHelper.spatialReference,"ground")??0:0}function c(w,x,n){if(!w.state.isGlobal||!w.stateManager.constraintsManager)return!1;const q=f(w,x);({far:w}=w.stateManager.constraintsManager.nearFarHeuristic.compute(x,n,w.renderDataExtent,q,u));w*=w;return b.squaredDistance(x,n)>w}const l={},e=g.create(),p=g.create(),h=g.create(),u={near:0,far:0};a.cameraOnContentAlongViewDirection=function(w,x,n,q){const t=w.state.camera.clone();
x&&n&&q&&(t.eye=x,t.center=n,t.up=q);x=t.ray;n=l[w.viewingMode];n||(n=m.newIntersector(w.state.viewingMode),n.options.backfacesTerrain=!w.state.isGlobal,n.options.invisibleTerrain=!0,l[w.viewingMode]=n);({isGlobal:q}=w.state);w.sceneIntersectionHelper.intersectRay(x,n,p)&&!c(w,x.origin,p)?x=!0:!w.renderCoordsHelper.intersectManifold(x,0,p)||c(w,x.origin,p)?q?(n=d.getReferenceEllipsoid(w.spatialReference).radius,n=b.dot(x.origin,x.origin)-n*n,b.scale(p,x.direction,(0<n?Math.sqrt(n)/3:1)/b.length(x.direction)),
b.add(p,p,x.origin),x=!0):x=!1:x=!0;x||b.copy(p,t.center);n=w.state.constraints;q=n.minimumPoiDistance;b.squaredDistance(t.eye,p)<q&&(x=n.collision.enabled,b.copy(h,t.viewForward),b.scale(h,h,q),x?t.eye=b.subtract(e,p,h):b.add(p,t.eye,h),w=w.renderCoordsHelper,q=w.getAltitude(t.eye),n=n.collision.elevationMargin,x&&q<n&&(b.subtract(h,p,t.eye),t.eye=w.setAltitude(e,n,t.eye),b.add(p,t.eye,h)));t.center=p;return t};a.eyeWithinExtent=function(w,x,n,q){return null!=w.renderCoordsHelper.fromRenderCoords(x.eye,
e,q)&&k.containsPoint(n,e)};a.surfaceElevationBelowRenderLocation=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./IntersectorTarget ./intersectorUtils ./verticalOffsetUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){class w{constructor(r){this.options=new e.IntersectorOptions;this._results=new x;this.transform=new u.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=c.create();this._rayEnd=k.create();this._rayBeginTransformed=k.create();this._rayEndTransformed=k.create();this.viewingMode=null==r?l.ViewingMode.Global:r}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(r,
y,z){this.resetWithRay(c.fromPoints(r,y,this._ray),z)}resetWithRay(r,y){this.camera=y;r!==this._ray&&c.copy(r,this._ray);0!==this.options.verticalOffset?this.viewingMode===l.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;d.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)}intersect(r=null,y,z,D,C){this.point=y;this.filterPredicate=D;this.tolerance=null==z?1E-5:z;y=u.getVerticalOffsetObject3D(this.verticalOffset);
if(r&&0<r.length){const E=C?A=>{C(A)&&this.intersectObject(A)}:A=>{this.intersectObject(A)};for(const A of r)r=A.getSpatialQueryAccelerator?.(),null!=r?(null!=y?r.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,E,y):r.forEachAlongRay(this._ray.origin,this._ray.direction,E),this.options.selectionMode&&this.options.hud&&r.forEachDegenerateObject(E)):A.objects.forAll(F=>E(F))}this.sortResults()}intersectObject(r){const y=r.geometries;if(y){var z=r.effectiveTransformation,D=u.getVerticalOffsetObject3D(this.verticalOffset);
for(const C of y){if(!C.visible)continue;const {material:E,id:A}=C;this.transform.setAndInvalidateLazyTransforms(z,C.transformation);d.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);d.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const F=this.transform.transform;null!=D&&(D.objectTransform=this.transform);E.intersect(C,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(G,I,H,B,K,L)=>{if(0<=G&&(null==this.filterPredicate||
this.filterPredicate(this._ray.origin,this._rayEnd,G))){var J=B?this._results.hud:this._results,M=B?T=>{const Q=new p.HudTarget(r,A,H,L);T.set(e.IntersectorType.HUD,Q,G,I,g.IDENTITY,K)}:T=>T.set(e.IntersectorType.OBJECT,{object:r,geometryId:A,triangleNr:H},G,I,F,K);(null==J.min.drapedLayerOrder||K>=J.min.drapedLayerOrder)&&(null==J.min.dist||G<J.min.dist)&&M(J.min);this.options.store!==e.StoreResults.MIN&&(null==J.max.drapedLayerOrder||K<J.max.drapedLayerOrder)&&(null==J.max.dist||G>J.max.dist)&&
M(J.max);this.options.store===e.StoreResults.ALL&&(B?(B=new q(this._ray),M(B),this._results.hud.all.push(B)):(B=new n(this._ray),M(B),this._results.all.push(B)))}})}}}sortResults(r=this._results.all){r.sort((y,z)=>y.dist!==z.dist?(y.dist??0)-(z.dist??0):y.drapedLayerOrder!==z.drapedLayerOrder?(y.drapedLayerOrder??Number.MAX_VALUE)-(z.drapedLayerOrder??Number.MAX_VALUE):(z.drapedLayerGraphicOrder??Number.MIN_VALUE)-(y.drapedLayerGraphicOrder??Number.MIN_VALUE))}}class x{constructor(){this.min=new n(c.create());
this.max=new n(c.create());this.hud={min:new q(c.create()),max:new q(c.create()),all:[]};this.ground=new n(c.create());this.all=[]}init(r){this.min.init(r);this.max.init(r);this.ground.init(r);this.all.length=0;this.hud.min.init(r);this.hud.max.init(r);this.hud.all.length=0}}class n{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?(d.scale(t,this.ray.direction,this.dist),d.length(t)):null}getIntersectionPoint(r){if(!h.isValidIntersectorResult(this))return!1;d.scale(t,
this.ray.direction,this.dist);d.add(r,this.ray.origin,t);return!0}getTransformedNormal(r){d.copy(v,this.normal);v[3]=0;m.transformMat4(v,v,this.transformation);d.copy(r,v);return d.normalize(r,r)}constructor(r){this.intersector=e.IntersectorType.OBJECT;this.normal=k.create();this.transformation=g.create();this._ray=c.create();this.init(r)}init(r){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=e.IntersectorType.OBJECT;c.copy(r,this._ray)}set(r,y,z,D,
C,E,A){this.intersector=r;this.dist=z;d.copy(this.normal,D??k.UNIT_Z);b.copy(this.transformation,C??g.IDENTITY);this.target=y;this.drapedLayerOrder=E;this.drapedLayerGraphicOrder=A}copy(r){c.copy(r.ray,this._ray);this.intersector=r.intersector;this.dist=r.dist;this.target=r.target;this.drapedLayerOrder=r.drapedLayerOrder;this.drapedLayerGraphicOrder=r.drapedLayerGraphicOrder;d.copy(this.normal,r.normal);b.copy(this.transformation,r.transformation)}}class q extends n{constructor(){super(...arguments);
this.intersector=e.IntersectorType.HUD}}const t=k.create(),v=f.create();a.defaultTolerance=1E-5;a.newIntersector=function(r){return new w(r)};a.newIntersectorResult=function(r){return new n(r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorType=void 0;(function(g){g[g.OBJECT=0]="OBJECT";g[g.HUD=1]="HUD";g[g.TERRAIN=2]="TERRAIN";g[g.OVERLAY=3]="OVERLAY";g[g.I3S=4]="I3S";g[g.PCL=
5]="PCL";g[g.LOD=6]="LOD";g[g.VOXEL=7]="VOXEL"})(a.IntersectorType||(a.IntersectorType={}));class b{constructor(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.filteredLayerUids=[];this.store=a.StoreResults.ALL}}a.StoreResults=void 0;(function(g){g[g.MIN=0]="MIN";g[g.MINMAX=1]="MINMAX";g[g.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports","../../../../chunks/vec3f64"],function(a,b){class g{constructor(c,l,e){this.object=c;this.geometryId=l;this.triangleNr=e}}class d extends g{constructor(c,l,e,p){super(c,l,e);this.center=null!=p?b.clone(p):null}}class k extends d{}class m{constructor(c){this.layerUid=c}}class f extends m{constructor(c,l){super(c);this.graphicUid=l}}a.Graphic3DTarget=f;a.HudTarget=d;a.LayerTarget=
m;a.ObjectTarget=g;a.ValidHudTarget=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/boundedPlane","./IntersectorInterfaces"],function(a,b,g,d,k){function m(c){return null!=c?.dist}const f=g.create();a.isHudIntersectorResult=function(c){return m(c)&&c.intersector===k.IntersectorType.HUD&&!!c.target&&"center"in c.target&&null!=c.target.center};
a.isObjectIntersectorResult=function(c){return m(c)&&c.intersector===k.IntersectorType.OBJECT&&!!c.target};a.isValidIntersectorResult=m;a.sliceFilterPredicate=function(c){return(l,e,p)=>{b.lerp(f,l,e,p);return!d.extrusionContainsPoint(c,f)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../../ViewingMode ../../support/orientedBoundingBox".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p{constructor(){this._transform=k.create();this._transformInverse=new h({value:this._transform},d.invert,k.create);this._transformInverseTranspose=new h(this._transformInverse,d.transpose,k.create);this._transformTranspose=new h({value:this._transform},d.transpose,k.create);this._transformInverseRotation=new h({value:this._transform},b.normalFromMat4Legacy,g.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();
this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(A){d.copy(this._transform,A)}multiplyTransform(A){d.multiply(this._transform,this._transform,A)}set(A){d.copy(this._transform,
A);this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(A,F){this.setTransformMatrix(A);this.multiplyTransform(F);this._invalidateLazyTransforms()}}class h{constructor(A,F,G){this._original=A;this._update=F;this._dirty=!0;this._transform=G()}invalidate(){this._dirty=!0}get value(){this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1);return this._transform}}class u{constructor(A=0){this.offset=A;this.tmpVertex=f.create()}applyToVertex(A,F,G){A=m.set(v,A,F,G);
F=m.add(r,A,this.localOrigin);G=this.offset/m.length(F);m.scaleAndAdd(this.tmpVertex,A,F,G);return this.tmpVertex}applyToAabb(A){var F=y;const G=z,I=D;for(var H=0;3>H;++H)F[H]=A[0+H]+this.localOrigin[H],G[H]=A[3+H]+this.localOrigin[H],I[H]=F[H];H=this.applyToVertex(F[0],F[1],F[2]);for(var B=0;3>B;++B)A[B]=H[B],A[B+3]=H[B];H=L=>{L=this.applyToVertex(L[0],L[1],L[2]);for(let J=0;3>J;++J)A[J]=Math.min(A[J],L[J]),A[J+3]=Math.max(A[J+3],L[J])};for(B=1;8>B;++B){for(var K=0;3>K;++K)I[K]=0===(B&1<<K)?F[K]:
G[K];H(I)}B=0;for(K=0;3>K;++K)0>F[K]*G[K]&&(B|=1<<K);if(0!==B&&7!==B)for(K=0;8>K;++K)if(0===(B&K)){for(let L=0;3>L;++L)I[L]=0!==(B&1<<L)?0:0!==(K&1<<L)?F[L]:G[L];H(I)}for(F=0;3>F;++F)A[F]-=this.localOrigin[F],A[F+3]-=this.localOrigin[F];return A}}class w{constructor(A=0){this.componentLocalOriginLength=0;this._tmpVertex=f.create();this._mbs=c.create();this._obb=e.create();this._offset=this._totalOffset=0;this._resetOffset(A)}_resetOffset(A){this._totalOffset=this._offset=A}set offset(A){this._resetOffset(A)}get offset(){return this._offset}set componentOffset(A){this._totalOffset=
this._offset+A}set localOrigin(A){this.componentLocalOriginLength=m.length(A)}applyToVertex(A,F,G){const I=m.set(v,A,F,G);A=m.set(r,A,F,G+this.componentLocalOriginLength);F=this._totalOffset/m.length(A);m.scaleAndAdd(this._tmpVertex,I,A,F);return this._tmpVertex}applyToAabb(A){const F=m.set(v,A[0],A[1],A[2]+this.componentLocalOriginLength),G=m.set(r,A[3],A[4],A[5]+this.componentLocalOriginLength);var I=m.sign(y,F);const H=m.sign(z,G);var B=m.abs(D,F),K=m.abs(C,G);const L=m.min(E,B,K);L[0]=0>I[0]*
H[0]?0:L[0];L[1]=0>I[1]*H[1]?0:L[1];L[2]=0>I[2]*H[2]?0:L[2];I=m.length(L);if(I<this._totalOffset)return A[0]-=0>F[0]?this._totalOffset:0,A[1]-=0>F[1]?this._totalOffset:0,A[2]-=0>F[2]?this._totalOffset:0,A[3]+=0<G[0]?this._totalOffset:0,A[4]+=0<G[1]?this._totalOffset:0,A[5]+=0<G[2]?this._totalOffset:0,A;B=m.max(E,B,K);B=m.length(B);B=this._totalOffset/B;K=this._totalOffset/I;A[0]+=F[0]*(0<F[0]?B:K);A[1]+=F[1]*(0<F[1]?B:K);A[2]+=F[2]*(0<F[2]?B:K);A[3]+=G[0]*(0>G[0]?B:K);A[4]+=G[1]*(0>G[1]?B:K);A[5]+=
G[2]*(0>G[2]?B:K);return A}applyToMbs(A){const F=m.length(A);m.scaleAndAdd(this._mbs,A,A,this._totalOffset/F);this._mbs[3]=A[3]+A[3]*this._totalOffset/F;return this._mbs}applyToObb(A){e.computeOffsetObb(A,this._totalOffset,this._totalOffset,l.ViewingMode.Global,this._obb);return this._obb}}class x{constructor(A=0){this.offset=A;this.sphere=c.create();this.tmpVertex=f.create()}applyToVertex(A,F,G){var I=this.objectTransform.transform;A=m.set(v,A,F,G);I=m.transformMat4(A,A,I);A=this.offset/m.length(I);
m.scaleAndAdd(I,I,I,A);m.transformMat4(this.tmpVertex,I,this.objectTransform.inverse);return this.tmpVertex}applyToMinMax(A,F){const G=this.offset/m.length(A);m.scaleAndAdd(A,A,A,G);A=this.offset/m.length(F);m.scaleAndAdd(F,F,F,A)}applyToAabb(A){var F=this.offset/Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]+=A[0]*F;A[1]+=A[1]*F;A[2]+=A[2]*F;F=this.offset/Math.sqrt(A[3]*A[3]+A[4]*A[4]+A[5]*A[5]);A[3]+=A[3]*F;A[4]+=A[4]*F;A[5]+=A[5]*F;return A}applyToBoundingSphere(A){const F=m.length(A);m.scaleAndAdd(this.sphere,
A,A,this.offset/F);this.sphere[3]=A[3]+A[3]*this.offset/F;return this.sphere}}const n=new x,q=new w,t=new u,v=f.create(),r=f.create(),y=f.create(),z=f.create(),D=f.create(),C=f.create(),E=f.create();a.I3SVerticalOffsetGlobalViewingMode=w;a.IntersectorTransform=p;a.Object3DVerticalOffsetGlobalViewingMode=x;a.TerrainVerticalOffsetGlobalViewingMode=u;a.getVerticalOffsetI3S=function(A){return null!=A?(q.offset=A,q):null};a.getVerticalOffsetObject3D=function(A){return null!=A?(n.offset=A,n):null};a.getVerticalOffsetTerrain=
function(A){return null!=A?(t.offset=A,t):null};a.terrainId="terrain";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,b){function g(J,M){J[0]=M[0];J[1]=M[1];J[2]=M[2];J[3]=M[4];J[4]=M[5];J[5]=M[6];J[6]=M[8];J[7]=M[9];J[8]=M[10];return J}function d(J,M){J[0]=M[0];J[1]=M[1];J[2]=M[2];J[3]=M[3];J[4]=M[4];J[5]=M[5];J[6]=M[6];J[7]=M[7];J[8]=M[8];return J}function k(J,M,T,Q,O,U,Z,P,R,W){J[0]=M;J[1]=T;J[2]=Q;J[3]=O;J[4]=
U;J[5]=Z;J[6]=P;J[7]=R;J[8]=W;return J}function m(J){J[0]=1;J[1]=0;J[2]=0;J[3]=0;J[4]=1;J[5]=0;J[6]=0;J[7]=0;J[8]=1;return J}function f(J,M){if(J===M){const T=M[1],Q=M[2],O=M[5];J[1]=M[3];J[2]=M[6];J[3]=T;J[5]=M[7];J[6]=Q;J[7]=O}else J[0]=M[0],J[1]=M[3],J[2]=M[6],J[3]=M[1],J[4]=M[4],J[5]=M[7],J[6]=M[2],J[7]=M[5],J[8]=M[8];return J}function c(J,M){const T=M[0],Q=M[1],O=M[2],U=M[3],Z=M[4],P=M[5],R=M[6],W=M[7];M=M[8];const N=M*Z-P*W,V=-M*U+P*R,S=W*U-Z*R;let X=T*N+Q*V+O*S;if(!X)return null;X=1/X;J[0]=
N*X;J[1]=(-M*Q+O*W)*X;J[2]=(P*Q-O*Z)*X;J[3]=V*X;J[4]=(M*T-O*R)*X;J[5]=(-P*T+O*U)*X;J[6]=S*X;J[7]=(-W*T+Q*R)*X;J[8]=(Z*T-Q*U)*X;return J}function l(J,M){const T=M[0],Q=M[1],O=M[2],U=M[3],Z=M[4],P=M[5],R=M[6],W=M[7];M=M[8];J[0]=Z*M-P*W;J[1]=O*W-Q*M;J[2]=Q*P-O*Z;J[3]=P*R-U*M;J[4]=T*M-O*R;J[5]=O*U-T*P;J[6]=U*W-Z*R;J[7]=Q*R-T*W;J[8]=T*Z-Q*U;return J}function e(J){const M=J[3],T=J[4],Q=J[5],O=J[6],U=J[7],Z=J[8];return J[0]*(Z*T-Q*U)+J[1]*(-Z*M+Q*O)+J[2]*(U*M-T*O)}function p(J,M,T){const Q=M[0],O=M[1],U=
M[2],Z=M[3],P=M[4],R=M[5],W=M[6],N=M[7];M=M[8];const V=T[0],S=T[1],X=T[2],ca=T[3],ba=T[4],ia=T[5],ka=T[6],na=T[7];T=T[8];J[0]=V*Q+S*Z+X*W;J[1]=V*O+S*P+X*N;J[2]=V*U+S*R+X*M;J[3]=ca*Q+ba*Z+ia*W;J[4]=ca*O+ba*P+ia*N;J[5]=ca*U+ba*R+ia*M;J[6]=ka*Q+na*Z+T*W;J[7]=ka*O+na*P+T*N;J[8]=ka*U+na*R+T*M;return J}function h(J,M,T){const Q=M[0],O=M[1],U=M[2],Z=M[3],P=M[4],R=M[5],W=M[6],N=M[7];M=M[8];const V=T[0];T=T[1];J[0]=Q;J[1]=O;J[2]=U;J[3]=Z;J[4]=P;J[5]=R;J[6]=V*Q+T*Z+W;J[7]=V*O+T*P+N;J[8]=V*U+T*R+M;return J}
function u(J,M,T){const Q=M[0],O=M[1],U=M[2],Z=M[3],P=M[4],R=M[5],W=M[6],N=M[7];M=M[8];const V=Math.sin(T);T=Math.cos(T);J[0]=T*Q+V*Z;J[1]=T*O+V*P;J[2]=T*U+V*R;J[3]=T*Z-V*Q;J[4]=T*P-V*O;J[5]=T*R-V*U;J[6]=W;J[7]=N;J[8]=M;return J}function w(J,M,T){const Q=T[0],O=T[1];T=T[2];J[0]=Q*M[0];J[1]=Q*M[1];J[2]=Q*M[2];J[3]=O*M[3];J[4]=O*M[4];J[5]=O*M[5];J[6]=T*M[6];J[7]=T*M[7];J[8]=T*M[8];return J}function x(J,M,T){const Q=T[0];T=T[1];J[0]=Q*M[0];J[1]=Q*M[1];J[2]=Q*M[2];J[3]=T*M[3];J[4]=T*M[4];J[5]=T*M[5];
return J}function n(J,M){J[0]=1;J[1]=0;J[2]=0;J[3]=0;J[4]=1;J[5]=0;J[6]=M[0];J[7]=M[1];J[8]=1;return J}function q(J,M){const T=Math.sin(M);M=Math.cos(M);J[0]=M;J[1]=T;J[2]=0;J[3]=-T;J[4]=M;J[5]=0;J[6]=0;J[7]=0;J[8]=1;return J}function t(J,M){J[0]=M[0];J[1]=0;J[2]=0;J[3]=0;J[4]=M[1];J[5]=0;J[6]=0;J[7]=0;J[8]=1;return J}function v(J,M){J[0]=M[0];J[1]=M[1];J[2]=0;J[3]=M[2];J[4]=M[3];J[5]=0;J[6]=M[4];J[7]=M[5];J[8]=1;return J}function r(J,M){var T=M[0],Q=M[1],O=M[2];M=M[3];var U=T+T,Z=Q+Q;const P=O+O;
T*=U;const R=Q*U;Q*=Z;const W=O*U,N=O*Z;O*=P;U*=M;Z*=M;M*=P;J[0]=1-Q-O;J[3]=R-M;J[6]=W+Z;J[1]=R+M;J[4]=1-T-O;J[7]=N-U;J[2]=W-Z;J[5]=N+U;J[8]=1-T-Q;return J}function y(J,M){const T=M[0],Q=M[1],O=M[2],U=M[4],Z=M[5],P=M[6],R=M[8],W=M[9];M=M[10];const N=M*Z-P*W,V=-M*U+P*R,S=W*U-Z*R;var X=T*N+Q*V+O*S;if(!X)return null;X=1/X;J[0]=N*X;J[1]=(-M*Q+O*W)*X;J[2]=(P*Q-O*Z)*X;J[3]=V*X;J[4]=(M*T-O*R)*X;J[5]=(-P*T+O*U)*X;J[6]=S*X;J[7]=(-W*T+Q*R)*X;J[8]=(Z*T-Q*U)*X;return J}function z(J,M){const T=M[0],Q=M[1],O=M[2],
U=M[3],Z=M[4],P=M[5],R=M[6],W=M[7];var N=M[8],V=M[9],S=M[10],X=M[11];const ca=M[12],ba=M[13],ia=M[14];M=M[15];const ka=T*P-Q*Z,na=T*R-O*Z,Y=T*W-U*Z,ea=Q*R-O*P,fa=Q*W-U*P,aa=O*W-U*R,da=N*ba-V*ca,ma=N*ia-S*ca;N=N*M-X*ca;const ua=V*ia-S*ba;V=V*M-X*ba;S=S*M-X*ia;X=ka*S-na*V+Y*ua+ea*N-fa*ma+aa*da;if(!X)return null;X=1/X;J[0]=(P*S-R*V+W*ua)*X;J[1]=(R*N-Z*S-W*ma)*X;J[2]=(Z*V-P*N+W*da)*X;J[3]=(O*V-Q*S-U*ua)*X;J[4]=(T*S-O*N+U*ma)*X;J[5]=(Q*N-T*V-U*da)*X;J[6]=(ba*aa-ia*fa+M*ea)*X;J[7]=(ia*Y-ca*aa-M*na)*X;J[8]=
(ca*fa-ba*Y+M*ka)*X;return J}function D(J,M,T){J[0]=2/M;J[1]=0;J[2]=0;J[3]=0;J[4]=-2/T;J[5]=0;J[6]=-1;J[7]=1;J[8]=1;return J}function C(J){return"mat3("+J[0]+", "+J[1]+", "+J[2]+", "+J[3]+", "+J[4]+", "+J[5]+", "+J[6]+", "+J[7]+", "+J[8]+")"}function E(J){return Math.sqrt(J[0]**2+J[1]**2+J[2]**2+J[3]**2+J[4]**2+J[5]**2+J[6]**2+J[7]**2+J[8]**2)}function A(J,M,T){J[0]=M[0]+T[0];J[1]=M[1]+T[1];J[2]=M[2]+T[2];J[3]=M[3]+T[3];J[4]=M[4]+T[4];J[5]=M[5]+T[5];J[6]=M[6]+T[6];J[7]=M[7]+T[7];J[8]=M[8]+T[8];return J}
function F(J,M,T){J[0]=M[0]-T[0];J[1]=M[1]-T[1];J[2]=M[2]-T[2];J[3]=M[3]-T[3];J[4]=M[4]-T[4];J[5]=M[5]-T[5];J[6]=M[6]-T[6];J[7]=M[7]-T[7];J[8]=M[8]-T[8];return J}function G(J,M,T){J[0]=M[0]*T;J[1]=M[1]*T;J[2]=M[2]*T;J[3]=M[3]*T;J[4]=M[4]*T;J[5]=M[5]*T;J[6]=M[6]*T;J[7]=M[7]*T;J[8]=M[8]*T;return J}function I(J,M,T,Q){J[0]=M[0]+T[0]*Q;J[1]=M[1]+T[1]*Q;J[2]=M[2]+T[2]*Q;J[3]=M[3]+T[3]*Q;J[4]=M[4]+T[4]*Q;J[5]=M[5]+T[5]*Q;J[6]=M[6]+T[6]*Q;J[7]=M[7]+T[7]*Q;J[8]=M[8]+T[8]*Q;return J}function H(J,M){return J[0]===
M[0]&&J[1]===M[1]&&J[2]===M[2]&&J[3]===M[3]&&J[4]===M[4]&&J[5]===M[5]&&J[6]===M[6]&&J[7]===M[7]&&J[8]===M[8]}function B(J,M){const T=J[0],Q=J[1],O=J[2],U=J[3],Z=J[4],P=J[5],R=J[6],W=J[7];J=J[8];const N=M[0],V=M[1],S=M[2],X=M[3],ca=M[4],ba=M[5],ia=M[6],ka=M[7];M=M[8];const na=b.getEpsilon();return Math.abs(T-N)<=na*Math.max(1,Math.abs(T),Math.abs(N))&&Math.abs(Q-V)<=na*Math.max(1,Math.abs(Q),Math.abs(V))&&Math.abs(O-S)<=na*Math.max(1,Math.abs(O),Math.abs(S))&&Math.abs(U-X)<=na*Math.max(1,Math.abs(U),
Math.abs(X))&&Math.abs(Z-ca)<=na*Math.max(1,Math.abs(Z),Math.abs(ca))&&Math.abs(P-ba)<=na*Math.max(1,Math.abs(P),Math.abs(ba))&&Math.abs(R-ia)<=na*Math.max(1,Math.abs(R),Math.abs(ia))&&Math.abs(W-ka)<=na*Math.max(1,Math.abs(W),Math.abs(ka))&&Math.abs(J-M)<=na*Math.max(1,Math.abs(J),Math.abs(M))}function K(J){const M=b.getEpsilon(),T=J[0],Q=J[1],O=J[2],U=J[3],Z=J[4],P=J[5],R=J[6],W=J[7];J=J[8];return Math.abs(1-(T*T+U*U+R*R))<=M&&Math.abs(1-(Q*Q+Z*Z+W*W))<=M&&Math.abs(1-(O*O+P*P+J*J))<=M}const L=Object.freeze(Object.defineProperty({__proto__:null,
add:A,adjoint:l,copy:d,determinant:e,equals:B,exactEquals:H,frob:E,fromMat2d:v,fromMat4:g,fromQuat:r,fromRotation:q,fromScaling:t,fromTranslation:n,identity:m,invert:c,isOrthoNormal:K,mul:p,multiply:p,multiplyScalar:G,multiplyScalarAndAdd:I,normalFromMat4:z,normalFromMat4Legacy:y,projection:D,rotate:u,scale:w,scaleByVec2:x,set:k,str:C,sub:F,subtract:F,translate:h,transpose:f},Symbol.toStringTag,{value:"Module"}));a.add=A;a.adjoint=l;a.copy=d;a.determinant=e;a.equals=B;a.exactEquals=H;a.frob=E;a.fromMat2d=
v;a.fromMat4=g;a.fromQuat=r;a.fromRotation=q;a.fromScaling=t;a.fromTranslation=n;a.identity=m;a.invert=c;a.isOrthoNormal=K;a.mat3=L;a.mul=p;a.multiply=p;a.multiplyScalar=G;a.multiplyScalarAndAdd=I;a.normalFromMat4=z;a.normalFromMat4Legacy=y;a.projection=D;a.rotate=u;a.scale=w;a.scaleByVec2=x;a.set=k;a.str=C;a.sub=F;a.subtract=F;a.translate=h;a.transpose=f})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ../../ViewingMode ./dito".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(G=[0,0,0],I=[-1,-1,-1],H=k.create()){return{center:f.clone(G),halfSize:f.clone(I),quaternion:k.clone(H)}}function x(G,I){const H=p.signedDistance(I,G.center);G=n(G,p.normal(I));return H>G?1:H<-G?-1:0}function n(G,I){d.conjugate(q,G.quaternion);m.transformQuat(t,I,q);G=G.halfSize;return Math.abs(t[0]*G[0])+Math.abs(t[1]*G[1])+Math.abs(t[2]*G[2])}const q=k.create(),t=f.create(),v=f.create(),r=l.create(),y=g.create(),z=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,
1.2],D=(()=>{const G=new Int8Array(162);let I=0;const H=B=>{for(let K=0;K<B.length;K++)G[I+K]=B[K];I+=6};H([6,2,3,1,5,4]);H([0,2,3,1,5,4]);H([0,2,3,7,5,4]);H([0,1,3,2,6,4]);H([0,1,3,2,0,0]);H([0,1,5,7,3,2]);H([0,1,3,7,6,4]);H([0,1,3,7,6,2]);H([0,1,5,7,6,2]);H([0,1,5,4,6,2]);H([0,1,5,4,0,0]);H([0,1,3,7,5,4]);H([0,2,6,4,0,0]);H([0,0,0,0,0,0]);H([1,3,7,5,0,0]);H([2,3,7,6,4,0]);H([2,3,7,6,0,0]);H([2,3,1,5,7,6]);H([0,1,5,7,6,2]);H([0,1,5,7,6,4]);H([0,1,3,7,6,4]);H([4,5,7,6,2,0]);H([4,5,7,6,0,0]);H([4,
5,1,3,7,6]);H([0,2,3,7,5,4]);H([6,2,3,7,5,4]);H([6,2,3,1,5,4]);return G})(),C=f.create(),E=f.create(),A=f.create(),F=k.create();a.clone=function(G){return w(G.center,G.halfSize,G.quaternion)};a.compute=function(G,I){I=I||w();u.computeOBB(G,I);return I};a.computeOffsetObb=function(G,I,H,B,K){d.copy(K.quaternion,G.quaternion);if(B===h.ViewingMode.Global){d.conjugate(F,G.quaternion);m.transformQuat(C,G.center,F);m.abs(E,C);m.min(A,E,G.halfSize);m.sub(A,E,A);B=m.length(A);m.add(A,E,G.halfSize);const L=
m.length(A);B<H?(m.copy(K.center,G.center),m.set(C,H,H,H),m.add(K.halfSize,G.halfSize,C)):(I=0<L?1+I/L:1,B=0<B?1+H/B:1,H=(B+I)/2,I=(B-I)/2,m.scale(K.halfSize,E,I),m.scaleAndAdd(K.halfSize,K.halfSize,G.halfSize,H),m.scale(K.center,E,H),m.scaleAndAdd(K.center,K.center,G.halfSize,I),m.sign(C,C),m.multiply(K.center,K.center,C),m.transformQuat(K.center,K.center,K.quaternion))}else B=m.set(C,0,0,1),m.scaleAndAdd(K.center,G.center,B,(H+I)/2),d.conjugate(F,G.quaternion),m.transformQuat(B,B,F),m.abs(B,B),
m.scaleAndAdd(K.halfSize,G.halfSize,B,(H-I)/2);return K};a.corners=function(G,I){for(let H=0;8>H;++H){const B=I[H];B[0]=H&1?-G.halfSize[0]:G.halfSize[0];B[1]=H&2?-G.halfSize[1]:G.halfSize[1];B[2]=H&4?-G.halfSize[2]:G.halfSize[2];m.transformQuat(B,B,G.quaternion);m.add(B,B,G.center)}};a.create=w;a.intersectLine=function(G,I,H,B=0){d.conjugate(q,G.quaternion);m.subtract(t,I,G.center);I=m.transformQuat(t,t,q);H=m.transformQuat(v,H,q);let K=-Infinity,L=Infinity;for(let J=0;3>J;J++)if(1E-6<Math.abs(H[J])){const M=
(B+G.halfSize[J]-I[J])/H[J],T=(-B-G.halfSize[J]-I[J])/H[J];K=Math.max(K,Math.min(M,T));L=Math.min(L,Math.max(M,T))}else if(I[J]>G.halfSize[J]+B||I[J]<-G.halfSize[J]-B)return!1;return K<=L};a.intersectPlane=x;a.intersectSphere=function(G,I){t[0]=G.center[0]-I[0];t[1]=G.center[1]-I[1];t[2]=G.center[2]-I[2];d.conjugate(q,G.quaternion);m.transformQuat(t,t,q);m.abs(t,t);m.min(v,t,G.halfSize);return m.sqrDist(v,t)<I[3]*I[3]};a.isVisible=function(G,I){return 0>=x(G,I[0])&&0>=x(G,I[1])&&0>=x(G,I[2])&&0>=
x(G,I[3])&&0>=x(G,I[4])&&0>=x(G,I[5])};a.maximumDistancePlane=function(G,I){const H=p.signedDistance(I,G.center);G=n(G,p.normal(I));return H+G};a.minimumDistancePlane=function(G,I){const H=p.signedDistance(I,G.center);G=n(G,p.normal(I));return H-G};a.projectedArea=function(G,I,H,B,K){d.conjugate(q,G.quaternion);m.sub(t,I,G.center);m.transformQuat(t,t,q);var L=t[0]<-G.halfSize[0]?-1:t[0]>G.halfSize[0]?1:0,J=t[1]<-G.halfSize[1]?-1:t[1]>G.halfSize[1]?1:0,M=t[2]<-G.halfSize[2]?-1:t[2]>G.halfSize[2]?1:
0;I=Math.abs(L)+Math.abs(J)+Math.abs(M);if(0===I)return Infinity;I=1===I?4:6;L=6*(L+3*J+9*M+13);b.fromQuat(y,G.quaternion);b.scale(y,y,G.halfSize);for(J=0;J<I;J++)M=D[L+J],m.set(t,((M&1)<<1)-1,(M&2)-1,((M&4)>>1)-1),m.transformMat3(t,t,y),m.add(r,G.center,t),r[3]=1,c.transformMat4(r,r,H),M=1/Math.max(1E-6,r[3]),z[2*J]=r[0]*M,z[2*J+1]=r[1]*M;G=2*I-2;H=z[0]*(z[3]-z[G+1])+z[G]*(z[1]-z[G-1]);for(I=2;I<G;I+=2)H+=z[I]*(z[I+3]-z[I-1]);return Math.abs(H)*B*K*.125};a.projectedRadius=n;a.radius=function(G){return m.len(G.halfSize)};
a.set=function(G,I){m.copy(I.center,G.center);m.copy(I.halfSize,G.halfSize);d.copy(I.quaternion,G.quaternion)};a.toAaBoundingBox=function(G,I){I||(I=e.create());var H=b.fromQuat(y,G.quaternion);const B=G.halfSize[0]*Math.abs(H[0])+G.halfSize[1]*Math.abs(H[3])+G.halfSize[2]*Math.abs(H[6]),K=G.halfSize[0]*Math.abs(H[1])+G.halfSize[1]*Math.abs(H[4])+G.halfSize[2]*Math.abs(H[7]);H=G.halfSize[0]*Math.abs(H[2])+G.halfSize[1]*Math.abs(H[5])+G.halfSize[2]*Math.abs(H[8]);I[0]=G.center[0]-B;I[1]=G.center[1]-
K;I[2]=G.center[2]-H;I[3]=G.center[0]+B;I[4]=G.center[1]+K;I[5]=G.center[2]+H;return I};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,b,g,d,k,m,f){function c(R){R[0]=0;R[1]=0;R[2]=0;R[3]=1;return R}function l(R,W,N){N*=.5;const V=Math.sin(N);R[0]=V*W[0];R[1]=V*W[1];R[2]=V*W[2];R[3]=Math.cos(N);return R}function e(R,W){const N=2*Math.acos(W[3]),V=Math.sin(N/2);
V>k.getEpsilon()?(R[0]=W[0]/V,R[1]=W[1]/V,R[2]=W[2]/V):(R[0]=1,R[1]=0,R[2]=0);return N}function p(R,W,N){const V=W[0],S=W[1],X=W[2];W=W[3];const ca=N[0],ba=N[1],ia=N[2];N=N[3];R[0]=V*N+W*ca+S*ia-X*ba;R[1]=S*N+W*ba+X*ca-V*ia;R[2]=X*N+W*ia+V*ba-S*ca;R[3]=W*N-V*ca-S*ba-X*ia;return R}function h(R,W,N){N*=.5;const V=W[0],S=W[1],X=W[2];W=W[3];const ca=Math.sin(N);N=Math.cos(N);R[0]=V*N+W*ca;R[1]=S*N+X*ca;R[2]=X*N-S*ca;R[3]=W*N-V*ca;return R}function u(R,W,N){N*=.5;const V=W[0],S=W[1],X=W[2];W=W[3];const ca=
Math.sin(N);N=Math.cos(N);R[0]=V*N-X*ca;R[1]=S*N+W*ca;R[2]=X*N+V*ca;R[3]=W*N-S*ca;return R}function w(R,W,N){N*=.5;const V=W[0],S=W[1],X=W[2];W=W[3];const ca=Math.sin(N);N=Math.cos(N);R[0]=V*N+S*ca;R[1]=S*N-V*ca;R[2]=X*N+W*ca;R[3]=W*N-X*ca;return R}function x(R,W){const N=W[0],V=W[1];W=W[2];R[0]=N;R[1]=V;R[2]=W;R[3]=Math.sqrt(Math.abs(1-N*N-V*V-W*W));return R}function n(R,W,N,V){const S=W[0],X=W[1],ca=W[2];W=W[3];let ba=N[0],ia=N[1],ka=N[2];N=N[3];let na;let Y;var ea=S*ba+X*ia+ca*ka+W*N;0>ea&&(ea=
-ea,ba=-ba,ia=-ia,ka=-ka,N=-N);1-ea>k.getEpsilon()?(na=Math.acos(ea),Y=Math.sin(na),ea=Math.sin((1-V)*na)/Y,V=Math.sin(V*na)/Y):ea=1-V;R[0]=ea*S+V*ba;R[1]=ea*X+V*ia;R[2]=ea*ca+V*ka;R[3]=ea*W+V*N;return R}function q(R){var W=k.RANDOM,N=W();const V=W();W=W();const S=Math.sqrt(1-N);N=Math.sqrt(N);R[0]=S*Math.sin(2*Math.PI*V);R[1]=S*Math.cos(2*Math.PI*V);R[2]=N*Math.sin(2*Math.PI*W);R[3]=N*Math.cos(2*Math.PI*W);return R}function t(R,W){const N=W[0],V=W[1],S=W[2];W=W[3];var X=N*N+V*V+S*S+W*W;X=X?1/X:0;
R[0]=-N*X;R[1]=-V*X;R[2]=-S*X;R[3]=W*X;return R}function v(R,W){R[0]=-W[0];R[1]=-W[1];R[2]=-W[2];R[3]=W[3];return R}function r(R,W){var N=W[0]+W[4]+W[8];if(0<N)N=Math.sqrt(N+1),R[3]=.5*N,N=.5/N,R[0]=(W[5]-W[7])*N,R[1]=(W[6]-W[2])*N,R[2]=(W[1]-W[3])*N;else{let V=0;W[4]>W[0]&&(V=1);W[8]>W[3*V+V]&&(V=2);const S=(V+1)%3,X=(V+2)%3;N=Math.sqrt(W[3*V+V]-W[3*S+S]-W[3*X+X]+1);R[V]=.5*N;N=.5/N;R[3]=(W[3*S+X]-W[3*X+S])*N;R[S]=(W[3*S+V]+W[3*V+S])*N;R[X]=(W[3*X+V]+W[3*V+X])*N}return R}function y(R,W,N,V){var S=
.5*Math.PI/180;W*=S;N*=S;V*=S;S=Math.sin(W);W=Math.cos(W);const X=Math.sin(N);N=Math.cos(N);const ca=Math.sin(V);V=Math.cos(V);R[0]=S*N*V-W*X*ca;R[1]=W*X*V+S*N*ca;R[2]=W*N*ca-S*X*V;R[3]=W*N*V+S*X*ca;return R}function z(R){return"quat("+R[0]+", "+R[1]+", "+R[2]+", "+R[3]+")"}function D(R,W,N){const V=m.dot(W,N);if(-.999999>V)return m.cross(T,Q,W),1E-6>m.len(T)&&m.cross(T,O,W),m.normalize(T,T),l(R,T,Math.PI),R;if(.999999<V)return R[0]=0,R[1]=0,R[2]=0,R[3]=1,R;m.cross(T,W,N);R[0]=T[0];R[1]=T[1];R[2]=
T[2];R[3]=1+V;return J(R,R)}function C(R,W,N,V,S,X){n(U,W,S,X);n(Z,N,V,X);n(R,U,Z,2*X*(1-X));return R}function E(R,W,N,V){const S=P;S[0]=N[0];S[3]=N[1];S[6]=N[2];S[1]=V[0];S[4]=V[1];S[7]=V[2];S[2]=-W[0];S[5]=-W[1];S[8]=-W[2];return J(R,r(R,S))}const A=f.copy,F=f.set,G=f.add,I=f.scale,H=f.dot,B=f.lerp,K=f.length,L=f.squaredLength,J=f.normalize,M=f.exactEquals;f=f.equals;const T=d.create(),Q=d.fromValues(1,0,0),O=d.fromValues(0,1,0),U=g.create(),Z=g.create(),P=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,
add:G,calculateW:x,conjugate:v,copy:A,dot:H,equals:f,exactEquals:M,fromEuler:y,fromMat3:r,getAxisAngle:e,identity:c,invert:t,len:K,length:K,lerp:B,mul:p,multiply:p,normalize:J,random:q,rotateX:h,rotateY:u,rotateZ:w,rotationTo:D,scale:I,set:F,setAxes:E,setAxisAngle:l,slerp:n,sqlerp:C,sqrLen:L,squaredLength:L,str:z},Symbol.toStringTag,{value:"Module"}));a.add=G;a.calculateW=x;a.conjugate=v;a.copy=A;a.dot=H;a.equals=f;a.exactEquals=M;a.fromEuler=y;a.fromMat3=r;a.getAxisAngle=e;a.identity=c;a.invert=
t;a.len=K;a.length=K;a.lerp=B;a.mul=p;a.multiply=p;a.normalize=J;a.quat=b;a.random=q;a.rotateX=h;a.rotateY=u;a.rotateZ=w;a.rotationTo=D;a.scale=I;a.set=F;a.setAxes=E;a.setAxisAngle=l;a.slerp=n;a.sqlerp=C;a.sqrLen=L;a.squaredLength=L;a.str=z})},"esri/views/3d/support/dito":function(){define(["exports","../webgl-engine/lib/Attribute"],function(a,b){function g(S,X,ca,ba,ia,ka){if(!(1E-6>X[0]*X[0]+X[1]*X[1]+X[2]*X[2]))for(u(G,ca,X),u(I,ba,X),u(H,ia,X),d(S,X,F),K[1]=F[0],B[1]=F[1],L[1]=B[1]-K[1],ca=[ca,
ba,ia],ba=[G,I,H],ia=0;3>ia;++ia){d(S,ca[ia],F);K[0]=F[0];B[0]=F[1];d(S,ba[ia],F);K[2]=F[0];B[2]=F[1];L[0]=B[0]-K[0];L[2]=B[2]-K[2];const na=c(L);na<ka.quality&&(h(ka.b0,ca[ia]),h(ka.b1,X),h(ka.b2,ba[ia]),ka.quality=na)}}function d(S,X,ca){const {data:ba,size:ia}=S;ca[0]=Number.POSITIVE_INFINITY;ca[1]=Number.NEGATIVE_INFINITY;for(S=0;S<ba.length;S+=ia){const ka=ba[S]*X[0]+ba[S+1]*X[1]+ba[S+2]*X[2];ca[0]=Math.min(ca[0],ka);ca[1]=Math.max(ca[1],ka)}}function k(S,X,ca){h(ca.center,S);p(ca.halfSize,X,
.5);ca.quaternion[0]=0;ca.quaternion[1]=0;ca.quaternion[2]=0;ca.quaternion[3]=1}function m(S,X,ca,ba,ia,ka){d(S,X,F);ia[0]=F[0];ka[0]=F[1];d(S,ca,F);ia[1]=F[0];ka[1]=F[1];d(S,ba,F);ia[2]=F[0];ka[2]=F[1]}function f(S,X,ca,ba,ia,ka,na){R[0]=S[0];R[1]=S[1];R[2]=S[2];R[3]=X[0];R[4]=X[1];R[5]=X[2];R[6]=ca[0];R[7]=ca[1];R[8]=ca[2];var Y=na.quaternion,ea=R,fa=ea[0]+ea[4]+ea[8];if(0<fa)fa=Math.sqrt(fa+1),Y[3]=.5*fa,fa=.5/fa,Y[0]=(ea[5]-ea[7])*fa,Y[1]=(ea[6]-ea[2])*fa,Y[2]=(ea[1]-ea[3])*fa;else{fa=0;ea[4]>
ea[0]&&(fa=1);ea[8]>ea[3*fa+fa]&&(fa=2);const aa=(fa+1)%3,da=(fa+2)%3;let ma=Math.sqrt(ea[3*fa+fa]-ea[3*aa+aa]-ea[3*da+da]+1);Y[fa]=.5*ma;ma=.5/ma;Y[3]=(ea[3*aa+da]-ea[3*da+aa])*ma;Y[aa]=(ea[3*aa+fa]+ea[3*fa+aa])*ma;Y[da]=(ea[3*da+fa]+ea[3*fa+da])*ma}l(W,ba,ia);p(W,W,.5);p(na.center,S,W[0]);p(P,X,W[1]);l(na.center,na.center,P);p(P,ca,W[2]);l(na.center,na.center,P);p(na.halfSize,ka,.5)}function c(S){return S[0]*S[1]+S[0]*S[2]+S[1]*S[2]}function l(S,X,ca){S[0]=X[0]+ca[0];S[1]=X[1]+ca[1];S[2]=X[2]+ca[2]}
function e(S,X,ca){S[0]=X[0]-ca[0];S[1]=X[1]-ca[1];S[2]=X[2]-ca[2]}function p(S,X,ca){S[0]=X[0]*ca;S[1]=X[1]*ca;S[2]=X[2]*ca}function h(S,X,ca=0){S[0]=X[ca];S[1]=X[ca+1];S[2]=X[ca+2]}function u(S,X,ca){const ba=X[0],ia=X[1];X=X[2];const ka=ca[0],na=ca[1];ca=ca[2];S[0]=ia*ca-X*na;S[1]=X*ka-ba*ca;S[2]=ba*na-ia*ka}function w(S,X){var ca=X[0]*X[0]+X[1]*X[1]+X[2]*X[2];0<ca&&(ca=1/Math.sqrt(ca),S[0]=X[0]*ca,S[1]=X[1]*ca,S[2]=X[2]*ca)}function x(S,X){const ca=X[0]-S[0],ba=X[1]-S[1];S=X[2]-S[2];return ca*
ca+ba*ba+S*S}const n=[0,0,0],q=[0,0,0],t=[0,0,0],v=[0,0,0],r=[0,0,0],y=[0,0,0],z=[0,0,0],D=[0,0,0],C=[0,0,0],E=[0,0,0],A=[0,0,0],F=[0,0],G=[0,0,0],I=[0,0,0],H=[0,0,0],B=[0,0,0],K=[0,0,0],L=[0,0,0],J=[0,0,0],M=[0,0,0],T=[0,0,0],Q=[0,0,0],O=[0,0,0],U=[0,0,0],Z=[0,0,0],P=[0,0,0],R=[1,0,0,0,1,0,0,0,1],W=[0,0,0];class N{constructor(S){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var X=0;this.minProj=new Float64Array(this.buffer,X,7);X+=56;this.maxProj=new Float64Array(this.buffer,
X,7);X+=56;for(var ca=0;7>ca;++ca)this.minVert[ca]=new Float64Array(this.buffer,X,3),X+=24;for(ca=0;7>ca;++ca)this.maxVert[ca]=new Float64Array(this.buffer,X,3),X+=24;for(X=0;7>X;++X)this.minProj[X]=Number.POSITIVE_INFINITY,this.maxProj[X]=Number.NEGATIVE_INFINITY;X=Array(7);ca=Array(7);const {data:ba,size:ia}=S;for(S=0;S<ba.length;S+=ia){var ka=ba[S];ka<this.minProj[0]&&(this.minProj[0]=ka,X[0]=S);ka>this.maxProj[0]&&(this.maxProj[0]=ka,ca[0]=S);ka=ba[S+1];ka<this.minProj[1]&&(this.minProj[1]=ka,
X[1]=S);ka>this.maxProj[1]&&(this.maxProj[1]=ka,ca[1]=S);ka=ba[S+2];ka<this.minProj[2]&&(this.minProj[2]=ka,X[2]=S);ka>this.maxProj[2]&&(this.maxProj[2]=ka,ca[2]=S);ka=ba[S]+ba[S+1]+ba[S+2];ka<this.minProj[3]&&(this.minProj[3]=ka,X[3]=S);ka>this.maxProj[3]&&(this.maxProj[3]=ka,ca[3]=S);ka=ba[S]+ba[S+1]-ba[S+2];ka<this.minProj[4]&&(this.minProj[4]=ka,X[4]=S);ka>this.maxProj[4]&&(this.maxProj[4]=ka,ca[4]=S);ka=ba[S]-ba[S+1]+ba[S+2];ka<this.minProj[5]&&(this.minProj[5]=ka,X[5]=S);ka>this.maxProj[5]&&
(this.maxProj[5]=ka,ca[5]=S);ka=ba[S]-ba[S+1]-ba[S+2];ka<this.minProj[6]&&(this.minProj[6]=ka,X[6]=S);ka>this.maxProj[6]&&(this.maxProj[6]=ka,ca[6]=S)}for(S=0;7>S;++S)ka=X[S],h(this.minVert[S],ba,ka),ka=ca[S],h(this.maxVert[S],ba,ka)}}class V{constructor(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0}}a.computeOBB=function(S,X){const {data:ca,size:ba}=S;var ia=ca.length/ba;if(!(0>=ia)){var ka=new N(S);l(n,ka.minProj,ka.maxProj);p(n,n,.5);e(q,ka.maxProj,ka.minProj);var na=c(q),Y=
new V;Y.quality=na;14>ia&&(S=new b.Vertices(new Float64Array(ka.buffer,112,42),3));var ea=[0,0,0],fa=[0,0,0],aa=[0,0,0];ia=[0,0,0];var da=[0,0,0],ma=[0,0,0],ua=[0,0,0];var sa=S;var ra=x(ka.maxVert[0],ka.minVert[0]),Aa=0;for(var qa=1;7>qa;++qa){const oa=x(ka.maxVert[qa],ka.minVert[qa]);oa>ra&&(ra=oa,Aa=qa)}h(ea,ka.minVert[Aa]);h(fa,ka.maxVert[Aa]);if(1E-6>x(ea,fa))sa=1;else{e(ia,ea,fa);w(ia,ia);const {data:oa,size:za}=sa;ka=Number.NEGATIVE_INFINITY;ra=0;for(Aa=0;Aa<oa.length;Aa+=za)A[0]=oa[Aa]-ea[0],
A[1]=oa[Aa+1]-ea[1],A[2]=oa[Aa+2]-ea[2],qa=ia[0]*A[0]+ia[1]*A[1]+ia[2]*A[2],qa=A[0]*A[0]+A[1]*A[1]+A[2]*A[2]-qa*qa/(ia[0]*ia[0]+ia[1]*ia[1]+ia[2]*ia[2]),qa>ka&&(ka=qa,ra=Aa);h(aa,oa,ra);1E-6>ka?sa=2:(e(da,fa,aa),w(da,da),e(ma,aa,ea),w(ma,ma),u(ua,da,ia),w(ua,ua),g(sa,ua,ia,da,ma,Y),sa=0)}switch(sa){case 1:k(n,q,X);return;case 2:na=S;h(M,ia);Math.abs(ia[0])>Math.abs(ia[1])&&Math.abs(ia[0])>Math.abs(ia[2])?M[0]=0:Math.abs(ia[1])>Math.abs(ia[2])?M[1]=0:M[2]=0;1E-6>M[0]*M[0]+M[1]*M[1]+M[2]*M[2]&&(M[0]=
M[1]=M[2]=1);u(T,ia,M);w(T,T);u(Q,ia,T);w(Q,Q);m(na,ia,T,Q,O,U);e(Z,U,O);f(ia,T,Q,O,U,Z,X);return}sa=S;ka=F;const {data:la,size:ja}=sa;h(v,la);h(t,v);ka[0]=J[0]*ua[0]+J[1]*ua[1]+J[2]*ua[2];ka[1]=ka[0];for(ra=ja;ra<la.length;ra+=ja)Aa=la[ra]*ua[0]+la[ra+1]*ua[1]+la[ra+2]*ua[2],Aa<ka[0]&&(ka[0]=Aa,h(v,la,ra)),Aa>ka[1]&&(ka[1]=Aa,h(t,la,ra));ua=ea[0]*ua[0]+ea[1]*ua[1]+ea[2]*ua[2];F[1]-1E-6<=ua&&(t[0]=void 0);F[0]+1E-6>=ua&&(v[0]=void 0);void 0!==t[0]&&(e(r,t,ea),w(r,r),e(y,t,fa),w(y,y),e(z,t,aa),w(z,
z),u(D,y,ia),w(D,D),u(C,z,da),w(C,C),u(E,r,ma),w(E,E),g(sa,D,ia,y,r,Y),g(sa,C,da,z,y,Y),g(sa,E,ma,r,z,Y));void 0!==v[0]&&(e(r,v,ea),w(r,r),e(y,v,fa),w(y,y),e(z,v,aa),w(z,z),u(D,y,ia),w(D,D),u(C,z,da),w(C,C),u(E,r,ma),w(E,E),g(sa,D,ia,y,r,Y),g(sa,C,da,z,y,Y),g(sa,E,ma,r,z,Y));m(S,Y.b0,Y.b1,Y.b2,O,U);S=[0,0,0];e(S,U,O);Y.quality=c(S);Y.quality<na?f(Y.b0,Y.b1,Y.b2,O,U,S,X):k(n,q,X)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],
function(a){class b{constructor(d,k,m=k){this.data=d;this.size=k;this.stride=m}}class g extends b{constructor(d,k,m,f=!1,c=m){super(d,m,c);this.indices=k;this.exclusive=f}}a.Attribute=g;a.Vertices=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection/projectPointToVector ../geometry/projection/projectVectorToVector ../views/3d/support/cameraUtilsInternal".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(z,D,C,E=e.createDirectionUp()){const {direction:A,up:F}=E;g.fromZRotation(v,-b.deg2rad(D));g.rotateX(v,v,b.deg2rad(C));k.transformMat4(A,t,v);k.scale(A,A,-1);k.transformMat4(F,q,v);return E}function h(z,D,C,E){return e.directionToHeadingTilt(D,C,E,t,q)}function u(z,D,C,E){const A=p(z,C,E),F=m.create();k.scale(F,A.direction,-D);k.add(F,F,z);return{up:A.up,eye:F,heading:C,tilt:E}}function w(z){return b.rad2deg(z)}function x(z){return b.deg2rad(z)}function n(z,
D,C,E,A){const F=z.renderSpatialReference;z=z.map&&z.spatialReference||D.spatialReference;c.projectPointToVector(D,r,F);c.projectPointToVector(D,y,F);r[0]-=C/2;y[0]+=C/2;r[1]-=E/2;y[1]+=E/2;l.projectVectorToVector(r,F,r,z);l.projectVectorToVector(y,F,y,z);A?(A.xmin=r[0],A.ymin=r[1],A.xmax=y[0],A.ymax=y[1],A.spatialReference=z):A=new f(r[0],r[1],y[0],y[1],z);return A}const q=m.fromValues(0,1,0),t=m.fromValues(0,0,1),v=d.create(),r=m.create(),y=m.create();d=Object.freeze(Object.defineProperty({__proto__:null,
directionToHeadingTilt:h,eyeForCenterWithHeadingTilt:u,eyeTiltToLookAtTilt:x,headingTiltToDirectionUp:p,lookAtTiltToEyeTilt:w,toExtent:n},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsPlanar=d;a.directionToHeadingTilt=h;a.eyeForCenterWithHeadingTilt=u;a.eyeTiltToLookAtTilt=x;a.headingTiltToDirectionUp=p;a.lookAtTiltToEyeTilt=w;a.toExtent=n})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,
b,g,d){const k=d.create(),m=d.create();a.createDirectionUp=function(){return{direction:d.create(),up:d.create()}};a.directionToHeadingTilt=function(f,c,l,e,p){let h=g.normalize(k,f),u=g.dot(h,e);const w=0<u;u=Math.abs(u);.99<u&&(u=Math.abs(g.dot(c,e)),.99>u?(g.copy(h,c),w&&g.scale(h,h,-1)):h=null);c=0;h&&(g.scale(m,e,g.dot(e,h)),g.subtract(h,h,m),c=g.dot(h,p)/(g.length(h)*g.length(p)),g.cross(m,h,p),c=(0<g.dot(m,e)?1:-1)*b.rad2deg(b.acosClamped(c)));f=b.rad2deg(b.acosClamped(-g.dot(e,f)/g.length(f)));
if(!l)return{heading:c,tilt:f};l.heading=c;l.tilt=f;return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/ellipsoidUtils ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(G,
I,H,B=h.createDirectionUp()){m.cross(A,G,z);0===m.dot(A,A)&&m.cross(A,G,D);d.fromRotation(E,-g.deg2rad(I),G);d.rotate(E,E,-g.deg2rad(H),A);const {up:K,direction:L}=B;m.cross(K,A,G);m.normalize(K,K);m.transformMat4(K,K,E);m.normalize(L,G);m.negate(L,L);m.transformMat4(L,L,E);return B}function x(G,I,H,B){const K=A,L=F;m.normalize(K,G);m.cross(F,K,z);0===m.dot(F,F)&&m.cross(F,K,D);m.cross(L,F,K);return h.directionToHeadingTilt(I,H,B,K,L)}function n(G,I,H,B){const K={eye:f.create(),up:null,tilt:B,heading:H},
L=A;L[0]=G[0];L[1]=G[2];L[2]=-G[1];H=g.deg2rad(H);var J=g.deg2rad(B);B=Math.sin(H);H=Math.cos(H);var M=Math.sin(J),T=Math.cos(J);const Q=m.length(L);if(1E-8>Math.abs(J))J=I+Q;else{var O=Q/M,U=g.asinClamped(I/O);J=O*Math.sin(Math.PI-J-U)}T*=I;O=I*I*M*M;U=H*H*O;const Z=J-T,P=Z*Z;var R=U*(U+P-L[1]*L[1]);if(0>R)return m.scale(K.eye,L,J/Q),K.tilt=0,t(K,G);var W=Math.sqrt(R);const N=L[1]*Z;R=U+P;W=0<H?-W+N:W+N;if(1E-8>Math.abs(R))return 1E-8>Q?(K.eye[0]=0,K.eye[1]=0,K.eye[2]=I):m.scale(K.eye,L,J/Q),K.tilt=
0,q(K.eye),t(K,G);K.eye[1]=W/R;I*=M;W=K.eye[1]*K.eye[1];M=1-W;R=Math.sqrt(M);O=U*W+B*B*O-2*H*I*K.eye[1]*R*Z+M*P;if(1E-8>Math.abs(O))return m.scale(K.eye,L,J/Q),K.tilt=0,q(K.eye),t(K,G);K.eye[0]=(M*(J*L[0]-T*L[0])-I*R*(L[0]*K.eye[1]*H+L[2]*B))/O;K.eye[2]=(M*(J*L[2]-T*L[2])-I*R*(L[2]*K.eye[1]*H-L[0]*B))/O;m.scale(K.eye,K.eye,J);q(K.eye);return t(K,G)}function q(G){const I=G[1];G[1]=-G[2];G[2]=I}function t(G,I){I=w(I,G.heading,G.tilt);G.up=I.up;return G}function v(G,I,H){I=m.length(I);H=g.asinClamped(H/
(Math.sqrt(H*H+I*I-2*H*I*Math.cos(Math.PI-G))/Math.sin(G)));return g.rad2deg(G-H)}function r(G,I,H){G=g.deg2rad(G);I=m.length(I);return g.asinClamped(H/(I/Math.sin(G)))+G}function y(G,I,H,B,K){function L(Q){const O=Math.PI/2;Q=b.cyclical2PI.normalize(Q,-O);Q>O&&(Q=Math.PI-Q);return Q}var J=I.latitude;var M=c.getReferenceEllipsoid(G.spatialReference).radius;I=I.longitude;var T=u.getLonDeltaForDistance(J,H,M)/2;H=I-T;I+=T;J=g.deg2rad(J);J=(1+Math.sin(J))/(1-Math.sin(J));T=(J+1)*Math.tan(B/M/2);J=1.5*
Math.PI-2*Math.atan(.5*(T+Math.sqrt(4*J+T*T)));B=J+B/M;J=L(J);B=L(B);B<J&&(M=B,B=J,J=M);J=Math.max(g.rad2deg(J),-90);B=Math.min(g.rad2deg(B),90);I=C.monotonic(H,I);180<I-H&&(M=(I-H-180)/2,H+=M,I-=M);M=G.spatialReference&&G.spatialReference.isGeographic?G.spatialReference:e.WGS84;K?(K.xmin=H,K.ymin=J,K.xmax=I,K.ymax=B,K.spatialReference=M):K=new l(H,J,I,B,M);G.spatialReference&&G.spatialReference.isWebMercator&&p.geographicToWebMercator(K,!1,K);return K}const z=f.fromValues(0,0,1),D=m.normalize(f.create(),
f.fromValues(1,1,1)),C=new b.Cyclical(-180,180),E=k.create(),A=f.create(),F=f.create();k=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:x,eyeForCenterWithHeadingTilt:n,eyeTiltToLookAtTilt:r,headingTiltToDirectionUp:w,lookAtTiltToEyeTilt:v,toExtent:y},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=k;a.directionToHeadingTilt=x;a.eyeForCenterWithHeadingTilt=n;a.eyeTiltToLookAtTilt=r;a.headingTiltToDirectionUp=w;a.lookAtTiltToEyeTilt=v;a.toExtent=y})},"esri/views/3d/support/earthUtils":function(){define(["exports",
"../../../core/mathUtils","../../../geometry/ellipsoidUtils","../../../geometry/Point"],function(a,b,g,d){function k(c,l,e){if(null==l.longitude||null==l.latitude||null==e.longitude||null==e.latitude)throw Error("Invalid points: no lon/lat");return m(c,l.longitude,l.latitude,e.longitude,e.latitude)}function m(c,l,e,p,h){e=b.deg2rad(e);h=b.deg2rad(h);l=b.deg2rad(l);const u=b.deg2rad(p);p=Math.sin((e-h)/2);l=Math.sin((l-u)/2);e=2*b.asinClamped(Math.sqrt(p*p+Math.cos(e)*Math.cos(h)*l*l));return Math.round(e*
c*1E4)/1E4}function f(c,l){c/=15;l||(c=Math.round(c));return c}a.getGreatCircleDistance=m;a.getGreatCircleDistanceFromPoints=k;a.getGreatCircleSpanAt=function(c,l,e){const p=l.spatialReference,h=g.getReferenceEllipsoid(p),u=new d(l.x,c.y,p),w=new d(e.x,c.y,p);l=new d(c.x,l.y,p);c=new d(c.x,e.y,p);return{lon:k(h.radius,u,w),lat:k(h.radius,l,c)}};a.getLonDeltaForDistance=function(c,l,e){l/=e;c=b.deg2rad(c);l=Math.sin(l/2);c=Math.cos(c);c=2*b.asinClamped(Math.sqrt(l*l/(c*c)));return b.rad2deg(c)};a.longitudeToTimezone=
f;a.positionToTimezoneInfo=function(c,l){c=c?.[0];if(null==c)return null;l||(l={hours:0,minutes:0,seconds:0});l.hours=f(c,!0);c=l.hours%1;l.hours-=c;l.minutes=60*c;c=l.minutes%1;l.minutes-=c;l.seconds=Math.round(60*c);return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../layers/graphics/dehydratedFeatureUtils"],function(a,b){function g(k){return"array"in k}class d{constructor(k,m=null,f=0){this.array=
k;this.spatialReference=m;this.offset=f}}a.SamplePosition=d;a.getElevationAtPoint=function(k,m,f="ground"){if(b.isDehydratedPoint(m))return k.getElevation(m.x,m.y,m.z||0,m.spatialReference,f);if(g(m)){let c=m.offset;return k.getElevation(m.array[c++],m.array[c++],m.array[c]||0,m.spatialReference??k.spatialReference,f)}return k.getElevation(m[0],m[1],m[2]||0,k.spatialReference,f)};a.isSamplePosition=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],
function(a){a.isDehydratedPoint=function(b){return"point"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,b,g){a.isSpatialReferenceSupported=function(d,k){return null==d?!1:null==k?!0:k===g.ViewingMode.Local?d.isGeographic?d.isWGS84||d.wkid===b.SupportedGCSWkids.CGCS2000:!0:d.isWebMercator||d.isWGS84||d.wkid===b.SupportedGCSWkids.CGCS2000||
d.wkid===b.SupportedGCSWkids.GCSMARS2000||d.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||d.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){b=class extends b.EventedAccessor{constructor(w){super(w);this.demResolution={min:-1,max:-1};this.noDataValue=u.elevationNodataValue}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const w=this.view.basemapTerrain;if(null==w?.extent||null==w.spatialReference)return null;const x=e.toExtent(w.extent,w.spatialReference);x.zmin=w.visibleElevationBounds.min;x.zmax=w.visibleElevationBounds.max;return x}get spatialReference(){return this.view.basemapTerrain?.spatialReference??
l.WGS84}elevationAt(w,x){if(null==this.extent||!p.extentContainsXYZ(this.extent,w,x)){const n=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;g.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${w}, ${x}) is outside of the sampler extent (${n})`);return this.noDataValue}return this.view.elevationProvider?.getElevation(w,x,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(w){return h.updateGeometryElevation(w.clone(),
this)}};a.__decorate([d.property({readOnly:!0})],b.prototype,"demResolution",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"noDataValue",void 0);a.__decorate([d.property()],b.prototype,"spatialReference",null);a.__decorate([d.property({constructOnly:!0})],b.prototype,"view",void 0);return b=a.__decorate([c.subclass("esri.views.support.GroundViewElevationSampler")],b)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../geometry ../../core/has ../../core/handleUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(q,t){const v=p(q,t.spatialReference);if(!v)return null;switch(q.type){case "point":q.z=t.elevationAt(v.x,v.y);break;case "polyline":n.spatialReference=v.spatialReference;var r=q.hasM&&!q.hasZ;for(var y=0;y<q.paths.length;y++){var z=q.paths[y],D=v.paths[y];for(let C=0;C<z.length;C++){const E=z[C],A=D[C];n.x=A[0];n.y=A[1];r&&(E[3]=E[2]);E[2]=t.elevationAt(n.x,n.y)}}q.hasZ=!0;break;case "multipoint":n.spatialReference=v.spatialReference;r=q.hasM&&!q.hasZ;for(y=
0;y<q.points.length;y++)z=q.points[y],D=v.points[y],n.x=D[0],n.y=D[1],r&&(z[3]=z[2]),z[2]=t.elevationAt(n.x,n.y);q.hasZ=!0}return q}function p(q,t){if(null==q)return null;const v=q.spatialReference;if(v.equals(t))return q;(q=c.project(q,t))||h.error(`Cannot project geometry spatial reference (wkid:${v.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`);return q}const h=k.getLogger("esri.layers.support.ElevationSampler");class u{queryElevation(q){return e(q.clone(),this)}on(){return d.makeHandle()}projectIfRequired(q,
t){return p(q,t)}}class w extends u{get spatialReference(){return this.extent.spatialReference}constructor(q,t,v){super();this.tile=q;this.noDataValue=v;v=q.tile.extent;this.extent=f.toExtent(v,t.spatialReference);this.extent.zmin=q.zmin;this.extent.zmax=q.zmax;this._aaExtent=v;v=m.getMetersPerUnitForSR(t.spatialReference);q=t.lodAt(q.tile.level).resolution*v;this.demResolution={min:q,max:q}}contains(q){q=this.projectIfRequired(q,this.spatialReference);return null==q?!1:this.containsAt(q.x,q.y)}containsAt(q,
t){return f.containsXY(this._aaExtent,q,t)}elevationAt(q,t){if(!this.containsAt(q,t)){const v=this.extent;h.warn("#elevationAt()",`Point used to sample elevation (${q}, ${t}) is outside of the sampler extent (${`${v.xmin}, ${v.ymin}, ${v.xmax}, ${v.ymax}`})`);return this.noDataValue}return this.tile.sample(q,t)??this.noDataValue}}class x extends u{get spatialReference(){return this.extent.spatialReference}constructor(q,t,v){super();let r;"number"===typeof t?(this.noDataValue=t,r=null):(r=t,this.noDataValue=
v);this.samplers=r?q.map(y=>new w(y,r,this.noDataValue)):q;if(q=this.samplers[0]){this.extent=q.extent.clone();const {min:y,max:z}=q.demResolution;this.demResolution={min:y,max:z};for(q=1;q<this.samplers.length;q++)t=this.samplers[q],this.extent.union(t.extent),this.demResolution.min=Math.min(this.demResolution.min,t.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,t.demResolution.max)}else this.extent=f.toExtent(f.create(),r.spatialReference),this.demResolution={min:0,max:0}}elevationAt(q,
t){for(const v of this.samplers)if(v.containsAt(q,t))return v.elevationAt(q,t);h.warn("#elevationAt()",`Point used to sample elevation (${q}, ${t}) is outside of the sampler`);return this.noDataValue}}const n=new l;a.ElevationSamplerBase=u;a.MultiTileElevationSampler=x;a.TileElevationSampler=w;a.updateGeometryElevation=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect",
"./TilingScheme"],function(a,b,g,d){b=b.clampFloat32(b.numberMaxFloat32/10);const k=g.create();d.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,k);g=g.create([-180,-90,180,90]);let m=3;a.elevationNodataValue=b;a.geographicWorldExtent=g;a.getElevationDesiredResolutionLevel=function(f){return 4>f?3:m};a.maxMemoryLodBias=2.5;a.maxPatchTesselation=512;a.maxRootTiles=64;a.progressiveLoadingModulo=2;a.test={setElevationDesiredMaxUpscalingDistance(f){m=null==f?3:f}};a.tileLoadingDebuglog=!1;a.tooManyRootTilesAfterChangeError=
"Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.tooManyRootTilesForLayerError="Surface extent is too large for tile resolution at level 0.";a.webmercatorWorldExtent=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/LOD ../../../layers/support/TileInfo ../../../geometry/Point".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(){return new g("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}class n{constructor(t){var v=n.checkUnsupported(t);if(null!=v)throw v;this.spatialReference=t.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=f.canProjectToWGS84ComparableLonLat(this.spatialReference)||e.isMars(this.spatialReference)||e.isMoon(this.spatialReference);this.origin=[t.origin.x,t.origin.y];this.pixelSize=t.size[0];
this.dpi=t.dpi;var r=t.lods.reduce((D,C,E)=>{C.level<D.min&&(D.min=C.level,D.minIndex=E);D.max=Math.max(D.max,C.level);return D},{min:Infinity,minIndex:0,max:-Infinity}),y=t.lods[r.minIndex];const z=2**y.level;v=y.resolution*z;y=y.scale*z;this.levels=Array(r.max+1);for(r=0;r<this.levels.length;r++)this.levels[r]={resolution:v,scale:y,tileSize:[v*t.size[0],v*t.size[1]]},v/=2,y/=2}clone(){return new n(this.toTileInfo())}toTileInfo(){return new u({dpi:this.dpi,origin:new w({x:this.origin[0],y:this.origin[1],
spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,v)=>new h({level:v,scale:t.scale,resolution:t.resolution}))})}getExtent(t,v,r,y){var z=this.levels[t];t=z.tileSize[0];z=z.tileSize[1];y[0]=this.origin[0]+r*t;y[2]=this.origin[0]+(r+1)*t;y[3]=this.origin[1]-v*z;y[1]=this.origin[1]-(v+1)*z}convertExtentToRadians(t,v){this._isWebMercator?(v[0]=p.x2lon(t[0]),v[1]=p.y2lat(t[1]),v[2]=p.x2lon(t[2]),v[3]=p.y2lat(t[3])):
this._isGCS&&(v[0]=d.deg2rad(t[0]),v[1]=d.deg2rad(t[1]),v[2]=d.deg2rad(t[2]),v[3]=d.deg2rad(t[3]))}getExtentGeometry(t,v,r,y=new m){this.getExtent(t,v,r,q);y.spatialReference=this.spatialReference;y.xmin=q[0];y.ymin=q[1];y.xmax=q[2];y.ymax=q[3];y.zmin=void 0;y.zmax=void 0;return y}ensureMaxLod(t){if(null==t)return!1;for(var v=!1;this.levels.length<=t;){v=this.levels[this.levels.length-1];const r=v.resolution/2;this.levels.push({resolution:r,scale:v.scale/2,tileSize:[r*this.pixelSize,r*this.pixelSize]});
v=!0}return v}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const v=this.levels[0].scale;return t>=v?0:Math.log(v/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof n)){if(n.checkUnsupported(t))return!1;t=new n(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const v=Math.min(this.levels.length,
t.levels.length)-1,r=this.levels[v].resolution;let y=.5*r;if(!d.floatEqualAbsolute(t.origin[0],this.origin[0],y)||!d.floatEqualAbsolute(t.origin[1],this.origin[1],y))return!1;y=.5*r/2**v/this.pixelSize*12;return d.floatEqualAbsolute(r,t.levels[v].resolution,y)}rootTilesInExtent(t,v=null,r=Infinity){const y=[],z=this.levels[0].tileSize;if(null==t||0===z[0]||0===z[1])return y;n.computeRowColExtent(t,z,this.origin,q);t=q[1];let D=q[3],C=q[0],E=q[2];var A=E-C;const F=D-t;A*F>r&&(r=Math.floor(Math.sqrt(r)),
F>r&&(t=t+Math.floor(.5*F)-Math.floor(.5*r),D=t+r),A>r&&(C=C+Math.floor(.5*A)-Math.floor(.5*r),E=C+r));for(r=t;r<D;r++)for(A=C;A<E;A++)y.push([0,r,A]);null!=v&&(v[0]=this.origin[0]+C*z[0],v[1]=this.origin[1]-D*z[1],v[2]=this.origin[0]+E*z[0],v[3]=this.origin[1]-t*z[1]);return y}static computeRowColExtent(t,v,r,y){const z=.001*(t[2]-t[0]+(t[3]-t[1]));y[0]=Math.max(0,Math.floor((t[0]+z-r[0])/v[0]));y[2]=Math.max(0,Math.ceil((t[2]-z-r[0])/v[0]));y[1]=Math.max(0,Math.floor((r[1]-t[3]+z)/v[1]));y[3]=Math.max(0,
Math.ceil((r[1]-t[1]-z)/v[1]))}static isPowerOfTwo(t){t=t.lods;const v=t[0].resolution*2**t[0].level;return!t.some(r=>!d.floatEqualRelative(r.resolution,v/2**r.level))}static hasGapInLevels(t){t=t.lods.map(v=>v.level);t.sort((v,r)=>v-r);for(let v=1;v<t.length;v++)if(t[v]!==t[0]+v)return!0;return!1}static tileSizeSupported(t){const v=t.size[1];return v===t.size[0]&&0===(v&v-1)&&128<=v&&512>=v}static hasOriginPerLODs(t){const v=t.origin;return t.lods.some(r=>null!=r.origin&&(r.origin[0]!==v.x||r.origin[1]!==
v.y))}static getMissingTileInfoError(){return new g("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return null==t?x():1>t.lods.length?new g("tilingscheme:generic","Tiling scheme must have at least one level"):n.isPowerOfTwo(t)?n.hasGapInLevels(t)?new g("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):n.tileSizeSupported(t)?n.hasOriginPerLODs(t)?new g("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):
null:new g("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new g("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,v){const r=t[2]-t[0],y=t[3]-t[1],z=k.getMetersPerUnitForSR(v),D=1.2*Math.max(r,y);t=new n(new u({size:[256,256],origin:new w({x:t[0]-.5*(D-r),y:t[3]+.5*(D-y)}),lods:[new h({level:0,resolution:D/256,scale:1/(256/96*.0254/(D*z))})],spatialReference:v}));t.ensureMaxLod(20);return t}static makeWebMercatorAuxiliarySphere(t){const v=
new n(n.WebMercatorAuxiliarySphereTileInfo);v.ensureMaxLod(t);return v}static makeGCSWithTileSize(t,v=256,r=16){const y=256/v;t=new n(new u({size:[v,v],origin:new w({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new h({level:0,resolution:.703125*y,scale:2.95497598570834E8*y})]}));t.ensureMaxLod(r);return t}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}n.WebMercatorAuxiliarySphereTileInfo=new u({size:[256,256],origin:new w({x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:c.WebMercator}),spatialReference:c.WebMercator,lods:[new h({level:0,resolution:156543.03392800014,scale:5.91657527591555E8})]});n.WebMercatorAuxiliarySphere=n.makeWebMercatorAuxiliarySphere(19);const q=l.create();a.TilingScheme=n;a.getMissingTileInfoError=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f){var c;b=c=class extends b.JSONSupport{constructor(l){super(l);this.cols=null;this.level=0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new c({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};a.__decorate([g.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"cols",void 0);a.__decorate([g.property({type:d.Integer,
json:{write:!0}})],b.prototype,"level",void 0);a.__decorate([g.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);a.__decorate([g.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"origin",void 0);a.__decorate([g.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);a.__decorate([g.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,
"rows",void 0);a.__decorate([g.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=c=a.__decorate([f.subclass("esri.layers.support.LOD")],b)})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){var v;b=new b.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});g=v=class extends g.JSONSupport{static create(r={}){const {resolutionFactor:y=1,scales:z,size:D=256,spatialReference:C=u.WebMercator,numLODs:E=24}=r;if(!x.isValid(C)){r=[];if(z)for(var A=0;A<z.length;A++){var F=
z[A];r.push(new q({level:A,scale:F,resolution:F}))}else for(A=5E-4,F=E-1;0<=F;F--)r.unshift(new q({level:F,scale:A,resolution:A})),A*=2;return new v({dpi:96,lods:r,origin:new h(0,0,C),size:[D,D],spatialReference:C})}A=x.getInfo(C);r=r.origin?new h({x:r.origin.x,y:r.origin.y,spatialReference:C}):A?new h({x:A.origin[0],y:A.origin[1],spatialReference:C}):new h({x:0,y:0,spatialReference:C});A=1/(39.37*d.getMetersPerUnitForSR(C)*96);F=[];if(z)for(var G=0;G<z.length;G++){var I=z[G];F.push(new q({level:G,
scale:I,resolution:I*A}))}else{var H=x.isGeographic(C)?512/D*5.916575275917094E8:256/D*5.91657527591555E8;G=Math.ceil(E/y);F.push(new q({level:0,scale:H,resolution:H*A}));for(I=1;I<G;I++)H/=2**y,F.push(new q({level:I,scale:H,resolution:H*A}))}return new v({dpi:96,lods:F,origin:r,size:[D,D],spatialReference:C})}constructor(r){super(r);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:r,origin:y}=this;if(r&&y){const z=x.getInfo(r);return r.isWrappable&&
!!z&&Math.abs(z.origin[0]-y.x)<=z.dx}return!1}readOrigin(r,y){return h.fromJSON({spatialReference:y.spatialReference,...r})}set lods(r){const y=[],z=this._levelToLOD={};r&&r.forEach(D=>{y.push(D.scale);z[D.level]=D});this._set("scales",y);this._set("lods",r);this._initializeUpsampleLevels()}readSize(r,y){return[y.cols,y.rows]}writeSize(r,y){y.cols=r[0];y.rows=r[1]}zoomToScale(r){const y=this.scales;if(0>=r)return y[0];if(r>=y.length-1)return y[y.length-1];const z=Math.floor(r);return y[z]/(y[z]/y[z+
1])**(r-z)}scaleToZoom(r){const y=this.scales,z=y.length-1;let D=0;for(;D<z;D++){const C=y[D],E=y[D+1];if(C<=r)break;if(E===r)return D+1;if(C>r&&E<r)return D+Math.log(C/r)/Math.log(C/E)}return D}snapScale(r,y=.95){r=this.scaleToZoom(r);return r%Math.floor(r)>=y?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(r,y,z,D){var C=this.lodAt(r);if(!C)return null;let E;if("number"===typeof y)E=y,y=z;else{if(x.equals(y.spatialReference,this.spatialReference))E=y.x,y=y.y;else{D=n.project(y,
this.spatialReference);if(null==D)return null;E=D.x;y=D.y}D=z}z=C.resolution*this.size[0];C=C.resolution*this.size[1];D||(D=new t.TileKey(null,0,0,0,w.create()));D.level=r;D.row=Math.floor((this.origin.y-y)/C+.001);D.col=Math.floor((E-this.origin.x)/z+.001);this.updateTileInfo(D);return D}updateTileInfo(r,y=v.ExtrapolateOptions.NONE){var z=this.lodAt(r.level);z||y!==v.ExtrapolateOptions.POWER_OF_TWO||(y=this.lods[this.lods.length-1],y.level<r.level&&(z=y));if(z){var D=r.level-z.level;y=z.resolution*
this.size[0]/2**D;z=z.resolution*this.size[1]/2**D;r.id=`${r.level}/${r.row}/${r.col}`;r.extent||(r.extent=w.create());r.extent[0]=this.origin.x+r.col*y;r.extent[1]=this.origin.y-(r.row+1)*z;r.extent[2]=r.extent[0]+y;r.extent[3]=r.extent[1]+z}}upsampleTile(r){const y=this._upsampleLevels[r.level];if(!y||-1===y.parentLevel)return!1;r.level=y.parentLevel;r.row=Math.floor(r.row/y.factor+.001);r.col=Math.floor(r.col/y.factor+.001);this.updateTileInfo(r);return!0}getTileBounds(r,y){var z=this.lodAt(y.level);
if(null==z)return null;var {resolution:D}=z;z=D*this.size[0];D*=this.size[1];r[0]=this.origin.x+y.col*z;r[1]=this.origin.y-(y.row+1)*D;r[2]=r[0]+z;r[3]=r[1]+D;return r}lodAt(r){return this._levelToLOD?.[r]??null}clone(){return v.fromJSON(this.write({}))}getOrCreateCompatible(r,y){if(256===this.size[0]&&256===this.size[1])return 256===r?this:null;const z=[],D=this.lods.length;for(let C=0;C<D;C++){const E=this.lods[C];z.push(new q({level:E.level,scale:E.scale,resolution:E.resolution*y}))}return new v({size:[r,
r],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:z})}_initializeUpsampleLevels(){const r=this.lods;this._upsampleLevels=[];let y=null;for(let z=0;z<r.length;z++){const D=r[z];this._upsampleLevels[D.level]={parentLevel:y?y.level:-1,factor:y?y.resolution/D.resolution:0};y=D}}};a.__decorate([k.property({type:Number,json:{write:!0}})],g.prototype,"compressionQuality",void 0);a.__decorate([k.property({type:Number,
json:{write:!0}})],g.prototype,"dpi",void 0);a.__decorate([k.property({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],g.prototype,"format",void 0);a.__decorate([k.property({readOnly:!0})],g.prototype,"isWrappable",null);a.__decorate([k.property({type:h,json:{write:!0}})],g.prototype,"origin",void 0);a.__decorate([l.reader("origin")],g.prototype,"readOrigin",null);a.__decorate([k.property({type:[q],value:null,json:{write:!0}})],g.prototype,"lods",null);a.__decorate([k.property({readOnly:!0})],
g.prototype,"scales",void 0);a.__decorate([k.property({cast:r=>Array.isArray(r)?r:"number"===typeof r?[r,r]:[256,256]})],g.prototype,"size",void 0);a.__decorate([l.reader("size",["rows","cols"])],g.prototype,"readSize",null);a.__decorate([p.writer("size",{cols:{type:m.Integer},rows:{type:m.Integer}})],g.prototype,"writeSize",null);a.__decorate([k.property({type:u,json:{write:!0}})],g.prototype,"spatialReference",void 0);g=v=a.__decorate([e.subclass("esri.layers.support.TileInfo")],g);(function(r){r=
r.ExtrapolateOptions||(r.ExtrapolateOptions={});r[r.NONE=0]="NONE";r[r.POWER_OF_TWO=1]="POWER_OF_TWO"})(g||(g={}));return g})},"esri/layers/support/TileKey":function(){define(["exports"],function(a){class b{constructor(g,d,k,m,f){this.id=g;this.level=d;this.row=k;this.col=m;this.extent=f}}a.TileKey=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/PopupView":function(){define("require exports ../chunks/tslib.es6 ../core/asyncUtils ../core/deprecate ../core/Error ../core/Logger ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./input/InputManager".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(v){return null!=v&&"open"in v&&"declaredClass"in v}function q(v){return null!=v&&"declaredClass"in v&&"dockOptions"in v}const t=v=>Object.freeze(Object.defineProperty({__proto__:null,default:v},Symbol.toStringTag,{value:"Module"}));b.PopupView=v=>{v=class extends v{constructor(){super(...arguments);this._popupSetupTask=null;this.popup={};this.popupEnabled=!0}initialize(){this.addHandles([l.watch(()=>[this.ui,this.popup],([r,y],z)=>{if(z){const [D,
C]=z;D&&n(C)&&(C.view=null,q(C)&&D.remove(C,"popup"))}r&&n(y)&&(y.view=this,q(y)&&r.add(y,{key:"popup",position:"manual",internal:!0}))},l.initial),this.on("click",r=>{this.popup&&this.popupEnabled&&("mouse"!==r.pointerType||0===r.button)&&(!n(this.popup)&&"autoOpenEnabled"in this.popup&&!1===this.popup.autoOpenEnabled||(n(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup();n(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},
x.ViewEventPriorities.WIDGET)]);l.whenOnce(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{new Promise((r,y)=>a(["../widgets/Popup"],z=>r(t(z)),y))})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(n(this.popup))return this.popup.open(r);try{await this.setupPopup(),this.popup?this.popup.open(r):f.getLogger(this).error(new m("view:null-popup","Popup is null and can't be opened"))}catch{}}closePopup(){this._popupSetupTask?.abort();n(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,
y){await this.when();const {location:z,queryArea:D,layerViewsAndGraphics:C,clientOnlyGraphics:E}=await this._prepareFetchPopupFeatures(r,y);r=Promise.resolve(E);y=this._queryLayerPopupFeatures(D,C,y);const A=y.map(F=>F.promise);r=c.eachAlwaysValues([r,...A]).then(F=>Array.from(new Set(F.flat())));return{location:z,clientOnlyGraphics:E,allGraphicsPromise:r,promisesPerLayerView:y}}async setupPopup(){this._popupSetupTask?.abort();if(this.popup&&!n(this.popup))return this._popupSetupTask=d.createTask(async r=>
{const {default:y}=await new Promise((z,D)=>a(["../widgets/Popup"],C=>z(t(C)),D));c.throwIfAborted(r);this.popup&&!n(this.popup)&&(r=this.popup,delete r.open,delete r.close,this.popup=new y(r))}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,y,z){return y.map(({layerView:D,graphics:C})=>{C=D.fetchPopupFeatures(r,{clientGraphics:C,event:null!=z?z.event:void 0,signal:null!=z?z.signal:void 0,defaultPopupTemplateEnabled:null!=z?!!z.defaultPopupTemplateEnabled:!1});return{layerView:D,promise:C}})}_isValidPopupGraphic(r,
y){return r&&!!r.getEffectivePopupTemplate(null!=y&&y.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,y){const {clientGraphics:z,queryArea:D,location:C}=await this._popupHitTestGraphics(r,y);r=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:E,clientOnlyGraphics:A}=this._graphicsPerFetchPopupLayerView(z,r);return{clientOnlyGraphics:A,layerViewsAndGraphics:E,queryArea:D,location:C}}async _popupHitTestGraphics(r,y){var z=await this.popupHitTest(r);r=z.mapPoint;z=z.results.filter(C=>
"graphic"===C.type&&this._isValidPopupGraphic(C.graphic,y));const D=z.length?z[0].mapPoint:null;return{clientGraphics:z.map(C=>C.graphic),queryArea:r,location:r||D}}_getFetchPopupLayerViews(){const r=[];this.allLayerViews.forEach(y=>{this._isValidPopupLayerView(y)&&r.push(y)});null!=this.graphicsView&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView);return r.reverse()}_isValidPopupLayerView(r){return null!=r&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,
y){const z=[],D=new Map;y=y.map(C=>{const E=[];"layer"in C?D.set(C.layer,E):D.set(C.graphics,E);return{layerView:C,graphics:E}});for(const C of r)(r=D.get(C.layer)||D.get(C.sourceLayer)||null)?r.push(C):z.push(C);return{layerViewsAndGraphics:y,clientOnlyGraphics:z}}};g.__decorate([e.property({cast(r){if(!r||n(r))return r;"object"===typeof r&&(r.open=y=>{k.deprecated(f.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",
version:"4.27"});return this.openPopup(y)},r.close=()=>{k.deprecated(f.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"});return this.closePopup()});return r}})],v.prototype,"popup",void 0);g.__decorate([e.property()],v.prototype,"popupEnabled",void 0);return v=g.__decorate([w.subclass("esri.views.PopupView")],v)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error"],function(a,b,g){const d=c=>Object.freeze(Object.defineProperty({__proto__:null,default:c},Symbol.toStringTag,{value:"Module"})),k=()=>new Promise((c,l)=>a(["./layers/TileLayerView3D"],e=>c(d(e)),l)),m=()=>new Promise((c,l)=>a(["./layers/ElevationLayerView3D"],e=>c(d(e)),l)),f={"base-dynamic":()=>new Promise((c,l)=>a(["./layers/BaseDynamicLayerView3D"],e=>c(d(e)),l)),"base-elevation":m,"base-tile":k,
"bing-maps":k,"building-scene":()=>new Promise((c,l)=>a(["./layers/BuildingSceneLayerView3D"],e=>c(d(e)),l)),csv:()=>new Promise((c,l)=>a(["./layers/CSVLayerView3D"],e=>c(d(e)),l)),dimension:()=>new Promise((c,l)=>a(["./layers/DimensionLayerView3D"],e=>c(d(e)),l)),elevation:m,feature:()=>new Promise((c,l)=>a(["./layers/FeatureLayerView3D"],e=>c(d(e)),l)),geojson:()=>new Promise((c,l)=>a(["./layers/GeoJSONLayerView3D"],e=>c(d(e)),l)),graphics:()=>new Promise((c,l)=>a(["./layers/GraphicsLayerView3D"],
e=>c(d(e)),l)),group:()=>new Promise((c,l)=>a(["../layers/GroupLayerView"],e=>c(d(e)),l)),imagery:()=>new Promise((c,l)=>a(["./layers/ImageryLayerView3D"],e=>c(d(e)),l)),"integrated-mesh":()=>new Promise((c,l)=>a(["./layers/IntegratedMeshLayerView3D"],e=>c(d(e)),l)),"line-of-sight":()=>new Promise((c,l)=>a(["./layers/LineOfSightLayerView3D"],e=>c(d(e)),l)),"map-image":()=>new Promise((c,l)=>a(["./layers/MapImageLayerView3D"],e=>c(d(e)),l)),media:()=>new Promise((c,l)=>a(["./layers/MediaLayerView3D"],
e=>c(d(e)),l)),"ogc-feature":()=>new Promise((c,l)=>a(["./layers/OGCFeatureLayerView3D"],e=>c(d(e)),l)),"open-street-map":k,"oriented-imagery":()=>new Promise((c,l)=>a(["./layers/FeatureLayerView3D"],e=>c(d(e)),l)),"point-cloud":()=>new Promise((c,l)=>a(["./layers/PointCloudLayerView3D"],e=>c(d(e)),l)),voxel:()=>new Promise((c,l)=>a(["./layers/VoxelLayerView3D"],e=>c(d(e)),l)),route:()=>new Promise((c,l)=>a(["./layers/RouteLayerView3D"],e=>c(d(e)),l)),scene:c=>null==c.profile||"mesh-pyramids"===c.profile?
new Promise((l,e)=>a(["./layers/SceneLayerView3D"],p=>l(d(p)),e)):new Promise((l,e)=>a(["./layers/SceneLayerGraphicsView3D"],p=>l(d(p)),e)),stream:()=>new Promise((c,l)=>a(["./layers/StreamLayerView3D"],e=>c(d(e)),l)),tile:k,"imagery-tile":()=>new Promise((c,l)=>a(["./layers/ImageryTileLayerView3D"],e=>c(d(e)),l)),"vector-tile":()=>new Promise((c,l)=>a(["./layers/VectorTileLayerView3D"],e=>c(d(e)),l)),wcs:()=>new Promise((c,l)=>a(["./layers/ImageryTileLayerView3D"],e=>c(d(e)),l)),"web-tile":k,wfs:()=>
new Promise((c,l)=>a(["./layers/WFSLayerView3D"],e=>c(d(e)),l)),wms:()=>new Promise((c,l)=>a(["./layers/WMSLayerView3D"],e=>c(d(e)),l)),wmts:()=>new Promise((c,l)=>a(["./layers/WMTSLayerView3D"],e=>c(d(e)),l)),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};b.layerView3DImporter={hasLayerViewModule:c=>null!=f[c.type],importLayerView:c=>{var l=f[c.type];if(null==l)throw c=
c.declaredClass?c.declaredClass.slice(c.declaredClass.lastIndexOf(".")+1):"Unknown",l=c.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new g(`${l}:view-not-supported`,`${c} is not supported in 3D`);return l(c)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(){const t=e.createResolver();t.promise.catch(()=>{});return t}const x=t=>Object.freeze(Object.defineProperty({__proto__:null,default:t},Symbol.toStringTag,{value:"Module"}));var n;(function(t){t[t.PENDING=0]="PENDING";t[t.CREATED=1]="CREATED"})(n||(n={}));var q;(function(t){t[t.ADDED=0]="ADDED";t[t.REMOVED=1]="REMOVED"})(q||(q={}));g=class extends g{constructor(t){super(t);this._allAnalysisViews=new k;this._creatingViewCount=0;this._items=new Map;this._scheduledUpdateHandle=
null;this._attachedToViewResolver=w();this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners();this._attachedToViewResolver.reject(e.createAbortError("AnalysisViewManager was destroyed"))}attach(){this._connectOwners();this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners();this._attachedToViewResolver.reject(e.createAbortError());this._attachedToViewResolver=
w()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(t=>t.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(t){await this._attachedToViewResolver.promise;const v=this._items.get(t);if(null==v||v.state.list===q.REMOVED)throw new m("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});return v.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),
"analyses-owner-handles")}_disconnectOwners(){this.removeHandles("analyses-owner-handles");this._update();this._creatingViewCount=0}_connectAnalysesCollection(t){for(const y of t)this._addAnalysis(y);const v=t.on("after-add",y=>this._addAnalysis(y.item)),r=t.on("after-remove",y=>this._removeAnalysis(y.item));return f.makeHandle(()=>{v.remove();r.remove();for(const y of t)this._removeAnalysis(y)})}_addAnalysis(t){const v=this._items.get(t);if(null==v){const r={state:{view:n.PENDING,list:q.ADDED},analysis:t,
view:null,createAnalysisViewTask:null};this._items.set(t,r);r.createAnalysisViewTask=d.createTask(y=>this._createAnalysisViewPromise(r,y))}else v.state.list=q.ADDED}_removeAnalysis(t){t=this._items.get(t);null==t?c.getLogger(this).error("Trying to remove analysis which was not added"):(t.state.list=q.REMOVED,this._scheduleUpdate())}_scheduleUpdate(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=p.schedule(()=>this._update()))}_update(){this._scheduledUpdateHandle=l.removeMaybe(this._scheduledUpdateHandle);
this._items.forEach(t=>{if(t.state.list===q.REMOVED)switch(this._items.delete(t.analysis),t.state.view){case n.PENDING:t.createAnalysisViewTask=l.abortMaybe(t.createAnalysisViewTask);break;case n.CREATED:null!=t.view&&(this._allAnalysisViews.remove(t.view),t.view=l.destroyMaybe(t.view),t.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(t,v){var r=t.analysis;const y=r.type,z=this._analysisModules[y];this._creatingViewCount+=1;if(null==z.module)try{z.module=await this._loadAnalysisModule(y)}catch(D){throw--this._creatingViewCount,
D;}if(e.isAborted(v))throw--this._creatingViewCount,e.createAbortError("AnalysisView creation aborted");r=new z.module.default({analysis:r,view:this.view});try{await r.when()}catch(D){throw--this._creatingViewCount,D;}if(e.isAborted(v))throw--this._creatingViewCount,r.destroy(),e.createAbortError("AnalysisView creation aborted");t.view=r;t.state.view=n.CREATED;this._allAnalysisViews.add(r);--this._creatingViewCount;return r}_loadAnalysisModule(t){switch(t){case "area-measurement":return new Promise((v,
r)=>a(["./AreaMeasurementAnalysisView3D"],y=>v(x(y)),r));case "dimension":return new Promise((v,r)=>a(["./DimensionAnalysisView3D"],y=>v(x(y)),r));case "direct-line-measurement":return new Promise((v,r)=>a(["./DirectLineMeasurementAnalysisView3D"],y=>v(x(y)),r));case "line-of-sight":return new Promise((v,r)=>a(["./LineOfSightAnalysisView3D"],y=>v(x(y)),r));case "slice":return new Promise((v,r)=>a(["./SliceAnalysisView3D"],y=>v(x(y)),r))}}};b.__decorate([h.property()],g.prototype,"updating",null);
b.__decorate([h.property({constructOnly:!0})],g.prototype,"view",void 0);b.__decorate([h.property()],g.prototype,"_allAnalysisViews",void 0);b.__decorate([h.property()],g.prototype,"_creatingViewCount",void 0);return g=b.__decorate([u.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],g)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){a.Constraints=class extends g{constructor(){super(...arguments);this.tilt=new p.TiltConstraint;this.altitude=new l.AltitudeConstraint;this.clipDistance=new e.ClipDistanceConstraint}};b.__decorate([d.property({type:p.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);b.__decorate([d.property({type:l.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);b.__decorate([d.property({type:e.ClipDistanceConstraint})],a.Constraints.prototype,"clipDistance",
void 0);a.Constraints=b.__decorate([c.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,g,d,k,m,f,c,l){a.AltitudeConstraint=class extends g{constructor(){super(...arguments);this.min=l.earthAltitudeConstraint.min;this.max=l.earthAltitudeConstraint.max}};b.__decorate([d.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);b.__decorate([d.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=b.__decorate([c.subclass("esri.views.3d.constraints.AltitudeConstraint")],a.AltitudeConstraint);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h,u){a.Constraints=class extends g{constructor(q){super(q);
this.collision=new n;this.distance=Infinity;this.minimumPoiDistance=4;this.tilt=null}get altitude(){return this.mode===h.ViewingMode.Local?null:this._get("altitude")||null}set altitude(q){this.mode===h.ViewingMode.Local?d.getLogger(this).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",q)}clampAltitude(q){return this.altitude?k.clamp(q,this.altitude.min,this.altitude.max):q}clampTilt(q,t){if(!this.tilt)return t;q=this.tilt(q);return k.clamp(t,q.min,q.max)}clampDistance(q){return Math.min(q,
this.distance)}createDefaultTilt(){return this.mode===h.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(q){return(t,v=x)=>{v.min=w.min;v.max=q;return v}}_createDefaultTiltLocal(){const q=this.collision.enabled?u.makePiecewiseLinearFunction([[4E3,w.max],[1E4,k.deg2rad(88)],[6E6,k.deg2rad(88)]]):()=>w.max;return(t,v=x)=>{v.min=w.min;v.max=q(t);return v}}_createDefaultTiltGlobal(){const q=this.collision.enabled?u.makePiecewiseLinearFunction([[4E3,
w.max],[5E4,k.deg2rad(88)],[6E6,k.deg2rad(88)],[2E7,w.min]]):u.makePiecewiseLinearFunction([[3E5,w.max],[3E6,k.deg2rad(88)],[6E6,k.deg2rad(88)],[2E7,w.min]]);return(t,v=x)=>{v.min=w.min;v.max=q(t);return v}}};b.__decorate([m.property()],a.Constraints.prototype,"altitude",null);b.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);b.__decorate([m.property()],a.Constraints.prototype,"distance",void 0);b.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",
void 0);b.__decorate([m.property()],a.Constraints.prototype,"tilt",void 0);b.__decorate([m.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=b.__decorate([e.subclass("esri.views.3d.state.Constraints")],a.Constraints);f={min:-2E5,max:4*p.earth.radius};const w={min:k.deg2rad(.5),max:k.deg2rad(179.5)},x={min:0,max:0};let n=class extends g{constructor(){super(...arguments);this.enabled=!0;this.elevationMargin=5}};b.__decorate([m.property({type:Boolean})],n.prototype,"enabled",
void 0);b.__decorate([m.property({type:Number})],n.prototype,"elevationMargin",void 0);n=b.__decorate([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],n);a.TiltDefault=w;a.earthAltitudeConstraint=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){a.ClipDistanceConstraint=class extends g{constructor(){super(...arguments);this.mode="auto"}get near(){return this._get("near")}set near(l){this._set("near",l);l>=this._get("far")&&(this.far=l+1E-9);this.mode="manual"}castNear(l){return Math.max(1E-8,l)}get far(){return this._get("far")}set far(l){this._set("far",l);l<=this._get("near")&&(this.near=l-1E-9);this.mode="manual"}castFar(l){return Math.max(1E-8,l)}autoUpdate(l,e){"auto"===this.mode&&(this._get("near")!==l&&this._set("near",
l),this._get("far")!==e&&this._set("far",e))}};b.__decorate([d.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);b.__decorate([k.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);b.__decorate([d.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);b.__decorate([k.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);b.__decorate([d.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",
void 0);a.ClipDistanceConstraint=b.__decorate([c.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,g,d,k,m,f,c,l,e){var p=d.rad2deg(e.TiltDefault.min),h=d.rad2deg(e.TiltDefault.max);a.TiltConstraint=class extends g{constructor(){super(...arguments);this.mode="auto"}get max(){return this._get("max")}set max(u){this._set("max",u);this.mode="manual"}castMax(u){return d.clamp(u,p,h)}autoUpdate(u){"auto"===this.mode&&this._get("max")!==u&&this._set("max",u)}};b.__decorate([k.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);b.__decorate([k.property({type:Number,
value:h})],a.TiltConstraint.prototype,"max",null);b.__decorate([m.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=b.__decorate([l.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/handleUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){var n;u=n=class extends u{constructor(q){super(q);this.atmosphere=new e.SceneViewAtmosphere;this.lighting=this.castLighting();this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(q){q=q.cloneConstructProperties();return new n({...q,lighting:q.lighting?"virtual"===q.lighting.type?h.fromWebsceneLighting(q.lighting):p.fromWebsceneLighting(q.lighting):void 0})}castLighting(q){return this._convertLightingWithDestroy(q)}applyLighting(q){this.lighting=
this._convertLightingWithDestroy(q)}_convertLightingWithDestroy(q){const t=this._convertLighting(q);t!==q&&this.addHandles(g.destroyHandle(t));return t}_convertLighting(q){return q?q instanceof p||q instanceof h?q:q instanceof w?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(q):new p({...q.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):q instanceof x?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(q):
new h({...q.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):c.ensureOneOfType(l.lightingTypes,q):new p}clone(){return new n({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:d.clone(this.background)})}cloneWithWebsceneEnvironment(q){return new n({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,
starsEnabled:this.starsEnabled,background:d.clone(this.background),...q.cloneConstructProperties(),lighting:this._getLighting(q)})}_getLighting(q){switch(q.lighting.type){case "sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(q.lighting):p.fromWebsceneLighting(q.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(q.lighting):h.fromWebsceneLighting(q.lighting);default:return b.neverReached(q.lighting),
p.fromWebsceneLighting(q.lighting)}}};a.__decorate([k.property({type:e.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],u.prototype,"atmosphere",void 0);a.__decorate([k.property({nonNullable:!0})],u.prototype,"lighting",void 0);a.__decorate([m.cast("lighting")],u.prototype,"castLighting",null);return u=n=a.__decorate([f.subclass("esri.views.3d.environment.SceneViewEnvironment")],u)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,
b,g){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:g}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),
function(a,b,g,d,k,m,f,c,l,e){var p;const h=d.getLogger("esri.views.3d.environment.SunLighting");g=p=class extends g.EventedMixin(e){constructor(w){super(w);this.cameraTrackingEnabled=!0;this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};w=(new Date).getFullYear();w=new Date("March 15, "+w+" 12:00:00 UTC");this._set("defaultDate",w);this._set("date",w)}get ambientOcclusionEnabled(){b.deprecatedProperty(h,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",
version:"4.27"});return this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(w){b.deprecatedProperty(h,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});this._set("ambientOcclusionEnabled",w)}get waterReflectionEnabled(){b.deprecatedProperty(h,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??
!1}set waterReflectionEnabled(w){b.deprecatedProperty(h,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",w)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(w){return new p(w.cloneConstructProperties())}set defaultDate(w){const x=this._get("date")===this._get("defaultDate");w=new Date(w.getTime());this._set("defaultDate",w);x&&this._set("date",
w)}set date(w){null!=w&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(w.getTime())))}autoUpdate(w,x){const n=p.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=x.hours;this.positionTimezoneInfo.minutes=x.minutes;this.positionTimezoneInfo.seconds=x.seconds;x=null;null!=w&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(w.getTime())?(x=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(x=this.date&&this.date.getTime(),this._set("date",
new Date(w.getTime()))));const q=p.calculateTimezoneOffset(this.positionTimezoneInfo);n!==q&&(u.target=this,u.timezoneOffset=q,this.emit("timezone-will-change",u),u.target=null);if(null!=w)return isNaN(w.getTime())||x!==w.getTime()}clone(){const w=this._get("date")===this._get("defaultDate"),x=new p({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});w&&x._set("date",x._get("defaultDate"));x.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;
x.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;x.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;x.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return x}cloneWithWebsceneLighting(w){const x=this.clone();null!=w.date&&(x.date=w.date);x.directShadowsEnabled=w.directShadowsEnabled;x.displayUTCOffset=w.displayUTCOffset;return x}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};a.__decorate([k.property({type:Boolean})],
g.prototype,"cameraTrackingEnabled",void 0);a.__decorate([k.property({type:Boolean})],g.prototype,"ambientOcclusionEnabled",null);a.__decorate([k.property({type:Boolean})],g.prototype,"waterReflectionEnabled",null);a.__decorate([k.property({type:Date})],g.prototype,"defaultDate",null);a.__decorate([k.property({type:Date})],g.prototype,"date",null);g=p=a.__decorate([l.subclass("esri.views.3d.environment.SunLighting")],g);(function(w){w.calculateTimezoneOffset=function({hours:x,minutes:n,seconds:q}){return Math.round(x+
n/60+q/3600)}})(g||(g={}));const u={target:null,timezoneOffset:0};return g})},"esri/webscene/SunLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),function(a,b,g,d,k,m,f,c,l){var e;b=e=class extends b.JSONSupport{constructor(p){super(p);
this.type="sun";this.date=null;this.directShadowsEnabled=!1;this.displayUTCOffset=null}readDate(p,h){return null!=h.datetime&&new Date(h.datetime)||null}writeDate(p,h,u){h[u]=p.getTime()}readDirectShadowsEnabled(p,h){return!!h.directShadows}writedirectShadowsEnabled(p,h,u){p&&(h[u]=p)}writeDisplayUTCOffset(p,h){null!=p&&(h.displayUTCOffset=p)}clone(){return new e(this.cloneConstructProperties())}cloneConstructProperties(){const p={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=
this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(p.date=new Date(this.date.getTime()));return p}};a.__decorate([g.property({readOnly:!0,type:["sun"],json:{write:!0}})],b.prototype,"type",void 0);a.__decorate([g.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);a.__decorate([f.reader("date",["datetime"])],b.prototype,"readDate",null);a.__decorate([l.writer("date")],b.prototype,"writeDate",null);a.__decorate([g.property({type:Boolean,json:{default:!1,
write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);a.__decorate([f.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);a.__decorate([l.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);a.__decorate([g.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",void 0);a.__decorate([l.writer("displayUTCOffset")],b.prototype,"writeDisplayUTCOffset",null);return b=e=a.__decorate([c.subclass("esri.webscene.SunLighting")],
b)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),function(a,b,g,d,k,m,f,c,l,e){var p;const h=d.getLogger("esri.views.3d.environment.VirtualLighting");g=p=class extends g.EventedMixin(e){constructor(u){super(u);
this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){b.deprecatedProperty(h,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});return this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(u){b.deprecatedProperty(h,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});this._set("ambientOcclusionEnabled",u)}get waterReflectionEnabled(){b.deprecatedProperty(h,
"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(u){b.deprecatedProperty(h,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",u)}clone(){return new p({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(u){return new p(u.cloneConstructProperties())}cloneWithWebsceneLighting(u){const w=
this.clone();w.directShadowsEnabled=u.directShadowsEnabled;return w}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};a.__decorate([k.property({type:Boolean})],g.prototype,"ambientOcclusionEnabled",null);a.__decorate([k.property({type:Boolean})],g.prototype,"waterReflectionEnabled",null);a.__decorate([k.property({type:Boolean})],g.prototype,"cameraTrackingEnabled",void 0);return g=p=a.__decorate([l.subclass("esri.views.3d.environment.VirtualLighting")],
g)})},"esri/webscene/VirtualLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,g,d,k,m,f){var c;b=c=class extends b.JSONSupport{constructor(l){super(l);this.type="virtual";this.directShadowsEnabled=!1}clone(){return new c(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};
a.__decorate([g.property({readOnly:!0,type:["virtual"],json:{write:!0}})],b.prototype,"type",void 0);a.__decorate([g.property({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],b.prototype,"directShadowsEnabled",void 0);return b=c=a.__decorate([f.subclass("esri.webscene.VirtualLighting")],b)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){var l;a.SceneViewAtmosphere=l=class extends g{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new l({quality:this.quality})}};b.__decorate([d.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=l=b.__decorate([c.subclass("esri.views.3d.environment.SceneViewAtmosphere")],a.SceneViewAtmosphere);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/Environment":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){var w;const x=d.getLogger("esri.webscene.Environment");d=(n,q,t)=>({enabled:!t||!t.isPresentation});b=w=class extends b.JSONSupport{constructor(n){super(n);this.lighting=new p;this.background=null;this.starsEnabled=this.atmosphereEnabled=!0}set weather(n){l.validateWeatherType(n?.type,x)&&this._set("weather",n)}clone(){return new w(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?h.prototype.clone.call(this.lighting):
p.prototype.clone.call(this.lighting),background:g.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};a.__decorate([k.property({types:e.lightingTypes,nonNullable:!0,json:{write:!0}})],b.prototype,"lighting",void 0);a.__decorate([k.property(u.backgroundProperty)],b.prototype,"background",void 0);a.__decorate([k.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:d}}})],b.prototype,"atmosphereEnabled",void 0);
a.__decorate([k.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:d}}})],b.prototype,"starsEnabled",void 0);a.__decorate([k.property({types:l.weatherTypes,nonNullable:!0,json:{write:!0},value:new c})],b.prototype,"weather",null);return b=w=a.__decorate([f.subclass("esri.webscene.Environment")],b)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){var l;b=l=class extends b.JSONSupport{constructor(e){super(e);this.type="sunny";this.cloudCover=.5}clone(){return new l({cloudCover:this.cloudCover})}};a.__decorate([f.enumeration({sunny:"sunny"})],b.prototype,"type",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=l=a.__decorate([c.subclass("esri.views.3d.environment.SunnyWeather")],b)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),
function(a,b,g,d,k,m){b={key:"type",base:m,typeMap:{sunny:m,cloudy:b,rainy:d,snowy:k,foggy:g}};const f=Object.keys(b.typeMap);a.cloudsHeight=1E5;a.validateWeatherType=function(c,l){return f.includes(c)?!0:(l.error(`"${c}" is not a valid weather type`),!1)};a.weatherHeightLimit=1E4;a.weatherTypes=b;a.weatherTypesArray=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){var l;b=l=class extends b.JSONSupport{constructor(e){super(e);this.type="cloudy";this.cloudCover=.5}clone(){return new l({cloudCover:this.cloudCover})}};a.__decorate([f.enumeration({cloudy:"cloudy"})],b.prototype,"type",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=l=a.__decorate([c.subclass("esri.views.3d.environment.CloudyWeather")],b)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){var l;b=l=class extends b.JSONSupport{constructor(e){super(e);this.type="foggy";this.fogStrength=.5}clone(){return new l({fogStrength:this.fogStrength})}};a.__decorate([f.enumeration({foggy:"foggy"})],b.prototype,"type",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"fogStrength",void 0);return b=l=a.__decorate([c.subclass("esri.views.3d.environment.FoggyWeather")],b)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){var l;b=l=class extends b.JSONSupport{constructor(e){super(e);this.type="rainy";this.precipitation=this.cloudCover=.5}clone(){return new l({cloudCover:this.cloudCover,precipitation:this.precipitation})}};a.__decorate([f.enumeration({rainy:"rainy"})],b.prototype,"type",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1},
json:{write:!0}})],b.prototype,"precipitation",void 0);return b=l=a.__decorate([c.subclass("esri.views.3d.environment.RainyWeather")],b)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){var l;b=l=class extends b.JSONSupport{constructor(e){super(e);this.type="snowy";this.precipitation=this.cloudCover=.5;this.snowCover="disabled"}clone(){return new l({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};a.__decorate([f.enumeration({snowy:"snowy"})],b.prototype,"type",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);a.__decorate([g.property({type:Number,
nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"precipitation",void 0);a.__decorate([g.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],b.prototype,"snowCover",void 0);return b=l=a.__decorate([c.subclass("esri.views.3d.environment.SnowyWeather")],b)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,g){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:g}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,g){b={base:b,key:"type",typeMap:{color:g}};b={types:b,json:{read:function(d){return(k,m,f)=>{if(!k)return k;for(const c in d.typeMap)if(k.type===c)return m=new d.typeMap[c],m.read(k,f),m}}(b),write:{overridePolicy:(d,k,m)=>({enabled:!m||!m.isPresentation})}}};a.backgroundProperty=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f){b=class extends b.JSONSupport{constructor(c){super(c)}clone(){}};a.__decorate([g.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);return b=a.__decorate([f.subclass("esri.webscene.background.Background")],b)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,g,d,k,m,f,c,l,e){var p;d={...l.colorAndTransparencyProperty,nonNullable:!0};e=p=class extends e{constructor(h){super(h);this.type="color";this.color=new b([0,0,0,1])}clone(){return new p(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};a.__decorate([f.enumeration({color:"color"},{readOnly:!0})],e.prototype,"type",void 0);a.__decorate([g.property(d)],e.prototype,"color",void 0);return e=p=a.__decorate([c.subclass("esri.webscene.background.ColorBackground")],
e)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projection/projectPointToWGS84ComparableLonLat ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){a.SceneViewEnvironmentManager=class extends g.EventedAccessor{constructor(){super();this._referencePointUpdateDelay=200;this._referencePointUpdateInterval=3E3;this._referencePointUpdateDistThreshold=1E6;this._referencePosMapCoordsRequested=this._referencePosUpdateQuery=null;this._viewHandlesKey="viewHandles";this._referencePosResetPreserveAbsoluteTime=this._trackingEnabled=this._preserveAbsoluteDateTime=!1;this._referencePosMapCoords=this._referencePosUpdateTimer=
null;this._mainLight=new z.MainLight;this._ambientLight=new z.AmbientLight;this._moonLight=new z.FillLight;this._disableWeather=this.disableQueries=!1;this._referencePosWGS84Comparable=this._renderer=null;this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&
!this._disableWeather&&this._view?.state?.viewingMode===q.ViewingMode.Global&&n.isEarth(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(I){if(!this._renderer){this._renderer=new t.EnvironmentRenderer({view:I});var H=()=>this._updateRenderParameters(),B=()=>this._cameraHandler();this.addHandles([m.watch(()=>I.environment.lighting,K=>this._updateLightingHandler(K),
m.sync),m.watch(()=>"virtual"!==I.environment.lighting.type?I.environment.lighting.date:null,K=>this._lightingDateHandler(K),m.sync),m.watch(()=>I.stationary,()=>this._interactingStationaryHandler()),m.watch(()=>I.environment.lighting.directShadowsEnabled,H,m.sync),m.watch(()=>I.qualitySettings.ambientOcclusion,H,m.sync),m.watch(()=>I.qualitySettings.reflections,H,m.sync),m.watch(()=>I.spatialReference,()=>this._resetReferencePosition(!0),m.sync),m.watch(()=>I.environment.weather.type,()=>this._updateLighting(null,
y.Update.Faded),m.sync),m.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,y.Update.Faded),m.sync),m.watch(()=>I.viewingMode,()=>this._resetReferencePosition(!0),m.syncAndInitial),m.watch(()=>"virtual"!==I.environment.lighting.type?I.environment.lighting.cameraTrackingEnabled:!1,K=>this._updateCameraTracking(K),m.syncAndInitial),m.watch(()=>I.state.camera,B,m.syncAndInitial),m.watch(()=>this.disableQueries,B)],this._viewHandlesKey);this._updateRenderParameters();this._updateLighting();
this._cameraHandler();this.notifyChange("updating")}}disconnectView(){this.removeHandles(this._viewHandlesKey);this._resetReferencePosition();this._renderer=d.destroyMaybe(this._renderer)}_updateLightingHandler(I){this._updateCameraTracking("virtual"!==I.type?I.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==I.type?I.date:null);this._updateRenderParameters()}_updateCameraTracking(I){(this._trackingEnabled=I)?this._cameraHandler():(I=this._view.environment.lighting,"virtual"!==I?.type&&
(I.positionTimezoneInfo.autoUpdated=!1))}_lightingDateHandler(I){const H=this._view.environment.lighting;if("virtual"===H?.type)this._updateLighting();else if(I){if(!H.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!w.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var B=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(B)){this._requestReferencePositionUpdate(B);return}}this._preupdateTracking(I);null!=this._referencePosWGS84Comparable&&
(B=v.positionToTimezoneInfo(this._referencePosWGS84Comparable,A),null!=B&&(H.autoUpdate(null,B),this._trackingEnabled&&(H.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(I)}}_preupdateTracking(I){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(I)}_cameraHandler(I=null){var H=this._view;H.ready&&(H=H.stateManager.camera)&&(this._cameraHandlerClientSide(H,I)||this._cameraHandlerServerSide(H))}_cameraHandlerClientSide(I,
H){const B=n.isEarth(this._view.spatialReference);if(B&&!w.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;I=I.position;null==this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable=u.create());B?x.projectPointToWGS84ComparableLonLat(I,this._referencePosWGS84Comparable):h.set(this._referencePosWGS84Comparable,I.longitude??0,I.latitude??0,I.z??0);this.notifyChange("referencePositionWGS84Comparable");
this._autoUpdateTimezone(this._referencePosWGS84Comparable,H)||this._updateLighting(H);return!0}_cameraHandlerServerSide(I){I=I.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(I))&&this._requestReferencePositionUpdate(I,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(I.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&
this._executePendingReferencePositionUpdate()}_updateLighting(I,H=y.Update.Immediate){var B=this._view;I=I||("virtual"===B.environment.lighting.type?null:B.environment.lighting.date);var K=this._referencePosWGS84Comparable;const L=null!=K?D:C;var J=this.weatherVisible?B.environment.weather.type:"disabled";null!=K?r.computeColorAndIntensity(I,K,B.state.viewingMode,J,B.state.camera,L):"virtual"===B.environment.lighting.type&&r.computeVirtualLightDirection(B.state.camera,B.state.viewingMode,L.direct.directionToLightSource);
I=this._mainLight;B=L.direct;h.scale(I.intensity,B.color,B.intensity*Math.PI);h.copy(I.direction,B.directionToLightSource);I.specularStrength=L.specularStrength;I.environmentStrength=L.environmentStrength;K=this._ambientLight;h.scale(K.intensity,L.ambient.color,L.ambient.intensity);J=this._moonLight;h.lerp(J.intensity,F,G,L.globalFactor);h.scale(J.intensity,J.intensity,(1-.5*L.globalFactor)*(1-.4*L.noonFactor*(1-L.globalFactor)));h.copy(J.direction,B.directionToLightSource);this._renderer.updateLightSources([I,
K,J],L.noonFactor,L.globalFactor,H);this._updateRenderParameters()}_autoUpdateTimezone(I,H=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==I)return!1;const B=E;B.setTime((H||this._view.environment.lighting.date).getTime());I=v.positionToTimezoneInfo(I,A);if(null==I)return!1;var K=this._view.environment.lighting.positionTimezoneInfo;if(!K.autoUpdated)K=I;else if(K.hours===I.hours&&K.minutes===I.minutes&&K.seconds===I.seconds)return!1;
const L=B.getUTCHours()-(I.hours-K.hours),J=B.getUTCMinutes()-(I.minutes-K.minutes);K=B.getUTCSeconds()-(I.seconds-K.seconds);B.setUTCHours(L);B.setUTCMinutes(J);B.setUTCSeconds(K);return H?!1:this._view.environment.lighting.autoUpdate(B,I)}_updateRenderParameters(){const I=this._view._stage;if(I){var H=null!=this._referencePosWGS84Comparable?r.computeShadowsEnabled(this._referencePosWGS84Comparable[2],this._view.state.viewingMode):!0;I.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&
H,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}}_resetReferencePosition(I=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");I&&this._cameraHandler()}_requestReferencePositionUpdate(I,H=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?
this._referencePosMapCoordsRequested.copy(I):this._referencePosMapCoordsRequested=I.clone(),this._referencePosResetPreserveAbsoluteTime=!!H,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const B=this._referencePosUpdateQuery=k.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===B)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==B)}).catch(L=>{"mapcoordshelper:missing-geometry-service"===L.name&&
(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===B&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),K=this._referencePosUpdateTimer=k.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===K&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(I){this._referencePosResetPreserveAbsoluteTime&&
(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const H=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);I()||isNaN(H[0])||isNaN(H[1])||(I=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?
(this._referencePosWGS84Comparable[0]=H[0],this._referencePosWGS84Comparable[1]=H[1],this._referencePosWGS84Comparable[2]=I):this._referencePosWGS84Comparable=[H[0],H[1],I],this._referencePosChanged())}_executePendingReferencePositionUpdate(){const I=this._referencePosMapCoordsRequested;I&&this._requestReferencePositionUpdate(I,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||
this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(I){return this._referencePosMapCoords?(I=this._referencePosMapCoords.distance(I),this._view.mapCoordsHelper&&(I*=this._view.mapCoordsHelper.unitInMeters),I>this._referencePointUpdateDistThreshold):!0}_cancelReferencePosUpdates(){const I=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return I}get test(){const I=this;return{get renderer(){return I._renderer},
set referencePointUpdateInterval(H){I._referencePointUpdateInterval=H},set referencePointUpdateDistThreshold(H){I._referencePointUpdateDistThreshold=H},set referencePosUpdateTimer(H){I._referencePosUpdateTimer=H},set referencePointUpdateDelay(H){I._referencePointUpdateDelay=H},set disableWeather(H){I._disableWeather=H}}}};b.__decorate([f.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);b.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,
"disableQueries",void 0);b.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);b.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);b.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",null);b.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);b.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);b.__decorate([f.property()],
a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=b.__decorate([p.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const D=new r.ColorAndIntensity,C=new r.ColorAndIntensity,E=new Date,A={hours:0,minutes:0,seconds:0},F=u.fromValues(.22,.22,.33),G=u.fromValues(.22,.22,.22);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToWGS84ComparableLonLat":function(){define(["exports",
"../../chunks/vec3f64","./projectVectorToWGS84ComparableLonLat"],function(a,b,g){const d=b.create();a.projectPointToWGS84ComparableLonLat=function(k,m){d[0]=k.x;d[1]=k.y;const f=k.z;d[2]=void 0!==f?f:0;return g.projectVectorToWGS84ComparableLonLat(d,k.spatialReference,m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToWGS84ComparableLonLat":function(){define(["exports","../../chunks/vec3f64","./projectors"],function(a,b,g){const d=b.create();
a.projectVectorToWGS84ComparableLonLat=function(k,m,f){if(null==m)return!1;m=g.getWGS84ComparableLonLatProjector(m);if(null==m)return!1;m(k,0,d,0);f!==d&&(f[0]=d[0],f[1]=d[1],2<f.length&&(f[2]=d[2]));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./AtmosphereType ./ChapmanAtmosphere ./CloudsComposition ./CloudsData ./CloudsGenerator ./CloudsParameters ./CloudsPresets ./Fog ./LocalAtmosphere ./MarsAtmosphere ./Precipitation ./Stars ./weather ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Update".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B){var K;a.EnvironmentRenderer=K=class extends I.SyncRenderPlugin{constructor(Q){super(Q);this.produces=new Map([[H.RenderSlot.ENVIRONMENT_OPAQUE,()=>!(null===this._atmosphere&&null===this._stars)],[H.RenderSlot.ENVIRONMENT_TRANSPARENT,()=>null!==this._atmosphere]]);this._atmosphere=this._context=null;this._oldWeatherParameters=new L;this._newWeatherParameters=new L;this._fadedWeatherParameters=new L;this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles();
this.uninitializeRenderContext();null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this);this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return null!=this.atmosphere?this.atmosphere.type:n.AtmosphereType.None}consumes(){return this._atmosphereType===n.AtmosphereType.Realistic?I.ConsumesDepth:I.ConsumesNone}updateAnimation(Q){return null!=this._precipitation?this._precipitation.update(Q):!1}get updating(){return null!=this._stars&&this._stars.updating||
null!=this._clouds&&this._clouds.running}get weatherVisible(){return p.length(this.view.state.camera.eye)-u.getReferenceEllipsoid(this.view.spatialReference).radius<=G.weatherHeightLimit}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const Q=this.view,O=Q.environment?.starsEnabled??!1,U=this._get("_stars");return O&&null!=this._context?null!=U?U:new F.Stars({view:Q,requestRender:()=>this._setNeedsRender()}):(k.destroyMaybe(U),null)}get _precipitation(){const Q=this._get("_precipitation");
if(!this._precipitationEnabled||null==this._context)return k.destroyMaybe(Q),null;const O=this.view,U=this._context;if(null!=Q&&Q.context===U)return Q;k.destroyMaybe(Q);return new A.Precipitation({context:U,view:O})}get _clouds(){const Q=this._get("_clouds");if(!this.weatherEnabled||null==this._context)return k.destroyMaybe(Q),null;if(null!=Q)return Q;const O=this.view,U=this._context;k.destroyMaybe(Q);return new r.CloudsGenerator({context:U,view:O,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const Q=
this._get("_cloudsComposition");if(!this.weatherEnabled||null==this._context)return k.destroyMaybe(Q),null;const O=this.view.state.viewingMode,U=this._context.renderContext.rctx,Z=u.getReferenceEllipsoid(this.view.spatialReference).radius;if(null!=Q&&Q.viewingMode===O&&Q.planetRadius===Z)return Q;k.destroyMaybe(Q);return new t.CloudsComposition({rctx:U,viewingMode:O,planetRadius:Z,requestRender:()=>this._setNeedsRender()})}get _fog(){const Q=this._get("_fog");return this.weatherEnabled&&null!=this._context?
null!=Q?Q:new D.Fog({context:this._context,view:this.view,rctx:this._context.renderContext.rctx,viewingMode:this.view.state.viewingMode}):(k.destroyMaybe(Q),null)}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(Q=null){this._context=Q;Q=()=>this._setNeedsRender();this.addHandles([m.watch(()=>({viewingMode:this.view.state.viewingMode,
enabled:this.view.environment.atmosphereEnabled}),O=>this._updateAtmosphere(O),m.syncAndInitial),m.watch(()=>this._stars,Q),m.watch(()=>this._precipitation,Q),m.watch(()=>this._clouds,()=>this._updateWeather(),m.initial),m.watch(()=>this._fog,()=>this._updateFogHaze(),m.initial),m.watch(()=>this.view.state.mode,()=>{this._setNeedsRender()},m.sync),m.watch(()=>this._weatherUpdateParameters,()=>{this._updateWeather();this._updateFogHaze()},m.syncAndInitial)])}uninitializeRenderContext(){this._context=
null;this._atmosphere=k.destroyMaybe(this._atmosphere);this._set("_stars",k.destroyMaybe(this._stars));this._set("_precipitation",k.destroyMaybe(this._precipitation));this._set("_clouds",k.destroyMaybe(this._clouds));this._set("_cloudsComposition",k.destroyMaybe(this._cloudsComposition));this._set("_fog",k.destroyMaybe(this._fog))}prepareRender(Q){Q.bindParameters.cloudsFade.data=v.isReadyCloudsData(this._clouds)?this._clouds:null;"local"!==this.view.viewingMode&&null!=Q.bindParameters.cloudsFade.data?.cubeMap&&
(this._updateWeatherFading(Q.bindParameters,Q.time),Q.bindParameters.cloudsFade.renderingStage===v.CloudsRenderingStages.FINISHED&&null!=this._clouds&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),Q.bindParameters.cloudsFade.data=null))}renderNode(Q){switch(Q.bindParameters.slot){case H.RenderSlot.ENVIRONMENT_OPAQUE:null!=this._stars&&this._stars.render(Q);null!=this.atmosphere&&(this.atmosphere.render(Q,this.view?._stage?.renderer?.fullResolutionAtmosphere),
null!=this._cloudsComposition&&null!=Q.bindParameters.cloudsFade.data&&(this.weatherVisible&&null!=this._clouds&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(Q)),Q.bindParameters.cloudsFade.isFading&&null!=this._context&&null!=Q.bindParameters.cloudsFade.data?.cubeMap&&this._context.requestRender());break;case H.RenderSlot.ENVIRONMENT_TRANSPARENT:if(null!=this.atmosphere&&(this.atmosphere.renderHaze(Q,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),
0<this._weatherParameters.fog.amount&&null!=this._fog&&this._fog.render(Q,this._weatherParameters.fog),null!=this._precipitation)){const O=this.view.environment.weather;"rainy"!==O.type&&"snowy"!==O.type||this._precipitation.render(Q,O.precipitation,O.type)}}}updateLightSources(Q,O,U,Z){if(null!=this._context){const P=this._context.renderContext;P.bindParameters.oldLighting.copyFrom(P.bindParameters.lighting);P.bindParameters.newLighting.noonFactor=O;P.bindParameters.newLighting.globalFactor=U;P.bindParameters.newLighting.set(Q);
Z===B.Update.Faded||P.bindParameters.weatherFading?P.bindParameters.fadeLighting(0):P.bindParameters.fadeLighting(1);this._context.requestRender()}}get _weatherUpdateParameters(){const Q=this.weatherEnabled?this.view.environment.weather:null;return null==Q?null:"rainy"===Q.type||"snowy"===Q.type?{type:Q.type,weatherAdjustment:Q.cloudCover,effect:Q.precipitation}:{type:Q.type,weatherAdjustment:"foggy"===Q.type?Q.fogStrength:Q.cloudCover}}_updateWeatherFading(Q,O){Q.cloudsFade.updateFading(Q.camera,
this.view.state.mode,O,this.view.qualitySettings.fadeDuration);Q.cloudsFade.updateParallax(Q.camera);Q.weatherFading&&(this._updateLighting(Q),this._updateFogAtmoshpere(Q))}_updateLighting(Q){Q.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||Q.cloudsFade.fadeMode===y.FadeMode.FADE_IN?Q.fadeLighting(Q.cloudsFade.fadeFactor):Q.fadeLighting(0)}_updateFogAtmoshpere(Q){Q.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||Q.cloudsFade.fadeMode===y.FadeMode.FADE_IN?this._fadeWeather(Q.cloudsFade.fadeFactor):this._fadeWeather(0)}_fadeWeather(Q){const {_newWeatherParameters:O,
_oldWeatherParameters:U}=this;1<=Q?this._weatherParameters=O:(this._fadedWeatherParameters.lerp(U,O,Q),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const Q=this._weatherUpdateParameters;null!=Q&&null!=this._clouds&&(this._clouds.applyPreset(z.cloudPresets[Q.type],Q.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){null!=this._context&&this._context.requestRender()}_updateFogHaze(){const Q=this._weatherUpdateParameters;if(null!=this._fog&&null!=Q&&null!=this._context){var O=
this._context.renderContext.bindParameters;this._oldWeatherParameters.copyFrom(this._weatherParameters);switch(Q.type){case "foggy":this._newWeatherParameters.fog.strength=d.lerp(3E-5,.005,Q.weatherAdjustment**3);p.copy(this._newWeatherParameters.fog.color,M);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;case "rainy":this._newWeatherParameters.fog.strength=d.lerp(4E-6,2E-4,(Q.effect??0)**3);p.copy(this._newWeatherParameters.fog.color,
J);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=0;this._setNeedsRender();break;case "snowy":this._newWeatherParameters.fog.strength=d.lerp(4E-6,2E-4,(Q.effect??0)**3);p.copy(this._newWeatherParameters.fog.color,M);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}O.weatherFading?
this._fadeWeather(0):this._fadeWeather(1)}}_updateAtmosphere(Q){Q=this._selectAtmosphereType(Q);if(Q===n.AtmosphereType.None||!this._context)this._atmosphere=k.destroyMaybe(this._atmosphere);else if(!this._atmosphere||this._atmosphere.type!==Q)if(this._atmosphere=k.destroyMaybe(this._atmosphere),Q=this._getAtmosphereClass(Q))this._atmosphere=new Q(this.view,this._context);this._setNeedsRender()}_getAtmosphereClass(Q){switch(Q){case n.AtmosphereType.Realistic:return q.ChapmanAtmosphere;case n.AtmosphereType.Local:return C.LocalAtmosphere;
case n.AtmosphereType.Mars:return E;default:case n.AtmosphereType.None:return null}}_selectAtmosphereType(Q){const {enabled:O,viewingMode:U}=Q;return!O||w.isMoon(this.view.spatialReference)?n.AtmosphereType.None:U===x.ViewingMode.Local?n.AtmosphereType.Local:null!=this._context&&q.ChapmanAtmosphere.isSupported(this._context)&&w.isEarth(this.view.spatialReference)?n.AtmosphereType.Realistic:w.isMars(this.view.spatialReference)?n.AtmosphereType.Mars:n.AtmosphereType.None}get test(){return{atmosphere:this._atmosphere,
clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:Q=>{T=K.prototype._getAtmosphereClass;K.prototype._getAtmosphereClass=Q},restoreGetAtmosphereClass:()=>{K.prototype._getAtmosphereClass=T}}}};b.__decorate([f.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"atmosphere",
null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_atmosphereType",null);b.__decorate([f.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);b.__decorate([f.property()],a.EnvironmentRenderer.prototype,"_context",void 0);b.__decorate([f.property()],a.EnvironmentRenderer.prototype,"_atmosphere",void 0);b.__decorate([f.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"_stars",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherEnabled",
null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=K=b.__decorate([e.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);class L{constructor(){this.fog=new D.FogParameters;this.hazeAmount=1}copyFrom(Q){this.fog.amount=Q.fog.amount;this.hazeAmount=Q.hazeAmount;this.fog.strength=Q.fog.strength;
p.copy(this.fog.color,Q.fog.color)}lerp(Q,O,U){this.fog.amount=d.lerp(Q.fog.amount,O.fog.amount,U);this.hazeAmount=d.lerp(Q.hazeAmount,O.hazeAmount,U);this.fog.strength=d.lerp(Q.fog.strength,O.fog.strength,U);p.lerp(this.fog.color,Q.fog.color,O.fog.color,U)}}const J=h.fromValues(.5,.5,.5),M=h.fromValues(1.5,1.5,1.5);let T;a.WeatherParameters=L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/AtmosphereType":function(){define(["exports"],function(a){a.AtmosphereType=
void 0;var b=a.AtmosphereType||(a.AtmosphereType={});b[b.Realistic=0]="Realistic";b[b.Local=1]="Local";b[b.Mars=2]="Mars";b[b.None=3]="None";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/colorUtils ../../../core/Handles ../../../core/mathUtils ../../../core/reactiveUtils ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./AtmosphereType ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl-engine/core/FBOCache ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/textureUtils ../../../chunks/AtmosphereCompositing.glsl ../webgl-engine/shaders/AtmosphereCompositingTechnique ../../webgl/enums ../../../webscene/background/ColorBackground".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){class D{constructor(C,E){this._view=C;this._context=E;this.type=p.AtmosphereType.Realistic;this._handles=new g;this._atmosphereCompositionParameters=new v.AtmosphereCompositingPassParameters;this._atmosphereConfiguration=new w.ChapmanAtmosphereTechniqueConfiguration;this._passParameters=new u.ChapmanAtmospherePassParameters;this._rootTileElevationMin=NaN;this._lowerBoundEarthRadius=e.earth.radius;this._fadeHaze=0;this._updateRadius(e.earth.radius);
C=this._context.renderContext.rctx;this._updateRootTileElevationBounds();this._handles.add([k.watch(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),k.watch(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),k.watch(()=>this._view?.environment.background,A=>{A=A instanceof z?b.unitRGBAFromColor(A.color):l.ZEROS;f.set(this._passParameters.backgroundColor,
A[0]*A[3],A[1]*A[3],A[2]*A[3])},k.syncAndInitial)]);E=new w.ChapmanAtmosphereTechniqueConfiguration;E.haze=!1;this._atmosphereTechnique=this._context.techniqueRepository.acquire(u.ChapmanAtmosphereTechnique,E);E.haze=!0;this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(u.ChapmanAtmosphereTechnique,E);E.reduced=!0;E.haze=!1;this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(u.ChapmanAtmosphereTechnique,E);E.haze=!0;this._atmosphereHazeReducedTechnique=
this._context.techniqueRepository.acquire(u.ChapmanAtmosphereTechnique,E);this._vao=q.createQuadVAO(C,n.Pos2Tex)}destroy(){this._handles.destroy();this._atmosphereTechnique.release();this._atmosphereHazeTechnique.release();this._atmosphereReducedTechnique.release();this._atmosphereHazeReducedTechnique.release();this._vao.dispose()}render(C,E){this._render(C,E?this._atmosphereTechnique:this._atmosphereReducedTechnique,C.offscreenRenderingHelper.depthTexture,E,!1)}renderHaze(C,E,A){this._fadeHaze=E;
this._render(C,A?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,C.bindParameters.linearDepth?.colorTexture,A,!0)}_render(C,E,A,F,G){if(null!=A){var I=C.offscreenRenderingHelper;this._update(C.bindParameters.camera);this._passParameters.depthTexture=A;var H=C.rctx.bindTechnique(E,this._passParameters,C.bindParameters);if(F)I.renderDepthDetached(()=>this._renderCommon(H,C));else{E=C.rctx.getViewport();F=f.length(C.bindParameters.camera.eye)-e.earth.radius;if(F<h.atmosphereHeight){F=
Math.min(1,Math.max(0,F/h.atmosphereHeight));var B=G?d.lerp(.4,.5,F):d.lerp(.2,.3,F)}else F=Math.min(1,Math.max(0,(F-h.atmosphereHeight)/(15*h.atmosphereHeight))),B=G?d.lerp(.5,1,F):d.lerp(.3,.6,F);F=t.applyTextureResizeModulo(Math.round(B*C.bindParameters.camera.fullViewport[2]));B=t.applyTextureResizeModulo(Math.round(B*C.bindParameters.camera.fullViewport[3]));C.rctx.setViewport(0,0,F,B);F=I.renderToCachedFBO(null,()=>this._renderCommon(H,C),[0,0,0,1],x.ColorFormat.RGBA,null,F,B);C.rctx.setViewport(E.x,
E.y,E.width,E.height);this._atmosphereCompositionParameters.color=F.colorTexture;this._atmosphereCompositionParameters.depth=A;this._atmosphereConfiguration.haze=G;A=this._context.techniqueRepository.acquire(r.AtmosphereCompositingTechnique,this._atmosphereConfiguration);C.rctx.bindTechnique(A,this._atmosphereCompositionParameters,C.bindParameters);I.renderDepthDetached(()=>C.rctx.screen.draw());A.release();F.release()}}}_renderCommon(C,E){null!=this._vao&&(E.rctx.bindVAO(this._vao),C.assertCompatibleVertexAttributeLocations(this._vao),
E.rctx.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(C){return C*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const C=this._view.basemapTerrain.rootTileElevationBounds.min;C!==this._rootTileElevationMin&&(this._rootTileElevationMin=C,this._lowerBoundEarthRadius=e.earth.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const C=this._adjustRadiusForTesselation(e.earth.radius+this._view.basemapTerrain.visibleElevationBounds.min);C<
this._lowerBoundEarthRadius&&this._updateRadius(C)}_updateRadius(C){this._lowerBoundEarthRadius=C;m.set(this._passParameters.radii,C,C+h.atmosphereHeight);this._passParameters.innerFadeDistance=2*Math.sqrt((2*C-h.innerAtmosphereDepth)*h.innerAtmosphereDepth)}_update(C){if(C){C=f.squaredLength(C.eye);var E=Math.sqrt(C),A=C-this._passParameters.radii[1]*this._passParameters.radii[1],F=d.clamp((E-this._passParameters.radii[0])/h.atmosphereHeight,0,1);c.set(this._passParameters.heightParameters,E,C,A,
F);this._passParameters.altitudeFade=h.computeInnerAltitudeFade(E-this._lowerBoundEarthRadius);this._passParameters.hazeStrength=d.lerp(d.lerp(.6,1,d.smoothstep(9500,10500,E-e.earth.radius)),1,this._fadeHaze)}}static isSupported(C){return C.renderContext.rctx.capabilities.depthTexture}}a.ChapmanAtmosphere=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports","../Color","../chunks/vec4","../chunks/vec4f64"],function(a,b,g,d){function k(q,
t){const v=[];let r,y;if(q[0].length!==t.length)throw Error("dimensions do not match");const z=q.length,D=q[0].length;let C=0;for(r=0;r<z;r++){for(y=C=0;y<D;y++)C+=q[r][y]*t[y];v.push(C)}return v}function m(q){q=[q.r/255,q.g/255,q.b/255].map(t=>.04045>=t?t/12.92:((t+.055)/1.055)**2.4);q=k(x,q);return{x:100*q[0],y:100*q[1],z:100*q[2]}}function f(q){q=k(n,[q.x/100,q.y/100,q.z/100]).map(t=>Math.min(1,Math.max(.0031308>=t?12.92*t:1.055*t**(1/2.4)-.055,0)));return{r:Math.round(255*q[0]),g:Math.round(255*
q[1]),b:Math.round(255*q[2])}}function c(q){q=[q.x/95.047,q.y/100,q.z/108.883].map(t=>t>(6/29)**3?t**(1/3):1/3*(29/6)**2*t+4/29);return{l:116*q[1]-16,a:500*(q[0]-q[1]),b:200*(q[1]-q[2])}}function l(q){const t=q.l;q=[(t+16)/116+q.a/500,(t+16)/116,(t+16)/116-q.b/200].map(v=>v>6/29?v**3:3*(6/29)**2*(v-4/29));return{x:95.047*q[0],y:100*q[1],z:108.883*q[2]}}function e(q){if("r"in q&&"g"in q&&"b"in q)return q;if("l"in q&&"c"in q&&"h"in q){var t=q.c,v=q.h;return f(l({l:q.l,a:t*Math.cos(v),b:t*Math.sin(v)}))}if("l"in
q&&"a"in q&&"b"in q)return f(l(q));if("x"in q&&"y"in q&&"z"in q)return f(q);if("h"in q&&"s"in q&&"v"in q){v=(q.h+360)%360/60;t=q.v/100*255;q=q.s/100*t;const r=q*(1-Math.abs(v%2-1));switch(Math.floor(v)){case 0:v={r:q,g:r,b:0};break;case 1:v={r,g:q,b:0};break;case 2:v={r:0,g:q,b:r};break;case 3:v={r:0,g:r,b:q};break;case 4:v={r,g:0,b:q};break;case 5:case 6:v={r:q,g:0,b:r};break;default:v={r:0,g:0,b:0}}v.r=Math.round(v.r+t-q);v.g=Math.round(v.g+t-q);v.b=Math.round(v.b+t-q);return v}return q}function p(q){if("h"in
q&&"s"in q&&"v"in q)return q;var t=e(q);q=t.r;const v=t.g,r=t.b;t=Math.max(q,v,r);const y=t-Math.min(q,v,r);q=0===y?0:t===q?(v-r)/y%6:t===v?(r-q)/y+2:(q-v)/y+4;0>q&&(q+=6);return{h:60*q,s:100*(0===y?0:y/t),v:100/255*t}}function h(q){return"l"in q&&"a"in q&&"b"in q?q:c(m(e(q)))}function u(q){let {r:t,g:v,b:r,a:y}=q;1>y&&(t=Math.round(y*t+255*(1-y)),v=Math.round(y*v+255*(1-y)),r=Math.round(y*r+255*(1-y)));return new b({r:t,g:v,b:r})}function w(q,t){const {r:v,g:r,b:y}=t?.ignoreAlpha?q:u(q);return.2126*
v+.7152*r+.0722*y}const x=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],n=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];a.BrightnessThreshold=void 0;(function(q){q[q.Low=160]="Low";q[q.High=225]="High"})(a.BrightnessThreshold||(a.BrightnessThreshold={}));a.colorEquals=function(q,t){return q===t||null!=q&&q.equals(t)};a.colorVectorEquals=function(q,t){return q===t||null!=q&&null!=t&&g.equals(q,t)};a.colorVectorToColorAndOpacity=function(q){return d.fromValues(q[0],
q[1],q[2],3<q.length?q[3]:1)};a.darken=function(q,t){var v=h(q);v.l*=1-t;t=e(v);v=q.clone();v.setColor(t);v.a=q.a;return v};a.desaturate=function(q,t){var v=p(q);v.s*=t;t=e(v);v=q.clone();v.setColor(t);v.a=q.a;return v};a.getColorLuminance=w;a.getColorTheme=function(q){return u(q).isBright?"light":"dark"};a.getContrast=function(q,t=a.BrightnessThreshold.High){return w(q,{ignoreAlpha:!0})>t?new b([0,0,0,q.a]):new b([255,255,255,q.a])};a.multiplyOpacity=function(q,t){q=q.clone();q.a*=t;return q};a.multiplyOpacityToUnitRGBA=
function(q,t){q=b.toUnitRGBA(q);q[3]*=t;return q};a.toHSV=p;a.toLAB=h;a.toLCH=function(q){if(!("l"in q&&"c"in q&&"h"in q)){var t=c(m(e(q)));q=t.l;var v=t.a;const r=t.b;t=Math.sqrt(v*v+r*r);v=Math.atan2(r,v);v=0<v?v:v+2*Math.PI;q={l:q,c:t,h:v}}return q};a.toRGB=e;a.unitRGBAFromColor=function(q){return b.toUnitRGBA(q)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,b){function g(O,U){O[0]=U[0];O[1]=U[1];return O}
function d(O,U,Z){O[0]=U;O[1]=Z;return O}function k(O,U,Z){O[0]=U[0]+Z[0];O[1]=U[1]+Z[1];return O}function m(O,U,Z){O[0]=U[0]-Z[0];O[1]=U[1]-Z[1];return O}function f(O,U,Z){O[0]=U[0]*Z[0];O[1]=U[1]*Z[1];return O}function c(O,U,Z){O[0]=U[0]/Z[0];O[1]=U[1]/Z[1];return O}function l(O,U){O[0]=Math.ceil(U[0]);O[1]=Math.ceil(U[1]);return O}function e(O,U){O[0]=Math.floor(U[0]);O[1]=Math.floor(U[1]);return O}function p(O,U,Z){O[0]=Math.min(U[0],Z[0]);O[1]=Math.min(U[1],Z[1]);return O}function h(O,U,Z){O[0]=
Math.max(U[0],Z[0]);O[1]=Math.max(U[1],Z[1]);return O}function u(O,U){O[0]=Math.round(U[0]);O[1]=Math.round(U[1]);return O}function w(O,U,Z){O[0]=U[0]*Z;O[1]=U[1]*Z;return O}function x(O,U,Z,P){O[0]=U[0]+Z[0]*P;O[1]=U[1]+Z[1]*P;return O}function n(O,U){const Z=U[0]-O[0];O=U[1]-O[1];return Math.sqrt(Z*Z+O*O)}function q(O,U){const Z=U[0]-O[0];O=U[1]-O[1];return Z*Z+O*O}function t(O){const U=O[0];O=O[1];return Math.sqrt(U*U+O*O)}function v(O){const U=O[0];O=O[1];return U*U+O*O}function r(O,U){O[0]=-U[0];
O[1]=-U[1];return O}function y(O,U){O[0]=1/U[0];O[1]=1/U[1];return O}function z(O,U){var Z=U[0];const P=U[1];Z=Z*Z+P*P;0<Z&&(Z=1/Math.sqrt(Z),O[0]=U[0]*Z,O[1]=U[1]*Z);return O}function D(O,U){return O[0]*U[0]+O[1]*U[1]}function C(O,U,Z){U=U[0]*Z[1]-U[1]*Z[0];O[0]=O[1]=0;O[2]=U;return O}function E(O,U,Z,P){const R=U[0];U=U[1];O[0]=R+P*(Z[0]-R);O[1]=U+P*(Z[1]-U);return O}function A(O,U){U=U||1;const Z=2*b.RANDOM()*Math.PI;O[0]=Math.cos(Z)*U;O[1]=Math.sin(Z)*U;return O}function F(O,U,Z){const P=U[0];
U=U[1];O[0]=Z[0]*P+Z[2]*U;O[1]=Z[1]*P+Z[3]*U;return O}function G(O,U,Z){const P=U[0];U=U[1];O[0]=Z[0]*P+Z[2]*U+Z[4];O[1]=Z[1]*P+Z[3]*U+Z[5];return O}function I(O,U,Z){const P=U[0];U=U[1];O[0]=Z[0]*P+Z[3]*U+Z[6];O[1]=Z[1]*P+Z[4]*U+Z[7];return O}function H(O,U,Z){const P=U[0];U=U[1];O[0]=Z[0]*P+Z[4]*U+Z[12];O[1]=Z[1]*P+Z[5]*U+Z[13];return O}function B(O,U,Z,P){const R=U[0]-Z[0];U=U[1]-Z[1];const W=Math.sin(P);P=Math.cos(P);O[0]=R*P-U*W+Z[0];O[1]=R*W+U*P+Z[1];return O}function K(O,U){var Z=O[0];O=O[1];
const P=U[0];U=U[1];let R=Z*Z+O*O;0<R&&(R=1/Math.sqrt(R));let W=P*P+U*U;0<W&&(W=1/Math.sqrt(W));Z=(Z*P+O*U)*R*W;return 1<Z?0:-1>Z?Math.PI:Math.acos(Z)}function L(O){return"vec2("+O[0]+", "+O[1]+")"}function J(O,U){return O[0]===U[0]&&O[1]===U[1]}function M(O,U){const Z=O[0];O=O[1];const P=U[0];U=U[1];const R=b.getEpsilon();return Math.abs(Z-P)<=R*Math.max(1,Math.abs(Z),Math.abs(P))&&Math.abs(O-U)<=R*Math.max(1,Math.abs(O),Math.abs(U))}function T(O,U,Z,P,R){let W=U[0]-Z[0];Z=U[1]-Z[1];R=(P[0]*W+P[1]*
Z)*(R-1);W=P[0]*R;Z=P[1]*R;O[0]=U[0]+W;O[1]=U[1]+Z;return O}const Q=Object.freeze(Object.defineProperty({__proto__:null,add:k,angle:K,ceil:l,copy:g,cross:C,dist:n,distance:n,div:c,divide:c,dot:D,equals:M,exactEquals:J,floor:e,inverse:y,len:t,length:t,lerp:E,max:h,min:p,mul:f,multiply:f,negate:r,normalize:z,projectAndScale:T,random:A,rotate:B,round:u,scale:w,scaleAndAdd:x,set:d,sqrDist:q,sqrLen:v,squaredDistance:q,squaredLength:v,str:L,sub:m,subtract:m,transformMat2:F,transformMat2d:G,transformMat3:I,
transformMat4:H},Symbol.toStringTag,{value:"Module"}));a.add=k;a.angle=K;a.ceil=l;a.copy=g;a.cross=C;a.dist=n;a.distance=n;a.div=c;a.divide=c;a.dot=D;a.equals=M;a.exactEquals=J;a.floor=e;a.inverse=y;a.len=t;a.length=t;a.lerp=E;a.max=h;a.min=p;a.mul=f;a.multiply=f;a.negate=r;a.normalize=z;a.projectAndScale=T;a.random=A;a.rotate=B;a.round=u;a.scale=w;a.scaleAndAdd=x;a.set=d;a.sqrDist=q;a.sqrLen=v;a.squaredDistance=q;a.squaredLength=v;a.str=L;a.sub=m;a.subtract=m;a.transformMat2=F;a.transformMat2d=G;
a.transformMat3=I;a.transformMat4=H;a.vec2=Q})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../core/mathUtils"],function(a,b){a.atmosphereHeight=1E5;a.computeInnerAltitudeFade=function(g){return b.clamp((g-1E5)/9E5,0,1)};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){class w extends f.NoParameters{constructor(){super(...arguments);this.heightParameters=k.create();this.radii=g.create();this.altitudeFade=this.innerFadeDistance=0;this.hazeStrength=1;this.renderScale=g.create();this.backgroundColor=d.create()}}class x extends l.ShaderTechnique{initializeProgram(n){return new p.Program(n.rctx,x.shader.get().build(this.configuration),e.Default3D)}initializePipeline(){return this.configuration.reduced?u.makePipelineState({blending:u.simpleBlendingParams(h.BlendFactor.ONE,
h.BlendFactor.ZERO),depthTest:{func:h.CompareFunction.ALWAYS},colorWrite:u.defaultColorWriteParams}):this.configuration.haze?u.makePipelineState({blending:u.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.ONE_MINUS_SRC_COLOR,h.BlendFactor.ONE),colorWrite:u.defaultColorWriteParams}):u.makePipelineState({blending:u.simpleBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:h.CompareFunction.LEQUAL},colorWrite:u.defaultColorWriteParams})}}
x.shader=new c.ReloadableShaderModule(m.ChapmanAtmosphere,()=>new Promise((n,q)=>a(["./ChapmanAtmosphere.glsl"],n,q)));b.ChapmanAtmospherePassParameters=w;b.ChapmanAtmosphereTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3f64 ../views/3d/environment/atmosphereUtils ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){function v(C){const E=new n.ShaderBuilder;E.attributes.add(t.VertexAttribute.POSITION,"vec2");E.include(m.TextureCoordinateAttribute,{textureCoordinateType:m.TextureCoordinateAttributeType.Default});E.varyings.add("worldRay","vec3");E.varyings.add("eyeDir","vec3");const {vertex:A,fragment:F}=E;A.uniforms.add(new x.Matrix4PassUniform("inverseProjectionMatrix",(G,I)=>I.camera.inverseProjectionMatrix),new x.Matrix4PassUniform("inverseViewMatrix",(G,I)=>b.invertOrIdentity(D,
I.camera.viewMatrix)));A.code.add(w.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);F.uniforms.add(new p.Float3PassUniform("backgroundColor",G=>G.backgroundColor),new e.Float2PassUniform("radii",G=>G.radii),new p.Float3PassUniform("cameraPosition",(G,I)=>I.camera.eye),new h.Float4PassUniform("heightParameters",G=>G.heightParameters),new u.FloatPassUniform("innerFadeDistance",G=>G.innerFadeDistance),new u.FloatPassUniform("altitudeFade",G=>G.altitudeFade),new q.Texture2DPassUniform("depthTexture",G=>G.depthTexture),new u.FloatPassUniform("hazeStrength",G=>G.hazeStrength));F.constants.add("betaRayleigh",
"vec3",r);F.constants.add("betaCombined","vec3",z);F.constants.add("betaMie","float",3.996E-6);F.constants.add("scaleHeight","float",k.rayLeighScaleHeight*k.atmosphereHeight);l.addMainLightDirection(F);E.include(c.Gamma);C.haze&&(F.include(f.ReadLinearDepth),F.uniforms.add(new e.Float2PassUniform("nearFar",(G,I)=>I.camera.nearFar)));F.code.add(w.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);F.code.add(w.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);F.code.add(w.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);F.code.add(w.glsl`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${C.haze?w.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${C.haze?"":w.glsl`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${C.haze?"":w.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${C.haze?w.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:w.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${C.haze?"":w.glsl`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${C.haze&&C.reduced?w.glsl`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${C.haze?w.glsl`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${C.reduced?w.glsl`cameraSpaceRay *= -textureBilinear(vuv0);`:w.glsl`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:w.glsl`${C.reduced?"":w.glsl`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${C.haze?w.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:w.glsl`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${C.haze?"":w.glsl`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `);return E}const r=d.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),y=d.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6))),z=d.fromValues(parseFloat(Number(r[0]+y[0]).toFixed(6)),parseFloat(Number(r[1]+y[1]).toFixed(6)),parseFloat(Number(r[2]+y[2]).toFixed(6))),D=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:r,
build:v},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphere=g;a.betaRayleigh=r;a.build=v})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,g,d){a.TextureCoordinateAttributeType=void 0;(function(k){k[k.None=0]="None";k[k.Default=1]="Default";k[k.Atlas=2]="Atlas";k[k.Compressed=3]="Compressed";k[k.COUNT=4]=
"COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(k,m){switch(m.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:k.attributes.add(d.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.vertex.code.add(g.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Compressed:k.attributes.add(d.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.vertex.code.add(g.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case a.TextureCoordinateAttributeType.Atlas:k.attributes.add(d.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.attributes.add(d.VertexAttribute.UVREGION,"vec4");k.varyings.add("vuvRegion","vec4");k.vertex.code.add(g.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:b.neverReached(m.textureCoordinateType);case a.TextureCoordinateAttributeType.None:k.vertex.code.add(g.glsl`void forwardTextureCoordinates() {}`);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(k,...m){let f="";for(let c=0;c<m.length;c++)f+=k[c]+m[c];return f+=k[k.length-1]}class g{}const d=g;(function(k){k.int=
function(m){return Math.round(m).toString()};k.float=function(m){return m.toPrecision(8)}})(b||(b={}));a.NoParameters=d;a.glsl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;(function(b){b.POSITION="position";b.NORMAL="normal";b.NORMALCOMPRESSED="normalCompressed";b.UV0="uv0";b.AUXPOS1="auxpos1";b.AUXPOS2="auxpos2";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE=
"size";b.TANGENT="tangent";b.OFFSET="offset";b.PERSPECTIVEDIVIDE="perspectiveDivide";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";b.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";b.FEATUREVALUE=
"featureValue";b.INSTANCEMODELORIGINHI="instanceModelOriginHi";b.INSTANCEMODELORIGINLO="instanceModelOriginLo";b.INSTANCEMODEL="instanceModel";b.INSTANCEMODELNORMAL="instanceModelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL=
"lodLevel";b.POSITION0="position0";b.POSITION1="position1";b.NORMALA="normalA";b.NORMALB="normalB";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";b.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";b.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(a.VertexAttribute||(a.VertexAttribute={}));a.affectsGeometry=function(b){return b===
a.VertexAttribute.POSITION};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,g){a.ReadLinearDepth=function(d){d.include(b.RgbaFloatEncoding);d.code.add(g.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTex, 0)));
return linearDepthFromRGBA(texelFetch(depthTex, iuv, 0), nearFar);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(g){g.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(g){g.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,g){function d(m){m.uniforms.add(new b.Float3PassUniform("mainLightDirection",(f,c)=>c.lighting.mainLight.direction))}function k(m){m.uniforms.add(new b.Float3PassUniform("mainLightIntensity",(f,c)=>c.lighting.mainLight.intensity))}a.MainLighting=
function(m){d(m.fragment);k(m.fragment);m.fragment.code.add(g.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)};a.addMainLightDirection=d;a.addMainLightIntensity=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"vec3",g.BindType.Pass,(f,c,l)=>f.setUniform3fv(k,m(c,l)))}}a.Float3PassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports",
"../shaderTechnique/BindType"],function(a,b){class g{constructor(d,k,m,f,c=null){this.name=d;this.type=k;this.arraySize=c;this.bind={[b.BindType.Pass]:null,[b.BindType.Draw]:null};if(f)switch(m){case b.BindType.Pass:this.bind[b.BindType.Pass]=f;break;case b.BindType.Draw:this.bind[b.BindType.Draw]=f}}equals(d){return this.type===d.type&&this.name===d.name&&this.arraySize===d.arraySize}}a.Uniform=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"vec2",g.BindType.Pass,(f,c,l)=>f.setUniform2fv(k,m(c,l)))}}a.Float2PassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"vec4",g.BindType.Pass,(f,c,l)=>f.setUniform4fv(k,m(c,l)))}}a.Float4PassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,
g){class d extends b.Uniform{constructor(k,m){super(k,"float",g.BindType.Pass,(f,c,l)=>f.setUniform1f(k,m(c,l)))}}a.FloatPassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"mat4",g.BindType.Pass,(f,c,l)=>f.setUniformMatrix4fv(k,m(c,l)))}}a.Matrix4PassUniform=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../shaderTechnique/BindType","../../lib/Util"],function(a,b,g,d,k){const m=g.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class f{constructor(){this._includedModules=new Map}include(q,t){if(this._includedModules.has(q)){const v=this._includedModules.get(q);if(v!==t){m.error("Trying to include shader module multiple times with different sets of options.");
t=new Set;for(const r of Object.keys(v))v[r]!==q[r]&&t.add(r);for(const r of Object.keys(q))v[r]!==q[r]&&t.add(r);t.forEach(r=>console.error(`  ${r}: current ${v[r]} new ${q[r]}`))}}else this._includedModules.set(q,t),q(this.builder,t)}}class c extends f{constructor(){super(...arguments);this.vertex=new p;this.fragment=new p;this.attributes=new h;this.varyings=new u;this.extensions=new w;this.constants=new n;this.outputs=new x}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(q){const t=
this.extensions.generateSource(q),v=this.attributes.generateSource(q),r=this.varyings.generateSource(q);var y="vertex"===q?this.vertex:this.fragment;const z=y.uniforms.generateSource(),D=y.code.generateSource(),C="vertex"===q?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";y=this.constants.generateSource().concat(y.constants.generateSource());
q=this.outputs.generateSource(q);return`#version 300 es\n${t.join("\n")}\n\n${C}\n\n${y.join("\n")}\n\n${z.join("\n")}\n\n${v.join("\n")}\n\n${r.join("\n")}\n\n${q.join("\n")}\n\n${D.join("\n")}`}generateBindPass(q){const t=new Map;this.vertex.uniforms.entries.forEach(y=>{const z=y.bind[d.BindType.Pass];z&&t.set(y.name,z)});this.fragment.uniforms.entries.forEach(y=>{const z=y.bind[d.BindType.Pass];z&&t.set(y.name,z)});const v=Array.from(t.values()),r=v.length;return(y,z)=>{for(let D=0;D<r;++D)v[D](q,
y,z)}}generateBindDraw(q){const t=new Map;this.vertex.uniforms.entries.forEach(y=>{const z=y.bind[d.BindType.Draw];z&&t.set(y.name,z)});this.fragment.uniforms.entries.forEach(y=>{const z=y.bind[d.BindType.Draw];z&&t.set(y.name,z)});const v=Array.from(t.values()),r=v.length;return(y,z,D)=>{for(let C=0;C<r;++C)v[C](q,y,z,D)}}}class l{constructor(){this._entries=new Map}add(...q){for(const t of q)this._add(t)}get(q){return this._entries.get(q)}_add(q){if(null==q)m.error(`Trying to add null Uniform from ${Error().stack}.`);
else{if(this._entries.has(q.name)&&!this._entries.get(q.name).equals(q))throw new b(`Duplicate uniform name ${q.name} for different uniform type`);this._entries.set(q.name,q)}}generateSource(){return Array.from(this._entries.values()).map(q=>null!=q.arraySize?`uniform ${q.type} ${q.name}[${q.arraySize}];`:`uniform ${q.type} ${q.name};`)}get entries(){return Array.from(this._entries.values())}}class e{constructor(){this._entries=[]}add(q){this._entries.push(q)}generateSource(){return this._entries}}
class p extends f{constructor(){super(...arguments);this.uniforms=new l;this.code=new e;this.constants=new n}get builder(){return this}}class h{constructor(){this._entries=[]}add(q,t){this._entries.push([q,t])}generateSource(q){return"fragment"===q?[]:this._entries.map(t=>`in ${t[1]} ${t[0]};`)}}class u{constructor(){this._entries=new Map}add(q,t){this._entries.has(q)&&k.assert(this._entries.get(q)===t);this._entries.set(q,t)}generateSource(q){const t=[];this._entries.forEach((v,r)=>t.push("vertex"===
q?`out ${v} ${r};`:`in ${v} ${r};`));return t}}class w{constructor(){this._entries=new Set}add(q){this._entries.add(q)}generateSource(q){const t="vertex"===q?w.ALLOWLIST_VERTEX:w.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(v=>t.includes(v)).map(v=>`#extension ${v} : enable`)}}w.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];w.ALLOWLIST_VERTEX=[];class x{constructor(){this._entries=new Map}add(q,t,v=0){const r=this._entries.get(v);r?k.assert(r.name===
q&&r.type===t,`Fragment shader output location ${v} occupied`):this._entries.set(v,{name:q,type:t})}generateSource(q){if("vertex"===q)return[];0===this._entries.size&&this._entries.set(0,{name:x.DEFAULT_NAME,type:x.DEFAULT_TYPE});const t=[];this._entries.forEach((v,r)=>t.push(`layout(location = ${r}) out ${v.type} ${v.name};`));return t}}x.DEFAULT_TYPE="vec4";x.DEFAULT_NAME="fragColor";class n{constructor(){this._entries=new Set}add(q,t,v){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case "float":r=
n._numberToFloatStr(v);break;case "int":r=n._numberToIntStr(v);break;case "bool":r=v.toString();break;case "vec2":r=`vec2(${n._numberToFloatStr(v[0])},                            ${n._numberToFloatStr(v[1])})`;break;case "vec3":r=`vec3(${n._numberToFloatStr(v[0])},                            ${n._numberToFloatStr(v[1])},                            ${n._numberToFloatStr(v[2])})`;break;case "vec4":r=`vec4(${n._numberToFloatStr(v[0])},                            ${n._numberToFloatStr(v[1])},                            ${n._numberToFloatStr(v[2])},                            ${n._numberToFloatStr(v[3])})`;
break;case "ivec2":r=`ivec2(${n._numberToIntStr(v[0])},                             ${n._numberToIntStr(v[1])})`;break;case "ivec3":r=`ivec3(${n._numberToIntStr(v[0])},                             ${n._numberToIntStr(v[1])},                             ${n._numberToIntStr(v[2])})`;break;case "ivec4":r=`ivec4(${n._numberToIntStr(v[0])},                             ${n._numberToIntStr(v[1])},                             ${n._numberToIntStr(v[2])},                             ${n._numberToIntStr(v[3])})`;
break;case "mat2":case "mat3":case "mat4":r=`${t}(${Array.prototype.map.call(v,y=>n._numberToFloatStr(y)).join(", ")})`}this._entries.add(`const ${t} ${q} = ${r};`);return this}static _numberToIntStr(q){return q.toFixed(0)}static _numberToFloatStr(q){return Number.isInteger(q)?q.toFixed(1):q.toString()}generateSource(){return Array.from(this._entries)}}a.Code=e;a.Includes=f;a.ShaderBuilder=c;a.Stage=p;a.Uniforms=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports",
"../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,g,d){function k(c,l){if(!c)throw l=l||"Assertion",new f(`${l} at ${Error(l).stack}`);}const m=d.create();class f{constructor(c){this.message=c}toString(){return`AssertException: ${this.message}`}}a.assert=k;a.isTranslationMatrix=function(c){return 1===c[0]&&0===c[1]&&0===c[2]&&0===c[3]&&0===c[4]&&1===c[5]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&1===c[10]&&0===c[11]&&1===c[15]};a.logWithBase=function(c,
l){return Math.log(c)/Math.log(l)};a.project=function(c,l,e,p,h){m[0]=c[0];m[1]=c[1];m[2]=c[2];m[3]=1;g.transformMat4(m,m,l);2<h.length&&(h[2]=-m[2]);g.transformMat4(m,m,e);k(0!==m[3]);h[0]=m[0]/m[3];h[1]=m[1]/m[3];h[2]=m[2]/m[3];h[0]=(.5*h[0]+.5)*p[2]+p[0];h[1]=(.5*h[1]+.5)*p[3]+p[1]};a.rayBoxTest=function(c,l,e,p){let h,u=(e[0]-c[0])/l[0],w=(p[0]-c[0])/l[0];u>w&&(h=u,u=w,w=h);let x=(e[1]-c[1])/l[1],n=(p[1]-c[1])/l[1];x>n&&(h=x,x=n,n=h);if(u>n||x>w)return!1;x>u&&(u=x);n<w&&(w=n);e=(e[2]-c[2])/l[2];
c=(p[2]-c[2])/l[2];e>c&&(h=e,e=c,c=h);if(u>c||e>w)return!1;c<w&&(w=c);return 0>w?!1:!0};a.rayRay2D=function(c,l,e,p,h,u=b.create()){const w=(p[h]-e[h])*(l[0]-c[0])-(p[0]-e[0])*(l[h]-c[h]);if(0===w)return!1;e=((p[0]-e[0])*(c[h]-e[h])-(p[h]-e[h])*(c[0]-e[0]))/w;u[0]=c[0]+e*(l[0]-c[0]);u[1]=c[h]+e*(l[h]-c[h]);return!0};a.setMatrixTranslation3=function(c,l,e,p){c[12]=l;c[13]=e;c[14]=p};a.verify=function(c,l){c||console.warn("Verify failed: "+(l||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"sampler2D",g.BindType.Pass,(f,c,l)=>f.bindTexture(k,m(c,l)))}}a.Texture2DPassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],
function(a){class b{constructor(g,d){this._module=g;this._loadModule=d}get(){return this._module}async reload(){return this._module=await this._loadModule()}}a.ReloadableShaderModule=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../core/maybe","../../../../webgl/enums"],function(a,b,g){class d{constructor(k,m,f){this.release=f;this.initializeConfiguration(k,m);this._configuration=
m.snapshot();this._program=this.initializeProgram(k);this._pipeline=this.initializePipeline(k.rctx.capabilities)}destroy(){this._program=b.disposeMaybe(this._program);this._pipeline=this._configuration=null}reload(k){b.disposeMaybe(this._program);this._program=this.initializeProgram(k);this._pipeline=this.initializePipeline(k.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(k){this.program.assertCompatibleVertexAttributeLocations(k)}get primitiveType(){return g.PrimitiveType.TRIANGLES}getPipeline(k,
m,f){return this._pipeline}initializeConfiguration(k,m){}}a.ShaderTechnique=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]=
"LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=
773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.MIN=32775]="MIN";b[b.MAX=32776]=
"MAX";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||
(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||
(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";
b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=
33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=
34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType={}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=
6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";
b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";
b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=
36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";
b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=
void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";
b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]=
"FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";b[b.Sync=7]="Sync";b[b.UNCOUNTED=8]="UNCOUNTED";b[b.LinesOfCode=8]="LinesOfCode";
b[b.Uniform=9]="Uniform";b[b.COUNT=10]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";
b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.SpecialDrawBuffers=void 0;(function(b){b[b.NONE=0]=
"NONE";b[b.BACK=1029]="BACK"})(a.SpecialDrawBuffers||(a.SpecialDrawBuffers={}));a.CompressedTextureFormat=void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]=
"COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";
b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";
b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";
b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=
36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]=
"SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=
37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.DepthStencilAttachment=33306;a.baseTextureUnit=33984;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports","./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,
1],[b.VertexAttribute.NORMALCOMPRESSED,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.COLORFEATUREATTRIBUTE,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.AUXPOS1,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.AUXPOS2,6],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],[b.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,
7],[b.VertexAttribute.INSTANCEMODEL,8],[b.VertexAttribute.INSTANCEMODELNORMAL,12],[b.VertexAttribute.INSTANCEMODELORIGINHI,11],[b.VertexAttribute.INSTANCEMODELORIGINLO,15]]);a.Default3D=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../core/PooledArray","../../../webgl/checkWebGLError"],function(a,b,g){class d{constructor(k,m,f){this._context=k;this._locations=f;this._textures=new Map;this._freeTextureUnits=
new b({deallocator:null});this._glProgram=k.programCache.acquire(m.generate("vertex"),m.generate("fragment"),f);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=m.generateBindPass(this);this.bindDraw=m.generateBindDraw(this);this._fragmentUniforms=g.webglDebugEnabled()?m.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(k,m){this._glProgram.setUniform1i(k,
m?1:0)}setUniform1i(k,m){this._glProgram.setUniform1i(k,m)}setUniform1f(k,m){this._glProgram.setUniform1f(k,m)}setUniform2fv(k,m){this._glProgram.setUniform2fv(k,m)}setUniform3fv(k,m){this._glProgram.setUniform3fv(k,m)}setUniform4fv(k,m){this._glProgram.setUniform4fv(k,m)}setUniformMatrix3fv(k,m){this._glProgram.setUniformMatrix3fv(k,m)}setUniformMatrix4fv(k,m){this._glProgram.setUniformMatrix4fv(k,m)}setUniform1fv(k,m){this._glProgram.setUniform1fv(k,m)}setUniform1iv(k,m){this._glProgram.setUniform1iv(k,
m)}setUniform2iv(k,m){this._glProgram.setUniform3iv(k,m)}setUniform3iv(k,m){this._glProgram.setUniform3iv(k,m)}setUniform4iv(k,m){this._glProgram.setUniform4iv(k,m)}assertCompatibleVertexAttributeLocations(k){k.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear();this._freeTextureUnits.clear()}bindTexture(k,m){if(null==m?.glName){if(m=this._textures.get(k))this._context.bindTexture(null,m.unit),this._freeTextureUnit(m),this._textures.delete(k);
return null}let f=this._textures.get(k);null==f?(f=this._allocTextureUnit(m),this._textures.set(k,f)):f.texture=m;this._context.useProgram(this);this.setUniform1i(k,f.unit);this._context.bindTexture(m,f.unit);return f.unit}rebindTextures(){this._context.useProgram(this);this._textures.forEach((k,m)=>{this._context.bindTexture(k.texture,k.unit);this.setUniform1i(m,k.unit)});null!=this._fragmentUniforms&&this._fragmentUniforms.forEach(k=>{"sampler2D"!==k.type&&"samplerCube"!==k.type||this._textures.has(k.name)||
console.error(`Texture sampler ${k.name} has no bound texture`)})}_allocTextureUnit(k){return{texture:k,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(k){this._freeTextureUnits.push(k.unit)}}a.Program=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,g,d){function k(c,l){switch(l){case c.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case c.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case c.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case c.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case c.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case c.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const m=d.getLogger("esri.views.webgl.checkWebGLError"),f=!!g("enable-feature:webgl-debug");a.checkWebGLError=function(c){if(f){const l=c.getError();l&&(c=k(c,l),m.error(new b("webgl-error","WebGL error occurred",{message:c,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=f;a.webglDebugEnabled=function(){return f};a.webglValidateShadersEnabled=function(){return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports",
"../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,g){function d(Q){return A.intern(Q)}function k(Q){return F.intern(Q)}function m(Q){return G.intern(Q)}function f(Q){return I.intern(Q)}function c(Q){return H.intern(Q)}function l(Q){return B.intern(Q)}function e(Q){return K.intern(Q)}function p(Q){return L.intern(Q)}function h(Q){return J.intern(Q)}function u(Q){return"["+Q.join(",")+"]"}function w(Q){return Q?u([Q.srcRgb,Q.srcAlpha,Q.dstRgb,Q.dstAlpha,Q.opRgb,Q.opAlpha,Q.color.r,Q.color.g,
Q.color.b,Q.color.a]):null}function x(Q){return Q?u([Q.face,Q.mode]):null}function n(Q){return Q?u([Q.factor,Q.units]):null}function q(Q){return Q?u([Q.func]):null}function t(Q){return Q?u([Q.function.func,Q.function.ref,Q.function.mask,Q.operation.fail,Q.operation.zFail,Q.operation.zPass]):null}function v(Q){return Q?u([Q.zNear,Q.zFar]):null}function r(Q){return Q?u([Q.r,Q.g,Q.b,Q.a]):null}function y(Q){return Q?u([Q.mask]):null}function z(Q){return Q?u(Q.buffers):null}const D={face:g.Face.BACK,
mode:g.CullMode.CCW},C={face:g.Face.FRONT,mode:g.CullMode.CCW};class E{constructor(Q,O){this._makeKey=Q;this._makeRef=O;this._interns=new Map}intern(Q){if(!Q)return null;const O=this._makeKey(Q),U=this._interns;U.has(O)||U.set(O,this._makeRef(Q));return U.get(O)??null}}const A=new E(w,Q=>({__tag:"Blending",...Q})),F=new E(x,Q=>({__tag:"Culling",...Q})),G=new E(n,Q=>({__tag:"PolygonOffset",...Q})),I=new E(q,Q=>({__tag:"DepthTest",...Q})),H=new E(t,Q=>({__tag:"StencilTest",...Q})),B=new E(v,Q=>({__tag:"DepthWrite",
...Q})),K=new E(r,Q=>({__tag:"ColorWrite",...Q})),L=new E(y,Q=>({__tag:"StencilWrite",...Q})),J=new E(z,Q=>({__tag:"DrawBuffers",...Q})),M=new E(function(Q){return Q?u([w(Q.blending),x(Q.culling),n(Q.polygonOffset),q(Q.depthTest),t(Q.stencilTest),v(Q.depthWrite),r(Q.colorWrite),y(Q.stencilWrite),z(Q.drawBuffers)]):null},Q=>({blending:d(Q.blending),culling:k(Q.culling),polygonOffset:m(Q.polygonOffset),depthTest:f(Q.depthTest),stencilTest:c(Q.stencilTest),depthWrite:l(Q.depthWrite),colorWrite:e(Q.colorWrite),
stencilWrite:p(Q.stencilWrite),drawBuffers:h(Q.drawBuffers)}));class T{constructor(Q){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=Q}setPipeline(Q){if(this._pipelineInvalid||Q!==this._pipeline)this._setBlending(Q.blending),this._setCulling(Q.culling),this._setPolygonOffset(Q.polygonOffset),
this._setDepthTest(Q.depthTest),this._setStencilTest(Q.stencilTest),this._setDepthWrite(Q.depthWrite),this._setColorWrite(Q.colorWrite),this._setStencilWrite(Q.stencilWrite),this._setDrawBuffers(Q.drawBuffers),this._pipeline=Q;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=
this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(Q){this._blending=this._setSubState(Q,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1}_setCulling(Q){this._culling=this._setSubState(Q,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(Q){this._polygonOffset=this._setSubState(Q,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(Q){this._depthTest=this._setSubState(Q,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(Q){this._stencilTest=
this._setSubState(Q,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(Q){this._depthWrite=this._setSubState(Q,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(Q){this._colorWrite=this._setSubState(Q,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(Q){this._stencilWrite=this._setSubState(Q,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1}_setDrawBuffers(Q){this._drawBuffers=this._setSubState(Q,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(Q,O,U,Z){if(U||Q!==O)Z(Q),this._pipelineInvalid=!0;return Q}}a.StateTracker=T;a.backFaceCullingParams=D;a.cullingParams=Q=>Q===b.CullFaceOptions.Back?D:Q===b.CullFaceOptions.Front?C:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};
a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=C;a.makeBlending=d;a.makeColorWrite=e;a.makeCulling=k;a.makeDepthTest=f;a.makeDepthWrite=l;a.makeDrawBuffers=h;a.makePipelineState=function(Q){return M.intern(Q)};a.makePolygonOffset=m;a.makeStencilTest=c;a.makeStencilWrite=p;a.separateBlendingParams=function(Q,O,U,Z,P=g.BlendOperation.ADD,R=g.BlendOperation.ADD,W=[0,0,0,0]){return{srcRgb:Q,srcAlpha:O,dstRgb:U,dstAlpha:Z,opRgb:P,opAlpha:R,color:{r:W[0],g:W[1],b:W[2],a:W[3]}}};a.simpleBlendingParams=
function(Q,O,U=g.BlendOperation.ADD,Z=[0,0,0,0]){return{srcRgb:Q,srcAlpha:Q,dstRgb:O,dstAlpha:O,opRgb:U,opAlpha:U,color:{r:Z[0],g:Z[1],b:Z[2],a:Z[3]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=
0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=
2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||
(a.Decorations={}));a.TextureEncodingMimeType=void 0;(function(b){b.DDS_ENCODING="image/vnd-ms.dds";b.KTX2_ENCODING="image/ktx2";b.BASIS_ENCODING="image/x.basis"})(a.TextureEncodingMimeType||(a.TextureEncodingMimeType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,g){class d extends g.ShaderTechniqueConfiguration{constructor(){super(...arguments);
this.reduced=this.haze=!1}}b.__decorate([g.parameter()],d.prototype,"haze",void 0);b.__decorate([g.parameter()],d.prototype,"reduced",void 0);a.ChapmanAtmosphereTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../shaderModules/interfaces"],function(a,b){class g extends b.NoParameters{constructor(){super();this._key="";this._keyDirty=!1;this._parameterBits=
this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}get key(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}snapshot(){const d=this._parameterNames,k={key:this.key};for(const m of d)k[m]=this[m];return k}}a.ShaderTechniqueConfiguration=g;a.parameter=function(d={}){return(k,m)=>{k._parameterNames=k._parameterNames??[];k._parameterNames.push(m);if(null!=d.constValue)Object.defineProperty(k,
m,{get(){return d.constValue}});else{const f=k._parameterNames.length-1,c=Math.ceil(Math.log2(d.count||2)),l=k._parameterBits??[0];let e=0;for(;16<l[e]+c;)e++,e>=l.length&&l.push(0);k._parameterBits=l;const p=l[e],h=(1<<c)-1<<p;l[e]+=c;Object.defineProperty(k,m,{get(){return this[f]},set(u){if(this[f]!==u&&(this[f]=u,this._keyDirty=!0,this._parameterBits[e]=this._parameterBits[e]&~h|+u<<p&h,"number"!==typeof u&&"boolean"!==typeof u))throw Error("Configuration value for "+m+" must be boolean or number, got "+
typeof u);}})}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOCache":function(){define("exports ../../../../core/maybe ./FBOPool ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,g,d,k,m,f,c,l){class e{constructor(C){this.rctx=C;this._acquired=new Set;this._cache=new g.FBOPool(C.newCache,"FBOCache");
this._depthCache=new g.FBOPool(C.newCache,"DepthAttachmentCache");this._colorCache=new g.FBOPool(C.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy();this._depthCache.destroy();this._colorCache.destroy()}clean(){this._cache.clean();this._colorCache.clean();this._depthCache.clean()}frame(){this._cache.frame();this._colorCache.frame();this._depthCache.frame()}get usedMemory(){return Array.from(this._acquired.values()).reduce((C,E)=>C+("colorTexture"in E?E.colorTexture?.gpuMemoryUsage??
0:E.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(C){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=C}acquire(C,E,A){const F=`${C}x${E}x${A}`,G=this._cache.pop(F)||new p(F,new k.FramebufferObject(this.rctx,{...z[C],width:E,height:A}),I=>{G.releaseDepth();G.depth=this._acquireDepth(I,G.fbo.width,G.fbo.height);G.fbo.attachDepthStencil(G.depth.attachment);return G},(I,H)=>{I=this._acquireColor(I,E,A);G.colors??
(G.colors=new Map);G.colors.set(H,I);G.fbo.attachColorTexture(I.attachment,H);return G});G.release=()=>{this._acquired.delete(G);G.releaseDepth();this._cache.put(G);G.release=()=>console.log(`Double FBO release in ${Error().stack}`)};this.rctx.unbindTexture(G.fbo.colorTexture);return this._trackHandle(G)}acquireDepth(C,E,A){return this._acquireDepth(C,E,A)}_acquireDepth(C,E,A){const F=`${C}x${E}x${A}`,G=this._depthCache.pop(F);if(G)return this._trackHandle(G);const I=C===a.DepthFormat.DEPTH_STENCIL_TEXTURE?
new u(F,new c.Texture(this.rctx,{...D[C],width:E,height:A}),()=>{this._acquired.delete(I);this._depthCache.put(I)}):new u(F,new m.Renderbuffer(this.rctx,{...D[C],width:E,height:A}),()=>{this._acquired.delete(I);this._depthCache.put(I)});return this._trackHandle(I)}_acquireColor(C,E,A){const F=`${C}x${E}x${A}`,G=this._colorCache.pop(F);if(G)return this._trackHandle(G);const I=new w(F,new c.Texture(this.rctx,{...z[C],width:E,height:A}),()=>{this._acquired.delete(I);this._colorCache.put(I)});return this._trackHandle(I)}_trackHandle(C){this._acquired.add(C);
return C}}class p{constructor(C,E,A,F){this.key=C;this.fbo=E;this.acquireDepth=A;this.acquireColor=F;this.release=()=>{};this.incarnation=0}dispose(){this.fbo.dispose()}releaseDepth(){this.fbo.detachDepthStencilTexture();this.fbo.detachDepthStencilBuffer();this.depth=b.releaseMaybe(this.depth)}detachDepth(){const C=this.depth;this.depth=void 0;this.fbo.detachDepthStencilTexture();this.fbo.detachDepthStencilBuffer();return C}attachDepth(C){this.releaseDepth();C&&(this.fbo.attachDepthStencil(C.attachment),
this.depth=C);return this}releaseColor(C){this.fbo.detachColorTexture(C);const E=this.colors?.get(C);this.colors?.delete(C);b.releaseMaybe(E)}get colorTexture(){return this.fbo?.colorTexture}getColorTexture(C=d.ColorAttachment.COLOR_ATTACHMENT0){return this.fbo?.getColorTexture(C)}get usedMemory(){return this.fbo.gpuMemoryUsage}}class h{constructor(C,E,A){this.key=C;this.attachment=E;this.release=A;this.incarnation=0}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.gpuMemoryUsage}}
class u extends h{}class w extends h{constructor(C,E,A){super(C,E,A);this.attachment=E;this.release=A}}a.ColorFormat=void 0;(function(C){C[C.RED=0]="RED";C[C.RG=1]="RG";C[C.RGBA4=2]="RGBA4";C[C.RGBA=3]="RGBA";C[C.RGBA_MIPMAP=4]="RGBA_MIPMAP";C[C.R16F=5]="R16F";C[C.RGBA16F=6]="RGBA16F"})(a.ColorFormat||(a.ColorFormat={}));const x=new l.TextureDescriptor;x.pixelFormat=d.PixelFormat.RED;x.internalFormat=d.SizedPixelFormat.R8;x.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const n=new l.TextureDescriptor;
n.pixelFormat=d.PixelFormat.RG;n.internalFormat=d.SizedPixelFormat.RG8;n.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const q=new l.TextureDescriptor;q.internalFormat=d.SizedPixelFormat.RGBA4;q.dataType=d.PixelType.UNSIGNED_SHORT_4_4_4_4;q.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const t=new l.TextureDescriptor;t.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const v=new l.TextureDescriptor;v.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;v.samplingMode=d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;v.hasMipmap=!0;v.maxAnisotropy=
8;const r=new l.TextureDescriptor;r.pixelFormat=d.PixelFormat.RED;r.dataType=d.PixelType.HALF_FLOAT;r.internalFormat=d.SizedPixelFormat.R16F;r.samplingMode=d.TextureSamplingMode.NEAREST;const y=new l.TextureDescriptor;y.dataType=d.PixelType.HALF_FLOAT;y.internalFormat=d.SizedPixelFormat.RGBA16F;y.samplingMode=d.TextureSamplingMode.NEAREST;const z={[a.ColorFormat.RED]:x,[a.ColorFormat.RG]:n,[a.ColorFormat.RGBA4]:q,[a.ColorFormat.RGBA]:t,[a.ColorFormat.RGBA_MIPMAP]:v,[a.ColorFormat.R16F]:r,[a.ColorFormat.RGBA16F]:y};
a.DepthFormat=void 0;(function(C){C[C.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE";C[C.DEPTH_STENCIL_BUFFER=1]="DEPTH_STENCIL_BUFFER";C[C.DEPTH24_BUFFER=2]="DEPTH24_BUFFER";C[C.DEPTH16_BUFFER=3]="DEPTH16_BUFFER"})(a.DepthFormat||(a.DepthFormat={}));l=new l.TextureDescriptor;l.pixelFormat=d.PixelFormat.DEPTH_STENCIL;l.dataType=d.PixelType.UNSIGNED_INT_24_8;l.samplingMode=d.TextureSamplingMode.NEAREST;l.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const D={[a.DepthFormat.DEPTH_STENCIL_TEXTURE]:l,[a.DepthFormat.DEPTH_STENCIL_BUFFER]:new f.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH24_STENCIL8,
4),[a.DepthFormat.DEPTH24_BUFFER]:new f.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_COMPONENT24,4),[a.DepthFormat.DEPTH16_BUFFER]:new f.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_COMPONENT16,4)};a.FBOCache=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOPool":function(){define(["exports","../../../../core/MemCachePool","../../../../core/PooledArray"],function(a,b,g){class d{constructor(k,m){this._last=new g;this._incarnation=0;this._cache=
new b.MemCachePool(k,m)}destroy(){this._last?.forAll(k=>k.dispose());this._last=null;this._cache.destroy()}set interactive(k){k&&!this._last?this._last=new g:k||(this._last?.forAll(m=>m.dispose()),this._last=null)}clean(){this._last?.filterInPlace(k=>k.incarnation<this._incarnation?(this._cache.put(k.key,k),!1):!0)}frame(){++this._incarnation}pop(k){if(this._last){const m=this._last.find(f=>f.key===k);if(m)return this._last.removeUnordered(m),m}return this._cache.pop(k)}put(k){k.incarnation=this._incarnation;
this._last?this._last.push(k):this._cache.put(k.key,k)}get usedMemory(){return this._last?.reduce((k,m)=>k+m.usedMemory,0)??0}}a.FBOPool=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCachePool":function(){define(["exports","./MemCache"],function(a,b){class g{constructor(d,k){this._cache=d(k,(m,f)=>this._remove(m,f))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}pop(d){const k=this._cache.peek(d);if(k){var m=k.pop();
if(0<k.length){const f=k.reduce((c,l)=>c+l.usedMemory,0);this._cache.updateSize(d,k,f)}else this._cache.pop(d);return m}}put(d,k,m=b.minPriority){const f=this._cache.peek(d);f?(f.push(k),k=f.reduce((c,l)=>c+l.usedMemory,0),this._cache.updateSize(d,f,k)):this._cache.put(d,[k],k.usedMemory,m)}_remove(d,k){switch(k){case b.RemoveMode.ALL:return d.forEach(m=>m.dispose()),0;case b.RemoveMode.SOME:return d.shift()?.dispose(),d.reduce((m,f)=>m+f.usedMemory,0)}}}a.MemCachePool=g;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./contextUtils ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),function(a,b,g,d,k,m,f,c,l,e,p){function h(q){return null!=q&&"type"in q&&q.type===l.GLObjectType.Texture}function u(q,t){const v=Math.max(q.width,q.height);return v>t?(x.warn(`Resizing FBO attachment size ${q.width}x${q.height} to device limit ${t}`),t/=v,q.width=
Math.round(q.width*t),q.height=Math.round(q.height*t),!1):!0}function w(q){return q.descriptor.target===c.TextureType.TEXTURE_CUBE_MAP?c.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:c.TextureType.TEXTURE_2D}const x=g.getLogger("esri.views.webgl.FramebufferObject");class n{constructor(q,t,v=null){this._context=q;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._depthStencilBuffer=null;this._initialized=!1;q.instanceCounter.increment(c.ResourceType.FramebufferObject,this);
q=h(t)?t:new p.Texture(this._context,t);this._colorAttachments.set(c.ColorAttachment.COLOR_ATTACHMENT0,q);this._validateTextureDescriptor(q.descriptor);this._validateColorAttachmentPoint(c.ColorAttachment.COLOR_ATTACHMENT0);null!=v&&(h(v)||null!=v&&"pixelFormat"in v?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=h(v)?v:new p.Texture(this._context,v),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):
(this._depthStencilBuffer=v=null!=v&&"type"in v&&v.type===l.GLObjectType.RenderBuffer?v:new e.Renderbuffer(this._context,v),this._validateRenderBufferDescriptor(v.descriptor)))}dispose(){if(0!==this._colorAttachments.size||this._glName){var q=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((t,v)=>this.detachColorTexture(v)?.dispose());this.detachDepthStencilBuffer()?.dispose();this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),
this._glName=null);this._context.bindFramebuffer(q);this._context.instanceCounter.decrement(c.ResourceType.FramebufferObject,this)}}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(c.ColorAttachment.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(c.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(c.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??
0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((q,[,t])=>q+t.gpuMemoryUsage,this.depthStencil?.gpuMemoryUsage??0)}getColorTexture(q){return(q=this._colorAttachments.get(q))&&h(q)?q:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(q,t=c.ColorAttachment.COLOR_ATTACHMENT0){q&&(this._validateColorAttachmentPoint(t),this._validateTextureDescriptor(q.descriptor),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),
this._framebufferTexture2D(q.glName,t)),this._colorAttachments.set(t,q))}detachColorTexture(q=c.ColorAttachment.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(q);if(t){if(this._initialized){const v=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);this._framebufferTexture2D(null,q);this._context.bindFramebuffer(v)}this._colorAttachments.delete(q);return t}}setColorTextureTarget(q,t=c.ColorAttachment.COLOR_ATTACHMENT0){const v=this._colorAttachments.get(t);v&&this._framebufferTexture2D(v.glName,
t,q)}attachDepthStencil(q){if(q)switch(q.type){case l.GLObjectType.Texture:return this._attachDepthStencilTexture(q);case l.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(q)}}_attachDepthStencilTexture(q){if(null!=q){var t=q.descriptor;t.pixelFormat!==c.PixelFormat.DEPTH_STENCIL&&t.pixelFormat!==c.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");t.dataType!==c.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");
this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");this._validateTextureDescriptor(t);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(q.glName,c.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=q}}detachDepthStencilTexture(){const q=this._depthStencilTexture;q&&this._initialized&&
(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,c.DepthStencilAttachment));this._depthStencilTexture=null;return q}_attachDepthStencilBuffer(q){if(null!=q){var t=q.descriptor;this._validateRenderBufferDescriptor(t);this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const v=this._context.gl;t=this._getGLAttachmentPoint(t);v.framebufferRenderbuffer(c.FramebufferTarget.FRAMEBUFFER,t,v.RENDERBUFFER,q.glName)}this._depthStencilBuffer=q}}detachDepthStencilBuffer(){const q=
this._depthStencilBuffer;if(q&&this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl,v=this._getGLAttachmentPoint(q.descriptor);t.framebufferRenderbuffer(c.FramebufferTarget.FRAMEBUFFER,v,t.RENDERBUFFER,null)}this._depthStencilBuffer=null;return q}copyToTexture(q,t,v,r,y,z,D){(0>q||0>t||0>y||0>z)&&console.error("Offsets cannot be negative!");(0>=v||0>=r)&&console.error("Copy width and height must be greater than zero!");var C=D.descriptor;D.descriptor.target!==c.TextureType.TEXTURE_2D&&
console.error("Texture target must be TEXTURE_2D!");(null==C?.width||null==C?.height||q+v>this.width||t+r>this.height||y+v>C.width||z+r>C.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");C=this._context;D=C.bindTexture(D,p.Texture.TEXTURE_UNIT_FOR_UPDATES);C.setActiveTexture(p.Texture.TEXTURE_UNIT_FOR_UPDATES);C.bindFramebuffer(this);C.gl.copyTexSubImage2D(c.TextureType.TEXTURE_2D,0,y,z,q,t,v,r);C.bindTexture(D,p.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(q,
t,v,r,y,z,D){(0>=v||0>=r)&&console.error("Copy width and height must be greater than zero!");D||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(q,t,v,r,y,z,D)}async readPixelsAsync(q,t,v,r,y,z,D){if(this._context.type!==f.ContextType.WEBGL2)m.webglDebugEnabled()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),this.readPixels(q,t,v,r,y,z,D);else{var C=this._context.gl,E=k.BufferObject.createPixelPack(this._context,
c.Usage.STREAM_READ,D.byteLength);this._context.bindBuffer(E);this._context.bindFramebuffer(this);C.readPixels(q,t,v,r,y,z,0);this._context.unbindBuffer(c.BufferType.PIXEL_PACK_BUFFER);await E.getSubDataAsync(D);E.dispose()}}resize(q,t){if(this.width!==q||this.height!==t){var v={width:q,height:t};u(v,this._context.parameters.maxTextureSize);this._colorAttachments.forEach(r=>r.resize(v.width,v.height));this._depthStencilTexture?.resize(v.width,v.height);this._initialized&&(u(v,this._context.parameters.maxRenderbufferSize),
this._depthStencilBuffer?.resize(v.width,v.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}}initializeAndBind(q=c.FramebufferTarget.FRAMEBUFFER){const t=this._context.gl;if(this._initialized)t.bindFramebuffer(q,this.glName);else{this._glName&&t.deleteFramebuffer(this._glName);var v=t.createFramebuffer();t.bindFramebuffer(q,v);this._colorAttachments.forEach((r,y)=>this._framebufferTexture2D(r.glName,y,w(r),q));if(this._depthStencilBuffer){const r=
this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(q,r,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,w(this._depthStencilTexture),q);m.webglDebugEnabled()&&t.checkFramebufferStatus(q)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=v;this._initialized=!0}}_framebufferTexture2D(q,t=c.ColorAttachment.COLOR_ATTACHMENT0,
v=c.TextureType.TEXTURE_2D,r=c.FramebufferTarget.FRAMEBUFFER,y=0){this._context.gl.framebufferTexture2D(r,t,v,q,y)}_disposeDepthStencilAttachments(){const q=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);q.framebufferRenderbuffer(c.FramebufferTarget.FRAMEBUFFER,t,q.RENDERBUFFER,null)}this._depthStencilBuffer=d.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&
(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,q.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=d.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(q){q.target!==c.TextureType.TEXTURE_2D&&q.target!==c.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");u(q,this._context.parameters.maxTextureSize);this._validateBufferDimensions(q)}_validateRenderBufferDescriptor(q){u(q,this._context.parameters.maxRenderbufferSize);
this._validateBufferDimensions(q)}_validateBufferDimensions(q){0>=q.width&&(q.width=this.width);0>=q.height&&(q.height=this.height);0<this.width&&0<this.height&&(this.width!==q.width||this.height!==q.height)&&console.error("Attachment size must match framebuffer size!")}_getGLAttachmentPoint(q){switch(q.internalFormat){case c.RenderbufferFormat.DEPTH_COMPONENT16:case c.RenderbufferFormat.DEPTH_COMPONENT24:case c.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case c.RenderbufferFormat.DEPTH24_STENCIL8:case c.RenderbufferFormat.DEPTH32F_STENCIL8:case c.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;
case c.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(q){if(-1===n._MAX_COLOR_ATTACHMENTS){const t=this._context.capabilities.drawBuffers;n._MAX_COLOR_ATTACHMENTS=t?this._context.gl.getParameter(t.MAX_COLOR_ATTACHMENTS):1}q-=c.ColorAttachment.COLOR_ATTACHMENT0;q+1>n._MAX_COLOR_ATTACHMENTS&&g.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${q+1}. Implementation supports up to ${n._MAX_COLOR_ATTACHMENTS} color attachments`)}}
n._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=n;a.ensureAttachmentMaxSize=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../core/arrayUtils ../../core/Logger ../../core/typedArrayUtil ./checkWebGLError ./contextUtils ./enums".split(" "),function(a,b,g,d,k,m,f){const c=g.getLogger("esri.views.webgl.BufferObject");class l{static createIndex(e,p,h){return new l(e,f.BufferType.ELEMENT_ARRAY_BUFFER,p,h)}static createVertex(e,
p,h){return new l(e,f.BufferType.ARRAY_BUFFER,p,h)}static createUniform(e,p,h){if(e.type!==m.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new l(e,f.BufferType.UNIFORM_BUFFER,p,h)}static createPixelPack(e,p=f.Usage.STREAM_READ,h){if(e.type!==m.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");e=new l(e,f.BufferType.PIXEL_PACK_BUFFER,p);h&&e.setSize(h);return e}static createPixelUnpack(e,p=f.Usage.STREAM_DRAW,h){if(e.type!==
m.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");return new l(e,f.BufferType.PIXEL_UNPACK_BUFFER,p,h)}constructor(e,p,h,u){this._context=e;this.bufferType=p;this.usage=h;this._glName=null;this._size=-1;this._indexType=void 0;e.instanceCounter.increment(f.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();k.checkWebGLError(this._context.gl);u&&this.setData(u)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===
f.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===f.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===f.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===f.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(f.ResourceType.BufferObject,this),this._context=null):this._glName&&c.warn("Leaked WebGL buffer object")}setSize(e,p=null){0>=
e&&c.error("Buffer size needs to be positive!");if(this.bufferType===f.BufferType.ELEMENT_ARRAY_BUFFER&&null!=p)switch(this._indexType=p,p){case f.DataType.UNSIGNED_SHORT:e*=2;break;case f.DataType.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(e){var p=e.byteLength;this.bufferType===f.BufferType.ELEMENT_ARRAY_BUFFER&&(d.isUint16Array(e)&&(p/=2,this._indexType=f.DataType.UNSIGNED_SHORT),d.isUint32Array(e)&&(p/=4,this._indexType=f.DataType.UNSIGNED_INT));this._setBufferData(p,e)}}_setBufferData(e,
p=null){this._size=e;const h=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const u=this._context.gl;null!=p?u.bufferData(this.bufferType,p,this.usage):u.bufferData(this.bufferType,e,this.usage);k.checkWebGLError(u);this._isVAOAware&&this._context.bindVAO(h)}setSubData(e,p,h,u){if(e){(0>p||p*e.BYTES_PER_ELEMENT>=this.byteLength)&&c.error("offset is out of range!");h>=u&&c.error("end must be bigger than start!");(p+(u-h))*e.BYTES_PER_ELEMENT>
this.byteLength&&c.error("An attempt to write beyond the end of the buffer!");var w=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var x=this._context.gl;this._context.type===m.ContextType.WEBGL2?x.bufferSubData(this.bufferType,p*e.BYTES_PER_ELEMENT,e,h,u-h):(h=0===h&&u===e.length?e:e.subarray(h,u),x.bufferSubData(this.bufferType,p*e.BYTES_PER_ELEMENT,h));k.checkWebGLError(x);this._isVAOAware&&this._context.bindVAO(w)}}getSubData(e,p=0,h,u){if(this._context.type!==
m.ContextType.WEBGL2)c.error("Get buffer subdata is supported in WebGL2 only!");else if(0>h||0>u)c.error("Problem getting subdata: offset and length were less than zero!");else{var w=b.isArrayLike(e)?e.BYTES_PER_ELEMENT:1;w*((h??0)+(u??0))>e.byteLength?c.error("Problem getting subdata: offset and length exceeded destination size!"):(p+w*(u??0)>this.byteLength&&c.warn("Potential problem getting subdata: requested data exceeds buffer size!"),w=this._context.gl,this._context.bindBuffer(this,f.BufferType.COPY_READ_BUFFER),
w.getBufferSubData(f.BufferType.COPY_READ_BUFFER,p,e,h,u),this._context.unbindBuffer(f.BufferType.COPY_READ_BUFFER))}}async getSubDataAsync(e,p=0,h,u){this._context.type!==m.ContextType.WEBGL2?c.error("Get buffer subdata is supported in WebGL2 only!"):(await this._context.clientWaitAsync(),this.getSubData(e,p,h,u))}}a.BufferObject=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/contextUtils":function(){define(["exports","../../core/has"],function(a,b){function g(k,
m,f={}){return(k=k.getContext(m===a.ContextType.WEBGL1?"webgl":"webgl2",f))?k:null}function d(k){if("3d"===k)return[a.ContextType.WEBGL2];k=b("esri-force-webgl");return k===a.ContextType.WEBGL1||k===a.ContextType.WEBGL2?[k]:b("mac")&&b("chrome")?[a.ContextType.WEBGL1,a.ContextType.WEBGL2]:[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}a.ContextType=void 0;(function(k){k[k.WEBGL1=1]="WEBGL1";k[k.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=g;a.createContextForView=function(k,
m,f={}){k=d(k);for(const c of k)if(k=g(m,c,f))return k;return null};a.getContextTypes=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/GLObjectType":function(){define(["exports"],function(a){a.GLObjectType=void 0;var b=a.GLObjectType||(a.GLObjectType={});b[b.Texture=0]="Texture";b[b.RenderBuffer=1]="RenderBuffer";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","./contextUtils","./enums",
"./GLObjectType","./RenderbufferDescriptor"],function(a,b,g,d,k){class m{constructor(f,c){this._context=f;this._descriptor=c;this.type=d.GLObjectType.RenderBuffer;this._context.instanceCounter.increment(g.ResourceType.Renderbuffer,this);f=this._context.gl;this.glName=f.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:l,height:e,internalFormat:p,multisampled:h}=c;if(h){if(this._context.type!==b.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");
f.renderbufferStorageMultisample(f.RENDERBUFFER,this.samples,p,l,e)}else f.renderbufferStorage(f.RENDERBUFFER,p,l,e)}get descriptor(){return this._descriptor}get samples(){const f=this._descriptor.samples,c=this._context.parameters.maxSamples;return f?Math.min(f,c):c}get gpuMemoryUsage(){return k.estimateMemory(this._descriptor)}resize(f,c){const l=this._descriptor;if(l.width!==f||l.height!==c)l.width=f,l.height=c,f=this._context.gl,this._context.bindRenderbuffer(this),l.multisampled?f.renderbufferStorageMultisample(f.RENDERBUFFER,
this.samples,l.internalFormat,l.width,l.height):f.renderbufferStorage(f.RENDERBUFFER,l.internalFormat,l.width,l.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(g.ResourceType.Renderbuffer,this),this._context=null)}}a.Renderbuffer=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],function(a,b){class g{constructor(d,k,m=k){this.internalFormat=
d;this.width=k;this.height=m;this.multisampled=!1;this.samples=1}}a.RenderbufferDescriptor=g;a.estimateMemory=function(d){return 0>=d.width||0>=d.height||null==d.internalFormat?0:d.width*d.height*b.getBytesPerElementFormat(d.internalFormat)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./enums"],function(a,b,g){function d(k){return k[0].stride}a.bindVertexBufferLayout=function(k,m,f,c,l=0){const e=k.gl;k.bindBuffer(f);
for(const h of c)if(f=m.get(h.name),void 0===f&&console.error(`There is no location for vertex attribute '${h.name}' defined.`),c=l*h.stride,4>=h.count)e.vertexAttribPointer(f,h.count,h.type,h.normalized,h.stride,h.offset+c),e.enableVertexAttribArray(f),0<h.divisor&&k.gl2?.vertexAttribDivisor(f,h.divisor);else if(9===h.count)for(var p=0;3>p;p++)e.vertexAttribPointer(f+p,3,h.type,h.normalized,h.stride,h.offset+12*p+c),e.enableVertexAttribArray(f+p),0<h.divisor&&k.gl2?.vertexAttribDivisor(f+p,h.divisor);
else if(16===h.count)for(p=0;4>p;p++)e.vertexAttribPointer(f+p,4,h.type,h.normalized,h.stride,h.offset+16*p+c),e.enableVertexAttribArray(f+p),0<h.divisor&&k.gl2?.vertexAttribDivisor(f+p,h.divisor);else console.error("Unsupported vertex attribute element count: "+h.count)};a.getBytesPerElementFormat=function(k){switch(k){case g.PixelFormat.ALPHA:case g.PixelFormat.LUMINANCE:case g.PixelFormat.RED:case g.PixelFormat.RED_INTEGER:case g.SizedPixelFormat.R8:case g.SizedPixelFormat.R8I:case g.SizedPixelFormat.R8UI:case g.SizedPixelFormat.R8_SNORM:case g.RenderbufferFormat.STENCIL_INDEX8:return 1;
case g.PixelFormat.LUMINANCE_ALPHA:case g.PixelFormat.RG:case g.PixelFormat.RG_INTEGER:case g.SizedPixelFormat.RGBA4:case g.SizedPixelFormat.R16F:case g.SizedPixelFormat.R16I:case g.SizedPixelFormat.R16UI:case g.SizedPixelFormat.RG8:case g.SizedPixelFormat.RG8I:case g.SizedPixelFormat.RG8UI:case g.SizedPixelFormat.RG8_SNORM:case g.SizedPixelFormat.RGB565:case g.SizedPixelFormat.RGB5_A1:case g.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case g.PixelFormat.DEPTH_COMPONENT:case g.PixelFormat.RGB:case g.PixelFormat.RGB_INTEGER:case g.SizedPixelFormat.RGB8:case g.SizedPixelFormat.RGB8I:case g.SizedPixelFormat.RGB8UI:case g.SizedPixelFormat.RGB8_SNORM:case g.SizedPixelFormat.SRGB8:case g.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case g.PixelFormat.DEPTH_STENCIL:case g.PixelFormat.DEPTH24_STENCIL8:case g.PixelFormat.RGBA:case g.PixelFormat.RGBA_INTEGER:case g.SizedPixelFormat.RGBA8:case g.SizedPixelFormat.R32F:case g.SizedPixelFormat.R11F_G11F_B10F:case g.SizedPixelFormat.RG16F:case g.SizedPixelFormat.R32I:case g.SizedPixelFormat.R32UI:case g.SizedPixelFormat.RG16I:case g.SizedPixelFormat.RG16UI:case g.SizedPixelFormat.RGBA8I:case g.SizedPixelFormat.RGBA8UI:case g.SizedPixelFormat.RGBA8_SNORM:case g.SizedPixelFormat.SRGB8_ALPHA8:case g.SizedPixelFormat.RGB9_E5:case g.SizedPixelFormat.RGB10_A2UI:case g.SizedPixelFormat.RGB10_A2:case g.RenderbufferFormat.DEPTH_STENCIL:case g.RenderbufferFormat.DEPTH_COMPONENT32F:case g.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case g.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case g.SizedPixelFormat.RGB16F:case g.SizedPixelFormat.RGB16I:case g.SizedPixelFormat.RGB16UI:return 6;case g.SizedPixelFormat.RG32F:case g.SizedPixelFormat.RG32I:case g.SizedPixelFormat.RG32UI:case g.SizedPixelFormat.RGBA16F:case g.SizedPixelFormat.RGBA16I:case g.SizedPixelFormat.RGBA16UI:return 8;case g.SizedPixelFormat.RGB32F:case g.SizedPixelFormat.RGB32I:case g.SizedPixelFormat.RGB32UI:return 12;case g.SizedPixelFormat.RGBA32F:case g.SizedPixelFormat.RGBA32I:case g.SizedPixelFormat.RGBA32UI:return 16;
case g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case g.CompressedTextureFormat.COMPRESSED_R11_EAC:case g.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case g.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case g.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case g.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case g.CompressedTextureFormat.COMPRESSED_RG11_EAC:case g.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case g.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};a.getErrorString=function(k){k=k.gl;switch(k.getError()){case k.NO_ERROR:return null;case k.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case k.INVALID_VALUE:return"An unacceptable value has been specified for an argument";
case k.INVALID_OPERATION:return"The specified command is not allowed for the current state";case k.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case k.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case k.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getStride=d;a.unbindVertexBufferLayout=function(k,m,f,c){const l=k.gl;k.bindBuffer(f);for(const e of c)if(f=m.get(e.name),4>=e.count)l.disableVertexAttribArray(f),
e.divisor&&0<e.divisor&&k.gl2?.vertexAttribDivisor(f,0);else if(9===e.count)for(c=0;3>c;c++)l.disableVertexAttribArray(f+c),e.divisor&&0<e.divisor&&k.gl2?.vertexAttribDivisor(f+c,0);else if(16===e.count)for(c=0;4>c;c++)l.disableVertexAttribArray(f+c),e.divisor&&0<e.divisor&&k.gl2?.vertexAttribDivisor(f+c,0);else console.error("Unsupported vertex attribute element count: "+e.count);k.unbindBuffer(g.BufferType.ARRAY_BUFFER)};a.vertexCount=function(k,m){return k.vertexBuffers[m].byteLength/d(k.layout[m])};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../core/Error ../../core/has ../../core/mathUtils ./checkWebGLError ./contextUtils ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),function(a,b,g,d,k,m,f,c,l,e){function p(y,z){(null!=z.width&&0>z.width||null!=z.height&&0>z.height||null!=z.depth&&0>z.depth)&&console.error("Negative dimension parameters are not allowed!");(y=y.type===m.ContextType.WEBGL2)||
!z.isImmutable&&!q(z.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");y||null!=z.width&&d.isPowerOfTwo(z.width)&&null!=z.height&&d.isPowerOfTwo(z.height)||("number"===typeof z.wrapMode?z.wrapMode!==f.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(z.wrapMode.s!==f.TextureWrapMode.CLAMP_TO_EDGE||z.wrapMode.t!==f.TextureWrapMode.CLAMP_TO_EDGE)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),
z.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}function h(y,z){let D=z.samplingMode,C=z.samplingMode;if(D===f.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||D===f.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)D=f.TextureSamplingMode.LINEAR,z.hasMipmap||(C=f.TextureSamplingMode.LINEAR);else if(D===f.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||D===f.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)D=f.TextureSamplingMode.NEAREST,z.hasMipmap||(C=f.TextureSamplingMode.NEAREST);y.texParameteri(z.target,
y.TEXTURE_MAG_FILTER,D);y.texParameteri(z.target,y.TEXTURE_MIN_FILTER,C)}function u(y,z){"number"===typeof z.wrapMode?(y.texParameteri(z.target,y.TEXTURE_WRAP_S,z.wrapMode),y.texParameteri(z.target,y.TEXTURE_WRAP_T,z.wrapMode)):(y.texParameteri(z.target,y.TEXTURE_WRAP_S,z.wrapMode.s),y.texParameteri(z.target,y.TEXTURE_WRAP_T,z.wrapMode.t))}function w(y,z){const D=y.capabilities.textureFilterAnisotropic;D&&y.gl.texParameterf(z.target,D.TEXTURE_MAX_ANISOTROPY,z.maxAnisotropy??1)}function x(y){return null!=
y&&"type"in y&&"compressed"===y.type}function n(y){return null!=y&&!x(y)&&!(null!=y&&"byteLength"in y)}function q(y){return y===f.TextureType.TEXTURE_3D||y===f.TextureType.TEXTURE_2D_ARRAY}function t(y,z,D,C=1){z=Math.max(z,D);y===f.TextureType.TEXTURE_3D&&(z=Math.max(z,C));return Math.round(Math.log(z)/Math.LN2)+1}let v=class{constructor(y,z=null,D=null){this.type=c.GLObjectType.Texture;this._glName=null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in y)this._descriptor=
y,D=z;else{y=e.ValidatedTextureDescriptor.validate(y,z);if(!y)throw new b("Texture descriptor invalid");this._descriptor=y}if(this._descriptor.context.type!==m.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),q(this._descriptor.target)))throw new b("3D and array textures are not supported in WebGL1");this._descriptor.target===f.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(D):this.setData(D)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){r.delete(this);
return l.estimateMemory(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(f.ResourceType.Texture,this);this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(y,z){const D=this._descriptor;if(D.width!==y||D.height!==z){if(this._wasImmutablyAllocated)throw new b("Immutable textures can't be resized!");
D.width=y;D.height=z;this._descriptor.target===f.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(y=null){for(let z=f.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;z<=f.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;z++)this._setData(y,z)}setData(y){this._setData(y)}_setData(y,z){if(this._descriptor.context?.gl){var D=this._descriptor.context.gl;k.checkWebGLError(D);this._glName||(this._glName=D.createTexture())&&this._descriptor.context.instanceCounter.increment(f.ResourceType.Texture,
this);void 0===y&&(y=null);var C=this._descriptor,E=z??C.target,A=q(E);null===y&&(C.width=C.width||4,C.height=C.height||4,A&&(C.depth=C.depth??1));z=this._descriptor.context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);p(this._descriptor.context,C);this._configurePixelStorage();k.checkWebGLError(D);var F=this._deriveInternalFormat();if(n(y)){let G="width"in y?y.width:y.codedWidth,I="height"in y?y.height:y.codedHeight;y instanceof
HTMLVideoElement&&(G=y.videoWidth,I=y.videoHeight);C.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(E,F,C.hasMipmap,G,I,1);this._texImage(E,0,F,G,I,1,y);k.checkWebGLError(D);C.hasMipmap&&this.generateMipmap();C.width||(C.width=G);C.height||(C.height=I);A&&!C.depth&&(C.depth=1)}else{const {width:G,height:I,depth:H}=C;if(null==G||null==I)throw new b("Width and height must be specified!");if(A&&null==H)throw new b("Depth must be specified!");C.isImmutable&&!this._wasImmutablyAllocated&&
this._texStorage(E,F,C.hasMipmap,G,I,H);if(x(y)){const B=y.levels;y=t(E,G,I,H);A=Math.min(y-1,B.length-1);null!=this._descriptor.context.gl2?D.texParameteri(C.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,A):C.hasMipmap=C.hasMipmap&&y===B.length;if(!(F in f.CompressedTextureFormat))throw new b("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((K,L,J,M)=>{this._compressedTexImage(E,K,F,L,J,M,B[Math.min(K,B.length-1)])},A)}else this._texImage(E,0,F,G,
I,H,y),k.checkWebGLError(D),C.hasMipmap&&this.generateMipmap()}h(D,this._descriptor);u(D,this._descriptor);w(this._descriptor.context,this._descriptor);k.checkWebGLError(D);this._descriptor.context.bindTexture(z,v.TEXTURE_UNIT_FOR_UPDATES)}}updateData(y,z,D,C,E,A,F=0){A||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const G=this._descriptor.context.gl,I=this._descriptor.context.gl2,H=this._descriptor,B=this._deriveInternalFormat(),
{pixelFormat:K,dataType:L,target:J,isImmutable:M}=H;if(M&&!this._wasImmutablyAllocated)throw new b("Cannot update immutable texture before allocation!");const T=this._descriptor.context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES,!0);(0>z||0>D||C>H.width||E>H.height||z+C>H.width||D+E>H.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();if(F){if(!I){console.error("Webgl2 must be enabled to use dataRowOffset!");return}G.pixelStorei(I.UNPACK_SKIP_ROWS,
F)}n(A)?I?I.texSubImage2D(J,y,z,D,C,E,K,L,A):G.texSubImage2D(J,y,z,D,K,L,A):x(A)?G.compressedTexSubImage2D(J,y,z,D,C,E,B,A.levels[y]):G.texSubImage2D(J,y,z,D,C,E,K,L,A);if(F){if(!I){console.error("Webgl2 must be enabled to use dataRowOffset!");return}G.pixelStorei(I.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(T,v.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(y,z,D,C,E,A,F,G){G||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
const I=this._descriptor.context.gl2;if(null==I)throw new b("3D textures are not supported in WebGL1");const H=this._descriptor,B=this._deriveInternalFormat(),{pixelFormat:K,dataType:L,isImmutable:J,target:M}=H;if(J&&!this._wasImmutablyAllocated)throw new b("Cannot update immutable texture before allocation!");q(M)||console.warn("Attempting to set 3D texture data on a non-3D texture");const T=this._descriptor.context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);
(0>z||0>D||0>C||E>H.width||A>H.height||F>H.depth||z+E>H.width||D+A>H.height||C+F>H.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();x(G)?(G=G.levels[y],I.compressedTexSubImage3D(M,y,z,D,C,E,A,F,B,G)):I.texSubImage3D(M,y,z,D,C,E,A,F,K,L,G);this._descriptor.context.bindTexture(T,v.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const y=this._descriptor;if(!y.hasMipmap){if(this._wasImmutablyAllocated)throw new b("Cannot add mipmaps to immutable texture after allocation");
this._samplingModeDirty=y.hasMipmap=!0;p(this._descriptor.context,y)}y.samplingMode===f.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,y.samplingMode=f.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):y.samplingMode===f.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,y.samplingMode=f.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const z=this._descriptor.context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(y.target);
this._descriptor.context.bindTexture(z,v.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(y){y!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=y,this._samplingModeDirty=!0)}setWrapMode(y){y!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=y,p(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const y=this._descriptor.context.gl,z=this._descriptor;this._samplingModeDirty&&(h(y,z),this._samplingModeDirty=!1);this._wrapModeDirty&&(u(y,z),this._wrapModeDirty=
!1)}_deriveInternalFormat(){if(this._descriptor.context.type===m.ContextType.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===f.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=f.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case f.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case f.PixelFormat.RGBA:return this._descriptor.internalFormat=
f.SizedPixelFormat.RGBA32F;case f.PixelFormat.RGB:return this._descriptor.internalFormat=f.SizedPixelFormat.RGB32F;default:throw new b("Unable to derive format");}case f.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case f.PixelFormat.RGBA:return this._descriptor.internalFormat=f.SizedPixelFormat.RGBA8;case f.PixelFormat.RGB:return this._descriptor.internalFormat=f.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===f.PixelFormat.DEPTH_STENCIL?
f.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const y=this._descriptor.context.gl,{unpackAlignment:z,flipped:D,preMultiplyAlpha:C}=this._descriptor;y.pixelStorei(y.UNPACK_ALIGNMENT,z);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,D?1:0);y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C?1:0)}_texStorage(y,z,D,C,E,A){const F=this._descriptor.context.gl2;if(null==F)throw new b("Immutable textures are not supported in WebGL1");if(!(z in f.SizedPixelFormat))throw new b("Immutable textures must have a sized internal format");
if(this._descriptor.isImmutable){D=D?t(y,C,E,A):1;if(q(y)){if(null==A)throw new b("Missing depth dimension for 3D texture upload");F.texStorage3D(y,D,z,C,E,A)}else F.texStorage2D(y,D,z,C,E);this._wasImmutablyAllocated=!0}}_texImage(y,z,D,C,E,A,F){const G=this._descriptor.context.gl,I=q(y),{isImmutable:H,pixelFormat:B,dataType:K}=this._descriptor,L=this._descriptor.context.type===m.ContextType.WEBGL2,J=L?G:null;if(!L&&n(F))G.texImage2D(y,0,D,B,K,F);else if(H){if(null!=F)if(I){if(null==A)throw new b("Missing depth dimension for 3D texture upload");
J.texSubImage3D(y,z,0,0,0,C,E,A,B,K,F)}else G.texSubImage2D(y,z,0,0,C,E,B,K,F)}else if(I){if(null==A)throw new b("Missing depth dimension for 3D texture upload");J.texImage3D(y,z,D,C,E,A,0,B,K,F)}else G.texImage2D(y,z,D,C,E,0,B,K,F)}_compressedTexImage(y,z,D,C,E,A,F){const G=this._descriptor.context.gl;let I=null;const H=q(y),B=this._descriptor.isImmutable;if(H){if(this._descriptor.context.type!==m.ContextType.WEBGL2)throw new b("3D textures are not supported in WebGL1");I=G}if(B){if(null!=F)if(H){if(null==
A)throw new b("Missing depth dimension for 3D texture upload");I.compressedTexSubImage3D(y,z,0,0,0,C,E,A,D,F)}else G.compressedTexSubImage2D(y,z,0,0,C,E,D,F)}else if(H){if(null==A)throw new b("Missing depth dimension for 3D texture upload");I.compressedTexImage3D(y,z,D,C,E,A,0,F)}else G.compressedTexImage2D(y,z,D,C,E,0,F)}_forEachMipmapLevel(y,z=Infinity){let {width:D,height:C,depth:E,hasMipmap:A,target:F}=this._descriptor;const G=F===f.TextureType.TEXTURE_3D;if(null==D||null==C||G&&null==E)throw new b("Missing texture dimensions for mipmap calculation");
for(let I=0;;++I){y(I,D,C,E);if(!A||1===D&&1===C&&(!G||1===E)||I>=z)break;D=Math.max(1,D>>1);C=Math.max(1,C>>1);G&&(E=Math.max(1,E>>1))}}};v.TEXTURE_UNIT_FOR_UPDATES=0;const r=new Map;a.Texture=v;a.clearUnestimatedTextures=function(){if(0!==r.size){var y=[];r.forEach((z,D)=>y.push([D.gpuMemoryUsage,z]));r.clear();y.sort((z,D)=>D[0]-z[0]);return y.reduce((z,D)=>`${z}\n\n${Math.round(D[0]/1024)}KB: ${D[1]}`,`Total unestimated texture memory: ${Math.round(y.reduce((z,D)=>z+D[0],0)/1024)}KB`)}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(a,b,g){class d{constructor(k=0,m=k){this.width=k;this.height=m;this.target=b.TextureType.TEXTURE_2D;this.pixelFormat=b.PixelFormat.RGBA;this.dataType=b.PixelType.UNSIGNED_BYTE;this.samplingMode=b.TextureSamplingMode.LINEAR;this.wrapMode=b.TextureWrapMode.REPEAT;this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=4;this.preMultiplyAlpha=
!1;this.depth=1;this.isImmutable=!1}}a.TextureDescriptor=d;a.estimateMemory=function(k){return 0>=k.width||0>=k.height?0:k.width*k.height*(k.hasMipmap?4/3:1)*(null==k.internalFormat?4:g.getBytesPerElementFormat(k.internalFormat))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(a,b,g){class d extends g.TextureDescriptor{constructor(k,m){super();this.context=k;Object.assign(this,
m);switch(this.internalFormat){case b.SizedPixelFormat.R16F:case b.SizedPixelFormat.R16I:case b.SizedPixelFormat.R16UI:case b.SizedPixelFormat.R32F:case b.SizedPixelFormat.R32I:case b.SizedPixelFormat.R32UI:case b.SizedPixelFormat.R8_SNORM:case b.SizedPixelFormat.R8:case b.SizedPixelFormat.R8I:case b.SizedPixelFormat.R8UI:this.pixelFormat=b.PixelFormat.RED}}static validate(k,m){return new d(k,m)}}a.ValidatedTextureDescriptor=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports",
"./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,g,d){const k=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,3,g.DataType.FLOAT,0,12)],m=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,3,g.DataType.FLOAT,0,20),new d.VertexElementDescriptor(b.VertexAttribute.UV0,2,g.DataType.FLOAT,12,20)],f=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,3,g.DataType.FLOAT,0,32),new d.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,
g.DataType.FLOAT,12,32),new d.VertexElementDescriptor(b.VertexAttribute.UV0,2,g.DataType.FLOAT,24,32)],c=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,3,g.DataType.FLOAT,0,16),new d.VertexElementDescriptor(b.VertexAttribute.COLOR,4,g.DataType.UNSIGNED_BYTE,12,16)],l=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,2,g.DataType.FLOAT,0,8)];b=[new d.VertexElementDescriptor(b.VertexAttribute.POSITION,2,g.DataType.FLOAT,0,16),new d.VertexElementDescriptor(b.VertexAttribute.UV0,2,
g.DataType.FLOAT,8,16)];a.Pos2=l;a.Pos2Tex=b;a.Pos3=k;a.Pos3Col=c;a.Pos3NormalTex=f;a.Pos3Tex=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){class b{constructor(g,d,k,m,f,c=!1,l=0){this.name=g;this.count=d;this.type=k;this.offset=m;this.stride=f;this.normalized=c;this.divisor=l}}a.VertexElementDescriptor=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c){a.createEmptyDepthTexture=function(l){const e=new c.TextureDescriptor(1);e.samplingMode=m.TextureSamplingMode.NEAREST;return new f.Texture(l,e,new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(l){const e=new c.TextureDescriptor(4);e.samplingMode=m.TextureSamplingMode.NEAREST;return new f.Texture(l,e)};a.createQuadVAO=function(l,e=g.Pos2,p=b.Default3D,h=-1,u=1){let w=null;switch(e){case g.Pos2Tex:w=new Float32Array([h,h,0,0,u,h,1,0,h,u,0,1,u,u,1,1]);break;
default:w=new Float32Array([h,h,u,h,h,u,u,u])}return new d.VertexArrayObject(l,p,{geometry:e},{geometry:k.BufferObject.createVertex(l,m.Usage.STATIC_DRAW,w)})};a.createScreenSizeTriangleVAO=function(l,e=g.Pos2,p=b.Default3D){const h=new Float32Array([-1,-1,3,-1,-1,3]);return new d.VertexArrayObject(l,p,{geometry:e},{geometry:k.BufferObject.createVertex(l,m.Usage.STATIC_DRAW,h)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports",
"../../../webgl/VertexArrayObject"],function(a,b){class g extends b.VertexArrayObject{}a.VertexArrayObject=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./enums ./Util".split(" "),function(a,b,g,d,k,m){const f=b.getLogger("esri.views.webgl.VertexArrayObject");a.VertexArrayObject=class{constructor(c,l,e,p,h=null){this._context=c;this._locations=l;this._layout=
e;this._buffers=p;this._indexBuffer=h;this._glName=null;this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((c,l)=>c+this._buffers[l].byteLength,null!=this._indexBuffer?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+
(this._indexBuffer?1:0))*d.typedArrayStaticSize}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const c in this._buffers)this._buffers[c]?.dispose(),delete this._buffers[c];this._indexBuffer=g.disposeMaybe(this._indexBuffer);this.disposeVAOOnly()}else(this._glName||0<Object.getOwnPropertyNames(this._buffers).length)&&f.warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&((this._context?.capabilities?.vao).deleteVertexArray(this._glName),this._glName=
null,this._context.instanceCounter.decrement(k.ResourceType.VertexArrayObject,this));this._context=null}initialize(){if(!this._initialized){var c=this._context.capabilities.vao;if(c){const l=c.createVertexArray();c.bindVertexArray(l);this._bindLayout();c.bindVertexArray(null);this._glName=l;this._context.instanceCounter.increment(k.ResourceType.VertexArrayObject,this)}this._initialized=!0}}bind(){this.initialize();const c=this._context.capabilities.vao;c?c.bindVertexArray(this.glName):(this._context.bindVAO(null),
this._bindLayout())}_bindLayout(){const {_buffers:c,_layout:l,_indexBuffer:e}=this;c||f.error("Vertex buffer dictionary is empty!");const p=this._context.gl;for(const h in c){const u=c[h];u||f.error("Vertex buffer is uninitialized!");const w=l[h];w||f.error("Vertex element descriptor is empty!");m.bindVertexBufferLayout(this._context,this._locations,u,w)}null!=e&&(this._context.capabilities.vao?p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,e.glName):this._context.bindBuffer(e))}unbind(){this.initialize();const c=
this._context.capabilities.vao;c?c.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const {_buffers:c,_layout:l}=this;c||f.error("Vertex buffer dictionary is empty!");for(const e in c){const p=c[e];p||f.error("Vertex buffer is uninitialized!");m.unbindVertexBufferLayout(this._context,this._locations,p,l[e])}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/textureUtils":function(){define(["exports",
"../../../../core/Error"],function(a,b){function g(k,m,f){if(k instanceof ImageData)return g(d(k),m,f);const c=document.createElement("canvas");c.width=m;c.height=f;c.getContext("2d").drawImage(k,0,0,c.width,c.height);return c}function d(k){const m=document.createElement("canvas");m.width=k.width;m.height=k.height;const f=m.getContext("2d");if(null==f)throw new b("Failed to create 2d context from HTMLCanvasElement");f.putImageData(k,0,0);return m}a.applyTextureResizeModulo=function(k){return 16*Math.ceil(k/
16)};a.downsampleImage=function(k,m){let f=k.width*k.height;if(4096>f)return k instanceof ImageData?d(k):k;let c=k.width,l=k.height;do c=Math.ceil(c/2),l=Math.ceil(l/2),f=c*l;while(1048576<f||null!=m&&(c>m||l>m));return g(k,c,l)};a.ensureImageMaxSize=function(k,m){const f=Math.max(k.width,k.height);if(f<=m)return k;m/=f;return g(k,Math.round(k.width*m),Math.round(k.height*m))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/AtmosphereCompositing.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,g,d,k){function m(l){const e=new d.ShaderBuilder;e.include(b.ScreenSpacePass);e.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",p=>p.color),new k.Texture2DPassUniform("depthTexture",p=>p.depth));l=l.haze;e.fragment.code.add(g.glsl`
    void main() {
      ${l?g.glsl`vec4`:g.glsl`float`} depthSample = texture(depthTexture, uv) ${l?"":g.glsl`.r`};
      if (depthSample ${l?g.glsl`== vec4(0)`:g.glsl`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `);return e}class f extends g.NoParameters{}const c=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:f,build:m},Symbol.toStringTag,{value:"Module"}));a.AtmosphereCompositing=c;a.AtmosphereCompositingPassParameters=f;a.build=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,g){a.ScreenSpacePass=function(d,k=!0){d.attributes.add(g.VertexAttribute.POSITION,
"vec2");k&&d.varyings.add("uv","vec2");d.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${k?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/AtmosphereCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/AtmosphereCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c,l){class e extends d.ShaderTechnique{initializeProgram(p){return new m.Program(p.rctx,
e.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return this.configuration.haze?l.makePipelineState({blending:l.separateBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_COLOR,c.BlendFactor.ONE),depthTest:{func:c.CompareFunction.ALWAYS},colorWrite:l.defaultColorWriteParams}):l.makePipelineState({blending:l.simpleBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:c.CompareFunction.ALWAYS},colorWrite:l.defaultColorWriteParams})}}
e.shader=new g.ReloadableShaderModule(f.AtmosphereCompositing,()=>new Promise((p,h)=>a(["./AtmosphereCompositing.glsl"],p,h)));b.AtmosphereCompositingTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){a.CloudsComposition=class extends g{constructor(x){super(x);this._technique=new e.CloudsCompositionTechnique(x);this._vao=h.createQuadVAO(x.rctx)}destroy(){this._technique=d.releaseMaybe(this._technique);this._vao=d.disposeMaybe(this._vao)}render(x){if(this._technique.compiled){var n=x.bindParameters.cloudsFade;null!=this._vao&&null!=n.data&&(n=x.rctx.bindTechnique(this._technique,w,x.bindParameters),x.rctx.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),
x.rctx.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4))}else this.requestRender()}};b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=b.__decorate([l.subclass("esri.views.3d.environment.CloudsComposition")],
a.CloudsComposition);const w=new p.NoParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends k.ShaderTechnique{constructor(h){super(h,new m.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(h){return new c.Program(h.rctx,p.shader.get().build(),f.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ZERO,l.BlendFactor.SRC_ALPHA,l.BlendFactor.ONE),depthTest:{func:l.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})}}p.shader=new d.ReloadableShaderModule(g.CloudsCompositionShader,
()=>new Promise((h,u)=>a(["./CloudsComposition.glsl"],h,u)));b.CloudsCompositionTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n){function q(){const v=new x.ShaderBuilder,{attributes:r,varyings:y,vertex:z,fragment:D}=v;r.add(n.VertexAttribute.POSITION,"vec2");y.add("worldRay","vec3");z.uniforms.add(new w.Matrix4PassUniform("inverseProjectionMatrix",(C,E)=>E.camera.inverseProjectionMatrix),new w.Matrix4PassUniform("inverseViewMatrix",(C,E)=>b.invertOrIdentity(t,E.camera.viewMatrix)));z.code.add(u.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);D.include(e.ColorConversion);D.include(p.RgbaFloatEncoding);v.include(d.EvaluateAmbientLighting,{pbrMode:f.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});v.include(c.PiUtils);v.include(k.Gamma);v.include(m.MainLighting);v.include(l.CloudsParallaxShading);D.uniforms.add(new h.Float3PassUniform("cameraPosition",(C,E)=>E.camera.eye));D.code.add(u.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return v}const t=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=g;a.build=q})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,g,d,k,m,f,c,l){const e=g.create(),p=k.create();a.EvaluateAmbientLighting=function(h,u){h=h.fragment;const w=void 0!==u.lightingSphericalHarmonicsOrder?u.lightingSphericalHarmonicsOrder:2;0===w?(h.uniforms.add(new f.Float3PassUniform("lightingAmbientSH0",(x,n)=>b.set(e,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),h.code.add(l.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===w?(h.uniforms.add(new c.Float4PassUniform("lightingAmbientSH_R",(x,n)=>d.set(p,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new c.Float4PassUniform("lightingAmbientSH_G",(x,n)=>d.set(p,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new c.Float4PassUniform("lightingAmbientSH_B",(x,n)=>d.set(p,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),h.code.add(l.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===w&&(h.uniforms.add(new f.Float3PassUniform("lightingAmbientSH0",(x,n)=>b.set(e,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new c.Float4PassUniform("lightingAmbientSH_R1",(x,n)=>d.set(p,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new c.Float4PassUniform("lightingAmbientSH_G1",(x,n)=>d.set(p,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new c.Float4PassUniform("lightingAmbientSH_B1",(x,n)=>d.set(p,n.lighting.sh.b[1],
n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new c.Float4PassUniform("lightingAmbientSH_R2",(x,n)=>d.set(p,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new c.Float4PassUniform("lightingAmbientSH_G2",(x,n)=>d.set(p,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new c.Float4PassUniform("lightingAmbientSH_B2",(x,n)=>d.set(p,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),h.code.add(l.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),u.pbrMode!==m.PBRMode.Normal&&u.pbrMode!==m.PBRMode.Schematic||h.code.add(l.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),function(a,
b,g,d,k,m,f,c,l){a.PBRMode=void 0;(function(p){p[p.Disabled=0]="Disabled";p[p.Normal=1]="Normal";p[p.Schematic=2]="Schematic";p[p.Water=3]="Water";p[p.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";p[p.Terrain=5]="Terrain";p[p.TerrainWithWater=6]="TerrainWithWater";p[p.COUNT=7]="COUNT"})(a.PBRMode||(a.PBRMode={}));class e extends l.GLTextureMaterialBindParameters{}a.PBRBindParameters=e;a.PhysicallyBasedRenderingParameters=function(p,h){const u=p.fragment,w=h.hasMetallicRoughnessTexture||h.hasEmissionTexture||
h.hasOcclusionTexture;h.pbrMode===a.PBRMode.Normal&&w&&p.include(b.VertexTextureCoordinates,h);h.pbrMode===a.PBRMode.Schematic?u.code.add(k.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):h.pbrMode===a.PBRMode.Disabled?u.code.add(k.glsl`float getBakedOcclusion() { return 1.0; }`):h.pbrMode===a.PBRMode.Normal&&(u.code.add(k.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),p=h.pbrTextureBindType,h.hasMetallicRoughnessTexture&&(u.uniforms.add(p===c.BindType.Pass?new f.Texture2DPassUniform("texMetallicRoughness",x=>x.textureMetallicRoughness):new m.Texture2DDrawUniform("texMetallicRoughness",x=>x.textureMetallicRoughness)),u.code.add(k.glsl`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),h.hasEmissionTexture&&(u.uniforms.add(p===c.BindType.Pass?new f.Texture2DPassUniform("texEmission",x=>x.textureEmissive):new m.Texture2DDrawUniform("texEmission",x=>x.textureEmissive)),u.code.add(k.glsl`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),h.hasOcclusionTexture?(u.uniforms.add(p===c.BindType.Pass?new f.Texture2DPassUniform("texOcclusion",x=>x.textureOcclusion):new m.Texture2DDrawUniform("texOcclusion",x=>x.textureOcclusion)),u.code.add(k.glsl`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):u.code.add(k.glsl`float getBakedOcclusion() { return 1.0; }`),p===c.BindType.Pass?u.uniforms.add(new d.Float3PassUniform("emissionFactor",x=>x.emissiveFactor),new d.Float3PassUniform("mrrFactors",x=>x.mrrFactors)):u.uniforms.add(new g.Float3DrawUniform("emissionFactor",x=>x.emissiveFactor),new g.Float3DrawUniform("mrrFactors",x=>x.mrrFactors)),u.code.add(k.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${h.hasMetallicRoughnessTexture?k.glsl`applyMetallnessAndRoughness(${h.hasMetallicRoughnessTextureTransform?k.glsl`metallicRoughnessUV`:"vuv0"});`:""}

      ${h.hasEmissionTexture?k.glsl`applyEmission(${h.hasEmissiveTextureTransform?k.glsl`emissiveUV`:"vuv0"});`:""}

      ${h.hasOcclusionTexture?k.glsl`applyOcclusion(${h.hasOcclusionTextureTransform?k.glsl`occlusionUV`:"vuv0"});`:""}
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,g,d,k){a.VertexTextureCoordinates=function(m,f){m.include(g.TextureCoordinateAttribute,f);switch(f.textureCoordinateType){case g.TextureCoordinateAttributeType.Default:case g.TextureCoordinateAttributeType.Compressed:m.fragment.code.add(k.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);break;case g.TextureCoordinateAttributeType.Atlas:m.include(d.TextureAtlasLookup);m.fragment.code.add(k.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);break;default:b.neverReached(f.textureCoordinateType);case g.TextureCoordinateAttributeType.None:case g.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(g){g.fragment.code.add(b.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"vec3",g.BindType.Draw,(f,c,l,e)=>f.setUniform3fv(k,m(c,l,e)))}}a.Float3DrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"sampler2D",g.BindType.Draw,(f,c,l)=>f.bindTexture(k,m(c,l)))}}a.Texture2DDrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,b,g,d,k,m){class f extends m{constructor(l){super(l);
this._numLoading=0;this._disposed=!1;this._textureRepository=l.textureRepository;this._textureId=l.textureId;this._acquire(l.textureId,e=>this._texture=e);this._acquire(l.normalTextureId,e=>this._textureNormal=e);this._acquire(l.emissiveTextureId,e=>this._textureEmissive=e);this._acquire(l.occlusionTextureId,e=>this._textureOcclusion=e);this._acquire(l.metallicRoughnessTextureId,e=>this._textureMetallicRoughness=e)}dispose(){this._texture=b.releaseMaybe(this._texture);this._textureNormal=b.releaseMaybe(this._textureNormal);
this._textureEmissive=b.releaseMaybe(this._textureEmissive);this._textureOcclusion=b.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=b.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0}ensureResources(l){return 0===this._numLoading?k.ResourceState.LOADED:k.ResourceState.LOADING}get textureBindParameters(){return new c(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:
null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(l){if(null==this._texture||l!==this._texture.id)this._texture=b.releaseMaybe(this._texture),this._textureId=l,this._acquire(this._textureId,e=>this._texture=e)}_acquire(l,e){null==l?e(null):(l=this._textureRepository.acquire(l),g.isPromiseLike(l)?(++this._numLoading,l.then(p=>{this._disposed?(b.releaseMaybe(p),e(null)):e(p)}).finally(()=>
--this._numLoading)):e(l))}}class c extends d.NoParameters{constructor(l=null,e=null,p=null,h=null,u=null){super();this.texture=l;this.textureNormal=e;this.textureEmissive=p;this.textureOcclusion=h;this.textureMetallicRoughness=u}}a.GLTextureMaterial=f;a.GLTextureMaterialBindParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["./basicInterfaces"],function(a){class b{constructor(g){this._material=g.material;this._techniqueRepository=
g.techniqueRep;this._output=g.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(g,d){return this._technique=this._techniqueRepository.releaseAndAcquire(g,this._material.getConfiguration(this._output,d),this._technique)}ensureResources(g){return a.ResourceState.LOADED}}
return b})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(g){g.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);g.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsData ../../../../environment/CloudsParameters ../../../../environment/weather ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){a.CloudsParallaxShading=function(w){w=w.fragment;w.uniforms.add(new h.Matrix4PassUniform("rotationMatrixClouds",(x,n)=>n.cloudsFade.parallax.transform),new h.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(x,n)=>n.cloudsFade.parallaxNew.transform),new l.Float3PassUniform("anchorPosition",(x,n)=>n.cloudsFade.parallax.anchorPointClouds),new l.Float3PassUniform("anchorPositionCrossFade",(x,n)=>n.cloudsFade.parallaxNew.anchorPointClouds),new e.FloatPassUniform("cloudsHeight",
()=>m.cloudsHeight),new e.FloatPassUniform("radiusCurvatureCorrectionFactor",(x,n)=>n.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new e.FloatPassUniform("totalFadeInOut",(x,n)=>1-n.cloudsFade.opacity),new e.FloatPassUniform("crossFadeAnchorFactor",(x,n)=>b.clamp(n.cloudsFade.fadeFactor,0,1)),new u.TextureCubePassUniform("cubeMap",(x,n)=>n.cloudsFade.data?.cubeMap?.colorTexture??null),new c.BooleanPassUniform("crossFade",(x,n)=>n.cloudsFade.fadeMode===k.FadeMode.CROSS_FADE),new c.BooleanPassUniform("readChannelsRG",
(x,n)=>n.cloudsFade.readChannels===d.CloudsTextureChannels.RG),new c.BooleanPassUniform("fadeTextureChannels",(x,n)=>n.cloudsFade.renderingStage===d.CloudsRenderingStages.FADING));w.constants.add("planetRadius","float",g.earth.radius);w.code.add(p.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);w.code.add(p.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);w.code.add(p.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);f.addMainLightDirection(w);f.addMainLightIntensity(w);w.code.add(p.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);w.code.add(p.glsl`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`);w.code.add(p.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);w.code.add(p.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);w.code.add(p.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsData":function(){define(["exports"],function(a){a.CloudsRenderingStages=void 0;(function(b){b[b.RENDERING=0]="RENDERING";b[b.FADING=1]="FADING";b[b.FINISHED=2]="FINISHED"})(a.CloudsRenderingStages||(a.CloudsRenderingStages={}));a.CloudsTextureChannels=void 0;(function(b){b[b.RG=0]="RG";b[b.BA=1]="BA"})(a.CloudsTextureChannels||(a.CloudsTextureChannels={}));a.ensureClouds=function(b){return null!=
b&&!b.running};a.isReadyCloudsData=function(b){return null!=b?.cubeMap};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsParameters":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsData ./weather ../../support/RenderState".split(" "),function(a,b,g,d,k,m,f,c,l,e,p){class h{constructor(){this.readChannels=
l.CloudsTextureChannels.RG;this.renderingStage=l.CloudsRenderingStages.FINISHED;this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=m.create();this.parallax=new u;this.parallaxNew=new u;this.pointOnGround=m.create();this.fadeMode=a.FadeMode.HIDE;this.opacity=this.fadeFactor=0}updateParallax(q){var t=this.parallax;q=k.length(q.eye);t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(q*q-c.earth.radius*c.earth.radius,0))/q;f.fromPoints(w,t.anchorPointClouds,x);g.rotate(t.transform,
d.IDENTITY,x[3],f.axis(x));this.fadeMode===a.FadeMode.CROSS_FADE&&(t=this.parallaxNew,f.fromPoints(w,t.anchorPointClouds,x),g.rotate(t.transform,d.IDENTITY,x[3],f.axis(x)))}updateFading(q,t,v,r){this.isFading&&this._advanceFading(v,r);this._evaluateFading(q,t,v)}_evaluateFading(q,t,v){const r=q.relativeElevation;q=this._calculateDistanceToAnchorPoint(q);(r>1.7*e.weatherHeightLimit||r<-e.weatherHeightLimit||2E5<q)&&0<this.opacity?this._setFade(a.FadeMode.HIDE,v):this.isFading||((r>e.weatherHeightLimit||
r<-.35*e.weatherHeightLimit||64E3<q)&&0<this.opacity?this._setFade(a.FadeMode.FADE_OUT,v):r<=e.weatherHeightLimit&&r>=-.35*e.weatherHeightLimit&&t===p.RenderState.IDLE&&l.ensureClouds(this.data)&&(0===this.opacity?this._setFade(a.FadeMode.FADE_IN,v):(34E3<q||this.renderingStage===l.CloudsRenderingStages.FADING)&&this._setFade(a.FadeMode.CROSS_FADE,v)))}_advanceFading(q,t){this._switchReadChannels();this._updateAnchorPoint();this._advanceFadingFactorAndOpacity(q,t)}_advanceFadingFactorAndOpacity(q,
t){1>this.fadeFactor?(this.fadeFactor=t?b.clamp((q-this.startTime)/(1.25*t),0,1):1,this.fadeMode===a.FadeMode.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===a.FadeMode.FADE_IN&&(this.opacity=this.fadeFactor),this.fadeMode===a.FadeMode.CROSS_FADE&&(this.opacity=1)):(this.fadeFactor=0,this.fadeMode===a.FadeMode.FADE_OUT&&(this.opacity=0),this.fadeMode===a.FadeMode.FADE_IN&&(this.opacity=1),this.fadeMode===a.FadeMode.CROSS_FADE&&(this.opacity=1),this.fadeMode=a.FadeMode.NONE)}_switchReadChannels(){const q=
this.fadeMode===a.FadeMode.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===a.FadeMode.FADE_IN&&0===this.fadeFactor;this.renderingStage===l.CloudsRenderingStages.FADING&&(q||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=l.CloudsRenderingStages.FINISHED)}_calculateDistanceToAnchorPoint(q){k.normalize(this.pointOnGround,q.eye);k.scale(this.pointOnGround,this.pointOnGround,c.earth.radius);return k.length(k.subtract(n,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===
a.FadeMode.CROSS_FADE&&(0===this.fadeFactor&&k.copy(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&k.copy(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds));this.fadeMode===a.FadeMode.FADE_IN&&0===this.fadeFactor&&k.copy(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(q,t){switch(q){case a.FadeMode.HIDE:this.opacity=0;break;case a.FadeMode.FADE_OUT:this.opacity=1;break;case a.FadeMode.FADE_IN:this.opacity=0;break;case a.FadeMode.CROSS_FADE:this.opacity=
1}this.fadeMode=q;this.fadeFactor=0;this.startTime=t}get isFading(){return this.fadeMode===a.FadeMode.FADE_OUT||this.fadeMode===a.FadeMode.FADE_IN||this.fadeMode===a.FadeMode.CROSS_FADE}}a.FadeMode=void 0;(function(q){q[q.NONE=0]="NONE";q[q.HIDE=1]="HIDE";q[q.FADE_OUT=2]="FADE_OUT";q[q.FADE_IN=3]="FADE_IN";q[q.CROSS_FADE=4]="CROSS_FADE"})(a.FadeMode||(a.FadeMode={}));class u{constructor(){this.anchorPointClouds=m.create();this.radiusCurvatureCorrectionFactor=0;this.transform=d.create()}}const w=m.fromValues(0,
0,1),x=f.create(),n=m.create();a.CloudsParameters=h;a.crossFadeDistanceThreshold=34E3;a.fadeOutDistanceThreshold=64E3;a.hideDistanceThreshold=2E5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngleDegrees":function(){define("exports ../../core/mathUtils ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ../../chunks/vec3f64".split(" "),function(a,b,g,d,k,m){function f(r=u){return[r[0],r[1],r[2],r[3]]}function c(r,y,z,D,C=f()){C[0]=r;C[1]=y;C[2]=z;
C[3]=D;return C}function l(r,y,z=f()){k.copy(z,r);z[3]=y;return z}function e(r,y,z=f()){g.setAxisAngle(w,r,p(r));g.setAxisAngle(x,y,p(y));g.multiply(w,x,w);return h(z,b.rad2deg(g.getAxisAngle(z,w)))}function p(r){return b.deg2rad(r[3])}function h(r,y){r[3]=y;return r}const u=[0,0,1,0],w=d.create(),x=d.create(),n=f(),q=f(),t=f(),v=f();a.angle=function(r){return r[3]};a.angleRad=p;a.axis=function(r){return r};a.compose=e;a.composeAxes=function(r,y,z,D=f()){l(m.UNIT_X,r,q);l(m.UNIT_Y,y,t);l(m.UNIT_Z,
z,v);e(q,t,q);e(q,v,D);return D};a.copy=function(r,y=f()){return c(r[0],r[1],r[2],r[3],y)};a.create=f;a.fromAxisAndAngle=l;a.fromPoints=function(r,y,z=f()){k.cross(z,r,y);k.normalize(z,z);z[3]=-k.angle(r,y);return z};a.fromValues=c;a.setAngle=h;a.up=u;a.wrap=function(r,y,z,D){return c(r,y,z,D,n)};a.wrapAxisAngle=function(r,y){return c(r[0],r[1],r[2],y,n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/RenderState":function(){define(["exports"],function(a){a.RenderState=
void 0;var b=a.RenderState||(a.RenderState={});b[b.ANIMATING=0]="ANIMATING";b[b.INTERACTING=1]="INTERACTING";b[b.IDLE=2]="IDLE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"bool",g.BindType.Pass,(f,c,l)=>f.setUniform1b(k,m(c,l)))}}a.BooleanPassUniform=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"samplerCube",g.BindType.Pass,(f,c,l)=>f.bindTexture(k,m(c,l)))}}a.TextureCubePassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(g){g.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f32 ../../../geometry/ellipsoidUtils ../../../chunks/Clouds.glsl ./CloudsData ./CloudsParameters ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B){a.CloudsGenerator=class extends g{constructor(M){super(M);this._techniques=[];this._techniqueConfiguration=new C.CloudsTechniqueConfiguration;this._bindParameters=new A.BindParameters(null,null);this._passParameters=new v.CloudsPassParameters;this._drawParameters=new v.CloudsDrawParameters;this._weatherTile=n.create();this._weatherTileCount=128;this._tileIndex=this._faceIndex=0;this.coverage=d.lerp(z.cloudPresets.default.coverage[0],
z.cloudPresets.default.coverage[1],.5);this.density=d.lerp(z.cloudPresets.default.density[0],z.cloudPresets.default.density[1],.5);this.absorption=d.lerp(z.cloudPresets.default.absorption[0],z.cloudPresets.default.absorption[1],.5);this.cloudSize=d.lerp(z.cloudPresets.default.cloudSize[0],z.cloudPresets.default.cloudSize[1],.5);this.detailSize=d.lerp(z.cloudPresets.default.detailSize[0],z.cloudPresets.default.detailSize[1],.5);this.smoothness=d.lerp(z.cloudPresets.default.smoothness[0],z.cloudPresets.default.smoothness[1],
.5);this.cloudHeight=d.lerp(z.cloudPresets.default.cloudHeight[0],z.cloudPresets.default.cloudHeight[1],.5);this.raymarchingSteps=z.cloudPresets.default.raymarchingSteps;this._viewMatrix=w.create();this.running=this._dirty=!1;this._vao=F.createQuadVAO(M.context.renderContext.rctx)}_getTechnique(M){const T=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,Q=T===r.CloudsTextureChannels.RG?2*M:2*M+1,O=this._techniques[Q];if(O)return O;this._techniqueConfiguration.writeTextureChannels=
T;this._techniqueConfiguration.steps=M;this._techniques[Q]=new D.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[Q]}updateWeatherTile(){var M=this.view.camera.position.latitude,T=this.view.camera.position.longitude;null!=M&&null!=T&&(x.set(this._weatherTile,(M+90)/180,(T+180)/360),M=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1)),this._weatherTile[0]=Math.floor(2*this._weatherTileCount*
this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-M)*this._weatherTile[1]),T=M=0,null!=this.view.environment&&"virtual"!==this.view.environment.lighting.type&&null!=this.view.environment.lighting.date&&(T=new Date(this.view.environment.lighting.date),T.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),M=31*T.getUTCMonth()+T.getUTCDate(),T=T.getUTCFullYear()),this._weatherTile[0]=(this._weatherTile[0]+M)%
(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+T%100)%(4*this._weatherTileCount),x.equals(this._passParameters.weatherTile,this._weatherTile)||this.setDirty())}initialize(){const M=t.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*M.radius;this.setDirty();this.updateWeatherTile();this.addHandles([this.view.resourceController.scheduler.registerTask(G.TaskPriority.CLOUDS_GENERATOR,this),m.watch(()=>[this.coverage,this.density,this.absorption,
this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),m.initial)])}destroy(){this._techniques.forEach(M=>k.releaseMaybe(M));this._frameBufferCube=k.disposeMaybe(this._frameBufferCube);this._techniques.length=0;this._vao.dispose();this._passParameters.noiseTexture=k.destroyMaybe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case C.RayMarchingSteps.SIXTEEN:return 1;case C.RayMarchingSteps.HUNDRED:return 4;
case C.RayMarchingSteps.COUNT:case C.RayMarchingSteps.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.gpuMemoryUsage??0)+(this._passParameters.noiseTexture?.textureAtlas?.gpuMemoryUsage??0)}_ensureNoiseTexture(){null==this._passParameters.noiseTexture&&(this._passParameters.noiseTexture=new E.NoiseTextureAtlas({context:this.context}));this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);return null!=this._passParameters.noiseTexture.textureAtlas}_ensureFrameBufferCube(M){null==
this._frameBufferCube&&(M=new B.TextureDescriptor(M),M.target=I.TextureType.TEXTURE_CUBE_MAP,M.wrapMode=I.TextureWrapMode.CLAMP_TO_EDGE,this._frameBufferCube=new H.FramebufferObject(this.context.renderContext.rctx,M));return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=k.disposeMaybe(this._frameBufferCube)}applyPreset(M,T){const Q=M.median,O=U=>{const Z=d.lerp(U[0],U[1],Q);return.5>T?d.lerp(U[0],Z,2*T):d.lerp(Z,U[1],2*(T-.5))};this.coverage=
O(M.coverage);this.density=O(M.density);this.absorption=O(M.absorption);this.cloudSize=O(M.cloudSize);this.detailSize=O(M.detailSize);this.smoothness=O(M.smoothness);this.cloudHeight=O(M.cloudHeight);this.raymarchingSteps=M.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(M){0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),x.copy(this._passParameters.weatherTile,this._weatherTile));var T=this._getTechnique(this._passParameters.raymarchingSteps);
if(!T.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||!this._ensureNoiseTexture())return G.Task.YIELD;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=r.CloudsRenderingStages.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=
this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const Q=this.context.renderContext.rctx,O=Q.bindTechnique(T,this._passParameters,this._bindParameters);Q.bindVAO(this._vao);O.assertCompatibleVertexAttributeLocations(this._vao);const U=Q.getViewport();T=T.configuration.cubeMapSize;const Z=T/this._tilesPerFace;Q.setViewport(0,this._tileIndex*Z,T,Z);T=this._ensureFrameBufferCube(T);Q.bindFramebuffer(T);u.targetTo(this._viewMatrix,
J,K[this._faceIndex],L[this._faceIndex]);h.fromMat4(this._drawParameters.viewMatrix,this._viewMatrix);T.setColorTextureTarget(I.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex);O.bindDraw(this._drawParameters,this._bindParameters,this._passParameters);Q.gl.drawArrays(Q.gl.TRIANGLE_STRIP,0,4);Q.gl.flush();Q.setViewport(U.x,U.y,U.width,U.height);this.requestRender();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._tileIndex=this._faceIndex=
0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=r.CloudsRenderingStages.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0);M.madeProgress();return G.Task.YIELD}};b.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"context",void 0);b.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);b.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",
void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"coverage",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"density",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"absorption",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"detailSize",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"smoothness",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,
"cloudHeight",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"raymarchingSteps",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=b.__decorate([p.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const K=[q.fromValues(1,0,0),q.fromValues(-1,0,0),q.fromValues(0,1,0),q.fromValues(0,-1,0),q.fromValues(0,0,1)],L=[q.fromValues(0,1,0),q.fromValues(0,1,0),q.fromValues(0,0,-1),q.fromValues(0,0,1),q.fromValues(0,1,0)],
J=q.zeros();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}function g(q){const t=new Float32Array(3);t[0]=q[0];t[1]=q[1];t[2]=q[2];return t}function d(q,t,v){const r=new Float32Array(3);r[0]=q;r[1]=t;r[2]=v;return r}function k(q,t){return new Float32Array(q,t,3)}function m(){return b()}function f(){return d(1,1,1)}function c(){return d(1,0,0)}function l(){return d(0,1,0)}function e(){return d(0,
0,1)}const p=b(),h=f(),u=c(),w=l(),x=e(),n=Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_X:u,UNIT_Y:w,UNIT_Z:x,ZEROS:p,clone:g,create:b,createView:k,fromValues:d,ones:f,unitX:c,unitY:l,unitZ:e,zeros:m},Symbol.toStringTag,{value:"Module"}));a.ONES=h;a.UNIT_X=u;a.UNIT_Y=w;a.UNIT_Z=x;a.ZEROS=p;a.clone=g;a.create=b;a.createView=k;a.fromValues=d;a.ones=f;a.unitX=c;a.unitY=l;a.unitZ=e;a.vec3f32=n;a.zeros=m})},"esri/chunks/Clouds.glsl":function(){define("exports ../core/mathUtils ./mat3f64 ./vec2 ./vec2f64 ../views/3d/environment/CloudsPresets ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(y){const z=new w.ShaderBuilder;z.include(l.ScreenSpacePass,!1);const D=z.fragment;D.uniforms.add(new p.FloatPassUniform("cloudRadius",C=>C.cloudRadius),new p.FloatPassUniform("power",C=>b.lerp(35,120,C.absorption)),new p.FloatPassUniform("sigmaE",C=>1+C.absorption),new p.FloatPassUniform("density",C=>b.lerp(0,.3,C.density)),new p.FloatPassUniform("cloudSize",C=>b.lerp(0,.02,Math.max(.01,1-C.cloudSize))),new p.FloatPassUniform("detailSize",C=>b.lerp(0,
.2,Math.max(.01,1-C.detailSize))),new p.FloatPassUniform("smoothness",C=>b.lerp(0,.5,1-C.smoothness)),new p.FloatPassUniform("cloudHeight",C=>b.lerp(0,1500,C.cloudHeight)),new p.FloatPassUniform("coverage",C=>C.coverage),new u.Matrix3DrawUniform("view",C=>C.viewMatrix),new x.Texture2DPassUniform("cloudShapeTexture",C=>null!=C.noiseTexture?C.noiseTexture.textureAtlas:null),new e.Float2PassUniform("cloudVariables",C=>d.set(v,C.coverage,C.absorption)));D.constants.add("halfCubeMapSize","float",.5*y.cubeMapSize);
D.code.add(h.glsl`
    const int STEPS = ${y.steps===f.RayMarchingSteps.SIXTEEN?h.glsl`16`:y.steps===f.RayMarchingSteps.HUNDRED?h.glsl`100`:h.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);D.code.add(h.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${h.glsl.float(c.atlasSize)};
      const float dataWidth = ${h.glsl.float(c.atlasSize)};
      const float tileRows = ${h.glsl.float(c.tileRows)};
      const vec3 atlasDimensions = vec3(${h.glsl.float(c.tileSize)}, ${h.glsl.float(c.tileSize)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${h.glsl.float(c.textureScale)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${h.glsl.float(c.weatherMapScale)} * p) / ${h.glsl.float(c.atlasSize)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `);D.code.add(h.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);D.code.add(h.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);D.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      float luminance \x3d 0.0;\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
D.code.add(h.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);D.code.add(h.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);D.code.add(h.glsl`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`);return z}class q extends h.NoParameters{constructor(){super(...arguments);this.coverage=this.cloudHeight=this.smoothness=this.density=this.absorption=this.detailSize=this.cloudSize=this.cloudRadius=0;this.raymarchingSteps=m.cloudPresets.default.raymarchingSteps;this.weatherTile=k.create()}}class t extends h.NoParameters{constructor(){super(...arguments);this.viewMatrix=g.create()}}const v=k.create(),r=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:t,CloudsPassParameters:q,
build:n},Symbol.toStringTag,{value:"Module"}));a.Clouds=r;a.CloudsDrawParameters=t;a.CloudsPassParameters=q;a.build=n})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(a,b){class g{constructor(k,m,f,c,l,e,p,h,u=.5){this.coverage=k;this.density=m;this.absorption=f;this.cloudSize=c;this.detailSize=l;this.smoothness=e;this.cloudHeight=p;this.raymarchingSteps=h;this.median=u}}const d=new g([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],
[.05,.05],b.RayMarchingSteps.SIXTEEN);b={sunny:d,cloudy:new g([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],b.RayMarchingSteps.TWOHUNDRED,.6),rainy:new g([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED,.4),snowy:new g([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],b.RayMarchingSteps.HUNDRED,.65),foggy:new g([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],b.RayMarchingSteps.SIXTEEN),default:d};a.CloudPresets=g;a.cloudPresets=b;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../../../core/has","./CloudsData","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,g,d,k){a.RayMarchingSteps=void 0;(function(f){f[f.SIXTEEN=0]="SIXTEEN";f[f.HUNDRED=1]="HUNDRED";f[f.TWOHUNDRED=2]="TWOHUNDRED";f[f.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));class m extends k.ShaderTechniqueConfiguration{constructor(){super(...arguments);
this.steps=a.RayMarchingSteps.SIXTEEN;this.writeTextureChannels=d.CloudsTextureChannels.RG}}b.__decorate([k.parameter({count:a.RayMarchingSteps.COUNT})],m.prototype,"steps",void 0);b.__decorate([k.parameter({constValue:g("esri-mobile")?1024:2048})],m.prototype,"cubeMapSize",void 0);b.__decorate([k.parameter()],m.prototype,"writeTextureChannels",void 0);a.CloudsTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports",
"../../../core/has"],function(a,b){b=b("esri-mobile")?64:128;const g=Math.ceil(Math.sqrt(b)),d=(b+2)*g;a.atlasSize=d;a.textureScale=b/128;a.tileRows=g;a.tileSize=b;a.weatherMapScale=d/1560;a.weatherMapSize=1E5;a.weatherTileSize=128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,
"mat3",g.BindType.Draw,(f,c,l)=>f.setUniformMatrix3fv(k,m(c,l)))}}a.Matrix3DrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/Clouds.glsl ./CloudsData ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends m.ShaderTechnique{constructor(h,u){super(h,u,()=>this.destroy())}initializeProgram(h){return new c.Program(h.rctx,p.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.simpleBlendingParams(l.BlendFactor.CONSTANT_COLOR,l.BlendFactor.ONE_MINUS_CONSTANT_COLOR,l.BlendOperation.ADD,this.configuration.writeTextureChannels===d.CloudsTextureChannels.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:l.CompareFunction.LEQUAL},
colorWrite:e.defaultColorWriteParams})}}p.shader=new k.ReloadableShaderModule(g.Clouds,()=>new Promise((h,u)=>a(["./Clouds.glsl"],h,u)));b.CloudsTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){a.NoiseTextureAtlas=class extends g{constructor(t){super(t);this._needsRender=!0;this._passParameters=new p.NoiseTextureAtlasPassParameters;this._frameBuffer=new n.FramebufferObject(t.context.renderContext.rctx,new q.TextureDescriptor(u.atlasSize));this._vao=x.createQuadVAO(t.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){null!=this._texture?null!=this._weatherMapTechnique&&this._weatherMapTechnique.compiled&&
this._needsRender&&(this._texture=this._render(h.NoiseTextureRenderMode.WeatherMap)):null!=this._fullTechnique&&this._fullTechnique.compiled&&(this._texture=this._render(h.NoiseTextureRenderMode.Full));return this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(t){if(this._passParameters.weatherTile[0]!==t[0]||this._passParameters.weatherTile[1]!==t[1])e.copy(this._passParameters.weatherTile,t),this._setDirty()}destroy(){this._fullTechniqueCached=d.releaseMaybe(this._fullTechniqueCached);
this._weatherMapTechniqueCached=d.releaseMaybe(this._weatherMapTechniqueCached);this._frameBuffer=d.disposeMaybe(this._frameBuffer);this._vao=d.disposeMaybe(this._vao)}get _fullTechnique(){if(null==this._fullTechniqueCached){const t=new h.NoiseTextureAtlasTechniqueConfiguration;t.mode=h.NoiseTextureRenderMode.Full;this._fullTechniqueCached=this._techniqueRepository.acquire(w.NoiseTextureAtlasTechnique,t)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(null==this._weatherMapTechniqueCached){const t=
new h.NoiseTextureAtlasTechniqueConfiguration;t.mode=h.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(w.NoiseTextureAtlasTechnique,t)}return this._weatherMapTechniqueCached}_render(t){if(null==this._vao||null==this._frameBuffer)return null;var v=t===h.NoiseTextureRenderMode.Full?this._fullTechnique:this._weatherMapTechnique;t=this.context.renderContext.rctx;const r=t.getViewport();t.setViewport(0,0,u.atlasSize,u.atlasSize);t.bindFramebuffer(this._frameBuffer);
v=t.bindTechnique(v,this._passParameters,null);t.bindVAO(this._vao);v.assertCompatibleVertexAttributeLocations(this._vao);t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4);t.setViewport(r.x,r.y,r.width,r.height);this._needsRender=!1;return this._frameBuffer.colorTexture}};b.__decorate([k.property({constructOnly:!0})],a.NoiseTextureAtlas.prototype,"context",void 0);b.__decorate([k.property({readOnly:!0})],a.NoiseTextureAtlas.prototype,"_techniqueRepository",null);a.NoiseTextureAtlas=b.__decorate([l.subclass("esri.views.3d.environment.NoiseTextureAtlas")],
a.NoiseTextureAtlas);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ./vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,g,d,k,m,f,c){function l(h){const u=new c.ShaderBuilder;u.include(k.ScreenSpacePass,!1);u.fragment.code.add(f.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);h.mode===g.NoiseTextureRenderMode.Full&&u.fragment.code.add(f.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${f.glsl.float(d.tileRows)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${f.glsl.float(8)});

      float worley0 = worley(p, ${f.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${f.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${f.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${f.glsl.float(2)});
      float worley1 = worley(p, ${f.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${f.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${f.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);u.fragment.uniforms.add(new m.Float2PassUniform("weatherTile",w=>w.weatherTile));u.fragment.code.add(f.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${f.glsl.float(d.weatherTileSize)});

      // Get global coordinates of p
      p += weatherTile * ${f.glsl.float(d.weatherTileSize)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${f.glsl.float(d.weatherMapSize)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);u.fragment.code.add(f.glsl`void main() {`);h.mode===g.NoiseTextureRenderMode.Full&&u.fragment.code.add(f.glsl`
        float padWidth = 1.0;
        float paddedSize = ${f.glsl.float(d.tileSize)} + 2.0 * padWidth;
        float tileCount = ${f.glsl.float(d.tileRows)} * ${f.glsl.float(d.tileRows)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${f.glsl.float(d.tileSize)};
          }

          if (startPadY) {
            pixel.y += ${f.glsl.float(d.tileSize)};
          }

          if (endPadX) {
            pixel.x -= ${f.glsl.float(d.tileSize)};
          }

          if (endPadY) {
            pixel.y -= ${f.glsl.float(d.tileSize)};
          }

          uv = vec2(pixel.xy / ${f.glsl.float(d.tileSize)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${f.glsl.float(d.tileSize)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${f.glsl.float(d.tileRows)} * ${f.glsl.float(d.tileRows)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${f.glsl.float(d.tileRows)} * ${f.glsl.float(d.tileRows)});
        p = p_;
        p.z /= (${f.glsl.float(d.tileRows)} * ${f.glsl.float(d.tileRows)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);u.fragment.code.add(f.glsl`
      vec2 mapUV = ${f.glsl.float(d.weatherTileSize)} * (gl_FragCoord.xy / ${f.glsl.float(d.atlasSize)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${h.mode===g.NoiseTextureRenderMode.Full?f.glsl`fragColor.ba = vec2(0.0, map);`:f.glsl`fragColor = vec4(map);`};
    }
  `);return u}class e extends f.NoParameters{constructor(){super(...arguments);this.weatherTile=b.fromValues(0,0)}}const p=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:e,build:l},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=p;a.NoiseTextureAtlasPassParameters=e;a.build=l})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,g){a.NoiseTextureRenderMode=void 0;(function(k){k[k.Full=0]="Full";k[k.WeatherMap=1]="WeatherMap";k[k.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));class d extends g.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.mode=a.NoiseTextureRenderMode.Full}}b.__decorate([g.parameter({count:a.NoiseTextureRenderMode.COUNT})],d.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c,l,e){class p extends m.ShaderTechnique{initializeProgram(h){return new c.Program(h.rctx,
p.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return e.makePipelineState({blending:this.configuration.mode===d.NoiseTextureRenderMode.Full?e.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ZERO):e.separateBlendingParams(l.BlendFactor.ZERO,l.BlendFactor.ONE,l.BlendFactor.ONE,l.BlendFactor.ZERO),depthTest:{func:l.CompareFunction.ALWAYS},colorWrite:e.defaultColorWriteParams})}}p.shader=new k.ReloadableShaderModule(g.NoiseTextureAtlas,()=>new Promise((h,u)=>a(["./NoiseTextureAtlas.glsl"],
h,u)));b.NoiseTextureAtlasTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../environment/CloudsParameters ../core/shaderLibrary/hud/HUDRenderStyle ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ./basicInterfaces ./Camera ./RenderSlot ./TransparencyPassType ../lighting/SceneLighting".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){class u{constructor(x,n){this.shadowMap=x;this.slicePlane=n;this.slot=e.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this.transparencyPassType=p.TransparencyPassType.NONE;this.alignPixelEnabled=!1;this.decorations=c.Decorations.ON;this.overlayStretch=1;this._camera=new l.Camera;this._inverseViewport=g.create();this.oldLighting=new h.SceneLighting;this.newLighting=new h.SceneLighting;this._fadedLighting=new h.SceneLighting;this._lighting=
this.newLighting;this.ssr=new w;this.multipassEnabled=!1;this.multipassTerrain=new f.MultipassTerrainUniforms;this.multipassGeometry=new m.MultipassGeometryUniforms;this.hudRenderStyle=k.HUDRenderStyle.Occluded;this.cloudsFade=new d.CloudsParameters}get camera(){return this._camera}set camera(x){this._camera=x;this._inverseViewport[0]=1/x.fullViewport[2];this._inverseViewport[1]=1/x.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===
this._fadedLighting}fadeLighting(x){const {oldLighting:n,newLighting:q}=this;1<=x?this._lighting=q:(this._fadedLighting.lerpLighting(n,q,x),this._lighting=this._fadedLighting)}}class w{constructor(){this.fadeFactor=1;this.reprojectionMatrix=b.create()}}a.BindParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDRenderStyle":function(){define(["exports"],function(a){a.HUDRenderStyle=void 0;var b=a.HUDRenderStyle||(a.HUDRenderStyle=
{});b[b.Occluded=0]="Occluded";b[b.NotOccluded=1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,g,d,k){class m{}a.MultipassGeometryUniforms=m;a.multipassGeometryTest=
function(f){f.include(b.ReadLinearDepth);f.uniforms.add(new k.Texture2DPassUniform("geometryDepthTexture",(c,l)=>l.multipassGeometry.linearDepth?.colorTexture),new g.Float2PassUniform("nearFar",(c,l)=>l.camera.nearFar));f.code.add(d.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,g,d,k){class m{constructor(){this.cullAboveGround=!1}}a.MultipassTerrainUniforms=m;a.multipassTerrainTest=function(f,c){if(c.multipassEnabled){f.fragment.include(b.ReadLinearDepth);
f.fragment.uniforms.add(new k.Texture2DPassUniform("terrainDepthTexture",(e,p)=>p.multipassTerrain.linearDepth?.colorTexture));f.fragment.uniforms.add(new g.Float2PassUniform("nearFar",(e,p)=>p.camera.nearFar));var l=c.occlusionPass;f.fragment.code.add(d.glsl`
   ${l?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${l?d.glsl`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:d.glsl`
          if(fragmentDepth ${c.cullAboveGround?"\x3e":"\x3c\x3d"} linearDepth){
            discard;
          }`}
    }`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./fov".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C){var E;a.Camera=E=class extends g{constructor(B={}){super(B);this._center=q.create();this._up=q.create();this._viewUp=q.create();this._viewForward=q.create();this._viewRight=q.create();this._ray=y.create();this._viewport=v.fromValues(0,0,1,1);this._padding=v.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=x.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=u.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=u.create();
this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=u.create();this._frustumDirty=!0;this._frustum=r.create();this._fullViewport=v.create();this._pixelRatio=1;this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(B){this._pixelRatio=0<B?B:1}get eye(){return this._ray.origin}set eye(B){this._compareAndSetView(B,this._ray.origin)}get center(){return this._center}set center(B){this._compareAndSetView(B,this._center,"_center")}get ray(){n.subtract(this._ray.direction,
this.center,this.eye);return this._ray}get up(){return this._up}set up(B){this._compareAndSetView(B,this._up,"_up")}get viewMatrix(){this._ensureViewClean();return this._viewMatrix}set viewMatrix(B){h.copy(this._viewMatrix,B);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}get viewForward(){this._ensureViewClean();return this._viewForward}get viewUp(){this._ensureViewClean();return this._viewUp}get viewRight(){this._ensureViewClean();return this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(B){this._nearFar[0]!==
B&&(this._nearFar[0]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(B){this._nearFar[1]!==B&&(this._nearFar[1]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(B){this.x=B[0];this.y=B[1];this.width=B[2];this.height=B[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const B=t.scale(v.create(),this._viewport,1/this.pixelRatio),
K=this._get("screenViewport");return K&&t.equals(B,K)?K:B}get screenPadding(){if(1===this.pixelRatio)return this._padding;const B=t.scale(v.create(),this._padding,1/this.pixelRatio),K=this._get("screenPadding");return K&&t.equals(B,K)?K:B}get x(){return this._viewport[0]}set x(B){B+=this._padding[a.PaddingSide.LEFT];this._viewport[0]!==B&&(this._viewport[0]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(B){B+=this._padding[a.PaddingSide.BOTTOM];
this._viewport[1]!==B&&(this._viewport[1]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(B){this._viewport[2]!==B&&(this._viewport[2]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(B){this._viewport[3]!==B&&(this._viewport[3]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+
this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]}set fullWidth(B){this.width=B-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]}set fullHeight(B){this.height=B-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}get fullViewport(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-
this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(B){t.exactEquals(this._padding,B)||(this._viewport[0]+=B[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=B[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],this._viewport[2]-=B[a.PaddingSide.RIGHT]+B[a.PaddingSide.LEFT]-(this._padding[a.PaddingSide.RIGHT]+
this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=B[a.PaddingSide.TOP]+B[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),t.copy(this._padding,B),this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){this._viewProjectionDirty&&(h.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}get projectionMatrix(){var B=
this.width,K=this.height;const L=this.near*Math.tan(this.fovY/2),J=L*this._aspect;B=h.frustum(u.create(),-J*(1+2*this._padding[a.PaddingSide.LEFT]/B),J*(1+2*this._padding[a.PaddingSide.RIGHT]/B),-L*(1+2*this._padding[a.PaddingSide.BOTTOM]/K),L*(1+2*this._padding[a.PaddingSide.TOP]/K),this.near,this.far);return(K=this._get("projectionMatrix"))&&h.equals(K,B)?K:B}get inverseProjectionMatrix(){return h.invert(u.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||u.create()}get fov(){return this._fov}set fov(B){this._fov=
B;this._frustumDirty=this._viewProjectionDirty=!0}get fovX(){return C.fovd2fovx(this._fov,this.width,this.height)}set fovX(B){this._fov=C.fovx2fovd(B,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get fovY(){return C.fovd2fovy(this._fov,this.width,this.height)}set fovY(B){this._fov=C.fovy2fovd(B,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get distance(){return n.distance(this.center,this.eye)}get frustum(){this._recomputeFrustum();return this._frustum}get viewInverseTransposeMatrix(){if(this._viewInverseTransposeMatrixDirty||
this._viewDirty)h.invert(this._viewInverseTransposeMatrix,this.viewMatrix),h.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}depthNDCToWorld(B){return 2*this.near*this.far/(this.far+this.near-(2*B-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=
this.relativeElevation&&0<=this.relativeElevation}copyFrom(B){n.copy(this._ray.origin,B.eye);this.center=B.center;this.up=B.up;t.copy(this._viewport,B.viewport);this.notifyChange("_viewport");t.copy(this._padding,B.padding);this.notifyChange("_padding");w.copy(this._nearFar,B.nearFar);this.notifyChange("_nearFar");this._fov=B.fov;this.relativeElevation=B.relativeElevation;this._viewDirty=B._viewDirty;this._viewDirty||(h.copy(this._viewMatrix,B.viewMatrix),n.copy(this._viewRight,B.viewRight),n.copy(this._viewUp,
B.viewUp),n.copy(this._viewForward,B.viewForward));this._viewProjectionDirty=!0;this._frustumDirty=B._frustumDirty;this._frustumDirty||(r.copy(this._frustum,B.frustum),this._frustumDirty=!1);B._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(h.copy(this._viewInverseTransposeMatrix,B.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);t.copy(this._fullViewport,B.fullViewport);this.pixelRatio=B.pixelRatio;return this}copyViewFrom(B){this.eye=B.eye;this.center=
B.center;this.up=B.up}clone(){return(new E).copyFrom(this)}equals(B){return n.exactEquals(this.eye,B.eye)&&n.exactEquals(this.center,B.center)&&n.exactEquals(this.up,B.up)&&t.exactEquals(this._viewport,B.viewport)&&t.exactEquals(this._padding,B.padding)&&w.exactEquals(this.nearFar,B.nearFar)&&this._fov===B.fov&&this.pixelRatio===B.pixelRatio&&this.relativeElevation===B.relativeElevation}almostEquals(B){var K=Math.max(1,1/this.pixelRatio,1/B.pixelRatio);if(.001<=Math.abs(B.fov-this._fov)||t.squaredDistance(B.screenPadding,
this.screenPadding)>=K||t.squaredDistance(this.screenViewport,B.screenViewport)>=K)return!1;n.sub(G,B.eye,B.center);n.sub(I,this.eye,this.center);K=n.dot(G,I);const L=n.sqrLen(G),J=n.sqrLen(I);return K*K>=(1-1E-10)*L*J&&n.sqrDist(B.eye,this.eye)<2.5E-7*Math.max(L,J)}computeRenderPixelSizeAt(B){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(B))}computeRenderPixelSizeAtDist(B){return B*this.perRenderPixelRatio}computeScreenPixelSizeAt(B){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(B))}_viewDirectionDistance(B){return Math.abs(z.projectPointSignedLength(this.viewForward,
n.subtract(G,B,this.eye)))}computeScreenPixelSizeAtDist(B){return B*this.perScreenPixelRatio}computeDistanceFromRadius(B,K){return B/Math.tan(Math.min(this.fovX,this.fovY)/(2*(K||1)))}getScreenCenter(B=m.createScreenPointArray()){B[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;B[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return B}getRenderCenter(B,K=.5,L=.5){B[0]=this.padding[a.PaddingSide.LEFT]+this.width*K;B[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*
L;B[2]=.5;return B}setGLViewport(B){const K=this.viewport,L=this.padding;B.setViewport(K[0]-L[3],K[1]-L[2],K[2]+L[1]+L[3],K[3]+L[0]+L[2])}applyProjection(B,K){B!==A&&n.copy(A,B);A[3]=1;t.transformMat4(A,A,this.projectionMatrix);B=Math.abs(A[3]);n.scale(A,A,1/B);const L=this.fullViewport;K[0]=k.lerp(0,L[0]+L[2],.5+.5*A[0]);K[1]=k.lerp(0,L[1]+L[3],.5+.5*A[1]);K[2]=.5*(A[2]+1);K[3]=B}unapplyProjection(B,K){const L=this.fullViewport;A[0]=(B[0]/(L[0]+L[2])*2-1)*B[3];A[1]=(B[1]/(L[1]+L[3])*2-1)*B[3];A[2]=
(2*B[2]-1)*B[3];A[3]=B[3];null!=this.inverseProjectionMatrix&&(t.transformMat4(A,A,this.inverseProjectionMatrix),K[0]=A[0],K[1]=A[1],K[2]=A[2])}projectToScreen(B,K){this.projectToRenderScreen(B,H);this.renderToScreen(H,K);return K}projectToRenderScreen(B,K){A[0]=B[0];A[1]=B[1];A[2]=B[2];A[3]=1;t.transformMat4(A,A,this.viewProjectionMatrix);if(0===A[3])return null;n.scale(A,A,1/Math.abs(A[3]));B=this.fullViewport;"x"in K?(K.x=k.lerp(0,B[0]+B[2],.5+.5*A[0]),K.y=k.lerp(0,B[1]+B[3],.5+.5*A[1])):(K[0]=
k.lerp(0,B[0]+B[2],.5+.5*A[0]),K[1]=k.lerp(0,B[1]+B[3],.5+.5*A[1]),2<K.length&&(K[2]=.5*(A[2]+1)));return K}unprojectFromScreen(B,K){return this.unprojectFromRenderScreen(this.screenToRender(B,H),K)}unprojectFromRenderScreen(B,K){h.multiply(F,this.projectionMatrix,this.viewMatrix);if(!h.invert(F,F))return null;const L=this.fullViewport;A[0]=2*(B[0]-L[0])/L[2]-1;A[1]=2*(B[1]-L[1])/L[3]-1;A[2]=2*B[2]-1;A[3]=1;t.transformMat4(A,A,F);if(0===A[3])return null;K[0]=A[0]/A[3];K[1]=A[1]/A[3];K[2]=A[2]/A[3];
return K}constrainWindowSize(B,K,L,J){B*=this.pixelRatio;K*=this.pixelRatio;return[Math.round(Math.max(B-L/2,0)),Math.round(Math.max(this.fullHeight-K-J/2,0)),Math.round(L- -Math.min(B-L/2,0)- -Math.min(this.fullWidth-B-L/2,0)),Math.round(J- -Math.min(this.fullHeight-K-J/2,0)- -Math.min(K-J/2,0))]}computeUp(B){B===D.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(B,K){const L=this.fullHeight-B[1]*this.pixelRatio;K[0]=B[0]*this.pixelRatio;K[1]=L;return K}renderToScreen(B,
K){const L=(this.fullHeight-B[1])/this.pixelRatio;K[0]=B[0]/this.pixelRatio;K[1]=L}_computeUpGlobal(){n.subtract(G,this.center,this.eye);const B=n.length(this.center);1>B?(n.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(n.dot(G,this.center))>.9999*n.length(G)*B||(n.cross(this._up,G,this.center),n.cross(this._up,this._up,G),n.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){n.direction(G,this.eye,this.center);.9999>=Math.abs(G[2])&&
(n.scale(G,G,G[2]),n.set(this._up,-G[0],-G[1],1-G[2]),n.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(B,K,L=""){"number"===typeof B[0]&&isFinite(B[0])&&"number"===typeof B[1]&&isFinite(B[1])&&"number"===typeof B[2]&&isFinite(B[2])?n.exactEquals(B,K)||(n.copy(K,B),this._markViewDirty(),L.length&&this.notifyChange(L)):d.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewProjectionDirty=
this._frustumDirty=this._viewDirty=!0}_recomputeFrustum(){this._frustumDirty&&(r.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(h.lookAt(this._viewMatrix,this.eye,this.center,this.up),n.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),n.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),n.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),
this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};b.__decorate([f.property()],a.Camera.prototype,"_center",void 0);b.__decorate([f.property()],a.Camera.prototype,"_up",void 0);b.__decorate([f.property()],a.Camera.prototype,"_viewport",void 0);b.__decorate([f.property()],a.Camera.prototype,"_padding",void 0);b.__decorate([f.property()],a.Camera.prototype,"_fov",void 0);b.__decorate([f.property()],a.Camera.prototype,"_nearFar",void 0);b.__decorate([f.property()],a.Camera.prototype,"_pixelRatio",
void 0);b.__decorate([f.property()],a.Camera.prototype,"pixelRatio",null);b.__decorate([f.property()],a.Camera.prototype,"eye",null);b.__decorate([f.property()],a.Camera.prototype,"center",null);b.__decorate([f.property()],a.Camera.prototype,"up",null);b.__decorate([f.property({readOnly:!0})],a.Camera.prototype,"nearFar",null);b.__decorate([f.property()],a.Camera.prototype,"near",null);b.__decorate([f.property()],a.Camera.prototype,"far",null);b.__decorate([f.property()],a.Camera.prototype,"viewport",
null);b.__decorate([f.property({readOnly:!0})],a.Camera.prototype,"screenViewport",null);b.__decorate([f.property({readOnly:!0})],a.Camera.prototype,"screenPadding",null);b.__decorate([f.property()],a.Camera.prototype,"x",null);b.__decorate([f.property()],a.Camera.prototype,"y",null);b.__decorate([f.property()],a.Camera.prototype,"width",null);b.__decorate([f.property()],a.Camera.prototype,"height",null);b.__decorate([f.property()],a.Camera.prototype,"fullWidth",null);b.__decorate([f.property()],
a.Camera.prototype,"fullHeight",null);b.__decorate([f.property({readOnly:!0})],a.Camera.prototype,"_aspect",null);b.__decorate([f.property()],a.Camera.prototype,"padding",null);b.__decorate([f.property({readOnly:!0})],a.Camera.prototype,"projectionMatrix",null);b.__decorate([f.property({readOnly:!0})],a.Camera.prototype,"inverseProjectionMatrix",null);b.__decorate([f.property()],a.Camera.prototype,"fov",null);b.__decorate([f.property()],a.Camera.prototype,"fovX",null);b.__decorate([f.property()],
a.Camera.prototype,"fovY",null);a.Camera=E=b.__decorate([p.subclass("esri.views.3d.webgl-engine.lib.Camera")],a.Camera);const A=v.create(),F=u.create(),G=q.create(),I=q.create(),H=m.createRenderScreenPointArray3();a.PaddingSide=void 0;(function(B){B[B.TOP=0]="TOP";B[B.RIGHT=1]="RIGHT";B[B.BOTTOM=2]="BOTTOM";B[B.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(){return[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()]}function h(t,v){l.fromPoints(v[a.PointIndex.FAR_BOTTOM_LEFT],v[a.PointIndex.NEAR_BOTTOM_LEFT],v[a.PointIndex.NEAR_TOP_LEFT],t[a.PlaneIndex.LEFT]);l.fromPoints(v[a.PointIndex.NEAR_BOTTOM_RIGHT],v[a.PointIndex.FAR_BOTTOM_RIGHT],v[a.PointIndex.FAR_TOP_RIGHT],t[a.PlaneIndex.RIGHT]);l.fromPoints(v[a.PointIndex.FAR_BOTTOM_LEFT],v[a.PointIndex.FAR_BOTTOM_RIGHT],v[a.PointIndex.NEAR_BOTTOM_RIGHT],
t[a.PlaneIndex.BOTTOM]);l.fromPoints(v[a.PointIndex.NEAR_TOP_LEFT],v[a.PointIndex.NEAR_TOP_RIGHT],v[a.PointIndex.FAR_TOP_RIGHT],t[a.PlaneIndex.TOP]);l.fromPoints(v[a.PointIndex.NEAR_BOTTOM_LEFT],v[a.PointIndex.NEAR_BOTTOM_RIGHT],v[a.PointIndex.NEAR_TOP_RIGHT],t[a.PlaneIndex.NEAR]);l.fromPoints(v[a.PointIndex.FAR_BOTTOM_RIGHT],v[a.PointIndex.FAR_BOTTOM_LEFT],v[a.PointIndex.FAR_TOP_LEFT],t[a.PlaneIndex.FAR])}function u(t,v){for(let r=0;6>r;r++)if(!l.clip(t[r],v))return!1;return!0}a.PlaneIndex=void 0;
(function(t){t[t.LEFT=0]="LEFT";t[t.RIGHT=1]="RIGHT";t[t.BOTTOM=2]="BOTTOM";t[t.TOP=3]="TOP";t[t.NEAR=4]="NEAR";t[t.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";t[t.FAR_TOP_LEFT=7]=
"FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const w={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,
a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]},x=[f.fromValues(-1,-1,-1,1),f.fromValues(1,-1,-1,1),f.fromValues(1,1,-1,1),f.fromValues(-1,1,-1,1),f.fromValues(-1,-1,1,1),f.fromValues(1,-1,1,1),f.fromValues(1,1,1,1),f.fromValues(-1,1,1,1)],n=new b.ObjectStack(c.create),q=p();a.NumPlanes=
6;a.NumPoints=8;a.computePlanes=h;a.copy=function(t,v){for(let r=0;6>r;r++)l.copy(t[r],v[r]);return t};a.create=function(t){return t?[l.create(t[0]),l.create(t[1]),l.create(t[2]),l.create(t[3]),l.create(t[4]),l.create(t[5])]:[l.create(),l.create(),l.create(),l.create(),l.create(),l.create()]};a.createPoints=p;a.fromMatrix=function(t,v,r,y=q){t=g.multiply(e.sm4d.get(),v,t);g.invert(t,t);for(v=0;8>v;++v){const z=m.transformMat4(e.sv4d.get(),x[v],t);d.set(y[v],z[0]/z[3],z[1]/z[3],z[2]/z[3])}h(r,y)};
a.intersectClipRay=function(t,v){for(let r=0;6>r;r++)if(!l.clipInfinite(t[r],v))return!1;return!0};a.intersectsLineSegment=function(t,v,r){return u(t,c.fromLineSegmentAndDirection(v,r,n.get()))};a.intersectsPoint=function(t,v){for(let r=0;6>r;r++)if(0<l.signedDistance(t[r],v))return!1;return!0};a.intersectsRay=function(t,v){return u(t,c.fromRay(v,n.get()))};a.intersectsSphere=function(t,v){for(let r=0;6>r;r++){const y=t[r];if(y[0]*v[0]+y[1]*v[1]+y[2]*v[2]+y[3]>=v[3])return!1}return!0};a.planePointIndices=
w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray"],function(a,b,g,d){function k(l){return l?{ray:d.create(l.ray),c0:l.c0,c1:l.c1}:{ray:d.create(),c0:0,c1:Number.MAX_VALUE}}function m(l,e,p,h=k()){d.copy(l,h.ray);h.c0=e;h.c1=p;return h}function f(l,e,p){return g.add(p,l.ray.origin,g.scale(p,l.ray.direction,e))}const c=new b.ObjectStack(()=>k());a.copy=function(l,e=k()){return m(l.ray,
l.c0,l.c1,e)};a.create=k;a.fromLineSegmentAndDirection=function(l,e,p=k()){const h=g.length(l.vector);d.fromValues(l.origin,e,p.ray);p.c0=0;p.c1=h;return p};a.fromRay=function(l,e=k()){d.copy(l,e.ray);e.c0=0;e.c1=Number.MAX_VALUE;return e};a.fromValues=m;a.getAt=f;a.getEnd=function(l,e){return f(l,l.c1,e)};a.getStart=function(l,e){return f(l,l.c0,e)};a.wrap=function(l,e,p){const h=c.get();h.ray=l;h.c0=e;h.c1=p;return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/fov":function(){define(["exports"],
function(a){a.fovd2fovx=function(b,g,d){return 2*Math.atan(g*Math.tan(.5*b)/Math.sqrt(g*g+d*d))};a.fovd2fovy=function(b,g,d){return 2*Math.atan(d*Math.tan(.5*b)/Math.sqrt(g*g+d*d))};a.fovx2fovd=function(b,g,d){return 2*Math.atan(Math.sqrt(g*g+d*d)*Math.tan(.5*b)/g)};a.fovy2fovd=function(b,g,d){return 2*Math.atan(Math.sqrt(g*g+d*d)*Math.tan(.5*b)/d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=
void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL";
b[b.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";b[b.ANTIALIASING=10]="ANTIALIASING";b[b.COMPOSITE=11]="COMPOSITE";b[b.BLIT=12]="BLIT";b[b.SSAO=13]="SSAO";b[b.HIGHLIGHT=14]="HIGHLIGHT";b[b.SHADOW_HIGHLIGHT=15]="SHADOW_HIGHLIGHT";b[b.ENVIRONMENT_OPAQUE=16]="ENVIRONMENT_OPAQUE";b[b.ENVIRONMENT_TRANSPARENT=17]="ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=18]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=19]="LASERLINES_CONTRAST_CONTROL";b[b.HUD_MATERIAL=20]="HUD_MATERIAL";b[b.LABEL_MATERIAL=21]="LABEL_MATERIAL";
b[b.LINE_CALLOUTS=22]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=23]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=24]="DRAPED_MATERIAL";b[b.DRAPED_WATER=25]="DRAPED_WATER";b[b.VOXEL=26]="VOXEL";b[b.MAX_SLOTS=27]="MAX_SLOTS";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(a){a.TransparencyPassType=void 0;var b=a.TransparencyPassType||(a.TransparencyPassType={});b[b.Color=0]="Color";b[b.Alpha=
1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,b,g,d,k,m){class f{constructor(){this.color=d.create();this.intensity=1}}class c{constructor(){this.direction=d.create();this.ambient=new f;this.diffuse=
new f}}class l{constructor(){this._shOrder=2;this._legacy=new c;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new k.SphericalHarmonicsAmbientLight;this._mainLight=new k.MainLight(d.create(),d.fromValues(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(p){m.combineLights(p,this._shOrder,this._mainLight,this._sphericalHarmonics);g.copy(this._legacy.direction,this._mainLight.direction);p=1/Math.PI;this._legacy.ambient.color[0]=
.282095*this._sphericalHarmonics.r[0]*p;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*p;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*p;g.scale(this._legacy.diffuse.color,this._mainLight.intensity,p);g.copy(e,this._legacy.diffuse.color);g.scale(e,e,.4*this.globalFactor);g.add(this._legacy.ambient.color,this._legacy.ambient.color,e)}copyFrom(p){this._sphericalHarmonics.r=Array.from(p.sh.r);this._sphericalHarmonics.g=Array.from(p.sh.g);this._sphericalHarmonics.b=
Array.from(p.sh.b);g.copy(this._mainLight.direction,p.mainLight.direction);g.copy(this._mainLight.intensity,p.mainLight.intensity);this._mainLight.castShadows=p.mainLight.castShadows;this._mainLight.specularStrength=p.mainLight.specularStrength;this._mainLight.environmentStrength=p.mainLight.environmentStrength;this.globalFactor=p.globalFactor;this.noonFactor=p.noonFactor}lerpLighting(p,h,u){g.lerp(this._mainLight.intensity,p.mainLight.intensity,h.mainLight.intensity,u);this._mainLight.environmentStrength=
b.lerp(p.mainLight.environmentStrength,h.mainLight.environmentStrength,u);this._mainLight.specularStrength=b.lerp(p.mainLight.specularStrength,h.mainLight.specularStrength,u);g.copy(this._mainLight.direction,h.mainLight.direction);this._mainLight.castShadows=h.mainLight.castShadows;this.globalFactor=b.lerp(p.globalFactor,h.globalFactor,u);this.noonFactor=b.lerp(p.noonFactor,h.noonFactor,u);if(p.sh.r.length===h.sh.r.length)for(let w=0;w<h.sh.r.length;w++)this._sphericalHarmonics.r[w]=b.lerp(p.sh.r[w],
h.sh.r[w],u),this._sphericalHarmonics.g[w]=b.lerp(p.sh.g[w],h.sh.g[w],u),this._sphericalHarmonics.b[w]=b.lerp(p.sh.b[w],h.sh.b[w],u);else for(p=0;p<h.sh.r.length;p++)this._sphericalHarmonics.r[p]=h.sh.r[p],this._sphericalHarmonics.g[p]=h.sh.g[p],this._sphericalHarmonics.b[p]=h.sh.b[p]}}const e=d.create();a.SceneLighting=l;a.ambientBoost=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],
function(a,b){class g{constructor(f=b.create()){this.intensity=f}}class d{constructor(f=b.create(),c=b.fromValues(.57735,.57735,.57735)){this.intensity=f;this.direction=c}}class k{constructor(f=b.create(),c=b.fromValues(.57735,.57735,.57735),l=!0,e=1,p=1){this.intensity=f;this.direction=c;this.castShadows=l;this.specularStrength=e;this.environmentStrength=p}}class m{constructor(){this.r=[0];this.g=[0];this.b=[0]}}a.AmbientLight=g;a.FillLight=d;a.MainLight=k;a.SphericalHarmonicsAmbientLight=m;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(a,b,g,d,k,m){function f(r){return(r+1)*(r+1)}function c(r){return b.clamp(Math.floor(Math.sqrt(r)-1),0,2)}function l(r,y,z){const D=r[0],C=r[1];r=r[2];z=z||[];z.length=f(y);0<=y&&(z[0]=.28209479177);1<=y&&(z[1]=.4886025119*D,z[2]=.4886025119*
r,z[3]=.4886025119*C);2<=y&&(z[4]=1.09254843059*D*C,z[5]=1.09254843059*C*r,z[6]=.31539156525*(3*r*r-1),z[7]=1.09254843059*D*r,z[8]=.54627421529*(D*D-C*C));return z}function e(r,y){r=f(r);y=y||{r:[],g:[],b:[]};y.r.length=y.g.length=y.b.length=r;for(let z=0;z<r;z++)y.r[z]=y.g[z]=y.b[z]=0;return y}function p(r,y){const z=c(y.r.length);for(const D of r)g.negate(t,D.direction),l(t,z,n),k.elementwiseProduct(n,v),k.scalarProduct(n,D.intensity[0],q),k.add(y.r,q),k.scalarProduct(n,D.intensity[1],q),k.add(y.g,
q),k.scalarProduct(n,D.intensity[2],q),k.add(y.b,q);return y}function h(r,y){l(t,0,n);for(const z of r)y.r[0]+=n[0]*v[0]*z.intensity[0]*4*Math.PI,y.g[0]+=n[0]*v[0]*z.intensity[1]*4*Math.PI,y.b[0]+=n[0]*v[0]*z.intensity[2]*4*Math.PI;return y}const u=[],w=[],x=[],n=[0],q=[0],t=d.create(),v=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(r,y,z,D){e(y,D);g.set(z.intensity,0,0,0);y=!1;u.length=0;w.length=0;x.length=0;for(const C of r)C instanceof m.MainLight&&
!y?(g.copy(z.direction,C.direction),g.copy(z.intensity,C.intensity),z.specularStrength=C.specularStrength,z.environmentStrength=C.environmentStrength,z.castShadows=C.castShadows,y=!0):C instanceof m.MainLight||C instanceof m.FillLight?u.push(C):C instanceof m.AmbientLight?w.push(C):C instanceof m.SphericalHarmonicsAmbientLight&&x.push(C);p(u,D);h(w,D);for(const C of x)k.add(D.r,C.r),k.add(D.g,C.g),k.add(D.b,C.b)};a.computeCoefficients=l;a.initSHCoefficients=e;a.numberOfCoefficients=f;a.orderFromNumberOfCoefficients=
c;a.projectAmbientLights=h;a.projectFillLights=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,g,d){d=d||b;d.length=b.length;for(let k=0;k<b.length;k++)d[k]=b[k]+g[k];return d};a.dotProduct=function(b,g){let d=0;for(let k=0;k<b.length;k++)d+=b[k]*g[k];return d};a.elementwiseProduct=function(b,g,d){d=d||b;d.length=b.length;for(let k=0;k<b.length;k++)d[k]=b[k]*g[k];return d};
a.scalarProduct=function(b,g,d){d=d||b;d.length=b.length;for(let k=0;k<b.length;k++)d[k]=b[k]*g;return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(A){return n.has(A)?n.get(A):"number"===typeof A?A:1}a.Task=void 0;(function(A){A[A.YIELD=1]="YIELD"})(a.Task||(a.Task={}));a.TaskPriority=void 0;(function(A){A.RESOURCE_CONTROLLER_IMMEDIATE="immediate";A.RESOURCE_CONTROLLER="schedule";A.SLIDE="slide";A.STREAM_DATA_LOADER="stream loader";A.ELEVATION_QUERY="elevation query";A.TERRAIN_SURFACE="terrain";A.SURFACE_GEOMETRY_UPDATES="surface geometry updates";A.LOD_RENDERER="LoD renderer";A.GRAPHICS_CORE=
"Graphics3D";A.I3S_CONTROLLER="I3S";A.POINT_CLOUD_LAYER="point cloud";A.FEATURE_TILE_FETCHER="feature fetcher";A.OVERLAY="overlay";A.STAGE="stage";A.GRAPHICS_DECONFLICTOR="graphics deconflictor";A.FILTER_VISIBILITY="Graphics3D filter visibility";A.SCALE_VISIBILITY="Graphics3D scale visibility";A.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";A.POINT_OF_INTEREST_FREQUENT="POI frequent";A.POINT_OF_INTEREST_INFREQUENT="POI infrequent";A.LABELER="labeler";A.FEATURE_QUERY_ENGINE="feature query";A.FEATURE_TILE_TREE=
"feature tile tree";A.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";A.ELEVATION_ALIGNMENT="elevation alignment";A.TEXT_TEXTURE_ATLAS="text texture atlas";A.TEXTURE_UNLOAD="texture unload";A.LINE_OF_SIGHT_TOOL="line of sight tool";A.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";A.ELEVATION_PROFILE="elevation profile";A.SNAPPING="snapping";A.SHADOW_ACCUMULATOR="shadow accumulator";A.CLOUDS_GENERATOR="clouds generator";A[A.NONE=0]="NONE";A[A.TEST_PRIO=1]="TEST_PRIO"})(a.TaskPriority||
(a.TaskPriority={}));const n=new Map([[a.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[a.TaskPriority.RESOURCE_CONTROLLER,4],[a.TaskPriority.SLIDE,0],[a.TaskPriority.STREAM_DATA_LOADER,0],[a.TaskPriority.ELEVATION_QUERY,0],[a.TaskPriority.TERRAIN_SURFACE,1],[a.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[a.TaskPriority.LOD_RENDERER,2],[a.TaskPriority.GRAPHICS_CORE,2],[a.TaskPriority.I3S_CONTROLLER,2],[a.TaskPriority.POINT_CLOUD_LAYER,2],[a.TaskPriority.FEATURE_TILE_FETCHER,2],[a.TaskPriority.OVERLAY,
4],[a.TaskPriority.STAGE,4],[a.TaskPriority.GRAPHICS_DECONFLICTOR,4],[a.TaskPriority.FILTER_VISIBILITY,4],[a.TaskPriority.SCALE_VISIBILITY,4],[a.TaskPriority.FRUSTUM_VISIBILITY,4],[a.TaskPriority.CLOUDS_GENERATOR,4],[a.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[a.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[a.TaskPriority.LABELER,8],[a.TaskPriority.FEATURE_QUERY_ENGINE,8],[a.TaskPriority.FEATURE_TILE_TREE,16],[a.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[a.TaskPriority.ELEVATION_ALIGNMENT,12],[a.TaskPriority.TEXT_TEXTURE_ATLAS,
12],[a.TaskPriority.TEXTURE_UNLOAD,12],[a.TaskPriority.LINE_OF_SIGHT_TOOL,16],[a.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[a.TaskPriority.SNAPPING,0],[a.TaskPriority.SHADOW_ACCUMULATOR,30]]),q=p.Milliseconds(6.5),t=p.Milliseconds(1),v=p.Milliseconds(30),r=p.Milliseconds(1E3/30),y=p.Milliseconds(100);var z;(function(A){class F{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(H=>H.needsUpdate)}constructor(){this._updating=e.signal(!0);this._microTaskQueued=
!1;this._frameNumber=0;this.performanceInfo={total:new m("total"),tasks:new Map};this._frameTaskTimes=new Map;this._budget=new I;this._state=w.RenderState.INTERACTING;this._tasks=new f;this._runQueue=new f;this._load=0;this._idleStateCallbacks=new f;this._debug=this._forceTask=this._idleUpdatesStartFired=!1;this._debugHandle=l.watch(()=>u.SCHEDULER_LOG_SLOW_TASKS,B=>this._debug=B,l.initial);for(const B of Object.keys(a.TaskPriority))this.performanceInfo.tasks.set(a.TaskPriority[B],new m(a.TaskPriority[B]));
const H=this;this._test={FRAME_SAFETY_BUDGET:q,INTERACTING_BUDGET:r,IDLE_BUDGET:y,get availableBudget(){return H._budget.budget},usedBudget:0,getBudget:()=>H._budget,setBudget:B=>H._budget=B,updateTask:B=>this._updateTask(B),getState:B=>this._getState(B),getRuntime:B=>this._getRuntime(B),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(H=>H.remove());this._tasks.clear();k.removeMaybe(this._debugHandle);
this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(H){this._updatingChanged();H&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(H,B){const K=x(H);B=new G(this,H,B,K);this._tasks.push(B);this._updatingChanged();this.performanceInfo.tasks.has(H)||this.performanceInfo.tasks.set(H,new m(H));return B}registerIdleStateCallbacks(H,
B){const K={idleBegin:H,idleEnd:B};this._idleStateCallbacks.push(K);this.state===w.RenderState.IDLE&&this._idleUpdatesStartFired&&K.idleBegin();const L=this;return{remove:()=>this._removeIdleStateCallbacks(K),set idleBegin(J){L._idleUpdatesStartFired&&(K.idleEnd(),L._state===w.RenderState.IDLE&&J());K.idleBegin=J},set idleEnd(J){K.idleEnd=J}}}get load(){return this._load}set state(H){this._state!==H&&(this._state=H,this.state!==w.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=
!1,this._idleStateCallbacks.forAll(B=>B.idleEnd())))}get state(){return this._state}updateBudget(H){this._test.usedBudget=0;++this._frameNumber;let B=q,K=H.frameDuration,L=t;switch(this.state){case w.RenderState.IDLE:B=p.Milliseconds(0);K=p.Milliseconds(Math.max(y,H.frameDuration));L=v;break;case w.RenderState.INTERACTING:K=p.Milliseconds(Math.max(r,H.frameDuration))}K=p.Milliseconds(K-H.elapsedFrameTime-B);if(this.state!==w.RenderState.IDLE&&K<t&&!this._forceTask)return this._forceTask=!0,!1;K=p.Milliseconds(Math.max(K,
L));this._budget.reset(K,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=this._forceTask=!1;switch(this.state){case w.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(H=>H.idleBegin()));this._runIdle();break;case w.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(p.Milliseconds(0),this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(H){this._idleUpdatesStartFired&&
H.idleEnd();this._idleStateCallbacks.removeUnordered(H)}removeTask(H){this._tasks.removeUnordered(H);this._runQueue.removeUnordered(H);this._updatingChanged()}_updateTask(H){this._tasks.forAll(B=>{B.name===H&&B.setPriority(H)})}_getState(H){if(this._runQueue.some(K=>K.name===H))return a.TaskState.SCHEDULED;let B=a.TaskState.IDLE;this._tasks.forAll(K=>{K.name===H&&K.needsUpdate&&(1>=K.schedulePriority?B=a.TaskState.READY:B!==a.TaskState.READY&&(B=a.TaskState.WAITING))});return B}_getRuntime(H){let B=
0;this._tasks.forAll(K=>{K.name===H&&(B+=K.runtime)});return B}_resetRuntimes(){this._tasks.forAll(H=>H.runtime=0)}_getRunning(){const H=new Map;this._tasks.forAll(K=>{K.needsUpdate&&H.set(K.name,(H.get(K.name)||0)+1)});if(0===H.size)return null;let B="";H.forEach((K,L)=>{B=1<K?B+` ${K}x ${L}`:B+` ${L}`});return B}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const H=this._tasks.reduce((B,K)=>K.needsUpdate?++B:B,0);this._load=.9*this._load+H*(1-.9)}_schedule(){this._runQueue.filterInPlace(H=>
{if(H.needsUpdate)return!0;H.schedulePriority=H.basePriority;return!1});for(this._tasks.forAll(H=>{0===H.basePriority&&H.needsUpdate&&!this._runQueue.includes(H)&&H.blockFrame!==this._frameNumber&&this._runQueue.unshift(H)});0===this._runQueue.length;){let H=!1;this._tasks.forAll(B=>{if(B.needsUpdate&&0!==B.schedulePriority&&0!==B.basePriority&&B.blockFrame!==this._frameNumber)switch(H=!0,B.schedulePriority){case 1:B.schedulePriority=0;this._runQueue.push(B);break;default:--B.schedulePriority}});
if(!H)return this._updatingChanged(),!1}this._updatingChanged();return!0}_run(){const H=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var B=this._budget.now();const K=this._runQueue.pop();this._budget.resetProgress();try{K.task.runTask(this._budget)===a.Task.YIELD&&(K.blockFrame=this._frameNumber)}catch(L){d.getLogger("esri.views.support.Scheduler").error(`Exception in task "${K.name}"`,L),K.blockFrame=this._frameNumber}!this._budget.hasProgressed&&K.blockFrame!==
this._frameNumber&&K.needsUpdate&&(K.blockFrame=this._frameNumber);K.schedulePriority=K.basePriority;B=this._budget.now()-B;K.runtime+=B;this._frameTaskTimes.set(K.priority,this._frameTaskTimes.get(K.priority)+B);this._debug&&B>2*this._budget.budget&&console.log("Task",K.name,"used",B,"of max",this._budget.budget,"ms");if(0>=this._budget.remaining){this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-H);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-
H)}_startFrameTaskTimes(){for(const H of Object.keys(a.TaskPriority))this._frameTaskTimes.set(a.TaskPriority[H],0)}_recordFrameTaskTimes(H){this._frameTaskTimes.forEach((B,K)=>this.performanceInfo.tasks.get(K).record(B));this.performanceInfo.total.record(H)}get test(){return this._test}}A.Scheduler=F;class G{get task(){return this._task.value}get updating(){return this._queue.running}constructor(H,B,K,L){this._scheduler=H;this.name=B;this._basePriority=L;this.runtime=this.blockFrame=0;this._queue=
new h.PromiseQueue;this._handles=new b;this.schedulePriority=this._basePriority;this._task=e.signal(null!=K?K:this._queue);this._handles.add(l.when(()=>this.task.running,J=>H.taskRunningChanged(J)))}remove(){this.processQueue(D);this._scheduler.removeTask(this);this.schedule=E.schedule;this.reschedule=E.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(H){this.name=H;H=x(H);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=H;this._basePriority=
H}get priority(){return this.name}set priority(H){this.setPriority(H)}get needsUpdate(){return this.updating||this.task.running}schedule(H,B,K){return this._queue.push(H,B,K)}reschedule(H,B,K){return this._queue.unshift(H,B,K)}processQueue(H){this._queue.runTask(H)}}class I{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=w.RenderState.IDLE;this._progressed=this._done=!1;this._enabled=!0}run(H){if(this.done)return!1;!0===H()&&this.madeProgress();
return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(H){this._enabled=H}reset(H,B){this._begin=this.now();this._budget=H;this._state=B;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._done=
this._progressed=!1}get hasProgressed(){return this._progressed}}A.Budget=I})(z||(z={}));a.TaskState=void 0;(function(A){A.SCHEDULED="s";A.READY="r";A.WAITING="w";A.IDLE="i"})(a.TaskState||(a.TaskState={}));const D=(()=>{const A=new z.Budget;A.enabled=!1;return A})();class C{remove(){}processQueue(){}schedule(A,F,G){try{if(c.isAborted(F)){const I=c.createAbortError();return G?Promise.resolve(G(I)):Promise.reject(I)}return c.when(A(D))}catch(I){return Promise.reject(I)}}reschedule(A,F,G){return this.schedule(A,
F,G)}}const E=new C;a.ImmediateTask=E;a.getTaskPriority=x;a.newScheduler=function(){return new z.Scheduler};a.noBudget=D;a.taskPriorities=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal"],function(a,b,g){class d{constructor(){this._tasks=[];this._running=g.signal(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(m){for(;!m.done&&
this._process(m);)m.madeProgress()}push(m,f,c){this._running.value=!0;return new Promise((l,e)=>this._tasks.push(new k(l,e,m,f,c)))}unshift(m,f,c){this._running.value=!0;return new Promise((l,e)=>this._tasks.unshift(new k(l,e,m,f,c)))}_process(m){if(0===this._tasks.length)return!1;const f=this._tasks.shift();try{const c=b.isAborted(f.signal);if(c&&!f.abortCallback)f.reject(b.createAbortError());else{const l=c?f.abortCallback?.(b.createAbortError()):f.callback(m);b.isPromiseLike(l)?l.then(f.resolve,
f.reject):f.resolve(l)}}catch(c){f.reject(c)}this._running.value=0<this._tasks.length;return!0}cancelAll(){const m=b.createAbortError();for(const f of this._tasks)if(f.abortCallback){const c=f.abortCallback(m);f.resolve(c)}else f.reject(m);this._tasks.length=0;this._running.value=!1}}class k{constructor(m,f,c,l,e){this.resolve=m;this.reject=f;this.callback=c;this.signal=l;this.abortCallback=e}}a.PromiseQueue=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f){b=class extends b{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=this.SCHEDULER_LOG_SLOW_TASKS=!1}};a.__decorate([g.property()],b.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);a.__decorate([g.property()],b.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);b=a.__decorate([f.subclass("esri.views.support.DebugFlags")],b);return new b})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/Fog.glsl ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){a.Fog=class extends g{constructor(D){super(D);this._passParameters=new w.FogPassParameters;this._vao=t.createQuadVAO(D.context.renderContext.rctx,q.Pos2Tex);this._technique=new x.FogTechnique(D);D=h.getReferenceEllipsoid(D.view.spatialReference);this._planetRadius=D.radius;this._atmosphereRadius=D.radius+u.atmosphereHeight}destroy(){this._technique.release();this._vao.dispose()}set strength(D){this._passParameters.fogStrength=D}get strength(){return this._passParameters.fogStrength}render(D,
C){this._update(D,C);if(!(0>=this._passParameters.fogAmount)){var E=this._technique;if(E.compiled){var A=D.offscreenRenderingHelper;A.renderDepthDetached(()=>{this._passParameters.depthTexture=A.depthTexture;const F=D.rctx.bindTechnique(E,this._passParameters,D.bindParameters);this._renderFog(F,D)})}else this.context.requestRender()}}_renderFog(D,C){C=C.rctx;C.bindVAO(this._vao);D.assertCompatibleVertexAttributeLocations(this._vao);C.drawArrays(v.PrimitiveType.TRIANGLE_STRIP,0,4)}_update(D,C){var E=
D.bindParameters.camera;e.normalize(y,E.eye);D=Math.max(0,e.dot(y,D.bindParameters.lighting.mainLight.direction));const A=C.color;e.scale(z,A,.1);e.lerp(this._passParameters.fogColor,z,A,D);E=e.length(E.eye);this._passParameters.atmosphereC=E*E-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.fogAmount=(1-d.smoothstep(.95*n.weatherHeightLimit,1*n.weatherHeightLimit,Math.abs(E-this._planetRadius)))*C.amount;this._passParameters.fogStrength=C.strength}static isSupported(D){return D.capabilities.depthTexture}};
b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"rctx",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"viewingMode",void 0);a.Fog=b.__decorate([l.subclass("esri.views.3d.environment.Fog")],a.Fog);class r{constructor(){this.color=p.create();this.amount=this.strength=0}}const y=p.create(),z=p.create();a.FogParameters=
r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Fog.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(){const v=new u.ShaderBuilder;v.attributes.add(x.VertexAttribute.POSITION,"vec2");v.include(k.TextureCoordinateAttribute,{textureCoordinateType:k.TextureCoordinateAttributeType.Default});v.varyings.add("worldRay","vec3");v.varyings.add("eyeDir","vec3");const {vertex:r,fragment:y}=v;r.uniforms.add(new h.Matrix4PassUniform("inverseProjectionMatrix",(z,D)=>D.camera.inverseProjectionMatrix),new h.Matrix4PassUniform("inverseViewMatrix",(z,D)=>b.invertOrIdentity(t,
D.camera.viewMatrix)));r.code.add(p.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);y.uniforms.add(new e.FloatPassUniform("atmosphereC",z=>z.atmosphereC),new l.Float3PassUniform("cameraPosition",(z,D)=>D.camera.eye),new c.Float2PassUniform("nearFar",(z,D)=>D.camera.nearFar),new w.Texture2DPassUniform("depthTexture",z=>z.depthTexture),new e.FloatPassUniform("fogStrength",z=>z.fogStrength),new e.FloatPassUniform("fogAmount",z=>z.fogAmount),new l.Float3PassUniform("fogColor",z=>z.fogColor));v.include(f.Gamma);y.include(m.ReadLinearDepth);y.code.add(p.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);y.code.add(p.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);y.code.add(p.glsl`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`);return v}class q extends p.NoParameters{constructor(){super(...arguments);this.fogColor=d.create();this.fogStrength=4E-6;this.atmosphereC=1;this.fogAmount=0}}const t=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:q,build:n},Symbol.toStringTag,{value:"Module"}));a.Fog=g;a.FogPassParameters=q;a.build=n})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends k.ShaderTechnique{constructor(h){super(h,new m.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(h){return new c.Program(h.rctx,p.shader.get().build(),f.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(l.BlendFactor.SRC_ALPHA,l.BlendFactor.ZERO,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams})}}p.shader=new d.ReloadableShaderModule(g.Fog,()=>new Promise((h,
u)=>a(["./Fog.glsl"],h,u)));b.FogTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/LocalAtmosphere":function(){define("exports ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ./AtmosphereType ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){class y{constructor(C,E){this.type=k.AtmosphereType.Local;this._configuration=new c.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new m.SimpleAtmospherePassParameters;this._configuration.geometry=c.SimpleAtmosphereGeometry.Cylinder;this._technique=E.techniqueRepository.acquire(f.SimpleAtmosphereTechnique,this._configuration);C=E.renderContext.rctx;this._vao=this._createVertexArrayObject(C);this._vaoCount=r.vertexCount(this._vao,"geometry");
E=new v.TextureDescriptor;E.wrapMode=q.TextureWrapMode.CLAMP_TO_EDGE;E.flipped=!0;E.width=1;E.height=512;this._passParameters.texture=new t.Texture(C,E,l.earthAtmosphereTextureSimple)}destroy(){this._passParameters.texture=b.disposeMaybe(this._passParameters.texture);this._vao.dispose();this._technique.release()}render(C){const E=C.rctx,A=E.bindTechnique(this._technique,this._passParameters,C.bindParameters);var F=z;g.copy(F,C.bindParameters.camera.viewMatrix);F[12]=0;F[13]=0;F[14]=0;F[15]=1;A.setUniformMatrix4fv("view",
z);E.bindVAO(this._vao);A.assertCompatibleVertexAttributeLocations(this._vao);E.drawArrays(q.PrimitiveType.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(C){var E=u.createPolySphereData(1,2,!1);const {data:A,indices:F}=E[0][1];E=D.createBuffer(F.length);const G=E.position;for(let I=0;I<F.length;++I){const H=3*F[0===I%3?I+2:2===I%3?I-2:I];G.set(I,0,A[H]);G.set(I,1,A[H+1]);G.set(I,2,A[H+2])}return new w.VertexArrayObject(C,h.Default3D,{geometry:e.glLayout(D)},{geometry:n.BufferObject.createVertex(C,
q.Usage.STATIC_DRAW,E.buffer)})}}const z=d.create(),D=p.newLayout().vec3f(x.VertexAttribute.POSITION);a.LocalAtmosphere=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ./vec2f64 ./vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(v){const r=new h.ShaderBuilder,{vertex:y,fragment:z}=r;m.addMainLightDirection(y);v.geometry===d.SimpleAtmosphereGeometry.Underground?(r.attributes.add(w.VertexAttribute.POSITION,"vec2"),r.varyings.add("color","vec4"),y.uniforms.add(new c.Float3PassUniform("cameraPosition",(D,C)=>C.camera.eye),new l.FloatPassUniform("undergroundFadeAlpha",D=>D.undergroundFadeAlpha)),y.code.add(e.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),z.code.add(e.glsl`void main() {
fragColor = color;
}`)):(r.include(k.Transform,v),r.attributes.add(w.VertexAttribute.POSITION,"vec3"),r.varyings.add("vtc","vec2"),r.varyings.add("falloff","float"),v=v.geometry===d.SimpleAtmosphereGeometry.Cylinder,y.uniforms.add(new p.Matrix4PassUniform("proj",(D,C)=>C.camera.projectionMatrix),new p.Matrix4PassUniform("view",(D,C)=>C.camera.viewMatrix)),v||(r.varyings.add("innerFactor","float"),y.uniforms.add(new c.Float3PassUniform("silCircleCenter",D=>D.silhouette.center)),y.uniforms.add(new c.Float3PassUniform("silCircleV1",
D=>D.silhouette.v1)),y.uniforms.add(new c.Float3PassUniform("silCircleV2",D=>D.silhouette.v2)),y.uniforms.add(new f.Float2PassUniform("texV",D=>D.texV)),y.uniforms.add(new l.FloatPassUniform("innerScale",D=>D.innerScale))),y.code.add(e.glsl`
		void main(void) {
      ${v?e.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:e.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${e.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${e.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),z.uniforms.add(new u.Texture2DPassUniform("tex",D=>D.texture)),v||z.uniforms.add(new l.FloatPassUniform("altitudeFade",D=>D.altitudeFade)),z.code.add(e.glsl`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${v?e.glsl`fragColor = atmosphereColor;`:e.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return r}class n extends e.NoParameters{constructor(){super(...arguments);this.texV=b.create();this.undergroundFadeAlpha=this.innerScale=this.altitudeFade=0;this.silhouette=new q}}class q{constructor(){this.center=g.create();this.v1=g.create();this.v2=g.create()}}const t=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:q,SimpleAtmospherePassParameters:n,build:x},Symbol.toStringTag,{value:"Module"}));a.SilhouetteCircle=q;a.SimpleAtmosphere=t;a.SimpleAtmospherePassParameters=
n;a.build=x})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(a,b,g,d){a.SimpleAtmosphereGeometry=void 0;(function(m){m[m.Cone=0]="Cone";m[m.Cylinder=1]="Cylinder";m[m.Underground=2]="Underground";m[m.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));class k extends d.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.geometry=a.SimpleAtmosphereGeometry.Cone}}b.__decorate([g.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],k.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,g,d,k){class m extends g.InstancedDoubleConfiguration{}b.__decorate([k.parameter({constValue:!0})],m.prototype,"hasSliceHighlight",void 0);b.__decorate([k.parameter({constValue:!1})],m.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([k.parameter({constValue:d.BindType.Pass})],m.prototype,"pbrTextureBindType",void 0);a.DefaultTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform ../../shaderTechnique/ShaderTechniqueConfiguration ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){class t extends x.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasModelTransformation=this.instancedDoublePrecision=!1}}b.__decorate([x.parameter()],t.prototype,"instancedDoublePrecision",void 0);b.__decorate([x.parameter()],t.prototype,"hasModelTransformation",void 0);class v extends h.NoParameters{constructor(){super(...arguments);this.modelTransformation=null}}const r=d.create(),y=f.create();a.InstancedDoubleConfiguration=t;a.InstancedDoublePassParameters=
v;a.InstancedDoublePrecision=function(z,D){const C=D.hasModelTransformation,E=D.instancedDoublePrecision;C&&(z.vertex.uniforms.add(new w.Matrix4PassUniform("model",A=>A.modelTransformation??k.IDENTITY)),z.vertex.uniforms.add(new u.Matrix3PassUniform("normalLocalOriginFromModel",A=>{g.normalFromMat4(r,A.modelTransformation??k.IDENTITY);return r})));D.instanced&&E&&(z.attributes.add(n.VertexAttribute.INSTANCEMODELORIGINHI,"vec3"),z.attributes.add(n.VertexAttribute.INSTANCEMODELORIGINLO,"vec3"),z.attributes.add(n.VertexAttribute.INSTANCEMODEL,
"mat3"),z.attributes.add(n.VertexAttribute.INSTANCEMODELNORMAL,"mat3"));z=z.vertex;E&&(z.include(l.DoublePrecision,D),z.uniforms.add(new p.Float3DrawUniform("viewOriginHi",(A,F)=>q.encodeDoubleHi(m.set(y,F.camera.viewInverseTransposeMatrix[3],F.camera.viewInverseTransposeMatrix[7],F.camera.viewInverseTransposeMatrix[11]),y)),new p.Float3DrawUniform("viewOriginLo",(A,F)=>q.encodeDoubleLo(m.set(y,F.camera.viewInverseTransposeMatrix[3],F.camera.viewInverseTransposeMatrix[7],F.camera.viewInverseTransposeMatrix[11]),
y))));z.code.add(h.glsl`
    vec3 getVertexInLocalOriginSpace() {
      return ${C?E?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":E?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${E?h.glsl`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);z.code.add(h.glsl`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${C?E?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":E?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `);D.output===c.ShaderOutput.Normal&&(e.addViewNormal(z),z.code.add(h.glsl`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${C?E?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":E?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `));D.hasVertexTangents&&z.code.add(h.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${C?E?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":E?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var b=a.ShaderOutput||(a.ShaderOutput={});b[b.Color=0]="Color";b[b.Depth=1]="Depth";b[b.Normal=2]="Normal";b[b.Shadow=3]="Shadow";b[b.ShadowHighlight=4]="ShadowHighlight";b[b.ShadowExcludeHighlight=5]="ShadowExcludeHighlight";b[b.Highlight=6]="Highlight";b[b.Alpha=7]="Alpha";b[b.ObjectAndLayerIdColor=8]=
"ObjectAndLayerIdColor";b[b.CompositeColor=9]="CompositeColor";b[b.COUNT=10]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DoublePrecision=function({code:g},d){d.doublePrecisionRequiresObfuscation?g.add(b.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):g.add(b.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../chunks/mat4 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),function(a,b,
g,d,k,m,f,c,l,e){const p=g.create(),h=k.create();a.addCameraPosition=function(u,w){w.instancedDoublePrecision?u.constants.add("cameraPosition","vec3",k.ZEROS):u.uniforms.add(new m.Float3DrawUniform("cameraPosition",(x,n)=>d.set(h,n.camera.viewInverseTransposeMatrix[3]-x.origin[0],n.camera.viewInverseTransposeMatrix[7]-x.origin[1],n.camera.viewInverseTransposeMatrix[11]-x.origin[2])))};a.addPixelRatio=function(u){u.uniforms.add(new c.FloatPassUniform("pixelRatio",(w,x)=>x.camera.pixelRatio/x.overlayStretch))};
a.addProjViewLocalOrigin=function(u,w){w.instancedDoublePrecision?u.uniforms.add(new e.Matrix4PassUniform("proj",(x,n)=>n.camera.projectionMatrix),new e.Matrix4PassUniform("view",(x,n)=>b.translate(p,n.camera.viewMatrix,d.set(h,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]))),new f.Float3PassUniform("localOrigin",(x,n)=>d.set(h,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]))):
u.uniforms.add(new e.Matrix4PassUniform("proj",(x,n)=>n.camera.projectionMatrix),new l.Matrix4DrawUniform("view",(x,n)=>b.translate(p,n.camera.viewMatrix,x.origin)),new m.Float3DrawUniform("localOrigin",x=>x.origin))};a.addViewNormal=function(u){u.uniforms.add(new e.Matrix4PassUniform("viewNormal",(w,x)=>x.camera.viewInverseTransposeMatrix))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"mat4",g.BindType.Draw,(f,c,l)=>f.setUniformMatrix4fv(k,m(c,l)))}}a.Matrix4DrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"mat3",g.BindType.Pass,(f,c,l)=>
f.setUniformMatrix3fv(k,m(c,l)))}}a.Matrix3PassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(g,d,k){for(let m=0;m<k;++m)d[m]=g[2*m]+g[2*m+1]};a.encodeDoubleArray=function(g,d,k){for(let m=0;m<k;++m)d[2*m]=g[m],d[2*m+1]=g[m]-d[2*m]};a.encodeDoubleHi=function(g,d){const k=g.length;for(let m=0;m<k;++m)b[0]=g[m],d[m]=b[0];return d};a.encodeDoubleLo=
function(g,d){const k=g.length;for(let m=0;m<k;++m)b[0]=g[m],b[1]=g[m]-b[0],d[m]=b[1];return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/interfaces"],function(a,b,g){a.Transform=function(d){b.addCalculateLinearDepth(d);d.vertex.code.add(g.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`);d.vertex.code.add(g.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,g,d,k){function m(l){l.varyings.add("linearDepth","float")}function f(l){l.vertex.uniforms.add(new d.Float2PassUniform("nearFar",(e,p)=>p.camera.nearFar))}function c(l){l.vertex.code.add(k.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}a.ForwardLinearDepth=function(l,e){const {vertex:p}=l;switch(e.output){case b.ShaderOutput.Color:if(e.receiveShadows){m(l);p.code.add(k.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case b.ShaderOutput.Depth:case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:l.include(g.VertexPosition,e);m(l);f(l);c(l);p.code.add(k.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}p.code.add(k.glsl`void forwardLinearDepth() {}`)};a.addCalculateLinearDepth=c;a.addLinearDepth=m;a.addNearFar=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){class u extends l.NoParameters{constructor(){super(...arguments);this.transformWorldFromViewTH=d.create();this.transformWorldFromViewTL=d.create();this.transformViewFromCameraRelativeRS=b.create();this.transformProjFromView=g.create()}}class w extends l.NoParameters{constructor(){super(...arguments);this.transformWorldFromModelRS=b.create();this.transformWorldFromModelTH=d.create();this.transformWorldFromModelTL=d.create()}}a.VertexPosition=function(x,n){x.include(k.PositionAttribute);
const q=x.vertex;q.include(m.DoublePrecision,n);x.varyings.add("vPositionWorldCameraRelative","vec3");x.varyings.add("vPosition_view","vec3");q.uniforms.add(new c.Float3PassUniform("transformWorldFromViewTH",t=>t.transformWorldFromViewTH),new c.Float3PassUniform("transformWorldFromViewTL",t=>t.transformWorldFromViewTL),new p.Matrix3PassUniform("transformViewFromCameraRelativeRS",t=>t.transformViewFromCameraRelativeRS),new h.Matrix4PassUniform("transformProjFromView",t=>t.transformProjFromView),new e.Matrix3DrawUniform("transformWorldFromModelRS",
t=>t.transformWorldFromModelRS),new f.Float3DrawUniform("transformWorldFromModelTH",t=>t.transformWorldFromModelTH),new f.Float3DrawUniform("transformWorldFromModelTL",t=>t.transformWorldFromModelTL));q.code.add(l.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);q.code.add(l.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${n.spherical?l.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:l.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);x.fragment.uniforms.add(new c.Float3PassUniform("transformWorldFromViewTL",t=>t.transformWorldFromViewTL));q.code.add(l.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);x.fragment.code.add(l.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=w;a.VertexPositionPassParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,g){a.PositionAttribute=function(d){d.attributes.add(g.VertexAttribute.POSITION,"vec3");d.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c,l,e){class p extends m.ShaderTechnique{initializeProgram(h){return new c.Program(h.rctx,
p.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return this.configuration.geometry===d.SimpleAtmosphereGeometry.Cylinder?e.makePipelineState({blending:e.separateBlendingParams(l.BlendFactor.SRC_ALPHA,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),culling:e.backFaceCullingParams,depthTest:{func:l.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(l.BlendFactor.SRC_ALPHA,
l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:l.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})}}p.shader=new k.ReloadableShaderModule(g.SimpleAtmosphere,()=>new Promise((h,u)=>a(["./SimpleAtmosphere.glsl"],h,u)));b.SimpleAtmosphereTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],function(a){const b=new Uint8ClampedArray([0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,
12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,
0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,
40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,
26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,
34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,
90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,
72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,
97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,
82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,
112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,
232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,
241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);a.earthAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,g){const d={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(k,
m=0){const f=k.stride;return Array.from(k.fields.keys()).map(c=>{const l=k.fields.get(c),e=l.constructor.ElementCount;var p=d[l.constructor.ElementType];if(!p)throw Error("BufferType not supported in WebGL");return new g.VertexElementDescriptor(c,e,p,l.offset,f,!(!l.optional||!l.optional.glNormalized),m)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types",
"../../webgl-engine/lib/Util"],function(a,b,g,d){class k{constructor(e,p){this.layout=e;this.buffer="number"===typeof p?new ArrayBuffer(p*e.stride):p;for(const h of e.fields.keys())p=e.fields.get(h),this[h]=new p.constructor(this.buffer,p.offset,this.stride)}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,p){return(e=this[e])&&e.elementCount===p.ElementCount&&e.elementType===p.ElementType?e:null}slice(e,
p){return new k(this.layout,this.buffer.slice(e*this.stride,p*this.stride))}copyFrom(e,p=0,h=0,u=e.count){const w=this.stride;0===w%4?(e=new Uint32Array(e.buffer,p*w,u*w/4),(new Uint32Array(this.buffer,h*w,u*w/4)).set(e)):(e=new Uint8Array(e.buffer,p*w,u*w),(new Uint8Array(this.buffer,h*w,u*w)).set(e));return this}get usedMemory(){return this.byteLength}dispose(){}}class m{constructor(e=null){this._lastAligned=this._stride=0;this._fields=new Map;e&&(this._stride=e.stride,e.fields.forEach(p=>this._fields.set(p[0],
{...p[1],constructor:l.get(p[1].constructor)})))}vec2f(e,p){this._appendField(e,b.BufferViewVec2f,p);return this}vec2f64(e,p){this._appendField(e,b.BufferViewVec2f64,p);return this}vec3f(e,p){this._appendField(e,b.BufferViewVec3f,p);return this}vec3f64(e,p){this._appendField(e,b.BufferViewVec3f64,p);return this}vec4f(e,p){this._appendField(e,b.BufferViewVec4f,p);return this}vec4f64(e,p){this._appendField(e,b.BufferViewVec4f64,p);return this}mat3f(e,p){this._appendField(e,b.BufferViewMat3f,p);return this}mat3f64(e,
p){this._appendField(e,b.BufferViewMat3f64,p);return this}mat4f(e,p){this._appendField(e,b.BufferViewMat4f,p);return this}mat4f64(e,p){this._appendField(e,b.BufferViewMat4f64,p);return this}vec4u8(e,p){this._appendField(e,b.BufferViewVec4u8,p);return this}f32(e,p){this._appendField(e,b.BufferViewFloat,p);return this}f64(e,p){this._appendField(e,b.BufferViewFloat64,p);return this}u8(e,p){this._appendField(e,b.BufferViewUint8,p);return this}u16(e,p){this._appendField(e,b.BufferViewUint16,p);return this}i8(e,
p){this._appendField(e,b.BufferViewInt8,p);return this}vec2i8(e,p){this._appendField(e,b.BufferViewVec2i8,p);return this}vec2i16(e,p){this._appendField(e,b.BufferViewVec2i16,p);return this}vec2u8(e,p){this._appendField(e,b.BufferViewVec2u8,p);return this}vec4u16(e,p){this._appendField(e,b.BufferViewVec4u16,p);return this}u32(e,p){this._appendField(e,b.BufferViewUint32,p);return this}_appendField(e,p,h){if(this._fields.has(e))d.assert(!1,`${e} already added to vertex buffer layout`);else{var u=p.ElementCount*
g.elementTypeSize(p.ElementType),w=this._stride;this._stride+=u;this._fields.set(e,{size:u,constructor:p,offset:w,optional:h})}}createBuffer(e){return new k(this,e)}createView(e){return new k(this,e)}clone(){const e=new m;e._stride=this._stride;e._fields=new Map;this._fields.forEach((p,h)=>e._fields.set(h,p));e.BufferType=this.BufferType;return e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(p=>e=Math.max(e,g.elementTypeSize(p.constructor.ElementType)));this._stride=
Math.floor((this._stride+e-1)/e)*e;this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}class f{constructor(e){this.fields=[];e.fields.forEach((p,h)=>{var u=p.constructor;this.fields.push([h,{...p,constructor:`${u.ElementType}_${u.ElementCount}`}])});this.stride=e.stride}}const c=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,b.BufferViewMat4f,b.BufferViewFloat64,b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,
b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,b.BufferViewVec4i16,b.BufferViewInt32,b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32],
l=new Map;c.forEach(e=>l.set(`${e.ElementType}_${e.ElementCount}`,e));a.InterleavedBuffer=k;a.InterleavedLayout=m;a.PackedLayout=f;a.newLayout=function(){return new m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,b,g,d,k,m,f){class c extends d.BufferViewScalarImpl{constructor(N,V=0,S,X){super(Float32Array,
N,V,S,X);this.elementType="f32"}static fromTypedArray(N,V){return new c(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}c.ElementType="f32";class l extends k.BufferViewVec2Impl{constructor(N,V=0,S,X){super(Float32Array,N,V,S,X);this.elementType="f32"}slice(N,V){return this.sliceBuffer(l,N,V)}static fromTypedArray(N,V){return new l(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}l.ElementType="f32";class e extends m.BufferViewVec3Impl{constructor(N,V=0,S,X){super(Float32Array,N,V,S,X);this.elementType=
"f32"}slice(N,V){return this.sliceBuffer(e,N,V)}static fromTypedArray(N,V){return new e(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}e.ElementType="f32";class p extends f.BufferViewVec4Impl{constructor(N,V=0,S,X){super(Float32Array,N,V,S,X);this.elementType="f32"}slice(N,V){return this.sliceBuffer(p,N,V)}static fromTypedArray(N,V){return new p(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}p.ElementType="f32";class h extends b.BufferViewMat3Impl{constructor(N,V=0,S,X){super(Float32Array,
N,V,S,X);this.elementType="f32"}slice(N,V){return this.sliceBuffer(h,N,V)}static fromTypedArray(N,V){return new h(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}h.ElementType="f32";class u extends b.BufferViewMat3Impl{constructor(N,V=0,S,X){super(Float64Array,N,V,S,X);this.elementType="f64"}slice(N,V){return this.sliceBuffer(u,N,V)}static fromTypedArray(N,V){return new u(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}u.ElementType="f64";class w extends g.BufferViewMat4Impl{constructor(N,
V=0,S,X){super(Float32Array,N,V,S,X);this.elementType="f32"}slice(N,V){return this.sliceBuffer(w,N,V)}static fromTypedArray(N,V){return new w(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}w.ElementType="f32";class x extends g.BufferViewMat4Impl{constructor(N,V=0,S,X){super(Float64Array,N,V,S,X);this.elementType="f64"}slice(N,V){return this.sliceBuffer(x,N,V)}static fromTypedArray(N,V){return new x(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}x.ElementType="f64";class n extends d.BufferViewScalarImpl{constructor(N,
V=0,S,X){super(Float64Array,N,V,S,X);this.elementType="f64"}slice(N,V){return this.sliceBuffer(n,N,V)}static fromTypedArray(N,V){return new n(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}n.ElementType="f64";class q extends k.BufferViewVec2Impl{constructor(N,V=0,S,X){super(Float64Array,N,V,S,X);this.elementType="f64"}slice(N,V){return this.sliceBuffer(q,N,V)}static fromTypedArray(N,V){return new q(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}q.ElementType="f64";class t extends m.BufferViewVec3Impl{constructor(N,
V=0,S,X){super(Float64Array,N,V,S,X);this.elementType="f64"}slice(N,V){return this.sliceBuffer(t,N,V)}static fromTypedArray(N,V){return new t(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}t.ElementType="f64";class v extends f.BufferViewVec4Impl{constructor(N,V=0,S,X){super(Float64Array,N,V,S,X);this.elementType="f64"}slice(N,V){return this.sliceBuffer(v,N,V)}static fromTypedArray(N,V){return new v(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}v.ElementType="f64";class r extends d.BufferViewScalarImpl{constructor(N,
V=0,S,X){super(Uint8Array,N,V,S,X);this.elementType="u8"}slice(N,V){return this.sliceBuffer(r,N,V)}static fromTypedArray(N,V){return new r(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}r.ElementType="u8";class y extends k.BufferViewVec2Impl{constructor(N,V=0,S,X){super(Uint8Array,N,V,S,X);this.elementType="u8"}slice(N,V){return this.sliceBuffer(y,N,V)}static fromTypedArray(N,V){return new y(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}y.ElementType="u8";class z extends m.BufferViewVec3Impl{constructor(N,
V=0,S,X){super(Uint8Array,N,V,S,X);this.elementType="u8"}slice(N,V){return this.sliceBuffer(z,N,V)}static fromTypedArray(N,V){return new z(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}z.ElementType="u8";class D extends f.BufferViewVec4Impl{constructor(N,V=0,S,X){super(Uint8Array,N,V,S,X);this.elementType="u8"}slice(N,V){return this.sliceBuffer(D,N,V)}static fromTypedArray(N,V){return new D(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}D.ElementType="u8";class C extends d.BufferViewScalarImpl{constructor(N,
V=0,S,X){super(Uint16Array,N,V,S,X);this.elementType="u16"}slice(N,V){return this.sliceBuffer(C,N,V)}static fromTypedArray(N,V){return new C(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}C.ElementType="u16";class E extends k.BufferViewVec2Impl{constructor(N,V=0,S,X){super(Uint16Array,N,V,S,X);this.elementType="u16"}slice(N,V){return this.sliceBuffer(E,N,V)}static fromTypedArray(N,V){return new E(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}E.ElementType="u16";class A extends m.BufferViewVec3Impl{constructor(N,
V=0,S,X){super(Uint16Array,N,V,S,X);this.elementType="u16"}slice(N,V){return this.sliceBuffer(A,N,V)}static fromTypedArray(N,V){return new A(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}A.ElementType="u16";class F extends f.BufferViewVec4Impl{constructor(N,V=0,S,X){super(Uint16Array,N,V,S,X);this.elementType="u16"}slice(N,V){return this.sliceBuffer(F,N,V)}static fromTypedArray(N,V){return new F(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}F.ElementType="u16";class G extends d.BufferViewScalarImpl{constructor(N,
V=0,S,X){super(Uint32Array,N,V,S,X);this.elementType="u32"}slice(N,V){return this.sliceBuffer(G,N,V)}static fromTypedArray(N,V){return new G(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}G.ElementType="u32";class I extends k.BufferViewVec2Impl{constructor(N,V=0,S,X){super(Uint32Array,N,V,S,X);this.elementType="u32"}slice(N,V){return this.sliceBuffer(I,N,V)}static fromTypedArray(N,V){return new I(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}I.ElementType="u32";class H extends m.BufferViewVec3Impl{constructor(N,
V=0,S,X){super(Uint32Array,N,V,S,X);this.elementType="u32"}slice(N,V){return this.sliceBuffer(H,N,V)}static fromTypedArray(N,V){return new H(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}H.ElementType="u32";class B extends f.BufferViewVec4Impl{constructor(N,V=0,S,X){super(Uint32Array,N,V,S,X);this.elementType="u32"}slice(N,V){return this.sliceBuffer(B,N,V)}static fromTypedArray(N,V){return new B(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}B.ElementType="u32";class K extends d.BufferViewScalarImpl{constructor(N,
V=0,S,X){super(Int8Array,N,V,S,X);this.elementType="i8"}slice(N,V){return this.sliceBuffer(K,N,V)}static fromTypedArray(N,V){return new K(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}K.ElementType="i8";class L extends k.BufferViewVec2Impl{constructor(N,V=0,S,X){super(Int8Array,N,V,S,X);this.elementType="i8"}slice(N,V){return this.sliceBuffer(L,N,V)}static fromTypedArray(N,V){return new L(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}L.ElementType="i8";class J extends m.BufferViewVec3Impl{constructor(N,
V=0,S,X){super(Int8Array,N,V,S,X);this.elementType="i8"}slice(N,V){return this.sliceBuffer(J,N,V)}static fromTypedArray(N,V){return new J(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}J.ElementType="i8";class M extends f.BufferViewVec4Impl{constructor(N,V=0,S,X){super(Int8Array,N,V,S,X);this.elementType="i8"}slice(N,V){return this.sliceBuffer(M,N,V)}static fromTypedArray(N,V){return new M(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}M.ElementType="i8";class T extends d.BufferViewScalarImpl{constructor(N,
V=0,S,X){super(Int16Array,N,V,S,X);this.elementType="i16"}slice(N,V){return this.sliceBuffer(T,N,V)}static fromTypedArray(N,V){return new T(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}T.ElementType="i16";class Q extends k.BufferViewVec2Impl{constructor(N,V=0,S,X){super(Int16Array,N,V,S,X);this.elementType="i16"}slice(N,V){return this.sliceBuffer(Q,N,V)}static fromTypedArray(N,V){return new Q(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}Q.ElementType="i16";class O extends m.BufferViewVec3Impl{constructor(N,
V=0,S,X){super(Int16Array,N,V,S,X);this.elementType="i16"}slice(N,V){return this.sliceBuffer(O,N,V)}static fromTypedArray(N,V){return new O(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}O.ElementType="i16";class U extends f.BufferViewVec4Impl{constructor(N,V=0,S,X){super(Int16Array,N,V,S,X);this.elementType="i16"}slice(N,V){return this.sliceBuffer(U,N,V)}static fromTypedArray(N,V){return new U(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}U.ElementType="i16";class Z extends d.BufferViewScalarImpl{constructor(N,
V=0,S,X){super(Int32Array,N,V,S,X);this.elementType="i32"}slice(N,V){return this.sliceBuffer(Z,N,V)}static fromTypedArray(N,V){return new Z(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}Z.ElementType="i32";class P extends k.BufferViewVec2Impl{constructor(N,V=0,S,X){super(Int32Array,N,V,S,X);this.elementType="i32"}slice(N,V){return this.sliceBuffer(P,N,V)}static fromTypedArray(N,V){return new P(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}P.ElementType="i32";class R extends m.BufferViewVec3Impl{constructor(N,
V=0,S,X){super(Int32Array,N,V,S,X);this.elementType="i32"}slice(N,V){return this.sliceBuffer(R,N,V)}static fromTypedArray(N,V){return new R(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}R.ElementType="i32";class W extends f.BufferViewVec4Impl{constructor(N,V=0,S,X){super(Int32Array,N,V,S,X);this.elementType="i32"}slice(N,V){return this.sliceBuffer(W,N,V)}static fromTypedArray(N,V){return new W(N.buffer,N.byteOffset,V,N.byteOffset+N.byteLength)}}W.ElementType="i32";a.BufferViewFloat=c;a.BufferViewFloat64=
n;a.BufferViewInt16=T;a.BufferViewInt32=Z;a.BufferViewInt8=K;a.BufferViewMat3f=h;a.BufferViewMat3f64=u;a.BufferViewMat4f=w;a.BufferViewMat4f64=x;a.BufferViewUint16=C;a.BufferViewUint32=G;a.BufferViewUint8=r;a.BufferViewVec2f=l;a.BufferViewVec2f64=q;a.BufferViewVec2i16=Q;a.BufferViewVec2i32=P;a.BufferViewVec2i8=L;a.BufferViewVec2u16=E;a.BufferViewVec2u32=I;a.BufferViewVec2u8=y;a.BufferViewVec3f=e;a.BufferViewVec3f64=t;a.BufferViewVec3i16=O;a.BufferViewVec3i32=R;a.BufferViewVec3i8=J;a.BufferViewVec3u16=
A;a.BufferViewVec3u32=H;a.BufferViewVec3u8=z;a.BufferViewVec4f=p;a.BufferViewVec4f64=v;a.BufferViewVec4i16=U;a.BufferViewVec4i32=W;a.BufferViewVec4i8=M;a.BufferViewVec4u16=F;a.BufferViewVec4u32=B;a.BufferViewVec4u8=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports"],function(a){class b{constructor(g,d,k=0,m,f){this.TypedArrayConstructor=g;this.elementCount=9;g=this.TypedArrayConstructor;void 0===m&&(m=9*g.BYTES_PER_ELEMENT);
const c=0===d.byteLength?0:k;this.typedBuffer=null==f?new g(d,c):new g(d,c,(f-k)/g.BYTES_PER_ELEMENT);this.typedBufferStride=m/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(g,d,k=this.count-d){d=this.typedBuffer.byteOffset+d*this.stride;return new g(this.buffer,d,this.stride,d+k*this.stride)}getMat(g,d){g*=this.typedBufferStride;for(let k=0;9>k;k++)d[k]=this.typedBuffer[g++];
return d}setMat(g,d){g*=this.typedBufferStride;for(let k=0;9>k;k++)this.typedBuffer[g++]=d[k]}get(g,d){return this.typedBuffer[g*this.typedBufferStride+d]}set(g,d,k){this.typedBuffer[g*this.typedBufferStride+d]=k}copyFrom(g,d,k){const m=this.typedBuffer,f=d.typedBuffer;g*=this.typedBufferStride;d=k*d.typedBufferStride;for(k=0;9>k;++k)m[g++]=f[d++]}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=9;a.BufferViewMat3Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports"],
function(a){class b{constructor(g,d,k=0,m,f){this.TypedArrayConstructor=g;this.elementCount=16;g=this.TypedArrayConstructor;void 0===m&&(m=16*g.BYTES_PER_ELEMENT);const c=0===d.byteLength?0:k;this.typedBuffer=null==f?new g(d,c):new g(d,c,(f-k)/g.BYTES_PER_ELEMENT);this.typedBufferStride=m/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(g,d,k=this.count-d){d=this.typedBuffer.byteOffset+
d*this.stride;return new g(this.buffer,d,this.stride,d+k*this.stride)}getMat(g,d){g*=this.typedBufferStride;for(let k=0;16>k;k++)d[k]=this.typedBuffer[g++];return d}setMat(g,d){g*=this.typedBufferStride;for(let k=0;16>k;k++)this.typedBuffer[g++]=d[k]}get(g,d){return this.typedBuffer[g*this.typedBufferStride+d]}set(g,d,k){this.typedBuffer[g*this.typedBufferStride+d]=k}copyFrom(g,d,k){const m=this.typedBuffer,f=d.typedBuffer;g*=this.typedBufferStride;d=k*d.typedBufferStride;for(k=0;16>k;++k)m[g++]=
f[d++]}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=16;a.BufferViewMat4Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports"],function(a){class b{constructor(g,d,k=0,m,f){this.TypedArrayConstructor=g;this.elementCount=1;g=this.TypedArrayConstructor;void 0===m&&(m=g.BYTES_PER_ELEMENT);const c=0===d.byteLength?0:k;this.typedBuffer=null==f?new g(d,c):new g(d,c,(f-k)/g.BYTES_PER_ELEMENT);this.stride=
m;this.typedBufferStride=m/g.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(g,d,k=this.count-d){d=this.typedBuffer.byteOffset+d*this.stride;return new g(this.buffer,d,this.stride,d+k*this.stride)}get(g){return this.typedBuffer[g*this.typedBufferStride]}set(g,d){this.typedBuffer[g*this.typedBufferStride]=d}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=1;a.BufferViewScalarImpl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/vec2"],function(a,b){class g{constructor(d,k,m=0,f,c){this.TypedArrayConstructor=d;this.elementCount=2;d=this.TypedArrayConstructor;void 0===f&&(f=2*d.BYTES_PER_ELEMENT);const l=0===k.byteLength?0:m;this.typedBuffer=null==c?new d(k,l):new d(k,l,(c-m)/d.BYTES_PER_ELEMENT);this.typedBufferStride=f/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*
this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(d,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new d(this.buffer,k,this.stride,k+m*this.stride)}getVec(d,k){d*=this.typedBufferStride;return b.set(k,this.typedBuffer[d],this.typedBuffer[d+1])}setVec(d,k){d*=this.typedBufferStride;this.typedBuffer[d++]=k[0];this.typedBuffer[d]=k[1]}get(d,k){return this.typedBuffer[d*this.typedBufferStride+k]}set(d,k,m){this.typedBuffer[d*this.typedBufferStride+k]=m}setValues(d,k,m){d*=
this.typedBufferStride;this.typedBuffer[d++]=k;this.typedBuffer[d]=m}copyFrom(d,k,m){const f=this.typedBuffer,c=k.typedBuffer;d*=this.typedBufferStride;k=m*k.typedBufferStride;f[d++]=c[k++];f[d]=c[k]}get buffer(){return this.typedBuffer.buffer}}g.ElementCount=2;a.BufferViewVec2Impl=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/vec3"],function(a,b){class g{constructor(d,k,m=0,f,c){this.TypedArrayConstructor=
d;this.elementCount=3;d=this.TypedArrayConstructor;void 0===f&&(f=3*d.BYTES_PER_ELEMENT);const l=0===k.byteLength?0:m;this.typedBuffer=null==c?new d(k,l):new d(k,l,(c-m)/d.BYTES_PER_ELEMENT);this.typedBufferStride=f/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(d,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new d(this.buffer,k,this.stride,k+
m*this.stride)}getVec(d,k){d*=this.typedBufferStride;return b.set(k,this.typedBuffer[d],this.typedBuffer[d+1],this.typedBuffer[d+2])}setVec(d,k){d*=this.typedBufferStride;this.typedBuffer[d++]=k[0];this.typedBuffer[d++]=k[1];this.typedBuffer[d]=k[2]}get(d,k){return this.typedBuffer[d*this.typedBufferStride+k]}set(d,k,m){this.typedBuffer[d*this.typedBufferStride+k]=m}setValues(d,k,m,f){d*=this.typedBufferStride;this.typedBuffer[d++]=k;this.typedBuffer[d++]=m;this.typedBuffer[d]=f}copyFrom(d,k,m){const f=
this.typedBuffer,c=k.typedBuffer;d*=this.typedBufferStride;k=m*k.typedBufferStride;f[d++]=c[k++];f[d++]=c[k++];f[d]=c[k]}get buffer(){return this.typedBuffer.buffer}}g.ElementCount=3;a.BufferViewVec3Impl=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/vec4"],function(a,b){class g{constructor(d,k,m=0,f,c){this.TypedArrayConstructor=d;this.start=m;this.elementCount=4;d=this.TypedArrayConstructor;
void 0===f&&(f=4*d.BYTES_PER_ELEMENT);const l=0===k.byteLength?0:m;this.typedBuffer=null==c?new d(k,l):new d(k,l,(c-m)/d.BYTES_PER_ELEMENT);this.typedBufferStride=f/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(d,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new d(this.buffer,k,this.stride,k+m*this.stride)}getVec(d,k){d*=this.typedBufferStride;
return b.set(k,this.typedBuffer[d++],this.typedBuffer[d++],this.typedBuffer[d++],this.typedBuffer[d])}setVec(d,k){d*=this.typedBufferStride;this.typedBuffer[d++]=k[0];this.typedBuffer[d++]=k[1];this.typedBuffer[d++]=k[2];this.typedBuffer[d]=k[3]}get(d,k){return this.typedBuffer[d*this.typedBufferStride+k]}set(d,k,m){this.typedBuffer[d*this.typedBufferStride+k]=m}setValues(d,k,m,f,c){d*=this.typedBufferStride;this.typedBuffer[d++]=k;this.typedBuffer[d++]=m;this.typedBuffer[d++]=f;this.typedBuffer[d]=
c}copyFrom(d,k,m){const f=this.typedBuffer,c=k.typedBuffer;d*=this.typedBufferStride;k=m*k.typedBufferStride;f[d++]=c[k++];f[d++]=c[k++];f[d++]=c[k++];f[d]=c[k]}get buffer(){return this.typedBuffer.buffer}}g.ElementCount=4;a.BufferViewVec4Impl=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(a){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;
case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;
case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./Geometry ./Util ./VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(V,S,X){function ca(na,Y){na>Y&&([na,Y]=[Y,na]);const ea=na.toString()+"."+Y.toString();if(ka[ea])return ka[ea];let fa=ba.length;ba.length+=3;r.add(ba,3*na,ba,3*Y,ba,fa);r.scale(ba,fa,V/r.length(ba,fa));fa/=3;return ka[ea]=fa}let ba;X?(ba=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],X=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(X=V*(1+Math.sqrt(5))/2,ba=[-V,X,0,V,X,0,-V,-X,0,V,-X,0,0,-V,X,0,V,X,0,-V,-X,0,V,-X,X,0,-V,X,0,V,-X,0,-V,-X,0,V],X=[0,
11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var ia=0;ia<ba.length;ia+=3)r.scale(ba,ia,V/r.length(ba,ia));let ka={};for(ia=0;ia<S;ia++){const na=X.length,Y=Array(4*na);for(let ea=0;ea<na;ea+=3){const fa=X[ea],aa=X[ea+1],da=X[ea+2],ma=ca(fa,aa),ua=ca(aa,da),sa=ca(da,fa),ra=4*ea;Y[ra]=fa;Y[ra+1]=ma;Y[ra+2]=sa;Y[ra+3]=aa;Y[ra+4]=ua;Y[ra+5]=ma;Y[ra+6]=da;Y[ra+7]=sa;Y[ra+8]=ua;Y[ra+9]=ma;Y[ra+10]=ua;Y[ra+11]=sa}X=
Y;ka={}}S=m.floatArrayFrom(ba);for(ia=0;ia<S.length;ia+=3)r.normalize(S,ia);return[[x.VertexAttribute.POSITION,new e.Attribute(m.floatArrayFrom(ba),X,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(S,X,3,!0)]]}function q(V,S,X,ca,ba,ia,ka=g.fromValues(0,0,0)){var na=S.length;const Y=m.newFloatArray(X.length*na*3+(6*ca.length||0)),ea=m.newFloatArray(X.length*na*3+(ca?6:0)),fa=[],aa=[];let da=0;var ma=0;const ua=g.create(),sa=g.create(),ra=g.create(),Aa=g.create(),qa=g.create(),la=g.create(),ja=g.create(),
oa=d.create(),za=g.create(),ta=g.create(),Ca=g.create(),Ga=g.create(),La=g.create(),Ma=c.create();b.set(za,0,1,0);b.subtract(sa,X[1],X[0]);b.normalize(sa,sa);ia?(b.add(oa,X[0],ka),b.normalize(ra,oa)):b.set(ra,0,0,1);v(sa,ra,za,za,qa,ra,.99619469809);b.copy(Aa,ra);b.copy(Ga,qa);for(var Ra=0;Ra<ca.length;Ra++)b.scale(la,qa,ca[Ra][0]),b.scale(oa,ra,ca[Ra][2]),b.add(la,la,oa),b.add(la,la,X[0]),Y[da++]=la[0],Y[da++]=la[1],Y[da++]=la[2];ea[ma++]=-sa[0];ea[ma++]=-sa[1];ea[ma++]=-sa[2];for(Ra=0;Ra<ba.length;Ra++)fa.push(0<
ba[Ra][0]?ba[Ra][0]:-ba[Ra][0]-1+ca.length),fa.push(0<ba[Ra][1]?ba[Ra][1]:-ba[Ra][1]-1+ca.length),fa.push(0<ba[Ra][2]?ba[Ra][2]:-ba[Ra][2]-1+ca.length),aa.push(0),aa.push(0),aa.push(0);Ra=ca.length;const Ya=ca.length-1;for(let Wa=0;Wa<X.length;Wa++){let cb=!1;0<Wa&&(b.copy(ua,sa),Wa<X.length-1?(b.subtract(sa,X[Wa+1],X[Wa]),b.normalize(sa,sa)):cb=!0,b.add(ta,ua,sa),b.normalize(ta,ta),b.add(Ca,X[Wa-1],Aa),c.fromPositionAndNormal(X[Wa],ta,Ma),c.intersectRay(Ma,l.wrap(Ca,ua),oa)?(b.subtract(oa,oa,X[Wa]),
b.normalize(ra,oa),b.cross(qa,ta,ra),b.normalize(qa,qa)):v(ta,Aa,Ga,za,qa,ra,.99619469809),b.copy(Aa,ra),b.copy(Ga,qa));ia&&(b.add(oa,X[Wa],ka),b.normalize(La,oa));for(let Na=0;Na<na;Na++)if(b.scale(la,qa,S[Na][0]),b.scale(oa,ra,S[Na][1]),b.add(la,la,oa),b.normalize(ja,la),ea[ma++]=ja[0],ea[ma++]=ja[1],ea[ma++]=ja[2],b.add(la,la,X[Wa]),Y[da++]=la[0],Y[da++]=la[1],Y[da++]=la[2],!cb){var ab=(Na+1)%na;fa.push(Ra+Na);fa.push(Ra+na+Na);fa.push(Ra+ab);fa.push(Ra+ab);fa.push(Ra+na+Na);fa.push(Ra+na+ab);
for(ab=0;6>ab;ab++)aa.push(fa[fa.length-6+ab]-Ya)}Ra+=na}S=X[X.length-1];for(X=0;X<ca.length;X++)b.scale(la,qa,ca[X][0]),b.scale(oa,ra,ca[X][1]),b.add(la,la,oa),b.add(la,la,S),Y[da++]=la[0],Y[da++]=la[1],Y[da++]=la[2];ca=ma/3;ea[ma++]=sa[0];ea[ma++]=sa[1];ea[ma++]=sa[2];na=Ra-na;for(ma=0;ma<ba.length;ma++)fa.push(0<=ba[ma][0]?Ra+ba[ma][0]:-ba[ma][0]-1+na),fa.push(0<=ba[ma][2]?Ra+ba[ma][2]:-ba[ma][2]-1+na),fa.push(0<=ba[ma][1]?Ra+ba[ma][1]:-ba[ma][1]-1+na),aa.push(ca),aa.push(ca),aa.push(ca);ba=[[x.VertexAttribute.POSITION,
new e.Attribute(Y,fa,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(ea,aa,3,!0)]];return new u.Geometry(V,ba)}function t(V,S,X,ca,ba){if(Math.abs(b.dot(S,V))>ba)return!1;b.cross(X,V,S);b.normalize(X,X);b.cross(ca,X,V);b.normalize(ca,ca);return!0}function v(V,S,X,ca,ba,ia,ka){return t(V,S,ba,ia,ka)||t(V,X,ba,ia,ka)||t(V,ca,ba,ia,ka)}const r=p.Vec3Compact,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],z=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,
-1],D=[0,0,1,0,1,1,0,1],C=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],E=Array(36);for(p=0;6>p;p++)for(var A=0;6>A;A++)E[6*p+A]=p;const F=Array(36);for(p=0;6>p;p++)F[6*p]=0,F[6*p+1]=1,F[6*p+2]=2,F[6*p+3]=2,F[6*p+4]=3,F[6*p+5]=0;const G=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],I=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],H=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],B=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];p=g.fromValues(-.5,
0,-.5);A=g.fromValues(.5,0,-.5);const K=g.fromValues(0,0,.5),L=g.fromValues(0,.5,0),J=g.create(),M=g.create(),T=g.create(),Q=g.create(),O=g.create();b.subtract(J,p,L);b.subtract(M,p,A);b.cross(T,J,M);b.normalize(T,T);b.subtract(J,A,L);b.subtract(M,A,K);b.cross(Q,J,M);b.normalize(Q,Q);b.subtract(J,K,L);b.subtract(M,K,p);b.cross(O,J,M);b.normalize(O,O);const U=[p,A,K,L],Z=[0,-1,0,T[0],T[1],T[2],Q[0],Q[1],Q[2],O[0],O[1],O[2]],P=[0,1,2,3,1,0,3,2,1,3,0,2],R=[0,0,0,1,1,1,2,2,2,3,3,3],W=[[-1,-1,0],[1,-1,
0],[1,1,0],[-1,1,0]],N=g.create();a.cgToGIS=function(V,S=V){var X=V.attributes;V=X.get(x.VertexAttribute.POSITION).data;if(X=X.get(x.VertexAttribute.NORMAL).data){var ca=S.getMutableAttribute(x.VertexAttribute.NORMAL).data;for(let ba=0;ba<X.length;ba+=3){const ia=X[ba+1];ca[ba+1]=-X[ba+2];ca[ba+2]=ia}}if(V)for(S=S.getMutableAttribute(x.VertexAttribute.POSITION).data,X=0;X<V.length;X+=3)ca=V[X+1],S[X+1]=-V[X+2],S[X+2]=ca};a.createBoxGeometry=function(V,S){Array.isArray(S)||(S=[S,S,S]);const X=Array(24);
for(let ca=0;8>ca;ca++)X[3*ca]=y[ca][0]*S[0],X[3*ca+1]=y[ca][1]*S[1],X[3*ca+2]=y[ca][2]*S[2];return new u.Geometry(V,[[x.VertexAttribute.POSITION,new e.Attribute(X,C,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(z,E,3)],[x.VertexAttribute.UV0,new e.Attribute(D,F,2)]])};a.createConeGeometry=function(V,S,X,ca,ba,ia=!0,ka=!0){let na=0;var Y=g.fromValues(0,na,0),ea=g.fromValues(0,na+S,0),fa=g.fromValues(0,-1,0),aa=g.fromValues(0,1,0);ba&&(na=S,ea=g.fromValues(0,0,0),Y=g.fromValues(0,na,0),fa=g.fromValues(0,
1,0),aa=g.fromValues(0,-1,0));Y=[ea,Y];fa=[fa,aa];aa=ca+2;ea=Math.sqrt(S*S+X*X);if(ba)for(ba=ca-1;0<=ba;ba--){var da=2*Math.PI/ca*ba,ma=g.fromValues(Math.cos(da)*X,na,Math.sin(da)*X);Y.push(ma);da=g.fromValues(S*Math.cos(da)/ea,-X/ea,S*Math.sin(da)/ea);fa.push(da)}else for(ba=0;ba<ca;ba++)da=2*Math.PI/ca*ba,ma=g.fromValues(Math.cos(da)*X,na,Math.sin(da)*X),Y.push(ma),da=g.fromValues(S*Math.cos(da)/ea,X/ea,S*Math.sin(da)/ea),fa.push(da);S=[];X=[];if(ia){for(ia=3;ia<Y.length;ia++)S.push(1),S.push(ia-
1),S.push(ia),X.push(0),X.push(0),X.push(0);S.push(Y.length-1);S.push(2);S.push(1);X.push(0);X.push(0);X.push(0)}if(ka){for(ka=3;ka<Y.length;ka++)S.push(ka),S.push(ka-1),S.push(0),X.push(ka),X.push(ka-1),X.push(1);S.push(0);S.push(2);S.push(Y.length-1);X.push(1);X.push(2);X.push(fa.length-1)}ka=m.newFloatArray(3*aa);for(ia=0;ia<aa;ia++)ka[3*ia]=Y[ia][0],ka[3*ia+1]=Y[ia][1],ka[3*ia+2]=Y[ia][2];Y=m.newFloatArray(3*aa);for(ia=0;ia<aa;ia++)Y[3*ia]=fa[ia][0],Y[3*ia+1]=fa[ia][1],Y[3*ia+2]=fa[ia][2];Y=[[x.VertexAttribute.POSITION,
new e.Attribute(ka,S,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(Y,X,3,!0)]];return new u.Geometry(V,Y)};a.createCylinderGeometry=function(V,S,X,ca,ba,ia,ka){ba=ba?g.clone(ba):g.fromValues(1,0,0);ia=ia?g.clone(ia):g.fromValues(0,0,0);ka??(ka=!0);var na=g.create();b.normalize(na,ba);var Y=g.create();b.scale(Y,na,Math.abs(S));var ea=g.create();b.scale(ea,Y,-.5);b.add(ea,ea,ia);const fa=g.fromValues(0,1,0);.2>Math.abs(1-b.dot(na,fa))&&b.set(fa,0,0,1);const aa=g.create();b.cross(aa,na,fa);b.normalize(aa,
aa);b.cross(fa,aa,na);S=2*ca+(ka?2:0);ia=ca+(ka?2:0);ba=m.newFloatArray(3*S);const da=m.newFloatArray(3*ia),ma=m.newFloatArray(2*S),ua=Array(3*ca*(ka?4:2)),sa=Array(3*ca*(ka?4:2));ka&&(ba[3*(S-2)]=ea[0],ba[3*(S-2)+1]=ea[1],ba[3*(S-2)+2]=ea[2],ma[2*(S-2)]=0,ma[2*(S-2)+1]=0,ba[3*(S-1)]=ba[3*(S-2)]+Y[0],ba[3*(S-1)+1]=ba[3*(S-2)+1]+Y[1],ba[3*(S-1)+2]=ba[3*(S-2)+2]+Y[2],ma[2*(S-1)]=1,ma[2*(S-1)+1]=1,da[3*(ia-2)]=-na[0],da[3*(ia-2)+1]=-na[1],da[3*(ia-2)+2]=-na[2],da[3*(ia-1)]=na[0],da[3*(ia-1)+1]=na[1],
da[3*(ia-1)+2]=na[2]);na=0;const ra=g.create(),Aa=g.create();for(let oa=0;oa<ca;oa++){var qa=2*Math.PI/ca*oa;b.scale(ra,fa,Math.sin(qa));b.scale(Aa,aa,Math.cos(qa));b.add(ra,ra,Aa);da[3*oa]=ra[0];da[3*oa+1]=ra[1];da[3*oa+2]=ra[2];b.scale(ra,ra,X);b.add(ra,ra,ea);ba[3*oa]=ra[0];ba[3*oa+1]=ra[1];ba[3*oa+2]=ra[2];ma[2*oa]=oa/ca;ma[2*oa+1]=0;ba[3*(oa+ca)]=ba[3*oa]+Y[0];ba[3*(oa+ca)+1]=ba[3*oa+1]+Y[1];ba[3*(oa+ca)+2]=ba[3*oa+2]+Y[2];ma[2*(oa+ca)]=oa/ca;ma[2*oa+1]=1;qa=(oa+1)%ca;var la=na++,ja=oa;ua[la]=
oa;sa[la]=ja;la=na++;ja=oa;ua[la]=oa+ca;sa[la]=ja;la=na++;ja=qa;ua[la]=qa;sa[la]=ja;la=na++;ja=qa;ua[la]=qa;sa[la]=ja;la=na++;ja=oa;ua[la]=oa+ca;sa[la]=ja;la=na++;ja=qa;ua[la]=qa+ca;sa[la]=ja}if(ka){for(X=0;X<ca;X++)ka=(X+1)%ca,Y=na++,ea=ia-2,ua[Y]=S-2,sa[Y]=ea,Y=na++,ea=ia-2,ua[Y]=X,sa[Y]=ea,Y=na++,ea=ia-2,ua[Y]=ka,sa[Y]=ea;for(X=0;X<ca;X++)ka=(X+1)%ca,Y=na++,ea=ia-1,ua[Y]=X+ca,sa[Y]=ea,Y=na++,ea=ia-1,ua[Y]=S-1,sa[Y]=ea,Y=na++,ea=ia-1,ua[Y]=ka+ca,sa[Y]=ea}ca=[[x.VertexAttribute.POSITION,new e.Attribute(ba,
ua,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(da,sa,3,!0)],[x.VertexAttribute.UV0,new e.Attribute(ma,ua,2,!0)]];return new u.Geometry(V,ca)};a.createDiamondGeometry=function(V,S){Array.isArray(S)||(S=[S,S,S]);const X=Array(18);for(let ca=0;6>ca;ca++)X[3*ca]=G[ca][0]*S[0],X[3*ca+1]=G[ca][1]*S[1],X[3*ca+2]=G[ca][2]*S[2];return new u.Geometry(V,[[x.VertexAttribute.POSITION,new e.Attribute(X,H,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(I,B,3)]])};a.createExtrudedTriangle=function(V,S,X,ca,
ba,ia=0){const ka=Array(18);S=[[-X,ia,ba/2],[ca,ia,ba/2],[0,S+ia,ba/2],[-X,ia,-ba/2],[ca,ia,-ba/2],[0,S+ia,-ba/2]];for(X=0;6>X;X++)ka[3*X]=S[X][0],ka[3*X+1]=S[X][1],ka[3*X+2]=S[X][2];return new u.Geometry(V,[[x.VertexAttribute.POSITION,new e.Attribute(ka,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])};a.createPathExtrusionGeometry=q;a.createPointGeometry=function(V,S,X,ca,ba,ia,ka,na,Y=null){X=X?[X[0],X[1],X[2]]:[0,0,0];S=S?[S[0],S[1],S[2]]:[0,0,1];ka=ka||[0,0];ca=ca?[255*ca[0],255*ca[1],
255*ca[2],3<ca.length?255*ca[3]:255]:[255,255,255,255];const ea=null!=ba&&2===ba.length?ba:[1,1];ba=f.getZeroIndexArray(1);ka=[[x.VertexAttribute.POSITION,new e.Attribute(X,ba,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(S,ba,3,!0)],[x.VertexAttribute.UV0,new e.Attribute(ka,ba,ka.length)],[x.VertexAttribute.COLOR,new e.Attribute(ca,ba,4,!0)],[x.VertexAttribute.SIZE,new e.Attribute(ea,ba,2)]];null!=ia&&ka.push([x.VertexAttribute.AUXPOS1,new e.Attribute([ia[0],ia[1],ia[2],ia[3]],ba,4)]);null!=na&&
ka.push([x.VertexAttribute.FEATUREATTRIBUTE,new e.Attribute([na[0],na[1],na[2],na[3]],ba,4)]);return new u.Geometry(V,ka,null,h.ContentObjectType.Point,Y)};a.createPolySphereData=n;a.createPolySphereGeometry=function(V,S,X,ca){S=n(S,X,ca);return new u.Geometry(V,S)};a.createPolylineGeometry=function(V,S,X,ca){w.assert(1<S.length,"createPolylineGeometry(): polyline needs at least 2 points");w.assert(3===S[0].length,"createPolylineGeometry(): malformed vertex");w.assert(null==X||X.length===S.length,
"createPolylineGeometry: need same number of points and normals");w.assert(null==X||3===X[0].length,"createPolylineGeometry(): malformed normal");var ba=k.newDoubleArray(3*S.length);const ia=Array(2*(S.length-1));var ka=0,na=0;for(var Y=0;Y<S.length;Y++){for(var ea=0;3>ea;ea++)ba[ka++]=S[Y][ea];0<Y&&(ia[na++]=Y-1,ia[na++]=Y)}ba=[[x.VertexAttribute.POSITION,new e.Attribute(ba,ia,3,!0)]];if(X){ka=m.newFloatArray(3*X.length);na=0;for(Y=0;Y<S.length;Y++)for(ea=0;3>ea;ea++)ka[na++]=X[Y][ea];ba.push([x.VertexAttribute.NORMAL,
new e.Attribute(ka,ia,3,!0)])}ca&&ba.push([x.VertexAttribute.COLOR,new e.Attribute(ca,f.getContinuousIndexArray(ca.length/4),4)]);return new u.Geometry(V,ba,null,h.ContentObjectType.Line)};a.createSphereGeometry=function(V,S,X,ca,ba={uv:!0}){var ia=-Math.PI,ka=2*Math.PI,na=-Math.PI/2,Y=Math.PI;X=Math.max(3,Math.floor(X));ca=Math.max(2,Math.floor(ca));var ea=(X+1)*(ca+1);const fa=m.newFloatArray(3*ea),aa=m.newFloatArray(3*ea);ea=m.newFloatArray(2*ea);const da=[];var ma=0;for(var ua=0;ua<=ca;ua++){const ra=
[],Aa=ua/ca,qa=na+Aa*Y,la=Math.cos(qa);for(let ja=0;ja<=X;ja++){const oa=ja/X;var sa=ia+oa*ka;const za=Math.cos(sa)*la,ta=Math.sin(qa);sa=-Math.sin(sa)*la;fa[3*ma]=za*S;fa[3*ma+1]=ta*S;fa[3*ma+2]=sa*S;aa[3*ma]=za;aa[3*ma+1]=ta;aa[3*ma+2]=sa;ea[2*ma]=oa;ea[2*ma+1]=Aa;ra.push(ma);++ma}da.push(ra)}S=[];for(ia=0;ia<ca;ia++)for(ka=0;ka<X;ka++)na=da[ia][ka],Y=da[ia][ka+1],ma=da[ia+1][ka+1],ua=da[ia+1][ka],0===ia?(S.push(na),S.push(ma),S.push(ua)):ia===ca-1?(S.push(na),S.push(Y),S.push(ma)):(S.push(na),
S.push(Y),S.push(ma),S.push(ma),S.push(ua),S.push(na));X=[[x.VertexAttribute.POSITION,new e.Attribute(fa,S,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(aa,S,3,!0)]];ba.uv&&X.push([x.VertexAttribute.UV0,new e.Attribute(ea,S,2,!0)]);ba.offset&&(X[0][0]=x.VertexAttribute.OFFSET,X.push([x.VertexAttribute.POSITION,new e.Attribute(Float64Array.from(ba.offset),f.getZeroIndexArray(S.length),3,!0)]));return new u.Geometry(V,X)};a.createSquareGeometry=function(V,S=W){var X=Array(12);for(var ca=0;4>ca;ca++)for(let ba=
0;3>ba;ba++)X[3*ca+ba]=S[ca][ba];S=[0,1,2,2,3,0];ca=[0,0,0,0,0,0];X=[[x.VertexAttribute.POSITION,new e.Attribute(X,S,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute([0,0,1],ca,3,!0)],[x.VertexAttribute.UV0,new e.Attribute([0,0,1,0,1,1,0,1],S,2,!0)],[x.VertexAttribute.COLOR,new e.Attribute([255,255,255,255],ca,4,!0)]];return new u.Geometry(V,X)};a.createTetrahedronGeometry=function(V,S){Array.isArray(S)||(S=[S,S,S]);const X=Array(12);for(let ca=0;4>ca;ca++)X[3*ca]=U[ca][0]*S[0],X[3*ca+1]=U[ca][1]*
S[1],X[3*ca+2]=U[ca][2]*S[2];return new u.Geometry(V,[[x.VertexAttribute.POSITION,new e.Attribute(X,P,3,!0)],[x.VertexAttribute.NORMAL,new e.Attribute(Z,R,3)]])};a.createTubeGeometry=function(V,S,X,ca,ba,ia){ca=ca||10;ba=null!=ba?ba:!0;w.assert(1<S.length);const ka=[],na=[];for(let Y=0;Y<ca;Y++){ka.push([0,-Y-1,-((Y+1)%ca)-1]);const ea=Y/ca*2*Math.PI;na.push([Math.cos(ea)*X,Math.sin(ea)*X])}return q(V,na,S,[[0,0,0]],ka,ba,ia)};a.makeOrthoBasisDirUpFallback=v;a.transformInPlace=function(V,S){V=V.getMutableAttribute(x.VertexAttribute.POSITION).data;
for(let X=0;X<V.length;X+=3)b.set(N,V[X],V[X+1],V[X+2]),b.transformMat4(N,N,S),V[X]=N[0],V[X+1]=N[1],V[X+2]=N[2]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.copyInto=function(g,d){for(let k=0;k<d.length;++k)g[k]=d[k];return g};a.doubleArrayFrom=function(g){return(b.isArray(g)?g.length:g.byteLength/8)<=b.nativeArrayMaxSize?Array.from(g):new Float64Array(g)};a.doubleSubArray=
function(g,d,k){return Array.isArray(g)?g.slice(d,d+k):g.subarray(d,d+k)};a.newDoubleArray=function(g,d=!1){return g<=b.nativeArrayMaxSize?d?Array(g).fill(0):Array(g):new Float64Array(g)};a.toFloat64Array=function(g){return Array.isArray(g)?new Float64Array(g):g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/FloatArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.compactFloatArray=function(g){return b.isArray(g)?g.length<b.nativeArrayMaxSize?
g:new Float32Array(g):g.length<b.nativeArrayMaxSize?Array.from(g):g};a.floatArrayFrom=function(g){return(b.isArray(g)?g.length:g.byteLength/8)<=b.nativeArrayMaxSize?Array.from(g):new Float32Array(g)};a.floatSubArray=function(g,d,k){return Array.isArray(g)?g.slice(d,d+k):g.subarray(d,d+k)};a.newFloatArray=function(g,d=!1){return g<=b.nativeArrayMaxSize?d?Array(g).fill(0):Array(g):new Float32Array(g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Indices":function(){define(["exports",
"../../core/typedArrayUtil"],function(a,b){function g(e){let p=!0;for(const h of e){if(65536<=h)return b.isArray(e)?new Uint32Array(e):e;256<=h&&(p=!1)}return p?new Uint8Array(e):new Uint16Array(e)}function d(e){if(1===e)return f;if(e<b.nativeArrayMaxSize)return Array.from(new Uint16Array(c.buffer,0,e));if(e<c.length)return new Uint16Array(c.buffer,0,e);if(e>m.length){m=new Uint32Array(Math.max(2*m.length,e));for(let p=0;p<m.length;p++)m[p]=p}return new Uint32Array(m.buffer,0,e)}function k(e){if(1===
e)return f;if(e<b.nativeArrayMaxSize)return Array(e).fill(0);e>l.length&&(l=new Uint8Array(Math.max(2*l.length,e)));return new Uint8Array(l.buffer,0,e)}let m=(()=>{const e=new Uint32Array(131072);for(let p=0;p<e.length;++p)e[p]=p;return e})();const f=[0],c=(()=>{const e=new Uint16Array(65536);for(let p=0;p<e.length;++p)e[p]=p;return e})();let l=new Uint8Array(65536);a.compactIndices=function(e){if(b.isArray(e)){if(e.length<b.nativeArrayMaxSize)return e}else if(e.length<b.nativeArrayMaxSize)return Array.from(e);
let p=!0,h=!0;e.some((u,w)=>{p=p&&0===u;h=h&&u===w;return!p&&!h});return p?k(e.length):h?d(e.length):b.isArray(e)||e.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?g(e):e};a.getContinuousIndexArray=d;a.getZeroIndexArray=k;a.newIndexArray=function(e){return e<=b.nativeArrayMaxSize?Array(e):65536>=e?new Uint16Array(e):new Uint32Array(e)};a.newIntArray=function(e){return e<=b.nativeArrayMaxSize?Array(e):new Uint32Array(e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],
function(a){a.Vec3Compact=void 0;(function(b){b.length=function(g,d){const k=g[d],m=g[d+1];g=g[d+2];return Math.sqrt(k*k+m*m+g*g)};b.normalize=function(g,d){var k=g[d];const m=g[d+1],f=g[d+2];k=1/Math.sqrt(k*k+m*m+f*f);g[d]*=k;g[d+1]*=k;g[d+2]*=k};b.scale=function(g,d,k){g[d]*=k;g[d+1]*=k;g[d+2]*=k};b.add=function(g,d,k,m,f,c=d){f=f||g;f[c]=g[d]+k[m];f[c+1]=g[d+1]+k[m+1];f[c+2]=g[d+2]+k[m+2]};b.subtract=function(g,d,k,m,f,c=d){f=f||g;f[c]=g[d]-k[m];f[c+1]=g[d+1]-k[m+1];f[c+2]=g[d+2]-k[m+2]}})(a.Vec3Compact||
(a.Vec3Compact={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Mesh=2]="Mesh";b[b.Line=3]="Line";b[b.Point=4]="Point";b[b.Material=5]="Material";b[b.Texture=6]="Texture";b[b.COUNT=7]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../geometry/support/Indices ./AttributeArray ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){class x extends c.ContentObject{constructor(n,q,t=null,v=l.ContentObjectType.Mesh,r=null,y=-1){super();this.material=n;this.mapPositions=t;this.type=v;this.objectAndLayerIdColor=r;this.edgeIndicesLength=y;this.visible=!0;this._attributes=new Map;this._boundingInfo=null;for(const [z,D]of q)this._attributes.set(z,{...D,indices:d.compactIndices(D.indices)}),z===u.VertexAttribute.POSITION&&(this.edgeIndicesLength=0>this.edgeIndicesLength?this._attributes.get(z).indices.length:
this.edgeIndicesLength)}instantiate(n={}){const q=new x(n.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);this._attributes.forEach((t,v)=>{t.exclusive=!1;q._attributes.set(v,t)});q._boundingInfo=this._boundingInfo;q.transformation=n.transformation||this.transformation;return q}get attributes(){return this._attributes}getMutableAttribute(n){let q=this._attributes.get(n);q&&!q.exclusive&&(q={...q,exclusive:!0,data:k.cloneAttributeData(q.data)},
this._attributes.set(n,q));return q}setAttributeData(n,q){const t=this._attributes.get(n);t&&this._attributes.set(n,{...t,exclusive:!0,data:q})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}computeAttachmentOrigin(n){return(this.type===l.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(n):
this.type===l.ContentObjectType.Line?this._computeAttachmentOriginLines(n):this._computeAttachmentOriginPoints(n))?(null!=this._transformation&&g.transformMat4(n,n,this._transformation),!0):!1}_computeAttachmentOriginTriangles(n){const q=this.attributes.get(u.VertexAttribute.POSITION);return e.computeAttachmentOriginTriangles(q,n)}_computeAttachmentOriginLines(n){const q=this.attributes.get(u.VertexAttribute.POSITION);var t=e.computeAttachmentOriginLines;var v=this.material.parameters;v="isClosed"in
v&&v.isClosed?2<q.indices.length:!1;return t.call(e,q,v,n)}_computeAttachmentOriginPoints(n){const q=this.attributes.get(u.VertexAttribute.POSITION);return e.computeAttachmentOriginPoints(q,n)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const n=this.attributes.get(u.VertexAttribute.POSITION);if(!n||0===n.indices.length)return null;const q=this.type===l.ContentObjectType.Mesh?3:1;h.assert(0===n.indices.length%q,"Indexing error: "+n.indices.length+" not divisible by "+
q);const t=d.getContinuousIndexArray(n.indices.length/q);return new f.BoundingInfo(t,q,n)}get transformation(){return this._transformation??b.IDENTITY}set transformation(n){this._transformation=n&&n!==b.IDENTITY?b.clone(n):null}addHighlight(){const n=new p.Object3DStateID(m.Object3DState.Highlight);this.highlights=w.addObject3DStateID(this.highlights,n);return n}removeHighlight(n){this.highlights=w.removeObject3DStateID(this.highlights,n)}}a.Geometry=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil"],function(a,b){a.cloneAttributeData=function(g){if(g.length<b.nativeArrayMaxSize)return Array.from(g);if(b.isArray(g))return Float64Array.from(g);if(!("BYTES_PER_ELEMENT"in g))return Array.from(g);switch(g.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(g);case 2:return b.isUint16Array(g)?Uint16Array.from(g):Int16Array.from(g);case 4:return Float32Array.from(g);default:case 8:return Float64Array.from(g)}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(a,b,g,d,k){class m{constructor(c,l,e){this.primitiveIndices=c;this._numIndexPerPrimitive=l;this.position=e;this._children=void 0;k.assert(1<=c.length);k.assert(3===e.size||4===e.size);const {data:p,size:h,indices:u}=e;k.assert(0===u.length%this._numIndexPerPrimitive);
k.assert(u.length>=c.length*this._numIndexPerPrimitive);var w=c.length;l=h*u[this._numIndexPerPrimitive*c[0]];f.clear();f.push(l);e=d.fromValues(p[l],p[l+1],p[l+2]);var x=d.clone(e);for(var n=0;n<w;++n){var q=this._numIndexPerPrimitive*c[n];for(var t=0;t<this._numIndexPerPrimitive;++t){l=h*u[q+t];f.push(l);let v=p[l];e[0]=Math.min(v,e[0]);x[0]=Math.max(v,x[0]);v=p[l+1];e[1]=Math.min(v,e[1]);x[1]=Math.max(v,x[1]);v=p[l+2];e[2]=Math.min(v,e[2]);x[2]=Math.max(v,x[2])}}this.bbMin=e;this.bbMax=x;c=g.lerp(d.create(),
this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(x[0]-e[0],x[1]-e[1]),x[2]-e[2]);e=this.radius*this.radius;for(x=0;x<f.length;++x)l=f.at(x),w=p[l]-c[0],n=p[l+1]-c[1],l=p[l+2]-c[2],q=w*w+n*n+l*l,q<=e||(q=Math.sqrt(q),t=.5*(q-this.radius),this.radius+=t,e=this.radius*this.radius,q=t/q,c[0]+=w*q,c[1]+=n*q,c[2]+=l*q);this.center=c;f.clear()}getChildren(){if(this._children||1>=g.squaredDistance(this.bbMin,this.bbMax))return this._children;var c=g.lerp(d.create(),this.bbMin,this.bbMax,.5),l=this.primitiveIndices.length;
const e=new Uint8Array(l),p=Array(8);for(var h=0;8>h;++h)p[h]=0;const {data:u,size:w,indices:x}=this.position;for(h=0;h<l;++h){var n=0;const t=this._numIndexPerPrimitive*this.primitiveIndices[h];var q=w*x[t];let v=u[q],r=u[q+1],y=u[q+2];for(let z=1;z<this._numIndexPerPrimitive;++z){q=w*x[t+z];const D=u[q],C=u[q+1];q=u[q+2];D<v&&(v=D);C<r&&(r=C);q<y&&(y=q)}v<c[0]&&(n|=1);r<c[1]&&(n|=2);y<c[2]&&(n|=4);e[h]=n;++p[n]}c=0;for(h=0;8>h;++h)0<p[h]&&++c;if(!(2>c)){c=Array(8);for(h=0;8>h;++h)c[h]=0<p[h]?new Uint32Array(p[h]):
void 0;for(h=0;8>h;++h)p[h]=0;for(h=0;h<l;++h)n=e[h],c[n][p[n]++]=this.primitiveIndices[h];this._children=[];for(l=0;8>l;++l)void 0!==c[l]&&this._children.push(new m(c[l],this._numIndexPerPrimitive,this.position));return this._children}}static prune(){f.prune()}}const f=new b({deallocator:null});a.BoundingInfo=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,b){class g{constructor(){this.id=
b.generateUID()}}a.ContentObject=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],function(a,b,g,d){const k=g.create(),m=g.create(),f=g.create(),c=g.create();a.computeAttachmentOriginLines=function(l,e,p){if(!l)return!1;b.set(p,0,0,0);b.set(c,0,0,0);let h=0,u=0;const {size:w,data:x,indices:n}=l;l=n.length-1;
e=l+(e?2:0);for(let t=0;t<e;t+=2){var q=n[t<l?t:l]*w;const v=n[t<l?t+1:0]*w;k[0]=x[q];k[1]=x[q+1];k[2]=x[q+2];m[0]=x[v];m[1]=x[v+1];m[2]=x[v+2];b.scale(k,b.add(k,k,m),.5);q=b.dist(k,m);0<q?(b.add(p,p,b.scale(k,k,q)),h+=q):0===h&&(b.add(c,c,k),u++)}return 0!==h?(b.scale(p,p,1/h),!0):0!==u?(b.scale(p,c,1/u),!0):!1};a.computeAttachmentOriginPoints=function(l,e){if(!l)return!1;const {size:p,data:h,indices:u}=l;b.set(e,0,0,0);l=-1;let w=0;for(let x=0;x<u.length;x++){const n=u[x]*p;l!==n&&(e[0]+=h[n],e[1]+=
h[n+1],e[2]+=h[n+2],w++);l=n}1<w&&b.scale(e,e,1/w);return 0<w};a.computeAttachmentOriginTriangles=function(l,e){if(!l)return!1;const {size:p,data:h,indices:u}=l;b.set(e,0,0,0);b.set(c,0,0,0);let w=l=0;for(let n=0;n<u.length-2;n+=3){var x=u[n]*p;const q=u[n+1]*p,t=u[n+2]*p;b.set(k,h[x],h[x+1],h[x+2]);b.set(m,h[q],h[q+1],h[q+2]);b.set(f,h[t],h[t+1],h[t+2]);(x=d.areaPoints3d(k,m,f))?(b.add(k,k,m),b.add(k,k,f),b.scale(k,k,1/3*x),b.add(e,e,k),l+=x):(b.add(c,c,k),b.add(c,c,m),b.add(c,c,f),w+=3)}return 0===
w&&0===l?!1:0!==l?(b.scale(e,e,1/l),!0):0!==w?(b.scale(e,c,1/w),!0):!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,g,d,k,m){function f(w){return w?{p0:d.clone(w.p0),p1:d.clone(w.p1),p2:d.clone(w.p2)}:{p0:d.create(),p1:d.create(),p2:d.create()}}function c(w,x,n,q=f()){g.copy(q.p0,w);g.copy(q.p1,x);g.copy(q.p2,
n);return q}function l(w,x,n){return.5*Math.abs((x[0]-w[0])*(n[1]-w[1])-(x[1]-w[1])*(n[0]-w[0]))}const e=new b.ObjectStack(k.create),p=new b.ObjectStack(()=>f()),h=d.create(),u=d.create();a.area2d=function(w){return l(w.p0,w.p1,w.p2)};a.areaPoints2d=l;a.areaPoints3d=function(w,x,n){g.subtract(h,x,w);g.subtract(u,n,w);return g.length(g.cross(h,h,u))/2};a.copy=function(w,x=f()){return c(w.p0,w.p1,w.p2,x)};a.create=f;a.distance2=function(w,x){var n=w.p0,q=w.p1;w=w.p2;const t=g.subtract(m.sv3d.get(),
q,n),v=g.subtract(m.sv3d.get(),w,q),r=g.subtract(m.sv3d.get(),n,w),y=g.subtract(m.sv3d.get(),x,n);var z=g.subtract(m.sv3d.get(),x,q),D=g.subtract(m.sv3d.get(),x,w);const C=g.cross(t,t,r),E=g.dot(g.cross(m.sv3d.get(),t,C),y);z=g.dot(g.cross(m.sv3d.get(),v,C),z);D=g.dot(g.cross(m.sv3d.get(),r,C),D);if(0<E&&0<z&&0<D)return x=g.dot(C,y),x*x/g.dot(C,C);n=k.distance2(k.fromValues(n,t,e.get()),x);q=k.distance2(k.fromValues(q,v,e.get()),x);x=k.distance2(k.fromValues(w,r,e.get()),x);return Math.min(n,q,x)};
a.fromValues=c;a.intersectRay=function(w,x,n){const {direction:q,origin:t}=x,{p0:v,p1:r,p2:y}=w;var z=r[0]-v[0],D=r[1]-v[1],C=r[2]-v[2];w=y[0]-v[0];x=y[1]-v[1];const E=y[2]-v[2];var A=q[1]*E-x*q[2],F=q[2]*w-E*q[0];const G=q[0]*x-w*q[1];var I=z*A+D*F+C*G;if(-1E-5<I&&1E-5>I)return!1;I=1/I;const H=t[0]-v[0],B=t[1]-v[1],K=t[2]-v[2];A=I*(H*A+B*F+K*G);if(0>A||1<A)return!1;F=B*C-D*K;C=K*z-C*H;z=H*D-z*B;D=I*(q[0]*F+q[1]*C+q[2]*z);if(0>D||1<A+D)return!1;n&&(g.scale(n,q,I*(w*F+x*C+E*z)),g.add(n,t,n));return!0};
a.wrap=function(w,x,n){const q=p.get();q.p0=w;q.p1=x;q.p2=n;return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,b){class g{constructor(d){this.channel=d;this.id=b.generateUID()}}a.Object3DStateID=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define(["exports","../../../../../chunks/vec3f64",
"../../../../webgl/doublePrecisionUtils"],function(a,b,g){const d=b.create(),k=new Float32Array(6);a.addObject3DStateID=function(m,f){null==m&&(m=[]);m.push(f);return m};a.encodeDoubleVec3=function(m,f,c,l,e){d[0]=m.get(f,0);d[1]=m.get(f,1);d[2]=m.get(f,2);g.encodeDoubleArray(d,k,3);c.set(e,0,k[0]);l.set(e,0,k[1]);c.set(e,1,k[2]);l.set(e,1,k[3]);c.set(e,2,k[4]);l.set(e,2,k[5])};a.removeObject3DStateID=function(m,f){if(null==m)return null;m=m.filter(c=>c!==f);return 0===m.length?null:m};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/MarsAtmosphere":function(){define("../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/FloatArray ./AtmosphereType ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I){function H(O,U,Z,P,R){const W=f.length(O),N=P*Math.sqrt(W*W-P*P)/W,V=R.v1,S=R.v2;f.scale(R.center,O,Math.sqrt(P*P-N*N)/W);f.cross(V,O,U);1>f.squaredLength(V)&&f.cross(V,O,Z);f.scale(V,V,N/f.length(V));f.cross(S,V,O);f.scale(S,S,N/f.length(S));return N}const B=-h.innerAtmosphereDepth,K=q.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);class L{constructor(O,U){this.view=O;this.type=p.AtmosphereType.Mars;
this._passParameters=new u.SimpleAtmospherePassParameters;this._vaoCount=0;this._texV1=1;O=l.getReferenceEllipsoid(O.spatialReference);this._planetRadius=O.radius;this._outerRimWidth=O.outerAtmosphereRimWidth;this._innerRimFactor=(this._planetRadius+B)/this._planetRadius;this._middleRimFactor=(this._planetRadius+0)/this._planetRadius;this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius;this._texV0=0/this._outerRimWidth;this._texVScale=this._texV1-this._texV0;this._techniqueRepository=
U.techniqueRepository;O=U.renderContext.rctx;this._cameraChangeHandle=g.watch(()=>this.view.state?.camera,()=>U.requestRender(),g.syncAndInitial);this._vao=this._createRibbon(O);this._vaoCount=I.vertexCount(this._vao,"geometry");this._fadeVao=y.createQuadVAO(O);this._fadeVaoCount=I.vertexCount(this._fadeVao,"geometry");const Z=new G.TextureDescriptor;Z.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;Z.flipped=!0;Z.width=1;Z.height=512;this._passParameters.texture=new F.Texture(O,Z,n.marsAtmosphereTextureSimple);
O=new x.SimpleAtmosphereTechniqueConfiguration;O.geometry=x.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._techniqueRepository.acquire(w.SimpleAtmosphereTechnique,O);O.geometry=x.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._techniqueRepository.acquire(w.SimpleAtmosphereTechnique,O)}destroy(){this._coneTechnique.release();this._undergroundTechnique.release();this._cameraChangeHandle.remove();this._passParameters.texture=b.disposeMaybe(this._passParameters.texture);
this._fadeVao.dispose();this._vao.dispose()}render(O){this._update(O.bindParameters.camera);const U=O.rctx;1>this._passParameters.undergroundFadeAlpha&&(U.bindTechnique(this._coneTechnique,this._passParameters,O.bindParameters),U.bindVAO(this._vao),U.drawArrays(A.PrimitiveType.TRIANGLES,0,this._vaoCount));0<this._passParameters.undergroundFadeAlpha&&(U.bindTechnique(this._undergroundTechnique,this._passParameters,O.bindParameters),U.bindVAO(this._fadeVao),U.drawArrays(A.PrimitiveType.TRIANGLE_STRIP,
0,this._fadeVaoCount))}renderHaze(){}_update(O){var U=c.create();const Z=this._planetRadius;var P=f.length(O.eye);const R=P-Z;this._passParameters.undergroundFadeAlpha=0>R?Math.min(-R/5E3,1):0;var W=Z+B,N=Z+Math.max(50,R);this._passParameters.innerScale=N*N/(Math.sqrt(N*N-Z*Z)*Math.sqrt(N*N-W*W)+Z*W)-1;this._passParameters.altitudeFade=h.computeInnerAltitudeFade(R);f.scale(U,O.eye,(Z+50)/P);H(U,O.center,O.up,Z,this._passParameters.silhouette);U=this._computeScreenRimWidth(O,U,O.up,this._passParameters.silhouette);
P=K(R);W=this._texV0+.001953125*this._texVScale;N=this._texV0+U*P*this._texVScale;50<R&&(H(O.eye,O.center,O.up,Z,this._passParameters.silhouette),O=this._computeScreenRimWidth(O,O.eye,O.up,this._passParameters.silhouette),O=a.clamp((O-1.5)/(U-1.5),0,1),W=this._texV0+.001953125*O*this._texVScale,N=this._texV0+a.lerp(this._texV1,U*P,O)*this._texVScale);m.set(this._passParameters.texV,W,N)}_createRibbon(O){const U=e.newFloatArray(1155),Z=new Uint32Array(1920);U[0]=0;U[1]=0;U[2]=-1;for(var P=0;128>P;P++){var R=
9*P+3;U[R]=P;U[R+1]=this._innerRimFactor;U[R+2]=-1;U[R+3]=P;U[R+4]=this._middleRimFactor;U[R+5]=0;U[R+6]=P;U[R+7]=this._outerRimFactor;U[R+8]=1;R=3*P+1;var W=127===P?1:R+3,N=15*P;Z[N]=R;Z[N+1]=R+1;Z[N+2]=W+1;Z[N+3]=W+1;Z[N+4]=W;Z[N+5]=R;Z[N+6]=R+1;Z[N+7]=R+2;Z[N+8]=W+2;Z[N+9]=W+2;Z[N+10]=W+1;Z[N+11]=R+1;Z[N+12]=R;Z[N+13]=W;Z[N+14]=0}P=Q.createBuffer(Z.length);R=P.position;for(W=0;W<Z.length;++W)N=3*Z[W],R.set(W,0,U[N]),R.set(W,1,U[N+1]),R.set(W,2,U[N+2]);return new D.VertexArrayObject(O,r.Default3D,
{geometry:t.glLayout(Q)},{geometry:E.BufferObject.createVertex(O,A.Usage.STATIC_DRAW,P.buffer)})}_computeScreenRimWidth(O,U,Z,P){f.add(M,P.center,P.v2);f.scale(T,M,this._outerRimFactor);d.lookAt(J,U,M,Z);z.project(M,J,O.projectionMatrix,O.viewport,M);z.project(T,J,O.projectionMatrix,O.viewport,T);return f.distance(M,T)/O.height}}const J=k.create(),M=c.create(),T=c.create(),Q=v.newLayout().vec3f(C.VertexAttribute.POSITION);return L})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],
function(a){const b=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,
0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,
6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,
4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,
11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,
118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,
138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,
28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,
96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,
61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,
87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,
221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,
212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);a.marsAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){a.Precipitation=class extends g{constructor(A){super(A);this._numParticles=25E4;this._rainSpeed=.1;this._snowSpeed=.01;this._passParameters=new w.PrecipitationPassParameters;this._animation=new t.AnimationTimer;this._updatingTracking=new h.UpdatingHandles;this._passParameters.time=0;this._passParameters.radius=u.getReferenceEllipsoid(A.view.spatialReference).radius;this._techniqueRepository=A.context.techniqueRepository}destroy(){this._updatingTracking.destroy();
this._numParticles=0;this._snowTechniqueCached=k.releaseMaybe(this._snowTechniqueCached);this._rainTechniqueCached=k.releaseMaybe(this._rainTechniqueCached);this._vao=k.disposeMaybe(this._vao);this._instanceIdBuffer=k.disposeMaybe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(null==this._rainTechniqueCached){const A=new x.PrecipitationTechniqueConfiguration;A.type=x.PrecipitationType.Rain;this._rainTechniqueCached=this._techniqueRepository.acquire(w.PrecipitationTechnique,
A)}return this._rainTechniqueCached}get _snowTechnique(){if(null==this._snowTechniqueCached){const A=new x.PrecipitationTechniqueConfiguration;A.type=x.PrecipitationType.Snow;this._snowTechniqueCached=this._techniqueRepository.acquire(w.PrecipitationTechnique,A)}return this._snowTechniqueCached}update(A){return this._animation.advance(A)}render(A,F,G){const I="rainy"===G?this._rainTechnique:this._snowTechnique;if(I.compiled){var H=A.rctx;this._ensureResources(H);null!=I&&null!=this._vao&&null!=this._instanceIdBuffer&&
(null!=A.bindParameters.cloudsFade.data&&(this._passParameters.opacity=A.bindParameters.cloudsFade.opacity),0>=this._passParameters.opacity||(F=.5>F?d.lerp(0,.35,2*F):d.lerp(.35,1,2*(F-.5)),this._passParameters.time=("rainy"===G?this._rainSpeed:this._snowSpeed)*m.secondsFromMilliseconds(this._animation.time)%1E5,A=H.bindTechnique(I,this._passParameters,A.bindParameters),H.bindVAO(this._vao),A.assertCompatibleVertexAttributeLocations(this._vao),D.bindVertexBufferLayout(H,w.attributeLocations,this._instanceIdBuffer,
E,0),H.drawArraysInstanced(z.PrimitiveType.TRIANGLES,0,3,this._numParticles*F),D.unbindVertexBufferLayout(H,w.attributeLocations,this._instanceIdBuffer,E)))}else this.context.requestRender()}_ensureResources(A){null==this._vao&&(this._vao=this._createVertexArrayObject(A));null==this._instanceIdBuffer&&(this._instanceIdBuffer=this._createInstanceIndices(A))}_createInstanceIndices(A){const F=[];for(let G=0;G<this._numParticles;G++)F.push(G);return y.BufferObject.createVertex(A,z.Usage.STATIC_DRAW,new Float32Array(F))}_createVertexArrayObject(A){const F=
new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new v.VertexArrayObject(A,w.attributeLocations,{geometry:n.glLayout(C)},{geometry:y.BufferObject.createVertex(A,z.Usage.STATIC_DRAW,F)})}};b.__decorate([f.property({constructOnly:!0})],a.Precipitation.prototype,"context",void 0);b.__decorate([f.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);b.__decorate([f.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);b.__decorate([f.property()],a.Precipitation.prototype,
"_updatingTracking",void 0);a.Precipitation=b.__decorate([p.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const C=q.newLayout().vec3f(r.VertexAttribute.POSITION),E=n.glLayout(q.newLayout().f32(r.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends d.NoParameters{constructor(){super(...arguments);this.time=0;this.radius=1;this.width=500;this.opacity=1}}class h extends m.ShaderTechnique{initializeProgram(w){return new f.Program(w.rctx,h.shader.get().build(this.configuration),u)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:l.CompareFunction.LEQUAL},
colorWrite:e.defaultColorWriteParams})}}h.shader=new k.ReloadableShaderModule(g.Precipitation,()=>new Promise((w,x)=>a(["./Precipitation.glsl"],w,x)));const u=new Map([[c.VertexAttribute.POSITION,0],[c.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);b.PrecipitationPassParameters=p;b.PrecipitationTechnique=h;b.attributeLocations=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec3 ./vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(n){const q=new l.ShaderBuilder;q.attributes.add(e.VertexAttribute.POSITION,"vec3");q.attributes.add(e.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");q.vertex.uniforms.add(new k.Float3PassUniform("cameraPosition",(t,v)=>v.camera.eye));q.vertex.uniforms.add(new k.Float3PassUniform("offset",(t,v)=>{v=v.camera.eye;var r=.5*t.width;const y=1/t.width;r=b.floor(h,b.set(h,(v[0]+r)*y,(v[1]+r)*y,(v[2]+r)*y));return b.sub(r,v,b.scale(r,r,t.width))}));q.vertex.uniforms.add(new m.FloatPassUniform("width",
t=>t.width));q.vertex.uniforms.add(new c.Matrix4PassUniform("proj",(t,v)=>v.camera.projectionMatrix));q.vertex.uniforms.add(new c.Matrix4PassUniform("view",(t,v)=>v.camera.viewMatrix));q.vertex.uniforms.add(new m.FloatPassUniform("time",t=>t.time));q.varyings.add("vUv","vec2");q.vertex.code.add(f.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${n.type===d.PrecipitationType.Rain?f.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:f.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);q.fragment.uniforms.add(new m.FloatPassUniform("opacity",t=>t.opacity),new k.Float3PassUniform("particleColor",(t,v)=>{t=n.type===d.PrecipitationType.Rain?x:w;const r=b.scale(h,t,.7);b.normalize(u,v.camera.eye);v=Math.max(0,b.dot(u,v.lighting.mainLight.direction));return b.lerp(r,r,t,v)}));q.fragment.code.add(f.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${n.type===d.PrecipitationType.Rain?f.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:f.glsl`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `);return q}const h=g.create(),u=g.create(),w=g.fromValues(1,1,1),x=g.fromValues(.85,.85,.85);g=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.Precipitation=g;a.build=p})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,g){a.PrecipitationType=void 0;(function(k){k[k.Rain=0]="Rain";k[k.Snow=
1]="Snow";k[k.COUNT=2]="COUNT"})(a.PrecipitationType||(a.PrecipitationType={}));class d extends g.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.type=a.PrecipitationType.Rain}}b.__decorate([g.parameter({count:a.PrecipitationType.COUNT})],d.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../core/time"],function(a,
b){class g{constructor(){this.enabled=!0;this._time=b.Milliseconds(0)}get time(){return this._time}advance({deltaTime:k,fixedTime:m}){if(null!=m){if(this._time===m)return!1;this._time=m;return!0}this._time=b.Milliseconds(this._time+k);return 0!==k}}class d{constructor(k,m){this.deltaTime=k;this.fixedTime=m}}a.AnimationTimer=g;a.Parameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../core/support/UpdatingHandles ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A){a.Stars=class extends d{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return null!=this._loadDataTask&&!this._loadDataTask.finished}constructor(K){super(K);this._loadDataTask=null;this._numPoints=0;this._renderParameter=new v.StarPassParameters;this._updatingTracking=new t.UpdatingHandles}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=c.abortMaybe(this._loadDataTask);
this._updatingTracking.destroy();this._numPoints=0;this._technique=c.releaseMaybe(this._technique);this._vao=c.disposeMaybe(this._vao);B=null}render(K){const {rctx:L}=K;this._ensureResources(L);null!=this._technique&&null!=this._vao&&(this._technique.compiled?(K=L.bindTechnique(this._technique,this._renderParameter,K.bindParameters),L.bindVAO(this._vao),K.assertCompatibleVertexAttributeLocations(this._vao),L.drawArrays(A.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())}_ensureResources(K){if(null==
this._technique&&null!=B){this._technique=new v.StarsTechnique({rctx:K,viewingMode:this.view.state.viewingMode});this._numPoints=B.byteLength/9;var L=new Float32Array(B,0,2*this._numPoints),J=new Uint8Array(B,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(K,L,J,this._numPoints);this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,M=>this._update(M),e.initial)}}_computeDayDuration(K){const L=new Date(K.getFullYear(),
0,1,11,58,56),J=new Date(K.getFullYear()+1,0,1,11,58,55);return(+K-+L)/(+J-+L)}_update(K){if(K){var L=K.getHours()/12,J=K.getMinutes()/60*(2/24),M=K.getSeconds()/60*(2/1440);L=(L+J+M-.9972222)%2;K=2*this._computeDayDuration(K);J=n.copy(this._renderParameter.modelMatrix,I);n.rotateZ(J,J,-K*Math.PI);n.multiply(J,G,J);n.rotateZ(J,J,-L*Math.PI);this.requestRender()}}_hexToRGB(K){return[parseInt(K.substring(0,2),16),parseInt(K.substring(2,4),16),parseInt(K.substring(4,6),16)]}_unpackUint8Attributes(K){return 192<=
K?[2.9,K-192]:160<=K?[2.5,K-160]:128<=K?[2,K-128]:96<=K?[1.5,K-96]:64<=K?[1,K-64]:32<=K?[.7,K-32]:[.4,K]}_createVertexArrayObject(K,L,J,M){const T=H.createBuffer(M),Q=T.position,O=T.color,U=T.size;for(let R=0;R<M;R++){var Z=L[2*R],P=L[2*R+1];Q.set(R,0,-Math.cos(Z)*Math.sin(P));Q.set(R,1,-Math.sin(Z)*Math.sin(P));Q.set(R,2,-Math.cos(P));Z=this._unpackUint8Attributes(J[R]);P=this._hexToRGB(F[Z[1]]);O.set(R,0,255*P[0]);O.set(R,1,255*P[1]);O.set(R,2,255*P[2]);O.set(R,3,255);U.set(R,Z[0])}return new D.VertexArrayObject(K,
z.Default3D,{geometry:r.glLayout(H)},{geometry:E.BufferObject.createVertex(K,A.Usage.STATIC_DRAW,T.buffer)})}_createLoadDataTask(){if(null!=B)return null;const K=k.createTask(async L=>{({data:L}=await g.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:L}));this._verifyStarData(L);B=L});K.promise.catch(L=>{l.isAbortError(L)||f.getLogger(this).error(L)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return K}_verifyStarData(K){if(!K)throw new m("stars:no-data-received",
"Failed to create stars because star catalogue is missing");K=K.byteLength/9;if(0!==K%1||5E4<K||5E3>K)throw new m("stars:invalid-data","Failed to create stars because star catalogue data is invalid");}};b.__decorate([p.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);b.__decorate([p.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);b.__decorate([p.property({readOnly:!0})],a.Stars.prototype,"updating",null);b.__decorate([p.property()],a.Stars.prototype,"_loadDataTask",
void 0);b.__decorate([p.property()],a.Stars.prototype,"_updatingTracking",void 0);a.Stars=b.__decorate([x.subclass("esri.views.3d.environment.Stars")],a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),G=q.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),I=q.fromValues(1,0,0,0,0,.9174771405229186,
-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),H=y.newLayout().vec3f(C.VertexAttribute.POSITION).vec4u8(C.VertexAttribute.COLOR).f32(C.VertexAttribute.SIZE);let B=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){class u extends k.NoParameters{constructor(){super(...arguments);this.modelMatrix=g.create()}}class w extends f.ShaderTechnique{constructor(x){super(x,new c.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(x){return new e.Program(x.rctx,w.shader.get().build(),l.Default3D)}initializePipeline(){return h.makePipelineState({blending:h.separateBlendingParams(p.BlendFactor.SRC_ALPHA,p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA,p.BlendFactor.ONE_MINUS_SRC_ALPHA),
depthTest:{func:p.CompareFunction.LEQUAL},colorWrite:h.defaultColorWriteParams})}}w.shader=new m.ReloadableShaderModule(d.Stars,()=>new Promise((x,n)=>a(["./Stars.glsl"],x,n)));b.StarPassParameters=u;b.StarsTechnique=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Stars.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(){const h=new c.ShaderBuilder;h.attributes.add(l.VertexAttribute.POSITION,"vec3");h.attributes.add(l.VertexAttribute.COLOR,"vec4");h.attributes.add(l.VertexAttribute.SIZE,"float");h.varyings.add("vcolor","vec4");h.varyings.add("vsize","float");h.vertex.uniforms.add(new f.Matrix4PassUniform("transform",(u,w)=>{b.copy(p,w.camera.projectionMatrix);p[10]=2.4E-7-1;p[11]=-1;p[14]=(2.4E-7-2)*w.camera.near;b.multiply(p,p,w.camera.viewMatrix);return b.multiply(p,p,u.modelMatrix)}),
new d.Float4PassUniform("viewport",(u,w)=>w.camera.fullViewport),new k.FloatPassUniform("pixelRatio",(u,w)=>w.camera.pixelRatio));h.vertex.code.add(m.glsl`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);h.fragment.code.add(m.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`);return h}const p=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.Stars=g;a.build=e})},"esri/views/3d/webgl-engine/effects/RenderPlugin":function(){define(["exports","../../../../core/Accessor","../core/shaderLibrary/ShaderOutput"],function(a,b,g){const d={required:[]},k={required:[g.ShaderOutput.Depth]},m={required:[g.ShaderOutput.CompositeColor]},f={required:[g.ShaderOutput.Highlight]};g={required:[g.ShaderOutput.Depth,g.ShaderOutput.Normal]};
class c extends b{consumes(){return d}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}}class l extends c{}class e extends c{}class p extends c{}class h extends c{}class u extends c{}a.ASyncPreparesRenderPlugin=u;a.AsyncRenderPlugin=h;a.ConsumesCompositeColor=m;a.ConsumesDepth=k;a.ConsumesDepthNormal=g;a.ConsumesHighlight=f;a.ConsumesNone=d;a.SyncPrepareRenderPlugin=e;a.SyncPreparesRenderPlugin=p;a.SyncRenderPlugin=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],function(a){a.Update=void 0;var b=a.Update||(a.Update={});b[b.Immediate=0]="Immediate";b[b.Faded=1]="Faded";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(U,Z,P){Z===l.ViewingMode.Global?f.normalize(T,U.eye):f.set(T,0,0,1);f.scale(Q,U.viewForward,-1);Z=p.angle(Q,T);const R=Math.max(Z-.5,0);g.fromRotation(M,-Math.max(.25,Z-.25-.85*R/(R+1)),U.viewRight);f.transformMat4(P,Q,M);f.add(P,P,f.scale(O,U.viewRight,.2));f.normalize(P,P)}function u(U,Z,P,R){const W=y,N=g.identity(r);if(P===l.ViewingMode.Global)e.SunCalc.getPosition(U,0,0,W),f.set(R,0,0,-1),g.rotateX(N,N,-W.azimuth),g.rotateY(N,N,-W.altitude);else{var V=
n.planarDirection;P=V.globalAngles;V=(Math.abs(Z[2])-V.localAltitude)/(V.globalAltitude-V.localAltitude);V=b.clamp(V,0,1);1>V?(e.SunCalc.getPosition(U,Z[1],Z[0],W),W.azimuth=(1-V)*W.azimuth+V*P.azimuth,W.altitude=(1-V)*W.altitude+V*P.altitude):(W.azimuth=P.azimuth,W.altitude=P.altitude);f.set(R,0,-1,0);g.rotateZ(N,N,-W.azimuth);g.rotateX(N,N,-W.altitude)}f.transformMat4(R,R,N)}function w(U){switch(U){case "disabled":case "sunny":return new q(1,1);case "cloudy":return new q(1,1);case "rainy":return new q(.4,
1.2);case "snowy":return new q(.5,1.3);case "foggy":return new q(.2,1.6)}}function x(U,Z){const P=(U[0]+U[1]+U[2])/3;U[0]+=(P-U[0])*Z;U[1]+=(P-U[1])*Z;U[2]+=(P-U[2])*Z}const n={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class q{constructor(U,Z){this.direct=U;this.ambient=
Z}}const t=c.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);class v{constructor(){this.ambient={color:c.fromValues(1,1,1),intensity:.55};this.direct={color:c.fromValues(1,1,1),intensity:.55,directionToLightSource:c.clone(t)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1}}const r=d.create(),y={azimuth:0,altitude:0},z=c.fromValues(.01,.01,.01),D=c.fromValues(1,.6,.5),C=c.fromValues(1,.98,.98),E=c.fromValues(1,1,1),A=c.fromValues(.8,.8,1),
F=c.fromValues(.8,.8,1),G=c.fromValues(.98,.98,1),I=c.fromValues(1,1,1),H=m.fromValues(.01,n.local.ambientAtNight),B=m.fromValues(n.local.directAtTwilight,n.local.ambientAtTwilight),K=m.fromValues(.9*n.local.directAtNoon,n.local.ambientAtNoon),L=m.fromValues(n.local.directAtNoon,n.local.ambientAtNoon),J=new Date(0),M=d.create(),T=c.create(),Q=c.create(),O=c.create();a.ColorAndIntensity=v;a.computeColorAndIntensity=function(U,Z,P,R,W,N){f.set(N.ambient.color,1,1,1);N.ambient.intensity=n.global.ambient;
f.set(N.direct.color,1,1,1);N.direct.intensity=n.global.direct;var V=b.clamp((Math.abs(Z[2])-n.local.altitude)/(n.global.altitude-n.local.altitude),0,1);N.globalFactor=V;var S;null!=U&&(S=e.SunCalc.getTimes(U,Z[1],Z[0]));if(1>V){if(null!=U){var X=S;var ca=U.valueOf();if(X.polarException===e.SunCalc.PolarException.MIDNIGHT_SUN){var ba=ca-36E5*(U.getHours()+48)-6E4*U.getMinutes();X=ba+432E6}else X.polarException===e.SunCalc.PolarException.POLAR_NIGHT?(ba=ca-2,X=ca-1):(ba=X.sunrise.valueOf(),X=X.sunset.valueOf());
var ia=X-ba;var ka=ba+ia/2,na=ia/4;const Y=ka-na;na=ka+na;ia*=.06;const ea=ba-ia/2,fa=ba+ia/2,aa=X-ia/2,da=X+ia/2;ba=m.create();ia=c.create();X=c.create();ca<ea||ca>da?(k.copy(ba,H),f.copy(ia,z),f.copy(X,A)):ca<fa?(ca=(ca-ea)/(fa-ea),k.lerp(ba,H,B,ca),f.lerp(ia,z,D,ca),f.lerp(X,A,F,ca)):ca<Y?(ca=(ca-fa)/(Y-fa),k.lerp(ba,B,K,ca),f.lerp(ia,D,C,ca),f.lerp(X,F,G,ca)):ca<ka?(ca=(ca-Y)/(ka-Y),k.lerp(ba,K,L,ca),f.lerp(ia,C,E,ca),f.lerp(X,G,I,ca)):ca<na?(ca=(ca-ka)/(na-ka),k.lerp(ba,L,K,ca),f.lerp(ia,E,C,
ca),f.lerp(X,I,G,ca)):ca<aa?(ca=(ca-na)/(aa-na),k.lerp(ba,K,B,ca),f.lerp(ia,C,D,ca),f.lerp(X,G,F,ca)):ca<da&&(ca=(ca-aa)/(da-aa),k.lerp(ba,B,H,ca),f.lerp(ia,D,z,ca),f.lerp(X,F,A,ca));ca=0;switch(R){case "rainy":case "foggy":ca=.8;break;case "snowy":ca=.5}0<ca&&(x(ia,ca),x(X,ca));ka=w(R);ca=ba[0]*ka.direct;ba=ba[1]*ka.ambient}else X=w(R),ca=n.local.directAtNoon*X.direct,ia=c.fromValues(1,1,1),ba=n.local.ambientAtNoon*X.ambient,X=c.fromValues(1,1,1);f.lerp(N.ambient.color,X,N.ambient.color,V);N.ambient.intensity=
b.lerp(ba,N.ambient.intensity,V);f.lerp(N.direct.color,ia,N.direct.color,V);N.direct.intensity=b.lerp(ca,N.direct.intensity,V);N.specularStrength="rainy"===R||"snowy"===R||"foggy"===R?0:1;N.environmentStrength="rainy"===R?.7:"snowy"===R||"foggy"===R?.75:1}null!=U?(R=U.valueOf(),S.polarException===e.SunCalc.PolarException.MIDNIGHT_SUN?(V=R-36E5*(U.getHours()+48)-6E4*U.getMinutes(),S=V+432E6):S.polarException===e.SunCalc.PolarException.POLAR_NIGHT?(V=R-2,S=R-1):(V=S.sunrise.valueOf(),S=S.sunset.valueOf()),
R=1-b.clamp(Math.abs(R-(V+(S-V)/2))/432E5,0,1)):R=1;N.noonFactor=R;null!=U?u(U,Z,P,N.direct.directionToLightSource):h(W,P,N.direct.directionToLightSource)};a.computeDirectionsOverTime=function(U,Z,P,R,W){U=U.getTime();Z=Z.getTime()-U;Z=Math.floor(Z/P)+1;const N=Array(Z);for(let V=0;V<Z;++V)J.setTime(U+P*V),N[V]=c.create(),u(J,R,W,N[V]);return N};a.computeShadowsEnabled=function(U,Z){return Z===l.ViewingMode.Global?!0:Math.abs(U)<n.planarDirection.localAltitude};a.computeVirtualLightDirection=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SunCalc":function(){define(["exports","./_commonjsHelpers"],function(a,b){var g={exports:{}};g.exports;(function(d){(function(k){k=k();void 0!==k&&(d.exports=k)})(function(){function k(A){return new Date(864E5*(A+.5-2440588))}function m(A,F){return v(x(A)*n(D)-q(F)*x(D),n(A))}function f(A,F){return t(x(F)*n(D)+n(F)*x(D)*x(A))}function c(A,F,G){return v(x(A),n(A)*x(F)-q(G)*n(F))}function l(A,F,G){return t(x(F)*x(G)+n(F)*n(G)*n(A))}function e(A){return y*
(1.9148*x(A)+.02*x(2*A)+3E-4*x(3*A))}function p(A,F){A=y*(357.5291+.98560028*A);var G=e(A);A=A+G+102.9372*y+w;F||(F={dec:0,ra:0});F.dec=f(A,0);F.ra=m(A,0);return F}function h(A,F,G){return 2451545+A+.0053*x(F)-.0069*x(2*G)}function u(A){var F=y*(134.963+13.064993*A),G=y*(93.272+13.22935*A);A=y*(218.316+13.176396*A)+6.289*y*x(F);G=5.128*y*x(G);F=385001-20905*n(F);return{ra:m(A,G),dec:f(A,G),dist:F}}var w=Math.PI,x=Math.sin,n=Math.cos,q=Math.tan,t=Math.asin,v=Math.atan2,r=Math.acos,y=w/180,z={dec:0,
ra:0},D=23.4397*y,C={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(A,F,G,I){G=y*-G;F*=y;var H=A.valueOf()/864E5-.5+2440588-2451545;A=p(H,z);G=y*(280.16+360.9856235*H)-G-A.ra;I||(I={azimuth:0,altitude:0});I.azimuth=c(G,F,A.dec);I.altitude=l(G,F,A.dec);return I}},E=[[-.83,"sunrise","sunset"]];C.addTime=function(A,F,G){E.push([A,F,G])};C.getTimes=function(A,F,G){function I(Z){var P=B,R=M;Z=r((x(Z)-x(P)*x(R))/(n(P)*n(R)));return h(9E-4+(Z+H)/(2*w)+K,L,J)}var H=y*-G,B=y*F,
K=Math.round(A.valueOf()/864E5-.5+2440588-2451545-9E-4-H/(2*w));A=9E-4+(0+H)/(2*w)+K;var L=y*(357.5291+.98560028*A);F=e(L);var J=L+F+102.9372*y+w,M=f(J,0);A=h(A,L,J);F={solarNoon:k(A),nadir:k(A-.5),polarException:C.PolarException.NORMAL};var T;G=0;for(T=E.length;G<T;G+=1){var Q=E[G];var O=I(Q[0]*y);var U=A-(O-A);F[Q[1]]=k(U);F[Q[2]]=k(O)}F.polarException=function(Z){Z=(x(Z)-x(B)*x(M))/(n(B)*n(M));return-1>Z?C.PolarException.MIDNIGHT_SUN:1<Z?C.PolarException.POLAR_NIGHT:C.PolarException.NORMAL}(E[0][0]*
y);return F};C.getMoonPosition=function(A,F,G){G=y*-G;F*=y;var I=A.valueOf()/864E5-.5+2440588-2451545;A=u(I);G=y*(280.16+360.9856235*I)-G-A.ra;I=l(G,F,A.dec);I+=.017*y/q(I+10.26*y/(I+5.1*y));return{azimuth:c(G,F,A.dec),altitude:I,distance:A.dist}};C.getMoonFraction=function(A){var F=A.valueOf()/864E5-.5+2440588-2451545;A=p(F);F=u(F);A=r(x(A.dec)*x(F.dec)+n(A.dec)*n(F.dec)*n(A.ra-F.ra));A=v(149598E3*x(A),F.dist-149598E3*n(A));return(1+n(A))/2};return C})})(g);b=b.getDefaultExportFromCjs(g.exports);
a.SunCalc=b})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I){b=class extends b{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(B){"pan"!==B&&"rotate"!==B||B===this._get("primaryDragAction")||(this._set("primaryDragAction",B),this._updateMode())}get mode(){return this._get("mode")}set mode(B){"default"!==B&&"pro"!==B||B===this._get("mode")||(this._set("mode",B),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??
!1}disconnect(){this.view.viewEvents.disconnect();this._inputManager=g.destroyMaybe(this._inputManager)}connect(){const B=this.view;this._source=new y.BrowserEventSource(this.view.surface,B.input);var K=[new E.ImmediateDoubleClick,new A.PointerClickHoldAndDrag,new F.SingleAndDoubleClick,new C.Drag(this.view.navigation),new G.VerticalTwoFingerDrag];this._inputManager=K=new z.InputManager({eventSource:this._source,recognizers:K});K.installHandlers("prevent-context-menu",[new D.PreventContextMenu],z.ViewEventPriorities.INTERNAL);
this._modeDragPan=new n.PinchAndPanNavigation(B,"primary");this._modeDragRotate=new p.DragRotate(B,"secondary",I.PivotPoint.CENTER);this._modeDragZoom=new h.DragZoom(B,"tertiary");K.installHandlers("navigation",[new q.PointerDownCancelAnimation(B),new e.DoubleClickZoom(B),new u.GamepadNavigation(B),new w.KeyboardNavigation(B,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),
new x.MouseWheelZoom(B),new v.SingleKeyResetTilt(B,"p"),new t.SingleKeyResetHeading(B,"n"),new p.DragRotate(B,"primary",I.PivotPoint.EYE,["b"]),new p.DragRotate(B,"secondary",I.PivotPoint.CENTER,["b"]),new n.PinchAndPanNavigation(B,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new r.TwoFingerTilt(B)],z.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(K);this._updateMode();this.addHandles(d.watch(()=>this.view.navigation?.browserTouchPanEnabled,L=>{this._source.browserTouchPanningEnabled=
!L},d.initial))}_updateMode(){var B=this.primaryDragAction;if(B=H.get(this.mode)?.get(B))this._modeDragPan&&(this._modeDragPan.pointerAction=B.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=B.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=B.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};a.__decorate([k.property()],b.prototype,"view",void 0);a.__decorate([k.property({value:"pan"})],
b.prototype,"primaryDragAction",null);a.__decorate([k.property({value:"default"})],b.prototype,"mode",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property()],b.prototype,"latestPointerType",null);a.__decorate([k.property()],b.prototype,"latestPointerLocation",null);a.__decorate([k.property()],b.prototype,"multiTouchActive",null);a.__decorate([k.property()],b.prototype,"_inputManager",void 0);b=a.__decorate([l.subclass("esri.views.3d.input.SceneInputManager")],
b);const H=new Map;a=new Map;k=new Map;a.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});a.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});k.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});k.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});H.set("default",a);H.set("pro",k);return b})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,g,d,k,m){class f extends k.InputHandler{constructor(c,l){super(!0);this._view=c;this.registerIncoming("double-click",l,e=>this._handleDoubleClick(e))}_handleDoubleClick(c){const l=c.data;if(m.eventMatchesPointerAction(l,"primary")){const e=this._view.state.isGlobal?new g.ZoomStepController({view:this._view,mode:"animation"}):new d.ZoomStepController({view:this._view,mode:"animation"});this._view.state.switchCameraController(e);e.zoomStep(Math.log(.5)/Math.log(.6),b.createScreenPointArray(l.x,
l.y));c.stopPropagation()}}}a.DoubleClickZoom=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A){a.ZoomStepController=class extends r.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=h.create();this._tmpCamera=new C.Camera;this._tmpViewDir=h.create();this._tmpRayDir={origin:h.create(),direction:h.create()};this._targetOnSphere=h.create();this._tmpCenter=h.create();this._constraintOptions={selection:n.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:q.InteractionType.ZOOM,interactionFactor:null,
interactionStartCamera:new C.Camera,interactionDirection:null,tiltMode:v.TiltMode.TUMBLE};this._sphere=w.create()}initialize(){this._intersector=E.newIntersector(this.view.state.viewingMode)}zoomStep(I,H){if(this.active){var B=this.view.state,{interactionStartCamera:K}=this._constraintOptions;K&&(this.animation.finished?K.copyFrom(B.camera):this.animation.cameraAt(1,K));var L=K=!1;this.intersectionHelper.intersectScreen(H,this._zoomLocation,0===this.view.map.ground.opacity?y.contentIntersectorOptions:
{})&&(K=0<I,L=!0);this._tmpCamera.copyFrom(B.camera);K?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:p.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,I,this._zoomLocation,H,L);this.begin(this._tmpCamera)}}animationSettings(){return{duration:d.Milliseconds(600),
easing:A.outExpo}}_updateCamera(I,H,B,K,L){var J=u.getReferenceEllipsoid(this.view.spatialReference);J=y.decideNavigationMode(I,K,J);var M=Math.abs(this.view.camera.position.z);p.normalize(G,I.eye);p.scale(G,G,-1);z.fromScreenAtEye(I,K,this._tmpRayDir);p.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const T=g.clamp(Math.min(y.zoomDistanceModifier,1/Math.abs(p.dot(G,this._tmpRayDir.direction)))*M,y.zoomMinDistanceModifier,y.zoomMaxDistanceModifier);if(J===y.NavigationMode.Horizontal){H=
.6**H;this._sphere[3]=p.length(B);p.subtract(this._tmpViewDir,I.center,I.eye);L=Math.min(p.length(this._tmpViewDir),T);J=L*H;1>=H&&4>J&&(J=4,H=J/L);if(1E-6>Math.abs(L-J))return;L=p.length(I.center);this._sphere[3]!==L&&(I.center=p.scale(F,I.center,(this._sphere[3]+H*(L-this._sphere[3]))/L));p.scale(this._tmpViewDir,this._tmpViewDir,-H);I.eye=p.add(F,I.center,this._tmpViewDir);x.applyAll(this.view,I,this._constraintOptions);1E-12<p.squaredDistance(B,I.center)&&D.intersectScreen(this._sphere,I,K,this._targetOnSphere)&&
y.panToPosition(this._sphere,I,B,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{J=.6**Math.abs(H);M=0<H?1:-1;p.subtract(this._tmpViewDir,B,I.eye);const Q=p.length(this._tmpViewDir);K=this.view._stage.renderView.getMinimalDepthForArea(null,K[0],K[1],this.view.state.camera,60);K=null!=K?K:T;K=L&&0<H?Math.min(K,Q):K;p.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,K);p.add(B,this._tmpRayDir.origin,this._tmpRayDir.direction);B=K*J;L=Math.max(4,1.01*I.nearFar[0]);
0<H&&B<L&&(B=L,J=B/K);if(1E-6>Math.abs(K-B))return;p.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,M*(1-J));I.eye=p.add(F,I.eye,this._tmpRayDir.direction);I.center=p.add(F,I.center,this._tmpRayDir.direction)}t.applySurfaceCollisionConstraint(this.view,I)}};a.ZoomStepController=b.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],a.ZoomStepController);const F=h.create(),G=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/ConstraintTypes ./constraintUtils/distance ./constraintUtils/InteractionType ./constraintUtils/surfaceCollision ./constraintUtils/tilt ./constraintUtils/TiltMode ../../animation/easing".split(" "),
function(a,b,g,d,k,m,f,c,l,e){const p=[{type:d.ConstraintTypes.TILT,error:function(u,w,x){return c.getTiltConstraintError(u,w,x)*w.distance},apply:c.applyTiltConstraint},{type:d.ConstraintTypes.ALTITUDE,error:b.getAltitudeConstraintError,apply:b.applyAltitudeConstraint},{type:d.ConstraintTypes.DISTANCE,error:k.getDistanceConstraintError,apply:k.applyDistanceConstraint}],h={selection:d.ConstraintTypes.ALL,interactionType:m.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:l.TiltMode.TUMBLE};a.applyAll=function(u,w,x=h,n=w){n!==w&&n.copyFrom(w);n.computeUp(u.state.viewingMode);w=!1;for(let t=0;5>t;t++){let v=0;for(var q of p)if(g.hasConstraintType(x.selection,q.type)){const r=Math.abs(q.error(u,n,x));q.apply(u,n,x)&&(w=!0,v+=r)}if(0===v)break}q=g.hasConstraintType(x.selection,d.ConstraintTypes.COLLISION);a:switch(x.interactionType){case m.InteractionType.PAN:x=f.Mode.EYE_AND_CENTER;break a;case m.InteractionType.ASCEND:x=u.state.isGlobal?f.Mode.EYE_AND_CENTER_SCALE:
f.Mode.EYE_AND_CENTER;break a;default:x=f.Mode.EYE}q&&f.applySurfaceCollisionConstraint(u,n,x)&&(w=!0);w&&n.computeUp(u.state.viewingMode);return w};a.pixelDistanceToInteractionFactor=function(u){return e.inOutCubic(Math.min(1,u/150))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ./ConstraintTypes ./InteractionType ../../support/intersectionUtils".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(n,q,t=m.defaultConstraintOptions){var v=n.state.constraints.altitude;v=n.state.isGlobal&&v?t.interactionType===c.InteractionType.TUMBLE&&m.hasConstraintType(t.selection,f.ConstraintTypes.TILT)?!1:!0:!1;if(!v||!n.state.constraints.altitude)return 0;var r=n.state.constraints.altitude;v=p;v.min=r.min;v.max=r.max;r=t.interactionType;if(r!==c.InteractionType.NONE){var {min:y,max:z}=v,{interactionStartCamera:D,interactionFactor:C}=t;if(D){t=r===c.InteractionType.TUMBLE||
r===c.InteractionType.ZOOM;r=e(n,D);var E=0===r?0:n.renderCoordsHelper.getAltitude(D.eye);v.min=y;v.max=z;m.adjustRangeForInteraction(r,E,t,C,.05*E,v)}}n=n.renderCoordsHelper.getAltitude(q.eye);n=b.clamp(n,v.min,v.max)-n;return 1E-6>=Math.abs(n)?0:n}const p={min:0,max:0},h=d.create(),u=d.create(),w=d.create(),x=d.create();a.applyAltitudeConstraint=function(n,q,t=m.defaultConstraintOptions){var v=e(n,q,t);if(0===v)return!1;const r=n.renderCoordsHelper,y=r.getAltitude(q.eye)+v;var z=m.interactionDirectionTowardsConstraintMinimization;
t=t.interactionDirection;v=Math.sign(v);n.renderCoordsHelper.worldUpAtPosition(q.eye,u);g.scale(u,u,v);z=z.call(m,q,t,u,h);n=g.copy(w,q.viewForward);z=r.intersectInfiniteManifold(k.wrap(q.eye,z),y,x);q.eye=null!=z?z:r.setAltitude(x,y,q.eye);q.center=l.closestPointOnRay(x,q.eye,n,q.center);return!0};a.getAltitudeConstraintError=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec3","./ConstraintTypes",
"./InteractionType","./TiltMode"],function(a,b,g,d,k){g={selection:g.ConstraintTypes.NONE,interactionType:d.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:k.TiltMode.TUMBLE};a.adjustRangeForInteraction=function(m,f,c,l,e,p){0!==m&&(c?(p.min=Math.min(p.min,f),p.max=Math.max(p.max,f)):null!=l?(p.min-=Math.max(0,(f-p.min)*(1-l)),p.max+=Math.max(0,(f-p.max)*(1-l))):e&&(p.min-=Math.max(0,f-p.min-e),p.max+=Math.max(0,f-p.max-e)))};a.defaultConstraintOptions=
g;a.hasConstraintType=function(m,f){return 0!==(m&f)};a.interactionDirectionTowardsConstraintMinimization=function(m,f,c,l){f=f||m.viewForward;b.copy(l,f);b.scale(l,l,Math.sign(b.dot(f,c)));return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintTypes":function(){define(["exports"],function(a){a.ConstraintTypes=void 0;var b=a.ConstraintTypes||(a.ConstraintTypes={});b[b.NONE=0]="NONE";b[b.TILT=1]="TILT";b[b.ALTITUDE=2]="ALTITUDE";b[b.DISTANCE=
4]="DISTANCE";b[b.COLLISION=8]="COLLISION";b[b.ALL=15]="ALL";b[b.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/InteractionType":function(){define(["exports"],function(a){a.InteractionType=void 0;var b=a.InteractionType||(a.InteractionType={});b[b.NONE=0]="NONE";b[b.ZOOM=1]="ZOOM";b[b.TUMBLE=2]="TUMBLE";b[b.LOOK_AROUND=3]="LOOK_AROUND";b[b.PAN=4]="PAN";b[b.ASCEND=5]="ASCEND";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/TiltMode":function(){define(["exports"],function(a){a.TiltMode=void 0;var b=a.TiltMode||(a.TiltMode={});b[b.TUMBLE=0]="TUMBLE";b[b.LOOK_AROUND=1]="LOOK_AROUND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,b,g,d,k){function m(l,
e,p,h){const u=c;l?(p&&h&&(u.len=g.distance(e,p)),g.copy(u.dir,l)):h?(u.len=g.distance(e,p),g.subtract(u.dir,p,e),g.scale(u.dir,u.dir,1/u.len)):(g.subtract(u.dir,p,e),g.normalize(u.dir,u.dir));return u}function f(l,e,p,h){h.clip[0]=0;h.clip[1]=p?h.len:Number.MAX_VALUE;for(p=0;p<l.length;p++){{var u=l[p],w=e;var x=h;const n=g.dot(k.normal(u),x.dir);u=-k.signedDistance(u,w);0>u&&0<=n?x=!1:-1E-6<n&&1E-6>n?x=0<u:!(0>u||0>n)||0>u&&0>n?(u/=n,0<n?u<x.clip[1]&&(x.clip[1]=u):u>x.clip[0]&&(x.clip[0]=u),x=x.clip[0]<=
x.clip[1]):x=!0}if(!x)return!1}return!0}const c={dir:d.create(),len:0,clip:b.create()};a.closestPointOnRay=function(l,e,p,h){h=g.dot(p,g.subtract(l,h,e));return g.add(l,e,g.scale(l,p,h))};a.frustumLineSegment=function(l,e,p,h){h=m(h,e,p,!0);return f(l,e,p,h)};a.frustumPoint=function(l,e){for(let p=0;6>p;p++)if(0<k.signedDistance(l[p],e))return!1;return!0};a.frustumRay=function(l,e,p,h){p=m(h,e,p,!1);return f(l,e,null,p)};a.frustumSphere=function(l,e,p){const h=e[0],u=e[1];e=e[2];return l[0][0]*h+
l[0][1]*u+l[0][2]*e+l[0][3]>p||l[1][0]*h+l[1][1]*u+l[1][2]*e+l[1][3]>p||l[2][0]*h+l[2][1]*u+l[2][2]*e+l[2][3]>p||l[3][0]*h+l[3][1]*u+l[3][2]*e+l[3][3]>p||l[4][0]*h+l[4][1]*u+l[4][2]*e+l[4][3]>p||l[5][0]*h+l[5][1]*u+l[5][2]*e+l[5][3]>p?!1:!0};a.planeSphere=function(l,e,p){return l[0]*e[0]+l[1]*e[1]+l[2]*e[2]+l[3]<p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common ./InteractionType".split(" "),
function(a,b,g,d,k,m,f){function c(n,q,t=m.defaultConstraintOptions){if(!n.state.isLocal)return 0;var v=n.state.constraints.distance;if(!n.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===v)return 0;e.min=0;e.max=v;v=e;var r=t.interactionType;if(r!==f.InteractionType.NONE){var {min:y,max:z}=v,{interactionStartCamera:D,interactionFactor:C}=t;if(D){t=r===f.InteractionType.ZOOM||r===f.InteractionType.PAN;r=c(n,D);var E=0===r?0:l(n,D);v.min=y;v.max=z;m.adjustRangeForInteraction(r,E,t,C,.05*E,
v)}}n=l(n,q);n=e.max-n;return-1E-6<=n?0:n}function l(n,q){n=n.pointsOfInterest.surfaceOrigin;return n.renderLocation?b.distance(q.eye,n.renderLocation):0}const e={min:0,max:0},p=g.create(),h=g.create(),u=g.create(),w=g.create(),x=g.create();a.applyDistanceConstraint=function(n,q,t=m.defaultConstraintOptions){var v=c(n,q,t);if(0===v)return!1;var r=n.pointsOfInterest.surfaceOrigin;if(!r.renderLocation)return!1;v=l(n,q)+v;const y=b.copy(p,q.eye);t=m.interactionDirectionTowardsConstraintMinimization(q,
t.interactionDirection,b.direction(w,q.eye,r.renderLocation),u);if(!k.intersectRay(k.fromCenterAndRadius(r.renderLocation,v),d.wrap(q.eye,t),x))return!1;q.eye=x;r=b.subtract(h,q.eye,y);q.center=b.add(x,q.center,r);r=n.renderCoordsHelper.getAltitude(q.center);n=n.renderCoordsHelper.intersectInfiniteManifold(q.ray,r,x);null!=n&&(q.center=n);return!0};a.getDistanceConstraintError=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,b,g,d){a.Mode=void 0;(function(f){f[f.EYE=0]="EYE";f[f.EYE_AND_CENTER=1]="EYE_AND_CENTER";f[f.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const k=g.create(),m=g.create();a.applySurfaceCollisionConstraint=function(f,c,l=a.Mode.EYE){var e=f.state.constraints;if(!e.collision.enabled)return!1;var p=d.surfaceElevationBelowRenderLocation(f,c.eye);const h=f.renderCoordsHelper.getAltitude(c.eye);
e=p+e.collision.elevationMargin;if(h>=e)return!1;p=b.length(c.eye);b.subtract(k,c.center,c.eye);c.eye=f.renderCoordsHelper.setAltitude(m,e,c.eye);l===a.Mode.EYE_AND_CENTER?c.center=b.add(k,c.eye,k):l===a.Mode.EYE_AND_CENTER_SCALE&&(c.center=b.scale(k,c.center,(p-h+e)/p));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../chunks/sphere ./common ./ConstraintTypes ./InteractionType ./TiltMode ../../state/utils/viewUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(A,F,G=e.defaultConstraintOptions,I=!0){E.eyeCenterDistance=0;E.requiresTwoSteps=!1;const H=n(A,F,G,void 0,E);if(0===H)return!1;d.fromRotation(r,-H,F.viewRight);switch(G.tiltMode){case u.TiltMode.LOOK_AROUND:m.transformMat4(v,F.viewForward,r);m.scale(v,v,E.eyeCenterDistance);F.center=m.add(y,F.eye,v);break;case u.TiltMode.TUMBLE:m.subtract(v,F.center,F.eye);m.transformMat4(v,v,r);F.eye=m.subtract(y,F.center,v);break;default:b.neverReached(G.tiltMode)}F.up=
m.transformMat4(y,F.up,r);return E.requiresTwoSteps&&I?x(A,F,G,!1):!0}function n(A,F,G=e.defaultConstraintOptions,I=e.defaultConstraintOptions,H){if(!A.state.constraints.tilt)return 0;var B=A.state.constraints.tilt(F.distance,D);if(G.interactionType!==h.InteractionType.NONE){var {interactionStartCamera:K,interactionFactor:L}=G;if(K){var {min:J,max:M}=B,T=n(A,K,e.defaultConstraintOptions,G),Q=0===T?0:w.viewAngle(A.renderCoordsHelper,K.center,K.eye);B.min=J;B.max=M;G.interactionType===h.InteractionType.TUMBLE?
(e.hasConstraintType(G.selection,p.ConstraintTypes.ALTITUDE)&&t(A,K,B),e.adjustRangeForInteraction(T,Q,!0,L,z,B)):e.adjustRangeForInteraction(T,Q,!1,L,z,B)}}I.interactionType===h.InteractionType.TUMBLE&&e.hasConstraintType(I.selection,p.ConstraintTypes.ALTITUDE)&&t(A,I.interactionStartCamera,B);if(G.tiltMode===u.TiltMode.LOOK_AROUND||I.tiltMode===u.TiltMode.LOOK_AROUND){a:{H&&(H.requiresTwoSteps=!1);switch(A.viewingMode){case "global":G=C;T=A.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
I=T+c.getReferenceEllipsoid(A.spatialReference).radius;T=A.renderCoordsHelper.intersectManifold(F.ray,T,y);G.eyeCenterDistance=F.distance;G.centerIsOnSurface=!1;null!=T?(G.eyeCenterDistance=m.distance(F.eye,T),G.tiltAtCenter=w.viewAngle(A.renderCoordsHelper,T,F.eye),G.centerIsOnSurface=!0):A.state.isLocal?G.tiltAtCenter=w.viewAngle(A.renderCoordsHelper,F.center,F.eye):(l.closestPointOnSilhouette(l.fromRadius(l.tmpSphere,I),F.ray,y),G.eyeCenterDistance=m.distance(F.eye,y),G.tiltAtCenter=g.acosClamped(-m.dot(F.viewForward,
m.normalize(y,y))));G.radius=I;G.eyeRadius=m.length(F.eye);G.constraints=A.state.constraints;F=g.clamp(G.tiltAtCenter,B.min,B.max);if(1E-9<Math.abs(G.tiltAtCenter-F)){if(G.centerIsOnSurface){{const {constraints:O,eyeCenterDistance:U,tiltAtCenter:Z}=G;F=Z;A=O.clampTilt(U,Z);B=q(G,A);if(O.clampTilt(B,Z)!==A)for(B=0;10>B&&1E-9<Math.abs(A-F);)I=(F+A)/2,T=q(G,I),T=O.clampTilt(T,I),1E-9<Math.abs(T-I)?F=I:A=I,B++;F=A}B=F;A=g.asinClamped(G.radius/G.eyeRadius*Math.sin(G.tiltAtCenter));B=g.asinClamped(G.radius/
G.eyeRadius*Math.sin(B));A=G.eyeRadius>G.radius?A-B:B-A}else F=G.constraints.clampTilt(G.eyeCenterDistance,G.tiltAtCenter),H&&F<Math.PI/2&&(H.requiresTwoSteps=!0,F=Math.PI/2-1E-5),A=G.tiltAtCenter-Math.PI/2-(F-Math.PI/2);H&&(H.eyeCenterDistance=q(G,F));H=A}else H=0;break a;case "local":I=w.viewAngle(A.renderCoordsHelper,F.center,F.eye);G=g.clamp(I,B.min,B.max);B=I-G;1E-9<Math.abs(B)?(H&&(I=A.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,A=A.renderCoordsHelper.getAltitude(F.eye)-
I,G=Math.cos(G),H.eyeCenterDistance=1E-4<Math.abs(G)?A/G:F.distance),H=B):H=0;break a}H=void 0}return H}H=w.viewAngle(A.renderCoordsHelper,F.center,F.eye);G=g.clamp(H,B.min,B.max);H-=G;H=1E-9<Math.abs(H)?H:0;return H}function q(A,F){if(!A.centerIsOnSurface)return A.eyeCenterDistance;F=Math.PI-g.clamp(F,0,Math.PI);const G=g.asinClamped(A.radius/A.eyeRadius*Math.sin(F)),I=Math.sin(Math.PI-F-G)/Math.sin(F);return A.eyeRadius<A.radius&&1<I?Math.sin(Math.PI-F-(Math.PI-G))/Math.sin(F)*A.eyeRadius:I*A.eyeRadius}
function t(A,F,G){var I=A.state.constraints;if(!A.state.isLocal&&I.altitude&&F){var H=m.squaredLength(F.center),B=Math.sqrt(H);F=F.distance;var K=c.getReferenceEllipsoid(A.spatialReference).radius;A=I.altitude.min+K;I=I.altitude.max+K;A=(A*A-F*F-H)/(-2*B*F);G.min=Math.max(G.min,Math.min(Math.PI-g.acosClamped((I*I-F*F-H)/(-2*B*F)),G.max));G.max=Math.min(G.max,Math.PI-g.acosClamped(A))}}const v=f.create(),r=k.create(),y=f.create(),z=g.deg2rad(5),D={min:0,max:0},C={constraints:null,radius:0,eyeRadius:0,
centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},E={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=x;a.getTiltConstraintError=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,g,d){const k=d.create(),m=d.create();a.viewAngle=function(f,c,l){f.worldUpAtPosition(c,k);g.subtract(m,l,c);f=g.length(m);
return 0===f?0:b.acosClamped(g.dot(m,k)/f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(O){const U=2*(O-Math.sqrt((O-1)*O)),Z=U/2/O;return P=>P<Z?O*P*P:U*P-U+1}function g(O,U){return(Z,P)=>Z<U?U*O(Z/U,P):1-O((1-Z)/(1-U),P)*(1-U)}const d=O=>O,k=O=>O*O,m=O=>1-k(1-O),f=O=>.5>O?k(2*O)/2:(1-k(1-2*(O-.5))+1)/2,c=O=>O*O*O,l=O=>1-c(1-O),e=O=>.5>O?c(2*O)/2:(1-c(1-2*(O-.5))+1)/2,p=O=>O*O*O*O,h=O=>1-p(1-O),
u=O=>.5>O?p(2*O)/2:(1-p(1-2*(O-.5))+1)/2,w=O=>O*O*O*O*O,x=O=>1-w(1-O),n=O=>.5>O?w(2*O)/2:(1-w(1-2*(O-.5))+1)/2,q=O=>-Math.cos(O*Math.PI/2)+1,t=O=>1-q(1-O),v=O=>.5>O?q(2*O)/2:(1-q(1-2*(O-.5))+1)/2,r=O=>2**(10*(O-1)),y=O=>1-2**(10*(1-O-1)),z=O=>.5>O?2**(10*(2*O-1))/2:(1-2**(10*(1-2*(O-.5)-1))+1)/2,D=O=>-(Math.sqrt(1-O*O)-1),C=O=>1-D(1-O),E=O=>.5>O?D(2*O)/2:(1-D(1-2*(O-.5))+1)/2,A=g(b(1),1),F=g(b(1),0),G=g(b(1),.5),I=g(b(2),1),H=g(b(2),0),B=g(b(2),.5),K=g(b(3),1),L=g(b(3),0),J=g(b(3),.5),M=g(b(4),1),
T=g(b(4),0),Q=g(b(4),.5);a.EasingFunctions={linear:d,"in-quad":k,"out-quad":m,"in-out-quad":f,"in-coast-quad":A,"out-coast-quad":F,"in-out-coast-quad":G,"in-cubic":c,"out-cubic":l,"in-out-cubic":e,"in-coast-cubic":I,"out-coast-cubic":H,"in-out-coast-cubic":B,"in-quart":p,"out-quart":h,"in-out-quart":u,"in-coast-quart":K,"out-coast-quart":L,"in-out-coast-quart":J,"in-quint":w,"out-quint":x,"in-out-quint":n,"in-coast-quint":M,"out-coast-quint":T,"in-out-coast-quint":Q,"in-sine":q,"out-sine":t,"in-out-sine":v,
"in-expo":r,"out-expo":y,"in-out-expo":z,"in-circ":D,"out-circ":C,"in-out-circ":E};a.inCirc=D;a.inCoastCubic=I;a.inCoastQuad=A;a.inCoastQuart=K;a.inCoastQuint=M;a.inCubic=c;a.inExpo=r;a.inOutCirc=E;a.inOutCoastCubic=B;a.inOutCoastQuad=G;a.inOutCoastQuart=J;a.inOutCoastQuint=Q;a.inOutCubic=e;a.inOutExpo=z;a.inOutQuad=f;a.inOutQuart=u;a.inOutQuint=n;a.inOutSine=v;a.inQuad=k;a.inQuart=p;a.inQuint=w;a.inSine=q;a.linear=d;a.outCirc=C;a.outCoastCubic=H;a.outCoastQuad=F;a.outCoastQuart=L;a.outCoastQuint=
T;a.outCubic=l;a.outExpo=y;a.outQuad=m;a.outQuart=h;a.outQuint=x;a.outSine=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){a.PointToPointAnimationController=class extends p.AnimationController{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(q){super(q);this.mode="interaction";this._hasTarget=!1}initialize(){this.animation=new e.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new l}get isInteractive(){return"interaction"===this.mode}begin(q,t){this._hasTarget=!0;t=this.animationSettings(t);x.copyFrom(this.view.state.camera);
const v=u.newIntersector(this.view.state.viewingMode);this.intersectionHelper.intersectRay(x.ray,v,n)&&(x.center=n);this.animation.update(x,q,t);this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time;super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(q,t){this._hasTarget&&this.animation.step(q,t)}onControllerEnd(q){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,q),this.animation.currentTime=
this.animation.time);super.onControllerEnd(q)}animationSettings(q={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...q,easing:"string"===typeof q.easing?w.EasingFunctions[q.easing]:q.easing}}};b.__decorate([g.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);b.__decorate([g.property({readOnly:!0})],a.PointToPointAnimationController.prototype,"isInteractive",null);a.PointToPointAnimationController=
b.__decorate([f.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const x=new h.Camera,n=c.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(a,b,g,d,k,m,f){const c=d.create();
class l{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=b.Milliseconds(0);this._animation=new f.Animation(()=>new k(e));this._current=new k(e)}update(e,p,h){const u=this._animation.definition.source,w=this._animation.definition.target,x=g.subtract(c,p.center,e.center),n=g.length(x);1E-5<=n?(x[0]/=n,x[1]/=n,x[2]/=n):(x[0]=0,x[1]=1,x[0]=0);g.copy(u.lookAtDirection,x);g.copy(w.lookAtDirection,x);u.copyFromRenderCamera(e);
w.copyFromRenderCamera(p);this._current.copyFrom(u);this._animation.update(u,w,h);this.currentTime=b.Milliseconds(0);e.almostEquals(p)&&(this.currentTime=this._animation.time)}cameraAt(e,p){this._animation.cameraAt(e,this._current);p=p||new m.Camera;this._current.copyToRenderCamera(p);return p}step(e,p){this.finished||(this.currentTime=b.Milliseconds(this.currentTime+b.millisecondsFromSeconds(e)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,
p)}}a.Animation=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,b,g,d,k,m,f){const c=k.create(),l=k.create(),e=k.create(),p=k.create(),h=k.create(),u=k.create();var w=k.fromValues(0,0,1),x=k.fromValues(0,1,0),n=k.fromValues(1,
0,0);const q=g.create();class t{constructor(v=m.ViewingMode.Global){this.viewingMode=v;this.center=k.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=k.clone(x)}pixelsPerPanAtZoom(v){return this.size/2/(this._zoomToPanScale*v)}zoomAtPixelsPerPan(v){return this.size/2/(this._zoomToPanScale*v)}pixelsPerRotateAtZoom(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)}compareTo(v,r){r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===m.ViewingMode.Global){var y=
d.length(this.center);const z=d.length(v.center);y=(y+z)/2;r.pan=f.angle(this.center,v.center)*y}else r.pan=d.distance(this.center,v.center);y=Math.abs(v.yaw-this.yaw);y>=Math.PI&&(y=2*Math.PI-y);r.rotate=Math.max(y,Math.abs(v.pitch-this.pitch));r.sourceZoom=this.distance;r.targetZoom=v.distance;return r}interpolate(v,r,y){this.viewingMode===m.ViewingMode.Global?f.slerp(v.center,r.center,y.pan,this.center):d.lerp(this.center,v.center,r.center,y.pan);this.distance=isFinite(r.distance)?a.lerp(v.distance,
r.distance,y.zoom):v.distance;this.pitch=a.lerp(v.pitch,r.pitch,y.rotate);v=v.yaw;r=r.yaw;Math.abs(r-v)>=Math.PI&&(v+=2*(v<r?1:-1)*Math.PI);this.yaw=a.lerp(v,r,y.rotate)}copyFrom(v){d.copy(this.center,v.center);this.pitch=v.pitch;this.yaw=v.yaw;this.distance=v.distance;d.copy(this.lookAtDirection,v.lookAtDirection);this.size=v.size;this.copyFromCommon(v);this.viewingMode=v.viewingMode}copyFromRenderCamera(v){const r=this._lookAtOrientation(v.center,q);d.copy(this.center,v.center);d.subtract(p,v.center,
v.eye);d.transformMat3(p,p,r);d.transformMat3(h,v.up,r);this.distance=d.length(p);0!==this.distance&&(p[0]/=this.distance,p[1]/=this.distance,p[2]/=this.distance);this.pitch=this._eyeUpToPitch(p);this.yaw=this._eyeUpToYaw(p,h);this.size=Math.sqrt(v.width*v.width+v.height*v.height);this.copyFromCommon(v)}copyFromCommon(v){this.fov=v.fov;this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(v){const r=this._lookAtOrientation(this.center,q);b.transpose(r,r);this._axisAngleVec3(n,this.pitch-
Math.PI/2,x,p);this._axisAngleVec3(w,this.yaw,p);this._axisAngleVec3(n,this.pitch-Math.PI/2,w,h);this._axisAngleVec3(w,this.yaw,h);d.scale(p,p,this.distance);d.transformMat3(p,p,r);d.transformMat3(h,h,r);v.center=this.center;v.eye=d.subtract(p,this.center,p);v.up=h}_axisAngleVec3(v,r,y,z=y){const D=Math.cos(r);r=Math.sin(r);d.scale(c,y,D);d.cross(l,v,y);d.scale(l,l,r);d.scale(e,v,(1-D)*d.dot(v,y));return d.add(z,d.add(z,c,l),e)}_lookAtOrientation(v,r=g.create()){this._upAtLookAt(v,e);d.cross(c,this.lookAtDirection,
e);d.normalize(c,c);0===c[0]&&0===c[1]&&0===c[2]&&d.copy(c,n);d.cross(l,e,c);d.normalize(l,l);r[0]=c[0];r[1]=l[0];r[2]=e[0];r[3]=c[1];r[4]=l[1];r[5]=e[1];r[6]=c[2];r[7]=l[2];r[8]=e[2];return r}_upAtLookAt(v,r){return this.viewingMode===m.ViewingMode.Local?d.copy(r,w):d.normalize(r,v)}_eyeUpToPitch(v){return Math.PI-f.angle(w,v)}_eyeUpToYaw(v,r){.5>Math.abs(r[2])?(d.copy(u,r),0<v[2]&&d.scale(u,u,-1)):d.copy(u,v);d.cross(l,u,w);d.normalize(l,l);return f.angle(n,l,w)}}return t})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(a,b,g,d,k,m){const f={zoom:0,pan:0,rotate:0};a.Animation=class{get time(){return this._time}constructor(c){this._createCamera=c;this._time=b.Milliseconds(0);this.definition=new d.Definition(c);this.path=new m.Path}update(c,l,e){this.definition.update(c,l,e);this.path.update(this.definition,e);this._time=this._applyTimeSettings(b.millisecondsFromSeconds(isFinite(this.path.time)?this.path.time:b.Seconds(0)),e);this._easing=e.easing??(1E3<=this._time?g.inOutCoastQuad:g.outExpo)}cameraAt(c,l){l=
l||this._createCamera();c=Math.min(Math.max(0,c),1);c=this._normalizedEasing(c);c=this.path.interpolateComponentsAt(c,f);l.interpolate(this.definition.source,this.definition.target,c);return l}_normalizedEasing(c){const l=this._easing(0,this._time),e=this._easing(1,this._time);return(this._easing(c,this._time)-l)/(e-l)}_applyTimeSettings(c,l){const e=null!=l.speedFactor?l.speedFactor:1;null!=l.duration?c=l.duration:null!=l.speedFactor&&(c=b.Milliseconds(c/e));return b.Milliseconds(Math.min(Math.max(null!=
l.minDuration?l.minDuration:k.defaultSettings.minDuration/e,c),null!=l.maxDuration?l.maxDuration:k.defaultSettings.maxDuration/e))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","./Settings"],function(a,b){class g{constructor(d){this._createCamera=d;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:b.defaultSettings.desiredScreenFlow};this.source=d();this.target=d()}clone(){const d=
new g(this._createCamera);d.copyFrom(this);return d}copyFrom(d){this.update(d.source,d.target,d.settings)}update(d,k,m){this.source!==d&&this.source.copyFrom(d);this.target!==k&&this.target.copyFrom(k);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=m.desiredScreenFlow?m.desiredScreenFlow:b.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(d){d=
this.target.pixelsPerPanAtZoom(d);return this.halfWindowSize/d}get hasZoom(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}get hasPan(){return 1E-9<this.compared.pan}get hasRotate(){return 1E-9<this.compared.rotate}}a.Definition=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};
a.defaultSettings=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/Path":function(){define(["exports","../../easing","../Path","../Segment","./planning"],function(a,b,g,d,k){class m extends g.Path{constructor(f,c){super();this._preallocSegments=[new d.Segment,new d.Segment,new d.Segment];this._descensionSegment=this._ascensionSegment=null;this.update(f,c)}update(f,c){if(f){this.definition?this.definition.copyFrom(f):this.definition=f.clone();
var l=null;c?.apex&&(l=k.optimalDistance(f,c.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==l?this._updateWithoutApex():this._updateWithApex(l,c?.apex)}}segmentInterpolateComponentsAt(f,c,l){l=f.interpolateComponentsAt(c,l);f===this._ascensionSegment?l.zoom=b.outQuad(l.zoom):f===this._descensionSegment&&(l.zoom=b.inQuad(l.zoom));return l}_updateWithApex(f,c){const [l,e,p]=this._preallocSegments,h=c?.ascensionFactor??.5;c=Math.min(1-h,null!=c?.ascensionFactor&&
null!=c.descensionFactor?c.descensionFactor:.5);const u=1-h-c;l.definition?l.definition.copyFrom(this.definition):l.definition=this.definition.clone();l.definition.compared.targetZoom=f;l.definition.compared.pan=this.definition.compared.pan*h;l.definition.compared.rotate=this.definition.compared.rotate*h;l.update();this._ascensionSegment=l;this.segments.push(l);0<u&&(e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=
f,e.definition.compared.targetZoom=f,e.definition.compared.pan=this.definition.compared.pan*u,e.definition.compared.rotate=this.definition.compared.rotate*u,e.update(),this.segments.push(e));p.definition?p.definition.copyFrom(this.definition):p.definition=this.definition.clone();p.definition.compared.sourceZoom=f;p.definition.compared.pan=this.definition.compared.pan*c;p.definition.compared.rotate=this.definition.compared.rotate*c;p.update();this._descensionSegment=p;this.segments.push(p)}_updateWithoutApex(){const [f]=
this._preallocSegments;f.update(this.definition);this.segments.push(f)}}a.Path=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../core/time"],function(a,b){a.Path=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((g,d)=>b.Seconds(g+d.time),b.Seconds(0))}interpolateComponentsAt(g,d){g=Math.min(Math.max(g,0),1);g*=this.time;let k=0,m=0;const f=this.definition;for(let c=0;c<this.segments.length;c++){const l=
this.segments[c],e=l.definition;if(g<=l.time||c===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(l,0===l.time?0:g/l.time,d),f.hasPan&&!isNaN(d.pan)&&isFinite(f.compared.pan)?d.pan=(k+e.compared.pan*d.pan)/f.compared.pan:d.pan=1,f.hasRotate&&!isNaN(d.rotate)&&isFinite(f.compared.rotate)?d.rotate=(m+e.compared.rotate*d.rotate)/f.compared.rotate:d.rotate=1,f.hasZoom&&!isNaN(d.zoom)&&isFinite(e.compared.targetZoom)?(g=this.segments[0].definition.compared.sourceZoom,d.zoom=(d.zoom*
(e.compared.targetZoom-e.compared.sourceZoom)+e.compared.sourceZoom-g)/(this.segments[this.segments.length-1].definition.compared.targetZoom-g)):d.zoom=1,d;g-=l.time;k+=e.compared.pan;m+=e.compared.rotate}}segmentInterpolateComponentsAt(g,d,k){return g.interpolateComponentsAt(d,k)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../core/time"],function(a,b){class g{get time(){return this._time}constructor(d){d&&
this.update(d)}update(d){d&&(this.definition?this.definition.copyFrom(d):this.definition=d.clone());this._updatePrecomputedVariables();this._updatePixelFlow()}_updatePrecomputedVariables(){var d=this.definition;const k=d.compared,m=k.sourceZoom,f=k.targetZoom;this._zoomSign=m>f?1:-1;this._panPixelsAtSource=k.pan*d.source.pixelsPerPanAtZoom(m);d=(d.source.pixelsPerRotateAtZoom(m)+d.target.pixelsPerRotateAtZoom(f))/2;this._rotatePixels=k.rotate*d}_updatePixelFlow(){var d=this.definition.compared.sourceZoom,
k=this.definition.compared.targetZoom;const {hasZoom:m,hasPan:f,hasRotate:c}=this.definition;var l=0,e=0;m&&(f&&(l=(k/d-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),c&&(e=Math.log(d/k)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;d=this.definition.desiredPixelFlow;m&&f&&c?(k=l+e+l*e,this._zoomPixelFlow=l*e/k*d,this._panPixelFlow=e/k*d,this._rotatePixelFlow=l/k*
d):m&&f?(e=1+l,this._zoomPixelFlow=l/e*d,this._panPixelFlow=1/e*d):m&&c?(l=1+e,this._zoomPixelFlow=e/l*d,this._rotatePixelFlow=1/l*d):f&&c?(l=this._panPixelsAtSource/this._rotatePixels,e=1+l,this._panPixelFlow=l/e*d,this._rotatePixelFlow=1/e*d):f?this._panPixelFlow=d:m?this._zoomPixelFlow=d:c&&(this._rotatePixelFlow=d);this._time=c?this.rotateTime:m?this.zoomTime:f?this.panTime:b.Seconds(0)}get rotateTime(){return this.definition.hasRotate?b.Seconds(this._rotatePixels/this._rotatePixelFlow):b.Seconds(0)}get zoomTime(){return this.definition.hasZoom?
b.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):b.Seconds(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const d=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return b.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*d+1)/(d*this._zoomPixelFlow))}return b.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return b.Seconds(0)}_interpolateComponentsZoom(d){if(0===
d||1===d)return d;if(this.definition.hasZoom){const k=this.definition.compared.sourceZoom,m=this.definition.compared.targetZoom;return(k*(k/m)**-d-k)/(m-k)}return d}_interpolateComponentsPan(d){if(0===d||1===d)return d;if(this.definition.hasPan&&this.definition.hasZoom){const k=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(k*d*this._time)-1)/(k*Math.LN2)}return d}_interpolateComponentsRotate(d){return d}interpolateComponentsAt(d,
k){d=Math.min(Math.max(d,0),1);const m=this._interpolateComponentsZoom(d),f=this._interpolateComponentsPan(d);d=this._interpolateComponentsRotate(d);k?(k.zoom=m,k.pan=f,k.rotate=d):k={zoom:m,pan:f,rotate:d};return k}}a.Segment=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(a,b){function g(d,k){const m=Math.max(d.compared.sourceZoom,d.compared.targetZoom);d=d.source.zoomAtPixelsPerPan(d.desiredPixelFlow/
d.compared.pan)/2;return d<m?null!=k.maximumDistance?m+(k.maximumDistance-m)/2:1.5*m:k.maximumDistance?Math.min(k.maximumDistance,d):d}a.optimalDistance=function(d,k){let m=g(d,k);const f={ascensionFactor:null!=k.ascensionFactor?k.ascensionFactor:.5,descensionFactor:null!=k.descensionFactor?k.descensionFactor:.5};var c=0===f.ascensionFactor,l=0===f.descensionFactor;const e=c?b.tAscensionZoomOnly:b.tAscensionZoomPan,p=c?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,h=c?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,
u=l?b.tDescensionZoomOnly:b.tDescensionZoomPan,w=l?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,x=l?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;c=z=>e(d,z,f)+b.tPanion(d,z,f)+u(d,z,f);l=z=>p(d,z,f)+b.dtPanion(d,z,f)+w(d,z,f);const n=z=>h(d,z,f)+b.ddtPanion(d,z,f)+x(d,z,f);let q=c(m);const t=b.tBaseLine(d),v=k.maximumIterations||20,r=null!=k.maximumDistance?k.maximumDistance:Infinity;for(k=0;k<v;k++){var y=(l(m)+1E-6)/n(m);if(isNaN(y)||m>=r&&0>y){if(!isFinite(r))return null;m=r;q=c(m);break}m-=
y;if(m<d.compared.sourceZoom||m<d.compared.targetZoom)return null;y=c(m);if(.005>=Math.abs(y-q)/q)break;q=y}return q>.7*t||m<d.compared.sourceZoom||m<d.compared.targetZoom?null:m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=function(b,g){return-b.halfWindowSize/(g*g*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,g,d){const k=g-b.compared.sourceZoom,
m=1/k,f=1/g,c=Math.log(b.compared.sourceZoom*f);d=(d.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(k))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*m*(-2*m*f*d+2*m*c+2*f-2*c*d/(k*k)-d/(g*g))/(b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(b,g){return-b.halfWindowSize/(g*g*b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=function(b,g,d){const k=g-b.compared.targetZoom,m=1/k,f=1/g,c=Math.log(g/b.compared.targetZoom);d=(b.halfWindowPanAtZoom(g)+d.descensionFactor*
Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*m*(-2*m*f*d-2*m*c+2*f+2*c*d/(k*k)-d/(g*g))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,g,d){return-2*b.compared.pan*b.halfWindowSize*(d.ascensionFactor+d.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(g*g*g))};a.dtAscensionZoomOnly=function(b,g){return b.halfWindowSize/(g*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,g,d){const k=1/g,m=Math.log(b.compared.sourceZoom*
k),f=1/b.desiredPixelFlow,c=1/Math.LN2;g-=b.compared.sourceZoom;const l=1/g;d=(d.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(g))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*k*f*c*l*d-b.halfWindowSize*m*f*c*l+b.halfWindowSize*m*f*c*d/(g*g)};a.dtDescensionZoomOnly=function(b,g){return b.halfWindowSize/(g*b.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(b,g,d){const k=Math.log(g/b.compared.targetZoom),m=1/b.desiredPixelFlow,f=1/Math.LN2,c=-g+b.compared.targetZoom,l=
1/c;d=(-b.halfWindowPanAtZoom(g)-d.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*k*m*f*l+b.halfWindowSize*k*m*f*d/(c*c)+b.halfWindowSize*m*f*l*d/g};a.dtPanion=function(b,g,d){return b.compared.pan*b.halfWindowSize*(d.ascensionFactor+d.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(g*g))};a.tAscensionZoomOnly=function(b,g){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/g)/(b.desiredPixelFlow*
Math.LN2)};a.tAscensionZoomPan=function(b,g,d){const k=b.halfWindowPanAtZoom(g-b.compared.sourceZoom);return-b.halfWindowSize*(d.ascensionFactor*Math.LN2*b.compared.pan+k)*Math.log(b.compared.sourceZoom/g)/(b.desiredPixelFlow*Math.LN2*k)};a.tBaseLine=function(b){const g=Math.LN2*b.compared.pan,d=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),k=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*d);return b.compared.sourceZoom<=b.compared.targetZoom?
k*(g-d):k*(g+d)};a.tDescensionZoomOnly=function(b,g){return b.halfWindowSize*Math.log(g/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,g,d){return b.halfWindowSize*(-b.halfWindowPanAtZoom(g)-d.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(g/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-g+b.compared.targetZoom))};a.tPanion=function(b,g,d){return-b.compared.pan*b.halfWindowSize*(d.ascensionFactor+
d.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(g))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){a.AnimationController=class extends h.CameraController{constructor(){super(...arguments);this._asyncResult=null}get canStop(){return!0}set asyncResult(u){this._asyncResult&&(this._asyncResult.reject(d.createAbortError()),this._asyncResult=null);this.state===h.State.Finished||this.state===h.State.Stopped?(g.assertIsSome(u),this.state===h.State.Finished?u.resolve():u.reject(d.createAbortError())):this._asyncResult=u}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=
h.State.Running;null!=this.viewAnimation&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){null==this.viewAnimation||this.state!==h.State.Ready&&this.state!==h.State.Running||(this.viewAnimation.state===p.State.FINISHED?this.finish():this.viewAnimation.state===p.State.STOPPED&&(this.state=h.State.Stopped))}onControllerEnd(){null==this.viewAnimation||this.viewAnimation.done||(this.state===h.State.Finished?this.viewAnimation.finish():
this.state===h.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===h.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(d.createAbortError()))}finish(){this.finishController()}};a.AnimationController=b.__decorate([e.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){a.State=void 0;(function(l){l.Ready="ready";l.Rejected="rejected";l.Running="running";l.Stopped="stopped";l.Finished="finished"})(a.State||(a.State={}));a.CameraController=class extends g{constructor(l){super(l);this.state=a.State.Ready}get active(){return this.state===a.State.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return this.canStop?(this.state=a.State.Stopped,!0):!1}finishController(){this.state=a.State.Finished}get steppingFinished(){return!1}};
b.__decorate([d.property({constructOnly:!0})],a.CameraController.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.CameraController.prototype,"active",null);b.__decorate([d.property()],a.CameraController.prototype,"state",void 0);b.__decorate([d.property({readOnly:!0})],a.CameraController.prototype,"isInteractive",null);a.CameraController=b.__decorate([c.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){function y(qa,la,ja){ja=k.fromRotation(n.sm4d.get(),ja[3],p.axis(ja));null==ja||k.exactEquals(ja,m.IDENTITY)||(l.subtract(aa,qa.eye,la),l.transformMat4(aa,aa,ja),qa.eye=l.add(aa,aa,la),l.subtract(aa,qa.center,la),l.transformMat4(aa,aa,ja),qa.center=l.add(aa,aa,la),qa.up=l.transformMat4(aa,qa.up,ja))}function z(qa,la,ja,oa){return Math.sin(qa/l.length(la))*(ja+oa.radius)}function D(qa,la,ja,oa){ja=q.fromScreenAtEye(la,ja,ra);if(null==ja)return!1;w.closestPointOnSilhouette(qa,
ja,O);return w.intersectRay(qa,ja,oa)?l.squaredDistance(O,ja.origin)<l.squaredDistance(oa,ja.origin)?(l.copy(oa,O),!1):!0:(l.subtract(U,la.eye,la.center),l.normalize(U,U),u.fromNormalAndOffset(U,-l.dot(l.normalize(U,U),O),Z),u.intersectRay(Z,ja,oa),!1)}function C(qa,la,ja,oa,za,ta){var Ca=0;l.cross(ua,qa,la);l.subtract(da,qa,la);l.length(qa)<=za||!oa.aboveGround?(l.cross(ja,da,oa.eye),Ca=l.dot(qa,la)/(l.length(qa)*l.length(la)),.9999>Ca?Ca=g.acosClamped(Ca):(qa=l.length(l.cross(e.create(),qa,la))/
(l.length(qa)*l.length(la)),Ca=g.asinClamped(qa)),ta=Math.cos(g.clamp(b.cyclicalPI.normalize(g.deg2rad(ta)),0,T)),Ca=-Ca-Math.max(0,l.length(la)-za)/(ta*za)):(l.subtract(P,oa.eye,oa.center),l.cross(ja,da,P),Ca=-l.length(da)/za);l.normalize(ja,ja);l.scale(ja,ja,l.length(ua));return Ca}function E(qa,la,ja,oa){oa=Math.cos(g.clamp(b.cyclicalPI.normalize(g.deg2rad(oa)),0,T));la=la>ja?-(la-ja)/(oa*ja):la<-ja?Math.PI-(la+ja)/(oa*ja):g.acosClamped(la/ja);return((qa>ja?-(qa-ja)/(oa*ja):qa<-ja?Math.PI-(qa+
ja)/(oa*ja):g.acosClamped(qa/ja))-la)*ja}function A(qa,la,ja,oa,za,ta,Ca,Ga,La,Ma){Ga=E(qa[2],la[2],ta[3],Ga);la=La?E(qa[0],la[0],ta[3],180):la[0]-qa[0];qa=Math.sin(Ca)*la-Math.cos(Ca)*Ga;Ca=Math.cos(Ca)*la+Math.sin(Ca)*Ga;l.normalize(aa,za);za=La?qa/Math.sqrt(Math.abs(ta[3]**2-l.dot(ja,aa)**2)):qa/ta[3];ja=Ca/Math.sqrt(Math.abs(ta[3]**2-l.dot(ja,oa)**2));f.set(Ma,za,ja)}function F(qa,la,ja,oa,za,ta,Ca,Ga,La,Ma){l.cross(ua,qa,la);h.coordinateSystemFromOneAxisAndNormalVector(ta.up,ta.eye,V,S,X);h.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],ta.eye,R,W,N);l.copy(ja,W);l.copy(oa,R);l.normalize(ja,ja);l.scale(ja,ja,l.length(ua));h.vectorCoordinates(qa,l.normalize(S,S),l.normalize(X,X),l.normalize(V,V),ca);h.vectorCoordinates(la,S,X,V,ba);A(ca,ba,qa,R,W,Ca,Ga,La,Ma,za)}function G(qa,la,ja,oa,za,ta,Ca){k.fromRotation(na,za,oa);k.fromRotation(Y,Ca,ta);k.multiply(ea,na,Y);l.subtract(la,qa,ja);l.transformMat4(la,la,ea);l.add(la,la,ja)}function I(qa,la,ja,oa,za,ta){k.fromRotation(na,oa,ja);k.fromRotation(Y,ta,za);k.multiply(ea,na,Y);l.subtract(aa,
qa.eye,la);l.transformMat4(aa,aa,ea);qa.eye=l.add(aa,aa,la);l.subtract(aa,qa.center,la);l.transformMat4(aa,aa,ea);qa.center=l.add(aa,aa,la);l.subtract(aa,qa.up,la);l.transformMat4(aa,aa,ea);qa.up=l.add(aa,aa,la)}function H(qa,la,ja,oa,za,ta){return(Math.abs(oa)>Math.PI-M.Angle||Math.abs(oa)<M.Angle)&&(Math.abs(qa[2])<ja*M.Pole||Math.abs(la)>ja)&&ta.aboveGround&&za<M.Tilt}function B(qa,la,ja,oa,za,ta){ta?(p.fromPoints(ja,oa,ka),y(la,qa,ka)):(ja=C(ja,oa,sa,la,qa[3],za),y(la,qa,p.wrapAxisAngle(sa,ja)))}
function K(qa,la,ja,oa,za,ta,Ca){const Ga=Ca?20:1;l.copy(fa,oa);ma.copyFrom(la);let La;for(let Ma=0;Ma<Ga&&1E-12<l.squaredDistance(ja,fa);Ma++)if(oa=l.squaredDistance(ja,fa),F(ja,fa,W,R,ia,ma,qa,za,ta,Ca),I(ma,qa,R,ia[1],W,ia[0]),G(fa,fa,qa,R,ia[1],W,ia[0]),La=l.squaredDistance(ja,fa),La<oa||0===Ma)la.copyFrom(ma);else break}a.SpherePickPointFallback=void 0;(function(qa){qa[qa.Ellipsoid=0]="Ellipsoid";qa[qa.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||(a.SpherePickPointFallback={}));r=
{exclude:new Set([r.terrainId])};const L=d.createScreenPointArray();a.NavigationMode=void 0;(function(qa){qa[qa.Vertical=0]="Vertical";qa[qa.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const J={Elevation:3E4,Angle:g.deg2rad(16)},M={Pole:.95,Angle:g.deg2rad(18),Tilt:45},T=g.deg2rad(80),Q=e.create(),O=e.create(),U=e.create(),Z=u.create(),P=e.create(),R=e.create(),W=e.create(),N=e.create(),V=e.create(),S=e.create(),X=e.create(),ca=e.create(),ba=e.create(),ia=c.create(),ka=p.create(),
na=m.create(),Y=m.create(),ea=m.create(),fa=e.create(),aa=e.create(),da=e.create(),ma=new v.Camera,ua=e.create(),sa=e.create(),ra={origin:e.create(),direction:e.create()},Aa={origin:e.create(),direction:e.create()};a.PreservingHeadingThreshold=M;a.TiltThresholdPanningSpeed=T;a.VerticalPanTresholds=J;a.applyPanPlanar=function(qa,la,ja){l.subtract(Q,ja,la);qa.eye=l.subtract(aa,qa.eye,Q);qa.center=l.subtract(aa,qa.center,Q)};a.applyPanSphericalDirectRotation=B;a.applyPanSphericalPreserveHeading=K;a.applyRotation=
y;a.applyRotationWithTwoAxes=I;a.applyZoomOnSphere=function(qa,la,ja){la.getScreenCenter(L);t.intersectScreen(qa,la,L,aa)&&(la.center=aa);qa=la.distance;ja*=qa;1E-6>Math.abs(qa-ja)||(ja=l.scale(n.sv3d.get(),la.viewForward,ja),la.eye=l.subtract(aa,la.center,ja))};a.applyZoomToPoint=function(qa,la,ja,oa){const za=n.sv3d.get();ja=1-ja;l.subtract(za,la,qa.eye);const ta=l.length(za);let Ca=ta*(1-ja);0<=ja&&Ca<oa&&(Ca=oa,ja=-(Ca-ta)/ta);1E-6>Math.abs(ta-Ca)||(l.scale(za,za,ja),qa.eye=l.add(aa,qa.eye,za),
qa.center=l.lerp(aa,qa.center,la,ja))};a.centroid=function(qa,la){l.set(la,0,0,0);for(const ja of qa)l.add(la,la,ja);l.scale(la,la,1/qa.length)};a.contentIntersectorOptions=r;a.decideNavigationMode=function(qa,la,ja){if(l.length(qa.eye)-ja.radius>J.Elevation)return a.NavigationMode.Horizontal;q.fromScreenAtEye(qa,la,Aa);return-Math.sign(qa.relativeElevation)*(.5*Math.PI+x.angle(qa.eye,Aa.direction))<J.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.distanceClampValues=[1,3E8];a.intersectPlaneFromScreenPoint=
function(qa,la,ja,oa){return u.intersectRay(qa,q.fromScreen(la,ja,ra),oa)};a.intersectPlaneFromScreenPointAtEye=function(qa,la,ja,oa){return u.intersectRay(qa,q.fromScreenAtEye(la,ja,ra),oa)};a.lengthFromPoints=E;a.minHeightLimit=50;a.normalizeCoordinate=function(qa,la,ja){ja[0]=la[0]/(qa.fullWidth/qa.pixelRatio);ja[1]=la[1]/(qa.fullHeight/qa.pixelRatio);return ja};a.normalizeRotationDelta=function(qa){for(;qa>Math.PI;)qa-=2*Math.PI;for(;qa<-Math.PI;)qa+=2*Math.PI;return qa};a.offSurfaceTiltToEyeTiltGlobal=
function(qa,la,ja,oa){return z(Math.PI/2,la,ja,oa)+(qa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=z;a.panDistanceModifier=5;a.panMotionToRotationMatrix=function(qa,la,ja,oa,za,ta,Ca,Ga,La){if(H(qa.center,l.dot(qa.up,qa.center),l.length(qa.center),-b.cyclicalPI.normalize(g.deg2rad(ta)),Ca,la))switch(qa=-b.cyclicalPI.normalize(g.deg2rad(za)),{eye:za}=la,h.coordinateSystemFromOneAxisAndNormalVector([0,0,1],za,R,W,N),za=ja.translation[0]*oa.pan,ta="zoom"===La.mode?0:ja.translation[1]*oa.pan,la=Math.max(Math.sqrt(Math.abs(1-
l.dot(la.center,R)**2/l.length(la.center)**2)),.5),Ca=-Math.cos(qa)*ta+Math.sin(qa)*za,k.rotate(Ga.pan.matrix,Ga.pan.matrix,(Math.sin(qa)*ta+Math.cos(qa)*za)/la,R),Ga.pan.enabled=!0,La.mode){case "pan":k.rotate(Ga.pan.matrix,Ga.pan.matrix,Ca,W);Ga.pan.enabled=!0;break;case "zoom":Ga.zoom=-ja.translation[1]*oa.zoom}else{const {eye:Ma,viewRight:Ra}=la;la=l.cross(n.sv3d.get(),Ra,Ma);qa=ja.translation[0]*oa.pan;0!==qa&&(k.rotate(Ga.pan.matrix,Ga.pan.matrix,-qa,la),Ga.pan.enabled=!0);switch(La.mode){case "pan":ja=
ja.translation[1]*oa.pan;0!==ja&&(k.rotate(Ga.pan.matrix,Ga.pan.matrix,ja,Ra),Ga.pan.enabled=!0);break;case "zoom":Ga.zoom=-ja.translation[1]*oa.zoom}}};a.panToPosition=function(qa,la,ja,oa,za,ta,Ca){H(ja,l.dot(la.up,ja),qa[3],-b.cyclicalPI.normalize(g.deg2rad(za)),ta,la)?K(qa,la,ja,oa,-b.cyclicalPI.normalize(g.deg2rad(za)),ta,Ca):B(qa,la,ja,oa,ta,Ca)};a.pickPointAndInitSphere=function(qa,la,ja,oa,za,ta){const Ca=e.create(),Ga=w.create();let La=!0,Ma=!0;qa.intersectScreen(ja,Ca,ta)?Ga[3]=l.length(Ca):
(Ma=!1,Ga[3]=la.aboveGround&&za!==a.SpherePickPointFallback.Ellipsoid?Math.max(l.length(la.center),.9*oa.radius):l.length(la.eye)-la.relativeElevation,za===a.SpherePickPointFallback.Silhouette?D(Ga,la,ja,Ca):La=t.intersectScreen(Ga,la,ja,Ca));return{sphere:Ga,scenePickPoint:La?Ca:null,hasGeometryIntersection:Ma}};a.pivotDistanceModifier=30;a.preserveHeadingThreshold=H;a.rotatePivotDistanceModifier=5;a.rotatePivotMinDistanceModifier=10;a.rotatePointAroundTwoAxes=G;a.rotateScreenPixelArea=90;a.rotationAngleAndAxisDirectRotation=
C;a.rotationAnglesAndAxesHeadingPreserving=F;a.rotationAnglesHeadingPreserving=A;a.screenPixelArea=80;a.sphereOrPlanePointFromScreenPoint=D;a.zoomDistanceModifier=8;a.zoomMaxDistanceModifier=1508E5;a.zoomMinDistanceModifier=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),function(a,b,g,d,k,m){function f(u=e){return[u[0],u[1],
u[2],u[3]]}function c(u,w,x,n,q=f()){q[0]=u;q[1]=w;q[2]=x;q[3]=n;return q}function l(u,w){u[3]=w;return u}const e=[0,0,1,0],p=g.create(),h=g.create();a.angle=function(u){return u[3]};a.axis=function(u){return u};a.compose=function(u,w,x){b.setAxisAngle(p,u,u[3]);b.setAxisAngle(h,w,w[3]);b.multiply(p,h,p);return l(x,b.getAxisAngle(x,p))};a.copy=function(u,w=f()){return c(u[0],u[1],u[2],u[3],w)};a.create=f;a.fromAxisAndAngle=function(u,w){const x=f();d.copy(x,u);x[3]=w;return x};a.fromPoints=function(u,
w,x){d.cross(x,u,w);d.normalize(x,x);x[3]=k.angle(u,w);return x};a.fromValues=c;a.setAngle=l;a.up=e;a.wrap=function(u,w,x,n){return c(u,w,x,n,m.sv4d.get())};a.wrapAxisAngle=function(u,w){return c(u[0],u[1],u[2],w,m.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks".split(" "),
function(a,b,g,d,k,m){function f(e,p,h){return c(e,e.screenToRender(p,b.castRenderScreenPointArray3(m.sv3d.get())),h)}function c(e,p,h){const u=b.castRenderScreenPointArray3(g.copy(m.sv3d.get(),p));u[2]=0;if(!e.unprojectFromRenderScreen(u,h.origin))return null;p=b.castRenderScreenPointArray3(g.copy(m.sv3d.get(),p));p[2]=1;e=e.unprojectFromRenderScreen(p,m.sv3d.get());if(null==e)return null;d.subtract(h.direction,e,h.origin);return h}function l(e,p,h){d.copy(h.origin,e.eye);p=d.set(m.sv3d.get(),p[0],
p[1],1);e=e.unprojectFromRenderScreen(p,m.sv3d.get());if(null==e)return null;d.subtract(h.direction,e,h.origin);return h}a.fromRender=c;a.fromRenderAtEye=l;a.fromScreen=f;a.fromScreenAtEye=function(e,p,h){return l(e,e.screenToRender(p,b.castRenderScreenPointArray3(m.sv3d.get())),h)};a.fromScreenNormalized=function(e,p,h=k.create()){f(e,b.screenPointObjectToArray(p),h);d.normalize(h.direction,h.direction);return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports",
"../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,g,d){const k=b.create();a.intersectScreen=function(m,f,c,l){f=d.fromScreenAtEye(f,c,k);return g.intersectRay(m,f,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../layers/VoxelWasm ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){a.ZoomStepController=class extends t.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=h.create();this._tmpCamera=new r.Camera;this._tmpRayDir=h.create();this._tmpCenter=h.create();this._constraintOptions={selection:w.ConstraintTypes.ALL,interactionType:x.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new r.Camera,interactionDirection:null,tiltMode:n.TiltMode.TUMBLE}}zoomStep(A,F){if(this.active){var G=
this.view.state,{interactionStartCamera:I}=this._constraintOptions;I&&(this.animation.finished?I.copyFrom(G.camera):this.animation.cameraAt(1,I));this._tmpCamera.copyFrom(G.camera);I=y.newIntersector(this.view.state.viewingMode);G=!1;0<A?(G=this.intersectionHelper.intersectScreenFreePointFallback(F,this._zoomLocation,0===this.view.map.ground.opacity?v.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,I,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):
this.intersectionHelper.intersectRay(this._tmpCamera.ray,I,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:p.copy(this._zoomLocation,this._tmpCamera.center);A=.6**A;F=this.view._stage.renderView.getMinimalDepthForArea(q.getVoxelWasm(this.view),F[0],F[1],this.view.state.camera,60);p.subtract(E,this._tmpCamera.eye,this._zoomLocation);p.normalize(E,E);I=g.clamp(Math.min(v.zoomDistanceModifier,1/Math.abs(p.dot(C,E)))*Math.abs(this.view.camera.position.z),v.zoomMinDistanceModifier,v.zoomMaxDistanceModifier);
if(F=null!=F?F:I)if(I=h.create(),p.subtract(I,this._zoomLocation,this._tmpCamera.eye),F<p.length(I)||!G)p.normalize(I,I),p.add(this._zoomLocation,this._tmpCamera.eye,p.scale(I,I,F));this._updateCamera(this._tmpCamera,A,this._zoomLocation);this.begin(this._tmpCamera)}}animationSettings(){return{duration:d.Milliseconds(600),easing:z.outExpo}}_updateCamera(A,F,G){p.subtract(this._tmpRayDir,G,A.eye);const I=p.length(this._tmpRayDir);let H=I*F;const B=Math.max(4,1.01*A.nearFar[0]);0!==H&&(1>=F&&H<B&&(H=
B,F=H/I),1E-6>Math.abs(I-H)||(p.scale(this._tmpRayDir,this._tmpRayDir,F),A.eye=p.subtract(D,G,this._tmpRayDir),A.center=p.lerp(D,A.center,G,1-F),u.applyAll(this.view,A,this._constraintOptions)))}};a.ZoomStepController=b.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const D=h.create(),C=h.fromValues(0,0,1),E=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/VoxelWasm":function(){define(["require",
"exports"],function(a,b){let g;const d=new Map;b.addLayerViewToWasm=async function(k){null==g&&(g=new Promise((c,l)=>a(["../../../layers/VoxelWasmPerSceneView"],e=>c(Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}))),l)));const m=k.view,f=d.get(m);return f?f.addVoxelLayer(k):(await g.then(c=>{c=new c.default({view:m});d.set(m,c);return c})).addVoxelLayer(k)};b.getVoxelWasm=function(k){return d.get(k)};b.removeLayerViewFromWasm=function(k){const m=
k.view,f=d.get(m);f&&1>f.removeVoxelLayer(k)&&(d.delete(m),0===d.size&&(g=null))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,g){if("touch"===b.pointerType)return!1;switch(g){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,g){switch(g){case "primary":return"touch"===
b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==b.pointerType&&1===b.button}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragRotate":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler","../../../input/handlers/support"],function(a,b,g,d,k){class m extends d.InputHandler{constructor(f,c,l,e){super(!0);
this._view=f;this.pointerAction=c;this._pivot=l;this.registerIncoming("drag",e,p=>this._handleDrag(p))}_handleDrag(f){const c=f.data;if(!(1<c.pointers.size)&&k.eventMatchesMousePointerAction(f.data,this.pointerAction)){var l=b.createScreenPointArray(c.center.x,c.center.y);switch(c.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new g.RotateController({view:this._view,pivot:this._pivot});this._view.state.switchCameraController(this._cameraController);
this._cameraController.begin(l);break;case "update":this._cameraController&&this._cameraController.update(l);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}f.stopPropagation()}}}Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>g.PivotPoint});a.DragRotate=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../../layers/VoxelWasm ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C){a.PivotPoint=void 0;(function(F){F[F.CENTER=0]="CENTER";F[F.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=class extends D.InteractiveController{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(F){super(F);this.pivot=a.PivotPoint.CENTER;this._rotScale=0;this._lastPoint=u.create();this._tmpWorldUp=x.create();this._tmpViewDir=x.create();this._tmpRotCurPoint=u.create();this._tmpTransf=p.create();
this._tmpAxis=x.create();this._tmpPivotPoint=x.create();this._pivotPos=x.create();this._constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:v.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:r.TiltMode.TUMBLE}}initialize(){this._rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5}begin(F){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:w.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=v.InteractionType.LOOK_AROUND;
this._constraintOptions.tiltMode=r.TiltMode.LOOK_AROUND;this._constraintOptions.selection=t.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:const G=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?C.contentIntersectorOptions:{});G||w.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(F,G);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=v.InteractionType.TUMBLE;this._constraintOptions.tiltMode=
r.TiltMode.TUMBLE;this._constraintOptions.selection=t.ConstraintTypes.ALL&~t.ConstraintTypes.DISTANCE}this._constraintOptions.interactionStartCamera=this.startCamera;C.normalizeCoordinate(this.startCamera,F,this._lastPoint)}}_constrainPivotPoint(F,G){const I=this.startCamera,H=x.create();w.subtract(H,this._pivotPos,I.eye);const B=w.length(H);var K=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(I.eye,A);K=Math.max(Math.min(C.rotatePivotDistanceModifier,1/Math.abs(w.dot(A,
I.viewForward)))*K,C.rotatePivotMinDistanceModifier);G&&(K=Math.min(B,K));var L=n.getReferenceEllipsoid(this.view.spatialReference),J=d.createScreenPointArray(I.width/I.pixelRatio*.5,I.height/I.pixelRatio*.5);L=C.decideNavigationMode(this.startCamera,J,L);J=this.view._stage.renderView.getMinimalDepthForArea(y.getVoxelWasm(this.view),I.fullWidth/I.pixelRatio*.5,I.fullHeight/I.pixelRatio*.5,I,2.5*C.rotateScreenPixelArea,C.rotateScreenPixelArea);F=this.view._stage.renderView.getMinimalDepthForArea(y.getVoxelWasm(this.view),
F[0],F[1],I,C.rotateScreenPixelArea);if(null!=J||null!=F)J=J??F??0,F=null==F||L===C.NavigationMode.Horizontal?J:F,K=J>F?F:J,K=G?Math.min(K,B):K;w.normalize(H,H);w.copy(this._pivotPos,w.add(this._tmpPivotPoint,I.eye,w.scale(this._tmpPivotPoint,H,K)))}update(F){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,F,this.currentCamera.center,this._pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=
this._applyRotation(this.currentCamera,F,this.currentCamera.eye,this._pivotPos)}q.applyAll(this.view,this.currentCamera,this._constraintOptions);this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(F,G,I,H){this.view.renderCoordsHelper.worldUpAtPosition(H,this._tmpWorldUp);C.normalizeCoordinate(F,G,this._tmpRotCurPoint);G=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let B=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;w.subtract(this._tmpViewDir,
I,H);I=w.length(this._tmpViewDir);I=g.acosClamped(w.dot(this._tmpViewDir,this._tmpWorldUp)/I);if(this.pivot===a.PivotPoint.EYE){const K=.5*Math.PI-I,L=.495*Math.PI;G=K-Math.max(-L,Math.min(L,K+-.5*G))}G=g.clamp(G+I,z.TiltDefault.min,z.TiltDefault.max)-I;w.cross(this._tmpAxis,F.up,this._tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(B=-B);e.fromRotation(this._tmpTransf,B,this._tmpWorldUp);e.rotate(this._tmpTransf,this._tmpTransf,G,this._tmpAxis);w.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);
F.up=w.transformMat4(E,F.up,this._tmpTransf);w.add(E,H,this._tmpViewDir);h.copy(this._lastPoint,this._tmpRotCurPoint);return E}};b.__decorate([k.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=b.__decorate([l.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const E=x.create(),A=x.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,g,d,k,m,f,c,l,e){a.InteractiveController=class extends l.CameraController{constructor(){super(...arguments);this.startCamera=new e.Camera;this.currentCamera=new e.Camera;this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<c.interactingTimeout}stepController(p,h){h.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(h)}onControllerStart(p){this.state=l.State.Running;this.startCamera.copyFrom(p);this.currentCamera.copyFrom(p)}onControllerEnd(p){p.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=
performance.now();setTimeout(()=>this.notifyChange("isInteractive"),c.interactingTimeout);this.view.state.updateCamera(p=>this.stepController(0,p));this.steppingFinished&&this.finishController()}};b.__decorate([g.property({readOnly:!0})],a.InteractiveController.prototype,"isInteractive",null);b.__decorate([g.property()],a.InteractiveController.prototype,"_lastInteraction",void 0);a.InteractiveController=b.__decorate([f.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewStateManager":function(){define("exports ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../webgl-engine/lib/RenderFeature ../../support/RenderState ../../webgl/FramebufferObject".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T){a.ViewStateManager=class extends k{get camera(){const N=this._get("camera");if(!this.ready)return N;const V=H.internalToExternal(this.view,this.view.state.camera,P);return V&&N&&V.equals(N)?N:V.clone()}set camera(N){this._updatePropertyBeforeReady("camera",N)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(H.externalToInternal(this.view,N),{applyConstraints:!1})||m.getLogger(this).error("#camera\x3d",
"Invalid camera",N),this.view.elevationProvider?.enableElevationCache(!1))}get contentCamera(){const N=this._get("contentCamera");if(!this.ready)return N;const V=H.internalToExternal(this.view,this.view.state.contentCamera,P);return V&&N&&V.equals(N)?N:V.clone()}set contentCamera(N){this._updatePropertyBeforeReady("contentCamera",N)||(N=H.externalToInternal(this.view,N),null==N?this.view.state.contentCamera=null:(this._updateElevation(N),this.view.state.contentCamera=N))}installContentCameraReset(N){this.removeHandles("content-camera-reset");
this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const V=this.zoom,S=this.view.state.camera.distance**2,X=q.fromArray(this.view.state.camera.center),ca=N.sticky?this.contentCamera.clone():null;this.addHandles([c.watch(()=>this.contentCamera,()=>{N.sticky||(this.removeHandles("content-camera-reset"),this.test.contentCameraResetState.clear())}),c.watch(()=>this.zoom,ba=>{void 0!==ba&&void 0!==V&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(ba-
V)/2),2<Math.abs(ba-V)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ca))}),c.watch(()=>this.view.state.camera,ba=>{ba=n.squaredDistance(X,ba.center);this.test.contentCameraResetState.set("camera.center",ba/S);ba>S?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ca)})],"content-camera-reset");return!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(N){this._updatePropertyBeforeReady("center",
N)||(N?this.isCompatible(N)?this.setStateCamera(this._centerToCamera(N),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():m.getLogger(this).error("#center\x3d","Invalid center",N):m.getLogger(this).error("#center\x3d","Center has an incompatible spatial reference (center: "+(N.spatialReference?N.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",N):m.getLogger(this).error("#center\x3d","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");
var N=this.view;N=H.toExtent(N,N.state.camera,N.pointsOfInterest.centerOnContent.renderLocation);return null!=N?N:this._get("extent")}set extent(N){this._updatePropertyBeforeReady("extent",N)||(N?this.isCompatible(N)?this.setStateCamera(this._extentToCamera(N),{applyConstraints:!0})||m.getLogger(this).error("#extent\x3d","Invalid extent",N):m.getLogger(this).error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(N.spatialReference?N.spatialReference.wkid:"none")+", view: "+
this.view.spatialReference?.wkid+")",N):m.getLogger(this).error("#extent\x3d","Extent may not be null or undefined"))}get frustum(){const N=this._propertiesPool.get("frustum");N.renderCoordsHelper=this.view.renderCoordsHelper;N.update(this.view.state.camera);return N}get _initialViewpoint(){const N=this.view.map;return N&&"initialViewProperties"in N?N.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const N=this.view.pointsOfInterest.centerOnContent;
return H.distanceToScale(this.view,N.distance,N.location.latitude)}return this._get("scale")}set scale(N){this._updatePropertyBeforeReady("scale",N)||this.setStateCamera(this._scaleToCamera(N),{applyConstraints:!0})||m.getLogger(this).error("#scale\x3d","Invalid scale",N)}get padding(){if(!this.ready)return this._get("padding");var N=this.view.state.camera,V=N.padding;const S=N.pixelRatio;N=this._get("padding");const X=Math.round(V[L.PaddingSide.TOP]/S),ca=Math.round(V[L.PaddingSide.RIGHT]/S),ba=
Math.round(V[L.PaddingSide.BOTTOM]/S);V=Math.round(V[L.PaddingSide.LEFT]/S);return null!=N&&N.top===X&&N.right===ca&&N.bottom===ba&&N.left===V?N:{top:X,right:ca,bottom:ba,left:V}}set padding(N){this._updatePropertyBeforeReady("padding",N)||(this._paddingToArray(N,this.view.state.camera.pixelRatio,W),this.view.state.updateCamera(V=>V.padding=W))}_paddingToArray(N,V,S){N?t.set(S,N.top||0,N.right||0,N.bottom||0,N.left||0):t.set(S,0,0,0,0);for(N=0;4>N;N++)S[N]=Math.round(S[N]*V)}get screenCenter(){const N=
this.padding;return e.createScreenPoint((this.view.width-(N.left+N.right))/2+N.left,(this.view.height-(N.top+N.bottom))/2+N.top)}get viewpoint(){return this.ready?K.fromCamera(this.view,this.camera):this._get("viewpoint")}set viewpoint(N){if(!this._updatePropertyBeforeReady("viewpoint",N))if(N)if(this.isCompatible(N))this.setStateCamera(this._viewpointToCamera(N),{applyConstraints:!N.camera})||m.getLogger(this).error("#viewpoint\x3d","Invalid viewpoint",N);else{var V=null!=N.camera?N.camera.position:
N.targetGeometry;V=null!=V&&V.spatialReference;m.getLogger(this).error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(V?V.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",N)}else m.getLogger(this).error("#viewpoint\x3d","Viewpoint may not be null or undefined")}get zoom(){return this.ready?H.scaleToZoom(this.view,this.scale):this._get("zoom")}set zoom(N){this._updatePropertyBeforeReady("zoom",N)||void 0===N||this.setStateCamera(this._zoomToCamera(N),{applyConstraints:!0})||
m.getLogger(this).error("#zoom\x3d","Invalid zoom",N)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;var N=Math.min(this._windowDevicePixelRatio,
this.view.qualitySettings.maximumPixelRatio);N=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:N)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*N);this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*N);T.ensureAttachmentMaxSize(this._tmpCanvasSize,this.view._stage.renderView.renderingContext.parameters.maxTextureSize);this._tmpCanvasSize.pixelRatio=0<this._tmpCanvasSize.width?this._tmpCanvasSize.width/this.view.surface.clientWidth*
.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:N;this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio));return this._tmpCanvasSize}get _rasterPixelRatio(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(J.RenderFeature.PhysicalPixelRendering)??
!1}get _usePhysicalPixelRenderingAny(){const N=this.view?._stage?.renderer;return N&&(N.isFeatureEnabled(J.RenderFeature.PhysicalPixelRendering,M.RenderState.IDLE)||N.isFeatureEnabled(J.RenderFeature.PhysicalPixelRendering,M.RenderState.INTERACTING)||N.isFeatureEnabled(J.RenderFeature.PhysicalPixelRendering,M.RenderState.ANIMATING))}constructor(N){super(N);this.constraintsManager=null;this.ready=!1;this._windowDevicePixelRatio=1;this._devicePixelRatioOverride=null;this._idleTimeout=300;this.test=
{viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:V=>this._devicePixelRatioOverride=V,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return null!=this.renderState},get idleTimeoutEnabled(){return 0<this.viewStateManager._idleTimeout},set idleTimeoutEnabled(V){this.viewStateManager._idleTimeout=V?300:0}};this._propertiesPool=new B.PropertiesPool({frustum:F.Frustum},this);this._cameraSetByUser=
!1;this._gotoOperation=null;this._cameraChangeTime=0;this._tmpCanvasSize=new Q}initialize(){this._cameraChangeTime=performance.now();this.addHandles([c.on(()=>this.view.state.events,"before-camera-change",N=>N&&this._updateElevation(N)),c.watch(()=>this.view.state?.camera,(N,V)=>this._cameraChangedHandler(N,V),c.sync)]);c.when(()=>this.view.state?.camera,N=>this._updateElevation(N),{once:!0,sync:!0});this.addHandles([l.addFrameTask({prepare:()=>this._prepareFrame()}),c.watch(()=>this.view.state.cameraController,
()=>{this._cameraSetByUser=!0;this.removeHandles("pending-initial-view")}),c.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit();this._propertiesPool=f.destroyMaybe(this._propertiesPool)}init(){this.constraintsManager=new A.ConstraintsManager({view:this.view});this._prepareFrame();var N=this._getInitialProperties();this._cameraSetByUser=!1;this._set("ready",!0);for(const V of N)this.set(V.name,V.value);this._cameraSetByUser||((N=this._initialViewpoint||
this.view.initialExtent)&&this.isCompatible(N)?this._setInitialView(N):this.view.state.viewingMode===D.ViewingMode.Local&&this.addHandles(c.when(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles("pending-initial-view");this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))}exit(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles("pending-initial-view"),
this.constraintsManager=f.destroyMaybe(this.constraintsManager))}async goTo(N,V){V={animate:!0,...V};null!=this._gotoOperation&&this._gotoOperation.abort(V.animate);this._gotoOperation=new G.GoToOperation(N,V,this.view);this.view.resourceController.scheduler.stopFrame();return this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(E.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})}step(N){const V=this.view.state,S=V?.cameraController;S&&(V.updateCamera(X=>S.stepController(N,
X)),S.steppingFinished&&S.finishController())}_cancelGoToOperation(){null!=this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const N=new Set,V=[];for(const {propertyName:S,overrides:X}of U){const ca=N.has(S),ba=this._isOverridden(S);!ca&&ba&&V.push({name:S,value:this._get(S)});this._clearOverride(S);(ca||ba)&&X.forEach(ia=>N.add(ia))}return V}_setInitialView(N){if(null!=N&&!this._cameraSetByUser)if(N instanceof g)this.setStateCamera(H.externalToInternal(this.view,
N),{applyConstraints:!1});else if(N instanceof d)if(N.targetGeometry instanceof r){var V=H.fromExtentSync(this.view,N.targetGeometry,0,.5,H.OrientationMode.LOCKED);null!=V&&this.setStateCamera(H.externalToInternal(this.view,V),{applyConstraints:!0})}else V={applyConstraints:!N.camera},N=this._viewpointToCamera(N),this.setStateCamera(N,V);else V=H.fromExtentSync(this.view,N,0,.5,H.OrientationMode.LOCKED),null!=V&&this.setStateCamera(H.externalToInternal(this.view,V),{applyConstraints:!0})}_updatePropertyBeforeReady(N,
V){if(this.ready)return!1;this._override(N,V);V&&O.has(N)&&this._override("hasInitialView",!0);return!0}isCompatible(N){return null==N?!1:N instanceof d?N.camera?this.isCompatible(N.camera):this.isCompatible(N.targetGeometry):N instanceof g?this.isCompatible(N.position):N.spatialReference&&z.canProject(N.spatialReference,this.view.spatialReference)}_getPreservingHeadingTilt(N=Z){this._cameraSetByUser?(N.heading=this.camera.heading,N.tilt=this.camera.tilt):(N.heading=0,N.tilt=.5);return N}_centerPointAtDistanceToCamera(N,
V,S=R){const {heading:X,tilt:ca}=this._getPreservingHeadingTilt();N=H.getObserverForPointAtDistanceSync(this.view,X,ca,N,V,H.OrientationMode.ADJUST);if(null==N)return null;S.copyFrom(this.view.state.camera);S.eye=N.eye;S.center=N.center;S.up=N.up;return S}_centerToCamera(N){const V=this.view.pointsOfInterest.centerOnContent;V.runTask();return this._centerPointAtDistanceToCamera(N,V.distance)}_extentToCamera(N){const {heading:V,tilt:S}=this._getPreservingHeadingTilt();return(N=H.fromExtentSync(this.view,
N,V,S,H.OrientationMode.ADJUST,P))?H.externalToInternal(this.view,N):null}_scaleToCamera(N){if(null==N)return null;var V=this.view.pointsOfInterest.centerOnContent;V.runTask();const S=V.renderLocation;V=V.location.latitude;if(null==V)return null;N=H.scaleToDistance(this.view,N,V);return this._centerPointAtDistanceToCamera(S,N)}_zoomToCamera(N){return this._scaleToCamera(H.zoomToScale(this.view,N))}_viewpointToCamera(N){return H.externalToInternal(this.view,K.toCameraSync(this.view,N))}setStateCamera(N,
V){if(null==N||!this.view.state.stopActiveCameraController())return!1;this._cameraSetByUser=!0;V.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(S=>{V.positionAndOrientationOnly?(S.eye=N.eye,S.center=N.center,S.up=N.up):S.copyFrom(N);V.applyConstraints&&C.applyAll(this.view,S)});V.applyConstraints||(this.view.state.cameraController=new I.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:N}));return!0}_prepareFrame(){const {surface:N,canvas:V}=this.view;
if(N&&V){this._windowDevicePixelRatio=window.devicePixelRatio;var S=this._computeCanvasSize();if(0!==S.width&&0!==S.height){if(V.width!==S.width||V.height!==S.height)V.width=S.width,V.height=S.height;if(this.view.state){const X=this.view.state.camera;if(X.fullWidth!==S.width||X.fullHeight!==S.height||X.pixelRatio!==S.pixelRatio)R.copyFrom(X),R.pixelRatio!==S.pixelRatio&&(this._paddingToArray(this.padding,S.pixelRatio,W),R.padding=W),R.fullWidth=S.width,R.fullHeight=S.height,R.pixelRatio=S.pixelRatio,
this.view.state.camera=R;this._updateViewState()}}}}_updateElevation(N){var V=this.view.basemapTerrain?.spatialReference;const S=this.view.renderCoordsHelper?.getAltitude(N.eye)??0;V=V?E.surfaceElevationBelowRenderLocation(this.view,N.eye):0;N.relativeElevation=S-V}_updateViewState(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=M.RenderState.ANIMATING:this.view.interacting?this.view.state.mode=M.RenderState.INTERACTING:(this.view.state.mode===
M.RenderState.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=M.RenderState.INTERACTING:this.view.state.mode=M.RenderState.IDLE);this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(N,V){N&&V&&N.almostEquals(V)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};b.__decorate([p.property({type:g,dependsOn:["view.state.camera","ready"]})],a.ViewStateManager.prototype,"camera",null);b.__decorate([p.property({type:g,
dependsOn:["view.state.contentCamera","ready"]})],a.ViewStateManager.prototype,"contentCamera",null);b.__decorate([p.property({type:y})],a.ViewStateManager.prototype,"center",null);b.__decorate([p.property({type:r})],a.ViewStateManager.prototype,"extent",null);b.__decorate([p.property({readOnly:!0})],a.ViewStateManager.prototype,"frustum",null);b.__decorate([p.property()],a.ViewStateManager.prototype,"_initialViewpoint",null);b.__decorate([p.property({readOnly:!0})],a.ViewStateManager.prototype,"hasInitialView",
null);b.__decorate([p.property({readOnly:!0,type:Boolean})],a.ViewStateManager.prototype,"ready",void 0);b.__decorate([p.property({type:Number})],a.ViewStateManager.prototype,"scale",null);b.__decorate([p.property()],a.ViewStateManager.prototype,"padding",null);b.__decorate([p.property({readOnly:!0})],a.ViewStateManager.prototype,"screenCenter",null);b.__decorate([p.property({constructOnly:!0})],a.ViewStateManager.prototype,"view",void 0);b.__decorate([p.property({type:d})],a.ViewStateManager.prototype,
"viewpoint",null);b.__decorate([p.property({type:Number})],a.ViewStateManager.prototype,"zoom",null);b.__decorate([p.property({readOnly:!0})],a.ViewStateManager.prototype,"_rasterPixelRatio",null);b.__decorate([p.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRendering",null);b.__decorate([p.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRenderingAny",null);b.__decorate([p.property()],a.ViewStateManager.prototype,"_windowDevicePixelRatio",void 0);
b.__decorate([p.property()],a.ViewStateManager.prototype,"_devicePixelRatioOverride",void 0);a.ViewStateManager=b.__decorate([x.subclass("esri.views.3d.state.ViewStateManager")],a.ViewStateManager);class Q{constructor(){this.height=this.width=0;this.pixelRatio=1}}const O=new Set("camera viewpoint extent scale center zoom".split(" ")),U=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",
overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Z={heading:0,tilt:0},P=new g,R=new L.Camera,W=v.create();a.interactingTimeout=100;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/ConstraintTypes ../camera/constraintUtils/InteractionType ../camera/constraintUtils/TiltMode ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){a.ConstraintsManager=class extends g{constructor(v){super(v);this.nearFarHeuristic=q.createNearFarHeuristic(v.view.state.viewingMode,v.view.basemapTerrain,v.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([k.watch(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),k.watch(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",
v=>this._updateCameraNearFar(v)),k.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),k.sync),k.watch(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),k.sync),k.watch(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),k.sync),k.watch(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),k.sync),k.watch(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),k.sync),k.watch(()=>[this.view.map?.ground?.navigationConstraint?.type,
this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),k.sync)]);this.view.state.isLocal&&this.addHandles(k.watch(()=>this.view.renderDataExtent,v=>this._updateLocalSurfaceDistance(v),k.initial));this._updateNearFar();this.view.state.viewingMode!==p.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new t.SurfaceCollisionConstraint({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const v=this.view.constraints?.clipDistance;v&&"auto"!==v.mode&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,v))}_updateNearFar(){this.view.state.updateCamera(v=>this._updateCameraNearFar(v))}_updateCameraNearFar(v){const r=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(r?r.mode:"auto")?this._updateCameraNearFarManual(v,r):this._updateCameraNearFarAuto(v,r)}_updateCameraNearFarAuto(v,
r){this.nearFarHeuristic.compute(v.eye,v.center,this.view.renderDataExtent,u.surfaceElevationBelowRenderLocation(this.view,v.eye),v);r&&r.autoUpdate(v.near,v.far)}_updateCameraNearFarManual(v,r){r&&(v.near=r.near,v.far=r.far)}_updateCollision(){var v=this.view.map?.ground?.navigationConstraint?.type;v=v?"stay-above"===v:!0;const r=this.view.state.constraints.collision;v!==r.enabled&&((r.enabled=v)&&this._reapplyConstraints(w.ConstraintTypes.COLLISION),(v=this.view.constraints&&this.view.constraints.tilt)&&
"auto"!==v.mode||this._updateTiltAuto())}_updateAltitude(){const v=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=v&&this.view.state.viewingMode!==p.ViewingMode.Local?{min:v.min,max:v.max}:null;this._reapplyConstraints()}_updateTiltMax(){const v=this.view.constraints&&this.view.constraints.tilt;v&&"auto"!==v.mode&&(this._updateTiltManual(v),this._reapplyConstraints())}_updateTilt(){const v=this.view.constraints&&this.view.constraints.tilt;"manual"===(v?
v.mode:"auto")?this._updateTiltManual(v):this._updateTiltAuto();this._reapplyConstraints()}_updateTiltManual(v){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(d.deg2rad(v.max))}_updateTiltAuto(){const v=this.view.state.constraints;v.tilt=v.createDefaultTilt();this._updateTiltAutoMax()}_updateTiltAutoMax(){const v=this.view.constraints&&this.view.constraints.tilt;if(v&&"auto"===v.mode){var r=this.view.state.constraints;r.tilt&&(r=r.tilt(this.view.state.camera.distance).max,v.autoUpdate(d.rad2deg(r)))}}_updateLocalSurfaceDistance(v){if(null!=
v){var r=Math.max(v.width,v.height);0>=r||(null!=v.zmax&&null!=v.zmin&&(r=Math.max(r,v.zmax-v.zmin)),v=this.view.state,r=3*r/Math.atan(v.camera.fov/2),r!==v.constraints.distance&&(v.constraints.distance=r))}}_reapplyConstraints(v=w.ConstraintTypes.ALL){this.view.state.updateCamera(r=>h.applyAll(this.view,r,{selection:v,interactionType:x.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:n.TiltMode.TUMBLE}))}};b.__decorate([m.property({constructOnly:!0})],
a.ConstraintsManager.prototype,"view",void 0);b.__decorate([m.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=b.__decorate([e.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Extent ../../ViewingMode ../environment/atmosphereUtils".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(x,n,q,t){q=2/q;x/n>q?(t.far=x,t.near=t.far/n):(t.near=q,t.far=t.near*n);return t}class p{constructor(x,n){this._elevationProvider=x;this._referenceEllipsoid=m.getReferenceEllipsoid(n);this._unitInMeters=g.getMetersPerUnitForSR(n,this._referenceEllipsoid.metersPerDegree)}compute(x,n,q,t,v){v||(v={near:0,far:0});var r=x[2]*this._unitInMeters,y=r;t=r-t;var z=this._elevationProvider?.visibleElevationBounds;z&&(r=0<=t?y-this._unitInMeters*z.min:this._unitInMeters*
z.max-y);q=null!=q?q:new f({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});y=Math.max(q.xmax-q.xmin,q.ymax-q.ymin,4*Math.max(q.xmax-q.xmin,q.ymax-q.ymin));d.subtract(w,n,x);u[0]=0<w[0]?q.xmax:q.xmin;u[1]=0<w[1]?q.ymax:q.ymin;u[2]=0<w[2]?y/2:-y/2;d.subtract(u,u,x);d.normalize(w,w);x=1.1*d.dot(u,w)*this._unitInMeters;n=Math.sqrt(r*(r+2*this._referenceEllipsoid.radius));q=Math.max(q.xmax-q.xmin,q.ymax-q.ymin);z=1E-4*q*this._unitInMeters;r=b.clamp((r-z)/(.001*q*this._unitInMeters-z),0,1);r=Math.min(b.lerp(n,
x,r**3),n)*Math.max(Math.log(Math.abs(t)),1);return e(Math.min(r,Math.max(34064E4,y))/this._unitInMeters,2E4,this._unitInMeters,v)}}class h{constructor(x){this._referenceEllipsoid=m.getReferenceEllipsoid(x)}compute(x,n,q,t,v){v||(v={near:0,far:0});x=d.length(x);n=x-this._referenceEllipsoid.radius;n=Math.max(Math.abs(n-t),Math.abs(n));t=1.2*b.lerp(Math.sqrt(n*(n+2*(this._referenceEllipsoid.radius+Math.min(0,t)))),x+this._referenceEllipsoid.radius,l.computeInnerAltitudeFade(n));x=b.clamp(2E4-(Math.log(n)-
7.983)/9.011*19E3,1E3,2E4);return e(t,x,1,v)}}const u=k.create(),w=k.create();a.createNearFarHeuristic=function(x,n,q){return x===c.ViewingMode.Global?new h(q):new p(n,q)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,g,d,k,m,f,c,l,e){a.SurfaceCollisionConstraint=class extends g{constructor(p){super(p)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",p=>this._handleElevationChangeEvent(p)))}_handleElevationChangeEvent(p){if(!this.view.state.cameraController){var h=this.view.state.camera;null!=p.spatialReference&&l.eyeWithinExtent(this.view,h,p.extent,p.spatialReference)&&this._applyToCurrentCamera()}}_applyToCurrentCamera(){this.view.state.updateCamera(p=>e.applySurfaceCollisionConstraint(this.view,
p,e.Mode.EYE_AND_CENTER))}};b.__decorate([d.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=b.__decorate([c.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/frustum"],function(a,b,g,d){function k(f,
c,l){f.origin=c;f.endpoint=l;b.direction(f.direction,c,l)}class m{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(f){this.renderCoordsHelper=f;this.frustum=d.create();this._points=d.createPoints();this.lines=Array(12);this._origin=g.create();this._direction=g.create();this._altitude=null;for(f=0;12>f;f++)this.lines[f]={origin:null,direction:g.create(),endpoint:null}}update(f){d.fromMatrix(f.viewMatrix,
f.projectionMatrix,this.frustum,this._points);b.copy(this._origin,f.eye);b.copy(this._direction,f.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()}updatePoints(f){for(let c=0;c<this._points.length;c++)b.copy(this._points[c],f[c]);d.computePlanes(this.frustum,this._points);this._updateLines()}get altitude(){return this._altitude}intersectsSphere(f){return d.intersectsSphere(this.frustum,f)}intersectsRay(f){return d.intersectsRay(this.frustum,f)}intersectsLineSegment(f,
c){return d.intersectsLineSegment(this.frustum,f,c)}intersectsPoint(f){return d.intersectsPoint(this.frustum,f)}_updateLines(){const f=this._points;for(let c=0;4>c;c++){const l=c+4;k(this.lines[c],f[c],f[l]);k(this.lines[c+4],f[c],3===c?f[0]:f[c+1]);k(this.lines[c+8],f[l],3===c?f[4]:f[l+1])}}}m.planePointIndices=d.planePointIndices;m.nearFarLineIndices=[[d.PointIndex.NEAR_BOTTOM_LEFT,d.PointIndex.FAR_BOTTOM_LEFT],[d.PointIndex.NEAR_BOTTOM_RIGHT,d.PointIndex.FAR_BOTTOM_RIGHT],[d.PointIndex.NEAR_TOP_RIGHT,
d.PointIndex.FAR_TOP_RIGHT],[d.PointIndex.NEAR_TOP_LEFT,d.PointIndex.FAR_TOP_LEFT]];a.Frustum=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ../camera/constraintUtils/surfaceCollision ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){class w{constructor(x,n,q){this.target=x;this.options=n;this.view=q;this.state="pending";this._animationController=null;this.promise=new Promise((t,v)=>{this._resolveCallback=t;this._rejectCallback=v;t=new AbortController;if(null!=this.options.signal)k.onAbort(this.options.signal,()=>{this.abort()});this._abortController=t;this.waitForReady()})}resolve(x){if("finished"!==this.state)return this.state="finished",this._resolveCallback(x)}reject(x){if("finished"!==
this.state)return this.state="finished",this._rejectCallback(x)}abort(x=!1){this._abortController.abort();switch(this.state){case "wait-for-animation-finish":!x&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController()}this.reject(k.createAbortError())}async waitForReady(){this.state="wait-for-ready";if(!this.view.ready)try{await m.whenOnce(()=>this.view.ready,this._abortController.signal)}catch(x){return this.reject(x)}this.createViewPoint()}async createViewPoint(){if("finished"!==
this.state){this.state="wait-for-viewpoint";this._animationController=this.options.animate?this._getAnimationController():null;try{const n=await u.create(this.view,this.target,this._abortController.signal);if("finished"!==this.state){var x=n?this._getCameraFromViewpoint(n):null;null!=x&&(this.options.animate?null!=this._animationController&&this.startAnimation(x,this._animationController):(this.view.stateManager.setStateCamera(x.camera,{applyConstraints:!x.isFullySpecified,positionAndOrientationOnly:!0,
doNotCancelGoToOperation:!0}),this.resolve()))}}catch(n){this.reject(n)}}}_getCameraFromViewpoint(x){const n=!!(this.target instanceof g&&this.target.camera||this.target instanceof b);var q=x.camera;if(null==q)return null;if(!this.view.stateManager.isCompatible(q))return x=(x=q.position)&&x.spatialReference,this.reject(new d("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${x?x.wkid:"none"}, view: ${this.view.spatialReference?.wkid})`,
{camera:q})),null;q=h.externalToInternal(this.view,q);return null==q?(this.reject(new d("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:x,camera:q,isFullySpecified:n}}startAnimation(x,n){this.state="wait-for-animation-finish";const q=n.viewAnimation;if(null==q)this.reject(new d("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{q.update(x.viewpoint,"running");if(!n.active||null==n.viewAnimation||n.viewAnimation.target!==x.viewpoint||this.view.state.cameraController!==
n)return this.abort();if(x.isFullySpecified){var t=new p.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:x.camera});c.applySurfaceCollisionConstraint(this.view,x.camera,c.Mode.EYE_AND_CENTER)}else f.applyAll(this.view,x.camera);n.begin(x.camera,this.options);var v=r=>{if(null!=this.view.state)switch(n.state){case l.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case l.State.Ready:case l.State.Rejected:case l.State.Running:case l.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(r)}}};
q.when(()=>{const r=this.view.state.cameraController;t&&(r&&r.active?r instanceof e.PointToPointAnimationController&&null!=r.viewAnimation&&r.viewAnimation.target===x.viewpoint&&(this.view.state.cameraController=t):null!=n.viewAnimation&&n.viewAnimation.target===x.viewpoint&&"finished"===n.state&&(this.view.state.cameraController=t))},r=>v(r));n.asyncResult={resolve:()=>v(),reject:r=>v(r)}}}_getAnimationController(){let x=null;var n=null;n=this.view.state.cameraController;n instanceof e.PointToPointAnimationController&&
(n.updateStateFromViewAnimation(),n.active&&(x=n,n=x.viewAnimation));return null!=x||(x=new e.PointToPointAnimationController({view:this.view,mode:"animation"}),n=x.viewAnimation,this.view.state.switchCameraController(x))?x:(null!=n&&n.stop(),this.reject(new d("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}a.GoToOperation=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(a,b,g,d,k,m,f,c,l,e){a.SurfaceCollisionCorrectionController=class extends e.CameraController{set desiredCamera(p){this._set("desiredCamera",p.clone())}constructor(p){super(p)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=e.State.Running;this.addHandles(this.view.basemapTerrain.on("elevation-change",p=>this._handleElevationChangeEvent(p)));this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(p){(null==
p.spatialReference||c.eyeWithinExtent(this.view,this.desiredCamera,p.extent,p.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(p=>{p.copyViewFrom(this.desiredCamera);l.applySurfaceCollisionConstraint(this.view,p,l.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=e.State.Stopped)})}};b.__decorate([g.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=b.__decorate([f.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],
a.SurfaceCollisionCorrectionController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectPointToVectorWithEngine ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/Multipoint".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K){async function L(qa,la,ja,oa){var za=la.camera;if(null!=za)return J(za,A.getViewSR(qa),oa);({targetGeometry:za}=la);if(null==za)throw Error("Viewpoint has no targetGeometry!");const {camera:ta,mode:Ca}=M(qa,la.rotation,ja);if("point"===za.type)return T(qa,la,za,ta,Ca,oa);la=za.extent;if(null==la)throw Error("Target geometry has no extent!");return A.fromExtentAsync(qa,la,ta.heading,ta.tilt,Ca,oa)}async function J(qa,la,ja){la=
await n.projectWithZConversion(qa.position,la,{signal:ja});e.throwIfAborted(ja);qa=qa.clone();qa.position=la.clone();return qa}function M(qa,la,ja){qa=A.internalToExternal(qa,qa.state.camera);let oa=A.OrientationMode.ADJUST;null!=la&&(qa.heading=360-c.cyclicalDegrees.normalize(la),oa=A.OrientationMode.LOCKED);null!=ja&&(qa.tilt=ja);return{camera:qa,mode:oa}}async function T(qa,la,ja,oa,za,ta){const Ca=qa.spatialReference;ja=await n.projectWithZConversion(ja.clone(),Ca,{signal:ta});e.throwIfAborted(ta);
la=null!=la.scale?A.scaleToDistance(qa,la.scale,ja.latitude):qa.state.camera.distance;return A.fromCenterDistanceAsync(qa,ja,la,oa,za,ta)}function Q(qa,la){return null==la.scale&&null!=la.zoom?A.zoomToScale(qa,la.zoom):la.scale}function O(qa,la){let ja=!1;null!=la.heading?(qa.heading=la.heading,ja=!0):null!=la.rotation&&(qa.heading=360-c.cyclicalDegrees.normalize(la.rotation),ja=!0);null!=la.tilt&&(qa.tilt=la.tilt,ja=!0);null!=la.fov&&(qa.fov=la.fov);return ja}function U(qa,la,ja,oa){const za=qa.spatialReference||
H.WGS84;la=null!=la?la:A.externalToInternal(qa,ja);if(null==la)return oa;oa.targetGeometry=v.projectVectorToPoint(la.center,qa.renderSpatialReference,za);oa.scale=A.computeScale(qa,la);oa.rotation=c.cyclicalDegrees.normalize(360-ja.heading);oa.camera=ja;return oa}async function Z(qa,la,ja,oa){const za=()=>new l("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!la)throw za();"mesh"===la.type&&(la=la.extent);const ta=la.spatialReference,Ca=qa.spatialReference,Ga=qa.basemapTerrain.spatialReference;
if(!la.hasZ&&qa.basemapTerrain){let Ma;switch(la.type){case "point":Ma=la;break;case "multipoint":case "polyline":Ma=la.extent?.center;break;case "extent":Ma=la.center;break;case "polygon":Ma=la.centroid}null!=Ma&&null!=Ga&&null!=qa.elevationProvider?(Ma=await n.projectWithZConversion(Ma,Ga,{signal:oa}),na[2]=F.getElevationAtPoint(qa.elevationProvider,Ma)??0):na[2]=0}const La=[];(0,Aa[la.type])(la,la.hasZ?Ma=>{La.push([Ma[0],Ma[1],Ma[2]])}:Ma=>{La.push([Ma[0],Ma[1]])},na);if(0===La.length)throw za();
qa=await n.projectWithZConversion(new K({spatialReference:ta,hasZ:la.hasZ,hasM:!1,points:La}),Ca,{signal:oa});la.hasZ&&(ja.hasZ=!0);if(la.hasZ)for(const [Ma,Ra,Ya]of qa.points)na[0]=Ma,na[1]=Ra,na[2]=Ya,y.expandWithVec3(ja.boundingBox,na);else for(const [Ma,Ra]of qa.points)na[0]=Ma,na[1]=Ra,y.expandWithVec3(ja.boundingBox,na)}async function P(qa,la,ja,oa,za){const ta=await m.result(qa.whenViewForGraphic(la));if(!1!==ta.ok&&null!=ta.value&&"whenGraphicBounds"in ta.value)if(ja=await m.result(ta.value.whenGraphicBounds(la,
{minDemResolution:ja})),!1!==ja.ok&&ja.value){var {screenSpaceObjects:Ca,boundingBox:Ga}=ja.value;y.expandWithAABB(oa.boundingBox,Ga);Ca&&Ca.forEach(La=>{oa.screenSpaceObjects.push(La)});isFinite(Ga[2])&&(oa.hasZ=!0)}else await Z(qa,la.geometry,oa,za);else await Z(qa,la.geometry,oa,za)}async function R(qa,la,ja,oa,za){if(Array.isArray(la)&&2===la.length){const ta=la[0],Ca=la[1];if("number"===typeof ta&&"number"===typeof Ca){ra.x=ta;ra.y=Ca;ra.z=void 0;ra.spatialReference=qa.spatialReference?.isGeographic?
qa.spatialReference:H.WGS84;await Z(qa,ra,oa,za);return}}la&&"map"in la&&"function"===typeof la.map?await Promise.allSettled(la.map(ta=>R(qa,ta,ja,oa,za))):la instanceof B?await Z(qa,la,oa,za):la instanceof d&&await P(qa,la,ja,oa,za)}async function W(qa,la,ja,oa,za){if(null!=la.camera)return N(qa,la.camera,oa,za);za.scale=la.scale;za.rotation=la.rotation;za.targetGeometry=null!=la.targetGeometry?la.targetGeometry.clone():null;za.camera=null;null!=ja.heading?za.rotation=c.cyclicalDegrees.normalize(360-
ja.heading):null!=ja.rotation&&(za.rotation=ja.rotation);la=Q(qa,ja);null!=la&&(za.scale=la);za.camera=await L(qa,za,ja.tilt,oa);return za}async function N(qa,la,ja,oa){ja=await n.projectWithZConversion(la.position,qa.spatialReference,{signal:ja});la=la.clone();la.fov=qa.camera.fov;la.position=ja;return U(qa,null,la,oa)}async function V(qa,la,ja,oa,za,ta,Ca){const Ga=qa.renderSpatialReference;await t.projectPointToVectorWithEngine(la,ua,Ga,0,{signal:Ca});await t.projectPointToVectorWithEngine(ja,
ma,Ga,0,{signal:Ca});ta.targetGeometry=new G(la);za.position=new G(ja);w.subtract(da,ua,ma);A.directionToHeadingTilt(qa,ma,da,oa.up,za);ta.scale=A.distanceToScale(qa,w.distance(ma,ua),ta.targetGeometry.latitude);ta.rotation=c.cyclicalDegrees.normalize(360-za.heading);ta.camera=za;return ta}async function S(qa,la,ja,oa,za,ta){if(null==ja)throw new l("createfromcenter","invalid point");ta.targetGeometry=ja.clone();const Ca=E.cameraOnContentAlongViewDirection(qa);if(la.position)return V(qa,ta.targetGeometry,
la.position,Ca,oa,ta,za);if(la.zoomFactor){var Ga=Ca.distance/la.zoomFactor;const La=w.scale(na,Ca.viewForward,-Ga);Ca.eye=w.add(na,Ca.center,La);ta.scale=A.distanceToScale(qa,Ga,ja.latitude)}A.internalToExternal(qa,Ca,oa);Ga=O(oa,la)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;la.zoomFactor||(la=Q(qa,la),null==la?({renderSpatialReference:la}=qa,await t.projectPointToVectorWithEngine(ja,na,la,0,{signal:za}),D.intersectsPoint(Ca.frustum,na)?ta.scale=A.distanceToScale(qa,w.distance(Ca.eye,na),
ja.latitude):ta.scale=A.computeScale(qa,Ca)):ta.scale=la,ta.camera=await A.fromCenterScale(qa,ta.targetGeometry,ta.scale,oa,Ga,za));return ta}async function X(qa,la,ja,oa,za){var ta=E.cameraOnContentAlongViewDirection(qa);w.copy(da,ta.viewForward);A.directionToHeadingTilt(qa,ta.eye,da,ta.up,sa);ta=qa.spatialReference;const {position:Ca}=la;Ca?(za=await n.projectWithZConversion(Ca,ta,{signal:za}),ja.position=za):ja.position=new G;ja.heading=null!=la.heading?la.heading:sa.heading;ja.tilt=null!=la.tilt?
la.tilt:sa.tilt;return U(qa,null,ja,oa)}async function ca(qa,la,ja,oa,za){var ta=E.cameraOnContentAlongViewDirection(qa);const {spatialReference:Ca,renderSpatialReference:Ga}=qa;ta=v.projectVectorToPoint(ta.center,Ga,Ca);return S(qa,la,ta,ja,oa,za)}async function ba(qa,la,ja,oa,za,ta){ta.targetGeometry=ja.clone();const Ca=E.cameraOnContentAlongViewDirection(qa);A.internalToExternal(qa,Ca,oa);la=O(oa,la)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;ta.camera=await A.fromExtentAsync(qa,ja,oa.heading,
oa.tilt,la,za);return ta}async function ia(qa,la,ja,oa,za,ta,Ca,Ga){Ga.targetGeometry=ja.clone();const La=E.cameraOnContentAlongViewDirection(qa);var Ma=0;null!=ja.z?Ma=ja.z:qa.basemapTerrain&&qa.elevationProvider&&(Ma=F.getElevationAtPoint(qa.elevationProvider,ja));w.set(na,ja.x,ja.y,Ma);q.computeTranslationToOriginAndRotation(qa.spatialReference,na,Y,qa.renderSpatialReference);p.fromMat4(ea,Y);p.transpose(ea,ea);y.empty(fa);ja=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Ra=
0;Ra<ja.length;Ra++){const Ya=ja[Ra];let ab=oa[Ya[2]];isFinite(ab)||(ab=Ma);w.set(na,oa[Ya[0]],oa[Ya[1]],ab);r.projectVectorToVector(na,qa.spatialReference,na,qa.renderSpatialReference);y.expandWithVec3(fa,w.transformMat3(na,na,ea))}oa=y.width(fa);Ma=y.height(fa);ja=y.depth(fa);Ra=1/Math.tan(La.fovY/2);za=Math.max(.5*Math.sqrt(oa*oa+ja*ja)*Math.max(Ra,1/Math.tan(La.fovX/2))+.5*Ma,.5*Ma*Ra+.5*Math.max(oa,ja))/za;A.internalToExternal(qa,La,ta);la=O(ta,la)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;
Ga.scale=A.distanceToScale(qa,za,Ga.targetGeometry.latitude);Ga.camera=await A.fromCenterScale(qa,Ga.targetGeometry,Ga.scale,ta,la,Ca);return Ga}function ka(qa){null!=qa?.camera&&(qa.rotation=c.cyclicalDegrees.normalize(360-qa.camera.heading));return qa}const na=x.create(),Y=u.create(),ea=h.create(),fa=y.create(),aa=z.create(),da=x.create(),ma=x.create(),ua=x.create(),sa={heading:0,tilt:0},ra=new G,Aa={point(qa,la,ja){ja[0]=qa.x;ja[1]=qa.y;null!=qa.z&&(ja[2]=qa.z);la(ja)},polygon(qa,la,ja){const oa=
qa.hasZ;for(let za=0;za<qa.rings.length;za++){const ta=qa.rings[za];for(let Ca=0;Ca<ta.length;Ca++)ja[0]=ta[Ca][0],ja[1]=ta[Ca][1],oa&&(ja[2]=ta[Ca][2]),la(ja)}},polyline(qa,la,ja){const oa=qa.hasZ;for(let za=0;za<qa.paths.length;za++){const ta=qa.paths[za];for(let Ca=0;Ca<ta.length;Ca++)ja[0]=ta[Ca][0],ja[1]=ta[Ca][1],oa&&(ja[2]=ta[Ca][2]),la(ja)}},multipoint(qa,la,ja){const oa=qa.points;qa=qa.hasZ;for(let za=0;za<oa.length;za++)ja[0]=oa[za][0],ja[1]=oa[za][1],qa&&(ja[2]=oa[za][2]),la(ja)},extent(qa,
la,ja){null!=qa.zmin&&null!=qa.zmax?(la(w.set(ja,qa.xmin,qa.ymin,qa.zmin)),la(w.set(ja,qa.xmax,qa.ymin,qa.zmin)),la(w.set(ja,qa.xmin,qa.ymax,qa.zmin)),la(w.set(ja,qa.xmax,qa.ymax,qa.zmin)),la(w.set(ja,qa.xmin,qa.ymin,qa.zmax)),la(w.set(ja,qa.xmax,qa.ymin,qa.zmax)),la(w.set(ja,qa.xmin,qa.ymax,qa.zmax)),la(w.set(ja,qa.xmax,qa.ymax,qa.zmax))):(la(w.set(ja,qa.xmin,qa.ymin,ja[2])),la(w.set(ja,qa.xmax,qa.ymin,ja[2])),la(w.set(ja,qa.xmin,qa.ymax,ja[2])),la(w.set(ja,qa.xmax,qa.ymax,ja[2])))}};a.create=async function(qa,
la,ja){if(la&&qa.spatialReference){var oa={target:void 0};"declaredClass"in la||Array.isArray(la)?oa.target=la:(Object.assign(oa,la),la.center&&!oa.target&&(oa.target=la.center));la=oa}else la=null;if(!la)throw new l("viewpointutils-create:no-target","Missing target for creating viewpoint");oa=new b({fov:qa.camera.fov});const za=new k({camera:oa});if(la.target instanceof k)return qa=await W(qa,la.target,la,ja,za),ka(qa);if(la.target instanceof b)return ka(await N(qa,la.target,ja,za));var ta=null!=
la.scale||null!=la.zoom;if(la.target instanceof I){var Ca=la.target.xmin===la.target.xmax||la.target.ymin===la.target.ymax;return ta||Ca?ka(await S(qa,la,la.target.center,oa,ja,za)):ka(await ba(qa,la,la.target,oa,ja,za))}Ca={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]};var Ga=ta?(Ga=Q(qa,la))?C.getResolutionInMetersForScale(Ga):void 0:void 0;await R(qa,la.target,Ga,Ca,ja);if(isFinite(Ca.boundingBox[0])){y.center(Ca.boundingBox,na);ra.x=na[0];ra.y=na[1];ra.z=na[2];ra.spatialReference=qa.spatialReference;
isFinite(ra.z)&&Ca.hasZ?Ga=y.isPoint(Ca.boundingBox):(ra.z=void 0,Ga=z.isPoint(y.toRect(Ca.boundingBox,aa)));if(ta||Ga)return ka(await S(qa,la,ra,oa,ja,za));ta=Ca.screenSpaceObjects;if(ta.length){Ga=Number.NEGATIVE_INFINITY;for(let La=0;La<ta.length;La++){const Ma=ta[La].screenSpaceBoundingRect;Ga=Math.max(Ga,Math.abs(Ma[0]),Math.abs(Ma[1]),Math.abs(Ma[2]),Math.abs(Ma[3]))}ta=.66-Ga/Math.min(qa.width,qa.height)*2}else ta=.66;return ka(await ia(qa,la,ra,Ca.boundingBox,ta,oa,ja,za))}return la.position?
ka(await X(qa,la,oa,za,ja)):ka(await ca(qa,la,oa,ja,za))};a.fromCamera=function(qa,la,ja=null){null==ja&&(ja=new k);return U(qa,null,la.clone(),ja)};a.toCameraAsync=L;a.toCameraSync=function(qa,la,ja){var oa=la.camera;if(null!=oa){a:{qa=A.getViewSR(qa);var za=oa.position;try{var ta=n.project(za,qa)}catch(La){qa=null;break a}qa=oa.clone();qa.position=ta.clone()}return qa}({targetGeometry:ta}=la);if(null==ta)return null;const {camera:Ca,mode:Ga}=M(qa,la.rotation,ja);if("point"===ta.type){a:{oa=qa.spatialReference;
try{za=n.project(ta.clone(),oa)}catch(La){qa=null;break a}ta=null!=la.scale?A.scaleToDistance(qa,la.scale,za.latitude):qa.state.camera.distance;qa=A.fromCenterDistanceSync(qa,za,ta,Ca,Ga)}return qa}ta=ta.extent;return null==ta?null:A.fromExtentSync(qa,ta,Ca.heading,Ca.tilt,Ga)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/computeTranslationToOriginAndRotation":function(){define("exports ../../core/mathUtils ../../chunks/mat4 ../../chunks/vec3f64 ./localRotationUtils ./projectors ../support/spatialReferenceUtils".split(" "),
function(a,b,g,d,k,m,f){function c(h){return h===m.ProjectionID.SPHERICAL_ECEF||h===m.ProjectionID.SPHERICAL_MARS_PCPF||h===m.ProjectionID.SPHERICAL_MOON_PCPF}const l=b.deg2rad(1),e=d.create(),p=d.create();a.computeTranslationToOriginAndRotation=function(h,u,w,x){if(null==h||null==x)return!1;var n=m.classifySpatialReference(h,m.sourceClassificationCache),q=m.classifySpatialReference(x,m.destClassificationCache);if(n===q&&!c(q)&&(n!==m.ProjectionID.UNKNOWN||f.equals(h,x)))return g.fromTranslation(w,
u),!0;if(c(q)){n=m.projectionTable[n][m.ProjectionID.LON_LAT];q=m.projectionTable[m.ProjectionID.LON_LAT][q];if(null==n||null==q)return!1;n(u,0,e,0);q(e,0,p,0);k.computeENUToSphericalPCPFLocalRotation(l*e[0],l*e[1],w);w[12]=p[0];w[13]=p[1];w[14]=p[2];return!0}if((q===m.ProjectionID.WEB_MERCATOR||q===m.ProjectionID.PLATE_CARREE)&&(n===m.ProjectionID.WGS84||n===m.ProjectionID.CGCS2000&&q===m.ProjectionID.PLATE_CARREE||n===m.ProjectionID.SPHERICAL_ECEF||n===m.ProjectionID.WEB_MERCATOR)){h=m.projectionTable[n][m.ProjectionID.LON_LAT];
q=m.projectionTable[m.ProjectionID.LON_LAT][q];if(null==h||null==q)return!1;h(u,0,e,0);q(e,0,p,0);n===m.ProjectionID.SPHERICAL_ECEF?k.computeSphericalPCPFToENULocalRotation(l*e[0],l*e[1],w):g.identity(w);w[12]=p[0];w[13]=p[1];w[14]=p[2];return!0}return!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localRotationUtils":function(){define(["exports","../../chunks/mat4"],function(a,b){function g(d,k,m){const f=Math.sin(d);d=Math.cos(d);const c=Math.sin(k);
k=Math.cos(k);m[0]=-f;m[4]=-c*d;m[8]=k*d;m[12]=0;m[1]=d;m[5]=-c*f;m[9]=k*f;m[13]=0;m[2]=0;m[6]=k;m[10]=c;m[14]=0;m[3]=0;m[7]=0;m[11]=0;m[15]=1;return m}a.computeENUToSphericalPCPFLocalRotation=g;a.computeSphericalPCPFToENULocalRotation=function(d,k,m){g(d,k,m);b.transpose(m,m);return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderFeature":function(){define(["exports","../../../../core/has","../../../../core/NestedMap","../../../support/RenderState"],
function(a,b,g,d){a.RenderFeature=void 0;(function(k){k[k.Antialiasing=0]="Antialiasing";k[k.HighQualityTransparency=1]="HighQualityTransparency";k[k.HighResolutionVoxel=2]="HighResolutionVoxel";k[k.HighResolutionAtmosphere=3]="HighResolutionAtmosphere";k[k.SSAO=4]="SSAO";k[k.WaterReflection=5]="WaterReflection";k[k.HighResolutionShadows=6]="HighResolutionShadows";k[k.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(a.RenderFeature||(a.RenderFeature={}));a.setupFeatureDefaults=function(k=!b("disable-feature:high-quality-idle"),
m=null){const f=new g.NestedMap;k?(f.set(d.RenderState.IDLE,a.RenderFeature.Antialiasing,"low"!==m),f.set(d.RenderState.IDLE,a.RenderFeature.HighResolutionAtmosphere,"low"!==m),f.set(d.RenderState.IDLE,a.RenderFeature.HighQualityTransparency,!0),f.set(d.RenderState.IDLE,a.RenderFeature.SSAO,!0),f.set(d.RenderState.IDLE,a.RenderFeature.WaterReflection,!0),f.set(d.RenderState.IDLE,a.RenderFeature.PhysicalPixelRendering,!0)):(f.set(d.RenderState.ANIMATING,a.RenderFeature.HighResolutionShadows,!0),f.set(d.RenderState.INTERACTING,
a.RenderFeature.HighResolutionShadows,!0));f.set(d.RenderState.IDLE,a.RenderFeature.HighResolutionShadows,!0);f.set(d.RenderState.IDLE,a.RenderFeature.HighResolutionVoxel,!0);return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/NestedMap":function(){define(["exports"],function(a){class b{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(g,d){return this._outer.get(g)?.get(d)}set(g,d,k){const m=this._outer.get(g);
m?m.set(d,k):this._outer.set(g,new Map([[d,k]]))}delete(g,d){const k=this._outer.get(g);k&&(k.delete(d),0===k.size&&this._outer.delete(g))}forEach(g){this._outer.forEach((d,k)=>g(d,k))}}a.NestedMap=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,g,d,k,m){class f extends k.InputHandler{constructor(c,l,e){super(!0);this._view=c;this.pointerAction=l;this.registerIncoming("drag",e,p=>this._handleDrag(p))}_handleDrag(c){const l=c.data;if(!(1<l.pointers.size)&&m.eventMatchesMousePointerAction(c.data,this.pointerAction)){var e=b.createScreenPointArray(l.center.x,l.center.y);switch(l.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=this._view.state.isGlobal?
new g.ZoomController({view:this._view}):new d.ZoomController({view:this._view});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(e);break;case "update":this._cameraController&&this._cameraController.update(e);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}c.stopPropagation()}}}a.DragZoom=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E){a.ZoomController=class extends D.InteractiveController{constructor(){super(...arguments);this._pickPoint=w.create();this._tmpP0=h.create();this._panAxisAngle=n.create();this._tmpRayDir=w.create();this._tmpRayDirPick=w.create();this._targetOnSphere=w.create();this._navMode=C.NavigationMode.Horizontal;this._tmpRay={origin:w.create(),direction:w.create()};this.dragBeginPoint=d.createScreenPointArray();this._normalizedAnchorPoint=h.create();
this._constraintOptions={selection:v.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:r.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE};this._sphere=q.create();this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(G){if(this.active){p.copy(this.dragBeginPoint,G);C.normalizeCoordinate(this.startCamera,G,this._normalizedAnchorPoint);var I=x.getReferenceEllipsoid(this.view.spatialReference),
H=C.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,G,I,C.SpherePickPointFallback.Ellipsoid,0===this.view.map.ground.opacity?C.contentIntersectorOptions:{});this._navMode=C.decideNavigationMode(this.startCamera,G,I);if(this._navMode===C.NavigationMode.Horizontal)this._hasPickPoint=!!H.scenePickPoint,this._pickPoint=H.scenePickPoint??this._pickPoint,this._sphere=H.sphere;else{E.fromScreenAtEye(this.startCamera,G,this._tmpRay);u.normalize(this._tmpRay.direction,this._tmpRay.direction);
let B;null!=H.scenePickPoint&&(u.subtract(this._tmpRayDirPick,this.startCamera.eye,H.scenePickPoint),B=u.length(this._tmpRayDirPick));I=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,F);I=g.clamp(Math.min(C.pivotDistanceModifier,1/Math.abs(u.dot(F,this._tmpRay.direction)))*I,C.distanceClampValues[0],C.distanceClampValues[1]);G=this.view._stage.renderView.getMinimalDepthForArea(null,G[0],G[1],this.view.state.camera,C.screenPixelArea);I=null!=
G?G:I;I=null!=B?Math.min(I,B):I;this._hasPickPoint=!0;u.scale(this._tmpRay.direction,this._tmpRay.direction,I);u.add(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}}update(G){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===C.NavigationMode.Horizontal){u.subtract(this._tmpRayDir,this.currentCamera.center,
this.currentCamera.eye);var I=u.length(this._tmpRayDir);C.normalizeCoordinate(this.currentCamera,G,this._tmpP0);var H=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),B=I*2**H;const K=this.view.state.constraints.minimumPoiDistance;0>H&&B<K&&(B=K);if(1E-6>Math.abs(I-B))return;this._hasPickPoint&&B<I&&(H=1-(1-B/I)*(1-this._sphere[3]/u.length(this.currentCamera.center)),this.currentCamera.center=u.scale(A,this.currentCamera.center,H));u.scale(this._tmpRayDir,this._tmpRayDir,-B/I);this.currentCamera.eye=
u.add(A,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=t.pixelDistanceToInteractionFactor(p.distance(this.dragBeginPoint,G));t.applyAll(this.view,this.currentCamera,this._constraintOptions);this._hasPickPoint&&(C.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),n.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),C.applyRotation(this.currentCamera,this._sphere,this._panAxisAngle))}else{I=
u.length(this._tmpRay.direction);C.normalizeCoordinate(this.currentCamera,G,this._tmpP0);G=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);B=I*2**G;H=this.view.state.constraints.minimumPoiDistance;0>G&&B<H&&(B=H);if(1E-6>Math.abs(I-B))return;u.scale(this._tmpRayDir,this._tmpRay.direction,1-B/I);this.currentCamera.eye=u.add(A,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=u.add(A,this.currentCamera.center,this._tmpRayDir)}y.applySurfaceCollisionConstraint(this.view,this.currentCamera);
this.commitCamera()}}end(){this.active&&this.finishController()}};a.ZoomController=b.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const A=w.create(),F=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../layers/VoxelWasm ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){a.ZoomController=class extends y.InteractiveController{constructor(){super(...arguments);this._tmpP=w.create();this._tmpDir=w.create();this._tmpN=w.create();this._tmpP0=h.create();this._tmpPoi=w.create();this._tmpRayDir=w.create();this.dragBeginPoint=d.createScreenPointArray();this._normalizedAnchorPoint=h.create();this._constraintOptions={selection:q.ConstraintTypes.ALL,interactionType:t.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,
interactionDirection:w.create(),tiltMode:v.TiltMode.TUMBLE};this._plane=x.create()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(E){if(this.active){p.copy(this.dragBeginPoint,E);z.normalizeCoordinate(this.startCamera,E,this._normalizedAnchorPoint);var A=this._intersectionHelper.intersectScreenFreePointFallback(E,this._tmpP,0===this.view.map.ground.opacity?z.contentIntersectorOptions:{});u.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var F=u.length(this._tmpDir);
u.normalize(this._tmpDir,this._tmpDir);var G=Math.abs(this.view.camera.position.z);G=g.clamp(Math.min(z.pivotDistanceModifier,1/Math.abs(u.dot(C,this._tmpDir)))*G,z.distanceClampValues[0],z.distanceClampValues[1]);E=this.view._stage.renderView.getMinimalDepthForArea(r.getVoxelWasm(this.view),E[0],E[1],this.view.state.camera,z.screenPixelArea);G=null!=E?E:G;G=A?Math.min(G,F):G;u.scale(this._tmpDir,this._tmpDir,G);u.add(this._tmpP,this.startCamera.eye,this._tmpDir);u.subtract(this._tmpN,this.startCamera.eye,
this.startCamera.center);u.normalize(this._tmpN,this._tmpN);0>this._tmpN[1]&&u.negate(this._tmpN,this._tmpN);x.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane);this._constraintOptions.interactionStartCamera=this.startCamera}}update(E){if(this.active){z.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||u.copy(this._tmpPoi,this.currentCamera.center);z.normalizeCoordinate(this.currentCamera,E,this._tmpP0);var A=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);
p.copy(this._normalizedAnchorPoint,this._tmpP0);u.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var F=u.length(this._tmpRayDir),G=F*(1-A);this._constraintOptions.interactionDirection&&(u.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),u.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(A)/F));var I=this.view.state.constraints.minimumPoiDistance;0<=A&&G<I&&(G=I,A=-(G-F)/F);1E-6>Math.abs(F-G)||(u.scale(this._tmpRayDir,
this._tmpRayDir,A),this.currentCamera.eye=u.add(D,this.currentCamera.eye,this._tmpRayDir),u.lerp(D,this.currentCamera.center,this._tmpPoi,A),D[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],D[2]):Math.min(this.startCamera.center[2],D[2]),this.currentCamera.center=D,this._constraintOptions.interactionFactor=n.pixelDistanceToInteractionFactor(p.distance(this.dragBeginPoint,E)),n.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}}end(){this.active&&
this.finishController()}};a.ZoomController=b.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const D=w.create(),C=w.fromValues(0,0,1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define(["exports","../../../../core/Handles","../../../../core/reactiveUtils","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,g,d,k){class m extends k.InputHandler{constructor(f){super(!0);
this._view=f;this._watchHandles=new b;this._handle=this.registerIncoming("gamepad",c=>this._handleEventGamepad(c));this._handle.pause()}onInstall(f){super.onInstall(f);this._watchHandles.add([g.watch(()=>this._view.navigation.gamepad.enabled,c=>{c?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},g.initial),g.watch(()=>this._view.navigation.gamepad.device,c=>{this._cameraControllerGamepad&&
c&&this._cameraControllerGamepad.gamepadDevice!==c&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll();super.onUninstall()}_handleEventGamepad(f){var c=this._view.navigation.gamepad.device;if(!c||f.data.device===c)if((c=this._cameraControllerGamepad&&this._cameraControllerGamepad.active)||d.GamepadKeyboardController.activatesFor(this._view,f.data))c||(c=new d.GamepadKeyboardController({view:this._view,gamepadDevice:f.data.device}),
this._view.state.switchCameraController(c)&&(this._cameraControllerGamepad=c)),this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===f.data.device&&this._cameraControllerGamepad.handleEventGamepad(f.data)}}a.GamepadNavigation=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I){a.GamepadKeyboardController=class extends D.InteractiveController{constructor(O){super(O);this._filteredSurfaceElevation=0;this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];this._tmpCamera=new G.Camera;this._headingStart=0;this._constraintOptions={selection:v.ConstraintTypes.ALL,interactionType:r.InteractionType.NONE,interactionStartCamera:new G.Camera,interactionFactor:0,
interactionDirection:null,tiltMode:y.TiltMode.LOOK_AROUND}}handleEventGamepad(O){const U=I.extractTransformation(O,this.view.navigation.gamepad,this._transformation);("end"===O.action||I.isZeroTransformation(U))&&this.finishController()}activateDirection(O){this._keysButtonState[O]=1;I.extractTransformationKeyboard(this._keysButtonState,this._transformation)}deactivateDirection(O){this._keysButtonState[O]=0;O=I.extractTransformationKeyboard(this._keysButtonState,this._transformation);I.isZeroTransformation(O)&&
this.finishController()}onControllerStart(O){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;super.onControllerStart(O)}_updateFilteredSurfaceElevation(O){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*O}stepController(O,U){this._updateStartHeading();this._updateFilteredSurfaceElevation(O);this.currentCamera.copyViewFrom(U);this._updateCameraCenter();
this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera);this._calculateControlTransformation(O,this.currentCamera,J);this._applyDisabledMovementTypes(J);this._applyPan(J.pan);this._applyRotate(J.rotate);this._applyZoom(J.zoom);this._applyAscend(J.ascend);this._constraintOptions.interactionType=r.InteractionType.NONE;this._constraintOptions.selection=v.ConstraintTypes.COLLISION;t.applyAll(this.view,this.currentCamera,this._constraintOptions);super.stepController(O,U)}_updateStartHeading(){0!==
this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(O){if(O.enabled){var U=this.currentCamera;p.subtract(M,U.center,U.eye);p.transformMat4(M,M,O.matrix);U.center=p.add(M,M,U.eye);U.up=p.transformMat4(M,U.up,O.matrix);this._constraintOptions.interactionType=r.InteractionType.LOOK_AROUND;this._constraintOptions.selection=v.ConstraintTypes.ALL_EXCEPT_COLLISION;t.applyAll(this.view,U,this._constraintOptions)}}_applyPan(O,U=this.currentCamera){O.enabled&&(U.eye=p.transformMat4(M,
U.eye,O.matrix),U.center=p.transformMat4(M,U.center,O.matrix),this.view.state.isGlobal&&(U.up=p.transformMat4(M,U.up,O.matrix)),this._constraintOptions.interactionType=r.InteractionType.PAN,this._constraintOptions.selection=v.ConstraintTypes.ALL,t.applyAll(this.view,U,this._constraintOptions))}_applyZoom(O){if(O){var U=this.currentCamera.viewForward;this.currentCamera.eye=p.add(M,this.currentCamera.eye,p.scale(q.sv3d.get(),U,O));p.copy(T,U);p.negate(T,T);this._constraintOptions.interactionDirection=
T;this._constraintOptions.interactionType=r.InteractionType.ZOOM;this._constraintOptions.selection=v.ConstraintTypes.ALL_EXCEPT_COLLISION;t.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}}_applyAscend(O){if(O){var U=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,q.sv3d.get());this._constraintOptions.interactionDirection=p.copy(T,U);this.view.state.isGlobal?(U=p.length(this.currentCamera.eye),O=(U+O)/U,this.currentCamera.eye=
p.scale(M,this.currentCamera.eye,O),this.currentCamera.center=p.scale(M,this.currentCamera.center,O)):(O=p.scale(q.sv3d.get(),U,O),this.currentCamera.eye=p.add(M,this.currentCamera.eye,O),this.currentCamera.center=p.add(M,this.currentCamera.center,O));this._updateCameraCenter();this._constraintOptions.interactionType=r.InteractionType.ASCEND;this._constraintOptions.selection=v.ConstraintTypes.COLLISION;t.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=
v.ConstraintTypes.ALL_EXCEPT_COLLISION;t.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}}_calculateControlTransformation(O,U,Z){Z.zoom=0;Z.ascend=0;Z.pan.enabled=!1;l.identity(Z.pan.matrix);Z.rotate.enabled=!1;l.identity(Z.rotate.matrix);O=this._computeVelocities(O);this.view.state.isLocal?this._calculateControlTransformationLocal(O,U,Z):this._calculateControlTransformationGlobal(O,U,Z)}_updateCameraCenter(){this.currentCamera.center=
this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,M)}_calculateControlTransformationLocal(O,U,Z){const {viewRight:P,viewForward:R}=U,W=this._transformation;var N=this.view.navigation.gamepad,V=p.set(q.sv3d.get(),R[0],R[1],0);p.normalize(V,V);var S=W.translation[0]*O.pan;0!==S&&(S=p.scale(q.sv3d.get(),P,S),l.translate(Z.pan.matrix,Z.pan.matrix,S),Z.pan.enabled=!0);switch(N.mode){case "pan":N=
-W.translation[1]*O.pan;0!==N&&(V=p.scale(q.sv3d.get(),V,N),l.translate(Z.pan.matrix,Z.pan.matrix,V),Z.pan.enabled=!0);Z.zoom=W.zoom*O.zoom;break;case "zoom":Z.zoom=(-W.translation[1]+W.zoom)*O.zoom;break;default:g.neverReached(N.mode)}Z.ascend=W.translation[2]*O.ascend;V=-W.heading*O.rotate;0!==V&&(l.rotate(Z.rotate.matrix,Z.rotate.matrix,V,this.view.renderCoordsHelper.worldUpAtPosition(U.eye,q.sv3d.get())),Z.rotate.enabled=!0);O=W.tilt*O.rotate;U=E.viewAngle(this.view.renderCoordsHelper,U.center,
U.eye);if(U=d.clamp(U+O,z.TiltDefault.min,z.TiltDefault.max)-U)l.rotate(Z.rotate.matrix,Z.rotate.matrix,U,P),Z.rotate.enabled=!0}_calculateControlTransformationGlobal(O,U,Z){const {eye:P,viewRight:R}=U,W=this._transformation;var N=this.view.navigation.gamepad,V=p.cross(q.sv3d.get(),R,P);p.normalize(V,V);p.negate(V,V);C.panMotionToRotationMatrix(this.startCamera,U,W,O,this.view.camera.heading,this._headingStart,this.view.camera.tilt,Z,N);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(J.pan,
this._tmpCamera);N=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;Z.ascend=W.translation[2]*O.ascend;V=-W.heading*O.rotate;0!==V&&(l.rotate(Z.rotate.matrix,Z.rotate.matrix,V,this._tmpCamera.eye),Z.rotate.enabled=!0);U=this._clampTiltDeltaGlobalToValidRange(W.tilt*O.rotate,U.ray,N);0!==U&&(l.rotate(Z.rotate.matrix,Z.rotate.matrix,U,this._tmpCamera.viewRight),Z.rotate.enabled=!0);Z.zoom+=W.zoom*O.zoom}_clampTiltDeltaGlobalToValidRange(O,U,Z){const P=u.getReferenceEllipsoid(this.view.spatialReference),
R=C.onSurfaceTiltToEyeTiltGlobal(z.TiltDefault.min,U.origin,Z,P);var W=0;let N=0;W=q.sv3d.get();this.view.renderCoordsHelper.intersectManifold(U,Z,W)?(W=E.viewAngle(this.view.renderCoordsHelper,W,U.origin),W=C.onSurfaceTiltToEyeTiltGlobal(W,U.origin,Z,P),N=C.onSurfaceTiltToEyeTiltGlobal(z.TiltDefault.max,U.origin,Z,P)):(x.closestPointOnSilhouette(x.fromRadius(x.tmpSphere,Z+P.radius),U,W),W=Math.PI+n.angle(U.direction,W),W=C.offSurfaceTiltToEyeTiltGlobal(W,U.origin,Z,P),N=C.offSurfaceTiltToEyeTiltGlobal(z.TiltDefault.max,
U.origin,Z,P));return d.clamp(W+O,R,N)-W}_getPointAbsoluteSurfaceElevation(O,U,Z){const {renderCoordsHelper:P}=this.view,R=P.getAltitude(O);U+=Math.abs(R-U);P.setAltitude(Z,U,O);return U}_clampedDistanceToSurface(O,U){const {renderCoordsHelper:Z}=this.view,{camera:P}=this.view.state;var {direction:R}=A.headingTiltToDirectionUp(this.view,U,0,80,Q);R=Z.intersectManifoldClosestSilhouette(w.wrap(U,R),O,q.sv3d.get());R=p.distance(U,R);O=Z.intersectManifoldClosestSilhouette(w.wrap(U,p.direction(q.sv3d.get(),
U,P.center)),O,q.sv3d.get());U=p.distance(U,O);return Math.min(R,U)}_computeHeadingRotateRadius(O){const {renderCoordsHelper:U,state:Z}=this.view,{camera:P,isGlobal:R}=Z;var W=U.intersectManifoldClosestSilhouette(P.ray,this._filteredSurfaceElevation,q.sv3d.get());if(R){const N=p.subtract(q.sv3d.get(),O,W);W=p.length(N);p.scale(N,N,1/W);O=p.normalize(q.sv3d.get(),O);O=d.acosClamped(p.dot(O,N));return W*Math.sin(Math.min(B,O))}O=p.copy(q.sv3d.get(),O);U.setAltitude(O,this._filteredSurfaceElevation);
return p.distance(W,O)}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:5}_computeVelocities(O){var U=this._filteredSurfaceElevation,Z=U+u.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:P,isGlobal:R}=this.view.state;var W=q.sv3d.get();const N=this._getPointAbsoluteSurfaceElevation(P.eye,U,W);var V=this._clampedDistanceToSurface(U,W);const S=P.width/2,X=.75*P.width,ca=.75*P.width;var ba=V*Math.tan(.5*P.fovX)/S;Z=ba/Z;W=ba/this._computeHeadingRotateRadius(W);
ba=(R?Z:ba)*X*O;U=N-U;U=Math.max(this._minimumAscendVelocity()*O,2**(X*O/S)*U-U);V=2**(X*O/S)*V-V;O*=d.clamp(W*ca,K,L);return{pan:ba,ascend:U,zoom:V,rotate:O}}_applyDisabledMovementTypes(O){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(O.zoom=this.disableMovements.zoom?0:O.zoom,O.ascend=this.disableMovements.ascend?0:O.ascend,O.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&l.identity(O.pan.matrix),O.rotate.enabled=
!this.disableMovements.rotate,this.disableMovements.rotate&&l.identity(O.rotate.matrix))}static activatesFor(O,U){O=I.extractTransformation(U,O.navigation.gamepad,H);return!("end"===U.action||I.isZeroTransformation(O))}};b.__decorate([k.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);b.__decorate([k.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=b.__decorate([c.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],
a.GamepadKeyboardController);const H={translation:[0,0,0],heading:0,tilt:0,zoom:0},B=d.deg2rad(80),K=d.deg2rad(30),L=d.deg2rad(80),J={zoom:0,ascend:0,pan:{enabled:!1,matrix:e.create()},rotate:{enabled:!1,matrix:e.create()}},M=h.create(),T=h.create(),Q=F.createDirectionUp();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,b){function g(d){let k=d*d;0>d&&(k*=-1);return k}a.extractTransformation=
function(d,k,m){const f=d.state;d=d.device;k="forward-down"===k.tiltDirection?1:-1;"standard"===d.deviceType?(m.translation[0]=g(f.axes[0]),m.translation[1]=g(f.axes[1]),m.translation[2]=g(f.buttons[7])-g(f.buttons[6]),m.heading=g(f.axes[2]),m.tilt=g(f.axes[3])):"spacemouse"===d.deviceType&&(m.translation[0]=1.2*g(f.axes[0]),m.translation[1]=1.2*g(f.axes[1]),m.translation[2]=2*-g(f.axes[2]),m.heading=1.2*g(f.axes[5]),m.tilt=1.2*g(f.axes[3]));m.tilt*=k;b.scale(m.translation,m.translation,1);return m};
a.extractTransformationKeyboard=function(d,k){k.translation[0]=d[1]-d[0];k.translation[1]=d[3]-d[2];k.translation[2]=d[4]-d[5];k.heading=d[7]-d[6];k.tilt=d[8]-d[9];k.zoom=d[10]-d[11];return k};a.isZeroTransformation=function(d){return 0===d.translation[0]&&0===d.translation[1]&&0===d.translation[2]&&0===d.heading&&0===d.tilt&&0===d.zoom};a.resetTransformation=function(d){d.translation[0]=0;d.translation[1]=0;d.translation[2]=0;d.heading=0;d.tilt=0;return d};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler","../../../input/VisibilityChange"],function(a,b,g,d,k){var m;(function(c){c[c.LEFT=0]="LEFT";c[c.RIGHT=1]="RIGHT";c[c.FORWARD=2]="FORWARD";c[c.BACKWARD=3]="BACKWARD";c[c.UP=4]="UP";c[c.DOWN=5]="DOWN";c[c.HEADINGLEFT=6]="HEADINGLEFT";c[c.HEADINGRIGHT=7]="HEADINGRIGHT";c[c.TILTUP=8]="TILTUP";c[c.TILTDOWN=
9]="TILTDOWN";c[c.ZOOMIN=10]="ZOOMIN";c[c.ZOOMOUT=11]="ZOOMOUT"})(m||(m={}));class f extends d.InputHandler{constructor(c,l){super(!0);this._view=c;this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:b.ViewingMode.Local};this._keyToNumber={[l.left]:m.LEFT,[l.right]:m.RIGHT,[l.forward]:m.FORWARD,[l.backward]:m.BACKWARD,[l.up]:m.UP,[l.down]:m.DOWN,[l.headingLeft]:m.HEADINGLEFT,[l.headingRight]:m.HEADINGRIGHT,[l.tiltUp]:m.TILTUP,[l.tiltDown]:m.TILTDOWN,[l.zoomIn]:m.ZOOMIN,[l.zoomOut]:m.ZOOMOUT};
this.registerIncoming("key-down",null,e=>this._handleKeyDown(e));this.registerIncoming("key-up",null,e=>this._handleKeyUp(e));this.registerIncoming("blur",null,()=>this._handleStop());this._visibilityHandle=k.onVisibilityChange(e=>e?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove();this._handleStop()}_handleKeyDown(c){if(!c.data.native.ctrlKey&&!c.data.native.metaKey){var l=this._keyToNumber[c.data.key];null!=l&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||
(this._cameraControllerKeyboard=new g.GamepadKeyboardController({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(l),c.stopPropagation()))}}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(c){if(!c.data.native.ctrlKey&&!c.data.native.metaKey){var l=
this._keyToNumber[c.data.key];null!=l&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(l),c.stopPropagation())}}}a.KeyboardNavigation=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/VisibilityChange":function(){define(["exports"],function(a){a.onVisibilityChange=function(b){const g=()=>b("visible"===document.visibilityState);document.addEventListener("visibilitychange",g);return{remove:()=>
document.addEventListener("visibilitychange",g)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/global/ZoomStepController","../../state/controllers/local/ZoomStepController","../../../input/InputHandler"],function(a,b,g,d,k){class m extends k.InputHandler{constructor(f,c){super(!0);this._view=f;this.registerIncoming("mouse-wheel",c,l=>this._handleMouseWheel(l))}_handleMouseWheel(f){if(this._view.navigation.mouseWheelZoomEnabled){var c=
f.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new g.ZoomStepController({view:this._view,mode:"interaction"}):new d.ZoomStepController({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController));this._cameraController.zoomStep(-1/60*c.deltaY,b.createScreenPointArray(c.x,c.y));f.preventDefault();f.stopPropagation()}}}a.MouseWheelZoom=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define(["exports","../../state/controllers/global/PinchAndPanController","../../state/controllers/local/PinchAndPanController","../../../input/InputHandler","../../../input/handlers/support"],function(a,b,g,d,k){class m extends d.InputHandler{constructor(f,c,l){super(!0);this._view=f;this.pointerAction=c;this._lastTimestamp=this._lastEndTimestamp=0;this.registerIncoming("drag",l,e=>this._handleDrag(e))}_handleDrag(f){if("mouse"!==f.data.pointerType||
k.eventMatchesMousePointerAction(f.data,this.pointerAction)){var c=f.timestamp-this._lastEndTimestamp;c=this._momentum&&this._momentum.active&&40>c;switch(f.data.action){case "start":case "update":if(c)break;this._controller&&this._controller.active?2<f.data.timestamp-this._lastTimestamp&&(this._controller.update(f.data),this._lastTimestamp=f.timestamp):this._startController(f);break;case "end":case "removed":this._endController(f,!0);break;case "added":this._endController(f,!1),this._startController(f)}f.stopPropagation()}}_endController(f,
c){this._controller&&this._controller.active&&(this._lastEndTimestamp=f.timestamp,f=this._controller.end(f.data),c&&f&&(this._momentum=f,this._view.state.switchCameraController(this._momentum)));this._controller=null}_startController(f){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(f.data);this._lastTimestamp=f.timestamp}_createController(){return this._view.state.isGlobal?new b.PinchAndPanController({view:this._view}):new g.PinchAndPanController({view:this._view})}}
a.PinchAndPanNavigation=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M){a.PinchAndPanController=class extends C.InteractiveController{constructor(){super(...arguments);this._smoothRotation=new D.ExponentialFalloff(.05);this._rotationAxis=w.create();this._beginHeading=this._beginAngle=0;this._panningPlane=q.create();this._beginRadius=0;this._smoothScaling=new D.ExponentialFalloff(.05);this._zoomCenterScreen=k.createScreenPointArray();this._zoomMomentumEstimator=new M.ZoomMomentumEstimator;
this._rotationMomentumEstimator=new J.RotationMomentumEstimator;this._panSphericalMomentumEstimator=new L.PanSphericalMomentumEstimator;this._panPlanarMomentumEstimator=new K.PanPlanarMomentumEstimator;this._adjustedSphere=t.create();this._tmp3d=w.create();this._tmpScreenPointArray=k.createScreenPointArray();this._beginScreenPoint=k.createScreenPointArray();this._beginScenePoint=w.create();this._screenPickPoint=k.createScreenPointArray();this._scenePickPoint=w.create();this._mode=H.NavigationMode.Horizontal;
this._sphere=t.create();this._pointerCount=0;this._tmpInteractionDirection=w.create();this._constraintOptions={selection:r.ConstraintTypes.ALL,interactionType:y.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new B.Camera,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(T){if(this.active){var Q=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=Q;this._rotationMomentumEstimator.enabled=
Q;this._panPlanarMomentumEstimator.enabled=Q;this._panSphericalMomentumEstimator.enabled=Q;this._beginHeading=-g.cyclicalPI.normalize(d.deg2rad(this.view.camera.heading));this._beginRadius=T.radius;this._pointerCount=T.pointers.size;this._beginAngle=T.angle;this._smoothRotation.reset();k.screenPointObjectToArray(T.center,this._screenPickPoint);h.copy(this._beginScreenPoint,this._screenPickPoint);Q=x.getReferenceEllipsoid(this.view.spatialReference);var O=H.pickPointAndInitSphere(this._intersectionHelper,
this.startCamera,this._screenPickPoint,Q,H.SpherePickPointFallback.Silhouette,0===this.view.map.ground.opacity?H.contentIntersectorOptions:{});null!=O.scenePickPoint&&(this._scenePickPoint=O.scenePickPoint,this._sphere=O.sphere,u.copy(this._beginScenePoint,this._scenePickPoint),this._mode=H.decideNavigationMode(this.startCamera,this._screenPickPoint,Q),this._mode===H.NavigationMode.Vertical&&this._preparePlanarPanMode(T,O.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}}update(T){if(this.active){this.currentCamera.copyFrom(this.startCamera);
var Q=1<T.pointers.size;this._mode===H.NavigationMode.Horizontal?(Q&&this._zoomSpherical(T),this._panningSpherical(T),Q&&this._rotateSpherical(T)):(Q&&this._zoomPlanar(T),this._panningPlanar(T),Q&&this._rotatePlanar(T));this.commitCamera()}}end(T){T.pointers.size===this._pointerCount&&this.update(T);this.finishController();if(T=this._zoomMomentumEstimator.evaluateMomentum())return this._mode===H.NavigationMode.Horizontal?new I.ZoomSphericalMomentumController({view:this.view,momentum:T,screenCenter:this._zoomCenterScreen,
sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new G.ZoomPlanarMomentumController({view:this.view,momentum:T,zoomCenter:this._beginScenePoint});if(T=this._rotationMomentumEstimator.evaluateMomentum())return new F.RotationMomentumController({view:this.view,momentum:T,center:this._sphere,axis:this._rotationAxis});if(this._mode===H.NavigationMode.Horizontal){if(T=this._panSphericalMomentumEstimator.evaluateMomentum())return new A.PanSphericalMomentumController({view:this.view,momentum:T})}else if(T=
this._panPlanarMomentumEstimator.evaluateMomentum())return new E.PanPlanarMomentumController({view:this.view,momentum:T});return null}_preparePlanarPanMode(T,Q){var O=u.negate(this._tmp3d,this.startCamera.viewForward);q.fromPositionAndNormal(this._scenePickPoint,O,this._panningPlane);var U=k.createScreenPointArray(this._screenPickPoint[0],0);O=w.create();var Z=u.length(this.startCamera.eye);this._adjustedSphere[3]=Z<this._sphere[3]?Z-100:this._sphere[3];H.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,
this.startCamera,U,O);U=k.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(O,U);O=w.create();U=w.create();Z=w.create();u.subtract(O,this._scenePickPoint,this.currentCamera.eye);const P=u.length(O);u.normalize(O,O);var R=H.panDistanceModifier*Math.max(Math.abs(this.view.camera.position.z),H.minHeightLimit);const W=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,H.screenPixelArea);R=null!=W?W:R;R=
Q?Math.min(R,P):R;u.copy(Z,u.add(U,this.currentCamera.eye,u.scale(U,O,R)));this._panningPlane[3]=-u.dot(q.normal(this._panningPlane),Z);this.startCamera.center=u.add(U,this.startCamera.eye,u.scale(U,this.startCamera.viewForward,R));T=k.screenPointObjectToArray(T.center,this._tmpScreenPointArray);H.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,T,this._beginScenePoint)}_zoomSpherical(T){const Q=this._beginRadius/T.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(T.radius,
40),120);this._smoothScaling.update(Q);H.applyZoomOnSphere(this._sphere,this.currentCamera,this._smoothScaling.value);k.screenPointObjectToArray(T.center,this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*T.timestamp);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(T.radius-this._beginRadius);v.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(T){const Q=
k.screenPointObjectToArray(T.center,this._tmpScreenPointArray);H.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,Q,this._tmp3d);H.preserveHeadingThreshold(this._beginScenePoint,u.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(H.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(Q,
this._tmp3d,.001*T.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(H.applyPanSphericalDirectRotation(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(Q,this._tmp3d,.001*T.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=y.InteractionType.PAN;this._constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(h.distance(this._screenPickPoint,
Q));v.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(T){u.normalize(this._rotationAxis,this._scenePickPoint);this.currentCamera.aboveGround||u.negate(this._rotationAxis,this._rotationAxis);var Q=this._smoothRotation.value,O=H.normalizeRotationDelta(T.angle-Q);Q+=O;this._smoothRotation.gain=.00125*Math.min(Math.max(T.radius,40),120);this._smoothRotation.update(Q);O=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(O,.001*T.timestamp);H.applyRotation(this.currentCamera,
this._sphere,n.wrapAxisAngle(this._rotationAxis,O));this._constraintOptions.interactionType=y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(T.radius*Q);v.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(T){const Q=k.screenPointObjectToArray(T.center,this._tmpScreenPointArray);H.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,Q,this._tmp3d)&&(H.applyPanPlanar(this.currentCamera,this._beginScenePoint,
this._tmp3d),this._panPlanarMomentumEstimator.add(Q,this._tmp3d,.001*T.timestamp),this._constraintOptions.interactionType=y.InteractionType.PAN,this._constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(h.distance(this._beginScreenPoint,Q)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),v.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=
null)}_zoomPlanar(T){const Q=this._beginRadius/T.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(T.radius,40),120);this._smoothScaling.update(Q);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*T.timestamp);H.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(T.radius-
this._beginRadius);v.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(T){u.copy(this._rotationAxis,this._beginScenePoint);this.currentCamera.aboveGround||u.negate(this._rotationAxis,this._rotationAxis);var Q=this._smoothRotation.value;let O=T.angle-Q;O=H.normalizeRotationDelta(O);this._smoothRotation.gain=.00125*Math.min(Math.max(T.radius,40),120);this._smoothRotation.update(Q+O);Q=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(Q,.001*T.timestamp);
H.applyRotation(this.currentCamera,this._sphere,n.wrapAxisAngle(this._rotationAxis,Q));this._constraintOptions.interactionType=y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(T.radius*Q);v.applyAll(this.view,this.currentCamera,this._constraintOptions)}};a.PinchAndPanController=b.__decorate([p.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/input/util":function(){define(["exports"],function(a){class b{constructor(g){this._gain=g}reset(g){this._value=g}set gain(g){this._gain=g}get value(){return void 0===this._value?0:this._value}update(g){this._value=void 0===this._value?g:this._gain*g+(1-this._gain)*this._value}}a.ExponentialFalloff=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){a.PanPlanarMomentumController=class extends p.MomentumController{constructor(u){super(u);this.interactionType=e.InteractionType.PAN;this._tmpPan=l.create()}momentumStep(u,w){u=this.momentum.value(u);c.scale(this._tmpPan,this.momentum.direction,u);w.eye=c.subtract(h,w.eye,this._tmpPan);w.center=c.subtract(h,w.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan}};b.__decorate([g.property({constructOnly:!0})],a.PanPlanarMomentumController.prototype,
"momentum",void 0);a.PanPlanarMomentumController=b.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const h=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){a.MomentumController=class extends w.AnimationController{constructor(){super(...arguments);this._beginCamera=new x.Camera;this._elapsedTimeSec=0;this.constraintOptions={selection:p.ConstraintTypes.ALL,interactionType:h.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new x.Camera,interactionDirection:null,tiltMode:u.TiltMode.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new l}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(n){this._beginCamera.copyFrom(n);
this.constraintOptions.interactionStartCamera=this._beginCamera;super.onControllerStart(n)}stepController(n,q){q.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=n;this.momentumStep(this._elapsedTimeSec,q);e.applyAll(this.view,q,this.constraintOptions)}};a.MomentumController=b.__decorate([c.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){const u=l.create(),w=l.create();a.PanSphericalMomentumController=class extends p.MomentumController{constructor(x){super(x);this.interactionType=e.InteractionType.PAN}momentumStep(x,n){const q=this.momentum.value1(x);x=this.momentum.value2(x);c.copy(w,n.eye);c.normalize(w,w);c.cross(this.momentum.axis2,w,this.momentum.axis1);h.applyRotationWithTwoAxes(n,u,this.momentum.axis1,q,this.momentum.axis2,x)}};b.__decorate([g.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,
"momentum",void 0);a.PanSphericalMomentumController=b.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){a.RotationMomentumController=class extends p.MomentumController{set center(u){this._set("center",c.clone(u))}set axis(u){this._set("axis",c.clone(u))}constructor(u){super(u);this.interactionType=e.InteractionType.TUMBLE}momentumStep(u,w){u=this.momentum.value(u);h.applyRotation(w,this.center,l.wrapAxisAngle(this.axis,u))}};b.__decorate([g.property({constructOnly:!0})],a.RotationMomentumController.prototype,"momentum",void 0);b.__decorate([g.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"center",null);b.__decorate([g.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=b.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){a.ZoomPlanarMomentumController=class extends p.MomentumController{set zoomCenter(u){this._set("zoomCenter",l.clone(u))}constructor(u){super(u);this.interactionType=e.InteractionType.ZOOM;this.constraintOptions.interactionDirection=l.create()}momentumStep(u,w){const {interactionDirection:x}=this.constraintOptions;x&&(c.copy(x,w.eye),u=this.momentum.valueDelta(0,u),h.applyZoomToPoint(w,this.zoomCenter,u,this.view.state.constraints.minimumPoiDistance),c.direction(x,
w.eye,x))}};b.__decorate([g.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);b.__decorate([g.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=b.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],a.ZoomPlanarMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){a.ZoomSphericalMomentumController=class extends w.MomentumController{set screenCenter(n){this._set("screenCenter",g.createScreenPointArray(n[0],n[1]))}set sceneCenter(n){this._set("sceneCenter",l.clone(n))}constructor(n){super(n);this.interactionType=u.InteractionType.ZOOM;this.radius=0;this._tmpSceneCenter=l.create();this._tmpZoomAxisAngle=e.create();this._sphere=p.create()}initialize(){this._sphere[3]=this.radius}momentumStep(n,q){n=this.momentum.valueDelta(0,
n);x.applyZoomOnSphere(this._sphere,q,n);this.constraintOptions.interactionType=u.InteractionType.ZOOM;h.applyAll(this.view,q,this.constraintOptions);x.sphereOrPlanePointFromScreenPoint(this._sphere,q,this.screenCenter,this._tmpSceneCenter);e.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);x.applyRotation(q,this._sphere,this._tmpZoomAxisAngle);this.constraintOptions.interactionType=u.InteractionType.PAN}};b.__decorate([d.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,
"momentum",void 0);b.__decorate([d.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);b.__decorate([d.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);b.__decorate([d.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=b.__decorate([c.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec3","../../chunks/vec3f64","./FilteredFiniteDifference","./Momentum"],function(a,b,g,d,k){class m extends k.Momentum{constructor(c,l,e,p,h){super(c,l,e);this._sceneVelocity=p;this.direction=h}value(c){return super.valueFromInitialVelocity(this._sceneVelocity,c)}}class f{constructor(c=300,l=12,e=.84){this._minimumInitialVelocity=c;this._stopVelocity=
l;this._friction=e;this.enabled=!0;this._time=new d.FilteredFiniteDifference(.6);this._screen=[new d.FilteredFiniteDifference(.4),new d.FilteredFiniteDifference(.4)];this._scene=[new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6)];this._tmpDirection=g.create()}add(c,l,e){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(e)||(this._screen[0].update(c[0]),this._screen[1].update(c[1]),this._scene[0].update(l[0]),this._scene[1].update(l[1]),
this._scene[2].update(l[2]),this._time.update(e))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var c=this._screen[0].filteredDelta,l=this._screen[1].filteredDelta;c=null==c||null==l?0:Math.sqrt(c*c+l*l);l=this._time.filteredDelta;c=null==l||null==c?0:c/l;return Math.abs(c)<this._minimumInitialVelocity?
null:this.createMomentum(c,this._stopVelocity,this._friction)}createMomentum(c,l,e){b.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const p=b.length(this._tmpDirection);0<p&&b.scale(this._tmpDirection,this._tmpDirection,1/p);const h=this._time.filteredDelta;return new m(c,l,e,null==h?0:p/h,this._tmpDirection)}}a.PanPlanarMomentum=m;a.PanPlanarMomentumEstimator=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(a){class b{constructor(g){this._gain=g;this.filteredDelta=this.lastValue=void 0}update(g){if(this.hasLastValue()){const d=this.computeDelta(g);this._updateDelta(d)}this.lastValue=g}reset(){this.filteredDelta=this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(g){return void 0===this.lastValue?NaN:g-this.lastValue}_updateDelta(g){this.filteredDelta=
void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*g:g}}a.FilteredFiniteDifference=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(a){class b{constructor(g,d,k){this._initialVelocity=g;this._stopVelocity=d;this._friction=k;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(g){return g>
this.duration}get friction(){return this._friction}value(g){return this.valueFromInitialVelocity(this._initialVelocity,g)}valueDelta(g,d){const k=this.value(g);return this.value(g+d)-k}valueFromInitialVelocity(g,d){d=Math.min(d,this.duration);const k=1-this.friction;return g*(k**d-1)/Math.log(k)}}a.Momentum=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(a,b,g,d,k,m,f,c){class l extends c.Momentum{constructor(p,h,u,w,x,n=0,q){super(p,h,u);this._angularVelocity1=w;this.axis1=x;this.angularVelocity2=n;this.axis2=q}value1(p){return super.valueFromInitialVelocity(this._angularVelocity1,p)}value2(p){return super.valueFromInitialVelocity(this.angularVelocity2,p)}}class e{constructor(p=300,h=12,u=.84){this._minimumInitialVelocity=p;this._stopVelocity=h;this._friction=u;this.enabled=!0;this._tmpAxis1=d.create();this._tmpAxis2=d.create();this._tmpAngles=
b.create();this._time=new m.FilteredFiniteDifference(.3);this._screen=[new m.FilteredFiniteDifference(.4),new m.FilteredFiniteDifference(.4)];this._angle1=new f.FilteredValue(.6);this._angle2=new f.FilteredValue(.6);this._axis1=d.create();this._axis2=d.create();this._lastScene=d.create()}addMomentumDirectRotation(p,h,u,w,x,n){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(u))return;w=k.rotationAngleAndAxisDirectRotation(this._lastScene,h,this._tmpAxis2,w,x,n);this._angle2.update(0);
1E-5>g.squaredLength(this._tmpAxis2)?w=0:g.normalize(this._axis1,this._tmpAxis2);this._angle1.update(w);g.copy(this._lastScene,h)}this._screen[0].update(p[0]);this._screen[1].update(p[1]);this._time.update(u)}}addMomentumPreserveHeading(p,h,u,w,x,n,q){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(u))return;k.rotationAnglesAndAxesHeadingPreserving(this._lastScene,h,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,w,x,n,q,!1);1E-5>g.squaredLength(this._tmpAxis2)?(this._angle1.update(0),
this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),g.normalize(this._axis1,this._tmpAxis1),g.normalize(this._axis2,this._tmpAxis2));g.copy(this._lastScene,h)}this._screen[0].update(p[0]);this._screen[1].update(p[1]);this._time.update(u)}}reset(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();this._angle2.reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var p=this._screen[0].filteredDelta,
h=this._screen[1].filteredDelta;p=null==p||null==h?null:Math.sqrt(p*p+h*h);h=this._time.filteredDelta;p=null==p||null==h?0:p/h;return Math.abs(p)<this._minimumInitialVelocity?null:this.createMomentum(p,this._stopVelocity,this._friction)}createMomentum(p,h,u){const w=this._time.filteredDelta,x=this._angle1.filteredValue,n=this._angle2.filteredValue;return new l(p,h,u,null==w||null==x?0:x/w,this._axis1,null==w||null==n?0:n/w,this._axis2)}}a.PanSphericalMomentum=l;a.PanSphericalMomentumEstimator=e;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredValue":function(){define(["exports"],function(a){class b{constructor(g){this._gain=g}update(g){this.filteredValue=void 0!==this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*g:g}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}a.FilteredValue=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(a,b){class g extends b.MomentumEstimator{constructor(d=3,k=.01,m=.95,f=12){super(d,k,m,f)}add(d,k){const m=this.value.lastValue;if(null!=m){for(d-=m;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=m+d}super.add(d,k)}}a.RotationMomentumEstimator=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,
g,d){class k{constructor(m=2.5,f=.01,c=.95,l=12){this._minimumInitialVelocity=m;this._stopVelocity=f;this._friction=c;this._maxVelocity=l;this.enabled=!0;this.value=new g.FilteredFiniteDifference(.8);this.time=new g.FilteredFiniteDifference(.3)}add(m,f){if(this.enabled&&null!=f){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(f))return;if(this.value.hasFilteredDelta()){const c=this.value.computeDelta(m);0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(f);this.value.update(m)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let m=this.value.filteredDelta/this.time.filteredDelta;m=b.clamp(m,-this._maxVelocity,this._maxVelocity);return Math.abs(m)<this._minimumInitialVelocity?null:this.createMomentum(m,this._stopVelocity,this._friction)}createMomentum(m,f,c){return new d.Momentum(m,f,c)}}a.MomentumEstimator=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(a,b,g){class d extends b.Momentum{constructor(m,f,c){super(m,f,c)}value(m){m=super.value(m);return Math.exp(m)}valueDelta(m,f){const c=super.value(m);m=super.value(m+f);return Math.exp(m-c)}}class k extends g.MomentumEstimator{constructor(m=2.5,f=.01,c=.95,l=12){super(m,f,c,l)}add(m,f){super.add(Math.log(m),f)}createMomentum(m,f,c){return new d(m,f,c)}}a.ZoomMomentum=d;a.ZoomMomentumEstimator=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../../../layers/VoxelWasm ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H){const B=u.fromValues(0,0,1);var K=16/180*Math.PI;a.PinchAndPanController=class extends z.InteractiveController{constructor(){super(...arguments);this._rotationValueSmooth=new r.ExponentialFalloff(.05);this._scalingValueSmooth=new r.ExponentialFalloff(.05);this._planeHorizontal=x.create();this._planeVertical=x.create();this._rotationMomentumEstimator=new I.RotationMomentumEstimator;this._panMomentumEstimator=new G.PanPlanarMomentumEstimator(300,
12,.9);this._zoomMomentumEstimator=new H.ZoomMomentumEstimator;this._beginRadius=0;this._beginCenter=u.create();this._beginAngle=0;this._tmpPoints=[];this._panMode=A.NavigationMode.Horizontal;this._beginCenterScreen=d.createScreenPointArray();this._tmpCentroid3d=u.create();this._tmpCentroid2d=d.createScreenPointArray();this._tmp2d=d.createScreenPointArray();this._pointerCount=0;this._constraintOptions={selection:q.ConstraintTypes.ALL,interactionType:t.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new F.Camera,
interactionDirection:null,tiltMode:v.TiltMode.TUMBLE}}begin(L){if(this.active){var J=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=J;this._rotationMomentumEstimator.enabled=J;this._panMomentumEstimator.enabled=J;this._beginRadius=L.radius;this._pointerCount=L.pointers.size;this._beginAngle=L.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();d.screenPointObjectToArray(L.center,this._beginCenterScreen);x.fromNormalAndOffset(B,0,this._planeHorizontal);
var M=u.create();J=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,M,0===this.view.map.ground.opacity?A.contentIntersectorOptions:{});var T=u.create();h.negate(T,this.startCamera.viewForward);var Q=u.create();h.copy(Q,B);var O=h.dot(T,Q);this._panMode=g.asinClamped(0>O?-O:O)>=K?A.NavigationMode.Horizontal:A.NavigationMode.Vertical;var U=Math.min(A.panDistanceModifier,1/Math.abs(h.dot(Q,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),
A.minHeightLimit);x.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,M);this.startCamera.aboveGround||x.negate(this._planeHorizontal,this._planeHorizontal);var Z=u.create(),P=u.create(),R=u.create();h.subtract(Z,M,this.currentCamera.eye);var W=h.length(Z);h.normalize(Z,Z);this._panMode===A.NavigationMode.Vertical?(h.scale(Q,Q,O),h.subtract(this._planeVertical,T,Q),h.normalize(this._planeVertical,this._planeVertical),x.setOffsetFromPoint(this._planeVertical,this._planeVertical,M),M=this.view._stage.renderView.getMinimalDepthForArea(y.getVoxelWasm(this.view),
this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,A.screenPixelArea),U=null!=M?M:U,U=J?Math.min(U,W):U,h.copy(R,h.add(P,this.currentCamera.eye,h.scale(P,Z,U))),this._planeVertical[3]=-h.dot(this._planeVertical,R),this._computePlanePoints(L.pointers,this._planeVertical,this.startCamera,this._tmpPoints)):(h.copy(R,h.add(P,this.currentCamera.eye,h.scale(P,Z,J?W:U))),this._planeHorizontal[3]=-h.dot(x.normal(this._planeHorizontal),R),this._computePlanePoints(L.pointers,this._planeHorizontal,
this.startCamera,this._tmpPoints));A.centroid(this._tmpPoints,this._beginCenter);this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}}update(L){if(this.active){this.currentCamera.copyFrom(this.startCamera);var J=1<L.pointers.size,M=this._panMode===A.NavigationMode.Horizontal?this._planeHorizontal:this._planeVertical,T=this._beginCenter;if(J){var Q=this._beginRadius/L.radius;this._scalingValueSmooth.gain=.001875*Math.min(Math.max(L.radius,40),120);this._scalingValueSmooth.update(Q);
A.applyZoomToPoint(this.currentCamera,T,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*L.timestamp);this._constraintOptions.interactionType=t.InteractionType.ZOOM;this._constraintOptions.interactionFactor=n.pixelDistanceToInteractionFactor(Math.abs(L.radius-this._beginRadius));n.applyAll(this.view,this.currentCamera,this._constraintOptions)}this._computePlanePoints(L.pointers,M,this.currentCamera,this._tmpPoints);
A.centroid(this._tmpPoints,this._tmpCentroid3d);d.screenPointObjectToArray(L.center,this._tmpCentroid2d);A.applyPanPlanar(this.currentCamera,T,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*L.timestamp);this._constraintOptions.interactionType=t.InteractionType.PAN;this._constraintOptions.interactionFactor=n.pixelDistanceToInteractionFactor(p.distance(this._beginCenterScreen,this._tmpCentroid2d));n.applyAll(this.view,this.currentCamera,this._constraintOptions);
J&&(J=this._planeHorizontal,M=this._rotationValueSmooth.value,Q=A.normalizeRotationDelta(L.angle-M),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(L.radius,40),120),this._rotationValueSmooth.update(M+Q),M=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(M,.001*L.timestamp),A.applyRotation(this.currentCamera,T,w.wrapAxisAngle(J,M)),this._constraintOptions.interactionType=t.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=n.pixelDistanceToInteractionFactor(Math.abs(L.radius*
M)),n.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}}end(L){L.pointers.size===this._pointerCount&&this.update(L);this.finishController();return(L=this._zoomMomentumEstimator.evaluateMomentum())?new E.ZoomPlanarMomentumController({view:this.view,momentum:L,zoomCenter:this._beginCenter}):(L=this._rotationMomentumEstimator.evaluateMomentum())?new C.RotationMomentumController({view:this.view,momentum:L,center:this._beginCenter,axis:x.normal(this._planeHorizontal)}):
(L=this._panMomentumEstimator.evaluateMomentum())?new D.PanPlanarMomentumController({view:this.view,momentum:L}):null}_computePlanePoints(L,J,M,T){T.length=L.size;const Q=this._tmp2d;let O=0;L.forEach(U=>{Q[0]=U.x;Q[1]=U.y;void 0===T[O]&&(T[O]=u.create());A.intersectPlaneFromScreenPointAtEye(J,M,Q,T[O]);O+=1});return T}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};a.PinchAndPanController=b.__decorate([e.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],
a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../input/InputHandler"],function(a,b){class g extends b.InputHandler{constructor(d,k){super(!0);this.view=d;this.registerIncoming("pointer-down",k,()=>this.view.state.stopActiveCameraController())}}a.PointerDownCancelAnimation=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports",
"./SingleKey"],function(a,b){class g extends b.SingleKey{constructor(d,k,m){super(k,m);this.view=d}activate(){this.view.goTo({heading:0}).catch(()=>{})}}a.SingleKeyResetHeading=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../input/InputHandler"],function(a,b){class g extends b.InputHandler{constructor(d,k){super(!0);this.key=d;this.registerIncoming("key-down",k,m=>this._handleKeyDown(m))}_handleKeyDown(d){d.data.key===
this.key&&(this.activate(),d.stopPropagation())}}a.SingleKey=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","./SingleKey"],function(a,b){class g extends b.SingleKey{constructor(d,k,m){super(k,m);this.view=d}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}a.SingleKeyResetTilt=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports",
"../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,b,g,d){class k extends d.InputHandler{constructor(m,f=!1){super(!0);this._view=m;this._invert=f;this.registerIncoming("vertical-two-finger-drag",c=>this._handleTwoFinger(c))}_handleTwoFinger(m){const f=b.createScreenPointArray(0,m.data.delta*(this._invert?-1:1));switch(m.data.action){case "begin":this._cameraController?.end();this._cameraController=new g.RotateController({view:this._view,
pivot:g.PivotPoint.CENTER});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(f);break;case "update":this._cameraController?.update(f);break;case "end":this._cameraController?.end(),this._cameraController=null}}}a.TwoFingerTilt=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../core/has ../../core/maybe ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),function(a,
b,g,d,k,m){const f=b("edge"),c=b("chrome"),l=b("ff"),e=b("safari");class p{constructor(u,w){this._input=w;this._active={};this._callback=()=>{};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=u;u.getAttribute("tabindex")||u.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new k.GamepadSource(u,this._input);this._gamepadSource.onEvent=x=>this._callback("gamepad",x)}destroy(){this._callback=()=>{};this.activeEvents=null;this._activePointerCaptures.forEach(u=>
{this._releasePointerCaptureSafe(u)});this._gamepadSource=g.destroyMaybe(this._gamepadSource);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(u){this._browserTouchPanningEnabled=u;this._updateTouchAction();this._updateTouchEventHandling()}set onEventReceived(u){this._callback=u}set activeEvents(u){for(const w in this._active)u&&
u.has(w)||(this._element.removeEventListener(h[w],this._active[w]),delete this._active[w]);u&&u.forEach(w=>{if(!this._active[w]&&h[w]){const x=(this._eventHandlers[w]||this._handleDefault).bind(this,w);this._element.addEventListener(h[w],x);this._active[w]=x}});this._gamepadSource.hasEventListeners=u?.has("gamepad")??!1}setPointerCapture(u,w){w?this._setPointerCatpureSafe(u.pointerId):(this._releasePointerCaptureSafe(u.pointerId),this._activePointerCaptures.delete(u.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(u){try{this._element.setPointerCapture(u),this._activePointerCaptures.add(u)}catch{}}_releasePointerCaptureSafe(u){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(u)||this._element.releasePointerCapture(u)}catch(w){}}_updateNormalizedPointerLikeEvent(u,w){u=m.createScreenPointFromNativeEvent(this._element,u);p.test.disableSubpixelCoordinates&&(u.x=Math.round(u.x),u.y=Math.round(u.y));
w.x=u.x;w.y=u.y;return w}_handleKey(u,w){const x=d.eventKey(w);x&&"key-up"===u&&this._keyDownState.delete(x);w={native:w,key:x,repeat:!!x&&this._keyDownState.has(x)};x&&"key-down"===u&&this._keyDownState.add(w.key);this._callback(u,w)}_handlePointer(u,w){w=this._updateNormalizedPointerLikeEvent(w,{native:w,x:0,y:0,pointerType:w.pointerType,button:w.button,buttons:w.buttons,eventId:this._eventId++});this._callback(u,w)}_handlePointerPreventDefault(u,w){const x=this._updateNormalizedPointerLikeEvent(w,
{native:w,x:0,y:0,pointerType:w.pointerType,button:w.button,buttons:w.buttons,eventId:this._eventId++});w.preventDefault();this._callback(u,x)}_handleMouseWheel(u,w){let x=w.deltaY;switch(w.deltaMode){case 0:f&&(x=x/document.documentElement.clientHeight*600);break;case 1:x*=30;break;case 2:x*=900}f?x*=.7:c||e?x*=.6:l&&(x*=1.375);const n=Math.abs(x);100<n&&(x=x/n*200/(1+Math.exp(-.02*(n-100))));w=this._updateNormalizedPointerLikeEvent(w,{native:w,x:0,y:0,deltaY:x});this._callback(u,w)}_handlePointerCaptureLost(u,
w){this._activePointerCaptures.delete(w.pointerId);this._handleDefault(u,w)}_handleDefault(u,w){const x={native:w};w.preventDefault();this._callback(u,x)}_preventAltKeyDefault(u){"Alt"===u.key&&u.preventDefault()}_preventMultiTouchPanning(u){1<u.touches.length&&u.preventDefault()}}p.test={disableSubpixelCoordinates:!1};const h={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture",
"pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,g,d){class k{constructor(m,f){this._element=m;this._input=f;this._hasEventListeners=
!1;this._onConnectGamepad=c=>{this._connectGamepad(c.gamepad)};this._onDisconnectGamepad=c=>{c=c.gamepad;const l=c.index,e=this._inputDevices[l];e&&(this._emitGamepadEvent(c,d.extractState(e),!1),this._inputDevices.splice(l,1),this._latestUpdate.splice(l,1),this._input.gamepad.devices.remove(e),this.ensurePollingState())};this._frameTask=null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;m=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&m)this._forEachGamepad(c=>
this._connectGamepad(c)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}destroy(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(m){this._hasEventListeners!==m&&(this._hasEventListeners=m,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&
0<this._inputDevices.length&&this._hasEventListeners}set onEvent(m){this._callback=m}_connectGamepad(m){const f=new g(m);"unknown"!==f.deviceType&&(this._inputDevices[m.index]=f,this._input.gamepad.devices.add(f));this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=b.addFrameTask({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=
null,this._latestUpdate=[])}_readGamepadState(){const m=document.hasFocus(),f=this._element.contains(document.activeElement),c="document"===this._input.gamepad.enabledFocusMode&&!m||"view"===this._input.gamepad.enabledFocusMode&&!f;this._forEachGamepad(l=>{var e=this._inputDevices[l.index];if(e){var p=this._latestUpdate[l.index];e=d.extractState(e);var h=c||d.stateIdle(e);p&&(p.timestamp===l.timestamp||!p.active&&h||d.stateEqual(p.state,e))||this._emitGamepadEvent(l,e,!h)}})}_forEachGamepad(m){const f=
window.navigator.getGamepads();for(let c=0;c<f.length;c++){const l=f[c];this._validate(l)&&m(l)}}_emitGamepadEvent(m,f,c){var l=this._latestUpdate[m.index];if((l=l&&l.active)||c)this._latestUpdate[m.index]={timestamp:m.timestamp,state:f,active:c},this._callback&&this._callback({device:this._inputDevices[m.index],state:f,action:!l&&c?"start":l&&c?"update":"end"})}_validate(m){if(!m||!m.connected)return!1;for(let f=0;f<m.axes.length;f++)if(isNaN(m.axes[f]))return!1;return!0}}a.GamepadSource=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=function(b){const g=b.native;return g?{buttons:g.buttons.map(d=>d.pressed?d.value||1:0),axes:g.axes.map(d=>{{var k=b.axisThreshold;const m=Math.abs(d);d=m<k?0:Math.sign(d)*(m-k)/(1-k)}return d})}:{buttons:[],axes:[]}};a.stateEqual=function(b,g){if(b.axes.length!==g.axes.length||b.buttons.length!==g.buttons.length)return!1;for(var d=0;d<b.axes.length;d++)if(b.axes[d]!==
g.axes[d])return!1;for(d=0;d<b.buttons.length;d++)if(b.buttons[d]!==g.buttons[d])return!1;return!0};a.stateIdle=function(b){for(var g=0;g<b.axes.length;g++)if(0!==b.axes[g])return!1;for(g=0;g<b.buttons.length;g++)if(0!==b.buttons[g])return!1;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../InputHandler"],function(a,b){class g extends b.InputHandler{constructor(){super(!0);this.registerIncoming("context-menu",
d=>{d.data.native.preventDefault()})}}a.PreventContextMenu=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/Drag":function(){define(["exports","../../../core/screenUtils","../../../core/time","../InputHandler","./support"],function(a,b,g,d,k){function m(p){const h=[];p.forEach(u=>{h.push(b.createScreenPoint(u.event.x,u.event.y))});return k.fitCircleLSQ(h)}function f(p){const h=m(p);let u=0;p.forEach(w=>{var x=l(w,h);for(x-=w.lastAngle;x>Math.PI;)x-=2*
Math.PI;for(;x<-Math.PI;)x+=2*Math.PI;x=w.lastAngle+x;w.lastAngle=x;u+=x-w.initialAngle});u/=p.size||1;return{angle:u,radius:h.radius,center:h.center}}function c(p){const h=new Map;p.forEach((u,w)=>h.set(w,u.event));return h}function l(p,h){p=p.event;return Math.atan2(p.y-h.center.y,p.x-h.center.x)}class e extends d.InputHandler{constructor(p){super(!1);this._navigationTouch=p;this._startStateModifiers=new Set;this._activePointerMap=new Map;this._isCurrentDragSuppressed=this._isDragging=!1;this._drag=
this.registerOutgoing("drag");this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this));this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(p,h,u,w){return{action:p,pointerType:this._pointerType,button:this._mouseButton,buttons:h.buttons,timestamp:w,pointers:c(this._activePointerMap),
pointer:h,angle:u.angle,radius:u.radius,center:u.center}}_addPointer(p){var h=p.native.pointerId;const u=f(this._activePointerMap).angle;p={event:p,initialAngle:0,lastAngle:0};this._activePointerMap.set(h,p);h=l(p,m(this._activePointerMap));p.initialAngle=h;p.lastAngle=h;this._updatePointerAngles(u)}_updatePointer(p){if(!p||null!=p.x||null!=p.y){var h=this._activePointerMap.get(p.native.pointerId);h?h.event=p:this._addPointer(p)}}_removePointer(p){const h=f(this._activePointerMap).angle;this._activePointerMap.delete(p);
this._updatePointerAngles(h)}_updatePointerAngles(p){const h=f(this._activePointerMap);this._activePointerMap.forEach(u=>{u.initialAngle=l(u,h)-p;u.lastAngle=l(u,h)-p})}_emitEvent(p,h,u){const w=f(this._activePointerMap);this._drag.emit(this._createPayload(p,h,w,u),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(p){const h=p.data.native.pointerId,u=g.Milliseconds(p.timestamp);this._activePointerMap.get(h)&&(1===this._activePointerMap.size?(this._updatePointer(p.data),!this._isCurrentDragSuppressed&&
this._emitEvent("end",p.data,u),this._isCurrentDragSuppressed=this._isDragging=!1,this._removePointer(h)):(this._removePointer(h),this._emitEvent("removed",p.data,g.Milliseconds(p.timestamp))))}_handlePointerDrag(p){const h=p.data,u=h.currentEvent,w=g.Milliseconds(p.timestamp);switch(h.action){case "start":case "update":this._isDragging?this._activePointerMap.has(u.native.pointerId)?(this._updatePointer(u),!this._isCurrentDragSuppressed&&this._emitEvent("update",u,w)):(this._addPointer(u),this._emitEvent("added",
u,w),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(u),this._pointerType=p.data.startEvent.pointerType,this._mouseButton=p.data.startEvent.button,this._startStateModifiers=p.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",u,w))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}a.Button=
void 0;(function(p){p[p.Left=0]="Left";p[p.Middle=1]="Middle";p[p.Right=2]="Right";p[p.Back=3]="Back";p[p.Forward=4]="Forward";p[p.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,
maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};a.euclideanDistance=function(g,d){const k=d.x-g.x;g=d.y-g.y;return Math.sqrt(k*k+g*g)};a.fitCircleLSQ=function(g,d){d?(d.radius=0,d.center.x=0,d.center.y=0):d={radius:0,center:b.createScreenPoint()};if(0===g.length)return d;if(1===g.length)return d.center.x=g[0].x,d.center.y=g[0].y,d;if(2===g.length){const [n,q]=g,[t,v]=[q.x-n.x,q.y-n.y];d.radius=Math.sqrt(t*t+v*v)/2;d.center.x=(n.x+q.x)/2;d.center.y=(n.y+q.y)/
2;return d}let k=0,m=0;for(d=0;d<g.length;d++)k+=g[d].x,m+=g[d].y;k/=g.length;m/=g.length;var f=g.map(n=>n.x-k),c=g.map(n=>n.y-m);let l=d=0;var e=0,p=0,h=0,u=0,w=0;for(var x=0;x<f.length;x++){const n=f[x],q=c[x],t=n*n,v=q*q;d+=t;l+=v;e+=n*q;p+=t*n;h+=v*q;u+=n*v;w+=q*t}f=d;c=e;x=l;p=.5*(p+u);h=.5*(h+w);w=f*x-e*c;u=(p*x-h*c)/w;h=(f*h-e*p)/w;w=b.createScreenPoint(u+k,h+m);return{radius:Math.sqrt(u*u+h*h+(d+l)/g.length),center:w}};a.getPointerId=function(g){({native:g}=g);const {pointerId:d,button:k,
pointerType:m}=g;return"mouse"===m?`${d}:${k}`:`${m}`};a.manhattanDistance=function(g,d){return Math.abs(d.x-g.x)+Math.abs(d.y-g.y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define(["exports","../../../core/clock","../InputHandler","./support"],function(a,b,g,d){class k extends g.InputHandler{constructor(m=d.DefaultParameters.maximumDoubleClickDelay,f=d.DefaultParameters.maximumDoubleClickDistance,c=d.DefaultParameters.maximumDoubleTouchDelay,
l=d.DefaultParameters.maximumDoubleTouchDistance,e=b.clock){super(!1);this._maximumDoubleClickDelay=m;this._maximumDoubleClickDistance=f;this._maximumDoubleTouchDelay=c;this._maximumDoubleTouchDistance=l;this._clock=e;this._pointerState=new Map;this._immediateDoubleClick=this.registerOutgoing("immediate-double-click");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(m=>
{m.immediateDoubleClick&&m.immediateDoubleClick.timeoutHandle.remove()});super.onUninstall()}_handlePointerDown(m){m=m.data;const f=d.getPointerId(m);this._pointerState.has(f)||(this._pointerState.set(f,{downButton:m.native.button,x:m.x,y:m.y,immediateDoubleClick:null}),this.startCapturingPointer(m.native))}_handlePointerUp(m){const f=m.data;var c=d.getPointerId(f);if((c=this._pointerState.get(c))&&c.downButton===f.native.button){const l=c.immediateDoubleClick,e="touch"===m.data.native.pointerType?
this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;l?(l.timeoutHandle.remove(),d.manhattanDistance(l,m.data)>e?this._startImmediateDoubleClick(m,c):(this._immediateDoubleClick.emit(m.data,void 0,l.modifiers),this._removeState(f))):d.manhattanDistance(c,m.data)>e?this._removeState(f):this._startImmediateDoubleClick(m,c)}}_startImmediateDoubleClick(m,f){f.immediateDoubleClick={x:m.data.x,y:m.data.y,modifiers:m.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(m.data),
"touch"===m.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}}_removeState(m){const f=d.getPointerId(m);this._pointerState.delete(f);this.stopCapturingPointer(m.native);this.refreshHasPendingInputs()}}a.ImmediateDoubleClick=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../core/clock","../../../core/maybe","../InputHandler","./support"],function(a,b,g,d,
k){class m extends d.InputHandler{constructor(f=k.DefaultParameters.maximumClickDelay,c=k.DefaultParameters.movementUntilMouseDrag,l=k.DefaultParameters.movementUntilPenDrag,e=k.DefaultParameters.movementUntilTouchDrag,p=k.DefaultParameters.holdDelay,h=b.clock){super(!1);this._maximumClickDelay=f;this._movementUntilMouseDrag=c;this._movementUntilPenDrag=l;this._movementUntilTouchDrag=e;this._holdDelay=p;this._clock=h;this._pointerState=new Map;this._pointerDrag=this.registerOutgoing("pointer-drag");
this._immediateClick=this.registerOutgoing("immediate-click");this._pointerHold=this.registerOutgoing("hold");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",u=>{this._handlePointerLoss(u,"pointer-up")});this.registerIncoming("pointer-capture-lost",u=>{this._handlePointerLoss(u,"pointer-capture-lost")});this.registerIncoming("pointer-cancel",u=>{this._handlePointerLoss(u,"pointer-cancel")});this._moveHandle=this.registerIncoming("pointer-move",
this._handlePointerMove.bind(this));this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(f=>{f.holdTimeout=g.removeMaybe(f.holdTimeout)});super.onUninstall()}_handlePointerDown(f){const c=f.data,l=c.native.pointerId;var e=null;0===this._pointerState.size&&(e=this._clock.setTimeout(()=>{const p=this._pointerState.get(l);p&&(p.isDragging||(this._pointerHold.emit(p.previousEvent,void 0,f.modifiers),p.holdEmitted=!0),p.holdTimeout=null)},this._holdDelay));e={startEvent:c,previousEvent:c,
startTimestamp:f.timestamp,isDragging:!1,downButton:c.native.button,holdTimeout:e,modifiers:new Set};this._pointerState.set(l,e);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(f)}_createPointerDragData(f,c,l){return{action:f,startEvent:c.startEvent,previousEvent:c.previousEvent,currentEvent:l}}_handlePointerMove(f){const c=f.data,l=this._pointerState.get(c.native.pointerId);if(l){if(l.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",
l,c),void 0,l.modifiers);else{const e=k.euclideanDistance(c,l.startEvent),p=this._getDragThreshold(c.native.pointerType);e>p&&this._startDragging(f)}l.previousEvent=c}}_getDragThreshold(f){switch(f){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(f){const c=f.data,l=c.native.pointerId;this._pointerState.forEach(e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);e.isDragging||
(e.modifiers=f.modifiers,e.isDragging=!0,l===e.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",e,c)):this._pointerDrag.emit(this._createPointerDragData("start",e,e.previousEvent),f.timestamp))})}_handlePointerLoss(f,c){const l=f.data,e=l.native.pointerId,p=this._pointerState.get(e);p&&(null!=p.holdTimeout&&(p.holdTimeout.remove(),p.holdTimeout=null),p.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",p,"pointer-up"===c?l:p.previousEvent),void 0,
p.modifiers):"pointer-up"===c&&p.downButton===l.native.button&&f.timestamp-p.startTimestamp<=this._maximumClickDelay&&!p.holdEmitted&&this._immediateClick.emit(l),this._pointerState.delete(e),this.stopCapturingPointer(l.native),0===this._pointerState.size&&this._moveHandle.pause())}}a.PointerClickHoldAndDrag=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),
function(a,b,g,d,k,m){class f extends k.InputHandler{constructor(c=m.DefaultParameters.maximumDoubleClickDelay,l=m.DefaultParameters.maximumDoubleClickDistance,e=m.DefaultParameters.maximumDoubleTouchDelay,p=m.DefaultParameters.maximumDoubleTouchDistance,h=b.clock){super(!1);this._maximumDoubleClickDelay=c;this._maximumDoubleClickDistance=l;this._maximumDoubleTouchDelay=e;this._maximumDoubleTouchDistance=p;this._clock=h;this._pointerState=new Map;this._click=this.registerOutgoing("click");this._doubleClick=
this.registerOutgoing("double-click");this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this));this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(c=>c.doubleClickTimer=d.removeMaybe(c.doubleClickTimer))}get hasPendingInputs(){return g.someMap(this._pointerState,c=>null!=c.doubleClickTimer)}_clearDoubleClickTimer(c,l){const e=this._pointerState.get(c);e&&(e.doubleClickTimer=d.removeMaybe(e.doubleClickTimer),l&&this._click.emit(e.event.data,
void 0,e.event.modifiers),this._pointerState.delete(c),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(c){const l=this._pointerState.get(c);1===l.pointerDownCount&&this._click.emit(l.event.data,void 0,l.event.modifiers);l.doubleClickTimer=null;this._pointerState.delete(c);this.refreshHasPendingInputs()}_getPointerId(c){const {pointerId:l,pointerType:e,button:p}=c.native;return"mouse"===e?`${l}:${p}`:`${e}`}_handleImmediateClick(c){const l=c.data;var {pointerType:e}=l.native;const p=this._getPointerId(l);
if(this._pointerState.has(p)){var h=this._pointerState.get(p),{data:u,modifiers:w}=h.event;e="touch"===e?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;m.manhattanDistance(u,l)>e?(this._clearDoubleClickTimer(p,!0),this._startClick(c)):(this._clearDoubleClickTimer(p,!1),2===h.pointerDownCount&&this._doubleClick.emit(u,void 0,w))}else this._startClick(c)}_handlePointerDown(c){c=m.getPointerId(c.data);if(c=this._pointerState.get(c))c.pointerDownCount+=1}_startClick(c){var {data:l}=
c;const {native:{pointerType:e}}=l,p=m.getPointerId(l);l=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(p),"touch"===e?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(p,{event:c,doubleClickTimer:l,pointerDownCount:1});this.refreshHasPendingInputs()}}a.SingleAndDoubleClick=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../DragEventSeparator","../InputHandler"],
function(a,b,g){class d extends g.InputHandler{constructor(k=20,m=40){super(!1);this._threshold=k;this._maxDelta=m;this._state="ready";this._emittedArtificalEnd2=!1;this._vertical=this.registerOutgoing("vertical-two-finger-drag");this._artificalDrag=this.registerOutgoing("drag");this._dragEventSeparator=new b.DragEventSeparator({start:(f,c)=>this._observeStart(f,c),update:(f,c,l)=>this._observeUpdate(f,c,l),end:(f,c)=>this._observeEnd(c)});this.registerIncoming("drag",f=>this._dragEventSeparator.handle(f))}get failed(){return"failed"===
this._state}_observeStart(k,m){1===k&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:m.data.button,buttons:m.data.buttons,pointerType:m.data.pointerType,timestamp:m.data.timestamp,pointers:m.data.pointers,pointer:m.data.pointer,angle:m.data.angle,radius:m.data.radius,center:m.data.center}),m.stopPropagation());this._state=2===k?"ready":"failed"}_observeUpdate(k,m,f){"failed"!==this._state&&2===k&&("active"===this._state?(this._vertical.emit({delta:m.data.center.y-
this._thresholdReachedCenter.y,action:"update"}),m.stopPropagation()):this._checkMovementWithinLimits(m.data,f.data)?this._checkVerticalThresholdReached(m.data,f.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=m.data.center,this._artificalDrag.emit({action:"end",button:m.data.button,buttons:m.data.buttons,pointerType:m.data.pointerType,timestamp:m.data.timestamp,pointers:m.data.pointers,pointer:m.data.pointer,angle:m.data.angle,radius:m.data.radius,center:m.data.center}),
this._vertical.emit({delta:m.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),m.stopPropagation()):this._state="failed")}_observeEnd(k){"active"===this._state&&(this._vertical.emit({delta:k.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",k.stopPropagation())}_checkMovementWithinLimits(k,m){let f=-Infinity,c=Infinity,l=-Infinity,e=Infinity;for(const {x,y:n}of m.pointers.values())f=Math.max(f,x),c=Math.min(c,x),l=Math.max(l,n),e=Math.min(e,n);let p=-Infinity,
h=Infinity,u=-Infinity,w=Infinity;for(const {x,y:n}of k.pointers.values())p=Math.max(p,x),h=Math.min(h,x),u=Math.max(u,n),w=Math.min(w,n);return Math.abs(k.center.x-m.center.x)<this._threshold&&Math.abs(p-h-(f-c))<=this._maxDelta&&Math.abs(u-w-(l-e))<=this._maxDelta}_checkVerticalThresholdReached(k,m){let f=Math.abs(k.center.y-m.center.y);k.pointers.forEach((c,l)=>{l=m.pointers.get(l);f=Math.min(f,Math.abs(c.y-l.y))});return f>=this._threshold}}a.VerticalTwoFingerDrag=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){class b{constructor(g){this._callbacks=g;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(g){const d=g.data,k=d.pointers.size;switch(d.action){case "start":this._currentCount=k;this._emitStart(g);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=k;this._emitStart(g);break;case "update":this._emitUpdate(g);break;case "removed":this._startEvent&&
this._emitEnd(this._previousEvent);this._currentCount=k;this._emitStart(g);break;case "end":this._emitEnd(g),this._currentCount=0}this._previousEvent=g}_emitStart(g){this._startEvent=g;this._callbacks.condition?.(this._currentCount,g)&&this._callbacks.start(this._currentCount,g,this._startEvent)}_emitUpdate(g){this._callbacks.condition?.(this._currentCount,g)&&this._callbacks.update(this._currentCount,g,this._startEvent)}_emitEnd(g){this._callbacks.condition?.(this._currentCount,g)&&this._callbacks.end(this._currentCount,
g,this._startEvent);this._startEvent=null}}a.DragEventSeparator=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n){function q(v){v=v.layer;return!(!v?.featureReduction||"selection"!==v.featureReduction.type)}function t(v){(v=v.graphics3DGraphics)&&v.forEach(r=>r.setVisibilityFlag(w.VisibilityGroup.GRAPHIC,w.VisibilityFlag.DECONFLICTION,!0))}a.GraphicsDeconflictor=class extends u.Deconflictor{constructor(){super(...arguments);this._contexts=new Map;this._viewState=new u.DeconflictorViewState;this.visibilityGroup=w.VisibilityGroup.GRAPHIC;this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([k.watch(()=>
this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),k.watch(()=>this.view?.map?.ground?.opacity,(v,r)=>{1!==v&&1!==r||this.setDirty()}),k.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},k.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(n.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new x.LabelDeconflictor({view:this.view,parent:this})}destroy(){this._labels=d.destroyMaybe(this._labels);this._frameTask=
d.removeMaybe(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(v){this._marginFactor=v;this.setDirty()}setDirty(){0<this._contexts.size&&(super.setDirty(),this._labels.setDirty())}runTask(v){super.runTask(v);this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(v,r){v=!(this._graphicSupportsDeconfliction(r)&&q(v));r.setVisibilityFlag(w.VisibilityGroup.GRAPHIC,w.VisibilityFlag.DECONFLICTION,v)}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),
this._updateSlicePlane())}_updateSlicePlane(){const v=this.view?this.view.slicePlane:null;null!=v&&h.transform(v,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=null!=v}_slicePlaneChanged(){g.someMap(this._contexts,(v,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(v){const r=this._getGraphicsContext(v);return{addGraphic:y=>this._addGraphic(v,r,y),removeGraphic:y=>this._removeGraphic(r,y),labelingInfoChange:()=>this._labels.enabledChanged(v,
r),featureReductionChange:()=>this.enabledChanged(v,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(v,r),clear:()=>r.forEach(y=>this._removeGraphic(r,y.graphics3DGraphic))}}removeGraphicsOwner(v){const r=this._contexts.get(v);r&&(r.forEach(y=>this._removeGraphic(r,y.graphics3DGraphic)),this._contexts.delete(v),this.setDirty())}_addGraphic(v,r,y){const z=y.graphic.uid;y=new u.DeconflictorGraphic(y,v.symbolCreationContext.slicePlaneEnabled);r.set(z,y);q(v)&&this.addToActiveGraphics(y);
v.labelsEnabled&&this._labels.addToActiveGraphics(y)}_removeGraphic(v,r){r=r.graphic.uid;const y=v.get(r);y&&(this.removeFromActiveGraphics(y),this._labels.removeFromActiveGraphics(y),v.delete(r),this.setDirty())}enabledChanged(v,r){const y=q(v);y||t(v);this.modifyGraphics(r,y)}_slicePlaneEnabledChanged(v,r){const y=v.symbolCreationContext.slicePlaneEnabled;r.forEach(z=>z.slicePlaneEnabled=y);this.setDirty()}getGraphicsLayers(v){return v.layers}_graphicSupportsDeconfliction(v){if(v.isDraped)return!1;
v=v.layers;if(!v?.length)return!1;for(const r of v)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(v){var r=this._contexts.get(v);if(r)return r;r=new Map;this._contexts.set(v,r);this.setDirty();return r}};a.GraphicsDeconflictor=b.__decorate([p.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/ScaleInfo".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I){function*H(ba){if(Map.prototype.entries){ba=ba.entries();for(let ia=ba.next();!ia.done;ia=ba.next())yield ia.value[1]}else yield*ba.values()}function*B(ba,ia,ka){ia.clear();ba.forEach((Y,ea)=>{const fa=ia.pushNew();fa.id=ea;fa.visible=Y.graphics3DGraphic.getVisibilityFlag(ka,C.VisibilityFlag.DECONFLICTION);ea=Y.info?.[ka];fa.prio=Y.graphics3DGraphic.deconflictionPriority;fa.distance=ea?ea.distance:Number.MAX_VALUE});yield;const na=
ia.iterableSort((Y,ea)=>Y.prio!==ea.prio?ea.prio-Y.prio:Y.distance!==ea.distance?Y.distance-ea.distance:Y.visible!==ea.visible?Y.visible?-1:1:Y.id-ea.id);for(let Y=na.next();!Y.done;Y=na.next())yield;ia.forAll(Y=>{const ea=ba.get(Y.id);ea&&(ba.delete(Y.id),ba.set(Y.id,ea))});ia.clear()}const K=x.create(),L=q.create(),J=q.create(),M=x.create(),T=h.create(),Q=z.create(),O=y.create(),U=x.create(),Z=v.create();class P{constructor(){this.aabr=v.create();this.distance=0;this.visible=this.culled=!1}}class R{constructor(ba,
ia){this.graphics3DGraphic=ba;this.slicePlaneEnabled=ia;this.info={}}}a.State=void 0;(function(ba){ba[ba.Idle=0]="Idle";ba[ba.Process=1]="Process";ba[ba.Sort=2]="Sort";ba[ba.Deconflict=3]="Deconflict";ba[ba.NumStates=4]="NumStates"})(a.State||(a.State={}));class W{constructor(){this.camera=new E.Camera;this.slicePlane=r.create();this.slicePlaneEnabled=!1}copyFrom(ba){this.camera.copyFrom(ba.camera);r.copy(ba.slicePlane,this.slicePlane);this.slicePlaneEnabled=ba.slicePlaneEnabled}}a.Deconflictor=class extends g{get dirty(){return this._dirty}get state(){return this._state}constructor(ba){super(ba);
this._dirty=!1;this._runningViewState=new W;this._state=a.State.Idle;this._active=new Map;this._visible=new Map;this._iterators=new V;this._accBinsNumX=15;this._accBinsNumY=20;this._accBinsSizeY=this._accBinsSizeX=0;this._accBins=null;this.accNumTests=0}destroy(){this._active.clear();this._visible.clear();this._iterators=null}setDirty(){!this._dirty&&0<this._active.size&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==a.State.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;
const ba=this._state/a.State.NumStates;return this._dirty?.5*ba:ba}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(ba){switch(this._state){case a.State.Idle:this._startUpdate(),ba.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(ba))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(ba))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ba))break;
default:D.drawAccelerationStruct(this,this._visible),this._state=a.State.Idle,this.notifyChange("updating")}}modifyGraphics(ba,ia){ia?ba.forEach(ka=>this.addToActiveGraphics(ka)):ba.forEach(ka=>this.removeFromActiveGraphics(ka));this.setDirty()}layerSupportsDeconfliction(ba){if(null==ba||"object3d"!==ba.type)return!1;ba=ba.stageObject;return 1===(ba?.geometries.length??0)&&ba?.geometries[0]?.material instanceof G.HUDMaterial?!0:!1}_startUpdate(){D.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);
const {fullWidth:ba,fullHeight:ia}=this._runningViewState.camera;this._initBins(ba,ia);this._resetIterators()}addToActiveGraphics(ba){ba.info[this.visibilityGroup]=new P;this._active.set(ba.graphics3DGraphic.graphic.uid,ba);this.setDirty()}removeFromActiveGraphics(ba){this._visible.delete(ba.graphics3DGraphic.graphic.uid);const ia=ba.graphics3DGraphic;ia.destroyed||ia.setVisibilityFlag(this.visibilityGroup,C.VisibilityFlag.DECONFLICTION,!0);delete ba.info[this.visibilityGroup];this._active.delete(ba.graphics3DGraphic.graphic.uid);
this.setDirty()}_processActiveGraphics(ba){const ia=this._ensureActiveGraphicsIterator(),ka=p.invertOrIdentity(T,this._runningViewState.camera.projectionMatrix),na="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?Q:null;let Y=0;null!=na&&(w.transformMat4(na,x.ZEROS,this._runningViewState.camera.viewMatrix),na[3]=t.getReferenceEllipsoid(this.view.spatialReference).radius,Y=z.distanceToSilhouette(na,x.ZEROS));for(;!ba.done;){ba.madeProgress();
var ea=ia.next();if(!0===ea.done)return this._resetActiveGraphicsIterator(),!0;ea=ea.value;const fa=ea?.info[this.visibilityGroup];fa&&(this._collectGraphics3DGraphics(ea,ka,na,Y),fa.culled?this._visible.delete(ea.graphics3DGraphic.graphic.uid):this._visible.set(ea.graphics3DGraphic.graphic.uid,ea))}return!1}_sortVisibleGraphics(ba){const ia=this._ensureSortGraphicsIterator();for(;!ba.done;){const ka=ia.next();ba.madeProgress();if(!0===ka.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(ba){const ia=
this._ensureVisibleGraphicsIterator(),ka=this.visibilityGroup===C.VisibilityGroup.LABEL;for(;!ba.done;){ba.madeProgress();var na=ia.next();if(!0===na.done)return this._resetVisibleGraphicsIterator(),!0;na=na.value;const ea=na.info[this.visibilityGroup];if(!ea||ea.culled)this._setGraphicVisibility(na,!1);else{var Y=na.graphics3DGraphic;Y=!ka||Y.isVisible();ea.visible=Y&&!this._isConflicted(na);ea.visible&&this._addToBins(na);this._setGraphicVisibility(na,ea.visible);D.drawPoly(ea,ea.visible)}}return!1}_resetIterators(){this._iterators.active=
null;this._iterators.visible=null;this._iterators.sort=null}_ensureActiveGraphicsIterator(){this._iterators.active||(this._iterators.active=H(this._active));return this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){this._iterators.visible||(this._iterators.visible=H(this._visible));return this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){this._iterators.sort||(this._iterators.sort=
B(this._visible,this._iterators.sortArray,this.visibilityGroup));return this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(ba,ia,ka,na){var Y=ba.graphics3DGraphic;if(!Y.destroyed){var ea=ba.info[this.visibilityGroup];if(Y.isVisible(C.VisibilityGroup.GRAPHIC,C.VisibilityFlag.DECONFLICTION)){var fa=this.getGraphicsLayers(Y);v.empty(ea.aabr);Y=null;for(const aa of fa)if(this.layerSupportsDeconfliction(aa)){fa=aa.stageObject.geometries[0].material;if(null==
Y&&(Y=ca,this._getProjectionInfo(aa,ia,Y),Y.isOutsideScreen||this._isCulledBySlice(ba,K)||null!=ka&&this._isCulledByHorizon(Y,ka,na))){ea.culled=!0;return}this._expandBoundingRect(ea,aa,fa,Y)}null==Y?ea.culled=!0:(ea.distance=Y.distance,ea.culled=!1)}else ea.culled=!0}}_getProjectionInfo(ba,ia,ka){const na=this._runningViewState.camera;ba=ba.stageObject;var Y=ba.geometries[0];const ea=Y.material;var fa=z.getCenter(ba.boundingVolumeWorldSpace.bounds);w.transformMat4(K,fa,na.viewMatrix);fa=Y.attributes;
Y=fa.get(F.VertexAttribute.NORMAL).data;fa=fa.get(F.VertexAttribute.AUXPOS1).data;ea.applyShaderOffsetsView(K,Y,ba.transformation,fa,na,ka.scaleInfo,K);n.set(L,K[0],K[1],K[2],1);n.transformMat4(J,L,na.projectionMatrix);w.scale(ka.positionNDC,J,1/J[3]);ea.applyShaderOffsetsNDC(ka.positionNDC,fa,na,ka.positionNDC,M);ka.distanceWithoutPolygonOffset=na.depthNDCToWorld(M[2]);ka.distance=M[2]===ka.positionNDC[2]?ka.distanceWithoutPolygonOffset:na.depthNDCToWorld(ka.positionNDC[2]);n.set(J,ka.positionNDC[0],
ka.positionNDC[1],ka.positionNDC[2],1);n.transformMat4(L,J,ia);n.scale(L,L,1/L[3]);w.set(ka.positionView,K[0],K[1],K[2])}_isCulledByHorizon(ba,ia,ka){w.copy(O.direction,ba.positionView);w.set(O.origin,0,0,0);return z.intersectRay(ia,O,U)?ba.distanceWithoutPolygonOffset>ka:!1}_isCulledBySlice(ba,ia){return ba.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&r.extrusionContainsPoint(this._runningViewState.slicePlane,ia)}_expandBoundingRect(ba,ia,ka,{positionNDC:na,scaleInfo:Y}){const ea=
this._runningViewState.camera;ia=ia.getScreenSize(S);A.applyPrecomputedScaleFactor(ia,Y.factor,ia);ia[0]*=ea.pixelRatio;ia[1]*=ea.pixelRatio;ka=v.offset(ka.calculateRelativeScreenBounds(ia,Y.factorAlignment.scale,Z),d.lerp(0,ea.fullWidth,.5+.5*na[0]),d.lerp(0,ea.fullHeight,.5+.5*na[1]));na=this.marginFactor;0!==na&&(na*=Math.min(v.width(ka),v.height(ka)),ka[0]-=na,ka[1]-=na,ka[2]+=na,ka[3]+=na);v.expand(ba.aabr,ka,ba.aabr)}_isConflicted(ba){const ia=ba.graphics3DGraphic.graphic.uid;ba=ba.info[this.visibilityGroup];
let ka=!0;for(let na=Math.floor(ba.aabr[0]/this._accBinsSizeX);na<=Math.floor(ba.aabr[2]/this._accBinsSizeX);na++)if(!(0>na||na>=this._accBinsNumX))for(let Y=Math.floor(ba.aabr[1]/this._accBinsSizeY);Y<=Math.floor(ba.aabr[3]/this._accBinsSizeY);Y++){if(0>Y||Y>=this._accBinsNumY)continue;ka=!1;const ea=this._accBins[na][Y];for(let fa=0;fa<ea.length;fa++){const aa=ea.data[fa],da=aa.info[this.visibilityGroup];if(da&&da.visible&&aa.graphics3DGraphic.graphic.uid!==ia&&(this.accNumTests++,v.intersects(da.aabr,
ba.aabr)))return!0}}return ka}_initBins(ba,ia){if(null==this._accBins){this._accBins=[];for(var ka=0;ka<this._accBinsNumX;ka++){this._accBins.push([]);var na=this._accBins[this._accBins.length-1];for(let Y=0;Y<this._accBinsNumY;Y++)na.push(new k)}}else for(ka=0;ka<this._accBinsNumX;ka++)for(na=0;na<this._accBinsNumY;na++)this._accBins[ka][na].clear();this._accBinsSizeX=ba/this._accBinsNumX;this._accBinsSizeY=ia/this._accBinsNumY;this.accNumTests=0}_addToBins(ba){var ia=ba.info[this.visibilityGroup],
ka=Math.floor(ia.aabr[0]/this._accBinsSizeX);const na=Math.floor(ia.aabr[2]/this._accBinsSizeX),Y=Math.floor(ia.aabr[1]/this._accBinsSizeY);for(ia=Math.floor(ia.aabr[3]/this._accBinsSizeY);ka<=na;ka++)if(!(0>ka||ka>=this._accBinsNumX))for(let ea=Y;ea<=ia;ea++)0>ea||ea>=this._accBinsNumY||this._accBins[ka][ea].push(ba)}_setGraphicVisibility(ba,ia){ba=ba.graphics3DGraphic;ba.destroyed||(ba.setVisibilityFlag(this.visibilityGroup,C.VisibilityFlag.DECONFLICTION,ia),this.visibilityGroup===C.VisibilityGroup.LABEL&&
this.view.labeler.setLabelGraphicVisibility(ba,ia))}};b.__decorate([m.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);b.__decorate([m.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);class N{constructor(){this.id=0;this.visible=!1;this.distance=this.prio=0}}class V{constructor(ba=null,ia=null,ka=null){this.active=ba;this.visible=ia;this.sort=ka;
this.sortArray=new k({allocator:na=>na||new N})}}const S=u.create();class X{constructor(){this.positionView=x.create();this.positionNDC=x.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo=new I.ScaleInfo}get isOutsideScreen(){const ba=this.positionNDC;return-1>ba[0]||-1>ba[1]||-1>ba[2]||1<=ba[0]||1<=ba[1]}}const ca=new X;a.DeconflictorGraphic=R;a.DeconflictorViewState=W;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports",
"../../support/debugFlags"],function(a,b){function g(p,h,u,w,x){c&&(c(),c=null);const n=l.height,q=e;q.beginPath();q.lineWidth=1;q.strokeStyle=x;q.moveTo(p,n-u);q.lineTo(h,n-u);q.stroke();q.lineTo(h,n-w);q.stroke();q.lineTo(h,n-u);q.stroke();q.lineTo(p,n-u);q.stroke();q.lineTo(p,n-u);q.stroke();q.closePath()}let d=!1,k=!1,m=!1,f=!1,c=null,l,e;a.drawAccelerationStruct=function(p,h){if(k&&e){c&&(c(),c=null);var u=e,w=0;for(let x=0;x<p.accBinsNumX;x++)for(let n=0;n<p.accBinsNumY;n++){const q=p.accBins[x][p.accBinsNumY-
1-n];w+=q.length;const t=x*p.accBinsSizeX,v=(x+1)*p.accBinsSizeX,r=n*p.accBinsSizeY,y=(n+1)*p.accBinsSizeY;u.fillText(q.length.toFixed(),t+5,r+15);g(t,v,r,y,"blue")}u.fillText("total totalShownLabels: "+w,70,40);u.fillText("total visible labels: "+h.size,70,50);u.fillText("total numTests: "+p.accNumTests,70,30)}};a.drawPoly=function(p,h){d&&(h&&m||!h&&f)&&g(p.aabr[0],p.aabr[2],p.aabr[1],p.aabr[3],h?"green":"red")};a.prepare=function(p){m=b.debugFlags.DECONFLICTOR_SHOW_VISIBLE;f=b.debugFlags.DECONFLICTOR_SHOW_INVISIBLE;
d=m||f;k=b.debugFlags.DECONFLICTOR_SHOW_GRID;c=null;d||k?c=()=>{null==l&&(l=document.createElement("canvas"),l.setAttribute("id","debugCanvas2d"),p.surface.parentElement.style.position="relative",p.surface.parentElement.appendChild(l));var {state:h}=p;const {camera:u,pixelRatio:w}=h,{width:x,height:n}=u;h=n*w;l.setAttribute("width",`${x*w}px`);l.setAttribute("height",`${h}px`);l.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${x}px;height:${n}px`);
e=l.getContext("2d");e.clearRect(0,0,x,n);e.font="12px Arial"}:l&&(l.parentElement.removeChild(l),l=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugFlags":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,g,d,k,m,f,
c){g=class extends g{constructor(){super(...arguments);this.LINE_WIREFRAMES=this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=this.I3S_SHOW_MODIFICATIONS=this.I3S_TREE_SHOW_TILES=this.TERRAIN_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_FETCH_SHOW_TILES=this.DRAW_MESH_GEOMETRY_NORMALS=this.TESTS_DISABLE_FAST_UPDATES=this.TESTS_DISABLE_OPTIMIZATIONS=this.SHOW_POI=this.OVERLAY_SHOW_CENTER=this.OVERLAY_DRAW_DEBUG_TEXTURE=
this.TEXT_SHOW_BORDER=this.TEXT_SHOW_BASELINE=this.LABELS_SHOW_BORDER=this.DECONFLICTOR_SHOW_GRID=this.DECONFLICTOR_SHOW_INVISIBLE=this.DECONFLICTOR_SHOW_VISIBLE=this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1}};b.__decorate([d.property()],g.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);b.__decorate([d.property()],g.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([d.property()],g.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);b.__decorate([d.property()],g.prototype,"DECONFLICTOR_SHOW_GRID",
void 0);b.__decorate([d.property()],g.prototype,"LABELS_SHOW_BORDER",void 0);b.__decorate([d.property()],g.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([d.property()],g.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([d.property()],g.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([d.property()],g.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([d.property()],g.prototype,"SHOW_POI",void 0);b.__decorate([d.property()],g.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);b.__decorate([d.property()],
g.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);b.__decorate([d.property()],g.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([d.property()],g.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([d.property()],g.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([d.property()],g.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([d.property()],g.prototype,"I3S_TREE_SHOW_TILES",void 0);b.__decorate([d.property()],g.prototype,"I3S_SHOW_MODIFICATIONS",void 0);
b.__decorate([d.property()],g.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([d.property()],g.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([d.property()],g.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([d.property()],g.prototype,"LINE_WIREFRAMES",void 0);g=b.__decorate([c.subclass("esri.views.3d.support.DebugFlags")],g);b=new g;a.debugFlags=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],
function(a){a.VisibilityFlag=void 0;(function(b){b[b.USER=1]="USER";b[b.SCALE_RANGE=2]="SCALE_RANGE";b[b.FILTER=4]="FILTER";b[b.DECONFLICTION=8]="DECONFLICTION";b[b.ALL_GRAPHIC=15]="ALL_GRAPHIC";b[b.ALL_LABEL=255]="ALL_LABEL"})(a.VisibilityFlag||(a.VisibilityFlag={}));a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=1]="GRAPHIC";b[b.LABEL=16]="LABEL"})(a.VisibilityGroup||(a.VisibilityGroup={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports",
"../../../../core/mathUtils","../../../ViewingMode"],function(a,b,g){function d(e,p,h){h=h.parameters;c.scale=Math.min(h.divisor/(p-h.offset),1);c.factor=Math.abs(e*e*e);return c}function k(e,p){return b.lerp(e*Math.max(p.scale,p.minScaleFactor),e,p.factor)}class m{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,p,h,u={camera:{distance:0,fovY:0},divisor:0,offset:0},w){this._viewingMode=e;this._description=p;this._ellipsoidRadius=
h;this.parameters=u;this._fontHeight=w;this._viewingMode===g.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){if(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===
e.distance)return!1;this._calculateParameters(e,this._ellipsoidRadius,this.parameters);return!0}overrideFontHeight(e){return e!==this._fontHeight?new m(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,p,h){const {scaleStart:u,scaleFallOffRange:w}=this._description,{fovY:x,distance:n}=e;var q=this._calculateCurvatureDependentParameters(e,p);p=this._coverageCompensation(e,p,q);const {tiltAngle:t,scaleFallOffFactor:v}=q,r=Math.sin(t)*n,y=.5*Math.PI-
t-x*(.5-u*p);q=r/Math.cos(y);p=(q-r/Math.cos(y+x*w*p)*v)/(1-v);h.camera.fovY=e.fovY;h.camera.distance=e.distance;h.offset=p;h.divisor=q-p;return h}_calculateCurvatureDependentParametersLocal(e,p,h=l){h.tiltAngle=this._description.curvatureDependent.min.tiltAngle;h.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;return h}_calculateCurvatureDependentParametersGlobal(e,p,h=l){const u=this._description.curvatureDependent;e=1+e.distance/p;e=Math.sqrt(e*e-1);const [w,x]=[u.min.curvature,
u.max.curvature];e=b.clamp((e-w)/(x-w),0,1);const [n,q]=[u.min,u.max];h.tiltAngle=b.lerp(n.tiltAngle,q.tiltAngle,e);h.scaleFallOffFactor=b.lerp(n.scaleFallOffFactor,q.scaleFallOffFactor,e);return h}_surfaceCoverageCompensationLocal(e,p,h){return(e.fovY-h.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,p,h){const u=p*p;h=h.tiltAngle+.5*Math.PI;const {fovY:w,distance:x}=e;e=x*x+u-2*Math.cos(h)*x*p;const n=Math.sqrt(e);return(Math.acos(Math.sqrt(e-u)/n)-Math.asin(p/(n/Math.sin(h)))+.5*w)/w}}const f=
{curvatureDependent:{min:{curvature:b.deg2rad(10),tiltAngle:b.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:b.deg2rad(70),tiltAngle:b.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},c={scale:0,factor:0,minScaleFactor:0},l={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(e,p,h=[0,0]){p=Math.min(Math.max(p.scale,p.minScaleFactor),1);h[0]=e[0]*p;h[1]=e[1]*p;return h};a.applyScaleFactor=k;a.getLabelSettings=function(e,p){const {curvatureDependent:h,
scaleStart:u,scaleFallOffRange:w}=f;return new m(e,{curvatureDependent:{min:{curvature:h.min.curvature,tiltAngle:h.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:h.max.curvature,tiltAngle:h.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:u,scaleFallOffRange:w,minPixelSize:14},p)};a.getSettings=function(e,p){return new m(e,f,p)};a.precomputeScaleFactor=function(e,p,h,u){e=d(e,p,h);e.minScaleFactor=0;e=k(1,e);u.scale=e;u.factor=0;u.minScaleFactor=h.minScaleFactor};a.scale=function(e,p,h,u){return k(e,
d(p,h,u))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../layers/support/FastSymbolUpdates ../../support/debugFlags ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./ScaleInfo ./internal/bufferWriterUtils ./internal/MaterialUtil ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K){function L(da,ma,ua,sa=O){c.copy(sa,da.anchorPosition);sa[0]*=-ma[0];sa[1]*=-ma[1];sa[0]+=da.screenOffset[0]*ua;sa[1]+=da.screenOffset[1]*ua;return sa}function J(da,ma,ua,sa,ra,Aa,qa,la){ma=ma-ra-(0<la[0]?sa[0]*la[0]:0);let ja=ma+sa[0]+2*ra;ua=ua-ra-(0<la[1]?sa[1]*la[1]:0);ra=ua+sa[1]+2*ra;la=qa.distanceFieldBoundingBox;qa.textureIsSignedDistanceField&&null!=la&&(ma+=sa[0]*la[0],ua+=sa[1]*la[1],ja-=sa[0]*(1-la[2]),ra-=sa[1]*
(1-la[3]),ma-=Aa,ja+=Aa,ua-=Aa,ra+=Aa);return da[0]>ma&&da[0]<ja&&da[1]>ua&&da[1]<ra}class M extends z.Material{constructor(da){super(da,new Y);this._configuration=new K.HUDMaterialTechniqueConfiguration}getConfiguration(da,ma){this._configuration.output=da;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled=
"screen"===this.parameters.centerOffsetUnits;this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.draped=this.parameters.isDraped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter;
this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.occlusionPass=ma.slot===D.RenderSlot.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(da===v.ShaderOutput.Color||da===v.ShaderOutput.Alpha);da===v.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=!!q.debugFlags.LABELS_SHOW_BORDER);this._configuration.depthEnabled=this.parameters.depthEnabled;this._configuration.transparencyPassType=ma.transparencyPassType;this._configuration.multipassEnabled=
ma.multipassEnabled;this._configuration.cullAboveGround=ma.multipassTerrain.cullAboveGround;return this._configuration}intersect(da,ma,ua,sa,ra,Aa){if(ua.options.selectionMode&&ua.options.hud&&da.visible&&ua.point){sa=this.parameters;ra=ua.point;var qa=ua.camera,{scaleX:la,scaleY:ja}=this._getScreenScale(da);la*=qa.pixelRatio;ja*=qa.pixelRatio;d.fromMat4(N,ma);if(da.attributes.has(A.VertexAttribute.FEATUREATTRIBUTE)){var oa=N,za=oa[0],ta=oa[1],Ca=oa[2],Ga=oa[3],La=oa[4],Ma=oa[5],Ra=oa[6],Ya=oa[7];
const ab=oa[8],Wa=1/Math.sqrt(za*za+ta*ta+Ca*Ca),cb=1/Math.sqrt(Ga*Ga+La*La+Ma*Ma),Na=1/Math.sqrt(Ra*Ra+Ya*Ya+ab*ab);oa[0]=za*Wa;oa[1]=ta*Wa;oa[2]=Ca*Wa;oa[3]=Ga*cb;oa[4]=La*cb;oa[5]=Ma*cb;oa[6]=Ra*Na;oa[7]=Ya*Na;oa[8]=ab*Na}oa=da.attributes.get(A.VertexAttribute.POSITION);za=da.attributes.get(A.VertexAttribute.SIZE);ta=da.attributes.get(A.VertexAttribute.NORMAL);da=da.attributes.get(A.VertexAttribute.AUXPOS1);E.assert(3<=oa.size);Ca=H.calculateAnchorPosForRendering(sa);Ga="screen"===this.parameters.centerOffsetUnits;
for(La=0;La<oa.data.length/oa.size;La++)Ma=La*oa.size,e.set(U,oa.data[Ma],oa.data[Ma+1],oa.data[Ma+2]),e.transformMat4(U,U,ma),Ma=La*za.size,ka[0]=za.data[Ma]*la,ka[1]=za.data[Ma+1]*ja,e.transformMat4(U,U,qa.viewMatrix),Ma=La*da.size,e.set(X,da.data[Ma],da.data[Ma+1],da.data[Ma+2]),Ga||(U[0]+=X[0],U[1]+=X[1],0!==X[2]&&(Ma=X[2],e.normalize(X,U),e.subtract(U,U,e.scale(X,X,Ma)))),Ma=La*ta.size,e.set(Z,ta.data[Ma],ta.data[Ma+1],ta.data[Ma+2]),this._normalAndViewAngle(Z,N,qa,ia),this._applyVerticalOffsetTransformationView(U,
ia,qa,Q),qa.applyProjection(U,P),-1<P[0]&&(Ga&&(X[0]||X[1])&&(P[0]+=X[0]*qa.pixelRatio,0!==X[1]&&(P[1]+=C.applyScaleFactor(X[1],Q.factorAlignment)*qa.pixelRatio),qa.unapplyProjection(P,U)),P[0]+=this.parameters.screenOffset[0]*qa.pixelRatio,P[1]+=this.parameters.screenOffset[1]*qa.pixelRatio,P[0]=Math.floor(P[0]),P[1]=Math.floor(P[1]),C.applyPrecomputedScaleFactor(ka,Q.factor,ka),Ma=1*qa.pixelRatio,Ra=0,sa.textureIsSignedDistanceField&&(Ra=sa.outlineSize*qa.pixelRatio/2),J(ra,P[0],P[1],ka,Ma,Ra,sa,
Ca)&&(Ra=ua.ray,e.transformMat4(W,U,m.invert(S,qa.viewMatrix)),P[0]=ra[0],P[1]=ra[1],qa.unprojectFromRenderScreen(P,U)&&(Ma=p.create(),e.copy(Ma,Ra.direction),Ya=1/e.length(Ma),e.scale(Ma,Ma,Ya),Ra=e.distance(Ra.origin,U)*Ya,Aa(Ra,Ma,-1,!0,1,W))))}}intersectDraped(da,ma,ua,sa,ra,Aa){ma=da.attributes.get(A.VertexAttribute.POSITION);ua=da.attributes.get(A.VertexAttribute.SIZE);const qa=this.parameters,la=H.calculateAnchorPosForRendering(qa);let {scaleX:ja,scaleY:oa}=this._getScreenScale(da);ja*=da.screenToWorldRatio;
oa*=da.screenToWorldRatio;const za=2*da.screenToWorldRatio;for(let Ga=0;Ga<ma.data.length/ma.size;Ga++){var ta=Ga*ma.size;const La=ma.data[ta];ta=ma.data[ta+1];var Ca=Ga*ua.size;ka[0]=ua.data[Ca]*ja;ka[1]=ua.data[Ca+1]*oa;Ca=0;qa.textureIsSignedDistanceField&&(Ca=qa.outlineSize*da.screenToWorldRatio/2);J(sa,La,ta,ka,za,Ca,qa,la)&&ra(Aa.dist,Aa.normal,-1,!1)}}createBufferWriter(){return new aa(this)}_normalAndViewAngle(da,ma,ua,sa){u.isMat4(ma)&&(ma=d.fromMat4(V,ma));e.transformMat3(sa.normal,da,ma);
e.transformMat4(sa.normal,sa.normal,ua.viewInverseTransposeMatrix);sa.cosAngle=e.dot(R,na);return sa}_updateScaleInfo(da,ma,ua){const sa=this.parameters;null!=sa.screenSizePerspective?C.precomputeScaleFactor(ua,ma,sa.screenSizePerspective,da.factor):(da.factor.scale=1,da.factor.factor=0,da.factor.minScaleFactor=0);null!=sa.screenSizePerspectiveAlignment?C.precomputeScaleFactor(ua,ma,sa.screenSizePerspectiveAlignment,da.factorAlignment):(da.factorAlignment.factor=da.factor.factor,da.factorAlignment.scale=
da.factor.scale,da.factorAlignment.minScaleFactor=da.factor.minScaleFactor)}applyShaderOffsetsView(da,ma,ua,sa,ra,Aa,qa){ma=this._normalAndViewAngle(ma,ua,ra,ia);this._applyVerticalGroundOffsetView(da,ma,ra,qa);this._applyVerticalOffsetTransformationView(qa,ma,ra,Aa);this._applyPolygonOffsetView(qa,ma,sa[3],ra,qa);this._applyCenterOffsetView(qa,sa,qa);return qa}applyShaderOffsetsNDC(da,ma,ua,sa,ra){this._applyCenterOffsetNDC(da,ma,ua,sa);null!=ra&&e.copy(ra,sa);this._applyPolygonOffsetNDC(sa,ma,ua,
sa);return sa}_applyPolygonOffsetView(da,ma,ua,sa,ra){var Aa=sa.aboveGround?1:-1;ua=Math.sign(ua);0===ua&&(ua=Aa);Aa*=ua;if(0>=this.parameters.shaderPolygonOffset)return e.copy(ra,da);ma=g.clamp(Math.abs(ma.cosAngle),.01,1);sa=1-Math.sqrt(1-ma*ma)/ma/sa.viewport[2];0<Aa?e.scale(ra,da,sa):e.scale(ra,da,1/sa);return ra}_applyVerticalGroundOffsetView(da,ma,ua,sa){const ra=e.length(da),Aa=ua.aboveGround?1:-1;ua=ua.computeRenderPixelSizeAtDist(ra)*r.HUDVerticalPixelOffset;ma=e.scale(U,ma.normal,Aa*ua);
e.add(sa,da,ma);return sa}_applyVerticalOffsetTransformationView(da,ma,ua,sa){const ra=this.parameters;if(!ra.verticalOffset?.screenLength){if(ra.screenSizePerspective||ra.screenSizePerspectiveAlignment){var Aa=e.length(da);this._updateScaleInfo(sa,Aa,ma.cosAngle)}else sa.factor.scale=1,sa.factorAlignment.scale=1;return da}Aa=e.length(da);ua=I.verticalOffsetAtDistance(ua,Aa,ra.verticalOffset,ma.cosAngle,ra.screenSizePerspectiveAlignment??ra.screenSizePerspective);this._updateScaleInfo(sa,Aa,ma.cosAngle);
e.scale(ma.normal,ma.normal,ua);return e.add(da,da,ma.normal)}_applyCenterOffsetView(da,ma,ua){const sa="screen"!==this.parameters.centerOffsetUnits;ua!==da&&e.copy(ua,da);sa&&(ua[0]+=ma[0],ua[1]+=ma[1],ma[2]&&(e.normalize(Z,ua),e.add(ua,ua,e.scale(Z,Z,ma[2]))));return ua}_applyCenterOffsetNDC(da,ma,ua,sa){const ra="screen"!==this.parameters.centerOffsetUnits;sa!==da&&e.copy(sa,da);ra||(sa[0]+=ma[0]/ua.fullWidth*2,sa[1]+=ma[1]/ua.fullHeight*2);return sa}_applyPolygonOffsetNDC(da,ma,ua,sa){const ra=
this.parameters.shaderPolygonOffset;da!==sa&&e.copy(sa,da);ra&&(da=ua.aboveGround?1:-1,sa[2]-=(da*Math.sign(ma[3])||da)*ra);return sa}produces(da,ma){if(ma===v.ShaderOutput.Color||ma===v.ShaderOutput.Alpha||ma===v.ShaderOutput.Highlight||ma===v.ShaderOutput.ObjectAndLayerIdColor){if(da===D.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:ua,occlusionTest:sa}=this.parameters;return da===(ua?D.RenderSlot.LABEL_MATERIAL:D.RenderSlot.HUD_MATERIAL)||sa&&da===D.RenderSlot.OCCLUSION_PIXELS}return!1}createGLMaterial(da){return new T(da)}calculateRelativeScreenBounds(da,
ma,ua=w.create()){L(this.parameters,da,ma,ua);ua[2]=ua[0]+da[0];ua[3]=ua[1]+da[1];return ua}_getScreenScale(da){da=da.attributes.get(A.VertexAttribute.FEATUREATTRIBUTE);if(null==da)return{scaleX:1,scaleY:1};da=h.fromArray(da.data,ba);const [ma,ua]=n.evaluateModelTransformScale(ca,this.parameters,da);return{scaleX:ma,scaleY:ua}}}class T extends y.GLTextureMaterial{constructor(da){super({...da,...da.material.parameters})}selectProgram(da){return this.ensureTechnique(B.HUDMaterialTechnique,da)}beginSlot(da){this.updateTexture(this._material.parameters.textureId);
this._material.setParameters(this.textureBindParameters);return this.selectProgram(da)}}const Q=new F.ScaleInfo,O=l.create(),U=p.create(),Z=p.create(),P=h.create(),R=p.create(),W=p.create(),N=k.create(),V=k.create(),S=f.create(),X=p.create(),ca=h.create(),ba=h.create(),ia={normal:R,cosAngle:0},ka=[0,0],na=p.fromValues(0,0,1);class Y extends y.GLTextureMaterialBindParameters{constructor(){super(...arguments);this.renderOccluded=z.RenderOccludedFlag.Occlude;this.isDecoration=!1;this.color=h.fromValues(1,
1,1,1);this.texCoordScale=[1,1];this.polygonOffset=!1;this.anchorPosition=l.fromValues(.5,.5);this.screenOffset=[0,0];this.shaderPolygonOffset=1E-5;this.sampleSignedDistanceFieldTexelCenter=this.textureIsSignedDistanceField=!1;this.outlineColor=h.fromValues(1,1,1,1);this.outlineSize=0;this.vvSizeEnabled=!1;this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.hasSlicePlane=!1;this.occlusionTest=this.pixelSnappingEnabled=!0;this.centerOffsetUnits="world";
this.drawInSecondSlot=!1;this.depthEnabled=!0;this.isDraped=!1}}const ea=t.newLayout().vec3f(A.VertexAttribute.POSITION).vec3f(A.VertexAttribute.NORMAL).vec2f(A.VertexAttribute.UV0).vec4u8(A.VertexAttribute.COLOR).vec2f(A.VertexAttribute.SIZE).vec4f(A.VertexAttribute.AUXPOS1).vec4f(A.VertexAttribute.FEATUREATTRIBUTE),fa=ea.clone().vec4u8(A.VertexAttribute.OBJECTANDLAYERIDCOLOR);class aa{constructor(da){this._material=da;this.vertexBufferLayout=b("enable-feature:objectAndLayerId-rendering")?fa:ea}elementCount(da){return 6*
da.attributes.get(A.VertexAttribute.POSITION).indices.length}write(da,ma,ua,sa,ra){G.writePosition(ua.attributes.get(A.VertexAttribute.POSITION),da,sa.position,ra,6);G.writeNormal(ua.attributes.get(A.VertexAttribute.NORMAL),ma,sa.normal,ra,6);da=ua.attributes.get(A.VertexAttribute.UV0).data;var Aa;if(null==da||4>da.length){da=this._material.parameters;var qa=Aa=0;var la=da.texCoordScale[0];var ja=da.texCoordScale[1]}else Aa=da[0],qa=da[1],la=da[2],ja=da[3];la=Math.min(1.99999,la+1);ja=Math.min(1.99999,
ja+1);da=ua.attributes.get(A.VertexAttribute.POSITION).indices.length;ma=ra;var oa=sa.uv0;for(let Ca=0;Ca<da;++Ca)oa.set(ma,0,Aa),oa.set(ma,1,qa),ma++,oa.set(ma,0,la),oa.set(ma,1,qa),ma++,oa.set(ma,0,la),oa.set(ma,1,ja),ma++,oa.set(ma,0,la),oa.set(ma,1,ja),ma++,oa.set(ma,0,Aa),oa.set(ma,1,ja),ma++,oa.set(ma,0,Aa),oa.set(ma,1,qa),ma++;G.writeColor(ua.attributes.get(A.VertexAttribute.COLOR),4,sa.color,ra,6);const {data:za,indices:ta}=ua.attributes.get(A.VertexAttribute.SIZE);da=ta.length;Aa=sa.size;
ma=ra;for(qa=0;qa<da;++qa)for(la=za[2*ta[qa]],ja=za[2*ta[qa]+1],oa=0;6>oa;++oa)Aa.set(ma,0,la),Aa.set(ma,1,ja),ma++;ua.attributes.get(A.VertexAttribute.AUXPOS1)?G.writeBufferVec4(ua.attributes.get(A.VertexAttribute.AUXPOS1),sa.auxpos1,ra,6):G.writeBufferVec4Zeros(sa.auxpos1,ra,6*da);ua.attributes.get(A.VertexAttribute.FEATUREATTRIBUTE)?G.writeBufferVec4(ua.attributes.get(A.VertexAttribute.FEATUREATTRIBUTE),sa.featureAttribute,ra,6):G.writeBufferVec4Zeros(sa.featureAttribute,ra,6*da);null!=ua.objectAndLayerIdColor&&
(da=ua.attributes.get(A.VertexAttribute.POSITION)?.indices)&&(da=da.length,sa=sa.getField(A.VertexAttribute.OBJECTANDLAYERIDCOLOR,x.BufferViewVec4u8),G.writeObjectAndLayerIdColor(ua.objectAndLayerIdColor,sa,da,ra,6))}}a.HUDMaterial=M;a.Parameters=Y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(d){return d instanceof Float32Array&&16<=d.length}function g(d){return Array.isArray(d)&&16<=d.length}
a.isMat4=function(d){return b(d)||g(d)};a.isMat4f32=b;a.isMat4f64=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){function u(R){return null!==R&&void 0!==R}function w(R){return"number"===typeof R}function x(R){return"string"===typeof R}function n(R,W){R&&R.push(W)}function q(R,W,N,V=f.create()){R=R||0;W=W||0;N=N||0;0!==R&&m.rotateZ(V,V,-R/180*Math.PI);0!==W&&m.rotateX(V,V,W/180*Math.PI);0!==N&&m.rotateY(V,V,N/180*Math.PI);return V}function t(R,W,N,V,S){const X=R.minSize,ca=R.maxSize;if(R.expression)return n(S,"Could not convert size info: expression not supported"),!1;if(R.useSymbolValue)return R=
V.symbolSize[N],W.minSize[N]=R,W.maxSize[N]=R,W.offset[N]=W.minSize[N],W.factor[N]=0,W.type[N]=a.FastSizeType.DefinedSize,!0;if(u(R.field)){if(u(R.stops)){if(2===R.stops.length&&w(R.stops[0].size)&&w(R.stops[1].size))return v(R.stops[0].size,R.stops[1].size,R.stops[0].value,R.stops[1].value,W,N),W.type[N]=a.FastSizeType.DefinedSize,!0;n(S,"Could not convert size info: stops only supported with 2 elements");return!1}if(w(X)&&w(ca)&&u(R.minDataValue)&&u(R.maxDataValue))return v(X,ca,R.minDataValue,
R.maxDataValue,W,N),W.type[N]=a.FastSizeType.DefinedSize,!0;if("unknown"===R.valueUnit)return n(S,"Could not convert size info: proportional size not supported"),!1;if(null!=e.meterIn[R.valueUnit])return W.minSize[N]=-Infinity,W.maxSize[N]=Infinity,W.offset[N]=0,W.factor[N]=1/e.meterIn[R.valueUnit],W.type[N]=a.FastSizeType.DefinedSize,!0;n(S,"Could not convert size info: scale-dependent size not supported");return!1}if(!u(R.field)){if(R.stops?.[0]&&w(R.stops[0].size))return W.minSize[N]=R.stops[0].size,
W.maxSize[N]=R.stops[0].size,W.offset[N]=W.minSize[N],W.factor[N]=0,W.type[N]=a.FastSizeType.DefinedSize,!0;if(w(X))return W.minSize[N]=X,W.maxSize[N]=X,W.offset[N]=X,W.factor[N]=0,W.type[N]=a.FastSizeType.DefinedSize,!0}n(S,"Could not convert size info: unsupported variant of sizeInfo");return!1}function v(R,W,N,V,S,X){V=0<Math.abs(V-N)?(W-R)/(V-N):0;S.minSize[X]=0<V?R:W;S.maxSize[X]=0<V?W:R;S.offset[X]=R-N*V;S.factor[X]=V}function r(R,W,N,V){if(R.normalizationField||R.valueRepresentation)return n(V,
"Could not convert size info: unsupported property"),null;var S=R.field;if(null!=S&&!x(S))return n(V,"Could not convert size info: field is not a string"),null;if(!W.size)W.size=new B(R.field);else if(R.field)if(!W.size.field)W.size.field=R.field;else if(R.field!==W.size.field)return n(V,"Could not convert size info: multiple fields in use"),null;switch(R.axis){case "width":return(S=t(R,W.size,0,N,V))?W:null;case "height":return(S=t(R,W.size,2,N,V))?W:null;case "depth":return(S=t(R,W.size,1,N,V))?
W:null;case "width-and-depth":return(S=t(R,W.size,0,N,V))&&t(R,W.size,1,N,V),S?W:null;case null:case void 0:case "all":return(S=(S=(S=t(R,W.size,0,N,V))&&t(R,W.size,1,N,V))&&t(R,W.size,2,N,V))?W:null;default:return n(V,`Could not convert size info: unknown axis "${R.axis}""`),null}}function y(R,W,N){for(let V=0;3>V;++V){let S=W.unitInMeters;R.type[V]===a.FastSizeType.DefinedSize&&(S*=W.modelSize[V],R.type[V]=a.FastSizeType.DefinedScale);R.minSize[V]/=S;R.maxSize[V]/=S;R.offset[V]/=S;R.factor[V]/=
S}if(R.type[0]!==a.FastSizeType.Undefined)W=0;else if(R.type[1]!==a.FastSizeType.Undefined)W=1;else if(R.type[2]!==a.FastSizeType.Undefined)W=2;else return n(N,"No size axis contains a valid size or scale"),!1;for(N=0;3>N;++N)R.type[N]===a.FastSizeType.Undefined&&(R.minSize[N]=R.minSize[W],R.maxSize[N]=R.maxSize[W],R.offset[N]=R.offset[W],R.factor[N]=R.factor[W],R.type[N]=R.type[W]);return!0}function z(R,W,N){R[4*W]=N.r/255;R[4*W+1]=N.g/255;R[4*W+2]=N.b/255;R[4*W+3]=N.a}function D(R,W,N){if(R.normalizationField)return n(N,
"Could not convert color info: unsupported property"),null;if(x(R.field))if(R.stops){if(8<R.stops.length)return n(N,"Could not convert color info: too many color stops"),null;W.color=new K(R.field);R=R.stops;for(N=0;8>N;++N){const V=R[Math.min(N,R.length-1)];W.color.values[N]=V.value;z(W.color.colors,N,V.color)}}else return n(N,"Could not convert color info: missing stops or colors"),null;else if(R.stops&&0<=R.stops.length)for(R=R.stops&&0<=R.stops.length&&R.stops[0].color,W.color={field:null,values:[0,
0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},N=0;8>N;N++)W.color.values[N]=Infinity,z(W.color.colors,N,R);else return n(N,"Could not convert color info: no field and no colors/stops"),null;return W}function C(R,W,N){if(R.normalizationField)return n(N,"Could not convert opacity info: unsupported property"),null;if(x(R.field))if(R.stops){if(8<R.stops.length)return n(N,"Could not convert opacity info: too many opacity stops"),null;W.opacity=new L(R.field);
R=R.stops;for(N=0;8>N;++N){const V=R[Math.min(N,R.length-1)];W.opacity.values[N]=V.value;W.opacity.opacityValues[N]=V.opacity}}else return n(N,"Could not convert opacity info: missing stops or opacities"),null;else if(R.stops&&0<=R.stops.length)for(R=R.stops&&0<=R.stops.length?R.stops[0].opacity:0,W.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},N=0;8>N;N++)W.opacity.values[N]=Infinity,W.opacity.opacityValues[N]=R;else return n(N,"Could not convert opacity info: no field and no opacities/stops"),
null;return W}function E(R,W,N){R=2===N&&"arithmetic"===R.rotationType;W.offset[N]=R?90:0;W.factor[N]=R?-1:1;W.type[N]=1}function A(R,W,N){if(!x(R.field))return n(N,"Could not convert rotation info: field is not a string"),null;if(!W.rotation)W.rotation={field:R.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(R.field)if(!W.rotation.field)W.rotation.field=R.field;else if(R.field!==W.rotation.field)return n(N,"Could not convert rotation info: multiple fields in use"),null;switch(R.axis){case "tilt":return E(R,
W.rotation,0),W;case "roll":return E(R,W.rotation,1),W;case null:case void 0:case "heading":return E(R,W.rotation,2),W;default:return n(N,`Could not convert rotation info: unknown axis "${R.axis}""`),null}}function F(R,W,N){if(!R)return null;const V=R.reduce((S,X)=>{if(!S)return S;if(X.valueExpression)return n(N,"Could not convert visual variables: arcade expressions not supported"),null;switch(X.type){case "size":return W.supports.size?r(X,S,W,N):S;case "color":return W.supports.color?D(X,S,N):S;
case "opacity":return W.supports.opacity?C(X,S,N):null;case "rotation":return W.supports.rotation?A(X,S,N):S;default:return null}},new M);return 0<R.length&&V&&!V.size&&!V.color&&!V.opacity&&!V.rotation||V?.size&&!y(V.size,W,N)?null:V}function G(R,W,N){if(!!R!==!!W||R&&R.field!==W?.field)return!1;if(R&&"rotation"===N)for(N=0;3>N;N++)if(R.type[N]!==W.type[N]||R.offset[N]!==W.offset[N]||R.factor[N]!==W.factor[N])return!1;return!0}function I(R,W){R=new O(R);R.vvSize&&(R.vvSymbolAnchor=W.anchor,m.identity(P),
q(W.rotation[2],W.rotation[0],W.rotation[1],P),R.vvSymbolRotationMatrix=R.vvSymbolRotationMatrix||k.create(),d.fromMat4(R.vvSymbolRotationMatrix,P));return R}a.FastSizeType=void 0;(function(R){R[R.Undefined=0]="Undefined";R[R.DefinedSize=1]="DefinedSize";R[R.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=void 0;(function(R){R[R.Undefined=0]="Undefined";R[R.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));class H{constructor(R){this.field=
R}}class B extends H{constructor(R){super(R);this.minSize=[0,0,0];this.maxSize=[0,0,0];this.offset=[0,0,0];this.factor=[0,0,0];this.type=[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]}}class K extends H{constructor(R){super(R);this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.values=[0,0,0,0,0,0,0,0]}}class L extends H{constructor(R){super(R);this.values=[0,0,0,0,0,0,0,0];this.opacityValues=[0,0,0,0,0,0,0,0]}}class J extends H{constructor(R){super(R);
this.offset=[0,0,0];this.factor=[1,1,1];this.type=[0,0,0]}}class M{}class T{constructor(R,W=[1,1,1],N=[1,1,1],V=1,S=[0,0,0],X=[1,1,1],ca=[0,0,0]){this.supports=R;this.modelSize=W;this.symbolSize=N;this.unitInMeters=V;this.anchor=S;this.scale=X;this.rotation=ca}}class Q{constructor(R,W,N){this.visualVariables=R;this.materialParameters=W;this.requiresShaderTransformation=N}}class O extends h.NoParameters{constructor(R){super();this.vvSize=R?.size??null;this.vvColor=R?.color??null;this.vvOpacity=R?.opacity??
null}}const U=f.create(),Z=l.create(),P=f.create();a.ConvertOptions=T;a.FastColorInfo=K;a.FastOpacityInfo=L;a.FastRotationInfo=J;a.FastSizeInfo=B;a.FastSymbolUpdatesState=Q;a.FastVisualVariables=M;a.VisualVariablesParameters=O;a.convertVisualVariables=F;a.evaluateModelTransform=function(R,W,N){if(!R.vvSize)return N;m.copy(U,N);N=R.vvSymbolRotationMatrix;m.set(P,N[0],N[1],N[2],0,N[3],N[4],N[5],0,N[6],N[7],N[8],0,0,0,0,1);m.multiply(U,U,P);for(N=0;3>N;++N)Z[N]=g.clamp(R.vvSize.offset[N]+W[0]*R.vvSize.factor[N],
R.vvSize.minSize[N],R.vvSize.maxSize[N]);m.scale(U,U,Z);m.translate(U,U,R.vvSymbolAnchor);return U};a.evaluateModelTransformScale=function(R,W,N){if(!W.vvSize)return c.set(R,1,1,1),R;for(let V=0;3>V;++V)R[V]=g.clamp(W.vvSize.offset[V]+N[0]*W.vvSize.factor[V],W.vvSize.minSize[V],W.vvSize.maxSize[V]);return R};a.getAttributeValue=function(R,W){R=null==R?0:W.attributes[R];return"number"===typeof R&&isFinite(R)?R:0};a.getMaterialParameters=I;a.initFastSymbolUpdatesState=function(R,W){return!R||p.debugFlags.TESTS_DISABLE_FAST_UPDATES?
null:(R=F(R.visualVariables,W))?new Q(R,I(R,W),!!R.size):null};a.updateFastSymbolUpdatesState=function(R,W,N){if(!W||!R)return!1;const V=R.visualVariables;W=F(W.visualVariables,N);if(!(W&&G(V.size,W.size,"size")&&G(V.color,W.color,"color")&&G(V.rotation,W.rotation,"rotation")&&G(V.opacity,W.opacity,"opacity")))return!1;R.visualVariables=W;R.materialParameters=I(W,N);R.requiresShaderTransformation=!!W.size;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c){a.HUD=function(l,e){l.include(g.ScreenSizePerspective);l.attributes.add(c.VertexAttribute.POSITION,"vec3");l.attributes.add(c.VertexAttribute.NORMAL,"vec3");l.attributes.add(c.VertexAttribute.AUXPOS1,"vec4");l=l.vertex;d.addProjViewLocalOrigin(l,e);d.addCameraPosition(l,e);l.uniforms.add(new k.Float4PassUniform("viewport",(p,h)=>h.camera.fullViewport),new m.FloatPassUniform("polygonOffset",p=>p.shaderPolygonOffset),new m.FloatPassUniform("cameraGroundRelative",(p,h)=>h.camera.aboveGround?
1:-1));e.hasVerticalOffset&&b.addVerticalOffset(l);l.constants.add("smallOffsetAngle","float",.984807753012208);l.code.add(f.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);l.code.add(f.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?f.glsl.float(0):f.glsl`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `);e.draped&&!e.hasVerticalOffset||d.addViewNormal(l);e.draped||(l.uniforms.add(new m.FloatPassUniform("perDistancePixelRatio",(p,h)=>Math.tan(h.camera.fovY/2)/(h.camera.fullViewport[2]/2))),l.code.add(f.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${f.glsl.float(.5)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `));e.screenCenterOffsetUnitsEnabled&&d.addPixelRatio(l);e.hasScreenSizePerspective&&g.addScreenSizePerspectiveAlignment(l);l.code.add(f.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offset of labels with respect to objects.
      // It also pulls the label towards the viewer so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective?e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled?"vec3 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${e.hasVerticalOffset?f.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":f.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)};a.HUDVerticalPixelOffset=.5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,g,d,k,m,f){function c(e){e.uniforms.add(new m.Float4PassUniform("verticalOffset",(p,h)=>
{const {minWorldLength:u,maxWorldLength:w,screenLength:x}=p.verticalOffset;return b.set(l,x*(h.camera.pixelRatio||1),Math.tan(.5*h.camera.fovY)/(.5*h.camera.fullViewport[3]),u,w)}))}const l=g.create();a.VerticalOffset=function(e,p){const h=e.vertex;p.hasVerticalOffset?(c(h),p.hasScreenSizePerspective&&(e.include(d.ScreenSizePerspective),d.addScreenSizePerspectiveAlignment(h),k.addCameraPosition(e.vertex,p)),h.code.add(f.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${p.spherical?f.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:f.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${p.hasScreenSizePerspective?f.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:f.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):h.code.add(f.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec3","../../../../../../chunks/vec3f64","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,g,d,k){function m(c){return b.set(f,c.parameters.divisor,
c.parameters.offset,c.minScaleFactor)}const f=g.create();a.ScreenSizePerspective=function(c){c.vertex.code.add(k.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);c.vertex.code.add(k.glsl`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`);c.vertex.code.add(k.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);c.vertex.code.add(k.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);c.vertex.code.add(k.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);c.vertex.code.add(k.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(c){c.uniforms.add(new d.Float3PassUniform("screenSizePerspective",l=>m(l.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(c){c.uniforms.add(new d.Float3PassUniform("screenSizePerspectiveAlignment",l=>m(l.screenSizePerspectiveAlignment||l.screenSizePerspective)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/vec3f64 ../core/shaderModules/interfaces ./AnimationTimer ./basicInterfaces ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),
function(a,b,g,d,k,m,f,c,l){class e extends m.ContentObject{constructor(u,w){super();this.type=f.ContentObjectType.Material;this.supportsEdges=!1;this._visible=!0;this._renderPriority=0;this._vertexAttributeLocations=c.Default3D;this._pp0=b.fromValues(0,0,1);this._pp1=b.fromValues(0,0,0);this._parameters=l.copyParameters(u,w);this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(u){return!1}setParameters(u,w=!0){l.updateParameters(this._parameters,u)&&(this.validateParameters(this._parameters),
w&&this.parametersChanged())}validateParameters(u){}get visible(){return this._visible}set visible(u){u!==this._visible&&(this._visible=u,this.parametersChanged())}shouldRender(u){return this.isVisible()&&this.isVisibleForOutput(u.output)&&(!this.parameters.isDecoration||u.bindParameters.decorations===k.Decorations.ON)&&0!==(this.parameters.renderOccluded&u.renderOccludedMask)}isVisibleForOutput(u){return!0}get renderPriority(){return this._renderPriority}set renderPriority(u){u!==this._renderPriority&&
(this._renderPriority=u,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}intersectDraped(u,w,x,n,q,t){this._pp0[0]=this._pp1[0]=n[0];this._pp0[1]=this._pp1[1]=n[1];return this.intersect(u,w,x,this._pp0,this._pp1,q)}}class p extends d.Parameters{constructor(u,w,x){super(w,x);this.camera=u}}a.RenderOccludedFlag=void 0;(function(u){u[u.None=0]="None";u[u.Occlude=1]=
"Occlude";u[u.Transparent=2]="Transparent";u[u.OccludeAndTransparent=4]="OccludeAndTransparent";u[u.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";u[u.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));class h extends g.NoParameters{constructor(){super(...arguments);this.renderOccluded=a.RenderOccludedFlag.Occlude;this.isDecoration=!1}}a.Material=e;a.MaterialParameters=h;a.UpdateParameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/ContentObjectType ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(C,E,A,F,G,I){if(null!=C){var H=w(E,A,r);m.setMin(v,C.bbMin);m.setMax(v,C.bbMax);null!=G&&G.applyToAabb(v);if(x(v,E,H,F)){const {primitiveIndices:B,position:K}=C;H=B?B.length:K.indices.length/3;if(1E3<H&&(C=C.getChildren(),void 0!==C)){for(const L of C)p(L,E,A,F,G,I);return}h(E,A,0,H,K.indices,K,B,G,I)}}}function h(C,E,A,F,G,I,H,B,K){if(H){const {data:ka,stride:na}=I;I=C[0];var L=C[1];C=C[2];var J=E[0]-I,M=E[1]-L;for(E=E[2]-C;A<F;++A){var T=H[A],Q=3*T,O=na*
G[Q++],U=ka[O++],Z=ka[O++],P=ka[O];O=na*G[Q++];var R=ka[O++],W=ka[O++],N=ka[O];O=na*G[Q];Q=ka[O++];var V=ka[O++];O=ka[O];null!=B&&([U,Z,P]=B.applyToVertex(U,Z,P,A),[R,W,N]=B.applyToVertex(R,W,N,A),[Q,V,O]=B.applyToVertex(Q,V,O,A));R-=U;W-=Z;N-=P;Q-=U;V-=Z;O-=P;var S=M*O-V*E,X=E*Q-O*J;const Y=J*V-Q*M;var ca=R*S+W*X+N*Y;if(!(Math.abs(ca)<=Number.EPSILON)){U=I-U;Z=L-Z;P=C-P;S=U*S+Z*X+P*Y;if(0<ca){if(0>S||S>ca)continue}else if(0<S||S<ca)continue;X=Z*N-W*P;P=P*R-N*U;Z=U*W-R*Z;U=J*X+M*P+E*Z;if(0<ca){if(0>
U||S+U>ca)continue}else if(0<U||S+U<ca)continue;P=(Q*X+V*P+O*Z)/ca;0<=P&&(R=u(R,W,N,Q,V,O,y),K(P,R,T,!1))}}}else{var {data:ba,stride:ia}=I;H=C[0];I=C[1];L=C[2];C=E[0]-H;J=E[1]-I;M=E[2]-L;for(let ka=A,na=3*A;ka<F;++ka)if(Q=ia*G[na++],Z=ba[Q++],P=ba[Q++],N=ba[Q],Q=ia*G[na++],E=ba[Q++],A=ba[Q++],T=ba[Q],Q=ia*G[na++],R=ba[Q++],W=ba[Q++],Q=ba[Q],null!=B&&([Z,P,N]=B.applyToVertex(Z,P,N,ka),[E,A,T]=B.applyToVertex(E,A,T,ka),[R,W,Q]=B.applyToVertex(R,W,Q,ka)),E-=Z,A-=P,T-=N,R-=Z,W-=P,Q-=N,O=J*Q-W*M,U=M*R-
Q*C,ca=C*W-R*J,V=E*O+A*U+T*ca,!(Math.abs(V)<=Number.EPSILON)){Z=H-Z;P=I-P;N=L-N;O=Z*O+P*U+N*ca;if(0<V){if(0>O||O>V)continue}else if(0<O||O<V)continue;U=P*T-A*N;N=N*E-T*Z;P=Z*A-E*P;Z=C*U+J*N+M*P;if(0<V){if(0>Z||O+Z>V)continue}else if(0<Z||O+Z<V)continue;N=(R*U+W*N+Q*P)/V;0<=N&&(E=u(E,A,T,R,W,Q,y),K(N,E,ka,!1))}}}function u(C,E,A,F,G,I,H){d.set(z,C,E,A);d.set(D,F,G,I);d.cross(H,z,D);d.normalize(H,H);return H}function w(C,E,A){return d.set(A,1/(E[0]-C[0]),1/(E[1]-C[1]),1/(E[2]-C[2]))}function x(C,E,
A,F){return n(C,E,A,F,Infinity)}function n(C,E,A,F,G){var I=(C[0]-F-E[0])*A[0],H=(C[3]+F-E[0])*A[0];let B=Math.min(I,H);I=Math.max(I,H);H=(C[1]-F-E[1])*A[1];const K=(C[4]+F-E[1])*A[1];I=Math.min(I,Math.max(H,K));if(0>I)return!1;B=Math.max(B,Math.min(H,K));if(B>I)return!1;H=(C[2]-F-E[2])*A[2];C=(C[5]+F-E[2])*A[2];I=Math.min(I,Math.max(H,C));if(0>I)return!1;B=Math.max(B,Math.min(H,C));return B>I?!1:B<G}function q(C,E){E=E?q(E):{};for(const A in C){let F=C[A];F?.forEach&&(F=t(F));null==F&&A in E||(E[A]=
F)}return E}function t(C){const E=[];C.forEach(A=>E.push(A));return E}const v=m.create(),r=k.create(),y=k.create(),z=k.create(),D=k.create();a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=w;a.computeNormal=u;a.copyParameters=q;a.intersectAabbInvDir=x;a.intersectAabbInvDirBefore=n;a.intersectTriangleGeometry=function(C,E,A,F,G,I){C.visible&&(C.boundingInfo?(l.assert(C.type===f.ContentObjectType.Mesh),p(C.boundingInfo,A,F,E.tolerance,G,I)):(C=C.attributes.get(e.VertexAttribute.POSITION),
E=C.indices,h(A,F,0,E.length/3,E,C,void 0,G,I)))};a.intersectTriangles=h;a.updateParameters=function(C,E){let A=!1;for(const F in E){const G=E[F];void 0!==G&&(Array.isArray(G)?null===C[F]?(C[F]=G.slice(),A=!0):b.update(C[F],G)&&(A=!0):C[F]!==G&&(A=!0,C[F]=G))}return A};a.verticalOffsetAtDistance=function(C,E,A,F,G){let I=(A.screenLength||0)*C.pixelRatio;null!=G&&(I=c.scale(I,F,E,G));return g.clamp(I*Math.tan(.5*C.fovY)/(.5*C.fullHeight)*E,A.minWorldLength||0,null!=A.maxWorldLength?A.maxWorldLength:
Infinity)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports"],function(a){class b{constructor(){this.factor=new g;this.factorAlignment=new g}}class g{constructor(){this.minScaleFactor=this.factor=this.scale=0}}a.ScaleFactor=g;a.ScaleInfo=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../chunks/mat4",
"../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(a,b,g,d,k){function m(n,q,t){const {data:v,indices:r}=n;n=q.typedBuffer;q=q.typedBufferStride;const y=r.length;t*=q;for(let z=0;z<y;++z){const D=2*r[z];n[t]=v[D];n[t+1]=v[D+1];t+=q}}function f(n,q,t,v){const {data:r,indices:y}=n;n=q.typedBuffer;q=q.typedBufferStride;const z=y.length;t*=q;if(null==v||1===v)for(v=0;v<z;++v){var D=3*y[v];n[t]=r[D];n[t+1]=r[D+1];n[t+2]=r[D+2];t+=q}else for(D=0;D<
z;++D){const C=3*y[D];for(let E=0;E<v;++E)n[t]=r[C],n[t+1]=r[C+1],n[t+2]=r[C+2],t+=q}}function c(n,q,t,v=1){const {data:r,indices:y}=n;n=q.typedBuffer;q=q.typedBufferStride;const z=y.length;t*=q;if(1===v)for(v=0;v<z;++v){var D=4*y[v];n[t]=r[D];n[t+1]=r[D+1];n[t+2]=r[D+2];n[t+3]=r[D+3];t+=q}else for(D=0;D<z;++D){const C=4*y[D];for(let E=0;E<v;++E)n[t]=r[C],n[t+1]=r[C+1],n[t+2]=r[C+2],n[t+3]=r[C+3],t+=q}}function l(n,q,t,v,r=1){if(q){var {data:y,indices:z}=n;n=t.typedBuffer;t=t.typedBufferStride;var D=
z.length,C=q[0],E=q[1],A=q[2],F=q[4],G=q[5],I=q[6],H=q[8],B=q[9],K=q[10],L=q[12],J=q[13],M=q[14];v*=t;var T=0,Q=0,O=0;q=b.hasIdentityRotation(q)?U=>{T=y[U]+L;Q=y[U+1]+J;O=y[U+2]+M}:U=>{const Z=y[U],P=y[U+1];U=y[U+2];T=C*Z+F*P+H*U+L;Q=E*Z+G*P+B*U+J;O=A*Z+I*P+K*U+M};if(1===r)for(r=0;r<D;++r)q(3*z[r]),n[v]=T,n[v+1]=Q,n[v+2]=O,v+=t;else for(let U=0;U<D;++U){q(3*z[U]);for(let Z=0;Z<r;++Z)n[v]=T,n[v+1]=Q,n[v+2]=O,v+=t}}else f(n,t,v,r)}function e(n,q,t,v,r=1){if(q){var {data:y,indices:z}=n;n=t.typedBuffer;
t=t.typedBufferStride;var D=z.length,C=q[0],E=q[1],A=q[2],F=q[4],G=q[5],I=q[6],H=q[8],B=q[9],K=q[10],L=!b.isOrthoNormal(q);v*=t;var J=0,M=0,T=0;q=b.hasIdentityRotation(q)?O=>{J=y[O];M=y[O+1];T=y[O+2]}:O=>{const U=y[O],Z=y[O+1];O=y[O+2];J=C*U+F*Z+H*O;M=E*U+G*Z+B*O;T=A*U+I*Z+K*O};if(1===r)if(L)for(r=0;r<D;++r)q(3*z[r]),L=J*J+M*M+T*T,.999999>L&&1E-6<L?(L=1/Math.sqrt(L),n[v]=J*L,n[v+1]=M*L,n[v+2]=T*L):(n[v]=J,n[v+1]=M,n[v+2]=T),v+=t;else for(r=0;r<D;++r)q(3*z[r]),n[v]=J,n[v+1]=M,n[v+2]=T,v+=t;else for(let O=
0;O<D;++O){q(3*z[O]);if(L){var Q=J*J+M*M+T*T;.999999>Q&&1E-6<Q&&(Q=1/Math.sqrt(Q),J*=Q,M*=Q,T*=Q)}for(Q=0;Q<r;++Q)n[v]=J,n[v+1]=M,n[v+2]=T,v+=t}}else f(n,t,v,r)}function p(n,q,t,v,r=1){if(q){var {data:y,indices:z}=n;n=t.typedBuffer;t=t.typedBufferStride;var D=z.length,C=q[0],E=q[1],A=q[2],F=q[4],G=q[5],I=q[6],H=q[8],B=q[9],K=q[10];q=!b.isOrthoNormal(q);v*=t;if(1===r)for(r=0;r<D;++r){var L=4*z[r],J=y[L],M=y[L+1],T=y[L+2];L=y[L+3];var Q=C*J+F*M+H*T,O=E*J+G*M+B*T;J=A*J+I*M+K*T;q&&(M=Q*Q+O*O+J*J,.999999>
M&&1E-6<M&&(M=1/Math.sqrt(M),Q*=M,O*=M,J*=M));n[v]=Q;n[v+1]=O;n[v+2]=J;n[v+3]=L;v+=t}else for(L=0;L<D;++L){Q=4*z[L];M=y[Q];T=y[Q+1];const U=y[Q+2];Q=y[Q+3];O=C*M+F*T+H*U;J=E*M+G*T+B*U;M=A*M+I*T+K*U;q&&(T=O*O+J*J+M*M,.999999>T&&1E-6<T&&(T=1/Math.sqrt(T),O*=T,J*=T,M*=T));for(T=0;T<r;++T)n[v]=O,n[v+1]=J,n[v+2]=M,n[v+3]=Q,v+=t}}else c(n,t,v,r)}function h(n,q,t,v,r=1){const {data:y,indices:z}=n;var D=t.typedBuffer,C=t.typedBufferStride;n=z.length;v*=C;if(q===y.length&&4===q)for(D[v]=y[0],D[v+1]=y[1],D[v+
2]=y[2],D[v+3]=y[3],D=new Uint32Array(t.typedBuffer.buffer,t.start),C/=4,v/=4,q=D[v],v+=C,n*=r,r=1;r<n;++r)D[v]=q,v+=C;else if(1===r)if(4===q)for(r=0;r<n;++r)q=4*z[r],D[v]=y[q],D[v+1]=y[q+1],D[v+2]=y[q+2],D[v+3]=y[q+3],v+=C;else for(r=0;r<n;++r)q=3*z[r],D[v]=y[q],D[v+1]=y[q+1],D[v+2]=y[q+2],D[v+3]=255,v+=C;else if(4===q)for(q=0;q<n;++q){t=4*z[q];for(var E=0;E<r;++E)D[v]=y[t],D[v+1]=y[t+1],D[v+2]=y[t+2],D[v+3]=y[t+3],v+=C}else for(q=0;q<n;++q)for(t=3*z[q],E=0;E<r;++E)D[v]=y[t],D[v+1]=y[t+1],D[v+2]=
y[t+2],D[v+3]=255,v+=C}function u(n,q,t){const {data:v,indices:r}=n;n=q.typedBuffer;q=q.typedBufferStride;const y=r.length,z=v[0];t*=q;for(let D=0;D<y;++D)n[t]=z,t+=q}function w(n,q,t,v,r=1){const y=q.typedBuffer;q=q.typedBufferStride;v*=q;if(1===r)for(r=0;r<t;++r)y[v]=n[0],y[v+1]=n[1],y[v+2]=n[2],y[v+3]=n[3],v+=q;else for(let z=0;z<t;++z)for(let D=0;D<r;++D)y[v]=n[0],y[v+1]=n[1],y[v+2]=n[2],y[v+3]=n[3],v+=q}function x(n,q,t,v,r,y){switch(n){case k.VertexAttribute.POSITION:d.assert(3===q.size);v=
r.getField(n,g.BufferViewVec3f);d.assert(!!v,`No buffer view for ${n}`);v&&l(q,t,v,y);break;case k.VertexAttribute.NORMAL:d.assert(3===q.size);t=r.getField(n,g.BufferViewVec3f);d.assert(!!t,`No buffer view for ${n}`);t&&e(q,v,t,y);break;case k.VertexAttribute.NORMALCOMPRESSED:d.assert(2===q.size);v=r.getField(n,g.BufferViewVec2i16);d.assert(!!v,`No buffer view for ${n}`);v&&m(q,v,y);break;case k.VertexAttribute.UV0:d.assert(2===q.size);v=r.getField(n,g.BufferViewVec2f);d.assert(!!v,`No buffer view for ${n}`);
v&&m(q,v,y);break;case k.VertexAttribute.COLOR:case k.VertexAttribute.SYMBOLCOLOR:v=r.getField(n,g.BufferViewVec4u8);d.assert(!!v,`No buffer view for ${n}`);d.assert(3===q.size||4===q.size);!v||3!==q.size&&4!==q.size||h(q,q.size,v,y);break;case k.VertexAttribute.COLORFEATUREATTRIBUTE:v=r.getField(n,g.BufferViewFloat);d.assert(!!v,`No buffer view for ${n}`);d.assert(1===q.size);v&&1===q.size&&u(q,v,y);break;case k.VertexAttribute.TANGENT:d.assert(4===q.size);t=r.getField(n,g.BufferViewVec4f);d.assert(!!t,
`No buffer view for ${n}`);t&&p(q,v,t,y);break;case k.VertexAttribute.PROFILERIGHT:case k.VertexAttribute.PROFILEUP:case k.VertexAttribute.PROFILEVERTEXANDNORMAL:case k.VertexAttribute.FEATUREVALUE:d.assert(4===q.size),v=r.getField(n,g.BufferViewVec4f),d.assert(!!v,`No buffer view for ${n}`),v&&c(q,v,y)}}a.writeBufferFloat=function(n,q,t,v=1){const {data:r,indices:y}=n;n=q.typedBuffer;q=q.typedBufferStride;const z=y.length;t*=q;if(1===v)for(v=0;v<z;++v)n[t]=r[y[v]],t+=q;else for(let D=0;D<z;++D){const C=
r[y[D]];for(let E=0;E<v;E++)n[t]=C,t+=q}};a.writeBufferMat3f=function(n,q,t){const {data:v,indices:r}=n;n=q.typedBuffer;q=q.typedBufferStride;const y=r.length;t*=q;for(let z=0;z<y;++z){const D=9*r[z];for(let C=0;9>C;++C)n[t+C]=v[D+C];t+=q}};a.writeBufferMat4f=function(n,q,t){const {data:v,indices:r}=n;n=q.typedBuffer;q=q.typedBufferStride;const y=r.length;t*=q;for(let z=0;z<y;++z){const D=16*r[z];for(let C=0;16>C;++C)n[t+C]=v[D+C];t+=q}};a.writeBufferVec2=m;a.writeBufferVec3=f;a.writeBufferVec4=c;
a.writeBufferVec4Zeros=function(n,q,t){const v=n.typedBuffer;n=n.typedBufferStride;q*=n;for(let r=0;r<t;++r)v[q]=0,v[q+1]=0,v[q+2]=0,v[q+3]=0,q+=n};a.writeColor=h;a.writeColorFeatureAttribute=u;a.writeDefaultAttribute=x;a.writeDefaultAttributes=function(n,q,t,v,r,y){for(const D of q.fields.keys()){q=n.attributes.get(D);var z=q?.indices;q&&z?x(D,q,t,v,r,y):D===k.VertexAttribute.OBJECTANDLAYERIDCOLOR&&null!=n.objectAndLayerIdColor&&(q=n.attributes.get(k.VertexAttribute.POSITION)?.indices)&&(q=q.length,
z=r.getField(D,g.BufferViewVec4u8),w(n.objectAndLayerIdColor,z,q,y))}};a.writeNormal=e;a.writeObjectAndLayerIdColor=w;a.writePosition=l;a.writeTangent=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A){function F(H){const B=new D.ShaderBuilder;var K=H.signedDistanceFieldEnabled;B.include(l.HUD,H);B.include(m.SliceDraw,H);if(H.occlusionPass)return B.include(e.HUDOcclusionPass,H),B;const {vertex:L,fragment:J}=B;B.include(q.ScreenSizePerspective);J.include(n.RgbaFloatEncoding);J.include(x.ColorConversion);B.include(u.VisualVariables,H);B.include(f.ObjectAndLayerIdColor,H);B.include(p.HUDVisibility);B.varyings.add("vcolor","vec4");B.varyings.add("vtc",
"vec2");B.varyings.add("vsize","vec2");B.varyings.add("voccluded","float");L.uniforms.add(new r.Float4PassUniform("viewport",(Q,O)=>O.camera.fullViewport),new v.Float2PassUniform("screenOffset",(Q,O)=>b.set(I,2*Q.screenOffset[0]*O.camera.pixelRatio,2*Q.screenOffset[1]*O.camera.pixelRatio)),new v.Float2PassUniform("anchorPosition",Q=>G(Q)),new r.Float4PassUniform("materialColor",Q=>Q.color));t.addPixelRatio(L);K&&(L.uniforms.add(new r.Float4PassUniform("outlineColor",Q=>Q.outlineColor)),J.uniforms.add(new r.Float4PassUniform("outlineColor",
Q=>0<Q.outlineColor[3]&&0<Q.outlineSize?Q.outlineColor:d.ZEROS),new y.FloatPassUniform("outlineSize",Q=>0<Q.outlineColor[3]&&0<Q.outlineSize?Q.outlineSize:0)));H.pixelSnappingEnabled&&L.include(c.AlignPixel);H.hasScreenSizePerspective&&(q.addScreenSizePerspective(L),q.addScreenSizePerspectiveAlignment(L));H.debugDrawLabelBorder&&B.varyings.add("debugBorderCoords","vec4");B.attributes.add(A.VertexAttribute.UV0,"vec2");B.attributes.add(A.VertexAttribute.COLOR,"vec4");B.attributes.add(A.VertexAttribute.SIZE,
"vec2");B.attributes.add(A.VertexAttribute.FEATUREATTRIBUTE,"vec4");L.code.add(z.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${H.hasScreenSizePerspective?z.glsl`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:z.glsl`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${H.vvSize?"inputSize *\x3d vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);var M=z.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const T=H.pixelSnappingEnabled?K?z.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:z.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:z.glsl`posProj += quadOffset;`;L.code.add(z.glsl`
    ${H.occlusionTestEnabled?"if (visible) {":""}
    ${M}
    ${H.vvColor?"vcolor \x3d interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    ${H.output===k.ShaderOutput.ObjectAndLayerIdColor?z.glsl`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${z.glsl.float(w.symbolAlphaCutoff)};
    ${K?`alphaDiscard = alphaDiscard && outlineColor.a < ${z.glsl.float(w.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${T}
      gl_Position = posProj;
    }

    vtc = uv;

    ${H.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${H.occlusionTestEnabled?z.glsl`} else { vtc = vec2(0.0);
      ${H.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);J.uniforms.add(new C.Texture2DPassUniform("tex",Q=>Q.texture));M=H.debugDrawLabelBorder?z.glsl`(isBorder > 0.0 ? 0.0 : ${z.glsl.float(w.defaultMaskAlphaCutoff)})`:z.glsl.float(w.defaultMaskAlphaCutoff);K=z.glsl`
    ${H.debugDrawLabelBorder?z.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${H.sampleSignedDistanceFieldTexelCenter?z.glsl`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:z.glsl`
      vec2 samplePos = vtc;
      `}

    ${K?z.glsl`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${M} ||
          fillPixelColor.a + outlinePixelColor.a < ${z.glsl.float(w.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${M}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:z.glsl`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${M}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${H.debugDrawLabelBorder?z.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(H.output){case k.ShaderOutput.Color:J.code.add(z.glsl`
        void main() {
          ${K}
          ${H.transparencyPassType===E.TransparencyPassType.FrontFace?"fragColor.rgb /\x3d fragColor.a;":""}
        }`);break;case k.ShaderOutput.Alpha:J.code.add(z.glsl`
        void main() {
          ${K}
          fragColor = vec4(fragColor.a);
        }`);break;case k.ShaderOutput.ObjectAndLayerIdColor:J.code.add(z.glsl`
        void main() {
          ${K}
          outputObjectAndLayerIdColor();
        }`);break;case k.ShaderOutput.Highlight:J.constants.add("occludedHighlightFlag","vec4",h.occludedHighlightFlag).add("unoccludedHighlightFlag","vec4",h.unoccludedHighlightFlag),J.code.add(z.glsl`
        void main() {
          ${K}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return B}function G(H,B=I){if(H.textureIsSignedDistanceField){var K=H.anchorPosition;H=H.distanceFieldBoundingBox;null!=H?b.set(B,K[0]*(H[2]-H[0])+H[0],K[1]*(H[3]-H[1])+H[1]):b.set(B,0,0)}else b.copy(B,H.anchorPosition);return B}const I=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,build:F,calculateAnchorPosForRendering:G},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=g;a.build=F;a.calculateAnchorPosForRendering=G})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,b,g,d,k,m,f,c){function l(r,y,...z){if(y.hasSlicePlane){y.hasSliceInVertexProgram&&r.vertex.uniforms.add(...z);r.fragment.uniforms.add(...z);z=c.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var D=c.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;D=y.hasSliceHighlight?c.glsl`
        ${D}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:c.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;y.hasSliceInVertexProgram&&r.vertex.code.add(z);r.fragment.code.add(z);r.fragment.code.add(D)}else z=c.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,y.hasSliceInVertexProgram&&r.vertex.code.add(z),r.fragment.code.add(z)}function e(r,y,z){return r.instancedDoublePrecision?d.set(n,z.camera.viewInverseTransposeMatrix[3],z.camera.viewInverseTransposeMatrix[7],z.camera.viewInverseTransposeMatrix[11]):y.slicePlaneLocalOrigin}function p(r,y){return null!=r?d.subtract(q,y.origin,r):y.origin}function h(r,y,z){return r.hasSliceTranslatedView?null!=y?b.translate(v,z.camera.viewMatrix,y):z.camera.viewMatrix:
null}function u(r,y,z){if(null==z.slicePlane)return k.ZEROS;const D=e(r,y,z);y=p(D,z.slicePlane);r=h(r,D,z);return null!=r?d.transformMat4(q,y,r):y}function w(r,y,z,D){if(null==D||null==z.slicePlane)return k.ZEROS;const C=e(r,y,z);y=p(C,z.slicePlane);r=h(r,C,z);return null!=r?(d.add(t,D,y),d.transformMat4(q,y,r),d.transformMat4(t,t,r),d.subtract(t,t,q)):D}class x extends c.NoParameters{constructor(r){super();this.slicePlaneLocalOrigin=r}}const n=k.create(),q=k.create(),t=k.create(),v=g.create();a.SliceDraw=
function(r,y){l(r,y,new m.Float3DrawUniform("slicePlaneOrigin",(z,D)=>u(y,z,D)),new m.Float3DrawUniform("slicePlaneBasis1",(z,D)=>w(y,z,D,D.slicePlane?.basis1)),new m.Float3DrawUniform("slicePlaneBasis2",(z,D)=>w(y,z,D,D.slicePlane?.basis2)))};a.SlicePass=function(r,y){l(r,y,new f.Float3PassUniform("slicePlaneOrigin",(z,D)=>u(y,z,D)),new f.Float3PassUniform("slicePlaneBasis1",(z,D)=>w(y,z,D,D.slicePlane?.basis1)),new f.Float3PassUniform("slicePlaneBasis2",(z,D)=>w(y,z,D,D.slicePlane?.basis2)))};a.SlicePlaneParameters=
x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,g,d){a.ObjectAndLayerIdColor=function(k,m){const f=m.output===b.ShaderOutput.ObjectAndLayerIdColor;m=m.objectAndLayerIdColorInstanced;f&&(k.varyings.add("objectAndLayerIdColorVarying","vec4"),m?k.attributes.add(d.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,
"vec4"):k.attributes.add(d.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"));k.vertex.code.add(g.glsl`
     void forwardObjectAndLayerIdColor() {
      ${f?m?g.glsl`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:g.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:g.glsl``} }`);k.fragment.code.add(g.glsl`
      void outputObjectAndLayerIdColor() {
        ${f?g.glsl`fragColor = objectAndLayerIdColorVarying;`:g.glsl``} }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/BooleanPassUniform","../../shaderModules/interfaces"],function(a,b,g){a.AlignPixel=function(d){d.uniforms.add(new b.BooleanPassUniform("alignPixelEnabled",(k,m)=>m.alignPixelEnabled));d.code.add(g.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`);d.code.add(g.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","./AlignPixel.glsl","../shading/MultipassGeometryTest.glsl","../shading/MultipassTerrainTest.glsl","../../shaderModules/interfaces"],function(a,b,g,d,k){a.HUDOcclusionPass=function(m,f){const {vertex:c,fragment:l}=m;c.include(b.AlignPixel);f.multipassEnabled&&(c.include(g.multipassGeometryTest),m.varyings.add("depth","float"));
c.code.add(k.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${f.multipassEnabled?k.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${f.multipassEnabled?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);m.include(d.multipassTerrainTest,f);l.code.add(k.glsl`
  void main() {
    fragColor = vec4(1);
    ${f.multipassEnabled?k.glsl`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl":function(){define("exports ./AlignPixel.glsl ./HUDRenderStyle ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,g,d,k,m,f){a.HUDVisibility=function(c){c.vertex.uniforms.add(new k.FloatPassUniform("renderTransparentlyOccludedHUD",(l,e)=>e.hudRenderStyle===
g.HUDRenderStyle.Occluded?1:e.hudRenderStyle===g.HUDRenderStyle.NotOccluded?0:.75),new d.Float4PassUniform("viewport",(l,e)=>e.camera.fullViewport),new f.Texture2DPassUniform("hudVisibilityTexture",(l,e)=>e.hudVisibility?.colorTexture));c.vertex.include(b.AlignPixel);c.vertex.code.add(m.glsl`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,g,d){const k=b.fromValues(1,1,0,1),m=b.fromValues(1,0,1,1);a.OutputHighlight=function(f){f.fragment.uniforms.add(new d.Texture2DPassUniform("depthTexture",(c,l)=>l.mainDepth));f.fragment.constants.add("occludedHighlightFlag",
"vec4",k).add("unoccludedHighlightFlag","vec4",m);f.fragment.code.add(g.glsl`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)};a.occludedHighlightFlag=k;a.unoccludedHighlightFlag=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,g,d,k,m,f,c){a.VisualVariables=function(l,e){const {vertex:p,attributes:h}=l;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&h.add(f.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");e.vvSize?(p.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",u=>u.vvSize.minSize)),p.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",u=>u.vvSize.maxSize)),p.uniforms.add(new b.Float3PassUniform("vvSizeOffset",u=>u.vvSize.offset)),p.uniforms.add(new b.Float3PassUniform("vvSizeFactor",u=>u.vvSize.factor)),
p.uniforms.add(new m.Matrix3PassUniform("vvSymbolRotationMatrix",u=>u.vvSymbolRotationMatrix)),p.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",u=>u.vvSymbolAnchor)),p.code.add(k.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),p.code.add(k.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?k.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):p.code.add(k.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);e.vvColor?(p.constants.add("vvColorNumber","int",c.vvColorNumber),p.uniforms.add(new d.FloatsPassUniform("vvColorValues",u=>u.vvColor.values,c.vvColorNumber),new g.Float4sPassUniform("vvColorColors",u=>u.vvColor.colors,c.vvColorNumber)),p.code.add(k.glsl`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?k.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):p.code.add(k.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m,f){super(k,"vec4",g.BindType.Pass,(c,l,e)=>c.setUniform4fv(k,m(l,e)),f)}}a.Float4sPassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m,f){super(k,"float",g.BindType.Pass,(c,l,e)=>c.setUniform1fv(k,m(l,e)),f)}}a.FloatsPassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../layers/support/FastSymbolUpdates","../lib/Material"],function(a,b,g){class d extends b.VisualVariablesParameters{constructor(){super(...arguments);
this.renderOccluded=g.RenderOccludedFlag.Occlude;this.isDecoration=!1}}a.VisualVariablePassParameters=d;a.vvColorNumber=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){class w extends m.ShaderTechnique{initializeConfiguration(q,t){t.spherical=q.viewingMode===g.ViewingMode.Global}initializeProgram(q){return new l.Program(q.rctx,w.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){const q=this.configuration.transparencyPassType,t=this.configuration,v=q===e.TransparencyPassType.NONE;var r=q===e.TransparencyPassType.FrontFace;const y=this.configuration.hasPolygonOffset?x:null;r=(v||r)&&t.output!==d.ShaderOutput.Highlight?
t.depthEnabled||t.occlusionPass?u.defaultDepthWriteParams:null:null;return u.makePipelineState({blending:t.output===d.ShaderOutput.Color||t.output===d.ShaderOutput.Alpha||t.output===d.ShaderOutput.Highlight?v?n:c.oitBlending(q):null,depthTest:{func:h.CompareFunction.LEQUAL},depthWrite:r,colorWrite:u.defaultColorWriteParams,polygonOffset:y})}get primitiveType(){return this.configuration.occlusionPass?h.PrimitiveType.POINTS:h.PrimitiveType.TRIANGLES}}w.shader=new k.ReloadableShaderModule(p.HUDMaterial,
()=>new Promise((q,t)=>a(["./HUDMaterial.glsl"],q,t)));const x={factor:0,units:-4},n=u.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);b.HUDMaterialTechnique=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(a,b,g,d){const k=d.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,
g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),m=d.simpleBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE),f=d.simpleBlendingParams(g.BlendFactor.ZERO,g.BlendFactor.ONE_MINUS_SRC_ALPHA),c={factor:-1,units:-2};a.OITPolygonOffset=c;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=f;a.blendingColor=m;a.blendingDefault=k;a.getOITPolygonOffset=function(l){return l?c:null};a.oitBlending=function(l){return l===b.TransparencyPassType.FrontFace?null:l===b.TransparencyPassType.Alpha?f:m};
a.oitDepthTest=function(l,e=g.CompareFunction.LESS){return l===b.TransparencyPassType.NONE||l===b.TransparencyPassType.FrontFace?e:g.CompareFunction.LEQUAL};a.oitDepthWrite=function(l){return l===b.TransparencyPassType.FrontFace?d.defaultDepthWriteParams:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m){class f extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=g.ShaderOutput.Color;this.transparencyPassType=k.TransparencyPassType.NONE;this.spherical=this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.hasPolygonOffset=this.hasSlicePlane=this.debugDrawLabelBorder=this.hasScreenSizePerspective=this.hasVerticalOffset=this.vvColor=this.vvSize=this.sampleSignedDistanceFieldTexelCenter=this.signedDistanceFieldEnabled=!1;this.pixelSnappingEnabled=
this.depthEnabled=!0;this.objectAndLayerIdColorInstanced=this.occlusionPass=this.cullAboveGround=this.multipassEnabled=this.draped=!1}}b.__decorate([d.parameter({count:g.ShaderOutput.COUNT})],f.prototype,"output",void 0);b.__decorate([d.parameter({count:k.TransparencyPassType.COUNT})],f.prototype,"transparencyPassType",void 0);b.__decorate([d.parameter()],f.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"spherical",void 0);b.__decorate([d.parameter()],
f.prototype,"occlusionTestEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"signedDistanceFieldEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"sampleSignedDistanceFieldTexelCenter",void 0);b.__decorate([d.parameter()],f.prototype,"vvSize",void 0);b.__decorate([d.parameter()],f.prototype,"vvColor",void 0);b.__decorate([d.parameter()],f.prototype,"hasVerticalOffset",void 0);b.__decorate([d.parameter()],f.prototype,"hasScreenSizePerspective",void 0);b.__decorate([d.parameter()],f.prototype,
"debugDrawLabelBorder",void 0);b.__decorate([d.parameter()],f.prototype,"hasSlicePlane",void 0);b.__decorate([d.parameter()],f.prototype,"hasPolygonOffset",void 0);b.__decorate([d.parameter()],f.prototype,"depthEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"pixelSnappingEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"draped",void 0);b.__decorate([d.parameter()],f.prototype,"multipassEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"cullAboveGround",void 0);b.__decorate([d.parameter()],
f.prototype,"occlusionPass",void 0);b.__decorate([d.parameter()],f.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([d.parameter({constValue:!0})],f.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([d.parameter({constValue:!1})],f.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){a.LabelDeconflictor=class extends c.Deconflictor{constructor(h){super(h);this.visibilityGroup=l.VisibilityGroup.LABEL;this.marginFactor=.05;this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(h){if(this.parent.running)return p.Task.YIELD;const u=performance.now();if(h.state!==e.RenderState.IDLE&&2E3>u-this._lastDeconfliction)return p.Task.YIELD;super.runTask(h);this.state===c.State.Idle&&(this._lastDeconfliction=u)}enabledChanged(h,u){this.modifyGraphics(u,
h.labelsEnabled)}getGraphicsLayers(h){return h.labelLayers}};b.__decorate([g.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=b.__decorate([f.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2f64 ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./graphicSymbolUtils ./LabelParameters ./labelPlacement ./placementUtils ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B){function K(O){return!O||0===O.length}function L(O){return!0===O.labelsVisible&&!!O.labelingInfo?.some(U=>!!U.symbol)}class J{constructor(O,U){this.labelingContext=O;this.graphics3DGraphic=U;this.textInitialized=this.addedToTextureAtlas=this.visible=this.hasGraphics3DResources=!1;this.textRenderers=[];this.textLabelPlacements=[]}}class M{constructor(O,U,Z,P,R){this.labelClass=O;this.graphics3DSymbol=U;this.graphics3DCalloutSymbolLayer=
Z;this.textRenderParameters=P;this.labelFunction=R;this.calloutSymbolLayerIndex=0}}class T{constructor(O,U,Z,P,R,W,N,V){this.layer=U;this.graphics3DCore=Z;this.scaleVisibility=P;this.emptySymbolLabelSupported=R;this.elevationInfoOverride=W;this.disablePlacement=N;this.active=V;this.labelClassAbortController=new AbortController;this.labelClassContexts=[];this.graphics=new Map;this.labelsToInitialize=new Map;this.stageLayer=new H.WebGLLayer(O,{pickable:!0,disableOctree:!0},U.uid)}destroy(){this.stageLayer.destroy()}}
a.Labeler=class extends g{constructor(O){super(O);this._dirty=!1;this._labels=new Map;this._labelingContexts=[]}setup(){this.dispose();this.addHandles([l.watch(()=>this.view.state?.camera,()=>this.setDirty()),l.watch(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(B.TaskPriority.LABELER,this)]);this._textTextureAtlas=new I.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new A.MaterialCollection(this.view._stage);
this._calloutMaterialCollection=new A.MaterialCollection(this.view._stage)}dispose(){this.removeAllHandles();this._textTextureAtlas=f.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=f.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=f.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear()}destroy(){this.dispose();Q.graphic=null;Q.renderingInfo=null;Q.layer=null}_activateLabelingContext(O){O.graphics.forEach((U,Z)=>
{const P=new J(O,U);this._labels.set(Z,P);O.labelsToInitialize.set(Z,P);U.setVisibilityFlag(v.VisibilityGroup.LABEL,v.VisibilityFlag.USER,!0)});O.active=!0}_deactivateLabelingContext(O){O.graphics.forEach((U,Z)=>{U.setVisibilityFlag(v.VisibilityGroup.LABEL,v.VisibilityFlag.USER,!1);this.setLabelGraphicVisibility(U,!1);this._labels.delete(Z)});O.active=!1}_addLabelTextureToAtlas(O){for(const U of O.graphics3DGraphic.labelLayers){if(!U._labelClass)continue;const Z=O.textRenderers[U._labelIndex];Z&&
(this._textTextureAtlas.addTextTexture(Z,U.stageObject),O.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(O){for(const U of O.graphics3DGraphic.labelLayers){if(!U._labelClass)continue;const Z=O.textRenderers[U._labelIndex];null!=Z&&(this._textTextureAtlas.removeTextTexture(Z,U.stageObject),O.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(O){this._updateLabels(O);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(O);
return B.Task.YIELD}_updateLabels(O){if(this._dirty){this._dirty=!1;for(const U of this._labelingContexts)U.active&&(U.labelClassPromise&&U.labelClassAbortController?this._dirty=!0:K(U.labelClassContexts)?null===U.labelClassContexts?this._deactivateLabelingContext(U):(this._createLabelClassContext(U),this._dirty=!0):m.someMap(U.labelsToInitialize,(Z,P)=>{this._ensureGraphics3DResources(Z)&&(this._labels.set(P,Z),this.deconflictor.setDirty(),O.madeProgress());if(Z.visible&&Z.textInitialized||!Z.visible&&
Z.hasGraphics3DResources)U.labelsToInitialize.delete(P),O.madeProgress();return O.done})&&(this._dirty=!0));this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(O){const U=O.labelClassAbortController?.signal;O.layer.when&&await O.layer.when();c.throwIfAborted(U);O.scaleVisibility&&O.scaleVisibility.updateScaleRangeActive();const Z=O.graphics3DCore,P=Z.layer.labelingInfo?.filter(R=>!!R.symbol);P&&0!==P.length&&(await d.forEach(P,async(R,W)=>{var N=R.symbol;const V=z.getGraphics3DSymbol(Z.getOrCreateGraphics3DSymbol(N));
if(null==V)k.getLogger(this).error("Failed to create Graphics3DSymbol for label");else{await V.load();c.throwIfAborted(U);var S=null;t.hasCalloutSupport(N)&&N.hasVisibleCallout()&&(S=r.make(N,Z.symbolCreationContext),await S.load(),c.throwIfAborted(U));N=await d.result(q.createLabelFunction(R,O.layer.fieldsIndex,this.view.spatialReference));c.throwIfAborted(U);if(!0===N.ok){const X=await this._createTextRenderParameters(V.symbol);c.throwIfAborted(U);O.labelClassContexts[W]=new M(R,V,S,X,N.value)}else k.getLogger(this).error(`Label expression failed to evaluate: ${N.error}`)}}),
c.throwIfAborted(U))}async _createLabelClassContext(O){null==O.labelClassPromise&&(O.labelClassPromise=this._createLabelClassContextAsync(O).catch(U=>{if(c.isAbortError(U))throw U;O.labelClassContexts.length=0}).then(()=>{O.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return O.labelClassPromise}async _createTextRenderParameters(O){O=O.symbolLayers.at(0);return"text"!==O?.type?null:G.TextRenderParameters.fromSymbol(O,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(O){for(var U of O.labelClassContexts)--U.graphics3DSymbol.referenced;
U=O.labelClassAbortController;O.labelClassAbortController=new AbortController;f.abortMaybe(U);O.labelClassContexts.length=0;O.labelClassPromise=null;this.notifyChange("updating")}_createTextSymbolGraphic(O,U,Z,P,R,W){O=new D.LabelParameters(Z,E.horizontalPlacementFromAnchor(Z.anchor),E.verticalPlacementFromAnchor(Z.anchor),O.text,x.fromValues(O.displayWidth,O.displayHeight));Q.graphic=U;Q.renderingInfo=null;Q.layer=P;return R.createLabel(Q,O,this._hudMaterialCollection,this._textTextureAtlas,()=>
{const N=C.getLabelPlacement(W);return N?N.elevationOffset:null})}_createLineCalloutGraphic(O,U,Z,P,R){Q.graphic=O;Q.layer=R;Q.renderingInfo=new y.LineCalloutSymbolLayerRenderingInfo(null,U,P.translation,P.centerOffset,P.screenOffset[0],P.centerOffsetUnits,P.elevationOffset,this._calloutMaterialCollection);return Z.createGraphics3DGraphic(Q)}_ensureGraphics3DResources(O){if(O.hasGraphics3DResources)return!1;const U=O.graphics3DGraphic;if(U.destroyed)return!1;this._ensureTextTextureResources(O);const Z=
O.labelingContext,P=Z.labelClassContexts;if(K(P)||!Z.emptySymbolLabelSupported&&0===U.layers.length)return!1;var R=!1,W=U.graphic;const N=Z.layer;var V=L(Z.layer);for(let X=0;X<P.length;X++){const ca=O.textRenderers[X],ba=O.textLabelPlacements[X];if(null==ca||null==ba)continue;const ia=P[X];var S=ia.graphics3DSymbol;const ka=S.symbol&&"label-3d"===S.symbol.type?S.symbol:null;if(S=S.symbolLayers[0]){S.setElevationInfoOverride(Z.elevationInfoOverride);R=new C.LabelInfo(U,ka,ia.labelClass);R=this._createTextSymbolGraphic(ca,
W,ba,N,S,R);if(null==R)return!1;R._labelClass=ia.labelClass;R._labelIndex=X;U.addLabelGraphic(R,Z.stageLayer);U.deconflictionPriority=ia.textRenderParameters?.definition.size??0;U.setVisibilityFlag(v.VisibilityGroup.LABEL,v.VisibilityFlag.USER,V);U.setVisibilityFlag(v.VisibilityGroup.LABEL,v.VisibilityFlag.SCALE_RANGE,!0);U.setVisibilityFlag(v.VisibilityGroup.LABEL,v.VisibilityFlag.DECONFLICTION,!1);R=!0;(V=ia.graphics3DCalloutSymbolLayer)&&ba.hasLabelVerticalOffset&&(V.setElevationInfoOverride(Z.elevationInfoOverride),
W=this._createLineCalloutGraphic(W,ka,V,ba,N),null!=W&&(ia.calloutSymbolLayerIndex=U.labelLayers.length,U.addLabelGraphic(W,Z.stageLayer)));break}}Z.scaleVisibility&&R&&Z.scaleVisibility.updateGraphicLabelScaleVisibility(U);return O.hasGraphics3DResources=!0}_destroyGraphics3DResources(O){const U=O.labelingContext.labelClassContexts;for(const Z of O.graphics3DGraphic.labelLayers)if(null!=Z._labelClass)U[Z._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(Z);O.graphics3DGraphic.deconflictionPriority=
0;O.graphics3DGraphic.clearLabelGraphics();O.hasGraphics3DResources=!1}_ensureTextTextureResources(O){if(!O.textInitialized){var U=O.labelingContext,Z=U.labelClassContexts;if(!K(Z)){var P=O.graphics3DGraphic.graphic;for(let N=0;N<Z.length;N++){const V=Z[N];O.textRenderers[N]=null;O.textLabelPlacements[N]=null;if(null==V?.textRenderParameters)continue;var R=V.labelFunction;let S;if("arcade"===R.type)try{const X=R.needsHydrationToEvaluate()?n.hydrateGraphic(P,U.layer):P;S=R.evaluate(X)}catch(X){S=null}else S=
R.evaluate(P);if(null!=S&&""!==S&&!/^\s+$/.test(S)&&(R=V.graphics3DSymbol,R.symbolLayers[0]&&(R=C.getLabelPlacement({graphics3DGraphic:O.graphics3DGraphic,labelSymbol:"label-3d"===R.symbol?.type?R.symbol:null,labelClass:V.labelClass,disablePlacement:U.disablePlacement}),null!=R))){var W=E.horizontalPlacementFromAnchor(R.anchor);W=E.textRenderAlignmentFromHorizontalPlacement(W);O.textRenderers[N]=new F.TextRenderer(S,W,V.textRenderParameters,I.TextTextureAtlas.maxSize);O.textLabelPlacements[N]=R}}O.textInitialized=
!0}}}_destroyTextTextureResources(O){O.textInitialized=!1;O.textRenderers.length=0;O.textLabelPlacements.length=0}_addGraphic(O,U){const Z=U.graphic.uid;O.graphics.set(Z,U);O.active&&(U=new J(O,U),this._labels.set(Z,U),O.labelsToInitialize.set(Z,U));this.setDirty();this.deconflictor.setDirty()}_removeGraphic(O,U){U=U.graphic.uid;const Z=this._labels.get(U);O.graphics.delete(U);Z&&(this._destroyGraphic(Z,U),O.labelsToInitialize.delete(U),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(O,
U){this._labels.delete(U);O.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(O);this._destroyTextTextureResources(O);O.hasGraphics3DResources&&this._destroyGraphics3DResources(O)}async _labelingInfoChange(O,U){if(U)for(const Z of U){if(U=O.graphics.get(Z))this._removeGraphic(O,U),this._addGraphic(O,U)}else return this._visibilityInfoChange(O),this._resetLabels(O),this._createLabelClassContext(O)}_globalPropertyChanged(O,U){for(const Z of U.labelClassContexts){const P=new Map;U.graphics.forEach(R=>
P.set(R.graphic.uid,R));Z.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(O,P,R=>R.labelLayers[0]);Z.graphics3DCalloutSymbolLayer&&Z.graphics3DCalloutSymbolLayer.globalPropertyChanged(O,P,R=>R.labelLayers[Z.calloutSymbolLayerIndex])}}_visibilityInfoChange(O){const U=L(O.layer);U&&!O.active&&this._activateLabelingContext(O);!U&&O.active&&this._deactivateLabelingContext(O);this.setDirty()}_resetAllLabels(){for(const O of this._labelingContexts)this._resetLabels(O)}_resetLabels(O){O.graphics.forEach((U,
Z)=>{if(U=this._labels.get(Z))this._destroyGraphic(U,Z),U.visible=!1,O.labelsToInitialize.set(Z,U)});this._destroyLabelClassContext(O);this.setDirty();this.deconflictor.setDirty()}_findLabelingContext(O){for(const U of this._labelingContexts)if(U.graphics3DCore===O)return U;return null}addGraphicsOwner(O,U,Z){const P=Z&&Z.emptySymbolLabelSupported||!1,R=Z?.elevationInfoOverride||null;Z=Z?.disablePlacement||null;if(!this._findLabelingContext(O)){var W=O.layer,N=new T(this.view._stage,W,O,U,P,R,Z,L(W));
this._labelingContexts.push(N);this.setDirty();return{addGraphic:V=>this._addGraphic(N,V),removeGraphic:V=>this._removeGraphic(N,V),featureReductionChange:()=>{},layerLabelsEnabled:()=>L(N.layer),labelingInfoChange:V=>this._labelingInfoChange(N,V),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",N),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",N),visibilityInfoChange:()=>this._visibilityInfoChange(N),reset:()=>this._resetLabels(N),clear:()=>{}}}}removeGraphicsOwner(O){const U=
this._findLabelingContext(O);U&&(O=this._labelingContexts.indexOf(U),this._labelingContexts.splice(O,1),U.graphics.forEach(Z=>this._removeGraphic(U,Z)),U.destroy(),this.setDirty())}setLabelGraphicVisibility(O,U){O=O.graphic.uid;const Z=this._labels.get(O);Z&&Z.visible!==U&&(U&&!Z.addedToTextureAtlas?(this._addLabelTextureToAtlas(Z),Z.textInitialized||Z.labelingContext.labelsToInitialize.set(O,Z)):!U&&Z.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(Z),Z.visible=U,this.setDirty())}setDirty(){!this._dirty&&
0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(O=>!!O.labelClassPromise&&!!O.labelClassAbortController)}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const O=0<this._labelingContexts.length?this._labelingContexts.reduce((U,Z)=>U+(Z.labelClassPromise&&Z.labelClassAbortController?0:1),0)/this._labelingContexts.length:
1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*O+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};b.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);b.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);b.__decorate([e.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);b.__decorate([e.property({type:Boolean,readOnly:!0})],
a.Labeler.prototype,"updating",null);a.Labeler=b.__decorate([w.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const Q=new y.LineCalloutCreationContext(null,null,null);a.areLabelsVisible=L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedPoint ../../geometry/SpatialReference".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(v){return"declaredClass"in v}function p(v){return"declaredClass"in v}function h(v){return"declaredClass"in v}function u(v){return null==v?null:e(v)?v:f.fromJSON(w(v))}function w(v){const {wkid:r,wkt:y,wkt2:z,latestWkid:D}=v.spatialReference,C={wkid:r,wkt:y,wkt2:z,latestWkid:D};switch(v.type){case "point":const {x:E,y:A,z:F,m:G}=v;return{x:E,y:A,z:F,m:G,spatialReference:C};case "polygon":const {rings:I,hasZ:H,hasM:B}=v;return{rings:x(I),hasZ:H,hasM:B,spatialReference:C};
case "polyline":const {paths:K,hasZ:L,hasM:J}=v;return{paths:x(K),hasZ:L,hasM:J,spatialReference:C};case "extent":const {xmin:M,xmax:T,ymin:Q,ymax:O,zmin:U,zmax:Z,mmin:P,mmax:R,hasZ:W,hasM:N}=v;return{xmin:M,xmax:T,ymin:Q,ymax:O,zmin:U,zmax:Z,mmin:P,mmax:R,hasZ:W,hasM:N,spatialReference:C};case "multipoint":const {points:V,hasZ:S,hasM:X}=v;return{points:t(V)?n(V):V,hasZ:S,hasM:X,spatialReference:C}}}function x(v){return q(v)?v.map(r=>n(r)):v}function n(v){return v.map(r=>Array.from(r))}function q(v){for(const r of v)if(0!==
r.length)return t(r);return!1}function t(v){return 0<v.length&&(m.isFloat32Array(v[0])||m.isFloat64Array(v[0]))}a.clonePoint=function(v,r){if(!v)return null;if(p(v)){if(null==r)return v.clone();if(p(r))return r.copy(v)}null!=r?(r.x=v.x,r.y=v.y,r.spatialReference=v.spatialReference,v.hasZ?(r.z=v.z,r.hasZ=v.hasZ):(r.z=void 0,r.hasZ=!1),v.hasM?(r.m=v.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=c.makeDehydratedPoint(v.x,v.y,v.z,v.spatialReference),v.hasM&&(r.m=v.m,r.hasM=!0));return r};a.hydrateGeometry=
u;a.hydrateGraphic=function(v,r){return v?h(v)?v:new g({layer:r,sourceLayer:r,visible:v.visible,symbol:k.clone(v.symbol),attributes:k.clone(v.attributes),geometry:u(v.geometry)}):null};a.hydratedSpatialReference=function(v){const {wkid:r,wkt:y,wkt2:z,latestWkid:D}=v;return l.fromJSON({wkid:r,wkt:y,wkt2:z,latestWkid:D})};a.isHydratedGeometry=e;a.isHydratedGraphic=h;a.isHydratedPoint=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(x,n){if(null==x)return"";const q=n.domain;if(q)if("codedValue"===q.type||"coded-value"===q.type)for(var t of q.codedValues){if(t.code===x)return t.name}else if("range"===q.type){const {max:v,min:r}=f.getDomainRange(n);t=+x;if(null!=r&&null!=v&&r<=t&&t<=v)return q.name}c.isDateField(n)?x=k.formatDate(x,k.convertDateFormatToIntlOptions("short-date")):c.isNumericField(n)&&(x=m.formatNumber(+x));return x||""}const h=g.getLogger("esri.layers.support.labelFormatUtils"),
u={type:"simple",evaluate(){return null}},w={getAttribute(x,n){return x.field(n)}};a.createLabelFunction=async function(x,n,q){if(!x||!x.symbol||!n)return u;const t=x.where,v=l.getLabelExpression(x);if("arcade"===v.type){const r=await e.createLabelExpression(v.expression,q,n);if(null==r)return u;x={type:"arcade",evaluate(y,z){try{const D="attributes"in y?r.repurposeFeature(y):y;D.contextTimeZone=z??null;const C=r.evaluate({$view:{timeZone:z},$feature:D},r.services);if(null!=C)return C.toString()}catch(D){h.error(new b("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{error:D,feature:y,expression:v}))}return null},needsHydrationToEvaluate(){return null==l.getSingleFieldArcadeExpression(v.expression)}}}else x={type:"simple",evaluate(r){return v.expression.replaceAll(/{[^}]*}/g,y=>{var z=y.slice(1,-1);z=n.get(z);if(!z)return y;y=null;"attributes"in r?r&&r.attributes&&(y=r.attributes[z.name]):y=r.field(z.name);return null==y?"":p(y,z)})}};if(t){let r;try{r=await d.parseWhereClause(t,n)}catch(z){return h.error(new b("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:t,error:z})),u}const y=x.evaluate;x.evaluate=(z,D)=>{const C="attributes"in z?void 0:w;try{if(r.testFeature(z,C))return y(z,D)}catch(E){h.error(new b("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:t,feature:z,error:E}))}return null}}return x};a.formatField=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,g,d){const k=b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),m={line:d.Graphics3DLineCalloutSymbolLayer};a.make=function(f,c){if(!g.hasCalloutSupport(f))return k.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${f.type}' does not support callouts`),null;if(!f.callout)return null;const l=m[f.callout.type];return l?new l(f,c):(k.error("Graphics3DCalloutSymbolLayerFactory#make",
`unknown or unsupported callout type ${f.callout.type}`),null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./SymbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y){class z extends u.Graphics3DSymbolLayer{constructor(G,I){super(G,null,I,E);this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new y.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}_perInstanceMaterialParameters(G){const I=
this._materialParameters;I.horizontalScreenOffset=G.horizontalScreenOffset??0;I.centerOffsetUnits=G.centerOffsetUnits||"world";return I}get _materialParameters(){const G=new y.Parameters;var I=this.symbol,H=I.callout;G.color=null!=H.color?b.toUnitRGBA(H.color):[0,0,0,0];G.color[3]*=this._getLayerOpacity();G.size=g.pt2px(H.size||0);if(I.verticalOffset){const {screenLength:B,minWorldLength:K,maxWorldLength:L}=I.verticalOffset;G.verticalOffset={screenLength:g.pt2px(B),minWorldLength:K||0,maxWorldLength:null!=
L?L:Infinity}}G.borderColor=null!=H.border?.color?b.toUnitRGBA(H.border.color):null;H="object"===I.symbolLayers.at(0).type;I="label-3d"===I.type;G.occlusionTest=!H;G.shaderPolygonOffset=H?0:void 0;G.depthHUDAlignStart=I;G.hasSlicePlane=this._context.slicePlaneEnabled;G.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return G}_defaultElevationInfoNoZ(){return C}createGraphics3DGraphic(G){const I=G.renderingInfo;G=G.graphic;
const H=this.setGraphicElevationContext(G,new l.ElevationContext,I.elevationOffset||0);var B=I.symbol;const K="on-the-ground"===this._elevationContext.mode&&("cim"===B.type||!B.symbolLayers.some(L=>"object"===L.type||"text"===L.type));if("label-3d"!==B.type&&K||"point-3d"===B.type&&B.symbolLayers.every(L=>"text"===L.type&&!m.textSymbolLayerSupportsVerticalOffset(L)))return null;B=w.computeCentroid(G.geometry);return null==B?null:this._createAs3DShape(B,H,I,G.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(G,
I,H){H=c.elevationModeChangeUpdateType(z.elevationModeChangeTypes,H,this._elevationContext.mode);if(H!==c.SymbolUpdateType.UPDATE)return H;G.forEach(B=>{const K=I(B);null!=K&&this.updateGraphicElevationContext(B.graphic,K)});return H}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(G,I,H=0){super.setGraphicElevationContext(G,I);I.addOffsetRenderUnits(H);return I}updateGraphicElevationContext(G,
I){this.setGraphicElevationContext(G,I.elevationContext,null!=I.metadata?I.metadata.elevationOffset:0);I.needsElevationUpdates=c.needsElevationUpdates2D(I.elevationContext.mode)}computeComplexity(){return new n.SymbolComplexity({verticesPerFeature:6})}_createVertexData(G){const {translation:I,centerOffset:H}=G;G=I?new q.Attribute([I[0],I[1],I[2]],D,3,!0):new q.Attribute([0,0,0],D,3,!0);const B=H?new q.Attribute([H[0],H[1],H[2],H[3]],D,4,!0):new q.Attribute([0,0,0,1],D,4,!0);return[[r.VertexAttribute.POSITION,
G],[r.VertexAttribute.NORMAL,new q.Attribute([0,0,1],D,3,!0)],[r.VertexAttribute.AUXPOS1,B]]}_getOrCreateMaterial(G){const I=this._perInstanceMaterialParameters(G),H=y.LineCalloutMaterial.uniqueMaterialIdentifier(I);if(H===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=G.materialCollection){let B=G.materialCollection.get(H);null==B&&(B=new y.LineCalloutMaterial(I),G.materialCollection.add(H,B));return{material:B,isUnique:!1}}return{material:new y.LineCalloutMaterial(I),
isUnique:!0}}_createAs3DShape(G,I,H,B){var K=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:B,layerUid:this._context.layer.uid}),L=this._getOrCreateMaterial(H);K=new v.Geometry(L.material,this._createVertexData(H),null,t.ContentObjectType.Point,K);B=x.createStageObject(this._context,G,K,I,B);if(null==B)return null;L=new p.Graphics3DObject3DGraphicLayer(this,B.object,[K],L.isUnique?[L.material]:null,null,f.perObjectElevationAligner,I);L.metadata=new h.Graphics3DObjectMetadata(H.elevationOffset);
L.alignedSampledElevation=B.sampledElevation;L.needsElevationUpdates=c.needsElevationUpdates2D(I.mode);x.extendPointGraphicElevationContext(L,G,this._context.elevationProvider);return L}}z.elevationModeChangeTypes={definedChanged:c.SymbolUpdateType.UPDATE,staysOnTheGround:c.SymbolUpdateType.UPDATE,onTheGroundChanged:c.SymbolUpdateType.RECREATE};const D=[0],C={mode:"relative-to-ground",offset:0},E={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class A{constructor(G,I,H=d.create(),B=k.create(),
K=0,L="world",J=0,M=null){this.renderer=G;this.symbol=I;this.translation=H;this.centerOffset=B;this.horizontalScreenOffset=K;this.centerOffsetUnits=L;this.elevationOffset=J;this.materialCollection=M}}class F extends e.Graphics3DGraphicCreationContext{}a.Graphics3DLineCalloutSymbolLayer=z;a.LineCalloutCreationContext=F;a.LineCalloutSymbolLayerRenderingInfo=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(z,D,C,E,A){let F=!1;var G=z.transformation;D=D.requiresSampledElevationInfo;q[0]=G[12];q[1]=G[13];q[2]=G[14];z.invalidateBoundingInfo();var I=z.getMutableAttribute(u.VertexAttribute.POSITION);G=I.data;I=I.size;const H=G.length/I;z=new p.SamplePosition(z.mapPositions,C);let B=0,K=0;for(let L=0;L<H;L++){t[0]=G[B];t[1]=G[B+1];t[2]=G[B+2];E(z,y);D&&(K+=y.sampledElevation);if(e.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)G[B]=z.array[z.offset],G[B+1]=z.array[z.offset+
1],G[B+2]=y.z,f.projectBuffer(G,C,B,G,A.spatialReference,B,1),G[B]-=q[0],G[B+1]-=q[1],G[B+2]-=q[2],F=!0;else{n[0]=G[B]+q[0];n[1]=G[B+1]+q[1];n[2]=G[B+2]+q[2];A.setAltitude(n,y.z);G[B]=n[0]-q[0];G[B+1]=n[1]-q[1];G[B+2]=n[2]-q[2];const J=.01/A.unitInMeters;if(Math.abs(t[0]-G[B])>=J||Math.abs(t[1]-G[B+1])>=J||Math.abs(t[2]-G[B+2])>=J)F=!0}B+=I;z.offset+=3}return{update:F,averageGeometrySampledElevation:K/H}}const x=g.create(),n=k.create(),q=k.create(),t=k.create(),v=g.create(),r=k.create(),y=new c.SampleElevationInfo;
a.perLodInstanceElevationAligner=function(z,D,C,E,A){var F=z.graphics3DSymbolLayer.lodRenderer;if(null==F)return 0;C=D.centerPointInElevationSR;E(C,y);D="absolute-height"!==D.mode?y.sampledElevation:0;E=F.instanceData;z=z.instanceIndex;E.getGlobalTransform(z,v);F=d.set(r,v[12],v[13],v[14]);e.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(n[0]=C.x,n[1]=C.y,n[2]=y.z,m.computeTranslationToOriginAndRotation(C.spatialReference,n,v,A.spatialReference)&&E.setGlobalTransform(z,v)):A.setAltitudeOfTransformation(y.z,
v);A=.01/A.unitInMeters;(e.debugFlags.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(v[12]-F[0])>=A||Math.abs(v[13]-F[1])>=A||Math.abs(v[14]-F[2])>=A)&&E.setGlobalTransform(z,v);return D};a.perObjectElevationAligner=function(z,D,C,E,A,F){z=z.stageObject;const G=D.centerPointInElevationSR;C=0;z.usesVerticalDistanceToGround?(E(G,y),l.updateVertexAttributeAuxpos1w(z,y.verticalDistanceToGround),C=y.sampledElevation):(E(G,y),"absolute-height"!==D.mode&&(C=y.sampledElevation));D=b.copy(x,F??z.transformation);E=
d.set(r,D[12],D[13],D[14]);e.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(n[0]=G.x,n[1]=G.y,n[2]=y.z,m.computeTranslationToOriginAndRotation(G.spatialReference,n,D,A.spatialReference)&&(F?b.copy(F,D):z.transformation=D)):A.setAltitudeOfTransformation(y.z,D);A=.01/A.unitInMeters;if(Math.abs(D[12]-E[0])>=A||Math.abs(D[13]-E[1])>=A||Math.abs(D[14]-E[2])>=A)F?b.copy(F,D):z.transformation=D;return C};a.perVertexElevationAligner=function(z,D,C,E,A){z=z.stageObject;const F=z.geometries;let G=0;for(const I of F){if(!h.isGeometryWithMapPositions(I))continue;
const {update:H,averageGeometrySampledElevation:B}=w(I,D,C,E,A);G+=B;H&&z.geometryVertexAttributeUpdated(I,u.VertexAttribute.POSITION)}return G/F.length};a.sharedGeometryElevationAligner=function(z,D,C,E,A){z=z.stageObject;const F=z.geometries;if(0===F.length)return 0;let G=0,I=null,H=0,B=!1;for(const K of F){if(!h.isGeometryWithMapPositions(K))continue;const L=K.attributes.get(u.VertexAttribute.POSITION);if(L!==I){const {update:J,averageGeometrySampledElevation:M}=w(K,D,C,E,A);H=M;I=L;B=J}B&&z.geometryVertexAttributeUpdated(K,
u.VertexAttribute.POSITION);G+=H}return G/F.length};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(n,q,t,v,r){const y=(f.isDehydratedPoint(n)?n.z:l.isSamplePosition(n)?n.array[n.offset+2]:n[2])||0;switch(t.mode){case "on-the-ground":t=l.getElevationAtPoint(q,n,"ground")??0;r.verticalDistanceToGround=0;r.sampledElevation=t;r.z=t;break;case "relative-to-ground":n=l.getElevationAtPoint(q,n,"ground")??0;t=t.geometryZWithOffset(y,v);r.verticalDistanceToGround=t;r.sampledElevation=n;r.z=t+n;break;case "relative-to-scene":n=l.getElevationAtPoint(q,n,"scene")??0;
t=t.geometryZWithOffset(y,v);r.verticalDistanceToGround=t;r.sampledElevation=n;r.z=t+n;break;case "absolute-height":t=t.geometryZWithOffset(y,v);v=l.getElevationAtPoint(q,n,"ground")??0;r.verticalDistanceToGround=t-v;r.sampledElevation=v;r.z=t;break;default:r.z=0}}class p{constructor(){this.z=this.sampledElevation=this.verticalDistanceToGround=0}}a.SymbolUpdateType=void 0;(function(n){n[n.NONE=0]="NONE";n[n.UPDATE=1]="UPDATE";n[n.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));
const h={"absolute-height":{applyElevationAlignmentBuffer:function(n,q,t,v,r,y,z,D){y=D.calculateOffsetRenderUnits(z);D=D.featureExpressionInfoContext;q*=3;v*=3;for(z=0;z<r;++z){const C=n[q+1],E=n[q+2];t[v]=n[q];t[v+1]=C;t[v+2]=null==D?E+y:y;q+=3;v+=3}return 0},requiresAlignment:function(n){const q=n.featureExpressionInfoContext;return 0!==n.meterUnitOffset||null!=q}},"on-the-ground":{applyElevationAlignmentBuffer:function(n,q,t,v,r,y){let z=0;const D=y.spatialReference;q*=3;v*=3;for(let C=0;C<r;++C){const E=
n[q],A=n[q+1],F=y.getElevation(E,A,n[q+2],D,"ground")??0;z+=F;t[v]=E;t[v+1]=A;t[v+2]=F;q+=3;v+=3}return z/r},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(n,q,t,v,r,y,z,D){let C=0;z=D.calculateOffsetRenderUnits(z);D=D.featureExpressionInfoContext;const E=y.spatialReference;q*=3;v*=3;for(let A=0;A<r;++A){const F=n[q],G=n[q+1],I=n[q+2],H=y.getElevation(F,G,I,E,"ground")??0;C+=H;t[v]=F;t[v+1]=G;t[v+2]=null==D?I+H+z:H+z;q+=3;v+=3}return C/r},requiresAlignment:()=>
!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(n,q,t,v,r,y,z,D){let C=0;z=D.calculateOffsetRenderUnits(z);D=D.featureExpressionInfoContext;const E=y.spatialReference;q*=3;v*=3;for(let A=0;A<r;++A){const F=n[q],G=n[q+1],I=n[q+2],H=y.getElevation(F,G,I,E,"scene")??0;C+=H;t[v]=F;t[v+1]=G;t[v+2]=null==D?I+H+z:H+z;q+=3;v+=3}return C/r},requiresAlignment:()=>!0}},u=g.create(),w=new p,x=d.create();a.SampleElevationInfo=p;a.applyElevationAlignmentForHUD=function(n,q,t,v,r){e(q,t,r,v,w);c.updateVertexAttributeAuxpos1w(n,
w.verticalDistanceToGround);t=w.sampledElevation;r=b.copy(u,n.transformation);x[0]=q.x;x[1]=q.y;x[2]=w.z;k.computeTranslationToOriginAndRotation(q.spatialReference,x,r,v.spatialReference)?n.transformation=r:console.warn("Could not locate symbol object properly, it might be misplaced");return t};a.applyPerVertexElevationAlignment=function(n,q,t,v,r,y,z,D,C,E,A){const F=h[A.mode];let G=0;if(m.projectBuffer(n,q,t,v,C.spatialReference,r,D)&&(F.requiresAlignment(A)?(G=F.applyElevationAlignmentBuffer(v,
r,y,z,D,C,E,A),n=y,r=z):n=v,m.projectBuffer(n,C.spatialReference,r,y,E.spatialReference,z,D)))return G};a.elevationModeChangeUpdateType=function(n,q,t){return null==q||null==t?n.definedChanged:"on-the-ground"===q&&"on-the-ground"===t?n.staysOnTheGround:q===t||"on-the-ground"!==q&&"on-the-ground"!==t?a.SymbolUpdateType.UPDATE:n.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(n,q,t,v){e(n,q,t,v,w);return w.z};a.evaluateElevationInfoAtPoint=e;a.needsElevationUpdates2D=function(n){return"relative-to-ground"===
n||"relative-to-scene"===n};a.needsElevationUpdates3D=function(n){return"absolute-height"!==n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/unitUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(v){var r=v.paths[0];if(!r||0===r.length)return null;r=h.getPointOnPath(r,h.getPathLength(r)/2);return u.makeDehydratedPoint(r[0],r[1],r[2],v.spatialReference)}function q(v,r,y){y=y?v:w.clonePoint(v);return r&&v?c.projectPoint(v,y,r)?y:null:y}function t(v){const r=y=>null==y||0<=y;return Array.isArray(v)?v.every(r):null==v||0<=v}a.computeCentroid=function(v,r){if("point"===v.type)return q(v,r,!1);if(w.isHydratedGeometry(v))switch(v.type){case "extent":return q(v.center,
r,!1);case "polygon":return q(v.centroid,r,!1);case "polyline":return q(n(v),r,!0);case "mesh":return q(v.origin,r,!1)}else switch(v.type){case "extent":return v=u.makeDehydratedPoint(.5*(v.xmax+v.xmin),.5*(v.ymax+v.ymin),null!=v.zmin&&null!=v.zmax&&isFinite(v.zmin)&&isFinite(v.zmax)?.5*(v.zmax+v.zmin):void 0,v.spatialReference),q(v,r,!0);case "polygon":var y=v.rings[0];y&&0!==y.length?(y=p.ringsCentroid(v.rings,!!v.hasZ),v=u.makeDehydratedPoint(y[0],y[1],y[2],v.spatialReference)):v=null;return q(v,
r,!0);case "polyline":return q(n(v),r,!0)}};a.computeObjectRotation=function(v,r,y,z=d.create()){v&&g.rotateZ(z,z,-v/180*Math.PI);r&&g.rotateX(z,z,r/180*Math.PI);y&&g.rotateY(z,z,y/180*Math.PI);return z};a.computeObjectScale=function(v=k.ONES,r,y,z=1){const D=Array(3);if(null==r||null==y)D[0]=1,D[1]=1,D[2]=1;else{let E=0;for(let A=2;0<=A;A--){const F=v[A];let G;const I=null!=F,H=0===A&&!C&&!I,B=y[A];"symbol-value"===F||H?G=0!==B?r[A]/B:1:I&&"proportional"!==F&&isFinite(F)&&(G=0!==B?F/B:1);if(null!=
G){var C=D[A]=G;E=Math.max(E,Math.abs(G))}}for(v=2;0<=v;v--)null==D[v]?D[v]=C:0===D[v]&&(D[v]=.001*E)}for(C=2;0<=C;C--)D[C]/=z;return k.fromArray(D)};a.demResolutionForBoundingBox=function(v,r,y){if(null!=y.minDemResolution)return y.minDemResolution;const z=b.getMetersPerUnitForSR(r),D=l.width(v)*z,C=l.depth(v)*z;v=l.height(v)*(r.isGeographic?1:z);return 0===D&&0===C&&0===v?y.minDemResolutionForPoints:.01*Math.max(D,C,v)};a.enlargeExtent=function(v,r,y,z=0){if(v){r||(r=e.create());let D=.5*v.width*
(y-1);y=.5*v.height*(y-1);v.width<1E-7*v.height?D+=y/20:v.height<1E-7*v.width&&(y+=D/20);m.set(r,v.xmin-D-z,v.ymin-y-z,v.xmax+D+z,v.ymax+y+z);return r}return null};a.isValidSize=t;a.mixinColorAndOpacity=function(v,r,y=null){const z=f.clone(f.ONES);null!=v&&(z[0]=v[0],z[1]=v[1],z[2]=v[2]);null!=r?z[3]=r:null!=v&&3<v.length&&(z[3]=v[3]);y&&(z[0]*=y,z[1]*=y,z[2]*=y,z[3]*=y);return z};a.overrideColor=function(v,r,y,z,D,C=[0,0,0,0]){for(let E=0;3>E;++E)C[E]=null!=v?.[E]?v[E]:null!=y?.[E]?y[E]:D[E];C[3]=
null!=r?r:null!=z?z:D[3];return C};a.updateVertexAttributeAuxpos1w=function(v,r){for(let y=0;y<v.geometries.length;++y){const z=v.geometries[y].getMutableAttribute(x.VertexAttribute.AUXPOS1);z&&z.data[3]!==r&&(z.data[3]=r,v.geometryVertexAttributeUpdated(v.geometries[y],x.VertexAttribute.AUXPOS1))}};a.validateSymbolLayerSize=function(v){return t(null!=v.isPrimitive?[v.width,v.depth,v.height]:v)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/GeometryWithMapPositions":function(){define(["exports","./Geometry"],function(a,b){class g extends b.Geometry{}a.GeometryWithMapPositions=g;a.isGeometryWithMapPositions=function(d){return null!=d.mapPositions};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,b,g){class d{constructor(){this._renderUnitOffset=
this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(k){this._unit=k;this._metersPerElevationInfoUnit=b.getMetersPerUnit(k)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null;this._renderUnitOffset=
this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"}set offsetMeters(k){this._meterUnitOffset=k;this._renderUnitOffset=0}set offsetElevationInfoUnits(k){this._meterUnitOffset=k*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}addOffsetRenderUnits(k){this._renderUnitOffset+=k}geometryZWithOffset(k,m){m=this.calculateOffsetRenderUnits(m);return null!=this.featureExpressionInfoContext?m:k+m}calculateOffsetRenderUnits(k){let m=this._meterUnitOffset;const f=this.featureExpressionInfoContext;
null!=f&&(m+=g.execute(f)*this._metersPerElevationInfoUnit);return m/k.unitInMeters+this._renderUnitOffset}setFromElevationInfo(k){this.mode=k.mode;this.unit=b.supportsUnit(k.unit)?k.unit:"meters";this.offsetElevationInfoUnits=k.offset??0}updateFeatureExpressionInfoContext(k,m,f){if(null==k)this._featureExpressionInfoContext=null;else{var c=k?.arcade;c&&null!=m&&null!=f?(this._featureExpressionInfoContext=g.clone(k),g.setContextFeature(this._featureExpressionInfoContext,g.createFeature(c.modules,
m,f))):this._featureExpressionInfoContext=k}}static fromElevationInfo(k){const m=new d;null!=k&&m.setFromElevationInfo(k);return m}}a.ElevationContext=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger","../../../../core/promiseUtils","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,g,d,k){const m=b.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");
a.clone=function(f){return{cachedResult:f.cachedResult,arcade:f.arcade?{func:f.arcade.func,context:f.arcade.modules.arcadeUtils.createExecContext(null,{sr:f.arcade.context.spatialReference}),modules:f.arcade.modules}:null}};a.createContext=async function(f,c,l,e){f=f?.expression;if("string"!==typeof f)return null;var p="0"===f?0:null;if(null!=p)return{cachedResult:p};p=await k.loadArcade();g.throwIfAborted(l);l=p.arcadeUtils;f=l.createSyntaxTree(f);return l.dependsOnView(f)?(null!=e&&e.error("Expressions containing '$view' are not supported on ElevationInfo"),
{cachedResult:0}):{arcade:{func:l.createFunction(f),context:l.createExecContext(null,{sr:c}),modules:p}}};a.createContextWithoutExpressionSupport=function(f){f=f?.expression;return"string"===typeof f&&(f="0"===f?0:null,null!=f)?{cachedResult:f}:null};a.createFeature=function(f,c,l){return f.arcadeUtils.createFeature(c.attributes,c.geometry,l)};a.execute=function(f){if(null!=f){if(null!=f.cachedResult)return f.cachedResult;var c=f.arcade;c=c?.modules.arcadeUtils.executeFunction(c.func,c.context);"number"!==
typeof c&&(c=f.cachedResult=0);return c}return 0};a.extractExpressionInfo=function(f,c=!1){f=f?.featureExpressionInfo;c||"0"===f?.expression||(f=null);return f??null};a.setContextFeature=function(f,c){null!=f&&null==f.cachedResult&&(c&&f.arcade?(c._geometry&&(c._geometry=d.hydrateGeometry(c._geometry)),f.arcade.modules.arcadeUtils.updateExecContext(f.arcade.context,c)):m.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(["exports"],function(a){class b{constructor(g,d,k){this.graphic=g;this.renderingInfo=d;this.layer=k}}a.Graphics3DGraphicCreationContext=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(t){return t.isVisible()?t.parameters.transparent?e.Transparency.TRANSPARENT:e.Transparency.OPAQUE:e.Transparency.INVISIBLE}class h{constructor(t,v,r){this.baseMaterial=t;this.edgeMaterials=v;this.properties=r}}class u{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(t,v,r,y,z,D,C,E=null){this.graphics3DSymbolLayer=t;this.stageObject=v;this._uniqueGeometries=r;this._uniqueMaterials=y;this._sharedResource=z;this.elevationAligner=
D;this.elevationContext=C;this._edgeState=E;this.type="object3d";this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}initialize(t){this._stageLayer=t;t=t.stage;t.addMany(this._uniqueMaterials);t.addMany(this._uniqueGeometries);t.add(this.stageObject)}destroy(){if(this._stageLayer){var t=this._stageLayer.stage;t.removeMany(this._uniqueMaterials);t.removeMany(this._uniqueGeometries);t.remove(this.stageObject);
this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);t=t.renderer.edgeView;t?.hasObject(this.stageObject)&&t.removeObject(this.stageObject);this.stageObject.dispose();this._sharedResource?.release();this._visible=!1;this._stageLayer=null}}layerOpacityChanged(t,v){if(null!=this._edgeState){var r=p(this._edgeState.baseMaterial),y=!1;for(const z of this._edgeState.edgeMaterials)z.objectTransparency!==r&&(z.objectTransparency=r,y=!0);y&&this.resetEdgeObject(v);this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[t])}}slicePlaneEnabledChanged(t,v){null!=this._edgeState&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!v),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(null!=this._stageLayer&&this._visible!==t&&(this._visible=t,this.stageObject.visible=t,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const v=this._stageLayer.stage.renderer.ensureEdgeView();
v.hasObject(this.stageObject)?v.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(v,!1)}}get visible(){return this._visible}alignWithElevation(t,v,r,y){null!=this.elevationAligner&&(null!=r&&f.setContextFeature(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t.spatialReference,(z,D)=>m.evaluateElevationInfoAtPoint(z,t,this.elevationContext,v,D),v),this.resetEdgeObject(y))}alignWithAbsoluteElevation(t,
v,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(y,z)=>{z.sampledElevation=t;z.verticalDistanceToGround=0;z.z=t},v);this.resetEdgeObject(r)}getCenterObjectSpace(t=g.create()){return b.copy(t,k.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(t=d.create()){const v=this.stageObject.boundingVolumeObjectSpace;d.setMin(t,v.min);d.setMax(t,v.max);return t}computeAttachmentOrigin(t){const v=this.stageObject.effectiveTransformation;
if(this.useObjectOriginAsAttachmentOrigin)t.render.origin[0]+=v[12],t.render.origin[1]+=v[13],t.render.origin[2]+=v[14],t.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(n)&&(b.transformMat4(n,n,v),b.add(t.render.origin,t.render.origin,n),t.render.num++)}async getProjectedBoundingBox(t,v,r,y,z){z=this.getBoundingBoxObjectSpace(z);var D=q,C=d.isPoint(z)?1:D.length;for(var E=0;E<C;E++){const A=D[E];x[0]=z[A[0]];x[1]=z[A[1]];x[2]=z[A[2]];b.transformMat4(x,x,this.stageObject.transformation);
w[3*E]=x[0];w[3*E+1]=x[1];w[3*E+2]=x[2]}if(!t(w,0,C))return null;d.empty(z);t=null;this.calculateRelativeScreenBounds&&(t=this.calculateRelativeScreenBounds());for(D=0;D<3*C;D+=3){for(E=0;3>E;E++)z[E]=Math.min(z[E],w[D+E]),z[E+3]=Math.max(z[E+3],w[D+E]);t&&r.push({location:w.slice(D,D+3),screenSpaceBoundingRect:t})}if(v?.service&&"absolute-height"!==this.elevationContext.mode){d.center(z,n);r="relative-to-scene"===this.elevationContext.mode?"scene":"ground";C=0;if(v.useViewElevation)C=v.service.getElevation(n[0],
n[1],r)??0;else try{const A=c.demResolutionForBoundingBox(z,v.service.spatialReference,v);C=await v.service.queryElevation(n[0],n[1],y,A,r)??0}catch(A){}d.offset(z,0,0,-this.alignedSampledElevation+C)}return z}addObjectState(t,v){t===l.Object3DState.Highlight&&v.addObject(this.stageObject,this.stageObject.highlight());t===l.Object3DState.MaskOccludee&&v.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}resetEdgeObject(t){if(null!=this._edgeState){var v=
this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(v,t):v.removeObject(this.stageObject)}}_addOrUpdateEdgeObject(t,v){const r=this._edgeState;if(null!=r){var y=p(r.baseMaterial);for(const z of r.edgeMaterials)z.objectTransparency=y;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!v).then(()=>this._stageLayer?.sync())}}}const w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=g.create(),n=g.create(),q=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,
1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=u;a.Object3DEdgeState=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency={});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]="OPAQUE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectMetadata":function(){define(["exports"],
function(a){class b{constructor(g,d=null){this.labelText=d;this.elevationOffset=g??0}}a.Graphics3DObjectMetadata=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./defaultSymbolComplexity ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ../support/FastSymbolUpdates".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(y){const z={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};y&&"visualVariables"in y&&y.visualVariables&&y.visualVariables.forEach(D=>{switch(D.type){case "color":z.color=!0;if(D.stops)for(let C=0;C<D.stops.length;C++){const E=D.stops[C].color;E&&(z.opacity=!0,1>E.a&&(z.opacityAlwaysOpaque=!1))}break;case "opacity":z.opacity=!0;z.opacityAlwaysOpaque=!1;break;case "size":z.size=!0}});return z}const n=d.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");
class q extends u.Loadable{constructor(y,z,D,C){super(D.schedule);this.symbol=y;this.symbolLayer=z;this._context=D;this.ignoreDrivers=!1;this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};this._materials=[];this.usedMemory=0;this.logger=n;this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};this.skipHighSymbolLodsChanged=!0;this._renderPriority=C.renderPriority;this._renderPriorityStep=C.renderPriorityStep;this._elevationContext=new l.ElevationContext;
this.complexity=this.computeComplexity();this.ignoreDrivers=C.ignoreDrivers;this.ignoreDrivers||(this._drivenProperties=x(this._context.renderer));this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(y){if(this.ignoreDrivers)return!1;const z=this._drivenProperties;y=x(y);return y.color!==z.color||y.opacity!==z.opacity||y.opacityAlwaysOpaque!==z.opacityAlwaysOpaque||y.size!==z.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&
!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(y,z,D,C){const E="polygons"in y?y.polygons:null,A=`${C} geometry failed to be created`;let F=null;y.projectionSuccess?!this._logGeometryValidationWarnings(z,D,C)&&E&&0===E.length&&"rings"===D&&0<z.length&&2<z[0].length&&(F=`${A} (filled rings should use clockwise winding - try reversing the order of vertices)`):F=`${A} (failed to project geometry to view spatial reference)`;F&&n.warnOncePerTick(F)}_logGeometryValidationWarnings(y,
z,D){D=`${D} geometry failed to be created`;return!y.length||1===y.length&&!y[0].length?(n.warnOncePerTick(`${D} (no ${z} were defined)`),!0):Array.isArray(y)&&Array.isArray(y[0])?!1:(n.warnOncePerTick(`${D} (${z} should be defined as a 2D array)`),!0)}_validateGeometry(y,z=null,D=null){return null==z||z.includes(y.type)?"point"!==y.type||isFinite(y.x)&&isFinite(y.y)?!0:(n.warn("point coordinate is not a valid number, graphic skipped"),!1):(this.logger.warn("unsupported geometry type for "+D+` symbol: ${y.type}`),
!1)}_defaultElevationInfoNoZ(){return t}_defaultElevationInfoZ(){return v}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(y){return y.hasZ?
this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(y,z=this.getDefaultElevationInfo(y)){return this._elevationContext.mode||z.mode}setElevationInfoOverride(y){this._elevationInfoOverride=y;this._updateElevationContext()}setGraphicElevationContext(y,z=new l.ElevationContext){var D=y.geometry;const C=this.getDefaultElevationInfo(D);z.unit=null!=this._elevationContext.unit?this._elevationContext.unit:C.unit;z.mode=this.getGeometryElevationMode(D,C);z.offsetMeters=
this._elevationContext.meterUnitOffset??C.offset??0;if(D=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===z.mode)z.mode="relative-to-ground",z.offsetMeters=0;z.updateFeatureExpressionInfoContext(D?e.zeroContext:this._elevationContext.featureExpressionInfoContext,y,this._context.layer);return z}prepareSymbolLayerPatch(y){}updateGeometry(y,z){return!1}updateTransform(y,z,D,C){return!1}onRemoveGraphic(y){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??
0;const y=this._context.layer.opacity;return null==y?1:y}_getCombinedOpacity(y,z=r){let D=1;this.draped||(D*=this._getLayerOpacity());if(this._drivenProperties.opacity)return D;null!=y?D*=y.a:z.hasIntrinsicColor||(D=0);return D}_getCombinedOpacityAndColor(y,z=r){z=this._getCombinedOpacity(y,z);if(this._drivenProperties.color)return p.mixinColorAndOpacity(null,z);y=null!=y?b.toUnitRGB(y):k.ONES;return p.mixinColorAndOpacity(y,z)}_getVertexOpacityAndColor(y,z=null){y=p.mixinColorAndOpacity(this._drivenProperties.color?
y.color:null,this._drivenProperties.opacity?y.opacity:null);z&&(y[0]*=z,y[1]*=z,y[2]*=z,y[3]*=z);return y}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return f.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)}globalPropertyChanged(y,z,D){switch(y){case "opacity":return this.layerOpacityChanged(z,D),!0;case "elevationInfo":return y=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(z,D,y)===c.SymbolUpdateType.RECREATE?!1:
!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(z,D);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(y,z,D){let C=c.SymbolUpdateType.UPDATE;y.forEach(E=>{const A=z(E);null!=A?(this.setGraphicElevationContext(E.graphic,A.elevationContext),A.needsElevationUpdates=
D(A.elevationContext.mode)):C=c.SymbolUpdateType.RECREATE});return C}applyRendererDiff(y,z){return h.ApplyRendererDiffResult.RecreateSymbol}getFastUpdateAttrValues(y){if(!this._fastUpdates)return null;const z=this._fastUpdates.visualVariables,D=z.size?w.getAttributeValue(z.size.field,y):0,C=z.color?w.getAttributeValue(z.color.field,y):0;y=z.opacity?w.getAttributeValue(z.opacity.field,y):0;return m.fromValues(D,C,y,0)}get draped(){return this._draped}ensureDrapedStatus(y){if(null==this._draped)return this._draped=
y,!0;y!==this.draped&&n.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??
null})}}}const t={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"},r={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/defaultSymbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../symbols/support/ObjectSymbol3DLayerResource ./Graphics3DPathSymbolLayerConstants ./primitiveObjectSymbolUtils ./SymbolComplexity ../support/edgeUtils ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,g,d,k,m,f,c){function l(n){let q=0,t=0,v=0,r=!1,y=0;const z=new m.SymbolComplexityMemory;for(const D of n)null!=D&&(q+=D.verticesPerFeature,t+=D.verticesPerCoordinate,v+=D.drawCallsPerFeature,z.bytesPerFeature+=D.memory.bytesPerFeature,z.bytesPerFeatureLabel+=D.memory.bytesPerFeatureLabel,z.resourceBytes+=D.memory.resourceBytes,z.draped.bytesPerFeature+=D.memory.bytesPerFeature,z.draped.bytesPerFeatureLabel+=D.memory.bytesPerFeatureLabel,r=r||D.estimated,++y);return r?new m.EstimatedAggregateSymbolComplexity(y,
{verticesPerFeature:q,verticesPerCoordinate:t,drawCallsPerFeature:v,memory:z}):new m.AggregateSymbolComplexity(y,{verticesPerFeature:q,verticesPerCoordinate:t,drawCallsPerFeature:v,memory:z})}function e(n,q){const t=p(n,q);var v=f.hasEdges(q)?2:0;switch(q.type){case "extrude":return new m.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:v,memory:t});case "fill":if("mesh-3d"===n.type)return new m.SymbolComplexity({drawCallsPerFeature:v,memory:t});if(null!=q.outline&&
0<q.outline.size)return new m.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:9,memory:t});case "water":return new m.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:3,memory:t});case "line":return new m.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:6,memory:t});case "object":if(q.resource?.href)return new m.EstimatedSymbolComplexity({verticesPerFeature:100,memory:t});q=q.resource?.primitive??g.defaultPrimitive;(n=w[q])?q=n:(n=k.primitiveLodResources(q,
new c.DefaultMaterial({})),n=h(n.levels),w[q]=new m.SymbolComplexity({verticesPerFeature:n}),q=w[q]);return{...q,memory:t};case "path":var r=n=0;switch(q.profile){case "circle":n=d.pathNumCircleProfileSubdivisions;break;case "quad":n=4;break;default:b.neverReached(q.profile);return}switch(q.join??"simple"){case "round":r=d.pathNumRoundJoinSubdivisions;break;case "miter":case "bevel":r=1;break;default:return}v=2*n;r=n*r*2;let y=-2*r-v;switch(q.cap){case "none":break;case "butt":case "square":y+=2*
(n-1);break;case "round":y+=2*(n*(d.pathNumRoundCapExtrusionSubdivisions-1)*2+n);break;default:return}return new m.SymbolComplexity({verticesPerFeature:y,verticesPerCoordinate:r+v,memory:t});case "text":case "icon":return new m.SymbolComplexity({verticesPerFeature:6,memory:t})}}function p(n,q){n="point-3d"===n.type;switch(q.type){case "extrude":return q.edges&&0<q.edges.size?x.EXTRUDE_EDGES:x.EXTRUDE;case "fill":return null!=q.outline&&0<q.outline.size?x.FILL_OUTLINE:x.FILL;case "water":return x.FILL;
case "line":return"round"===q.join?x.LINE_ROUND:x.LINE_MITER;case "path":switch(q.join){case "round":switch(q.profile){case "circle":return x.PATH_ROUND_CIRCLE;case "quad":return x.PATH_ROUND_QUAD;default:b.neverReached(q.profile);return}case "miter":case "bevel":switch(q.profile){case "circle":return x.PATH_MITER_CIRCLE;case "quad":return x.PATH_MITER_QUAD;default:b.neverReached(q.profile);return}case "simple":return;default:return}case "object":return n?x.OBJECT_POINT:x.OBJECT_POLYGON;case "icon":case "text":return n?
x.ICON_POINT:x.ICON_POLYGON}}function h(n){return n.reduce((q,t,v)=>q+1/10**v*t.numVertices,0)/n.reduce((q,t,v)=>q+1/10**v,0)}const u=new m.EstimatedSymbolComplexity({}),w={},x={ICON_POINT:{bytesPerFeature:2111.586639736967,bytesPerFeatureLabel:870.520855,resourceBytes:0,draped:{bytesPerFeature:1799.2619971817762,bytesPerFeatureLabel:857.4890149999999}},ICON_POLYGON:{bytesPerFeature:2829.8183316810564,bytesPerFeatureLabel:858.0951816666667,resourceBytes:0,draped:{bytesPerFeature:2521.242008227286,
bytesPerFeatureLabel:869.6919750000001}},OBJECT_POINT:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001,resourceBytes:0,draped:{bytesPerFeature:607.8007336777831,bytesPerFeatureLabel:715.7017950000001}},OBJECT_POLYGON:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667,resourceBytes:0,draped:{bytesPerFeature:1111.4123028075749,bytesPerFeatureLabel:684.5498416666667}},LINE_MITER:{bytesPerFeature:3053.034748007272,bytesPerFeatureLabel:804.5473016666666,
resourceBytes:0,draped:{bytesPerFeature:2649.5661560225844,bytesPerFeatureLabel:843.3404083333334}},LINE_ROUND:{bytesPerFeature:3225.35183564197,bytesPerFeatureLabel:807.296835,resourceBytes:0,draped:{bytesPerFeature:2650.9229994933276,bytesPerFeatureLabel:861.108335}},PATH_MITER_CIRCLE:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665,resourceBytes:0,draped:{bytesPerFeature:38664.832646351235,bytesPerFeatureLabel:862.95665}},PATH_ROUND_CIRCLE:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885,
resourceBytes:0,draped:{bytesPerFeature:42462.97022293504,bytesPerFeatureLabel:851.35885}},PATH_MITER_QUAD:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885,resourceBytes:0,draped:{bytesPerFeature:25558.22153327986,bytesPerFeatureLabel:838.56885}},PATH_ROUND_QUAD:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001,resourceBytes:0,draped:{bytesPerFeature:42274.86801764233,bytesPerFeatureLabel:867.5658500000001}},FILL:{bytesPerFeature:3124.272297197038,bytesPerFeatureLabel:850.6966816666666,
resourceBytes:0,draped:{bytesPerFeature:2630.99580851019,bytesPerFeatureLabel:845.464495}},FILL_OUTLINE:{bytesPerFeature:4501.643043274039,bytesPerFeatureLabel:866.3982816666668,resourceBytes:0,draped:{bytesPerFeature:3841.8870233416183,bytesPerFeatureLabel:854.9969683333334}},EXTRUDE:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668,resourceBytes:0,draped:{bytesPerFeature:7545.975968446941,bytesPerFeatureLabel:859.7106016666668}},EXTRUDE_EDGES:{bytesPerFeature:2872.306473115409,
bytesPerFeatureLabel:604.556581666667,resourceBytes:0,draped:{bytesPerFeature:2872.306473115409,bytesPerFeatureLabel:604.556581666667}}};a.averageSymbolComplexities=function(n){n=l(n);0<n.numComplexities&&(n.verticesPerFeature/=n.numComplexities,n.verticesPerCoordinate/=n.numComplexities,n.drawCallsPerFeature/=n.numComplexities,n.memory.bytesPerFeature/=n.numComplexities,n.memory.bytesPerFeatureLabel/=n.numComplexities,n.memory.resourceBytes/=n.numComplexities,n.memory.draped.bytesPerFeature/=n.numComplexities,
n.memory.draped.bytesPerFeatureLabel/=n.numComplexities);return n};a.defaultSymbolComplexity=function(n){if("web-style"===n.type)return u;const q=n.symbolLayers.toArray().map(t=>e(n,t));return l(q)};a.defaultSymbolLayerComplexity=e;a.defaultSymbolLayerMemoryComplexity=p;a.emptySymbolComplexity=u;a.estimateNumVerticesForLods=h;a.memoryEstimators=x;a.totalSymbolComplexities=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants":function(){define(["exports"],
function(a){a.pathNumCircleProfileSubdivisions=10;a.pathNumRoundCapExtrusionSubdivisions=3;a.pathNumRoundJoinSubdivisions=3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b,g,d){const k=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,
minScreenSpaceRadius:65}];a.isValidPrimitive=function(m){switch(m){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(m,f){const c=(l,e,p=!1)=>new d.LodResources(l.map(h=>{const u=e(h.tesselation);p&&g.cgToGIS(u);return new d.LodLevelResources([new d.LodComponentResources(u)],h.minScreenSpaceRadius)}));switch(m){case "sphere":return c([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,
minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],l=>g.createPolySphereGeometry(f,.5,l,!0));case "cube":return c([{tesselation:0,minScreenSpaceRadius:0}],()=>g.createBoxGeometry(f,1));case "cone":return c(k,l=>g.createConeGeometry(f,1,.5,l,!1),!0);case "inverted-cone":return c(k,l=>g.createConeGeometry(f,1,.5,l,!0),!0);case "cylinder":return c(k,l=>g.createCylinderGeometry(f,1,.5,l,[0,0,1],[0,0,.5]));case "tetrahedron":return c([{tesselation:0,
minScreenSpaceRadius:0}],()=>g.createTetrahedronGeometry(f,1),!0);case "diamond":return c([{tesselation:0,minScreenSpaceRadius:0}],()=>g.createDiamondGeometry(f,1),!0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils","../VertexAttribute"],function(a,b,g){class d{constructor(f,c=null){this.geometry=f;this.textures=c}}class k{constructor(f,c,l){this.components=f;
this.minScreenSpaceRadius=c;this.pivotOffset=l;this.numVertices=this.geometries.reduce((e,p)=>e+p.attributes.get(g.VertexAttribute.POSITION).indices.length,0)}get geometries(){return b.unique(this.components.map(f=>f.geometry))}}class m{constructor(f){this.levels=f;this.levels.sort((c,l)=>c.minScreenSpaceRadius===l.minScreenSpaceRadius?c.numVertices-l.numVertices:c.minScreenSpaceRadius-l.minScreenSpaceRadius)}}a.LodComponentResources=d;a.LodLevelResources=k;a.LodResources=m;a.geometriesFromLodResources=
function(f){const c=[];f.levels.forEach(l=>l.components.forEach(e=>c.push(e.geometry)));return b.unique(c)};a.materialsFromLodResources=function(f){const c=[];f.levels.forEach(l=>l.components.forEach(e=>c.push(e.geometry.material)));return b.unique(c)};a.texturesFromLodResources=function(f){const c=[];f.levels.forEach(l=>l.components.forEach(e=>{null!=e.textures&&c.push(...e.textures)}));return b.unique(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SymbolComplexity":function(){define(["exports"],
function(a){class b{constructor(f){this.estimated=!1;this.verticesPerFeature=f.verticesPerFeature??0;this.verticesPerCoordinate=f.verticesPerCoordinate??0;this.drawCallsPerFeature=f.drawCallsPerFeature??0;this.memory=f.memory??new m}}class g extends b{constructor(f){super(f);this.estimated=!0}}class d extends b{constructor(f,c){super(c);this.numComplexities=f}}class k extends g{constructor(f,c){super(c);this.numComplexities=f}}class m{constructor(){this.resourceBytes=this.bytesPerFeatureLabel=this.bytesPerFeature=
0;this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}a.AggregateSymbolComplexity=d;a.EstimatedAggregateSymbolComplexity=k;a.EstimatedSymbolComplexity=g;a.SymbolComplexity=b;a.SymbolComplexityMemory=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,g,d,k,m,f){function c(h,u){if(null==h)return null;const w=null!=h.color?k.fromArray(b.toUnitRGBA(h.color)):k.fromValues(0,0,0,0),x=d.pt2px(h.size),n=d.pt2px(h.extensionLength);switch(h.type){case "solid":return l({color:w,size:x,extensionLength:n,...u});case "sketch":return{...p,color:w,size:x,extensionLength:n,...u,type:"sketch"}}}function l(h){return{...e,...h,type:"solid"}}const e={color:k.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:f.Transparency.OPAQUE,
hasSlicePlane:!1},p={color:k.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:f.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(h,u){return c(h&&h.enabled&&h.edges||null,u)};a.createMaterialFromEdges=c;a.createSolidEdgeMaterial=l;a.hasEdges=function(h){return h&&h.enabled&&(m.isExtrudeSymbol3DLayer(h)||m.isFillSymbol3DLayer(h))&&null!=h.edges};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],
function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../core/has ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){class D extends u.Material{constructor(J){super(J,A);this.supportsEdges=!0;this._configuration=new y.DefaultMaterialTechniqueConfiguration;J=this.parameters;const M=m.newLayout().vec3f(n.VertexAttribute.POSITION);J.normalType===c.NormalType.Compressed?M.vec2i16(n.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}):M.vec3f(n.VertexAttribute.NORMAL);J.hasVertexTangents&&M.vec4f(n.VertexAttribute.TANGENT);(J.textureId||J.normalTextureId||J.metallicRoughnessTextureId||
J.emissiveTextureId||J.occlusionTextureId)&&M.vec2f(n.VertexAttribute.UV0);J.hasVertexColors&&M.vec4u8(n.VertexAttribute.COLOR);J.hasSymbolColors&&M.vec4u8(n.VertexAttribute.SYMBOLCOLOR);b("enable-feature:objectAndLayerId-rendering")&&M.vec4u8(n.VertexAttribute.OBJECTANDLAYERIDCOLOR);this._vertexBufferLayout=M}isVisibleForOutput(J){return J===f.ShaderOutput.Shadow||J===f.ShaderOutput.ShadowExcludeHighlight||J===f.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){var J=this.parameters;
if(!super.isVisible()||0===J.layerOpacity)return!1;const {hasInstancedColor:M,hasVertexColors:T,hasSymbolColors:Q,vvColor:O}=J,U="replace"===J.colorMixMode,Z=0<J.opacity;J=J.externalColor&&0<J.externalColor[3];const P=M||O||Q;return T&&P?U||Z:T?U?J:Z:P?U||Z:U?J:Z}getConfiguration(J,M){this._configuration.output=J;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;
this._configuration.instanced=this.parameters.isInstanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=
this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=this.parameters.hasSlicePlane?p.CullFaceOptions.None:this.parameters.cullFace;this._configuration.multipassEnabled=
M.multipassEnabled;this._configuration.cullAboveGround=M.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation;if(J===f.ShaderOutput.Color||J===f.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=this.parameters.treeRendering?l.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===
this.parameters.doubleSidedType?l.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?l.NormalsDoubleSidedMode.WindingOrder:l.NormalsDoubleSidedMode.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=null!=M.ssao,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=
!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?e.PBRMode.Schematic:e.PBRMode.Normal:e.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),
this._configuration.transparencyPassType=M.transparencyPassType,this._configuration.enableOffset=M.camera.relativeElevation<w.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(M),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=
!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration}hasSnowCover(J){return null!=J.weather&&J.weatherVisible&&"snowy"===J.weather.type&&"enabled"===J.weather.snowCover}intersect(J,M,T,Q,O,U){if(null!=this.parameters.verticalOffset){const P=T.camera;g.set(K,M[12],M[13],M[14]);M=null;switch(T.viewingMode){case k.ViewingMode.Global:M=g.normalize(H,K);break;case k.ViewingMode.Local:M=
g.copy(H,I)}let R=0;var Z=g.subtract(L,K,P.eye);const W=g.length(Z);Z=g.scale(Z,Z,1/W);let N=null;this.parameters.screenSizePerspective&&(N=g.dot(M,Z));R+=v.verticalOffsetAtDistance(P,W,this.parameters.verticalOffset,N??0,this.parameters.screenSizePerspective);g.scale(M,M,R);g.transformMat3(B,M,T.transform.inverseRotation);Q=g.subtract(F,Q,B);O=g.subtract(G,O,B)}v.intersectTriangleGeometry(J,T,Q,O,q.getVerticalOffsetObject3D(T.verticalOffset),U)}produces(J,M){return M===f.ShaderOutput.Color||M===
f.ShaderOutput.Alpha||M===f.ShaderOutput.Depth||M===f.ShaderOutput.Normal||M===f.ShaderOutput.Shadow||M===f.ShaderOutput.ShadowHighlight||M===f.ShaderOutput.ShadowExcludeHighlight||M===f.ShaderOutput.Highlight||M===f.ShaderOutput.ObjectAndLayerIdColor?J===(this.parameters.transparent?this.parameters.writeDepth?x.RenderSlot.TRANSPARENT_MATERIAL:x.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:x.RenderSlot.OPAQUE_MATERIAL)||J===x.RenderSlot.DRAPED_MATERIAL:!1}createGLMaterial(J){return new C(J)}createBufferWriter(){return new t.DefaultBufferWriter(this._vertexBufferLayout)}}
class C extends h.GLTextureMaterial{constructor(J){super({...J,...J.material.parameters})}_updateShadowState(J){J.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:J.shadowMap.enabled})}_updateOccludeeState(J){J.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:J.hasOccludees})}beginSlot(J){if(this._output===f.ShaderOutput.Color||this._output===f.ShaderOutput.Alpha)this._updateShadowState(J),
this._updateOccludeeState(J);const M=this._material.parameters;this.updateTexture(M.textureId);const T=J.camera.viewInverseTransposeMatrix;g.set(M.origin,T[3],T[7],T[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(M.treeRendering?z.RealisticTreeTechnique:r.DefaultMaterialTechnique,J)}}class E extends r.DefaultMaterialPassParameters{constructor(){super(...arguments);this.hasVertexTangents=this.treeRendering=this.initTextureTransparent=!1}}const A=new E,F=d.create(),
G=d.create(),I=d.fromValues(0,0,1),H=d.create(),B=d.create(),K=d.create(),L=d.create();a.DefaultGLMaterial=C;a.DefaultMaterial=D;a.DefaultMaterialParameters=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,g,d){a.NormalType=void 0;(function(k){k[k.Attribute=
0]="Attribute";k[k.Compressed=1]="Compressed";k[k.Ground=2]="Ground";k[k.ScreenDerivative=3]="ScreenDerivative";k[k.COUNT=4]="COUNT"})(a.NormalType||(a.NormalType={}));a.NormalAttribute=function(k,m){switch(m.normalType){case a.NormalType.Compressed:k.attributes.add(d.VertexAttribute.NORMALCOMPRESSED,"vec2");k.vertex.code.add(g.glsl`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case a.NormalType.Attribute:k.attributes.add(d.VertexAttribute.NORMAL,"vec3");k.vertex.code.add(g.glsl`vec3 normalModel() {
return normal;
}`);break;case a.NormalType.ScreenDerivative:k.fragment.code.add(g.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:b.neverReached(m.normalType);case a.NormalType.COUNT:case a.NormalType.Ground:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,g){a.NormalsDoubleSidedMode=void 0;(function(d){d[d.None=0]="None";d[d.View=1]="View";d[d.WindingOrder=2]="WindingOrder";d[d.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||
(a.NormalsDoubleSidedMode={}));a.Normals=function(d,k){d=d.fragment;d.code.add(g.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(k.doubleSidedMode){case a.NormalsDoubleSidedMode.None:d.code.add(g.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:d.code.add(g.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:d.code.add(g.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(k.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../lib/VertexAttribute","./internal/bufferWriterUtils"],function(a,b,g){class d{constructor(k){this.vertexBufferLayout=k}elementCount(k){return k.attributes.get(b.VertexAttribute.POSITION).indices.length}write(k,m,f,c,l){g.writeDefaultAttributes(f,this.vertexBufferLayout,
k,m,c,l)}}a.DefaultBufferWriter=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/pbrUtils ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){class C extends l.VertexNormalPassParameters{constructor(){super(...arguments);this.usePBR=this.isSchematic=!1;this.mrrFactors=g.fromArray(r.defaultAdvancedMRRFactors);this.doubleSided=this.hasSymbolColors=this.hasVertexColors=!1;this.doubleSidedType="normal";this.cullFace=u.CullFaceOptions.Back;this.hasInstancedColor=this.isInstanced=!1;this.emissiveFactor=g.fromValues(0,0,0);this.instancedDoublePrecision=!1;this.normalType=f.NormalType.Attribute;
this.castShadows=this.receiveShadows=!0;this.shadowMappingEnabled=!1;this.ambient=g.fromValues(.2,.2,.2);this.diffuse=g.fromValues(.8,.8,.8);this.externalColor=d.fromValues(1,1,1,1);this.colorMixMode="multiply";this.layerOpacity=this.opacity=1;this.origin=g.create();this.hasSlicePlane=!1;this.hasSliceHighlight=!0;this.offsetTransparentBackfaces=!1;this.modelTransformation=this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.transparent=!1;this.writeDepth=
!0;this.customDepthTest=u.DepthTestFunction.Less;this.textureAlphaMode=u.AlphaDiscardMode.Blend;this.textureAlphaCutoff=e.defaultMaskAlphaCutoff;this.hasOccludees=this.textureAlphaPremultiplied=!1;this.renderOccluded=x.RenderOccludedFlag.Occlude;this.isDecoration=!1}}class E extends l.VertexNormalDrawParameters{constructor(){super(...arguments);this.slicePlaneLocalOrigin=this.origin=g.create()}}class A extends h.ShaderTechnique{initializeConfiguration(F,G){G.spherical=F.viewingMode===k.ViewingMode.Global;
G.doublePrecisionRequiresObfuscation=F.rctx.driverTest.doublePrecisionRequiresObfuscation.result;G.textureCoordinateType=G.hasColorTexture||G.hasMetallicRoughnessTexture||G.hasEmissionTexture||G.hasOcclusionTexture||G.hasNormalTexture?c.TextureCoordinateAttributeType.Default:c.TextureCoordinateAttributeType.None;G.objectAndLayerIdColorInstanced=G.instanced}initializeProgram(F){return this._initializeProgram(F,A.shader)}_initializeProgram(F,G){return new q.Program(F.rctx,G.get().build(this.configuration),
w.Default3D)}_convertDepthTestFunction(F){return F===u.DepthTestFunction.Lequal?z.CompareFunction.LEQUAL:z.CompareFunction.LESS}_makePipeline(F,G){const I=this.configuration,H=F===v.TransparencyPassType.NONE,B=F===v.TransparencyPassType.FrontFace;var K=D.makePipelineState,L=I.output!==m.ShaderOutput.Color&&I.output!==m.ShaderOutput.Alpha||!I.transparent?null:H?n.blendingDefault:n.oitBlending(F);var J=I.cullFace!==u.CullFaceOptions.None?!0:I.hasSlicePlane?!1:!I.transparent&&!I.doubleSidedMode;return K.call(D,
{blending:L,culling:J?D.cullingParams(I.cullFace):null,depthTest:{func:n.oitDepthTest(F,this._convertDepthTestFunction(I.customDepthTest))},depthWrite:H||B?I.writeDepth?D.defaultDepthWriteParams:null:null,colorWrite:D.defaultColorWriteParams,stencilWrite:I.hasOccludees?t.stencilWriteMaskOn:null,stencilTest:I.hasOccludees?G?t.stencilToolMaskBaseParams:t.stencilBaseAllZerosParams:null,polygonOffset:H||B?null:n.getOITPolygonOffset(I.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,
!0);return this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(F){return F?this._occludeePipelineState:super.getPipeline()}}A.shader=new p.ReloadableShaderModule(y.DefaultMaterial,()=>new Promise((F,G)=>a(["./DefaultMaterial.glsl"],F,G)));b.DefaultMaterialDrawParameters=E;b.DefaultMaterialPassParameters=C;b.DefaultMaterialTechnique=A;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l){class e extends m.VertexPositionPassParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=g.create()}}class p extends m.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalGlobalFromModel=g.create();this.toMapSpace=d.create()}}a.VertexNormal=function(h,u){switch(u.normalType){case k.NormalType.Attribute:case k.NormalType.Compressed:h.include(k.NormalAttribute,u);h.varyings.add("vNormalWorld","vec3");h.varyings.add("vNormalView",
"vec3");h.vertex.uniforms.add(new c.Matrix3DrawUniform("transformNormalGlobalFromModel",w=>w.transformNormalGlobalFromModel),new l.Matrix3PassUniform("transformNormalViewFromGlobal",w=>w.transformNormalViewFromGlobal));h.vertex.code.add(f.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case k.NormalType.Ground:h.include(m.VertexPosition,u);h.varyings.add("vNormalWorld","vec3");h.vertex.code.add(f.glsl`
        void forwardNormal() {
          vNormalWorld = ${u.spherical?f.glsl`normalize(vPositionWorldCameraRelative);`:f.glsl`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case k.NormalType.ScreenDerivative:h.vertex.code.add(f.glsl`void forwardNormal() {}`);break;default:b.neverReached(u.normalType);case k.NormalType.COUNT:}};a.VertexNormalDrawParameters=p;a.VertexNormalPassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,g){const d={func:g.CompareFunction.LESS},k={function:{func:g.CompareFunction.ALWAYS,
ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:g.StencilOperation.KEEP,zFail:g.StencilOperation.KEEP,zPass:g.StencilOperation.ZERO}},m={function:{func:g.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:g.StencilOperation.KEEP,zFail:g.StencilOperation.KEEP,zPass:g.StencilOperation.REPLACE}},f={function:{func:g.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,
mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:g.StencilOperation.KEEP,zFail:g.StencilOperation.KEEP,zPass:g.StencilOperation.KEEP}};b={function:{func:g.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:g.StencilOperation.KEEP,zFail:g.StencilOperation.KEEP,zPass:g.StencilOperation.KEEP}};a.depthCompareAlways={func:g.CompareFunction.ALWAYS};a.depthCompareLess=d;a.renderWhenBitIsNotSet=c=>({function:{func:g.CompareFunction.NOTEQUAL,
ref:c,mask:c},operation:{fail:g.StencilOperation.KEEP,zFail:g.StencilOperation.KEEP,zPass:g.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=c=>({function:{func:g.CompareFunction.ALWAYS,ref:c,mask:c},operation:{fail:g.StencilOperation.KEEP,zFail:g.StencilOperation.KEEP,zPass:g.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=k;a.stencilToolMaskBaseParams=m;a.stencilToolMaskOccluderParams=f;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn=
{mask:255};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/pbrUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,g){a.defaultAdvancedMRRFactors=[1,1,.5];a.defaultEsriSymbologyMRRFactors=[0,1,.2];a.defaultSchematicMRRFactors=[0,.6,.2];a.useSchematicPBR=function({normalTexture:d,metallicRoughnessTexture:k,metallicFactor:m,roughnessFactor:f,emissiveTexture:c,emissiveFactor:l,occlusionTexture:e}){return null==
d&&null==k&&null==c&&(null==l||b.exactEquals(l,g.ZEROS))&&null==e&&(null==f||1===f)&&(null==m||1===m||0===m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O){function U(P){const R=new M.ShaderBuilder,{vertex:W,fragment:N,varyings:V}=R;H.addProjViewLocalOrigin(W,P);R.include(l.PositionAttribute);V.add("vpos","vec3");R.include(A.VisualVariables,P);R.include(f.InstancedDoublePrecision,P);R.include(w.VerticalOffset,P);P.hasColorTextureTransform&&R.include(E.colorTextureUV);if(P.output===d.ShaderOutput.Color||P.output===d.ShaderOutput.Alpha){P.hasNormalTextureTransform&&R.include(E.normalTextureUV);
P.hasEmissionTextureTransform&&R.include(E.emissiveTextureUV);P.hasOcclusionTextureTransform&&R.include(E.occlusionTextureUV);P.hasMetallicRoughnessTextureTransform&&R.include(E.metallicRoughnessTextureUV);H.addCameraPosition(W,P);R.include(c.NormalAttribute,P);R.include(m.Transform,P);const S=P.normalType===c.NormalType.Attribute||P.normalType===c.NormalType.Compressed;S&&P.offsetBackfaces&&R.include(g.Offset);R.include(n.ComputeNormalTexture,P);R.include(u.VertexNormal,P);P.instancedColor&&R.attributes.add(O.VertexAttribute.INSTANCECOLOR,
"vec4");V.add("vPositionLocal","vec3");R.include(p.TextureCoordinateAttribute,P);R.include(b.ForwardLinearDepth,P);R.include(e.SymbolColor,P);R.include(h.VertexColor,P);W.uniforms.add(new K.Float4PassUniform("externalColor",X=>X.externalColor));V.add("vcolorExt","vec4");P.multipassEnabled&&V.add("depth","float");W.code.add(J.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${P.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${J.glsl.float(F.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${S?J.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${P.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${S&&P.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${P.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${P.hasColorTextureTransform?J.glsl`forwardColorUV();`:""}
        ${P.hasNormalTextureTransform?J.glsl`forwardNormalUV();`:""}
        ${P.hasEmissionTextureTransform?J.glsl`forwardEmissiveUV();`:""}
        ${P.hasOcclusionTextureTransform?J.glsl`forwardOcclusionUV();`:""}
        ${P.hasMetallicRoughnessTextureTransform?J.glsl`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(P.output){case d.ShaderOutput.Alpha:R.include(k.SliceDraw,P);R.include(G.DiscardOrAdjustAlphaPass,P);R.include(r.multipassTerrainTest,P);N.uniforms.add(new L.FloatPassUniform("opacity",S=>S.opacity),new L.FloatPassUniform("layerOpacity",S=>S.layerOpacity));P.hasColorTexture&&N.uniforms.add(new T.Texture2DPassUniform("tex",S=>S.texture));N.include(I.MixExternalColor);N.code.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${P.multipassEnabled?"terrainDepthTest(depth);":""}
        ${P.hasColorTexture?J.glsl`
                vec4 texColor = texture(tex, ${P.hasColorTextureTransform?J.glsl`colorUV`:J.glsl`vuv0`});
                ${P.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        ${P.hasVertexColors?J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case d.ShaderOutput.Color:R.include(k.SliceDraw,P),R.include(t.EvaluateSceneLighting,P),R.include(q.EvaluateAmbientOcclusion,P),R.include(G.DiscardOrAdjustAlphaPass,P),R.include(P.instancedDoublePrecision?C.ReadShadowMapPass:C.ReadShadowMapDraw,P),R.include(r.multipassTerrainTest,P),H.addCameraPosition(N,P),N.uniforms.add(W.uniforms.get("localOrigin"),new B.Float3PassUniform("ambient",S=>S.ambient),new B.Float3PassUniform("diffuse",S=>S.diffuse),new L.FloatPassUniform("opacity",S=>S.opacity),
new L.FloatPassUniform("layerOpacity",S=>S.layerOpacity)),P.hasColorTexture&&N.uniforms.add(new T.Texture2DPassUniform("tex",S=>S.texture)),R.include(D.PhysicallyBasedRenderingParameters,P),R.include(z.PhysicallyBasedRendering,P),N.include(I.MixExternalColor),R.include(y.Normals,P),t.addAmbientBoostFactor(N),t.addLightingGlobalFactor(N),v.addMainLightIntensity(N),N.code.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${P.multipassEnabled?"terrainDepthTest(depth);":""}
        ${P.hasColorTexture?J.glsl`
                vec4 texColor = texture(tex, ${P.hasColorTextureTransform?J.glsl`colorUV`:J.glsl`vuv0`});
                ${P.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${P.normalType===c.NormalType.ScreenDerivative?J.glsl`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:J.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${P.pbrMode===D.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${P.receiveShadows?"readShadowMap(vpos, linearDepth)":P.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${P.hasVertexColors?J.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${P.hasNormalTexture?J.glsl`
                mat3 tangentSpace = ${P.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${P.hasNormalTextureTransform?J.glsl`normalUV`:"vuv0"});`:J.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${P.spherical?J.glsl`normalize(posWorld);`:J.glsl`vec3(0.0, 0.0, 1.0);`}

        ${P.snowCover?J.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${P.pbrMode===D.PBRMode.Normal||P.pbrMode===D.PBRMode.Schematic?J.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${P.snowCover?J.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:J.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${P.transparencyPassType===Q.TransparencyPassType.Color?J.glsl`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}R.include(x.DefaultMaterialAuxiliaryPasses,P);return R}const Z=Object.freeze(Object.defineProperty({__proto__:null,build:U},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=Z;a.build=U})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(g){g.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,g,d,k,m){a.SymbolColor=function(f,c){c.hasSymbolColors?(f.include(b.DecodeSymbolColor),f.attributes.add(k.VertexAttribute.SYMBOLCOLOR,
"vec4"),f.varyings.add("colorMixMode","mediump float"),f.vertex.code.add(d.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(f.fragment.uniforms.add(new g.IntegerPassUniform("colorMixMode",l=>m.colorMixModes[l.colorMixMode])),f.vertex.code.add(d.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,g){a.DecodeSymbolColor=function(d){d.vertex.code.add(g.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${g.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${g.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${g.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${g.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils"],function(a,b){a.ColorMixModeEnum=void 0;(function(g){g[g.Multiply=1]="Multiply";g[g.Ignore=2]="Ignore";g[g.Replace=3]="Replace";g[g.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(g,d,k){if(null==g||d===a.ColorMixModeEnum.Ignore)k[0]=255,k[1]=255,k[2]=255,k[3]=255;else{var m=b.clamp(Math.round(85*
g[3]),0,85);d=0===m||d===a.ColorMixModeEnum.Tint?0:d===a.ColorMixModeEnum.Replace?85:170;k[0]=b.clamp(Math.round(255*g[0]),0,255);k[1]=b.clamp(Math.round(255*g[1]),0,255);k[2]=b.clamp(Math.round(255*g[2]),0,255);k[3]=m+d}};a.parseColorMixMode=function(g){switch(g){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;default:return a.ColorMixModeEnum.Multiply}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"int",g.BindType.Pass,(f,c,l)=>f.setUniform1i(k,m(c,l)))}}a.IntegerPassUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces",
"../../../lib/VertexAttribute"],function(a,b,g){a.VertexColor=function(d,k){k.hasVertexColors?(d.attributes.add(g.VertexAttribute.COLOR,"vec4"),d.varyings.add("vColor","vec4"),d.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),d.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):d.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){a.DefaultMaterialAuxiliaryPasses=function(t,v){const {vertex:r,fragment:y}=t,z=v.hasColorTexture&&v.alphaDiscardMode!==q.AlphaDiscardMode.Opaque;switch(v.output){case g.ShaderOutput.Depth:case g.ShaderOutput.Shadow:case g.ShaderOutput.ShadowHighlight:case g.ShaderOutput.ShadowExcludeHighlight:case g.ShaderOutput.ObjectAndLayerIdColor:w.addProjViewLocalOrigin(r,v);t.include(k.Transform,v);t.include(c.TextureCoordinateAttribute,v);t.include(h.VisualVariables,
v);t.include(e.OutputDepth,v);t.include(d.SliceDraw,v);t.include(f.ObjectAndLayerIdColor,v);b.addNearFar(t);t.varyings.add("depth","float");z&&y.uniforms.add(new n.Texture2DPassUniform("tex",D=>D.texture));r.code.add(x.glsl`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`);t.include(u.DiscardOrAdjustAlphaPass,v);y.code.add(x.glsl`
          void main(void) {
            discardBySlice(vpos);
            ${z?x.glsl`
                    vec4 texColor = texture(tex, ${v.hasColorTextureTransform?x.glsl`colorUV`:x.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${v.output===g.ShaderOutput.ObjectAndLayerIdColor?x.glsl`outputObjectAndLayerIdColor();`:x.glsl`outputDepth(depth);`}
          }
        `);break;case g.ShaderOutput.Normal:w.addProjViewLocalOrigin(r,v);t.include(k.Transform,v);t.include(m.NormalAttribute,v);t.include(l.VertexNormal,v);t.include(c.TextureCoordinateAttribute,v);t.include(h.VisualVariables,v);z&&y.uniforms.add(new n.Texture2DPassUniform("tex",D=>D.texture));v.normalType===m.NormalType.ScreenDerivative&&t.varyings.add("vPositionView","vec3");r.code.add(x.glsl`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${v.normalType===m.NormalType.Attribute||v.normalType===m.NormalType.Compressed?x.glsl`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:x.glsl`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `);t.include(d.SliceDraw,v);t.include(u.DiscardOrAdjustAlphaPass,v);y.code.add(x.glsl`
          void main() {
            discardBySlice(vpos);
            ${z?x.glsl`
                    vec4 texColor = texture(tex, ${v.hasColorTextureTransform?x.glsl`colorUV`:x.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${v.normalType===m.NormalType.ScreenDerivative?x.glsl`vec3 normal = screenDerivativeNormal(vPositionView);`:x.glsl`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break;case g.ShaderOutput.Highlight:w.addProjViewLocalOrigin(r,v),t.include(k.Transform,v),t.include(c.TextureCoordinateAttribute,v),t.include(h.VisualVariables,v),z&&y.uniforms.add(new n.Texture2DPassUniform("tex",D=>D.texture)),r.code.add(x.glsl`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(d.SliceDraw,v),t.include(u.DiscardOrAdjustAlphaPass,v),t.include(p.OutputHighlight,v),y.code.add(x.glsl`
          void main() {
            discardBySlice(vpos);
            ${z?x.glsl`
                    vec4 texColor = texture(tex, ${v.hasColorTextureTransform?x.glsl`colorUV`:x.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloat16Encoding.glsl","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,g,d,k){a.OutputDepth=function(m,f){switch(f.output){case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:m.fragment.include(g.Rgba4FloatEncoding);
m.fragment.code.add(k.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case b.ShaderOutput.Depth:m.fragment.include(d.RgbaFloatEncoding),m.fragment.code.add(k.glsl`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloat16Encoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Rgba4FloatEncoding=function(g){g.code.add(b.glsl`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,g,d,k,m){function f(c,l,e){const p=c.fragment;l.alphaDiscardMode!==m.AlphaDiscardMode.Mask&&l.alphaDiscardMode!==m.AlphaDiscardMode.MaskBlend||
p.uniforms.add(e);switch(l.alphaDiscardMode){case m.AlphaDiscardMode.Blend:return c.include(b.DiscardOrAdjustAlphaBlend);case m.AlphaDiscardMode.Opaque:p.code.add(k.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case m.AlphaDiscardMode.Mask:p.code.add(k.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case m.AlphaDiscardMode.MaskBlend:c.fragment.code.add(k.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(c,l){f(c,l,new g.FloatDrawUniform("textureAlphaCutoff",e=>e.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(c,l){f(c,l,new d.FloatPassUniform("textureAlphaCutoff",
e=>e.textureAlphaCutoff))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,b,g){a.DiscardOrAdjustAlphaBlend=function(d){d.fragment.code.add(g.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${g.glsl.float(b.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"float",g.BindType.Draw,(f,c,l)=>f.setUniform1f(k,m(c,l)))}}a.FloatDrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l){a.ComputeNormalTexture=function(e,p){const h=e.fragment;p.hasVertexTangents?(e.attributes.add(l.VertexAttribute.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),p.doubleSidedMode===d.NormalsDoubleSidedMode.WindingOrder?h.code.add(k.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):h.code.add(k.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):h.code.add(k.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`);p.textureCoordinateType!==b.TextureCoordinateAttributeType.None&&(e.include(g.VertexTextureCoordinates,p),h.uniforms.add(p.pbrTextureBindType===c.BindType.Pass?new f.Texture2DPassUniform("normalTexture",u=>u.textureNormal):new m.Texture2DDrawUniform("normalTexture",u=>u.textureNormal)),h.code.add(k.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform","../../../effects/ssao/SSAO"],function(a,b,g,d){a.EvaluateAmbientOcclusion=function(k,m){k=k.fragment;m.receiveAmbientOcclusion?(k.uniforms.add(new g.Texture2DPassUniform("ssaoTex",(f,c)=>c.ssao?.colorTexture)),k.constants.add("blurSizePixelsInverse",
"float",1/d.blurSizePixels),k.code.add(b.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):k.code.add(b.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAO":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../core/FBOCache ../RenderPlugin ./SSAOBlurTechnique ./SSAONoiseData ./SSAOParameters ./SSAOTechnique ../../lib/RenderFeature ../../lib/RenderSlot ../../../../../chunks/SSAO.glsl ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){a.SSAO=class extends u.SyncRenderPlugin{constructor(C){super(C);this._context=null;this._passParameters=new n.SSAOPassParameters;this._drawParameters=new n.BlurDrawParameters;this.produces=new Map([[v.RenderSlot.SSAO,()=>this._produces()]])}_produces(){return null!=this._enableTime&&null!=this._context}consumes(){return this._produces()?u.ConsumesDepthNormal:u.ConsumesNone}initializeRenderContext(C){this._context=C;this.addHandles([d.watch(()=>
this.view.qualitySettings.ambientOcclusion||this._context?.isFeatureEnabled(t.RenderFeature.SSAO),E=>E?this._enable():this._disable(),d.syncAndInitial)])}uninitializeRenderContext(){this._disable();this._context=null}_disable(){this._passParameters.noiseTexture=g.disposeMaybe(this._passParameters.noiseTexture);this._enableTime=null}destroy(){this._disable()}_enable(){if(null==this._enableTime&&this._context){var C=Uint8Array.from(atob(x.noiseData),A=>A.charCodeAt(0)),E=new D.TextureDescriptor;E.wrapMode=
y.TextureWrapMode.CLAMP_TO_EDGE;E.pixelFormat=y.PixelFormat.RGB;E.wrapMode=y.TextureWrapMode.REPEAT;E.hasMipmap=!0;E.width=32;E.height=32;this._passParameters.noiseTexture=new z.Texture(this._context.renderContext.rctx,E,C);null==this._ssaoTechnique&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(q.SSAOTechnique));null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(w.SSAOBlurTechnique));this._enableTime=k.Milliseconds(0);this._context?.requestRender()}}renderNode(C,
E,A){E=C.bindParameters;var F=E.linearDepth?.colorTexture,G=A?.normal?.colorTexture;if(null!=this._enableTime&&null!=this._context&&null!=F&&G){if(this._ssaoTechnique.compiled&&this._blurTechnique.compiled){0===this._enableTime&&(this._enableTime=C.time);A=C.rctx;var I=E.camera,H=this.view.qualitySettings.fadeDuration;C=0<H?Math.min(H,C.time-this._enableTime)/H:1;this._passParameters.normalTexture=G;this._passParameters.depthTexture=F;this._passParameters.projScale=1/I.computeScreenPixelSizeAtDist(1);
this._passParameters.intensity=2/r.getRadius(I)**6*C;F=I.fullViewport[2];G=I.fullViewport[3];H=Math.round(F/2);var B=Math.round(G/2),K=this._context.fbos,L=K.acquire(h.ColorFormat.RED,F,G);A.bindFramebuffer(L.fbo);A.setViewport(0,0,F,G);A.bindTechnique(this._ssaoTechnique,this._passParameters,E).bindDraw(this._drawParameters,E,this._passParameters);A.screen.draw();var J=A.bindTechnique(this._blurTechnique,this._passParameters,E);A.setViewport(0,0,H,B);var M=K.acquire(h.ColorFormat.RED,H,B);A.bindFramebuffer(M.fbo);
this._drawParameters.colorTexture=L.colorTexture;p.set(this._drawParameters.blurSize,0,2/G);J.bindDraw(this._drawParameters,E,this._passParameters);A.setViewport(0,0,H,B);A.screen.draw();L.release();K=K.acquire(h.ColorFormat.RED,H,B);A.bindFramebuffer(K.fbo);A.setViewport(0,0,F,G);A.setClearColor(1,1,1,0);A.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);A.setViewport(0,0,H,B);this._drawParameters.colorTexture=M.colorTexture;p.set(this._drawParameters.blurSize,2/F,0);J.bindDraw(this._drawParameters,E,this._passParameters);
A.screen.draw();A.setViewport4fv(I.fullViewport);M.release();1>C&&this._context.requestRender();return K}this._enableTime=C.time;this._context.requestRender()}}};b.__decorate([m.property({constructOnly:!0})],a.SSAO.prototype,"view",void 0);b.__decorate([m.property()],a.SSAO.prototype,"_context",void 0);a.SSAO=b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.ssao.SSAO")],a.SSAO);a.blurSizePixels=2;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/SSAOBlur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c){class l extends d.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,l.shader.get().build(),k.Default3D)}initializePipeline(){return c.makePipelineState({colorWrite:c.defaultColorWriteParams})}}l.shader=new g.ReloadableShaderModule(f.SSAOBlur,()=>new Promise((e,p)=>a(["../../shaders/SSAOBlur.glsl"],e,p)));b.SSAOBlurTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAOBlur.glsl":function(){define("exports ./vec3 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(){const w=new l.ShaderBuilder,x=w.fragment;w.include(g.ScreenSpacePass);x.include(d.ReadLinearDepth);x.uniforms.add(new p.Texture2DPassUniform("depthMap",n=>n.depthTexture),new e.Texture2DDrawUniform("tex",n=>n.colorTexture),new k.Float2DrawUniform("blurSize",n=>n.blurSize),new f.FloatPassUniform("projScale",(n,q)=>{q=b.distance(q.camera.eye,q.camera.center);return 5E4<q?Math.max(0,n.projScale-(q-5E4)):n.projScale}),new m.Float2PassUniform("nearFar",(n,q)=>
q.camera.nearFar));x.code.add(c.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${c.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);w.outputs.add("fragBlur","float");x.code.add(c.glsl`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${c.glsl.int(4)}; r <= ${c.glsl.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `);return w}const u=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));a.SSAOBlur=u;a.build=h})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"vec2",g.BindType.Draw,(f,c,l,e)=>f.setUniform2fv(k,m(c,l,e)))}}a.Float2DrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/effects/ssao/SSAONoiseData":function(){define(["exports"],function(a){a.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOParameters":function(){define(["exports","../../../../../chunks/vec2f64","../../core/shaderModules/interfaces"],function(a,b,g){class d extends g.NoParameters{constructor(){super(...arguments);this.projScale=1}}class k extends d{constructor(){super(...arguments);this.intensity=1}}class m extends g.NoParameters{}class f extends m{constructor(){super(...arguments);this.blurSize=b.create()}}a.BlurDrawParameters=
f;a.BlurPassParameters=d;a.SSAODrawParameters=m;a.SSAOPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/SSAO.glsl ../../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c){class l extends d.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,
l.shader.get().build(),k.Default3D)}initializePipeline(){return c.makePipelineState({colorWrite:c.defaultColorWriteParams})}}l.shader=new g.ReloadableShaderModule(f.SSAO,()=>new Promise((e,p)=>a(["../../shaders/SSAO.glsl"],e,p)));b.SSAOTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define("exports ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(){const x=new e.ShaderBuilder,n=x.fragment;x.include(d.ScreenSpacePass);n.include(k.ReadLinearDepth);x.include(m.CameraSpace);n.uniforms.add(new c.FloatPassUniform("radius",(q,t)=>u(t.camera)));n.code.add(l.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`);n.code.add(l.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);n.uniforms.add(new f.Float2PassUniform("nearFar",(q,t)=>t.camera.nearFar),new p.Texture2DPassUniform("normalMap",q=>q.normalTexture),new p.Texture2DPassUniform("depthMap",q=>q.depthTexture),new c.FloatPassUniform("projScale",q=>q.projScale),new p.Texture2DPassUniform("rnm",q=>q.noiseTexture),new f.Float2PassUniform("rnmScale",(q,t)=>b.set(w,t.camera.fullWidth/q.noiseTexture.descriptor.width,t.camera.fullHeight/q.noiseTexture.descriptor.height)),new c.FloatPassUniform("intensity",q=>q.intensity),
new f.Float2PassUniform("screenSize",(q,t)=>b.set(w,t.camera.fullWidth,t.camera.fullHeight)));x.outputs.add("fragOcclusion","float");n.code.add(l.glsl`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 0.0;
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${l.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${l.glsl.int(16)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `);return x}function u(x){return Math.max(10,20*x.computeScreenPixelSizeAtDist(Math.abs(4*x.relativeElevation)))}const w=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,build:h,getRadius:u},Symbol.toStringTag,{value:"Module"}));a.SSAO=g;a.build=h;a.getRadius=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,g,d,k,m,f,c){function l(u){const w=u.camera.projectionMatrix;return 0===w[11]?d.set(p,2/(u.camera.fullWidth*w[0]),2/(u.camera.fullHeight*w[5]),(1+w[12])/w[0],(1+w[13])/w[5]):d.set(p,-2/(u.camera.fullWidth*w[0]),-2/(u.camera.fullHeight*w[5]),(1-w[8])/w[0],(1-w[9])/w[5])}function e(u){return 0===u.camera.projectionMatrix[11]?b.set(h,0,1):b.set(h,1,0)}const p=k.create(),h=g.create();a.CameraSpace=function(u){u.fragment.uniforms.add(new f.Float4PassUniform("projInfo",(w,x)=>l(x)));u.fragment.uniforms.add(new m.Float2PassUniform("zScale",
(w,x)=>e(x)));u.fragment.code.add(c.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getProjectionInfo=l;a.getZScale=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){function u(x){x.constants.add("ambientBoostFactor","float",h.ambientBoost)}function w(x){x.uniforms.add(new e.FloatPassUniform("lightingGlobalFactor",(n,q)=>q.lighting.globalFactor))}a.EvaluateSceneLighting=function(x,n){const q=x.fragment;x.include(d.EvaluateAmbientOcclusion,n);n.pbrMode!==f.PBRMode.Disabled&&x.include(m.PhysicallyBasedRendering,n);x.include(g.EvaluateAmbientLighting,n);x.include(c.PiUtils);q.code.add(p.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${n.pbrMode===f.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);u(q);w(q);k.addMainLightDirection(q);q.code.add(p.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${n.spherical?p.glsl`normalize(vPosWorld)`:p.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);k.addMainLightIntensity(q);q.code.add(p.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(n.pbrMode){case f.PBRMode.Disabled:case f.PBRMode.WaterOnIntegratedMesh:case f.PBRMode.Water:x.include(k.MainLighting);q.code.add(p.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case f.PBRMode.Normal:case f.PBRMode.Schematic:q.code.add(p.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);q.code.add(p.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);n.useFillLights?q.uniforms.add(new l.BooleanPassUniform("hasFillLights",(t,v)=>v.enableFillLights)):q.constants.add("hasFillLights","bool",!1);q.code.add(p.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);q.uniforms.add(new e.FloatPassUniform("lightingSpecularStrength",(t,v)=>v.lighting.mainLight.specularStrength),new e.FloatPassUniform("lightingEnvironmentStrength",(t,v)=>v.lighting.mainLight.environmentStrength));q.code.add(p.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);q.code.add(p.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${n.pbrMode!==f.PBRMode.Schematic||n.hasColorTexture?p.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:p.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case f.PBRMode.Terrain:case f.PBRMode.TerrainWithWater:x.include(k.MainLighting);q.code.add(p.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:b.neverReached(n.pbrMode);case f.PBRMode.COUNT:}};a.addAmbientBoostFactor=u;a.addLightingGlobalFactor=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,g,d,k){a.PhysicallyBasedRendering=function(m,f){const c=m.fragment.code;
m.include(d.PiUtils);if(f.pbrMode===g.PBRMode.Normal||f.pbrMode===g.PBRMode.Schematic||f.pbrMode===g.PBRMode.Terrain||f.pbrMode===g.PBRMode.TerrainWithWater)c.add(k.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),c.add(k.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`);if(f.pbrMode===g.PBRMode.Normal||f.pbrMode===g.PBRMode.Schematic)m.include(b.AnalyticalSkyModel),c.add(k.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),c.add(k.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),c.add(k.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),c.add(k.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};a.PhysicallyBasedRenderingWater=function(m,f){const c=m.fragment.code;m.include(d.PiUtils);c.add(k.glsl`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${f.useCustomDTRExponentForWater?"2.2":"2.0"};
  `);c.add(k.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`);c.add(k.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`);c.add(k.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`);c.add(k.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(g){g=g.fragment.code;g.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);g.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);g.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ../util/RgbaFloat16Encoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(n){n=n.fragment;n.include(d.Rgba4FloatEncoding);n.uniforms.add(new e.Texture2DPassUniform("shadowMapTex",(q,t)=>t.shadowMap.depthTexture),new m.IntegerPassUniform("numCascades",(q,t)=>t.shadowMap.numCascades),new k.Float4PassUniform("cascadeDistances",(q,t)=>t.shadowMap.cascadeDistances));n.code.add(f.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMapTex, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMapTex);
}`)}class h extends f.NoParameters{constructor(){super(...arguments);this.origin=g.create()}}class u extends h{}class w extends f.NoParameters{constructor(){super(...arguments);this.modelTransformation=b.IDENTITY}}class x extends w{constructor(){super(...arguments);this.origin=g.create()}}a.ReadShadowMapDraw=function(n,q){q.receiveShadows&&(n.fragment.uniforms.add(new c.Matrix4sDrawUniform("shadowMapMatrix",(t,v)=>v.shadowMap.getShadowMapMatrices(t.origin),4)),p(n))};a.ReadShadowMapDrawParameters=
u;a.ReadShadowMapParameters=w;a.ReadShadowMapPass=function(n,q){q.receiveShadows&&(n.fragment.uniforms.add(new l.Matrix4sPassUniform("shadowMapMatrix",(t,v)=>v.shadowMap.getShadowMapMatrices(t.origin),4)),p(n))};a.ReadShadowMapPassParameters=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,
m,f){super(k,"mat4",g.BindType.Draw,(c,l,e,p)=>c.setUniformMatrix4fv(k,m(l,e,p)),f)}}a.Matrix4sDrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m,f){super(k,"mat4",g.BindType.Pass,(c,l,e)=>c.setUniformMatrix4fv(k,m(l,e)),f)}}a.Matrix4sPassUniform=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../chunks/mat3f32","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(a,b,g,d){a.colorTextureUV=function(k){k.vertex.uniforms.add(new d.Matrix3PassUniform("colorTextureTransformMatrix",m=>null!=m.colorTextureTransformMatrix?m.colorTextureTransformMatrix:b.create()));k.varyings.add("colorUV","vec2");k.vertex.code.add(g.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.emissiveTextureUV=function(k){k.vertex.uniforms.add(new d.Matrix3PassUniform("emissiveTextureTransformMatrix",m=>null!=m.emissiveTextureTransformMatrix?m.emissiveTextureTransformMatrix:b.create()));k.varyings.add("emissiveUV","vec2");k.vertex.code.add(g.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.metallicRoughnessTextureUV=function(k){k.vertex.uniforms.add(new d.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",m=>null!=m.metallicRoughnessTextureTransformMatrix?m.metallicRoughnessTextureTransformMatrix:b.create()));k.varyings.add("metallicRoughnessUV","vec2");k.vertex.code.add(g.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.normalTextureUV=function(k){k.vertex.uniforms.add(new d.Matrix3PassUniform("normalTextureTransformMatrix",m=>null!=m.normalTextureTransformMatrix?m.normalTextureTransformMatrix:b.create()));k.varyings.add("normalUV","vec2");k.vertex.code.add(g.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.occlusionTextureUV=function(k){k.vertex.uniforms.add(new d.Matrix3PassUniform("occlusionTextureTransformMatrix",m=>null!=m.occlusionTextureTransformMatrix?m.occlusionTextureTransformMatrix:b.create()));k.varyings.add("occlusionUV","vec2");k.vertex.code.add(g.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function b(){const f=new Float32Array(9);f[0]=1;f[4]=1;f[8]=1;return f}function g(f){const c=new Float32Array(9);c[0]=f[0];c[1]=f[1];c[2]=f[2];c[3]=f[3];c[4]=f[4];c[5]=f[5];c[6]=f[6];c[7]=f[7];c[8]=f[8];return c}function d(f,c,l,e,p,h,u,w,x){const n=new Float32Array(9);n[0]=f;n[1]=c;n[2]=l;n[3]=e;n[4]=p;n[5]=h;n[6]=u;n[7]=w;n[8]=x;return n}function k(f,c){return new Float32Array(f,
c,9)}const m=Object.freeze(Object.defineProperty({__proto__:null,clone:g,create:b,createView:k,fromValues:d},Symbol.toStringTag,{value:"Module"}));a.clone=g;a.create=b;a.createView=k;a.fromValues=d;a.mat3f32=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,g,d){a.MixExternalColor=function(k){k.include(g.ColorConversion);k.code.add(d.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${d.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${d.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${d.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${d.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${d.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){class h extends p.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=g.ShaderOutput.Color;this.alphaDiscardMode=l.AlphaDiscardMode.Opaque;this.doubleSidedMode=m.NormalsDoubleSidedMode.None;this.pbrMode=f.PBRMode.Disabled;this.cullFace=l.CullFaceOptions.None;this.transparencyPassType=e.TransparencyPassType.NONE;this.normalType=d.NormalType.Attribute;this.textureCoordinateType=k.TextureCoordinateAttributeType.None;this.customDepthTest=l.DepthTestFunction.Less;
this.hasSlicePlane=this.hasVerticalOffset=this.hasSymbolColors=this.hasVertexColors=this.spherical=!1;this.hasSliceHighlight=!0;this.doublePrecisionRequiresObfuscation=this.instancedDoublePrecision=this.objectAndLayerIdColorInstanced=this.instancedColor=this.instanced=this.textureAlphaPremultiplied=this.receiveAmbientOcclusion=this.receiveShadows=this.vvColor=this.vvSize=this.offsetBackfaces=this.hasModelTransformation=this.multipassEnabled=this.hasOccludees=this.hasVertexTangents=this.hasScreenSizePerspective=
this.hasNormalTexture=this.hasOcclusionTexture=this.hasEmissionTexture=this.hasMetallicRoughnessTexture=this.hasColorTexture=!1;this.writeDepth=!0;this.transparent=!1;this.enableOffset=!0;this.hasMetallicRoughnessTextureTransform=this.hasOcclusionTextureTransform=this.hasNormalTextureTransform=this.hasEmissionTextureTransform=this.hasColorTextureTransform=this.snowCover=this.cullAboveGround=!1}}b.__decorate([c.parameter({count:g.ShaderOutput.COUNT})],h.prototype,"output",void 0);b.__decorate([c.parameter({count:l.AlphaDiscardMode.COUNT})],
h.prototype,"alphaDiscardMode",void 0);b.__decorate([c.parameter({count:m.NormalsDoubleSidedMode.COUNT})],h.prototype,"doubleSidedMode",void 0);b.__decorate([c.parameter({count:f.PBRMode.COUNT})],h.prototype,"pbrMode",void 0);b.__decorate([c.parameter({count:l.CullFaceOptions.COUNT})],h.prototype,"cullFace",void 0);b.__decorate([c.parameter({count:e.TransparencyPassType.COUNT})],h.prototype,"transparencyPassType",void 0);b.__decorate([c.parameter({count:d.NormalType.COUNT})],h.prototype,"normalType",
void 0);b.__decorate([c.parameter({count:k.TextureCoordinateAttributeType.COUNT})],h.prototype,"textureCoordinateType",void 0);b.__decorate([c.parameter({count:l.DepthTestFunction.COUNT})],h.prototype,"customDepthTest",void 0);b.__decorate([c.parameter()],h.prototype,"spherical",void 0);b.__decorate([c.parameter()],h.prototype,"hasVertexColors",void 0);b.__decorate([c.parameter()],h.prototype,"hasSymbolColors",void 0);b.__decorate([c.parameter()],h.prototype,"hasVerticalOffset",void 0);b.__decorate([c.parameter()],
h.prototype,"hasSlicePlane",void 0);b.__decorate([c.parameter()],h.prototype,"hasSliceHighlight",void 0);b.__decorate([c.parameter()],h.prototype,"hasColorTexture",void 0);b.__decorate([c.parameter()],h.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([c.parameter()],h.prototype,"hasEmissionTexture",void 0);b.__decorate([c.parameter()],h.prototype,"hasOcclusionTexture",void 0);b.__decorate([c.parameter()],h.prototype,"hasNormalTexture",void 0);b.__decorate([c.parameter()],h.prototype,
"hasScreenSizePerspective",void 0);b.__decorate([c.parameter()],h.prototype,"hasVertexTangents",void 0);b.__decorate([c.parameter()],h.prototype,"hasOccludees",void 0);b.__decorate([c.parameter()],h.prototype,"multipassEnabled",void 0);b.__decorate([c.parameter()],h.prototype,"hasModelTransformation",void 0);b.__decorate([c.parameter()],h.prototype,"offsetBackfaces",void 0);b.__decorate([c.parameter()],h.prototype,"vvSize",void 0);b.__decorate([c.parameter()],h.prototype,"vvColor",void 0);b.__decorate([c.parameter()],
h.prototype,"receiveShadows",void 0);b.__decorate([c.parameter()],h.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([c.parameter()],h.prototype,"textureAlphaPremultiplied",void 0);b.__decorate([c.parameter()],h.prototype,"instanced",void 0);b.__decorate([c.parameter()],h.prototype,"instancedColor",void 0);b.__decorate([c.parameter()],h.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([c.parameter()],h.prototype,"instancedDoublePrecision",void 0);b.__decorate([c.parameter()],
h.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([c.parameter()],h.prototype,"writeDepth",void 0);b.__decorate([c.parameter()],h.prototype,"transparent",void 0);b.__decorate([c.parameter()],h.prototype,"enableOffset",void 0);b.__decorate([c.parameter()],h.prototype,"cullAboveGround",void 0);b.__decorate([c.parameter()],h.prototype,"snowCover",void 0);b.__decorate([c.parameter()],h.prototype,"hasColorTextureTransform",void 0);b.__decorate([c.parameter()],h.prototype,"hasEmissionTextureTransform",
void 0);b.__decorate([c.parameter()],h.prototype,"hasNormalTextureTransform",void 0);b.__decorate([c.parameter()],h.prototype,"hasOcclusionTextureTransform",void 0);b.__decorate([c.parameter()],h.prototype,"hasMetallicRoughnessTextureTransform",void 0);b.__decorate([c.parameter({constValue:!1})],h.prototype,"occlusionPass",void 0);b.__decorate([c.parameter({constValue:!0})],h.prototype,"hasVvInstancing",void 0);b.__decorate([c.parameter({constValue:!1})],h.prototype,"useCustomDTRExponentForWater",
void 0);b.__decorate([c.parameter({constValue:!1})],h.prototype,"supportsTextureAtlas",void 0);b.__decorate([c.parameter({constValue:!0})],h.prototype,"useFillLights",void 0);a.DefaultMaterialTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),
function(a,b,g,d,k,m,f){class c extends m.DefaultMaterialTechnique{initializeConfiguration(l,e){super.initializeConfiguration(l,e);e.hasMetallicRoughnessTexture=!1;e.hasEmissionTexture=!1;e.hasOcclusionTexture=!1;e.hasNormalTexture=!1;e.hasModelTransformation=!1;e.normalType=g.NormalType.Attribute;e.doubleSidedMode=d.NormalsDoubleSidedMode.WindingOrder;e.hasVertexTangents=!1}initializeProgram(l){return this._initializeProgram(l,c.shader)}}c.shader=new k.ReloadableShaderModule(f.RealisticTree,()=>
new Promise((l,e)=>a(["./RealisticTree.glsl"],l,e)));b.RealisticTreeTechnique=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J){function M(Q){const O=new B.ShaderBuilder,{vertex:U,fragment:Z,varyings:P}=O;A.addProjViewLocalOrigin(U,Q);O.include(l.PositionAttribute);P.add("vpos","vec3");O.include(z.VisualVariables,Q);O.include(f.InstancedDoublePrecision,Q);O.include(u.VerticalOffset,Q);if(Q.output===d.ShaderOutput.Color||Q.output===d.ShaderOutput.Alpha)A.addCameraPosition(O.vertex,Q),O.include(c.NormalAttribute,Q),O.include(m.Transform,Q),Q.offsetBackfaces&&
O.include(g.Offset),Q.instancedColor&&O.attributes.add(J.VertexAttribute.INSTANCECOLOR,"vec4"),P.add("vNormalWorld","vec3"),P.add("localvpos","vec3"),Q.multipassEnabled&&P.add("depth","float"),O.include(p.TextureCoordinateAttribute,Q),O.include(b.ForwardLinearDepth,Q),O.include(e.SymbolColor,Q),O.include(h.VertexColor,Q),U.uniforms.add(new G.Float4PassUniform("externalColor",R=>R.externalColor)),P.add("vcolorExt","vec4"),U.code.add(H.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${Q.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${H.glsl.float(D.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${Q.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${Q.multipassEnabled?H.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);Q.output===d.ShaderOutput.Alpha&&(O.include(k.SliceDraw,Q),O.include(C.DiscardOrAdjustAlphaPass,Q),O.include(t.multipassTerrainTest,Q),Z.uniforms.add(new I.FloatPassUniform("opacity",R=>R.opacity),new I.FloatPassUniform("layerOpacity",R=>R.layerOpacity)),Q.hasColorTexture&&Z.uniforms.add(new K.Texture2DPassUniform("tex",R=>R.texture)),Z.include(E.MixExternalColor),Z.code.add(H.glsl`
      void main() {
        discardBySlice(vpos);
        ${Q.multipassEnabled?H.glsl`terrainDepthTest(depth);`:""}
        ${Q.hasColorTexture?H.glsl`
                vec4 texColor = texture(tex, ${Q.hasColorTextureTransform?H.glsl`colorUV`:H.glsl`vuv0`});
                ${Q.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:H.glsl`vec4 texColor = vec4(1.0);`}
        ${Q.hasVertexColors?H.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:H.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `));Q.output===d.ShaderOutput.Color&&(O.include(k.SliceDraw,Q),O.include(n.EvaluateSceneLighting,Q),O.include(x.EvaluateAmbientOcclusion,Q),O.include(C.DiscardOrAdjustAlphaPass,Q),O.include(Q.instancedDoublePrecision?y.ReadShadowMapPass:y.ReadShadowMapDraw,Q),O.include(t.multipassTerrainTest,Q),A.addCameraPosition(O.fragment,Q),q.addMainLightDirection(Z),n.addAmbientBoostFactor(Z),n.addLightingGlobalFactor(Z),Z.uniforms.add(U.uniforms.get("localOrigin"),U.uniforms.get("view"),new F.Float3PassUniform("ambient",
R=>R.ambient),new F.Float3PassUniform("diffuse",R=>R.diffuse),new I.FloatPassUniform("opacity",R=>R.opacity),new I.FloatPassUniform("layerOpacity",R=>R.layerOpacity)),Q.hasColorTexture&&Z.uniforms.add(new K.Texture2DPassUniform("tex",R=>R.texture)),O.include(r.PhysicallyBasedRenderingParameters,Q),O.include(v.PhysicallyBasedRendering,Q),Z.include(E.MixExternalColor),q.addMainLightIntensity(Z),Z.code.add(H.glsl`
      void main() {
        discardBySlice(vpos);
        ${Q.multipassEnabled?H.glsl`terrainDepthTest(depth);`:""}
        ${Q.hasColorTexture?H.glsl`
                vec4 texColor = texture(tex, ${Q.hasColorTextureTransform?H.glsl`colorUV`:H.glsl`vuv0`});
                ${Q.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:H.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${Q.pbrMode===r.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${Q.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":Q.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${Q.hasVertexColors?H.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:H.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${Q.snowCover?H.glsl`albedo = mix(albedo, vec3(1), 0.9);`:H.glsl``}
        ${H.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${Q.pbrMode===r.PBRMode.Normal||Q.pbrMode===r.PBRMode.Schematic?Q.spherical?H.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:H.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:H.glsl``}
        ${Q.pbrMode===r.PBRMode.Normal||Q.pbrMode===r.PBRMode.Schematic?H.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${Q.snowCover?H.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:H.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${Q.transparencyPassType===L.TransparencyPassType.Color?H.glsl`fragColor = premultiplyAlpha(fragColor);`:H.glsl``}
      }
    `));O.include(w.DefaultMaterialAuxiliaryPasses,Q);return O}const T=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=T;a.build=M})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.RecreateSymbol=0]="RecreateSymbol";b[b.RecreateGraphics=1]="RecreateGraphics";b[b.FastUpdate=2]="FastUpdate";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,g){class d{constructor(k){this.schedule=k;this._abortController=null;this._loadStatus=a.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(k,m){if(this._loadStatus===a.LoadStatus.LOADED)return k&&k(),this._loader??Promise.resolve();if(this._loadStatus===
a.LoadStatus.FAILED)return m&&m(this._loadError),this._loader??Promise.resolve();null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},f=>{this._loadError=f;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!g.isAbortError(f)&&this.logger&&f.message&&this.logger.warn(f.message);throw f;}));this._loader.then(k,m).catch(()=>{});return this._loader}abortLoad(){null!=
this._abortController?this._abortController=b.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null}}a.LoadStatus=void 0;(function(k){k[k.LOADING=0]="LOADING";k[k.LOADED=1]="LOADED";k[k.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../chunks/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,g,d,k,m,f,c,l){const e=b.create();a.createStageObject=function(p,h,u,w,x){const n=p.clippingExtent;g.projectPointToVector(h,e,p.elevationProvider.spatialReference);if(null!=n&&!d.containsPoint(n,e))return null;g.projectPointToVector(h,e,p.renderCoordsHelper.spatialReference);u.localOrigin=p.localOriginFactory.getOrigin(e);u=new l.Object3D({geometries:[u],castShadow:!1,layerUid:p.layer.uid,graphicUid:x,usesVerticalDistanceToGround:!0});p=f.applyElevationAlignmentForHUD(u,h,p.elevationProvider,
p.renderCoordsHelper,w);return{object:u,sampledElevation:p}};a.extendPointGraphicElevationContext=function(p,h,u){p=p.elevationContext;u=u.spatialReference;g.projectPointToVector(h,e,u);p.centerPointInElevationSR=m.makeDehydratedPoint(e[0],e[1],h.hasZ?e[2]:0,null!=u?u:null)};a.placePointOnGeometry=function(p){switch(p.type){case "point":return p;case "polygon":case "extent":return c.computeCentroid(p);case "polyline":var h=p.paths[0];if(!h||0===h.length)break;h=k.getPointOnPath(h,k.getPathLength(h)/
2);return m.makeDehydratedPoint(h[0],h[1],h[2],p.spatialReference);case "mesh":return p.origin}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){class x extends l.ContentObject{get geometries(){return this._geometries}get transformation(){return this._transformation??g.IDENTITY}set transformation(D){this._transformation=b.copy(this._transformation??g.create(),D);this._invalidateBoundingVolume();this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(D){this._shaderTransformation=D?b.copy(this._shaderTransformation??g.create(),D):null;
this._invalidateBoundingVolume();this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(D={}){super();this.type=e.ContentObjectType.Object;this._parentLayer=this._shaderTransformation=null;this._visible=!0;this.castShadow=D.castShadow??!0;this.usesVerticalDistanceToGround=D.usesVerticalDistanceToGround??!1;this.graphicUid=D.graphicUid;this.layerUid=D.layerUid;D.isElevationSource&&(this.lastValidElevationBB=new n);
this._geometries=D.geometries?Array.from(D.geometries):[]}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(D){h.assert(null==this._parentLayer||null==D,"Object3D can only be added to a single Layer");this._parentLayer=D}addGeometry(D){D.visible=this._visible;this._geometries.push(D);this._emit("geometryAdded",{object:this,geometry:D});this._invalidateBoundingVolume()}removeGeometry(D){if(D=this._geometries.splice(D,1)[0])this._emit("geometryRemoved",{object:this,
geometry:D}),this._invalidateBoundingVolume()}removeAllGeometries(){for(;0<this._geometries.length;)this.removeGeometry(0)}geometryVertexAttributeUpdated(D,C,E=!1){this._emit("attributesChanged",{object:this,geometry:D,attribute:C,sync:E});u.affectsGeometry(C)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(D){if(this._visible!==D){this._visible=D;for(const C of this._geometries)C.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const D=new p.Object3DStateID(c.Object3DState.MaskOccludee);
for(const C of this._geometries)C.occludees=w.addObject3DStateID(C.occludees,D);this._emit("occlusionChanged",this);return D}removeOcclude(D){for(const C of this._geometries)C.occludees=w.removeObject3DStateID(C.occludees,D);this._emit("occlusionChanged",this)}highlight(){const D=new p.Object3DStateID(c.Object3DState.Highlight);for(const C of this._geometries)C.highlights=w.addObject3DStateID(C.highlights,D);this._emit("highlightChanged",this);return D}removeHighlight(D){for(const C of this._geometries)C.highlights=
w.removeObject3DStateID(C.highlights,D);this._emit("highlightChanged",this)}getCombinedStaticTransformation(D,C){return b.multiply(C,this.transformation,D.transformation)}getCombinedShaderTransformation(D,C=g.create()){return b.multiply(C,this.effectiveTransformation,D.transformation)}get boundingVolumeWorldSpace(){this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new q,this._validateBoundingVolume(this._bvWorldSpace,z.WorldSpace));return this._bvWorldSpace}get boundingVolumeObjectSpace(){this._bvObjectSpace||
(this._bvObjectSpace=this._bvObjectSpace||new q,this._validateBoundingVolume(this._bvObjectSpace,z.ObjectSpace));return this._bvObjectSpace}_validateBoundingVolume(D,C){C=C===z.ObjectSpace;for(var E of this._geometries){var A=E.boundingInfo;if(A){var F=D,G=C?E.transformation:this.getCombinedShaderTransformation(E),I=A.bbMin;A=A.bbMax;if(b.hasIdentityRotation(G))for(G=d.set(t,G[12],G[13],G[14]),d.add(v,I,G),d.add(r,A,G),I=0;3>I;++I)F.min[I]=Math.min(F.min[I],v[I]),F.max[I]=Math.max(F.max[I],r[I]);
else if(d.transformMat4(v,I,G),d.exactEquals(I,A))for(I=0;3>I;++I)F.min[I]=Math.min(F.min[I],v[I]),F.max[I]=Math.max(F.max[I],v[I]);else{d.transformMat4(r,A,G);for(var H=0;3>H;++H)F.min[H]=Math.min(F.min[H],v[H],r[H]),F.max[H]=Math.max(F.max[H],v[H],r[H]);for(H=0;3>H;++H){d.copy(v,I);d.copy(r,A);v[H]=A[H];r[H]=I[H];d.transformMat4(v,v,G);d.transformMat4(r,r,G);for(let B=0;3>B;++B)F.min[B]=Math.min(F.min[B],v[B],r[B]),F.max[B]=Math.max(F.max[B],v[B],r[B])}}}}d.lerp(D.bounds,D.min,D.max,.5);for(const B of this._geometries)E=
B.boundingInfo,null!=E&&(I=C?B.transformation:this.getCombinedShaderTransformation(B),F=f.maxScale(I),d.transformMat4(y,E.center,I),I=d.distance(y,D.bounds),D.bounds[3]=Math.max(D.bounds[3],I+E.radius*F))}_invalidateBoundingVolume(){const D=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0;this._parentLayer&&D&&this._parentLayer.notifyObjectBBChanged(this,D)}_emit(D,C){this._parentLayer&&this._parentLayer.events.emit(D,C)}get test(){const D=this;return{hasGeometry:C=>D._geometries.includes(C),
getGeometryIndex:C=>D._geometries.indexOf(C)}}}class n{constructor(){this.min=k.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=k.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class q extends n{constructor(){super(...arguments);this.bounds=m.create()}}const t=k.create(),v=k.create(),r=k.create(),y=k.create();var z;(function(D){D[D.WorldSpace=0]="WorldSpace";D[D.ObjectSpace=
1]="ObjectSpace"})(z||(z={}));a.Object3D=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/vec2f32 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),function(a,b,g,
d,k,m,f,c,l,e,p){class h extends m.Material{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(t){super(t,new w);this._configuration=new p.LineCalloutTechniqueConfiguration;this._uniqueMaterialIdentifier=h.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(t,v){t=v?.slot!==f.RenderSlot.LINE_CALLOUTS;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;
this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.depthHudEnabled=t;this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.multipassEnabled=v.multipassEnabled;return this._configuration}intersect(){}produces(t,v){if(v===d.ShaderOutput.Color)switch(t){case f.RenderSlot.LINE_CALLOUTS:case f.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return new u(t)}createBufferWriter(){return new q}validateParameters(t){t=
h.uniqueMaterialIdentifier(t);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(t){return JSON.stringify({horizontalScreenOffset:t.horizontalScreenOffset??0,centerOffsetUnits:t.centerOffsetUnits||"world"})}}class u extends k{beginSlot(t){return this.ensureTechnique(e.LineCalloutTechnique,t)}}class w extends m.MaterialParameters{constructor(){super(...arguments);this.horizontalScreenOffset=0;this.color=[0,0,0,1];this.size=1;this.occlusionTest=!1;
this.shaderPolygonOffset=1E-5;this.depthHUDAlignStart=!1;this.centerOffsetUnits="world";this.hasSlicePlane=!1}}const x=g.newLayout().vec3f(c.VertexAttribute.POSITION).vec3f(c.VertexAttribute.NORMAL).vec2f(c.VertexAttribute.UV0).vec4f(c.VertexAttribute.AUXPOS1),n=[b.fromValues(0,0),b.fromValues(1,0),b.fromValues(0,1),b.fromValues(1,0),b.fromValues(1,1),b.fromValues(0,1)];class q{constructor(){this.vertexBufferLayout=x}elementCount(t){return 6*t.attributes.get(c.VertexAttribute.POSITION).indices.length}write(t,
v,r,y,z){l.writePosition(r.attributes.get(c.VertexAttribute.POSITION),t,y.position,z,6);l.writeNormal(r.attributes.get(c.VertexAttribute.NORMAL),v,y.normal,z,6);l.writeBufferVec4(r.attributes.get(c.VertexAttribute.AUXPOS1),y.auxpos1,z,6);for(t=0;t<n.length;++t)y.uv0.setVec(z+t,n[t])}}a.LineCalloutMaterial=h;a.Parameters=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function g(x){const n=
new Float32Array(2);n[0]=x[0];n[1]=x[1];return n}function d(x,n){const q=new Float32Array(2);q[0]=x;q[1]=n;return q}function k(x,n){return new Float32Array(x,n,2)}function m(){return b()}function f(){return d(1,1)}function c(){return d(1,0)}function l(){return d(0,1)}const e=b(),p=f(),h=c(),u=l(),w=Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_X:h,UNIT_Y:u,ZEROS:e,clone:g,create:b,createView:k,fromValues:d,ones:f,unitX:c,unitY:l,zeros:m},Symbol.toStringTag,{value:"Module"}));a.ONES=
p;a.UNIT_X=h;a.UNIT_Y=u;a.ZEROS=e;a.clone=g;a.create=b;a.createView=k;a.fromValues=d;a.ones=f;a.unitX=c;a.unitY=l;a.vec2f32=w;a.zeros=m})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,
b,g,d,k,m,f,c,l,e){class p extends k.ShaderTechnique{initializeConfiguration(h,u){u.spherical=h.viewingMode===g.ViewingMode.Global}initializeProgram(h){return new f.Program(h.rctx,p.shader.get().build(this.configuration),m.Default3D)}setPipelineState(h){h=h?l.CompareFunction.ALWAYS:l.CompareFunction.LESS;return this.configuration.depthHudEnabled?e.makePipelineState({depthTest:{func:h},depthWrite:e.defaultDepthWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(l.BlendFactor.ONE,l.BlendFactor.SRC_ALPHA,
l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:h},colorWrite:e.defaultColorWriteParams})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}}p.shader=new d.ReloadableShaderModule(c.LineCallout,()=>new Promise((h,u)=>a(["./LineCallout.glsl"],h,u)));b.LineCalloutTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineCallout.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n){function q(r){const y=new x.ShaderBuilder,{vertex:z,fragment:D}=y;z.include(m.AlignPixel);y.include(f.HUD,r);y.include(k.SliceDraw,r);y.attributes.add(n.VertexAttribute.UV0,"vec2");z.uniforms.add(new h.Float4PassUniform("viewport",(C,E)=>E.camera.fullViewport),new u.FloatPassUniform("lineSize",(C,E)=>0<C.size?Math.max(1,C.size)*E.camera.pixelRatio:0),new p.Float2PassUniform("pixelToNDC",(C,E)=>b.set(v,2/E.camera.fullViewport[2],2/E.camera.fullViewport[3])),
new u.FloatPassUniform("borderSize",(C,E)=>null!=C.borderColor?E.camera.pixelRatio:0),new p.Float2PassUniform("screenOffset",(C,E)=>b.set(v,C.horizontalScreenOffset*E.camera.pixelRatio,0)));y.varyings.add("coverageSampling","vec4");y.varyings.add("lineSizes","vec2");r.multipassEnabled&&y.varyings.add("depth","float");r.occlusionTestEnabled&&y.include(c.HUDVisibility);r.hasScreenSizePerspective&&e.addScreenSizePerspectiveAlignment(z);z.code.add(w.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${r.occlusionTestEnabled?w.glsl`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${r.hasScreenSizePerspective?w.glsl`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:w.glsl`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${r.multipassEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${r.depthHudEnabled?r.depthHudAlignStartEnabled?w.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:w.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${r.hasScreenSizePerspective?w.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:w.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);D.uniforms.add(new h.Float4PassUniform("uColor",C=>t(C.color)),new h.Float4PassUniform("borderColor",C=>t(C.borderColor)));r.multipassEnabled&&(D.include(l.multipassGeometryTest,r),D.uniforms.add(new p.Float2PassUniform("inverseViewport",(C,E)=>E.inverseViewport)));D.code.add(w.glsl`
    void main() {
      ${r.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${r.depthHudEnabled?w.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:w.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return y}function t(r){return null!=r?r:d.ZEROS}const v=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.LineCallout=g;a.build=q})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,g,d){class k extends d.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.spherical=this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.multipassEnabled=this.hasSlicePlane=this.depthHudAlignStartEnabled=this.depthHudEnabled=this.hasScreenSizePerspective=this.hasVerticalOffset=!1}}b.__decorate([g.parameter()],k.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([g.parameter()],k.prototype,"spherical",void 0);b.__decorate([g.parameter()],k.prototype,"occlusionTestEnabled",void 0);b.__decorate([g.parameter()],k.prototype,"hasVerticalOffset",
void 0);b.__decorate([g.parameter()],k.prototype,"hasScreenSizePerspective",void 0);b.__decorate([g.parameter()],k.prototype,"depthHudEnabled",void 0);b.__decorate([g.parameter()],k.prototype,"depthHudAlignStartEnabled",void 0);b.__decorate([g.parameter()],k.prototype,"hasSlicePlane",void 0);b.__decorate([g.parameter()],k.prototype,"multipassEnabled",void 0);b.__decorate([g.parameter({constValue:!0})],k.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([g.parameter({constValue:!1})],k.prototype,
"draped",void 0);a.LineCalloutTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,g){a.getGraphics3DSymbol=function(d){return d instanceof g.Graphics3DWebStyleSymbol?d.graphics3DSymbol:d instanceof b.Graphics3DSymbol?d:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/promiseUtils ./defaultSymbolComplexity ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCreationContext ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){class h extends p.Loadable{set symbol(w){this._symbol=w;w.symbolLayers.forEach((x,n)=>{n=this.symbolLayers[n];null!=n&&(n.symbol=w,n.symbolLayer=x)})}get symbol(){return this._symbol}constructor(w,x,n){super(x.schedule);this._symbol=w;this._context=x;this._backgroundLayers=n;this._destroyed=!1;this.symbolLayers=[];this._extentPadding=this.referenced=0}async doLoad(w){let x=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(x=this._backgroundLayers.concat(x));
const n=x.length;for(;this.symbolLayers.length<x.length;)this.symbolLayers.push(null);this.symbolLayers.length=x.length;const q=[];for(let v=0;v<n;v++){var t=x.at(v);if(!1===t.enabled)continue;u.renderPriority=1-(1+v)/n;u.renderPriorityStep=1/n;u.ignoreDrivers=t.ignoreDrivers;const r=l.make(this.symbol,t,this._context,u);(t=d.onAbortOrThrow(w,()=>{this.symbolLayers[v]=null;r.destroy()}))&&q.push(t);this.symbolLayers[v]=r}await g.forEach(this.symbolLayers,async(v,r)=>{if(null!=v)try{await v.load(),
this._extentPadding+=Math.max(this._extentPadding,v.extentPadding)}catch{this.symbolLayers[r]=null}});q.forEach(v=>v.remove());d.throwIfAborted(w);if(this.symbolLayers.length&&!this.symbolLayers.some(v=>!!v))throw Error();}getSymbolLayerSize(w){w=this.symbolLayers[w];return null!=w?w.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(w=>w?.queryForSnapping)}createGraphics3DGraphic(w,x){const n=w.graphic,q=this.symbolLayers.map(t=>
t?.createGraphics3DGraphic(w)??null);return new m.Graphics3DGraphic(n,x||this,q,w.layer,this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null)}get complexity(){return k.totalSymbolComplexities(this.symbolLayers.map(w=>null!=w?w.complexity:null))}globalPropertyChanged(w,x){const n=this.symbolLayers.length;for(let q=0;q<n;q++){const t=this.symbolLayers[q],v=r=>{r=r.layers[q];return r instanceof f.Graphics3DObject3DGraphicLayer?r:null};if(null!=t&&!t.globalPropertyChanged(w,
x,v))return!1}return!0}applyRendererDiff(w,x){return this.loadStatus!==p.LoadStatus.LOADED?e.ApplyRendererDiffResult.RecreateSymbol:this.symbolLayers.reduce((n,q)=>n!==e.ApplyRendererDiffResult.RecreateSymbol&&null!=q?Math.min(n,q.applyRendererDiff(w,x)):n,e.ApplyRendererDiffResult.FastUpdate)}prepareSymbolPatch(w){if(this.loadStatus!==p.LoadStatus.FAILED&&"partial"===w.diff.type){var x=w.diff.diff;if(x.symbolLayers&&"partial"===x.symbolLayers.type){var n=x.symbolLayers.diff;this.symbolLayers.forEach((q,
t)=>{if(null!=q){var v=n[t];if(v){const r={diff:v,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};q.prepareSymbolLayerPatch(r);w.symbolStatePatches.push(...r.symbolLayerStatePatches);r.graphics3DGraphicPatches.length&&w.graphics3DGraphicPatches.push((y,z)=>{const D=y.layers[t];null!=D&&r.graphics3DGraphicPatches.forEach(C=>C(D,z))})}}})}}}updateGeometry(w,x){return this._updateGeometryOrTransform(w,(n,q)=>n.updateGeometry(q,x))}updateTransform(w,x,n,q){return this._updateGeometryOrTransform(w,
(t,v)=>t.updateTransform(v,x,n,q))}_updateGeometryOrTransform(w,x){for(let n=0;n<this.symbolLayers.length;n++){const q=this.symbolLayers[n];if(null==q)continue;const t=w.layers[n];if(!t||!x(q,t))return!1}return!0}onRemoveGraphic(w){for(let x=0;x<this.symbolLayers.length;x++){const n=this.symbolLayers[x];if(null==n)continue;const q=w.layers[x];if(null!=q)n.onRemoveGraphic(q)}}getFastUpdateStatus(){let w=0,x=0,n=0;this.symbolLayers.forEach(q=>{null!=q&&(q.loadStatus===p.LoadStatus.LOADING?w++:q.isFastUpdatesEnabled()?
n++:x++)});return{loading:w,slow:x,fast:n}}async queryForSnapping(w,x,n,q){var t=this.symbolLayers.filter(b.isSome).filter(v=>null!=v.queryForSnapping).map(v=>v.queryForSnapping(w,x,n,q));t=await Promise.all(t);d.throwIfAborted(q);return t.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const w of this.symbolLayers)null!=w&&w.destroy();this.symbolLayers.length=0;this._destroyed=!0}}get destroyed(){return this._destroyed}}
const u=new c.Graphics3DSymbolLayerCreationContext;a.Graphics3DSymbol=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){const v=new k(Array,z=>h.set(z,h.zero),null,10,5),r=u.create();class y{get labelLayers(){return this._labelLayers||b.EmptyArray}get extent(){return this._extent}get isElevationSource(){return this.layers.some(z=>z?.isElevationSource)}constructor(z,D,C,E,A){this.graphic=z;this.graphics3DSymbol=D;this.layers=C;this._visibleFlags=q.VisibilityFlag.ALL_LABEL;this.deconflictionPriority=0;++D.referenced;this._featureExpressionFeature=A?t.createFeature(A,z,E):
null}initialize(z){this._layer=z;this._forEachSymbolLayerGraphic(D=>{D.initialize(z);D.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(z=>z.destroy());this._calloutLayer=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic(z=>z.destroy());this._labelLayers=null}addLabelGraphic(z,D){this._labelLayers||(this._labelLayers=[]);this._labelLayers.push(z);z.initialize(D);z.setVisibility(this.isVisible(q.VisibilityGroup.LABEL))}setCalloutGraphic(z){this._calloutLayer=
z;this._layer&&(z.initialize(this._layer),z.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let z=!1;this._forEachSymbolLayerGraphic(D=>{"draped"===D.type&&(z=!0)});return z}isVisible(z=q.VisibilityGroup.GRAPHIC,D){D=D?this._visibleFlags|D|q.VisibilityGroup.LABEL*D:this._visibleFlags;return z===q.VisibilityGroup.GRAPHIC?(D&q.VisibilityFlag.ALL_GRAPHIC)===q.VisibilityFlag.ALL_GRAPHIC:(D&q.VisibilityFlag.ALL_LABEL)===q.VisibilityFlag.ALL_LABEL}setVisibilityFlag(z,
D,C){const E=this.isVisible(z);this._visibleFlags=C?this._visibleFlags|z*D:this._visibleFlags&~(z*D);const A=this.isVisible(z);if(E===A)return!1;if(z===q.VisibilityGroup.LABEL)this._forEachLabelGraphic(F=>F.setVisibility(A));else{this._forEachSymbolLayerGraphic(G=>G.setVisibility(A));const F=this.isVisible(q.VisibilityGroup.LABEL);this._forEachLabelGraphic(G=>G.setVisibility(F))}return!0}getVisibilityFlag(z,D){return 0!==(this._visibleFlags&z*D)}computeExtent(z){if(!this._extent){var D=this.graphic.geometry;
if(null==D)return!1;this._extent=u.create();x.computeAABR(D,this._extent);D=D.spatialReference;if(!w.equals(D,z)&&!p.projectBoundingRect(this._extent,D,this._extent,z))return this._extent=null,!1}return!0}getAsOptimizedGeometry(z,D){this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,z,D));return this._optimizedGeometry}_convertGraphicToOptimizedGeometry(z,D,C){z=z.geometry;if("mesh"===z.type||"extent"===z.type)z=e.fromExtent("mesh"===z.type?z.extent:
z);return n.convertFromGeometry(z,D,C)}get usedMemory(){let z=d.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(D=>z+=D.graphics3DSymbolLayer.usedMemory);return z}computeAttachmentOrigin(){const z={render:{origin:l.create(),num:0},draped:{origin:f.create(),num:0}};for(const D of this.layers)null!=D&&D.computeAttachmentOrigin(z);1<z.render.num&&c.scale(z.render.origin,z.render.origin,1/z.render.num);1<z.draped.num&&m.scale(z.draped.origin,z.draped.origin,1/z.draped.num);
return z}async getProjectedBoundingBox(z,D,C,E,A){A||(A={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});A.boundingBox?h.empty(A.boundingBox):A.boundingBox=h.empty();A.requiresDrapedElevation=!1;await g.forEach(this.layers,async F=>{if(null!=F){var G="draped"===F.type?D:z,I=v.acquire();F=await F.getProjectedBoundingBox(G,C,A.screenSpaceObjects,E,I);isFinite(F[2])&&isFinite(F[5])||(A.requiresDrapedElevation=!0);F&&h.expandWithAABB(A.boundingBox,I);v.release(I)}});return h.allFinite(A.boundingBox)||
u.allFinite(h.toRect(A.boundingBox,r))?A:null}needsElevationUpdates(){for(const z of this.layers)if(null!=z&&("object3d"===z.type||"lod-instance"===z.type)&&z.needsElevationUpdates)return!0;return this._labelLayers?.some(z=>z?.needsElevationUpdates??!1)??!1}alignWithElevation(z,D,C){this._forEachRenderedGraphic(E=>{"object3d"!==E.type&&"lod-instance"!==E.type||E.alignWithElevation(z,D,this._featureExpressionFeature,C)})}alignWithAbsoluteElevation(z,D,C){this._forEachRenderedGraphic(E=>{"object3d"===
E.type&&E.alignWithAbsoluteElevation(z,D,C)})}addObjectStateSet(z,D){this._forEachSymbolLayerGraphic(C=>C.addObjectState(z,D))}removeObjectState(z){this._forEachSymbolLayerGraphic(D=>D.removeObjectState(z))}_forEachGraphicList(z,D){z?.forEach(C=>C&&D(C))}_forEachSymbolLayerGraphic(z){this._forEachGraphicList(this.layers,z);this._calloutLayer&&z(this._calloutLayer)}_forEachLabelGraphic(z){this._forEachGraphicList(this._labelLayers,z)}_forEachRenderedGraphic(z){this._forEachSymbolLayerGraphic(z);this._forEachLabelGraphic(z)}get test(){const z=
this;return{addLabelLayer:D=>{z._labelLayers||(z._labelLayers=[]);z._labelLayers.push(D)}}}}a.Graphics3DGraphic=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){function u(q,t,v){if(null==q)return null;switch(t){case "point":return{x:q.x,y:q.y,z:q.z,m:q.m,hasZ:null!=q.z,hasM:null!=q.m,type:"point",spatialReference:v};case "polyline":return{paths:q.paths,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"polyline",spatialReference:v};case "polygon":return{rings:q.rings,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"polygon",spatialReference:v};case "multipoint":return{points:q.points,hasZ:!!q.hasZ,hasM:!!q.hasM,type:"multipoint",spatialReference:v}}}function w(q){if(null==
q)return 0;let t=32;switch(q.type){case "point":t+=42;break;case "polyline":case "polygon":var v=0;const r=2+(q.hasZ?1:0)+(q.hasM?1:0);q="polyline"===q.type?q.paths:q.rings;for(const y of q)v+=y.length;t+=8*v*r+64;t+=128*v;t=t+34+32*(q.length+1);break;case "multipoint":v=q.points.length;t+=8*v*(2+(q.hasZ?1:0)+(q.hasM?1:0))+64;t+=128*v;t=t+34+32;break;case "extent":t+=98;q.hasM&&(t+=32);q.hasZ&&(t+=32);break;case "mesh":t+=d.estimateSize(q.vertexAttributes.position,q.vertexAttributes.normal,q.vertexAttributes.uv,
q.vertexAttributes.tangent)}return t}class x{constructor(q,t,v){this.uid=q;this.geometry=t;this.attributes=v;this.visible=!0;this.centroid=this.objectId=null}}class n{constructor(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null}}a.equals=h.equals;a.DehydratedFeatureClass=x;a.DehydratedFeatureSetClass=n;a.computeAABB=
function(q,t){f.empty(t);"mesh"===q.type&&(q=q.extent);switch(q.type){case "point":t[0]=t[3]=q.x;t[1]=t[4]=q.y;q.hasZ&&(t[2]=t[5]=q.z);break;case "polyline":for(var v=0;v<q.paths.length;v++)f.expandWithNestedArray(t,q.paths[v],!!q.hasZ);break;case "polygon":for(v=0;v<q.rings.length;v++)f.expandWithNestedArray(t,q.rings[v],!!q.hasZ);break;case "multipoint":f.expandWithNestedArray(t,q.points,!!q.hasZ);break;case "extent":t[0]=q.xmin,t[1]=q.ymin,t[3]=q.xmax,t[4]=q.ymax,null!=q.zmin&&(t[2]=q.zmin),null!=
q.zmax&&(t[5]=q.zmax)}};a.computeAABR=function(q,t){c.empty(t);"mesh"===q.type&&(q=q.extent);switch(q.type){case "point":t[0]=t[2]=q.x;t[1]=t[3]=q.y;break;case "polyline":for(var v=0;v<q.paths.length;v++)c.expandWithNestedArray(t,q.paths[v]);break;case "polygon":for(v=0;v<q.rings.length;v++)c.expandWithNestedArray(t,q.rings[v]);break;case "multipoint":c.expandWithNestedArray(t,q.points);break;case "extent":t[0]=q.xmin,t[1]=q.ymin,t[2]=q.xmax,t[3]=q.ymax}};a.estimateGeometryObjectSize=w;a.estimateSize=
function(q){let t;t=32+b.estimateAttributesObjectSize(q.attributes);return t=t+3+(8+w(q.geometry))};a.fromFeatureSetJSON=function(q){const t=e.featureGeometryTypeKebabDictionary.fromJSON(q.geometryType),v=m.fromJSON(q.spatialReference),r=q.transform,y=q.features.map(z=>{var D=q.objectIdFieldName;z={uid:k.generateUID(),objectId:D&&z.attributes?z.attributes[D]:null,attributes:z.attributes,geometry:u(z.geometry,t,v),visible:!0};D=z.geometry;if(null!=D&&r)switch(D.type){case "point":z.geometry=l.unquantizePoint(r,
D,D,D.hasZ,D.hasM);break;case "multipoint":z.geometry=l.unquantizeMultipoint(r,D,D,!!D.hasZ,!!D.hasM);break;case "polygon":z.geometry=l.unquantizePolygon(r,D,D,!!D.hasZ,!!D.hasM);break;case "polyline":z.geometry=l.unquantizePolyline(r,D,D,!!D.hasZ,!!D.hasM);break;case "extent":z.geometry=D;break;case "mesh":z.geometry=D}return z});return{geometryType:t,features:y,spatialReference:v,fields:q.fields?.map(z=>p.fromJSON(z))??[],objectIdFieldName:q.objectIdFieldName,globalIdFieldName:q.globalIdFieldName,
geohashFieldName:q.geohashFieldName,geometryProperties:q.geometryProperties,hasZ:q.hasZ,hasM:q.hasM,exceededTransferLimit:q.exceededTransferLimit,transform:null}};a.fromJSONGeometry=u;a.getObjectId=function(q,t){return null!=q.objectId?q.objectId:q.attributes&&t?q.attributes[t]:null};a.hasGeometry=function(q){return null!=q.geometry};a.hasVertices=function(q){if(null==q)return!1;switch(q.type){case "extent":case "point":return!0;case "polyline":for(const t of q.paths)if(0<t.length)return!0;return!1;
case "polygon":for(const t of q.rings)if(0<t.length)return!0;return!1;case "multipoint":return 0<q.points.length;case "mesh":return!q.loaded||0<q.vertexAttributes.position.length}};a.numVertices=function(q){if(null==q)return 0;switch(q.type){case "point":return 1;case "polyline":var t=0;for(var v of q.paths)t+=v.length;return t;case "polygon":v=0;for(t of q.rings)v+=t.length;return v;case "multipoint":return q.points.length;case "extent":return 2;case "mesh":return(q=q.vertexAttributes&&q.vertexAttributes.position)?
q.length/3:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(a,b){function g({scale:A,translate:F},G){return Math.round((G-F[0])/A[0])}function d({scale:A,translate:F},G){return Math.round((F[1]-G)/A[1])}function k(A,F,G){const I=[];let H,B,K,L;for(let J=0;J<G.length;J++){const M=G[J];if(0<J){if(K=g(A,M[0]),L=d(A,M[1]),K!==H||L!==B)I.push(F(M,K-H,L-B)),H=K,B=L}else H=g(A,M[0]),B=d(A,M[1]),
I.push(F(M,H,B))}return 0<I.length?I:null}function m(A,F,G,I){return k(A,G?I?E:C:I?C:D,F)}function f(A,F,G,I){const H=[];G=G?I?E:C:I?C:D;for(I=0;I<F.length;I++){const B=k(A,G,F[I]);B&&3<=B.length&&H.push(B)}return H.length?H:null}function c(A,F,G,I){const H=[];G=G?I?E:C:I?C:D;for(I=0;I<F.length;I++){const B=k(A,G,F[I]);B&&2<=B.length&&H.push(B)}return H.length?H:null}function l({scale:A,translate:F},G){return G*A[0]+F[0]}function e({scale:A,translate:F},G){return F[1]-G*A[1]}function p(A,F,G){const I=
Array(G.length);if(!G.length)return I;const [H,B]=A.scale;let K=l(A,G[0][0]);A=e(A,G[0][1]);I[0]=F(G[0],K,A);for(let L=1;L<G.length;L++){const J=G[L];K+=J[0]*H;A-=J[1]*B;I[L]=F(J,K,A)}return I}function h(A,F,G){const I=Array(G.length);for(let H=0;H<G.length;H++)I[H]=p(A,F,G[H]);return I}function u(A,F,G,I){return p(A,G?I?E:C:I?C:D,F)}function w(A,F,G,I){return h(A,G?I?E:C:I?C:D,F)}function x(A,F,G,I){return h(A,G?I?E:C:I?C:D,F)}function n(A,F,G){let [I,H]=G[0],B=Math.min(I,F[0]),K=Math.min(H,F[1]),
L=Math.max(I,F[2]);F=Math.max(H,F[3]);for(let J=1;J<G.length;J++){const [M,T]=G[J];I+=M;H+=T;0>M&&(B=Math.min(B,I));0<M&&(L=Math.max(L,I));0>T?K=Math.min(K,H):0<T&&(F=Math.max(F,H))}A[0]=B;A[1]=K;A[2]=L;A[3]=F;return A}function q(A,F){if(!F.length)return null;A[0]=A[1]=Number.POSITIVE_INFINITY;A[2]=A[3]=Number.NEGATIVE_INFINITY;for(let G=0;G<F.length;G++)n(A,A,F[G]);return A}function t(A,F,G,I,H){F.xmin=g(A,G.xmin);F.ymin=d(A,G.ymin);F.xmax=g(A,G.xmax);F.ymax=d(A,G.ymax);F!==G&&(I&&(F.zmin=G.zmin,
F.zmax=G.zmax),H&&(F.mmin=G.mmin,F.mmax=G.mmax));return F}function v(A,F,G,I,H){F.points=m(A,G.points,I,H)??[];return F}function r(A,F,G,I,H){F.x=g(A,G.x);F.y=d(A,G.y);F!==G&&(I&&(F.z=G.z),H&&(F.m=G.m));return F}function y(A,F,G,I,H){A=f(A,G.rings,I,H);if(!A)return null;F.rings=A;return F}function z(A,F,G,I,H){A=c(A,G.paths,I,H);if(!A)return null;F.paths=A;return F}const D=(A,F,G)=>[F,G],C=(A,F,G)=>[F,G,A[2]],E=(A,F,G)=>[F,G,A[2],A[3]];a.equals=function(A,F){if(A===F||null==A&&null==F)return!0;if(null==
A||null==F)return!1;let G,I,H,B;A&&"upperLeft"===A.originPosition?(G=A.translate[0],I=A.translate[1],A=A.scale[0]):(G=null!=A.extent?A.extent.xmin:0,I=null!=A.extent?A.extent.ymax:0,A=A.tolerance);F&&"upperLeft"===F.originPosition?(H=F.translate[0],B=F.translate[1],F=F.scale[0]):(H=null!=F.extent?F.extent.xmin:0,B=null!=F.extent?F.extent.ymax:0,F=F.tolerance);return G===H&&I===B&&A===F};a.getQuantizedBoundsCoordsArray=n;a.getQuantizedBoundsCoordsArrayArray=q;a.getQuantizedBoundsPaths=function(A){return q([0,
0,0,0],A)};a.getQuantizedBoundsPoints=function(A){const F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return n(F,F,A)};a.getQuantizedBoundsRings=function(A){return q([0,0,0,0],A)};a.quantizeBounds=function(A,F,G){F[0]=g(A,G[0]);F[3]=d(A,G[1]);F[2]=g(A,G[2]);F[1]=d(A,G[3]);return F};a.quantizeExtent=t;a.quantizeGeometry=function(A,F){return A&&F?b.isPoint(F)?r(A,{},F,!1,!1):b.isPolyline(F)?z(A,{},F,!1,!1):b.isPolygon(F)?y(A,{},F,!1,!1):b.isMultipoint(F)?
v(A,{},F,!1,!1):b.isExtent(F)?t(A,{},F,!1,!1):null:null};a.quantizeMultipoint=v;a.quantizePaths=c;a.quantizePoint=r;a.quantizePoints=m;a.quantizePolygon=y;a.quantizePolyline=z;a.quantizeRings=f;a.quantizeX=g;a.quantizeY=d;a.toQuantizationTransform=function(A){return A?{originPosition:"upper-left"===A.originPosition?"upperLeft":"lower-left"===A.originPosition?"lowerLeft":A.originPosition,scale:A.tolerance?[A.tolerance,A.tolerance]:[1,1],translate:null!=A.extent?[A.extent.xmin,A.extent.ymax]:[0,0]}:
null};a.unquantizeBounds=function(A,F,G){return G?(F[0]=l(A,G[0]),F[1]=e(A,G[3]),F[2]=l(A,G[2]),F[3]=e(A,G[1]),F):[l(A,F[0]),e(A,F[3]),l(A,F[2]),e(A,F[1])]};a.unquantizeCoordsArray=p;a.unquantizeCoordsArrayArray=h;a.unquantizeExtent=function(A,F,G,I,H){F.xmin=l(A,G.xmin);F.ymin=e(A,G.ymin);F.xmax=l(A,G.xmax);F.ymax=e(A,G.ymax);F!==G&&(I&&(F.zmin=G.zmin,F.zmax=G.zmax),H&&(F.mmin=G.mmin,F.mmax=G.mmax));return F};a.unquantizeMultipoint=function(A,F,G,I,H){null!=G&&(F.points=u(A,G.points,I,H));return F};
a.unquantizePaths=w;a.unquantizePoint=function(A,F,G,I,H){if(null==G)return F;F.x=l(A,G.x);F.y=e(A,G.y);F!==G&&(I&&(F.z=G.z),H&&(F.m=G.m));return F};a.unquantizePoints=u;a.unquantizePolygon=function(A,F,G,I,H){null!=G&&(F.rings=x(A,G.rings,I,H));return F};a.unquantizePolyline=function(A,F,G,I,H){null!=G&&(F.paths=w(A,G.paths,I,H));return F};a.unquantizeRings=x;a.unquantizeX=l;a.unquantizeY=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports",
"../../core/has","../../geometry/support/spatialReferenceUtils"],function(a,b,g){function d(l,e){if(l===e)return!0;if(null==l||null==e||l.length!==e.length)return!1;for(let p=0;p<l.length;p++){const h=l[p],u=e[p];if(h.length!==u.length)return!1;for(let w=0;w<h.length;w++)if(h[w]!==u[w])return!1}return!0}function k(l,e){if(l===e)return!0;if(null==l||null==e||l.length!==e.length)return!1;for(let p=0;p<l.length;p++)if(!d(l[p],e[p]))return!1;return!0}function m(l,e){return l===e||null!=l&&null!=e&&g.equals(l.spatialReference,
e.spatialReference)&&l.x===e.x&&l.y===e.y&&l.z===e.z&&l.m===e.m}function f(l,e){if(l===e)return!0;if(null==l||null==e||l.type!==e.type)return!1;switch(l.type){case "point":return m(l,e);case "extent":return l=l.hasZ!==e.hasZ||l.hasM!==e.hasM?!1:g.equals(l.spatialReference,e.spatialReference)?l.xmin===e.xmin&&l.ymin===e.ymin&&l.zmin===e.zmin&&l.xmax===e.xmax&&l.ymax===e.ymax&&l.zmax===e.zmax:!1,l;case "polyline":return l=l.hasZ!==e.hasZ||l.hasM!==e.hasM?!1:g.equals(l.spatialReference,e.spatialReference)?
k(l.paths,e.paths):!1,l;case "polygon":return l=l.hasZ!==e.hasZ||l.hasM!==e.hasM?!1:g.equals(l.spatialReference,e.spatialReference)?k(l.rings,e.rings):!1,l;case "multipoint":return l=l.hasZ!==e.hasZ||l.hasM!==e.hasM?!1:g.equals(l.spatialReference,e.spatialReference)?d(l.points,e.points):!1,l;case "mesh":return!1}}function c(l,e){if(l===e)return!0;if(!l||!e)return!1;const p=Object.keys(l),h=Object.keys(e);if(p.length!==h.length)return!1;for(const u of p)if(l[u]!==e[u])return!1;return!0}a.equals=function(l,
e){return l===e?!0:null!=l&&null!=e&&l.objectId===e.objectId&&f(l.geometry,e.geometry)&&c(l.attributes,e.attributes)?!0:!1};a.pointEquals=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],function(a){class b{constructor(d,k){this.scheduler=d;this.schedule=k;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=
this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1}}class g{constructor(){this.renderPriority=0;this.renderPriorityStep=1;this.ignoreDrivers=!1}}a.Graphics3DSymbolCreationContext=b;a.Graphics3DSymbolLayerCreationContext=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){const h={icon:d.Graphics3DIconSymbolLayer,object:f.Graphics3DObjectSymbolLayer,line:k.Graphics3DLineSymbolLayer,path:c.Graphics3DPathSymbolLayer,fill:l.Graphics3DPolygonFillSymbolLayer,extrude:g.Graphics3DExtrudeSymbolLayer,text:e.Graphics3DTextSymbolLayer,water:p.Graphics3DWaterSymbolLayer},u={"mesh-3d":{fill:m.Graphics3DMeshFillSymbolLayer}};a.make=function(w,x,n,q){const t=u[w.type]?.[x.type]||h[x.type];return t?new t(w,x,n,q):(b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",
`unknown symbol type ${x.type}`),null)};a.setSymbolClass=function(w,x){h[w]=x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/lang ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/Indices ../../../../chunks/vec32 ../../../../layers/graphics/data/SnappingCandidate ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../support/renderInfoUtils/polygon ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/Normals ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z){function P(ra,Aa,qa,la,ja,oa){const za=n.getZeroIndexArray(Aa.length);Aa=[[U.VertexAttribute.POSITION,new K.Attribute(la.positions,Aa,3,!0)],[U.VertexAttribute.NORMALCOMPRESSED,new K.Attribute(la.normals,Aa,2,!0)],[U.VertexAttribute.COLOR,new K.Attribute(ja,za,4,!0)]];return new M.Geometry(ra,Aa,la.elevation,J.ContentObjectType.Mesh,oa,qa)}function R(ra,Aa,qa,la,ja,oa,za,ta,Ca,Ga,La,Ma,Ra){let Ya=0;var ab=2*
la.count,Wa=la.index,cb=la.count,Na=qa.length/3,xa=ab;p.copy(fa,Ma);const Da=0<La?1:-1;ab=3*Wa;let Ka=0;Wa=3*Ka;let ha=cb;Ma=3*ha;for(let Sa=0;Sa<cb;++Sa)Ra&&(fa[0]=ra[ab],fa[1]=ra[ab+1],fa[2]=ra[ab+2],p.normalize(fa,fa)),ja[Wa]=ra[ab],ja[Wa+1]=ra[ab+1],ja[Wa+2]=ra[ab+2],oa[Wa]=Aa[ab],oa[Wa+1]=Aa[ab+1],oa[Wa+2]=Aa[ab+2],za[Wa]=-Da*fa[0],za[Wa+1]=-Da*fa[1],za[Wa+2]=-Da*fa[2],ta[Ka]=0,ja[Ma]=ra[ab]+La*fa[0],ja[Ma+1]=ra[ab+1]+La*fa[1],ja[Ma+2]=ra[ab+2]+La*fa[2],oa[Ma]=Aa[ab],oa[Ma+1]=Aa[ab+1],oa[Ma+
2]=Aa[ab+2],za[Ma]=Da*fa[0],za[Ma+1]=Da*fa[1],za[Ma+2]=Da*fa[2],ta[ha]=La,Wa+=3,Ma+=3,ab+=3,Ka+=1,ha+=1;Wa=ab=0;Ma=3*xa;ra=0>La?ma:da;Aa=0>La?da:ma;for(Ra=0;Ra<Na;++Ra)Ga[Wa]=qa[ab+ra[0]],Ga[Wa+1]=qa[ab+ra[1]],Ga[Wa+2]=qa[ab+ra[2]],Ca[Ma]=qa[ab+Aa[0]]+cb,Ca[Ma+1]=qa[ab+Aa[1]]+cb,Ca[Ma+2]=qa[ab+Aa[2]]+cb,Wa+=3,Ma+=3,ab+=3;qa=2*la.count;ab=0;N(ja,oa,ta,za,Ya,la.pathLengths[0],la.count,qa,Ca,ab,La);qa+=4*la.pathLengths[0];ab+=2*la.pathLengths[0];Ya+=la.pathLengths[0];for(Ga=1;Ga<la.pathLengths.length;++Ga)N(ja,
oa,ta,za,Ya,la.pathLengths[Ga],la.count,qa,Ca,ab,La),qa+=4*la.pathLengths[Ga],ab+=2*la.pathLengths[Ga],Ya+=la.pathLengths[Ga]}function W(ra,Aa,qa,la,ja,oa,za){la[oa]=la[za];za*=3;oa*=3;ra[oa]=ra[za];ra[oa+1]=ra[za+1];ra[oa+2]=ra[za+2];Aa[oa]=Aa[za];Aa[oa+1]=Aa[za+1];Aa[oa+2]=Aa[za+2];qa[oa]=ja[0];qa[oa+1]=ja[1];qa[oa+2]=ja[2]}function N(ra,Aa,qa,la,ja,oa,za,ta,Ca,Ga,La){let Ma=ja,Ra=ja+1,Ya=ja+za,ab=ja+za+1,Wa=ta,cb=ta+1,Na=ta+2*oa;ta=ta+2*oa+1;0>La&&(Ma=ja+za+1,ab=ja);Ga*=3;for(let Va=0;Va<oa;++Va){Va===
oa-1&&(0<La?(Ra=ja,ab=ja+za):(Ra=ja,Ma=ja+za));var xa=ra,Da=Ma,Ka=Ra,ha=Ya,Sa=X;Da*=3;Ka*=3;ha*=3;p.set(ca,xa[Da++],xa[Da++],xa[Da++]);p.set(ba,xa[Ka++],xa[Ka++],xa[Ka++]);p.set(ia,xa[ha++],xa[ha++],xa[ha++]);p.subtract(ka,ba,ca);p.subtract(na,ia,ca);p.cross(Sa,na,ka);p.normalize(Sa,Sa);W(ra,Aa,la,qa,X,Wa,Ma);W(ra,Aa,la,qa,X,cb,Ra);W(ra,Aa,la,qa,X,Na,Ya);W(ra,Aa,la,qa,X,ta,ab);Ca[Ga++]=Wa;Ca[Ga++]=Na;Ca[Ga++]=ta;Ca[Ga++]=Wa;Ca[Ga++]=ta;Ca[Ga++]=cb;Ma++;Ra++;Ya++;ab++;Wa+=2;cb+=2;Na+=2;ta+=2}}const V=
["polygon","extent"];class S extends D.Graphics3DSymbolLayer{constructor(ra,Aa,qa,la){super(ra,Aa,qa,la);this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){var ra=C.validateSymbolLayerSize(this._getSymbolSize());if(ra)throw new g("graphics3dextrudesymbollayer:invalid-size",ra);}var Aa=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);ra=h.fromArray(Aa);Aa=Aa[3];const qa=1>Aa||this.needsDrivenTransparentPass;ra={usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0,diffuse:ra,ambient:ra,opacity:Aa,transparent:qa,cullFace:qa?L.CullFaceOptions.None:L.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:B.NormalType.Compressed};this._materials[ua.Main]=new Z.DefaultMaterial(ra);this._materials[ua.Bottom]=new Z.DefaultMaterial({...ra,cullFace:L.CullFaceOptions.Back});this._context.stage.addMany(this._materials)}destroy(){super.destroy();
this._context.stage.removeMany(this._materials);this._materials.length=0}createGraphics3DGraphic(ra){const Aa=ra.graphic;if(!this._validateGeometry(Aa.geometry,V,this.symbolLayer.type))return null;const qa=this._getVertexOpacityAndColor(ra.renderingInfo,255),la=this.setGraphicElevationContext(Aa);return this._createAs3DShape(Aa,ra.renderingInfo,qa,la,Aa.uid)}layerOpacityChanged(ra,Aa){const qa=this._getCombinedOpacity(this.symbolLayer?.material?.color),la=1>qa||this.needsDrivenTransparentPass;this._materials[ua.Main]?.setParameters({opacity:qa,
transparent:la});this._materials[ua.Bottom]?.setParameters({opacity:qa,transparent:la});const ja=this._getLayerOpacity();ra.forEach(oa=>{oa=Aa(oa);null!=oa&&oa.layerOpacityChanged(ja,this._context.isAsync)})}layerElevationInfoChanged(ra,Aa){return this.updateGraphics3DGraphicElevationInfo(ra,Aa,y.needsElevationUpdates3D)}slicePlaneEnabledChanged(ra,Aa){this._materials[ua.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._materials[ua.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
ra.forEach(qa=>{qa=Aa(qa);null!=qa&&qa.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0}physicalBasedRenderingChanged(){const ra={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};this._materials[ua.Main]?.setParameters(ra);this._materials[ua.Bottom]?.setParameters(ra);return!0}_getExtrusionSize(ra){ra=ra.size&&this._drivenProperties.size?v.getDriverAxisSizeValue(ra.size,2)??0:this._getSymbolSize();return ra/=this._context.renderCoordsHelper.unitInMeters}applyRendererDiff(ra,
Aa){return this._drivenPropertiesChanged(Aa)?E.ApplyRendererDiffResult.RecreateSymbol:E.ApplyRendererDiffResult.RecreateGraphics}async queryForSnapping(ra,Aa,qa,la){Aa=this._getExtrusionSize(qa)*this._context.renderCoordsHelper.unitInMeters/k.getMetersPerVerticalUnitForSR(Aa);const {objectId:ja,target:oa}=ra;qa=d.clone(oa);qa.z=(qa.z??0)+Aa;switch(ra.type){case "edge":const {start:za,end:ta}=ra;ra=d.clone(za);la=d.clone(ta);ra.z=(ra.z??0)+Aa;la.z=(la.z??0)+Aa;return[t.makeEdgeCandidate(ja,qa,Infinity,
ra,la)];case "vertex":return[t.makeVertexCandidate(ja,qa,Infinity),t.makeEdgeCandidate(ja,oa,Infinity,oa,qa)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(ra,Aa,qa,la,ja){var oa=A.geometryAsPolygon(ra.geometry);if(null==oa)return null;if(0===oa.rings.length||!oa.rings.some(Ka=>0<Ka.length))return this._logGeometryValidationWarnings(oa.rings,"rings","ExtrudeSymbol3DLayer"),null;ra=H.geometryToRenderInfo(oa,this._context.elevationProvider,this._context.renderCoordsHelper,
la);this._logGeometryCreationWarnings(ra,oa.rings,"rings","ExtrudeSymbol3DLayer");var za=C.computeCentroid(oa);if(null==za)return null;var ta=[];const Ca=[],Ga=w.create(),La=e.create(),Ma=h.create(),Ra=this._context.renderCoordsHelper.viewingMode===r.ViewingMode.Global;Ra||this._context.renderCoordsHelper.worldUpAtPosition(null,Ma);u.computeTranslationToOriginAndRotation(oa.spatialReference,[za.x,za.y,0],La,this._context.renderCoordsHelper.spatialReference);oa=e.create();l.invert(oa,La);za=c.create();
f.normalFromMat4(za,oa);const {polygons:Ya,mapPositions:ab,position:Wa}=ra;for(const Ka of Ya){za=Ka.count;if(this._context.clippingExtent&&(w.empty(Ga),w.expandWithBuffer(Ga,Ka.mapPositions),!w.intersectsClippingArea(Ga,this._context.clippingExtent)))continue;var cb=m.earcut(Ka.mapPositions,Ka.holeIndices,3);if(0===cb.length)continue;var Na=cb.length,xa=6*za;za=n.newIndexArray(xa+Na);Na=n.newIndexArray(Na);var Da=x.newDoubleArray(3*xa);const ha=x.newDoubleArray(3*xa),Sa=x.newDoubleArray(3*xa);xa=
x.newDoubleArray(xa);const Va=this._getExtrusionSize(Aa);R(Wa,ab,cb,Ka,Da,Sa,ha,xa,za,Na,Va,Ma,Ra);q.transformMat4(Da,Da,oa);cb=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ja,layerUid:this._context.layer.uid});Da=new sa(Da,Sa,Q.compressNormals(ha),xa);ta.push(P(this._materials[ua.Main],za,za.length-Na.length,Da,qa,cb),P(this._materials[ua.Bottom],Na,0,Da,qa,cb));Ca.push(Da.heights)}if(0===ta.length)return null;Aa=new O.Object3D({geometries:ta,layerUid:this._context.layer.uid,
graphicUid:ja,isElevationSource:!0});Aa.transformation=La;qa=F.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});ta=new z.Graphics3DObject3DGraphicLayer(this,Aa,ta,null,null,(Ka,ha,Sa,Va,wa)=>{Ka=Ka.stageObject;const Ba=Ka.geometries,Ja=Ba.length;ha="absolute-height"!==ha.mode;let Ta=0;const db=Ka.transformation,lb=l.invertOrIdentity(e.create(),db);for(let mb=0;mb<Ja;mb+=2){const ob=Ba[mb];if(!T.isGeometryWithMapPositions(ob))continue;const pb=ob.getMutableAttribute(U.VertexAttribute.POSITION).data,
zb=Ca[mb/2],rb=new I.SamplePosition(ob.mapPositions),Jb=pb.length/3;let fb=0,Cb=!1,Lb=0;for(let Hb=0;Hb<Jb;Hb++){Y[0]=pb[fb];Y[1]=pb[fb+1];Y[2]=pb[fb+2];Va(rb,aa);ha&&(Lb+=aa.sampledElevation);G.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(p.set(ea,rb.array[rb.offset],rb.array[rb.offset+1],aa.z+zb[fb/3]),null!=Sa&&wa.toRenderCoords(ea,Sa,ea)):(p.set(ea,pb[fb],pb[fb+1],pb[fb+2]),p.transformMat4(ea,ea,db),wa.setAltitude(ea,aa.z+zb[fb/3]));p.transformMat4(ea,ea,lb);pb[fb]=ea[0];pb[fb+1]=ea[1];pb[fb+2]=ea[2];
const Mb=.01/wa.unitInMeters;if(Math.abs(Y[0]-pb[fb])>=Mb||Math.abs(Y[1]-pb[fb+1])>=Mb||Math.abs(Y[2]-pb[fb+2])>=Mb)Cb=!0;rb.offset+=3;fb+=3}Cb&&(ob.invalidateBoundingInfo(),Ka.geometryVertexAttributeUpdated(Ba[mb],U.VertexAttribute.POSITION),Ba[mb+1].invalidateBoundingInfo(),Ka.geometryVertexAttributeUpdated(Ba[mb+1],U.VertexAttribute.POSITION));Ta+=Lb/Jb}return Ta/Ja},la,null!=qa?{baseMaterial:this._materials[ua.Main],edgeMaterials:[qa],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:
null);ta.alignedSampledElevation=ra.sampledElevation;ta.needsElevationUpdates=y.needsElevationUpdates3D(la.mode);return ta}}const X=h.create(),ca=h.create(),ba=h.create(),ia=h.create(),ka=h.create(),na=h.create(),Y=h.create(),ea=h.create(),fa=h.create(),aa=new y.SampleElevationInfo,da=[0,2,1],ma=[0,1,2];var ua;(function(ra){ra[ra.Main=0]="Main";ra[ra.Bottom=1]="Bottom"})(ua||(ua={}));class sa{constructor(ra,Aa,qa,la){this.positions=ra;this.elevation=Aa;this.normals=qa;this.heights=la}}a.Graphics3DExtrudeSymbolLayer=
S;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports","./_commonjsHelpers"],function(a,b){var g={exports:{}};g.exports;(function(d){(function(k){k=k();void 0!==k&&(d.exports=k)})(function(){function k(A,F,G){G=G||2;var I=F&&F.length,H=I?F[0]*G:A.length,B=m(A,0,H,G,!0),K=[];if(!B||B.next===B.prev)return K;var L;if(I){var J=B;var M=G;B=[];var T;I=0;for(T=F.length;I<T;I++){var Q=F[I]*M;var O=I<T-1?F[I+1]*M:A.length;Q=m(A,Q,O,M,!1);Q===Q.next&&
(Q.steiner=!0);O=B;var U=O.push,Z=Q,P=Q;do{if(Z.x<P.x||Z.x===P.x&&Z.y<P.y)P=Z;Z=Z.next}while(Z!==Q);U.call(O,P)}B.sort(e);for(I=0;I<B.length;I++)M=B[I],F=J,(J=h(M,F))?(T=y(J,M),M=f(J,J.next),T=p(T),f(T,T.next),M=p(M),J=p(F===J?M:F)):J=F,J=f(J,J.next);B=J}if(A.length>80*G){var R=L=A[0];var W=I=A[1];for(M=G;M<H;M+=G)F=A[M],J=A[M+1],F<R&&(R=F),J<W&&(W=J),F>L&&(L=F),J>I&&(I=J);L=Math.max(L-R,I-W);L=0!==L?1/L:0}c(B,K,G,R,W,L);return K}function m(A,F,G,I,H){if(H===0<E(A,F,G,I))for(H=F;H<G;H+=I)var B=z(H,
A[H],A[H+1],B);else for(H=G-I;H>=F;H-=I)B=z(H,A[H],A[H+1],B);B&&n(B,B.next)&&(A=B.next,D(B),B=A);return B}function f(A,F){if(!A)return A;F||(F=A);do{var G=!1;if(A.steiner||!n(A,A.next)&&0!==x(A.prev,A,A.next))A=A.next;else{F=A.prev;D(A);A=F;if(A===A.next)break;G=!0}}while(G||A!==F);return F}function c(A,F,G,I,H,B,K){if(A){if(!K&&B){var L=A,J=L;do null===J.z&&(J.z=u(J.x,J.y,I,H,B)),J.prevZ=J.prev,J=J.nextZ=J.next;while(J!==L);J.prevZ.nextZ=null;J.prevZ=null;L=J;var M,T,Q,O,U=1;do{J=L;var Z=L=null;
for(T=0;J;){T++;var P=J;for(M=Q=0;M<U&&(Q++,P=P.nextZ,P);M++);for(O=U;0<Q||0<O&&P;)0!==Q&&(0===O||!P||J.z<=P.z)?(M=J,J=J.nextZ,Q--):(M=P,P=P.nextZ,O--),Z?Z.nextZ=M:L=M,M.prevZ=Z,Z=M;J=P}Z.nextZ=null;U*=2}while(1<T)}for(L=A;A.prev!==A.next;){J=A.prev;P=A.next;if(B)Z=l(A,I,H,B);else a:if(Z=A,T=Z.prev,Q=Z,U=Z.next,0<=x(T,Q,U))Z=!1;else{for(M=Z.next.next;M!==Z.prev;){if(w(T.x,T.y,Q.x,Q.y,U.x,U.y,M.x,M.y)&&0<=x(M.prev,M,M.next)){Z=!1;break a}M=M.next}Z=!0}if(Z)F.push(J.i/G),F.push(A.i/G),F.push(P.i/G),
D(A),L=A=P.next;else if(A=P,A===L){if(!K)c(f(A),F,G,I,H,B,1);else if(1===K){A=f(A);K=F;L=G;J=A;do P=J.prev,Z=J.next.next,!n(P,Z)&&q(P,J,J.next,Z)&&r(P,Z)&&r(Z,P)&&(K.push(P.i/L),K.push(J.i/L),K.push(Z.i/L),D(J),D(J.next),J=A=Z),J=J.next;while(J!==A);A=f(J);c(A,F,G,I,H,B,2)}else if(2===K)a:{K=A;do{for(L=K.next.next;L!==K.prev;){if(J=K.i!==L.i){Z=Z=Z=Z=void 0;J=K;P=L;if(Z=J.next.i!==P.i&&J.prev.i!==P.i){b:{Z=J;do{if(Z.i!==J.i&&Z.next.i!==J.i&&Z.i!==P.i&&Z.next.i!==P.i&&q(Z,Z.next,J,P)){Z=!0;break b}Z=
Z.next}while(Z!==J);Z=!1}Z=!Z}if(Z){if(Z=r(J,P)&&r(P,J)){Z=J;T=!1;Q=(J.x+P.x)/2;U=(J.y+P.y)/2;do Z.y>U!==Z.next.y>U&&Z.next.y!==Z.y&&Q<(Z.next.x-Z.x)*(U-Z.y)/(Z.next.y-Z.y)+Z.x&&(T=!T),Z=Z.next;while(Z!==J);Z=T}Z=Z&&(x(J.prev,J,P.prev)||x(J,P.prev,P))||n(J,P)&&0<x(J.prev,J,J.next)&&0<x(P.prev,P,P.next)}J=Z}if(J){A=y(K,L);K=f(K,K.next);A=f(A,A.next);c(K,F,G,I,H,B);c(A,F,G,I,H,B);break a}L=L.next}K=K.next}while(K!==A)}break}}}}function l(A,F,G,I){var H=A.prev,B=A.next;if(0<=x(H,A,B))return!1;var K=
H.x>A.x?H.x>B.x?H.x:B.x:A.x>B.x?A.x:B.x,L=H.y>A.y?H.y>B.y?H.y:B.y:A.y>B.y?A.y:B.y,J=u(H.x<A.x?H.x<B.x?H.x:B.x:A.x<B.x?A.x:B.x,H.y<A.y?H.y<B.y?H.y:B.y:A.y<B.y?A.y:B.y,F,G,I);F=u(K,L,F,G,I);G=A.prevZ;for(I=A.nextZ;G&&G.z>=J&&I&&I.z<=F;){if(G!==A.prev&&G!==A.next&&w(H.x,H.y,A.x,A.y,B.x,B.y,G.x,G.y)&&0<=x(G.prev,G,G.next))return!1;G=G.prevZ;if(I!==A.prev&&I!==A.next&&w(H.x,H.y,A.x,A.y,B.x,B.y,I.x,I.y)&&0<=x(I.prev,I,I.next))return!1;I=I.nextZ}for(;G&&G.z>=J;){if(G!==A.prev&&G!==A.next&&w(H.x,H.y,A.x,
A.y,B.x,B.y,G.x,G.y)&&0<=x(G.prev,G,G.next))return!1;G=G.prevZ}for(;I&&I.z<=F;){if(I!==A.prev&&I!==A.next&&w(H.x,H.y,A.x,A.y,B.x,B.y,I.x,I.y)&&0<=x(I.prev,I,I.next))return!1;I=I.nextZ}return!0}function e(A,F){return A.x-F.x}function p(A){if(A.next.prev===A)return A;let F=A;do{const G=F.next;if(G.prev===F||G===F||G===A)break;F=G}while(1);return F}function h(A,F){var G=F,I=A.x,H=A.y,B=-Infinity;do{if(H<=G.y&&H>=G.next.y&&G.next.y!==G.y){var K=G.x+(H-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(K<=I&&K>B){B=
K;if(K===I){if(H===G.y)return G;if(H===G.next.y)return G.next}var L=G.x<G.next.x?G:G.next}}G=G.next}while(G!==F);if(!L)return null;if(I===B)return L;F=L;K=L.x;var J=L.y,M=Infinity;G=L;do{if(I>=G.x&&G.x>=K&&I!==G.x&&w(H<J?I:B,H,K,J,H<J?B:I,H,G.x,G.y)){var T=Math.abs(H-G.y)/(I-G.x);var Q;if((Q=r(G,A))&&!(Q=T<M)&&(Q=T===M)&&!(Q=G.x>L.x)&&(Q=G.x===L.x)){Q=L;var O=G;Q=0>x(Q.prev,Q,O.prev)&&0>x(O.next,Q,Q.next)}Q&&(L=G,M=T)}G=G.next}while(G!==F);return L}function u(A,F,G,I,H){A=32767*(A-G)*H;F=32767*(F-
I)*H;A=(A|A<<8)&16711935;A=(A|A<<4)&252645135;A=(A|A<<2)&858993459;F=(F|F<<8)&16711935;F=(F|F<<4)&252645135;F=(F|F<<2)&858993459;return(A|A<<1)&1431655765|((F|F<<1)&1431655765)<<1}function w(A,F,G,I,H,B,K,L){return 0<=(H-K)*(F-L)-(A-K)*(B-L)&&0<=(A-K)*(I-L)-(G-K)*(F-L)&&0<=(G-K)*(B-L)-(H-K)*(I-L)}function x(A,F,G){return(F.y-A.y)*(G.x-F.x)-(F.x-A.x)*(G.y-F.y)}function n(A,F){return A.x===F.x&&A.y===F.y}function q(A,F,G,I){var H=v(x(A,F,G)),B=v(x(A,F,I)),K=v(x(G,I,A)),L=v(x(G,I,F));return H!==B&&K!==
L||0===H&&t(A,G,F)||0===B&&t(A,I,F)||0===K&&t(G,A,I)||0===L&&t(G,F,I)?!0:!1}function t(A,F,G){return F.x<=Math.max(A.x,G.x)&&F.x>=Math.min(A.x,G.x)&&F.y<=Math.max(A.y,G.y)&&F.y>=Math.min(A.y,G.y)}function v(A){return 0<A?1:0>A?-1:0}function r(A,F){return 0>x(A.prev,A,A.next)?0<=x(A,F,A.next)&&0<=x(A,A.prev,F):0>x(A,F,A.prev)||0>x(A,A.next,F)}function y(A,F){var G=new C(A.i,A.x,A.y),I=new C(F.i,F.x,F.y),H=A.next,B=F.prev;A.next=F;F.prev=A;G.next=H;H.prev=G;I.next=G;G.prev=I;B.next=I;I.prev=B;return I}
function z(A,F,G,I){A=new C(A,F,G);I?(A.next=I.next,A.prev=I,I.next.prev=A,I.next=A):(A.prev=A,A.next=A);return A}function D(A){A.next.prev=A.prev;A.prev.next=A.next;A.prevZ&&(A.prevZ.nextZ=A.nextZ);A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function C(A,F,G){this.i=A;this.x=F;this.y=G;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function E(A,F,G,I){for(var H=0,B=G-I;F<G;F+=I)H+=(A[B]-A[F])*(A[F+1]+A[B+1]),B=F;return H}k.deviation=function(A,F,G,I){var H=F&&F.length,B=Math.abs(E(A,
0,H?F[0]*G:A.length,G));if(H){H=0;for(var K=F.length;H<K;H++)B-=Math.abs(E(A,F[H]*G,H<K-1?F[H+1]*G:A.length,G))}for(H=F=0;H<I.length;H+=3){K=I[H]*G;var L=I[H+1]*G,J=I[H+2]*G;F+=Math.abs((A[K]-A[J])*(A[L+1]-A[K+1])-(A[K]-A[L])*(A[J+1]-A[K+1]))}return 0===B&&0===F?0:Math.abs((F-B)/B)};k.flatten=function(A){for(var F=A[0][0].length,G={vertices:[],holes:[],dimensions:F},I=0,H=0;H<A.length;H++){for(var B=0;B<A[H].length;B++)for(var K=0;K<F;K++)G.vertices.push(A[H][B][K]);0<H&&(I+=A[H-1].length,G.holes.push(I))}return G};
return k})})(g);b=b.getDefaultExportFromCjs(g.exports);a.earcut=b})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(b,g,d,k,m,f=!1){return{objectId:b,target:g,distance:d,type:"edge",start:k,end:m,draped:f}};a.makeVertexCandidate=function(b,g,d){return{objectId:b,target:g,distance:d,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports",
"../../Color","../visualVariables/support/visualVariableUtils"],function(a,b,g){function d(m,f){if(!m||m.symbol)return null;f=f?.renderer;return m&&null!=f&&f.getObservationRenderer?f.getObservationRenderer(m):f}async function k(m,f){if(null!=m.symbol)return m.symbol;const c=d(m,f);return null!=c?c.getSymbolAsync(m,f):null}a.getDriverAxisSizeValue=function(m,f=0){m=m[f];return"number"===typeof m&&isFinite(m)?m:null};a.getDriverAxisSizeValueAny=function(m){for(let f=0;3>f;f++){const c=m[f];if("number"===
typeof c)return isFinite(c)?c:0}return 0};a.getRenderer=d;a.getRenderingInfo=function(m,f){const c=d(m,f);if(null!=m.symbol)var l=m.symbol;else l=d(m,f),l=null!=l&&"dot-density"!==l.type?l.getSymbol(m,f):null;if(null==l)return null;l={renderer:c,symbol:l};if(!(null!=c&&"visualVariables"in c&&c.visualVariables))return l;f=g.getVisualVariableValues(c,m,f)??[];m=["proportional","proportional","proportional"];for(const {variable:e,value:p}of f)switch(e.type){case "color":l.color=p.toRgba();break;case "size":if("outline"===
e.target)l.outlineSize=p;else switch(f=e.useSymbolValue?"symbol-value":p,e.axis){case "width":m[0]=f;break;case "depth":m[1]=f;break;case "height":m[2]=f;break;case "width-and-depth":m[0]=m[1]=f;break;default:m[0]=m[1]=m[2]=f}break;case "opacity":l.opacity=p;break;case "rotation":switch(e.axis){case "tilt":l.tilt=p;break;case "roll":l.roll=p;break;default:l.heading=p}}if("proportional"!==m[0]||"proportional"!==m[1]||"proportional"!==m[2])l.size=m;return l};a.getRenderingInfoAsync=async function(m,
f){var c=d(m,f),l=await k(m,f);if(!l)return null;l={renderer:c,symbol:l};if(!(c&&"visualVariables"in c&&c.visualVariables))return l;f=g.getVisualVariableValues(c,m,f)??[];m=["proportional","proportional","proportional"];for(const {variable:e,value:p}of f)"color"===e.type?l.color=b.toUnitRGBA(p):"size"===e.type?"outline"===e.target?l.outlineSize=p:(f=e.axis,c=e.useSymbolValue?"symbol-value":p,"width"===f?m[0]=c:"depth"===f?m[1]=c:"height"===f?m[2]=c:m[0]="width-and-depth"===f?m[1]=c:m[1]=m[2]=c):"opacity"===
e.type?l.opacity=p:"rotation"===e.type&&"tilt"===e.axis?l.tilt=p:"rotation"===e.type&&"roll"===e.axis?l.roll=p:"rotation"===e.type&&(l.heading=p);if(isFinite(m[0])||isFinite(m[1])||isFinite(m[2]))l.size=m;return l};a.getSymbolAsync=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/mathUtils ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec3 ../../../../geometry/support/Axis ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(r,y,z,D){const C=Array.isArray(y[0])?(A,F)=>y[A][F]:(A,F)=>y[3*A+F],E=D?d.getMetersPerUnitForSR(D)/d.getMetersPerVerticalUnitForSR(D):1;return l.fromManyPoints(r,(A,F)=>m.set(A,C(F,0)*E,C(F,1)*E,C(F,2)),z)}function q(r,y,z){r=n(t,r,y,z)?l.normal(t):[0,0,1];return Math.abs(r[2])>Math.cos(g.deg2rad(80))?f.Axis.Z:Math.abs(r[1])>Math.abs(r[0])?f.Axis.Y:f.Axis.X}const t=l.create();class v{constructor(r,y,z){this.renderData=r;this.layerUid=y;this.graphicUid=
z;this.outGeometries=[]}}a.PolygonCreationDataBase=v;a.createColorGeometry=function(r){const y=[[u.VertexAttribute.POSITION,new e.Attribute(r.attributeData.position,r.indices,3,!0)]],z=c.getZeroIndexArray(r.indices.length);null!=r.attributeData.colorFeature?y.push([u.VertexAttribute.COLORFEATUREATTRIBUTE,new e.Attribute([r.attributeData.colorFeature],z,1,!0)]):r.attributeData.color&&y.push([u.VertexAttribute.COLOR,new e.Attribute(r.attributeData.color,z,4,!0)]);r.attributeData.uvMapSpace&&y.push([u.VertexAttribute.UVMAPSPACE,
new e.Attribute(r.attributeData.uvMapSpace,r.indices,4,!0)]);r.attributeData.boundingRect&&y.push([u.VertexAttribute.BOUNDINGRECT,new e.Attribute(r.attributeData.boundingRect,r.indices,9,!0)]);return new h.Geometry(r.material,y,r.mapPositions,p.ContentObjectType.Mesh,r.attributeData.objectAndLayerIdColor)};a.createIndices3D=function(r,y,z){z=q(r,(0<y.length?y[0]:r.length/3)-1,z);if(z!==f.Axis.Z){r=r.slice();for(let D=0;D<r.length;D+=3)r[D+z]=r[D+2]}return k.earcut(r,y,3)};a.createWaterGeometry=function(r,
y=null){const z=[[u.VertexAttribute.POSITION,new e.Attribute(r.attributeData.position,r.indices,3,!0)],[u.VertexAttribute.UV0,new e.Attribute(r.attributeData.uv0,r.indices,2,!0)]];return new h.Geometry(r.material,z,r.mapPositions,p.ContentObjectType.Mesh,y)};a.fitPlane=n;a.geometryAsPolygon=function(r){switch(r.type){case "extent":if(r instanceof w)return x.fromExtent(r);break;case "polygon":return r}return null};a.leastSignificantAxis=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/renderInfoUtils/polygon":function(){define("exports ../../../../geometry/projection/projectBuffer ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(a,b,g,d,k,m){function f(w,x,n=null){return w.filter(({count:q})=>1<q).map(({index:q,count:t})=>{const v=3*q,r=3*t;return null!=n?new e(q,t,g.doubleSubArray(x,v,r),g.doubleSubArray(n,v,r)):new l(q,
t,g.doubleSubArray(x,v,r))})}function c(w,x,n=null){const q=[];for(const {index:t,count:v,holeIndices:r,pathLengths:y}of w){if(1>=v)continue;w=3*t;const z=3*v,D=r.map(C=>C-t);w=null!=n?new p(t,v,g.doubleSubArray(x,3*t,3*v),g.doubleSubArray(n,w,z),D,y):new h(t,v,g.doubleSubArray(x,3*t,3*v),D,y);q.push(w)}return q}class l{constructor(w,x,n){this.index=w;this.count=x;this.position=n}}class e extends l{constructor(w,x,n,q){super(w,x,n);this.mapPositions=q}}class p extends e{constructor(w,x,n,q,t,v){super(w,
x,n,q);this.holeIndices=t;this.pathLengths=v}}class h extends l{constructor(w,x,n,q,t){super(w,x,n);this.holeIndices=q;this.pathLengths=t}}class u{constructor(w,x,n,q,t,v){this.position=w;this.mapPositions=x;this.polygons=n;this.outlines=q;this.projectionSuccess=t;this.sampledElevation=v}}a.PolygonRenderInfo=u;a.PolygonVertexData=p;a.PolygonVertexDataDraped=h;a.geometryToRenderInfo=function(w,x,n,q){const t=d.pathsToTriangulationInfo(w.rings,!!w.hasZ,d.CounterClockwiseMode.CCW_IS_HOLE,w.spatialReference),
v=g.newDoubleArray(t.position.length);w=k.applyPerVertexElevationAlignment(t.position,w.spatialReference,0,v,0,t.position,0,t.position.length/3,x,n,q);x=null!=w;return new u(t.position,v,c(t.polygons,t.position,v),f(t.outlines,t.position,v),x,w)};a.geometryToRenderInfoDraped=function(w,x){const n=d.pathsToTriangulationInfo(w.rings,!1,d.CounterClockwiseMode.CCW_IS_HOLE);w=b.projectBuffer(n.position,w.spatialReference,0,n.position,x,0,n.position.length/3);for(x=2;x<n.position.length;x+=3)n.position[x]=
m.drapedZ;return{position:n.position,polygons:c(n.polygons,n.position),outlines:f(n.outlines,n.position),projectionSuccess:w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangulationUtils":function(){define("exports ../../chunks/earcut ./Axis ./coordsUtils ./DoubleArray ./Indices ./meshUtils/deduplicate ../../views/3d/layers/graphics/polygonUtils".split(" "),function(a,b,g,d,k,m,f,c){function l(u,w,x){if(1===u.length)return u[0];w=k.newDoubleArray(w);x=
Array(x);let n=0,q=0,t=0;for(const v of u){for(u=0;u<v.position.length;u++)w[n++]=v.position[u];for(const r of v.faces)x[q++]=r+t;t=n/3}return{position:w,faces:m.compactIndices(x)}}function e(u,w,x,n){const q=u.length,t=Array(q),v=Array(q),r=Array(q);let y=0,z=0,D=0;var C=0;for(var E=0;E<q;++E)C+=u[E].length;C=k.newDoubleArray(3*C);E=0;for(let I=q-1;0<=I;I--){var A=u[I],F=x===a.CounterClockwiseMode.CCW_IS_HOLE?h(A,w,n):!1;if(F&&1!==q)t[y++]=A;else{var G=A.length;for(let H=0;H<y;++H)G+=t[H].length;
G={index:E,pathLengths:Array(y+1),count:G,holeIndices:Array(y)};G.pathLengths[0]=A.length;0<A.length&&(r[D++]={index:E,count:A.length});E=F?p(A,A.length-1,-1,C,E,A.length,w):p(A,0,1,C,E,A.length,w);for(A=0;A<y;++A)F=t[A],G.holeIndices[A]=E,G.pathLengths[A+1]=F.length,0<F.length&&(r[D++]={index:E,count:F.length}),E=p(F,0,1,C,E,F.length,w);y=0;0<G.count&&(v[z++]=G)}}for(u=0;u<y;++u)x=t[u],0<x.length&&(r[D++]={index:E,count:x.length}),E=p(x,0,1,C,E,x.length,w);v.length=z;r.length=D;return{position:C,
polygons:v,outlines:r}}function p(u,w,x,n,q,t,v){q*=3;for(let r=0;r<t;++r){const y=u[w];n[q++]=y[0];n[q++]=y[1];n[q++]=v?y[2]:0;w+=x}return q/3}function h(u,w,x){if(w){w=c.leastSignificantAxis(u,u.length-1,x);if(w===g.Axis.X)return!d.isClockwise(u,g.Axis.Y,g.Axis.Z);if(w===g.Axis.Y)return!d.isClockwise(u,g.Axis.X,g.Axis.Z)}return!d.isClockwise(u,g.Axis.X,g.Axis.Y)}a.CounterClockwiseMode=void 0;(function(u){u[u.NONE=0]="NONE";u[u.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode=
{}));a.isCounterClockwise=h;a.pathsToTriangulationInfo=e;a.triangulate=function(u){u=e(u.rings,u.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE,u.spatialReference);const w=[];let x=0,n=0;for(var q of u.polygons){const v=q.index,r=k.doubleSubArray(u.position,3*v,3*q.count);var t=q.holeIndices.map(y=>y-v);t=m.compactIndices(b.earcut(r,t,3));w.push({position:r,faces:t});x+=r.length;n+=t.length}q=l(w,x,n);u=Array.isArray(q.position)?f.deduplicate(q.position,3,{originalIndices:q.faces}):f.deduplicate(q.position.buffer,
6,{originalIndices:q.faces});q.position=k.doubleArrayFrom(new Float64Array(u.buffer));q.faces=u.indices;return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../Indices"],function(a,b,g){let d=null;a.deduplicate=function(k,m,f){var c=Array.isArray(k),l=c?k.length/m:k.byteLength/(4*m),e=c?k:new Uint32Array(k,0,l*m),p=f?.minReduction??0;const h=(k=f?.originalIndices||null)?k.length:
0;var u=f?.componentOffsets||null;f=0;if(u)for(var w=0;w<u.length-1;w++){var x=u[w+1]-u[w];x>f&&(f=x)}else f=l;var n=Math.floor(1.1*f)+1;if(null==d||d.length<2*n)d=new Uint32Array(b.nextHighestPowerOfTwo(2*n));for(f=0;f<2*n;f++)d[f]=0;f=0;const q=(x=!!u&&!!k)?h:l;w=g.newIndexArray(l);var t=new Uint32Array(h),v=0!==p?Math.ceil(7.84*1.96/(p*p)*p*(1-p)):q,r=1,y=u?u[1]:q;for(let A=0;A<q;A++){if(A===v){var z=1-f/A;if(z+1.96*Math.sqrt(z*(1-z)/A)<p)return null;v*=2}if(A===y){for(y=0;y<2*n;y++)d[y]=0;if(k)for(y=
u[r-1];y<u[r];y++)t[y]=w[k[y]];y=u[++r]}z=x?k[A]:A;const F=z*m;var D=0;for(var C=0;C<m;C++)D=e[F+C]+D|0,D=D+(D<<11)+(D>>>2)|0;D>>>=0;C=D%n;let G=f;for(;0!==d[2*C+1];){if(d[2*C]===D){const I=d[2*C+1]-1;var E=I*m;a:{for(let H=0;H<m;H++)if(e[F+H]!==e[E+H]){E=!1;break a}E=!0}if(E){G=w[I];break}}C++;C>=n&&(C-=n)}G===f&&(d[2*C]=D,d[2*C+1]=z+1,f++);w[z]=G}if(0!==p&&1-f/l<p)return null;if(x){for(l=u[r-1];l<t.length;l++)t[l]=w[k[l]];w=g.compactIndices(t)}c=c?Array(f):new Uint32Array(f*m);f=0;for(v=0;v<q;v++)if(w[v]===
f){l=e;p=(x?k[v]:v)*m;u=c;n=f*m;t=m;for(r=0;r<t;r++)u[n+r]=l[p+r];f++}if(k&&!x){m=new Uint32Array(h);for(e=0;e<m.length;e++)m[e]=w[k[e]];w=g.compactIndices(m)}return{buffer:Array.isArray(c)?c:c.buffer,indices:w,uniqueCount:f}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayContent ./OverlayRenderTargets ../webgl-engine/core/FBOCache ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/TextureOnly.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/TransparencyPassType ../webgl-engine/lib/UpdatePolicy ../webgl-engine/lighting/Lightsources ../../../chunks/OverlayCompositing.glsl ../webgl-engine/shaders/OverlayCompositingTechnique ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba){a.OverlayRenderer=class extends I.SyncRenderPlugin{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(Y){super(Y);
this._renderTargets=this._overlays=null;this._overlayParameters=new N.OverlayCompositingPassParameters;this._hasWater=this._rendersOccluded=this.hasHighlights=!1;this._renderers=new Map;this._sortedDrapeSourceRenderersDirty=!1;this._sortedRenderers=new m;this._passParameters=new F.TextureOnlyPassParameters;this._materialRepository=null;this._screenToWorldRatio=1;this._localOriginFactory=null;this.unloadedMemory=0;this.ignoresMemoryFactor=!1;this._camera=new H.Camera;this.worldToPCSRatio=1;this.events=
new g;this.longitudeCyclical=null;this.produces=new Map([[T.RenderSlot.DRAPED_MATERIAL,ea=>ea!==E.ShaderOutput.Highlight||this.hasHighlights],[T.RenderSlot.DRAPED_WATER,()=>!0]]);this._hasDrapedRasterSource=this._hasDrapedFeatureSource=this._hasTargetWithoutRasterImage=!1}initialize(){const Y=this.view._stage.renderer.fboCache,ea=this.view._stage.renderView,{waterTextureRepository:fa,stippleTextureRepository:aa,markerTextureRepository:da}=ea;this._shaderTechniqueRepository=new G.ShaderTechniqueRepository({rctx:this._rctx,
viewingMode:q.ViewingMode.Local,stippleTextureRepository:aa,markerTextureRepository:da,waterTextureRepository:fa});this._renderContext=new M.OverlayRenderContext(this._rctx,new Q.ShadowMap(Y,this.view.state.viewingMode),null);this.addHandles([f.watch(()=>fa.updating,()=>this.events.emit("content-changed"),f.syncAndInitial),f.watch(()=>this.spatialReference,ma=>this._localOriginFactory=new L.GridLocalOriginFactory(ma),f.syncAndInitial),f.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=
!0)]);this._materialRepository=new B.GLMaterialRepository(ea.textureRepository,this._shaderTechniqueRepository,ma=>{0<(ma.parameters.renderOccluded&na)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating");this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._bindParameters.slot=T.RenderSlot.DRAPED_MATERIAL;this._bindParameters.mainDepth=K.createEmptyDepthTexture(this._rctx);this._camera.near=1;this._camera.far=
1E4;this._camera.relativeElevation=null;this._bindParameters.camera=this._camera;this._bindParameters.transparencyPassType=P.TransparencyPassType.NONE;this._bindParameters.newLighting.noonFactor=0;this._bindParameters.newLighting.globalFactor=0;this._bindParameters.newLighting.set([new W.AmbientLight(n.fromValues(1,1,1))]);this.addHandles(this.view.resourceController.scheduler.registerTask(S.TaskPriority.STAGE,this))}destroy(){this._renderers.forEach(Y=>Y.destroy());this._renderers.clear();this._debugTextureTechnique=
k.releaseMaybe(this._debugTextureTechnique);this._passParameters.texture=k.disposeMaybe(this._passParameters.texture);this._bindParameters.mainDepth=k.disposeMaybe(this._bindParameters.mainDepth);this._shaderTechniqueRepository=k.destroyMaybe(this._shaderTechniqueRepository);this.disposeOverlays()}initializeRenderContext(Y){this.pluginContext=Y}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||d.someMap(this._renderers,Y=>Y.updating)}get hasOverlays(){return null!=
this._overlays&&null!=this._renderTargets}getMemoryForMaterial(Y){return Array.from(this._renderers.values()).reduce((ea,fa)=>ea+fa.getMemoryForMaterial(Y),0)}createGeometryDrapeSourceRenderer(Y){return this.createDrapeSourceRenderer(Y,O.SortedRenderGeometryRenderer)}createDrapeSourceRenderer(Y,ea,fa){const aa=this._renderers.get(Y);null!=aa&&aa.destroy();ea=new ea({...fa,rendererContext:this,drapeSource:Y});this._renderers.set(Y,ea);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in Y&&this.addHandles(f.watch(()=>
Y.fullOpacity,()=>this.events.emit("content-changed")),Y);return ea}removeDrapeSourceRenderer(Y){if(null!=Y){var ea=this._renderers.get(Y);null!=ea&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(Y),this.removeHandles(Y),ea.destroy())}}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(Y){this._hasTargetWithoutRasterImage=this._overlays?c.someSet(Y,ea=>
ea.drapeTargetType===t.DrapeTargetType.WithoutRasterImage):!1}ensureDrapeSources(Y){this._overlays?(this._hasDrapedFeatureSource=c.someSet(Y,ea=>ea.drapeSourceType===t.DrapeSourceType.Features),this._hasDrapedRasterSource=c.someSet(Y,ea=>ea.drapeSourceType===t.DrapeSourceType.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(Y,
ea,fa=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new D.OverlayRenderTargets(this.view._stage.renderer.fboCache),this._overlays=[new y.Overlay,new y.Overlay]);this.ensureDrapeTargets(Y);this.ensureDrapeSources(ea);this._bindParameters.overlayStretch=fa}disposeOverlays(){this._overlays=null;this._renderTargets=k.disposeMaybe(this._renderTargets);this.events.emit("textures-disposed")}getTexture(Y){if(null!=Y)return Y===z.OverlayContent.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&
this._hasDrapedFeatureSource?this._renderTargets?.getTexture(z.OverlayContent.Color):this._renderTargets?.getTexture(Y)}get running(){return this.updating}runTask(Y){this._processDrapeSources(Y,()=>!0)}_processDrapeSources(Y,ea){let fa=!1;for(const [aa,da]of this._renderers){if(Y.done)break;(aa.destroyed||ea(aa))&&da.commitChanges()&&(fa=!0,Y.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,fa=!0,this._updateSortedDrapeSourceRenderers());fa&&(null!=
this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=d.someMap(this._renderers,aa=>aa.hasHighlights),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(S.noBudget,Y=>Y.updatePolicy===R.UpdatePolicy.SYNC)}get isEmpty(){return v.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE?!1:!d.someMap(this._renderers,Y=>!Y.isEmpty)}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}get mode(){return this.isEmpty?
A.OverlayMode.Disabled:this._renderTargets?.getTexture(z.OverlayContent.WaterNormal)?A.OverlayMode.EnabledWithWater:this._renderTargets?.getTexture(z.OverlayContent.Color)?A.OverlayMode.Enabled:A.OverlayMode.Disabled}updateAnimation(Y){let ea=!1;this._renderers.forEach(fa=>ea=fa.updateAnimation(Y)||ea);return ea}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(Y){if(this._overlays&&this._renderTargets){for(const ea of this._overlays)this.longitudeCyclical?ea.setupGeometryViewsCyclical(this.longitudeCyclical):
ea.setupGeometryViewsDirect();for(const ea of this._renderTargets.targets)if(ea.content!==z.OverlayContent.ColorNoRasterImage||this._needsColorWithoutRasterImage)this._drawTarget(r.OverlayIndex.INNER,ea,Y),this._drawTarget(r.OverlayIndex.OUTER,ea,Y)}}_drawTarget(Y,ea,fa){const aa=this._overlays[Y],da=aa.canvasGeometries;if(0!==da.numViews){var {alignPixelEnabled:ma,contentPixelRatio:ua}=fa;this._screenToWorldRatio=ua*aa.mapUnitsPerPixel/this._bindParameters.overlayStretch;var sa=ea.output;if(!(this.isEmpty||
sa===E.ShaderOutput.Highlight&&!this.hasHighlights||sa===E.ShaderOutput.Normal&&!this.hasWater)&&aa.hasSomeSizedView()){var ra=this._rctx;this._camera.pixelRatio=aa.pixelRatio*ua;this._renderContext.output=sa;this._bindParameters.alignPixelEnabled=ma;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=sa===E.ShaderOutput.Normal?T.RenderSlot.DRAPED_WATER:T.RenderSlot.DRAPED_MATERIAL;
if((fa=v.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE&&ea.content!==z.OverlayContent.Occluded)||this._sortedRenderers.some(({renderer:oa})=>oa.shouldRender(this._renderContext))){var Aa=aa.resolution;this._rctx.setViewport(Y===r.OverlayIndex.INNER?0:Aa,0,Aa,Aa);var qa=2*aa.resolution,la=aa.resolution,ja=ea.fbo;ja.bind(ra,qa,la);Y===r.OverlayIndex.INNER&&(ra.setClearColor(0,0,0,0),ra.clearSafe(X.ClearBufferBit.COLOR_BUFFER_BIT));ea.content===z.OverlayContent.Occluded&&(this._renderContext.renderOccludedMask=
na);if(fa)for(fa=0;fa<da.numViews;fa++)this._setViewParameters(da.extents[fa],aa),this._ensureDebugPatternResources(aa.resolution,ka[Y]),this._rctx.bindTechnique(this._debugTextureTechnique,this._passParameters,null),this._rctx.screen.draw();this._sortedRenderers.forAll(({drapeSource:oa,renderer:za})=>{if(ea.content!==z.OverlayContent.ColorNoRasterImage||oa.drapeSourceType!==t.DrapeSourceType.RasterImage){var {fullOpacity:ta}=oa;oa=null!=ta&&1>ta&&sa===E.ShaderOutput.Color?this.bindTemporaryFramebuffer(qa,
la):null;for(let Ca=0;Ca<da.numViews;Ca++)this._setViewParameters(da.extents[Ca],aa),za.render(this._renderContext);oa&&(ja.bind(ra,qa,la),this._overlayParameters.texture=oa.colorTexture,this._overlayParameters.opacity=ta,this._overlayParameters.overlayIndex=Y,za=this.pluginContext.techniqueRepository.acquire(V.OverlayCompositingTechnique),this._rctx.bindTechnique(za,this._overlayParameters,this._renderContext.bindParameters),this._rctx.screen.draw(),za.release(),oa.release())}});ra.bindFramebuffer(null);
Y===r.OverlayIndex.OUTER&&ja.generateMipMap();this._renderContext.resetRenderOccludedMask()}}}}bindTemporaryFramebuffer(Y,ea){const fa=this.view._stage.renderer.fboCache;Y=fa.acquire(C.ColorFormat.RGBA,Y,ea);fa.rctx.bindFramebuffer(Y.fbo);fa.rctx.clearSafe(X.ClearBufferBit.COLOR_BUFFER_BIT);return Y}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(Y,ea,fa,aa){let da=0;for(const ma of this._renderers.values())da=
ma.intersect?.(Y,ea,fa,aa,da)??da}_updateSortedDrapeSourceRenderers(){this._sortedRenderers.clear();if(0!==this._renderers.size){var Y=this.view.map.allLayers;this._renderers.forEach((ea,fa)=>{const aa=Y.indexOf(fa.layer),da=0<=aa;this._sortedRenderers.push(new ia(fa,ea,this._renderers.size*(fa.renderGroup??(da?t.DrapedRenderGroup.MapLayer:t.DrapedRenderGroup.ViewLayer))+(da?aa:0)))});this._sortedRenderers.sort((ea,fa)=>ea.index-fa.index)}}_setViewParameters(Y,ea){const fa=this._camera;fa.viewport=
[0,0,ea.resolution,ea.resolution];w.ortho(fa.projectionMatrix,0,Y[2]-Y[0],0,Y[3]-Y[1],fa.near,fa.far);w.fromTranslation(fa.viewMatrix,[-Y[0],-Y[1],0])}_updateHasWater(){const Y=d.someMap(this._renderers,ea=>ea.hasWater);Y!==this._hasWater&&(this._hasWater=Y,this.events.emit("has-water",Y))}_updateRendersOccluded(){const Y=d.someMap(this._renderers,ea=>ea.rendersOccluded);Y!==this._rendersOccluded&&(this._rendersOccluded=Y,this.events.emit("renders-occluded",Y))}_ensureDebugPatternResources(Y,ea){x.set(this._passParameters.color,
ea[0],ea[1],ea[2]);if(!this._passParameters.texture){ea=new Uint8Array(Y*Y*4);var fa=0;for(let aa=0;aa<Y;aa++)for(let da=0;da<Y;da++){const ma=Math.floor(da/10),ua=Math.floor(aa/10);2>ma||2>ua||10*ma>Y-20||10*ua>Y-20?(ea[fa++]=255,ea[fa++]=255,ea[fa++]=255,ea[fa++]=255):(ea[fa++]=255,ea[fa++]=255,ea[fa++]=255,ma&1&&ua&1?ea[fa++]=da&1^aa&1?0:255:ea[fa++]=ma&1^ua&1?0:128)}Y=new ba.TextureDescriptor(Y);Y.samplingMode=X.TextureSamplingMode.NEAREST;this._passParameters.texture=new ca.Texture(this._rctx,
Y,ea);Y=new Z.TextureTechniqueConfiguration;Y.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(U.TextureTechnique,Y)}}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:Y=>this._renderers.get(Y)}}};b.__decorate([l.property()],a.OverlayRenderer.prototype,"hasHighlights",void 0);b.__decorate([l.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);b.__decorate([l.property({autoDestroy:!0})],a.OverlayRenderer.prototype,
"_shaderTechniqueRepository",void 0);b.__decorate([l.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);b.__decorate([l.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);b.__decorate([l.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);b.__decorate([l.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);b.__decorate([l.property()],a.OverlayRenderer.prototype,"isEmpty",null);a.OverlayRenderer=b.__decorate([u.subclass("esri.views.3d.terrain.OverlayRenderer")],
a.OverlayRenderer);class ia{constructor(Y,ea,fa){this.drapeSource=Y;this.renderer=ea;this.index=fa}}const ka=[[1,.5,.5],[.5,.5,1]],na=J.RenderOccludedFlag.OccludeAndTransparent;a.drapedZ=-2;a.overlayRenderOccludedFlag=na;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));
a.DrapedRenderGroup=void 0;(function(b){b[b.MapLayer=0]="MapLayer";b[b.ViewLayer=1]="ViewLayer";b[b.Outline=2]="Outline";b[b.SnappingHint=3]="SnappingHint"})(a.DrapedRenderGroup||(a.DrapedRenderGroup={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],
function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=
1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Overlay":function(){define(["exports","../../../geometry/support/aaBoundingRect","../webgl-engine/lib/LocalOriginFactory"],function(a,b,g){class d{constructor(){this._extent=b.create();this.resolution=0;this.renderLocalOrigin=g.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new k}get extent(){return this._extent}setupGeometryViewsCyclical(m){this.setupGeometryViewsDirect();
var f=.001*m.range;if(this._extent[0]-f<=m.min){const c=this.canvasGeometries.extents[this.canvasGeometries.numViews++];b.offset(this._extent,m.range,0,c)}this._extent[2]+f>=m.max&&(f=this.canvasGeometries.extents[this.canvasGeometries.numViews++],b.offset(this._extent,-m.range,0,f))}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1;b.copy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let m=0;m<this.canvasGeometries.numViews;m++){const f=this.canvasGeometries.extents[m];
if(f[0]!==f[2]&&f[1]!==f[3])return!0}return!1}}class k{constructor(){this.extents=[b.create(),b.create(),b.create()];this.numViews=0}}a.Overlay=d;a.OverlayStretch=1.3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../chunks/vec3f64"],function(a,b){class g{constructor(d,k){this.vec3=d;this.id=k}}a.LocalOrigin=g;a.fromValues=function(d,k,m,f){return new g(b.fromValues(d,k,m),f)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayContent":function(){define(["exports"],function(a){a.OverlayContent=void 0;var b=a.OverlayContent||(a.OverlayContent={});b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.WaterNormal=3]="WaterNormal";b[b.Occluded=4]="Occluded";b[b.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderTargets":function(){define("exports ../../../core/has ./OverlayContent ./OverlayFramebufferObject ../webgl-engine/core/FBOCache ../webgl-engine/core/shaderLibrary/ShaderOutput".split(" "),
function(a,b,g,d,k,m){class f{constructor(l,e,p,h=k.ColorFormat.RGBA_MIPMAP){this.output=e;this.content=p;this.fbo=new d.OverlayFramebufferObject(l,h)}get valid(){return this.fbo.valid}}class c{constructor(l){this.targets=[new f(l,m.ShaderOutput.Color,g.OverlayContent.Color),new f(l,m.ShaderOutput.Color,g.OverlayContent.ColorNoRasterImage),new f(l,m.ShaderOutput.Highlight,g.OverlayContent.Highlight,k.ColorFormat.RGBA4),new f(l,m.ShaderOutput.Normal,g.OverlayContent.WaterNormal),new f(l,m.ShaderOutput.Color,
g.OverlayContent.Occluded)];b("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new f(l,m.ShaderOutput.ObjectAndLayerIdColor,g.OverlayContent.ObjectAndLayerIdColor))}getTexture(l){return this.targets[l]?.fbo.texture}dispose(){for(const l of this.targets)l.fbo.dispose()}computeValidity(){return this.targets.reduce((l,e,p)=>e.valid?l|=1<<p:l,0)}}a.OverlayRenderTargets=c;a.RenderTargetDescriptor=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define(["exports",
"../../../core/maybe"],function(a,b){class g{constructor(d,k){this._fbos=d;this._format=k}get valid(){return null!=this._handle}dispose(){this._handle=b.releaseMaybe(this._handle)}get texture(){return this._handle?.colorTexture}bind(d,k,m){this._handle&&this._handle.fbo.width===k&&this._handle.fbo.height===m||(this._handle?.release(),this._handle=this._fbos.acquire(this._format,k,m));d.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.colorTexture?.descriptor?.hasMipmap&&this._handle?.colorTexture?.generateMipmap()}}
a.OverlayFramebufferObject=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../chunks/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../../../terrain/OverlayContent ../../renderPasses/AllRenderPasses ../ShaderOutput ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(r,y){y.pbrMode!==l.PBRMode.Water&&y.pbrMode!==l.PBRMode.WaterOnIntegratedMesh&&y.pbrMode!==l.PBRMode.TerrainWithWater||r.include(e.Water,y);const {vertex:z,fragment:D}=r;r.varyings.add("vtcOverlay","vec4");z.code.add(u.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);D.code.add(u.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);D.code.add(u.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);D.code.add(u.glsl`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);if(y.pbrMode===l.PBRMode.Water||y.pbrMode===l.PBRMode.WaterOnIntegratedMesh||y.pbrMode===l.PBRMode.TerrainWithWater)c.addMainLightDirection(D),c.addMainLightIntensity(D),D.code.add(u.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function q(r,y){return r.identifier===m.RenderPassIdentifier.Material&&r.output===f.ShaderOutput.Color?y.overlay?.getTexture(k.OverlayContent.ColorNoRasterImage):r.identifier===m.RenderPassIdentifier.Material&&r.output===f.ShaderOutput.ObjectAndLayerIdColor?y.overlay?.getTexture(k.OverlayContent.ObjectAndLayerIdColor):r.identifier===m.RenderPassIdentifier.Highlight?y.overlay?.getTexture(k.OverlayContent.Highlight):null}a.OverlayMode=void 0;(function(r){r[r.Disabled=0]="Disabled";r[r.Enabled=1]=
"Enabled";r[r.EnabledWithWater=2]="EnabledWithWater";r[r.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));class t extends x.Uniform{constructor(r){super(r,"vec4")}}const v=b.create();a.OverlayIM=function(r,y){const {vertex:z,fragment:D}=r;z.uniforms.add(new p.Float4DrawUniform("overlayTexOffset",(C,E)=>{const A=E.overlay?.overlays[d.OverlayIndex.INNER]?.extent;g.hasArea(A)&&(v[0]=C.toMapSpace[0]/g.width(A)-A[0]/g.width(A),v[1]=C.toMapSpace[1]/g.height(A)-A[1]/g.height(A));E=E.overlay?.overlays[d.OverlayIndex.OUTER]?.extent;
g.hasArea(E)&&(v[2]=C.toMapSpace[0]/g.width(E)-E[0]/g.width(E),v[3]=C.toMapSpace[1]/g.height(E)-E[1]/g.height(E));return v}),new p.Float4DrawUniform("overlayTexScale",(C,E)=>{const A=E.overlay?.overlays[d.OverlayIndex.INNER]?.extent;g.hasArea(A)&&(v[0]=C.toMapSpace[2]/g.width(A),v[1]=C.toMapSpace[3]/g.height(A));E=E.overlay?.overlays[d.OverlayIndex.OUTER]?.extent;g.hasArea(E)&&(v[2]=C.toMapSpace[2]/g.width(E),v[3]=C.toMapSpace[3]/g.height(E));return v}));D.constants.add("overlayOpacity","float",1);
D.uniforms.add(new w.Texture2DPassUniform("ovColorTex",(C,E)=>q(C,E)));n(r,y)};a.OverlayTerrain=function(r,y){const {vertex:z,fragment:D}=r;z.uniforms.add(new t("overlayTexOffset"),new t("overlayTexScale"));D.uniforms.add(new h.FloatPassUniform("overlayOpacity",C=>C.overlayOpacity),new w.Texture2DPassUniform("ovColorTex",(C,E)=>E.overlay?.getTexture(C.overlayContent)));n(r,y)};a.getIMColorTexture=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports",
"../../../../../chunks/vec3f64","../shaderLibrary/ShaderOutput","../shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,g,d){class k extends d.VertexNormalPassParameters{constructor(){super(...arguments);this.origin=this.slicePlaneLocalOrigin=b.create();this.modelTransformation=null}}class m extends d.VertexNormalDrawParameters{}a.RenderPassIdentifier=void 0;(function(e){e[e.Material=0]="Material";e[e.ShadowMap=1]="ShadowMap";e[e.Highlight=2]="Highlight"})(a.RenderPassIdentifier||(a.RenderPassIdentifier=
{}));class f extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.Material;this.output=g.ShaderOutput.Color;this.transparent=!1}}class c extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.ShadowMap}}class l extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.Highlight}}a.DrawParameters=m;a.HighlightPassParameters=l;a.MaterialPassParameters=f;a.PassParameters=k;a.ShadowMapPassParameters=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,g,d,k,m,f,c,l,e){a.Water=function(p,h){p.include(d.PhysicallyBasedRenderingWater,
h);p.include(g.Gamma);p.include(b.FoamColor);h.hasCloudsReflections&&p.include(m.CloudsParallaxShading,h);h.hasScreenSpaceReflections&&p.include(k.ScreenSpaceReflections,h);p=p.fragment;p.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod",
"float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);p.code.add(c.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);p.uniforms.add(new f.FloatPassUniform("lightingSpecularStrength",(u,w)=>w.lighting.mainLight.specularStrength),new f.FloatPassUniform("lightingEnvironmentStrength",(u,w)=>w.lighting.mainLight.environmentStrength));p.code.add(c.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);h.hasCloudsReflections&&p.code.add(c.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);h.hasScreenSpaceReflections?(p.uniforms.add(new l.Matrix4PassUniform("view",(u,w)=>w.camera.viewMatrix),new e.Texture2DPassUniform("lastFrameColorTexture",(u,w)=>w.ssr.lastFrameColor?.colorTexture),new f.FloatPassUniform("fadeFactorSSR",(u,w)=>w.ssr.fadeFactor)),p.code.add(c.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):p.code.add(c.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);h.hasCloudsReflections?h.hasScreenSpaceReflections?p.code.add(c.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):p.code.add(c.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):p.code.add(c.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(g){g.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(g){g.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,g,d,k,m,f){a.ScreenSpaceReflections=function(c,l){c=c.fragment;c.include(b.ReadLinearDepth);
c.uniforms.add(new g.Float2PassUniform("nearFar",(e,p)=>p.camera.nearFar));c.uniforms.add(new f.Texture2DPassUniform("depthMap",(e,p)=>p.linearDepth?.colorTexture));c.uniforms.add(new m.Matrix4PassUniform("proj",(e,p)=>p.camera.projectionMatrix));c.uniforms.add(new d.FloatPassUniform("invResolutionHeight",(e,p)=>1/p.camera.height));c.uniforms.add(new m.Matrix4PassUniform("reprojectionMatrix",(e,p)=>p.ssr.reprojectionMatrix));c.code.add(k.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${l.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"vec4",g.BindType.Draw,(f,c,l)=>f.setUniform4fv(k,m(c,l)))}}a.Float4DrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f){function c(){const p=new m.ShaderBuilder;p.include(g.ScreenSpacePass);p.fragment.uniforms.add(new f.Texture2DPassUniform("tex",h=>h.texture),new d.Float4PassUniform("uColor",h=>h.color));p.fragment.code.add(k.glsl`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`);return p}class l extends k.NoParameters{constructor(){super(...arguments);this.color=b.fromValues(1,1,1,1)}}const e=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:l,build:c},Symbol.toStringTag,{value:"Module"}));a.TextureOnly=e;a.TextureOnlyPassParameters=l;a.build=c})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(a,b,g){class d{constructor(f){this._context=
f;this._perConstructorInstances=new b.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(f=>f.forEach(c=>c.technique.destroy()));this._perConstructorInstances.clear()}acquire(f,c=m){const l=c.key;let e=this._perConstructorInstances.get(f,l);if(null==e){const p=new f(this._context,c,()=>this.release(p));e=new k(p);this._perConstructorInstances.set(f,
l,e)}++e.refCount;return e.technique}releaseAndAcquire(f,c,l){if(null!=l){if(c.key===l.key)return l;this.release(l)}return this.acquire(f,c)}release(f){null==f||this._perConstructorInstances.empty||(f=this._perConstructorInstances.get(f.constructor,f.key),null!=f&&(--f.refCount,0===f.refCount&&(f.refZeroFrame=this._frameCounter)))}frameUpdate(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((f,c)=>{f.forEach((l,e)=>{0===l.refCount&&l.refZeroFrame+this._keepAliveFrameCount<
this._frameCounter&&(l.technique.destroy(),this._perConstructorInstances.delete(c,e))})})}async reloadAll(){const f=[];this._perConstructorInstances.forEach((c,l)=>{f.push((async(e,p)=>{if(p=p.shader)await p.reload(),e.forEach(h=>h.technique.reload(this._context))})(c,l))});await Promise.all(f)}}class k{constructor(f){this.technique=f;this.refZeroFrame=this.refCount=0}}const m=new g.ShaderTechniqueConfiguration;a.ShaderTechniqueRepository=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define(["exports","../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],function(a,b,g,d,k){class m{constructor(c,l,e,p){this._textureRepository=c;this._techniqueRepository=l;this.materialChanged=e;this.requestRender=p;this._id2glMaterialRef=new d.NestedMap}dispose(){this._textureRepository.destroy()}acquire(c,l,e){this._ownMaterial(c);if(!c.produces(l,e))return null;l=this._id2glMaterialRef.get(e,
c.id);null==l&&(l=c.createGLMaterial({material:c,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:e}),l=new f(l),this._id2glMaterialRef.set(e,c.id,l));l.ref();return l.glMaterial}release(c,l){const e=this._id2glMaterialRef.get(l,c.id);null!=e&&(e.unref(),e.referenced||(g.disposeMaybe(e.glMaterial),this._id2glMaterialRef.delete(l,c.id)))}_ownMaterial(c){c.repository&&c.repository!==this&&b.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");
c.repository=this}}class f{constructor(c){this.glMaterial=c;this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt;k.assert(0<=this._refCnt)}get referenced(){return 0<this._refCnt}}a.GLMaterialRepository=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/uid ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection/projectBuffer ./Attribute ./ContentObjectType ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){class n{constructor(t){this._originSR=t;this._rootOriginId="root/"+b.generateUID();this._origins=new Map;this._objects=new Map;this._gridSize=5E5}getOrigin(t){var v=this._origins.get(this._rootOriginId);if(null==v){v=h.gridLocalOriginFactory.rootOrigin;if(null!=v)return this._origins.set(this._rootOriginId,e.fromValues(v[0],v[1],v[2],this._rootOriginId)),this.getOrigin(t);t=e.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);
this._origins.set(this._rootOriginId,t);return t}var r=this._gridSize;const y=Math.round(t[0]/r),z=Math.round(t[1]/r),D=Math.round(t[2]/r),C=`${y}/${z}/${D}`;let E=this._origins.get(C);const A=.5*r;g.subtract(q,t,v.vec3);q[0]=Math.abs(q[0]);q[1]=Math.abs(q[1]);q[2]=Math.abs(q[2]);if(q[0]<A&&q[1]<A&&q[2]<A)return E&&(r=Math.max(...q),g.subtract(q,t,E.vec3),q[0]=Math.abs(q[0]),q[1]=Math.abs(q[1]),q[2]=Math.abs(q[2]),Math.max(...q)<r)?E:v;E||(E=e.fromValues(y*r,z*r,D*r,C),this._origins.set(C,E));return E}_drawOriginBox(t,
v=k.fromValues(1,1,0,1)){const r=window.view,y=r._stage;var z=v.toString();if(!this._objects.has(z)){this._material=new x.RibbonLineMaterial({width:2,color:v});y.add(this._material);v=new w.WebGLLayer(y,{pickable:!1});var D=new p.Object3D({castShadow:!1});y.add(D);v.add(D);this._objects.set(z,D)}z=this._objects.get(z);v=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];D=v.length;const C=Array(3*D),E=[],A=.5*this._gridSize;for(let F=0;F<D;F++)C[3*F]=t[0]+(v[F]&1?A:-A),C[3*F+1]=t[1]+(v[F]&2?A:-A),C[3*F+2]=t[2]+
(v[F]&4?A:-A),0<F&&E.push(F-1,F);m.projectBuffer(C,this._originSR,0,C,r.renderSpatialReference,0,D);t=new l.Geometry(this._material,[[u.VertexAttribute.POSITION,new f.Attribute(C,E,3,!0)]],null,c.ContentObjectType.Line);y.add(t);z.addGeometry(t)}get test(){const t=this;return{set gridSize(v){t._gridSize=v}}}}const q=d.create();a.GridLocalOriginFactory=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory=
{rootOrigin:null};a.textTextureAtlas={stableRendering:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),function(a,b,g,d,k,m,f,c,l,e){class p extends m.ContentObject{get objects(){return this._objects}constructor(h,u,w=""){super();
this.stage=h;this.apiLayerUid=w;this.type=f.ContentObjectType.Layer;this.events=new b;this.pickable=this.visible=!0;this.sliceable=!1;this._objects=new k;this._objectsAdded=new k;this._handles=new g;this.apiLayerUid=w;this.visible=u?.visible??!0;this.pickable=u?.pickable??!0;this.updatePolicy=u?.updatePolicy??e.UpdatePolicy.ASYNC;this._disableOctree=u?.disableOctree??!1;h.add(this);for(const x of c.DirtyEventNames)this._handles.add(this.events.on(x,n=>h.handleEvent(x,n)))}destroy(){this._handles.size&&
(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(h){this._objects.push(h);h.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:h});null!=this._octree&&this._objectsAdded.push(h)}remove(h){this._objects.removeUnordered(h)&&(h.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:h}),null!=this._octree&&(this._objectsAdded.removeUnordered(h)||this._octree.remove([h])))}addMany(h){this._objects.pushArray(h);for(const u of h)u.parentLayer=
this;this.events.emit("layerObjectsAdded",{layer:this,objects:h});null!=this._octree&&this._objectsAdded.pushArray(h)}removeMany(h){const u=[];this._objects.removeUnorderedMany(h,h.length,u);if(0!==u.length){for(const w of u)w.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:u});if(null!=this._octree){for(h=0;h<u.length;)this._objectsAdded.removeUnordered(u[h])?(u[h]=u[u.length-1],--u.length):++h;this._octree.remove(u)}}}sync(){this.updatePolicy!==e.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(h,
u){null==this._octree||this._objectsAdded.includes(h)||this._octree.update(h,u)}getSpatialQueryAccelerator(){null==this._octree&&50<this._objects.length&&!this._disableOctree?(this._octree=new l(h=>h.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree}invalidateSpatialQueryAccelerator(){this._octree=
d.destroyMaybe(this._octree);this._objectsAdded.clear()}}a.WebGLLayer=p;a.isWebGLLayer=function(h){return null!=h&&h.type===f.ContentObjectType.Layer};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved transformationChanged shaderTransformationChanged visibilityChanged occlusionChanged highlightChanged geometryAdded geometryRemoved attributesChanged".split(" ");
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,b,g,d,k,m,f,c){function l(L,J,M){M[0]=L[0]+J;M[1]=L[1]+J;M[2]=L[2]+J}function e(L,J,M,T){if(1===J)L=M(L[0]),f.copy(L,T);else{D[0]=Infinity;D[1]=
Infinity;D[2]=Infinity;C[0]=-Infinity;C[1]=-Infinity;C[2]=-Infinity;for(let Z=0;Z<J;Z++){var Q=M(L[Z]);if(w(Q[3])){var O=D,U=Q;O[0]=Math.min(O[0],U[0]-U[3]);O[1]=Math.min(O[1],U[1]-U[3]);O[2]=Math.min(O[2],U[2]-U[3]);O=C;O[0]=Math.max(O[0],Q[0]+Q[3]);O[1]=Math.max(O[1],Q[1]+Q[3]);O[2]=Math.max(O[2],Q[2]+Q[3])}}g.lerp(T,D,C,.5);T[3]=Math.max(C[0]-D[0],C[1]-D[1],C[2]-D[2])/2}}function p(L,J,M){if(!B.length)for(var T=0;8>T;++T)B.push({index:0,distance:0});for(T=0;8>T;++T){const Q=q[T];B.data[T].index=
T;B.data[T].distance=u(L,J,Q)}B.sort((Q,O)=>Q.distance-O.distance);for(L=0;8>L;++L)M[L]=B.data[L].index}function h(L,J){let M=Infinity,T;for(let Q=0;8>Q;++Q){const O=u(L,J,t[Q]);O<M&&(M=O,T=t[Q])}return T}function u(L,J,M){return J*(L[0]*M[0]+L[1]*M[1]+L[2]*M[2])}function w(L){return!isNaN(L)&&-Infinity!==L&&Infinity!==L&&0<L}class x{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(L,
J){this.objectToBoundingSphere=L;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new n;this._objectCount=0;J&&(void 0!==J.maximumObjectsPerNode&&(this._maximumObjectsPerNode=J.maximumObjectsPerNode),void 0!==J.maximumDepth&&(this._maximumDepth=J.maximumDepth))}destroy(){this._degenerateObjects.clear();n.clearPool();r[0]=null;E.prune();B.prune()}add(L,J=L.length){this._objectCount+=J;this._grow(L,J);const M=n.acquire();for(let T=0;T<J;T++){const Q=L[T];
this._isDegenerate(Q)?this._degenerateObjects.add(Q):(M.init(this._root),this._add(Q,M))}n.release(M)}remove(L,J=null){this._objectCount-=L.length;const M=n.acquire();for(const T of L)L=null!=J?J:f.copy(this.objectToBoundingSphere(T),A),w(L[3])?(M.init(this._root),this._remove(T,L,M)):this._degenerateObjects.delete(T);n.release(M);this._shrink()}update(L,J){if(w(J[3])||!this._isDegenerate(L))r[0]=L,L=r,this.remove(L,J),this.add(L)}forEachAlongRay(L,J,M){const T=m.wrap(L,J);this._forEachNode(this._root,
Q=>{if(!this._intersectsNode(T,Q))return!1;Q=Q.node;Q.terminals.forAll(O=>{this._intersectsObject(T,O)&&M(O)});null!==Q.residents&&Q.residents.forAll(O=>{this._intersectsObject(T,O)&&M(O)});return!0})}forEachAlongRayWithVerticalOffset(L,J,M,T){const Q=m.wrap(L,J);this._forEachNode(this._root,O=>{if(!this._intersectsNodeWithOffset(Q,O,T))return!1;O=O.node;O.terminals.forAll(U=>{this._intersectsObjectWithOffset(Q,U,T)&&M(U)});null!==O.residents&&O.residents.forAll(U=>{this._intersectsObjectWithOffset(Q,
U,T)&&M(U)});return!0})}forEach(L){this._forEachNode(this._root,J=>{J=J.node;J.terminals.forAll(L);null!==J.residents&&J.residents.forAll(L);return!0});this._degenerateObjects.forEach(L)}forEachDegenerateObject(L){this._degenerateObjects.forEach(L)}findClosest(L,J,M,T=()=>!0,Q=Infinity){let O=Infinity,U=Infinity,Z=null;const P=h(L,J),R=W=>{--Q;if(T(W)){var N=this.objectToBoundingSphere(W);if(k.intersectsSphere(M,N)){var V=u(L,J,f.getCenter(N)),S=V-N[3];N=V+N[3];S<O&&(O=S,U=N,Z=W)}}};this._forEachNodeDepthOrdered(this._root,
W=>{if(0>=Q||!k.intersectsSphere(M,W.bounds))return!1;g.scale(z,P,W.halfSize);g.add(z,z,W.bounds);if(u(L,J,z)>U)return!1;W=W.node;W.terminals.forAll(N=>R(N));null!==W.residents&&W.residents.forAll(N=>R(N));return!0},L,J);return Z}forEachInDepthRange(L,J,M,T,Q,O,U){let Z=-Infinity,P=Infinity;const R={setRange:X=>{M===x.DepthOrder.FRONT_TO_BACK?(Z=Math.max(Z,X.near),P=Math.min(P,X.far)):(Z=Math.max(Z,-X.far),P=Math.min(P,-X.near))}};R.setRange(T);const W=u(J,M,L),N=h(J,M),V=h(J,-M),S=X=>{if(U(X)){var ca=
this.objectToBoundingSphere(X),ba=f.getCenter(ca);ba=u(J,M,ba)-W;var ia=ba+ca[3];ba-ca[3]>P||ia<Z||!k.intersectsSphere(O,ca)||Q(X,R)}};this._forEachNodeDepthOrdered(this._root,X=>{if(!k.intersectsSphere(O,X.bounds))return!1;g.scale(z,N,X.halfSize);g.add(z,z,X.bounds);if(u(J,M,z)-W>P)return!1;g.scale(z,V,X.halfSize);g.add(z,z,X.bounds);if(u(J,M,z)-W<Z)return!1;X=X.node;X.terminals.forAll(ca=>S(ca));null!==X.residents&&X.residents.forAll(ca=>S(ca));return!0},J,M)}forEachNode(L){this._forEachNode(this._root,
J=>L(J.node,J.bounds,J.halfSize,J.depth))}forEachNeighbor(L,J){const M=f.getRadius(J),T=f.getCenter(J),Q=Z=>{const P=this.objectToBoundingSphere(Z);var R=f.getRadius(P);R=M+R;return 0>=g.squaredDistance(f.getCenter(P),T)-R*R?L(Z):!0};let O=!0;const U=Z=>{O&&(O=Q(Z))};this._forEachNode(this._root,Z=>{var P=f.getRadius(Z.bounds);P=M+P;if(0<g.squaredDistance(f.getCenter(Z.bounds),T)-P*P)return!1;Z=Z.node;Z.terminals.forAll(U);O&&null!==Z.residents&&Z.residents.forAll(U);return O});O&&this.forEachDegenerateObject(U)}_intersectsNode(L,
J){l(J.bounds,2*-J.halfSize,D);l(J.bounds,2*J.halfSize,C);return c.rayBoxTest(L.origin,L.direction,D,C)}_intersectsNodeWithOffset(L,J,M){l(J.bounds,2*-J.halfSize,D);l(J.bounds,2*J.halfSize,C);M.applyToMinMax(D,C);return c.rayBoxTest(L.origin,L.direction,D,C)}_intersectsObject(L,J){J=this.objectToBoundingSphere(J);return 0<J[3]?f.intersectsRay(J,L):!0}_intersectsObjectWithOffset(L,J,M){J=this.objectToBoundingSphere(J);return 0<J[3]?f.intersectsRay(M.applyToBoundingSphere(J),L):!0}_forEachNode(L,J){L=
n.acquire().init(L);const M=[L];for(;0!==M.length;){L=M.pop();if(J(L)&&!L.isLeaf())for(let T=0;T<L.node.children.length;T++)L.node.children[T]&&M.push(n.acquire().init(L).advance(T));n.release(L)}}_forEachNodeDepthOrdered(L,J,M,T=x.DepthOrder.FRONT_TO_BACK){L=n.acquire().init(L);const Q=[L];for(p(M,T,K);0!==Q.length;){L=Q.pop();if(J(L)&&!L.isLeaf())for(M=7;0<=M;--M)T=K[M],L.node.children[T]&&Q.push(n.acquire().init(L).advance(T));n.release(L)}}_remove(L,J,M){E.clear();J=M.advanceTo(J,(T,Q)=>{E.push(T.node);
E.push(Q)})?M.node.terminals:M.node.residents;J.removeUnordered(L);if(0===J.length)for(L=E.length-2;0<=L&&this._purge(E.data[L],E.data[L+1]);L-=2);}_nodeIsEmpty(L){if(0!==L.terminals.length)return!1;if(null!==L.residents)return 0===L.residents.length;for(let J=0;J<L.children.length;J++)if(L.children[J])return!1;return!0}_purge(L,J){0<=J&&(L.children[J]=null);return this._nodeIsEmpty(L)?(null===L.residents&&(L.residents=new b({shrink:!0})),!0):!1}_add(L,J){J.advanceTo(this.objectToBoundingSphere(L))?
J.node.terminals.push(L):(J.node.residents.push(L),J.node.residents.length>this._maximumObjectsPerNode&&J.depth<this._maximumDepth&&this._split(J))}_split(L){const J=L.node.residents;L.node.residents=null;for(let M=0;M<J.length;M++){const T=n.acquire().init(L);this._add(J.at(M),T);n.release(T)}}_grow(L,J){0!==J&&(e(L,J,M=>this.objectToBoundingSphere(M),F),w(F[3])&&!this._fitsInsideTree(F)&&(this._nodeIsEmpty(this._root.node)?(f.copy(F,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],
this._root.updateBoundsRadiusFromHalfSize()):(L=this._rootBoundsForRootAsSubNode(F),this._placingRootViolatesMaxDepth(L)?this._rebuildTree(F,L):this._growRootAsSubNode(L),n.release(L))))}_rebuildTree(L,J){g.copy(G,J.bounds);G[3]=J.halfSize;e([L,G],2,M=>M,I);L=n.acquire().init(this._root);this._root.initFrom(null,I,I[3]);this._root.increaseHalfSize(1.25);this._forEachNode(L,M=>{this.add(M.node.terminals.data,M.node.terminals.length);null!==M.node.residents&&this.add(M.node.residents.data,M.node.residents.length);
return!0});n.release(L)}_placingRootViolatesMaxDepth(L){const J=Math.log(L.halfSize/this._root.halfSize)*Math.LOG2E;let M=0;this._forEachNode(this._root,T=>{M=Math.max(M,T.depth);return M+J<=this._maximumDepth});return M+J>this._maximumDepth}_rootBoundsForRootAsSubNode(L){var J=L[3],M=-Infinity;const T=this._root.bounds,Q=this._root.halfSize;for(var O=0;3>O;O++){var U=Math.max(0,Math.ceil((T[O]-Q-(L[O]-J))/(2*Q)));const Z=Math.max(0,Math.ceil((L[O]+J-(T[O]+Q))/(2*Q)))+1;M=Math.max(M,2**Math.ceil(Math.log(U+
Z)*Math.LOG2E));H[O].min=U;H[O].max=Z}for(L=0;3>L;L++)J=H[L].min,O=H[L].max,U=(M-(J+O))/2,J+=Math.ceil(U),O+=Math.floor(U),y[L]=T[L]-Q-J*Q*2+(O+J)*Q;M*=Q;y[3]=M*v;return n.acquire().initFrom(null,y,M,0)}_growRootAsSubNode(L){const J=this._root.node;g.copy(F,this._root.bounds);F[3]=this._root.halfSize;this._root.init(L);L.advanceTo(F,null,!0);L.node.children=J.children;L.node.residents=J.residents;L.node.terminals=J.terminals}_shrink(){for(;;){const L=this._findShrinkIndex();if(-1===L)break;this._root.advance(L);
this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let L=null;const J=this._root.node.children;let M=0,T=0;for(;T<J.length&&null==L;)M=T++,L=J[M];for(;T<J.length;)if(J[T++])return-1;return M}_isDegenerate(L){L=this.objectToBoundingSphere(L)[3];return!w(L)}_fitsInsideTree(L){const J=this._root.bounds,M=this._root.halfSize;return L[3]<=M&&L[0]>=J[0]-M&&L[0]<=J[0]+M&&L[1]>=J[1]-M&&L[1]<=J[1]+M&&L[2]>=J[2]-M&&L[2]<=J[2]+M}toJSON(){const {maximumDepth:L,
maximumObjectsPerNode:J,_objectCount:M}=this,T=this._nodeToJSON(this._root.node);return{maximumDepth:L,maximumObjectsPerNode:J,objectCount:M,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:T}}}_nodeToJSON(L){const J=L.children.map(T=>T?this._nodeToJSON(T):null),M=L.residents?.map(T=>this.objectToBoundingSphere(T));L=L.terminals?.map(T=>this.objectToBoundingSphere(T));return{children:J,residents:M,terminals:L}}static fromJSON(L){const J=new x(M=>M,{maximumDepth:L.maximumDepth,
maximumObjectsPerNode:L.maximumObjectsPerNode});J._objectCount=L.objectCount;J._root.initFrom(L.root.node,L.root.bounds,L.root.halfSize,L.root.depth);return J}}class n{constructor(){this.bounds=f.create();this.halfSize=0;this.initFrom(null,null,0,0)}init(L){return this.initFrom(L.node,L.bounds,L.halfSize,L.depth)}initFrom(L,J,M,T=this.depth){this.node=null!=L?L:n.createEmptyNode();null!=J&&f.copy(J,this.bounds);this.halfSize=M;this.depth=T;return this}increaseHalfSize(L){this.halfSize*=L;this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=
this.halfSize*v}advance(L){let J=this.node.children[L];J||(J=n.createEmptyNode(),this.node.children[L]=J);this.node=J;this.halfSize/=2;this.depth++;L=q[L];this.bounds[0]+=L[0]*this.halfSize;this.bounds[1]+=L[1]*this.halfSize;this.bounds[2]+=L[2]*this.halfSize;this.updateBoundsRadiusFromHalfSize();return this}advanceTo(L,J,M=!1){for(;;){if(this.isTerminalFor(L))return J&&J(this,-1),!0;if(this.isLeaf()){if(!M)return J&&J(this,-1),!1;this.node.residents=null}const T=this._childIndex(L);J&&J(this,T);
this.advance(T)}}isLeaf(){return null!=this.node.residents}isTerminalFor(L){return L[3]>this.halfSize/2}_childIndex(L){const J=this.bounds;return(J[0]<L[0]?1:0)+(J[1]<L[1]?2:0)+(J[2]<L[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new b({shrink:!0}),residents:new b({shrink:!0})}}static acquire(){return n._pool.acquire()}static release(L){n._pool.release(L)}static clearPool(){n._pool.prune()}}n._pool=new a(n);(function(L){L=L.DepthOrder||(L.DepthOrder=
{});L[L.FRONT_TO_BACK=1]="FRONT_TO_BACK";L[L.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(x||(x={}));const q=[d.fromValues(-1,-1,-1),d.fromValues(1,-1,-1),d.fromValues(-1,1,-1),d.fromValues(1,1,-1),d.fromValues(-1,-1,1),d.fromValues(1,-1,1),d.fromValues(-1,1,1),d.fromValues(1,1,1)],t=[d.fromValues(-1,-1,-1),d.fromValues(-1,-1,1),d.fromValues(-1,1,-1),d.fromValues(-1,1,1),d.fromValues(1,-1,-1),d.fromValues(1,-1,1),d.fromValues(1,1,-1),d.fromValues(1,1,1)],v=Math.sqrt(3),r=[null],y=f.create(),z=d.create(),D=
d.create(),C=d.create(),E=new b,A=f.create(),F=f.create(),G=f.create(),I=f.create(),H=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],B=new b,K=[0,0,0,0,0,0,0,0];return x})},"esri/views/3d/webgl-engine/lib/UpdatePolicy":function(){define(["exports"],function(a){a.UpdatePolicy=void 0;var b=a.UpdatePolicy||(a.UpdatePolicy={});b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C){function E(ka,na,Y,ea,fa){for(let aa=0;aa<fa;aa++)Y[ea++]=ka[na++];return ea}var A;(function(ka){ka[ka.LEFT_JOIN_START=-2]="LEFT_JOIN_START";ka[ka.LEFT_JOIN_END=-1]="LEFT_JOIN_END";ka[ka.LEFT_CAP_START=-4]="LEFT_CAP_START";ka[ka.LEFT_CAP_END=-5]="LEFT_CAP_END";ka[ka.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";ka[ka.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";ka[ka.RIGHT_CAP_START=4]="RIGHT_CAP_START";ka[ka.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(A||(A={}));class F extends n.Material{constructor(ka){super(ka,
new I);this._configuration=new C.RibbonLineTechniqueConfiguration;this._vertexAttributeLocations=D.vertexAttributeLocations}getConfiguration(ka,na){this._configuration.output=ka;this._configuration.draped=na.slot===q.RenderSlot.DRAPED_MATERIAL;ka=null!=this.parameters.stipplePattern&&ka!==w.ShaderOutput.Highlight;this._configuration.stippleEnabled=ka;this._configuration.stippleOffColorEnabled=ka&&null!=this.parameters.stippleOffColor;this._configuration.stipplePreferContinuous=ka&&this.parameters.stipplePreferContinuous;
this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;ka=this._configuration;if(null!=this.parameters.markerParameters){var Y=this.parameters.markerParameters;Y=Y.anchor===y.LineMarkerAnchor.Tip&&Y.hideOnShortSegments&&"begin-end"===Y.placement&&Y.worldSpace}else Y=!1;ka.applyMarkerOffset=Y;this._configuration.hasPolygonOffset=
this.parameters.hasPolygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&null!=this.parameters.innerColor;this._configuration.falloffEnabled=0<this.parameters.falloff;this._configuration.occluder=this.parameters.renderOccluded===n.RenderOccludedFlag.OccludeAndTransparentStencil;
this._configuration.transparencyPassType=na.transparencyPassType;this._configuration.multipassEnabled=na.multipassEnabled;this._configuration.cullAboveGround=na.multipassTerrain.cullAboveGround;this._configuration.wireframe=this.parameters.wireframe;return this._configuration}intersectDraped(ka,na,Y,ea,fa,aa){if(Y.options.selectionMode){na=ka.attributes.get(v.VertexAttribute.POSITION).data;Y=ka.attributes.get(v.VertexAttribute.SIZE);var da=this.parameters.width;this.parameters.vvSize?(Y=ka.attributes.get(v.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],
da*=d.clamp(this.parameters.vvSize.offset[0]+Y*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):Y&&(da*=Y.data[0]);Y=ea[0];ea=ea[1];ka=(da/2+4)*ka.screenToWorldRatio;da=Number.MAX_VALUE;var ma=0;for(let qa=0;qa<na.length-5;qa+=3){var ua=na[qa],sa=na[qa+1],ra=Y-ua,Aa=ea-sa;ua=na[qa+3]-ua;sa=na[qa+4]-sa;const la=d.clamp((ua*ra+sa*Aa)/(ua*ua+sa*sa),0,1);ra=ua*la-ra;Aa=sa*la-Aa;Aa=ra*ra+Aa*Aa;Aa<da&&(da=Aa,ma=qa/3)}da<ka*ka&&fa(aa.dist,aa.normal,ma,
!1)}}intersect(ka,na,Y,ea,fa,aa){if(Y.options.selectionMode&&ka.visible)if(t.isTranslationMatrix(na)){var da=ka.attributes;ea=da.get(v.VertexAttribute.POSITION).data;ka=this.parameters.width;this.parameters.vvSize?(fa=da.get(v.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],ka*=d.clamp(this.parameters.vvSize.offset[0]+fa*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):da.has(v.VertexAttribute.SIZE)&&(ka*=da.get(v.VertexAttribute.SIZE).data[0]);
var ma=Y.camera,ua=M;m.copy(ua,Y.point);fa=ka*ma.pixelRatio/2+4*ma.pixelRatio;f.set(V[0],ua[0]-fa,ua[1]+fa,0);f.set(V[1],ua[0]+fa,ua[1]+fa,0);f.set(V[2],ua[0]+fa,ua[1]-fa,0);f.set(V[3],ua[0]-fa,ua[1]-fa,0);for(ka=0;4>ka;ka++)if(!ma.unprojectFromRenderScreen(V[ka],S[ka]))return;h.fromPoints(ma.eye,S[0],S[1],X);h.fromPoints(ma.eye,S[1],S[2],ca);h.fromPoints(ma.eye,S[2],S[3],ba);h.fromPoints(ma.eye,S[3],S[0],ia);var sa=Number.MAX_VALUE;ka=0;da=this.parameters.isClosed&&2<da.get(v.VertexAttribute.POSITION).indices.length?
ea.length-2:ea.length-5;for(let Aa=0;Aa<da;Aa+=3){B[0]=ea[Aa]+na[12];B[1]=ea[Aa+1]+na[13];B[2]=ea[Aa+2]+na[14];var ra=(Aa+3)%ea.length;K[0]=ea[ra]+na[12];K[1]=ea[ra+1]+na[13];K[2]=ea[ra+2]+na[14];if(!(0>h.signedDistance(X,B)&&0>h.signedDistance(X,K)||0>h.signedDistance(ca,B)&&0>h.signedDistance(ca,K)||0>h.signedDistance(ba,B)&&0>h.signedDistance(ba,K)||0>h.signedDistance(ia,B)&&0>h.signedDistance(ia,K))){ma.projectToRenderScreen(B,T);ma.projectToRenderScreen(K,Q);if(0>T[2]&&0<Q[2])f.subtract(L,B,
K),ra=ma.frustum,ra=-h.signedDistance(ra[e.PlaneIndex.NEAR],B)/f.dot(L,h.normal(ra[e.PlaneIndex.NEAR])),f.scale(L,L,ra),f.add(B,B,L),ma.projectToRenderScreen(B,T);else if(0<T[2]&&0>Q[2])f.subtract(L,K,B),ra=ma.frustum,ra=-h.signedDistance(ra[e.PlaneIndex.NEAR],K)/f.dot(L,h.normal(ra[e.PlaneIndex.NEAR])),f.scale(L,L,ra),f.add(K,K,L),ma.projectToRenderScreen(K,Q);else if(0>T[2]&&0>Q[2])continue;T[2]=0;Q[2]=0;ra=p.distance2(p.fromPoints(T,Q,Z),ua);ra<sa&&(sa=ra,f.copy(O,B),f.copy(U,K),ka=Aa/3)}}na=Y.rayBegin;
Y=Y.rayEnd;sa<fa*fa&&(ea=Number.MAX_VALUE,p.closestLineSegmentPoint(p.fromPoints(O,U,Z),p.fromPoints(na,Y,P),J)&&(f.subtract(J,J,na),ea=f.length(J),f.scale(J,J,1/ea),ea/=f.distance(na,Y)),aa(ea,J,ka,!1))}else g.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")}get _layout(){const ka=u.newLayout().vec3f(v.VertexAttribute.POSITION).f32(v.VertexAttribute.SUBDIVISIONFACTOR).vec2f(v.VertexAttribute.UV0).vec3f(v.VertexAttribute.AUXPOS1).vec3f(v.VertexAttribute.AUXPOS2);
this.parameters.vvSize?ka.f32(v.VertexAttribute.SIZEFEATUREATTRIBUTE):ka.f32(v.VertexAttribute.SIZE);this.parameters.vvColor?ka.f32(v.VertexAttribute.COLORFEATUREATTRIBUTE):ka.vec4f(v.VertexAttribute.COLOR);this.parameters.vvOpacity&&ka.f32(v.VertexAttribute.OPACITYFEATUREATTRIBUTE);b("enable-feature:objectAndLayerId-rendering")&&ka.vec4u8(v.VertexAttribute.OBJECTANDLAYERIDCOLOR);return ka}createBufferWriter(){return new H(this._layout,this.parameters)}produces(ka,na){return na===w.ShaderOutput.Color||
na===w.ShaderOutput.Alpha||na===w.ShaderOutput.Highlight||na===w.ShaderOutput.Depth||na===w.ShaderOutput.ObjectAndLayerIdColor?ka===q.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===n.RenderOccludedFlag.OccludeAndTransparentStencil?ka===q.RenderSlot.OPAQUE_MATERIAL||ka===q.RenderSlot.OCCLUDER_MATERIAL||ka===q.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:na===w.ShaderOutput.Color||na===w.ShaderOutput.Alpha?ka===(this.parameters.writeDepth?q.RenderSlot.TRANSPARENT_MATERIAL:q.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):
ka===q.RenderSlot.OPAQUE_MATERIAL:!1}createGLMaterial(ka){return new G(ka)}validateParameters(ka){"miter"!==ka.join&&(ka.miterLimit=0);null!=ka.markerParameters&&(ka.markerScale=ka.markerParameters.width/ka.width)}}class G extends x{constructor(){super(...arguments);this._stipplePattern=null}dispose(){super.dispose();this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null}_updateOccludeeState(ka){ka.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ka.hasOccludees})}beginSlot(ka){this._output!==
w.ShaderOutput.Color&&this._output!==w.ShaderOutput.Alpha||this._updateOccludeeState(ka);const na=this._material.parameters.stipplePattern;this._stipplePattern!==na&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(na,this._stipplePattern)}),this._stipplePattern=na);return this.ensureTechnique(D.RibbonLineTechnique,ka)}}class I extends r.VisualVariablePassParameters{constructor(){super(...arguments);this.width=0;this.color=l.ONES;this.join="miter";this.cap=C.CapType.BUTT;
this.miterLimit=5;this.writeDepth=!0;this.hasPolygonOffset=!1;this.stippleTexture=null;this.stipplePreferContinuous=!0;this.markerParameters=null;this.markerScale=1;this.isClosed=this.vvFastUpdate=this.hasSlicePlane=!1;this.innerWidth=this.falloff=0;this.wireframe=this.hasOccludees=!1}}class H{constructor(ka,na){this.vertexBufferLayout=ka;this._parameters=na;this.numJoinSubdivisions=0;ka=na.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=ka;break;
case "round":this.numJoinSubdivisions=z.ribbonlineNumRoundJoinSubdivisions+ka}}_isClosed(ka){return this._parameters.isClosed?2<ka.attributes.get(v.VertexAttribute.POSITION).indices.length:!1}allocate(ka){return this.vertexBufferLayout.createBuffer(ka)}elementCount(ka){var na=ka.attributes.get(v.VertexAttribute.POSITION).indices.length/2+1;ka=this._isClosed(ka);na=(ka?2:4)+((ka?na:na-1)-(ka?0:1))*(2*this.numJoinSubdivisions+4);na+=2;this._parameters.wireframe&&(na=2+4*(na-2));return na}write(ka,na,
Y,ea,fa){na=R;const aa=W,da=N,ma=Y.attributes.get(v.VertexAttribute.POSITION);var ua=ma.indices;const sa=ma.data.length/3,ra=Y.attributes.get(v.VertexAttribute.DISTANCETOSTART)?.data;ua&&ua.length!==2*(sa-1)&&console.warn("RibbonLineMaterial does not support indices");let Aa=1,qa=0;const la=this.vertexBufferLayout.fields.has(v.VertexAttribute.SIZEFEATUREATTRIBUTE);la?qa=Y.attributes.get(v.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:Y.attributes.has(v.VertexAttribute.SIZE)&&(Aa=Y.attributes.get(v.VertexAttribute.SIZE).data[0]);
let ja=[1,1,1,1],oa=0;const za=this.vertexBufferLayout.fields.has(v.VertexAttribute.COLORFEATUREATTRIBUTE);za?oa=Y.attributes.get(v.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:Y.attributes.has(v.VertexAttribute.COLOR)&&(ja=Y.attributes.get(v.VertexAttribute.COLOR).data);const ta=b("enable-feature:objectAndLayerId-rendering")?Y.objectAndLayerIdColor:null;let Ca=0;const Ga=this.vertexBufferLayout.fields.has(v.VertexAttribute.OPACITYFEATUREATTRIBUTE);Ga&&(Ca=Y.attributes.get(v.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);
const La=new Float32Array(ea.buffer),Ma=b("enable-feature:objectAndLayerId-rendering")?new Uint8Array(ea.buffer):null;ua=this.vertexBufferLayout.stride/4;let Ra=fa*ua;fa=Ra;let Ya=0;const ab=ra?(Ka,ha,Sa)=>Ya=ra[Sa]:(Ka,ha,Sa)=>Ya+=f.distance(Ka,ha),Wa=b("enable-feature:objectAndLayerId-rendering"),cb=(Ka,ha,Sa,Va,wa,Ba,Ja)=>{La[Ra++]=ha[0];La[Ra++]=ha[1];La[Ra++]=ha[2];La[Ra++]=Va;La[Ra++]=Ja;La[Ra++]=wa;La[Ra++]=Ka[0];La[Ra++]=Ka[1];La[Ra++]=Ka[2];La[Ra++]=Sa[0];La[Ra++]=Sa[1];La[Ra++]=Sa[2];La[Ra++]=
la?qa:Aa;za?La[Ra++]=oa:(Ka=Math.min(4*Ba,ja.length-4),La[Ra++]=ja[Ka],La[Ra++]=ja[Ka+1],La[Ra++]=ja[Ka+2],La[Ra++]=ja[Ka+3]);Ga&&(La[Ra++]=Ca);Wa&&(null!=ta&&(Ma[4*Ra]=ta[0],Ma[4*Ra+1]=ta[1],Ma[4*Ra+2]=ta[2],Ma[4*Ra+3]=ta[3]),Ra++)};Ra+=ua;f.set(aa,ma.data[0],ma.data[1],ma.data[2]);ka&&f.transformMat4(aa,aa,ka);if(Y=this._isClosed(Y)){var Na=ma.data.length-3;f.set(na,ma.data[Na],ma.data[Na+1],ma.data[Na+2]);ka&&f.transformMat4(na,na,ka)}else f.set(da,ma.data[3],ma.data[4],ma.data[5]),ka&&f.transformMat4(da,
da,ka),cb(aa,aa,da,1,A.LEFT_CAP_START,0,0),cb(aa,aa,da,1,A.RIGHT_CAP_START,0,0),f.copy(na,aa),f.copy(aa,da);Na=Y?0:1;const xa=Y?sa:sa-1;for(let Ka=Na;Ka<xa;Ka++){var Da=(Ka+1)%sa*3;f.set(da,ma.data[Da],ma.data[Da+1],ma.data[Da+2]);ka&&f.transformMat4(da,da,ka);ab(na,aa,Ka);cb(na,aa,da,0,A.LEFT_JOIN_END,Ka,Ya);cb(na,aa,da,0,A.RIGHT_JOIN_END,Ka,Ya);Da=this.numJoinSubdivisions;for(let ha=0;ha<Da;++ha){const Sa=(ha+1)/(Da+1);cb(na,aa,da,Sa,A.LEFT_JOIN_END,Ka,Ya);cb(na,aa,da,Sa,A.RIGHT_JOIN_END,Ka,Ya)}cb(na,
aa,da,1,A.LEFT_JOIN_START,Ka,Ya);cb(na,aa,da,1,A.RIGHT_JOIN_START,Ka,Ya);f.copy(na,aa);f.copy(aa,da)}Y?(f.set(da,ma.data[3],ma.data[4],ma.data[5]),ka&&f.transformMat4(da,da,ka),Ya=ab(na,aa,xa),cb(na,aa,da,0,A.LEFT_JOIN_END,Na,Ya),cb(na,aa,da,0,A.RIGHT_JOIN_END,Na,Ya)):(Ya=ab(na,aa,xa),cb(na,aa,aa,0,A.LEFT_CAP_END,xa,Ya),cb(na,aa,aa,0,A.RIGHT_CAP_END,xa,Ya));E(La,fa+ua,La,fa,ua);Ra=E(La,Ra-ua,La,Ra,ua);this._parameters.wireframe&&this._addWireframeVertices(ea,fa,Ra,ua)}_addWireframeVertices(ka,na,
Y,ea){const fa=new Float32Array(ka.buffer,Y*Float32Array.BYTES_PER_ELEMENT);ka=new Float32Array(ka.buffer,na*Float32Array.BYTES_PER_ELEMENT,Y-na);na=0;for(Y=0;Y<ka.length-1;Y+=2*ea)na=E(ka,Y,fa,na,ea),na=E(ka,Y+2*ea,fa,na,ea),na=E(ka,Y+1*ea,fa,na,ea),na=E(ka,Y+2*ea,fa,na,ea),na=E(ka,Y+1*ea,fa,na,ea),na=E(ka,Y+3*ea,fa,na,ea)}}const B=c.create(),K=c.create(),L=c.create(),J=c.create(),M=c.create(),T=k.createRenderScreenPointArray3(),Q=k.createRenderScreenPointArray3(),O=c.create(),U=c.create(),Z=p.create(),
P=p.create(),R=c.create(),W=c.create(),N=c.create(),V=[k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3()],S=[c.create(),c.create(),c.create(),c.create()],X=h.create(),ca=h.create(),ba=h.create(),ia=h.create();a.Parameters=I;a.RibbonLineMaterial=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m){a.LineMarkerSpace=void 0;(function(c){c[c.Draped=0]="Draped";c[c.Screen=1]="Screen";c[c.World=2]="World";c[c.COUNT=3]="COUNT"})(a.LineMarkerSpace||(a.LineMarkerSpace={}));a.LineMarkerAnchor=void 0;(function(c){c[c.Center=0]="Center";c[c.Tip=1]="Tip";c[c.COUNT=2]="COUNT"})(a.LineMarkerAnchor||(a.LineMarkerAnchor={}));class f extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=g.ShaderOutput.Color;this.transparencyPassType=k.TransparencyPassType.NONE;
this.writeDepth=this.hasSlicePlane=this.occluder=!1;this.space=a.LineMarkerSpace.Screen;this.hasCap=this.hideOnShortSegments=!1;this.anchor=a.LineMarkerAnchor.Center;this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.vvOpacity=this.vvColor=this.vvSize=this.hasTip=!1}get draped(){return this.space===a.LineMarkerSpace.Draped}}b.__decorate([d.parameter({count:g.ShaderOutput.COUNT})],f.prototype,"output",void 0);b.__decorate([d.parameter({count:k.TransparencyPassType.COUNT})],f.prototype,
"transparencyPassType",void 0);b.__decorate([d.parameter()],f.prototype,"occluder",void 0);b.__decorate([d.parameter()],f.prototype,"hasSlicePlane",void 0);b.__decorate([d.parameter()],f.prototype,"writeDepth",void 0);b.__decorate([d.parameter({count:a.LineMarkerSpace.COUNT})],f.prototype,"space",void 0);b.__decorate([d.parameter()],f.prototype,"hideOnShortSegments",void 0);b.__decorate([d.parameter()],f.prototype,"hasCap",void 0);b.__decorate([d.parameter({count:a.LineMarkerAnchor.COUNT})],f.prototype,
"anchor",void 0);b.__decorate([d.parameter()],f.prototype,"hasTip",void 0);b.__decorate([d.parameter()],f.prototype,"vvSize",void 0);b.__decorate([d.parameter()],f.prototype,"vvColor",void 0);b.__decorate([d.parameter()],f.prototype,"vvOpacity",void 0);b.__decorate([d.parameter()],f.prototype,"hasOccludees",void 0);b.__decorate([d.parameter()],f.prototype,"multipassEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"cullAboveGround",void 0);b.__decorate([d.parameter({constValue:!1})],f.prototype,
"occlusionPass",void 0);b.__decorate([d.parameter({constValue:!0})],f.prototype,"hasVvInstancing",void 0);b.__decorate([d.parameter({constValue:!0})],f.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C){function E(F){const G=new r.ShaderBuilder,{vertex:I,fragment:H}=G,B=F.multipassEnabled&&(F.output===g.ShaderOutput.Color||F.output===g.ShaderOutput.Alpha);G.include(p.PiUtils);G.include(m.RibbonVertexPosition,F);G.include(c.LineStipple,F);const K=F.applyMarkerOffset&&!F.draped;K&&(I.uniforms.add(new q.FloatPassUniform("markerScale",U=>U.markerScale)),G.include(l.MarkerSizing,{space:D.LineMarkerSpace.World,draped:!1}));F.output===g.ShaderOutput.Depth&&
G.include(f.OutputDepth,F);G.include(k.ObjectAndLayerIdColor,F);w.addProjViewLocalOrigin(I,F);I.uniforms.add(new v.Matrix4PassUniform("inverseProjectionMatrix",(U,Z)=>Z.camera.inverseProjectionMatrix),new x.Float2PassUniform("nearFar",(U,Z)=>Z.camera.nearFar),new q.FloatPassUniform("miterLimit",U=>"miter"!==U.join?0:U.miterLimit),new n.Float4PassUniform("viewport",(U,Z)=>Z.camera.fullViewport));I.constants.add("LARGE_HALF_FLOAT","float",65500);G.attributes.add(z.VertexAttribute.POSITION,"vec3");G.attributes.add(z.VertexAttribute.SUBDIVISIONFACTOR,
"float");G.attributes.add(z.VertexAttribute.UV0,"vec2");G.attributes.add(z.VertexAttribute.AUXPOS1,"vec3");G.attributes.add(z.VertexAttribute.AUXPOS2,"vec3");G.varyings.add("vColor","vec4");G.varyings.add("vpos","vec3");b.addLinearDepth(G);B&&G.varyings.add("depth","float");const L=F.stippleEnabled;L&&G.varyings.add("vLineSizeInv","float");const J=F.capType===C.CapType.ROUND,M=L||J;M&&G.varyings.add("vLineWidth","float");const T=F.innerColorEnabled||J;T&&G.varyings.add("vLineDistance","float");const Q=
F.stippleEnabled&&J,O=F.falloffEnabled||Q;O&&G.varyings.add("vLineDistanceNorm","float");J&&(G.varyings.add("vSegmentSDF","float"),G.varyings.add("vReverseSegmentSDF","float"));I.code.add(t.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);I.code.add(t.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);b.addCalculateLinearDepth(G);I.code.add(t.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${B?"depth \x3d pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);w.addPixelRatio(I);I.code.add(t.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${M?t.glsl`vLineWidth = lineWidth;`:""}
      ${L?t.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `);K&&I.code.add(t.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);I.code.add(t.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(F.stippleEnabled||J)&&I.code.add(t.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${J?t.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);I.code.add(t.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);F.roundJoins?I.code.add(t.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${F.stippleEnabled?t.glsl`min(1.0, subdivisionFactor * ${t.glsl.float(1.5)})`:t.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):I.code.add(t.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);I.code.add(t.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${F.capType!==C.CapType.BUTT?t.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);I.code.add(t.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${O||T?t.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${T?t.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${O?t.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);J&&I.code.add(t.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);F.stippleEnabled&&(F.draped?I.uniforms.add(new q.FloatPassUniform("worldToScreenRatio",(U,Z)=>1/Z.screenToPCSRatio)):I.code.add(t.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),I.code.add(t.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),F.draped?I.code.add(t.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):I.code.add(t.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),I.uniforms.add(new q.FloatPassUniform("stipplePatternPixelSize",U=>c.computePixelSize(U))),I.code.add(t.glsl`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`));I.code.add(t.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${F.wireframe&&!F.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `);B&&G.include(e.multipassTerrainTest,F);G.include(d.SliceDraw,F);H.include(u.ColorConversion);H.code.add(t.glsl`
  void main() {
    discardBySlice(vpos);
    ${B?"terrainDepthTest(depth);":""}
  `);F.wireframe?H.code.add(t.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(J&&H.code.add(t.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${t.glsl.float(h.symbolAlphaCutoff)}) {
        discard;
      }
    `),Q?H.code.add(t.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${t.glsl.float(h.symbolAlphaCutoff)}, stippleCoverage);
      `):H.code.add(t.glsl`float stippleAlpha = getStippleAlpha();`),F.output!==g.ShaderOutput.ObjectAndLayerIdColor&&H.code.add(t.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),H.uniforms.add(new n.Float4PassUniform("intrinsicColor",U=>U.color)),H.code.add(t.glsl`vec4 color = intrinsicColor * vColor;`),F.innerColorEnabled&&(H.uniforms.add(new n.Float4PassUniform("innerColor",U=>U.innerColor??U.color),new q.FloatPassUniform("innerWidth",(U,Z)=>U.innerWidth*Z.camera.pixelRatio)),
H.code.add(t.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),H.code.add(t.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),F.falloffEnabled&&(H.uniforms.add(new q.FloatPassUniform("falloff",U=>U.falloff)),H.code.add(t.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)));H.code.add(t.glsl`
    ${F.output===g.ShaderOutput.ObjectAndLayerIdColor?t.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${t.glsl.float(h.symbolAlphaCutoff)}) {
      discard;
    }

    ${F.output===g.ShaderOutput.Alpha?t.glsl`fragColor = vec4(finalColor.a);`:""}
    ${F.output===g.ShaderOutput.Color?t.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${F.output===g.ShaderOutput.Color&&F.transparencyPassType===y.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${F.output===g.ShaderOutput.Highlight?t.glsl`fragColor = vec4(1.0);`:""}
    ${F.output===g.ShaderOutput.Depth?t.glsl`outputDepth(linearDepth);`:""}
    ${F.output===g.ShaderOutput.ObjectAndLayerIdColor?t.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return G}const A=Object.freeze(Object.defineProperty({__proto__:null,build:E,ribbonlineNumRoundJoinSubdivisions:1},Symbol.toStringTag,{value:"Module"}));a.RibbonLine=A;a.build=E;a.ribbonlineNumRoundJoinSubdivisions=1})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../shading/VisualVariables.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f){a.RibbonVertexPosition=function(c,l){const e=c.vertex;e.uniforms.add(new d.FloatPassUniform("intrinsicWidth",p=>p.width));l.vvSize?(c.attributes.add(f.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),e.uniforms.add(new g.Float3PassUniform("vvSizeMinSize",p=>p.vvSize.minSize),new g.Float3PassUniform("vvSizeMaxSize",p=>p.vvSize.maxSize),new g.Float3PassUniform("vvSizeOffset",p=>p.vvSize.offset),new g.Float3PassUniform("vvSizeFactor",p=>p.vvSize.factor)),e.code.add(m.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(c.attributes.add(f.VertexAttribute.SIZE,"float"),e.code.add(m.glsl`float getSize(){
return intrinsicWidth * size;
}`));l.vvOpacity?(c.attributes.add(f.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),e.constants.add("vvOpacityNumber","int",8),e.uniforms.add(new k.FloatsPassUniform("vvOpacityValues",p=>p.vvOpacity.values,8),new k.FloatsPassUniform("vvOpacityOpacities",p=>p.vvOpacity.opacityValues,8)),e.code.add(m.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.code.add(m.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);l.vvColor?(c.include(b.VisualVariables,l),c.attributes.add(f.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),e.code.add(m.glsl`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(c.attributes.add(f.VertexAttribute.COLOR,"vec4"),e.code.add(m.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../materials/stippleTextureRepository ../../../shaders/ensureColor4".split(" "),function(a,b,g,d,k,m,f,c,l){function e(u,w){const x=
!(w.draped&&w.stipplePreferContinuous),{vertex:n,fragment:q}=u;q.include(b.RgbaFloatEncoding);w.draped||(g.addCameraPosition(n,w),n.uniforms.add(new k.FloatPassUniform("worldToScreenPerDistanceRatio",(t,v)=>1/v.camera.perScreenPixelRatio)),n.code.add(m.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));u.varyings.add("vStippleDistance","float");u.varyings.add("vStippleDistanceLimits","vec2");u.varyings.add("vStipplePatternStretch","float");n.code.add(m.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${h};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);n.code.add(m.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);n.code.add(m.glsl`
    if (segmentLengthPseudoScreen >= ${x?"patternLength":"1e4"}) {
  `);g.addPixelRatio(n);n.code.add(m.glsl`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`);q.uniforms.add(new f.Texture2DPassUniform("stipplePatternTexture",t=>t.stippleTexture),new k.FloatPassUniform("stipplePatternSDFNormalizer",t=>(t=t.stipplePattern)?(Math.floor(.5*(c.computeLongestPattern(t)-1))+.5)/t.pixelRatio:1),new k.FloatPassUniform("stipplePatternPixelSizeInv",t=>1/p(t)));q.code.add(m.glsl`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`);w.stippleOffColorEnabled?(q.uniforms.add(new d.Float4PassUniform("stippleOffColor",t=>l.ensureColor4(t.stippleOffColor))),q.code.add(m.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):q.code.add(m.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function p(u){const w=u.stipplePattern;return w?c.computeTextureSize(u.stipplePattern)/w.pixelRatio:1}const h=m.glsl.float(.4);a.LineStipple=function(u,w){u.constants.add("stippleAlphaColorDiscard","float",.001);u.constants.add("stippleAlphaHighlightDiscard","float",.5);w.stippleEnabled?e(u,w):u.fragment.code.add(m.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};a.computePixelSize=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/stippleTextureRepository":function(){define("exports ../../../../core/floatRGBA ./ProceduralTextureRepository ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,g,d,k,m){function f(e){return e.pattern.map(p=>Math.round(p*e.pixelRatio))}function c(e){if(null==e)return 1;e=f(e);
return Math.floor(e.reduce((p,h)=>p+h))}function l(e){return f(e).reduce((p,h)=>Math.max(p,h))}a.computeLongestPattern=l;a.computeTextureSize=c;a.createStippleTextureRepository=function(e,p){return new g.ProceduralTextureRepository(h=>{var u=f(h),w=1/h.pixelRatio,x=c(h);h=l(h);const n=(Math.floor(.5*(h-1))+.5)*w;h=[];let q=1;for(var t of u){for(let y=0;y<t;y++)h.push(q*(Math.min(y,t-1-y)+.5)*w/n*.5+.5);q=-q}u=Math.round(u[0]/2);u=[...h.slice(u),...h.slice(0,u)];w=new Uint8Array(4*x);t=0;for(const y of u)b.packFloatRGBA(y,
w,t),t+=4;const {encodedData:v,textureSize:r}={encodedData:w,textureSize:x};x=new m.TextureDescriptor;x.internalFormat=d.PixelFormat.RGBA;x.width=r;x.height=1;x.wrapMode=d.TextureWrapMode.REPEAT;return new k.Texture(e,x,v)},h=>`${h.pattern.join(",")}-r${h.pixelRatio}`,p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function g(f,c=0){let l=0;for(let e=0;4>e;e++)l+=f[c+e]*k[e];return l}const d=[1,256,
65536,16777216],k=[1/256,1/65536,1/16777216,1/4294967296],m=g(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(f,c,l=0){f=b.clamp(f,0,m);for(let h=0;4>h;h++){var e=Math,p=f*d[h];c[l+h]=e.floor.call(e,256*(p-Math.floor(p)))}};a.unpackFloatRGBA=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ProceduralTextureRepository":function(){define(["exports","../../../../core/uid"],function(a,b){class g{constructor(k,m,f){this._createTexture=
k;this._parametersKey=m;this._repository=new Map;this._orphanCache=f.newCache(`procedural-texture-repository:${b.generateUID()}`,c=>c.dispose())}destroy(){for(const [,{texture:k}]of this._repository)k.dispose();this._repository.clear();this._orphanCache.destroy()}swap(k,m=null){k=this._acquire(k);this.release(m);return k}release(k){if(null!=k){k=this._parametersKey(k);var m=this._repository.get(k);m&&(m.refCount--,0===m.refCount&&(this._repository.delete(k),{texture:m}=m,this._orphanCache.put(k,m,
m.gpuMemoryUsage)))}}_acquire(k){if(null==k)return null;const m=this._parametersKey(k);var f=this._repository.get(m);if(f)return f.refCount++,f.texture;k=this._orphanCache.pop(m)??this._createTexture(k);f=new d(k);this._repository.set(m,f);return k}}class d{constructor(k){this.texture=k;this.refCount=1}}a.ProceduralTextureRepository=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../chunks/vec4",
"../../../../chunks/vec4f64"],function(a,b,g){const d=g.create();a.ensureColor4=function(k){return null==k?g.ZEROS:4===k.length?k:b.set(d,k[0],k[1],k[2],1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../support/engineContent/marker ../util/View.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m){a.MarkerSizing=function(f,c){const {vertex:l,constants:e}=f;e.add("markerSizePerLineWidth","float",b.markerSizePerLineWidth);g.addPixelRatio(l);null==l.uniforms.get("markerScale")&&l.constants.add("markerScale","float",1);l.code.add(k.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);c.space===m.LineMarkerSpace.World&&(l.constants.add("maxSegmentLengthFraction","float",.45),l.uniforms.add(new d.FloatPassUniform("perRenderPixelRatio",(p,h)=>h.camera.perRenderPixelRatio)),l.code.add(k.glsl`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(a,b,g,d,k){a.createMarkerTexture=function(m,f){m=b.createPrimitive(m,64,32,6.4);const c=new k.TextureDescriptor;c.internalFormat=g.PixelFormat.RGBA;c.width=64;c.height=64;c.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;return new d.Texture(f,c,m)};a.markerSizePerLineWidth=
10;a.markerSymbolSize=32;a.markerTextureSize=64;a.markerThickness=6.4;a.markerTipThicknessFactor=.25;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports","../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,g,d,k){function m(v,r=128,y=.5*r,z=0){switch(v){case "circle":return f(r,y);case "square":return c(r,y);case "cross":return e(r,y,z);
case "x":return p(r,y,z);case "kite":return l(r,y);case "triangle":return h(r,y);case "arrow":return u(r,y);default:return f(r,y)}}function f(v,r){const y=v/2-.5;return t(v,n(y,y,r/2))}function c(v,r){return w(v,r,!1)}function l(v,r){return w(v,r,!0)}function e(v,r,y=0){return x(v,r,!1,y)}function p(v,r,y=0){return x(v,r,!0,y)}function h(v,r){return t(v,q(v/2,r,r/2))}function u(v,r){const y=r/2,z=v/2,D=.8*r,C=n(z,(v-r)/2-D,Math.sqrt(D*D+y*y)),E=q(z,r,y);return t(v,(A,F)=>Math.max(E(A,F),-C(A,F)))}
function w(v,r,y){y&&(r/=Math.SQRT2);return t(v,(z,D)=>{z=z-.5*v+.25;D=-D+.5*v-.75;if(y){const C=(z+D)/Math.SQRT2;D=(D-z)/Math.SQRT2;z=C}return Math.max(Math.abs(z),Math.abs(D))-.5*r})}function x(v,r,y,z=0){r-=z;y&&(r*=Math.SQRT2);const D=.5*r;return t(v,(C,E)=>{C-=.5*v;E=-E+.5*v-1;if(y){const A=(C+E)/Math.SQRT2;E=(E-C)/Math.SQRT2;C=A}C=Math.abs(C);E=Math.abs(E);C=C>E?C>D?Math.sqrt((C-D)*(C-D)+E*E):E:E>D?Math.sqrt(C*C+(E-D)*(E-D)):C;return C-=z/2})}function n(v,r,y){return(z,D)=>{z-=v;D-=r;return Math.sqrt(z*
z+D*D)-y}}function q(v,r,y){const z=Math.sqrt(r*r+y*y);return(D,C)=>{C=C-v+r/2+.75;return Math.max((r*(Math.abs(D-v)-y)+y*C)/z,-C)}}function t(v,r){const y=new Uint8Array(4*v*v);for(let z=0;z<v;z++)for(let D=0;D<v;D++){const C=D+v*z;let E=r(D,z);E=E/v+.5;g.packFloatRGBA(E,y,4*C)}return y}a.createArrow=u;a.createCircle=f;a.createCross=e;a.createKite=l;a.createPrimitive=m;a.createSquare=c;a.createTexture=function(v,r=128,y=.5*r,z=0){v=m(v,r,y,z);return new d.Texture(v,{mipmap:!1,wrap:{s:k.TextureWrapMode.CLAMP_TO_EDGE,
t:k.TextureWrapMode.CLAMP_TO_EDGE},width:r,height:r,components:4,noUnpackFlip:!0,reloadable:!0})};a.createTriangle=h;a.createX=p;a.defaultSymbolSizeRatio=.5;a.defaultTexSize=128;a.requiresHalfTexelOffset=function(v){return"cross"===v||"x"===v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/Evented ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){function y(E){return E instanceof HTMLVideoElement?{width:E.videoWidth,height:E.videoHeight}:E}class z extends u.ContentObject{get parameters(){return this._parameters}constructor(E,A){super();this._data=E;this.type=w.ContentObjectType.Texture;this._loadingController=this._loadingPromise=this._glTexture=null;this.events=new d;this._parameters={...C,...A};this._startPreload(E)}dispose(){this.unload();this._data=this.frameUpdate=void 0}_startPreload(E){null!=
E&&(E instanceof HTMLVideoElement?(this.frameUpdate=A=>this._frameUpdate(E,A),this._startPreloadVideoElement(E)):E instanceof HTMLImageElement&&this._startPreloadImageElement(E))}_startPreloadVideoElement(E){if(!(c.isBlobProtocol(E.src)||"auto"===E.preload&&E.crossOrigin)){E.preload="auto";E.crossOrigin="anonymous";const A=!E.paused;E.src=E.src;if(A&&E.autoplay){const F=()=>{E.removeEventListener("canplay",F);E.play()};E.addEventListener("canplay",F)}}}_startPreloadImageElement(E){c.isDataProtocol(E.src)||
c.isBlobProtocol(E.src)||E.crossOrigin||(E.crossOrigin="anonymous",E.src=E.src)}_createDescriptor(E){const A=new r.TextureDescriptor;A.wrapMode=this._parameters.wrap??t.TextureWrapMode.REPEAT;A.flipped=!this._parameters.noUnpackFlip;A.samplingMode=this._parameters.mipmap?t.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:t.TextureSamplingMode.LINEAR;A.hasMipmap=!!this._parameters.mipmap;A.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha;A.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?
E.parameters.maxMaxAnisotropy:1);return A}get glTexture(){return this._glTexture}get memoryEstimate(){var E;if(!(E=this._glTexture?.gpuMemoryUsage)){E=this._data;var A=this._parameters;if(null==E)E=0;else if(f.isArrayBuffer(E)||f.isUint8Array(E))E=A.encoding===p.TextureEncodingMimeType.KTX2_ENCODING?h.estimateMemoryKTX2(E,!!A.mipmap):A.encoding===p.TextureEncodingMimeType.BASIS_ENCODING?h.estimateMemoryBasis(E,!!A.mipmap):E.byteLength;else{var {width:F,height:G}=E instanceof Image||E instanceof ImageData||
E instanceof HTMLCanvasElement||E instanceof HTMLVideoElement?y(E):A;E=(A.mipmap?4/3:1)*F*G*(A.components||4)||0}}return E}load(E){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const A=this._data;if(null==A)return this._glTexture=new v.Texture(E,this._createDescriptor(E),null);this._parameters.reloadable||(this._data=void 0);return"string"===typeof A?this._loadFromURL(E,A):A instanceof Image?this._loadFromImageElement(E,A):A instanceof HTMLVideoElement?
this._loadFromVideoElement(E,A):A instanceof ImageData||A instanceof HTMLCanvasElement?this._loadFromImage(E,A):(f.isArrayBuffer(A)||f.isUint8Array(A))&&this._parameters.encoding===p.TextureEncodingMimeType.DDS_ENCODING?this._loadFromDDSData(E,A):(f.isArrayBuffer(A)||f.isUint8Array(A))&&this._parameters.encoding===p.TextureEncodingMimeType.KTX2_ENCODING?this._loadFromKTX2(E,A):(f.isArrayBuffer(A)||f.isUint8Array(A))&&this._parameters.encoding===p.TextureEncodingMimeType.BASIS_ENCODING?this._loadFromBasis(E,
A):f.isUint8Array(A)?this._loadFromPixelData(E,A):f.isArrayBuffer(A)?this._loadFromPixelData(E,new Uint8Array(A)):null}_frameUpdate(E,A){if(null==this._glTexture||E.readyState<D.HAVE_CURRENT_DATA||A===E.currentTime)return A;this._glTexture.setData(E);this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this._parameters.updateCallback&&this._parameters.updateCallback();return E.currentTime}_loadFromDDSData(E,A){return this._glTexture=x.createDDSTexture(E,this._createDescriptor(E),
A)}_loadFromKTX2(E,A){return this._loadAsync(()=>h.createTextureKTX2(E,this._createDescriptor(E),A).then(F=>this._glTexture=F))}_loadFromBasis(E,A){return this._loadAsync(()=>h.createTextureBasis(E,this._createDescriptor(E),A).then(F=>this._glTexture=F))}_loadFromPixelData(E,A){q.assert(0<this._parameters.width&&0<this._parameters.height);const F=this._createDescriptor(E);F.pixelFormat=1===this._parameters.components?t.PixelFormat.LUMINANCE:3===this._parameters.components?t.PixelFormat.RGB:t.PixelFormat.RGBA;
F.width=this._parameters.width??0;F.height=this._parameters.height??0;return this._glTexture=new v.Texture(E,F,A)}_loadFromURL(E,A){return this._loadAsync(async F=>{const G=await l.requestImage(A,{signal:F});m.throwIfAborted(F);return this._loadFromImage(E,G)})}_loadFromImageElement(E,A){return A.complete?this._loadFromImage(E,A):this._loadAsync(async F=>{const G=await e.loadImageAsync(A,A.src,!1,F);m.throwIfAborted(F);return this._loadFromImage(E,G)})}_loadFromVideoElement(E,A){return A.readyState>=
D.HAVE_CURRENT_DATA?this._loadFromImage(E,A):this._loadFromVideoElementAsync(E,A)}_loadFromVideoElementAsync(E,A){return this._loadAsync(F=>new Promise((G,I)=>{const H=()=>{A.removeEventListener("loadeddata",B);A.removeEventListener("error",K);k.removeMaybe(L)},B=()=>{A.readyState>=D.HAVE_CURRENT_DATA&&(H(),G(this._loadFromImage(E,A)))},K=J=>{H();I(J||new g("Failed to load video"))};A.addEventListener("loadeddata",B);A.addEventListener("error",K);const L=m.onAbort(F,()=>K(m.createAbortError()))}))}_loadFromImage(E,
A){if(!(A instanceof HTMLVideoElement)){var {maxTextureSize:F}=E.parameters;A=this._parameters.downsampleUncompressed?n.downsampleImage(A,F):n.ensureImageMaxSize(A,F)}F=y(A);this._parameters.width=F.width;this._parameters.height=F.height;const G=this._createDescriptor(E);G.pixelFormat=3===this._parameters.components?t.PixelFormat.RGB:t.PixelFormat.RGBA;G.width=F.width;G.height=F.height;return this._glTexture=new v.Texture(E,G,A)}_loadAsync(E){const A=new AbortController;this._loadingController=A;
const F=E(A.signal);this._loadingPromise=F;E=()=>{this._loadingController===A&&(this._loadingController=null);this._loadingPromise===F&&(this._loadingPromise=null)};F.then(E,E);return F}unload(){this._glTexture=k.disposeMaybe(this._glTexture);if(null!=this._loadingController){const E=this._loadingController;this._loadingPromise=this._loadingController=null;E.abort()}this.events.emit("unloaded")}}var D;(function(E){E[E.HAVE_NOTHING=0]="HAVE_NOTHING";E[E.HAVE_METADATA=1]="HAVE_METADATA";E[E.HAVE_CURRENT_DATA=
2]="HAVE_CURRENT_DATA";E[E.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";E[E.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(D||(D={}));const C={wrap:{s:t.TextureWrapMode.REPEAT,t:t.TextureWrapMode.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1};a.Texture=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(a,b){a.requestImage=async function(g,d){({data:g}=await b(g,{responseType:"image",
...d}));return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,g,d,k,m){async function f(){null==u&&(u=b.getBasisTranscoder(),h=await u);return u}function c(w,x,n,q,t){x=m.getBytesPerElementFormat(x?d.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:d.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);
return Math.ceil(n*q*x*(t&&1<w?(4**w-1)/(3*4**(w-1)):1))}function l(w){return 1<=w.getNumImages()&&!w.isUASTC()}function e(w){return 1<=w.getFaces()&&w.isETC1S()}function p(w,x,n,q,t,v,r,y){const {compressedTextureETC:z,compressedTextureS3TC:D}=w.capabilities,[C,E]=z?q?[g.TextureFormat.ETC2_RGBA,d.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[g.TextureFormat.ETC1_RGB,d.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:D?q?[g.TextureFormat.BC3_RGBA,d.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:
[g.TextureFormat.BC1_RGB,d.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[g.TextureFormat.RGBA32,d.PixelFormat.RGBA];n=x.hasMipmap?n:Math.min(1,n);q=[];for(let A=0;A<n;A++)q.push(new Uint8Array(r(A,C))),y(A,C,q[A]);x.internalFormat=E;x.hasMipmap=1<q.length;x.samplingMode=x.hasMipmap?d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:d.TextureSamplingMode.LINEAR;x.width=t;x.height=v;return new k.Texture(w,x,{type:"compressed",levels:q})}let h=null,u=null;a.createTextureBasis=async function(w,x,n){null==
h&&(h=await f());const q=new h.BasisFile(new Uint8Array(n));if(!l(q))return null;q.startTranscoding();w=p(w,x,q.getNumLevels(0),q.getHasAlpha(),q.getImageWidth(0,0),q.getImageHeight(0,0),(t,v)=>q.getImageTranscodedSizeInBytes(0,t,v),(t,v,r)=>q.transcodeImage(r,0,t,v,0,0));q.close();q.delete();return w};a.createTextureKTX2=async function(w,x,n){null==h&&(h=await f());const q=new h.KTX2File(new Uint8Array(n));if(!e(q))return null;q.startTranscoding();w=p(w,x,q.getLevels(),q.getHasAlpha(),q.getWidth(),
q.getHeight(),(t,v)=>q.getImageTranscodedSizeInBytes(t,0,0,v),(t,v,r)=>q.transcodeImage(r,t,0,0,v,0,-1,-1));q.close();q.delete();return w};a.estimateMemoryBasis=function(w,x){if(null==h)return w.byteLength;w=new h.BasisFile(new Uint8Array(w));x=l(w)?c(w.getNumLevels(0),w.getHasAlpha(),w.getImageWidth(0,0),w.getImageHeight(0,0),x):0;w.close();w.delete();return x};a.estimateMemoryKTX2=function(w,x){if(null==h)return w.byteLength;w=new h.KTX2File(new Uint8Array(w));x=e(w)?c(w.getLevels(),w.getHasAlpha(),
w.getWidth(),w.getHeight(),x):0;w.close();w.delete();return x};a.loadBasis=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets"],function(a,b,g){let d;b.getBasisTranscoder=function(){if(null==d){const k=m=>g.getAssetUrl(`esri/libs/basisu/${m}`);d=(new Promise((m,f)=>a(["../../chunks/basis_transcoder"],m,f))).then(m=>m.basis_transcoder).then(({default:m})=>m({locateFile:k}).then(f=>{f.initializeBasis();delete f.then;
return f}))}return d};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";
b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports",
"../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],function(a,b,g,d){function k(p){return p.charCodeAt(0)+(p.charCodeAt(1)<<8)+(p.charCodeAt(2)<<16)+(p.charCodeAt(3)<<24)}function m(p,h){var u=new Int32Array(p,0,31);if(542327876!==u[0])return f.error("Invalid magic number in DDS header"),null;if(!(u[20]&4))return f.error("Unsupported format, must contain a FourCC code"),null;var w=u[21];let x;switch(w){case c:w=8;x=g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;
case l:w=16;x=g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e:w=16;x=g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return f.error("Unsupported FourCC code:",String.fromCharCode(w&255,w>>8&255,w>>16&255,w>>24&255)),null}let n=1,q=u[4],t=u[3];if(0!==(q&3)||0!==(t&3))f.warn("Rounding up compressed texture size to nearest multiple of 4."),q=q+3&-4,t=t+3&-4;const v=q,r=t;u[2]&131072&&!1!==h&&(n=Math.max(1,u[7]));let y=u[1]+4;const z=[];for(let D=0;D<n;++D)u=
(q+3>>2)*(t+3>>2)*w,h=new Uint8Array(p,y,u),z.push(h),y+=u,q=Math.max(1,q>>1),t=Math.max(1,t>>1);return{textureData:{type:"compressed",levels:z},internalFormat:x,width:v,height:r}}const f=b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),c=k("DXT1"),l=k("DXT3"),e=k("DXT5");a.createDDSTexture=function(p,h,u){u=m(u,h.hasMipmap??!1);if(null==u)throw Error("DDS texture data is null");const {textureData:w,internalFormat:x,width:n,height:q}=u;h.samplingMode=1<w.levels.length?g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:
g.TextureSamplingMode.LINEAR;h.hasMipmap=1<w.levels.length;h.internalFormat=x;h.width=n;h.height=q;return new d.Texture(p,h,w)};a.createDDSTextureData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m){a.CapType=void 0;(function(c){c[c.BUTT=0]="BUTT";c[c.SQUARE=1]="SQUARE";c[c.ROUND=2]="ROUND";c[c.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));class f extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=g.ShaderOutput.Color;this.capType=a.CapType.BUTT;this.transparencyPassType=k.TransparencyPassType.NONE;this.stippleOffColorEnabled=this.stippleEnabled=this.draped=this.writeDepth=this.hasPolygonOffset=this.hasSlicePlane=this.occluder=!1;this.stipplePreferContinuous=
!0;this.objectAndLayerIdColorInstanced=this.wireframe=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.innerColorEnabled=this.falloffEnabled=this.vvOpacity=this.vvColor=this.vvSize=this.applyMarkerOffset=this.roundJoins=!1}}b.__decorate([d.parameter({count:g.ShaderOutput.COUNT})],f.prototype,"output",void 0);b.__decorate([d.parameter({count:a.CapType.COUNT})],f.prototype,"capType",void 0);b.__decorate([d.parameter({count:k.TransparencyPassType.COUNT})],f.prototype,"transparencyPassType",
void 0);b.__decorate([d.parameter()],f.prototype,"occluder",void 0);b.__decorate([d.parameter()],f.prototype,"hasSlicePlane",void 0);b.__decorate([d.parameter()],f.prototype,"hasPolygonOffset",void 0);b.__decorate([d.parameter()],f.prototype,"writeDepth",void 0);b.__decorate([d.parameter()],f.prototype,"draped",void 0);b.__decorate([d.parameter()],f.prototype,"stippleEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"stippleOffColorEnabled",void 0);b.__decorate([d.parameter()],f.prototype,
"stipplePreferContinuous",void 0);b.__decorate([d.parameter()],f.prototype,"roundJoins",void 0);b.__decorate([d.parameter()],f.prototype,"applyMarkerOffset",void 0);b.__decorate([d.parameter()],f.prototype,"vvSize",void 0);b.__decorate([d.parameter()],f.prototype,"vvColor",void 0);b.__decorate([d.parameter()],f.prototype,"vvOpacity",void 0);b.__decorate([d.parameter()],f.prototype,"falloffEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"innerColorEnabled",void 0);b.__decorate([d.parameter()],
f.prototype,"hasOccludees",void 0);b.__decorate([d.parameter()],f.prototype,"multipassEnabled",void 0);b.__decorate([d.parameter()],f.prototype,"cullAboveGround",void 0);b.__decorate([d.parameter()],f.prototype,"wireframe",void 0);b.__decorate([d.parameter()],f.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([d.parameter({constValue:!1})],f.prototype,"occlusionPass",void 0);b.__decorate([d.parameter({constValue:!0})],f.prototype,"hasVvInstancing",void 0);b.__decorate([d.parameter({constValue:!0})],
f.prototype,"hasSliceTranslatedView",void 0);a.RibbonLineTechniqueConfiguration=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){const w=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.SUBDIVISIONFACTOR,1],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.AUXPOS2,4],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[e.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);class x extends k.ShaderTechnique{initializeProgram(q){return new f.Program(q.rctx,
x.shader.get().build(this.configuration),w)}_makePipelineState(q,t){const v=this.configuration,r=q===l.TransparencyPassType.NONE,y=q===l.TransparencyPassType.FrontFace;return u.makePipelineState({blending:v.output===g.ShaderOutput.Color||v.output===g.ShaderOutput.Alpha?r?m.blendingDefault:m.oitBlending(q):null,depthTest:{func:m.oitDepthTest(q)},depthWrite:r?v.writeDepth?u.defaultDepthWriteParams:null:m.oitDepthWrite(q),colorWrite:u.defaultColorWriteParams,stencilWrite:v.hasOccludees?c.stencilWriteMaskOn:
null,stencilTest:v.hasOccludees?t?c.stencilToolMaskBaseParams:c.stencilBaseAllZerosParams:null,polygonOffset:r||y?v.hasPolygonOffset?n:null:m.OITPolygonOffset})}initializePipeline(){var q=this.configuration;q.occluder&&(q=q.hasPolygonOffset?n:null,this._occluderPipelineTransparent=u.makePipelineState({blending:m.blendingDefault,polygonOffset:q,depthTest:c.depthCompareAlways,depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:null,stencilTest:c.stencilToolTransparentOccluderParams}),
this._occluderPipelineOpaque=u.makePipelineState({blending:m.blendingDefault,polygonOffset:q,depthTest:c.depthCompareAlways,depthWrite:null,colorWrite:u.defaultColorWriteParams,stencilWrite:c.stencilWriteMaskOff,stencilTest:c.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=u.makePipelineState({blending:null,polygonOffset:q,depthTest:c.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:c.stencilWriteMaskOn,stencilTest:c.stencilToolMaskBaseParams}));this._occludeePipelineState=
this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?h.PrimitiveType.LINES:h.PrimitiveType.TRIANGLE_STRIP}getPipeline(q,t,v){return q?this._occludeePipelineState:this.configuration.occluder?v?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}x.shader=new d.ReloadableShaderModule(p.RibbonLine,
()=>new Promise((q,t)=>a(["./RibbonLine.glsl"],q,t)));const n={factor:0,units:-4};b.RibbonLineTechnique=x;b.vertexAttributeLocations=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../core/time ../core/shaderLibrary/ShaderOutput ./BindParameters ./Camera ./Material".split(" "),function(a,b,g,d,k,m){class f{constructor(e,p,h=null){this.rctx=e;this.sliceHelper=h;this.lastFrameCamera=new k.Camera;this.output=
g.ShaderOutput.Color;this.renderOccludedMask=l;this.bindParameters=new d.BindParameters(p,null!=h?h.plane:null);this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=l}}class c extends f{constructor(e,p,h,u){super(e,h,u);this.offscreenRenderingHelper=p;this.sliceHelper=u;this.time=b.Milliseconds(0)}}const l=m.RenderOccludedFlag.Occlude|m.RenderOccludedFlag.OccludeAndTransparent|m.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=f;a.RenderContext=
c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/FBOCache ./CascadeCamera ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){function y(ia,ka){c.set(X,ia[ka],ia[ka+3]);return X}a.SnapshotSlot=void 0;(function(ia){ia[ia.Highlight=0]="Highlight";ia[ia.Default=1]="Default"})(a.SnapshotSlot||(a.SnapshotSlot={}));class z{constructor(){this.camera=new n.CascadeCamera;this.lightMat=f.create()}}class D{constructor(){this.maxNumCascadesLowQuality=this.maxNumCascadesHighQuality=4;this.textureSizeModHighQuality=1.3;this.textureSizeModLowQuality=.9;this.splitSchemeLambda=0}}class C{get depthTexture(){return this._handle?.colorTexture}get _textureWidth(){return this._textureHeight*
this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return h.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?this._cascadeDistances[2]:Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}constructor(ia,ka){this._fbos=ia;this._viewingMode=ka;this._enabled=!1;this._snapshots=[];this._textureHeight=0;this._numCascades=1;this.settings=new D;this._projectionView=f.create();this._projectionViewInverse=
f.create();this._modelViewLight=f.create();this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=u.create();this._cascades=[new z,new z,new z,new z];this._lastOrigin=null;this._maxTextureWidth=Math.min(b("esri-mobile")?4096:16384,ia.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1;this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=d.releaseMaybe(this._handle);this._discardSnapshots()}set maxCascades(ia){this.settings.maxNumCascadesHighQuality=g.clamp(Math.floor(ia),
1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(ia){(this._enabled=ia)||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let ia=0;ia<this._numCascades;++ia)J[ia]=this._cascades[ia];J.length=this._numCascades;return J}start(ia,ka,na,Y,ea){t.assert(this.enabled);const {near:fa,far:aa}=this._clampNearFar(na);this._computeCascadeDistances(fa,aa,Y);this._textureHeight=this._computeTextureHeight(ia,
ea,Y);this._setupMatrices(ia,ka);const {viewMatrix:da,projectionMatrix:ma}=ia;for(ia=0;ia<this._numCascades;++ia)this._constructCascade(ia,ma,da,ka);this._lastOrigin=null;this.clear()}finish(){t.assert(this.enabled);this._handle?.releaseDepth()}getShadowMapMatrices(ia){if(!this._lastOrigin||!e.exactEquals(ia,this._lastOrigin)){this._lastOrigin=this._lastOrigin||p.create();e.copy(this._lastOrigin,ia);for(let ka=0;ka<this._numCascades;++ka){m.translate(M,this._cascades[ka].lightMat,ia);for(let na=0;16>
na;++na)T[16*ka+na]=M[na]}}return T}moveSnapshot(ia){t.assert(this.enabled);this._handle?.releaseDepth();this._snapshots[ia]?.release();this._snapshots[ia]=this._handle;this._handle=null}copySnapshot(ia){var ka=this._handle?.colorTexture?.descriptor;if(this.enabled&&ka){this._snapshots[ia]?.release();var {width:na,height:Y}=ka;this._snapshots[ia]=this._fbos.acquire(x.ColorFormat.RGBA4,na,Y);ka=this._fbos.rctx;this._bindFbo();ia=ka.bindTexture(this._snapshots[ia]?.colorTexture,r.Texture.TEXTURE_UNIT_FOR_UPDATES);
ka.gl.copyTexSubImage2D(v.TextureType.TEXTURE_2D,0,0,0,0,0,na,Y);ka.bindTexture(ia,r.Texture.TEXTURE_UNIT_FOR_UPDATES)}}getSnapshot(ia){return this.enabled?this._snapshots[ia]?.colorTexture:null}clear(){const ia=this._fbos.rctx;this._ensureFbo();this._bindFbo();ia.setClearColor(1,1,1,1);ia.clearSafe(v.ClearBufferBit.COLOR_BUFFER_BIT|v.ClearBufferBit.DEPTH_BUFFER_BIT)}_computeTextureHeight(ia,ka,na){ia=q.applyTextureResizeModulo(Math.floor(Math.min(window.devicePixelRatio,ka)/ia.pixelRatio*Math.max(ia.fullWidth,
ia.fullHeight)*(na?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality)));return Math.min(this._maxTextureWidth,this._numCascades*ia)/this._numCascades}_ensureFbo(){if(this._handle?.fbo.width!==this._textureWidth||this._handle?.fbo.height!==this._textureHeight)this._handle?.release(),this._handle=this._fbos.acquire(x.ColorFormat.RGBA4,this._textureWidth,this._textureHeight);this._handle.acquireDepth(x.DepthFormat.DEPTH16_BUFFER)}_discardSnapshot(ia){this._snapshots[ia]=
d.releaseMaybe(this._snapshots[ia])}_discardSnapshots(){for(let ia=0;ia<this._snapshots.length;++ia)this._discardSnapshot(ia);this._snapshots.length=0}_bindFbo(){const ia=this._fbos.rctx;ia.unbindTexture(this.depthTexture);ia.bindFramebuffer(this._handle?.fbo)}_constructCascade(ia,ka,na,Y){const ea=this._cascades[ia];var fa=-this._cascadeDistances[ia],aa=-this._cascadeDistances[ia+1];fa=(ka[10]*fa+ka[14])/Math.abs(ka[11]*fa+ka[15]);ka=(ka[10]*aa+ka[14])/Math.abs(ka[11]*aa+ka[15]);t.assert(fa<ka);
for(aa=0;8>aa;++aa){h.set(A,0===aa%4||3===aa%4?-1:1,0===aa%4||1===aa%4?-1:1,4>aa?fa:ka,1);var da=F[aa];h.transformMat4(da,A,this._projectionViewInverse);da[0]/=da[3];da[1]/=da[3];da[2]/=da[3]}e.negate(L,F[0]);ea.camera.viewMatrix=m.translate(E,this._modelViewLight,L);for(fa=0;8>fa;++fa)e.transformMat4(F[fa],F[fa],ea.camera.viewMatrix);fa=F[0][2];ka=F[0][2];for(aa=1;8>aa;++aa)fa=Math.min(fa,F[aa][2]),ka=Math.max(ka,F[aa][2]);fa-=200;ka+=200;ea.camera.near=-ka;ea.camera.far=-fa;aa=ea.camera;da=1/F[0][3];
var ma=1/F[4][3];t.assert(da<ma);da+=Math.sqrt(da*ma);var ua=Math.sin(g.acosClamped(na[2]*Y[0]+na[6]*Y[1]+na[10]*Y[2]));na=F;var sa=da/ua;Y=G;var ra=I,Aa=H;ma=B;da=K;c.set(Q,0,0);for(var qa=0;4>qa;++qa)c.add(Q,Q,na[qa]);c.scale(Q,Q,.25);c.set(O,0,0);for(qa=4;8>qa;++qa)c.add(O,O,na[qa]);c.scale(O,O,.25);c.lerp(U[0],na[4],na[5],.5);c.lerp(U[1],na[5],na[6],.5);c.lerp(U[2],na[6],na[7],.5);c.lerp(U[3],na[7],na[4],.5);qa=0;var la=c.squaredDistance(U[0],Q);for(var ja=1;4>ja;++ja){var oa=c.squaredDistance(U[ja],
Q);oa<la&&(la=oa,qa=ja)}c.subtract(Z,U[qa],na[qa+4]);qa=Z[0];Z[0]=-Z[1];Z[1]=qa;c.subtract(P,O,Q);0>c.dot(P,Z)&&c.negate(Z,Z);c.lerp(Z,Z,P,ua);c.normalize(Z,Z);ua=qa=c.dot(c.subtract(R,na[0],Q),Z);for(la=1;8>la;++la)ja=c.dot(c.subtract(R,na[la],Q),Z),ja<ua?ua=ja:ja>qa&&(qa=ja);c.copy(Y,Q);c.scale(R,Z,ua-sa);c.add(Y,Y,R);ja=-1;oa=1;sa=la=0;for(let za=0;8>za;++za){c.subtract(W,na[za],Y);c.normalize(W,W);const ta=Z[0]*W[1]-Z[1]*W[0];0<ta?ta>ja&&(ja=ta,la=za):ta<oa&&(oa=ta,sa=za)}t.verify(0<ja,"leftArea");
t.verify(0>oa,"rightArea");c.scale(N,Z,ua);c.add(N,N,Q);c.scale(V,Z,qa);c.add(V,V,Q);S[0]=-Z[1];S[1]=Z[0];ra=t.rayRay2D(Y,na[sa],V,c.add(R,V,S),1,ra);Aa=t.rayRay2D(Y,na[la],V,R,1,Aa);ma=t.rayRay2D(Y,na[la],N,c.add(R,N,S),1,ma);na=t.rayRay2D(Y,na[sa],N,R,1,da);t.verify(ra,"rayRay");t.verify(Aa,"rayRay");t.verify(ma,"rayRay");t.verify(na,"rayRay");Aa=G;na=I;Y=B;ma=K;da=aa.projectionMatrix;c.subtract(ca,Y,ma);c.scale(ca,ca,.5);ba[0]=ca[0];ba[1]=ca[1];ba[2]=0;ba[3]=ca[1];ba[4]=-ca[0];ba[5]=0;ba[6]=ca[0]*
ca[0]+ca[1]*ca[1];ba[7]=ca[0]*ca[1]-ca[1]*ca[0];ba[8]=1;ba[6]=-c.dot(y(ba,0),Aa);ba[7]=-c.dot(y(ba,1),Aa);Aa=c.dot(y(ba,0),Y)+ba[6];ra=c.dot(y(ba,1),Y)+ba[7];sa=c.dot(y(ba,0),ma)+ba[6];ma=c.dot(y(ba,1),ma)+ba[7];Aa=-(Aa+sa)/(ra+ma);ba[0]+=ba[1]*Aa;ba[3]+=ba[4]*Aa;ba[6]+=ba[7]*Aa;Aa=1/(c.dot(y(ba,0),Y)+ba[6]);ra=1/(c.dot(y(ba,1),Y)+ba[7]);ba[0]*=Aa;ba[3]*=Aa;ba[6]*=Aa;ba[1]*=ra;ba[4]*=ra;ba[7]*=ra;ba[2]=ba[1];ba[5]=ba[4];ba[8]=ba[7];ba[7]+=1;Aa=c.dot(y(ba,1),na)+ba[7];ra=c.dot(y(ba,2),na)+ba[8];sa=
c.dot(y(ba,1),Y)+ba[7];ma=c.dot(y(ba,2),Y)+ba[8];Aa=-.5*(Aa/ra+sa/ma);ba[1]+=ba[2]*Aa;ba[4]+=ba[5]*Aa;ba[7]+=ba[8]*Aa;Aa=c.dot(y(ba,1),na)+ba[7];ra=c.dot(y(ba,2),na)+ba[8];sa=-ra/Aa;ba[1]*=sa;ba[4]*=sa;ba[7]*=sa;da[0]=ba[0];da[1]=ba[1];da[2]=0;da[3]=ba[2];da[4]=ba[3];da[5]=ba[4];da[6]=0;da[7]=ba[5];da[8]=0;da[9]=0;da[10]=1;da[11]=0;da[12]=ba[6];da[13]=ba[7];da[14]=0;da[15]=ba[8];aa.projectionMatrix[10]=2/(fa-ka);aa.projectionMatrix[14]=-(fa+ka)/(fa-ka);m.multiply(ea.lightMat,ea.camera.projectionMatrix,
ea.camera.viewMatrix);fa=this._textureHeight;ea.camera.viewport=[ia*fa,0,fa,fa]}_setupMatrices(ia,ka){m.multiply(this._projectionView,ia.projectionMatrix,ia.viewMatrix);m.invert(this._projectionViewInverse,this._projectionView);ia=this._viewingMode===w.ViewingMode.Global?ia.eye:e.set(L,0,0,1);m.lookAt(this._modelViewLight,[0,0,0],[-ka[0],-ka[1],-ka[2]],ia)}_clampNearFar(ia){let {near:ka,far:na}=ia;2>ka&&(ka=2);2>na&&(na=2);ka>=na&&(ka=2,na=4);return{near:ka,far:na}}_computeCascadeDistances(ia,ka,
na){na=na?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(t.logWithBase(ka/ia,4)),na);na=(ka-ia)/this._numCascades;ka=(ka/ia)**(1/this._numCascades);let Y=ia;for(let ea=0;ea<this._numCascades+1;++ea)this._cascadeDistances[ea]=g.lerp(Y,ia,this.settings.splitSchemeLambda),Y*=ka,ia+=na}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}}const E=f.create(),A=u.create(),F=[];for(let ia=0;8>ia;++ia)F.push(u.create());
const G=l.create(),I=l.create(),H=l.create(),B=l.create(),K=l.create(),L=p.create(),J=[],M=f.create(),T=f.IDENTITY.concat(f.IDENTITY,f.IDENTITY,f.IDENTITY,f.IDENTITY),Q=l.create(),O=l.create(),U=[l.create(),l.create(),l.create(),l.create()],Z=l.create(),P=l.create(),R=l.create(),W=l.create(),N=l.create(),V=l.create(),S=l.create(),X=l.create(),ca=l.create(),ba=k.create();a.ShadowMap=C;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CascadeCamera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ./Camera".split(" "),
function(a,b,g,d,k,m,f,c,l){a.CascadeCamera=class extends l.Camera{constructor(){super(...arguments);this._projectionMatrix=c.create()}get projectionMatrix(){return this._projectionMatrix}};b.__decorate([g.property()],a.CascadeCamera.prototype,"_projectionMatrix",void 0);b.__decorate([g.property({readOnly:!0})],a.CascadeCamera.prototype,"projectionMatrix",null);a.CascadeCamera=b.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.CascadeCamera")],a.CascadeCamera);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2f64 ../../terrain/Intersector ./ChangeSet ./Intersector ./IntersectorInterfaces ./ModelDirtyTypes ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){function t(y,z,D,C,E,A,F){const G=new p.OverlayTarget(A,F,z);z=I=>{I.set(w.IntersectorType.OVERLAY,G,y.dist,y.normal,y.transformation,D,C)};(null==E.results.min.drapedLayerOrder||D>=E.results.min.drapedLayerOrder)&&(null==E.results.min.dist||E.results.ground.dist<=E.results.min.dist)&&z(E.results.min);E.options.store!==w.StoreResults.MIN&&(null==E.results.max.drapedLayerOrder||D<E.results.max.drapedLayerOrder)&&(null==E.results.max.dist||E.results.ground.dist>
E.results.max.dist)&&z(E.results.max);E.options.store===w.StoreResults.ALL&&(A=u.newIntersectorResult(E.ray),z(A),E.results.all.push(A))}a.SortedRenderGeometryRenderer=class extends g{constructor(y){super(y);this._pending=new v;this._changes=new h.ChangeSet;this._materialRenderers=new d;this._sortedMaterialRenderers=new d;this._geometries=new Map;this._hasWater=this._hasHighlights=!1}destroy(){this._changes.prune();this._materialRenderers.forAll(y=>y.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();
this._geometries.clear();this._pending.clear()}get updating(){return!this._pending.empty||0<this._changes.updates.length}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._materialRenderers.some(y=>y.rendersOccluded)}get isEmpty(){return!this.updating&&
0===this._materialRenderers.length&&0===this._geometries.size}getMemoryForMaterial(y){return null==y?0:this._materialRenderers.find(z=>z.material===y)?.usedMemory??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();let y=!1,z=!1,D=!1;n.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((C,E)=>{var A=this._materialRenderers.find(I=>I.material===E);!A&&0<C.adds.length&&(A=new q.MergedRenderer({material:E}),A.initializeRenderContext(this.rendererContext.pluginContext,
this._materialRepository),this._materialRenderers.push(A),D=z=y=!0);if(A){var F=z||A.hasHighlights,G=D||A.hasWater;A.modify(C);z=z||F!==A.hasHighlights;D=D||G!==A.hasWater;A.isEmpty&&(this._materialRenderers.removeUnordered(A),A.dispose(),y=!0)}});this._changes.clear();y&&this._updateSortedMaterialRenderers();z&&(this._hasHighlights=this._materialRenderers.some(C=>C.hasHighlights));D&&(this._hasWater=this._materialRenderers.some(C=>C.hasWater));this.notifyChange("updating");return!0}addGeometries(y,
z){if(0!==y.length){var D=this._validateRenderGeometries(y);for(var C of D)this._geometries.set(C.id,C);C=this._pending.empty;for(const E of D)this._pending.adds.add(E);C&&this.notifyChange("updating");z===x.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(y)}}removeGeometries(y,z){const D=this._pending.empty,C=this._pending.adds;for(const E of y)C.has(E)?(this._pending.removed.add(E),C.delete(E)):this._pending.removed.has(E)||this._pending.removes.add(E),this._geometries.delete(E.id);D&&
!this._pending.empty&&this.notifyChange("updating");z===x.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(y)}modifyGeometries(y,z){const D=0===this._changes.updates.length;for(const C of y){const E=this._changes.updates.pushNew();E.renderGeometry=this._validateRenderGeometry(C);E.updateType=z}D&&0<this._changes.updates.length&&this.notifyChange("updating");switch(z){case x.DirtyState.TRANSFORMATION:case x.DirtyState.GEOMETRY:return this._notifyGraphicGeometryChanged(y);case x.DirtyState.VISIBILITY:return this._notifyGraphicVisibilityChanged(y)}}updateAnimation(y){let z=
!1;this._sortedMaterialRenderers.forAll(D=>z=D.updateAnimation(y)||z);return z}shouldRender(y){return this._sortedMaterialRenderers.some(z=>z.prepareTechnique(y))}render(y){this._sortedMaterialRenderers.forAll(z=>{const D=z.prepareTechnique(y);null!=D&&z.renderNode(y,D)})}intersect(y,z,D,C,E){this._geometries.forEach(A=>{if(!C||C(A)){this._intersectRenderGeometry(A,D,z,0,y,E);var F=this.rendererContext.longitudeCyclical;F&&(A.boundingSphere[0]-A.boundingSphere[3]<F.min&&this._intersectRenderGeometry(A,
D,z,F.range,y,E),A.boundingSphere[0]+A.boundingSphere[3]>F.max&&this._intersectRenderGeometry(A,D,z,-F.range,y,E));E++}});return E}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();this._materialRenderers.forAll((y,z)=>{y.priority=z;this._sortedMaterialRenderers.push(y)});this._sortedMaterialRenderers.sort((y,z)=>z.material.renderPriority===y.material.renderPriority?y.priority-z.priority:z.material.renderPriority-y.material.renderPriority)}_processAddsRemoves(){this._changes.adds.clear();
this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let y=0;y<this._changes.updates.length;)this._pending.has(this._changes.updates.data[y].renderGeometry)?this._changes.updates.removeUnorderedIndex(y):y++;this._pending.clear()}_intersectRenderGeometry(y,z,D,C,E,A){if(y.visible){var F=0;C+=y.transformation[12];F=y.transformation[13];r[0]=D[0]-C;r[1]=D[1]-F;y.screenToWorldRatio=this.rendererContext.screenToWorldRatio;
y.material.intersectDraped(y,null,E,r,(G,I,H)=>{t(z,H,y.material.renderPriority,A,E,y.layerUid,y.graphicUid)},z)}}_notifyGraphicGeometryChanged(y){if(null!=this.drapeSource.notifyGraphicGeometryChanged)for(const D of y)if(y=D.graphicUid,null!=y&&y!==z){this.drapeSource.notifyGraphicGeometryChanged(y);var z=y}}_notifyGraphicVisibilityChanged(y){if(null!=this.drapeSource.notifyGraphicVisibilityChanged)for(const D of y)if(y=D.graphicUid,null!=y&&y!==z){this.drapeSource.notifyGraphicVisibilityChanged(y);
var z=y}}_validateRenderGeometries(y){for(const z of y)this._validateRenderGeometry(z);return y}_validateRenderGeometry(y){null==y.localOrigin&&(y.localOrigin=this._localOriginFactory.getOrigin(y.boundingSphere));return y}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);b.__decorate([k.property()],
a.SortedRenderGeometryRenderer.prototype,"rctx",null);b.__decorate([k.property({constructOnly:!0})],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);b.__decorate([k.property({readOnly:!0})],a.SortedRenderGeometryRenderer.prototype,"isEmpty",null);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,
"_materialRenderers",void 0);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_geometries",void 0);a.SortedRenderGeometryRenderer=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);class v{constructor(){this.adds=new Set;this.removes=new Set;this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(y){return this.adds.has(y)||this.removes.has(y)||this.removed.has(y)}clear(){this.adds.clear();
this.removes.clear();this.removed.clear()}}const r=e.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/IntersectorTarget","../webgl-engine/lib/intersectorUtils"],function(a,b,g,d){class k extends g.Graphic3DTarget{constructor(m,f,c){super(m,f);this.triangleNr=c}}a.OverlayTarget=k;a.isOverlayIntersectorResult=function(m){return d.isValidIntersectorResult(m)&&
m.intersector===b.IntersectorType.OVERLAY&&!!m.target};a.isTerrainIntersectorResult=function(m){return d.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.TERRAIN&&!!m.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){class g{constructor(){this.adds=new b;this.removes=new b;this.updates=new b({allocator:m=>m||new d,deallocator:m=>{m.renderGeometry=
null;return m}})}clear(){this.adds.clear();this.removes.clear();this.updates.clear()}prune(){this.adds.prune();this.removes.prune();this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class d{}class k{constructor(){this.adds=[];this.removes=[];this.updates=[]}}a.ChangeSet=g;a.MaterialChangeSet=k;a.RenderGeometryUpdate=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],
function(a){a.DirtyOperation=void 0;(function(b){b[b.ADD=0]="ADD";b[b.UPDATE=1]="UPDATE";b[b.REMOVE=2]="REMOVE"})(a.DirtyOperation||(a.DirtyOperation={}));a.DirtyState=void 0;(function(b){b[b.NONE=0]="NONE";b[b.VISIBILITY=1]="VISIBILITY";b[b.GEOMETRY=2]="GEOMETRY";b[b.TRANSFORMATION=4]="TRANSFORMATION";b[b.HIGHLIGHT=8]="HIGHLIGHT";b[b.OCCLUDEE=16]="OCCLUDEE"})(a.DirtyState||(a.DirtyState={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports",
"./ChangeSet"],function(a,b){a.splitRenderGeometryChangeSetByMaterial=function(g){const d=new Map,k=m=>{let f=d.get(m);f||(f=new b.MaterialChangeSet,d.set(m,f));return f};g.removes.forAll(m=>{1<=m.geometry.indexCount&&k(m.material).removes.push(m)});g.adds.forAll(m=>{1<=m.geometry.indexCount&&k(m.material).adds.push(m)});g.updates.forAll(m=>{1<=m.renderGeometry.geometry.indexCount&&k(m.renderGeometry.material).updates.push(m)});return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/MapUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/NestedMap ../../../../../core/PooledArray ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/RenderSlot ../../lib/Util ../DrawParameters ../WaterMaterial ./BufferRange ./Instance ./PerBufferData ./PerOriginData ./VaoCache".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I){function H(U,Z){let P;if(!U.some(W=>{if(W.numElements<Z)return!1;P=W;return!0}))return null;const R=P.from;P.from+=Z;P.from>=P.to&&U.removeUnordered(P);return R}function B(U){O.length<U&&(O=new Float32Array(U));return O}function K(U){U*=4;return 1024>=U?1024:262144>U?k.nextHighestPowerOfTwo(U):Math.max(Math.min(262144*Math.ceil(1.5*U/262144),16777216),U)}a.MergedRenderer=class extends q.SyncPrepareRenderPlugin{constructor(U){super(U);
this._bufferWriter=this._glMaterials=this._vaoCache=null;this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this.priority=0;this.produces=new Map}dispose(){this._glMaterials=m.disposeMaybe(this._glMaterials);this._dataByOrigin.forEach(U=>U.dispose());this._dataByOrigin.clear();this._vaoCache=m.disposeMaybe(this._vaoCache)}initializeRenderContext(U,Z){const {rctx:P}=U.renderContext;this._glMaterials=new t.GLMaterials(this.material,Z??U.materialRepository);this._bufferWriter=this.material.createBufferWriter();
this._vaoCache=new I.VaoCache(P,this.material.vertexAttributeLocations,x.glLayout(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof C.WaterMaterial}get isDecoration(){return this.material.parameters.isDecoration}get rendersOccluded(){return!this.isEmpty&&this.material.parameters.renderOccluded!==
v.RenderOccludedFlag.Occlude}get numGeometries(){let U=0;this._dataByOrigin.forEach(Z=>U+=Z.buffers.reduce((P,R)=>P+=R.instances.size,0));return U}get usedMemory(){let U=0;this._dataByOrigin.forEach(Z=>U+=Z.buffers.reduce((P,R)=>P+R.vao.usedMemory,0));return U}forEachGeometry(U){this._dataByOrigin.forEach(Z=>Z.buffers.forEach(P=>P.instances.forEach(R=>U(R.geometry))))}modify(U){this._updateGeometries(U.updates);this._addAndRemoveGeometries(U.adds,U.removes);this._updateDrawCommands()}_updateGeometries(U){const Z=
this._bufferWriter;if(null!==Z){var P=Z.vertexBufferLayout.stride/4;for(const W of U){U=W.renderGeometry;const N=this._dataByOrigin.get(U.localOrigin.id)?.findBuffer(U.id);if(null==N)break;const V=N.instances.get(U.id);if(W.updateType&(r.DirtyState.GEOMETRY|r.DirtyState.TRANSFORMATION)){var R=Z.elementCount(V.geometry.geometry)*P;R=B(R);const S=Z.vertexBufferLayout.createView(R.buffer);this._writeGeometry(U,S,0);N.vao.vertexBuffers.geometry.setSubData(R,V.from*P,0,V.numElements*P)}W.updateType&(r.DirtyState.HIGHLIGHT|
r.DirtyState.OCCLUDEE|r.DirtyState.VISIBILITY)&&(N.drawCommandsDirty=!0)}}}_computeDeltas(U,Z){const P=new f.NestedMap;for(var R of U){U=R.localOrigin;if(null==U)continue;let W=P.get(U.id,null);null==W&&(W=new L(U.vec3),P.set(U.id,null,W));W.changes.push(R)}for(const W of Z)Z=W.localOrigin,null!=Z&&(R=this._dataByOrigin.get(Z.id)?.findBuffer(W.id),null!=R&&(U=P.get(Z.id,R),null==U&&(U=new L(Z.vec3),P.set(Z.id,R,U)),U.changes.push(W)));return P}_addAndRemoveGeometries(U,Z){if(null!==this._bufferWriter&&
null!==this._vaoCache){var {_bufferWriter:P,_dataByOrigin:R}=this,W=P.vertexBufferLayout.stride/4,N=this._computeDeltas(U,Z);N.forEach((V,S)=>{const X=V.get(null),ca=null!=X?X.changes:[];N.delete(S,null);let ba=R.get(S);V.forEach((ia,ka)=>{N.delete(S,ka);if(null==ka)z.assert(!1,"No VAO for removed geometries");else if(ka.instances.size===ia.changes.length)this._vaoCache.deleteVao(ka.vao),g.removeUnordered(ba.buffers,ka),0===ba.buffers.length&&0===ca.length&&R.delete(S);else{var na=ka.numElements,
Y=ka.vao.byteSize/4,ea=ca.reduce((aa,da)=>aa+P.elementCount(da.geometry),0),fa=ia.changes.reduce((aa,da)=>aa+P.elementCount(da.geometry),0);na=Math.min((na+ea-fa)*W,4194304);ea=na>Y;65536<na&&na<Y/2?(ia.changes.forEach(({id:aa})=>ka.deleteInstance(aa)),ka.instances.forEach(({geometry:aa})=>ca.push(aa)),this._vaoCache.deleteVao(ka.vao),g.removeUnordered(ba.buffers,ka)):ea?this._applyAndRebuild(ka,ca,ia):this._applyRemoves(ka,ia)}});if(0<ca.length)for(null==ba&&(ba=new G.PerOriginData(X.origin),R.set(S,
ba)),ba.buffers.forEach(ia=>this._applyAdds(ia,ca));0<ca.length;)ba.buffers.push(this._applyAndRebuild(new F.PerBufferData,ca,null))})}}_updateDrawCommands(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(U=>{U.buffers.forEach(Z=>{Z.drawCommandsDirty&&(Z.hasHiddenInstances=!1,Z.hasHighlights=!1,Z.hasOccludees=!1,d.someMap(Z.instances,P=>{Z.updateDrawState(P);return Z.hasHiddenInstances&&Z.hasHighlights&&Z.hasOccludees}),Z.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride));
this._hasHighlights=this._hasHighlights||Z.hasHighlights;this._hasOccludees=this._hasOccludees||Z.hasOccludees})})}_applyAndRebuild(U,Z,P){if(null!=P)for(var R of P.changes)U.deleteInstance(R.id);const W=this._bufferWriter;P=W.vertexBufferLayout.stride;R=P/4;var N=Math.floor(4194304/R);let V=U.numElements;for(;0<Z.length;){const ba=Z.pop();var S=W.elementCount(ba.geometry);if(V+S>N&&0<V){Z.push(ba);break}V+=S;S=new A.Instance(ba,0,0);z.assert(null==U.instances.get(ba.id));U.addInstance(ba.id,S)}Z=
V*R;N=B(Z);const X=W.vertexBufferLayout.createView(N.buffer);let ca=0;U.hasHiddenInstances=!1;U.hasHighlights=!1;U.hasOccludees=!1;U.instances.forEach((ba,ia)=>{this._writeGeometry(ba.geometry,X,ca);const ka=ca;ca+=W.elementCount(ba.geometry.geometry);U.updateInstance(ia,ka,ca);U.updateDrawState(ba)});this._vaoCache.deleteVao(U.vao);U.vao=this._vaoCache.newVao(K(Z));U.vao.vertexBuffers.geometry.setSubData(N,0,0,ca*R);U.holes.clear();Z=U.holes.pushNew();Z.from=ca;Z.to=Math.floor(U.vao.byteSize/P);
U.updateDrawCommands(P);return U}_applyRemoves(U,Z){if(0!==Z.changes.length&&null!==this._bufferWriter){for(var P of Z.changes){var R=P.id;if(Z=U.instances.get(R)){U.deleteInstance(R);if(R=Q.back()){if(R.to===Z.from){R.to=Z.to;continue}if(R.from===Z.to){R.from=Z.from;continue}}R=Q.pushNew();R.from=Z.from;R.to=Z.to}}E.mergeAdjacentRanges(Q);var W=this._bufferWriter.vertexBufferLayout.stride/4;P=Q.reduce((S,X)=>Math.max(S,X.numElements),0)*W;var N=B(P);N.fill(0,0,P);var V=U.vao.vertexBuffers.geometry;
Q.forAll(S=>V.setSubData(N,S.from*W,0,S.numElements*W));U.holes.pushArray(Q.data,Q.length);Q.forAll((S,X)=>Q.data[X]=null);Q.clear();U.drawCommandsDirty=!0}}_applyAdds(U,Z){if(0!==Z.length&&null!==this._bufferWriter)if(F.hasVao(U)){var P=this._bufferWriter,R=P.vertexBufferLayout.stride/4,W=U.numElements,N=Z.reduce((Y,ea)=>Y+P.elementCount(ea.geometry),0);W=Math.min((W+N)*R,4194304);N=4*W;if(U.vao.byteSize<K(4128768)&&N>U.vao.byteSize)this._applyAndRebuild(U,Z,null);else{E.mergeAdjacentRanges(U.holes);
var V=[];for(var S of Z)N=P.elementCount(S.geometry),N=H(U.holes,N),V.push(N);var X=U.vao.vertexBuffers.geometry,ca=0,ba=0,ia=0,ka=B(W),na=P.vertexBufferLayout.createView(ka.buffer);Z.forEach((Y,ea)=>{ea=V[ea];if(null!=ea){if(ia!==ea){var fa=ia-ba;0<fa&&X.setSubData(ka,ba*R,0,fa*R);ba=ea;ca=0}fa=P.elementCount(Y.geometry);this._writeGeometry(Y,na,ca);ca+=fa;ia=ea+fa;ea=new A.Instance(Y,ea,ea+fa);z.assert(null==U.instances.get(Y.id));U.addInstance(Y.id,ea);U.drawCommandsDirty=!0}});S=ia-ba;0<S&&X.setSubData(ka,
ba*R,0,S*R);g.filterInPlace(Z,(Y,ea)=>null==V[ea])}}else this._applyAndRebuild(U,Z,null)}_writeGeometry(U,Z,P){if(null!==this._bufferWriter){var R=U.localOrigin.vec3;z.setMatrixTranslation3(J,-R[0],-R[1],-R[2]);R=u.multiply(M,J,U.transformation);u.invert(T,R);u.transpose(T,T);this._bufferWriter.write(R,T,U.geometry,Z,P)}}updateAnimation(U){return this.material.update(U)}prepareTechnique(U){if(!this.material.shouldRender(U))return null;const {output:Z,bindParameters:P}=U;if(!this.material.produces(P.slot,
Z))return null;const R=Z===n.ShaderOutput.Highlight||Z===n.ShaderOutput.ShadowHighlight;if(R&&!this._hasHighlights)return null;const W=Z===n.ShaderOutput.ShadowExcludeHighlight,N=!(R||W);for(const S of this._dataByOrigin.values())for(const X of S.buffers){if(R&&!X.hasHighlights)continue;var V=(R?X.drawCommandsHighlight:W&&X.needsMultipleCommands()?X.drawCommandsShadowHighlightRest:X.drawCommandsDefault)||null;const ca=N&&X.drawCommandsOccludees||null;if(V?.length||ca?.length)if(V=this._glMaterials.load(U.rctx,
P.slot,Z),V=null!=V?V.beginSlot(P):null,null!=V)return V}return null}renderNode(U,Z){const {output:P,bindParameters:R}=U,W=P===n.ShaderOutput.Highlight||P===n.ShaderOutput.ShadowHighlight,N=P===n.ShaderOutput.ShadowExcludeHighlight,V=!(W||N),S=U.rctx,X=U.bindParameters.slot===y.RenderSlot.OCCLUDER_MATERIAL;U=U.bindParameters.slot===y.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;S.runAppleAmdDriverHelper();S.bindTechnique(Z,this.material.parameters,R);for(const ca of this._dataByOrigin.values())for(const ba of ca.buffers){if(W&&
!ba.hasHighlights)continue;const ia=(W?ba.drawCommandsHighlight:N&&ba.needsMultipleCommands()?ba.drawCommandsShadowHighlightRest:ba.drawCommandsDefault)||null,ka=V&&ba.drawCommandsOccludees||null;if(ia?.length||ka?.length)Z.program.bindDraw(new D.DrawParameters(ca.origin),R,this.material.parameters),Z.ensureAttributeLocations(ba.vao),S.bindVAO(ba.vao),ia?.length&&(S.setPipelineState(Z.getPipeline(!1,X,U)),ia.forAll(na=>S.drawArrays(Z.primitiveType,na.first,na.count))),ka?.length&&(S.setPipelineState(Z.getPipeline(!0,
X,U)),ka.forAll(na=>S.drawArrays(Z.primitiveType,na.first,na.count)))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};b.__decorate([l.property({constructOnly:!0})],a.MergedRenderer.prototype,"material",void 0);a.MergedRenderer=b.__decorate([h.subclass("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],a.MergedRenderer);class L{constructor(U){this.origin=U;this.changes=[]}}const J=w.create(),M=w.create(),T=w.create(),Q=new c({allocator:U=>
U||new E.BufferRange,deallocator:null});let O=new Float32Array(65536);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","./basicInterfaces"],function(a,b){class g{constructor(d,k){this._material=d;this._repository=k;this._map=new Map}dispose(){this._map.forEach((d,k)=>{null!=d&&this._repository.release(this._material,k)})}load(d,k,m){if(!this._material.produces(k,m))return null;this._map.has(m)||this._map.set(m,
this._repository.acquire(this._material,k,m));k=this._map.get(m);if(null!=k){if(k.ensureResources(d)===b.ResourceState.LOADED)return k;this._repository.requestRender()}return null}}a.GLMaterials=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../chunks/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,g){class d extends g.VertexNormalDrawParameters{constructor(k=
b.create()){super();this.slicePlaneLocalOrigin=this.origin=k}}a.DrawParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../core/has ../../../../core/time ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ./WaterGLMaterial ./WaterTechnique".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n){class q extends w.TriangleMaterial{constructor(v){super(v,new t);this._configuration=new n.WaterTechniqueConfiguration;this._animation=new c.AnimationTimer}getConfiguration(v,r){this._configuration.output=v;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.receiveShadows=this.parameters.receiveShadows;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasScreenSpaceReflections=
this.parameters.hasScreenSpaceReflections;this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections;this._configuration.isDraped=this.parameters.isDraped;this._configuration.transparencyPassType=r.transparencyPassType;this._configuration.enableOffset=r.camera.relativeElevation<e.OITPolygonOffsetLimit;this._configuration.multipassEnabled=r.multipassEnabled;this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround;return this._configuration}update(v){this._animation.enabled=
35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(v.camera.relativeElevation,v.camera.distance);v=this._animation.advance(v);this.setParameters({timeElapsed:g.secondsFromMilliseconds(this._animation.time)*this.parameters.animationSpeed},!1);return this._animation.enabled&&v}produces(v,r){switch(r){case f.ShaderOutput.Normal:return v===p.RenderSlot.DRAPED_WATER;case f.ShaderOutput.Color:if(this.parameters.isDraped)return v===p.RenderSlot.DRAPED_MATERIAL;break;
case f.ShaderOutput.Alpha:break;case f.ShaderOutput.Highlight:case f.ShaderOutput.ObjectAndLayerIdColor:return v===p.RenderSlot.OPAQUE_MATERIAL||v===p.RenderSlot.DRAPED_MATERIAL;default:return!1}r=p.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(r=this.parameters.writeDepth?p.RenderSlot.TRANSPARENT_MATERIAL:p.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);return v===r}createGLMaterial(v){return new x.WaterGLMaterial(v)}createBufferWriter(){return new h.DefaultBufferWriter(b("enable-feature:objectAndLayerId-rendering")?
u.PositionUVLayoutObjectAndLayerId:u.PositionUVLayout)}get test(){return{animationEnabled:this._animation.enabled}}}class t extends l.MaterialParameters{constructor(){super(...arguments);this.waveStrength=.06;this.waveTextureRepeat=32;this.waveDirection=d.fromValues(1,0);this.waveVelocity=.05;this.flowStrength=.015;this.flowOffset=-.5;this.animationSpeed=.35;this.timeElapsed=0;this.color=m.fromValues(0,0,0,0);this.writeDepth=this.transparent=!0;this.isDraped=this.hasSlicePlane=!1;this.receiveShadows=
!0;this.hasCloudsReflections=this.hasScreenSpaceReflections=!1;this.origin=k.create();this.modelTransformation=null}}a.WaterMaterial=q;a.WaterMaterialParameters=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultLayouts":function(){define(["exports","../../support/buffer/InterleavedLayout","../lib/VertexAttribute"],function(a,b,g){const d=b.newLayout().vec3f(g.VertexAttribute.POSITION),k=b.newLayout().vec3f(g.VertexAttribute.POSITION).vec2f(g.VertexAttribute.UV0),
m=b.newLayout().vec3f(g.VertexAttribute.POSITION).vec4u8(g.VertexAttribute.COLOR),f=b.newLayout().vec3f(g.VertexAttribute.POSITION).vec4u8(g.VertexAttribute.OBJECTANDLAYERIDCOLOR),c=b.newLayout().vec3f(g.VertexAttribute.POSITION).vec2f(g.VertexAttribute.UV0).vec4u8(g.VertexAttribute.OBJECTANDLAYERIDCOLOR);b=b.newLayout().vec3f(g.VertexAttribute.POSITION).vec4u8(g.VertexAttribute.COLOR).vec4u8(g.VertexAttribute.OBJECTANDLAYERIDCOLOR);a.PositionColorLayout=m;a.PositionColorLayoutObjectAndLayerId=b;
a.PositionLayout=d;a.PositionLayoutObjectAndLayerId=f;a.PositionUVLayout=k;a.PositionUVLayoutObjectAndLayerId=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/TriangleMaterial":function(){define(["exports","../lib/Material","./internal/MaterialUtil"],function(a,b,g){class d extends b.Material{intersect(k,m,f,c,l,e){return g.intersectTriangleGeometry(k,f,c,l,void 0,e)}}a.TriangleMaterial=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","./WaterTechnique"],function(a,b,g,d){class k extends g{_updateShadowState(m){m.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:m.shadowMap.enabled})}_updateSSRState(m){m=null!=m.ssr.lastFrameColor;m!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:m})}_updateCloudsReflectionState(m){m=
null!=m.cloudsFade.data;m!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:m})}ensureResources(m){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(m)}beginSlot(m){this._output===b.ShaderOutput.Color&&(this._updateShadowState(m),this._updateSSRState(m),this._updateCloudsReflectionState(m));this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters);return this.ensureTechnique(d.WaterTechnique,
m)}}a.WaterGLMaterial=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){class t extends f.WaterDistortionPassParameters{}class v extends l.ShaderTechnique{initializeConfiguration(y,z){z.spherical=y.viewingMode===d.ViewingMode.Global;z.doublePrecisionRequiresObfuscation=y.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(y){return new u.Program(y.rctx,v.shader.get().build(this.configuration),p.Default3D)}_setPipelineState(y){const z=this.configuration,D=y===w.TransparencyPassType.NONE,C=y===w.TransparencyPassType.FrontFace;
return q.makePipelineState({blending:z.output!==k.ShaderOutput.Normal&&z.output!==k.ShaderOutput.Highlight&&z.output!==k.ShaderOutput.ObjectAndLayerIdColor&&z.transparent?D?h.blendingDefault:h.oitBlending(y):null,depthTest:{func:h.oitDepthTest(y)},depthWrite:D?z.writeDepth?q.defaultDepthWriteParams:null:h.oitDepthWrite(y),colorWrite:q.defaultColorWriteParams,polygonOffset:D||C?null:h.getOITPolygonOffset(z.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}
v.shader=new c.ReloadableShaderModule(n.WaterSurface,()=>new Promise((y,z)=>a(["../shaders/WaterSurface.glsl"],y,z)));class r extends x.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=k.ShaderOutput.Color;this.transparencyPassType=w.TransparencyPassType.NONE;this.transparent=this.hasSlicePlane=this.receiveShadows=this.spherical=!1;this.enableOffset=!0;this.cullAboveGround=this.multipassEnabled=this.isDraped=this.objectAndLayerIdColorInstanced=this.hasCloudsReflections=
this.doublePrecisionRequiresObfuscation=this.hasScreenSpaceReflections=this.writeDepth=!1}}g.__decorate([e.parameter({count:k.ShaderOutput.COUNT})],r.prototype,"output",void 0);g.__decorate([e.parameter({count:w.TransparencyPassType.COUNT})],r.prototype,"transparencyPassType",void 0);g.__decorate([e.parameter()],r.prototype,"spherical",void 0);g.__decorate([e.parameter()],r.prototype,"receiveShadows",void 0);g.__decorate([e.parameter()],r.prototype,"hasSlicePlane",void 0);g.__decorate([e.parameter()],
r.prototype,"transparent",void 0);g.__decorate([e.parameter()],r.prototype,"enableOffset",void 0);g.__decorate([e.parameter()],r.prototype,"writeDepth",void 0);g.__decorate([e.parameter()],r.prototype,"hasScreenSpaceReflections",void 0);g.__decorate([e.parameter()],r.prototype,"doublePrecisionRequiresObfuscation",void 0);g.__decorate([e.parameter()],r.prototype,"hasCloudsReflections",void 0);g.__decorate([e.parameter()],r.prototype,"objectAndLayerIdColorInstanced",void 0);g.__decorate([e.parameter()],
r.prototype,"isDraped",void 0);g.__decorate([e.parameter()],r.prototype,"multipassEnabled",void 0);g.__decorate([e.parameter()],r.prototype,"cullAboveGround",void 0);g.__decorate([e.parameter({constValue:!1})],r.prototype,"occlusionPass",void 0);g.__decorate([e.parameter({constValue:m.PBRMode.Water})],r.prototype,"pbrMode",void 0);g.__decorate([e.parameter({constValue:!0})],r.prototype,"useCustomDTRExponentForWater",void 0);g.__decorate([e.parameter({constValue:!0})],r.prototype,"highStepCount",void 0);
g.__decorate([e.parameter({constValue:!1})],r.prototype,"useFillLights",void 0);b.WaterMaterialPassParameters=t;b.WaterTechnique=v;b.WaterTechniqueConfiguration=r;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./FoamRendering.glsl ./ReadShadowMap.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){class h extends f.ReadShadowMapPassParameters{}const u=k.create(),w=g.create();a.WaterDistortion=function(x){x.fragment.uniforms.add(new p.Texture2DPassUniform("texWaveNormal",n=>n.waveNormal),new p.Texture2DPassUniform("texWavePerturbation",n=>n.wavePerturbation),new l.Float4PassUniform("waveParams",n=>d.set(u,n.waveStrength,n.waveTextureRepeat,n.flowStrength,n.flowOffset)),new c.Float2PassUniform("waveDirection",n=>b.set(w,n.waveDirection[0]*n.waveVelocity,n.waveDirection[1]*
n.waveVelocity)));x.include(m.FoamIntensity);x.fragment.code.add(e.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.WaterDistortionPassParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C){function E(F){const G=new z.ShaderBuilder,{vertex:I,fragment:H}=G;t.addProjViewLocalOrigin(I,F);G.include(k.Transform,F);G.attributes.add(C.VertexAttribute.POSITION,"vec3");G.attributes.add(C.VertexAttribute.UV0,"vec2");const B=new v.Float4PassUniform("waterColor",K=>K.color);if(F.output===g.ShaderOutput.Color&&F.isDraped)return G.varyings.add("vpos","vec3"),I.uniforms.add(B),I.code.add(y.glsl`
        void main(void) {
          if (waterColor.a < ${y.glsl.float(n.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),H.uniforms.add(B),H.code.add(y.glsl`void main() {
fragColor = waterColor;
}`),G;if(F.output===g.ShaderOutput.Color||F.output===g.ShaderOutput.Alpha)G.include(p.NormalUtils,F),G.include(b.ForwardLinearDepth,F),G.varyings.add("vuv","vec2"),G.varyings.add("vpos","vec3"),G.varyings.add("vnormal","vec3"),G.varyings.add("vtbnMatrix","mat3"),F.multipassEnabled&&G.varyings.add("depth","float"),I.uniforms.add(B),I.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(n.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${F.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${F.output===g.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);G.include(e.multipassTerrainTest,F);switch(F.output){case g.ShaderOutput.Alpha:G.include(d.SliceDraw,F);H.uniforms.add(B);H.code.add(y.glsl`
        void main() {
          discardBySlice(vpos);
          ${F.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case g.ShaderOutput.Color:G.include(l.MainLighting);G.include(c.EvaluateAmbientLighting,{pbrMode:h.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});G.include(x.WaterDistortion);G.include(d.SliceDraw,F);G.include(u.ReadShadowMapDraw,F);G.include(w.Water,F);H.uniforms.add(B,new r.FloatPassUniform("timeElapsed",K=>K.timeElapsed),I.uniforms.get("view"),I.uniforms.get("localOrigin"));t.addCameraPosition(H,F);H.include(q.ColorConversion);l.addMainLightDirection(H);l.addMainLightIntensity(H);
H.code.add(y.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${F.receiveShadows?y.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${F.transparencyPassType===D.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `);break;case g.ShaderOutput.Normal:G.include(p.NormalUtils,F);G.include(x.WaterDistortion,F);G.include(d.SliceDraw,F);G.varyings.add("vpos","vec3");G.varyings.add("vuv","vec2");I.uniforms.add(B);I.code.add(y.glsl`
        void main(void) {
          if (waterColor.a < ${y.glsl.float(n.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `);H.uniforms.add(new r.FloatPassUniform("timeElapsed",K=>K.timeElapsed));H.code.add(y.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case g.ShaderOutput.Highlight:G.include(f.OutputHighlight,F);G.varyings.add("vpos","vec3");I.uniforms.add(B);I.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(n.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `);G.include(d.SliceDraw,F);H.code.add(y.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case g.ShaderOutput.ObjectAndLayerIdColor:G.include(m.ObjectAndLayerIdColor,F),G.varyings.add("vpos","vec3"),I.uniforms.add(B),I.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(n.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),G.include(d.SliceDraw,F),H.code.add(y.glsl`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return G}const A=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=A;a.build=E})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(g,d){d.spherical?g.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):g.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);d.spherical?g.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):g.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/BufferRange":function(){define(["exports"],function(a){class b{constructor(g=0,d=0){this.from=g;this.to=d}get numElements(){return this.to-this.from}}a.BufferRange=b;a.mergeAdjacentRanges=function(g){const d=new Map;g.forAll(m=>d.set(m.from,m));let k=!0;for(;k;)k=!1,g.forEach(m=>{const f=d.get(m.to);f&&(m.to=f.to,d.delete(f.from),g.removeUnordered(f),k=!0)})};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","./BufferRange"],function(a,b){class g extends b.BufferRange{constructor(d,k,m){super(k,m);this.geometry=d}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}a.Instance=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerBufferData":function(){define(["exports",
"../../../../../core/PooledArray","./BufferRange","./DrawCommand"],function(a,b,g,d){function k(){return new b({allocator:l=>l||new d.DrawCommand,deallocator:l=>l})}function m(l,e){const p=l.back();null==p?(l=l.pushNew(),l.first=e.from,l.count=e.numElements):p.first+p.count>=e.from?p.count=e.from-p.first+e.numElements:(l=l.pushNew(),l.first=e.from,l.count=e.numElements)}class f{constructor(){this._numElements=0;this._instances=new Map;this.holes=new b({allocator:l=>l||new g.BufferRange,deallocator:null});
this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1;this.drawCommandsDirty=!0;this.drawCommandsDefault=k();this.drawCommandsHighlight=k();this.drawCommandsOccludees=k();this.drawCommandsShadowHighlightRest=k()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(l,e){this.deleteInstance(l);this._instances.set(l,e);this._numElements+=e.numElements}deleteInstance(l){const e=this._instances.get(l);e&&(this._numElements-=e.numElements,this._instances.delete(l))}updateInstance(l,
e,p){if(l=this._instances.get(l))this._numElements-=l.numElements,l.from=e,l.to=p,this._numElements+=l.numElements}updateDrawState(l){l.isVisible?(l.hasHighlights&&(this.hasHighlights=!0),l.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(l){this.drawCommandsDefault.clear();this.drawCommandsHighlight.clear();this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){l=
Array.from(this._instances.values()).sort((p,h)=>p.from===h.from?p.to-h.to:p.from-h.from);for(var e of l)e.isVisible&&(m(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),m(e.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,e))}else{const p=this.drawCommandsDefault.pushNew();e=this.holes.front();null!=this.vao&&1===this.holes.length&&e.to===Math.floor(this.vao.byteSize/l)?(p.first=0,p.count=e.from):(p.first=Infinity,p.count=0,this._instances.forEach(h=>
{p.first=Math.min(p.first,h.from);p.count=Math.max(p.count,h.to)}),p.count-=p.first)}}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}class c extends f{}a.PerBufferData=f;a.PerVaoData=c;a.hasVao=function(l){return null!=l.vao};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/DrawCommand":function(){define(["exports"],function(a){class b{constructor(){this.count=this.first=0}}a.DrawCommand=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerOriginData":function(){define(["exports"],function(a){class b{constructor(g){this.origin=g;this.buffers=[]}dispose(){this.buffers.forEach(g=>g.vao.dispose());this.buffers.length=0}findBuffer(g){return this.buffers.find(d=>d.instances.has(g))}}a.PerOriginData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/VaoCache":function(){define("exports ../../../../../core/MemCache ../../../../../core/MemCachePool ../../lib/VertexArrayObject ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,g,d,k,m){const f=b.minPriority+1;class c{constructor(l,e,p){this._rctx=l;this._locations=e;this._layout=p;this._cache=new g.MemCachePool(l.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(l){let e=this._cache.pop(l.toString());if(e)return e;e=new d.VertexArrayObject(this._rctx,this._locations,{geometry:this._layout},{geometry:k.BufferObject.createVertex(this._rctx,m.Usage.STATIC_DRAW)});e.vertexBuffers.geometry.setSize(l);return e}deleteVao(l){null!=l&&this._cache.put(l.byteSize.toString(),
l,f)}}a.VaoCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c,l){class e extends k.ShaderTechnique{initializeProgram(p){return new f.Program(p.rctx,
e.shader.get().build(),m.Default3D)}initializePipeline(){return this.configuration.hasAlpha?l.makePipelineState({blending:l.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:l.defaultColorWriteParams}):l.makePipelineState({colorWrite:l.defaultColorWriteParams})}}e.shader=new d.ReloadableShaderModule(g.TextureOnly,()=>new Promise((p,h)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],p,h)));b.TextureTechnique=
e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,g){class d extends g.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasAlpha=!1}}b.__decorate([g.parameter()],d.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/OverlayCompositing.glsl":function(){define("exports ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,g,d,k,m,f,c){function l(){const h=
new f.ShaderBuilder;h.include(g.ScreenSpacePass);h.fragment.uniforms.add(new c.Texture2DPassUniform("tex",u=>u.texture));h.fragment.uniforms.add(new k.IntegerPassUniform("overlayIdx",u=>u.overlayIndex));h.fragment.uniforms.add(new d.FloatPassUniform("opacity",u=>u.opacity));h.fragment.code.add(m.glsl`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`);return h}class e extends m.NoParameters{constructor(){super(...arguments);this.overlayIndex=b.OverlayIndex.INNER;this.opacity=1}}const p=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:e,build:l},Symbol.toStringTag,{value:"Module"}));a.OverlayCompositing=p;a.OverlayCompositingPassParameters=e;a.build=l})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OverlayCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l){class e extends d.ShaderTechnique{initializeProgram(p){return new m.Program(p.rctx,e.shader.get().build(),k.Default3D)}initializePipeline(){return l.makePipelineState({blending:l.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:l.defaultColorWriteParams})}}e.shader=new g.ReloadableShaderModule(f.OverlayCompositing,()=>new Promise((p,h)=>a(["./OverlayCompositing.glsl"],p,h)));b.OverlayCompositingTechnique=e;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Normals":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3"],function(a,b,g){function d(f,c,l,e,p,h=2){var u=1/(Math.abs(l)+Math.abs(e)+Math.abs(p));l*=u;e*=u;u=0>=p?(0<=e?1:-1)*(1-Math.abs(l)):e;c*=h;f[c]=k(0>=p?(0<=l?1:-1)*(1-Math.abs(e)):l);f[c+1]=k(u)}function k(f){return b.clamp(Math.round(32767*f),-32767,32767)}function m(f){return b.clamp(f/32767,-1,1)}a.compressNormal=d;a.compressNormals=function(f){const c=
f.length/3,l=new Int16Array(2*c);let e=0;for(let p=0;p<c;++p)d(l,p,f[e++],f[e++],f[e++]);return l};a.decodeInt16=m;a.decompressNormal=function(f,c,l,e=2){e*=l;l=m(c[e]);c=m(c[e+1]);e=1-Math.abs(l)-Math.abs(c);f[2]=e;0>e?(f[0]=(0<=l?1:-1)*(1-Math.abs(c)),f[1]=(0<=c?1:-1)*(1-Math.abs(l))):(f[0]=l,f[1]=c);g.normalize(f,f)};a.encodeInt16=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ../support/FastSymbolUpdates ../../support/engineContent/sdfPrimitives ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q){function O(S){return null==S?!1:"cross"===S||"x"===S}const U=h.fromValues(0,0,1);d=B.defaultTexSize;const Z=B.defaultSymbolSizeRatio,P=[Z/2,Z/2,1-Z/2,1-Z/2];class R extends E.Graphics3DSymbolLayer{getCachedSize(){return{size:this._getIconSize()}}constructor(S,X,ca,ba){super(S,X,ca,ba);this._cimLayers=null;this._cimSymbolMaterials=new Map;this._cimSymbolTextures=new Map;this._size=this._cimScaleFactorOrFunction=this._cimRequiredFields=
this._cimMaterialParametersInfo=null;this._symbolTextureRatio=1;this._outlineSize=0;this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(S){this._validateOrThrow();const X=this._prepareMaterialParameters();var ca=this._getPrimitive();if(null!=ca)this._prepareResourcesPrimitive(X,ca);else{ca=t.getIconHref(this.symbolLayer);const ba=e.dataComponents(ca);ba&&"application/json"===ba.mediaType?await this._prepareResourcesCIM(X,JSON.parse(ba.data),S):await this._prepareResourcesHref(X,
ca,S)}}_validateOrThrow(){if(!this._drivenProperties.size){var S=A.validateSymbolLayerSize(this._getIconSize());if(S)throw new m("graphics3diconsymbollayer:invalid-size",S);}}_getIconSize(){var S=this.symbolLayer;S=Math.round(null!=S.size?l.pt2px(S.size):16);return this._drivenProperties.size?Math.max(S,64):S}_generateTextureCIM(S){const X=this._getGraphicHash(S);let ca=""===X?null:this._cimSymbolTextures.get(X);ca||(S=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,
S,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},void 0,void 0),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",S.anchorPosition),ca=new M.Texture(S.imageData,{width:S.imageData.width,height:S.imageData.height}),this._cimSymbolTextures.set(X,ca),this._context.stage.add(ca));return ca}_prepareMaterialParameters(){const S={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},X=this.symbol;if(X&&"point-3d"===X.type&&
X.hasVisibleVerticalOffset()){const {screenLength:ca,minWorldLength:ba,maxWorldLength:ia}=X.verticalOffset;S.verticalOffset={screenLength:l.pt2px(ca),minWorldLength:ba||0,maxWorldLength:null!=ia?ia:Infinity}}this._context.screenSizePerspectiveEnabled&&(S.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);S.occlusionTest=!0;S.hasSlicePlane=this._context.slicePlaneEnabled;return S}_prepareResourcesPrimitive(S,X){var ca=this._getOutlineSize();if(O(X)&&0===ca)throw Error("Nothing to render");
this._outlineSize=ca;S.color=this._getFillColor();S.outlineColor=this._getOutlineColor();S.outlineSize=this._outlineSize;null!=this._context.sharedResources.textures&&(this._textureHandle=ca=this._context.sharedResources.textures.fromData(`${X}-icon`,()=>B.createTexture(X)),S.textureId=ca.texture.id);S.textureIsSignedDistanceField=!0;S.sampleSignedDistanceFieldTexelCenter=B.requiresHalfTexelOffset(X);S.distanceFieldBoundingBox=P;ca=this._getIconSize();this._size=[ca,ca];this._symbolTextureRatio=1/
Z;this._createMaterialAndAddToStage(S,this._context.stage)}async _prepareResourcesHref(S,X,ca){this._outlineSize=this._getOutlineSize();S.color=this._getFillColor();S.outlineColor=this._getOutlineColor();S.outlineSize=this._outlineSize;S.textureIsSignedDistanceField=!1;const ba=this._getIconSize(),ia=ba*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(null!=this._context.sharedResources.textures){ca=await k.result(this._context.sharedResources.textures.fromUrl(X,ia,{signal:ca}));if(!1===
ca.ok)throw c.throwIfAbortError(ca.error),new m("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${X})`);this._textureHandle=ca.value;X=ca.value.texture;ca=X.parameters.width/X.parameters.height;this._size=1<ca?[ba,Math.round(ba/ca)]:[Math.round(ba*ca),ba];S.textureId=X.id}this._createMaterialAndAddToStage(S,this._context.stage)}async _prepareResourcesCIM(S,X,ca){X=new Q({data:X});if(!this._context.sharedResources.cimSymbolRasterizer){var ba=(await new Promise((Y,
ea)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],Y,ea))).CIMSymbolRasterizer;c.throwIfAborted(ca);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new ba(this._context.renderCoordsHelper.spatialReference,!0))}ba=this._context.layer.fields?this._context.layer.fields.map(Y=>Y.toJSON()):null;this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(X,ba,this._context.renderer&&"dictionary"===this._context.renderer.type?
this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:ca});let ia;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(X=this._context.renderer,isNaN(X.scaleExpression)){const Y=await n.createRendererExpression(X.scaleExpression,this._context.layer.spatialReference,ba);ia=(ea,fa,aa)=>{ea=v(Y,ea,{$view:aa},"esriGeometryPoint",fa);return null!==ea?ea:1}}else var ka=Number(X.scaleExpression);this._cimScaleFactorOrFunction=ka||ia||
1;ka=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];c.throwIfAborted(ca);const na=this._context.layer.fieldsIndex;this._cimRequiredFields=ka.map(Y=>na.get(Y).name);this._cimMaterialParametersInfo=S;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&
this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||q.defaultPrimitive}_getOutlineSize(){var S=0;S=this.symbolLayer;if(null!=S.outline?.size)return Math.max(l.pt2px(S.outline.size),0);S=this._getPrimitive();S=O(S)?1.5:0;return Math.max(S,0)}_getOutlineColor(){const S=this._getLayerOpacity(),X=this.symbolLayer?.outline?.color;if(null!=X){const ca=g.toUnitRGB(X);return[ca[0],ca[1],ca[2],X.a*S]}return[0,0,0,0]}_getFillColor(){if(O(this._getPrimitive()))return r.transparentUnit;
const S=null==this._getPrimitive();return this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color,{hasIntrinsicColor:S})}_getAnchorPos(S,X){return"relative"===S?p.fromValues((X.x||0)+.5,-(X.y||0)+.5):S in G.namedAnchorToHUDMaterialAnchorPos?G.namedAnchorToHUDMaterialAnchorPos[S]:G.namedAnchorToHUDMaterialAnchorPos.center}_createMaterialAndAddToStage(S,X){if(this._cimLayers){this._fastUpdates=null;let ca=S.textureId?this._cimSymbolMaterials.get(S.textureId):null;ca||(ca=new T.HUDMaterial(S),
this._cimSymbolMaterials.set(S.textureId??0,ca),X.add(ca));return ca}(this._fastUpdates=H.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()))&&(S={...S,...this._fastUpdates.materialParameters});this._materials[0]=new T.HUDMaterial(S);X.add(this._materials[0]);return this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(S=>{S.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,
shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy();this._forEachMaterial(S=>this._context.stage.remove(S));this._materials.length=0;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(S=>this._context.stage.remove(S));this._cimSymbolTextures.clear();this._textureHandle=f.releaseMaybe(this._textureHandle)}_getScaleFactor(S,X){if(this._drivenProperties.size&&S.size){for(let ca=0;3>ca;ca++){const ba=S.size[ca];ba&&"symbol-value"!==ba&&"proportional"!==
ba&&(S.size[ca]=l.pt2px(ba))}if("symbol-value"===S.size[0])return 1;if(isFinite(+S.size[0]))return+S.size[0]/X;if(isFinite(+S.size[2]))return+S.size[2]/X}return 1}createGraphics3DGraphic(S){const X=S.graphic;if(!this._validateGeometry(X.geometry))return null;var ca=[0,0];let ba;if(this._cimLayers){if(!this._cimLayers.length)return null;var ia=this._generateTextureCIM(X);ba=this._createMaterialAndAddToStage({textureId:ia.id,...this._cimMaterialParametersInfo},this._context.stage);ca=[ia.parameters.width,
ia.parameters.height]}else ca=this._size,ba=this._materials[0];ia=I.placePointOnGeometry(X.geometry);if(null==ia)return this.logger.warn(`unsupported geometry type for icon symbol: ${X.geometry.type}`),null;var ka=S.renderingInfo;const na=this._getVertexOpacityAndColor(ka);let Y=1;this._fastUpdates?.visualVariables.size||(Y=this._getScaleFactor(ka,ca[0]>ca[1]?ca[0]:ca[1]));Y*=this._symbolTextureRatio;ca=p.fromValues(ca[0]*Y,ca[1]*Y);ka=this.setGraphicElevationContext(X);this.ensureDrapedStatus("on-the-ground"===
ka.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(X,ia,ba,na,ca,S.layer.uid):this._createAs3DShape(X,ia,ba,na,ca,ka,X.uid)}layerOpacityChanged(){const S=this._getFillColor(),X=this._getOutlineColor();this._forEachMaterial(ca=>{ca.setParameters({color:S});ca.setParameters({outlineColor:X})})}layerElevationInfoChanged(S,X,ca){const ba=this._elevationContext.mode;ca=z.elevationModeChangeUpdateType(R.elevationModeChangeTypes,ca,ba);if(ca!==z.SymbolUpdateType.UPDATE)return ca;
const ia=z.needsElevationUpdates2D(ba)||"absolute-height"===ba;return this.updateGraphics3DGraphicElevationInfo(S,X,()=>ia)}slicePlaneEnabledChanged(){this.draped||this._forEachMaterial(S=>{S.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(S,X){for(const ca in S.diff)switch(ca){case "visualVariables":if(H.updateFastSymbolUpdatesState(this._fastUpdates,X,this._fastVisualVariableConvertOptions()))this._materials[0]?.setParameters(this._fastUpdates.materialParameters);
else return F.ApplyRendererDiffResult.RecreateSymbol;break;default:return F.ApplyRendererDiffResult.RecreateSymbol}return F.ApplyRendererDiffResult.FastUpdate}_defaultElevationInfoNoZ(){return W}_createAs3DShape(S,X,ca,ba,ia,ka,na){S=this.getFastUpdateAttrValues(S);const Y=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:na,layerUid:this._context.layer.uid});ba=L.createPointGeometry(ca,U,null,ba,ia,N,null,S,Y);na=I.createStageObject(this._context,X,ba,ka,na);if(null==na)return null;
const ea=new C.Graphics3DObject3DGraphicLayer(this,na.object,[ba],null,null,y.perObjectElevationAligner,ka);ea.alignedSampledElevation=na.sampledElevation;ea.needsElevationUpdates=z.needsElevationUpdates2D(ka.mode)||"absolute-height"===ka.mode;ea.getScreenSize=this._createScreenSizeGetter(ia,S);ea.calculateRelativeScreenBounds=fa=>ca.calculateRelativeScreenBounds(ea.getScreenSize(),1,fa);I.extendPointGraphicElevationContext(ea,X,this._context.elevationProvider);return ea}_createAsOverlay(S,X,ca,ba,
ia,ka){ca.renderPriority=this._renderPriority;const na=u.create();w.projectPointToVector(X,na,this._context.overlaySR);na[2]=K.drapedZ;X=this._context.clippingExtent;if(null!=X&&!x.containsPoint(X,na))return null;X=this.getFastUpdateAttrValues(S);const Y=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:S.uid,layerUid:this._context.layer.uid});ba=L.createPointGeometry(ca,U,na,ba,ia,null,null,X,Y);S=new J.RenderGeometry(ba,{layerUid:ka,graphicUid:S.uid});const ea=new D.Graphics3DDrapedGraphicLayer(this,
[S],null,this._context.drapeSourceRenderer);ea.getScreenSize=this._createScreenSizeGetter(ia,X);ea.calculateRelativeScreenBounds=fa=>ca.calculateRelativeScreenBounds(ea.getScreenSize(),1,fa);return ea}_createScreenSizeGetter(S,X){const ca=this._outlineSize+2;if(this._fastUpdates&&X){const ka=S[0]/this._symbolTextureRatio,na=S[1]/this._symbolTextureRatio;return(Y=p.create())=>{const [ea,fa]=H.evaluateModelTransformScale(V,this._fastUpdates.materialParameters,X);Y[0]=ea*ka+ca;Y[1]=fa*na+ca;return Y}}const ba=
S[0]/this._symbolTextureRatio+ca,ia=S[1]/this._symbolTextureRatio+ca;return(ka=p.create())=>{ka[0]=ba;ka[1]=ia;return ka}}_fastVisualVariableConvertOptions(){var S=Math.max(this._size[0],this._size[1]);const X=h.fromValues(S,S,S),ca=l.px2pt(1);S*=ca;S=h.fromValues(S,S,S);return new H.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},X,S,ca)}_getGraphicHash(S){let X="";for(const ca of this._cimRequiredFields)X+=ca+S.attributes[ca];return X}_forEachMaterial(S){this._materials.forEach(S);this._cimSymbolMaterials.forEach(S)}test(){return{...super.test(),
material:this._materials[0]}}}R.PRIMITIVE_SIZE=[d*Z,d*Z];R.elevationModeChangeTypes={definedChanged:z.SymbolUpdateType.UPDATE,staysOnTheGround:z.SymbolUpdateType.NONE,onTheGroundChanged:z.SymbolUpdateType.RECREATE};const W={mode:"relative-to-ground",offset:0},N=u.fromValues(0,0,0,1),V=h.create();b.Graphics3DIconSymbolLayer=R;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./cimSymbolUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){function u(C){C=C.symbolLayers;if(!C)return null;let E=null;C.forEach(A=>{"object"===A.type&&A.resource?.href||(E="water"===A.type?A.color:A.material?A.material.color:null)});return E?new g(E):null}function w(C,E){if(null==E||null==C)return C;C=C.toRgba();C[3]*=E;return new g(C)}function x(C,E,A){if(C=C.symbolLayers){var F=G=>{E=E??G??(null!=A?D:null);return w(E,A)};C.forEach(G=>{if("object"!==G.type||!G.resource?.href||E)if("water"===G.type)G.color=F(G.color);else{const I=
F(null!=G.material?G.material.color:null);null==G.material?G.material=new h.Symbol3DMaterial({color:I}):G.material.color=I;null!=A&&"outline"in G&&null!=G.outline?.color&&(G.outline.color=w(G.outline.color,A))}})}}async function n(C,E){(C=C.symbolLayers)&&await k.forEach(C,async A=>q(A,E))}async function q(C,E){switch(C.type){case "extrude":C.size="number"===typeof E[2]?E[2]:0;break;case "icon":case "line":case "text":E=t(E);null!=E&&(C.size=E);break;case "path":const A=r(E,c.ONES,[C.width,void 0,
C.height]);C.width=z(E[0],C.width,1,A);C.height=z(E[2],C.height,1,A);break;case "object":await v(C,E)}}function t(C){for(const E of C)if("number"===typeof E)return E;return null}async function v(C,E){const {resourceSize:A,symbolSize:F}=await y(C),G=r(E,A,F);C.width=z(E[0],F[0],A[0],G);C.depth=z(E[1],F[1],A[1],G);C.height=z(E[2],F[2],A[2],G)}function r(C,E,A){for(let F=0;3>F;F++){const G=C[F];switch(G){case "symbol-value":return C=A[F],null!=C?C/E[F]:1;case "proportional":break;default:if(G&&E[F])return G/
E[F]}}return 1}async function y(C){var {computeObjectLayerResourceSize:E}=await new Promise((B,K)=>a(["./symbolLayerUtils"],B,K));E=await E(C,10);const {width:A,height:F,depth:G}=C;C=[A,G,F];let I=1;for(var H=0;3>H;H++){const B=C[H];if(null!=B){I=B/E[H];break}}for(H=0;3>H;H++)null==C[H]&&(C[H]=E[H]*I);return{resourceSize:E,symbolSize:C}}function z(C,E,A,F){switch(C){case "proportional":return A*F;case "symbol-value":return null!=E?E:A;default:return C}}const D=new g("white");b.applyColorToSymbol=
function(C,E,A){if(C&&(E||null!=A))if(E&&(E=new g(E)),d.isSymbol3D(C))x(C,E,A);else if(d.isSymbol2D(C)){if(E=E??C.color)C.color=w(E,A);null!=A&&"outline"in C&&C.outline?.color&&(C.outline.color=w(C.outline.color,A))}};b.applyOpacityToColor=w;b.applyRotationToSymbol=function(C,E,A){C&&null!=E&&(d.isSymbol3D(C)?(C=C.symbolLayers)&&C.forEach(F=>{if(F&&"object"===F.type)switch(A){case "tilt":F.tilt=E;break;case "roll":F.roll=E;break;default:F.heading=E}}):!d.isSymbol2D(C)||"simple-marker"!==C.type&&"picture-marker"!==
C.type&&"text"!==C.type||(C.angle=E))};b.applySizesToSymbol=async function(C,E){if(C&&E){if(d.isSymbol3D(C))return n(C,E);if(d.isSymbol2D(C)&&(E=t(E),null!=E))switch(C.type){case "simple-marker":C.size=E;break;case "picture-marker":const A=C.width/C.height;1<A?(C.width=E,C.height=E*A):(C.width=E*A,C.height=E);break;case "simple-line":C.width=E;break;case "text":C.font.size=E}}};b.fetchWebStyleSymbol=async function(C,E){const A=await C.fetchSymbol(E);return A?A:C.fetchCIMSymbol(E)};b.getCSSFilterFromEffectList=
function(C){if(!C)return null;C=C.effects.filter(E=>"bloom"!==E.type).map(E=>E.toJSON());return l.effectFunctionsFromJSON(C)};b.getColorFromSymbol=function(C,E){if(!C)return null;let A=null;d.isSymbol3D(C)?A=u(C):d.isSymbol2D(C)&&(A="cim"===C.type?e.getCIMSymbolColor(C):C.color?new g(C.color):null);return A?w(A,E):null};b.getIconHref=function(C){return C.resource?.href??""};b.getSymbolOutlineSize=function(C){return C?d.isSymbol3D(C)?(C=(C=C.symbolLayers?.at(-1))&&"outline"in C?C?.outline?.size:void 0,
null!=C?C:0):f.px2pt(p.getStroke(C)?.width):0};b.isVolumetricSymbol=function(C){if(null==C||!("symbolLayers"in C)||null==C.symbolLayers)return!1;switch(C.type){case "point-3d":return C.symbolLayers.some(E=>"object"===E.type);case "line-3d":return C.symbolLayers.some(E=>"path"===E.type);case "polygon-3d":return C.symbolLayers.some(E=>"object"===E.type||"extrude"===E.type);default:return!1}};b.symbolHasExtrudeSymbolLayer=function(C){return null!=C&&"polygon-3d"===C.type&&C.symbolLayers.some(E=>"extrude"===
E.type)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,g){function d(h){h=g.toCIMSymbolJSON(h);if("CIMTextSymbol"===h?.type)return h.height??0;let u=0;if(h?.symbolLayers)for(const w of h.symbolLayers)g.isCIMMarker(w)&&null!=w.size&&w.size>u?u=w.size:g.isCIMStroke(w)&&null!=w.width&&w.width>u?u=w.width:g.isCIMFill(w);return u}function k(h,u,w,x){if(h)if("CIMTextSymbol"===
h.type)null!=h.height&&(h.height*=u);else{if(w&&h.effects)for(const n of h.effects)c(n,u);if(h.symbolLayers)for(const n of h.symbolLayers)switch(n.type){case "CIMPictureMarker":case "CIMVectorMarker":m(n,u,x);break;case "CIMPictureStroke":case "CIMSolidStroke":!x?.preserveOutlineWidth&&n.width&&(n.width*=u);break;case "CIMPictureFill":n.height&&(n.height*=u);n.offsetX&&(n.offsetX*=u);n.offsetY&&(n.offsetY*=u);break;case "CIMHatchFill":k(n.lineSymbol,u,!0,{...x,preserveOutlineWidth:!1}),n.offsetX&&
(n.offsetX*=u),n.offsetY&&(n.offsetY*=u),n.separation&&(n.separation*=u)}}}function m(h,u,w){if(h&&(h.markerPlacement&&f(h.markerPlacement,u),h.offsetX&&(h.offsetX*=u),h.offsetY&&(h.offsetY*=u),h.anchorPoint&&"Absolute"===h.anchorPointUnits&&(h.anchorPoint={x:h.anchorPoint.x*u,y:h.anchorPoint.y*u}),h.size=null!=h.size?h.size*u:0,"CIMVectorMarker"===h.type&&h.markerGraphics))for(const x of h.markerGraphics)h.scaleSymbolsProportionally||k(x.symbol,u,!0,w)}function f(h,u){g.isCIMMarkerStrokePlacement(h)&&
h.offset&&(h.offset*=u);switch(h.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":h.customEndingOffset&&(h.customEndingOffset*=u);h.offsetAlongLine&&(h.offsetAlongLine*=u);if(h.placementTemplate&&h.placementTemplate.length){var w=h.placementTemplate.map(x=>x*u);h.placementTemplate=w}break;case "CIMMarkerPlacementAlongLineVariableSize":h.maxRandomOffset&&(h.maxRandomOffset*=u);h.placementTemplate&&h.placementTemplate.length&&(w=h.placementTemplate.map(x=>
x*u),h.placementTemplate=w);break;case "CIMMarkerPlacementOnLine":h.startPointOffset&&(h.startPointOffset*=u);break;case "CIMMarkerPlacementAtExtremities":h.offsetAlongLine&&(h.offsetAlongLine*=u);break;case "CIMMarkerPlacementAtRatioPositions":h.beginPosition&&(h.beginPosition*=u);h.endPosition&&(h.endPosition*=u);break;case "CIMMarkerPlacementPolygonCenter":h.offsetX&&(h.offsetX*=u);h.offsetY&&(h.offsetY*=u);break;case "CIMMarkerPlacementInsidePolygon":h.offsetX&&(h.offsetX*=u),h.offsetY&&(h.offsetY*=
u),h.stepX&&(h.stepX*=u),h.stepY&&(h.stepY*=u)}}function c(h,u){switch(h.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":h.width&&(h.width*=u);break;case "CIMGeometricEffectBuffer":h.size&&(h.size*=u);break;case "CIMGeometricEffectCut":h.beginCut&&(h.beginCut*=u);h.endCut&&(h.endCut*=u);h.middleCut&&(h.middleCut*=u);break;case "CIMGeometricEffectDashes":h.customEndingOffset&&(h.customEndingOffset*=u);h.offsetAlongLine&&(h.offsetAlongLine*=u);if(h.dashTemplate&&h.dashTemplate.length){const w=
h.dashTemplate.map(x=>x*u);h.dashTemplate=w}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":h.length&&(h.length*=u);break;case "CIMGeometricEffectMove":h.offsetX&&(h.offsetX*=u);h.offsetY&&(h.offsetY*=u);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":h.offset&&(h.offset*=u);break;case "CIMGeometricEffectRegularPolygon":h.radius&&(h.radius*=u);break;case "CIMGeometricEffectTaperedPolygon":h.fromWidth&&(h.fromWidth*=
u);h.length&&(h.length*=u);h.toWidth&&(h.toWidth*=u);break;case "CIMGeometricEffectWave":h.amplitude&&(h.amplitude*=u),h.period&&(h.period*=u)}}function l(h,u){if(h){var w="CIMTextSymbol"===h.type?h.symbol:h;h="CIMPolygonSymbol"===h.type;if(w?.symbolLayers)for(const x of w.symbolLayers)if(!(x.colorLocked||h&&(g.isCIMStroke(x)||g.isCIMMarker(x)&&x.markerPlacement&&g.isCIMMarkerStrokePlacement(x.markerPlacement))))switch(x.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":x.tintColor&&
e(u,x.tintColor);break;case "CIMVectorMarker":x.markerGraphics?.forEach(n=>{l(n.symbol,u)});break;case "CIMSolidStroke":case "CIMSolidFill":e(u,x.color);break;case "CIMHatchFill":l(x.lineSymbol,u)}}}function e(h,u){for(const w of h)if(w.join(".")===u.join("."))return;h.push(u)}function p(h,u,w){if(h){var x="CIMTextSymbol"===h.type?h.symbol:h;h="CIMPolygonSymbol"===x?.type;if(x?.symbolLayers)for(const n of x.symbolLayers)if(!n.colorLocked){if(h)if(w){if({layersToColor:x}=w,(g.isCIMStroke(n)||g.isCIMMarker(n)&&
n.markerPlacement&&g.isCIMMarkerStrokePlacement(n.markerPlacement))&&"fill"===x||g.isCIMFill(n)&&"outline"===x)continue}else if(g.isCIMStroke(n)||g.isCIMMarker(n)&&n.markerPlacement&&g.isCIMMarkerStrokePlacement(n.markerPlacement))continue;x=u.toArray();switch(n.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":n.tintColor=x;break;case "CIMVectorMarker":n.markerGraphics?.forEach(q=>{p(q.symbol,u,w)});break;case "CIMSolidStroke":case "CIMSolidFill":n.color=x;break;case "CIMHatchFill":p(n.lineSymbol,
u,w)}}}}a.applyCIMSymbolColor=function(h,u,w){u instanceof b||(u=new b(u));(h=g.toCIMSymbolJSON(h))&&p(h,u,w)};a.applyCIMSymbolRotation=function(h,u,w=!1){h=g.toCIMSymbolJSON(h);w&&0!==u&&(u=360-u);if("CIMTextSymbol"===h?.type)h.angle=u;else if("CIMPointSymbol"===h?.type&&h.symbolLayers){w=u-(h.angle||0);for(const x of h.symbolLayers)if(g.isCIMMarker(x)){let n=x.rotation||0;n=x.rotateClockwise?n-w:n+w;x.rotation=n}h.angle=u}};a.getCIMSymbolColor=function(h){h=g.toCIMSymbolJSON(h);const u=[];l(h,u);
return u.length?new b(g.fromCIMColor(u[0])):null};a.getCIMSymbolRotation=function(h,u=!1){h=g.toCIMSymbolJSON(h);return"CIMTextSymbol"===h?.type||"CIMPointSymbol"===h?.type?(h=h.angle,null!=h&&0!==h&&u?360-h:h??0):0};a.getCIMSymbolSize=d;a.getCIMSymbolType=function(h){h=g.toCIMSymbolJSON(h);if(!h)return null;switch(h.type){case "CIMPointSymbol":return"CIMPointSymbol";case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";
case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};a.scaleCIMMarker=m;a.scaleCIMSymbol=k;a.scaleCIMSymbolTo=function(h,u,w){if(h){var x=g.toCIMSymbolJSON(h);h=d(h);if(0===h){if(x)if("CIMTextSymbol"===x.type)x.height=u;else if(x.symbolLayers)for(const n of x.symbolLayers)switch(n.type){case "CIMPictureMarker":case "CIMVectorMarker":n.size=u;break;case "CIMPictureStroke":case "CIMSolidStroke":n.width=u}}else k(x,u/h,!1,w)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,b){function g(h){return"function"===typeof h}function d(h){let u=h.length;for(;u--;)if(!" /-,\n".includes(h.charAt(u)))return!1;return!0}function k(h,u){const w=[];var x=0;let n=-1;do n=h.indexOf("[",x),n>=x&&(n>x&&(x=h.substr(x,n-x),w.push([x,null,d(x)])),x=n+1,n=h.indexOf("]",x),n>=x&&(n>x&&(x=h.substr(x,n-x),(x=u[x])&&w.push([null,x,!1])),x=n+1));while(-1!==n);x<h.length-1&&(h=h.substr(x),w.push([h,null,d(h)]));return w}
function m(h,u,w){let x="",n=null;for(const q of u){const [t,v,r]=q;if(t)r?n=t:(n&&(x+=n,n=null),x+=t);else if(u=h.attributes[v])n&&(x+=n,n=null),x+=u}return f(x,w)}function f(h,u){"string"!==typeof h&&(h=String(h));switch(u){case "LowerCase":return h.toLowerCase();case "Allcaps":return h.toUpperCase();default:return h}}function c(h){return h?{r:h[0],g:h[1],b:h[2],a:h[3]/255}:{r:0,g:0,b:0,a:0}}function l(h){if(!h)return null;switch(h.type){case "CIMPolygonSymbol":if(h.symbolLayers)for(const u of h.symbolLayers)if(h=
l(u),null!=h)return h;break;case "CIMTextSymbol":return l(h.symbol);case "CIMSolidFill":return h.color}}function e(h){if(h)switch(h.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(h=h.symbolLayers)for(const u of h)if(h=e(u),null!=h)return h;break;case "CIMTextSymbol":return e(h.symbol);case "CIMSolidStroke":return h.color}}function p(h){if(h)switch(h.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(h.symbolLayers)for(const u of h.symbolLayers)if(h=p(u),void 0!==h)return h;break;case "CIMTextSymbol":return p(h.symbol);
case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return h.width}}b.adjustTextCase=f;b.analyzeTextParts=k;b.assignTextValuesFromFeature=m;b.attributesToFields=function(h){return(h?Object.keys(h):[]).map(u=>({name:u,alias:u,type:"string"===typeof h[u]?"esriFieldTypeString":"esriFieldTypeDouble"}))};b.colorToArray=function(h){return[h.r,h.g,h.b,h.a]};b.createLabelOverrideFunction=function(h,u,w){const x=k(u,h);return n=>m(n,x,w)};b.evaluateValueOrFunction=function(h,u,w,x){return g(h)?
h(u,w,x):h};b.fromCIMColor=c;b.fromCIMFontDecoration=function(h){return h.underline?"underline":h.strikethrough?"line-through":"none"};b.fromCIMFontStyle=function(h){let u="normal",w="normal";h&&(h=h.toLowerCase(),h.includes("italic")?u="italic":h.includes("oblique")&&(u="oblique"),h.includes("bold")?w="bold":h.includes("light")&&(w="lighter"));return{style:u,weight:w}};b.fromCIMHorizontalAlignment=function(h){switch(h){default:return"left";case "Right":return"right";case "Center":return"center";
case "Justify":return"center"}};b.fromCIMVerticalAlignment=function(h){switch(h){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};b.getFillColor=l;b.getFontStyle=function(h){if(!h)return"normal";switch(h.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};b.getFontWeight=function(h){if(!h)return"normal";switch(h.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";
default:return"normal"}};b.getStrokeColor=e;b.getStrokeWidth=p;b.getTintColor=h=>h.tintColor?c(h.tintColor):{r:255,g:255,b:255,a:1};b.getValue=(h,u=0)=>null==h||isNaN(h)?u:h;b.importGeometryEngine=function(){return new Promise((h,u)=>a(["../../geometry/geometryEngineJSON"],h,u))};b.isCIMFill=function(h){return null!=h&&("CIMGradientFill"===h.type||"CIMHatchFill"===h.type||"CIMPictureFill"===h.type||"CIMSolidFill"===h.type||"CIMWaterFill"===h.type)};b.isCIMMarker=function(h){return"CIMVectorMarker"===
h.type||"CIMPictureMarker"===h.type||"CIMBarChartMarker"===h.type||"CIMCharacterMarker"===h.type||"CIMPieChartMarker"===h.type||"CIMStackedBarChartMarker"===h.type};b.isCIMMarkerStrokePlacement=function(h){return null!=h&&("CIMMarkerPlacementAlongLineRandomSize"===h.type||"CIMMarkerPlacementAlongLineSameSize"===h.type||"CIMMarkerPlacementAlongLineVariableSize"===h.type||"CIMMarkerPlacementAtExtremities"===h.type||"CIMMarkerPlacementAtMeasuredUnits"===h.type||"CIMMarkerPlacementAtRatioPositions"===
h.type||"CIMMarkerPlacementOnLine"===h.type||"CIMMarkerPlacementOnVertices"===h.type)};b.isCIMStroke=function(h){return"CIMGradientStroke"===h.type||"CIMPictureStroke"===h.type||"CIMSolidStroke"===h.type};b.isFeatureValueFn=g;b.isGeometryEngineRequired=h=>{if(!h)return!1;for(const u of h)switch(u.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};b.isSVGImage=h=>h.includes("data:image/svg+xml");b.mapCIMSymbolToGeometryType=function(h){if(!h)return null;
switch(h.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};b.resampleHermite=function(h,u,w,x,n,q,t=!0){const v=u/n;w/=q;const r=Math.ceil(v/2),y=Math.ceil(w/2);for(let C=0;C<q;C++)for(let E=0;E<n;E++){const A=4*(E+(t?q-C-1:C)*n);var z=0;let F=0,G=0,I=0,H=0,B=0,K=0;const L=(C+.5)*w;for(let J=Math.floor(C*w);J<(C+1)*w;J++){var D=Math.abs(L-(J+.5))/y;const M=
(E+.5)*v;D*=D;for(let T=Math.floor(E*v);T<(E+1)*v;T++){let Q=Math.abs(M-(T+.5))/r;z=Math.sqrt(D+Q*Q);-1<=z&&1>=z&&(z=2*z*z*z-3*z*z+1,0<z&&(Q=4*(T+J*u),K+=z*h[Q+3],G+=z,255>h[Q+3]&&(z=z*h[Q+3]/250),I+=z*h[Q],H+=z*h[Q+1],B+=z*h[Q+2],F+=z))}}x[A]=I/F;x[A+1]=H/F;x[A+2]=B/F;x[A+3]=K/G}};b.toCIMSymbolJSON=function(h){return h.data?.symbol??null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/LRUCache ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(a,b,g,d,k,m,f){function c(p){if(!p)return null;let h=null;switch(p.type){case "simple-fill":case "picture-fill":case "simple-marker":h=c(p.outline);break;case "simple-line":const u=m.pt2px(p.width);null!=p.style&&"none"!==p.style&&0!==u&&(h={color:p.color,style:e(p.style),width:u,cap:p.cap,join:"miter"===p.join?m.pt2px(p.miterLimit):p.join});break;default:h=null}return h}const l=new k.LRUCache(1E3),e=(()=>{const p={};return h=>{if(p[h])return p[h];const u=h.replaceAll("-","");return p[h]=
u}})();g=new g([128,128,128]);a.defaultThematicColor=g;a.dekebabifyLineStyle=e;a.getFill=function(p){const h=p.style;let u=null;if(p)switch(p.type){case "simple-marker":"cross"!==h&&"x"!==h&&(u=p.color);break;case "simple-fill":"solid"===h?u=p.color:"none"!==h&&(u={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${h}.png`),width:5,height:5});break;case "picture-fill":u={type:"pattern",src:p.url,width:m.pt2px(p.width)*p.xscale,height:m.pt2px(p.height)*p.yscale,x:m.pt2px(p.xoffset),
y:m.pt2px(p.yoffset)};break;case "text":u=p.color;break;case "cim":u=f.getCIMSymbolColor(p)}return u};a.getPatternUrlWithColor=function(p,h){const u=p+"-"+h;return void 0!==l.get(u)?Promise.resolve(l.get(u)):d(p,{responseType:"image"}).then(w=>{w=w.data;const x=w.naturalWidth,n=w.naturalHeight,q=document.createElement("canvas");q.width=x;q.height=n;const t=q.getContext("2d");t.fillStyle=h;t.fillRect(0,0,x,n);t.globalCompositeOperation="destination-in";t.drawImage(w,0,0);w=q.toDataURL();l.put(u,w);
return w})};a.getStroke=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(a,b,g){function d(m){const f={};switch(m){case "esriGeometryPoint":return(c,l,e,p)=>g.unquantizePoint(l,f,c,e,p);case "esriGeometryPolygon":return(c,l,e,p)=>g.unquantizePolygon(l,f,c,e,p);case "esriGeometryPolyline":return(c,l,e,p)=>g.unquantizePolyline(l,
f,c,e,p);case "esriGeometryMultipoint":return(c,l,e,p)=>g.unquantizeMultipoint(l,f,c,e,p);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${m}`)),c=>c}}const k=new Map;return function(m,f,c,l,e){if(null==m)return null;if(m.referencesGeometry()&&e){const {transform:p,hasZ:h,hasM:u}=e;k.has(l)||k.set(l,d(l));l=k.get(l)(f.geometry,p,h,u);f={...f,geometry:l}}f=m.repurposeFeature(f);try{return m.evaluate({...c,$feature:f},
m.services)}catch(p){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",p),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,b){b=b.ZEROS;a.labelMarginPx=4;a.suspendResumeExtentOptimism=1.2;a.transparentUnit=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,b,g,d,k,m,f,c){class l{constructor(u,w,x,n){this.graphics3DSymbolLayer=u;this.renderGeometries=w;this.boundingBox=x;this._drapeSourceRenderer=n;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}initialize(u){this.stage=u.stage}setVisibility(u){if(null!=this.stage&&this._visible!==u)if((this._visible=u)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,c.DirtyOperation.ADD);else if(u||this._addedToStage){for(const w of this.renderGeometries)w.visible=
this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,c.DirtyState.VISIBILITY)}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,c.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null}getCenterObjectSpace(u=g.create()){return b.set(u,0,0,0)}getBoundingBoxObjectSpace(u=d.create()){return d.empty(u)}addObjectState(u,w){u===f.Object3DState.Highlight&&(this.renderGeometries.forEach(x=>{const n=x.geometry.addHighlight();
w.addRenderGeometry(x,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,c.DirtyState.HIGHLIGHT))}removeObjectState(u){this.renderGeometries.forEach(w=>{u.removeRenderGeometry(w)})}removeRenderGeometryObjectState(u,w){u.geometry.removeHighlight(w);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,c.DirtyState.HIGHLIGHT)}computeAttachmentOrigin(u){for(const w of this.renderGeometries)w.geometry.computeAttachmentOrigin(h)&&
(u.draped.origin[0]+=h[0],u.draped.origin[1]+=h[1],u.draped.num++)}async getProjectedBoundingBox(u,w,x,n,q){d.empty(q);for(let t=0;t<this.renderGeometries.length;t++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[t],u,e,x),d.expandWithRect(q,e);if(w){d.center(q,h);let t;u=m.demResolutionForBoundingBox(q,w.service.spatialReference,w);try{t=await w.service.queryElevation(h[0],h[1],n,u,"ground")}catch(v){}null!=t&&(q[2]=Math.min(q[2],t),q[5]=Math.max(q[5],t))}return q}_getRenderGeometryProjectedBoundingRect(u,
w,x,n){if(this.boundingBox)d.set(p,this.boundingBox);else{u=u.boundingSphere;const q=u[3];p[0]=u[0]-q;p[1]=u[1]-q;p[2]=u[2]-q;p[3]=u[0]+q;p[4]=u[1]+q;p[5]=u[2]+q}w(p,0,2);this.calculateRelativeScreenBounds&&n.push({location:d.center(p),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return d.toRect(p,x)}}const e=k.create(),p=d.create(),h=g.create();a.Graphics3DDrapedGraphicLayer=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports",
"../../../../chunks/vec2","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,g,d){const k=Object.freeze({left:0,center:.5,right:1}),m=Object.freeze({"bottom-left":g.fromValues(0,0),bottom:g.fromValues(.5,0),"bottom-right":g.fromValues(1,0),left:g.fromValues(0,.5),center:g.fromValues(.5,.5),right:g.fromValues(1,.5),"top-left":g.fromValues(0,1),top:g.fromValues(.5,1),"top-right":g.fromValues(1,1)});a.anchorFromPlacements=function(f,c){switch(c){case "bottom":return"left"===
f?"bottom-left":"right"===f?"bottom-right":"bottom";case "center":return f;case "top":return"left"===f?"top-left":"right"===f?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(f){switch(f){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};a.horizontalPlacementToAnchorX=k;a.namedAnchorToHUDMaterialAnchorPos=m;a.textRenderAlignmentFromHorizontalPlacement=function(f){switch(f){case "left":return d.TextRenderAlignment.Left;
case "right":return d.TextRenderAlignment.Right;default:return d.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(f){return"middle"===f?"center":f};a.verticalPlacementFromAnchor=function(f){switch(f){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";case "top-left":case "top":case "top-right":return"top"}};a.verticalScreenOffsetFromAlignment=function(f,c){switch(f){case "top":return b.set(c,0,d.textVerticalPaddingPx);
case "bottom":return b.set(c,0,-d.textVerticalPaddingPx);default:return b.copy(c,g.ZEROS)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../core/mathUtils","../../support/debugFlags","./FontMetrics","./TextHelperCanvas"],function(a,b,g,d,k){class m{constructor(e,p,h,u){this.text=e;this._alignment=p;this._parameters=h;this._maxSize=u;this._textWidths=[];this._lineWidths=[];this._metricsCached=this._renderPixelRatio=
null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`;this._lines=e.replaceAll(" ","\u00a0").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let p=0;p<this._lines.length-1;p++)e+=this._lineSpacing;e+=this._metrics.lastLineDescent;return Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+
this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const p=k.getTextHelperCanvas(c,512,512).getContext("2d");this._parameters.setFontProperties(p,this._fontSize);let h=2*this._haloSize;var e=this._parameters.definition.font;if("italic"===e.style||"oblique"===e.style||"bold"===e.weight||"bolder"===e.weight)h+=.3*p.measureText("A").width;this._textWidths.length=0;let u=this._lineWidths.length=0,w,x,n=0,q=0;
this._lines.forEach((t,v)=>{t=p.measureText(t);const r=t.width,y=r+h;this._textWidths.push(r);this._lineWidths.push(y);u=Math.max(u,y);n=Math.max(n,t.actualBoundingBoxAscent);q=Math.max(q,t.actualBoundingBoxDescent);0===v&&(w=t);v===this._lines.length-1&&(x=t)});e=d.getFontMetrics(this._parameters);n=Math.max(n,e.maxAscent);q=Math.max(q,e.maxDescent);this._metricsCached=new l(w.actualBoundingBoxAscent,"underline"===this._parameters.definition.font.decoration?q:x.actualBoundingBoxDescent,n,q,u)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+
this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return.2*this._midLineHeight}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?
this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,1)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){null==this._renderPixelRatio&&(this._renderPixelRatio=Math.min(this._parameters.definition.pixelRatio,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight)));return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case a.TextRenderAlignment.Left:return this._horizontalPadding;
case a.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[e])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,p,h){e.save();p/=this.renderPixelRatio;h/=this.renderPixelRatio;const u=p,w=h;var x=this._haloSize;const n=this._firstLineYOffset+this._metrics.firstLineAscent;p+=x;h+=n;const q=0<this._haloSize;q&&this._renderHalo(e,u,w,x,n);this._parameters.setFontProperties(e,this._renderedFontSize);for(x=0;x<this._lines.length;++x){const t=
this._lines[x],v=this._getLineXOffset(x);q&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,t,p+v,h),this._renderLineDecoration(e,p+v,h,this._textWidths[x]));e.globalCompositeOperation="source-over";e.fillStyle=this._parameters.textStyle;this._fillText(e,t,p+this._getLineXOffset(x),h);this._renderLineDecoration(e,p+v,h,this._textWidths[x]);h+=this._lineSpacing}if(g.debugFlags.TEXT_SHOW_BASELINE)for(e.strokeStyle="rgb(255, 0, 255, 0.5)",e.setLineDash([2,2]),
e.lineWidth=1,p=w+n,h=0;h<this._lines.length;++h)this._drawLine(e,[u,p],[u+this.displayWidth,p]),p+=this._lineSpacing;g.debugFlags.TEXT_SHOW_BORDER&&(e.strokeStyle="rgb(255, 0, 255, 0.5)",e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[u,w],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(e,u,w,this._parameters.definition.background.borderRadius*this.renderPixelRatio),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill());
e.restore()}_renderLineDecoration(e,p,h,u,w=!1){if("none"!==this._parameters.definition.font.decoration&&0!==u){var x=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":h+=2*x;break;case "line-through":h-=.33*this._midLineAscent}var n=w?this._haloSize:0;e.strokeStyle=w?this._parameters.haloStyle:this._parameters.textStyle;e.lineWidth=this._toRenderUnit(x+2*n);e.beginPath();e.moveTo(this._toRenderUnit(p-n),this._toRenderUnit(h));e.lineTo(this._toRenderUnit(p+
u+n),this._toRenderUnit(h));e.stroke()}}_roundedRect(e,p,h,u){p=this._toRenderUnit(p);h=this._toRenderUnit(h);const w=this.renderedWidth,x=this.renderedHeight;0===u?e.rect(p,h,w,x):(u=b.clamp(u,0,Math.floor(x/2)),e.beginPath(),e.moveTo(p,h+u),e.arcTo(p,h,p+u,h,u),e.lineTo(p+w-u,h),e.arcTo(p+w,h,p+w,h+u,u),e.lineTo(p+w,h+x-u),e.arcTo(p+w,h+x,p+w-u,h+x,u),e.lineTo(p+u,h+x),e.arcTo(p,h+x,p,h+x-u,u),e.closePath())}_renderHalo(e,p,h,u,w){const x=this.renderedWidth,n=this.renderedHeight,q=k.getTextHelperCanvas(c,
Math.max(x,512),Math.max(n,512)),t=q.getContext("2d");t.clearRect(0,0,x,n);this._parameters.setFontProperties(t,this._renderedFontSize);t.fillStyle=this._parameters.haloStyle;t.strokeStyle=this._parameters.haloStyle;var v=3>this._renderedHaloSize;t.lineJoin=v?"miter":"round";v?this._renderHaloEmulated(t,u,w):this._renderHaloNative(t,u,w);for(v=0;v<this._lines.length;++v){const r=this._getLineXOffset(v);this._renderLineDecoration(t,u+r,w,this._textWidths[v],!0);w+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3];
e.drawImage(q,0,0,x,n,this._toRenderUnit(p),this._toRenderUnit(h),x,n);e.globalAlpha=1}_renderHaloEmulated(e,p,h){for(let u=0;u<this._lines.length;++u){const w=this._lines[u],x=this._getLineXOffset(u);for(const [n,q]of f)this._fillText(e,w,p+x+this._haloSize*n,h+this._haloSize*q);h+=this._lineSpacing}}_renderHaloNative(e,p,h){const u=2*this._haloSize;for(let w=0;w<this._lines.length;++w){const x=this._lines[w],n=this._getLineXOffset(w);for(let q=0;5>q;q++)e.lineWidth=this._toRenderUnit((.6+.1*q)*
u),this._strokeText(e,x,p+n,h);h+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,p,h,u){e.fillText(p,this._toRenderUnit(h),this._toRenderUnit(u))}_strokeText(e,p,h,u){e.strokeText(p,this._toRenderUnit(h),this._toRenderUnit(u))}_drawLine(e,p,h){e.beginPath();e.moveTo(this._toRoundedRenderUnit(p[0])+.5,this._toRoundedRenderUnit(p[1])+.5);e.lineTo(this._toRoundedRenderUnit(h[0])+
.5,this._toRoundedRenderUnit(h[1])+.5);e.stroke()}_drawBox(e,p,h){var u=this._toRenderUnit(p[0]);p=this._toRenderUnit(p[1]);var w=this._toRenderUnit(h[0]);const x=this._toRenderUnit(h[1]);h=Math.floor(u)+.5;u=Math.ceil(u+w)-.5;w=Math.floor(p)+.5;p=Math.ceil(p+x)-.5;e.beginPath();e.moveTo(h,w);e.lineTo(u,w);e.lineTo(u,p);e.lineTo(h,p);e.lineTo(h,w);e.stroke()}}const f=[];for(let e=0;360>e;e+=22.5)f.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);a.TextRenderAlignment=void 0;(function(e){e[e.Left=
0]="Left";e[e.Center=1]="Center";e[e.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const c={canvas:null};class l{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,p,h,u,w){this.firstLineAscent=e;this.lastLineDescent=p;this.maxLineAscent=h;this.maxLineDescent=u;this.displayWidth=w}}a.TextRenderer=m;a.textVerticalPaddingPx=
1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/FontMetrics":function(){define(["exports","./TextHelperCanvas"],function(a,b){const g=new Map;class d{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(f,c){this.maxAscent=f;this.maxDescent=c}}const k={canvas:null},m=(()=>{let f="";for(let c=32;127>c;c++)f+=String.fromCharCode(c);return f})();a.getFontMetrics=function(f){const {size:c}=f.definition,l=f.fontString(c);var e=g.get(l);e||
(e=b.getTextHelperCanvas(k,0,0).getContext("2d"),f.setFontProperties(e,c),f=e.measureText(m),e=new d(f.actualBoundingBoxAscent,f.actualBoundingBoxDescent),g.set(l,e));return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextHelperCanvas":function(){define(["exports"],function(a){a.getTextHelperCanvas=function(b,g,d){b.canvas||(b.canvas=document.createElement("canvas"));b.canvas.width=g;b.canvas.height=d;return b.canvas};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/sphere ../../support/mathUtils".split(" "),function(a,b,g,d,k,m,f){class c{constructor(e,p={}){this.geometry=e;this.screenToWorldRatio=1;this._transformation=d.create();this._boundingSphere=this._shaderTransformation=null;this.id=b.generateUID();this.layerUid=p.layerUid;
this.graphicUid=p.graphicUid;this.castShadow=p.castShadow??!1;null!=p.objectShaderTransformation&&this.objectShaderTransformationChanged(p.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){g.copy(this._transformation,e);this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=d.create()),g.multiply(this._shaderTransformation,
e,this.geometry.transformation));this._boundingSphere=null}get boundingSphere(){if(!this.boundingInfo)return m.NullSphere;null==this._boundingSphere&&(this._boundingSphere??(this._boundingSphere=m.create()),k.transformMat4(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*f.maxScale(this.shaderTransformation));return this._boundingSphere}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return null==
this._shaderTransformation?this.transformation:this._shaderTransformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}class l extends c{}a.RenderGeometry=c;a.ValidatedRenderGeometry=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../geometry ../../../../core/Error ../../../../core/screenUtils ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../../support/debugFlags ../../support/engineContent/line ../../support/renderInfoUtils/line ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E){const A=["polyline","polygon","extent"],F=new x.ConvertOptions({size:!0,color:!0,rotation:!1,opacity:!0});class G extends h.Graphics3DSymbolLayer{constructor(B,K,L,J){super(B,K,L,J)}async doLoad(){this._fastUpdates=x.initFastSymbolUpdatesState(this._context.renderer,F);if(!this._drivenProperties.size&&0>(null!=this.symbolLayer.size?this.symbolLayer.size:d.px2pt(1)))throw new g("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");
}_getMaterialParameters(B,K=!1){const L=this._getCombinedOpacityAndColor(K&&this._markerColor||this._materialColor);this._patternHidesLine&&!K&&(L[3]=0);B={width:this._computeMaterialWidth(this.symbolLayer?.size),color:L,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:w.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:B,stipplePattern:z.getStipplePatternForLinePattern(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?
{...B,...this._fastUpdates.materialParameters}:B}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){null==this._materials[H.Line]&&(this._materials[H.Line]=new D.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[H.Line]));return this._materials[H.Line]}get _ringMaterial(){null==this._materials[H.Ring]&&(this._materials[H.Ring]=new D.RibbonLineMaterial(this._getMaterialParameters(!0)),
this._context.stage.add(this._materials[H.Ring]));return this._materials[H.Ring]}get _wireframeLineMaterial(){null==this._materials[H.LineWireframe]&&(this._materials[H.LineWireframe]=new D.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[H.LineWireframe]));return this._materials[H.LineWireframe]}get _wireframeRingMaterial(){null==this._materials[H.RingWireframe]&&(this._materials[H.RingWireframe]=new D.RibbonLineMaterial({...this._getMaterialParameters(!0),
wireframe:!0}),this._context.stage.add(this._materials[H.RingWireframe]));return this._materials[H.RingWireframe]}get _markerMaterial(){null==this._materials[H.Marker]&&null!=this.symbolLayer.marker&&(this._materials[H.Marker]=new y.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:w.parseLineMarkerStyle(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[H.Marker]));return this._materials[H.Marker]}destroy(){super.destroy();
this._forEachMaterial(B=>this._context.stage.remove(B));this._materials.length=0}_getDrivenSize(B){return this._drivenProperties.size&&B.size?d.pt2px(f.getDriverAxisSizeValueAny(B.size)):1}_getDrivenColor(B){const K=k.fromValues(1,1,1,1);this._drivenProperties.color&&B.color&&(K[0]=B.color[0],K[1]=B.color[1],K[2]=B.color[2],0<B.color.length&&(K[3]=B.color[3]));this._drivenProperties.opacity&&B.opacity&&(K[3]=B.opacity);return K}createGraphics3DGraphic(B){const K=B.graphic;if(!this._validateGeometry(K.geometry,
A,this.symbolLayer.type))return null;const L=this.setGraphicElevationContext(K);this.ensureDrapedStatus("on-the-ground"===L.mode);return this.draped?this._createAsOverlay(B,this._context.layer.uid):this._createAs3DShape(B,L,K.uid)}applyRendererDiff(B,K){for(const L in B.diff)switch(L){case "visualVariables":const J=this._fastUpdates;if(x.updateFastSymbolUpdatesState(J,K,F))this._forEachMaterial(M=>M?.setParameters(J.materialParameters));else return u.ApplyRendererDiffResult.RecreateSymbol;break;default:return u.ApplyRendererDiffResult.RecreateSymbol}return u.ApplyRendererDiffResult.FastUpdate}prepareSymbolLayerPatch(B){if("partial"===
B.diff.type){var K=B.diff.diff,L={};"complete"===K.size?.type&&(L.width=this._computeMaterialWidth(K.size.newValue),delete K.size);"complete"===K.cap?.type&&(L.cap=w.parseCapType(K.cap.newValue??"butt"),delete K.cap);var J=this._prepareMarkerPatch(B,K);this._prepareMaterialPatch(B,K,J);B.symbolLayerStatePatches.push(()=>this._forEachMaterial(M=>M?.setParameters(L)))}}layerOpacityChanged(){this._forEachMaterial((B,K)=>this._updateMaterialLayerOpacity(B,K===H.Marker))}_forEachMaterial(B){this._materials.forEach(B)}_updateMaterialLayerOpacity(B,
K=!1){if(null!=B){var L=B.parameters.color,J=this.symbolLayer?.material?.color;K=this._patternHidesLine&&!K?0:this._getCombinedOpacity(J);L=k.fromValues(L[0],L[1],L[2],K);B.setParameters({color:L})}}layerElevationInfoChanged(B,K,L){const J=this._elevationContext.mode;L=l.elevationModeChangeUpdateType(G.elevationModeChangeTypes,L,J);if(L!==l.SymbolUpdateType.UPDATE)return L;const M=l.needsElevationUpdates2D(J);return this.updateGraphics3DGraphicElevationInfo(B,K,()=>M)}slicePlaneEnabledChanged(){const B=
{hasSlicePlane:this._context.slicePlaneEnabled};this._forEachMaterial(K=>K?.setParameters(B));return!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(B){switch(B.type){case "extent":if(B instanceof C)return E.fromExtent(B);break;case "polygon":case "polyline":return B}return null}_createAs3DShape(B,K,L){const J=this._getGeometryAsPolygonOrPolyline(B.graphic.geometry);var M="polygon"===J.type?J.rings:J.paths,T=[];const Q=m.create(),O=t.geometryToRenderInfo(J,this._context.elevationProvider,
this._context.renderCoordsHelper,K);this._logGeometryCreationWarnings(O,M,"polygon"===J.type?"rings":"paths","LineSymbol3DLayer");for(M=0;M<O.lines.length;M++){var U=O.lines[M],Z=U.position;U=U.mapPositions;if(null!=this._context.clippingExtent&&(m.empty(Q),m.expandWithBuffer(Q,U),!m.intersectsClippingArea(Q,this._context.clippingExtent)))continue;Z=this._createGeometry("polygon"===J.type?this._ringMaterial:this._lineMaterial,B,Z,U,J.type,I.ELEVATED,L);T.push(Z);n.debugFlags.LINE_WIREFRAMES&&T.push(Z.instantiate({material:"polygon"===
J.type?this._wireframeRingMaterial:this._wireframeLineMaterial}));null!=this._markerMaterial&&T.push(Z.instantiate({material:this._markerMaterial}))}if(0===T.length)return null;B=new v.Object3D({geometries:T,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:L});T=new p.Graphics3DObject3DGraphicLayer(this,B,T,null,null,c.sharedGeometryElevationAligner,K);T.alignedSampledElevation=O.sampledElevation;T.needsElevationUpdates=l.needsElevationUpdates2D(K.mode);return T}_createGeometry(B,K,L,J,M,
T,Q){T=T===I.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null;M="polygon"===M;const O=this._fastUpdates?.visualVariables.color,U=this._fastUpdates?.visualVariables.size,Z=this._fastUpdates?.visualVariables.opacity;Q=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Q,layerUid:this._context.layer.uid});K={position:L,size:U?null:this._getDrivenSize(K.renderingInfo),color:O?null:this._getDrivenColor(K.renderingInfo),sizeFeature:U?
x.getAttributeValue(U.field,K.graphic):null,colorFeature:O?x.getAttributeValue(O.field,K.graphic):null,opacityFeature:Z?x.getAttributeValue(Z.field,K.graphic):null};return q.createGeometry(B,{overlayInfo:T,removeDuplicateStartEnd:M,mapPositions:J,attributeData:K},Q)}_createAsOverlay(B,K){const L=B.graphic,J=this._getGeometryAsPolygonOrPolyline(L.geometry);var M="polygon"===J.type?J.rings:J.paths;const T="polygon"===J.type?this._ringMaterial:this._lineMaterial;T.renderPriority=this._renderPriority;
const Q=n.debugFlags.LINE_WIREFRAMES?"polygon"===J.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,O=this._markerMaterial;null!=Q&&(Q.renderPriority=this._renderPriority-.001);null!=O&&(O.renderPriority=this._renderPriority-.002);const U=[],Z=m.create(),P=m.empty();var R=t.geometryToRenderInfoDraped(J,this._context.overlaySR);this._logGeometryCreationWarnings(R,M,"polygon"===J.type?"rings":"paths","LineSymbol3DLayer");for(const W of R.lines)m.empty(Z),m.expandWithBuffer(Z,W.position),
m.intersectsClippingArea(Z,this._context.clippingExtent)&&(m.expandWithAABB(P,Z),M=N=>{N=this._createGeometry(N,B,W.position,void 0,J.type,I.DRAPED,L.uid);N=new r.RenderGeometry(N,{layerUid:K,graphicUid:L.uid});U.push(N)},null!=O&&(M(O),R=this.symbolLayer.marker.placement,"begin"!==R&&"begin-end"!==R||m.expandWithBuffer(Z,W.position,0,1),"end"!==R&&"begin-end"!==R||m.expandWithBuffer(Z,W.position,W.position.length-3,1)),M(T),n.debugFlags.LINE_WIREFRAMES&&M(Q));return new e.Graphics3DDrapedGraphicLayer(this,
U,P,this._context.drapeSourceRenderer)}get _patternHidesLine(){const B=this.symbolLayer.pattern;return null!=B&&"style"===B.type&&"none"===B.style}_computeMaterialWidth(B){B=B??d.px2pt(1);return this._drivenProperties.size?this._fastUpdates?.visualVariables.size?d.pt2px(1):1:d.pt2px(B)}_prepareMaterialPatch(B,K,L){var J=K.material;null==J?L.changed&&L.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[H.Marker],B):"collection"!==J.type&&
(J=this._getCombinedOpacityAndColor("complete"===J.type?J.newValue?.color:"complete"===J.diff.color?.type?J.diff.color.newValue:null),L.useMaterialColor&&this._patchMaterialColor(k.clone(J),this._materials[H.Marker],B),this._patternHidesLine&&(J[3]=0),this._patchMaterialColor(J,this._materials[H.Line],B),delete K.material)}_prepareMarkerPatch(B,K){const L=K.marker,J=this._markerMaterial;if(null==L||"partial"!==L.type||null==L.diff||null!=L.diff.placement||null!=L.diff.style&&"complete"!==L.diff.style.type||
null!=L.diff.color&&"complete"!==L.diff.color.type||null==J)return{changed:!1,useMaterialColor:null==this._markerColor};var M=L.diff.color;const T=null!=M;M=T?M.newValue:null;const Q=null==M&&null==this._markerColor;M&&this._patchMaterialColor(this._getCombinedOpacityAndColor(M),J,B);const O=L.diff.style?.newValue;O&&B.symbolLayerStatePatches.push(()=>J.setParameters({markerPrimitive:w.parseLineMarkerStyle(O)}));delete K.marker;return{changed:T,useMaterialColor:Q}}_patchMaterialColor(B,K,L){null!=
K&&L.symbolLayerStatePatches.push(()=>K.setParameters({color:B}))}}G.elevationModeChangeTypes={definedChanged:l.SymbolUpdateType.RECREATE,staysOnTheGround:l.SymbolUpdateType.NONE,onTheGroundChanged:l.SymbolUpdateType.RECREATE};var I;(function(B){B[B.DRAPED=0]="DRAPED";B[B.ELEVATED=1]="ELEVATED"})(I||(I={}));var H;(function(B){B[B.Line=0]="Line";B[B.Ring=1]="Ring";B[B.LineWireframe=2]="LineWireframe";B[B.RingWireframe=3]="RingWireframe";B[B.Marker=4]="Marker"})(H||(H={}));a.Graphics3DLineSymbolLayer=
G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/shaders/RibbonLineTechniqueConfiguration"],function(a,b,g){a.parseCapType=function(d){switch(d){case "butt":return g.CapType.BUTT;case "square":return g.CapType.SQUARE;case "round":return g.CapType.ROUND;default:return null}};a.parseLineMarkerStyle=function(d){return"diamond"===d?"kite":d};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/engineContent/line":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectors ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../ViewingMode ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){const n=d.create(),q=d.create();a.createGeometry=function(t,v,r=null){const y=[],z=v.mapPositions,{attributeData:{position:D},removeDuplicateStartEnd:C}=v;var E=D.length;E=D[0]===D[E-3]&&D[1]===D[E-2]&&D[2]===D[E-1]&&C;var A=D.length/3-(E?1:0),F=Array(2*(A-1)),G=E?D.slice(0,-3):D,I=0;for(var H=0;H<A-1;H++)F[I++]=H,F[I++]=H+1;y.push([x.VertexAttribute.POSITION,new h.Attribute(G,F,3,E)]);A=y[0][1].data;E=e.getZeroIndexArray(y[0][1].indices.length);null==v.attributeData.colorFeature&&
y.push([x.VertexAttribute.COLOR,new h.Attribute(v.attributeData.color??k.ONES,E,4)]);null==v.attributeData.sizeFeature&&y.push([x.VertexAttribute.SIZE,new h.Attribute([v.attributeData.size??1],E,1,!0)]);v.attributeData.normal&&y.push([x.VertexAttribute.NORMAL,new h.Attribute(v.attributeData.normal,E,3)]);null!=v.attributeData.colorFeature&&y.push([x.VertexAttribute.COLORFEATUREATTRIBUTE,new h.Attribute([v.attributeData.colorFeature],E,1,!0)]);null!=v.attributeData.sizeFeature&&y.push([x.VertexAttribute.SIZEFEATUREATTRIBUTE,
new h.Attribute([v.attributeData.sizeFeature],E,1,!0)]);null!=v.attributeData.opacityFeature&&y.push([x.VertexAttribute.OPACITYFEATUREATTRIBUTE,new h.Attribute([v.attributeData.opacityFeature],E,1,!0)]);if(null!=v.overlayInfo&&v.overlayInfo.renderCoordsHelper.viewingMode===p.ViewingMode.Global&&v.overlayInfo.spatialReference.isGeographic){E=c.newDoubleArray(A.length);v=m.getReferenceEllipsoid(v.overlayInfo.spatialReference);for(F=0;F<E.length;F+=3)f.lonLatToWebMercatorComparable(A,F,E,F,v);v=A.length/
3;A=l.newFloatArray(v+1);F=n;G=q;H=I=0;g.set(F,E[H++],E[H++],E[H++]);A[0]=0;for(let B=1;B<v+1;++B)B===v&&(H=0),g.set(G,E[H++],E[H++],E[H++]),I+=b.dist(F,G),A[B]=I,[F,G]=[G,F];y.push([x.VertexAttribute.DISTANCETOSTART,new h.Attribute(A,y[0][1].indices,1,!0)])}return new w.Geometry(t,y,z,u.ContentObjectType.Line,r)};a.lineStripsToParameters=function(t,v){if(null==t||0===t.length)return[];const r=[];t.forEach(y=>{const z=c.newDoubleArray(3*y.length);y.forEach((D,C)=>{z[3*C]=D[0];z[3*C+1]=D[1];z[3*C+
2]=D[2]});r.push({attributeData:{position:z,normal:v},removeDuplicateStartEnd:!1})});return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/line":function(){define("exports ../../../../geometry/projection/projectBuffer ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(a,b,g,d,k,m){function f(c,l,e=null){const p=
[];for(const {index:h,count:u}of c){if(1>=u)continue;c=3*h;const w=3*u;p.push({position:g.doubleSubArray(l,3*h,3*u),mapPositions:null!=e?g.doubleSubArray(e,c,w):void 0})}return p}a.geometryToRenderInfo=function(c,l,e,p){const {position:h,outlines:u}=d.pathsToTriangulationInfo("polygon"===c.type?c.rings:c.paths,!!c.hasZ,"polygon"===c.type?d.CounterClockwiseMode.CCW_IS_HOLE:d.CounterClockwiseMode.NONE,c.spatialReference),w=g.newDoubleArray(h.length);c=k.applyPerVertexElevationAlignment(h,c.spatialReference,
0,w,0,h,0,h.length/3,l,e,p);l=null!=c;return{lines:l?f(u,h,w):[],projectionSuccess:l,sampledElevation:c}};a.geometryToRenderInfoDraped=function(c,l){const {position:e,outlines:p}=d.pathsToTriangulationInfo("polygon"===c.type?c.rings:c.paths,!1,"polygon"===c.type?d.CounterClockwiseMode.CCW_IS_HOLE:d.CounterClockwiseMode.NONE);c=b.projectBuffer(e,c.spatialReference,0,e,l,0,e.length/3);for(l=2;l<e.length;l+=3)e[l]=m.drapedZ;return{lines:c?f(p,e):[],projectionSuccess:c}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),function(a,b,g,d,k,m,f,c,l,
e,p,h,u){class w extends f.Material{constructor(r){super(r,new n);this._vertexAttributeLocations=p.vertexAttributeLocations;this._configuration=new h.LineMarkerTechniqueConfiguration;this._layout=this.createLayout()}getConfiguration(r,y){this._configuration.output=r;this._configuration.space=y.slot===c.RenderSlot.DRAPED_MATERIAL?h.LineMarkerSpace.Draped:this.parameters.worldSpace?h.LineMarkerSpace.World:h.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;
this._configuration.hasCap=this.parameters.cap!==u.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;
this._configuration.occluder=this.parameters.renderOccluded===f.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=y.transparencyPassType;this._configuration.multipassEnabled=y.multipassEnabled;this._configuration.cullAboveGround=y.multipassTerrain.cullAboveGround;return this._configuration}intersect(){}createLayout(){const r=d.newLayout().vec3f(l.VertexAttribute.POSITION).vec2f(l.VertexAttribute.UV0).vec3f(l.VertexAttribute.AUXPOS1);this.parameters.worldSpace&&
r.vec3f(l.VertexAttribute.NORMAL);this.parameters.vvSize?r.f32(l.VertexAttribute.SIZEFEATUREATTRIBUTE):r.f32(l.VertexAttribute.SIZE);this.parameters.vvColor?r.f32(l.VertexAttribute.COLORFEATUREATTRIBUTE):r.vec4f(l.VertexAttribute.COLOR);this.parameters.vvOpacity&&r.f32(l.VertexAttribute.OPACITYFEATUREATTRIBUTE);return r}createBufferWriter(){return new q(this._layout,this.parameters)}produces(r,y){return y===k.ShaderOutput.Color||y===k.ShaderOutput.Alpha||y===k.ShaderOutput.Highlight||y===k.ShaderOutput.Depth?
r===c.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===f.RenderOccludedFlag.OccludeAndTransparentStencil?r===c.RenderSlot.OPAQUE_MATERIAL||r===c.RenderSlot.OCCLUDER_MATERIAL||r===c.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:y===k.ShaderOutput.Color||y===k.ShaderOutput.Alpha?r===(this.parameters.writeDepth?c.RenderSlot.TRANSPARENT_MATERIAL:c.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):r===c.RenderSlot.OPAQUE_MATERIAL:!1}createGLMaterial(r){return new x(r)}}class x extends m.GLTextureMaterial{constructor(){super(...arguments);
this._markerPrimitive=null}dispose(){super.dispose();this._markerTextureRepository.release(this._markerPrimitive);this._markerPrimitive=null}_updateParameters(r){const y=this._material.parameters.markerPrimitive;y!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(y,this._markerPrimitive)}),this._markerPrimitive=y);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(p.LineMarkerTechnique,r)}_updateOccludeeState(r){r.hasOccludees!==
this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:r.hasOccludees})}beginSlot(r){this._output!==k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(r);return this._updateParameters(r)}}class n extends e.VisualVariablePassParameters{constructor(){super(...arguments);this.width=0;this.color=[1,1,1,1];this.markerPrimitive="arrow";this.placement="end";this.cap=u.CapType.BUTT;this.anchor=h.LineMarkerAnchor.Center;this.hideOnShortSegments=
this.worldSpace=this.hasTip=!1;this.writeDepth=!0;this.hasOccludees=this.vvFastUpdate=this.hasSlicePlane=!1;this.markerTexture=null}}class q{constructor(r,y){this.vertexBufferLayout=r;this._parameters=y}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(r,y,z,D,C){const E=z.attributes.get(l.VertexAttribute.POSITION).data,A=E.length/3;let F=[1,0,0];y=z.attributes.get(l.VertexAttribute.NORMAL);this._parameters.worldSpace&&null!=y&&(F=y.data);let G=1,I=0;this._parameters.vvSize?
I=z.attributes.get(l.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:z.attributes.has(l.VertexAttribute.SIZE)&&(G=z.attributes.get(l.VertexAttribute.SIZE).data[0]);let H=[1,1,1,1],B=0;this._parameters.vvColor?B=z.attributes.get(l.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:z.attributes.has(l.VertexAttribute.COLOR)&&(H=z.attributes.get(l.VertexAttribute.COLOR).data);let K=0;this._parameters.vvOpacity&&(K=z.attributes.get(l.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const L=new Float32Array(D.buffer);
let J=this.vertexBufferLayout.stride/4*C;const M=(Q,O,U,Z)=>{L[J++]=Q[0];L[J++]=Q[1];L[J++]=Q[2];L[J++]=U[0];L[J++]=U[1];L[J++]=O[0];L[J++]=O[1];L[J++]=O[2];this._parameters.worldSpace&&(L[J++]=F[0],L[J++]=F[1],L[J++]=F[2]);this._parameters.vvSize?L[J++]=I:L[J++]=G;this._parameters.vvColor?L[J++]=B:(Q=Math.min(4*Z,H.length-4),L[J++]=H[Q],L[J++]=H[Q+1],L[J++]=H[Q+2],L[J++]=H[Q+3]);this._parameters.vvOpacity&&(L[J++]=K)};let T;(function(Q){Q[Q.ASCENDING=1]="ASCENDING";Q[Q.DESCENDING=-1]="DESCENDING"})(T||
(T={}));z=(Q,O)=>{const U=b.set(t,E[3*Q],E[3*Q+1],E[3*Q+2]),Z=v;let P=Q+O;do b.set(Z,E[3*P],E[3*P+1],E[3*P+2]),P+=O;while(b.equals(U,Z)&&0<=P&&P<A);r&&(b.transformMat4(U,U,r),b.transformMat4(Z,Z,r));M(U,Z,[-1,-1],Q);M(U,Z,[1,-1],Q);M(U,Z,[1,1],Q);M(U,Z,[-1,-1],Q);M(U,Z,[1,1],Q);M(U,Z,[-1,1],Q)};D=this._parameters.placement;"begin"!==D&&"begin-end"!==D||z(0,T.ASCENDING);"end"!==D&&"begin-end"!==D||z(A-1,T.DESCENDING)}}const t=g.create(),v=g.create();a.LineMarkerMaterial=w;a.Parameters=n;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h){const u=new Map([[e.VertexAttribute.POSITION,
0],[e.VertexAttribute.UV0,1],[e.VertexAttribute.AUXPOS1,2],[e.VertexAttribute.NORMAL,3],[e.VertexAttribute.COLOR,4],[e.VertexAttribute.COLORFEATUREATTRIBUTE,4],[e.VertexAttribute.SIZE,5],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,5],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,6]]);class w extends k.ShaderTechnique{initializeProgram(x){return new f.Program(x.rctx,w.shader.get().build(this.configuration),u)}_makePipelineState(x,n){const q=this.configuration,t=x===l.TransparencyPassType.NONE;return h.makePipelineState({blending:q.output===
g.ShaderOutput.Color||q.output===g.ShaderOutput.Alpha?t?m.blendingDefault:m.oitBlending(x):null,depthTest:{func:m.oitDepthTest(x)},depthWrite:t?q.writeDepth?h.defaultDepthWriteParams:null:m.oitDepthWrite(x),colorWrite:h.defaultColorWriteParams,stencilWrite:q.hasOccludees?c.stencilWriteMaskOn:null,stencilTest:q.hasOccludees?n?c.stencilToolMaskBaseParams:c.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){this.configuration.occluder&&(this._occluderPipelineTransparent=
h.makePipelineState({blending:m.blendingDefault,depthTest:c.depthCompareAlways,depthWrite:null,colorWrite:h.defaultColorWriteParams,stencilWrite:null,stencilTest:c.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=h.makePipelineState({blending:m.blendingDefault,depthTest:c.depthCompareAlways,depthWrite:null,colorWrite:h.defaultColorWriteParams,stencilWrite:c.stencilWriteMaskOff,stencilTest:c.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=h.makePipelineState({blending:null,
depthTest:c.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:c.stencilWriteMaskOn,stencilTest:c.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(x,n,q){return x?this._occludeePipelineState:this.configuration.occluder?q?this._occluderPipelineTransparent:n?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}
w.shader=new d.ReloadableShaderModule(p.LineMarker,()=>new Promise((x,n)=>a(["./LineMarker.glsl"],x,n)));b.LineMarkerTechnique=w;b.vertexAttributeLocations=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/support/engineContent/marker ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){function C(A){const F=new v.ShaderBuilder,G=A.multipassEnabled&&(A.output===d.ShaderOutput.Color||A.output===d.ShaderOutput.Alpha),I=A.space===D.LineMarkerSpace.World;F.include(m.RibbonVertexPosition,A);F.include(c.MarkerSizing,A);A.output===d.ShaderOutput.Depth&&F.include(f.OutputDepth,A);const {vertex:H,fragment:B}=F;B.include(h.RgbaFloatEncoding);u.addProjViewLocalOrigin(H,A);F.attributes.add(z.VertexAttribute.POSITION,"vec3");F.attributes.add(z.VertexAttribute.UV0,
"vec2");F.attributes.add(z.VertexAttribute.AUXPOS1,"vec3");F.varyings.add("vColor","vec4");F.varyings.add("vpos","vec3");F.varyings.add("vUV","vec2");F.varyings.add("vSize","float");g.addLinearDepth(F);G&&F.varyings.add("depth","float");A.hasTip&&F.varyings.add("vLineWidth","float");H.uniforms.add(new w.Float2PassUniform("nearFar",(K,L)=>L.camera.nearFar),new x.Float4PassUniform("viewport",(K,L)=>L.camera.fullViewport));H.code.add(q.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);H.code.add(q.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`);I?(F.attributes.add(z.VertexAttribute.NORMAL,"vec3"),u.addViewNormal(H),H.constants.add("tiltThreshold","float",.7),H.code.add(q.glsl`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):H.code.add(q.glsl`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);H.code.add(q.glsl`
      #define vecN ${I?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${I?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${A.anchor===D.LineMarkerAnchor.Tip?"pos -\x3d 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `);A.space===D.LineMarkerSpace.Screen&&(H.uniforms.add(new t.Matrix4PassUniform("inverseProjectionMatrix",(K,L)=>L.camera.inverseProjectionMatrix)),H.code.add(q.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),H.code.add(q.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),H.uniforms.add(new n.FloatPassUniform("perScreenPixelRatio",(K,L)=>L.camera.perScreenPixelRatio)),H.code.add(q.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${A.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));u.addPixelRatio(H);g.addCalculateLinearDepth(F);H.code.add(q.glsl`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`);I?(A.hideOnShortSegments&&H.code.add(q.glsl`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),H.code.add(q.glsl`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(H.code.add(q.glsl`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),A.space===D.LineMarkerSpace.Screen&&H.code.add(q.glsl`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`));H.code.add(q.glsl`
        ${G?"depth \x3d pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${I?"":"vUV *\x3d displacedPosScreen.w;"}

        ${A.hasTip?"vLineWidth \x3d lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);G&&F.include(l.multipassTerrainTest,A);F.include(k.SliceDraw,A);B.uniforms.add(new x.Float4PassUniform("intrinsicColor",K=>K.color),new r.Texture2DPassUniform("tex",K=>K.markerTexture));B.include(p.ColorConversion);F.constants.add("texelSize","float",1/b.markerTextureSize);B.code.add(q.glsl`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`);A.hasTip&&(F.constants.add("relativeMarkerSize","float",b.markerSymbolSize/b.markerTextureSize),F.constants.add("relativeTipLineWidth","float",b.markerTipThicknessFactor),B.code.add(q.glsl`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${I?"halfTipLineWidth *\x3d fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `));F.constants.add("symbolAlphaCutoff","float",e.symbolAlphaCutoff);B.code.add(q.glsl`
  void main() {
    discardBySlice(vpos);
    ${G?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${I?"vec2 samplePos \x3d vUV;":"vec2 samplePos \x3d vUV * gl_FragCoord.w;"}

    ${A.hasTip?"finalColor.a *\x3d max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *\x3d markerAlpha(samplePos);"}

    ${A.output===d.ShaderOutput.ObjectAndLayerIdColor?q.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${A.output===d.ShaderOutput.Alpha?q.glsl`fragColor = vec4(finalColor.a);`:""}
    ${A.output===d.ShaderOutput.Color?q.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${A.output===d.ShaderOutput.Color&&A.transparencyPassType===y.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${A.output===d.ShaderOutput.Highlight?q.glsl`fragColor = vec4(1.0);`:""}
    ${A.output===d.ShaderOutput.Depth?q.glsl`outputDepth(linearDepth);`:""}
  }
  `);return F}const E=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}));a.LineMarker=E;a.build=C})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports"],function(a){function b(k){null!=k?(k=d[k],k=null==k?k:{pattern:k.slice(),pixelRatio:8}):k=null;return k}const g={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},d={dash:g.dash,"dash-dot":[...g.dash,...g.dot],dot:g.dot,"long-dash":g["long-dash"],
"long-dash-dot":[...g["long-dash"],...g.dot],"long-dash-dot-dot":[...g["long-dash"],...g.dot,...g.dot],none:null,"short-dash":g["short-dash"],"short-dash-dot":[...g["short-dash"],...g["short-dot"]],"short-dash-dot-dot":[...g["short-dash"],...g["short-dot"],...g["short-dot"]],"short-dot":g["short-dot"],solid:null};a.createStipplePatternSimple=function(k){return{pattern:[k,k],pixelRatio:2}};a.getStipplePatternForLinePattern=function(k){return null!=k&&"style"===k.type?b(k.style):null};a.getStipplePatternForPatternStyle=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToDehydratedPoint ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/MeshTextureTransform ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/georeference ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/sources/interfaces ../../../ViewingMode ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DMeshObject3DGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./MeshFastUpdateProcessor ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba){const ia=["mesh"];class ka extends J.Graphics3DSymbolLayer{constructor(ja,oa,za,ta){super(ja,oa,za,ta);this._materialInfoCache=new M.MaterialInfoCache;this._fastUpdateProcessor=new M.MeshFastUpdateProcessor;this._textures=new Map;this.ensureDrapedStatus(!1)}async doLoad(){O.debugFlags.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new X.NativeLineMaterial({color:[1,0,1,1]}),
this._debugFaceNormalMaterial=new X.NativeLineMaterial({color:[0,1,1,1]}))}destroy(){super.destroy();this._textures.forEach(ja=>ja.unload());this._context.stage.removeMany(this._materialInfoCache.materials);this._context.stage.removeMany(Array.from(this._textures.values()));this._materialInfoCache.clear();this._textures.clear();this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(ja){const oa=ja.graphic;if(!this._validateGeometry(oa.geometry,
ia,"fill on mesh-3d"))return null;const za=this.setGraphicElevationContext(oa);return this._createAs3DShape(oa,ja.renderingInfo,za,oa.uid)}onRemoveGraphic(ja){this._fastUpdateProcessor.onRemoveGraphic(ja,this._materialInfoCache,this._context)}layerOpacityChanged(ja,oa){const za=this._getLayerOpacity();this._updateMaterialParameters(ta=>{ta.material.setParameters({layerOpacity:za});const Ca=ta.material.parameters;this._setMaterialTransparentParameter(Ca,ta);ta.material.setParameters({transparent:Ca.transparent})});
ja.forEach(ta=>oa(ta)?.layerOpacityChanged(za,this._context.isAsync))}layerElevationInfoChanged(ja,oa){return this.updateGraphics3DGraphicElevationInfo(ja,oa,B.needsElevationUpdates3D)}slicePlaneEnabledChanged(ja,oa){this._updateMaterialParameters(({material:za})=>{za.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});ja.forEach(za=>oa(za)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync));return!0}physicalBasedRenderingChanged(){const ja=this._usePBR();
this._updateMaterialParameters(({material:oa})=>oa.setParameters({usePBR:ja}));return!0}updateTransform(ja,oa,za,ta){const Ca=this._context.renderCoordsHelper.spatialReference,Ga=sa,{origin:La,transform:Ma}=za;u.computeTranslationToOriginAndRotation(oa,l.set(ea,La.x,La.y,La.z??0),Ga,Ca);switch(ta){case A.MeshTransformUpdateAction.EnableFastUpdates:this._fastUpdateProcessor.enable(ja,this._materialInfoCache,this._context);break;case A.MeshTransformUpdateAction.DisableFastUpdates:this._fastUpdateProcessor.disable(ja,
this._materialInfoCache,this._context);break;case A.MeshTransformUpdateAction.UpdateFastLocalOrigin:ja.updateFastLocalOrigin(Ga,Ma,this._context.localOriginFactory)}const {elevationContext:Ra}=ja;Ra.centerPointInElevationSR=this._getCenterPointInElevationSR(Ga);const {elevationProvider:Ya,renderCoordsHelper:ab}=this._context;ja.alignedSampledElevation=H.perObjectElevationAligner(ja,Ra,Ya.spatialReference,(Wa,cb)=>B.evaluateElevationInfoAtPoint(Wa,Ya,Ra,ab,cb),ab,Ga);ja.updateTransform(Ga,Ma,this._context.isAsync);
return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(ja){return null==ja?"-":ja instanceof b?ja.toHex():ja.contentHash}_materialPropertiesDefault(ja,oa){const za=this._requiresSymbolVertexColors(),ta=!!ja.vertexAttributes.color;ja=!!ja.vertexAttributes.tangent;return{hasSymbolVertexColors:za,hasVertexColors:ta,hasVertexTangents:ja,uid:`vc:${ta},vt:${ja},vct${oa},svc:${za}`}}_textureTransformUid(ja){const {offset:oa,scale:za,
rotation:ta}=ja??qa;return`${oa[0]},${oa[1]},${ta},${za[0]},${za[1]}`}_materialProperties(ja,oa,za){ja=this._materialPropertiesDefault(ja,za);if(!oa.material)return ja;const {color:ta,colorTexture:Ca,colorTextureTransform:Ga,normalTexture:La,normalTextureTransform:Ma,doubleSided:Ra,alphaCutoff:Ya,alphaMode:ab}=oa.material;za=this._colorOrTextureUid(ta);var Wa=this._colorOrTextureUid(Ca),cb=this._textureTransformUid(Ga),Na=this._colorOrTextureUid(La),xa=this._textureTransformUid(Ma);ja.color=ta;ja.colorTexture=
Ca;ja.normalTexture=La;ja.uid=`${ja.uid},cmuid:${za},ctmuid:${Wa},cttuid:${cb},ntmuid:${Na},nttuid:${xa},ds:${Ra},ac:${Ya},am:${ab}`;if(oa.material instanceof r){const {metallic:Da,roughness:Ka,metallicRoughnessTexture:ha,metallicRoughnessTextureTransform:Sa,emissiveColor:Va,emissiveTexture:wa,emissiveTextureTransform:Ba,occlusionTexture:Ja,occlusionTextureTransform:Ta}=oa.material;oa=this._colorOrTextureUid(ha);za=this._textureTransformUid(Sa);Wa=this._colorOrTextureUid(Va);cb=this._colorOrTextureUid(wa);
Na=this._textureTransformUid(Ba);xa=this._colorOrTextureUid(Ja);const db=this._textureTransformUid(Ta);ja.metallic=Da;ja.roughness=Ka;ja.metallicRoughnessTexture=ha;ja.emissiveColor=Va;ja.emissiveTexture=wa;ja.occlusionTexture=Ja;ja.colorTextureTransform=this._convertTextureTransform(Ga);ja.normalTextureTransform=this._convertTextureTransform(Ma);ja.emissiveTextureTransform=this._convertTextureTransform(Ba);ja.occlusionTextureTransform=this._convertTextureTransform(Ta);ja.metallicRoughnessTextureTransform=
this._convertTextureTransform(Sa);ja.uid=`${ja.uid},mrm:${Da},mrr:${Ka},mrt:${oa},mrtt:${za},emuid:${Wa},etmuid:${cb},ett:${Na},otmuid:${xa},ott:${db}`}return ja}_convertTextureTransform(ja){if(!ja)return null;const {scale:oa,offset:za,rotation:ta}=ja;return{scale:oa,offset:za,rotation:d.deg2rad(ta)}}_setInternalColorValueParameters(ja,oa){oa.diffuse=b.toUnitRGB(ja);oa.opacity=ja.a}_getLoadableTextureResource(ja){return ja.data??ja.url}_getInternalTextureId(ja){return this._getInternalTexture(ja,
Z.AlphaDiscardMode.Opaque)?.id}_getInternalTexture(ja,oa){const za=this._getLoadableTextureResource(ja);if(!za)return null;const ta=`${ja.contentHash}/${oa}`;var Ca=this._textures.get(ta);Ca||(Ca=null,Ca=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,ja={wrap:this._castTextureWrap(ja.wrap),noUnpackFlip:!0,maxAnisotropy:Ca,mipmap:1<Ca},G.isEncodedMeshTexture(za)?(Ca=za.data,ja.preMultiplyAlpha=!1,ja.encoding=za.encoding):(Ca=za,ja.preMultiplyAlpha=oa!==Z.AlphaDiscardMode.Opaque,
ja.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),Ca=new N.Texture(Ca,ja),this._textures.set(ta,Ca),Ca.load(this._context.stage.renderView.renderingContext),this._context.stage.add(Ca));return Ca}_castTextureWrap(ja="repeat"){return"string"===typeof ja?(ja=this._castTextureWrapIndividual(ja),{s:ja,t:ja}):{s:this._castTextureWrapIndividual(ja.horizontal),t:this._castTextureWrapIndividual(ja.vertical)}}_castTextureWrapIndividual(ja){switch(ja){case "clamp":return ba.TextureWrapMode.CLAMP_TO_EDGE;
case "mirror":return ba.TextureWrapMode.MIRRORED_REPEAT;default:return ba.TextureWrapMode.REPEAT}}_setInternalMaterialParameters(ja,oa){null!=ja.color&&this._setInternalColorValueParameters(ja.color,oa);if(null!=ja.colorTexture){const za=this._getInternalTexture(ja.colorTexture,oa.textureAlphaMode);za?(oa.textureId=za.id,oa.textureAlphaPremultiplied=!!za.parameters.preMultiplyAlpha):oa.textureId=void 0}ja.normalTexture&&(oa.normalTextureId=this._getInternalTextureId(ja.normalTexture));ja.emissiveColor&&
(oa.emissiveFactor=b.toUnitRGB(ja.emissiveColor));ja.emissiveTexture&&(oa.emissiveTextureId=this._getInternalTextureId(ja.emissiveTexture));ja.occlusionTexture&&(oa.occlusionTextureId=this._getInternalTextureId(ja.occlusionTexture));ja.metallicRoughnessTexture&&(oa.metallicRoughnessTextureId=this._getInternalTextureId(ja.metallicRoughnessTexture));oa.colorTextureTransformMatrix=I.getTransformMatrix(ja.colorTextureTransform);oa.normalTextureTransformMatrix=I.getTransformMatrix(ja.normalTextureTransform);
oa.occlusionTextureTransformMatrix=I.getTransformMatrix(ja.occlusionTextureTransform);oa.emissiveTextureTransformMatrix=I.getTransformMatrix(ja.emissiveTextureTransform);oa.metallicRoughnessTextureTransformMatrix=I.getTransformMatrix(ja.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(ja){let oa=this.symbolLayer.material?.colorMixMode??null;if(this._drivenProperties.color)ja.externalColor=p.ONES;else{const za=this.symbolLayer.material?.color??null;za?ja.externalColor=b.toUnitRGBA(za):
(oa=null,ja.externalColor=p.ONES)}oa&&(ja.colorMixMode=oa);ja.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(ja){ja=ja.vertexAttributes.color;if(null==ja)return!1;for(let oa=3;oa<ja.length;oa+=4)if(255!==ja[oa])return!0;return!1}_getOrCreateMaterial(ja,oa){var za=oa.material?.color,ta=oa.material?.colorTexture,Ca=oa.material?.alphaMode;const Ga="blend"===Ca;za="opaque"!==Ca&&(this._hasTransparentVertexColors(ja)||null!=za&&1>za.a||ta?.transparent||Ga);ja=this._materialProperties(ja,
oa,za);if(ta=this._materialInfoCache.byUid(ja.uid))return ta.material;za={uid:ja.uid,material:null,isComponentTransparent:za,alphaMode:oa.material?oa.material.alphaMode:"opaque"};ta=ca.useSchematicPBR({normalTexture:ja.normalTexture,metallicRoughnessTexture:ja.metallicRoughnessTexture,metallicFactor:ja.metallic,roughnessFactor:ja.roughness,emissiveTexture:ja.emissiveTexture,emissiveFactor:b.toUnitRGB(ja.emissiveColor),occlusionTexture:ja.occlusionTexture});Ca={usePBR:this._usePBR(),isSchematic:ta,
hasVertexColors:ja.hasVertexColors,hasSymbolColors:ja.hasSymbolVertexColors,hasVertexTangents:ja.hasVertexTangents,ambient:e.ZEROS,diffuse:e.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Z.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};Ca.mrrFactors=ta?[...ca.defaultSchematicMRRFactors]:[ja.metallic,ja.roughness,ca.defaultAdvancedMRRFactors[2]];oa.material&&(Ca.doubleSided=oa.material.doubleSided,
Ca.cullFace=oa.material.doubleSided?Z.CullFaceOptions.None:Z.CullFaceOptions.Back,Ca.textureAlphaCutoff=oa.material.alphaCutoff);this._setExternalMaterialParameters(Ca);this._setMaterialTransparentParameter(Ca,za);this._setInternalMaterialParameters(ja,Ca);oa=new S.DefaultMaterial(Ca);za.material=oa;this._materialInfoCache.set(ja.uid,za);this._context.stage.add(oa);return oa}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(ja,oa){ja.transparent=this.needsDrivenTransparentPass||
oa.isComponentTransparent||1>ja.layerOpacity||1>ja.opacity||ja.externalColor&&1>ja.externalColor[3];ja.textureAlphaMode="auto"===oa.alphaMode?ja.transparent?Z.AlphaDiscardMode.MaskBlend:Z.AlphaDiscardMode.Opaque:"opaque"===oa.alphaMode?Z.AlphaDiscardMode.Opaque:"mask"===oa.alphaMode?Z.AlphaDiscardMode.Mask:Z.AlphaDiscardMode.Blend}_addDebugNormals(ja,oa){var za=oa.length,ta=ja.spatialReference.isGeographic?20015077/180:1;const Ca=.1*Math.max(ja.extent.width*ta,ja.extent.height*ta,ja.extent.zmax-ja.extent.zmin);
var Ga=[];const La=[];ja=[];ta=[];for(let cb=0;cb<za;cb++){var Ma=oa[cb],Ra=Ma.attributes.get(V.VertexAttribute.POSITION),Ya=Ma.attributes.get(V.VertexAttribute.NORMAL);Ma=Ra.data;Ra=Ra.indices;const Na=Ya.data;Ya=Ya.indices;for(let xa=0;xa<Ra.length;xa++){var ab=3*Ra[xa];const Da=3*Ya[xa];for(var Wa=0;3>Wa;Wa++)Ga.push(Ma[ab+Wa]);for(Wa=0;3>Wa;Wa++)Ga.push(Ma[ab+Wa]+Na[Da+Wa]*Ca);La.push(La.length);La.push(La.length);if(0===xa%3){this._calculateFaceNormal(Ma,Ra,xa,da);this._getFaceVertices(Ma,Ra,
xa,ea,fa,aa);l.add(ea,ea,fa);l.add(ea,ea,aa);l.scale(ea,ea,1/3);for(ab=0;3>ab;ab++)ja.push(ea[ab]);for(ab=0;3>ab;ab++)ja.push(ea[ab]+da[ab]*Ca);ta.push(ta.length);ta.push(ta.length)}}}za=oa[0].transformation;Ga=new R.Geometry(this._debugVertexNormalMaterial,[[V.VertexAttribute.POSITION,new U.Attribute(Ga,La,3,!0)]],null,P.ContentObjectType.Line);oa.push(Ga);Ga.transformation=za;ja=new R.Geometry(this._debugFaceNormalMaterial,[[V.VertexAttribute.POSITION,new U.Attribute(ja,ta,3,!0)]],null,P.ContentObjectType.Line);
ja.transformation=za;oa.push(ja)}_createAs3DShape(ja,oa,za,ta){ja=ja.geometry;if("mesh"!==ja.type)return null;oa=this._createGeometryInfo(ja,oa,ta);if(null==oa)return null;const {geometries:Ca,objectTransformation:Ga}=oa;O.debugFlags.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(ja,Ca);ta=new W.Object3D({geometries:Ca,layerUid:this._context.layer.uid,graphicUid:ta});ta.transformation=Ga;oa=(oa=T.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()}))?new L.Object3DEdgeState(Ca[0].material,
[oa],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null;oa=new K.Graphics3DMeshObject3DGraphicLayer(this,ta,Ca,null,null,H.perObjectElevationAligner,za,oa);this._fastUpdateProcessor.onAddGraphic();oa.needsElevationUpdates=B.needsElevationUpdates3D(za.mode);oa.useObjectOriginAsAttachmentOrigin=!0;za.centerPointInElevationSR=this._getCenterPointInElevationSR(ta.transformation);const {elevationProvider:La,renderCoordsHelper:Ma}=this._context;oa.alignedSampledElevation=H.perObjectElevationAligner(oa,
za,La.spatialReference,(Ra,Ya)=>B.evaluateElevationInfoAtPoint(Ra,La,za,Ma,Ya),Ma);return oa}_getCenterPointInElevationSR(ja){const oa=E.makeDehydratedPoint(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);x.projectVectorToDehydratedPoint([ja[12],ja[13],ja[14]],this._context.renderCoordsHelper.spatialReference,oa);return oa}_createComponentNormals(ja,oa,za,ta){switch(za.shading||"flat"){default:case "source":return this._createComponentNormalsSource(ja,
oa,za,ta);case "flat":return this._createComponentNormalsFlat(ja,ta);case "smooth":return this._createComponentNormalsSmooth(ja,ta)}}_createComponentNormalsSource(ja,oa,za,ta){if(null==oa)return this._createComponentNormalsFlat(ja,ta);let Ca=!1;if(!za.trustSourceNormals)for(za=0;za<ta.length;za+=3){this._calculateFaceNormal(ja,ta,za,da);for(let Ga=0;3>Ga;Ga++){const La=3*ta[za+Ga];ea[0]=oa[La];ea[1]=oa[La+1];ea[2]=oa[La+2];0>l.dot(da,ea)&&(oa[La]=-oa[La],oa[La+1]=-oa[La+1],oa[La+2]=-oa[La+2],Ca=!0)}}return new na(oa,
ta,Ca)}_createComponentNormalsFlat(ja,oa){const za=q.newFloatArray(oa.length),ta=Array(3*oa.length);for(let Ca=0;Ca<oa.length;Ca+=3){const Ga=this._calculateFaceNormal(ja,oa,Ca,da);for(let La=0;3>La;La++)za[Ca+La]=Ga[La],ta[Ca+La]=Ca/3}return new na(za,ta,!1)}_createComponentNormalsSmooth(ja,oa){const za={};for(var ta=0;ta<oa.length;ta+=3){var Ca=this._calculateFaceNormal(ja,oa,ta,da);for(var Ga=0;3>Ga;Ga++){var La=oa[ta+Ga];let Ma=za[La];Ma||(Ma={normal:e.create(),count:0},za[La]=Ma);l.add(Ma.normal,
Ma.normal,Ca);Ma.count++}}ja=q.newFloatArray(3*oa.length);ta=Array(3*oa.length);for(Ca=0;Ca<oa.length;Ca++){Ga=za[oa[Ca]];1!==Ga.count&&(l.normalize(Ga.normal,Ga.normal),Ga.count=1);for(La=0;3>La;La++)ja[3*Ca+La]=Ga.normal[La];ta[Ca]=Ca}return new na(ja,ta,!1)}_getFaceVertices(ja,oa,za,ta,Ca,Ga){const La=3*oa[za],Ma=3*oa[za+1];oa=3*oa[za+2];ta[0]=ja[La];ta[1]=ja[La+1];ta[2]=ja[La+2];Ca[0]=ja[Ma];Ca[1]=ja[Ma+1];Ca[2]=ja[Ma+2];Ga[0]=ja[oa];Ga[1]=ja[oa+1];Ga[2]=ja[oa+2]}_calculateFaceNormal(ja,oa,za,
ta){this._getFaceVertices(ja,oa,za,ea,fa,aa);l.subtract(fa,fa,ea);l.subtract(aa,aa,ea);l.cross(ea,fa,aa);l.normalize(ta,ea);return ta}_getOrCreateComponents(ja){return ja.components??Aa}_createPositionBuffer(ja,oa){let za=ja.vertexAttributes.position;const ta=oa.reprojection===la.ECEF?oa.transformBeforeProject:null;ta&&(za=z.transformMat4(new Float64Array(za.length),za,ta));if(oa.reprojection===la.NONE)return oa.needsBufferCopy?new Float64Array(za):za;oa=ta?za:new Float64Array(za.length);w.projectBuffer(za,
ja.spatialReference,0,oa,this._context.renderCoordsHelper.spatialReference,0,za.length/3);return oa}_createNormalBuffer(ja,oa,za){let ta=ja.vertexAttributes.normal;if(null==ta)return null;var Ca=za.reprojection===la.ECEF?za.transformBeforeProject:null;Ca&&(ta=C.transformNormal(ta,new Float32Array(ta.length),Ca));if("local"===this._context.graphicsCoreOwner.view.viewingMode||za.reprojection===la.NONE)return za.needsBufferCopy&&ja.vertexAttributes.normal===ta?new Float32Array(ta):ta;za=ja.vertexAttributes.position;
Ca=Ca?ta:new Float32Array(ta.length);return C.projectNormalToPCPF(ta,za,oa,ja.spatialReference,Ca)}_createTangentBuffer(ja,oa,za){let ta=ja.vertexAttributes.tangent;if(null==ta)return null;var Ca=za.reprojection===la.ECEF?za.transformBeforeProject:null;Ca&&(ta=C.transformTangent(ta,new Float32Array(ta.length),Ca));if("local"===this._context.graphicsCoreOwner.view.viewingMode||za.reprojection===la.NONE)return za.needsBufferCopy&&ja.vertexAttributes.normal===ta?new Float32Array(ta):ta;za=ja.vertexAttributes.position;
Ca=Ca?ta:new Float32Array(ta.length);return C.projectTangentToPCPF(ta,za,oa,ja.spatialReference,Ca)}_createColorBuffer(ja){return ja.vertexAttributes.color}_createSymbolColorBuffer(ja){if(this._requiresSymbolVertexColors()){ja=this._getVertexOpacityAndColor(ja);const oa=Q.parseColorMixMode(this.symbolLayer?.material?.colorMixMode),za=new Uint8Array(4);Q.encodeSymbolColor(ja,oa,za);return za}return null}_createBuffers(ja,oa){var za=ja.vertexAttributes&&ja.vertexAttributes.position;if(!za)return this.logger.warn("Mesh geometry must contain position vertex attributes"),
null;var ta=ja.vertexAttributes.normal;const Ca=ja.vertexAttributes.uv;var Ga=ja.vertexAttributes.tangent;if(ta&&ta.length!==za.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Ga&&Ga.length/4!==za.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(Ca&&Ca.length/2!==za.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;Ga=this._computeReprojectionInfo(ja);za=this._createPositionBuffer(ja,Ga);ta=this._createColorBuffer(ja);oa=this._createSymbolColorBuffer(oa);const La=this._createNormalBuffer(ja,za,Ga),Ma=this._createTangentBuffer(ja,za,Ga);ja=Ga.reprojection===la.NONE&&Ga.objectTransformation?Ga.objectTransformation:this._transformOriginLocal(ja,za,La,Ma);Ga=Ga.reprojection===la.NONE&&Ga.geometryTransformation?Ga.geometryTransformation:c.create();return{positionBuffer:za,normalBuffer:La,tangentBuffer:Ma,uvBuffer:Ca,
colorBuffer:ta,symbolColorBuffer:oa,objectTransformation:ja,geometryTransformation:Ga}}_computeReprojectionInfo(ja){var {vertexSpace:oa}=ja;const za=oa.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===F.ViewingMode.Local?la.NONE:la.ECEF:la.NONE;if(oa.isRelative){const {origin:ta}=oa;oa=c.create();const Ca=ja.transform?.localMatrix??c.IDENTITY;if(za===la.NONE)return u.computeTranslationToOriginAndRotation(ja.spatialReference,ta,oa,this._context.renderCoordsHelper.spatialReference),ja=
c.clone(Ca),{reprojection:za,objectTransformation:oa,geometryTransformation:ja,needsBufferCopy:!1};ja=f.fromTranslation(c.create(),ta);f.multiply(ja,ja,Ca);return{reprojection:za,transformBeforeProject:ja,needsBufferCopy:!0}}return{reprojection:za,needsBufferCopy:!0}}_transformOriginLocal(ja,oa,za,ta){const Ca=this._context.renderCoordsHelper.spatialReference;var Ga=ja.anchor;Y[0]=Ga.x;Y[1]=Ga.y;Y[2]=Ga.z??0;Ga=c.create();u.computeTranslationToOriginAndRotation(ja.spatialReference,Y,Ga,Ca);f.invert(ma,
Ga);z.transformMat4(oa,oa,ma);if(za||ta)k.fromMat4(ua,Ga),k.transpose(ua,ua),za&&z.transformMat3(za,za,ua),ta&&z.transformMat3(ta,ta,ua,4);return Ga}_validateFaces(ja,oa){ja=ja.vertexAttributes.position.length/3;if(oa=oa.faces){let za=-1;for(let ta=0;ta<oa.length;ta++){const Ca=oa[ta];Ca>za&&(za=Ca)}if(ja<=za)return this.logger.warn(`Vertex index ${za} is out of bounds of the mesh position buffer`),!1}else if(0!==ja%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0}_getOrCreateFaces(ja,oa){return oa.faces??t.getContinuousIndexArray(ja.vertexAttributes.position.length/3)}_isOutsideClippingArea(ja){if(!this._context.clippingExtent)return!1;var oa=ja.vertexAttributes?.position;if(!oa)return!1;ja=D.project({positions:oa,transform:ja.transform,vertexSpace:ja.vertexSpace,inSpatialReference:ja.spatialReference,outSpatialReference:this._context.elevationProvider.spatialReference??ja.spatialReference,localMode:this._context.stage.viewingMode===F.ViewingMode.Local});
oa=ja.length/3;n.empty(ra);n.expandWithBuffer(ra,ja,0,oa);return!n.intersectsClippingArea(ra,this._context.clippingExtent)}_createGeometryInfo(ja,oa,za){if(!h.canProjectWithoutEngine(ja.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(ja))return null;oa=this._createBuffers(ja,oa);if(null==oa)return null;const {positionBuffer:ta,uvBuffer:Ca,colorBuffer:Ga,
symbolColorBuffer:La,normalBuffer:Ma,tangentBuffer:Ra,objectTransformation:Ya,geometryTransformation:ab}=oa;var Wa=this._getOrCreateComponents(ja);oa=[];let cb=!1;var Na=f.getTranslation(ea,Ya);Na=this._context.localOriginFactory.getOrigin(Na);for(const Da of Wa){if(!this._validateFaces(ja,Da))return null;var xa=this._getOrCreateFaces(ja,Da);if(0===xa.length)continue;Wa=this._createComponentNormals(ta,Ma,Da,xa);Wa.didFlipNormals&&(cb=!0);Wa=[[V.VertexAttribute.POSITION,new U.Attribute(ta,xa,3,!0)],
[V.VertexAttribute.NORMAL,new U.Attribute(Wa.normals,Wa.indices,3,!0)]];Ga&&Wa.push([V.VertexAttribute.COLOR,new U.Attribute(Ga,xa,4,!0)]);La&&Wa.push([V.VertexAttribute.SYMBOLCOLOR,new U.Attribute(La,t.getZeroIndexArray(xa.length),4,!0)]);Ca&&Wa.push([V.VertexAttribute.UV0,new U.Attribute(Ca,xa,2,!0)]);Ra&&Wa.push([V.VertexAttribute.TANGENT,new U.Attribute(Ra,xa,4,!0)]);xa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:za,layerUid:this._context.layer.uid});const Ka=this._getOrCreateMaterial(ja,
Da);Wa=new R.Geometry(Ka,Wa,null,P.ContentObjectType.Mesh,xa);Wa.transformation=ab;Wa.localOrigin=Na;oa.push(Wa)}cb&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:oa,objectTransformation:Ya}}_updateMaterialParameters(ja){this._materialInfoCache.forEachMaterialInfo(ja);this._fastUpdateProcessor.forEachMaterialInfo(ja);this._fastUpdateProcessor.forEachClonedMaterial((oa,
za)=>{za.setParameters(oa.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class na{constructor(ja,oa,za){this.normals=ja;this.indices=oa;this.didFlipNormals=za}}const Y=e.create(),ea=e.create(),fa=e.create(),aa=e.create(),da=e.create(),ma=c.create(),ua=m.create(),sa=c.create(),ra=n.create(),Aa=[new v],qa=new y;var la;(function(ja){ja[ja.NONE=0]="NONE";ja[ja.ECEF=1]="ECEF"})(la||(la={}));a.Graphics3DMeshFillSymbolLayer=ka;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/projection/projectVectorToDehydratedPoint":function(){define(["exports","../../chunks/vec3f64","./projectBuffer"],function(a,b,g){const d=b.create();a.projectVectorToDehydratedPoint=function(k,m,f){return g.projectBuffer(k,m,0,d,f.spatialReference,0,1)?(f.x=d[0],f.y=d[1],f.z=d[2],f):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){var h;const u=d.getLogger("esri.geometry.support.MeshComponent");b=h=class extends b.JSONSupport{static from(w){return c.ensureClass(h,w)}constructor(w){super(w);this.material=this.faces=null;this.name=void 0;this.shading="source";this.trustSourceNormals=!1}castFaces(w){return p.castArray(w,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},u)}castMaterial(w){return w&&"object"===typeof w&&("metallic"in w||"roughness"in w||"metallicRoughnessTexture"in w)?c.ensureClass(e,
w):c.ensureClass(l,w)}clone(){return new h({faces:g.clone(this.faces),shading:this.shading,material:g.clone(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(w,x){w={faces:g.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(w,x):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new h(w)}get memoryUsage(){let w=0;null!=this.faces&&(w+=this.faces.byteLength);null!=this.material&&(w+=
this.material.memoryUsage);return w}};a.__decorate([k.property({json:{write:!0}})],b.prototype,"faces",void 0);a.__decorate([m.cast("faces")],b.prototype,"castFaces",null);a.__decorate([k.property({type:l,json:{write:!0}})],b.prototype,"material",void 0);a.__decorate([m.cast("material")],b.prototype,"castMaterial",null);a.__decorate([k.property()],b.prototype,"name",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],b.prototype,"shading",void 0);a.__decorate([k.property({type:Boolean})],
b.prototype,"trustSourceNormals",void 0);return b=h=a.__decorate([f.subclass("esri.geometry.support.MeshComponent")],b)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./MeshTexture ./MeshTextureTransform".split(" "),function(a,b,g,d,k,m,f,c,l,e){var p;g=p=class extends g.JSONSupport{constructor(h){super(h);
this.colorTextureTransform=this.colorTexture=this.color=null;this.normalTextureTransform=this.normalTexture=void 0;this.alphaMode="auto";this.alphaCutoff=.5;this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(h,u){const w=null!=h?h.get(this):null;if(w)return w;u=new p(this.clonePropertiesWithDeduplication(u));null!=h&&h.set(this,u);return u}clonePropertiesWithDeduplication(h){return{color:null!=this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(h),
normalTexture:this.normalTexture?.cloneWithDeduplication(h),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let h;h=null!=this.color?16:0;null!=this.colorTexture&&(h+=this.colorTexture.memoryUsage);h+=null!=this.colorTextureTransform?20:0;null!=this.normalTexture&&(h+=this.normalTexture.memoryUsage);
return h+=null!=this.normalTextureTransform?20:0}};a.__decorate([d.property({type:b,json:{write:!0}})],g.prototype,"color",void 0);a.__decorate([d.property({type:l,json:{write:!0}})],g.prototype,"colorTexture",void 0);a.__decorate([d.property({type:e,json:{write:!0}})],g.prototype,"colorTextureTransform",void 0);a.__decorate([d.property({type:l,json:{write:!0}})],g.prototype,"normalTexture",void 0);a.__decorate([d.property({type:e,json:{write:!0}})],g.prototype,"normalTextureTransform",void 0);a.__decorate([d.property({nonNullable:!0,
json:{write:!0}})],g.prototype,"alphaMode",void 0);a.__decorate([d.property({nonNullable:!0,json:{write:!0}})],g.prototype,"alphaCutoff",void 0);a.__decorate([d.property({nonNullable:!0,json:{write:!0}})],g.prototype,"doubleSided",void 0);return g=p=a.__decorate([c.subclass("esri.geometry.support.MeshMaterial")],g)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){var h;const u=new WeakMap;let w=0;b=h=class extends d.JSONSupport{constructor(x){super(x);this.wrap="repeat"}get url(){return this._get("url")||null}set url(x){this._set("url",x);x&&this._set("data",null)}get data(){return this._get("data")||null}set data(x){this._set("data",x);x&&this._set("url",null)}writeData(x,n,q,t){x instanceof HTMLImageElement?(x={type:"image-element",src:p.toJSON(x.src,t),crossOrigin:x.crossOrigin},n[q]=x):x instanceof HTMLCanvasElement?(x=
x.getContext("2d").getImageData(0,0,x.width,x.height),x={type:"canvas-element",imageData:this._encodeImageData(x)},n[q]=x):x instanceof HTMLVideoElement?(x={type:"video-element",src:p.toJSON(x.src,t),autoplay:x.autoplay,loop:x.loop,muted:x.muted,crossOrigin:x.crossOrigin,preload:x.preload},n[q]=x):x instanceof ImageData&&(x={type:"image-data",imageData:this._encodeImageData(x)},n[q]=x)}readData(x){switch(x.type){case "image-element":var n=new Image;n.src=x.src;n.crossOrigin=x.crossOrigin;return n;
case "canvas-element":return x=this._decodeImageData(x.imageData),n=document.createElement("canvas"),n.width=x.width,n.height=x.height,n.getContext("2d").putImageData(x,0,0),n;case "image-data":return this._decodeImageData(x.imageData);case "video-element":return n=document.createElement("video"),n.src=x.src,n.crossOrigin=x.crossOrigin,n.autoplay=x.autoplay,n.loop=x.loop,n.muted=x.muted,n.preload=x.preload,n}}get transparent(){var x=this.data,n=this.url;return x instanceof HTMLCanvasElement?this._imageDataContainsTransparent(x.getContext("2d").getImageData(0,
0,x.width,x.height)):x instanceof ImageData?this._imageDataContainsTransparent(x):n&&(x=n.substr(n.length-4,4).toLowerCase(),n=n.substr(0,15).toLocaleLowerCase(),".png"===x||"data:image/png;"===n)?!0:!1}set transparent(x){this._overrideIfSome("transparent",x)}get contentHash(){const x="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",n=(q="")=>`d:${q},t:${this.transparent},w:${x}`;if(null!=this.url)return n(this.url);if(null!=this.data){if(this.data instanceof
HTMLImageElement||this.data instanceof HTMLVideoElement)return n(this.data.src);u.has(this.data)||u.set(this.data,++w);return n(u.get(this.data))}return n()}get memoryUsage(){let x;x=0+(null!=this.url?this.url.length:0);if(null!=this.data){const n=this.data;"data"in n?x+=n.data.byteLength:n instanceof HTMLImageElement?x+=n.naturalWidth*n.naturalHeight*3:n instanceof HTMLCanvasElement&&(x+=n.width*n.height*3)}return x}clone(){const x={url:this.url,data:this.data,wrap:this._cloneWrap()};return new h(x)}cloneWithDeduplication(x){var n=
x.get(this);if(n)return n;n=this.clone();x.set(this,n);return n}_cloneWrap(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(x){let n="";for(let q=0;q<x.data.length;q++)n+=String.fromCharCode(x.data[q]);return{data:btoa(n),width:x.width,height:x.height}}_decodeImageData(x){const n=atob(x.data),q=new Uint8ClampedArray(n.length);for(let t=0;t<n.length;t++)q[t]=n.charCodeAt(t);return g.wrapImageData(q,x.width,x.height)}_imageDataContainsTransparent(x){for(let n=
3;n<x.data.length;n+=4)if(255!==x.data[n])return!0;return!1}static from(x){return"string"===typeof x?new h({url:x}):x instanceof HTMLImageElement||x instanceof HTMLCanvasElement||x instanceof ImageData||x instanceof HTMLVideoElement?new h({data:x}):m.ensureClass(h,x)}};a.__decorate([k.property({type:String,json:{write:p.write}})],b.prototype,"url",null);a.__decorate([k.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),k.property()],b.prototype,"data",null);a.__decorate([e.writer("data")],
b.prototype,"writeData",null);a.__decorate([c.reader("data")],b.prototype,"readData",null);a.__decorate([k.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);a.__decorate([k.property({json:{write:!0}})],b.prototype,"wrap",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"contentHash",null);return b=h=a.__decorate([l.subclass("esri.geometry.support.MeshTexture")],b)})},"esri/core/imageUtils":function(){define("require exports ../request ./Error ./promiseUtils ./urlUtils ../support/base64Utils".split(" "),
function(a,b,g,d,k,m,f){function c(u,w,x){x||(p||(p=document.createElement("canvas"),p.width=1,p.height=1),x=p);return x.getContext("2d").createImageData(u,w)}async function l(u,w){u=window.URL.createObjectURL(u);try{const {data:x}=await g(u,{...w,responseType:"image"});return x}catch(x){if(!k.isAbortError(x))throw new d("invalid-image",`Could not fetch requested image at ${u}`);throw x;}finally{window.URL.revokeObjectURL(u)}}async function e(u,w){const x=m.dataComponents(u);if(x?.isBase64)return{arrayBuffer:f.base64ToArrayBuffer(x.data),
mediaType:x.mediaType};w=await g(u,{responseType:"array-buffer",...w});u=w.data;w=w.getHeader("Content-Type");return{arrayBuffer:u,mediaType:w}}let p=null,h=!0;b.createEmptyImageData=function(u,w,x){if(!u||!w)throw Error("Cannot construct image data without dimensions");if(h)try{return new ImageData(u,w)}catch(n){h=!1}return c(u,w,x)};b.getImageData=async function(u,w){const {arrayBuffer:x,mediaType:n}=await e(u,w);u="image/png"===n;if("image/gif"===n){const {isAnimatedGIF:q,parseGif:t}=await new Promise((v,
r)=>a(["./image/gif"],v,r));if(q(x))return t(x,w)}if(u){const {isAnimatedPNG:q,parseApng:t}=await new Promise((v,r)=>a(["./image/apng"],v,r));if(q(x))return t(x,w)}u=new Blob([x],{type:n});return l(u,w)};b.wrapImageData=function(u,w,x,n){if(!w||!x)throw Error("Cannot construct image data without dimensions");if(h)try{return new ImageData(u,w,x)}catch(q){h=!1}w=c(w,x,n);w.data.set(u,0);return w};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshTextureTransform":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){b=class extends b.ClonableMixin(g.JSONSupport){constructor(l){super(l);this.offset=[0,0];this.rotation=0;this.scale=[1,1]}};a.__decorate([d.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"offset",void 0);a.__decorate([d.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"rotation",void 0);a.__decorate([d.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"scale",void 0);return b=a.__decorate([c.subclass("esri.geometry.support.MeshTextureTransform")],
b)})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture ./MeshTextureTransform".split(" "),function(a,b,g,d,k,m,f,c,l,e){var p;d=p=class extends c{constructor(h){super(h);this.emissiveTexture=this.emissiveColor=null;this.emissiveTextureTransform=
void 0;this.occlusionTexture=null;this.occlusionTextureTransform=void 0;this.roughness=this.metallic=1;this.metallicRoughnessTexture=null;this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(h,u){const w=null!=h?h.get(this):null;if(w)return w;u=new p(this.clonePropertiesWithDeduplication(u));null!=h&&h.set(this,u);return u}getMemoryUsage(){let h=super.getMemoryUsage();h+=null!=this.emissiveColor?16:0;null!=this.emissiveTexture&&
(h+=this.emissiveTexture.memoryUsage);h+=null!=this.emissiveTextureTransform?20:0;null!=this.occlusionTexture&&(h+=this.occlusionTexture.memoryUsage);h+=null!=this.occlusionTextureTransform?20:0;null!=this.metallicRoughnessTexture&&(h+=this.metallicRoughnessTexture.memoryUsage);return h+=null!=this.metallicRoughnessTextureTransform?20:0}clonePropertiesWithDeduplication(h){return{...super.clonePropertiesWithDeduplication(h),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(h),
emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(h),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(h),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};a.__decorate([g.property({type:b,json:{write:!0}})],d.prototype,"emissiveColor",void 0);a.__decorate([g.property({type:l,
json:{write:!0}})],d.prototype,"emissiveTexture",void 0);a.__decorate([g.property({type:e,json:{write:!0}})],d.prototype,"emissiveTextureTransform",void 0);a.__decorate([g.property({type:l,json:{write:!0}})],d.prototype,"occlusionTexture",void 0);a.__decorate([g.property({type:e,json:{write:!0}})],d.prototype,"occlusionTextureTransform",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],d.prototype,"metallic",void 0);a.__decorate([g.property({type:Number,
nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],d.prototype,"roughness",void 0);a.__decorate([g.property({type:l,json:{write:!0}})],d.prototype,"metallicRoughnessTexture",void 0);a.__decorate([g.property({type:e,json:{write:!0}})],d.prototype,"metallicRoughnessTextureTransform",void 0);return d=p=a.__decorate([f.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],d)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){function l(w,x,n,q){const {loggerTag:t,stride:v}=x;return 0!==w.length%v?(q.error(t,`Invalid array length, expected a multiple of ${v}`),new n([])):w}function e(w,x,n,q,t){if(!w)return w;if(w instanceof x)return l(w,q,x,t);for(const v of n)if(w instanceof v)return l(new x(w),q,x,t);if(Array.isArray(w))return l(new x(w),q,x,t);n=n.map(v=>`'${v.name}'`);t.error(`Failed to set property, expected one of ${n}, but got ${w.constructor.name}`);return new x([])}function p(w,x,n){const q=
Array(w.length);for(let t=0;t<w.length;t++)q[t]=w[t];x[n]=q}var h;const u=k.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=h=class extends g.JSONSupport{constructor(w){super(w);this.color=null;this.position=new Float64Array(0);this.tangent=this.normal=this.uv=null}castColor(w){return e(w,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},u)}castPosition(w){w&&w instanceof Float32Array&&u.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");
return e(w,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},u)}castUv(w){return e(w,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},u)}castNormal(w){return e(w,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},u)}castTangent(w){return e(w,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},u)}clone(){const w={position:d.clone(this.position),uv:d.clone(this.uv),normal:d.clone(this.normal),tangent:d.clone(this.tangent),color:d.clone(this.color)};return new h(w)}clonePositional(){const w=
{position:d.clone(this.position),normal:d.clone(this.normal),tangent:d.clone(this.tangent),uv:this.uv,color:this.color};return new h(w)}get memoryUsage(){let w;w=0+this.position.byteLength;null!=this.uv&&(w+=this.uv.byteLength);null!=this.normal&&(w+=this.normal.byteLength);null!=this.tangent&&(w+=this.tangent.byteLength);null!=this.color&&(w+=this.color.byteLength);return w}};b.__decorate([m.property({json:{write:p}})],a.MeshVertexAttributes.prototype,"color",void 0);b.__decorate([f.cast("color")],
a.MeshVertexAttributes.prototype,"castColor",null);b.__decorate([m.property({nonNullable:!0,json:{write:p}})],a.MeshVertexAttributes.prototype,"position",void 0);b.__decorate([f.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);b.__decorate([m.property({json:{write:p}})],a.MeshVertexAttributes.prototype,"uv",void 0);b.__decorate([f.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);b.__decorate([m.property({json:{write:p}})],a.MeshVertexAttributes.prototype,"normal",
void 0);b.__decorate([f.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);b.__decorate([m.property({json:{write:p}})],a.MeshVertexAttributes.prototype,"tangent",void 0);b.__decorate([f.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=h=b.__decorate([c.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/georeference":function(){define("exports ../../../core/unitUtils ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../DoubleArray ../MeshGeoreferencedRelativeVertexSpace ../MeshGeoreferencedVertexSpace ../MeshLocalVertexSpace ../MeshTransform ../../../chunks/vec32 ./geographicUtils ./projection".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){function y(B,K,L){if(v.isGeographicMesh(K.spatialReference,L)){var J=K.spatialReference,M=A(K,L,G),T=new Float64Array(B.position.length);K=B.position;var Q=J;var O=T;t.transformMat4(O,K,M);K=new Float64Array(K.length);Q=r.projectFromPCPF(O,K,Q);M=c.normalFromMat4(H,M);O=T;K=B.normal;L=M;var U=J;if(null==K)O=null;else{var Z=new Float32Array(K.length);t.transformMat3(Z,K,L);r.projectNormalFromPCPF(Z,Q,O,U,Z);O=Z}B=B.tangent;if(null==B)B=null;else{K=
new Float32Array(B.length);t.transformMat3(K,B,M,4);for(M=3;M<K.length;M+=4)K[M]=B[M];r.projectTangentFromPCPF(K,Q,T,J,K);B=K}B={position:Q,normal:O,tangent:B}}else{J=new Float64Array(B.position.length);Q=B.position;T=K.x;M=K.y;O=K.z??0;K=F(L?L.unit:null,K.spatialReference);for(L=0;L<Q.length;L+=3)J[L]=Q[L]*K+T,J[L+1]=Q[L+1]*K+M,J[L+2]=Q[L+2]*K+O;B={position:J,normal:B.normal,tangent:B.tangent}}return B}function z(B,K=k.IDENTITY){const {position:L,normal:J,tangent:M}=B;B=t.transformMat4(new Float64Array(L.length),
L,K);const T=null!=J?r.transformNormal(J,new Float32Array(J.length),K):null;K=null!=M?r.transformTangent(M,new Float32Array(M.length),K):null;return{position:B,normal:T,tangent:K}}function D(B,K,L,J){const {position:M,normal:T,tangent:Q}=B;if(!K.isRelative)return{position:M,normal:T,tangent:Q};B=z(B,L?.localMatrix);return y(B,K.getOriginPoint(J),{geographic:!K.isGeoreferenced})}function C(B,K,L){if(v.isGeographicMesh(K.spatialReference,L)){const Q=K.spatialReference;A(K,L,G);var J=d.invert(I,G);K=
new Float64Array(B.position.length);L=J;var M=r.projectToPCPF(B.position,Q,K),T=new Float64Array(M.length);t.transformMat4(T,M,L);L=T;J=c.normalFromMat4(H,J);T=B.normal;M=J;null==T?M=null:(T=r.projectNormalToPCPF(T,B.position,K,Q,new Float32Array(T.length)),t.transformMat3(T,T,M),M=T);T=B.tangent;null==T?B=null:(B=r.projectTangentToPCPF(T,B.position,K,Q,new Float32Array(T.length)),t.transformMat3(B,B,J,4));B={position:L,normal:M,tangent:B}}else B=E(B,K,L);return B}function E(B,K,L){const J=new Float64Array(B.position.length),
M=B.position,T=K.x,Q=K.y,O=K.z??0;K=F(L?L.unit:null,K.spatialReference);for(L=0;L<M.length;L+=3)J[L]=(M[L]-T)/K,J[L+1]=(M[L+1]-Q)/K,J[L+2]=(M[L+2]-O)/K;return{position:J,normal:B.normal,tangent:B.tangent}}function A(B,K,L){p.computeTranslationToOriginAndRotation(B.spatialReference,[B.x,B.y,B.z??0],L,e.getSphericalPCPF(B.spatialReference));B=F(K?K.unit:null,B.spatialReference);d.scale(L,L,[B,B,B]);return L}function F(B,K){if(null==B)return 1;K=b.getMetersPerCartesianUnitForSR(K);return 1/b.convertUnit(K,
"meters",B)}const G=k.create(),I=k.create(),H=g.create();a.applyTransform=z;a.georeference=y;a.georeferenceApplyTransform=D;a.georeferenceByTransform=function(B,K,L){if(L?.useTransform){const {position:J,normal:M,tangent:T}=B,{x:Q,y:O,z:U}=K;B=f.fromValues(Q,O,U??0);return{vertexAttributes:{position:J,normal:M,tangent:T},vertexSpace:L.geographic??!0?new n({origin:B}):new w({origin:B}),transform:new q}}return{vertexAttributes:y(B,K,L),vertexSpace:new x,transform:null}};a.project=function({positions:B,
transform:K,vertexSpace:L,inSpatialReference:J,outSpatialReference:M,outPositions:T,localMode:Q}){const O=L.isRelative?L.origin:f.ZEROS;K=L.isRelative?K?.localMatrix??k.IDENTITY:k.IDENTITY;if(L.isGeoreferenced){T=T??u.newDoubleArray(B.length);d.equals(K,k.IDENTITY)?u.copyInto(T,B):t.transformMat4(T,B,K);if(!m.exactEquals(O,f.ZEROS)){const [Z,P,R]=O;for(B=0;B<T.length;B+=3)T[B]+=Z,T[B+1]+=P,T[B+2]+=R}h.projectBuffer(T,J,0,T,M,0,T.length/3);return T}L=J;const U=e.getSphericalPCPF(J);L=M.isWebMercator&&
Q||!l.canProjectWithoutEngine(J,U)?L:U;p.computeTranslationToOriginAndRotation(J,O,G,L);d.multiply(G,G,K);J=T??u.newDoubleArray(B.length);t.transformMat4(J,B,G);h.projectBuffer(J,L,0,J,M,0,J.length/3);return J};a.ungeoreference=C;a.ungeoreferenceByTransform=function(B,K,L,J,M){if(!K.isRelative)return C(B,J,M);const {spatialReference:T}=J;B=D(B,K,L,T);return J.equals(K.getOriginPoint(T))?E(B,J,M):C(B,J,M)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshGeoreferencedVertexSpace":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/Error ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c,l,e){b=class extends b.ClonableMixin(g.JSONSupport){constructor(){super({});this.type="georeferenced";this.isRelative=!1;this.isGeoreferenced=!0}};a.__decorate([l.enumeration({georeferenced:"georeferenced"},{readOnly:!0})],b.prototype,"type",void 0);return b=a.__decorate([e.subclass("esri.geometry.support.MeshGeoreferencedVertexSpace")],b)})},"esri/geometry/support/MeshLocalVertexSpace":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../chunks/vec3f64 ../Point".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){b=class extends b.ClonableMixin(g.JSONSupport){constructor(h){super(h);this.type="local";this.isRelative=!0;this.isGeoreferenced=!1;this.origin=e.create()}getOriginPoint(h){const [u,w,x]=this.origin;return new p({x:u,y:w,z:x,spatialReference:h})}setOriginFromPoint({x:h,y:u,z:w}){this.origin=e.fromValues(h,u,w??0)}};a.__decorate([c.enumeration({local:"local"},{readOnly:!0})],b.prototype,"type",void 0);a.__decorate([d.property({type:[Number],nonNullable:!0,json:{write:!0}})],
b.prototype,"origin",void 0);return b=a.__decorate([l.subclass("esri.geometry.support.MeshLocalVertexSpace")],b)})},"esri/geometry/support/MeshTransform":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/mat4 ../../chunks/mat4f64 ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ../../chunks/vec3f64 ./axisAngleDegrees".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){var x;b=x=class extends b.JSONSupport{constructor(q){super(q);this.translation=u.create();this.rotationAxis=u.fromArray(w.up);this.rotationAngle=0;this.scale=u.fromValues(1,1,1)}get rotation(){return w.fromAxisAndAngle(this.rotationAxis,this.rotationAngle)}set rotation(q){this.rotationAxis=u.clone(w.axis(q));this.rotationAngle=w.angle(q)}get localMatrix(){const q=l.create();e.setAxisAngle(n,w.axis(this.rotation),w.angleRad(this.rotation));c.fromRotationTranslationScale(q,
n,this.translation,this.scale);return q}get localMatrixInverse(){return c.invert(l.create(),this.localMatrix)}applyLocal(q,t){return h.transformMat4(t,q,this.localMatrix)}applyLocalInverse(q,t){return h.transformMat4(t,q,this.localMatrixInverse)}equals(q){return this===q||null!=q&&c.exactEquals(this.localMatrix,q.localMatrix)}clone(){const q={translation:u.clone(this.translation),rotationAxis:u.clone(this.rotationAxis),rotationAngle:this.rotationAngle,scale:u.clone(this.scale)};return new x(q)}};
a.__decorate([g.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"translation",void 0);a.__decorate([g.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"rotationAxis",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"rotationAngle",void 0);a.__decorate([g.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"scale",void 0);a.__decorate([g.property()],b.prototype,"rotation",null);a.__decorate([g.property()],
b.prototype,"localMatrix",null);a.__decorate([g.property()],b.prototype,"localMatrixInverse",null);b=x=a.__decorate([f.subclass("esri.geometry.support.MeshTransform")],b);const n=p.create();return b})},"esri/geometry/support/meshUtils/geographicUtils":function(){define(["exports","../../../core/Logger"],function(a,b){a.isGeographicMesh=function(g,d){return g.isGeographic||g.isWebMercator&&(d?.geographic??!0)};a.validateGeographicFlag=function(g,d,k){const m=!g.isGeoreferenced;null!=k?.geographic&&
k.geographic!==m&&b.getLogger(d).warnOnce(`Specifying the 'geographic' parameter (${k.geographic}) for a Mesh vertex space of type "${g.type}" is not supported. This parameter will be ignored.`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(C,E,A,F,G,I){if(E){var H=A.count,B=c.getSphericalPCPF(G);if(q(G))for(A=0;A<H;A++)F.getVec(A,r),E.getVec(A,y),l.computeTranslationToOriginAndRotation(B,r,z,B),g.fromMat4(D,z),C===v.FROM_PCPF&&g.transpose(D,D),m.transformMat3(y,y,D),I.setVec(A,y);else for(G=0;G<H;G++){F.getVec(G,r);E.getVec(G,y);l.computeTranslationToOriginAndRotation(B,r,z,B);g.fromMat4(D,z);var K=h.y2lat(A.get(G,1));K=Math.cos(K);C===v.TO_PCPF&&(K=1/K);D[0]*=K;D[1]*=K;D[2]*=K;D[3]*=
K;D[4]*=K;D[5]*=K;C===v.FROM_PCPF&&g.transpose(D,D);m.transformMat3(y,y,D);m.normalize(y,y);I.setVec(G,y)}return I}}function n(C){return q(C)||C.isWebMercator}function q(C){return C.isWGS84||p.isCGCS2000(C)||p.isMars(C)||p.isMoon(C)}const t=b.getLogger("esri.geometry.support.meshUtils.normalProjection");var v;(function(C){C[C.TO_PCPF=0]="TO_PCPF";C[C.FROM_PCPF=1]="FROM_PCPF"})(v||(v={}));const r=f.create(),y=f.create(),z=k.create(),D=d.create();a.projectFromPCPF=function(C,E,A){e.projectBuffer(C,
c.getSphericalPCPF(A),0,E,A,0,C.length/3);return E};a.projectNormalFromPCPF=function(C,E,A,F,G){if(!n(F))return t.error("Cannot convert to spatial reference from PCPF"),G;x(v.FROM_PCPF,u.BufferViewVec3f.fromTypedArray(C),u.BufferViewVec3f64.fromTypedArray(E),u.BufferViewVec3f64.fromTypedArray(A),F,u.BufferViewVec3f.fromTypedArray(G));return G};a.projectNormalToPCPF=function(C,E,A,F,G){if(!n(F))return t.error("Cannot convert spatial reference to PCPF"),G;x(v.TO_PCPF,u.BufferViewVec3f.fromTypedArray(C),
u.BufferViewVec3f64.fromTypedArray(E),u.BufferViewVec3f64.fromTypedArray(A),F,u.BufferViewVec3f.fromTypedArray(G));return G};a.projectTangentFromPCPF=function(C,E,A,F,G){if(!n(F))return t.error("Cannot convert to spatial reference from PCPF"),G;x(v.FROM_PCPF,u.BufferViewVec3f.fromTypedArray(C,16),u.BufferViewVec3f64.fromTypedArray(E),u.BufferViewVec3f64.fromTypedArray(A),F,u.BufferViewVec3f.fromTypedArray(G,16));for(E=3;E<C.length;E+=4)G[E]=C[E];return G};a.projectTangentToPCPF=function(C,E,A,F,G){if(!n(F))return t.error("Cannot convert spatial reference to PCPF"),
G;x(v.TO_PCPF,u.BufferViewVec3f.fromTypedArray(C,4*Float32Array.BYTES_PER_ELEMENT),u.BufferViewVec3f64.fromTypedArray(E),u.BufferViewVec3f64.fromTypedArray(A),F,u.BufferViewVec3f.fromTypedArray(G,4*Float32Array.BYTES_PER_ELEMENT));for(E=3;E<C.length;E+=4)G[E]=C[E];return G};a.projectToPCPF=function(C,E,A){e.projectBuffer(C,E,0,A,c.getSphericalPCPF(E),0,C.length/3);return A};a.transformNormal=function(C,E,A){g.normalFromMat4(D,A);w.transformMat3(E,C,D);g.isOrthoNormal(D)||w.normalize(E,E);return E};
a.transformTangent=function(C,E,A){g.normalFromMat4(D,A);w.transformMat3(E,C,D,4);g.isOrthoNormal(D)||w.normalize(E,E,4);if(C!==E)for(A=3;A<C.length;A+=4)E[A]=C[A];return E};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/interfaces":function(){define(["exports"],function(a){a.MeshTransformUpdateAction=void 0;var b=a.MeshTransformUpdateAction||(a.MeshTransformUpdateAction={});b[b.EnableFastUpdates=0]="EnableFastUpdates";b[b.DisableFastUpdates=1]="DisableFastUpdates";
b[b.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/resourceUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/basicInterfaces"],function(a,b,g){class d{constructor(k){this.data=k;this.type="encoded-mesh-texture";this.encoding=g.TextureEncodingMimeType.KTX2_ENCODING}}a.EncodedMeshTexture=d;a.imageFromBinaryData=async function(k,m){if(m===g.TextureEncodingMimeType.KTX2_ENCODING)return new d(k);
k=new Blob([k],{type:m});const f=URL.createObjectURL(k),c=new Image;if(b("esri-iPhone"))return new Promise((l,e)=>{const p=()=>{u();l(c)},h=w=>{u();e(w)},u=()=>{URL.revokeObjectURL(f);c.removeEventListener("load",p);c.removeEventListener("error",h)};c.addEventListener("load",p);c.addEventListener("error",h);c.src=f});try{c.src=f,await c.decode()}catch(l){console.warn("Failed decoding HTMLImageElement")}URL.revokeObjectURL(f);return c};a.isEncodedMeshTexture=function(k){return"encoded-mesh-texture"===
k?.type};a.jsonFromBinaryData=async function(k){k=await (new Blob([k])).text();return JSON.parse(k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/TextureTransformUtils":function(){define(["exports","../../../../chunks/mat3f32","../../../../chunks/vec2f32","../../../../chunks/mat3"],function(a,b,g,d){a.getTransformMatrix=function(k){if(null==k)return null;var m=null!=k.offset?k.offset:g.ZEROS,f=null!=k.rotation?k.rotation:0;k=null!=k.scale?k.scale:g.ONES;
m=b.fromValues(1,0,0,0,1,0,m[0],m[1],1);f=b.fromValues(Math.cos(f),-Math.sin(f),0,Math.sin(f),Math.cos(f),0,0,0,1);k=b.fromValues(k[0],0,0,0,k[1],0,0,0,1);const c=b.create();d.multiply(c,f,k);d.multiply(c,m,c);return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshObject3DGraphicLayer":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./ElevationAligners ./elevationAlignmentUtils ./featureExpressionInfoUtils ./Graphics3DObject3DGraphicLayer".split(" "),
function(a,b,g,d,k,m,f,c,l){class e extends l.Graphics3DObject3DGraphicLayer{constructor(){super(...arguments);this._originalGeometries=[];this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(v,r){if(!this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!0;var {stageObject:y}=this,z=y.geometries.slice();y.removeAllGeometries();var D=b.getTranslation(p,y.transformation);r=r.getOrigin(D);for(const C of z)D=
v(C.material),D=C.instantiate({material:D}),D.localOrigin=r,y.addGeometry(D);this._originalGeometries=z}}disableFastTransformUpdates(v){if(this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!1;var {stageObject:r}=this,y=r.geometries.map(z=>v(z.material));r.removeAllGeometries();for(let z=0;z<this._originalGeometries.length;z++){const D=this._originalGeometries[z],C=y[z];C.setParameters({modelTransformation:null});C===D.material?r.addGeometry(D):r.addGeometry(D.instantiate({material:C}))}this._originalGeometries.length=
0}}updateFastLocalOrigin(v,r,y){if(this._fastTransformUpdatesEnabled){var {stageObject:z}=this;if(0!==z.geometries.length){var D=z.geometries[0].localOrigin,C=b.getTranslation(p,v),E=y.getOrigin(C);if(E!==D){var A=r?.localMatrix??g.IDENTITY;z.shaderTransformation=null;z.transformation=v;z.geometries.forEach(F=>{F.transformation=A;F.localOrigin=E})}}}}updateTransform(v,r,y){const {stageObject:z}=this,D=r?.localMatrix??g.IDENTITY;if(this._fastTransformUpdatesEnabled){var C=z.geometries[0].transformation;
r=b.multiply(h,z.transformation,C);v=b.multiply(u,v,D);C=b.multiply(x,v,b.invert(x,C));z.shaderTransformation=C;this._setFastMaterialTransformation({matA:r,matB:v})}else z.shaderTransformation=null,z.transformation=v,z.geometries.forEach(E=>{E.transformation=D});this._fastUpdateEdgeTransform()||this.resetEdgeObject(y)}alignWithElevation(v,r,y,z){if(this._fastTransformUpdatesEnabled){null!=y&&c.setContextFeature(this.elevationContext.featureExpressionInfoContext,y);var {stageObject:D}=this;if(D.geometries[0].material.parameters.modelTransformation){y=
b.multiply(h,D.transformation,D.geometries[0].transformation);var C=b.copy(w,D.effectiveTransformation);this.alignedSampledElevation=m.perObjectElevationAligner(this,this.elevationContext,v.spatialReference,(E,A)=>f.evaluateElevationInfoAtPoint(E,v,this.elevationContext,r,A),r,C);D.shaderTransformation=C;D=b.multiply(u,C,D.geometries[0].transformation);this._setFastMaterialTransformation({matA:y,matB:D});this._fastUpdateEdgeTransform()||this.resetEdgeObject(z)}}else super.alignWithElevation(v,r,y,
z)}_setFastMaterialTransformation({matA:v,matB:r}){const {stageObject:y}=this;if(0!==y.geometries.length){var z=b.fromTranslation(t,d.scale(p,y.geometries[0].localOrigin.vec3,-1));v=b.multiply(n,z,v);r=b.multiply(q,z,r);z=b.invert(n,v);r=b.multiply(q,r,z);for(const D of y.geometries)D.material.setParameters({modelTransformation:r})}}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}}const p=k.create(),h=g.create(),
u=g.create(),w=g.create(),x=g.create(),n=g.create(),q=g.create(),t=g.create();a.Graphics3DMeshObject3DGraphicLayer=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/MeshFastUpdateProcessor":function(){define(["exports","../../webgl-engine/materials/DefaultMaterial"],function(a,b){class g{constructor(){this._fastTransformOriginalMaterials=new Map;this._fastTransformClonedMaterials=new Map;this._graphicReferenceCount=0}enable(k,m,f){k.enableFastTransformUpdates(c=>
{if(1>=this._graphicReferenceCount){if(this._fastTransformOriginalMaterials.has(c))return c;var l=m.byMaterial(c);this._fastTransformOriginalMaterials.set(c,l);m.delete(c);return c}l=new b.DefaultMaterial(c.parameters);f.stage.add(l);this._fastTransformClonedMaterials.set(l,c);return l},f.localOriginFactory)}disable(k,m,f){const c=new Set,l=new Set;k.disableFastTransformUpdates(e=>{if(!this._fastTransformClonedMaterials.has(e)){var p=this._fastTransformOriginalMaterials.get(e);if(m.has(p.uid))return c.add(e),
m.byUid(p.uid).material;l.add(e);return p.material}p=this._fastTransformClonedMaterials.get(e);this._fastTransformClonedMaterials.delete(e);f.stage.remove(e);return p});for(const e of c)this._fastTransformOriginalMaterials.delete(e),f.stage.remove(e);for(const e of l)k=this._fastTransformOriginalMaterials.get(e),this._fastTransformOriginalMaterials.delete(e),m.set(k.uid,k)}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(k,m,f){this._graphicReferenceCount--;this.disable(k,m,f)}forEachMaterialInfo(k){this._fastTransformOriginalMaterials.forEach(k)}forEachClonedMaterial(k){this._fastTransformClonedMaterials.forEach(k)}destroy(k){k.removeMany(Array.from(this._fastTransformClonedMaterials.keys()));
k.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:m})=>m));this._fastTransformClonedMaterials.clear();this._fastTransformOriginalMaterials.clear()}}class d{constructor(){this._byUid=new Map;this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),k=>k.material)}byUid(k){return this._byUid.get(k)}byMaterial(k){return this._byMaterial.get(k)}set(k,m){this._byUid.set(k,m);this._byMaterial.set(m.material,m)}delete(k){const m=this._byMaterial.get(k)?.uid;
m&&(this._byUid.delete(m),this._byMaterial.delete(k))}has(k){return this._byUid.has(k)}forEachMaterialInfo(k){this._byUid.forEach(k)}clear(){this._byUid.clear();this._byMaterial.clear()}}a.MaterialInfoCache=d;a.MeshFastUpdateProcessor=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./DefaultLayouts ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y){class z extends w.Material{constructor(R){super(R,new C);this._configuration=new y.NativeLineTechniqueConfiguration}getConfiguration(R){this._configuration.output=R;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._configuration.hasOccludees=this.parameters.hasOccludees;return this._configuration}intersect(R,
W,N,V,S,X){if(N.options.selectionMode&&R.visible)if(n.isTranslationMatrix(W)){S=R.attributes.get(q.VertexAttribute.POSITION).data;var ca=N.camera,ba=M;k.copy(ba,N.point);m.set(T[0],ba[0]-2,ba[1]+2,0);m.set(T[1],ba[0]+2,ba[1]+2,0);m.set(T[2],ba[0]+2,ba[1]-2,0);m.set(T[3],ba[0]-2,ba[1]-2,0);for(R=0;4>R;R++)if(!ca.unprojectFromRenderScreen(T[R],Q[R]))return;p.fromPoints(ca.eye,Q[0],Q[1],O);p.fromPoints(ca.eye,Q[1],Q[2],U);p.fromPoints(ca.eye,Q[2],Q[3],Z);p.fromPoints(ca.eye,Q[3],Q[0],P);V=Number.MAX_VALUE;
R=0;for(let ka=0;ka<S.length-5;ka+=3)if(E[0]=S[ka]+W[12],E[1]=S[ka+1]+W[13],E[2]=S[ka+2]+W[14],A[0]=S[ka+3]+W[12],A[1]=S[ka+4]+W[13],A[2]=S[ka+5]+W[14],!(0>p.signedDistance(O,E)&&0>p.signedDistance(O,A)||0>p.signedDistance(U,E)&&0>p.signedDistance(U,A)||0>p.signedDistance(Z,E)&&0>p.signedDistance(Z,A)||0>p.signedDistance(P,E)&&0>p.signedDistance(P,A))){ca.projectToRenderScreen(E,I);ca.projectToRenderScreen(A,H);if(0>I[2]&&0<H[2]){m.subtract(F,E,A);var ia=ca.frustum;ia=-p.signedDistance(ia[l.PlaneIndex.NEAR],
E)/m.dot(F,p.normal(ia[l.PlaneIndex.NEAR]));m.scale(F,F,ia);m.add(E,E,F);ca.projectToRenderScreen(E,I)}else if(0<I[2]&&0>H[2])m.subtract(F,A,E),ia=ca.frustum,ia=-p.signedDistance(ia[l.PlaneIndex.NEAR],A)/m.dot(F,p.normal(ia[l.PlaneIndex.NEAR])),m.scale(F,F,ia),m.add(A,A,F),ca.projectToRenderScreen(A,H);else if(0>I[2]&&0>H[2])continue;I[2]=0;H[2]=0;ia=e.distance2(e.fromPoints(I,H,L),ba);ia<V&&(V=ia,m.copy(B,E),m.copy(K,A),R=ka/3)}W=N.rayBegin;N=N.rayEnd;4>V&&(V=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(B,
K,L),e.fromPoints(W,N,J),G)&&(m.subtract(G,G,W),V=m.length(G),m.scale(G,G,1/V),V/=m.distance(W,N)),X(V,G,R,!1))}else b.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")}intersectDraped(R,W,N,V,S,X){if(N.options.selectionMode){W=R.attributes.get(q.VertexAttribute.POSITION).data;var ca=R.attributes.get(q.VertexAttribute.SIZE);N=V[0];V=V[1];R=(((ca?ca.data[0]:0)+1)/2+4)*R.screenToWorldRatio;ca=Number.MAX_VALUE;var ba=0;for(let ea=
0;ea<W.length-5;ea+=3){var ia=W[ea],ka=W[ea+1],na=N-ia,Y=V-ka;ia=W[ea+3]-ia;ka=W[ea+4]-ka;const fa=g.clamp((ia*na+ka*Y)/(ia*ia+ka*ka),0,1);na=ia*fa-na;Y=ka*fa-Y;Y=na*na+Y*Y;Y<ca&&(ca=Y,ba=ea/3)}ca<R*R&&S(X.dist,X.normal,ba,!1)}}produces(R,W){return(W===h.ShaderOutput.Color||W===h.ShaderOutput.Highlight||W===h.ShaderOutput.ObjectAndLayerIdColor)&&(R===x.RenderSlot.OPAQUE_MATERIAL||R===x.RenderSlot.DRAPED_MATERIAL)}createGLMaterial(R){return new D(R)}createBufferWriter(){return new t.DefaultBufferWriter(this.parameters.hasVertexColors?
v.PositionColorLayout:v.PositionLayout)}}class D extends u{_updateOccludeeState(R){R.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:R.hasOccludees})}beginSlot(R){this._output===h.ShaderOutput.Color&&this._updateOccludeeState(R);return this.ensureTechnique(r.NativeLineTechnique,R)}}class C extends w.MaterialParameters{constructor(){super(...arguments);this.color=c.ONES;this.hasSlicePlane=this.hasVertexColors=!1;this.width=1;this.hasOccludees=!1}}const E=
f.create(),A=f.create(),F=f.create(),G=f.create(),I=d.createRenderScreenPointArray3(),H=d.createRenderScreenPointArray3(),B=f.create(),K=f.create(),L=e.create(),J=e.create(),M=f.create(),T=[d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3()],Q=[f.create(),f.create(),f.create(),f.create()],O=p.create(),U=p.create(),Z=p.create(),P=p.create();a.NativeLineMaterial=z;a.Parameters=C;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c,l,e,p){class h extends k.ShaderTechnique{initializeProgram(u){return new f.Program(u.rctx,
h.shader.get().build(this.configuration),m.Default3D)}initializePipeline(){const u=this.configuration,w=p.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),x=(n,q=null,t=null)=>p.makePipelineState({blending:q,depthTest:c.depthCompareLess,depthWrite:t,colorWrite:p.defaultColorWriteParams,stencilWrite:u.hasOccludees?c.stencilWriteMaskOn:null,stencilTest:u.hasOccludees?n?c.stencilToolMaskBaseParams:c.stencilBaseAllZerosParams:
null});return u.output===g.ShaderOutput.Color?(this._occludeePipelineState=x(!0,u.transparent?w:null,p.defaultDepthWriteParams),x(!1,u.transparent?w:null,p.defaultDepthWriteParams)):x(!1)}get primitiveType(){return e.PrimitiveType.LINES}getPipeline(u){return u?this._occludeePipelineState:super.getPipeline()}}h.shader=new d.ReloadableShaderModule(l.NativeLine,()=>new Promise((u,w)=>a(["./NativeLine.glsl"],u,w)));b.NativeLineTechnique=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(n){const q=new h.ShaderBuilder,{vertex:t,fragment:v}=q;q.include(d.Transform,n);q.include(k.VertexColor,n);c.addProjViewLocalOrigin(t,n);q.attributes.add(u.VertexAttribute.POSITION,"vec3");q.varyings.add("vpos","vec3");t.code.add(p.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`);n.output===b.ShaderOutput.Highlight&&q.include(m.OutputHighlight,n);q.include(g.SliceDraw,n);v.uniforms.add(new e.FloatPassUniform("alphaCoverage",(r,y)=>Math.min(1,r.width*y.camera.pixelRatio)));n.hasVertexColors||v.uniforms.add(new l.Float4PassUniform("constantColor",r=>r.color));v.code.add(p.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${n.hasVertexColors?"vColor":"constantColor"};

    ${n.output===b.ShaderOutput.ObjectAndLayerIdColor?p.glsl`color.a = 1.0;`:""}

    if (color.a < ${p.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${n.output===b.ShaderOutput.Color?p.glsl`fragColor = highlightSlice(color, vpos);`:""}
    ${n.output===b.ShaderOutput.Highlight?p.glsl`outputHighlight();`:""}
  }
  `);return q}const x=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}));a.NativeLine=x;a.build=w})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,g,d,k){class m extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.output=g.ShaderOutput.Color;this.hasOccludees=this.transparent=this.hasVertexColors=this.hasSlicePlane=!1}}b.__decorate([d.parameter({count:g.ShaderOutput.COUNT})],m.prototype,"output",void 0);b.__decorate([d.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([d.parameter()],m.prototype,"hasVertexColors",void 0);b.__decorate([d.parameter()],m.prototype,"transparent",void 0);b.__decorate([d.parameter()],m.prototype,"hasOccludees",void 0);a.NativeLineTechniqueConfiguration=m;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/typedArrayUtil ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./defaultSymbolComplexity ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./SymbolComplexity ./webStyleUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q){class O{constructor(V,S,X,ca,ba,ia,ka,na,Y,ea,fa,aa){this.lodResources=V;this.lodRenderer=S;this.stageResources=X;this.originalMaterialParameters=ca;this.resourceSize=ba;this.isEsriSymbolResource=ia;this.isWosr=ka;this.resourceBoundingBox=na;this.symbolSize=Y;this.extentPadding=ea;this.physicalBasedRenderingEnabled=fa;this.pivotOffset=aa}}class U extends y.Graphics3DSymbolLayer{getCachedSize(){const [V,S,X]=null!=
this._resources?this._resources.symbolSize:[1,1,1];return{width:V,depth:S,height:X}}constructor(V,S,X,ca){super(V,S,X,ca);this._resources=null;this._optionalFields=[];this._instanceIndexToGraphicUid=new Map;this._hasLoadedPBRTextures=!1;this._disposeResourceHandles=[];this.skipHighSymbolLodsChanged=!1;this.ensureDrapedStatus(!1);this._hasLoadedPBRTextures=X.physicalBasedRenderingEnabled}async doLoad(V){if(!this._drivenProperties.size&&z.validateSymbolLayerSize(this.symbolLayer))throw Error();if(this._isPrimitive){var S=
this.symbolLayer.resource;S=S&&G.isValidPrimitive(S.primitive)?S.primitive:x.defaultPrimitive;this._resources=await this._createResourcesForPrimitive(S,V)}else S=(await H.getResourceUrlFromSymbolStyle(this.symbol.styleOrigin))?.href??this.symbolLayer.resource.href,this._resources=await this._createResourcesForUrl(S,V);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?
this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(V,S=this.symbolLayer?.material?.color){S=this._getCombinedOpacity(S);const X=1>S||this.needsDrivenTransparentPass;V.transparent=X;V.opacity=S;V.cullFace=X?K.CullFaceOptions.None:K.CullFaceOptions.Back;return V}async _createResourcesForPrimitive(V,S){var X=
this.symbolLayer;const ca=w.create(n.objectSymbolLayerPrimitiveBoundingBox(V)),ba=e.fromArray(w.size(ca)),ia=e.fromArray(n.objectSymbolLayerSizeWithResourceSize(ba,X)),ka=l.length(ia);var na={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...Q.defaultSchematicMRRFactors],ambient:e.ONES,diffuse:e.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const Y=
!!na.usePBR;this._setMaterialTransparencyParameters(na);const ea=this.symbol;if("point-3d"===ea.type&&ea.verticalOffset){const {screenLength:fa,minWorldLength:aa,maxWorldLength:da}=ea.verticalOffset;na.verticalOffset={screenLength:k.pt2px(fa),minWorldLength:aa||0,maxWorldLength:null!=da?da:Infinity};na.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(na.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?na.externalColor=p.ONES:
(X=null!=X.material?X.material.color:null,X=null!=X?b.toUnitRGBA(X):p.ONES,na.externalColor=X);this._fastUpdates=B.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(ca,ia,ba,null));na.isInstanced=!0;this._fastUpdates?(Object.assign(na,this._fastUpdates.materialParameters),this._optionalFields.push(L.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(na.hasInstancedColor=!0,this._optionalFields.push(L.VertexAttribute.COLOR));g("enable-feature:objectAndLayerId-rendering")&&
this._optionalFields.push(L.VertexAttribute.OBJECTANDLAYERIDCOLOR);na=new T.DefaultMaterial(na);na=G.primitiveLodResources(V,na);if(!na)throw Error(`Unknown object symbol primitive: ${V}`);V=M.materialsFromLodResources(na).map(fa=>({opacity:1,transparent:fa.parameters.transparent}));X=await this._createStageResources(na,Y,S);S=await this._createLodRenderer(na,S);return new O(na,S,X,V,ba,!1,!1,ca,ia,ka,Y,null)}async _createResourcesForUrl(V,S){var X={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};(this._fastUpdates=B.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)))?(Object.assign(X.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(L.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(X.materialParameters.hasInstancedColor=!0,this._optionalFields.push(L.VertexAttribute.COLOR));
g("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(L.VertexAttribute.OBJECTANDLAYERIDCOLOR);var ca=this.symbol;if("point-3d"===ca.type&&ca.verticalOffset){const {screenLength:Aa,minWorldLength:qa,maxWorldLength:la}=ca.verticalOffset;X.materialParameters.verticalOffset={screenLength:k.pt2px(Aa),minWorldLength:qa||0,maxWorldLength:null!=la?la:Infinity};X.materialParameters.castShadows=!1}ca=this._context.physicalBasedRenderingEnabled;X.signal=S;X.usePBR=ca;X.skipHighLods=this._context.skipHighSymbolLods;
var ba=await A.fetch(V,X);V=ba.isEsriSymbolResource;X=ba.isWosr;const ia=E.makeLodResources(ba.lods),ka=this._context,na=this._getExternalColorParameters(this.symbolLayer.material),Y=this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:!0}),ea=this.needsDrivenTransparentPass;var fa=M.materialsFromLodResources(ia);const aa=M.materialsFromLodResources(ia).map(Aa=>({opacity:Aa.parameters.opacity||1,transparent:Aa.parameters.transparent}));fa.forEach(Aa=>{const qa=Aa.parameters;
Aa.setParameters(na);const la=qa.opacity*Y;Aa.setParameters({opacity:la,transparent:1>la||ea||qa.transparent});ka.screenSizePerspectiveEnabled&&Aa.setParameters({screenSizePerspective:ka.sharedResources.screenSizePerspectiveSettings})});ba=ba.referenceBoundingBox;const da=e.fromArray(w.size(ba)),ma=e.fromArray(ia.levels[0].pivotOffset),ua=e.fromArray(n.objectSymbolLayerSizeWithResourceSize(da,this.symbolLayer)),sa=l.length(ua),ra=this._fastUpdates;B.updateFastSymbolUpdatesState(ra,this._context.renderer,
this._fastVisualVariableConvertOptions(ba,ua,da,ma))&&fa.forEach(Aa=>Aa.setParameters(ra.materialParameters));fa=await this._createStageResources(ia,ca,S);S=await this._createLodRenderer(ia,S);return new O(ia,S,fa,aa,da,V,X,ba,ua,sa,ca,ma)}_addDisposeResource(V){this._disposeResourceHandles.push(V)}async _createStageResources(V,S,X){const ca=this._context.stage,ba=M.materialsFromLodResources(V);S!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();ca.addMany(ba);this._addDisposeResource(()=>
ca.removeMany(ba));const ia=M.texturesFromLodResources(V);ca.addMany(ia);this._addDisposeResource(()=>{ia.forEach(na=>na.unload());ca.removeMany(ia)});await Promise.all(ia.map(na=>this._context.stage.schedule(()=>na.load(ca.renderView.renderingContext),X)));d.throwIfAborted(X);const ka=M.geometriesFromLodResources(V);ca.addMany(ka);this._addDisposeResource(()=>ca.removeMany(ka));return{materials:ba,textures:ia,geometries:ka}}async _createLodRenderer(V,S){const X=this._context.stage,ca=this._fastUpdates,
ba=new J.LodRenderer({symbol:V,optionalFields:this._optionalFields,metadata:{layerUid:this._context.layer.uid,graphicUid:ia=>this._instanceIndexToGraphicUid.get(ia),notifyGraphicGeometryChanged:ia=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(ia)),notifyGraphicVisibilityChanged:ia=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(ia))},shaderTransformation:ca?{applyTransform:(ia,ka,na)=>{ia.getFeatureAttribute(ka,W);f.copy(na,B.evaluateModelTransform(ca.materialParameters,
W,na))},scaleFactor:(ia,ka,na)=>{ka.getFeatureAttribute(na,W);B.evaluateModelTransformScale(ia,ca.materialParameters,W)}}:null},this._context.scheduler);ba.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{X.removeRenderPlugin(ba);ba.destroy()});await X.addRenderPlugin(ba,S);return ba}_getExternalColorParameters(V){const S={};this._drivenProperties.color?S.externalColor=p.ONES:null!=V?.color?S.externalColor=b.toUnitRGBA(V.color):(S.externalColor=p.ONES,S.colorMixMode=
"ignore");return S}destroy(){super.destroy();this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(V=>V());this._disposeResourceHandles.length=0;this._resources=null}createGraphics3DGraphic(V){const S=V.graphic;if(!this._validateGeometry(S.geometry))return null;const X=F.placePointOnGeometry(S.geometry);if(null==X)return this.logger.warn(`unsupported geometry type for icon symbol: ${S.geometry.type}`),null;const ca=this.setGraphicElevationContext(S);return this._createAs3DShape(S,
X,V.renderingInfo,ca,S.uid,V.layer.uid)}notifyDestroyGraphicLayer(V){this._instanceIndexToGraphicUid.delete(V.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null!=this._resources){var V=this._drivenProperties.opacity,S=!this._isPrimitive,X=this._resources.stageResources.materials,ca=this._resources.originalMaterialParameters;for(let ia=0;ia<X.length;ia++){const ka=X[ia];var ba=ca[ia];const na=this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:S})*
ba.opacity;ba=1>na||V||ba.transparent;ka.setParameters({opacity:na,transparent:ba});this._isPrimitive&&ka.setParameters({cullFace:ba?K.CullFaceOptions.None:K.CullFaceOptions.Back})}}}layerElevationInfoChanged(V,S){return this.updateGraphics3DGraphicElevationInfo(V,S,v.needsElevationUpdates3D)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const V of this._resources.stageResources.materials)V.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const {stageResources:V,isWosr:S}=this._resources;for(const X of V.materials)this._isPrimitive?X.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):S||X.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this._hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this._hasLoadedPBRTextures=!0,!1):!0}applyRendererDiff(V,S){if(null==
this._resources)return D.ApplyRendererDiffResult.RecreateSymbol;const {stageResources:{materials:X},lodRenderer:ca,resourceBoundingBox:ba,symbolSize:ia,resourceSize:ka,pivotOffset:na}=this._resources;for(const Y in V.diff)switch(Y){case "visualVariables":if(B.updateFastSymbolUpdatesState(this._fastUpdates,S,this._fastVisualVariableConvertOptions(ba,ia,ka,na))){for(const ea of X)ea.setParameters(this._fastUpdates.materialParameters);ca.notifyShaderTransformationChanged()}else return D.ApplyRendererDiffResult.RecreateSymbol;
break;default:return D.ApplyRendererDiffResult.RecreateSymbol}return D.ApplyRendererDiffResult.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();var V=this._resources.lodResources;const S=q.estimateNumVerticesForLods(V.levels),X=ba=>Array.from(ba.attributes.values()).reduce((ia,ka)=>ia+m.estimateSize(ka.data,ka.indices),0),ca=M.geometriesFromLodResources(V).reduce((ba,ia)=>ba+X(ia),0);V=M.texturesFromLodResources(V).reduce((ba,ia)=>ba+ia.memoryEstimate,0)+ca;
V={...q.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer),resourceBytes:V};return new I.SymbolComplexity({verticesPerFeature:S,memory:V})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(V,S,X,ca,ba,ia){if(!this._hasLodRenderer()||null==this._resources)return null;V=this.getFastUpdateAttrValues(V);var ka=this._context.clippingExtent;u.projectPointToVector(S,Z,this._context.elevationProvider.spatialReference);if(null!=ka&&!w.containsPoint(ka,Z))return null;ka=this._requiresTerrainElevation(ca);
const na=this._computeGlobalTransform(S,ca,R,N),Y=this._computeLocalTransform(this._resources,this.symbolLayer,X,P),ea=this._resources.lodRenderer.instanceData,fa=ea.addInstance();this._instanceIndexToGraphicUid.set(fa,ba);ea.setLocalTransform(fa,Y,!1);ea.setGlobalTransform(fa,na);V&&ea.setFeatureAttribute(fa,V);null==this._fastUpdates&&this._hasPerInstanceColor()&&ea.setColor(fa,z.mixinColorAndOpacity(X.color,X.opacity,255));null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&ea.setObjectAndLayerIdColor(fa,
this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:ba,layerUid:ia}));X=new r.Graphics3DLodInstanceGraphicLayer(this,fa,t.perLodInstanceElevationAligner,ca);ka&&(X.alignedSampledElevation=N.sampledElevation);X.needsElevationUpdates=v.needsElevationUpdates3D(ca.mode);F.extendPointGraphicElevationContext(X,S,this._context.elevationProvider);return X}_computeGlobalTransform(V,S,X,ca){v.evaluateElevationInfoAtPoint(V,this._context.elevationProvider,S,this._context.renderCoordsHelper,
ca);Z[0]=V.x;Z[1]=V.y;Z[2]=ca.z;h.computeTranslationToOriginAndRotation(V.spatialReference,Z,X,this._context.renderCoordsHelper.spatialReference);return X}_computeLocalTransform(V,S,X,ca){f.identity(ca);this._applyObjectRotation(X,!1,ca);this._applyObjectRotation(S,!0,ca);this._applyObjectScale(V,X,ca);this._applyAnchor(V,S,ca);return ca}_applyObjectScale(V,S,X){this._fastUpdates?.requiresShaderTransformation||(V=z.computeObjectScale(this._drivenProperties.size&&S.size?S.size:V.symbolSize,V.symbolSize,
V.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===V[0]&&1===V[1]&&1===V[2]||f.scale(X,X,V))}prepareSymbolLayerPatch(V){if("partial"===V.diff.type){var S=V.diff.diff;this._preparePatchTransform(V,S);this._preparePatchColor(V,S)}}updateGeometry(V,S){if(null==this._resources)return!0;const X=S&&F.placePointOnGeometry(S);if(null==X)return!1;S=this.getGeometryElevationMode(S);if(V.elevationContext.mode!==S)return!1;this._computeGlobalTransform(X,V.elevationContext,R,N);this._requiresTerrainElevation(V.elevationContext)&&
(V.alignedSampledElevation=N.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(V.instanceIndex,R,!0);F.extendPointGraphicElevationContext(V,X,this._context.elevationProvider);return!0}_preparePatchTransform(V,S){if((S.heading||S.tilt||S.roll||S.width||S.height||S.depth||S.anchor||S.anchorPosition)&&null!=this._resources){var X=(da,ma,ua)=>(null!=da&&"complete"===da.type?da.newValue:ma)??ua,ca=X(S.heading,this.symbolLayer.heading,0),ba=X(S.tilt,this.symbolLayer.tilt,0),
ia=X(S.roll,this.symbolLayer.roll,0),ka=X(S.width,this.symbolLayer.width,void 0),na=X(S.height,this.symbolLayer.height,void 0),Y=X(S.depth,this.symbolLayer.depth,void 0),ea=X(S.anchor,this.symbolLayer.anchor,void 0);X=X(S.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete S.heading;delete S.tilt;delete S.roll;delete S.width;delete S.height;delete S.depth;delete S.anchor;delete S.anchorPosition;var fa={heading:ca,tilt:ba,roll:ia,anchor:ea,anchorPosition:X},aa=this._resources;this.loadStatus===
C.LoadStatus.LOADED&&V.symbolLayerStatePatches.push(()=>{aa.symbolSize=e.fromArray(n.objectSymbolLayerSizeWithResourceSize(aa.resourceSize,{width:ka,height:na,depth:Y,isPrimitive:this.symbolLayer.isPrimitive}))});V.graphics3DGraphicPatches.push((da,ma)=>{ma=this._computeLocalTransform(aa,fa,ma,P);aa.lodRenderer.instanceData.setLocalTransform(da.instanceIndex,ma,!0)})}}_preparePatchColor(V,S){if(S.material&&"partial"===S.material.type&&(S=S.material.diff,S.color&&"complete"===S.color.type&&null!=S.color.newValue&&
null!=S.color.oldValue)){var X=S.color.newValue,ca=null!=X?b.toUnitRGBA(X):p.ONES;delete S.color;var ba=this._resources;null!=ba&&V.graphics3DGraphicPatches.push(ia=>{this._hasPerInstanceColor()?(ba.lodRenderer.instanceData.setColor(ia.instanceIndex,ca),ia=this._setMaterialTransparencyParameters({},X)):ia=this._setMaterialTransparencyParameters({externalColor:ca},X);for(const ka of ba.stageResources.materials)ka.setParameters(ia)})}}_requiresTerrainElevation(V){return"absolute-height"!==V.mode}_applyObjectRotation(V,
S,X){if(!this._fastUpdates?.requiresShaderTransformation||!S)return z.computeObjectRotation(V.heading,V.tilt,V.roll,X)}_computeAnchor(V,S,X){const ca=e.create();switch(X.anchor){case "center":l.copy(ca,w.center(V));l.negate(ca,ca);break;case "top":S=w.center(V);l.set(ca,-S[0],-S[1],-V[5]);break;case "bottom":S=w.center(V);l.set(ca,-S[0],-S[1],-V[2]);break;case "relative":S=w.center(V);V=w.size(V);X=(X=X.anchorPosition)?e.fromValues(X.x,X.y,X.z):e.ZEROS;l.multiply(ca,V,X);l.add(ca,ca,S);l.negate(ca,
ca);break;default:null!=S?l.negate(ca,S):l.copy(ca,e.ZEROS)}return ca}_applyAnchor(V,S,X){this._fastUpdates?.requiresShaderTransformation||(V=this._computeAnchor(V.resourceBoundingBox,V.pivotOffset,S))&&f.translate(X,X,V)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(V,S,X,ca){const ba=null!=V?e.fromArray(w.size(V)):e.ONES;V=null!=V?this._computeAnchor(V,ca,this.symbolLayer):e.ZEROS;ca=this._context.renderCoordsHelper.unitInMeters;
X=z.computeObjectScale(null!=S?S:void 0,S,X,ca);const ia=e.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new B.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},ba,S??e.ONES,ca,V,X,ia)}}const Z=e.create(),P=c.create(),R=c.create(),W=p.create(),N=new v.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=U;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p{constructor(q,t,v,r){this.graphics3DSymbolLayer=q;this.instanceIndex=t;this.elevationAligner=v;this.elevationContext=r;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}initialize(){}setVisibility(q){const t=this._lodRenderer.instanceData;q!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,q)}destroy(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),
this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(q,t,v){this.elevationAligner&&(f.setContextFeature(this.elevationContext.featureExpressionInfoContext,v),v=this.elevationAligner(this,this.elevationContext,q.spatialReference,(r,y)=>m.evaluateElevationInfoAtPoint(r,q,this.elevationContext,t,y),t),null!=v&&(this.alignedSampledElevation=v))}getCenterObjectSpace(q=d.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,n);return g.transformMat4(q,
this._lodRenderer.baseBoundingSphere.center,n)}getBoundingBoxObjectSpace(q=k.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,n);const t=this._lodRenderer.baseBoundingBox;k.empty(q);for(let v=0;8>v;++v)g.set(u,0===(v&1)?t[0]:t[3],0===(v&2)?t[1]:t[4],0===(v&4)?t[2]:t[5]),g.transformMat4(u,u,n),k.expandWithVec3(q,u);return q}computeAttachmentOrigin(q){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,n);q.render.origin[0]+=n[12];q.render.origin[1]+=
n[13];q.render.origin[2]+=n[14];q.render.num++}async getProjectedBoundingBox(q,t,v,r,y){y=this.getBoundingBoxObjectSpace(y);var z=x;const D=k.isPoint(y)?1:z.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,n);for(var C=0;C<D;C++){const E=z[C];u[0]=y[E[0]];u[1]=y[E[1]];u[2]=y[E[2]];g.transformMat4(u,u,n);h[3*C]=u[0];h[3*C+1]=u[1];h[3*C+2]=u[2]}if(!q(h,0,D))return null;k.empty(y);q=null;this.calculateRelativeScreenBounds&&(q=this.calculateRelativeScreenBounds());for(z=0;z<
3*D;z+=3){for(C=0;3>C;C++)y[C]=Math.min(y[C],h[z+C]),y[C+3]=Math.max(y[C+3],h[z+C]);q&&v.push({location:h.slice(z,z+3),screenSpaceBoundingRect:q})}if(t&&(k.center(y,w),"absolute-height"!==this.elevationContext.mode)){let E;v=c.demResolutionForBoundingBox(y,t.service.spatialReference,t);try{E=await t.service.queryElevation(w[0],w[1],r,v,"ground")}catch(A){}null!=E&&k.offset(y,0,0,-this.alignedSampledElevation+E)}return y}addObjectState(q,t){q===l.Object3DState.Highlight&&(q=new e.Object3DStateID(q),
this._addHighlightId(q),t.addExternal(v=>{this._removeHighlightId(v)},q))}removeObjectState(q){this._highlights.forEach(t=>q.remove(t))}_addHighlightId(q){this._highlights.add(q);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(q){this._highlights.delete(q);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this._highlights.size)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0],u=d.create(),w=d.create(),x=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],n=b.create();a.Graphics3DLodInstanceGraphicLayer=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b){function g(k,m){const f=k.stageResources.geometries.map(c=>new b.LodComponentResources(c,k.stageResources.textures));m=null==k.lodThreshold||0===
k.lodThreshold&&0<m?d(f):k.lodThreshold;return new b.LodLevelResources(f,m,k.pivotOffset)}function d(k){k=k.reduce((m,{geometry:f})=>m+f.indexCount/3,0);return Math.sqrt(20*k/Math.PI)}a.makeLodResources=function(k){return new b.LodResources(k.map((m,f)=>g(m,f)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../core/devEnvironmentUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../chunks/vec22 ../../../../chunks/vec33 ../../../../chunks/vec43 ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ProcessedObjectResource ./wosrLoader ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K){function L(Q){const O=Q.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return O?{fileType:"gltf",url:O[1],specifiedLodIndex:null!=O[4]?Number(O[4]):null}:Q.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:Q,specifiedLodIndex:null}:{fileType:"unknown",url:Q,specifiedLodIndex:null}}function J(Q,O,U,Z){const P=Q.model,R=[],W=new Map,N=new Map,V=P.lods.length,S=l.empty();P.lods.forEach((X,ca)=>{const ba=!0===Z.skipHighLods&&(1<
V&&0===ca||3<V&&1===ca)||!1===Z.skipHighLods&&null!=Z.singleLodIndex&&ca!==Z.singleLodIndex;if(!ba||0===ca){var ia=new z.ProcessedObjectResource(X.name,X.lodThreshold,[0,0,0]);X.parts.forEach(ka=>{const na=ba?new H.DefaultMaterial({}):M(P,ka,ia,O,U,W,N);var Y=null!=na?na:new H.DefaultMaterial({});const ea=ka.attributes.position.count,fa=v.convertPrimitiveToTriangles(ka.indices||ea,ka.primitiveType);var aa=e.newFloatArray(3*ea);const {typedBuffer:da,typedBufferStride:ma}=ka.attributes.position;h.transformMat4(aa,
da,ka.transform,3,ma);aa=[[I.VertexAttribute.POSITION,new E.Attribute(aa,fa,3,!0)]];if(null!=ka.attributes.normal){var ua=e.newFloatArray(3*ea);const {typedBuffer:Aa,typedBufferStride:qa}=ka.attributes.normal;g.normalFromMat4(T,ka.transform);h.transformMat3(ua,Aa,T,3,qa);aa.push([I.VertexAttribute.NORMAL,new E.Attribute(ua,fa,3,!0)])}if(null!=ka.attributes.tangent){ua=e.newFloatArray(4*ea);const {typedBuffer:Aa,typedBufferStride:qa}=ka.attributes.tangent;g.normalFromMat4(T,ka.transform);u.transformMat3(ua,
Aa,T,4,qa);aa.push([I.VertexAttribute.TANGENT,new E.Attribute(ua,fa,4,!0)])}if(null!=ka.attributes.texCoord0){ua=e.newFloatArray(2*ea);const {typedBuffer:Aa,typedBufferStride:qa}=ka.attributes.texCoord0;w.normalizeIntegerBuffer(ua,Aa,2,qa);aa.push([I.VertexAttribute.UV0,new E.Attribute(ua,fa,2,!0)])}null!=ka.attributes.color&&(ua=new Uint8Array(4*ea),4===ka.attributes.color.elementCount?ka.attributes.color instanceof p.BufferViewVec4f?u.scale(ua,ka.attributes.color,255):ka.attributes.color instanceof
p.BufferViewVec4u8?n.copy(ua,ka.attributes.color):ka.attributes.color instanceof p.BufferViewVec4u16&&u.scale(ua,ka.attributes.color,1/256):(ua.fill(255),ka.attributes.color instanceof p.BufferViewVec3f?h.scale(ua,ka.attributes.color,255,4):ka.attributes.color instanceof p.BufferViewVec3u8?x.copy(ua,ka.attributes.color.typedBuffer,4,ka.attributes.color.typedBufferStride):ka.attributes.color instanceof p.BufferViewVec3u16&&h.scale(ua,ka.attributes.color,1/256,4)),aa.push([I.VertexAttribute.COLOR,new E.Attribute(ua,
fa,4,!0)]));ka={geometry:new F.Geometry(Y,aa),vertexCount:ea};const {geometry:sa,vertexCount:ra}=ka;ka=sa.boundingInfo;null!=ka&&0===ca&&(l.expandWithVec3(S,ka.bbMin),l.expandWithVec3(S,ka.bbMax));null!=na&&(ia.stageResources.geometries.push(sa),ia.numberOfVertices+=ra)});ba||R.push(ia)}});return{engineResources:R,referenceBoundingBox:S}}function M(Q,O,U,Z,P,R,W){const N=O.material+(O.attributes.normal?"_normal":"")+(O.attributes.color?"_color":"")+(O.attributes.texCoord0?"_texCoord0":"")+(O.attributes.tangent?
"_tangent":""),V=Q.materials.get(O.material);var S=null!=O.attributes.texCoord0;const X=null!=O.attributes.normal;if(null==V)return null;a:{switch(V.alphaMode){case "BLEND":var ca=A.AlphaDiscardMode.Blend;break a;case "MASK":ca=A.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:ca=A.AlphaDiscardMode.Opaque;break a}ca=void 0}if(!R.has(N)){if(S){var ba=(da,ma=!1)=>{if(null!=da&&!W.has(da)){const ua=Q.textures.get(da);if(null!=ua){const sa=ua.data;W.set(da,new G.Texture(r.isEncodedMeshTexture(sa)?
sa.data:sa,{...ua.parameters,preMultiplyAlpha:r.isEncodedMeshTexture(sa)?!1:ma,encoding:r.isEncodedMeshTexture(sa)&&null!=sa.encoding?sa.encoding:void 0}))}}};ba(V.textureColor,ca!==A.AlphaDiscardMode.Opaque);ba(V.textureNormal);ba(V.textureOcclusion);ba(V.textureEmissive);ba(V.textureMetallicRoughness)}ba=V.color[0]**(1/B.colorGamma);const ia=V.color[1]**(1/B.colorGamma),ka=V.color[2]**(1/B.colorGamma),na=V.emissiveFactor[0]**(1/B.colorGamma),Y=V.emissiveFactor[1]**(1/B.colorGamma),ea=V.emissiveFactor[2]**
(1/B.colorGamma),fa=null!=V.textureColor&&S?W.get(V.textureColor):null,aa=K.useSchematicPBR({normalTexture:V.textureNormal,metallicRoughnessTexture:V.textureMetallicRoughness,metallicFactor:V.metallicFactor,roughnessFactor:V.roughnessFactor,emissiveTexture:V.textureEmissive,emissiveFactor:V.emissiveFactor,occlusionTexture:V.textureOcclusion});R.set(N,new H.DefaultMaterial({...Z,transparent:ca===A.AlphaDiscardMode.Blend,customDepthTest:A.DepthTestFunction.Lequal,textureAlphaMode:ca,textureAlphaCutoff:V.alphaCutoff,
diffuse:[ba,ia,ka],ambient:[ba,ia,ka],opacity:V.opacity,doubleSided:V.doubleSided,doubleSidedType:"winding-order",cullFace:V.doubleSided?A.CullFaceOptions.None:A.CullFaceOptions.Back,hasVertexColors:!!O.attributes.color,hasVertexTangents:!!O.attributes.tangent,normalType:X?C.NormalType.Attribute:C.NormalType.ScreenDerivative,castShadows:!0,textureId:null!=fa?fa.id:void 0,colorMixMode:V.colorMixMode,normalTextureId:null!=V.textureNormal&&S?W.get(V.textureNormal).id:void 0,textureAlphaPremultiplied:null!=
fa&&!!fa.parameters.preMultiplyAlpha,occlusionTextureId:null!=V.textureOcclusion&&S?W.get(V.textureOcclusion).id:void 0,emissiveTextureId:null!=V.textureEmissive&&S?W.get(V.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=V.textureMetallicRoughness&&S?W.get(V.textureMetallicRoughness).id:void 0,emissiveFactor:[na,Y,ea],mrrFactors:aa?[...K.defaultSchematicMRRFactors]:[V.metallicFactor,V.roughnessFactor,Z.mrrFactors[2]],isSchematic:aa,colorTextureTransformMatrix:y.getTransformMatrix(V.colorTextureTransform),
normalTextureTransformMatrix:y.getTransformMatrix(V.normalTextureTransform),occlusionTextureTransformMatrix:y.getTransformMatrix(V.occlusionTextureTransform),emissiveTextureTransformMatrix:y.getTransformMatrix(V.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:y.getTransformMatrix(V.metallicRoughnessTextureTransform),...P}))}O=R.get(N);U.stageResources.materials.push(O);S&&(S=ia=>{null!=ia&&U.stageResources.textures.push(W.get(ia))},S(V.textureColor),S(V.textureNormal),S(V.textureOcclusion),
S(V.textureEmissive),S(V.textureMetallicRoughness));return O}const T=d.create();a.fetch=async function(Q,O){Q=L(b.adjustStaticAGOUrl(Q));if("wosr"===Q.fileType){Q=await (O.cache?O.cache.loadWOSR(Q.url,O):D.load(Q.url,O));const {engineResources:X,referenceBoundingBox:ca}=D.processLoadResult(Q,O);return{lods:X,referenceBoundingBox:ca,isEsriSymbolResource:!1,isWosr:!0}}const U=await (O.cache?O.cache.loadGLTF(Q.url,O,!!O.usePBR):t.loadGLTF(new q.DefaultLoadingContext(O.streamDataRequester),Q.url,O,O.usePBR)),
Z=U.model.meta?.ESRI_proxyEllipsoid,P=U.meta.isEsriSymbolResource&&null!=Z&&U.meta.uri.includes("/RealisticTrees/");if(P&&!U.customMeta.esriTreeRendering){U.customMeta.esriTreeRendering=!0;a:for(let X=0;X<U.model.lods.length;++X){var R=U.model.lods[X];for(var W of R.parts){R=W.attributes.normal;if(null==R)break a;const ca=W.attributes.position,ba=ca.count,ia=c.create(),ka=c.create(),na=c.create(),Y=new Uint8Array(4*ba),ea=new Float64Array(3*ba),fa=k.invert(m.create(),W.transform);let aa=0,da=0;for(let ma=
0;ma<ba;ma++){ca.getVec(ma,ka);R.getVec(ma,ia);f.transformMat4(ka,ka,W.transform);f.subtract(na,ka,Z.center);f.divide(na,na,Z.radius);const ua=na[2];var N=f.length(na);N=Math.min(.45+.55*N*N,1);f.divide(na,na,Z.radius);null!==fa&&f.transformMat4(na,na,fa);f.normalize(na,na);X+1!==U.model.lods.length&&1<U.model.lods.length&&(-1<ua?f.lerp(na,na,ia,.2):f.lerp(na,na,ia,Math.min(-4*ua-3.8,1)));ea[aa]=na[0];ea[aa+1]=na[1];ea[aa+2]=na[2];aa+=3;Y[da]=255*N;Y[da+1]=255*N;Y[da+2]=255*N;Y[da+3]=255;da+=4}W.attributes.normal=
new p.BufferViewVec3f(ea);W.attributes.color=new p.BufferViewVec4u8(Y)}}}W=!!O.usePBR;W=U.meta.isEsriSymbolResource?{usePBR:W,isSchematic:!1,treeRendering:P,mrrFactors:[...K.defaultEsriSymbologyMRRFactors]}:{usePBR:W,isSchematic:!1,treeRendering:!1,mrrFactors:[...K.defaultAdvancedMRRFactors]};const {engineResources:V,referenceBoundingBox:S}=J(U,W,{...O.materialParameters,treeRendering:P},O.skipHighLods&&null==Q.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:Q.specifiedLodIndex});
return{lods:V,referenceBoundingBox:S,isEsriSymbolResource:U.meta.isEsriSymbolResource,isWosr:!1}};a.gltfToEngineResources=J;a.parseUrl=L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const b=/^devext.arcgis.com$/,g=/^qaext.arcgis.com$/,d=/^[\w-]*\.mapsdevext.arcgis.com$/,k=/^[\w-]*\.mapsqa.arcgis.com$/,m=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,g,/^jsapps.esri.com$/,d,k];a.adjustStaticAGOUrl=function(f,
c){return f?(c=c||globalThis.location.hostname)?null!=c.match(b)||null!=c.match(d)?f.replace("static.arcgis.com","staticdev.arcgis.com"):null!=c.match(g)||null!=c.match(k)?f.replace("static.arcgis.com","staticqa.arcgis.com"):f:f:f};a.devHostnames=m;a.isDevEnvironment=function(f){f=f||globalThis.location.hostname;return m.some(c=>null!=f?.match(c))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],
function(a,b){function g(e,p,h){if(e.count!==p.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var u=e.count,w=h[0],x=h[1],n=h[2],q=h[3],t=h[4],v=h[5],r=h[6],y=h[7],z=h[8],D=h[9],C=h[10],E=h[11],A=h[12],F=h[13],G=h[14];h=h[15];var I=e.typedBuffer;e=e.typedBufferStride;var H=p.typedBuffer;p=p.typedBufferStride;for(let K=0;K<u;K++){const L=K*e;var B=K*p;const J=H[B],M=H[B+1],T=H[B+2];B=H[B+3];I[L]=w*J+t*M+z*T+A*B;I[L+1]=x*J+v*M+D*T+F*B;I[L+2]=
n*J+r*M+C*T+G*B;I[L+3]=q*J+y*M+E*T+h*B}}}function d(e,p,h){k(e.typedBuffer,p.typedBuffer,h,e.typedBufferStride,p.typedBufferStride)}function k(e,p,h,u=4,w=u){if(e.length/u!==p.length/w)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var x=e.length/u,n=h[0],q=h[1],t=h[2],v=h[3],r=h[4],y=h[5],z=h[6],D=h[7];h=h[8];var C=0,E=0;for(let A=0;A<x;A++){const F=p[C],G=p[C+1],I=p[C+2],H=p[C+3];e[E]=n*F+v*G+z*I;e[E+1]=q*F+r*G+D*I;e[E+2]=t*F+y*G+h*I;e[E+3]=H;
C+=w;E+=u}}}function m(e,p){const h=Math.min(e.count,p.count),u=e.typedBuffer;e=e.typedBufferStride;const w=p.typedBuffer;p=p.typedBufferStride;for(let q=0;q<h;q++){const t=q*e;var x=q*p;const v=w[x],r=w[x+1];x=w[x+2];var n=v*v+r*r+x*x;0<n&&(n=1/Math.sqrt(n),u[t]=n*v,u[t+1]=n*r,u[t+2]=n*x)}}function f(e,p,h){c(e.typedBuffer,p,h,e.typedBufferStride)}function c(e,p,h,u=4){const w=Math.min(e.length/u,p.count),x=p.typedBuffer;p=p.typedBufferStride;let n=0,q=0;for(let t=0;t<w;t++)e[q]=h*x[n],e[q+1]=h*
x[n+1],e[q+2]=h*x[n+2],e[q+3]=h*x[n+3],n+=p,q+=u}const l=Object.freeze(Object.defineProperty({__proto__:null,normalize:m,scale:c,scaleView:f,transformMat3:k,transformMat3View:d,transformMat4:g},Symbol.toStringTag,{value:"Module"}));a.normalize=m;a.scale=c;a.scaleView=f;a.transformMat3=k;a.transformMat3View=d;a.transformMat4=g;a.vec4=l})},"esri/chunks/vec22":function(){define(["exports","../core/typedArrayUtil"],function(a,b){function g(f,c){d(f.typedBuffer,c.typedBuffer,f.typedBufferStride,c.typedBufferStride)}
function d(f,c,l=2,e=l){const p=c.length/2;let h=0,u=0;if(b.isArray(c)||b.isFloat(c))for(var w=0;w<p;++w)f[h]=c[u],f[h+1]=c[u+1],h+=l,u+=e;else if(w=b.maximumValue(c),b.isSigned(c))for(var x=0;x<p;++x)f[h]=Math.max(c[u]/w,-1),f[h+1]=Math.max(c[u+1]/w,-1),h+=l,u+=e;else for(x=0;x<p;++x)f[h]=c[u]/w,f[h+1]=c[u+1]/w,h+=l,u+=e}function k(f,c,l,e){const p=f.typedBuffer,h=f.typedBufferStride;f=e?.count??f.count;e=(e?.dstIndex??0)*h;for(let u=0;u<f;++u)p[e]=c,p[e+1]=l,e+=h}const m=Object.freeze(Object.defineProperty({__proto__:null,
fill:k,normalizeIntegerBuffer:d,normalizeIntegerBufferView:g},Symbol.toStringTag,{value:"Module"}));a.fill=k;a.normalizeIntegerBuffer=d;a.normalizeIntegerBufferView=g;a.vec2=m})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(m,f){g(m.typedBuffer,f.typedBuffer,m.typedBufferStride,f.typedBufferStride)}function g(m,f,c=3,l=c){const e=f.length/l;let p=0,h=0;for(let u=0;u<e;++u)m[p]=f[h],m[p+1]=f[h+1],m[p+2]=f[h+2],p+=c,h+=l}function d(m,f,c,l,e){const p=m.typedBuffer,h=m.typedBufferStride;
m=e?.count??m.count;e=(e?.dstIndex??0)*h;for(let u=0;u<m;++u)p[e]=f,p[e+1]=c,p[e+2]=l,e+=h}const k=Object.freeze(Object.defineProperty({__proto__:null,copy:g,copyView:b,fill:d},Symbol.toStringTag,{value:"Module"}));a.copy=g;a.copyView=b;a.fill=d;a.vec3=k})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(m,f){g(m.typedBuffer,f,m.typedBufferStride)}function g(m,f,c=4){const l=f.typedBuffer,e=f.typedBufferStride;f=f.count;let p=0,h=0;for(let u=0;u<f;++u)m[p]=l[h],m[p+1]=l[h+
1],m[p+2]=l[h+2],m[p+3]=l[h+3],p+=c,h+=e}function d(m,f,c,l,e,p){const h=m.typedBuffer,u=m.typedBufferStride;m=p?.count??m.count;p=(p?.dstIndex??0)*u;for(let w=0;w<m;++w)h[p]=f,h[p+1]=c,h[p+2]=l,h[p+3]=e,p+=u}const k=Object.freeze(Object.defineProperty({__proto__:null,copy:g,copyView:b,fill:d},Symbol.toStringTag,{value:"Module"}));a.copy=g;a.copyView=b;a.fill=d;a.vec4=k})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(a,b,g,d,k,m){class f{constructor(l){this._streamDataRequester=l}async loadJSON(l,e){return this._load("json",l,e)}async loadBinary(l,e){return m.isDataProtocol(l)?(k.throwIfAborted(e),m.dataToArrayBuffer(l)):this._load("binary",l,e)}async loadImage(l,e){return this._load("image",l,e)}async _load(l,e,p){if(null==this._streamDataRequester)return(await b(e,{responseType:c[l]})).data;l=await g.result(this._streamDataRequester.request(e,l,p));if(!0===l.ok)return l.value;k.throwIfAbortError(l.error);
throw new d("",`Request for resource failed: ${l.error}`);}}const c={image:"image",binary:"array-buffer",json:"json","image+type":void 0};a.DefaultLoadingContext=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../core/Logger ../../../chunks/mat4f64 ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,g,d,k,m){function f(h){let u=null;h.json.nodes.forEach(w=>{w=w.extras;null!=w&&(w.ESRI_proxyEllipsoid||
w.ESRI_lod)&&(u=w)});return u}async function c(h,u){async function w(v,r){const y=x.nodes[v];v=h.getNodeTransform(v);null!=y.weights&&b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported.");if(null!=y.mesh){const z=x.meshes[y.mesh];for(const D of z.primitives)t.push(u(D,v,r,z.name))}for(const z of y.children||[])t.push(w(z,r))}const x=h.json;var n=x.scenes[x.scene||0].nodes;const q=1<n.length,t=[];for(const v of n)n=x.nodes[v],t.push(w(v,0)),n.extensions?.MSFT_lod&&
Array.isArray(n.extensions.MSFT_lod.ids)&&!q&&n.extensions.MSFT_lod.ids.forEach((r,y)=>w(r,y+1));await Promise.all(t)}function l(h,u,w){const x=q=>{const t=`${w}_tex_${q&&q.id}${q?.name?"_"+q.name:""}`;q&&!h.textures.has(t)&&(q=d.makeTextureSource(q.data,{wrap:{s:q.wrapS,t:q.wrapT},mipmap:p.has(q.minFilter),noUnpackFlip:!0}),h.textures.set(t,q));return t},n=`${w}_mat_${u.id}_${u.name}`;h.materials.has(n)||(u=d.makeMaterialParameters({color:[u.color[0],u.color[1],u.color[2]],opacity:u.color[3],alphaMode:u.alphaMode,
alphaCutoff:u.alphaCutoff,doubleSided:u.doubleSided,colorMixMode:u.ESRI_externalColorMixMode,textureColor:u.colorTexture?x(u.colorTexture):void 0,textureNormal:u.normalTexture?x(u.normalTexture):void 0,textureOcclusion:u.occlusionTexture?x(u.occlusionTexture):void 0,textureEmissive:u.emissiveTexture?x(u.emissiveTexture):void 0,textureMetallicRoughness:u.metallicRoughnessTexture?x(u.metallicRoughnessTexture):void 0,emissiveFactor:[u.emissiveFactor[0],u.emissiveFactor[1],u.emissiveFactor[2]],colorTextureTransform:u.colorTextureTransform,
normalTextureTransform:u.normalTextureTransform,occlusionTextureTransform:u.occlusionTextureTransform,emissiveTextureTransform:u.emissiveTextureTransform,metallicRoughnessTextureTransform:u.metallicRoughnessTextureTransform,metallicFactor:u.metallicFactor,roughnessFactor:u.roughnessFactor}),h.materials.set(n,u));return n}let e=0;const p=new Set([m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,m.TextureSamplingMode.LINEAR_MIPMAP_NEAREST]);a.loadGLTF=async function(h,u,w={},x=!0){const n=await k.GLTFResource.load(h,
u,w),q=`gltf_${e++}`,t={lods:[],materials:new Map,textures:new Map,meta:f(n)};h=!(!n.json.asset.extras||"symbolResource"!==n.json.asset.extras.ESRI_type);const v=new Map;await c(n,async(y,z,D,C)=>{const E=v.get(D)??0;v.set(D,E+1);var A=void 0!==y.mode?y.mode:m.PrimitiveType.TRIANGLES,F=A===m.PrimitiveType.TRIANGLES||A===m.PrimitiveType.TRIANGLE_STRIP||A===m.PrimitiveType.TRIANGLE_FAN?A:null;if(null==F)b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+m.PrimitiveType[A]+
"). Skipping primitive.");else if(n.hasPositions(y)){A=n.getPositionData(y,w);var G=n.getMaterial(y,w,x),I=n.hasNormals(y)?n.getNormalData(y,w):null,H=n.hasTangents(y)?n.getTangentData(y,w):null,B=n.hasTextureCoordinates(y)?n.getTextureCoordinates(y,w):null,K=n.hasVertexColors(y)?n.getVertexColors(y,w):null;y=n.getIndexData(y,w);z={name:C,transform:g.clone(z),attributes:{position:await A,normal:I?await I:null,texCoord0:B?await B:null,color:K?await K:null,tangent:H?await H:null},indices:await y,primitiveType:F,
material:l(t,await G,q)};F=null;null!=t.meta?.ESRI_lod&&"screenSpaceRadius"===t.meta.ESRI_lod.metric&&(F=t.meta.ESRI_lod.thresholds[D]);t.lods[D]=t.lods[D]||{parts:[],name:C,lodThreshold:F};t.lods[D].parts[E]=z}else b.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.")});for(var r of t.lods)r.parts=r.parts.filter(y=>!!y);r=await n.getLoadedBuffersSize();return{model:t,meta:{isEsriSymbolResource:h,uri:n.uri},customMeta:{},size:r}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(g={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,
metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...g}};a.makeTextureSource=function(g,d={}){return{data:g,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,t:b.TextureWrapMode.REPEAT,...d.wrap},noUnpackFlip:!0,mipmap:!1,...d}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ../../../../core/has ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ./resourceUtils ../../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){function y(H){switch(H.componentType){case r.DataType.BYTE:return new h.BufferViewVec2i8(H.raw,H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*H.entryCount);case r.DataType.UNSIGNED_BYTE:return new h.BufferViewVec2u8(H.raw,H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*H.entryCount);case r.DataType.SHORT:return new h.BufferViewVec2i16(H.raw,H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*H.entryCount);case r.DataType.UNSIGNED_SHORT:return new h.BufferViewVec2u16(H.raw,
H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*H.entryCount);case r.DataType.UNSIGNED_INT:return new h.BufferViewVec2u32(H.raw,H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*H.entryCount);case r.DataType.FLOAT:return new h.BufferViewVec2f(H.raw,H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*H.entryCount)}}class z{constructor(H,B,K,L){this._context=H;this.uri=B;this.json=K;this._glbBuffer=L;this._bufferLoaders=new Map;this._textureLoaders=new Map;this._textureCache=new Map;this._materialCache=
new Map;this._nodeParentMap=new Map;this._nodeTransformCache=new Map;this._supportedExtensions=["KHR_texture_basisu"];this._baseUri=t.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();if(null==K.scenes)throw new b("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==K.meshes)throw new b("gltf-loader-unsupported-feature","Meshes must be defined");if(null==K.nodes)throw new b("gltf-loader-unsupported-feature","Nodes must be defined.");
this._computeNodeParents()}static async load(H,B,K){if(m.isDataProtocol(B)){var L=m.dataComponents(B);if(L&&"model/gltf-binary"!==L.mediaType)try{const J=JSON.parse(L.isBase64?atob(L.data):L.data);return new z(H,B,J)}catch{}L=m.dataToArrayBuffer(B);if(z._isGLBData(L))return this._fromGLBData(H,B,L)}if(G.test(B)||"gltf"===K?.expectedType)return K=await H.loadJSON(B,K),new z(H,B,K);L=await H.loadBinary(B,K);if(z._isGLBData(L))return this._fromGLBData(H,B,L);if(I.test(B)||"glb"===K?.expectedType)throw new b("gltf-loader-invalid-glb",
"This is not a valid glb file.");K=await H.loadJSON(B,K);return new z(H,B,K)}static _isGLBData(H){if(null==H)return!1;H=new x.BinaryStreamReader(H);return 4<=H.remainingBytes()&&1179937895===H.readUint32()}static async _fromGLBData(H,B,K){K=await z._parseGLBData(K);return new z(H,B,K.json,K.binaryData)}static async _parseGLBData(H){const B=new x.BinaryStreamReader(H);if(12>B.remainingBytes())throw new b("gltf-loader-error","glb binary data is insufficiently large.");var K=B.readUint32(),L=B.readUint32();
const J=B.readUint32();if(1179937895!==K)throw new b("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(H.byteLength<J)throw new b("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==L)throw new b("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");H=0;let M,T;for(;8<=B.remainingBytes();){K=B.readUint32();L=B.readUint32();if(0===H){if(1313821514!==L)throw new b("gltf-loader-error",
"First glb chunk must be JSON.");if(0>K)throw new b("gltf-loader-error","No JSON data found.");M=await v.jsonFromBinaryData(B.readUint8Array(K))}else if(1===H){if(5130562!==L)throw new b("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");T=B.readUint8Array(K)}else g.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");H+=1}if(!M)throw new b("gltf-loader-error","No glb JSON chunk detected.");return{json:M,binaryData:T}}async getBuffer(H,
B){const K=this.json.buffers[H];if(null==K.uri){if(null==this._glbBuffer)throw new b("gltf-loader-error","glb buffer not present");return this._glbBuffer}H=await this._getBufferLoader(H,B);if(H.byteLength!==K.byteLength)throw new b("gltf-loader-error","Buffer byte lengths should match.");return H}async _getBufferLoader(H,B){const K=this._bufferLoaders.get(H);if(K)return K;B=this._context.loadBinary(this._resolveUri(this.json.buffers[H].uri),B).then(L=>new Uint8Array(L));this._bufferLoaders.set(H,
B);return B}async getAccessor(H,B){if(!this.json.accessors)throw new b("gltf-loader-unsupported-feature","Accessors missing.");H=this.json.accessors[H];if(null==H?.bufferView)throw new b("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(H.type in[n.AttributeType.MAT2,n.AttributeType.MAT3,n.AttributeType.MAT4])throw new b("gltf-loader-unsupported-feature",`AttributeType ${H.type} is not supported`);const K=this.json.bufferViews[H.bufferView];B=await this.getBuffer(K.buffer,
B);const L=A[H.type],J=F[H.componentType],M=L*J,T=K.byteStride||M;return{raw:B.buffer,byteStride:T,byteOffset:B.byteOffset+(K.byteOffset||0)+(H.byteOffset||0),entryCount:H.count,isDenselyPacked:T===M,componentCount:L,componentByteSize:J,componentType:H.componentType,min:H.min,max:H.max,normalized:!!H.normalized}}async getIndexData(H,B){if(null!=H.indices)if(H=await this.getAccessor(H.indices,B),H.isDenselyPacked)switch(H.componentType){case r.DataType.UNSIGNED_BYTE:return new Uint8Array(H.raw,H.byteOffset,
H.entryCount);case r.DataType.UNSIGNED_SHORT:return new Uint16Array(H.raw,H.byteOffset,H.entryCount);case r.DataType.UNSIGNED_INT:return new Uint32Array(H.raw,H.byteOffset,H.entryCount)}else switch(H.componentType){case r.DataType.UNSIGNED_BYTE:return u.makeDense(this._wrapAccessor(h.BufferViewUint8,H));case r.DataType.UNSIGNED_SHORT:return u.makeDense(this._wrapAccessor(h.BufferViewUint16,H));case r.DataType.UNSIGNED_INT:return u.makeDense(this._wrapAccessor(h.BufferViewUint32,H))}}async getPositionData(H,
B){if(null==H.attributes.POSITION)throw new b("gltf-loader-unsupported-feature","No POSITION vertex data found.");H=await this.getAccessor(H.attributes.POSITION,B);if(H.componentType!==r.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+r.DataType[H.componentType]);if(3!==H.componentCount)throw new b("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+H.componentCount.toFixed());
return this._wrapAccessor(h.BufferViewVec3f,H)}async getNormalData(H,B){if(null==H.attributes.NORMAL)throw new b("gltf-loader-error","No NORMAL vertex data found.");H=await this.getAccessor(H.attributes.NORMAL,B);if(H.componentType!==r.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+r.DataType[H.componentType]);if(3!==H.componentCount)throw new b("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+
H.componentCount.toFixed());return this._wrapAccessor(h.BufferViewVec3f,H)}async getTangentData(H,B){if(null==H.attributes.TANGENT)throw new b("gltf-loader-error","No TANGENT vertex data found.");H=await this.getAccessor(H.attributes.TANGENT,B);if(H.componentType!==r.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+r.DataType[H.componentType]);if(4!==H.componentCount)throw new b("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+
H.componentCount.toFixed());return new h.BufferViewVec4f(H.raw,H.byteOffset,H.byteStride,H.byteOffset+H.byteStride*H.entryCount)}async getTextureCoordinates(H,B){if(null==H.attributes.TEXCOORD_0)throw new b("gltf-loader-error","No TEXCOORD_0 vertex data found.");H=await this.getAccessor(H.attributes.TEXCOORD_0,B);if(2!==H.componentCount)throw new b("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+H.componentCount.toFixed());if(H.componentType===r.DataType.FLOAT)return this._wrapAccessor(h.BufferViewVec2f,
H);if(!H.normalized)throw new b("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return y(H)}async getVertexColors(H,B){if(null==H.attributes.COLOR_0)throw new b("gltf-loader-error","No COLOR_0 vertex data found.");H=await this.getAccessor(H.attributes.COLOR_0,B);if(4!==H.componentCount&&3!==H.componentCount)throw new b("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+H.componentCount.toFixed());
if(4===H.componentCount){if(H.componentType===r.DataType.FLOAT)return this._wrapAccessor(h.BufferViewVec4f,H);if(H.componentType===r.DataType.UNSIGNED_BYTE)return this._wrapAccessor(h.BufferViewVec4u8,H);if(H.componentType===r.DataType.UNSIGNED_SHORT)return this._wrapAccessor(h.BufferViewVec4u16,H)}else if(3===H.componentCount){if(H.componentType===r.DataType.FLOAT)return this._wrapAccessor(h.BufferViewVec3f,H);if(H.componentType===r.DataType.UNSIGNED_BYTE)return this._wrapAccessor(h.BufferViewVec3u8,
H);if(H.componentType===r.DataType.UNSIGNED_SHORT)return this._wrapAccessor(h.BufferViewVec3u16,H)}throw new b("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+r.DataType[H.componentType]);}hasPositions(H){return void 0!==H.attributes.POSITION}hasNormals(H){return void 0!==H.attributes.NORMAL}hasVertexColors(H){return void 0!==H.attributes.COLOR_0}hasTextureCoordinates(H){return void 0!==H.attributes.TEXCOORD_0}hasTangents(H){return void 0!==H.attributes.TANGENT}async getMaterial(H,
B,K){var L=H.material?this._materialCache.get(H.material):void 0;if(!L){L=null!=H.material?q.material(this.json.materials[H.material]):q.material();const J=L.pbrMetallicRoughness,M=this.hasVertexColors(H),T=this.getTexture(J.baseColorTexture,B),Q=this.getTexture(L.normalTexture,B),O=K?this.getTexture(L.occlusionTexture,B):void 0,U=K?this.getTexture(L.emissiveTexture,B):void 0;B=K?this.getTexture(J.metallicRoughnessTexture,B):void 0;H=null!=H.material?H.material:-1;L={alphaMode:L.alphaMode,alphaCutoff:L.alphaCutoff,
color:J.baseColorFactor,doubleSided:!!L.doubleSided,colorTexture:await T,normalTexture:await Q,name:L.name,id:H,occlusionTexture:await O,emissiveTexture:await U,emissiveFactor:L.emissiveFactor,metallicFactor:J.metallicFactor,roughnessFactor:J.roughnessFactor,metallicRoughnessTexture:await B,hasVertexColors:M,ESRI_externalColorMixMode:L.extras.ESRI_externalColorMixMode,colorTextureTransform:J?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:L.normalTexture?.extensions?.KHR_texture_transform,
occlusionTextureTransform:L.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:L.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:J?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return L}async getTexture(H,B){if(H){if(0!==(H.texCoord||0))throw new b("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");var K=H.index;H=this.json.textures[K];var L=q.textureSampler(null!=H.sampler?this.json.samplers[H.sampler]:
{}),J=this._getTextureSourceId(H),M=this.json.images[J],T=await this._loadTextureImageData(K,H,B);return d.getOrCreateMapValue(this._textureCache,K,()=>{const Q=U=>33071===U||33648===U||10497===U,O=U=>{throw new b("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${U}`);};return{data:T,wrapS:Q(L.wrapS)?L.wrapS:O(L.wrapS),wrapT:Q(L.wrapT)?L.wrapT:O(L.wrapT),minFilter:L.minFilter,name:M.name,id:K}})}}getNodeTransform(H){if(void 0===H)return D;var B=this._nodeTransformCache.get(H);if(!B){B=this.getNodeTransform(this._getNodeParent(H));
const K=this.json.nodes[H];K.matrix?B=c.multiply(l.create(),B,K.matrix):K.translation||K.rotation||K.scale?(B=l.clone(B),K.translation&&c.translate(B,B,K.translation),K.rotation&&(E[3]=e.getAxisAngle(E,K.rotation),c.rotate(B,B,E[3],E)),K.scale&&c.scale(B,B,K.scale)):B=l.clone(B);this._nodeTransformCache.set(H,B)}return B}_wrapAccessor(H,B){return new H(B.raw,B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*(B.entryCount-1)+B.componentByteSize*B.componentCount)}_resolveUri(H){return m.makeAbsolute(H,
this._baseUri)}_getNodeParent(H){return this._nodeParentMap.get(H)}_checkVersionSupported(){const H=f.Version.parse(this.json.asset.version,"glTF");C.validate(H)}_checkRequiredExtensionsSupported(){const H=this.json;if(H.extensionsRequired&&!H.extensionsRequired.every(B=>this._supportedExtensions.includes(B)))throw new b("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+H.extensionsRequired.join(", "));}_computeNodeParents(){this.json.nodes.forEach((H,
B)=>{H.children&&H.children.forEach(K=>{this._nodeParentMap.set(K,B)})})}async _loadTextureImageData(H,B,K){const L=this._textureLoaders.get(H);if(L)return L;B=this._createTextureLoader(B,K);this._textureLoaders.set(H,B);return B}_getTextureSourceId(H){if(void 0!==H.extensions&&null!==H.extensions.KHR_texture_basisu)return H.extensions.KHR_texture_basisu.source;if(null!==H.source)return H.source;throw new b("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.");
}async _createTextureLoader(H,B){H=this._getTextureSourceId(H);H=this.json.images[H];if(H.uri)return H.uri.endsWith(".ktx2")?(B=await this._context.loadBinary(this._resolveUri(H.uri),B),new v.EncodedMeshTexture(new Uint8Array(B))):this._context.loadImage(this._resolveUri(H.uri),B);if(null==H.bufferView)throw new b("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==H.mimeType)throw new b("gltf-loader-unsupported-feature","Image mimeType must be defined.");const K=this.json.bufferViews[H.bufferView];
B=await this.getBuffer(K.buffer,B);if(null!=K.byteStride)throw new b("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return v.imageFromBinaryData(new Uint8Array(B.buffer,B.byteOffset+(K.byteOffset||0),K.byteLength),H.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const H=await k.allSettledValues(Array.from(this._bufferLoaders.values())),B=await k.allSettledValues(Array.from(this._textureLoaders.values()));return H.reduce((K,
L)=>K+(L?.byteLength??0),0)+B.reduce((K,L)=>K+(L?v.isEncodedMeshTexture(L)?L.data.byteLength:L.width*L.height*4:0),0)}}const D=c.fromXRotation(l.create(),Math.PI/2),C=new f.Version(2,0,"glTF"),E=p.create(),A={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F={[r.DataType.BYTE]:1,[r.DataType.UNSIGNED_BYTE]:1,[r.DataType.SHORT]:2,[r.DataType.UNSIGNED_SHORT]:2,[r.DataType.FLOAT]:4,[r.DataType.INT]:4,[r.DataType.UNSIGNED_INT]:4},G=/\.gltf$/i,I=/\.glb$/i;a.GLTFResource=z;a.transformGltfToEngine=D;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/scalar":function(){define(["exports"],function(a){function b(d,k){const m=d.count;k||(k=new d.TypedArrayConstructor(m));for(let f=0;f<m;f++)k[f]=d.get(f);return k}const g=Object.freeze(Object.defineProperty({__proto__:null,makeDense:b},Symbol.toStringTag,{value:"Module"}));a.makeDense=b;a.scalar=g})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(a){class b{constructor(g){this._data=
g;this._offset4=0;this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const g=this._offset4;this._offset4+=1;return this._dataUint32[g]}readUint8Array(g){const d=4*this._offset4;this._offset4+=g/4;return new Uint8Array(this._data,d,g)}remainingBytes(){return this._data.byteLength-4*this._offset4}}a.BinaryStreamReader=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=
void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils",
"../../../webgl/enums"],function(a,b,g){const d={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},k={pbrMetallicRoughness:d,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},m={ESRI_externalColorMixMode:"tint"},f={magFilter:g.TextureSamplingMode.LINEAR,minFilter:g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,wrapS:g.TextureWrapMode.REPEAT,wrapT:g.TextureWrapMode.REPEAT};a.material=(c={})=>{const l={...d,...c.pbrMetallicRoughness};var e={...m,...c.extras};switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;
default:b.neverReached(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return{...k,...c,pbrMetallicRoughness:l,extras:e}};a.textureSampler=c=>({...f,...c});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(b){let g,d;b.replace(/^(.*\/)?([^/]*)$/,(k,m,f)=>{g=m||"";d=f||"";return""});return{dirPart:g,filePart:d}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/Indices","../../../webgl/enums"],function(a,b,g,d){a.convertPrimitiveToTriangles=function(k,m){switch(m){case d.PrimitiveType.TRIANGLES:return k="number"===typeof k?g.getContinuousIndexArray(k):b.isUint8Array(k)?new Uint16Array(k):k,k;case d.PrimitiveType.TRIANGLE_STRIP:m="number"===typeof k?k:k.length;if(3>m)k=[];else{m-=2;var f=g.newIndexArray(3*m);if("number"===
typeof k){k=0;for(var c=0;c<m;c+=1)0===c%2?(f[k++]=c,f[k++]=c+1):(f[k++]=c+1,f[k++]=c),f[k++]=c+2}else{c=0;for(var l=0;l<m;l+=1)0===l%2?(f[c++]=k[l],f[c++]=k[l+1]):(f[c++]=k[l+1],f[c++]=k[l]),f[c++]=k[l+2]}k=f}return k;case d.PrimitiveType.TRIANGLE_FAN:m="number"===typeof k?k:k.length;if(3>m)k=new Uint16Array(0);else{m-=2;f=65536>=m?new Uint16Array(3*m):new Uint32Array(3*m);if("number"===typeof k)for(k=0,c=0;c<m;++c)f[k++]=0,f[k++]=c+1,f[k++]=c+2;else{c=k[0];l=k[1];var e=0;for(let p=0;p<m;++p){const h=
k[p+2];f[e++]=c;f[e++]=l;l=f[e++]=h}}k=f}return k}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ProcessedObjectResource":function(){define(["exports"],function(a){class b{constructor(){this.geometries=[];this.materials=[];this.textures=[]}}class g{constructor(d,k,m){this.name=d;this.lodThreshold=k;this.pivotOffset=m;this.stageResources=new b;this.numberOfVertices=0}}a.ProcessedObjectResource=g;a.ProcessedObjectStageResources=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/NestedMap ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/Indices ../../../../support/requestImageUtils ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){async function y(B,K){const L=K?.streamDataRequester;if(L)return z(B,L,K);B=await g.result(b(B,K));if(!0===B.ok)return B.value.data;c.throwIfAbortError(B.error);D(B.error)}async function z(B,K,L){B=await g.result(K.request(B,"json",L));if(!0===B.ok)return B.value;c.throwIfAbortError(B.error);D(B.error.details.url)}function D(B){throw new k("",`Request for object resource failed: ${B}`);}function C(B){var K=B.params,L=K.topology;let J=!0;K.vertexAttributes||
(I.warn("Geometry must specify vertex attributes"),J=!1);switch(K.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:L=K.faces;if(!L)I.warn("Indexed geometries must specify faces"),J=!1;else if(K.vertexAttributes)for(const M in K.vertexAttributes)K=L[M],K?.values?(null!=K.valueType&&"UInt32"!==K.valueType&&(I.warn(`Unsupported indexed geometry indices type '${K.valueType}', only UInt32 is currently supported`),J=!1),null!=K.valuesPerElement&&1!==K.valuesPerElement&&(I.warn(`Unsupported indexed geometry values per element '${K.valuesPerElement}', only 1 is currently supported`),
J=!1)):(I.warn(`Indexed geometry does not specify face indices for '${M}' attribute`),J=!1);break;default:I.warn(`Unsupported topology '${L}'`),J=!1}B.params.material||(I.warn("Geometry requires material"),J=!1);B=B.params.vertexAttributes;for(const M in B)B[M].values||(I.warn("Geometries with externally defined attributes are not yet supported"),J=!1);return J}function E(B){const K=p.empty();B.forEach(L=>{L=L.boundingInfo;null!=L&&(p.expandWithVec3(K,L.bbMin),p.expandWithVec3(K,L.bbMax))});return K}
async function A(B,K){const L=[];for(const T in B){var J=B[T],M=J.images[0].data;if(!M){I.warn("Externally referenced texture data is not yet supported");continue}M=J.encoding+";base64,"+M;const Q="/textureDefinitions/"+T,O="rgba"===J.channels?J.alphaChannelUsage||"transparency":"none",U={noUnpackFlip:!0,wrap:{s:r.TextureWrapMode.REPEAT,t:r.TextureWrapMode.REPEAT},preMultiplyAlpha:F(O)!==x.AlphaDiscardMode.Opaque};J=null!=K&&K.disableTextures?Promise.resolve(null):u.requestImage(M,K);L.push(J.then(Z=>
({refId:Q,image:Z,parameters:U,alphaChannelUsage:O})))}B=await Promise.all(L);K={};for(const T of B)K[T.refId]=T;return K}function F(B){switch(B){case "mask":return x.AlphaDiscardMode.Mask;case "maskAndTransparency":return x.AlphaDiscardMode.MaskBlend;case "none":return x.AlphaDiscardMode.Opaque;case "transparency":return x.AlphaDiscardMode.Blend;default:return x.AlphaDiscardMode.Blend}}function G(B){B=B.params;return{id:1,material:B.material,texture:B.texture,region:B.texture}}const I=m.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
H=new l.Version(1,2,"wosr");a.createTextureResources=A;a.load=async function(B,K){B=await y(B,K);K=await A(B.textureDefinitions??{},K);let L=0;for(const J in K)if(K.hasOwnProperty(J)){const M=K[J];L+=M?.image?M.image.width*M.image.height*4:0}return{resource:B,textures:K,size:L+d.estimateNestedObjectSize(B)}};a.processLoadResult=function(B,K){const L=[],J=[],M=[],T=new f.NestedMap,Q=B.resource;var O=l.Version.parse(Q.version||"1.0","wosr");H.validate(O);O=Q.model.name;const U=Q.model.geometries,Z=
Q.materialDefinitions??{};B=B.textures;let P=0;const R=new Map;for(let ia=0;ia<U.length;ia++){const ka=U[ia];if(!C(ka))continue;var W=G(ka),N=ka.params.vertexAttributes;const na=[];var V=Y=>{if("PerAttributeArray"===ka.params.topology)return null;const ea=ka.params.faces;for(const fa in ea)if(fa===Y)return ea[fa].values;return null},S=N[t.VertexAttribute.POSITION];S=S.values.length/S.valuesPerElement;for(const Y in N){var X=N[Y],ca=X.values,ba=V(Y)??h.getContinuousIndexArray(S);na.push([Y,new w.Attribute(ca,
ba,X.valuesPerElement,!0)])}N=W.texture;if((V=B&&B[N])&&!R.has(N)){const {image:Y,parameters:ea}=V;S=new q.Texture(Y,ea);J.push(S);R.set(N,S)}S=(S=R.get(N))?S.id:void 0;W=W.material;X=T.get(W,N);null==X&&(X=W.substring(W.lastIndexOf("/")+1),X=Z[X].params,1===X.transparency&&(X.transparency=0),ca=V&&V.alphaChannelUsage,ca=0<X.transparency||"transparency"===ca||"maskAndTransparency"===ca,ba=V?F(V.alphaChannelUsage):void 0,V={ambient:e.fromArray(X.diffuse),diffuse:e.fromArray(X.diffuse),opacity:1-(X.transparency||
0),transparent:ca,textureAlphaMode:ba,textureAlphaCutoff:.33,textureId:S,initTextureTransparent:!0,doubleSided:!0,cullFace:x.CullFaceOptions.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:V?.parameters.preMultiplyAlpha??!1},K?.materialParameters&&Object.assign(V,K.materialParameters),X=new v.DefaultMaterial(V),T.set(W,N,X));M.push(X);N=new n.Geometry(X,na);P+=na.find(Y=>Y[0]===t.VertexAttribute.POSITION)?.[1]?.indices.length??0;L.push(N)}return{engineResources:[{name:O,
stageResources:{textures:J,materials:M,geometries:L},pivotOffset:Q.model.pivotOffset,numberOfVertices:P,lodThreshold:null}],referenceBoundingBox:E(L)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],function(a){a.colorGamma=2.1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/webStyleUtils":function(){define(["exports","../../../../core/Error",
"../../../../symbols/support/styleUtils","../../../../symbols/support/webStyleSymbolUtils"],function(a,b,g,d){a.getResourceUrlFromSymbolStyle=async function(k){if(null===k||null==k.styleName&&null==k.styleUrl)return null;var m=k.name;if(null==m)throw new b("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const f={portal:k.portal};k=await g.fetchStyle(k,f).catch(()=>null);if(null===k)return null;const c=d.getStyleItemFromStyle(m,k.data);if(c&&!c.formatInfos?.some(l=>
"gltf_basisu"===l.type))return null;m=await d.fetchSymbolFromStyle(k,m,f,"webRef",(l,e)=>g.symbolUrlFromStyleItem(l,e,["gltf_basisu","gltf"])).catch(()=>null);if(null===m||"point-3d"!==m.type)return null;m=m.symbolLayers.items[0];return"object"===m.type?m.resource:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define("exports ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/urlUtils ../../portal/Portal ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./styleUtils ./Thumbnail".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(x,n){return n.items.find(q=>q.name===x)}function u(x,n,q,t,v,r){const y=null!=q?.portal?q.portal:m.getDefault(),z={portal:y,url:k.urlToObject(x.baseUrl),origin:"portal-item"},D=h(n,x.data);if(!D)return Promise.reject(new d("symbolstyleutils:symbol-name-not-found",`The symbol name '${n}' could not be found`,{symbolName:n}));v=f.fromJSON(v(D,t),z);let C=D.thumbnail?.href??null;const E=D.thumbnail?.imageData;g.isDevEnvironment()&&(v=g.adjustStaticAGOUrl(v)??
"",C=g.adjustStaticAGOUrl(C));const A={portal:y,url:k.urlToObject(k.removeFile(v)),origin:"portal-item"};return e.requestJSON(v,r).then(F=>{F="cimRef"===t?e.makeCIMSymbolRef(F.data):F.data;if((F=c.fromJSON(F,A))&&b.isSymbol3D(F)){if(C){const G=f.fromJSON(C,z);F.thumbnail=new p.Thumbnail({url:G})}else E&&(F.thumbnail=new p.Thumbnail({url:`data:image/png;base64,${E}`}));x.styleUrl?F.styleOrigin=new l({portal:q.portal,styleUrl:x.styleUrl,name:n}):x.styleName&&(F.styleOrigin=new l({portal:q.portal,styleName:x.styleName,
name:n}))}return F})}function w(x,n,q){const t=e.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,x),v=null!=n.portal?n.portal:m.getDefault();return e.requestJSON(t,q).then(r=>{r=e.makeCIMSymbolRef(r.data);return c.fromJSON(r,{portal:v,url:k.urlToObject(k.removeFile(t)),origin:"portal-item"})})}a.fetchSymbolFromStyle=u;a.getStyleItemFromStyle=h;a.resolveWebStyleSymbol=function(x,n,q,t){const v=x.name;return null==v?Promise.reject(new d("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):
x.styleName&&"Esri2DPointSymbolsStyle"===x.styleName?w(v,n,t):e.fetchStyle(x,n,t).then(r=>u(r,v,n,q,e.symbolUrlFromStyleItem,t))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ../VertexAttribute ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../support/Scheduler ../../../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M){function T(S,X,ca){const ba=S.allocateHead();S=S.view;K.encodeDoubleVec3(X.modelOrigin,ca,S.modelOriginHi,S.modelOriginLo,ba);S.model.copyFrom(ba,X.model,ca);S.modelNormal.copyFrom(ba,X.modelNormal,ca);X.color&&S.color&&S.color.copyFrom(ba,X.color,ca);X.objectAndLayerIdColor&&S.objectAndLayerIdColor&&S.objectAndLayerIdColor.copyFrom(ba,X.objectAndLayerIdColor,ca);X.featureAttribute&&S.featureAttribute&&S.featureAttribute.copyFrom(ba,
X.featureAttribute,ca)}function Q(S){let X=n.newLayout().vec3f(E.VertexAttribute.INSTANCEMODELORIGINHI).vec3f(E.VertexAttribute.INSTANCEMODELORIGINLO).mat3f(E.VertexAttribute.INSTANCEMODEL).mat3f(E.VertexAttribute.INSTANCEMODELNORMAL);null!=S&&S.includes("featureAttribute")&&(X=X.vec4f(E.VertexAttribute.INSTANCEFEATUREATTRIBUTE));null!=S&&S.includes("color")&&(X=X.vec4u8(E.VertexAttribute.INSTANCECOLOR));null!=S&&S.includes("objectAndLayerIdColor")&&(X=X.vec4u8(E.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR));
return X}const O=S=>{const X=S.baseBoundingSphere.radius;S=S.levels.map(ca=>ca.minScreenSpaceRadius);return new G.LevelSelector(X,S)};a.LodRenderer=class extends t.ASyncPreparesRenderPlugin{constructor(S,X){super(S);this.type=y.IntersectorType.LOD;this.isGround=!1;this._levels=[];this._defaultRenderInstanceData=[[]];this._highlightRenderInstanceData=[[]];this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]];this._cycleStartIndex=this._instanceIndex=
0;this._slicePlane=!1;this._camera=new v.Camera;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.produces=new Map([[D.RenderSlot.OPAQUE_MATERIAL,ca=>this._produces(ca)],[D.RenderSlot.TRANSPARENT_MATERIAL,ca=>this._hasTransparentLevels()?this._produces(ca):!1]]);this._instanceData=new A.InstanceData({shaderTransformation:S.shaderTransformation},S.optionalFields);this.addHandles(X.registerTask(J.TaskPriority.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=Q(this.optionalFields);
this._glInstanceBufferLayout=x.glLayout(this._instanceBufferLayout,1);this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:S})=>{this._requestUpdateCycle();this.metadata.notifyGraphicGeometryChanged(S)}),this._instanceData.events.on("instance-visibility-changed",({index:S})=>{this._requestUpdateCycle(!0);this.metadata.notifyGraphicVisibilityChanged(S)}),this._instanceData.events.on("instance-highlight-changed",
()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return 1<this.symbol.levels.length}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(S){this._slicePlane=S}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((S,
X)=>X.reduce((ca,ba)=>ca+ba.usedMemory,S),0)}get renderStats(){const S=this._instanceData.size,X=[];this._levels.forEach((ca,ba)=>{ba=this._allRenderInstanceData[0][ba].size+this._allRenderInstanceData[1][ba].size;ca=ca.triangleCount;X.push({renderedInstances:ba,renderedTriangles:ba*ca,trianglesPerInstance:ca})});return{totalInstances:S,renderedInstances:X.reduce((ca,ba)=>ca+ba.renderedInstances,0),renderedTriangles:X.reduce((ca,ba)=>ca+ba.renderedTriangles,0),levels:X}}async initializeRenderContext(S,
X){this._context=S;const ca=S.renderContext.rctx,ba=await Promise.allSettled(this.symbol.levels.map(ka=>{this._defaultRenderInstanceData[0].push(new H.RenderInstanceData(ca,this._instanceBufferLayout));this._highlightRenderInstanceData[0].push(new H.RenderInstanceData(ca,this._instanceBufferLayout));return I.LodLevel.create(S,ka,X)})),ia=ba.map(ka=>"fulfilled"===ka.status?ka.value:null).filter(g.isSome);if(k.isAborted(X)||ia.length!==ba.length){ia.forEach(ka=>ka.destroy());k.throwIfAborted(X);for(const ka of ba)if("rejected"===
ka.status)throw ka.reason;}this._levels=ia;this._levelSelector=O(this)}uninitializeRenderContext(){this._invalidateOctree();this._levels.forEach(S=>S.destroy());this._defaultRenderInstanceData[0].forEach(S=>S.destroy());this._highlightRenderInstanceData[0].forEach(S=>S.destroy())}_hasTransparentLevels(){return this._levels.some(S=>S.components.some(X=>X.material.produces(D.RenderSlot.TRANSPARENT_MATERIAL,q.ShaderOutput.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(S=>0<
S.size)}_produces(S){return S!==q.ShaderOutput.Highlight&&S!==q.ShaderOutput.ShadowHighlight||this.hasHighlights()}prepareRender(S){if(!w.debugFlags.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const X=S.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(S.bindParameters.contentCamera);X||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(J.noBudget),this._needFullCycle=!1)}}prepareTechniques(S){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(S.output))return null;
const X=this._getInstanceDatas(S.output);if(!X)return null;const ca=[];X.forEach(ba=>this.levels.forEach((ia,ka)=>{ia.components.forEach(na=>ca.push(this._beginComponent(S,ba[ka],na)))}));return ca}renderNode(S,X){const ca=this._getInstanceDatas(S.output);if(ca&&null!=X){var ba=0;S.rctx.bindVAO();ca.forEach(ia=>this.levels.forEach((ka,na)=>{ka.components.forEach(Y=>this._renderComponent(S,X[ba++],ia[na],Y,na))}))}}_getInstanceDatas(S){const X=S!==q.ShaderOutput.Highlight&&S!==q.ShaderOutput.ShadowHighlight;
S=S!==q.ShaderOutput.ShadowExcludeHighlight;return X&&S?this._allRenderInstanceData:X?this._defaultRenderInstanceData:S?this._highlightRenderInstanceData:null}intersect(S,X,ca,ba){if(this.baseMaterial.isVisible()&&null!=this._octree){var ia=h.create();p.subtract(ia,ba,ca);var ka=na=>{this._instanceData.getCombinedModelTransform(na,P);S.transform.set(P);p.transformMat4(R,ca,S.transform.inverse);p.transformMat4(W,ba,S.transform.inverse);const Y=this._instanceData.getState(na),ea=this._instanceData.getLodLevel(na),
fa=this._levels.length;C.assert(0!==(Y&A.StateFlags.ACTIVE),"invalid instance state");C.assert(0<=ea&&ea<fa,"invaid lod level");this._levels[ea].intersect(S,X,R,W,na,this.metadata,fa)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(ka):this._octree.forEachAlongRay(ca,ia,ka)}}notifyShaderTransformationChanged(){this._invalidateOctree();this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const S=this._instanceData,X=S.view?.state;if(!X)return null;this._octreeCached=
new F.InstanceOctree(S,this.baseBoundingSphere);for(let ca=0;ca<S.capacity;++ca)X.get(ca)&A.StateFlags.ACTIVE&&this._octreeCached.addInstance(ca)}return this._octreeCached}_invalidateOctree(){this._octreeCached=d.destroyMaybe(this._octreeCached)}queryDepthRange(S){if(null==this._octree)return{near:Infinity,far:-Infinity};var X=S.viewForward,ca=this._octree.findClosest(X,z.DepthOrder.FRONT_TO_BACK,S.frustum);const ba=this._octree.findClosest(X,z.DepthOrder.BACK_TO_FRONT,S.frustum);if(null==ca||null==
ba)return{near:Infinity,far:-Infinity};const ia=S.eye,ka=this._instanceData.view;ka.boundingSphere.getVec(ca,Z);p.subtract(Z,Z,ia);ca=p.dot(Z,X)-Z[3];ka.boundingSphere.getVec(ba,Z);p.subtract(Z,Z,ia);X=p.dot(Z,X)+Z[3];return{near:Math.max(S.near,ca),far:Math.min(S.far,X)}}_requestUpdateCycle(S=!1){this._updateCyclesWithStaticCamera=-1;this._cycleStartIndex=this._instanceIndex;S&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++;this._allRenderInstanceData.forEach(S=>
S.forEach(X=>X.startUpdateCycle()))}get running(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}runTask(S){const {_enableLevelSelection:X,_camera:ca,_levelSelector:ba}=this;this._allRenderInstanceData.forEach(ma=>ma.forEach(ua=>ua.beginUpdate()));const ia=this._instanceData,ka=ia.view;let na=ia.size;const Y=ia.capacity;let ea=this._instanceIndex;const fa=Math.ceil(Y/500);for(let ma=0;ma<na&&!S.done;++ma){ea===this._cycleStartIndex&&this._startUpdateCycle();const ua=ka.state.get(ea);
var aa=0;if(ua&A.StateFlags.ALLOCATED){var da=ka.lodLevel.get(ea);ua&A.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][da].freeTail();ua&A.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][da].freeTail();ua&A.StateFlags.REMOVE?ia.freeInstance(ea):ua&A.StateFlags.VISIBLE?(da=0,X&&(ka.modelOrigin.getVec(ea,U),da=ba.selectLevel(U,ia.getCombinedMedianScaleFactor(ea),ca)),aa=ua&~(A.StateFlags.ACTIVE|A.StateFlags.TRANSFORM_CHANGED),0<=da&&(ua&A.StateFlags.HIGHLIGHT?(T(this._highlightRenderInstanceData[0][da],
ka,ea),aa|=A.StateFlags.HIGHLIGHT_ACTIVE):(T(this._defaultRenderInstanceData[0][da],ka,ea),aa|=A.StateFlags.DEFAULT_ACTIVE)),ka.state.set(ea,aa),ka.lodLevel.set(ea,da)):(aa=ua&~(A.StateFlags.ACTIVE|A.StateFlags.TRANSFORM_CHANGED),ka.state.set(ea,aa));null!=this._octreeCached&&(da=!!(ua&A.StateFlags.ACTIVE),aa=!!(aa&A.StateFlags.ACTIVE),!da&&aa?this._octreeCached.addInstance(ea):da&&!aa?this._octreeCached.removeInstance(ea):da&&aa&&ua&A.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(ea),
this._octreeCached.addInstance(ea)));ea=ea+1===Y?0:ea+1;0===ea%fa&&S.madeProgress()}else ea=ea+1===Y?0:ea+1,na++}this._instanceIndex=ea;this._allRenderInstanceData.forEach(ma=>ma.forEach(ua=>ua.endUpdate()));this._context.requestRender()}_beginComponent(S,X,ca){if(0===X.size)return null;X=ca.glMaterials.load(S.rctx,S.bindParameters.slot,S.output);return null!=X?X.beginSlot(S.bindParameters):null}_renderComponent(S,X,ca,ba,ia){if(X){var {bindParameters:ka,rctx:na}=S;na.runAppleAmdDriverHelper();var Y=
na.bindTechnique(X,ba.material.parameters,ka);na.bindVAO(ba.vao);X.ensureAttributeLocations(ba.vao);Y.bindDraw(V,ka,ba.material.parameters);w.debugFlags.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&S.output===q.ShaderOutput.Color&&(Y.setUniform4fv("externalColor",N[Math.min(ia,N.length-1)]),Y.setUniform1i("colorMixMode",B.colorMixModes.replace));S=ca.capacity;ia=ca.headIndex;Y=ca.tailIndex;var ea=ca.firstIndex,fa=this._glInstanceBufferLayout,aa=(da,ma)=>{M.bindVertexBufferLayout(na,r.Default3D,ca.buffer,
fa,da);na.drawArraysInstanced(X.primitiveType,0,ba.vertexCount,ma-da);M.unbindVertexBufferLayout(na,r.Default3D,ca.buffer,fa)};ba.material.parameters.transparent&&null!=ea?ia>Y?(C.assert(ea>=Y&&ea<=ia,"invalid firstIndex"),aa(ea,ia),aa(Y,ea)):ia<Y&&(ea<=ia?(C.assert(0<=ea&&ea<=ia,"invalid firstIndex"),aa(ea,ia),aa(Y,S),aa(0,ea)):(C.assert(ea>=Y&&ea<=S,"invalid firstIndex"),aa(ea,S),aa(0,ia),aa(Y,ea))):ia>Y?aa(Y,ia):ia<Y&&(aa(0,ia),aa(Y,S));na.bindVAO(null)}}};b.__decorate([m.property({constructOnly:!0})],
a.LodRenderer.prototype,"symbol",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"optionalFields",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"metadata",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"shaderTransformation",void 0);b.__decorate([m.property()],a.LodRenderer.prototype,"_instanceData",void 0);b.__decorate([m.property()],a.LodRenderer.prototype,"_cycleStartIndex",void 0);b.__decorate([m.property({readOnly:!0})],
a.LodRenderer.prototype,"_enableLevelSelection",null);b.__decorate([m.property()],a.LodRenderer.prototype,"_updateCyclesWithStaticCamera",void 0);b.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,"running",null);a.LodRenderer=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],a.LodRenderer);const U=h.create(),Z=u.create(),P=e.create(),R=h.create(),W=h.create(),N=[u.fromValues(1,0,1,1),u.fromValues(0,0,1,1),u.fromValues(0,1,0,1),u.fromValues(1,1,0,1),
u.fromValues(1,0,0,1)],V=new L.DefaultMaterialDrawParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Evented ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute ./RenderInstanceData".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y){a.StateFlags=void 0;(function(F){F[F.ALLOCATED=1]="ALLOCATED";F[F.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";F[F.VISIBLE=4]="VISIBLE";F[F.HIGHLIGHT=8]="HIGHLIGHT";F[F.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";F[F.REMOVE=32]="REMOVE";F[F.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";F[F.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));class z{constructor(F){this.localTransform=F.getField(r.VertexAttribute.LOCALTRANSFORM,n.BufferViewMat4f64);this.globalTransform=
F.getField(r.VertexAttribute.GLOBALTRANSFORM,n.BufferViewMat4f64);this.modelOrigin=F.getField(r.VertexAttribute.MODELORIGIN,n.BufferViewVec3f64);this.model=F.getField(r.VertexAttribute.INSTANCEMODEL,n.BufferViewMat3f);this.modelNormal=F.getField(r.VertexAttribute.INSTANCEMODELNORMAL,n.BufferViewMat3f);this.modelScaleFactors=F.getField(r.VertexAttribute.MODELSCALEFACTORS,n.BufferViewVec2f);this.boundingSphere=F.getField(r.VertexAttribute.BOUNDINGSPHERE,n.BufferViewVec4f64);this.featureAttribute=F.getField(r.VertexAttribute.FEATUREATTRIBUTE,
n.BufferViewVec4f);this.color=F.getField(r.VertexAttribute.COLOR,n.BufferViewVec4u8);this.objectAndLayerIdColor=F.getField(r.VertexAttribute.OBJECTANDLAYERIDCOLOR,n.BufferViewVec4u8);this.state=F.getField(r.VertexAttribute.STATE,n.BufferViewUint8);this.lodLevel=F.getField(r.VertexAttribute.LODLEVEL,n.BufferViewUint8)}}a.InstanceData=class extends g{constructor(F,G){super(F);this.events=new k;this._next=this._size=this._capacity=0;F=t.newLayout().mat4f64(r.VertexAttribute.LOCALTRANSFORM).mat4f64(r.VertexAttribute.GLOBALTRANSFORM).vec4f64(r.VertexAttribute.BOUNDINGSPHERE).vec3f64(r.VertexAttribute.MODELORIGIN).mat3f(r.VertexAttribute.INSTANCEMODEL).mat3f(r.VertexAttribute.INSTANCEMODELNORMAL).vec2f(r.VertexAttribute.MODELSCALEFACTORS);
G.includes(r.VertexAttribute.FEATUREATTRIBUTE)&&(F=F.vec4f(r.VertexAttribute.FEATUREATTRIBUTE));G.includes(r.VertexAttribute.COLOR)&&(F=F.vec4u8(r.VertexAttribute.COLOR));G.includes(r.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&(F=F.vec4u8(r.VertexAttribute.OBJECTANDLAYERIDCOLOR));this._layout=F=F.u8(r.VertexAttribute.STATE).u8(r.VertexAttribute.LODLEVEL);this._capacity=y.initialCapacity;this._buffer=this._layout.createBuffer(this._capacity);this._view=new z(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+
1>this._capacity&&this._grow();const F=this._findSlot();this._view.state.set(F,a.StateFlags.ALLOCATED);this._size++;this.events.emit("instances-changed");return F}removeInstance(F){const G=this._view.state;v.assert(0<=F&&F<this._capacity&&0!==(G.get(F)&a.StateFlags.ALLOCATED),"invalid instance handle");this._getStateFlag(F,a.StateFlags.ACTIVE)?this._setStateFlags(F,a.StateFlags.REMOVE):this.freeInstance(F);this.events.emit("instances-changed")}freeInstance(F){const G=this._view.state;v.assert(0<=
F&&F<this._capacity&&0!==(G.get(F)&a.StateFlags.ALLOCATED),"invalid instance handle");G.set(F,0);this._size--}setLocalTransform(F,G,I=!0){this._view.localTransform.setMat(F,G);I&&this.updateModelTransform(F)}getLocalTransform(F,G){this._view.localTransform.getMat(F,G)}setGlobalTransform(F,G,I=!0){this._view.globalTransform.setMat(F,G);I&&this.updateModelTransform(F)}getGlobalTransform(F,G){this._view.globalTransform.getMat(F,G)}updateModelTransform(F){const G=this._view;var I=D;const H=C;G.localTransform.getMat(F,
E);G.globalTransform.getMat(F,A);const B=h.multiply(A,A,E);w.set(I,B[12],B[13],B[14]);G.modelOrigin.setVec(F,I);e.fromMat4(H,B);G.model.setMat(F,H);I=q.scaleFromMatrix(D,B);I.sort();G.modelScaleFactors.set(F,0,I[1]);G.modelScaleFactors.set(F,1,I[2]);e.invert(H,H);e.transpose(H,H);G.modelNormal.setMat(F,H);this._setStateFlags(F,a.StateFlags.TRANSFORM_CHANGED);this.events.emit("instance-transform-changed",{index:F})}getModelTransform(F,G){const I=this._view;I.model.getMat(F,C);I.modelOrigin.getVec(F,
D);G[0]=C[0];G[1]=C[1];G[2]=C[2];G[3]=0;G[4]=C[3];G[5]=C[4];G[6]=C[5];G[7]=0;G[8]=C[6];G[9]=C[7];G[10]=C[8];G[11]=0;G[12]=D[0];G[13]=D[1];G[14]=D[2];G[15]=1}applyShaderTransformation(F,G){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,F,G)}getCombinedModelTransform(F,G){this.getModelTransform(F,G);null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,F,G);return G}getCombinedLocalTransform(F,G){this._view.localTransform.getMat(F,G);null!=this.shaderTransformation&&
this.shaderTransformation.applyTransform(this,F,G)}getCombinedMaxScaleFactor(F){let G=this._view.modelScaleFactors.get(F,1);null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(D,this,F),G*=Math.max(D[0],D[1],D[2]));return G}getCombinedMedianScaleFactor(F){let G=this._view.modelScaleFactors.get(F,0);if(null!=this.shaderTransformation){this.shaderTransformation.scaleFactor(D,this,F);F=D[0];var I=D[1];G*=Math.max(Math.min(F,I),Math.min(Math.max(F,I),D[2]))}return G}getModel(F,G){this._view.model.getMat(F,
G)}setFeatureAttribute(F,G){this._view.featureAttribute.setVec(F,G)}getFeatureAttribute(F,G){this._view.featureAttribute.getVec(F,G)}setColor(F,G){this._view.color.setVec(F,G)}setObjectAndLayerIdColor(F,G){this._view.objectAndLayerIdColor.setVec(F,G)}setVisible(F,G){G!==this.getVisible(F)&&(this._setStateFlag(F,a.StateFlags.VISIBLE,G),this.events.emit("instance-visibility-changed",{index:F}))}getVisible(F){return this._getStateFlag(F,a.StateFlags.VISIBLE)}setHighlight(F,G){G!==this.getHighlight(F)&&
(this._setStateFlag(F,a.StateFlags.HIGHLIGHT,G),this.events.emit("instance-highlight-changed"))}getHighlight(F){return this._getStateFlag(F,a.StateFlags.HIGHLIGHT)}getState(F){return this._view.state.get(F)}getLodLevel(F){return this._view.lodLevel.get(F)}countFlags(F){let G=0;for(let I=0;I<this._capacity;++I)this.getState(I)&F&&++G;return G}_setStateFlags(F,G){const I=this._view.state;G|=I.get(F);I.set(F,G)}_clearStateFlags(F,G){const I=this._view.state;G=I.get(F)&~G;I.set(F,G)}_setStateFlag(F,G,
I){I?this._setStateFlags(F,G):this._clearStateFlags(F,G)}_getStateFlag(F,G){return!!(this._view.state.get(F)&G)}_grow(){this._capacity=Math.max(y.initialCapacity,Math.floor(this._capacity*d.ReallocGrowthFactor));this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer);this._view=new z(this._buffer)}_findSlot(){const F=this._view.state;let G=this._next;for(;F.get(G)&a.StateFlags.ALLOCATED;)G=G+1===this._capacity?0:G+1;this._next=G+1===this._capacity?0:G+1;return G}};b.__decorate([m.property({constructOnly:!0})],
a.InstanceData.prototype,"shaderTransformation",void 0);b.__decorate([m.property()],a.InstanceData.prototype,"_size",void 0);b.__decorate([m.property({readOnly:!0})],a.InstanceData.prototype,"size",null);a.InstanceData=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],a.InstanceData);const D=x.create(),C=p.create(),E=u.create(),A=u.create();a.InstanceDataView=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../core/arrayUtils ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,g,d,k,m){class f{constructor(l){this.modelOriginHi=l.getField(k.VertexAttribute.INSTANCEMODELORIGINHI,g.BufferViewVec3f);this.modelOriginLo=l.getField(k.VertexAttribute.INSTANCEMODELORIGINLO,g.BufferViewVec3f);this.model=l.getField(k.VertexAttribute.INSTANCEMODEL,g.BufferViewMat3f);this.modelNormal=l.getField(k.VertexAttribute.INSTANCEMODELNORMAL,g.BufferViewMat3f);this.featureAttribute=l.getField(k.VertexAttribute.INSTANCEFEATUREATTRIBUTE,g.BufferViewVec4f);this.color=l.getField(k.VertexAttribute.INSTANCECOLOR,
g.BufferViewVec4u8);this.objectAndLayerIdColor=l.getField(k.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,g.BufferViewVec4u8)}}class c{constructor(l,e){this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=l;this._instanceBufferLayout=e;this._elementSize=e.stride;this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const l=
this._headIndex,e=this._tailIndex;return l>=e?l-e:l+this._capacity-e}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._tailIndex=this._headIndex=0;this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){d.assert(!this._updating,
"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex}endUpdate(){d.assert(this._updating,"not updating");this.size<b.ReallocShrinkTreshold*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1}allocateHead(){d.assert(this._updating,"not updating");this.isFull&&this._grow();const l=this.headIndex;this._captureFirstIndex&&(this._firstIndex=l,this._captureFirstIndex=!1);
this._incrementHead();d.assert(this._headIndex!==this._tailIndex,"invalid pointers");return l}freeTail(){d.assert(this._updating,"not updating");d.assert(0<this.size,"invalid size");const l=this._tailIndex===this._firstIndex;this._incrementTail();l&&(this._firstIndex=this._tailIndex)}_grow(){this._resize(Math.max(64,Math.floor(this._capacity*b.ReallocGrowthFactor)))}_shrink(){this._resize(Math.max(64,Math.floor(this._capacity*b.ReallocShrinkFactor)))}_resize(l){d.assert(this._updating,"not updating");
if(l!==this._capacity){var e=new m(this._rctx,this._elementSize,l);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const p=this.size,h=this._compactInstances(e);d.assert(h===p,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=h;this._prevHeadIndex=0}this._resized=!0;this._capacity=l;this._buffer=e;this._view=new f(this._instanceBufferLayout.createView(this._buffer.array))}}_compactInstances(l){const e=
this._headIndex,p=this._tailIndex;return p<e?(this._buffer.copyRange(p,e,l),e-p):p>e?(this._buffer.copyRange(p,this._capacity,l),0<e&&this._buffer.copyRange(0,e,l,this._capacity-p),e+(this._capacity-p)):0}_incrementHead(l=1){this._headIndex=(this._headIndex+l)%this._capacity}_incrementTail(l=1){this._tailIndex=(this._tailIndex+l)%this._capacity}_transferRange(l,e){l<e?this._buffer.transferRange(l,e):l>e&&(0<e&&this._buffer.transferRange(0,e),this._buffer.transferRange(l,this._capacity))}}a.RenderInstanceData=
c;a.RenderInstanceDataView=f;a.initialCapacity=64;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b){class g{constructor(d,k,m){this._elementSize=k;this._buffer=a.BufferObject.createVertex(d,b.Usage.STATIC_DRAW);this.resize(m)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+
this._buffer.byteLength}copyRange(d,k,m,f=0){d=new Uint8Array(this.array,d*this.elementSize,(k-d)*this.elementSize);(new Uint8Array(m.array,f*this.elementSize)).set(d)}transferAll(){this._buffer.setData(this._array)}transferRange(d,k){d*=this._elementSize;k*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),d,d,k)}resize(d){const k=d*this._elementSize,m=new ArrayBuffer(k);this._array&&(d>=this._capacity?(new Uint8Array(m)).set(new Uint8Array(this._array)):(new Uint8Array(m)).set((new Uint8Array(this._array)).subarray(0,
d*this._elementSize)));this._array=m;this._buffer.setSize(k);this._capacity=d}}return g})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,b,g,d,k,m){class f extends m{constructor(c,l){super(e=>d.wrap(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere)),{maximumDepth:25});this._instanceData=c;this._boundingSphere=
l;this._tmpSphere=d.create();this._tmpMat4=b.create()}addInstance(c){const l=this._instanceData.view.boundingSphere,e=this._instanceData.getCombinedModelTransform(c,this._tmpMat4);g.transformMat4(this._tmpSphere,this._boundingSphere.center,e);this._tmpSphere[3]=this._boundingSphere.radius*k.maxScale(e);l.setVec(c,this._tmpSphere);this.add([c])}removeInstance(c){this.remove([c])}}a.InstanceOctree=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports"],
function(a){class b{constructor(g,d){this._worldSpaceRadius=g;this._minScreenSpaceRadii=d}selectLevel(g,d,k){g=k.computeScreenPixelSizeAt(g);d=this._worldSpaceRadius*d/g;g=0;for(k=1;k<this._minScreenSpaceRadii.length;++k)d>=this._minScreenSpaceRadii[k]&&(g=k);return g}}a.LevelSelector=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,b,g,d,k,m){class f{static async create(c,l,e){const p=await Promise.allSettled(l.components.map(u=>c.controller.schedule(()=>new m.LodComponentData(c,u),e))),h=p.map(u=>"fulfilled"===u.status?u.value:null).filter(b.isSome);if(g.isAborted(e)||h.length!==p.length){h.forEach(u=>u.destroy());g.throwIfAborted(e);for(const u of p)if("rejected"===u.status)throw u.reason;}return new f(l.minScreenSpaceRadius,h)}constructor(c,l){this.minScreenSpaceRadius=c;this.components=l}destroy(){this.components.forEach(c=>
c.destroy())}intersect(c,l,e,p,h,u,w){this.components.forEach(x=>x.intersect(c,l,e,p,h,u,this.boundingSphere,w))}get boundingBox(){if(null==this._boundingBox){const c=k.empty();this.components.forEach(l=>{null!=l.boundingInfo&&(k.expandWithVec3(c,l.boundingInfo.bbMin),k.expandWithVec3(c,l.boundingInfo.bbMax))});this._boundingBox=c}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const c=this.boundingBox,l=d.create();k.center(c,l);this._boundingSphere={center:l,radius:.5*
k.diameter(c)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((c,l)=>c+l.triangleCount,0)}}a.LodLevel=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ./Intersector ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p{constructor(h,u){const w=h.renderContext.rctx;u=u.geometry;this._materialRepository=h.materialRepository;u.material.setParameters({instancedDoublePrecision:!0});h=u.material.createBufferWriter();const x=h.vertexBufferLayout,n=h.elementCount(u),q=x.createBuffer(n);h.write(null,null,u,q,0);this.geometry=u;this.material=u.material;this.glMaterials=new d.GLMaterials(u.material,this._materialRepository);this.vertexBufferLayout=x;this.vbo=l.BufferObject.createVertex(w,
e.Usage.STATIC_DRAW,q.buffer);this.vao=new f.VertexArrayObject(w,g.Default3D,{geometry:b.glLayout(x)},{geometry:this.vbo});this.vertexCount=n}destroy(){this.glMaterials.dispose();this.vbo.dispose();this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(h,u,w,x,n,q,t,v){const r=this.geometry.id;this.material.intersect(this.geometry,h.transform.transform,h,w,x,(y,z,D,C,E)=>{0<=y&&(null==u||u(h.rayBegin,h.rayEnd,y))&&(D=new c.LodTarget(q.layerUid,
q.graphicUid(n),r,D,t,v),(null==h.results.min.drapedLayerOrder||E>=h.results.min.drapedLayerOrder)&&(null==h.results.min.dist||y<h.results.min.dist)&&h.results.min.set(m.IntersectorType.LOD,D,y,z,h.transform.transform,E),h.options.store!==m.StoreResults.MIN&&(null==h.results.max.drapedLayerOrder||E>=h.results.max.drapedLayerOrder)&&(null==h.results.max.dist||y>h.results.max.dist)&&h.results.max.set(m.IntersectorType.LOD,D,y,z,h.transform.transform,E),h.options.store===m.StoreResults.ALL&&(C=k.newIntersectorResult(h.results.min.ray),
C.set(m.IntersectorType.LOD,D,y,z,h.transform.transform,E),h.results.all.push(C)))})}}a.LodComponentData=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../IntersectorTarget","../intersectorUtils"],function(a,b,g,d){class k extends g.Graphic3DTarget{constructor(m,f,c,l,e,p){super(m,f);this.layerUid=m;this.graphicUid=f;this.geometryId=c;this.triangleNr=l;this.baseBoundingSphere=
e;this.numLodLevels=p}}a.LodTarget=k;a.isLodIntersectorResult=function(m){return d.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.LOD&&!!m.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/projectBuffer ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DPathSymbolLayerConstants ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../support/ElevationProvider ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Path ../../webgl-engine/lib/PathBuilder ../../webgl-engine/lib/PathCapBuilder ../../webgl-engine/lib/PathExtruder ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/PathGeometryData ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/lib/PathProfile ../../webgl-engine/lib/PathVertex ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M){function T(R,W,N){const {origin:V,positions:S}=R;let X=R.offset;switch(W){default:case G.UpVectorAlignment.World:for(const ca of R.vertices)Z[0]=S[X++]+V[0],Z[1]=S[X++]+V[1],Z[2]=S[X++]+V[2],N.worldUpAtPosition(Z,Z),ca.setFrameFromUpVector(Z);break;case G.UpVectorAlignment.Path:Z[0]=S[X]+V[0],Z[1]=S[X+1]+V[1],Z[2]=S[X+2]+V[2],N.worldUpAtPosition(Z,Z),H.computeMinimumRotationTangentFrame(R,Z)}}function Q(R,W,N){switch(R){case "symbol-value":return N;
case "proportional":return W;default:return R}}const O=["polyline"];class U extends n.Graphics3DSymbolLayer{constructor(R,W,N,V){super(R,W,N,V);this._intrinsicSize=f.fromValues(1,1);this._upVectorAlignment=G.UpVectorAlignment.Path;this._stencilWidth=.1;this.usedMemory=0;this.ensureDrapedStatus(!1)}async doLoad(){var R=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height;const W=null!=this.symbolLayer.height?this.symbolLayer.height:R;this._vvConvertOptions=new v.ConvertOptions({size:!0,
color:!0,rotation:!1,opacity:!0},[1,1,1],[R,1,W],this._context.renderCoordsHelper.unitInMeters);this._fastUpdates=0<this._context.renderer?.visualVariables?.length?v.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):null;var N=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?G.UpVectorAlignment.World:G.UpVectorAlignment.Path;var V=this.symbolLayer.profile||"circle";switch(V){default:case "circle":this._profile=B.circleProfiles[N];
break;case "quad":this._profile=B.quadProfiles[N]}switch(this.symbolLayer.join){case "round":this._extruder=new F.MiterExtruder(0,x.pathNumRoundJoinSubdivisions);break;case "bevel":this._extruder=new F.MiterExtruder(0,1);break;case "miter":this._extruder=new F.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new F.SimpleExtruder}N=this.symbolLayer.cap||"butt";switch(N){case "none":this._startCap=new A.NoCapBuilder;this._endCap=new A.NoCapBuilder;break;default:this._startCap=new A.TriangulationCapBuilder(this._profile,
0);this._endCap=new A.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new A.TriangulationCapBuilder(this._profile,-.5);this._endCap=new A.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":V="quad"===V,this._startCap=new A.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:V,subdivisions:x.pathNumRoundCapExtrusionSubdivisions}),this._endCap=new A.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:V,subdivisions:x.pathNumRoundCapExtrusionSubdivisions})}var S=
this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);V=l.fromArray(S);S=S[3];const X=1>S||this.needsDrivenTransparentPass;N={diffuse:V,ambient:V,opacity:S,transparent:X,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:X||"none"===N?z.CullFaceOptions.None:z.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(m.set(this._intrinsicSize,R,W),!q.isValidSize(this._intrinsicSize[0])||!q.isValidSize(this._intrinsicSize[1])))throw new g("graphics3dpathsymbollayer:invalid-size",
"Symbol sizes may not be negative values");this._fastUpdates?.visualVariables.size||m.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates?(R={...N,...this._fastUpdates.materialParameters,size:f.fromArray(this._intrinsicSize)},this._materials[0]=new M.PathMaterial(R)):(N.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,N.normalType=y.NormalType.Compressed,this._materials[0]=new J.DefaultMaterial(N));this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials[0]=null;this._materials.length=0}createGraphics3DGraphic(R){const W=R.graphic;if(!this._validateGeometry(W.geometry,O,this.symbolLayer.type))return null;const N=this.setGraphicElevationContext(W);return this._createAs3DShape(W,R.renderingInfo,N,W.uid)}layerOpacityChanged(){const R=this._getCombinedOpacity(this.symbolLayer?.material?.color),W=1>R||this.needsDrivenTransparentPass;
this._materials[0]?.setParameters({opacity:R,transparent:W})}layerElevationInfoChanged(R,W){return this.updateGraphics3DGraphicElevationInfo(R,W,u.needsElevationUpdates3D)}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0}applyRendererDiff(R,W){for(const N in R.diff)switch(N){case "visualVariables":if(v.updateFastSymbolUpdatesState(this._fastUpdates,
W,this._vvConvertOptions))this._materials[0]?.setParameters(this._fastUpdates.materialParameters);else return t.ApplyRendererDiffResult.RecreateSymbol;break;default:return t.ApplyRendererDiffResult.RecreateSymbol}return t.ApplyRendererDiffResult.FastUpdate}_getVertexData(R){let W=0;const N=R.paths,V=[],S=R.spatialReference,X=this._context.elevationProvider.spatialReference,ca=this._context.renderCoordsHelper.spatialReference;for(var ba of N)W+=ba.length;ba=h.newDoubleArray(3*W);let ia=0;for(const ka of N){V.push({offset:ia,
numVertices:ka.length});for(const na of ka)ba[ia++]=na[0],ba[ia++]=na[1],ba[ia++]=R.hasZ?na[2]:0}if(null!=X&&!S.equals(X)&&!e.projectBuffer(ba,S,0,ba,X,0,W))return null;null==X||X.equals(ca)?R=h.doubleArrayFrom(ba):(R=h.newDoubleArray(3*W),e.projectBuffer(ba,X,0,R,ca,0,W));return{pathVertexDataInfos:V,vertexDataES:ba,vertexDataRS:R}}_createAs3DShape(R,W,N,V){this.usedMemory=0;var S=R.geometry;const X=this._getVertexData(S);if(null==X)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0===X.pathVertexDataInfos.length)return 0!==S.paths.length&&S.paths.some(aa=>0<aa.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;var ca=[];S=S.spatialReference;const ba=p.create(),ia=this._context.renderCoordsHelper,ka=new r.SamplePosition(X.vertexDataES);for(const aa of X.pathVertexDataInfos){var na=aa.numVertices;if(!(2>na)){var Y=aa.offset;if(null!=this._context.clippingExtent&&(p.empty(ba),p.expandWithBuffer(ba,X.vertexDataES,
Y,na),!p.intersectsClippingArea(ba,this._context.clippingExtent)))continue;var ea=[];na=Y+3*na;for(var fa=Y;fa<na;fa+=3){ka.offset=fa;const da=u.evaluateElevationAlignmentAtPoint(ka,this._context.elevationProvider,N,ia);c.set(Z,X.vertexDataRS[fa],X.vertexDataRS[fa+1],X.vertexDataRS[fa+2]);ia.setAltitude(Z,da);X.vertexDataRS[fa]=Z[0];X.vertexDataRS[fa+1]=Z[1];X.vertexDataRS[fa+2]=Z[2];ea.push(K.newPathVertex(this._upVectorAlignment))}Y=new C.Path(ea,X.vertexDataES,X.vertexDataRS,Y);T(Y,this._upVectorAlignment,
this._context.renderCoordsHelper);Y=new E.PathBuilder(Y,this._profile,this._extruder,this._startCap,this._endCap);ea=null;this._fastUpdates?(fa=this._fastUpdates.visualVariables,ea=v.getAttributeValue(fa.size?.field,R)??0,na=v.getAttributeValue(fa.color?.field,R)??0,fa=v.getAttributeValue(fa.opacity?.field,R)??0,ea=new I.FastUpdatePathGeometry(Y,ea,na,fa)):(ea=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(na=W.size,ea[0]*=Q(na[0],"symbol-value"===na[2]?this.symbolLayer.height||
0:na[2],this.symbolLayer.width||0),ea[1]*=Q(na[2],"symbol-value"===na[0]?this.symbolLayer.width||0:na[0],this.symbolLayer.height||0)),na=void 0,this._drivenProperties.color&&(na=W.color),this._drivenProperties.opacity&&null!=W.opacity&&(na=na?[na[0],na[1],na[2],W.opacity]:[1,1,1,W.opacity]),fa=new I.StaticPathGeometry(Y),fa.bake(ea),na&&fa.bakeVertexColors(na),ea=fa);na=ea.createGeometryData();fa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:V,layerUid:this._context.layer.uid});
ea=new G.PathGeometry(this._materials[0],na,ea,S,this._stencilWidth,fa);ea.transformation=d.translate(k.create(),k.IDENTITY,Y.path.origin);ca.push(ea);this.usedMemory+=Y.usedMemory}}if(0===ca.length)return null;R=new D.Object3D({geometries:ca,layerUid:this._context.layer.uid,graphicUid:V});ca=new w.Graphics3DObject3DGraphicLayer(this,R,ca,null,null,(aa,da,ma,ua,sa)=>{da=this._upVectorAlignment;aa=aa.stageObject;ma=aa.geometries;var ra=0;for(const ja of ma){if(!G.isPathGeometry(ja))continue;const oa=
ja.path,za=oa.builder.path;var Aa=za,qa=ua,la=sa;let ta=0;const {origin:Ca,vertices:Ga,positions:La,positionsES:Ma}=Aa,Ra=Aa.offset+3*Ga.length;for(let Ya=Aa.offset;Ya<Ra;Ya+=3)c.set(Z,Ma[Ya],Ma[Ya+1],Ma[Ya+2]),qa(Z,P),ta+=P.sampledElevation,Z[0]=La[Ya]+Ca[0],Z[1]=La[Ya+1]+Ca[1],Z[2]=La[Ya+2]+Ca[2],la.setAltitude(Z,P.z),La[Ya]=Z[0]-Ca[0],La[Ya+1]=Z[1]-Ca[1],La[Ya+2]=Z[2]-Ca[2];Aa.updatePathVertexInformation();ra+=ta/Ga.length;da!==G.UpVectorAlignment.World&&T(za,da,sa);oa.onPathChanged(ja);ja.invalidateBoundingInfo();
aa.geometryVertexAttributeUpdated(ja,L.VertexAttribute.POSITION)}return ra/ma.length},N);ca.alignedSampledElevation=0;ca.needsElevationUpdates=u.needsElevationUpdates3D(N.mode);return ca}}const Z=l.create(),P=new u.SampleElevationInfo;a.Graphics3DPathSymbolLayer=U;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Path":function(){define(["exports","../../../../core/typedArrayUtil","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/FloatArray"],
function(a,b,g,d,k){class m{constructor(f,c,l,e){this.vertices=f;this.positionsES=c;this.offset=e;var p=f.length;e=this.offset+3*Math.floor(p/2);f=l[e];c=l[e+1];e=l[e+2];this.origin=d.fromValues(f,c,e);this.positions=k.newFloatArray(3*p);p=this.offset+3*p;for(let h=this.offset;h<p;h+=3)this.positions[h]=l[h]-f,this.positions[h+1]=l[h+1]-c,this.positions[h+2]=l[h+2]-e;this.updatePathVertexInformation()}get usedMemory(){return b.estimateSize(this.positions)}updatePathVertexInformation(){const f=this.vertices.length;
var c=this.vertices[0];let l=this.offset;const e=this.positions;c.vRight[0]=e[l+3]-e[l];c.vRight[1]=e[l+4]-e[l+1];c.vRight[2]=e[l+5]-e[l+2];l+=3;let p=g.length(c.vRight);c.vMinSiblingLength=p;g.normalize(c.vRight,c.vRight);var h=c;for(c=1;c<f;++c){const u=this.vertices[c];u.vLeft=h.vRight;c<f-1?(u.vRight[0]=e[l+3]-e[l],u.vRight[1]=e[l+4]-e[l+1],u.vRight[2]=e[l+5]-e[l+2],h=g.length(u.vRight),u.vMinSiblingLength=Math.min(p,h),p=h,g.normalize(u.vRight,u.vRight)):(g.copy(u.vRight,u.vLeft),u.vMinSiblingLength=
p);h=u;l+=3}}}a.Path=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathBuilder":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices"],function(a,b,g,d){class k{constructor(m,f,c,l,e,p={}){this.path=m;this.profile=f;this.extruder=c;this.startCap=l;this.endCap=e;this.options=p;this._extrusionVertexCount=0;l=this.path.vertices.length-2;this.numExtrusionProfiles=
c.numProfilesPerJoin()*l+2;this.numVerticesTotal=f.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.startCap.numVertices;this.endCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.endCap.numVertices;this.pathVertexData=d.newIntArray(1*this.numVerticesTotal);this.profileRightAxes=g.newFloatArray(4*this.numVerticesTotal);this.profileUpAxes=g.newFloatArray(4*this.numVerticesTotal);this.profileVertexAndNormals=
g.newFloatArray(4*this.numVerticesTotal);this.positions=g.floatSubArray(m.positions,m.offset,3*m.vertices.length);this._rebuildGeometry();this.buildTopology()}get usedMemory(){return b.estimateSize(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(m,f,c,l,e){const p=4*this._extrusionVertexCount;this.profileRightAxes[p]=f.right[0];this.profileRightAxes[p+1]=f.right[1];this.profileRightAxes[p+2]=f.right[2];
this.profileUpAxes[p]=f.up[0];this.profileUpAxes[p+1]=f.up[1];this.profileUpAxes[p+2]=f.up[2];this.profileVertexAndNormals[p]=c[0];this.profileVertexAndNormals[p+1]=c[1];this.profileVertexAndNormals[p+2]=l[0];this.profileVertexAndNormals[p+3]=l[1];this.pathVertexData[this._extrusionVertexCount]=m;e?(m=this.path.vertices[m],f=m.maxStretchDistance,this.profileRightAxes[p+3]=m.rotationRight[0]*f,this.profileUpAxes[p+3]=m.rotationRight[1]*f):(this.profileRightAxes[p+3]=0,this.profileUpAxes[p+3]=0);++this._extrusionVertexCount}emitCapVertex(m,
f,c,l,e,p){const h=4*this._extrusionVertexCount;this.profileRightAxes[h]=f.right[0];this.profileRightAxes[h+1]=f.right[1];this.profileRightAxes[h+2]=f.right[2];this.profileRightAxes[h+3]=e;this.profileUpAxes[h]=f.up[0];this.profileUpAxes[h+1]=f.up[1];this.profileUpAxes[h+2]=f.up[2];this.profileUpAxes[h+3]=p;this.profileVertexAndNormals[h]=c[0];this.profileVertexAndNormals[h+1]=c[1];this.profileVertexAndNormals[h+2]=l[0];this.profileVertexAndNormals[h+3]=l[1];this.pathVertexData[this._extrusionVertexCount]=
m;++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const {positions:m,offset:f,vertices:c}=this.path;this.positions=g.floatSubArray(m,f,3*c.length);let l=0;const e=(h,u,w,x,n)=>this.emitCapVertex(l,h,u,w,x,n),p=(h,u,w,x)=>this.emitVertex(l,h,u,w,x);this.startCap.rebuildConnectingProfileGeometry(c[l],this.profile,e);for(l=1;l<c.length-1;++l)this.extruder.extrude(c[l],this.profile,p);this.endCap.rebuildConnectingProfileGeometry(c[l],this.profile,e);l=0;this.startCap.rebuildCapGeometry(c[l],
e);l=c.length-1;this.endCap.rebuildCapGeometry(c[l],e)}buildTopology(){const m=this.profile.vertices.length,f=this.profile.numSegments,c=this.numExtrusionProfiles-1;var l=f*c*6;this.startCap.indexBufferStart=l;this.startCap.firstProfileVertexIndex=0;l+=this.startCap.numIndices;this.endCap.indexBufferStart=l;this.endCap.firstProfileVertexIndex=m*(this.numExtrusionProfiles-1);const e=[],p=[],h=[];l=(u,w,x)=>{e.push(u);e.push(w);e.push(x);p.push(u);p.push(w);p.push(x);h.push(this.pathVertexData[u]);
h.push(this.pathVertexData[w]);h.push(this.pathVertexData[x])};for(let u=0;u<f;++u){const w=this.profile.indices[2*u],x=this.profile.indices[2*u+1];for(let n=0;n<c;++n){const q=n*m+w,t=(n+1)*m+x,v=n*m+x;l(q,(n+1)*m+w,t);l(q,t,v)}}this.startCap.buildTopology(this.path.vertices[0],l);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l);this.vertexIndices=d.compactIndices(e);this.normalIndices=d.compactIndices(p);this.pathVertexIndices=d.compactIndices(h)}onPathChanged(){this._rebuildGeometry()}}
a.PathBuilder=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathCapBuilder":function(){define(["exports","../../../../chunks/vec2","../../../../chunks/vec2f64"],function(a,b,g){class d{rebuildConnectingProfileGeometry(e,p,h){for(let u=0;u<p.vertices.length;++u)h(e.frame,p.vertices[u],p.normals[u],0,0)}}class k extends d{constructor(){super();this.numIndices=this.numVertices=0}rebuildCapGeometry(){}buildTopology(){}}class m extends d{constructor(e,
p=0,h=!1){super();this.profile=e;this.profilePlaneOffset=p;this.flip=h}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,p,h){const u=this.profilePlaneOffset;for(let w=0;w<p.vertices.length;++w)h(e.frame,p.vertices[w],p.normals[w],u,0)}rebuildCapGeometry(e,p){const h=this.profile,u=this.flip?1:-1,w=this.profilePlaneOffset,x=l;b.set(x,0,0);for(let n=0;n<h.vertices.length;++n)p(e.frame,h.vertices[n],x,w,u)}buildTopology(e,
p){e=this.profile;const h=this.vertexBufferStart+e.indices[0];for(let u=1;u<e.numSegments;++u){const w=this.vertexBufferStart+e.indices[2*u],x=this.vertexBufferStart+e.indices[2*u+1];this.flip?p(x,w,h):p(h,w,x)}}}class f extends d{constructor(e){super();this.flip=!1;this.sign=0;this.breakNormals=!1;this.numSegments=3;this.profile=e.profile;this.sign=(this.flip=e.flip)?1:-1;this.breakNormals=e.breakNormals;this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-
1)+this.profile.poles.length;this.breakNormals&&(e+=this.profile.vertices.length);return e}get numIndices(){let e;const p=this.profile;e=2*p.numSegments*(this.numSegments-1);for(let h=0;h<p.numSegments;++h)e=p.poleIndices[p.indices[2*h]]===p.poleIndices[p.indices[2*h+1]]?e+1:e+2;return 3*e}rebuildCapGeometry(e,p){const h=this.profile;e=e.frame;const u=.5*this.sign,w=c,x=l;b.set(x,0,0);for(var n of h.poles)n.normal?p(e,n.position,n.normal,u,0):p(e,n.position,x,u,this.sign);if(this.breakNormals)for(n=
0;n<h.vertices.length;++n)p(e,h.vertices[n],h.normals[n],0,0);for(n=0;n<this.numSegments-1;++n){var q=(1-(n+1)/this.numSegments)*Math.PI*.5;const t=Math.sin(q);q=Math.cos(q);for(let v=0;v<h.vertices.length;++v){const r=h.poles[h.poleIndices[v]];b.subtract(w,h.vertices[v],r.position);b.scale(w,w,t);r.normal?(b.add(w,w,r.position),p(e,w,r.normal,u*q,0)):(b.normalize(x,w),b.scale(x,x,t),b.add(w,w,r.position),p(e,w,x,u*q,this.sign*q))}}}buildTopology(e,p){e=this.profile;const h=this.breakNormals?this.vertexBufferStart+
e.poles.length:this.firstProfileVertexIndex,u=this.breakNormals?this.vertexBufferStart+e.poles.length+e.vertices.length:this.vertexBufferStart+e.poles.length;for(let w=0;w<e.numSegments;++w){const x=e.indices[2*w],n=e.indices[2*w+1],q=this.vertexBufferStart+e.poleIndices[x],t=this.vertexBufferStart+e.poleIndices[n];let v=h+x,r=h+n;for(let y=0;y<this.numSegments-1;++y){const z=u+y*e.vertices.length+x,D=u+y*e.vertices.length+n;this.flip?(p(z,r,v),p(r,z,D)):(p(v,r,z),p(D,z,r));v=z;r=D}this.flip?(p(q,
r,v),q!==t&&p(q,t,r)):(p(v,r,q),q!==t&&p(r,t,q))}}}const c=g.create(),l=g.create();a.NoCapBuilder=k;a.PathCapBuilder=d;a.RoundCapBuilder=f;a.TriangulationCapBuilder=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathExtruder":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64".split(" "),function(a,b,g,d,k,m,f){class c{}
class l{numProfilesPerJoin(){return 1}extrude(x,n,q){for(let t=0;t<n.vertices.length;++t)q(x.frame,n.vertices[t],n.normals[t],!1)}}class e{constructor(x,n){this.cutoffAngle=x;this.numBendSubdivisions=n}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(x,n,q){var t=w;const {rotationAngle:v,rotationRight:r,frame:y}=x;if(Math.abs(v)>=this.cutoffAngle){var z=x.rotationFrameUp;for(var D=0;D<this.numBendSubdivisions+1;++D){b.fromRotation(u,.5*-v+D*v/this.numBendSubdivisions,z);var C=t,E=y,
A=u;m.transformMat4(C.up,E.up,A);m.transformMat4(C.right,E.right,A);for(C=0;C<n.vertices.length;++C)0<=d.dot(n.vertices[C],r)*v?q(t,n.vertices[C],n.normals[C],!1):(E=x.applyMiterStretch(h,n.vertices[C]),q(y,E,n.normals[C],!0))}}else for(t=0;t<this.numBendSubdivisions+1;++t)for(z=0;z<n.vertices.length;++z)D=0<=d.dot(n.vertices[z],r)*v,C=x.applyMiterStretch(h,n.vertices[z]),q(y,C,n.normals[z],!D)}}class p{constructor(){this.up=f.create();this.right=f.create()}}const h=k.create(),u=g.create(),w=new p;
a.Frame2D=p;a.MiterExtruder=e;a.PathExtruder=c;a.SimpleExtruder=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","./ContentObjectType","./Geometry"],function(a,b,g){class d extends g.Geometry{constructor(k,m,f,c,l,e){super(k,m,null,b.ContentObjectType.Mesh,e);this.path=f;this.geometrySR=c;this.stencilWidth=l}}a.UpVectorAlignment=void 0;(function(k){k[k.World=0]="World";k[k.Path=1]="Path"})(a.UpVectorAlignment||
(a.UpVectorAlignment={}));a.PathGeometry=d;a.isPathGeometry=function(k){return"path"in k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometryData":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ./Attribute ./Normals ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){class u{constructor(D){this.builder=D}onPathChanged(D){this.builder.onPathChanged()}}class w extends u{constructor(D){super(D);this.vertexAttributeColor=m.fromValues(255,255,255,255);this.size=[];this.vertexAttributePosition=f.newFloatArray(3*this.builder.numVerticesTotal);this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(D){this.vertexAttributeColor[0]=255*D[0];this.vertexAttributeColor[1]=255*D[1];this.vertexAttributeColor[2]=
255*D[2];this.vertexAttributeColor[3]=255*(3<D.length?D[3]:1)}bake(D){this.size=D;const {numVerticesTotal:C,pathVertexData:E,path:A,positions:F,profileRightAxes:G,profileUpAxes:I,profileVertexAndNormals:H}=this.builder;for(let J=0;J<C;++J){var B=E[J],K=0===B||B===A.vertices.length-1;B*=3;const M=r;let T=0,Q=0;const O=4*J,U=d.set(y,G[O],G[O+1],G[O+2]),Z=d.set(z,I[O],I[O+1],I[O+2]);var L=b.set(n,H[O]*D[0],H[O+1]*D[1]);if(K)d.cross(M,Z,U),T=G[O+3]*D[0],Q=I[O+3];else{K=q;const P=t;b.set(K,G[O+3],I[O+
3]);const R=b.length(K);b.normalize(K,K);const W=b.dot(L,K);if(Math.abs(W)>R){b.set(P,-K[1],K[0]);const N=b.dot(L,P);b.scale(K,K,R*Math.sign(W));b.scale(P,P,N);b.add(L,K,P)}d.set(M,0,0,0)}L=d.set(v,U[0]*L[0]+Z[0]*L[1],U[1]*L[0]+Z[1]*L[1],U[2]*L[0]+Z[2]*L[1]);K=3*J;this.vertexAttributePosition[K]=F[B]+L[0]+M[0]*T;this.vertexAttributePosition[K+1]=F[B+1]+L[1]+M[1]*T;this.vertexAttributePosition[K+2]=F[B+2]+L[2]+M[2]*T;B=b.set(n,H[O+2],H[O+3]);e.compressNormal(this.vertexAttributeNormal,J,U[0]*B[0]+
Z[0]*B[1]+M[0]*Q,U[1]*B[0]+Z[1]*B[1]+M[1]*Q,U[2]*B[0]+Z[2]*B[1]+M[2]*Q)}}createGeometryData(){const D=this.builder.vertexIndices.length,{normalIndices:C,vertexIndices:E}=this.builder;return[[p.VertexAttribute.POSITION,new l.Attribute(this.vertexAttributePosition,E,3,!0)],[p.VertexAttribute.NORMALCOMPRESSED,new l.Attribute(this.vertexAttributeNormal,C,2,!0)],[p.VertexAttribute.COLOR,new l.Attribute(this.vertexAttributeColor,c.getZeroIndexArray(D),4)]]}onPathChanged(D){super.onPathChanged(D);this.bake(this.size)}intersect(D,
C,E){const A=this.builder.vertexIndices,F=new l.Vertices(this.vertexAttributePosition,3);h.intersectTriangles(D,C,0,A.length/3,A,F,void 0,void 0,E)}}class x extends u{constructor(D,C,E,A){super(D);this.sizeAttributeValue=C;this.colorAttributeValue=E;this.opacityAttributeValue=A;this.vvData=null;this.baked=new w(D);this.vvData=f.newFloatArray(4*this.builder.path.vertices.length);for(D=0;D<this.builder.path.vertices.length;++D)this.vvData[4*D]=C,this.vvData[4*D+1]=E,this.vvData[4*D+2]=A,this.vvData[4*
D+3]=0===D||D===this.builder.path.vertices.length-1?1:0}createGeometryData(){const {positions:D,profileRightAxes:C,profileUpAxes:E,profileVertexAndNormals:A,pathVertexIndices:F,vertexIndices:G}=this.builder;return[[p.VertexAttribute.POSITION,new l.Attribute(D,F,3,!0)],[p.VertexAttribute.PROFILERIGHT,new l.Attribute(C,G,4,!0)],[p.VertexAttribute.PROFILEUP,new l.Attribute(E,G,4,!0)],[p.VertexAttribute.PROFILEVERTEXANDNORMAL,new l.Attribute(A,G,4,!0)],[p.VertexAttribute.FEATUREVALUE,new l.Attribute(this.vvData,
F,4,!0)]]}onPathChanged(D){super.onPathChanged(D);if(D=D.getMutableAttribute(p.VertexAttribute.POSITION))D.data=this.builder.positions}}const n=g.create(),q=g.create(),t=g.create(),v=k.create(),r=k.create(),y=k.create(),z=k.create();a.FastUpdatePathGeometry=x;a.PathGeometryData=u;a.StaticPathGeometry=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil".split(" "),
function(a,b,g,d,k,m,f){const c=d.create();a.computeMinimumRotationTangentFrame=function(l,e){let p=null;const h=l.vertices.length,u=d.create(),w=d.create(),x=d.create(),n=d.create(),q=d.create(),t=d.create(),v=k.create();let r=l.vertices[0];g.copy(w,e);g.set(u,0,1,0);f.makeOrthoBasisDirUpFallback(r.vRight,w,u,u,x,w,.99619469809);g.copy(r.frame.up,w);g.copy(r.frame.right,x);e=l.positions;let y=l.offset;p=r;for(let D=1;D<h;++D){r=l.vertices[D];g.add(q,r.vLeft,r.vRight);var z=g.length(q);0<z?(z=1/Math.sqrt(z),
q[0]*=z,q[1]*=z,q[2]*=z):(q[0]=r.vRight[0],q[1]=r.vRight[1],q[2]=r.vRight[2]);t[0]=e[y]+p.frame.up[0];t[1]=e[y+1]+p.frame.up[1];t[2]=e[y+2]+p.frame.up[2];y+=3;z=g.set(c,e[y],e[y+1],e[y+2]);k.fromPositionAndNormal(z,q,v);k.intersectRay(v,m.wrap(t,r.vLeft),n)?(n[0]-=e[y],n[1]-=e[y+1],n[2]-=e[y+2],g.normalize(w,n),g.cross(x,q,w),g.normalize(x,x)):f.makeOrthoBasisDirUpFallback(q,p.frame.up,p.frame.right,u,x,w,.99619469809);g.copy(r.frame.up,w);g.copy(r.frame.right,x);p=r}};a.profileSpaceToVertexSpace=
function(l,e,p){l[0]=p[0]*e.right[0]+p[1]*e.up[0];l[1]=p[0]*e.right[1]+p[1]*e.up[1];l[2]=p[0]*e.right[2]+p[1]*e.up[2]};a.vertexSpaceToProfileSpace=function(l,e,p){b.set(l,g.dot(p,e.right),g.dot(p,e.up))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathProfile":function(){define(["exports","../../../../core/typedArrayUtil","../../../../chunks/vec2f64","../../layers/graphics/Graphics3DPathSymbolLayerConstants"],function(a,b,g,d){function k(p){const h=
d.pathNumCircleProfileSubdivisions,u=new f,w={v0:0,v1:0};u.addPole(g.fromValues(0,0));for(var x=0;x<h;++x){var n=2*x*Math.PI/h,q=Math.cos(n);const t=Math.sin(n);n=g.fromValues(.5*q,.5*t);q=g.fromValues(q,t);u.addVertex(n,q)}for(x=0;x<h-1;++x)u.addSegment({v0:x,v1:x+1},w);u.addSegment({v0:h-1,v1:0},w);"center"!==p&&(p=c[p],u.translate(p[0],p[1]));return u}function m(p){const h=new f,u=g.fromValues(-.5,-.5),w=g.fromValues(.5,-.5),x=g.fromValues(.5,.5),n=g.fromValues(-.5,.5),q=g.fromValues(0,-1),t=g.fromValues(1,
0),v=g.fromValues(0,1),r=g.fromValues(-1,0);h.addPole(g.fromValues(0,.5),v);h.addPole(g.fromValues(0,.5));h.addPole(g.fromValues(0,-.5));h.addPole(g.fromValues(0,-.5),q);h.addVertex(u,q);h.addVertex(w,q);h.addSegment({v0:0,v1:1},{v0:3,v1:3});h.addVertex(w,t);h.addVertex(x,t);h.addSegment({v0:2,v1:3},{v0:2,v1:1});h.addVertex(x,v);h.addVertex(n,v);h.addSegment({v0:4,v1:5},{v0:0,v1:0});h.addVertex(n,r);h.addVertex(u,r);h.addSegment({v0:6,v1:7},{v0:1,v1:2});"center"!==p&&(p=c[p],h.translate(p[0],p[1]));
return h}class f{constructor(){this.vertices=[];this.normals=[];this.indices=[];this.poles=[];this.poleIndices=[]}addVertex(p,h){this.vertices.push(g.clone(p));this.normals.push(g.clone(h));return this.vertices.length-1}addPole(p,h=null){this.poles.push({position:g.clone(p),normal:h?g.clone(h):null});return this.poles.length-1}addSegment(p,h=null){this.indices.push(p.v0);this.indices.push(p.v1);h&&(this.poleIndices.push(h.v0),this.poleIndices.push(h.v1))}get numSegments(){return this.indices.length/
2}translate(p,h){for(const u of this.vertices)u[0]+=p,u[1]+=h;for(const u of this.poles)u.position[0]+=p,u.position[1]+=h}get usedMemory(){return this.vertices.length*b.estimateSize(this.vertices[0])*2+b.estimateSize(this.indices)}}const c={top:[0,-.5],bottom:[0,.5]},l={center:k("center"),top:k("top"),bottom:k("bottom")},e={center:m("center"),top:m("top"),bottom:m("bottom")};a.PathProfile=f;a.circleProfiles=l;a.quadProfiles=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathVertex":function(){define("exports ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./PathExtruder ./PathGeometry".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p{constructor(){this.vLeft=c.create();this.vRight=c.create();this.vMinSiblingLength=0;this.frame=new l.Frame2D}setFrameFromUpVector(E){f.copy(this.frame.up,E);f.add(z,this.vLeft,this.vRight);f.normalize(z,z);f.scale(y,this.frame.up,f.dot(z,this.frame.up));f.subtract(D,z,y);f.normalize(D,D);f.cross(this.frame.right,D,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class h extends p{get rotationFrameUp(){return this.frame.up}get rotationRight(){return m.UNIT_X}get rotationAngle(){f.scale(v,
this.frame.up,f.dot(this.frame.up,this.vLeft));f.subtract(v,this.vLeft,v);f.negate(v,v);f.normalize(v,v);f.scale(r,this.frame.up,f.dot(this.frame.up,this.vRight));f.subtract(r,this.vRight,r);f.normalize(r,r);f.cross(t,this.rotationFrameUp,this.vLeft);return Math.sign(f.dot(t,this.vRight))*(Math.PI-b.acosClamped(f.dot(v,r)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(E,A){var F=this.rotationAngle;if(0>=Math.abs(F))return A;F=b.reciprocalClamped(Math.cos(.5*
F));return k.set(E,(1+(F-1))*A[0],A[1])}}class u extends p{get rotationFrameUp(){const E=Math.sign(f.dot(this.frame.right,this.vRight));f.cross(w,this.vRight,this.vLeft);f.scale(w,w,E);return f.normalize(w,w)}get rotationRight(){var E=this.rotationFrameUp,A=f.dot(E,this.frame.up);E=f.dot(E,this.frame.right);f.scale(n,this.frame.up,-E);f.scale(q,this.frame.right,A);f.add(n,n,q);f.normalize(n,n);A=this.frame;E=n;k.set(x,f.dot(E,A.right),f.dot(E,A.up));return x}get rotationAngle(){const E=Math.sign(f.dot(this.frame.right,
this.vRight));f.negate(t,this.vLeft);return-E*(Math.PI-b.acosClamped(f.dot(t,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*b.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(E,A){var F=this.rotationAngle;if(0===Math.abs(F))return A;F=b.reciprocalClamped(Math.cos(.5*F));const G=this.rotationRight;F=g.set(C,1+(F-1)*G[0]*G[0],(F-1)*G[0]*G[1],(F-1)*G[0]*G[1],1+(F-1)*G[1]*G[1]);return k.transformMat2(E,A,F)}}const w=c.create(),x=m.create(),n=c.create(),
q=c.create(),t=c.create(),v=c.create(),r=c.create(),y=c.create(),z=c.create(),D=c.create(),C=d.create();a.PathVertex=p;a.newPathVertex=function(E){switch(E){case e.UpVectorAlignment.World:return new h;case e.UpVectorAlignment.Path:return new u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,b){function g(E,A){E[0]=A[0];E[1]=A[1];E[2]=A[2];E[3]=A[3];return E}function d(E){E[0]=1;E[1]=0;E[2]=0;E[3]=1;return E}function k(E,
A,F,G,I){E[0]=A;E[1]=F;E[2]=G;E[3]=I;return E}function m(E,A){if(E===A){const F=A[1];E[1]=A[2];E[2]=F}else E[0]=A[0],E[1]=A[2],E[2]=A[1],E[3]=A[3];return E}function f(E,A){const F=A[0],G=A[1],I=A[2];A=A[3];let H=F*A-I*G;if(!H)return null;H=1/H;E[0]=A*H;E[1]=-G*H;E[2]=-I*H;E[3]=F*H;return E}function c(E,A){const F=A[0];E[0]=A[3];E[1]=-A[1];E[2]=-A[2];E[3]=F;return E}function l(E){return E[0]*E[3]-E[2]*E[1]}function e(E,A,F){const G=A[0],I=A[1],H=A[2];A=A[3];const B=F[0],K=F[1],L=F[2];F=F[3];E[0]=G*
B+H*K;E[1]=I*B+A*K;E[2]=G*L+H*F;E[3]=I*L+A*F;return E}function p(E,A,F){const G=A[0],I=A[1],H=A[2];A=A[3];const B=Math.sin(F);F=Math.cos(F);E[0]=G*F+H*B;E[1]=I*F+A*B;E[2]=G*-B+H*F;E[3]=I*-B+A*F;return E}function h(E,A,F){const G=A[1],I=A[2],H=A[3],B=F[0];F=F[1];E[0]=A[0]*B;E[1]=G*B;E[2]=I*F;E[3]=H*F;return E}function u(E,A){const F=Math.sin(A);A=Math.cos(A);E[0]=A;E[1]=F;E[2]=-F;E[3]=A;return E}function w(E,A){E[0]=A[0];E[1]=0;E[2]=0;E[3]=A[1];return E}function x(E){return"mat2("+E[0]+", "+E[1]+", "+
E[2]+", "+E[3]+")"}function n(E){return Math.sqrt(E[0]**2+E[1]**2+E[2]**2+E[3]**2)}function q(E,A,F,G){E[2]=G[2]/G[0];F[0]=G[0];F[1]=G[1];F[3]=G[3]-E[2]*F[1];return[E,A,F]}function t(E,A,F){E[0]=A[0]+F[0];E[1]=A[1]+F[1];E[2]=A[2]+F[2];E[3]=A[3]+F[3];return E}function v(E,A,F){E[0]=A[0]-F[0];E[1]=A[1]-F[1];E[2]=A[2]-F[2];E[3]=A[3]-F[3];return E}function r(E,A){return E[0]===A[0]&&E[1]===A[1]&&E[2]===A[2]&&E[3]===A[3]}function y(E,A){const F=E[0],G=E[1],I=E[2];E=E[3];const H=A[0],B=A[1],K=A[2];A=A[3];
const L=b.getEpsilon();return Math.abs(F-H)<=L*Math.max(1,Math.abs(F),Math.abs(H))&&Math.abs(G-B)<=L*Math.max(1,Math.abs(G),Math.abs(B))&&Math.abs(I-K)<=L*Math.max(1,Math.abs(I),Math.abs(K))&&Math.abs(E-A)<=L*Math.max(1,Math.abs(E),Math.abs(A))}function z(E,A,F){E[0]=A[0]*F;E[1]=A[1]*F;E[2]=A[2]*F;E[3]=A[3]*F;return E}function D(E,A,F,G){E[0]=A[0]+F[0]*G;E[1]=A[1]+F[1]*G;E[2]=A[2]+F[2]*G;E[3]=A[3]+F[3]*G;return E}const C=Object.freeze(Object.defineProperty({__proto__:null,LDU:q,add:t,adjoint:c,copy:g,
determinant:l,equals:y,exactEquals:r,frob:n,fromRotation:u,fromScaling:w,identity:d,invert:f,mul:e,multiply:e,multiplyScalar:z,multiplyScalarAndAdd:D,rotate:p,scale:h,set:k,str:x,sub:v,subtract:v,transpose:m},Symbol.toStringTag,{value:"Module"}));a.LDU=q;a.add=t;a.adjoint=c;a.copy=g;a.determinant=l;a.equals=y;a.exactEquals=r;a.frob=n;a.fromRotation=u;a.fromScaling=w;a.identity=d;a.invert=f;a.mat2=C;a.mul=e;a.multiply=e;a.multiplyScalar=z;a.multiplyScalarAndAdd=D;a.rotate=p;a.scale=h;a.set=k;a.str=
x;a.sub=v;a.subtract=v;a.transpose=m})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function b(){return[1,0,0,1]}function g(f){return[f[0],f[1],f[2],f[3]]}function d(f,c,l,e){return[f,c,l,e]}function k(f,c){return new Float64Array(f,c,4)}const m=Object.freeze(Object.defineProperty({__proto__:null,clone:g,create:b,createView:k,fromValues:d},Symbol.toStringTag,{value:"Module"}));a.clone=g;a.create=b;a.createView=k;a.fromValues=d;a.mat2f64=m})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./internal/MaterialUtil".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){class x extends c.Material{constructor(t){super(t,new q);this.supportsEdges=!0;this._vertexAttributeLocations=u.vertexAttributeLocations;this._configuration=new u.PathTechniqueConfiguration;this._vertexBufferLayout=x.getVertexBufferLayout()}getConfiguration(t,v){this._configuration.output=t;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(t===k.ShaderOutput.Color||t===k.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?m.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?m.NormalsDoubleSidedMode.WindingOrder:m.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=
this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=v.ssao;this._configuration.transparencyPassType=v.transparencyPassType;this._configuration.multipassEnabled=v.multipassEnabled;this._configuration.cullAboveGround=v.multipassTerrain.cullAboveGround;return this._configuration}isVisibleForOutput(t){return t===k.ShaderOutput.Shadow||t===k.ShaderOutput.ShadowExcludeHighlight||t===k.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){return super.isVisible()&&
0<this.parameters.opacity}intersect(t,v,r,y,z,D){if(l.isPathGeometry(t)){v=t.path;var C=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const {offset:F,factor:G,minSize:I,maxSize:H}=this.parameters.vvSize;var E=v.sizeAttributeValue;C[0]*=b.clamp(F[0]+E*G[0],I[0],H[0]);C[1]*=b.clamp(F[2]+E*G[2],I[2],H[2])}E=Math.max(C[0],C[1]);t=t.boundingInfo;if(null==t)this._intersectTriangles(v,C,y,z,D);else{t=g.fromValues(t.bbMin[0]-E,t.bbMin[1]-E,t.bbMin[2]-E,t.bbMax[0]+E,t.bbMax[1]+
E,t.bbMax[2]+E);E=[z[0]-y[0],z[1]-y[1],z[2]-y[2]];var A=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);w.intersectAabbInvDir(t,y,[A/E[0],A/E[1],A/E[2]],r.tolerance)&&this._intersectTriangles(v,C,y,z,D)}}}_intersectTriangles(t,v,r,y,z){t.baked.size&&t.baked.size[0]===v[0]&&t.baked.size[1]===v[1]||t.baked.bake(v);t.baked.intersect(r,y,z)}createBufferWriter(){return new h.DefaultBufferWriter(this._vertexBufferLayout)}produces(t,v){switch(v){case k.ShaderOutput.Shadow:case k.ShaderOutput.ShadowHighlight:case k.ShaderOutput.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;
case k.ShaderOutput.Color:case k.ShaderOutput.Alpha:case k.ShaderOutput.Depth:case k.ShaderOutput.Normal:case k.ShaderOutput.Highlight:case k.ShaderOutput.ObjectAndLayerIdColor:return t===(this.parameters.transparent?e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.OPAQUE_MATERIAL)||t===e.RenderSlot.DRAPED_MATERIAL;default:return!1}}createGLMaterial(t){return new n(t)}static getVertexBufferLayout(){return d.newLayout().vec3f(p.VertexAttribute.POSITION).vec4f(p.VertexAttribute.PROFILERIGHT).vec4f(p.VertexAttribute.PROFILEUP).vec4f(p.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(p.VertexAttribute.FEATUREVALUE)}}
class n extends f{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){null!=this.technique&&t.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){if(this._output===k.ShaderOutput.Color||this._output===k.ShaderOutput.Alpha)this._updateShadowState(t),this._updateOccludeeState(t);return this.ensureTechnique(u.PathTechnique,
t)}}class q extends u.PathPassParameters{constructor(){super(...arguments);this.doubleSided=!1;this.doubleSidedType="normal";this.receiveShadows=!1;this.castShadows=!0;this.hasOccludees=this.transparent=this.hasSlicePlane=!1}}a.PathMaterial=x;a.PathMaterialParameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){const y=new Map([[q.VertexAttribute.POSITION,0],[q.VertexAttribute.PROFILERIGHT,1],[q.VertexAttribute.PROFILEUP,2],[q.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[q.VertexAttribute.FEATUREVALUE,4]]);class z extends f.PathVertexPositionPassParameters{constructor(){super(...arguments);this.ambient=d.fromValues(.2,.2,.2);this.diffuse=d.fromValues(.8,.8,.8);this.specular=d.fromValues(0,0,0);this.opacity=1;this.origin=d.create();this.modelTransformation=
null}}class D extends p.ShaderTechnique{initializeConfiguration(E,A){A.spherical=E.viewingMode===k.ViewingMode.Global;A.doublePrecisionRequiresObfuscation=E.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(E){return new w.Program(E.rctx,D.shader.get().build(this.configuration),y)}initializePipeline(){const E=this.configuration.transparencyPassType,A=this.configuration,F=E===n.TransparencyPassType.NONE,G=E===n.TransparencyPassType.FrontFace;return r.makePipelineState({blending:A.output!==
m.ShaderOutput.Color&&A.output!==m.ShaderOutput.Alpha||!A.transparent?null:F?u.blendingDefault:u.oitBlending(E),culling:A.hasSlicePlane&&!A.transparent&&A.doubleSidedMode!==c.NormalsDoubleSidedMode.None?r.frontFaceCullingParams:null,depthTest:{func:u.oitDepthTest(E)},depthWrite:F||G?r.defaultDepthWriteParams:null,colorWrite:r.defaultColorWriteParams,stencilWrite:A.hasOccludees?x.stencilWriteMaskOn:null,stencilTest:A.hasOccludees?x.stencilBaseAllZerosParams:null,polygonOffset:F||G?null:u.OITPolygonOffset})}}
D.shader=new e.ReloadableShaderModule(v.Path,()=>new Promise((E,A)=>a(["../shaders/Path.glsl"],E,A)));class C extends t.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=m.ShaderOutput.Color;this.doubleSidedMode=c.NormalsDoubleSidedMode.None;this.transparencyPassType=n.TransparencyPassType.NONE;this.doublePrecisionRequiresObfuscation=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.transparent=this.hasSlicePlane=this.vvOpacity=this.vvColor=this.vvSize=this.receiveAmbientOcclusion=
this.receiveShadows=this.spherical=!1}}g.__decorate([h.parameter({count:m.ShaderOutput.COUNT})],C.prototype,"output",void 0);g.__decorate([h.parameter({count:c.NormalsDoubleSidedMode.COUNT})],C.prototype,"doubleSidedMode",void 0);g.__decorate([h.parameter({count:n.TransparencyPassType.COUNT})],C.prototype,"transparencyPassType",void 0);g.__decorate([h.parameter()],C.prototype,"spherical",void 0);g.__decorate([h.parameter()],C.prototype,"receiveShadows",void 0);g.__decorate([h.parameter()],C.prototype,
"receiveAmbientOcclusion",void 0);g.__decorate([h.parameter()],C.prototype,"vvSize",void 0);g.__decorate([h.parameter()],C.prototype,"vvColor",void 0);g.__decorate([h.parameter()],C.prototype,"vvOpacity",void 0);g.__decorate([h.parameter()],C.prototype,"hasSlicePlane",void 0);g.__decorate([h.parameter()],C.prototype,"transparent",void 0);g.__decorate([h.parameter()],C.prototype,"hasOccludees",void 0);g.__decorate([h.parameter()],C.prototype,"multipassEnabled",void 0);g.__decorate([h.parameter()],
C.prototype,"cullAboveGround",void 0);g.__decorate([h.parameter()],C.prototype,"doublePrecisionRequiresObfuscation",void 0);g.__decorate([h.parameter({constValue:!1})],C.prototype,"occlusionPass",void 0);g.__decorate([h.parameter({constValue:l.PBRMode.Disabled})],C.prototype,"pbrMode",void 0);g.__decorate([h.parameter({constValue:!0})],C.prototype,"hasVvInstancing",void 0);g.__decorate([h.parameter({constValue:!1})],C.prototype,"useCustomDTRExponentForWater",void 0);g.__decorate([h.parameter({constValue:!1})],
C.prototype,"useFillLights",void 0);g.__decorate([h.parameter({constValue:!1})],C.prototype,"hasColorTexture",void 0);b.PathPassParameters=z;b.PathTechnique=D;b.PathTechniqueConfiguration=C;b.vertexAttributeLocations=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends e.VisualVariablePassParameters{constructor(){super(...arguments);this.size=b.fromValues(1,1)}}a.PathVertexPosition=function(h,u){const w=l.VertexAttribute.FEATUREVALUE;h.attributes.add(w,"vec4");const x=h.vertex;x.code.add(c.glsl`
  bool isCapVertex() {
    return ${w}.w == 1.0;
  }
  `);x.uniforms.add(new d.Float2PassUniform("size",n=>n.size));u.vvSize?(x.uniforms.add(new k.Float3PassUniform("vvSizeMinSize",n=>n.vvSize.minSize),new k.Float3PassUniform("vvSizeMaxSize",n=>n.vvSize.maxSize),new k.Float3PassUniform("vvSizeOffset",n=>n.vvSize.offset),new k.Float3PassUniform("vvSizeFactor",n=>n.vvSize.factor)),x.code.add(c.glsl`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${w}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):x.code.add(c.glsl`vec2 getSize(){
return size;
}`);u.vvOpacity?(x.constants.add("vvOpacityNumber","int",8),x.uniforms.add(new f.FloatsPassUniform("vvOpacityValues",n=>n.vvOpacity.values,8),new f.FloatsPassUniform("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,8)),x.code.add(c.glsl`
    vec4 applyOpacity(vec4 color) {
      float value = ${w}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):x.code.add(c.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);u.vvColor?(x.constants.add("vvColorNumber","int",e.vvColorNumber),x.uniforms.add(new f.FloatsPassUniform("vvColorValues",n=>n.vvColor.values,e.vvColorNumber),new m.Float4sPassUniform("vvColorColors",n=>n.vvColor.colors,e.vvColorNumber)),x.code.add(c.glsl`
    vec4 getColor() {
      float value = ${w}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):x.code.add(c.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);h.include(g.PositionAttribute);h.attributes.add(l.VertexAttribute.PROFILERIGHT,"vec4");h.attributes.add(l.VertexAttribute.PROFILEUP,"vec4");h.attributes.add(l.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");x.code.add(c.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);x.code.add(c.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);x.code.add(c.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);x.code.add(c.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){function D(E){const A=new y.ShaderBuilder,{vertex:F,fragment:G}=A;q.addProjViewLocalOrigin(F,E);A.varyings.add("vpos","vec3");A.include(m.PathVertexPosition,E);if(E.output===g.ShaderOutput.Color||E.output===g.ShaderOutput.Alpha)A.include(k.Transform,E),A.include(x.ReadShadowMapDraw,E),A.include(b.ForwardLinearDepth,E),A.varyings.add("vnormal","vec3"),A.varyings.add("vcolor","vec4"),E.multipassEnabled&&A.varyings.add("depth","float"),F.code.add(r.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${E.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${E.output===g.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);A.include(h.multipassTerrainTest,E);switch(E.output){case g.ShaderOutput.Alpha:A.include(d.SliceDraw,E);G.uniforms.add(new v.FloatPassUniform("opacity",I=>I.opacity));G.code.add(r.glsl`
      void main() {
        discardBySlice(vpos);
        ${E.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case g.ShaderOutput.Color:A.include(d.SliceDraw,E);A.include(e.EvaluateSceneLighting,E);A.include(l.EvaluateAmbientOcclusion,E);A.include(x.ReadShadowMapDraw,E);A.include(u.Normals,E);q.addCameraPosition(G,E);e.addAmbientBoostFactor(G);e.addLightingGlobalFactor(G);G.uniforms.add(F.uniforms.get("localOrigin"),new t.Float3PassUniform("ambient",I=>I.ambient),new t.Float3PassUniform("diffuse",I=>I.diffuse),new t.Float3PassUniform("specular",I=>I.specular),new v.FloatPassUniform("opacity",
I=>I.opacity));G.include(n.ColorConversion);p.addMainLightIntensity(G);G.code.add(r.glsl`
        void main() {
          discardBySlice(vpos);
          ${E.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${E.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":E.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${E.transparencyPassType===z.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
        }
      `);break;case g.ShaderOutput.Depth:case g.ShaderOutput.Shadow:case g.ShaderOutput.ShadowHighlight:case g.ShaderOutput.ShadowExcludeHighlight:A.include(k.Transform,E);b.addNearFar(A);A.varyings.add("depth","float");F.code.add(r.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`);A.include(d.SliceDraw,E);A.include(f.OutputDepth,E);G.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case g.ShaderOutput.Normal:A.include(k.Transform,E);A.include(w.NormalUtils,E);q.addViewNormal(F);A.varyings.add("vnormal","vec3");F.code.add(r.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`);A.include(d.SliceDraw,E);G.code.add(r.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case g.ShaderOutput.Highlight:A.include(k.Transform,E),A.include(w.NormalUtils,E),A.varyings.add("vnormal","vec3"),F.code.add(r.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),A.include(d.SliceDraw,E),A.include(c.OutputHighlight,E),G.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return A}const C=Object.freeze(Object.defineProperty({__proto__:null,build:D},Symbol.toStringTag,{value:"Module"}));a.Path=C;a.build=D})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../chunks/earcut ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./lineUtils ./polygonUtils ../support/FastSymbolUpdates ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E){const A=["polyline","polygon","extent"],F=new n.ConvertOptions({size:!1,color:!0,rotation:!1,opacity:!1});class G extends p.Graphics3DSymbolLayer{constructor(L,J,M,T){super(L,J,M,T);this._needsUV=!1}async doLoad(){this._fastUpdates=n.initFastSymbolUpdatesState(this._context.renderer,F)}_createMaterials(){if(!(0<this._materials.length)){var L=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);this._materials[K.Fill]=q.createMaterial(this.symbolLayer,
{color:L,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters});this._needsUV=this._materials[K.Fill]instanceof C.PatternMaterial;L=this.symbolLayer.outline;if(this._isValidOutline(L)){const J=D.getStipplePatternForLinePattern(L.pattern);this._materials[K.Outline]=new E.RibbonLineMaterial({width:g.pt2px(L.size),color:this._getOutlineColor(),
hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:J,cap:w.parseCapType(L.patternCap||"butt")})}this._context.stage.addMany(this._materials)}}_isValidOutline(L){return null!=L?.size&&0<L.size&&null!=L.color&&(null==L.pattern||"style"!==L.pattern.type||"none"!==L.pattern.style)}destroy(){super.destroy();this._context.stage.removeMany(this._materials);this._materials.length=0}createGraphics3DGraphic(L){const J=L.graphic;if(!this._validateGeometry(J.geometry,
A,this.symbolLayer.type))return null;L=this._getVertexOpacityAndColor(L.renderingInfo,255);const M=this.setGraphicElevationContext(J);this.ensureDrapedStatus("on-the-ground"===M.mode);this._createMaterials();return this.draped?this._createAsOverlay(J,L):this._createAs3DShape(J,L,M)}applyRendererDiff(L,J){for(const M in L.diff)switch(M){case "visualVariables":if(n.updateFastSymbolUpdatesState(this._fastUpdates,J,F))this._materials[K.Fill]?.setParameters(this._fastUpdates.materialParameters);else return u.ApplyRendererDiffResult.RecreateSymbol;
break;default:return u.ApplyRendererDiffResult.RecreateSymbol}return u.ApplyRendererDiffResult.FastUpdate}layerOpacityChanged(){if(null!=this._materials[K.Fill]){var L=this._materials[K.Fill].parameters.color;const J=this._getCombinedOpacity(this.symbolLayer?.material?.color);this._materials[K.Fill].setParameters({color:[L[0],L[1],L[2],J],forceTransparentMode:this.needsDrivenTransparentPass})}null!=this._materials[K.Outline]&&(L=this._materials[K.Outline].parameters.color,this._materials[K.Outline].setParameters({color:[L[0],
L[1],L[2],this._getOutlineOpacity()]}))}layerElevationInfoChanged(L,J,M){const T=this._elevationContext.mode;M=c.elevationModeChangeUpdateType(G.elevationModeChangeTypes,M,T);if(M!==c.SymbolUpdateType.UPDATE)return M;const Q=c.needsElevationUpdates2D(T);return this.updateGraphics3DGraphicElevationInfo(L,J,()=>Q)}slicePlaneEnabledChanged(){this._materials[K.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._materials[K.Outline]&&this._materials[K.Outline].setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(L,J,M){const T=x.geometryAsPolygon(L.geometry);if(!T)return null;var Q=r.geometryToRenderInfo(T,this._context.elevationProvider,this._context.renderCoordsHelper,M);J=new H(Q,J,this._context.layer.uid,L.uid);Q=J.renderData.position.length/3;this._needsUV&&(J.uvMapSpace=f.newFloatArray(4*Q,!0),J.boundingRect=m.newDoubleArray(9*Q,!0),t.createMapSpaceUVCoords(J.uvMapSpace,J.boundingRect,J.renderData.position,this._context.renderCoordsHelper));
J.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(J);this._createAs3DShapeFill(L,J);this._materials[K.Outline]&&this._createAs3DShapeOutline(J);this._logGeometryCreationWarnings(J.renderData,T.rings,"rings","FillSymbol3DLayer");if(0===J.outGeometries.length)return null;L=new y.Object3D({geometries:J.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:L.uid});L=new e.Graphics3DObject3DGraphicLayer(this,L,J.outGeometries,null,null,q.uvElevationAligner,
M);L.alignedSampledElevation=J.renderData.sampledElevation;L.needsElevationUpdates=c.needsElevationUpdates2D(M.mode);return L}_createAs3DShapeFill(L,J){var M=J.renderData.polygons;for(const {position:T,mapPositions:Q,holeIndices:O,index:U,count:Z}of M){if(null!=this._context.clippingExtent&&(k.empty(I),k.expandWithBuffer(I,Q),!k.intersectsClippingArea(I,this._context.clippingExtent)))continue;M=x.createIndices3D(Q,O,this._context.elevationProvider.spatialReference);if(0===M.length)continue;const P=
this._fastUpdates?.visualVariables.color;M=x.createColorGeometry({material:this._materials[K.Fill],indices:M,mapPositions:Q,attributeData:{position:T,color:P?null:J.color,colorFeature:P?n.getAttributeValue(P.field,L):null,uvMapSpace:this._needsUV?f.floatSubArray(J.uvMapSpace,4*U,4*Z):null,boundingRect:this._needsUV?m.doubleSubArray(J.boundingRect,9*U,9*Z):null,objectAndLayerIdColor:J.objectAndLayerIdColor}});J.outGeometries.push(M)}}_createAs3DShapeOutline(L){if(null!=this._materials[K.Outline]){var J=
L.renderData.outlines;for(const {mapPositions:M,position:T}of J){if(null!=this._context.clippingExtent&&(k.empty(I),k.expandWithBuffer(I,M),!k.intersectsClippingArea(I,this._context.clippingExtent)))continue;J=v.createGeometry(this._materials[K.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:M,attributeData:{position:T}},L.objectAndLayerIdColor);L.outGeometries.push(J)}}}_createAsOverlay(L,J){const M=x.geometryAsPolygon(L.geometry);if(null==M)return null;this._materials[K.Fill].renderPriority=
this._renderPriority+this._renderPriorityStep/2;null!=this._materials[K.Outline]&&(this._materials[K.Outline].renderPriority=this._renderPriority);var T=r.geometryToRenderInfoDraped(M,this._context.overlaySR);J=new B(T,J,this._context.layer.uid,L.uid);T=J.renderData.position.length/3;this._needsUV&&(J.uvMapSpace=f.newFloatArray(4*T,!0),t.createMapSpaceUVCoordsDraped(J.uvMapSpace,J.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));J.outBoundingBox=
k.empty();J.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(J);this._createAsOverlayFill(L,J);this._materials[K.Outline]&&this._createAsOverlayOutline(J);this._logGeometryCreationWarnings(J.renderData,M.rings,"rings","FillSymbol3DLayer");return 0===J.outGeometries.length?null:new l.Graphics3DDrapedGraphicLayer(this,J.outGeometries,J.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(L,J){var M=J.renderData.polygons;for(const {position:Q,holeIndices:O,
index:U,count:Z}of M){var T=k.empty(I);k.expandWithBuffer(T,Q);k.intersectsClippingArea(T,this._context.clippingExtent)&&(M=d.earcut(Q,O,3),0!==M.length&&(k.expandWithAABB(J.outBoundingBox,T),T=this._fastUpdates?.visualVariables.color,M=x.createColorGeometry({material:this._materials[K.Fill],indices:M,attributeData:{position:Q,color:T?null:J.color,colorFeature:T?n.getAttributeValue(T.field,L):null,uvMapSpace:this._needsUV?f.floatSubArray(J.uvMapSpace,4*U,4*Z):null,objectAndLayerIdColor:J.objectAndLayerIdColor}}),
J.outGeometries.push(new z.RenderGeometry(M,J))))}}_createAsOverlayOutline(L){if(null!=this._materials[K.Outline]){var J=L.renderData.outlines;for(let T=0;T<J.length;++T){var {position:M}=J[T];k.empty(I);k.expandWithBuffer(I,M);k.intersectsClippingArea(I,this._context.clippingExtent)&&(k.expandWithAABB(L.outBoundingBox,I),M=v.createGeometry(this._materials[K.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,
attributeData:{position:M}},L.objectAndLayerIdColor),L.outGeometries.push(new z.RenderGeometry(M,L)))}}}_getOutlineOpacity(){const L=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=L?L.a:0)}_getOutlineColor(){const L=this.symbolLayer?.outline?.color,J=this._getOutlineOpacity();return h.mixinColorAndOpacity(null!=L?b.toUnitRGB(L):null,J)}test(){return{...super.test(),createAsOverlay:(L,J)=>this._createAsOverlay(L,J),createAs3DShape:(L,J,M)=>this._createAs3DShape(L,
J,M)}}}G.elevationModeChangeTypes={definedChanged:c.SymbolUpdateType.RECREATE,staysOnTheGround:c.SymbolUpdateType.NONE,onTheGroundChanged:c.SymbolUpdateType.RECREATE};const I=k.create();class H extends x.PolygonCreationDataBase{constructor(L,J,M,T){super(L,M,T);this.color=J}}class B extends x.PolygonCreationDataBase{constructor(L,J,M,T){super(L,M,T);this.color=J}}var K;(function(L){L[L.Fill=0]="Fill";L[L.Outline=1]="Outline"})(K||(K={}));a.Graphics3DPolygonFillSymbolLayer=G;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../chunks/vec4f64 ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),function(a,b,g,d,k,m,f,c,l){function e(u){switch(u){case "horizontal":return l.Style.Horizontal;case "vertical":return l.Style.Vertical;
case "cross":return l.Style.Cross;case "forward-diagonal":return l.Style.ForwardDiagonal;case "backward-diagonal":return l.Style.BackwardDiagonal;case "diagonal-cross":return l.Style.DiagonalCross}}function p(u){return u.material instanceof c.PatternMaterial&&!u.material.parameters.draped}function h(u,w){if(p(u)){const x=u.attributes.get(m.VertexAttribute.POSITION).data,n=u.getMutableAttribute(m.VertexAttribute.UVMAPSPACE).data;u=u.getMutableAttribute(m.VertexAttribute.BOUNDINGRECT).data;k.createMapSpaceUVCoords(n,
u,x,w)}}a.createMaterial=function(u,w){u=u?.pattern??null;if(null==u)return new f.ColorMaterial(w);if("none"===u.style||"solid"===u.style)return"none"===u.style&&(w.color=g.fromValues(0,0,0,0),w.forceTransparentMode=!0),new f.ColorMaterial(w);w.style=e(u.style);return new c.PatternMaterial(w)};a.parsePatternStyle=e;a.requiresUVUpdates=p;a.updateMapSpaceUVCoords=h;a.uvElevationAligner=function(u,w,x,n,q){w=d.perVertexElevationAligner(u,w,x,n,q);u=u.stageObject.geometries;for(const t of u)h(t,q);return w};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectors ../../../../geometry/support/DoubleArray ../../../../geometry/support/plane ../../../ViewingMode".split(" "),function(a,b,g,d,k,m,f,c,l,e,p){function h(I,H,B,K,L,J,
M){k.set(I,H*L[0]+B*J[0]+K*M[0],H*L[1]+B*J[1]+K*M[1],H*L[2]+B*J[2]+K*M[2])}const u=m.create(),w=m.create(),x=e.create(),n=m.create(),q=m.create(),t=m.create(),v=d.create(),r=d.create(),y=m.create(),z=m.create(),D=m.create(),C=b.create(),E=m.create(),A=m.create(),F=m.create(),G=m.create();a.createMapSpaceUVCoords=function(I,H,B,K,L=1){k.set(n,1,0,0);k.set(q,0,1,0);k.set(t,0,0,1);k.set(G,0,0,0);for(var J=0;J<B.length-3;J+=3)G[0]+=B[J],G[1]+=B[J+1],G[2]+=B[J+2];k.scale(u,G,1/(B.length/3-1));if(e.fromArray(x,
B)){null!=K?(K.basisMatrixAtPosition(u,C),k.set(E,C[0],C[1],C[2]),k.set(A,C[4],C[5],C[6]),k.set(F,C[8],C[9],C[10])):(k.set(E,1,0,0),k.set(A,0,1,0),k.set(F,0,0,1));K=e.normal(x);0>k.dot(K,F)&&k.scale(K,K,-1);k.copy(t,K);J=k.dot(K,A);var M=k.dot(K,E);Math.abs(J)>Math.abs(M)?(k.scaleAndAdd(n,E,K,-M),k.normalize(n,n),k.cross(q,n,K),k.normalize(q,q),k.scale(q,q,-1)):(k.scaleAndAdd(q,A,K,-J),k.normalize(q,q),k.cross(n,q,K),k.normalize(n,n))}g.set(v,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);g.set(r,
Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(K=0;K<B.length;K+=3)k.set(w,B[K],B[K+1],B[K+2]),J=k.dot(n,w),M=k.dot(q,w),v[0]=Math.min(v[0],J),v[1]=Math.min(v[1],M),r[0]=Math.max(r[0],J),r[1]=Math.max(r[1],M);K=k.dot(t,u);h(y,v[0],v[1],K,n,q,t);h(z,r[0],v[1],K,n,q,t);h(D,v[0],r[1],K,n,q,t);k.subtract(z,z,y);k.scale(z,z,.5);k.subtract(D,D,y);k.scale(D,D,.5);k.add(y,y,z);k.add(y,y,D);K=v[0]-v[0]%L;J=v[1]-v[1]%L;for(M=0;M<B.length;M+=3){k.set(w,B[M],B[M+1],B[M+2]);var T=M/3,Q=4*T;I[Q]=(k.dot(n,
w)-K)/L;I[Q+1]=(k.dot(q,w)-J)/L;I[Q+2]=K/L;I[Q+3]=J/L;T*=9;for(Q=0;3>Q;Q++)H[T+Q]=y[Q],H[T+Q+3]=z[Q],H[T+Q+6]=D[Q]}};a.createMapSpaceUVCoordsDraped=function(I,H,B,K,L=1){if(B.isGeographic&&K===p.ViewingMode.Global){K=l.newDoubleArray(H.length);var J=H.length;B=f.getReferenceEllipsoid(B);for(var M=0;M<J;M+=3)c.lonLatToWebMercatorComparable(H,M,K,M,B);H=K}g.set(v,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(K=0;K<H.length;K+=3)v[0]=Math.min(v[0],H[K]),v[1]=Math.min(v[1],H[K+1]);K=v[0]-v[0]%
L;J=v[1]-v[1]%L;for(B=0;B<H.length;B+=3)M=B/3*4,I[M]=(H[B]-K)/L,I[M+1]=(H[B+1]-J)/L,I[M+2]=K/L,I[M+3]=J/L};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../core/has ../../../../chunks/vec4f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./TriangleMaterial ./VisualVariablePassParameters ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){class n extends h.TriangleMaterial{constructor(v){super(v,new t);this.supportsEdges=!0;this._configuration=new x.ColorMaterialTechniqueConfiguration}getConfiguration(v,r){this._configuration.output=v;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this._isTransparent;
this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=r.transparencyPassType;this._configuration.enableOffset=r.camera.relativeElevation<c.OITPolygonOffsetLimit;this._configuration.multipassEnabled=r.multipassEnabled;this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;
return this._configuration}produces(v,r){return r===k.ShaderOutput.Color||r===k.ShaderOutput.Alpha||r===k.ShaderOutput.Highlight||r===k.ShaderOutput.Depth&&this.parameters.writeLinearDepth||r===k.ShaderOutput.ObjectAndLayerIdColor?v===l.RenderSlot.DRAPED_MATERIAL?!0:r===k.ShaderOutput.Highlight?v===l.RenderSlot.OPAQUE_MATERIAL:v===(this._isTransparent?this.parameters.writeDepth?l.RenderSlot.TRANSPARENT_MATERIAL:l.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:l.RenderSlot.OPAQUE_MATERIAL):!1}createGLMaterial(v){return new q(v)}createBufferWriter(){const v=
d.newLayout().vec3f(e.VertexAttribute.POSITION);b("enable-feature:objectAndLayerId-rendering")&&v.vec4u8(e.VertexAttribute.OBJECTANDLAYERIDCOLOR);this.parameters.vvColor?v.f32(e.VertexAttribute.COLORFEATUREATTRIBUTE):v.vec4u8(e.VertexAttribute.COLOR);return new p.DefaultBufferWriter(v)}get _isTransparent(){return 1>this.parameters.color[3]||this.parameters.forceTransparentMode}}class q extends f{_updateOccludeeState(v){v.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:v.hasOccludees})}beginSlot(v){this._output!==
k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(v);return this.ensureTechnique(w.ColorMaterialTechnique,v)}}class t extends u.VisualVariablePassParameters{constructor(){super(...arguments);this.color=g.ZEROS;this.forceTransparentMode=!1;this.writeDepth=!0;this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=m.CullFaceOptions.None;this.hasOccludees=!1}}a.ColorMaterial=n;a.Parameters=t;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/VisualVariablePassParameters ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){class x extends h.VisualVariablePassParameters{constructor(){super(...arguments);this.color=g.ZEROS}}class n extends m.ShaderTechnique{initializeProgram(t){return new l.Program(t.rctx,n.shader.get().build(this.configuration),f.Default3D)}_createPipeline(t,v){const r=this.configuration,y=t===p.TransparencyPassType.NONE,z=t===p.TransparencyPassType.FrontFace;return w.makePipelineState({blending:r.output!==d.ShaderOutput.Color&&r.output!==d.ShaderOutput.Alpha||!r.transparent?
null:y?c.blendingDefault:c.oitBlending(t),culling:w.cullingParams(r.cullFace),depthTest:{func:c.oitDepthTest(t)},depthWrite:y||z?r.writeDepth?w.defaultDepthWriteParams:null:null,colorWrite:w.defaultColorWriteParams,stencilWrite:r.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:r.hasOccludees?v?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:y||z?r.polygonOffset?q:null:c.getOITPolygonOffset(r.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,
!0);return this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}n.shader=new k.ReloadableShaderModule(u.ColorMaterial,()=>new Promise((t,v)=>a(["./ColorMaterial.glsl"],t,v)));const q={factor:1,units:1};b.ColorMaterialPassParameters=x;b.ColorMaterialTechnique=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){function r(z){const D=new q.ShaderBuilder,{vertex:C,fragment:E,attributes:A,varyings:F}=D;w.addProjViewLocalOrigin(C,z);D.include(k.Transform,z);D.include(f.VertexColor,z);D.include(p.VisualVariables,z);D.include(m.ObjectAndLayerIdColor,z);A.add(v.VertexAttribute.POSITION,"vec3");z.vvColor&&A.add(v.VertexAttribute.COLORFEATUREATTRIBUTE,"float");F.add("vColor","vec4");F.add("vpos","vec3");const G=z.multipassEnabled&&(z.output===g.ShaderOutput.Color||
z.output===g.ShaderOutput.Alpha);G&&F.add("depth","float");C.uniforms.add(new x.Float4PassUniform("eColor",H=>H.color));var I=z.output===g.ShaderOutput.Depth;I&&(D.include(c.OutputDepth,z),b.addNearFar(D),b.addLinearDepth(D));C.code.add(n.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${z.hasVertexColors?"vColor *\x3d eColor;":z.vvColor?"vColor \x3d eColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d eColor;"}
      ${G?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${I?n.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:n.glsl`transformPosition(proj, view, vpos);`}
    }
  `);D.include(d.SliceDraw,z);G&&D.include(e.multipassTerrainTest,z);E.include(u.ColorConversion);(I=z.output===g.ShaderOutput.Highlight)&&D.include(l.OutputHighlight,z);E.code.add(n.glsl`
  void main() {
    discardBySlice(vpos);
    ${G?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${z.output===g.ShaderOutput.ObjectAndLayerIdColor?n.glsl`fColor.a = 1.0;`:""}

    if (fColor.a < ${n.glsl.float(h.symbolAlphaCutoff)}) {
      discard;
    }

    ${z.output===g.ShaderOutput.Alpha?n.glsl`fragColor = vec4(fColor.a);`:""}

    ${z.output===g.ShaderOutput.Color?n.glsl`fragColor = highlightSlice(fColor, vpos); ${z.transparencyPassType===t.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
    ${I?n.glsl`outputHighlight();`:""};
    ${z.output===g.ShaderOutput.Depth?n.glsl`outputDepth(linearDepth);`:""};
    ${z.output===g.ShaderOutput.ObjectAndLayerIdColor?n.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return D}const y=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=y;a.build=r})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,g,d,k,m,f){class c extends f.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.output=g.ShaderOutput.Color;this.cullFace=k.CullFaceOptions.None;this.transparencyPassType=m.TransparencyPassType.NONE;this.polygonOffset=this.transparent=this.hasVertexColors=this.hasSlicePlane=!1;this.writeDepth=this.enableOffset=!0;this.vvColor=this.objectAndLayerIdColorInstanced=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=!1}}b.__decorate([d.parameter({count:g.ShaderOutput.COUNT})],c.prototype,"output",void 0);b.__decorate([d.parameter({count:k.CullFaceOptions.COUNT})],c.prototype,
"cullFace",void 0);b.__decorate([d.parameter({count:m.TransparencyPassType.COUNT})],c.prototype,"transparencyPassType",void 0);b.__decorate([d.parameter()],c.prototype,"hasSlicePlane",void 0);b.__decorate([d.parameter()],c.prototype,"hasVertexColors",void 0);b.__decorate([d.parameter()],c.prototype,"transparent",void 0);b.__decorate([d.parameter()],c.prototype,"polygonOffset",void 0);b.__decorate([d.parameter()],c.prototype,"enableOffset",void 0);b.__decorate([d.parameter()],c.prototype,"writeDepth",
void 0);b.__decorate([d.parameter()],c.prototype,"hasOccludees",void 0);b.__decorate([d.parameter()],c.prototype,"multipassEnabled",void 0);b.__decorate([d.parameter()],c.prototype,"cullAboveGround",void 0);b.__decorate([d.parameter()],c.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([d.parameter()],c.prototype,"vvColor",void 0);b.__decorate([d.parameter({constValue:!1})],c.prototype,"occlusionPass",void 0);b.__decorate([d.parameter({constValue:!0})],c.prototype,"hasVvInstancing",
void 0);b.__decorate([d.parameter({constValue:!1})],c.prototype,"vvSize",void 0);b.__decorate([d.parameter({constValue:!1})],c.prototype,"vvOpacity",void 0);a.ColorMaterialTechniqueConfiguration=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./VisualVariablePassParameters ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){class t extends w.TriangleMaterial{constructor(z){super(z,new y);this.supportsEdges=!0;this._vertexAttributeLocations=q.vertexAttributeLocations;this._configuration=new q.PatternTechniqueConfiguration}getConfiguration(z,D){this._configuration.output=z;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;
this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=D.transparencyPassType;this._configuration.enableOffset=D.camera.relativeElevation<c.OITPolygonOffsetLimit;this._configuration.multipassEnabled=
D.multipassEnabled;this._configuration.cullAboveGround=D.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;return this._configuration}produces(z,D){return D===k.ShaderOutput.Color||D===k.ShaderOutput.Alpha||D===k.ShaderOutput.Highlight||D===k.ShaderOutput.Depth&&this.parameters.writeLinearDepth?z===l.RenderSlot.DRAPED_MATERIAL?!0:D===k.ShaderOutput.Highlight?z===l.RenderSlot.OPAQUE_MATERIAL:z===(this.parameters.writeDepth?l.RenderSlot.TRANSPARENT_MATERIAL:l.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):
!1}createGLMaterial(z){return new v(z)}createBufferWriter(){const z=d.newLayout().vec3f(p.VertexAttribute.POSITION).vec4f(p.VertexAttribute.UVMAPSPACE);this.parameters.draped||z.mat3f(p.VertexAttribute.BOUNDINGRECT);this.parameters.vvColor?z.f32(p.VertexAttribute.COLORFEATUREATTRIBUTE):z.vec4u8(p.VertexAttribute.COLOR);return new r(z)}}class v extends f{_updateParameters(z){return this.ensureTechnique(q.PatternTechnique,z)}_updateOccludeeState(z){z.hasOccludees!==this._material.parameters.hasOccludees&&
this._material.setParameters({hasOccludees:z.hasOccludees})}beginSlot(z){this._output!==k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(z);return this._updateParameters(z)}}class r extends h.DefaultBufferWriter{write(z,D,C,E,A){for(const G of this.vertexBufferLayout.fields.keys()){const I=C.attributes.get(G);var F=I?.indices;if(I&&F)switch(G){case p.VertexAttribute.UVMAPSPACE:e.assert(4===I.size);(F=E.getField(G,g.BufferViewVec4f))&&n.writeBufferVec4(I,F,A);break;
case p.VertexAttribute.BOUNDINGRECT:e.assert(9===I.size);(F=E.getField(G,g.BufferViewMat3f))&&this.writeBoundingRect(I,z,F,A);break;default:n.writeDefaultAttribute(G,I,z,D,E,A)}}}writeBoundingRect(z,D,C,E){const {data:A,indices:F}=z;z=C.typedBuffer;C=C.typedBufferStride;const G=F.length;E*=C;for(let H=0;H<G;++H){const B=9*F[H];var I=A[B];const K=A[B+1],L=A[B+2];z[E]=D[0]*I+D[4]*K+D[8]*L+D[12];z[E+1]=D[1]*I+D[5]*K+D[9]*L+D[13];z[E+2]=D[2]*I+D[6]*K+D[10]*L+D[14];for(I=3;9>I;++I)z[E+I]=A[B+I];E+=C}}}
class y extends x.VisualVariablePassParameters{constructor(){super(...arguments);this.color=b.fromValues(1,1,1,1);this.writeDepth=!0;this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=m.CullFaceOptions.None;this.hasOccludees=!1;this.style=u.Style.Cross;this.patternSpacing=10;this.lineWidth=1;this.draped=!0}}a.Parameters=y;a.PatternMaterial=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],
function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){class t extends m.ShaderTechnique{initializeProgram(z){return new e.Program(z.rctx,t.shader.get().build(this.configuration),y)}_setPipelineState(z,D){const C=this.configuration,E=z===h.TransparencyPassType.NONE,A=z===h.TransparencyPassType.FrontFace;return q.makePipelineState({blending:C.output===d.ShaderOutput.Color||C.output===d.ShaderOutput.Alpha?E?l.blendingDefault:l.oitBlending(z):null,culling:q.cullingParams(C.cullFace),depthTest:{func:l.oitDepthTest(z)},
depthWrite:E?C.writeDepth?q.defaultDepthWriteParams:null:l.oitDepthWrite(z),colorWrite:q.defaultColorWriteParams,stencilWrite:C.hasOccludees?p.stencilWriteMaskOn:null,stencilTest:C.hasOccludees?D?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null,polygonOffset:E||A?C.polygonOffset?v:null:l.getOITPolygonOffset(C.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,
!1)}getPipeline(z){return z?this._occludeePipelineState:super.getPipeline()}}t.shader=new k.ReloadableShaderModule(n.Pattern,()=>new Promise((z,D)=>a(["./Pattern.glsl"],z,D)));const v={factor:1,units:1};class r extends w.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=d.ShaderOutput.Color;this.cullFace=c.CullFaceOptions.None;this.transparencyPassType=h.TransparencyPassType.NONE;this.polygonOffset=this.hasVertexColors=this.hasSlicePlane=!1;this.writeDepth=!0;this.hasOccludees=
!1;this.enableOffset=!0;this.vvColor=this.cullAboveGround=this.multipassEnabled=!1}}g.__decorate([f.parameter({count:d.ShaderOutput.COUNT})],r.prototype,"output",void 0);g.__decorate([f.parameter({count:c.CullFaceOptions.COUNT})],r.prototype,"cullFace",void 0);g.__decorate([f.parameter({count:x.Style.COUNT})],r.prototype,"style",void 0);g.__decorate([f.parameter({count:h.TransparencyPassType.COUNT})],r.prototype,"transparencyPassType",void 0);g.__decorate([f.parameter()],r.prototype,"hasSlicePlane",
void 0);g.__decorate([f.parameter()],r.prototype,"hasVertexColors",void 0);g.__decorate([f.parameter()],r.prototype,"polygonOffset",void 0);g.__decorate([f.parameter()],r.prototype,"writeDepth",void 0);g.__decorate([f.parameter()],r.prototype,"hasOccludees",void 0);g.__decorate([f.parameter()],r.prototype,"patternSpacing",void 0);g.__decorate([f.parameter()],r.prototype,"lineWidth",void 0);g.__decorate([f.parameter()],r.prototype,"enableOffset",void 0);g.__decorate([f.parameter()],r.prototype,"draped",
void 0);g.__decorate([f.parameter()],r.prototype,"multipassEnabled",void 0);g.__decorate([f.parameter()],r.prototype,"cullAboveGround",void 0);g.__decorate([f.parameter()],r.prototype,"vvColor",void 0);g.__decorate([f.parameter({constValue:!1})],r.prototype,"occlusionPass",void 0);g.__decorate([f.parameter({constValue:!1})],r.prototype,"hasVvInstancing",void 0);g.__decorate([f.parameter({constValue:!1})],r.prototype,"vvSize",void 0);g.__decorate([f.parameter({constValue:!1})],r.prototype,"vvOpacity",
void 0);const y=new Map([[u.VertexAttribute.POSITION,0],[u.VertexAttribute.COLOR,3],[u.VertexAttribute.UVMAPSPACE,4],[u.VertexAttribute.COLORFEATUREATTRIBUTE,5],[u.VertexAttribute.BOUNDINGRECT,6]]);b.PatternTechnique=t;b.PatternTechniqueConfiguration=r;b.vertexAttributeLocations=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){function y(C){const E=new q.ShaderBuilder,A=C.multipassEnabled&&(C.output===g.ShaderOutput.Color||C.output===g.ShaderOutput.Alpha),{vertex:F,fragment:G,attributes:I,varyings:H}=E;u.addProjViewLocalOrigin(F,C);E.include(k.Transform,C);E.include(m.VertexColor,C);E.include(e.VisualVariables,C);C.draped?F.uniforms.add(new x.FloatPassUniform("worldToScreenRatio",(K,L)=>1/L.screenToPCSRatio)):I.add(v.VertexAttribute.BOUNDINGRECT,"mat3");I.add(v.VertexAttribute.POSITION,
"vec3");I.add(v.VertexAttribute.UVMAPSPACE,"vec4");C.vvColor&&I.add(v.VertexAttribute.COLORFEATUREATTRIBUTE,"float");H.add("vColor","vec4");H.add("vpos","vec3");H.add("vuv","vec2");A&&H.add("depth","float");F.uniforms.add(new w.Float4PassUniform("uColor",K=>K.color));var B=C.style===r.Style.ForwardDiagonal||C.style===r.Style.BackwardDiagonal||C.style===r.Style.DiagonalCross;B&&F.code.add(n.glsl`
      const mat2 rotate45 = mat2(${n.glsl.float(.70710678118)}, ${n.glsl.float(-.70710678118)},
                                 ${n.glsl.float(.70710678118)}, ${n.glsl.float(.70710678118)});
    `);C.draped||(u.addCameraPosition(F,C),F.uniforms.add(new x.FloatPassUniform("worldToScreenPerDistanceRatio",(K,L)=>1/L.camera.perScreenPixelRatio)),F.code.add(n.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),F.code.add(n.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),F.code.add(n.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${n.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));F.code.add(n.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${B?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${B?" * rotate45":""};

      ${C.draped?"":n.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${n.glsl.float(C.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);if(B=C.output===g.ShaderOutput.Depth)E.include(f.OutputDepth,C),b.addNearFar(E),b.addLinearDepth(E);F.code.add(n.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${A?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${C.hasVertexColors?"vColor *\x3d uColor;":C.vvColor?"vColor \x3d uColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d uColor;"}
      gl_Position = ${B?n.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:n.glsl`transformPosition(proj, view, vpos);`}
    }
  `);E.include(d.SliceDraw,C);G.include(h.ColorConversion);C.draped&&G.uniforms.add(new x.FloatPassUniform("texelSize",(K,L)=>1/L.camera.pixelRatio));C.output===g.ShaderOutput.Highlight&&E.include(c.OutputHighlight,C);A&&E.include(l.multipassTerrainTest,C);C.output!==g.ShaderOutput.Highlight&&(G.code.add(n.glsl`
      const float lineWidth = ${n.glsl.float(C.lineWidth)};
      const float spacing = ${n.glsl.float(C.patternSpacing)};
      const float spacingINV = ${n.glsl.float(1/C.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),C.draped||G.code.add(n.glsl`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));G.code.add(n.glsl`
    void main() {
      discardBySlice(vpos);
      ${A?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${C.output!==g.ShaderOutput.Highlight?n.glsl`color.a *= ${z(C)};`:""}

      ${C.output===g.ShaderOutput.ObjectAndLayerIdColor?n.glsl`color.a = 1.0;`:""}

      if (color.a < ${n.glsl.float(p.symbolAlphaCutoff)}) {
        discard;
      }

      ${C.output===g.ShaderOutput.Alpha?n.glsl`fragColor = vec4(color.a);`:""}

      ${C.output===g.ShaderOutput.Color?n.glsl`fragColor = color; ${C.transparencyPassType===t.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
      ${C.output===g.ShaderOutput.Highlight?n.glsl`outputHighlight();`:""}
      ${C.output===g.ShaderOutput.Depth?n.glsl`outputDepth(linearDepth);`:""};
    }
  `);return E}function z(C){function E(A){return C.draped?n.glsl`coverage(vuv.${A}, texelSize)`:n.glsl`sampleAA(vuv.${A})`}switch(C.style){case r.Style.ForwardDiagonal:case r.Style.Horizontal:return E("y");case r.Style.BackwardDiagonal:case r.Style.Vertical:return E("x");case r.Style.DiagonalCross:case r.Style.Cross:return n.glsl`
        1.0 - (1.0 - ${E("x")}) * (1.0 - ${E("y")})
      `;default:return"0.0"}}const D=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.Pattern=D;a.build=y})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../core/Error ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./LabelParameters ./placementUtils ./pointUtils ../../webgl-engine/lib/FontMetrics ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y){function z(F,G,I){F&&F.forEach(H=>{const B=G(H);null!=B&&I(B,H.graphic)})}function D(F,G){if("baseline"===G.verticalPlacement)return k.fromValues(x.horizontalPlacementToAnchorX[G.horizontalPlacement],null!=F?F.baselineAnchorY:0);F=x.anchorFromPlacements(G.horizontalPlacement,G.verticalPlacement);return x.namedAnchorToHUDMaterialAnchorPos[F]}const C=[0,0,1];class E extends h.Graphics3DSymbolLayer{constructor(F,G,I,H){super(F,G,I,H);this._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const F=u.validateSymbolLayerSize(this.symbolLayer.size);if(F)throw new b("graphics3dtextsymbollayer:invalid-size",F);}await this._createTextRenderParameters()}async _createTextRenderParameters(){this._textRenderParameters=await v.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.rasterPixelRatio)}destroy(){super.destroy()}createGraphics3DGraphic(F){F=
F.graphic;const G=n.placePointOnGeometry(F.geometry);if(null==G)return this.logger.warn(`unsupported geometry type for text symbol: ${F.geometry.type}`),null;const I=this.symbolLayer.text;if(null==I||""===I)return null;var H=m.hasCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=H&&!m.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+
`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;var {verticalAlignment:B}=this.symbolLayer;H=new w.LabelPlacement(H);x.verticalScreenOffsetFromAlignment(B,H.screenOffset);B=new w.LabelParameters(H,this.symbolLayer.horizontalAlignment,x.verticalPlacementFromAlignment(B));return this._createAs3DShape(F,G,I,B)}createLabel(F,G,I,H,B){F=F.graphic;const K=n.placePointOnGeometry(F.geometry);if(null==K)return this.logger.warn(`unsupported geometry type for label: ${F.geometry.type}`),
null;const L=G.text;return!L||/^\s+$/.test(L)?null:this._createAs3DShape(F,K,L,G,I,H,B)}setGraphicElevationContext(F,G,I=0){super.setGraphicElevationContext(F,G);G.addOffsetRenderUnits(I);return G}layerOpacityChanged(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1}layerElevationInfoChanged(F,G){z(F,G,(I,H)=>{this.updateGraphicElevationContext(H,I)});return c.SymbolUpdateType.UPDATE}slicePlaneEnabledChanged(F,G){z(F,G,I=>{for(const H of I.stageObject.geometries)H.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});
return!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(F,G){const I=G.elevationContext;this.setGraphicElevationContext(F,I,null!=G.metadata?G.metadata.elevationOffset:0);G.needsElevationUpdates=c.needsElevationUpdates2D(I.mode)||"absolute-height"===I.mode}_defaultElevationInfoNoZ(){return A}_createAs3DShape(F,G,I,H,B=null,K=null,L=()=>H.placement.elevationOffset){const J=this.setGraphicElevationContext(F,new l.ElevationContext,H.placement.elevationOffset);
var M="polyline"===F.geometry?.type,T=F.uid;let Q=null,O=null;if(null==K){var U=x.textRenderAlignmentFromHorizontalPlacement(H.horizontalPlacement);Q=new r(I,U,this._textRenderParameters);let Z=null;if(null!=this._context.sharedResources.textures){O=this._context.sharedResources.textures.fromData(Q.key,()=>Q.create());O.texture.events.on("unloaded",()=>Z?.release());U=this._context.stage.renderView.textureRepository.acquire(O.texture.id);if(null==U||g.isPromiseLike(U))return O.release(),null;Z=U}}U=
D(Q,H);U={occlusionTest:!0,screenOffset:H.placement.screenOffset,anchorPosition:U,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:H.placement.centerOffsetUnits,drawInSecondSlot:!0};K?U.textureId=K.id:O&&(U.textureId=O.texture.id);if(null!=H.placement.verticalOffset){const {screenLength:Z,minWorldLength:P,maxWorldLength:R}=H.placement.verticalOffset;U.verticalOffset={screenLength:d.pt2px(Z),minWorldLength:P||0,maxWorldLength:null!=R?R:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:Z,
screenSizePerspectiveSettingsLabels:P}=this._context.sharedResources;K=q.getFontMetrics(this._textRenderParameters);U.screenSizePerspective=P.overrideFontHeight(K.maxHeight);U.screenSizePerspectiveAlignment=Z}M&&(U.shaderPolygonOffset=1E-4);U.hasSlicePlane=this._context.slicePlaneEnabled;M=(Z,P)=>{const R=JSON.stringify(P);let W=Z.get(R);null==W&&(W=new y.HUDMaterial(P),Z.add(R,W));return W};M=B?M(B,U):new y.HUDMaterial(U);K=H.placement.translation;U=Q?k.fromValues(Q.displayWidth,Q.displayHeight):
k.ZEROS;K=t.createPointGeometry(M,C,K,null,U,H.placement.centerOffset,[0,0],null);T=n.createStageObject(this._context,G,K,J,T);if(null==T)return null;B=new e.Graphics3DObject3DGraphicLayer(this,T.object,[K],null==B?[M]:null,O,(Z,P,R,W,N,V)=>{const S=L()||H.placement.elevationOffset;P=this.setGraphicElevationContext(F,P,S);return f.perObjectElevationAligner(Z,P,R,W,N,V)},J);B.alignedSampledElevation=T.sampledElevation;B.needsElevationUpdates=c.needsElevationUpdates2D(J.mode)||"absolute-height"===J.mode;
B.getScreenSize=(Z=k.create())=>{Z[0]=Q?Q.displayWidth:H.displaySize[0];Z[1]=Q?Q.displayHeight:H.displaySize[1];return Z};I=new p.Graphics3DObjectMetadata(H.placement.elevationOffset,I);B.metadata=I;n.extendPointGraphicElevationContext(B,G,this._context.elevationProvider);return B}}const A={mode:"relative-to-ground",offset:0};a.Graphics3DTextSymbolLayer=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelParameters":function(){define(["exports","../../../../chunks/vec2f64",
"../../../../chunks/vec3f64","../../../../chunks/vec4f64"],function(a,b,g,d){class k{constructor(f,c="center",l=!1,e=b.create(),p=d.fromValues(0,0,0,-1),h="world",u=g.create(),w=0){this.verticalOffset=f;this.anchor=c;this.hasLabelVerticalOffset=l;this.screenOffset=e;this.centerOffset=p;this.centerOffsetUnits=h;this.translation=u;this.elevationOffset=w}}class m{constructor(f,c="center",l="center",e=null,p=b.create()){this.placement=f;this.horizontalPlacement=c;this.verticalPlacement=l;this.text=e;
this.displaySize=p}}a.LabelParameters=m;a.LabelPlacement=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../Color ../../../../core/fontUtils ../../../../core/Logger ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),function(a,b,g,d,k,m){class f{constructor(l){this.definition=l;this.key=JSON.stringify(l);this.haloSize=Math.round(l.halo.size);this.textStyle=this._colorToRGBA(l.color);
this.haloStyle=this._colorToRGB(l.halo.color);this.backgroundStyle=0!==l.background.color[3]?this._colorToRGBA(l.background.color):null}fontString(l){const e=this.definition.font;return`${e.style} ${e.weight} ${l}px ${e.family}, ${"sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji"}`}setFontProperties(l,e){l.font=this.fontString(e);l.textAlign="left";l.textBaseline="alphabetic"}_colorToRGB(l){return`rgb(${l.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}_colorToRGBA(l){return`rgba(${l.slice(0,
3).map(e=>Math.floor(255*e)).toString()},${l[3]})`}static async fromSymbol(l,e){var p=b.toUnitRGBA(l?.material?.color)??m.ZEROS,h=null!=l.size?k.pt2px(l.size):12;const u=l.lineHeight,w=null!=l.background?b.toUnitRGBA(l.background.color):m.ZEROS,x={family:l.font?.family??"sans-serif",decoration:l.font?.decoration??"none",weight:l.font?.weight??"normal",style:l.font?.style??"normal"};var n=l.halo;n=null!=n?.color&&0<n.size?{size:k.pt2px(n.size),color:b.toUnitRGBA(n.color)}:{size:0,color:m.ZEROS};e=
new f({color:p,size:h,background:{color:w,padding:null!=l.background?[.65*h,.5*h]:[0,0],borderRadius:null!=l.background?.375*h:0},lineSpacingFactor:u,font:x,halo:n,pixelRatio:e});if(l.font){p=!1;h=e.fontString(h);try{p=(await document.fonts.load(h)).some(q=>!g.isCachedFontFace(q))}catch(q){d.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${h}'. Some text symbology may be rendered using the default browser font.`)}if(!p&&!c.has(l.font.family))try{await g.loadFont(l.font)}catch(q){}}return e}}
const c=new Set("Arial;Times New Roman;Courier New;serif;sans-serif;monospace;cursive;fantasy;system-ui;ui-serif;ui-sans-serif;ui-monospace;ui-rounded;math;emoji;fangsong".split(";"));a.TextRenderParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(a,b){function g(c){if(!c)return"arial-unicode-ms";c=c.toLowerCase().split(" ").join("-");switch(c){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";
case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return c}}function d(c){a:{if(c.weight)switch(c.weight.toLowerCase()){case "bold":case "bolder":var l="-bold";break a}l=""}a:{if(c.style)switch(c.style.toLowerCase()){case "italic":case "oblique":var e="-italic";break a}e=""}l+=e;return g(c.family)+(0<l.length?l:"-regular")}const k=new Map,m=new Set;class f{constructor(c,l){this.fontFace=c;this.promise=l}}a.clearFonts=function(){const c=
document.fonts;k.forEach(l=>{c.delete(l.fontFace)});k.clear();m.clear()};a.defaultFontFamily="arial-unicode-ms";a.getFontFamily=g;a.getFullyQualifiedFontName=d;a.isCachedFontFace=function(c){return m.has(c)};a.loadFont=async function(c){const l=d(c),e=k.get(l);if(e)return e.promise;const p=new FontFace(c.family,`url('${b.fontsUrl}/woff2/${l}.${"woff2"}') format('${"woff2"}')`,{style:c.style,weight:c.weight}),h=document.fonts;if(h.has(p)&&"loading"===p.status)return p.loaded;c=p.load().then(()=>{h.add(p);
return p});k.set(l,new f(p,c));m.add(p);return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["./TextHelperCanvas","./TextRenderer","./TextTextureAtlas","./Texture","../../../webgl/enums"],function(a,b,g,d,k){class m{constructor(c,l,e){this._renderer=new b.TextRenderer(c,l,e,g.TextTextureAtlas.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/
this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const c=a.getTextHelperCanvas(f,this._renderer.renderedWidth,this._renderer.renderedHeight),l=c.getContext("2d");l.save();this._renderer.render(l,0,0);l.restore();return new d.Texture(c,{wrap:{s:k.TextureWrapMode.CLAMP_TO_EDGE,t:k.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const f={canvas:null};return m})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./ContentObjectType ./testUtils ./textureUtils ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y){function z(F,G){F.geometries[0].setAttributeData(q.VertexAttribute.UV0,G.uv);F.geometryVertexAttributeUpdated(F.geometries[0],q.VertexAttribute.UV0,!0)}a.TextTextureAtlas=class extends g{constructor(F){super(F);this.type=w.ContentObjectType.Texture;this.id=m.generateUID();this.events=new d;this._glTexture=null;this._atlas=new C(256,256);this._needsRepack=!1;this._canRepack=!0;this._elementsToRender=new Map;this._elements=new Map;this._stageObjects=
new Map;this.updating=!1}initialize(){this._canvas=document.createElement("canvas");this._canvas.setAttribute("id","textAtlasCanvas");this._canvas.setAttribute("style","display:none");this._ctx=this._canvas.getContext("2d");this._stage=this.view._stage;this._stage.add(this);this._updateCanvasElementSize(this._atlas);this._reset()}unload(){this._glTexture=k.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){A=x.textTextureAtlas.stableRendering?
2:0;return[4094-A,4094-A-2]}load(F){if(this._glTexture)return this._glTexture;const G=new y.TextureDescriptor;G.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;G.samplingMode=v.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;G.hasMipmap=!0;G.preMultiplyAlpha=!0;G.maxAnisotropy=F.parameters.maxMaxAnisotropy;this._glTexture=new r.Texture(F,G,this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(t.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture}dispose(){this._elements.clear();
this._elementsToRender.clear();this._frameWorker=k.removeMaybe(this._frameWorker);this._glTexture&&(this._stage.remove(this),this._glTexture=k.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null}_updateCanvasElementSize(F){this._canvas.setAttribute("width",F.width.toString());this._canvas.setAttribute("height",F.height.toString())}_resizeAtlas(F,G){const {width:I,height:H}=this._atlas;if(I!==F||H!==G)this._atlas.width=F,this._atlas.height=G,this._glTexture?.resize(F,
G),this._glTexture?.updateData(0,0,0,I,H,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(B=>{this._stageObjects.get(B.textRenderer.key)?.forEach(K=>z(K,B))}),this._reset()}_reset(){this._elementsToRender.clear();this._atlas.reset();this._needsRepack=!0;this.setDirty()}_addAtlasElement(F,G,I,H){const B=this._atlas;if(B.width<I||B.height<H)return!1;let K=B.cursors.get(H);if(!K){if(B.height<B.nextY+H)return!1;K=[new E(B.nextY)];B.cursors.set(H,K);B.nextY+=H}let L=K.find(J=>
B.width>=J.x+I);if(null==L){if(B.height<B.nextY+H)return!1;L=new E(B.nextY);B.nextY+=H;K.push(L)}F.setNewPosition(L);this._elements.set(G,F);this._elementsToRender.set(G,F);L.x+=I;return!0}_ensureStageObjects(F){var G=this._stageObjects.get(F);if(G)return G;G=new Set;this._stageObjects.set(F,G);return G}_addStageObject(F,G){this._ensureStageObjects(F).add(G)}_removeStageObject(F,G){this._stageObjects.get(F)?.delete(G)&&(G.geometries[0].setAttributeData(q.VertexAttribute.SIZE,[0,0]),G.geometryVertexAttributeUpdated(G.geometries[0],
q.VertexAttribute.SIZE),this._elementsToRender.delete(F))}_processAddition(F){const G=F.textRenderer.key;if(this._needsRepack)this._elements.set(G,F);else{var I=this._atlas,H=F.textRenderer.renderedWidth+2,B=F.textRenderer.renderedHeight+2+2;this._addAtlasElement(F,G,H,B)||(this._canRepack?this._reset():I.width<H?(H=Math.min(n.applyTextureResizeModulo(Math.max(H,1.5*I.width)),4096),this._resizeAtlas(H,I.height)):(H=Math.min(n.applyTextureResizeModulo(Math.max(I.nextY+B,1.5*I.height)),4096),H>I.height?
this._resizeAtlas(I.width,H):4096>I.width&&(H=Math.min(n.applyTextureResizeModulo(1.5*I.width),4096),this._resizeAtlas(H,I.height))),this._elements.set(G,F))}}_renderElement(F){const G=F.commitNewPosition();this._ctx.clearRect(G[0]-2,G[1]-2,F.textRenderer.renderedWidth+4,F.textRenderer.renderedHeight+4);F.textRenderer.render(this._ctx,G[0],G[1]);this._stageObjects.get(F.textRenderer.key)?.forEach(I=>z(I,F))}get running(){return this.updating}runTask(F){if(null==this._glTexture)return t.Task.YIELD;
for(;this._needsRepack&&(this._canRepack||4096>this._atlas.height&&4096>this._atlas.height);){this._canRepack=this._needsRepack=!1;const G=this._elements;this._elements=new Map;G.forEach(I=>this._processAddition(I));F.madeProgress()}if(0<this._elementsToRender.size){for(const [G,I]of this._elementsToRender){if(F.done)break;this._renderElement(I);this._elementsToRender.delete(G);F.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=0<this._elementsToRender.size}addTextTexture(F,G){var I=
F.key;this._addStageObject(I,G);I=this._elements.get(I);null==I&&(I=new D(this._atlas,F),this._processAddition(I),this.setDirty());G.geometries[0].setAttributeData(q.VertexAttribute.SIZE,[I.textRenderer.displayWidth,I.textRenderer.displayHeight]);G.geometryVertexAttributeUpdated(G.geometries[0],q.VertexAttribute.SIZE);z(G,I)}removeTextTexture(F,G){F=F.key;this._elements.get(F)&&(this._removeStageObject(F,G),(G=this._stageObjects.get(F))&&0!==G.size||this._elements.delete(F),0===G?.size&&this._stageObjects.delete(F),
this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const {_elements:F,_stageObjects:G,_atlas:I}=this,H=this;return{elements:F,stageObjects:G,atlas:I,resizeAtlas:(B,K)=>H._resizeAtlas(B,K),run:B=>H.runTask(B)}}};b.__decorate([f.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);b.__decorate([f.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=b.__decorate([p.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);class D{constructor(F,G){this._atlas=F;this.textRenderer=G;this._uv=u.create();this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return u.ZEROS;const {renderedWidth:F,renderedHeight:G}=this.textRenderer;return h.set(this._uv,this._xOffset/this._atlas.width,(this._yOffset+G)/this._atlas.height,(this._xOffset+F)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(F){this._newPosition[0]=F.x;this._newPosition[1]=F.y}commitNewPosition(){this._xOffset=
this._newPosition[0];this._yOffset=this._newPosition[1];return this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class C{constructor(F,G){this.width=F;this.height=G;this.cursors=new Map;this.nextY=0}reset(){this.cursors.clear();this.nextY=A}}class E{constructor(F){this.y=F;this.x=A}}let A=0;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../Color ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){const D=["polyline","polygon","extent"];class C extends n.Graphics3DSymbolLayer{constructor(B,K,L,J){super(B,K,L,J)}async doLoad(){}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}createGraphics3DGraphic(B){B=B.graphic;if(!this._validateGeometry(B.geometry,D,this.symbolLayer.type))return null;const K=this.setGraphicElevationContext(B);this.ensureDrapedStatus("on-the-ground"===K.mode);this.ensureMaterial();
return this.draped?this._createAsOverlay(B):this._createAs3DShape(B,K,B.uid)}ensureMaterial(){if(!this._materials[0]){var B=new y.WaterMaterialParameters,K=this.symbolLayer.color;null!=K&&(B.color=b.toUnitRGBA(K));K=this._getCombinedOpacity(K,{hasIntrinsicColor:!0});B.color=[B.color[0],B.color[1],B.color[2],K];B.transparent=1>K||this.needsDrivenTransparentPass;B.waveDirection=null!=this.symbolLayer.waveDirection?C.headingVectorFromAngle(this.symbolLayer.waveDirection):m.fromValues(0,0);K=z.wavePresets[this.symbolLayer.waveStrength+
"-"+this.symbolLayer.waterbodySize];B.waveStrength=K.waveStrength;B.waveTextureRepeat=K.textureRepeat;B.waveVelocity=K.waveVelocity;B.flowStrength=K.perturbationStrength;B.hasSlicePlane=this._context.slicePlaneEnabled;B.isDraped=this.draped;this._materials[0]=new y.WaterMaterial(B);this._context.stage.add(this._materials[0])}}layerOpacityChanged(){if(null!=this._materials[0]){var B=this._materials[0].parameters.color,K=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._materials[0].setParameters({color:[B[0],
B[1],B[2],K],transparent:1>K||this.needsDrivenTransparentPass})}}layerElevationInfoChanged(B,K,L){const J=this._elevationContext.mode;L=u.elevationModeChangeUpdateType(C.elevationModeChangeTypes,L,J);if(L!==u.SymbolUpdateType.UPDATE)return L;const M=u.needsElevationUpdates2D(J);return this.updateGraphics3DGraphicElevationInfo(B,K,()=>M)}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(B,
K,L){const J=q.geometryAsPolygon(B.geometry);if(null==J)return null;const M=t.geometryToRenderInfo(J,this._context.elevationProvider,this._context.renderCoordsHelper,K),T=M.position.length/3,Q=p.newDoubleArray(2*T);this._createUVCoordsFromVertices(Q,M.mapPositions,T,this._context.elevationProvider.spatialReference);B=new I(M,Q,this._context.layer.uid,B.uid);B.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(B);this._create3DShapeGeometries(B);this._logGeometryCreationWarnings(B.renderData,
J.rings,"rings","WaterSymbol3DLayer");if(0===B.outGeometries.length)return null;L=new v.Object3D({geometries:B.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:L});L=new x.Graphics3DObject3DGraphicLayer(this,L,B.outGeometries,null,null,h.perVertexElevationAligner,K);L.alignedSampledElevation=B.renderData.sampledElevation;L.needsElevationUpdates=u.needsElevationUpdates2D(K.mode);return L}_createUVCoordsFromVertices(B,K,L,J){J=g.getMetersPerUnitForSR(J);e.empty(A);for(var M=0;M<
L;M++)k.set(F,K[3*M],K[3*M+1]),e.expandPointInPlace(A,F);f.scale(A,A,J);M=A[1]%C.unitSizeOfTexture;E[0]=A[0]-A[0]%C.unitSizeOfTexture;E[1]=A[1]-M;for(M=0;M<L;M++)B[2*M]=(K[3*M]*J-E[0])/C.unitSizeOfTexture,B[2*M+1]=(K[3*M+1]*J-E[1])/C.unitSizeOfTexture}_create3DShapeGeometries(B){var K=B.renderData.polygons;const L=B.uvCoords;for(const {count:J,index:M,position:T,mapPositions:Q,holeIndices:O}of K){if(null!=this._context.clippingExtent&&(l.empty(G),l.expandWithBuffer(G,Q),!l.intersectsClippingArea(G,
this._context.clippingExtent)))continue;K=d.earcut(Q,O,3);if(0===K.length)continue;const U=p.doubleSubArray(L,2*M,2*J);K=q.createWaterGeometry({material:this._materials[0],indices:K,mapPositions:Q,attributeData:{position:T,uv0:U}},B.objectAndLayerIdColor);B.outGeometries.push(K)}}_createAsOverlay(B){const K=q.geometryAsPolygon(B.geometry);if(null==K)return null;this._materials[0].renderPriority=this._renderPriority;const L=t.geometryToRenderInfoDraped(K,this._context.overlaySR),J=L.position.length/
3,M=p.newDoubleArray(2*J);this._createUVCoordsFromVertices(M,L.position,J,this._context.overlaySR);B=new H(L,M,this._context.layer.uid,B.uid);B.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(B);B.outBoundingBox=l.empty();this._createAsOverlayWater(B);this._logGeometryCreationWarnings(B.renderData,K.rings,"rings","WaterSymbol3DLayer");return 0===B.outGeometries.length?null:new w.Graphics3DDrapedGraphicLayer(this,B.outGeometries,B.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(B){const K=
B.uvCoords;var L=B.renderData.polygons;for(const {position:J,holeIndices:M,index:T,count:Q}of L){l.empty(G);l.expandWithBuffer(G,J);if(!l.intersectsClippingArea(G,this._context.clippingExtent))continue;l.expandWithAABB(B.outBoundingBox,G);L=d.earcut(J,M,3);if(0===L.length)continue;const O=p.doubleSubArray(K,2*T,2*Q);L=q.createWaterGeometry({material:this._materials[0],indices:L,attributeData:{position:J,uv0:O}},B.objectAndLayerIdColor);B.outGeometries.push(new r.RenderGeometry(L,B))}}static headingVectorFromAngle(B){const K=
m.create();B=c.toRadian(B);K[0]=Math.sin(B);K[1]=Math.cos(B);return K}test(){return{...super.test(),create3DShape:B=>this._createAs3DShape(B.graphic,B.elevationContext,B.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}C.unitSizeOfTexture=100;C.elevationModeChangeTypes={definedChanged:u.SymbolUpdateType.RECREATE,staysOnTheGround:u.SymbolUpdateType.NONE,onTheGroundChanged:u.SymbolUpdateType.RECREATE};const E=m.create(),A=e.create(),F=m.create(),G=l.create();class I extends q.PolygonCreationDataBase{constructor(B,
K,L,J){super(B,L,J);this.uvCoords=K}}class H extends q.PolygonCreationDataBase{constructor(B,K,L,J){super(B,L,J);this.uvCoords=K}}a.Graphics3DWaterSymbolLayer=C;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,
waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,
perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["exports",
"./defaultSymbolComplexity","./interfaces","./Loadable"],function(a,b,g,d){class k extends d.Loadable{constructor(m,f,c){super(f);this.symbol=m;this._convert=c;this.symbologySnappingSupported=!1;this.graphics3DSymbol=null;this.referenced=0}getSymbolLayerSize(m){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(m):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:
0}async doLoad(m){m=await this.symbol.fetchSymbol({signal:m});m.id=this.symbol.id;this.graphics3DSymbol=this._convert(m);null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(m){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(m,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:b.emptySymbolComplexity}globalPropertyChanged(m,f){return null!=this.graphics3DSymbol?this.graphics3DSymbol.globalPropertyChanged(m,
f):!1}applyRendererDiff(m,f){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(m,f):g.ApplyRendererDiffResult.RecreateSymbol}prepareSymbolPatch(m){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(m)}updateGeometry(m,f){return null!=this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(m,f):!1}updateTransform(m,f,c,l){return this.graphics3DSymbol?.updateTransform(m,f,c,l)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return null!=this.graphics3DSymbol?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}a.Graphics3DWebStyleSymbol=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./constants ./graphicSymbolUtils ./LabelParameters ../../webgl-engine/lib/TextRenderer ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(E){E=c.getGraphics3DSymbol(E.graphics3DGraphic.graphics3DSymbol);return null!=E?E.symbol.symbolLayers.at(0):null}function u(E,A){var F=A.graphics3DGraphic.graphic.geometry;if(null==F)return null;if(null!=A.disablePlacement)return A.labelClass.labelPlacement?(r.warnOncePerTick(w(E?.placement,A.disablePlacement.logEntityDescription)),x(A)):E;F=F.type;switch(F){case "polyline":case "polygon":case "extent":case "multipoint":if(A.labelClass.labelPlacement)return r.warnOncePerTick(w(E?.placement,
`'${F}' geometries`)),x(A)}return E}function w(E,A){return`the requested label placement '${E}' is currently unsupported for ${A} in SceneView.`}function x(E){const A=E.graphics3DGraphic.graphic.geometry;if(null==A)return null;switch(A.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:k.ZEROS,anchor:"center"};case "polygon":return E=h(E),null!=E&&"extrude"===E.type?z["above-center"]:{placement:"center-center",normalizedOffset:k.ZEROS,anchor:"center"};
case "point":return z["above-center"];case "mesh":return z["above-center"]}}function n(E,A=D){({graphics3DGraphic:E}=E);(E=E.layers[0]?.stageObject.geometries[0].material??null)&&E instanceof p.HUDMaterial?(E=E.parameters.anchorPosition,A[0]=2*(E[0]-.5),A[1]=2*(E[1]-.5)):(A[0]=0,A[1]=0);return A}function q(E,A,F){F=null!=F?F.getBoundingBoxObjectSpace(C):C;F=k.fromValues(F[3]-F[0],F[4]-F[1],F[5]-F[2]);E.centerOffset[0]=Math.sqrt(F[0]*F[0]+F[1]*F[1])/2*A.normalizedOffset[0];const G=E.translation[2],
I=F[2]/2*A.normalizedOffset[1];E.translation[2]=0;E.elevationOffset=G+I;F=d.length(F);E.centerOffset[2]=F/2*A.normalizedOffset[2]}function t(E){const A=E.labelClass.labelPlacement,{labelSymbol:F,graphics3DGraphic:G}=E;var I=c.getGraphics3DSymbol(G.graphics3DSymbol);I="point-3d"===I?.symbol.type?I.symbol:null;E=z[A]||x(E);if(null!=I&&I.supportsCallout()&&I.hasVisibleVerticalOffset()&&!G.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:v(I.verticalOffset),anchor:null,normalizedOffset:null};
if(F&&F.hasVisibleVerticalOffset()&&(null==I||!I.supportsCallout()||!I.verticalOffset||G.isDraped)){if(!(I=!E)){a:switch(E.placement){case "above-center":I=!0;break a;default:I=!1}I=!I}return I?(r.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+A+" placement)"),null):{placement:"above-center",verticalOffset:v(F.verticalOffset),anchor:"bottom",normalizedOffset:[0,E.normalizedOffset[1],0],hasLabelVerticalOffset:!0}}return{placement:null,
verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function v(E){const {screenLength:A,minWorldLength:F,maxWorldLength:G}=E;return{screenLength:A,minWorldLength:F,maxWorldLength:G}}const r=g.getLogger("esri.views.3d.layers.graphics.labelPlacement");class y{constructor(E,A,F,G=null){this.graphics3DGraphic=E;this.labelSymbol=A;this.labelClass=F;this.disablePlacement=G}}const z={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",
normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",
normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],
"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const E in b){const A=z[E];b[E].forEach(F=>{z[F]=A})}Object.freeze&&(Object.freeze(z),Object.keys(z).forEach(E=>{Object.freeze(z[E]);Object.freeze(z[E]?.normalizedOffset)}));const D=[0,0],C=m.create();a.LabelInfo=y;a.getLabelPlacement=function(E){var A=t(E);if(null==A)return null;if(A.anchor)var F=A;else{F=E.labelClass.labelPlacement;var G=z[F],I=G||x(E);F&&!G&&r.warnOncePerTick(`the requested label placement '${F}' is currently unsupported in SceneView.`);
F=u(I,E)}if(null==F)return null;A=new l.LabelPlacement(A.verticalOffset,F.anchor,!!A.hasLabelVerticalOffset);G=E.graphics3DGraphic.graphic.geometry;if(null==G)E=null;else{switch(G.type){case "point":I=h(E);if(null!=I)switch(G=E.graphics3DGraphic.layers[0],null!=G?G.getCenterObjectSpace(A.translation):d.set(A.translation,0,0,0),I.type){case "icon":case "text":({graphics3DGraphic:I}=E);G=null!=G?G.getScreenSize():null;I.isDraped||null==G?A.hasLabelVerticalOffset||"center"===A.anchor||(z[E.labelClass.labelPlacement]&&
r.warnOncePerTick(`the requested placement '${F.placement}' is currently unsupported for draped graphics`),A.anchor="center"):(E=n(E),A.screenOffset[0]=G[0]/2*(F.normalizedOffset[0]-E[0]),E=G[1]/2*(F.normalizedOffset[1]-E[1]),A.hasLabelVerticalOffset?(A.centerOffset[1]=E,A.centerOffsetUnits="screen"):A.screenOffset[1]=E);break;case "object":q(A,F,G)}break;case "polygon":G=h(E);if(null!=G)switch(G.type){case "extrude":E=E.graphics3DGraphic.layers[0],null!=E?(E.getBoundingBoxObjectSpace(C),m.center(C,
A.translation),A.translation[2]=m.height(C)/2):d.set(A.translation,0,0,0),q(A,F,E)}break;case "mesh":q(A,F,E.graphics3DGraphic.layers[0])}E=f.labelMarginPx-e.textVerticalPaddingPx;A.screenOffset[0]+=E*F.normalizedOffset[0];A.screenOffset[1]+=E*F.normalizedOffset[1];E=A}return E};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){class b{constructor(g){this._stage=g;this._materials=new Map}get(g){return this._materials.get(g)}add(g,
d){this._materials.set(g,d);this._stage.add(d)}dispose(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()}}a.MaterialCollection=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){a.FeatureTileTree3D=class extends g{get tilingScheme(){const z=this.tilingSchemeOwner.tilingScheme;return z?z.clone():null}set filterExtent(z){if(null==z||z.spatialReference.equals(this.viewState.spatialReference)){var D=this._get("filterExtent");D===z||null!=D&&z&&D.equals(z)||(z=null!=z?z.clone():null,this._set("filterExtent",z),this._setDirty())}else m.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view")}get _filterExtentRect(){if(null==
this.filterExtent)return null;const z=n.create();v.toBoundingRect(this.filterExtent,z,this.tilingScheme.spatialReference);return z}get _rootTileIds(){const {tilingScheme:z}=this;return this._filterExtentRect&&z?z.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(z){z!==this._get("suspended")&&(this._set("suspended",z),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(z){super(z);this.tiles=new d;this.tileSize=512;this._idToTile=new Map;this._clients=
new Set;this._dirty=!1;this._pendingTiles=null;this._newTiles=new c}initialize(){this.addHandles([l.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),l.sync),l.watch(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),l.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(r.TaskPriority.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=f.removeMaybe(this._frameWorker)}addClient(){const z=
e.generateUID();this._clients.add(z);1===this._clients.size&&this._setDirty();return k.makeHandle(()=>this._removeClient(z))}_removeClient(z){this._clients.delete(z);this._hasClients||this._clear()}get _hasClients(){return 0<this._clients.size}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(r.noBudget))}_clear(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")}get running(){return this.updating}runTask(z){this._dirty=
!1;this._pendingTiles||(this._startUpdate(),null!=this._frameWorker&&(this._frameWorker.priority=r.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(z);this._pendingTiles||null==this._frameWorker||(this._frameWorker.priority=r.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")}_startUpdate(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new t.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,
tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()):this._clear())}_reset(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()}_getRootTiles(){const {tilingScheme:z}=this;return this._rootTileIds.map(D=>new q.FeatureTileDescriptor3D(D[0],D[1],D[2],z))}_purgeHorizonTiles(z){z.sort((D,C)=>{D=D.measures.screenRect;C=C.measures.screenRect;
return D[1]+D[3]-(C[1]+C[3])});n.empty(y);for(let D=0;D<z.length;D++)if(n.expand(y,z.data[D].measures.screenRect,y),10<n.height(y))return z.data.slice(D,z.length);return[]}_subdivideTilesForView(z){if(this._pendingTiles){for(var {tilingScheme:D}=this;0<this._pendingTiles.length&&!z.done;){const C=this._pendingTiles.pop();z.madeProgress();if(!this._filterExtentRect||n.intersects(this._filterExtentRect,C.extent))this._tileMeasurements.updateTile(C),C.measures.visibility!==q.Visibility.INVISIBLE&&(C.measures.shouldSplit?
(D.ensureMaxLod(C.lij[0]+1),this._pendingTiles.push(...C.getChildren())):this._newTiles.push(C))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(z){for(var D of this.tiles.items)D.used=!1;z=z.filter(C=>{const E=this._idToTile.get(C.id);E?(E.copyMeasurementsFrom(C),E.used=!0):this._idToTile.set(C.id,C);return!E});D=this.tiles.items.filter(C=>C.used?!1:(this._idToTile.delete(C.id),
!0));this.tiles.removeMany(D);this.tiles.addMany(z);this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((z,D)=>z.measures.visibility!==D.measures.visibility?z.measures.visibility===q.Visibility.VISIBLE_ON_SURFACE?-1:1:z.measures.distance-D.measures.distance);this.tiles.forEach((z,D)=>z.loadPriority=D)}};b.__decorate([p.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);b.__decorate([p.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,
"renderCoordsHelper",void 0);b.__decorate([p.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);b.__decorate([p.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);b.__decorate([p.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);b.__decorate([p.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);b.__decorate([p.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",
void 0);b.__decorate([p.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);b.__decorate([p.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);b.__decorate([p.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);b.__decorate([p.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);b.__decorate([p.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_filterExtentRect",null);b.__decorate([p.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_rootTileIds",
null);b.__decorate([p.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);b.__decorate([p.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=b.__decorate([x.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);const y=n.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],
function(a,b){class g{constructor(d,k,m,f=null){this.lij=[0,0,0];this.extent=b.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:b.create(),distance:0,shouldSplit:!1};this.used=!1;f&&this.acquire(d,k,m,f)}acquire(d,k,m,f){this.tilingScheme=f;this.id=g.id(d,k,m);this.lij[0]=d;this.lij[1]=k;this.lij[2]=m;f.getExtent(d,k,m,this.extent);this.resolution=f.resolutionAtLevel(d)}release(){this.tilingScheme=null}getChildren(d){const k=this.lij[0]+
1,m=2*this.lij[1],f=2*this.lij[2];if(!d)return[new g(k,m,f,this.tilingScheme),new g(k,m+1,f,this.tilingScheme),new g(k,m,f+1,this.tilingScheme),new g(k,m+1,f+1,this.tilingScheme)];d[0].acquire(k,m,f,this.tilingScheme);d[1].acquire(k,m+1,f,this.tilingScheme);d[2].acquire(k,m,f+1,this.tilingScheme);d[3].acquire(k,m+1,f+1,this.tilingScheme);return d}copyMeasurementsFrom(d){this.measures.visibility=d.measures.visibility;this.measures.shouldSplit=d.measures.shouldSplit;this.measures.distance=d.measures.distance;
b.copy(d.measures.screenRect,this.measures.screenRect)}static id(d,k,m){return`${d}/${k}/${m}`}}a.Visibility=void 0;(function(d){d[d.INVISIBLE=0]="INVISIBLE";d[d.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";d[d.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){class h{constructor(r){this._camera=new p.Camera;this._focusOnMap=[0,0];this._screenRect=k.create();this._tileSize=r.tileSize;this._renderCoordsHelper=r.renderCoordsHelper;this._tilingScheme=r.tilingScheme;this._visibility=new e.FeatureTileVisibility3D(r.renderCoordsHelper)}begin(r,y,z){this._camera.copyFrom(r);this._surfaceElevation=z;this._focusOnMap[0]=y.x;this._focusOnMap[1]=y.y;k.fromValues(0,0,r.fullWidth,r.fullHeight,this._screenRect);this._visibility.begin(this._camera,
z)}end(){this._visibility.end()}updateTile(r){r.measures.visibility=this._visibility.calculate(r);r.measures.distance=k.distance(r.extent,this._focusOnMap);r.measures.visibility!==l.Visibility.INVISIBLE&&this._updateScreenMeasure(r)}_updateScreenMeasure(r){const y=r.measures.screenRect;k.empty(y);let z=0;const D=r.lij[0]+2,C=r.lij[1]<<2,E=r.lij[2]<<2;var A=this._tileSizeWithBias(r);A*=A;for(let F=0;4>F;F++)for(let G=0;4>G;G++)if(z+=this._computeScreenArea(r,D,C+F,E+G,y),z>A){r.measures.shouldSplit=
!0;return}r.measures.shouldSplit=!1}_tileSizeWithBias(r){return r.measures.visibility===l.Visibility.VISIBLE_WHEN_EXTENDED?5*this._tileSize:this._tileSize}_computeScreenArea(r,y,z,D,C){this._projectToScreen(y,z,D,r.measures.visibility===l.Visibility.VISIBLE_WHEN_EXTENDED,w);k.empty(u);for(r=0;4>r;r++)k.expandPointInPlace(u,w[r]);k.expand(C,u,C);return c.areaPoints2d(w[0],w[1],w[2])+c.areaPoints2d(w[0],w[2],w[3])}_projectToScreen(r,y,z,D,C){this._tilingScheme.ensureMaxLod(r);this._tilingScheme.getExtent(r,
y,z,x);this._toRenderCoords(x,0,3,q[0]);this._toRenderCoords(x,2,3,q[1]);this._toRenderCoords(x,2,1,q[2]);this._toRenderCoords(x,0,1,q[3]);D&&(this._projectToPlane(q,this._camera.frustum[m.PlaneIndex.NEAR]),this._projectToPlane(q,this._camera.frustum[m.PlaneIndex.TOP]),this._projectToPlane(q,this._camera.frustum[m.PlaneIndex.BOTTOM]));for(r=0;4>r;r++)this._camera.projectToRenderScreen(q[r],v),this._camera.renderToScreen(v,C[r])}_projectToPlane(r,y){for(var z=0;4>z;z++)t[z]=f.signedDistance(y,r[z]);
z=Math.max(t[0],t[1],t[2],t[3]);if(0<z)for(y=g.scale(n,f.normal(y),-z),z=0;4>z;z++)g.add(r[z],r[z],y)}_toRenderCoords(r,y,z,D){n[0]=r[y];n[1]=r[z];n[2]=this._surfaceElevation;this._renderCoordsHelper.toRenderCoords(n,this._tilingScheme.spatialReference,D);return D}}const u=k.create(),w=[b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray()],x=k.create(),n=d.create(),q=[d.create(),d.create(),d.create(),d.create()],t=[0,0,0,0],v=b.createRenderScreenPointArray3();
a.FeatureTileMeasurements3D=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){class w{constructor(v){this._renderCoordsHelper=v;this._surfaceElevation=0;this._cache=new Map;this._frustum=new h.Frustum(v);this._extendedFrustum=new h.Frustum(v);this._intersector=new u.FrustumExtentIntersection({renderCoordsHelper:v});this._renderCoordsHelper=v}begin(v,r){this._surfaceElevation=r;this._aboveGround=this._renderCoordsHelper.getAltitude(v.eye)>r;this._frustum.update(v);this._shortenFrustumFarPlane(this._frustum);this._updateExtendedFrustum(v)}end(){this._cache.clear()}calculate(v){if(this._allTilesInvisible)return p.Visibility.INVISIBLE;
const r=this._renderCoordsHelper.viewingMode===e.ViewingMode.Global&&2<=v.lij[0]&&6>v.lij[0],y=this._getOrCalculateSingleTileVisibility(v,!r);return y!==p.Visibility.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(v):y}_shortenFrustumFarPlane(v){var r=h.Frustum.nearFarLineIndices;const y=v.mutablePoints;for(const z of r){const [D,C]=z;r=y[D];d.subtract(x,y[C],r);d.scale(x,x,.95);d.add(y[C],r,x)}v.updatePoints(y)}_calculateAggregatedChildrenVisibility(v){let r=p.Visibility.INVISIBLE;var y=
this._cache.get(v.id);if(null!=y)return y;y=t.acquire();v.getChildren(y);for(const z of y){const D=this.calculate(z);if(D!==p.Visibility.INVISIBLE&&(r=D,D===p.Visibility.VISIBLE_ON_SURFACE))break}t.release(y);this._cache.set(v.id,r);return r}_getOrCalculateSingleTileVisibility(v,r){var y=this._cache.get(v.id);if(null!=y)return y;y=this._calculateSingleTileVisibility(v);r&&this._cache.set(v.id,y);return y}_calculateSingleTileVisibility(v){if(!this._aboveGround&&this._renderCoordsHelper.viewingMode===
e.ViewingMode.Global&&12>v.lij[0]){if(this._calculateSingleTileVisibilitySided(v,!1)===p.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(v,!0)}else return this._calculateSingleTileVisibilitySided(v,this._aboveGround)}_calculateSingleTileVisibilitySided(v,r){this._intersector.update(v.extent,v.tilingScheme.spatialReference,this._surfaceElevation,r);v=m.getReferenceEllipsoid(v.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,
v)?this._intersector.isVisibleInFrustum(this._frustum,v,!0)?p.Visibility.VISIBLE_ON_SURFACE:p.Visibility.VISIBLE_WHEN_EXTENDED:p.Visibility.INVISIBLE}_updateExtendedFrustum(v){this._extendedFrustum.update(v);this._shortenFrustumFarPlane(this._extendedFrustum);var r=this._renderCoordsHelper.worldUpAtPosition(v.eye,x);this._aboveGround||d.negate(r,r);r=b.acosClamped(-d.dot(r,v.viewForward));this._allTilesInvisible=r>(Math.PI+v.fovY)/2;if(!this._allTilesInvisible&&(this._hasExtendedFrustum=r>v.fovY/
2)){v=this._extendedFrustumParameters();r=this._extendedFrustum.mutablePoints;for(let y=0;4>y;y++){const z=v.pointIndices[y],D=r[z],C=this._renderCoordsHelper.getAltitude(D);if(v.needsAltitudeAdjustment(C)){this._renderCoordsHelper.worldUpAtPosition(D,x);switch(z){case f.PointIndex.FAR_BOTTOM_LEFT:case f.PointIndex.FAR_TOP_LEFT:case f.PointIndex.NEAR_BOTTOM_LEFT:case f.PointIndex.NEAR_TOP_LEFT:c.projectVector(this._extendedFrustum.planes[f.PlaneIndex.LEFT],x,x);break;case f.PointIndex.FAR_BOTTOM_RIGHT:case f.PointIndex.FAR_TOP_RIGHT:case f.PointIndex.NEAR_BOTTOM_RIGHT:case f.PointIndex.NEAR_TOP_RIGHT:c.projectVector(this._extendedFrustum.planes[f.PlaneIndex.RIGHT],
x,x)}d.scale(x,x,v.direction);this._renderCoordsHelper.intersectInfiniteManifold(l.wrap(D,x),v.zWithMargin,D)}}this._extendedFrustum.updatePoints(r);c.fromPoints(r[f.PointIndex.NEAR_BOTTOM_LEFT],r[f.PointIndex.NEAR_BOTTOM_RIGHT],r[f.PointIndex.NEAR_TOP_RIGHT],n);c.fromPoints(r[f.PointIndex.NEAR_BOTTOM_RIGHT],r[f.PointIndex.NEAR_TOP_RIGHT],r[f.PointIndex.NEAR_TOP_LEFT],q);0>d.dot(c.normal(n),c.normal(q))&&(v=this._extendedFrustum.mutablePoints,this._aboveGround?[v[f.PointIndex.NEAR_BOTTOM_LEFT],v[f.PointIndex.NEAR_BOTTOM_RIGHT]]=
[v[f.PointIndex.NEAR_BOTTOM_RIGHT],v[f.PointIndex.NEAR_BOTTOM_LEFT]]:[v[f.PointIndex.NEAR_TOP_LEFT],v[f.PointIndex.NEAR_TOP_RIGHT]]=[v[f.PointIndex.NEAR_TOP_RIGHT],v[f.PointIndex.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(v))}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const v=this._surfaceElevation-1;return{zWithMargin:v,pointIndices:h.Frustum.planePointIndices.bottom,
direction:-1,needsAltitudeAdjustment(r){return r>v}}}_extendedFrustumParametersBelowSurface(){const v=this._surfaceElevation+1;return{zWithMargin:v,pointIndices:h.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(r){return r<v}}}}const x=k.create(),n=c.create(),q=c.create(),t=new g(Array,v=>{4!==v.length&&(v[0]=new p.FeatureTileDescriptor3D,v[1]=new p.FeatureTileDescriptor3D,v[2]=new p.FeatureTileDescriptor3D,v[3]=new p.FeatureTileDescriptor3D)},v=>{v[0].release();v[1].release();v[2].release();
v[3].release()});a.FeatureTileVisibility3D=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBoundingRect ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){const r=.5*Math.PI,y=r/Math.PI*180;class z{constructor(H){this._renderCoordsHelper=H.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:f.create(),direction:f.create()};for(H=0;4>H;H++)this._extent[H]={origin:f.create(),direction:f.create(),cap:{next:null,direction:f.create()}},this._planes[H]=n.create();this._planes[w.PlaneIndex.NEAR]=n.create();this._planes[w.PlaneIndex.FAR]=n.create();this._planesWithoutFar=
this._planes.slice(0,5)}update(H,B,K,L=!0){const J=this._extent;this._toRenderBoundingExtent(H,B,K);m.add(this._center.origin,J[0].origin,J[2].origin);m.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);L||m.scale(this._center.direction,this._center.direction,-1);for(K=0;4>K;K++){const M=J[K];this._renderCoordsHelper.worldUpAtPosition(M.origin,M.direction);const T=J[3===K?0:K+1];M.cap.next=T.origin;m.direction(M.cap.direction,
M.origin,T.origin);n.fromVectorsAndPoint(M.direction,M.cap.direction,M.origin,this._planes[K]);L||m.scale(M.direction,M.direction,-1)}n.fromVectorsAndPoint(J[0].cap.direction,J[1].cap.direction,J[0].origin,this._planes[w.PlaneIndex.NEAR]);L?n.negate(this._planes[w.PlaneIndex.NEAR],this._planes[w.PlaneIndex.FAR]):(n.copy(this._planes[w.PlaneIndex.FAR],this._planes[w.PlaneIndex.NEAR]),n.negate(this._planes[w.PlaneIndex.NEAR],this._planes[w.PlaneIndex.NEAR]));this._maxSpan=Math.max(Math.abs(H[0]-H[2]),
Math.abs(H[1]-H[3]));this._maxSpanSpatialReference=B;this._minGlobalAltitude=.9*c.getReferenceEllipsoid(this._maxSpanSpatialReference).radius}isVisibleInFrustum(H,B,K=!1){if(null==H)return!1;if(this._renderCoordsHelper.viewingMode===t.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?y:r*B))return!0;if(null!=H.altitude&&H.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(H)}if(0===this._maxSpan)return B=this._extent[0],!K&&H.intersectsRay(q.wrap(B.origin,
B.direction))?!0:!1;for(B=0;B<this._extent.length;B++){var L=this._extent[B];if(!K&&H.intersectsRay(q.wrap(L.origin,L.direction))||H.intersectsLineSegment(x.fromPoints(L.origin,L.cap.next,I),L.cap.direction))return!0}K=K?this._planes:this._planesWithoutFar;for(B=0;B<H.lines.length;B++)if(L=H.lines[B],v.frustumLineSegment(K,L.origin,L.endpoint,L.direction))return!0;return!1}_toRenderBoundingExtentGlobal(H,B,K){u.center(H,C);C[2]=K;l.computeTranslationToOriginAndRotation(B,C,E,this._renderCoordsHelper.spatialReference);
d.invert(A,E);h.empty(F);for(const {x0:L,x1:J,y0:M,y1:T}of D)for(let Q=0;5>Q;Q++){const O=Q/4;C[0]=g.lerp(H[L],H[J],O);C[1]=g.lerp(H[M],H[T],O);C[2]=K;p.projectVectorToVector(C,B,C,this._renderCoordsHelper.spatialReference);m.transformMat4(C,C,A);h.expandWithVec3(F,C)}m.set(this._extent[0].origin,F[0],F[1],F[2]);m.set(this._extent[1].origin,F[3],F[1],F[2]);m.set(this._extent[2].origin,F[3],F[4],F[2]);m.set(this._extent[3].origin,F[0],F[4],F[2]);for(H=0;4>H;++H)m.transformMat4(this._extent[H].origin,
this._extent[H].origin,E)}_toRenderBoundingExtentLocal(H,B,K){e.projectBoundingRect(H,B,G,this._renderCoordsHelper.spatialReference);m.set(this._extent[0].origin,G[0],G[1],K);m.set(this._extent[1].origin,G[2],G[1],K);m.set(this._extent[2].origin,G[2],G[3],K);m.set(this._extent[3].origin,G[0],G[3],K)}_toRenderBoundingExtent(H,B,K){switch(this._renderCoordsHelper.viewingMode){case t.ViewingMode.Global:this._toRenderBoundingExtentGlobal(H,B,K);break;case t.ViewingMode.Local:this._toRenderBoundingExtentLocal(H,
B,K);break;default:b.neverReached(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(H){if(0>n.signedDistance(H.planes[w.PlaneIndex.NEAR],this._center.origin)&&0>m.dot(this._center.direction,H.direction))return!0;for(let B=0;4>B;B++){const K=this._extent[B];if(0>n.signedDistance(H.planes[w.PlaneIndex.NEAR],K.origin)&&0>m.dot(K.direction,H.direction))return!0}return!1}}const D=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],C=f.create(),E=k.create(),
A=k.create(),F=h.create(),G=u.create(),I=x.create();a.FrustumExtentIntersection=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../chunks/vec3f64","../../../geometry/projection/projectBuffer"],function(a,b,g){const d=b.create();a.projectToBoundingBox=function(k,m,f){if(null==k||null==f)return!1;let c;d[0]=null!=k.xmin?k.xmin:0;d[1]=null!=k.ymin?k.ymin:0;d[2]=null!=k.zmin?k.zmin:0;c=g.projectBuffer(d,k.spatialReference,
0,m,f,0,1);d[0]=null!=k.xmax?k.xmax:0;d[1]=null!=k.ymax?k.ymax:0;d[2]=null!=k.zmax?k.zmax:0;c=c&&g.projectBuffer(d,k.spatialReference,0,m,f,3,1);null==k.xmin&&(m[0]=-Infinity);null==k.ymin&&(m[1]=-Infinity);null==k.zmin&&(m[2]=-Infinity);null==k.xmax&&(m[3]=Infinity);null==k.ymax&&(m[4]=Infinity);null==k.zmax&&(m[5]=Infinity);return c};a.toBoundingRect=function(k,m,f){if(null==k||null==f)return!1;let c;d[0]=null!=k.xmin?k.xmin:0;d[1]=null!=k.ymin?k.ymin:0;d[2]=null!=k.zmin?k.zmin:0;c=g.projectBuffer(d,
k.spatialReference,0,d,f,0,1);m[0]=d[0];m[1]=d[1];d[0]=null!=k.xmax?k.xmax:0;d[1]=null!=k.ymax?k.ymax:0;d[2]=null!=k.zmax?k.zmax:0;c=c&&g.projectBuffer(d,k.spatialReference,0,d,f,0,1);m[2]=d[0];m[3]=d[1];null==k.xmin&&(m[0]=-Infinity);null==k.ymin&&(m[1]=-Infinity);null==k.xmax&&(m[2]=Infinity);null==k.ymax&&(m[3]=Infinity);return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){b=class extends b{constructor(){super(...arguments);this._propertiesPool=new t.PropertiesPool({camera:v.Camera},this);this._lastSeenCameraProjectionValues=new v.Camera;this.mode=r.RenderState.ANIMATING;this._cssCamera=new v.Camera;this._camera=new v.Camera;this.contentPixelRatio=this.rasterPixelRatio=1;this.events=new g;this.viewingMode=w.ViewingMode.Global;this._cameraChanged=!1;this._updateQueue=[];this._processingUpdates=!1}init(z,D){this._set("viewingMode",
z);this._set("spatialReference",D);this._set("constraints",new x.Constraints({mode:this.viewingMode}))}exit(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new t.PropertiesPool({camera:v.Camera},this)}destroy(){this.cameraController=null;this._propertiesPool?.destroy();this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===w.ViewingMode.Global){const z=h.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new v.Camera({eye:p.fromValues(4*
z,0,0),center:p.fromValues(z,0,0),up:p.fromValues(0,0,1)})}else this.camera=new v.Camera({eye:p.fromValues(0,0,100),center:p.fromValues(0,0,0),up:p.fromValues(0,1,0)})}get animation(){return this.cameraController instanceof n.AnimationController&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const z=this._cssCamera.copyFrom(this.camera),{height:D,width:C,pixelRatio:E}=this.camera;z.pixelRatio=1;z.height=Math.round(D/
E);z.width=Math.round(C/E);return z}set camera(z){z!==y&&y.copyFrom(z);y.computeUp(this.viewingMode);this.events.emit("before-camera-change",y);z=this._camera;this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,y)&&(this._lastSeenCameraProjectionValues.copyFrom(y),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!z.equals(y)&&(this._camera=this._propertiesPool.get("camera").copyFrom(y),this._cameraChanged=!z.almostEquals(y))){const D=e.afterDispatch(()=>
{this._cameraChanged=!1;D.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===r.RenderState.IDLE}get updating(){return this.mode!==r.RenderState.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(z){this._contentCamera=null!=z?z.clone():null}get fixedContentCamera(){return null!=this._contentCamera}get isGlobal(){return this.viewingMode===w.ViewingMode.Global}get isLocal(){return this.viewingMode===
w.ViewingMode.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(z){this.stopActiveCameraController()?(this.cameraController?.destroy(),z&&(this.removeHandles("ViewStateHandles"),this.addHandles(d.when(()=>z.state===q.State.Finished||z.state===q.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(D=>
z.onControllerEnd(D))},{sync:!0,once:!0}),"ViewStateHandles"),z.onControllerStart(this.camera)),this._set("cameraController",z)):z&&(z.state=q.State.Rejected)}switchCameraController(z){this.cameraController=z;return z.state!==q.State.Rejected}stopActiveCameraController(){return this.cameraController&&!this.cameraController.stopController()?!1:!0}updateCamera(z){this._updateQueue.push(z);this._processUpdateQueue()}_processUpdateQueue(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=
!0;var z=this._updateQueue.shift();y.copyFrom(this._get("camera"));z(y);this.camera=y;this._processingUpdates=!1;this._processUpdateQueue()}}_cameraProjectionChanged(z,D){return z.fov!==D.fov||z.fullViewport[0]!==D.fullViewport[0]||z.fullViewport[1]!==D.fullViewport[1]||z.fullViewport[2]!==D.fullViewport[2]||z.fullViewport[3]!==D.fullViewport[3]||z.padding[v.PaddingSide.TOP]!==D.padding[v.PaddingSide.TOP]||z.padding[v.PaddingSide.RIGHT]!==D.padding[v.PaddingSide.RIGHT]||z.padding[v.PaddingSide.BOTTOM]!==
D.padding[v.PaddingSide.BOTTOM]||z.padding[v.PaddingSide.LEFT]!==D.padding[v.PaddingSide.LEFT]?!0:!1}};a.__decorate([k.property()],b.prototype,"mode",void 0);a.__decorate([k.property({readOnly:!0,type:u})],b.prototype,"animation",null);a.__decorate([k.property({type:v.Camera})],b.prototype,"camera",null);a.__decorate([k.property({type:v.Camera})],b.prototype,"cssCamera",null);a.__decorate([k.property()],b.prototype,"_cssCamera",void 0);a.__decorate([k.property()],b.prototype,"_camera",void 0);a.__decorate([k.property({readOnly:!0})],
b.prototype,"pixelRatio",null);a.__decorate([k.property()],b.prototype,"rasterPixelRatio",void 0);a.__decorate([k.property()],b.prototype,"contentPixelRatio",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"alignPixelEnabled",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property({})],b.prototype,"_contentCamera",void 0);a.__decorate([k.property({type:v.Camera})],b.prototype,"contentCamera",null);a.__decorate([k.property({readOnly:!0})],b.prototype,
"fixedContentCamera",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"constraints",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"events",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"isGlobal",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"isLocal",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"viewingMode",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"spatialReference",void 0);a.__decorate([k.property()],b.prototype,
"navigating",null);a.__decorate([k.property()],b.prototype,"stationary",null);a.__decorate([k.property()],b.prototype,"_cameraChanged",void 0);a.__decorate([k.property()],b.prototype,"cameraController",null);a=b=a.__decorate([l.subclass("esri.views.3d.state.ViewState")],b);const y=new v.Camera;return a})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(z){t&&t.viewingMode===z||(t=p.newIntersector(z));return t}class x{constructor(z,D,C){this.viewingMode=z;this._forEachLayer=D;this._view=C;this._externalIntersectionHandlers=new b;this._tolerance=p.defaultTolerance;this._tmpRay=f.create();this._tmpRegion=m.create();this._validateHUDIntersector=p.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}intersectScreen(z,D,C){return this.intersectRay(this._getPickRay(z,this._tmpRay),
w(this.viewingMode),D,C)}intersectScreenFreePointFallback(z,D,C){return this.intersectRayFreePointFallback(this._getPickRay(z,this._tmpRay),D,C)}intersectRayFreePointFallback(z,D,C){return this.intersectRay(z,w(this.viewingMode),D,C)||this._intersectRayFreePointLocal(z,D)}intersectRay(z,D,C,E){D.options.selectionMode=!1;D.options.store=h.StoreResults.MIN;this.computeIntersection(z,D,E);return D.results.min?D.results.min.getIntersectionPoint(C):!1}getCenterRayWithSubpixelOffset(z,D,C=.5,E=.5){z.getRenderCenter(y,
C,E);y[0]+=.0466;y[1]-=.0123;return e.fromRenderAtEye(z,y,D)}intersectIntersectorScreen(z,D,C){this.computeIntersection(this._getPickRay(z,this._tmpRay),D,C)}intersectToolIntersectorScreen(z,D,C){z=this._getPickRay(z,this._tmpRay);this.intersectToolIntersectorRay(z,D,C)}intersectToolIntersectorRay(z,D,C){D.options.selectionMode=!0;this.computeIntersection(z,D,C);const E=D.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||u.isValidIntersectorResult(E)&&E.intersector!==h.IntersectorType.TERRAIN||
(D.options.selectionMode=!1,this.computeIntersection(z,D,C))}setTolerance(z=p.defaultTolerance){this._tolerance=z}addIntersectionHandler(z){this._externalIntersectionHandlers.push(z);this._externalIntersectionHandlers.sort((D,C)=>D.type===h.IntersectorType.TERRAIN?1:C.type===h.IntersectorType.TERRAIN?-1:0)}removeIntersectionHandler(z){null!=this._externalIntersectionHandlers.removeUnordered(z)&&this._externalIntersectionHandlers.sort((D,C)=>D.type===h.IntersectorType.TERRAIN?1:C.type===h.IntersectorType.TERRAIN?
-1:0)}_getPickRay(z,D){return e.fromScreen(this._view.state.camera,z,D)}_intersectRayFreePointLocal(z,D){if(this.viewingMode!==l.ViewingMode.Local||null==z)return!1;d.add(D,z.origin,d.normalize(c.sv3d.get(),z.direction));return!1}intersectElevationFromScreen(z,D,C=0,E=null){return this._intersectElevation(this._getPickRay(z,this._tmpRay),D,C,E)}_intersectElevation(z,D,C=0,E=null){if(null==z)return null;var A=null!=D?D.mode:"absolute-height",F=D?.offset??0,G="on-the-ground"!==A?F+C:0;D=G/this._view.renderCoordsHelper.unitInMeters;
if("absolute-height"===A)return this._view.renderCoordsHelper.intersectInfiniteManifold(z,G,r)?(C=this._view.computeMapPointFromVec3d(r),C.z??(C.z=0),C.z-=F,C):null;F=this._view.state.camera;const I=g.castRenderScreenPointArray3(c.sv3d.get());F.projectToRenderScreen(z.origin,I);G=new v(null,this._forEachLayer);const H=this._view.slicePlane,B=null!=H?u.sliceFilterPredicate(H):null,K=p.newIntersector(this.viewingMode);K.options.store=h.StoreResults.MIN;K.options.verticalOffset=D;D=z.origin;z=d.add(c.sv3d.get(),
D,z.direction);K.reset(D,z,F);K.point=I;const L=E?"type"in E&&"graphics"===E.type?J=>J.layerUid!==E.uid:J=>J.graphicUid!==E.uid:null;switch(A){case "relative-to-scene":K.intersect(G.layers,I,this._tolerance,null,J=>(!L||L(J))&&!!J.lastValidElevationBB);this._externalIntersectionHandlers.forAll(J=>{J.type!==h.IntersectorType.I3S&&J.type!==h.IntersectorType.TERRAIN||J.intersect(K,J.slicePlaneEnabled?B:null,K.rayBegin,K.rayEnd,I)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(J=>
{J.isGround&&J.intersect(K,J.slicePlaneEnabled?B:null,K.rayBegin,K.rayEnd,I)})}return K.results.min.getIntersectionPoint(r)?(A=this._view.computeMapPointFromVec3d(r),A.z=C,A):null}computeIntersection(z,D,C){if(null!=z){var E=this._view.state.camera,A=g.castRenderScreenPointArray3(c.sv3d.get());E.projectToRenderScreen(z.origin,A);var F=new v(C,this._forEachLayer);D.options.selectOpaqueTerrainOnly=!C||!("include"in C||"exclude"in C);var G=z.origin,I=d.add(c.sv3d.get(),z.origin,z.direction);D.reset(G,
I,E);D.intersect(F.layers,A,this._tolerance);z=this._view.slicePlane;var H=null!=z?u.sliceFilterPredicate(z):null;D.intersect(F.sliceableLayers,A,this._tolerance,H);var B=C&&(C.requiresGroundFeedback||C.enableDraped);this._externalIntersectionHandlers.forAll(K=>{var L=K.layerUid;const J=Array.isArray(L);L=J?L:[L];J&&(D.options.filteredLayerUids=[]);let M=!1;for(const T of L)F.filterLayerUid(T)?M=!0:J&&D.options.filteredLayerUids.push(T);D.options.isFiltered=!M;(K.isGround&&B||!D.options.isFiltered)&&
K.intersect(D,K.slicePlaneEnabled?H:null,G,I,A)});z=c.sv3d.get();E=this._view.basemapTerrain;if(C&&C.enableDraped&&null!=E.spatialReference&&D.results.ground.getIntersectionPoint(z)){C=E.overlayManager.renderer;const K=this._view.renderCoordsHelper.spatialReference,L=c.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(z,L,E.spatialReference);L[2]=this._view.elevationProvider?.getElevation(z[0],z[1],z[2],K,"ground")??0;C.intersect(D,L,D.results.ground,J=>F.filterRenderGeometry(J))}D.sortResults();
this._processHUDResults(D)}}_processHUDResults(z){var D=z.results.hud;m.copy(this._tmpRegion,m.negativeInfinity);const C=this._view.state.camera,E=[],A=this._tmpRegion;var F=L=>{const J=new q(L);C.projectToRenderScreen(L.target.center,J.screenPoint);J.screenPoint[0]=Math.floor(J.screenPoint[0]);J.screenPoint[1]=Math.floor(J.screenPoint[1]);E.push(J);m.expandPointInPlace(A,J.screenPoint)};z.sortResults(D.all);null!=D.min.dist&&F(D.min);for(var G of D.all)D.min.target.object!==G.target.object&&D.max.target.object!==
G.target.object&&F(G);null!=D.max.dist&&D.max.target.object!==D.min.target.object&&F(D.max);if(E.length){A[0]===A[2]&&(A[2]+=1);A[1]===A[3]&&(A[3]+=1);D=C.fullWidth;F=C.fullHeight;var I=Math.max(0,A[0]-1),H=Math.max(0,A[1]-1);G=Math.min(m.width(A)+2,D-I);var B=Math.min(m.height(A)+2,F-H),K=new Uint8Array(G*B*4);this._view._stage.renderer.readHUDVisibility(I,H,G,B,K);I=!0;H=null==z.results.max.dist;B=0;for(const L of E)for(const J of n)if(K[4*(Math.min(L.screenPoint[0]+J[0],D)-A[0]+(Math.min(L.screenPoint[1]+
J[1],F)-A[1])*G)]){I&&(z.results.min.copy(L.result),I=!1);H&&z.results.max.copy(L.result);z.options.store===h.StoreResults.ALL&&z.results.all.splice(B++,0,L.result);break}}}}const n=(()=>{const z=[];for(let D=-1;1>=D;D++)for(let C=-1;1>=C;C++)z.push([C+1,D+1]);return z})();class q{constructor(z){this.result=z;this.screenPoint=g.createRenderScreenPointArray3()}}let t;class v{constructor(z,D){this.layers=[];this.sliceableLayers=[];this.include=z?.include;this.exclude=z?.exclude;D(C=>{C.pickable&&this.filterLayerUid(C.apiLayerUid)&&
(C.sliceable?this.sliceableLayers:this.layers).push(C)})}filterLayerUid(z){const {include:D,exclude:C}=this;return null==z?null==D&&null==C:(null==D||D.has(z))&&(null==C||!C.has(z))}filterRenderGeometry(z){return this.filterLayerUid(z.layerUid)}}const r=k.create(),y=g.createRenderScreenPointArray3();a.SceneIntersectionHelper=x;a.isIntersectionHandler=function(z){return"object"===typeof z&&"intersect"in z};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(n,q,t,v,r,y,z){for(const D of q)q=D.getElevation(t,v,r,y,z),null!=q&&(n=null!=n?Math.max(q,n):q);return n}a.CombinedElevationProvider=class extends d.EventedMixin(g){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(n){super(n);this._im=[];this._ground=[];this._scene=[];this.lastElevationQuery=null;this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=k.destroyMaybe(this._elevationQueryCached)}enableElevationCache(n){n||
(this.lastElevationQuery=null);this.elevationCacheEnabled=n}getElevation(n,q,t,v,r){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var y=this.lastElevationQuery;if(n===y.x&&q===y.y&&t===y.z&&u.equals(v,y.spatialReference)&&r===y.queryContext)return y.result}y=x(null,this._im,n,q,t,v,r);null==y&&(y=x(y,this._ground,n,q,t,v,r));"scene"===r&&(y=x(y,this._scene,n,q,t,v,r));this.elevationCacheEnabled&&(this.lastElevationQuery={x:n,y:q,z:t,spatialReference:v,queryContext:r,result:y});return y}getSphereElevationBounds(n,
q){let t=Infinity,v=-Infinity;for(const r of[this._im,this._ground,this._scene])r.forEach(y=>{y.getSphereElevationBounds&&(y=y.getSphereElevationBounds(n,q),null!=y&&(t=Math.min(t,y.min),v=Math.max(v,y.max)))});return{min:t,max:v}}getRootElevationBounds(){let n=Infinity,q=-Infinity;for(const t of[this._im,this._ground,this._scene])t.forEach(v=>{v.getRootElevationBounds&&(v=v.getRootElevationBounds(),null!=v&&(n=Math.min(n,v.min),q=Math.max(q,v.max)))});return{min:n,max:q}}async queryElevation(n,q,
t,v,r,y=null,z=0){const D=this._getElevationQuery(v);try{const C=await D.queryElevation(n,q,y,z);return"scene"===r?x(C,this._scene,n,q,t,v,r):C}catch(C){return m.throwIfAbortError(C),this.getElevation(n,q,t,v,r)}}register(n,q){this.addHandles(q.on("elevation-change",t=>this.emit("elevation-change",t)),q);this._providersFromContext(n).push(q)}unregister(n){this.removeHandles(n);for(const q of[this._im,this._ground,this._scene]){const t=q.indexOf(n);-1<t&&q.splice(t,1)}}_providersFromContext(n){switch(n){case "ground":return this._ground;
case "im":return this._im;case "scene":return this._scene}}_getElevationQuery(n=this.view.spatialReference){const q=this._elevationQueryCached;if(null!=q&&u.equals(n,q.spatialReference))return q;q?.destroy({completeTasks:!0});const {wkid:t,wkt:v,wkt2:r,latestWkid:y}=n;return this._elevationQueryCached=n=new w.ElevationQuery(this.view.resourceController.scheduler,new h({wkid:t,wkt:v,wkt2:r,latestWkid:y}),()=>this.view.map?.ground,{maximumAutoTileRequests:4})}};b.__decorate([f.property({constructOnly:!0})],
a.CombinedElevationProvider.prototype,"view",void 0);b.__decorate([f.property()],a.CombinedElevationProvider.prototype,"spatialReference",null);a.CombinedElevationProvider=b.__decorate([p.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../geometry ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,g,d,k,m){class f{constructor(l,e){this.spatialReference=l;this._view=e}getElevation(l,e,p){return this._view.elevationProvider.getElevation(l,e,0,this.spatialReference,p)}async queryElevation(l,e,p,h,u){return this._view.elevationProvider.queryElevation(l,e,0,this.spatialReference,u,p,h)}}class c{constructor(l,e,p,h){this.spatialReference=e;this._getElevationQueryProvider=p;this._queries=[];this._queryOptions={...h,ignoreInvisibleLayers:!0};this._frameTask=l.registerTask(k.TaskPriority.ELEVATION_QUERY,
this)}destroy({completeTasks:l}={completeTasks:!1}){this._frameTask.remove();if(this.running)if(l)this.runTask(k.noBudget);else for(const e of this._queries)e.result.reject(d.createAbortError())}queryElevation(l,e,p,h=0){const u=d.createResolver(),w={x:l,y:e,minDemResolution:h,result:u,signal:p};this._queries.push(w);d.onAbort(p,()=>{g.remove(this._queries,w);u.reject(d.createAbortError())});return u.promise}get running(){return 0<this._queries.length}runTask(l){const e=this._queries;this._queries=
[];const p=this._getElevationQueryProvider();if(p){var h=e.map(n=>[n.x,n.y]),u=e.reduce((n,q)=>Math.min(n,q.minDemResolution),Infinity);h=new m({points:h,spatialReference:this.spatialReference});var w=1<e.length&&e.some(n=>!!n.signal)?new AbortController:null,x=null!=w?w.signal:e[0].signal;if(null!=w){let n=0;e.forEach(q=>d.onAbort(q.signal,()=>{n++;q.result.reject(d.createAbortError());n===e.length&&w.abort()}))}p.queryElevation(h,{...this._queryOptions,minDemResolution:u,signal:x}).then(n=>{e.forEach((q,
t)=>{null!=q.signal&&q.signal.aborted?q.result.reject(d.createAbortError()):q.result.resolve(n.geometry.points[t][2])})}).catch(n=>{e.forEach(q=>q.result.reject(n))})}else e.forEach(n=>n.result.reject());l.madeProgress()}get test(){const l=this;return{update:()=>0<l._queries.length&&l.runTask(k.noBudget)}}}a.ElevationQuery=c;a.ViewElevationProvider=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has",
"../../../core/time"],function(a,b){function g(){const m=!!a("esri-mobile"),f=!!a("ios"),c=b.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxNumberOfDrawCalls:8E3,maxTotalNumberOfVertices:255E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:b.Milliseconds(0),lodCrossfadeoutDuration:b.Milliseconds(0),
lodCrossfadeUncoveredDuration:b.Milliseconds(0)},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0,textureFadeDuration:b.Milliseconds(0)},fadeDuration:b.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+k.IPhone12Pro,
additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1E5,maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:625E4,polygonLodFactor:m?.8:1,polylineLodFactor:m?1.2:1.5,snapshotAvailable:!f,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:m},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:b.Milliseconds(0),lodCrossfadeoutDuration:b.Milliseconds(0),lodCrossfadeUncoveredDuration:c},
point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:m},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:c},fadeDuration:c,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:m?600+k.GalaxyS20:750+k.FullHD,additionalCacheMemory:m?-100:
150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1E5,maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:125E5,polygonLodFactor:m?1.2:2,polylineLodFactor:m?1.2:2,snapshotAvailable:!f,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:b.Milliseconds(0),lodCrossfadeoutDuration:b.Milliseconds(0),lodCrossfadeUncoveredDuration:c},point:{lodFactor:1},
integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:c},fadeDuration:c,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:m?900+k.SurfacePro7:1500+k.FullHDRetina,additionalCacheMemory:m?-150:0,frameRate:0,
maximumPixelRatio:m?1:Infinity}}}class d{static isValidProfile(m){return m in d.profiles}static getDefaultProfile(){return a("esri-iPhone")?"low":"medium"}static apply(m,f){m=d.profiles[m];f.graphics3D.maxTotalNumberOfFeatures=m.graphics3D.maxTotalNumberOfFeatures;f.graphics3D.maxNumberOfDrawCalls=m.graphics3D.maxNumberOfDrawCalls;f.graphics3D.maxTotalNumberOfVertices=m.graphics3D.maxTotalNumberOfVertices;f.graphics3D.polygonLodFactor=m.graphics3D.polygonLodFactor;f.graphics3D.polylineLodFactor=m.graphics3D.polylineLodFactor;
f.graphics3D.snapshotAvailable=m.graphics3D.snapshotAvailable;f.graphics3D.skipHighSymbolLods=m.graphics3D.skipHighSymbolLods;f.graphics3D.uncompressedTextureDownsamplingEnabled=m.graphics3D.uncompressedTextureDownsamplingEnabled;const c=f.sceneService.object,l=m.sceneService.object;c.lodFactor=l.lodFactor;c.lodCrossfadeinDuration=l.lodCrossfadeinDuration;c.lodCrossfadeoutDuration=l.lodCrossfadeoutDuration;c.lodCrossfadeUncoveredDuration=l.lodCrossfadeUncoveredDuration;f.sceneService.point.lodFactor=
m.sceneService.point.lodFactor;f.sceneService.integratedMesh.lodFactor=m.sceneService.integratedMesh.lodFactor;f.sceneService.pointCloud.lodFactor=m.sceneService.pointCloud.lodFactor;f.sceneService.uncompressedTextureDownsamplingEnabled=m.sceneService.uncompressedTextureDownsamplingEnabled;f.tiledSurface.lodBias=m.tiledSurface.lodBias;f.tiledSurface.angledSplitBias=m.tiledSurface.angledSplitBias;f.tiledSurface.vtlContentZoom=m.tiledSurface.vtlContentZoom;f.tiledSurface.reduceTileLevelDifferences=
m.tiledSurface.reduceTileLevelDifferences;f.tiledSurface.textureFadeDuration=m.tiledSurface.textureFadeDuration;f.heatmap.pixelRatio=m.heatmap.pixelRatio;f.heatmap.maxTotalNumberOfFeatures=m.heatmap.maxTotalNumberOfFeatures;f.fadeDuration=m.fadeDuration;f.antialiasingEnabled=m.antialiasingEnabled;f.physicallyBasedRenderingEnabled=m.physicalBasedRenderingEnabled;f.highQualityTransparency=m.highQualityTransparency;f.highResolutionAtmosphere=m.highResolutionAtmosphere;f.reflections=m.reflections;f.ambientOcclusion=
m.ambientOcclusion;f.memoryLimit=m.memoryLimit;f.additionalCacheMemory=m.additionalCacheMemory;f.frameRate=m.frameRate;f.maximumPixelRatio=m.maximumPixelRatio}}d.test={reset(){const m=g();for(const f of Object.keys(m))d.profiles[f]=m[f]}};const k={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};(d||(d={})).profiles=g();return d})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../webgl-engine/effects/highlight/HighlightDefaults".split(" "),
function(a,b,g,d,k,m,f,c,l){g=class extends g{constructor(){super(...arguments);this.color=l.defaultColor.clone();this.haloColor=null;this.haloOpacity=l.defaultHaloOpacity;this.fillOpacity=l.defaultFillOpacity;this.shadowOpacity=l.defaultShadowOpacity;this.shadowColor=l.defaultShadowColor.clone();this.shadowDifference=l.defaultShadowDifference}};a.__decorate([d.property({type:b})],g.prototype,"color",void 0);a.__decorate([d.property({type:b})],g.prototype,"haloColor",void 0);a.__decorate([d.property()],
g.prototype,"haloOpacity",void 0);a.__decorate([d.property()],g.prototype,"fillOpacity",void 0);a.__decorate([d.property()],g.prototype,"shadowOpacity",void 0);a.__decorate([d.property({type:b})],g.prototype,"shadowColor",void 0);a.__decorate([d.property()],g.prototype,"shadowDifference",void 0);return g=a.__decorate([c.subclass("esri.views.3d.support.HighlightOptions")],g)})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDefaults":function(){define(["exports","../../../../../Color"],function(a,
b){const g=new b([0,255,255]);b=new b([0,0,0]);a.defaultColor=g;a.defaultFillOpacity=.25;a.defaultHaloOpacity=1;a.defaultShadowColor=b;a.defaultShadowDifference=.2;a.defaultShadowOpacity=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p{constructor(h,u){this.spatialReference=u;this.unitInMeters=d.getMetersPerUnitForSR(this.spatialReference,k.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=m.getGeometryServiceURL(h&&"portalItem"in h?h.portalItem:void 0).catch(()=>{throw new g("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}async toGeographic(h){var u=await this._geometryServiceURLPromise;let w=!0;Array.isArray(h[0])&&
"number"!==typeof h[0]||(h=[h],w=!1);h=h.map(x=>x instanceof l?x:new l(x,this.spatialReference));h=new c({geometries:h,outSpatialReference:e.WGS84});u=(await f.project(u,h)).map(x=>"point"===x.type?[x.x,x.y]:void 0).filter(x=>!!x);return w?u:u[0]}}a.MapCoordsHelper=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,g,d,k,m){async function f(c=null,l){if(b.geometryServiceUrl)return b.geometryServiceUrl;if(!c)throw new g("internal:geometry-service-url-not-configured");c="portal"in c?c.portal||d.getDefault():c;await c.load({signal:l});l=c.helperServices?.geometry?.url;if(!l)throw new g("internal:geometry-service-url-not-configured");return l}a.getGeometryServiceURL=f;a.projectGeometry=async function(c,l,e=null,p){e=await f(e,p);const h=new m;h.geometries=[c];h.outSpatialReference=l;if((c=await k.project(e,
h,{signal:p}))&&Array.isArray(c)&&1===c.length)return c[0];throw new g("internal:geometry-service-projection-failed");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define("exports ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),function(a,b,g,d,k,m,f){const c=g.ensureType(f);a.project=async function(l,e,p){e=c(e);l=k.parseUrl(l);const h=
{...l.query,f:"json",...e.toJSON()},u=e.outSpatialReference,w=d.getJsonType(e.geometries[0]);e=k.asValidOptions(h,p);return b(l.path+"/project",e).then(({data:{geometries:x}})=>m.decodeGeometries(x,w,u))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,g,d,k,m,f,c,l){b=class extends b.JSONSupport{constructor(e){super(e);this.geometries=[];this.transformForward=this.transformation=this.outSpatialReference=null}toJSON(){const e=this.geometries.map(u=>u.toJSON()),p=this.geometries[0],h={};h.outSR=l.srToRESTValue(this.outSpatialReference);h.inSR=l.srToRESTValue(p.spatialReference);h.geometries=JSON.stringify({geometryType:c.getJsonType(p),geometries:e});this.transformation&&(h.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(h.transformForward=this.transformForward);return h}};a.__decorate([g.property()],b.prototype,"geometries",void 0);a.__decorate([g.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);a.__decorate([g.property()],b.prototype,"transformation",void 0);a.__decorate([g.property()],b.prototype,"transformForward",void 0);return b=a.__decorate([f.subclass("esri.rest.support.ProjectParameters")],b)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){let l=class extends b{constructor(){super(...arguments);this.minTotalNumberOfFeatures=2E3;this.maxTotalNumberOfFeatures=5E4;this.maxNumberOfDrawCalls=17E3;this.maxTotalNumberOfVertices=17E5;this.snapshotAvailable=!0;this.polylineLodFactor=this.polygonLodFactor=1;this.uncompressedTextureDownsamplingEnabled=this.skipHighSymbolLods=!1}};a.__decorate([d.property()],l.prototype,"minTotalNumberOfFeatures",void 0);a.__decorate([d.property()],l.prototype,"maxTotalNumberOfFeatures",
void 0);a.__decorate([d.property()],l.prototype,"maxNumberOfDrawCalls",void 0);a.__decorate([d.property()],l.prototype,"maxTotalNumberOfVertices",void 0);a.__decorate([d.property()],l.prototype,"snapshotAvailable",void 0);a.__decorate([d.property()],l.prototype,"polygonLodFactor",void 0);a.__decorate([d.property()],l.prototype,"polylineLodFactor",void 0);a.__decorate([d.property()],l.prototype,"skipHighSymbolLods",void 0);a.__decorate([d.property()],l.prototype,"uncompressedTextureDownsamplingEnabled",
void 0);l=a.__decorate([c.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],l);let e=class extends b{constructor(){super(...arguments);this.lodFactor=1}};a.__decorate([d.property()],e.prototype,"lodFactor",void 0);e=a.__decorate([c.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],e);let p=class extends e{constructor(){super(...arguments);this.lodCrossfadeinDuration=g.Milliseconds(0);this.lodCrossfadeoutDuration=g.Milliseconds(0);this.lodCrossfadeUncoveredDuration=
g.Milliseconds(0)}};p=a.__decorate([c.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],p);let h=class extends b{constructor(){super(...arguments);this.object=new p;this.point=new e;this.integratedMesh=new e;this.pointCloud=new e;this.uncompressedTextureDownsamplingEnabled=!1}};a.__decorate([d.property({type:p})],h.prototype,"object",void 0);a.__decorate([d.property({type:e})],h.prototype,"point",void 0);a.__decorate([d.property({type:e})],h.prototype,"integratedMesh",void 0);
a.__decorate([d.property({type:e})],h.prototype,"pointCloud",void 0);a.__decorate([d.property()],h.prototype,"uncompressedTextureDownsamplingEnabled",void 0);h=a.__decorate([c.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],h);let u=class extends b{constructor(){super(...arguments);this.lodBias=0;this.vtlContentZoom=this.angledSplitBias=1;this.reduceTileLevelDifferences=!0;this.textureFadeDuration=g.Milliseconds(400)}};a.__decorate([d.property()],u.prototype,"lodBias",void 0);
a.__decorate([d.property()],u.prototype,"angledSplitBias",void 0);a.__decorate([d.property()],u.prototype,"vtlContentZoom",void 0);a.__decorate([d.property()],u.prototype,"reduceTileLevelDifferences",void 0);a.__decorate([d.property()],u.prototype,"textureFadeDuration",void 0);u=a.__decorate([c.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],u);let w=class extends b{constructor(){super(...arguments);this.pixelRatio=1;this.maxTotalNumberOfFeatures=5E4}};a.__decorate([d.property()],
w.prototype,"pixelRatio",void 0);a.__decorate([d.property()],w.prototype,"maxTotalNumberOfFeatures",void 0);w=a.__decorate([c.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],w);b=class extends b{constructor(){super(...arguments);this.graphics3D=new l;this.sceneService=new h;this.tiledSurface=new u;this.heatmap=new w;this.fadeDuration=g.Milliseconds(400);this.antialiasingEnabled=!0;this.physicallyBasedRenderingEnabled=!1;this.highQualityTransparency=!0;this.ambientOcclusion=this.reflections=
this.highResolutionAtmosphere=!1;this.memoryLimit=750;this.additionalCacheMemory=0;this.frameRate=void 0;this.maximumPixelRatio=Infinity}};a.__decorate([d.property({type:l})],b.prototype,"graphics3D",void 0);a.__decorate([d.property({type:h})],b.prototype,"sceneService",void 0);a.__decorate([d.property({type:u})],b.prototype,"tiledSurface",void 0);a.__decorate([d.property({type:w})],b.prototype,"heatmap",void 0);a.__decorate([d.property()],b.prototype,"fadeDuration",void 0);a.__decorate([d.property()],
b.prototype,"antialiasingEnabled",void 0);a.__decorate([d.property()],b.prototype,"physicallyBasedRenderingEnabled",void 0);a.__decorate([d.property()],b.prototype,"highQualityTransparency",void 0);a.__decorate([d.property()],b.prototype,"highResolutionAtmosphere",void 0);a.__decorate([d.property()],b.prototype,"reflections",void 0);a.__decorate([d.property()],b.prototype,"ambientOcclusion",void 0);a.__decorate([d.property()],b.prototype,"memoryLimit",void 0);a.__decorate([d.property()],b.prototype,
"additionalCacheMemory",void 0);a.__decorate([d.property()],b.prototype,"frameRate",void 0);a.__decorate([d.property()],b.prototype,"maximumPixelRatio",void 0);return b=a.__decorate([c.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../core/libs/gl-matrix-2/types/vec3 ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToDehydratedPoint ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){class t{constructor(v,r,y,z){this.viewingMode=v;this.spatialReference=r;this.unitInMeters=y;this._coordinateSystem=z;this._tmpCoordinateSystem=h.create(z)}set extent(v){v&&h.setExtent(this._coordinateSystem,v,this._coordinateSystem)}getAltitude(v){return h.altitudeAt(this._coordinateSystem,v)}setAltitude(v,r,y=v){return h.setAltitudeAt(this._coordinateSystem,y,r,v)}setAltitudeOfTransformation(v,r){h.setAltitudeOfTransformation(this._coordinateSystem,r,v,
r)}worldUpAtPosition(v,r){return h.normalAt(this._coordinateSystem,v,r)}worldBasisAtPosition(v,r,y){return h.axisAt(this._coordinateSystem,v,r,y)}basisMatrixAtPosition(v,r){const y=this.worldBasisAtPosition(v,p.Axis.X,x.sv3d.get()),z=this.worldBasisAtPosition(v,p.Axis.Y,x.sv3d.get());v=this.worldBasisAtPosition(v,p.Axis.Z,x.sv3d.get());d.set(r,y[0],y[1],y[2],0,z[0],z[1],z[2],0,v[0],v[1],v[2],0,0,0,0,1);return r}headingAtPosition(v,r){const y=this.worldUpAtPosition(v,x.sv3d.get());v=this.worldBasisAtPosition(v,
p.Axis.Y,x.sv3d.get());r=w.angleAroundAxis(r,v,y);return b.rad2deg(r)}intersectManifoldClosestSilhouette(v,r,y){h.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);h.intersectRayClosestSilhouette(this._tmpCoordinateSystem,v,y);return y}intersectManifold(v,r,y){h.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);r=x.sv3d.get();return h.intersectRay(this._tmpCoordinateSystem,v,r)?k.copy(y,r):null}intersectInfiniteManifold(v,r,y){if(this.viewingMode===q.ViewingMode.Global)return this.intersectManifold(v,
r,y);h.elevate(this._coordinateSystem,r,this._tmpCoordinateSystem);r=this._tmpCoordinateSystem.value;const z=x.sv3d.get();return u.intersectRay(r.plane,v,z)?k.copy(y,z):null}toRenderCoords(v,r,y){return n.isDehydratedPoint(v)?f.projectPointToVector(v,r,this.spatialReference):e.projectVectorToVector(v,r,y,this.spatialReference)}fromRenderCoords(v,r,y=null){return n.isDehydratedPoint(r)?(null!=y&&(r.spatialReference=y),c.projectVectorToDehydratedPoint(v,this.spatialReference,r)):m.isVec3(r)?e.projectVectorToVector(v,
this.spatialReference,r,y)?r:null:l.projectVectorToPoint(v,this.spatialReference,r)}static create(v,r){switch(v){case q.ViewingMode.Local:return new t(q.ViewingMode.Local,r,g.getMetersPerUnitForSR(r),h.createLocal());case q.ViewingMode.Global:return new t(q.ViewingMode.Global,r,1,h.createGlobal(r))}}static renderUnitScaleFactor(v,r){return g.getMetersPerCartesianUnitForSR(v)/g.getMetersPerCartesianUnitForSR(r)}}a.RenderCoordsHelper=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/libs/gl-matrix-2/types/vec3":function(){define(["exports","../../../typedArrayUtil"],function(a,b){function g(k){return b.isFloat32Array(k)&&3<=k.length}function d(k){return(b.isFloat64Array(k)||Array.isArray(k))&&3<=k.length}a.isVec3=function(k){return g(k)||d(k)};a.isVec3f32=g;a.isVec3f64=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/signal ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){g=class extends g{constructor(){super(...arguments);this.updating=!1}};b.__decorate([e.property({readOnly:!0})],g.prototype,"updating",void 0);g=b.__decorate([w.subclass("esri.views.3d.support.ResourceControllerMain")],g);let v=class extends g{constructor(){super(...arguments);this._normalTask=this._immediateTask=t.ImmediateTask;this._updatingObjects=c.signal([]);this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=
t.newScheduler();this._memoryController=n.newMemoryController(this.view);this._streamDataLoader=new q.StreamDataLoader;this._streamDataLoader.setup(x.maxDownloadSlots,x.downloadSlotsPerClient,this._scheduler);this.addHandles([m.watch(()=>this.view.state?.mode,r=>{null!=r&&(this._scheduler.state=r)},m.sync),m.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=f.addFrameTask({update:r=>this._frame(r)});this._immediateTask=this._scheduler.registerTask(t.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE);
this._normalTask=this._scheduler.registerTask(t.TaskPriority.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove();this._normalTask.remove();this._frameTask=k.removeMaybe(this._frameTask);this._streamDataLoader=k.destroyMaybe(this._streamDataLoader);this._memoryController=k.destroyMaybe(this._memoryController);this._scheduler=k.destroyMaybe(this._scheduler);this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||
this._updatingObjects?.value.some(r=>r.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(r){const y=this._streamDataLoader;return{request(z,D,C){return y.request(z,D,r,C)},get busy(){return!y.hasDownloadSlots(r)}}}addUpdatingObject(r){const y=this._updatingObjects;y.value=[...y.value,r];return d.makeHandle(()=>{y.value=y.value.filter(z=>z!==r)})}_frame(r){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(l.secondsFromMilliseconds(r.deltaTime)),
!this._scheduler))return;this._memoryController.update();this._scheduler.updateBudget(r)&&this._scheduler.frame()}}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r)}}};b.__decorate([e.property()],v.prototype,"view",void 0);b.__decorate([e.property()],v.prototype,"_scheduler",void 0);b.__decorate([e.property()],v.prototype,"_memoryController",void 0);b.__decorate([e.property()],v.prototype,
"_streamDataLoader",void 0);b.__decorate([e.property()],v.prototype,"_immediateTask",void 0);b.__decorate([e.property()],v.prototype,"_normalTask",void 0);b.__decorate([e.property()],v.prototype,"_updatingObjects",void 0);b.__decorate([e.property({readOnly:!0})],v.prototype,"updating",null);v=b.__decorate([w.subclass("esri.views.3d.support.ResourceControllerImpl")],v);a.newResourceController=function(r){return new v({view:r})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/index":function(){define(["exports"],
function(a){a.ClientType=void 0;(function(g){g[g.ELEVATION=0]="ELEVATION";g[g.BASEMAP=1]="BASEMAP";g[g.I3S_INDEX=2]="I3S_INDEX";g[g.I3S_DATA=3]="I3S_DATA";g[g.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const g=[];g[a.ClientType.ELEVATION]=10;g[a.ClientType.BASEMAP]=10;g[a.ClientType.I3S_INDEX]=10;g[a.ClientType.I3S_DATA]=10;g[a.ClientType.SYMBOLOGY]=5;return g})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/MemCache ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./MemoryManagedView".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h){let u=class extends g{constructor(w){super(w);this._quality=1;this._usedMemory=
0;this._updating=!1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=0;this._cacheStorage=new k.MemCacheStorage;this._warnMemoryUsage=null;this._numQualityChanges=0;this._maxMemory=750;this._additionalCacheMemory=0;this.addHandles(m.addFrameTask({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(w){null==w||0>=w||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<
w&&this._updateQuality(1),this._maxMemory=w)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(w){null!=w&&(this._additionalCacheMemory=w)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(w,x){return new k.MemCache(w,this._cacheStorage,x)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(!(0>=
this._memoryPredicted)||this._updating){var w=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(w){if(1.1<this._memoryPredicted||1<this._usedMemory)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):.1<this._quality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,
this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._usedMemory?(this._stableQuality=0,this._canFastRecover=!1,w=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._usedMemory&&1>this._quality?(this._stableQuality=this._quality,w=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=w}}_updateQuality(w){w=Math.min(Math.max(w,.1),1);if(w===this._quality)return!1;
this._quality=w;++this._numQualityChanges;return!0}_layersUpdating(){return this.view.allLayerViews.some(w=>!!w.updating)}_updateMemory(){if(this.view){this.view._stage?.renderer?.tick();var w=(this.view.basemapTerrain?.usedMemory??0)+(this.view._stage?.renderer?.usedMemory??0),x=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(t=>{if(h.isMemoryManagedView(t)){const v=t.ignoresMemoryFactor?this._quality:1;w+=t.usedMemory*v;x+=t.unloadedMemory*v}});var n=null==this._warnMemoryUsage||Math.round(10*
w)!==Math.round(10*this._warnMemoryUsage),q=1048576*this.maxMemory;if(w>q&&n){this._warnMemoryUsage=w;n=v=>(v/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const t=Math.round(100*this._quality);d.getLogger(this).warn(`Memory Limit exceeded! Limit: ${n(q)} Current: ${n(w)} Projected: ${n(w+x)} Quality: ${t}%`)}this._usedMemory=w/q;this._memoryPredicted=(w+x)/q;this._cacheStorage.maxSize=Math.max(0,q-w+1048576*this.additionalCacheMemory)}}get test(){const w=this;return{cacheStorage:this._cacheStorage,
resetQualityChanges:()=>{const x=w._numQualityChanges;w._numQualityChanges=0;return x}}}};b.__decorate([f.property({constructOnly:!0})],u.prototype,"view",void 0);b.__decorate([f.property()],u.prototype,"maxMemory",null);b.__decorate([f.property()],u.prototype,"additionalCacheMemory",null);b.__decorate([f.property({readOnly:!0})],u.prototype,"memoryFactor",null);b.__decorate([f.property({readOnly:!0})],u.prototype,"updating",null);b.__decorate([f.property({readOnly:!0})],u.prototype,"usedMemory",
null);b.__decorate([f.property({readOnly:!0})],u.prototype,"usedCacheMemory",null);b.__decorate([f.property()],u.prototype,"_quality",void 0);b.__decorate([f.property()],u.prototype,"_usedMemory",void 0);b.__decorate([f.property()],u.prototype,"_updating",void 0);b.__decorate([f.property()],u.prototype,"_stableQuality",void 0);b.__decorate([f.property()],u.prototype,"_maxMemory",void 0);b.__decorate([f.property()],u.prototype,"_additionalCacheMemory",void 0);u=b.__decorate([p.subclass("esri.views.3d.support.MemoryController")],
u);a.minQuality=.1;a.newMemoryController=function(w){return new u({view:w})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MemoryManagedView":function(){define(["exports"],function(a){a.isMemoryManagedView=function(b){return"usedMemory"in b&&"unloadedMemory"in b&&"ignoresMemoryFactor"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(r){if(2>r.byteLength)return"unknown";r=new Uint8Array(r,0,r.byteLength);return 137===r[0]&&80===r[1]?"image/png":71===r[0]&&73===r[1]?"image/gif":66===r[0]&&77===r[1]?"image/bmp":255===r[0]&&216===r[1]?"image/jpeg":"unknown"}a.StreamDataLoader=class extends d{constructor(){super(...arguments);this._tasks=new Map;this._onLoadQueue=[];this._doneQueue=[];this.updating=!1}setup(r,y,z){this._loadQueue=new u.AsyncWorkerQueue((D,C)=>this._startLoading(D,
C),(D,C)=>this._doneLoadingCB(D,C),r,y);z&&(this._frameTask=z.registerTask(x.TaskPriority.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=c.removeMaybe(this._frameTask);this._tasks.forEach(r=>c.abortMaybe(r.abortController));this._loadQueue=c.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null}hasDownloadSlots(r){return this._loadQueue.hasQuota(r)}request(r,y,z,D={}){const C=l.createResolver();C.__signal=null!=D?D.signal:null;const E=this._createOrUpdateTask(r,y,z,
D,C);l.onAbort(D,()=>this._cancelRequest(E,C));return C.promise}_createTask(r,y,z,D,C,E){r=new v(r,y,z,D,C);this._updateTask(r,E);this._tasks.set(C,r);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(r);return r}_cancelRequest(r,y){k.removeUnordered(r.resolvers,y);y.reject(l.createAbortError());0===r.resolvers.length&&(r.status===a.TaskStatus.DOWNLOADING&&(r.status=a.TaskStatus.CANCELLED,this._loadQueue.cancel(r),r.abortController?.abort(),r.request=null,r.abortController=null),
r.status=a.TaskStatus.CANCELLED,this._tasks.delete(r.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(r,y){r.resolvers.push(y)}_createOrUpdateTask(r,y,z,D,C){const E=`${D?.uid||r}:${y}:${z}`,A=this._tasks.get(E);return A?(this._updateTask(A,C),A):this._createTask(r,D,y,z,E,C)}_doneLoadingCB(r,y){this._loadQueue&&(w.assert(r.status===a.TaskStatus.DOWNLOADING),r.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:r,err:y}):this._doneLoading(r,y))}get running(){return 0<
this._doneQueue.length||0<this._onLoadQueue.length}runTask(r){for(;!r.done&&0<this._onLoadQueue.length;){var y=this._onLoadQueue.shift();l.throwIfAborted(y.task.abortController);y.task.abortController=null;y.callback(y.task);r.madeProgress()}for(;!r.done&&0<this._doneQueue.length;)y=this._doneQueue.shift(),y.task.status!==a.TaskStatus.DOWNLOADED&&(y.err=y.err||l.createAbortError()),this._doneLoading(y.task,y.err),r.madeProgress()}_doneLoading(r,y){if(y&&!l.isAbortError(y)&&0<r.numRetries)--r.numRetries,
this._loadQueue.push(r);else{var z=r.result instanceof HTMLImageElement?0:r.resolvers.length;for(const D of r.resolvers)if(y)l.isAbortError(y)?D.reject(y):D.reject(new m("stream-data-loader:request-error",`Failed to request resource at '${r.url}'. ${y}`,{url:r.url,error:y}));else{--z;const C=0<z?f.clone(r.result):r.result;D.resolve(C)}this._tasks.delete(r.key);0===this._tasks.size&&this._set("updating",!1)}}_startLoading(r,y){if(r.status===a.TaskStatus.CANCELLED)return!1;r.startTime=performance.now();
r.status=a.TaskStatus.DOWNLOADING;let z,D;switch(r.docType){case "binary":D="array-buffer";z=0;break;case "image":D="image";break;case "image+type":D="array-buffer";break;default:D="json"}r.abortController=new AbortController;const C=r.abortController.signal;r.request=g(r.url,{...r.options,responseType:D,timeout:z,signal:C});let E=()=>{};const A=G=>{r.duration=performance.now()-r.startTime;r.size=G instanceof ArrayBuffer?G.byteLength:r.size||0;r.result=G;this._frameTask?this._onLoadQueue.push({callback:y,
task:r}):(r.abortController=null,y(r))},F=G=>{r.status===a.TaskStatus.DOWNLOADING&&y(r,G);E()};if("image+type"!==r.docType)return r.request.then(G=>A(G.data),F),!0;r.request.then(G=>{G=G.data;const I=n(G);D="image";r.size=G.byteLength;if("unknown"===I)r.request=g(r.url,{responseType:D,timeout:z,signal:C}),r.request.then(B=>A(B.data),F);else{G=new Blob([G],{type:I});var H=window.URL.createObjectURL(G);E=()=>window.URL.revokeObjectURL(H);r.request=g(H,{responseType:D,timeout:z,signal:C});r.request.then(B=>
A(new t(B.data,I,E)),F)}},F);return!0}get test(){return{loadQueue:this._loadQueue}}};b.__decorate([e.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=b.__decorate([h.subclass("esri.views.3d.support.StreamDataLoader")],a.StreamDataLoader);const q={numRetries:0};class t{constructor(r,y,z){this.image=r;this.type=y;this.release=z}get isOpaque(){return"image/jpeg"===this.type}}class v extends u.BaseTask{constructor(r,y,z,D,C){super(D);this.url=r;this.options=
y;this.docType=z;this.key=C;this.result=null;this.status=a.TaskStatus.QUEUED;this.abortController=this.request=null;this.resolvers=[];this.startTime=0;this.numRetries=q.numRetries}}a.TaskStatus=void 0;(function(r){r[r.QUEUED=1]="QUEUED";r[r.DOWNLOADING=2]="DOWNLOADING";r[r.DOWNLOADED=3]="DOWNLOADED";r[r.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=t;a.isImageWithType=function(r){return"image"in r&&"type"in r};a.test=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../webgl-engine/lib/Util"],function(a,b){class g{constructor(f){this.client=f;this._cancelled=!1;this.duration=this.size=0}}class d{constructor(f){this.typeWorkerQuota=f;this.tasks=[];this.numWorkers=0;this.statistics=new k}}class k{constructor(){this.speed=this.duration=this.size=this.requests=0}}class m{constructor(f,c,l,e){this._workerFunc=f;this._callbackFunc=c;this._maxTotalNumWorkers=l;this._totalNumWorkers=0;this._clients=
e.map(p=>new d(p))}destroy(){this._clients.length=0}hasQuota(f){return(f=this._clients[f])?this._totalNumWorkers<this._maxTotalNumWorkers||f.numWorkers+f.tasks.length<f.typeWorkerQuota:!1}push(f){const c=this._clients[f.client];c&&(this._totalNumWorkers<this._maxTotalNumWorkers?(c.numWorkers++,this._totalNumWorkers++,this._workerFunc(f,(l,e)=>this._taskCallback(l,e))):c.tasks.push(f))}cancel(f){this._taskFinished(f);f._cancelled=!0}_taskFinished(f){const c=this._clients[f.client];this._totalNumWorkers--;
c&&(c.numWorkers--,c.statistics.requests++,c.statistics.size+=f.size||0,c.statistics.duration+=f.duration||0,c.statistics.speed=0<c.statistics.duration?c.statistics.size/c.statistics.duration:0,b.assert(0<=c.numWorkers));this._next()}_next(){for(const f of this._clients)if(f&&f.numWorkers<f.typeWorkerQuota&&this._processQueue(f))return;for(const f of this._clients)if(f&&this._processQueue(f))break}_processQueue(f){for(;0<f.tasks.length;)if(this._workerFunc(f.tasks.shift(),(c,l)=>this._taskCallback(c,
l)))return f.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(f,c){f._cancelled||(this._callbackFunc(f,c),this._taskFinished(f))}getStatsForType(f){return(f=this._clients[f])?{quota:f.typeWorkerQuota,workers:f.numWorkers,queueSize:f.tasks.length,requestStats:f.statistics}:null}get test(){const f=this;return{set workerFunc(c){f._workerFunc=c}}}}a.AsyncWorkerQueue=m;a.BaseTask=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/ByteSizeUnit",
"../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,b,g,d){class k{constructor(m){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];this.fboMemory=this.cachedMemory=0;if(null!=m.resourceController){const f=m.resourceController.memoryController;this.totalMemory=(f.maxMemory??0)*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(f.usedMemory*this.totalMemory);this.quality=
m.quality;this.load=m.resourceController.scheduler.load;this.cachedMemory=f.usedCacheMemory}this.terrainMemory=m.basemapTerrain?.usedMemory??0;this.edgesMemory=m?._stage?.renderer?.edgeView?.usedMemory??0;this.fboMemory=m?._stage?.renderer?.memoryInfo?.fbos??0;m.allLayerViews.items.forEach(f=>{(b.isMemoryManagedLayerView(f)||d.isSurfaceLayerView(f))&&this.layerPerformanceInfos.push(new g(f,m))});this.layerPerformanceInfos.sort((f,c)=>c.memory-f.memory)}}return k})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports",
"../../support/MemoryManagedView"],function(a,b){a.isMemoryManagedLayerView=function(g){return b.isMemoryManagedView(g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(a,b){class g{constructor(d,k){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=d.layer;
this.memory=b.isSurfaceLayerView(d)?k.basemapTerrain.getUsedMemoryForLayerView(d):d.usedMemory;a.isPerformanceInfoLayerView(d)&&(d=d.performanceInfo,this.displayedNumberOfFeatures=d.displayedNumberOfFeatures,this.maximumNumberOfFeatures=d.maximumNumberOfFeatures,this.totalNumberOfFeatures=d.totalNumberOfFeatures)}}return g})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(a){a.isPerformanceInfoLayerView=function(b){return"performanceInfo"in b};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./ITile ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(a,b,g,d,k,m,f,c,l){function e(D){return"imagery-tile"===D?.type||"wcs"===D?.type}function p(D){return"imagery-tile-3d"===D?.type}function h(D){return"tile-3d"===
D?.type}function u(D){return"vector-tile-3d"===D?.type}function w(D){return"wmts-3d"===D?.type}function x(D){return"elevation-3d"===D?.type}function n(D){return D&&(h(D)||p(D)||u(D)||w(D))}function q(D){return null!=D?.data&&"type"in D.data&&"vector-tile"===D.data.type}function t(D,C,E,A){return y[A].checkIfTileInfoSupportedForViewSR(D,E,C)}function v(D,C,E){D=d.getTileMaxtrixSetFromActiveLayer(D);if(null!=D)if(b.isCollection(D)){if(D=D.find(A=>null==t(A.tileInfo,A.fullExtent,C,E)))return{tileInfo:D.tileInfo,
fullExtent:D.fullExtent}}else return{tileInfo:D.tileInfo,fullExtent:D.fullExtent};return{tileInfo:null,fullExtent:null}}function r(D){return D.isWGS84||D.isWebMercator||g.isCGCS2000(D)||!g.isEarth(D)}const y={[k.ViewingMode.Global]:l.terrainUtilsSpherical,[k.ViewingMode.Local]:c.terrainUtilsPlanar};a.enableTerrainInternalChecks=!1;a.enableWaterproofnessTests=!1;const z={force512VTL:!1};c=[f.NeighborIndex.NORTH,f.NeighborIndex.EAST,f.NeighborIndex.SOUTH,f.NeighborIndex.WEST];l=[f.NeighborIndex.NORTH_EAST,
f.NeighborIndex.SOUTH_EAST,f.NeighborIndex.SOUTH_WEST,f.NeighborIndex.NORTH_WEST];a.almostEquals=function(D,C,E=1E-5){return Math.abs(D-C)<E};a.checkIfTileInfoSupportedForView=t;a.enableInternalTerrainChecks=function(D){a.enableTerrainInternalChecks=D};a.enableTerrainWaterproofnessChecks=function(D){a.enableWaterproofnessTests=D;a.enableTerrainInternalChecks=a.enableTerrainInternalChecks||D};a.eps=1E-5;a.getLayerWithExtentRange=function(D){return p(D)?{fullExtent:D.fullExtent,minScale:D.layer.minScale,
maxScale:D.layer.maxScale,tilemapCache:null}:D.layer};a.getTileInfoAndExtentFromWMTSLayer=v;a.getTiledLayerInfo=function(D,C,E){var A=null;let F=null;if("wmts"===D?.type)D=v(D,C,E),A=D.tileInfo,F=D.fullExtent;else if(F=e(D)?D.getCompatibleFullExtent(C):D.fullExtent,A=E===k.ViewingMode.Local,e(D))A=D.getCompatibleTileInfo(C,F,A);else if("vector-tile"===D?.type){A=A&&!r(C)||z.force512VTL;const G=D.tileInfo.spatialReference.isGeographic;A=A?D.tileInfo:D.tileInfo.getOrCreateCompatible(256,G?1:2)}else A=
D.tileInfo;return null!=A&&null!=F&&null==t(A,F,C,E)?{tileInfo:A,fullExtent:F}:null};a.internalAssert=function(D,C){if(a.enableTerrainInternalChecks&&!D)throw D=Error().stack?.slice(5),console.warn("Terrain internal: "+(C??"")+" at "+D),Error("Assertion failed"+(C?": "+C:""));};a.isBlendableLayerView=function(D){return D&&(h(D)||w(D)||p(D)||u(D))};a.isEast=function(D){return D===f.NeighborIndex.NORTH_EAST||D===f.NeighborIndex.EAST||D===f.NeighborIndex.SOUTH_EAST};a.isElevationLayerView=x;a.isGroupLayerView=
function(D){return"group"===D?.type};a.isImageryTileLayerView=p;a.isImageryTileRenderInfo=function(D){D=D?.sourceLayerInfo?.data;return null!=D&&"type"in D&&"raster-tile"===D.type};a.isMapTileLayerView=n;a.isNorth=function(D){return D===f.NeighborIndex.NORTH_EAST||D===f.NeighborIndex.NORTH||D===f.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(D){return D===f.NeighborIndex.NORTH_WEST||D===f.NeighborIndex.NORTH_EAST};a.isProjectableRasterLayer=e;a.isRasterTileRenderInfo=function(D){D=D?.sourceLayerInfo?.data;
return D instanceof HTMLImageElement||D instanceof m.ImageWithType||D instanceof HTMLCanvasElement||D instanceof ImageData};a.isSouth=function(D){return D===f.NeighborIndex.SOUTH_EAST||D===f.NeighborIndex.SOUTH||D===f.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(D){return n(D)||x(D)};a.isTextureTileRenderInfo=function(D){D=D?.sourceLayerInfo?.data;return null!=D&&"type"in D&&"tile-texture"===D.type};a.isTileLayerView=h;a.isVectorTileLayerView=u;a.isVectorTilePerLayerInfo=q;a.isVectorTileRenderInfo=
function(D){return q(D?.sourceLayerInfo)||!!D?.isVTLBackground};a.isWMTSLayerView=w;a.isWest=function(D){return D===f.NeighborIndex.NORTH_WEST||D===f.NeighborIndex.WEST||D===f.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(D){return D===f.NeighborIndex.NORTH_WEST||D===f.NeighborIndex.SOUTH_WEST};a.lij2s=function(D){return"["+D[0]+","+D[1]+","+D[2]+"]"};a.neighborCornerIndices=l;a.neighborEdgeIndices=c;a.oppositeCorner=function(D){return D===f.NeighborIndex.NORTH_EAST?f.NeighborIndex.SOUTH_WEST:
D===f.NeighborIndex.NORTH_WEST?f.NeighborIndex.SOUTH_EAST:D===f.NeighborIndex.SOUTH_WEST?f.NeighborIndex.NORTH_EAST:f.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(D){return D===f.NeighborIndex.NORTH?f.NeighborIndex.SOUTH:D===f.NeighborIndex.EAST?f.NeighborIndex.WEST:D===f.NeighborIndex.SOUTH?f.NeighborIndex.NORTH:f.NeighborIndex.EAST};a.releaseTileData=function(D){null!=D&&"release"in D&&D.release();return null};a.test=z;a.useFetchTileForLayer=function(D){return D.fetchTile&&!1!==D.hasOverriddenFetchTile};
a.v32s=function(D){return"("+D[0]+","+D[1]+","+D[2]+")"};a.vtlAssumes256PixelSizeAsDefault=r;a.weakAssert=function(D,C){D||console.warn("Terrain: "+C)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ITile":function(){define(["exports"],function(a){a.TileFrustumVisibility=void 0;(function(b){b[b.INSIDE=0]="INSIDE";b[b.INTERSECTS=1]="INTERSECTS";b[b.OUTSIDE=2]="OUTSIDE"})(a.TileFrustumVisibility||(a.TileFrustumVisibility={}));a.NeighborIndex=void 0;(function(b){b[b.NORTH=
0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=5]="SOUTH_WEST";b[b.WEST=6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,g,d,k,m,f,c){function l(q,t,v=0){q=q.extent;return null==q?!1:0===v?m.containsPoint(q,t):m.containsPointWithMargin(q,t,v*Math.min(q[2]-q[0],q[3]-q[1]))}function e(q,t,v,r){g.copy(u,v);u[r]=t[r];r=g.subtract(u,u,t);var y=g.subtract(w,q,t);y=g.dot(y,r);const z=g.dot(r,r);t=0>=y?t:z<=y?v:g.add(u,t,g.scale(r,r,y/z));q=g.subtract(u,q,t);return Math.PI/2-Math.atan(q[2]/Math.sqrt(q[0]*q[0]+q[1]*q[1]))}function p(q,t,v){q=q.extent;if(null==q)return 0;x[0]=q[0];x[1]=q[1];x[2]=v;n[0]=q[2];n[1]=
q[3];n[2]=v;q=v=Infinity;t[0]<x[0]?v=e(t,x,n,0):t[0]>n[0]&&(v=e(t,n,x,0));t[1]<x[1]?q=e(t,x,n,1):t[1]>n[1]&&(q=e(t,n,x,1));return Math.min(v,q)}function h(q,t,v){if(null==q)return c.getMissingTileInfoError();if(q.spatialReference.isGeographic&&!k.canProjectToWGS84ComparableLonLat(q.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var r=c.TilingScheme.checkUnsupported(q);if(null!=r)return r;if(null==
v)return new b("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var y=q.lods;r=y[0].resolution*2**y[0].level;var z=[r*q.size[0],r*q.size[1]];const D=[q.origin.x,q.origin.y];v=m.fromExtent(v);const C=m.create();c.TilingScheme.computeRowColExtent(v,z,D,C);z=(C[2]-C[0])*(C[3]-C[1]);z>f.maxRootTiles?(y=y[0].scale*2**y[0].level,r=Math.max((v[3]-v[1])/q.size[1],(v[2]-v[0])/q.size[0])*y/r,v=Math.floor(Math.log(r)/Math.log(10)),r=Math.ceil(r/10**v)*10**v,r=new b("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(y).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+r.toLocaleString()+".",{level0Scale:y,suggestedLevel0Scale:r,requiredNumRootTiles:z,allowedNumRootTiles:f.maxRootTiles})):r=null}if(r)return r;q=q.spatialReference;return null==t||q.equals(t)||t.isWGS84&&q.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const u=d.create(),
w=d.create(),x=d.create(),n=d.create();d=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:h,isInsideExtent:l,tiltToExtentEdge:p},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=h;a.isInsideExtent=l;a.terrainUtilsPlanar=d;a.tiltToExtentEdge=p})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports","../core/Error","../geometry/projection","../geometry/support/spatialReferenceUtils","../views/3d/terrain/TilingScheme"],function(a,
b,g,d,k){function m(){return!0}function f(){return 0}function c(e,p){if(null==e)return k.getMissingTileInfoError();const h=e.lods.length-1,u=e.spatialReference,w=g.canProjectToWGS84ComparableLonLat(u)||d.isMars(u)||d.isMoon(u);if(u.isWebMercator){if(!k.TilingScheme.makeWebMercatorAuxiliarySphere(h).compatibleWith(e))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(w){if(!k.TilingScheme.makeGCSWithTileSize(e.spatialReference,
e.size[0],h).compatibleWith(e))return e.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(null!=p&&!e.spatialReference.equals(p))return new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const l=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:c,isInsideExtent:m,tiltToExtentEdge:f},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=c;a.isInsideExtent=m;a.terrainUtilsSpherical=l;a.tiltToExtentEdge=f})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/ellipsoidUtils ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){class h{constructor(w){this.streamDataRequester=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=null;this._viewState=w.viewState;this._view=w.view;this._pointsOfInterest=w.pointsOfInterest;this.streamDataRequester=w.resourceController.createStreamDataRequester(l.ClientType.SYMBOLOGY);this.objectResourceCache=new c.ObjectResourceCache((n,q)=>w.resourceController.memoryController.newCache(n,q));this.textures=new e.StreamTextureCollection(this.streamDataRequester,
w.view._stage,w.resourceController.scheduler);const x=f.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=p.getSettings(w.viewingMode,x);this.screenSizePerspectiveSettingsLabels=p.getLabelSettings(w.viewingMode,x)}destroy(){this.textures.destroy();this.streamDataRequester=null}addGraphicsOwner(w){if(!w)return d.makeHandle();this._graphicsOwners.push(w);const x=m.watch(()=>w.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());
this._updateScreenSizePerspectiveEnabled();return d.makeHandle(()=>{x.remove();b.removeUnordered(this._graphicsOwners,w);this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){var w=this._graphicsOwners.some(x=>!0===x.layer?.screenSizePerspectiveEnabled);w&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new g,w=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([m.watch(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,
w,m.sync),this._viewState.events.on("camera-projection-changed",w)]),this._updateScreenSizePerspectiveSettings()):w||(this._screenSizePerspectiveHandles=k.destroyMaybe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){u.distance=this._pointsOfInterest.centerOnSurfaceInfrequent.distance;u.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(u);this.screenSizePerspectiveSettingsLabels.update(u);this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}
const u={distance:0,fovY:0};a.SharedSymbolResources=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,b,g,d,k,m){class f{constructor(c){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=c("gltf-resources",()=>{});this._wosrMemCache=c("wosr-resources",
()=>{})}destroy(){this._gltfLoading.forEach(c=>c.abortController.abort());this._wosrLoading.forEach(c=>c.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()}loadGLTF(c,l,e){const p=e?`gltfPBR:${c}`:`gltf:${c}`,h=this._gltfMemCache.get(p);return null!=h?Promise.resolve(h):this._loadOnce(this._gltfLoading,this._gltfMemCache,p,u=>k.loadGLTF(new d.DefaultLoadingContext(u.streamDataRequester),c,u,e),l)}loadWOSR(c,l){const e=`wosr:${c}:${l.disableTextures}`,p=this._wosrMemCache.get(e);
return null!=p?Promise.resolve(p):this._loadOnce(this._wosrLoading,this._wosrMemCache,e,h=>m.load(c,h),l)}async _loadOnce(c,l,e,p,h){g.throwIfAborted(h);const u=g.onAbort(h,()=>this._abortLoad(c,e));var w=c.get(e);w?w.refCount++:(w=new AbortController,p=p({...h,signal:w.signal}),w={refCount:1,abortController:w,promise:p},c.set(e,w));try{const x=await w.promise;l.put(e,x,x.size);c.delete(e);g.throwIfAborted(h);return x}finally{b.removeMaybe(u)}}_abortLoad(c,l){const e=c.get(l);null!=e&&0<--e.refCount||
(c.delete(l),null!=e&&e.abortController.abort())}}a.ObjectResourceCache=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/Texture ../../webgl/enums".split(" "),function(a,b,g,d,k,m){class f extends d.TextureCollection{constructor(c,l,e){super(l,e);this._streamDataRequester=c}async fromUrl(c,l,e){b.throwIfAborted(e);e=null!=
e?e.signal:null;const p=this.makeUid(c,l);let h=this._textureRequests.get(p);if(!h){const u=new AbortController,w=this._streamDataRequester.request(c,"image",{uid:p,signal:u.signal});h=new d.TextureRequest;h.abortController=u;const x=h;this._textureRequests.set(p,h);h.textureAsync=w.then(async n=>{n=this._createTexture(c,n,l);x.texture=n;x.abortController=null;await n.load(this._stage.renderView.renderingContext);this._stage.add(n);return{uid:p,texture:n,release:()=>this._release(p)}},n=>{x.abortController=
null;throw n;})}h.referenceCount++;try{return await b.whenOrAbort(h.textureAsync,e)}catch(u){throw this._release(p),u;}}_createTexture(c,l,e){const p={width:l.width,height:l.height,wrap:{s:m.TextureWrapMode.CLAMP_TO_EDGE,t:m.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(g.isSVG(c)){if(e||0===l.width&&0===l.height)c=l.width?l.height/l.width:1,e=e||64,1<c?(l.width=Math.round(e/c),l.height=e):(l.width=e,l.height=Math.round(e*c));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&
(p.preMultiplyAlpha=!1)}return new k.Texture(l,p)}}a.StreamTextureCollection=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),function(a,b,g,d,k,m,
f,c,l){a.TextureCollection=class extends g{constructor(p,h){super({});this._stage=p;this._textureRequests=new Map;this._frameTask=h?.registerTask(l.TaskPriority.TEXTURE_UNLOAD)??l.ImmediateTask}normalizeCtorArgs(){return{}}destroy(){super.destroy();this._frameTask?.remove();this._textureRequests?.forEach(p=>this._releaseTextureRequest(p));this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(p,h){const u=this.makeUid(p);p=this._textureRequests.get(u);p||(p=new e,p.texture=
h(),this._stage&&(p.texture.load(this._stage.renderView.renderingContext),this._stage.add(p.texture)),this._textureRequests.set(u,p));p.referenceCount++;return{uid:u,texture:p.texture,release:()=>this._release(u)}}_release(p){const h=this._textureRequests.get(p);h?(1>h.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+p),h.referenceCount--,1>h.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(p))):console.warn(`TextureCollection: texture doesn't exist: '${p}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(p){if(this._textureRequests){var h=
this._textureRequests.get(p);!h||0<h.referenceCount||(h.texture?.unload(),this._releaseTextureRequest(h),this._textureRequests.delete(p))}}_releaseTextureRequest(p){p.texture?this._stage?.remove(p.texture):p.abortController&&(p.abortController.abort(),p.abortController=null)}makeUid(p,h=null){return null!=h?`${p}.${h}px`:p}};b.__decorate([d.property()],a.TextureCollection.prototype,"_frameTask",void 0);b.__decorate([d.property()],a.TextureCollection.prototype,"updating",null);a.TextureCollection=
b.__decorate([c.subclass("esri.views.3d.support.TextureCollection")],a.TextureCollection);class e{constructor(){this.referenceCount=0}}a.TextureRequest=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F){a.PointsOfInterest=class extends g{constructor(K){super(K);this._handles=new d;this._tmpRay=u.create();this._centerRayDirty=!0;this._surfaceAltitudeAtCenter=0;this._surfaceAltitudeAtCenterDirty=!0;this._contentAltitudeAtCenter=0;this._contentAltitudeAtCenterDirty=!0;this._propertiesPool=new n.PropertiesPool({renderPointOfView:G},this);this.renderPointOfView=h.create();this._pois=[];this._debugCenters=new Map}initialize(){const {state:K,
basemapTerrain:L,renderCoordsHelper:J,map:M}=this.view;this._surfaceIntersector=C.newIntersector(K.viewingMode);this._surfaceIntersector.options.backfacesTerrain=K.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=E.StoreResults.MIN;this._contentIntersector=C.newIntersector(K.viewingMode);var T=()=>this._estimateSurfaceAltitudeAtCenter();const Q=this.view.resourceController.scheduler,O=this.view.basemapTerrain?.elevationQueryCache,U={state:K,
scheduler:Q,surface:L,renderCoordsHelper:J};this._set("centerOnSurfaceInfrequent",new v.CenterOnSurface({...U,task:F.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:T}));this._set("centerOnSurfaceFrequent",new v.CenterOnSurface({...U,task:F.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:T}));this._set("centerOnContent",new v.CenterOnSurface({...U,task:F.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));
this._set("cameraOnSurface",new t.CameraOnSurface({...U,cache:O,task:F.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:M}));this._set("surfaceGeometryUpdates",new D.SurfaceGeometryUpdates({...U,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new r.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:J}));this._set("surfaceOrigin",new z.StableSurfaceCenter({cache:O,view:this.view}));
this._set("focus",new y.Focus({state:K,scheduler:Q,surface:L,renderCoordsHelper:J,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(Z,P)=>this._estimateSurfaceIntersectionAtRenderPoint(Z,this.view.state.contentCamera,P)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);T=this.view.graphics;this._debugCenters.set(this.centerOnContent,new x.PointGraphics(T,"red","CenterOnContent"));
this._debugCenters.set(this.centerOnSurfaceFrequent,new x.PointGraphics(T,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new x.PointGraphics(T,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new x.PointGraphics(T,"blue","CameraOnSurface"));this._debugCenters.set(this.focus,new x.PointGraphics(T,"green","Focus"));this._handles.add([k.watch(()=>K.contentCamera,Z=>this._cameraChanged(Z),k.sync),k.watch(()=>L.extent,()=>this._updateCenterPointsOfInterest()),
k.when(()=>!L.updating,()=>this._updateCenterPointsOfInterest(),k.sync),k.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),k.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),k.when(()=>w.debugFlags.SHOW_POI,Z=>this._setDebug(Z),k.initial)]);this._cameraChanged(this.view.state.contentCamera);for(const Z of this._pois)Z.runTask()}destroy(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();
for(const K of this._pois)K.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(K=>K.updating))}get _centerRay(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=
!1;const K=this._centerRay;if(null==K)return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(K,this._contentIntersector,I,B)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(I):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=
!1;const K=this._centerRay;if(null==K)return this._surfaceAltitudeAtCenter;const L=K.origin,J=p.add(I,K.origin,K.direction);this._surfaceIntersector.resetWithRay(K,this.view.state.contentCamera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,L,J);this._surfaceIntersector.results.min.getIntersectionPoint(I)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(I));return this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(K,L,J){K=q.fromRenderAtEye(L,
K,H);if(null==K)return null;const M=K.origin,T=p.add(I,K.origin,K.direction);this._surfaceIntersector.resetWithRay(K,L);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,M,T);return this._surfaceIntersector.results.min.getIntersectionPoint(J)?J:null}_cameraChanged(K){this._updateCenterPointsOfInterest();K=K.eye;p.exactEquals(this.renderPointOfView,K)||this._set("renderPointOfView",p.copy(this._propertiesPool.get("renderPointOfView"),K))}_updateCenterPointsOfInterest(){this._contentAltitudeAtCenterDirty=
this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const K of this._pois)K.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()}_setDebug(K){if(K)for(const L of this._pois)this._handles.add(k.watch(()=>L.renderLocation,J=>this._debugCenters.get(L)?.show(J,L.renderCoordsHelper.spatialReference),k.initial),"debug");else this._debugCenters.forEach(L=>L.hide()),this._handles.remove("debug")}get test(){return{update:()=>
{this.surfaceGeometryUpdates.runTask();for(const K of this._pois)K.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnContent",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,
"cameraOnSurface",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceOrigin",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",
void 0);b.__decorate([m.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);b.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=b.__decorate([e.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const G=Array,I=h.create(),H=u.create(),B={exclude:new Set([A.terrainId])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/Collection ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer ../../../geometry/Point".split(" "),
function(a,b,g,d,k,m,f,c,l){class e{constructor(p,h,u=""){this.graphics=p;this._symbol=new m({symbolLayers:new k([new f({material:{color:h},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new c({text:u,halo:{color:"white",size:1/.75},material:{color:h},size:12})])})}show(p,h){null!=h&&(this.hide(),p=new l({x:p[0],y:p[1],z:p[2],spatialReference:h}),this._graphic=new g({geometry:p,symbol:this._symbol}),this.graphics.add(this._graphic))}hide(){null!=this._graphic&&(this.graphics.remove(this._graphic),
this._graphic=null)}}a.PointGraphics=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){const v=Array;a.CameraOnSurface=class extends q.PointOfInterest{constructor(y){super(y);this._dirty=!1;this._propertiesPool=new n.PropertiesPool({location:u,renderLocation:v},this);this._estimatedSurfaceAltitude=0;this._pendingElevationQueryController=null;this.renderLocation=h.create();this._tmpPoint=new u}initialize(){this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this));this.runTask();if(this.map){const y=()=>this._setDirty();
this.addHandles(k.on(()=>this.map?.ground?.layers,"change",y,{onListenerAdd:y,onListenerRemove:y}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest();this._propertiesPool=g.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const y=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,y,this.state.spatialReference);return y}get scale(){const y=this._camera,z=p.distance(y.eye,this.renderLocation);
return x.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:y}},z,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty();this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const y=this._pendingElevationQueryController;y&&(this._pendingElevationQueryController=null,y.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&
this._dirty}runTask(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(!this.map?.ground)return this._updateSurfaceAltitude(0),t.Task.YIELD;var y=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,y);y=1E5<(this._tmpPoint.z??0)&&this.renderCoordsHelper.viewingMode===w.ViewingMode.Global&&(y.isWGS84||y.isWebMercator);let z=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:z.signal,cache:this.cache,
minDemResolution:y?1E6:0}).then(D=>this._updateSurfaceAltitude(D.geometry.z??0)).catch(D=>{d.isAbortError(D)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===z&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));z=null});this._pendingElevationQueryController=z;return t.Task.YIELD}_updateSurfaceAltitude(y){this._estimatedSurfaceAltitude!==y&&(this._estimatedSurfaceAltitude=y,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(r,
this._estimatedSurfaceAltitude,this._camera.eye);p.exactEquals(this._get("renderLocation"),r)||(this._set("renderLocation",p.copy(this._propertiesPool.get("renderLocation"),r)),this.notifyChange("renderLocation"))}};b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);b.__decorate([m.property({readOnly:!0})],
a.CameraOnSurface.prototype,"location",null);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);b.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);b.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);b.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=b.__decorate([e.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const r=
h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,g,d,k,m,f,c){a.PointOfInterest=class extends g{constructor(l){super(l)}};
b.__decorate([d.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);b.__decorate([d.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);b.__decorate([d.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=b.__decorate([c.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/Point ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){const r=Array;a.CenterOnSurface=class extends t.PointOfInterest{constructor(C){super(C);this._propertiesPool=new q.PropertiesPool({location:u,renderLocation:r},this);this.distance=this._latestSurfaceAltitude=this._currentSurfaceAltitude=0;this.renderLocation=p.create();this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()}destroy(){this._frameWorker=d.removeMaybe(this._frameWorker);this._propertiesPool=
d.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const C=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C,this.state.spatialReference);return C}updateRenderLocation(){this.updating=!0;this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();
this.updating=!1;return v.Task.YIELD}_updateRenderLocation(){const C=y;let E=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,C);var A=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!E&&A&&(E=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,C))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);A=z;E&&this._latestSurfaceAltitudeChangesDistanceSignificantly(C,A)&&(e.copy(C,A),this._currentSurfaceAltitude=this._latestSurfaceAltitude);E?this.distance=
e.distance(this._camera.eye,C):(e.scale(C,this._camera.viewForward,this._get("distance")),e.add(C,C,this._camera.eye));e.exactEquals(this._get("renderLocation"),C)||this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),C))}_calculateSurfaceIntersection(C,E){var A=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(A.ray,C,E))return!1;if(this.state.isGlobal){const F=h.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;C=F+C;const G=e.squaredLength(A.eye),
I=G<C*C,H=e.distance(A.eye,E);I&&H>F/4&&(e.scale(E,A.viewForward,C-Math.sqrt(G)),e.add(E,E,A.eye))}else A=this.surface?.ready?this.surface.extent:null,null!=A&&w.projectBoundingRect(A,this.surface?.spatialReference,D,this.renderCoordsHelper.spatialReference)&&(E[0]=g.clamp(E[0],D[0],D[2]),E[1]=g.clamp(E[1],D[1],D[3]));return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(C,E){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==C)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,
E)){if(n.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)return!0;const A=this._camera.eye;C=e.distance(A,C);E=e.distance(A,E);if(.05<Math.abs(E-C)/C)return!0}return!1}};b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"scheduler",void 0);b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);b.__decorate([k.property()],a.CenterOnSurface.prototype,"distance",void 0);b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",
void 0);b.__decorate([k.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);b.__decorate([k.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);b.__decorate([k.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=b.__decorate([l.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const y=p.create(),z=p.create(),D=x.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports",
"../../../../core/Evented","../../../../core/Handles","../../../../core/maybe"],function(a,b,g,d){class k{constructor(f){this._handles=new g;this.events=new b;this._contentLayerViews=f.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",c=>this._layerViewsChanged(c)));this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=d.destroyMaybe(this._handles);this._contentLayerViews.destroy()}_layerViewsChanged(f){f.added.forEach(c=>
{"esri.views.3d.layers.SceneLayerView3D"===c.declaredClass&&this._handles.add(c.on("visible-geometry-changed",()=>this._contentChanged()),c.uid)});f.removed.forEach(c=>this._handles.remove(c.uid))}_contentChanged(){this.events.emit("request-update",m)}}const m={};a.ContentGeometryUpdates=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){const r=Array;a.Focus=class extends q.PointOfInterest{constructor(C){super(C);this._propertiesPool=new n.PropertiesPool({location:w,renderLocation:r},this);this._dirty=!0;this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([k.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),k.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);this.scheduler&&this.addHandles(this.scheduler.registerTask(v.TaskPriority.POINT_OF_INTEREST_FREQUENT,
this))}destroy(){this._propertiesPool=d.destroyMaybe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const C=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C,this.state.spatialReference);return C}get running(){return this._dirty}runTask(){var C=this._get("renderLocation");const E=this.centerOnSurface.renderLocation;var A=this.renderCoordsHelper,F=this.state.contentCamera;this._dirty=!1;A.worldUpAtPosition(E,
y);A=Math.max(0,(Math.acos(h.dot(y,F.viewForward))-.5*Math.PI)*(F.aboveGround?1:-1));if(Number.isNaN(A))return C&&h.equals(C,E)||(C=this._propertiesPool.get("renderLocation"),h.copy(C,E),this._set("renderLocation",C)),v.Task.YIELD;A=1-g.clamp(A/(.5*Math.PI),0,1);A*=A*A;this._calculateScreenHorizontalEdgeOnSurface(D);F=this._propertiesPool.get("renderLocation");h.lerp(F,E,D,A);C&&h.equals(C,F)||this._set("renderLocation",F);return v.Task.YIELD}_calculateScreenHorizontalEdgeOnSurface(C){const E=this.state.contentCamera;
var A=E.getRenderCenter(m.createRenderScreenPointArray3());A[1]=E.aboveGround?E.padding[t.PaddingSide.BOTTOM]:E.fullHeight-E.padding[t.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(A,C))return C;const F=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return E.unprojectFromRenderScreen(A,z)&&(h.subtract(z,z,E.eye),A=h.normalize(z,z),this.renderCoordsHelper.intersectInfiniteManifold(x.wrap(E.eye,A),F,C))?C:this.renderCoordsHelper.setAltitude(C,F,E.eye)}updateRenderLocation(){this._dirty=
!0}};b.__decorate([f.property()],a.Focus.prototype,"_dirty",void 0);b.__decorate([f.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);b.__decorate([f.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);b.__decorate([f.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);b.__decorate([f.property({readOnly:!0})],a.Focus.prototype,"updating",null);b.__decorate([f.property({readOnly:!0})],a.Focus.prototype,"location",
null);b.__decorate([f.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=b.__decorate([p.subclass("esri.views.3d.support.pointsOfInterest.Focus")],a.Focus);const y=u.create(),z=u.create(),D=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){a.StableSurfaceCenter=class extends g{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const w=p.create();this.view.renderCoordsHelper.toRenderCoords(this.location,w);return w}constructor(w){super(w);this._updateController=this.location=null}initialize(){this.view.state.isLocal&&(this.addHandles([k.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],
()=>this._update()),k.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)this._set("location",null);else{var w=u.center(this.surfaceView.extent);w=new h({x:w[0],y:w[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=
new AbortController,this.surface.queryElevation(w,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(x=>{this._updateController=null;this._set("location",x.geometry)}).catch(x=>{d.isAbortError(x)||x&&"elevation-query:invalid-layer"===x.name||console.error("StableSurfaceCenter failed to update: ",x)})):this._set("location",w)}}};b.__decorate([m.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);b.__decorate([m.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,
"cache",void 0);b.__decorate([m.property()],a.StableSurfaceCenter.prototype,"surface",null);b.__decorate([m.property()],a.StableSurfaceCenter.prototype,"surfaceView",null);b.__decorate([m.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);b.__decorate([m.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=b.__decorate([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){a.SurfaceGeometryUpdates=class extends g{constructor(q){super(q);this._tileGeometryUpdateExtent=p.empty();this._tileGeometryUpdateSpatialReference=null;this.events=new d;this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",q=>this._tileGeometryChanged(q)),this.scheduler.registerTask(h.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){if(!this.updating)return h.Task.YIELD;this._tileGeometryUpdateSpatialReference&&
this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",u);p.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return h.Task.YIELD}_tileGeometryChanged(q){this._tileGeometryUpdateSpatialReference=q.spatialReference;p.expand(this._tileGeometryUpdateExtent,q.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)}_furthestCenterOnSurface(){let q=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const v=
this.centerOnSurfaces[t];v.distance>q.distance&&(q=v)}return q}_centerIntersectsExtent(q,t){const v=this.state.contentCamera.eye,r=n,y=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(v,w,t);this.renderCoordsHelper.fromRenderCoords(y.renderLocation,x,t);w[0]<x[0]?(r[0]=w[0],r[2]=x[0]):(r[0]=x[0],r[2]=w[0]);w[1]<x[1]?(r[1]=w[1],r[3]=x[1]):(r[1]=x[1],r[3]=w[1]);return p.intersects(r,q)}};b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",
void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);b.__decorate([k.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,
"updating",void 0);a.SurfaceGeometryUpdates=b.__decorate([l.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const u={},w=e.create(),x=e.create(),n=p.empty();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ../../../geometry/SpatialReference ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/ElevationTileData ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./ScaleRangeQueries ./SphericalPatch ./SplitLimits ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba,ia,ka,na,Y,ea,fa,aa,da,ma,ua,sa,ra,Aa,qa,la,ja,oa,za,ta,Ca){function Ga(xa,Da){return xa[0]===Da[0]&&xa[1]===Da[1]&&xa[2]===Da[2]}function La(xa){xa=xa.children;if(!xa[0])return!1;for(const Da of xa)if(Da.shouldLoad)return!0;for(const Da of xa)if(La(Da))return!0;return!1}function Ma(xa,Da,Ka){for(const ha of xa)if(ha.containsPointXY(Da,Ka)){for(xa=ha;xa&&!xa.renderData;)xa=xa.children[(Da>
xa.extentMidX?1:0)+(Ka<xa.extentMidY?2:0)];return V.sampleElevation(Da,Ka,xa?.renderData?.geometryState.samplerData??null)}return null}var Ra;d=Ra=class extends f.EventedMixin(d){constructor(xa){super(xa);this._scaleRangeQueries=new na.ScaleRangeQueries;this._iteratorPool=new h(Aa.IteratorPreorder,Da=>Da.remove=()=>this._iteratorPool.release(Da));this._postorderIterator=new Aa.IteratorPostorder;this._hasPendingUpdates=!1;this._asyncWorkItems=this._pendingUpdates=0;this._allTilesSorted=this._allTilesDirty=
!0;this._usedMemory=null;this._performanceInfo=new da;this._viewChangeUpdateDirty=this._inFrameTask=this._viewChanged=!1;this._eyePosRenderSR=D.create();this._eyePosSurfaceSR=D.create();this._splitLimits=new ea.SplitLimits;this._frustum=B.create();this._viewProjectionMatrix=y.create();this._layerViews=[[],[]];this._layerIndexByUid=[new Map,new Map];this._basemapLayerViewHandles=new Map;this._watchUpdatingTracking=new E.UpdatingHandles;this._frameTask=Ca.ImmediateTask;this._allTiles=new u;this._upsampleInfoPool=
new h(la.UpsampleInfo);this._shouldEmitChangeEvent=!1;this._rootTilesExtent=H.create();this.updatingProgress=.5;this._maxNumUpdating=1;this.maxTextureScale=1.2;this._spatialReference=F.WebMercator;this.visibleElevationBounds=new N.ElevationBounds(Infinity,-Infinity);this.rootTileElevationBounds=new N.ElevationBounds(Infinity,-Infinity);this._updatingRootTiles=!1;this._pendingTilesForElevationUpdateEvent=new Set;this._pendingTilesToUpdate=new Set;this.totalTileUpdates=this.totalGeometryUpdates=0;this._oneBatchPerFrameTask=
!0;this._layerViewsDirty=!1;this.unloadedMemory=0;this._isWebMercatorOnPlateeCarree=this._isWebMercator=this.ignoresMemoryFactor=!1;this.overlayManager=new ba.OverlayManager({...xa,surface:this});this._tileConstructor=(this._isGlobal=!xa.view?.state?.isLocal)?Y.SphericalPatch:ia.PlanarPatch}initialize(){const xa=this.view,Da=xa.resourceController;this._lercDecoder=Q.acquireDecoder(Da);const Ka=Da.memoryController;this._tileCache=new p.MemCachePool((wa,Ba)=>Ka.newCache(wa,Ba),"terrain-tile");this._upsampleMapCache=
Ka.newCache("terrain-upsample",wa=>wa.unloadMapData());this._elevationQueryCache=new J.ElevationQueryTileCache(Ka.newCache("elevation-query"));const ha=this.overlayManager;this._renderer=new aa.TerrainRenderer(ha.renderer,xa._stage,this._allTiles,A.getReferenceEllipsoid(xa.spatialReference).radius,Ka);this.addHandles([x.watch(()=>ha.rendersOccluded,wa=>this._renderer.setRenderOccludedOverlay(wa)),x.watch(()=>ha.renderer.isEmpty,()=>this._evaluateTransparency()),x.watch(()=>this.renderer.visible,wa=>
this.suspended=!wa)],"overlayManager");this.addHandles([x.watch(()=>this.baseOpacity,()=>{this._handleLayerViewChanges();this._updateTileTextures(this._evaluateTransparency()?X.TextureUpdate.UNFADED:X.TextureUpdate.IMMEDIATE)},x.syncAndInitial),x.watch(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?X.TextureUpdate.UNFADED:X.TextureUpdate.IMMEDIATE),x.syncAndInitial),x.watch(()=>this.backgroundColor,(wa,Ba)=>{wa?.equals(Ba)||(this._handleLayerViewChanges(),
this._renderer.updateTileBackground(wa))},x.sync),x.watch(()=>this.snapLevel,()=>this._viewChanged=!0,x.sync),x.watch(()=>this.view.pointsOfInterest,wa=>{this._renderer.pointsOfInterest=wa;this._watchUpdatingTracking.removeAll();wa&&this._watchUpdatingTracking.add(()=>wa.focus.renderLocation,()=>this._allTilesSorted=!1)}),x.watch(()=>Z.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES,wa=>{wa&&!this._treeDebugger?(new Promise((Ba,Ja)=>a(["../layers/support/TerrainTileTree3DDebugger"],Ba,Ja))).then(({TerrainTileTree3DDebugger:Ba})=>
{!this._treeDebugger&&Z.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Ba({view:xa}))}):wa||(this._treeDebugger=e.destroyMaybe(this._treeDebugger))},x.initial)]);var {spatialReference:Sa}=xa;this._extentHelper=S.create(this.viewingMode,{layers:xa.map.allLayers,layerViews:xa.allLayerViews,viewSpatialReference:Sa});const Va=new m({getCollections:()=>xa.defaultsFromMap?.mapCollections?.map(({layers:wa})=>wa),getChildrenFunction:wa=>wa&&"layers"in wa?wa.layers:null});Sa=new qa.TilingSchemeLogic({layers:Va,
extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:Sa});this._set("tilingSchemeLogic",Sa);this._updateTilingScheme();this._elevationDataRequester=Da.createStreamDataRequester(R.ClientType.ELEVATION);this._mapDataRequester=Da.createStreamDataRequester(R.ClientType.BASEMAP);this._frameTask=Da.scheduler.registerTask(Ca.TaskPriority.TERRAIN_SURFACE,this);this.addHandles([x.watch(()=>this._extentHelper.stencilEnabledExtents,wa=>this._renderer.setStencilEnabledLayerExtents(wa),
x.initial),x.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),x.sync),x.watch(()=>this.extent,()=>this._updateRootTiles(),x.initial),xa.on("resize",()=>this._viewChangeUpdate()),x.watch(()=>{const wa=xa.state;return[this._lodBias,this.lodSnapping,xa.quality,wa.camera,wa.contentCamera,wa.fixedContentCamera]},()=>this._viewChangeUpdate(),x.syncAndInitial),x.watch(()=>xa.qualitySettings?.tiledSurface?.textureFadeDuration,wa=>this._renderer.textureFadingEnabled=0<wa,x.initial),
x.watch(()=>xa.qualitySettings?.physicallyBasedRenderingEnabled,wa=>this._renderer.pbrMode=wa?oa.PBRMode.Terrain:oa.PBRMode.Disabled,x.initial),x.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),x.sync)]);this.addHandles(xa.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove();this._watchUpdatingTracking.destroy();this._lercDecoder=
e.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._set("tilingSchemeLogic",e.destroyMaybe(this.tilingSchemeLogic));this._basemapLayerViewHandles.forEach((xa,Da)=>this._unregisterTiledLayerView(Da));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",e.destroyMaybe(this.overlayManager));this._tileCache=e.destroyMaybe(this._tileCache);ua.Tile.prune();this._treeDebugger=e.destroyMaybe(this._treeDebugger);this._renderer=e.destroyMaybe(this._renderer);this._iteratorPool=
e.destroyMaybe(this._iteratorPool);this._upsampleMapCache=e.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=e.destroyMaybe(this._elevationQueryCache);this._set("view",null);this._extentHelper=e.destroyMaybe(this._extentHelper);this._upsampleInfoPool=e.destroyMaybe(this._upsampleInfoPool);O.printAllocations();sa.printAllocations()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===X.LODSnapping.ON){var xa=this.view,Da=this.tilingScheme;
const ha=xa.pointsOfInterest?.cameraOnSurface?.scale;if(Da&&ha){var Ka=xa.state.contentCamera;Ka=U.directionToHeadingTilt(xa,Ka.eye,Ka.viewForward,Ka.up).tilt;90<Ka&&(Ka=180-Ka);Ka=2*(Ka/90)**2;Da=Da.levelAtScale(ha);xa=Math.min(Da-Ka+xa.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||Infinity);return 0>=xa?null:xa}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?X.LODSnapping.ON:X.LODSnapping.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){var {spatialReference:xa}=
this,{clippingArea:Da}=this.view;if(null==Da||null==xa)return null;const Ka=H.create();xa=P.toBoundingRect(Da,Ka,xa)?Ka:null;Da=this._get("extent");return H.equals(xa,Da)?Da:xa}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const xa=H.intersection(this.groundExtent,this._userClippingExtent,H.create()),Da=this._get("extent");return H.equals(xa,Da)?Da:xa}get groundExtent(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking?.updating||0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-
this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(xa){this.view.map.ground.opacity=xa}get viewingMode(){return this.view.state.viewingMode}get ready(){return null!=this._rootTiles}set renderOrder(xa){this._renderer.renderOrder=xa;this._set("renderOrder",xa)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(xa){this.view.map.ground.surfaceColor=
xa}set slicePlaneEnabled(xa){this._renderer.slicePlaneEnabled=xa;this._set("slicePlaneEnabled",xa);this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(xa){xa!==this._renderer.wireframe&&(this._renderer.wireframe=xa,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===aa.TransparencyMode.Opaque}set suspended(xa){this._set("suspended",xa);this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??
0}intersect(xa,Da,Ka,ha){this._renderer.intersect(xa,Da,Ka,ha)}getElevation(xa,Da,Ka,ha){const Sa=this._rootTiles;if(!Sa?.length||0===Sa[0].layerInfo[ca.LayerClass.ELEVATION].length)return null;const Va=Ya;Va[0]=xa;Va[1]=Da;Va[2]=Ka;return I.projectVectorToVector(Va,ha,Va,this._spatialReference)?Ma(Sa,Va[0],Va[1]):(c.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(xa,Da,Ka){const ha=this._rootTiles;var Sa=
ha?ha[0].layerInfo[ca.LayerClass.ELEVATION].length:0;if(ha?.length&&0!==Sa)for(Sa=0;Sa<Da;++Sa){var Va=3*Sa;Va=Ma(ha,xa[Va],xa[Va+1]);Ka(Sa,Va)}else for(xa=0;xa<Da;++xa)Ka(xa,null)}getScale(xa){if(!this.tilingScheme)return null;if(!G.projectPointToVector(xa,Ya,this.spatialReference))return c.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;xa=this._rootTiles;if(null!=xa)for(var Da of xa)if(Da?.containsPoint(Ya)){for(;Da.children[0]&&
!Da.rendered;){xa=Da.children[0].extent;let Ka=0;Ya[0]>xa[2]&&(Ka+=1);Ya[1]<xa[1]&&(Ka+=2);Da=Da.children[Ka]}return this._getLodBiasCorrectedScale(Da.level)}return Infinity}getSphereElevationBounds(xa,Da){Ya[0]=xa[0];Ya[1]=xa[1];Ya[2]=xa[2];Ya[3]=xa[3];if(!I.projectVectorToVector(Ya,Da,Ya,this.tilingScheme?.spatialReference))return c.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let Ka=Infinity,ha=-Infinity;
const Sa=Va=>{if(Va&&H.intersectsSphere(Va.extent,Ya))if(Va.isLeaf||Va.rendered)Ka=Math.min(Ka,Va.elevationBounds[0]),ha=Math.max(ha,Va.elevationBounds[1]);else for(const wa of Va.children)Sa(wa)};xa=this._rootTiles;if(null!=xa)for(const Va of xa)Sa(Va);return{min:Ka,max:ha}}getRootElevationBounds(){return{min:this.rootTileElevationBounds.min,max:this.rootTileElevationBounds.max}}getSphereScale(xa,Da){if(!this.tilingScheme)return null;if(!G.projectPointToVector(xa,Ya,this.spatialReference))return c.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),
null;Ya[3]=Da;let Ka=null;const ha=Sa=>{if(Sa&&H.intersectsSphere(Sa.extent,Ya)){const Va=Sa.children;if(Va[0]&&!Sa.rendered)for(const wa of Va)ha(wa);else Sa=this._getLodBiasCorrectedScale(Sa.level),Ka=null==Ka?Sa:Math.min(Ka,Sa)}};xa=this._rootTiles;if(null!=xa)for(const Sa of xa)ha(Sa);return Ka}queryVisibleScaleRange(xa,Da,Ka,ha){Da=Da?this.tilingScheme.levelAtScale(Da):0;Ka=Ka?this.tilingScheme.levelAtScale(Ka):Infinity;const Sa=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(xa,
Da+Sa,Ka+Sa,ha)}_evaluateTransparency(){var xa=this.baseOpacity;const Da=this.overlayManager.renderer.isEmpty;var Ka=this._renderer.transparency;xa=this._allSurfaceLayersTransparent()?Da?aa.TransparencyMode.Empty:aa.TransparencyMode.TransparentWithDraped:1<=xa&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?aa.TransparencyMode.Opaque:aa.TransparencyMode.Semitransparent;if(Ka=Ka!==xa)this._renderer.transparency=xa,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency});
return Ka}_updateTilingScheme(){const xa=this.tilingSchemeLogic.tilingScheme;if(xa!==this.tilingScheme){ma.weakAssert(!!xa,"tiling scheme cannot be reset to undefined");this._isGlobal=!this.view?.state?.isLocal;this.tilingScheme&&this._removeAllTiles();var Da=xa?.spatialReference??F.WebMercator;this._spatialReference=Da;this._isWebMercatorOnPlateeCarree=(this._isWebMercator=!!Da?.isWebMercator)&&K.isPlateCarree(this.view?.renderSpatialReference);this._set("tilingScheme",xa);this._updateClippingExtent();
xa&&(this._updateTiledLayers(),this._renderer.setTileSize(xa.pixelSize),this.overlayManager.setSpatialReference(xa.spatialReference),this._updateRootTiles())}}_acquireTile(xa,Da,Ka,ha){const Sa=this._tileCache.pop(Ra._tileMemcacheKey);return Sa?(Sa.init(xa,Da,Ka,ha,this),Sa):new this._tileConstructor(xa,Da,Ka,ha,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const {extent:xa,tilingScheme:Da}=this;if(Da){var Ka=ab,ha=Da.rootTilesInExtent(xa,Ka,5*fa.maxRootTiles);if(null!=
this._rootTiles){if(ha.length>fa.maxRootTiles){c.getLogger(this).warn(fa.tooManyRootTilesAfterChangeError);return}const Sa=this._rootTiles.map(wa=>wa.lij),Va=k.difference(Sa,ha,Ga);this._updatingRootTiles=!0;if(0<Va.removed.length||0<Va.added.length){const wa=this._rootTiles.filter(Ba=>-1<Va.removed.findIndex(Ja=>Ga(Ja,Ba.lij))?(this._purgeTile(Ba),!1):!0);Va.added.forEach(Ba=>wa.push(this._newRootTile(Ba)));this._setRootTiles(wa)}}else this._updatingRootTiles=!0,ha.length>fa.maxRootTiles&&(c.getLogger(this).warn(fa.tooManyRootTilesForLayerError),
ha=Da.rootTilesInExtent(xa,Ka,fa.maxRootTiles)),this._setRootTiles(ha.map(Sa=>this._newRootTile(Sa)));H.equals(Ka,this._rootTilesExtent)||(this._rootTilesExtent=H.create(Ka));this.renderer.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}}_updateAllTileGeometries(){const xa=this._allTiles.filter(Da=>Da.isLoaded&&Da.intersectsClippingArea);xa.forEach(Da=>
this._renderer.updateTileGeometryState(Da));xa.forEach(Da=>Da.renderData.updateNeighborData());this._updateTilesGeometries(xa);this._pendingTilesToUpdate.clear()}_updateTilesGeometries(xa){if(0!==xa.length){xa.sort(Aa.compareTilesByLij);var Da=this.renderer;xa.forEach(Ka=>Da.updateGeometryIfNeeded(Ka));xa.forEach(Ka=>this._pendingTilesForElevationUpdateEvent.add(Ka))}}_shouldSplit(xa){return xa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ra.TileUpdate.SPLIT}_newRootTile(xa){xa=
this._acquireTile(0,xa[1],xa[2],null);this._shouldSplit(xa)&&xa.setPendingUpdate(ra.TileUpdate.SPLIT);this._loadTile(xa);this._markTileToUpdate(xa);this._updateRootTileElevationBounds();return xa}_setRootTiles(xa){this._rootTiles=xa;this._allTiles.clear();if(null!=xa){const Da=this._iteratorPool.acquire();for(Da.reset(xa);!Da.done;)this._allTiles.push(Da.next());Da.remove()}this._renderer.setRootTiles(this._rootTiles);this._updateTilesVisibility(xa)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&
(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(xa){xa.updateClippingStatus(this.extent)&&xa.resetPendingUpdate(ra.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(xa)}_updateTilesVisibility(xa){if(null!=xa){var Da=
Aa.hasLoadableSiblings(xa),Ka=this.visibleElevationBounds,ha=Da?Ka.min:Infinity;Da=Da?Ka.max:-Infinity;var Sa=this.extent,Va=this._viewProjectionMatrix;this.setTileTreeDirty();var wa=this._iteratorPool.acquire();for(wa.reset(xa);!wa.done;)xa=wa.next(),xa.updateClippingStatus(Sa)&&xa.resetPendingUpdate(ra.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(xa),xa.setPendingUpdate(ra.TileUpdate.RENDERDATA),xa.computeVisibility(),xa.updateScreenDepth(Va),xa.renderData&&(ha=Math.min(xa.elevationBounds[0],
ha),Da=Math.max(xa.elevationBounds[1],Da));wa.remove();this._allTilesDirty=this._viewChanged=!0;this._updatePendingTileGeometries();isFinite(ha)&&isFinite(Da)&&(Ka.min!==ha||Ka.max!==Da)&&(this.visibleElevationBounds=new N.ElevationBounds(ha,Da))}}_updateRootTileElevationBounds(){let xa=Infinity,Da=-Infinity;var Ka=this._rootTiles;null!=Ka&&Ka.forEach(({elevationBounds:ha})=>{xa=Math.min(xa,ha[0]);Da=Math.max(Da,ha[1])});Ka=this.rootTileElevationBounds;if(Ka.min!==xa||Ka.max!==Da)this.rootTileElevationBounds=
new N.ElevationBounds(xa,Da)}_updateViewDependentParameters(){const {camera:xa,contentCamera:Da}=this.view.state,Ka=Math.tan(.5*Da.fovX),ha=Math.tan(.5*Da.fovY),Sa=this.tilingScheme.pixelSize,Va=2**-this._lodBias*xa.pixelRatio;this._splitLimits.aboveGround=xa.aboveGround;this._splitLimits.fovX=Ka;this._splitLimits.fovY=ha;this._splitLimits.relativeWidthLimit=Sa/xa.width*this.maxTextureScale*Va;this._splitLimits.relativeHeightLimit=Sa/xa.height*this.maxTextureScale*Va;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();
this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this._splitLimits.frustum=this.view.state.fixedContentCamera?B.copy(this._splitLimits.frustum??B.create(),Da.frustum):null;B.copy(this._frustum,xa.frustum);r.multiply(this._viewProjectionMatrix,Da.projectionMatrix,Da.viewMatrix);z.copy(this._eyePosRenderSR,Da.eye);I.projectVectorToVector(xa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(xa){xa.rendered&&!xa.shouldLoad&&
(La(xa)?this._loadChildren(xa):xa.isLeaf&&(xa.parent?.shouldLoad??!1)&&this._loadParent(xa))}_updateTileGeometryState(xa){xa.updateVisibility();this._renderer.updateTileGeometryState(xa)&&this._markTileToUpdate(xa);this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(xa){xa.forEachLoadedNeighbor(Da=>this._pendingTilesToUpdate.add(Da))}_updateTileTexture(xa,Da){const Ka=xa.resetPendingUpdate(ra.TileUpdate.TEXTURE_FADING)?ra.TileUpdate.TEXTURE_FADING:xa.resetPendingUpdate(ra.TileUpdate.TEXTURE_NOFADING)?
ra.TileUpdate.TEXTURE_NOFADING:!1;Ka&&(this._renderer.updateTileTexture(xa,Ka),this._usedMemory=null,Da.madeProgress())}_emitElevationUpdateEventForTiles(){if(this._shouldEmitChangeEvent){var xa=cb.extent;H.empty(xa);this._pendingTilesForElevationUpdateEvent.forEach(Da=>H.expand(xa,Da.extent,xa));this._pendingTilesForElevationUpdateEvent.clear();cb.spatialReference=this.spatialReference;this.emit("elevation-change",cb);this._shouldEmitChangeEvent=!1}}runTask(xa){this._handleLayerViewChanges(xa);this._frameTask.processQueue(xa);
this.renderer.processScaleRangeQueries(this._scaleRangeQueries,xa);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(xa);this._sortTiles(xa);const Da=!this.view.state.fixedContentCamera;this._mergeAndSplit(xa,Da);this._updateElevation(xa);this._updateTextures(xa);Da||this._mergeAndSplit(xa,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();this._updatePendingTileGeometries();this._emitElevationUpdateEventForTiles();xa.done&&xa.hasProgressed&&
this.requestUpdate();this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(xa){if(this._viewChanged&&this._rootTiles&&!xa.done){this._viewChanged=!1;var Da=this._iteratorPool.acquire();Da.reset(this._rootTiles);for(var Ka=this.snapLevel,ha=this._splitLimits,Sa=this._eyePosRenderSR;!Da.done;){var Va=Da.next(),wa=Va.shouldSplit(ha,Sa,Ka);if(wa===ra.TileUpdate.SPLIT)Va.resetPendingUpdate(ra.TileUpdate.MERGE),Va.isLeaf&&(Va.setPendingUpdate(ra.TileUpdate.SPLIT),Da.skipSubtree()),Va.rendered&&
Va.setPendingUpdate(ra.TileUpdate.RENDERDATA);else if(Va.resetPendingUpdate(ra.TileUpdate.SPLIT)&&Va.updateAgentSuspension(),wa===ra.TileUpdate.ELEVATION&&Va.updateAgents(ca.LayerClass.ELEVATION),Da.skipSubtree(),!Va.isLeaf){Va.setPendingUpdate(ra.TileUpdate.MERGE);Va.resetPendingUpdate(ra.TileUpdate.SPLIT);wa=this._iteratorPool.acquire();wa.resetOne(Va);Va=this._viewProjectionMatrix;for(let Ba=wa.next();!wa.done;Ba=wa.next())this._updateClippingStatus(Ba),Ba.updateVisibility(),Ba.updateScreenDepth(Va);
wa.remove()}}Da.remove();this.requestUpdate();!this._shortBatches&&this._oneBatchPerFrameTask||this._updatePendingTileGeometries();xa.madeProgress()}}_sortTiles(xa){xa.done||this._allTilesSorted||(Aa.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),xa.madeProgress())}_markTileToUpdate(xa){ma.internalAssert(xa.isLoaded);xa.intersectsClippingArea&&(this._pendingTilesToUpdate.add(xa),this._markAllTileNeighborsForGeometryUpdate(xa))}_updatePendingTileGeometries(){const xa=
this._pendingTilesToUpdate,Da=Array.from(xa.keys()).filter(Sa=>Sa.isLoaded&&Sa.intersectsClippingArea);if(0===Da.length)xa.clear();else{var Ka=(Sa,Va)=>{!Va?.isLoaded||!Va.intersectsClippingArea||Va.level<Sa.level||xa.has(Va)||(xa.add(Va),Da.push(Va),Va.renderData.updateNeighborData())};Da.sort(Aa.compareTilesByLij);var ha=Da.length;for(let Sa=0;Sa<ha;++Sa){const Va=Da[Sa];ma.internalAssert(Va.isLoaded);ma.internalAssert(Va.intersectsClippingArea);const wa=Va.renderData;wa.updateNeighborData();const Ba=
wa._dirtyEdgeResolutions,Ja=wa.geometryState.neighborData.cornerPeerNeighbors,Ta=db=>{const lb=ma.neighborCornerIndices[db];Ka(Va,Ja[db]?.findCorner(ma.oppositeCorner(lb),mb=>mb.isLoaded))};for(let db=0;4>db;++db)if(Ba&1<<db){const lb=wa.geometryState.neighborData.edgePeerNeighbors[db];lb&&lb?.level>=Va.level&&lb.forAllSubtreeOnSide(ma.oppositeEdge(ma.neighborEdgeIndices[db]),mb=>mb.isLoaded&&mb.intersectsClippingArea?(ma.internalAssert(xa.has(mb)||0>Aa.compareTilesByLij(Va,mb)),Ka(Va,mb),!0):!1);
Ta((db+1)%4);Ta(db)}}xa.clear();this._updateTilesGeometries(Da);this._shouldEmitChangeEvent=!0;ma.enableTerrainInternalChecks&&ma.enableWaterproofnessTests&&this.checkAllTilesWaterproofness()}}_mergeAndSplit(xa,Da){if(!this.suspended&&!xa.done&&this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var Ka=!1,ha=this.view.state.fixedContentCamera,Sa=!1;!xa.done;){Sa=!0;let Va=!1;const wa=!this._allTiles.some(Ba=>{if(!Ka&&!ha&&!Ba.visible)return xa.done;let Ja=Ba;if(Ba.resetPendingUpdate(ra.TileUpdate.MERGE)){if(!Da)return Ba.setPendingUpdate(ra.TileUpdate.MERGE),
xa.done;for(;Ja.parent?.resetPendingUpdate(ra.TileUpdate.MERGE);)Ja=Ja.parent;this._mergeTile(Ja);Va=!0;xa.madeProgress()}else Ba.resetPendingUpdate(ra.TileUpdate.SPLIT)&&(this._splitTile(Ba),Va=!0,xa.madeProgress());!xa.done&&Ja===Ba&&Ba.resetPendingUpdate(ra.TileUpdate.RENDERDATA)&&(this._updateRenderData(Ba),xa.madeProgress());return xa.done});Va&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(wa)if(!Ka)Ka=!0;else{if(!Va)break}else this._allTilesDirty=!0}Sa?xa.madeProgress():this._allTilesDirty=
!0;!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries();this._sortTiles(xa)}}_updateElevation(xa){xa.done||(this._allTiles.some(Da=>{Da.resetPendingUpdate(ra.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(Da),this._updateTileTexture(Da,xa),this._shortBatches&&this._updatePendingTileGeometries(),xa.madeProgress());return xa.done}),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(xa){xa.done||this._allTiles.some(Da=>{this._updateTileTexture(Da,xa);
return xa.done})}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(za.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.quality)*fa.maxMemoryLodBias}_getLodBiasCorrectedScale(xa){const Da=this.tilingScheme.levels;xa=l.clamp(xa-this._lodBias,0,Da.length-1);const Ka=xa-Math.floor(xa);return Da[Math.floor(xa)].scale*(1-Ka)+Da[Math.ceil(xa)].scale*Ka}_removeAllTiles(){null!=
this._rootTiles&&(this._rootTiles.forEach(xa=>this._purgeTile(xa)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.renderer.visible=!1}_purgeDescendantTiles(xa){if(!xa.children[0])return!1;let Da=!1;for(let Ka=0;4>Ka;++Ka)Da=this._purgeTile(xa.children[Ka])||Da;xa.unsetChildren();return Da}_purgeTile(xa){const Da=this._purgeDescendantTiles(xa)||xa.rendered;this._allTiles.removeUnordered(xa);this._unloadTile(xa);this._tileCache.put(Ra._tileMemcacheKey,xa);return Da}_unloadTile(xa){this._pendingTilesToUpdate.delete(xa);
this._pendingTilesForElevationUpdateEvent.delete(xa);xa.unload(this._renderer)}_splitTile(xa){ma.weakAssert(xa.isLeaf,"tile that is already split should not be split again!");const Da=xa.level+1,Ka=2*xa.lij[1],ha=2*xa.lij[2];xa.setChildren(this._createTile(Da,Ka,ha,xa),this._createTile(Da,Ka,ha+1,xa),this._createTile(Da,Ka+1,ha,xa),this._createTile(Da,Ka+1,ha+1,xa));xa.setPendingUpdate(ra.TileUpdate.RENDERDATA);xa.updateAgentSuspension();this._allTiles.pushArray(xa.children);this._allTilesDirty=!0;
++this._performanceInfo.numSplit}_emitTileScaleChange(xa,Da=xa.level){Na.spatialReference=this.spatialReference;Na.extent=xa.extent;Na.scale=this._getLodBiasCorrectedScale(Da);this.emit("scale-change",Na)}_createTile(xa,Da,Ka,ha){ma.weakAssert(!!ha,"_createTile sanity check");xa=this._acquireTile(xa,Da,Ka,ha);xa.updateClippingStatus(this.extent);xa.updateScreenDepth(this._viewProjectionMatrix);this._shouldSplit(xa)&&xa.setPendingUpdate(ra.TileUpdate.SPLIT);return xa}get _shortBatches(){return this.view.state.mode!==
ta.RenderState.IDLE}_mergeTile(xa){ma.weakAssert(!xa.hasPendingUpdate(ra.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeDescendantTiles(xa)&&(ma.weakAssert(!xa.renderData,"_mergeTile sanity check"),this._loadTile(xa),this._markTileToUpdate(xa),this._emitTileScaleChange(xa),this._shortBatches&&this._updatePendingTileGeometries());this._allTilesDirty=!0;++this._performanceInfo.numMerged}_loadChildren(xa){ma.weakAssert(xa.rendered,"parent should be rendered");this._unloadTile(xa);const Da=xa.children;
Da.forEach(Ka=>this._loadTile(Ka));Da.forEach(Ka=>this._pendingTilesToUpdate.add(Ka));this._markAllTileNeighborsForGeometryUpdate(xa);this._emitTileScaleChange(xa,xa.level+1);this._shortBatches&&this._updatePendingTileGeometries()}_loadParent(xa){xa=xa.parent;this._unloadChildren(xa);this._loadTile(xa);this._markTileToUpdate(xa);this._emitTileScaleChange(xa,xa.level);this._shortBatches&&this._updatePendingTileGeometries()}_unloadChildren(xa){xa=xa.children;if(xa[0])for(let Da=0;4>Da;++Da){const Ka=
xa[Da];this._unloadChildren(Ka);this._unloadTile(Ka)}}_loadTile(xa){xa.load();xa.setPendingUpdate(ra.TileUpdate.RENDERDATA);this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(xa)}_elevationDataArrived(xa,Da,Ka){Ka=new V.ElevationData(xa.lij,xa.extent,Ka);xa.dataArrived(Da,ca.LayerClass.ELEVATION,Ka);Ka=[xa];xa=xa.level;const ha=this._iteratorPool.acquire();for(ha.reset(Ka);!ha.done;){const Sa=ha.next();Sa.findElevationBoundsForLayer(Da,
xa);Sa.computeElevationBounds()}0===xa&&this._updateRootTileElevationBounds();ha.remove();this._updateTilesVisibility(Ka)}_handleLayerViewChanges(xa=Ca.noBudget){if(this._layerViewsDirty){var Da=this._layerViewsDirty=!1,Ka=new Set,ha=-1;for(const Va of this.view.allLayerViews.items)if(Ka.add(Va.uid),ma.isSurfaceLayerView(Va)||ma.isGroupLayerView(Va))if(this._basemapLayerViewHandles.has(Va.uid)&&!ma.isGroupLayerView(Va)){var Sa=this._layerClassFromLayerView(Va);Sa=this._getLayerIdxByUID(Sa,Va.uid);
if(null!=Sa){if(Sa<ha||null==ha)Da=!0;ha=Sa}}else this._registerTiledLayerView(Va),Va.layer.loaded&&(Da=!0);this._basemapLayerViewHandles.forEach((Va,wa)=>{Ka.has(wa)||(this._unregisterTiledLayerView(wa),Da=!0)});Da&&this._updateTiledLayers();this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._evaluateTransparency();xa.madeProgress()}}_allSurfaceLayersTransparent(){let xa=0===this.view.map?.ground?.opacity;for(const Da of this.view.allLayerViews.items)if(ma.isMapTileLayerView(Da)&&!T.isBaseLayer(Da.layer)&&
0!==Da.fullOpacity){xa=!1;break}return xa}_hasCompositeBlendMode(){for(const xa of this.view.allLayerViews.items)if((ma.isBlendableLayerView(xa)||ma.isGroupLayerView(xa))&&ja.isCompositeBlendMode(ja.blendModeFromString[xa.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(xa){return ma.isElevationLayerView(xa)?ca.LayerClass.ELEVATION:ca.LayerClass.MAP}_registerTiledLayerView(xa){const Da=[];(ma.isBlendableLayerView(xa)||ma.isGroupLayerView(xa))&&Da.push(x.watch(()=>xa.layer.blendMode,()=>
{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(X.TextureUpdate.UNFADED)}));if(!ma.isGroupLayerView(xa)){const Ka=this._layerClassFromLayerView(xa);Da.push(x.watch(()=>xa.suspended,()=>this._updateTiledLayers()));Da.push(x.watch(()=>xa.fullOpacity,()=>this._updateTileTextures(X.TextureUpdate.UNFADED)));Da.push(x.watch(()=>"effectiveScaleRange"in xa.layer?xa.layer.effectiveScaleRange:null,()=>this._restartAllAgents(Ka)));Da.push(xa.on("data-changed",()=>{const ha=
this._getLayerIdxByUID(Ka,xa.uid);null!=ha&&this._invalidateLayerData(ha,Ka)}))}this._unregisterTiledLayerView(xa.uid);this._basemapLayerViewHandles.set(xa.uid,Da)}_unregisterTiledLayerView(xa){const Da=this._basemapLayerViewHandles.get(xa);if(Da){for(const Ka of Da)Ka.remove();this._basemapLayerViewHandles.delete(xa)}}_updateTiledLayers(){if(this.tilingScheme&&!this.view.suspended){var xa=[[],[]],Da=null;this.view.allLayerViews.forEach(ha=>{if(ha.layer&&!ha.suspended&&ma.isSurfaceLayerView(ha)&&
ha.fullExtent){var Sa=this._layerClassFromLayerView(ha);if(Sa===ca.LayerClass.MAP){const Va=ha.displayLevelRange.maxLevel;Infinity!==Va&&(null===Da||Va>Da)&&(Da=Va)}xa[Sa].push(ha)}});for(const ha of ca.LayerClasses){var Ka=this._layerViews[ha];const Sa=xa[ha];Sa.reverse();const Va=Sa.length;let wa=Ka.length!==Va;const Ba=Array(Va),Ja=Array(Ka.length);this._layerIndexByUid[ha].clear();for(let Ta=0;Ta<Va;Ta++){this._layerIndexByUid[ha].set(Sa[Ta].uid,Ta);const db=Ka.indexOf(Sa[Ta]);Ba[Ta]=db;Ta!==
db&&(wa=!0);-1<db&&(Ja[db]=Ta)}if(wa){Ka=this._postorderIterator;for(Ka.reset(this._rootTiles);!Ka.done;)Ka.next().modifyLayers(Ja,Ba,ha);this._layerViews[ha]=Sa;this._restartAllAgents(ha);this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(Da)&&this._viewChangeUpdate()}}_restartAllAgents(xa){const Da=this._postorderIterator;for(Da.reset(this._rootTiles);!Da.done;){const Ka=Da.next();Ka.restartAgents(xa);xa===ca.LayerClass.ELEVATION&&Ka.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(xa,
Da){return this._layerViews[Da][xa]}numLayers(xa){return this._layerViews[xa].length}_updateTileTextures(xa){this._allTiles.forAll(Da=>{Da.updateAgents(ca.LayerClass.MAP);xa===X.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Da,ra.TileUpdate.TEXTURE_NOFADING):Da.updateRenderData(ca.LayerClass.MAP,xa)});this._evaluateTransparency()}_invalidateLayerData(xa,Da){this._allTiles.forAll(Ka=>Ka.removeLayerAgent(xa,Da));this._allTiles.forAll(Ka=>Ka.invalidateLayerData(xa,Da))}setTileTreeDirty(){this._allTilesDirty=
!0}requestRender(xa=za.RenderRequestType.UPDATE){this.renderer.setNeedsRender(xa)}requestUpdate(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(xa,Da,Ka,ha){const Sa=this.layerViewByIndex(Da,Ka);Da=Sa.layer;if(!Da.tilemapCache||ma.isVectorTileLayerView(Sa))return this._requestTileData(xa,Ka,Sa,ha);++this._asyncWorkItems;return Da.tilemapCache.fetchAvailability(xa.lij[0],xa.lij[1],xa.lij[2],{...ha,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Va=>{--this._asyncWorkItems;
w.throwIfAborted(ha);w.isAbortError(Va)||this._dataMissing(xa,Ka,Sa,{notInTilemap:!0});throw Va;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(xa,Ka,Sa,ha),ha.signal))}_requestTileData(xa,Da,Ka,ha){return Da===ca.LayerClass.ELEVATION?ma.isElevationLayerView(Ka)?this._requestElevationTileData(xa,Ka,ha):Promise.reject():ma.isMapTileLayerView(Ka)?this._requestMapTileData(xa,Ka,ha):Promise.reject()}_requestElevationTileData(xa,Da,Ka){++this._asyncWorkItems;const ha=wa=>{if(!w.isAborted(Ka)){var Ba=
this._layerIndexByUid[ca.LayerClass.ELEVATION].get(Da.uid);null==Ba?c.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",ca.LayerClass.ELEVATION,xa.lij.toString()):(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(xa,Ba,wa))}},Sa=wa=>{w.isAbortError(wa)||(this._dataMissing(xa,ca.LayerClass.ELEVATION,Da,wa),this.requestUpdate())};if(ma.useFetchTileForLayer(Da.layer))return Da.layer.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],{noDataValue:fa.elevationNodataValue,
signal:Ka.signal}).then(wa=>{if(w.isAborted(Ka))c.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");else return this._frameTask.schedule(()=>ha(wa),Ka.signal,Sa)},Sa).finally(()=>{--this._asyncWorkItems});const Va=Da.getTileUrl(xa.lij[0],xa.lij[1],xa.lij[2]);return this._elevationDataRequester.request(Va,"binary",Ka).then(wa=>this._lercDecoder.decode(wa,{noDataValue:fa.elevationNodataValue},
Ka.signal)).then(wa=>{wa?ha(new M.ElevationTileData(wa)):Sa(Error("LERC decoding failed"))},Sa).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(xa,Da,Ka){++this._asyncWorkItems;const ha=(Ja,Ta)=>{--this._asyncWorkItems;ma.releaseTileData(Ta);w.isAborted(Ka)||(this._dataMissing(xa,ca.LayerClass.MAP,Da,Ja),this.requestUpdate())},Sa=Ja=>Ta=>ha(Ta,Ja),Va=Ja=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();w.isAborted(Ka)?ma.releaseTileData(Ja):this._mapTileDataArrived(xa,
Da,Ja)},Ka.signal,Sa(Ja)).catch(Sa(Ja)),wa=(Ja,Ta=null)=>this._frameTask.schedule(()=>ha(Ja,Ta));if(ma.isVectorTileLayerView(Da)){var Ba=Da.schemaHelper.getLevelRowColumn(xa.lij);return Da.fetchTile(Ba[0],Ba[1],Ba[2],Ka).then(Va,wa)}if(ma.isImageryTileLayerView(Da))return Da.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],Ka).then(Va,wa);if(ma.isTileLayerView(Da)&&ma.useFetchTileForLayer(Da.layer))return Da.layer.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],Ka).then(Ja=>{w.isAborted(Ka)?(c.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
wa(w.createAbortError())):Va(Ja)},wa);Ba=Da.getTileUrl(xa.lij[0],xa.lij[1],xa.lij[2]);L.isRefreshableLayer(Da.layer)&&Da.layer.refreshTimestamp&&(Ba+=`${Ba.includes("?")?"\x26":"?"}_ts=${Da.layer.refreshTimestamp}`);return this._mapDataRequester.request(Ba,Da.hasMixedImageFormats?"image+type":"image",Ka).then(Va,wa)}_mapTileDataArrived(xa,Da,Ka){Da=this._getLayerIdxByUID(ca.LayerClass.MAP,Da.uid);null!=Da?xa.dataArrived(Da,ca.LayerClass.MAP,Ka):(ma.releaseTileData(Ka),c.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(xa,
Da){return this._layerIndexByUid[xa].get(Da)}_dataMissing(xa,Da,Ka,ha){Ka=this._getLayerIdxByUID(Da,Ka.uid);null!=Ka?xa.dataMissing(Ka,Da,ha):c.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(xa){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(Da=>{Da.renderData&&this.overlayManager.setTileParameters(Da)}),this._renderer.setNeedsRender(xa))}get performanceInfo(){const xa=this._performanceInfo;xa.numNodes=this._allTiles.length;xa.numLeaves=
xa.numVisible=xa.numRendered=xa.numLoadedPerLevel.length=xa.numRenderedPerLevel.length=0;this._allTiles.forAll(Da=>{Da.isLeaf&&xa.numLeaves++;const Ka=Da.level;Da.renderData&&(xa.numLoadedPerLevel[Ka]=(xa.numLoadedPerLevel[Ka]||0)+1);Da.visible&&(xa.numVisible++,Da.rendered&&(xa.numRenderedPerLevel[Ka]=(xa.numRenderedPerLevel[Ka]||0)+1,xa.numRendered++))});return xa}get usedMemory(){if(!this.tilingScheme)return 0;null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory());return this._usedMemory??
0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((xa,Da)=>xa+Da.usedMemory,0)):null}getUsedMemoryForLayerView(xa){let Da=0;const Ka=this._layerClassFromLayerView(xa),ha=this._getLayerIdxByUID(Ka,xa.uid);null!=ha&&this._allTiles.forAll(Sa=>Da+=Sa.getUsedMemoryForLayer(Ka,ha));return Da}getTile(xa){if(null==xa||null==this._rootTiles)return null;const Da=xa.split("/").map(Va=>+Va);if(0===Da[0])return this._rootTiles.find(Va=>Va.lij[1]===Da[1]&&Va.lij[2]===Da[2]);xa=
2**Da[0];const Ka=Math.floor(Da[1]/xa),ha=Math.floor(Da[2]/xa);let Sa;this._rootTiles.some(Va=>Va.lij[1]===Ka&&Va.lij[2]===ha?(Sa=Va,!0):!1);if(Sa){for(xa=1<<Da[0]-1;Sa.lij[0]<Da[0];){let Va=Da[1]&xa?2:0;0<(Da[2]&xa)&&Va++;if(!Sa.children[Va])return null;Sa=Sa.children[Va];xa>>=1}ma.weakAssert(Sa.lij[0]===Da[0]&&Sa.lij[1]===Da[1]&&Sa.lij[2]===Da[2],"not the right tile?");return Sa}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(xa){this._renderer.renderPatchBorders=
xa}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(xa){this._renderer.visualizeNormals=xa}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(xa){this._renderer.renderingDisabled=xa}get test(){const xa=this;return{renderer:xa._renderer,lercDecoder:xa._lercDecoder,forceReload:()=>{null!=xa._rootTiles&&0<xa._rootTiles.length&&(xa._mergeTile(xa._rootTiles[0]),xa._viewChangeUpdate())},getTiles:()=>xa._allTiles.toArray(),getRenderedTiles(){Wa.clear();
xa._allTiles.forAll(Ka=>{Ka.visible&&Ka.rendered&&Wa.push(Ka)});const Da=Wa.toArray();Aa.sortTiles(xa.renderOrder,Da);return Da},lockTilingScheme(Da,Ka){xa._extentHelper.defaultTiledLayersExtent=Ka;xa.tilingSchemeLogic.test.lockTilingScheme(Da)}}}checkAllTilesWaterproofness(){if(ma.enableWaterproofnessTests){var xa=this._rootTiles;if(null!=xa){var Da=Sa=>0<Sa?.renderData?.geometry?.indices?.length,Ka=Sa=>{if(Sa.intersectsClippingArea)if(Sa.renderData&&!Sa.renderData.geometryState&&console.error("Tile[",
Sa.lij,"] has renderData but not geometryState"),Sa.renderData&&!Sa.renderData.geometry&&console.error("Tile[",Sa.lij,"] has renderData but not geometryInfo"),!Sa.renderData?.geometry||0<(Sa.renderData.geometry.indices?.length??0)||console.error("Tile[",Sa.lij,"] has renderData but no indices - geometryInfo: ",Sa.renderData.geometry),Da(Sa)){Sa.checkGeometryWaterproofness();for(const Ba of Sa.children){var Va=Ba,wa=Sa;Da(Va)&&console.error("Tile[",Va.lij,"] has geometry although parent[",wa.lij,"] has geom")}}else if(Sa.isLeaf)console.error("Tile[",
Sa.lij,"] has no geometry and no children, from root to leaf");else for(Va of Sa.children)Ka(Va)},ha=Sa=>{const Va=Sa.parent?.visible??!0,wa=Sa.visible;Sa.computeVisibility();const Ba=Sa.visible;wa!==Ba&&Va&&console.error(" Tile[",Sa.lij,"] has out of date visibility: ",wa," instead of ",Ba);if(!Sa.isLeaf)for(const Ja of Sa.children)ha(Ja)};for(const Sa of xa)Ka(Sa),ha(Sa)}}}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(xa){return this.isGlobal&&
xa[2]===this.lijEastEnd(xa[0])-1}isWestEndWrap(xa){return this.isGlobal&&0===xa[2]}lijEastEnd(xa){return 2**(xa+(null!=this.spatialReference&&this.spatialReference.isGeographic?1:0))}wrapEastWest(xa){const Da=this.lijEastEnd(xa[0]),Ka=xa[2];return 0<=Ka&&Ka<Da?xa:this.isGlobal?[xa[0],xa[1],(Ka+(0>Ka?Da:0))%Da]:null}enableInternalChecks(xa){ma.enableInternalTerrainChecks(xa)}enableWaterproofnessChecks(xa){ma.enableTerrainWaterproofnessChecks(xa)}};d._tileMemcacheKey="TerrainTileMemcache";b.__decorate([n.property()],
d.prototype,"_renderer",void 0);b.__decorate([n.property({constructOnly:!0})],d.prototype,"_scaleRangeQueries",void 0);b.__decorate([n.property({constructOnly:!0})],d.prototype,"view",void 0);b.__decorate([n.property({constructOnly:!0})],d.prototype,"overlayManager",void 0);b.__decorate([n.property()],d.prototype,"_hasPendingUpdates",void 0);b.__decorate([n.property()],d.prototype,"_asyncWorkItems",void 0);b.__decorate([n.property()],d.prototype,"_allTilesDirty",void 0);b.__decorate([n.property()],
d.prototype,"_allTilesSorted",void 0);b.__decorate([n.property()],d.prototype,"_viewChanged",void 0);b.__decorate([n.property()],d.prototype,"_splitLimits",void 0);b.__decorate([n.property({readOnly:!0})],d.prototype,"_watchUpdatingTracking",void 0);b.__decorate([n.property()],d.prototype,"_frameTask",void 0);b.__decorate([n.property({readOnly:!0})],d.prototype,"snapLevel",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"lodSnapping",null);b.__decorate([n.property()],d.prototype,"_userClippingExtent",
null);b.__decorate([n.property()],d.prototype,"_rootTilesExtent",void 0);b.__decorate([n.property({readOnly:!0})],d.prototype,"extent",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"groundExtent",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"_tilingSchemeExtent",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"updating",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"running",null);b.__decorate([n.property(W.updatingProgress)],d.prototype,"updatingProgress",
void 0);b.__decorate([n.property({readOnly:!0})],d.prototype,"updatingProgressValue",null);b.__decorate([n.property()],d.prototype,"_maxNumUpdating",void 0);b.__decorate([n.property()],d.prototype,"baseOpacity",null);b.__decorate([n.property()],d.prototype,"hasCompositeBlendMode",void 0);b.__decorate([n.property({readOnly:!0})],d.prototype,"viewingMode",null);b.__decorate([n.property()],d.prototype,"maxTextureScale",void 0);b.__decorate([n.property({readOnly:!0})],d.prototype,"ready",null);b.__decorate([n.property({value:ka.RenderOrder.FRONT_TO_BACK})],
d.prototype,"renderOrder",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"rootTiles",null);b.__decorate([n.property()],d.prototype,"_rootTiles",void 0);b.__decorate([n.property({readOnly:!0})],d.prototype,"spatialReference",null);b.__decorate([n.property({type:g})],d.prototype,"backgroundColor",null);b.__decorate([n.property({value:!1})],d.prototype,"slicePlaneEnabled",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"tilingScheme",void 0);b.__decorate([n.property({readOnly:!0})],
d.prototype,"tilingSchemeLocked",null);b.__decorate([n.property({readOnly:!0})],d.prototype,"tilingSchemeLogic",void 0);b.__decorate([n.property()],d.prototype,"wireframe",null);b.__decorate([n.property({value:!1})],d.prototype,"suspended",null);b.__decorate([n.property()],d.prototype,"textureFadeDuration",null);b.__decorate([n.property()],d.prototype,"visibleElevationBounds",void 0);b.__decorate([n.property()],d.prototype,"rootTileElevationBounds",void 0);b.__decorate([n.property()],d.prototype,
"_layerViewsDirty",void 0);b.__decorate([n.property()],d.prototype,"renderPatchBorders",null);b.__decorate([n.property()],d.prototype,"visualizeNormals",null);b.__decorate([n.property()],d.prototype,"renderingDisabled",null);b=d=Ra=b.__decorate([v.subclass("esri.views.3d.terrain.TerrainSurface")],d);const Ya=C.create(),ab=H.create(),Wa=new u,cb={spatialReference:null,extent:H.create(),context:"ground"},Na={spatialReference:null,extent:null,scale:0};return b})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],
function(a){class b{constructor(g){this._store=g}destroy(){this._store.destroy()}get(g){return this._store.get(g)}put(g,d){this._store.put(g,d,d.values.byteLength+256)}}a.ElevationQueryTileCache=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationTileData":function(){define(["exports"],function(a){class b{constructor(g,d,k,m){this._maxValue=this._minValue=this._hasNoDataValues=null;"pixelData"in g?(this.values=g.pixelData,this.width=g.width,this.height=
g.height,this.noDataValue=g.noDataValue):(this.values=g,this.width=d,this.height=k,this.noDataValue=m)}get hasNoDataValues(){null==this._hasNoDataValues&&(this._hasNoDataValues=this.values.includes(this.noDataValue));return this._hasNoDataValues}get minValue(){this._ensureBounds();return this._minValue}get maxValue(){this._ensureBounds();return this._maxValue}_ensureBounds(){if(null==this._minValue){var {noDataValue:g,values:d}=this,k=Infinity,m=-Infinity,f=!0;for(const c of d)c===g?this._hasNoDataValues=
!0:(k=c<k?c:k,m=c>m?c:m,f=!1);f?this._maxValue=this._minValue=0:(this._minValue=k,this._maxValue=-3E38<m?m:0)}}}a.ElevationTileData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../core/workers/WorkerHandle"],function(a,b){class g extends b.WorkerHandle{constructor(k=null){super("LercWorker","_decode",{_decode:m=>[m.buffer]},k,{strategy:"dedicated"});this.schedule=k;this.ref=0}decode(k,m,f){return k&&0!==k.byteLength?
this.invoke({buffer:k,options:m},f):Promise.resolve(null)}release(){0>=--this.ref&&(d.forEach((k,m)=>{k===this&&d.delete(m)}),this.destroy())}}const d=new Map;a.acquireDecoder=function(k=null){let m=d.get(k);m||(null!=k?(m=new g(f=>k.immediate.schedule(f)),d.set(k,m)):(m=new g,d.set(null,m)));++m.ref;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerHandle":function(){define("exports ../arrayUtils ../handleUtils ../Logger ../promiseUtils ./workers".split(" "),
function(a,b,g,d,k,m){class f{constructor(c,l,e,p,h={}){this._mainMethod=l;this._transferLists=e;this._listeners=[];this._promise=m.open(c,{...h,schedule:p}).then(u=>{if(void 0===this._thread){this._thread=u;this._promise=null;h.hasInitialize&&this.broadcast({},"initialize");for(const w of this._listeners)this._connectListener(w)}else u.close()});this._promise.catch(u=>d.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${c} worker: ${u}`))}on(c,l){const e={removed:!1,eventName:c,
callback:l,threadHandle:null};this._listeners.push(e);this._connectListener(e);return g.makeHandle(()=>{e.removed=!0;b.remove(this._listeners,e);this._thread&&null!=e.threadHandle&&e.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null;this._listeners.length=0;this._transferLists={}}invoke(c,l){return this.invokeMethod(this._mainMethod,c,l)}invokeMethod(c,l,e){if(this._thread){var p=this._transferLists[c];p=p?p(l):[];return this._thread.invoke(c,
l,{transferList:p,signal:e})}return this._promise?this._promise.then(()=>{k.throwIfAborted(e);return this.invokeMethod(c,l,e)}):Promise.reject(null)}broadcast(c,l){return this._thread?Promise.all(this._thread.broadcast(l,c)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(c,l)):Promise.reject()}get promise(){return this._promise}_connectListener(c){this._thread&&this._thread.on(c.eventName,c.callback).then(l=>{c.removed||(c.threadHandle=l)})}}a.WorkerHandle=f;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,b,g,d,k,m,f,c){class l extends c.TiledDisplayObject{constructor(p,h,u,w,x,n,q,t=null){super(p,h,u,w,x,n,4096,4096);this.styleRepository=q;this._memCache=t;this.type="vector-tile";this._referenced=0;this._hasSymbolBuckets=
!1;this._memoryUsedByLayerData=0;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this._processed=!1;this._referenced=1;this.id=p.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<f.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&
(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<f.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(p){this.changeDataImpl(p);this.requestRender();this.ready();this._processed=!0}deleteLayerData(p){let h=!1;for(const u of p)if(p=this.layerData.get(u))this._memoryUsedByLayerData-=p.memoryUsed,p.type===k.BucketType.SYMBOL&&this.symbols.delete(u)&&(h=!0),p.destroy(),this.layerData.delete(u);this._memCache?.updateSize(this.key.id,
this,this._memoryUsedByLayerData);h&&this.emit("symbols-changed");this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}dispose(){"unloaded"!==this.status&&(e.delete(this),l._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+
256}changeDataImpl(p){let h=!1;if(p){const {bucketsWithData:u,emptyBuckets:w}=p;p=this._createRenderBuckets(u);if(w&&0<w.byteLength){const x=new Uint32Array(w);for(const n of x)this._deleteLayerData(n)}for(const [x,n]of p)this._deleteLayerData(x),n.type===k.BucketType.SYMBOL&&(this.symbols.set(x,n.symbols),h=!0),this._memoryUsedByLayerData+=n.memoryUsed,this.layerData.set(x,n);this._memCache?.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const [,u]of this.layerData)u.type===
k.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);h&&this.emit("symbols-changed")}attachWithContext(p){this.stage={context:p,trashDisplayObject(h){h.processDetach()},untrashDisplayObject(){return!1}}}setTransform(p){super.setTransform(p);var h=this.resolution/(p.resolution*p.pixelRatio);const u=this.width/this.rangeX*h;h*=this.height/this.rangeY;const w=[0,0];p.toScreen(w,[this.x,this.y]);const x=this.transforms.tileUnitsToPixels;g.identity(x);g.translate(x,x,w);g.rotate(x,x,Math.PI*p.rotation/180);
g.scale(x,x,[u,h,1])}_createTransforms(){return{dvs:d.create(),tileMat3:d.create(),tileUnitsToPixels:d.create()}}static _destroyRenderBuckets(p){if(p){var h=new Set;for(const u of p.values())h.has(u)||(u.destroy(),h.add(u));p.clear()}}_createRenderBuckets(p){const h=new Map,u=new Map;for(const w of p){p=this._deserializeBucket(w,u);for(const x of p.layerUIDs)h.set(x,p)}return h}_deserializeBucket(p,h){let u=h.get(p);if(u)return u;switch((new Uint32Array(p))[0]){case k.BucketType.FILL:u=new m.FillRenderBucket(p,
this.styleRepository);break;case k.BucketType.LINE:u=new m.LineRenderBucket(p,this.styleRepository);break;case k.BucketType.SYMBOL:u=new m.SymbolRenderBucket(p,this.styleRepository,this);break;case k.BucketType.CIRCLE:u=new m.CircleRenderBucket(p,this.styleRepository)}h.set(p,u);return u}_deleteLayerData(p){if(this.layerData.has(p)){var h=this.layerData.get(p);this._memoryUsedByLayerData-=h.memoryUsed;h.destroy();this.layerData.delete(p)}}}const e=new Map;a.VectorTile=l;a.printAllocations=function(){e.forEach((p,
h)=>{console.log(`\n${h.key}:`);p[0].forEach(u=>console.log(u));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");p[1].forEach(u=>console.log(u))})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=
0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(a,b,g,d,k,m,f,c){class l{constructor(w,x){this.layerUIDs=[];this.isDestroyed=!1;this._data=w;let n=1;w=new Uint32Array(w);this.layerUIDs=[];const q=w[n++];for(let t=0;t<q;t++)this.layerUIDs[t]=w[n++];
this.bufferDataOffset=n;x&&(this.layer=x.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(w){null!=this._data&&(this.doPrepareForRendering(w,this._data,this.bufferDataOffset),this._data=null)}}class e extends l{constructor(w,x){super(w,x);this.type=d.BucketType.LINE;this.lineIndexCount=
this.lineIndexStart=0;w=new Uint32Array(w);x=this.bufferDataOffset;this.lineIndexStart=w[x++];this.lineIndexCount=w[x++];const n=w[x++];if(0<n){this.patternMap=new Map;for(let q=0;q<n;q++){const t=w[x++],v=w[x++],r=w[x++];this.patternMap.set(t,[v,r])}}this.bufferDataOffset=x}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=b.disposeMaybe(this.vao)}doPrepareForRendering(w,
x,n){var q=new Uint32Array(x);x=new Int32Array(q.buffer);var t=q[n++];x=m.BufferObject.createVertex(w,f.Usage.STATIC_DRAW,new Int32Array(x.buffer,4*n,t));n+=t;t=q[n++];q=m.BufferObject.createIndex(w,f.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*n,t));n+=t;n=this.layer.lineMaterial;this.vao=new c.VertexArrayObject(w,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:x},q)}}class p extends l{constructor(w,x){super(w,x);this.type=d.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=
this.fillIndexStart=0;w=new Uint32Array(w);x=this.bufferDataOffset;this.fillIndexStart=w[x++];this.fillIndexCount=w[x++];this.outlineIndexStart=w[x++];this.outlineIndexCount=w[x++];const n=w[x++];if(0<n){this.patternMap=new Map;for(let q=0;q<n;q++){const t=w[x++],v=w[x++],r=w[x++];this.patternMap.set(t,[v,r])}}this.bufferDataOffset=x}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+
this.outlineIndexCount)/3}doDestroy(){this.fillVAO=b.disposeMaybe(this.fillVAO);this.outlineVAO=b.disposeMaybe(this.outlineVAO)}doPrepareForRendering(w,x,n){var q=new Uint32Array(x),t=new Int32Array(q.buffer),v=q[n++];x=m.BufferObject.createVertex(w,f.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*n,v));n+=v;var r=q[n++];v=m.BufferObject.createIndex(w,f.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*n,r));n+=r;r=q[n++];t=m.BufferObject.createVertex(w,f.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*n,r));
n+=r;r=q[n++];q=m.BufferObject.createIndex(w,f.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*n,r));n+=r;r=this.layer;n=r.fillMaterial;r=r.outlineMaterial;this.fillVAO=new c.VertexArrayObject(w,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:x},v);this.outlineVAO=new c.VertexArrayObject(w,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:t},q)}}class h extends l{constructor(w,x,n){super(w,x);this.type=d.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;
this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];x=new Uint32Array(w);const q=new Int32Array(w);w=new Float32Array(w);let t=this.bufferDataOffset;this.isIconSDF=!!x[t++];var v=x[t++];for(var r=0;r<v;r++){var y=x[t++],z=x[t++],D=x[t++];this.iconPerPageElementsMap.set(y,[z,D])}v=x[t++];for(r=0;r<v;r++)y=x[t++],z=x[t++],D=x[t++],this.glyphPerPageElementsMap.set(y,[z,D]);v=x[t++];r=x[t++];this.iconOpacity=new Int32Array(v);this.textOpacity=new Int32Array(r);
this.bufferDataOffset=t=k.deserializeSymbols(x,q,w,t,this.symbols,n)}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+g.estimateSize(this.iconOpacity)+g.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let w=0;for(const [,x]of this.iconPerPageElementsMap)w+=x[1];for(const [,x]of this.glyphPerPageElementsMap)w+=x[1];return w/3}doDestroy(){this.iconVAO=
b.disposeMaybe(this.iconVAO);this.textVAO=b.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var w=this.iconOpacity,x=this.iconVAO.vertexBuffers.opacity;0<w.length&&w.byteLength===x.byteLength&&x.setSubData(w,0,0,w.length);w=this.textOpacity;x=this.textVAO.vertexBuffers.opacity;0<w.length&&w.byteLength===x.byteLength&&x.setSubData(w,0,0,w.length)}}doPrepareForRendering(w,x,n){var q=new Uint32Array(x),t=new Int32Array(q.buffer),v=q[n++];x=m.BufferObject.createVertex(w,
f.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*n,v));n+=v;var r=q[n++];v=m.BufferObject.createIndex(w,f.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*n,r));n+=r;r=q[n++];t=m.BufferObject.createVertex(w,f.Usage.STATIC_DRAW,new Int32Array(t.buffer,4*n,r));n+=r;r=q[n++];q=m.BufferObject.createIndex(w,f.Usage.STATIC_DRAW,new Uint32Array(q.buffer,4*n,r));n+=r;n=m.BufferObject.createVertex(w,f.Usage.STATIC_DRAW,this.iconOpacity.buffer);r=m.BufferObject.createVertex(w,f.Usage.STATIC_DRAW,this.textOpacity.buffer);
var y=this.layer;const z=y.iconMaterial;y=y.textMaterial;this.iconVAO=new c.VertexArrayObject(w,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:x,opacity:n},v);this.textVAO=new c.VertexArrayObject(w,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:t,opacity:r},q)}}class u extends l{constructor(w,x){super(w,x);this.type=d.BucketType.CIRCLE;this.circleIndexCount=this.circleIndexStart=0;w=new Uint32Array(w);x=this.bufferDataOffset;this.circleIndexStart=w[x++];this.circleIndexCount=w[x++];
this.bufferDataOffset=x}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=b.disposeMaybe(this.vao)}doPrepareForRendering(w,x,n){var q=new Uint32Array(x);x=new Int32Array(q.buffer);var t=q[n++];x=m.BufferObject.createVertex(w,f.Usage.STATIC_DRAW,new Int32Array(x.buffer,4*n,t));n+=t;t=q[n++];q=m.BufferObject.createIndex(w,f.Usage.STATIC_DRAW,new Uint32Array(q.buffer,
4*n,t));n+=t;n=this.layer.circleMaterial;this.vao=new c.VertexArrayObject(w,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:x},q)}}a.CircleRenderBucket=u;a.FillRenderBucket=p;a.LineRenderBucket=e;a.RenderBucketBase=l;a.SymbolRenderBucket=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../enums","./core"],function(a,b,g){class d{constructor(k,m,f){this._rows=Math.ceil(m/f);this._columns=Math.ceil(k/
f);this._cellSize=f;this.cells=Array(this._rows);for(k=0;k<this._rows;k++)for(this.cells[k]=Array(this._columns),m=0;m<this._columns;m++)this.cells[k][m]=[]}getCell(k,m){m=Math.min(Math.max(Math.floor(m/this._cellSize),0),this._rows-1);k=Math.min(Math.max(Math.floor(k/this._cellSize),0),this._columns-1);return this.cells[m]&&this.cells[m][k]||null}getCellSpan(k,m,f,c){return[Math.min(Math.max(Math.floor(k/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(m/this._cellSize),0),this.rows-
1),Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(c/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}a.GridIndex=d;a.deserializeSymbols=function(k,m,f,c,l,e){const p=m[c++];for(let w=0;w<p;w++){const x=new g.VTLSymbol(e);x.xTile=m[c++];x.yTile=m[c++];x.hash=m[c++];x.priority=m[c++];var h=m[c++];for(var u=0;u<h;u++){const n=m[c++],q=m[c++],t=m[c++],v=m[c++],r=!!m[c++],
y=m[c++],z=f[c++],D=f[c++],C=m[c++],E=m[c++];x.colliders.push({xTile:n,yTile:q,dxPixels:t,dyPixels:v,hard:r,partIndex:y,width:C,height:E,minLod:z,maxLod:D})}h=k[c++];for(u=0;u<h;u++)x.textVertexRanges.push([k[c++],k[c++]]);h=k[c++];for(u=0;u<h;u++)x.iconVertexRanges.push([k[c++],k[c++]]);l.push(x)}return c};a.tileCoordChange=function(k,m,f,c,l,e){f-=l;if(0<=f)return(m>>f)+(c-(e<<f))*(k>>f);f=-f;return m-(e-(c<<f))*(k>>f)<<f};a.writeOpacityToBuffers=function(k,m,f){for(const [w,x]of k.symbols){{var c=
k,l=m,e=f,p=x;const n=c.layerData.get(w);if(n.type===b.BucketType.SYMBOL){for(const q of p){p=q.unique;var h=void 0;if(q.selectedForRendering){var u=p.parts[0];h=u.startOpacity;u=u.targetOpacity;c.allSymbolsFadingOut=c.allSymbolsFadingOut&&0===u;h=e?Math.floor(127*h)|u<<7:u?255:0;h|=h<<24|h<<16|h<<8}else h=0;for(const [t,v]of q.iconVertexRanges)for(u=t;u<t+v;u+=4)n.iconOpacity[u/4]=h;q.selectedForRendering?(h=p.parts[1],p=h.startOpacity,h=h.targetOpacity,c.allSymbolsFadingOut=c.allSymbolsFadingOut&&
0===h,p=e?Math.floor(127*p)|h<<7:h?255:0,h=p<<24|p<<16|p<<8|p):h=0;for(const [t,v]of q.textVertexRanges)for(p=t;p<t+v;p+=4)n.textOpacity[p/4]=h}n.lastOpacityUpdate=l;n.opacityChanged=!0}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){class b{constructor(d){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=d}}
class g{constructor(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}a.VTLSymbol=b;a.VTLUniqueSymbol=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.collisionGridCellSize=32;a.declutterBudget=1.5;a.declutterTiles=!0;a.fadeDuration=200;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,g,d){class k extends g.DisplayObject{constructor(m,f,c,l,e,p,h=e,u=p){super();this.triangleCount=this.triangleCountReportedInDebug=0;this.texture=null;this.key=new d(m);this.resolution=f;this.x=c;this.y=l;this.width=e;this.height=p;this.rangeX=h;this.rangeY=u}destroy(){this.texture&&(this.texture.dispose(),this.texture=
null)}setTransform(m){const f=this.resolution/(m.resolution*m.pixelRatio),c=this.transforms.tileMat3,[l,e]=m.toScreenNoRotation([0,0],[this.x,this.y]);b.set(c,this.width/this.rangeX*f,0,0,0,this.height/this.rangeY*f,0,l,e,1);b.multiply(this.transforms.dvs,m.displayViewMat3,c)}}a.TiledDisplayObject=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],
function(a,b,g,d){const k=1/g("mapview-transitions-duration");class m extends b{constructor(){super(...arguments);this._clips=this._fadeInResolver=this._fadeOutResolver=null;this.computedVisible=!0;this.computedOpacity=1;this._isReady=this.inFadeTransition=this.fadeTransitionEnabled=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get clips(){return this._clips}set clips(f){this._clips=f;this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(f){this._opacity!==
f&&(this._opacity=Math.min(1,Math.max(f,0)),this.requestRender())}get stage(){return this._stage}set stage(f){if(this._stage!==f){var c=this._stage;(this._stage=f)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):c?.trashDisplayObject(this)}}get transforms(){return this._getTransforms()}_getTransforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get visible(){return this._visible}set visible(f){this._visible!==f&&(this._visible=
f,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=d.createResolver();this.requestRender();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;
this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=d.createResolver();this.requestRender();return this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()}beforeRender(f){this.updateTransitionProperties(f.deltaTime,f.state.scale);this.setTransform(f.state)}afterRender(f){this._fadeInResolver&&
this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(f){}processRender(f){this.stage&&this.computedVisible&&this.doRender(f)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),
this._fadeOutResolver=null);this.onDetach();this.emit("detach")}updateTransitionProperties(f,c){if(this.fadeTransitionEnabled){c=this._fadeOutResolver||!this.visible?0:this.opacity;const l=this.computedOpacity;l===c?this.computedVisible=this.visible:(f*=k,this.computedOpacity=l>c?Math.max(c,l-f):Math.min(c,l+f),this.computedVisible=0<this.computedOpacity,f=c===this.computedOpacity,this.inFadeTransition=!f,f||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(f){}ready(){this._isReady||
(this._isReady=!0,this.emit("isReady"),this.requestRender())}}a.DisplayObject=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(a){class b{static getId(g,d,k,m){return"object"===typeof g?`${g.level}/${g.row}/${g.col}/${g.world}`:`${g}/${d}/${k}/${m}`}constructor(g,d,k,m){this.set(g,d,k,m)}get key(){return this}get id(){return this.toString()}set id(g){this.set(g)}get hash(){return(this.world&3)<<
30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}acquire(g,d,k,m){this.set(g,d,k,m)}contains(g){const d=g.level-this.level;return 0<=d&&this.row===g.row>>d&&this.col===g.col>>d&&this.world===g.world}equals(g){return this.level===g.level&&this.row===g.row&&this.col===g.col&&this.world===g.world}clone(){return new b(this)}release(){this.world=this.col=this.row=this.level=0}set(g,d,k,m){if(null==g)this.world=this.col=this.row=this.level=0;else if("object"===typeof g)this.level=g.level||0,this.row=
g.row||0,this.col=g.col||0,this.world=g.world||0;else if("string"===typeof g){const [f,c,l,e]=g.split("/");this.level=parseFloat(f);this.row=parseFloat(c);this.col=parseFloat(l);this.world=parseFloat(e)}else this.level=+g,this.row=+d,this.col=+k,this.world=+m||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=this.level?null:new b(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const g=this.level+1,d=this.row<<1,k=this.col<<
1,m=this.world;return[new b(g,d,k,m),new b(g,d,k+1,m),new b(g,d+1,k,m),new b(g,d+1,k+1,m)]}compareRowMajor(g){return this.row<g.row?-1:this.row>g.row?1:this.col<g.col?-1:this.col>g.col?1:0}}b.pool=new a(b,null,null,25,50);return b})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){class b{constructor(g=0,d=0){this.min=g;this.max=d;this.level=0;this.hasNoDataValues=!1}copyFrom(g){this.min=g.min;this.max=g.max;this.level=g.level;this.hasNoDataValues=g.hasNoDataValues}}a.ElevationBounds=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../../../layers/support/ElevationSamplerData",
"../support/mathUtils","./TerrainConst"],function(a,b,g,d,k){class m{constructor(c,l,e){this.type="elevation";this.level=c[0];this.i=c[1];this.j=c[2];this.extent=l;this.samplerData=new g.ElevationSamplerData(e,l)}computeMinMaxValue(c,l,e,p){p.min=Infinity;p.max=-Infinity;p.hasNoDataValues=!1;c-=this.level;if(0>=c)return p;var h=2**c;if(Math.floor(l/h)!==this.i||Math.floor(e/h)!==this.j)return p;var u=Infinity,w=-Infinity,x=this.samplerData.data.width,n=this.samplerData.data.values,q=.5*k.elevationNodataValue;
c=(x-1)/h;e=(e-this.j*h)*c;let t=(l-this.i*h)*c;if(1>c){const y=Math.floor(e),z=Math.floor(t);var v=y+z*x;l=n[v];h=n[v+1];var r=n[v+x];v=n[v+x+1];if(l+h+r+v<q)return u=e-y,q=t-z,w=d.bilerp(l,h,r,v,u,q),x=d.bilerp(l,h,r,v,u+c,q),n=d.bilerp(l,h,r,v,u,q+c),c=d.bilerp(l,h,r,v,u+c,q+c),p.min=Math.min(w,x,n,c),p.max=Math.max(w,x,n,c),p;e=y;t=z;c=1}else e=Math.floor(e),t=Math.floor(t),c=Math.ceil(c);for(l=e;l<=e+c;l++)for(h=t;h<=t+c;h++)r=n[l+h*x],r<q?(u=Math.min(u,r),w=Math.max(w,r)):p.hasNoDataValues=
!0;p.min=u;p.max=w;return p}}const f=.5*k.elevationNodataValue;a.ElevationData=m;a.sampleElevation=function(c,l,e){if(null==e)return null;for(const x of e){if(!x)continue;var p=x.safeWidth;e=b.clamp(x.dy*(x.y1-l),0,p);p=b.clamp(x.dx*(c-x.x0),0,p);const n=Math.floor(e),q=Math.floor(p);var h=x.data.width,u=n*h+q,w=x.data.values;const t=w[u],v=w[u+1];u+=h;h=w[u];w=w[u+1];if(t+h+v+w<f)return e-=n,p-=q,c=t+(v-t)*p,c+(h+(w-h)*p-c)*e}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/ElevationSamplerData":function(){define(["exports"],function(a){class b{constructor(g,d){this.data=g;this.safeWidth=.99999999*(g.width-1);this.dx=(g.width-1)/(d[2]-d[0]);this.dy=(g.width-1)/(d[3]-d[1]);this.x0=d[0];this.y1=d[3]}}a.ElevationSamplerData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(t,v){return null==t||t.spatialReference.equals(v)?t:l.projectWithoutEngine(t,t.spatialReference,v)}a.ExtentHelper=class extends g{constructor(t){super(t)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const t=
[];this.layerViews.forEach(v=>{v=v.layer;"IntegratedMeshLayer"===v.operationalLayerType&&null!=this.viewSpatialReference&&(v=x(v.fullExtent,this.viewSpatialReference),null!=v&&t.push(e.fromExtent(v)))});return t}};b.__decorate([d.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);b.__decorate([d.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);b.__decorate([d.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);b.__decorate([d.property()],
a.ExtentHelper.prototype,"viewSpatialReference",void 0);b.__decorate([d.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);b.__decorate([d.property()],a.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);b.__decorate([d.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);b.__decorate([d.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=b.__decorate([c.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let n=
class extends a.ExtentHelper{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?u.webmercatorWorldExtent:u.geographicWorldExtent}};n=b.__decorate([c.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],n);let q=class extends a.ExtentHelper{_computeLayerViewsExtent(){const t=e.empty(),v=this.viewSpatialReference;this.layerViews.forEach(z=>{const D=z.layer;!z.isResolved()||"graphics"===
D.type&&D.internal||(z=x("fullExtentInLocalViewSpatialReference"in z&&z.fullExtentInLocalViewSpatialReference||z.layer.fullExtent,v),e.expand(t,z,t))});const r=e.allFinite(t)?t:null,y=this._get("layerViewsExtent");return e.equals(r,y)?y:r}_computeTiledLayersExtent(){const t=this.tilingScheme;if(!t)return null;const v=this.viewSpatialReference,r=e.empty();this.layers.forEach(D=>{if(D.loaded&&p.isTiledLayer(D)){const A=w.getTiledLayerInfo(D,v,h.ViewingMode.Local);if(null!=A){var {tileInfo:C,fullExtent:E}=
A;null!=C&&null!=E&&(w.isProjectableRasterLayer(D)||t.compatibleWith(C)&&E.spatialReference.equals(t.spatialReference))&&e.expand(r,E,r)}}});e.expand(r,this.defaultTiledLayersExtent,r);const y=e.allFinite(r)?r:null,z=this._get("tiledLayersExtent");return e.equals(y,z)?z:y}};q=b.__decorate([c.subclass("esri.views.3d.terrain.ExtentHelperLocal")],q);a.create=function(t,v){return t===h.ViewingMode.Global?new n(v):new q(v)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],
function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/has ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/textureUtils ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q){const O=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let U;a.OverlayManager=class extends g{get running(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||A.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return null!=
this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?t.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return 1.3/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(ca){super(ca);this._renderSR=this._spatialReference=null;this._overlaySREqualsRenderSR=!0;this._drapeSources=
new Set;this._drapeTargets=new Set;this._drawTexturesAnimateDirty=this._drawTexturesDirty=this._contentUpdated=this._placementDirty=!1;this._longitudeCyclical=null;this._latestOriginId=0;this._maxResolution=k("esri-mobile")?2048:4096;this._animationTimeLast=0}initialize(){const ca=this.view;this.renderer=new I.OverlayRenderer({view:ca,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});ca._stage.renderer.renderPlugins.add(this.renderer);const ba=()=>this.setDrawTexturesDirty();
this._groundIntersector=B.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this.addHandles([f.watch(()=>this.renderer.hasHighlights,ba),this.renderer.events.on("has-water",ia=>ca._stage?.renderer.setParameters({hasOverlayWater:ia})),this.renderer.events.on("renders-occluded",()=>{ba();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
ba),f.watch(()=>ca.state.camera.pixelRatio,ba),f.watch(()=>ca.state.alignPixelEnabled,ba),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),f.watch(()=>[ca.pointsOfInterest?.renderPointOfView,ca.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),f.watch(()=>[ca.state?.pixelRatio,ca.state?.contentPixelRatio],()=>this.setPlacementDirty(),f.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),ca.on("resize",()=>this.setPlacementDirty()),
ca.resourceController.scheduler.registerTask(Q.TaskPriority.OVERLAY,this),ca._stage.renderView.events.on("force-camera-for-screenshot",ia=>{this._updateOverlays(Q.noBudget,ia.camera,H.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&this._drawOverlays(H.RenderRequestType.BACKGROUND,ia)})]);ca._stage.renderer.renderOverlay=ia=>this._renderOverlay(ia)}_renderOverlay(ca){this._contentUpdated=!1;this.renderer.processSyncDrapeSources();if(this.renderer.hasOverlays)return this._dispatchAnimationUpdate(ca),
this._drawOverlays(H.RenderRequestType.UPDATE,this.view.state)}destroy(){this.view?._stage&&(this.view._stage.renderer.renderPlugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{});U&&(U.hide(),U=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(ca){this._spatialReference=ca;this.renderer.spatialReference=ca;this._longitudeCyclical=null;const ba=this.view.renderSpatialReference;null!=ca&&null!=ba?(this._renderSR=ba,this._overlaySREqualsRenderSR=ca.equals(this._renderSR),
this._isSpherical&&(this._longitudeCyclical=ca.isWebMercator?new d.Cyclical(-2.0037508342787E7,2.0037508342787E7):new d.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(ca,ba,ia){this._drapeSources.add(ca);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ba=this.renderer.createDrapeSourceRenderer(ca,ba,ia);this._updateDrapeSourceExtent(ca);
this._setContentDirty();this.notifyChange("running");return ba}registerGeometryDrapeSource(ca){return this.registerDrapeSource(ca,J.SortedRenderGeometryRenderer)}_updateDrapeSourceExtent(ca){2===this.renderer.overlays.length&&null!=ca.setDrapingExtent&&null!=this._spatialReference&&ca.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(ca){this._drapeSources.has(ca)&&(this._drapeSources.delete(ca),this.renderer.removeDrapeSourceRenderer(ca),this.renderer.ensureDrapeSources(this._drapeSources),
this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(ca){this._drapeTargets.add(ca);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(ca){this._drapeTargets.delete(ca);this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty();this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(ca){return this._updateOverlays(ca,this.view.state.contentCamera,H.RenderRequestType.UPDATE)}_updateOverlays(ca,
ba,ia){if(!this._spatialReference)return Q.Task.YIELD;var ka=this._computeOverlayResolution(ba);this._computeOverlayExtents(ba,ka,W);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,W.stretch);ba=this._updateOverlay(G.OverlayIndex.INNER,W.inner,ka,1*W.pixelRatioAdjustment,W.mapUnitsPerPixel);const na=r.width(W.inner)/r.width(W.outer);ka=this._updateOverlay(G.OverlayIndex.OUTER,W.outer,ka,na*W.pixelRatioAdjustment,W.mapUnitsPerPixel);if(ba===X.EXTENT||ka===X.EXTENT)this._drapeSources.forEach(Y=>
this._updateDrapeSourceExtent(Y)),this.surface.updateTileOverlayParams(ia);ba===X.NONE&&ka===X.NONE||this.setDrawTexturesDirty();this._placementDirty=!1;ca.madeProgress()}_computeOverlayResolution(ca){const ba=this.view.state.contentPixelRatio*this.view.resolutionScale;return Math.min(M.applyTextureResizeModulo(Math.ceil(1.5*Math.max(ca.fullWidth/ca.pixelRatio*ba,ca.fullHeight/ca.pixelRatio*ba))),this._maxResolution)}_updateOverlay(ca,ba,ia,ka,na){if(0===this.renderer.overlays.length)return X.NONE;
ca=this.renderer.overlays[ca];const Y=ca.mapUnitsPerPixel;ca.mapUnitsPerPixel=na;ca.pixelRatio=ka;ka=ca.extent;const ea=A.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(ba[2]-ba[0],ba[3]-ba[1],ka[2]-ka[0],ka[3]-ka[1]);if(Math.abs(ka[0]-ba[0])<=ea&&Math.abs(ka[1]-ba[1])<=ea&&Math.abs(ka[2]-ba[2])<=ea&&Math.abs(ka[3]-ba[3])<=ea&&ia===ca.resolution)return Y===na?X.NONE:X.RERENDER_ONLY;r.copy(ca.extent,ba);ca.resolution=ia;ba=r.center(ca.extent);ca.renderLocalOrigin=K.fromValues(ba[0],ba[1],0,
`OV_${this._latestOriginId++}`);return X.EXTENT}setTileParameters(ca){const ba=ca.renderData.overlay;if(0<this.renderer.overlays.length){const ia=this.renderer.overlays[G.OverlayIndex.INNER],ka=this.renderer.overlays[G.OverlayIndex.OUTER];ca=ca.extent;this._rectInsideRect(ia.extent,ca)||this._rectanglesOverlap(ca,ia.extent)||this._rectanglesOverlap(ca,ka.extent)?(this._setTileOverlayData(ca,G.OverlayIndex.INNER,ba),this._setTileOverlayData(ca,G.OverlayIndex.OUTER,ba)):(this._clearTileOverlayData(G.OverlayIndex.INNER,
ba),this._clearTileOverlayData(G.OverlayIndex.OUTER,ba))}else this._clearTileOverlayData(G.OverlayIndex.INNER,ba),this._clearTileOverlayData(G.OverlayIndex.OUTER,ba)}overlayPixelSizeInMapUnits(ca,ba){if(0===this.renderer.overlays.length)return ba();ba=this.renderer.overlays[G.OverlayIndex.INNER];const ia=this.renderer.overlays[G.OverlayIndex.OUTER];ca=this._pointIsInExtent(ca,ba.extent)?ba:ia;return(ca.extent[2]-ca.extent[0])/ca.resolution}_setTileOverlayData(ca,ba,ia){if(0!==this.renderer.overlays.length){var ka=
this.renderer.overlays[ba].extent,na=r.width(ka),Y=r.height(ka),ea=ca[0];if(this._longitudeCyclical){ea=this._longitudeCyclical.minimalMonotonic(ka[0],ea);const fa=this._longitudeCyclical.minimalMonotonic(ka[0],ca[2]);ea>fa&&(ea=fa-(ca[2]-ca[0]))}ia.setScale(ba,r.width(ca)/na,r.height(ca)/Y);ia.setOffset(ba,(ea-ka[0])/na,(ca[1]-ka[1])/Y)}}_clearTileOverlayData(ca,ba){ba.setScale(ca,-1,-1);ba.setOffset(ca,-1,-1)}async reloadShaders(){T.removeLoadedShaderModules();await this.renderer.reloadShaders();
this.setDrawTexturesDirty();this.runTask(Q.noBudget)}_dispatchAnimationUpdate(ca){var ba=c.Milliseconds(ca-this._animationTimeLast);if(ba>=this.surface.view._stage.renderer.animationTimestep||null!=this.view.state.forcedAnimationTime||this._drawTexturesDirty||this._drawTexturesAnimateDirty)ba=c.Milliseconds(ba/this.surface.view._stage.renderer.animationTimeDilation),ba=new L.UpdateParameters(this.view.state.camera,ba,this.view.state.forcedAnimationTime),this.renderer.updateAnimation(ba)&&(this._drawTexturesAnimateDirty=
!0),this._animationTimeLast=ca}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._drawTexturesDirty=this._contentUpdated=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(ca,ba,ia,ka){ia=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ca,S,ba,ia);if(null==ia)return!1;ba=ia.origin;ia=w.add(R,ia.origin,ia.direction);this._groundIntersector.reset(ba,ia,ca);this._groundIntersector.intersect([]);this.view.basemapTerrain.intersect(this._groundIntersector,
null,ba,ia);return this._groundIntersector.results.min.getIntersectionPoint(ka)}_findHorizonBasedPointOfInterest(ca,ba){var ia=.5;ia=this.view.renderCoordsHelper.getAltitude(ca.eye);const ka=this.view.pointsOfInterest.centerOnSurfaceFrequent;var na=m.clamp(ka.estimatedSurfaceAltitude,ca.aboveGround?-Infinity:ia+1E-5,ca.aboveGround?ia-1E-5:Infinity);ia=ca.aboveGround;if("global"===this.view.viewingMode){var Y=R;z.closestPointOnSilhouette(z.fromRadius(z.tmpSphere,t.getReferenceEllipsoid(this.view.spatialReference).radius+
na),y.wrap(ca.eye,ca.viewForward),Y);w.subtract(Y,Y,ca.eye);na=d.cyclicalPI.normalize(D.angleAroundAxis(ca.viewForward,Y,ca.viewRight))/ca.fovY+.5;Y=0>=na||1<=na?.5:.55;ia=ia?Y*na:na+Y*(1-na)}else na=q.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ca.viewForward[2])),1,0),na=n.transformMat4(na,na,ca.projectionMatrix)[1],na=m.clamp(.5+.5*na,0,1),ia=1===na||0===na?.5:ia?.55*na:1-.55*(1-na);return this._intersectGroundFromView(ca,.5,ia,ba)?w.sqrDist(ba,ca.eye)<ka.distance*ka.distance:!1}_computeOverlayExtents(ca,
ba,ia){var ka=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const na=x.create();this._findHorizonBasedPointOfInterest(ca,na)||w.copy(na,ka);A.debugFlags.OVERLAY_SHOW_CENTER?(null==U&&(U=new F.PointGraphics(this.view.graphics,"red")),U.show(na,this._renderSR)):null!=U&&U.hide();var Y=Math.max(.1,w.distance(ca.eye,na));const ea=E.viewAngle(this.view.renderCoordsHelper,ka,ca.eye);this._overlaySREqualsRenderSR||v.projectVectorToVector(na,this._renderSR,na,this._spatialReference);ka=
this.surface.extent;var fa=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,aa=fa&&this._spatialReference?1/t.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;Y=ca.perScreenPixelRatio/this.view.state.contentPixelRatio*Y*aa;ia.mapUnitsPerPixel=Y/this._worldToPCSRatio;ia.stretch=this._overlayStretch;Y=ba*Y/2*ia.stretch;var da=!1;fa=fa?90:Infinity;this._isSpherical&&ka&&this._spatialReference&&(this._spatialReference.isWebMercator?(Y/=Math.cos(C.y2lat(na[1])),
fa=ka[3]):(da=!0,Y/=t.getReferenceEllipsoid(this._spatialReference).metersPerDegree,fa=90),Y>=fa&&(Y=fa,na[1]=0,this._spatialReference.isWebMercator&&(na[0]=0)));aa=1;da&&(aa=1/Math.max(.2,Math.cos(Math.abs(m.deg2rad(na[1])))),180<Y*aa&&(aa=180/Y),ia.mapUnitsPerPixel*=aa);da=Math.log(2)/12;Y=Math.exp(Math.round(Math.log(Y)/da)*da);const ma=Y*aa;da=.5*ba/(32*ma);var ua=.5*ba/(32*Y);na[0]=Math.round(na[0]*da)/da;na[1]=Math.round(na[1]*ua)/ua;da=ia.inner;da[0]=na[0]-ma;da[1]=na[1]-Y;da[2]=na[0]+ma;da[3]=
na[1]+Y;this._isSpherical&&this._shiftExtentToFitBounds(da,Infinity,fa);ua=ia.outer;6*ma>r.width(ka)?r.copy(ua,ka):Math.PI/2-Math.abs(ea-Math.PI/2)<=.25*Math.PI?(ua[0]=da[0]-ma,ua[1]=da[1]-Y,ua[2]=da[2]+ma,ua[3]=da[3]+Y):(v.projectVectorToVector(ca.eye,this._renderSR,R,this._spatialReference),u.subtract(P,na,R),ca=-Math.atan2(P[1],P[0])+.125*Math.PI,0>ca&&(ca+=2*Math.PI),n.scale(P,O[Math.floor(ca/(.25*Math.PI))],2*Y),P[0]*=aa,P[2]*=aa,n.add(ua,da,P));this._isSpherical?(ua[0]=this._longitudeCyclical.clamp(ua[0]),
ua[2]=this._longitudeCyclical.clamp(ua[2]),ua[1]=Math.max(ua[1],-fa),ua[3]=Math.min(ua[3],fa)):(ca=r.intersection(da,ka,N),ka=r.intersection(ua,ka,V),r.contains(ca,ka)&&(ua[2]=ua[0],ua[3]=ua[1]));ba=Math.abs(da[2]-da[0])/ba;ia.mapUnitsPerPixel=Math.max(ia.mapUnitsPerPixel,ba);ia.pixelRatioAdjustment=ia.mapUnitsPerPixel/ba}_drawOverlays(ca,ba){if(this.renderer.hasOverlays){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;var ia=this._drawTexturesDirty;this._drawTexturesDirty=
this._drawTexturesAnimateDirty=!1;var ka=this.renderer.computeValidity();this.renderer.releaseRenderTargets();this.renderer.drawOverlays(ba);ba=this.renderer.computeValidity();ka!==ba&&this.surface.updateTileOverlayParams(H.RenderRequestType.UPDATE);ia?(this.surface.requestRender(ca),ca===H.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(H.RenderRequestType.BACKGROUND);return this.renderer}}_rectanglesOverlap(ca,ba){return null==ca?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(ba[0],
ba[2],ca[0])||this._longitudeCyclical.contains(ba[0],ba[2],ca[2])||this._longitudeCyclical.contains(ca[0],ca[2],ba[0]))&&!(ca[1]>ba[3]||ca[3]<ba[1]):r.intersects(ca,ba)}_rectInsideRect(ca,ba){return null==ba?!1:this._longitudeCyclical?this._longitudeCyclical.contains(ca[0],ca[2],ba[0])&&this._longitudeCyclical.contains(ca[0],ca[2],ba[2])&&ba[1]>ca[1]&&ba[3]<ca[3]:r.contains(ca,ba)}_pointIsInExtent(ca,ba){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ba[0],ba[2],ca.x)&&ca.y>=ba[1]&&
ca.y<=ba[3];const ia=ca.x;ca=ca.y;return ia>ba[0]&&ia<ba[2]&&ca>ba[1]&&ca<ba[3]}_shiftExtentToFitBounds(ca,ba,ia){let ka=0,na=0;ca[0]<-ba?ka=ca[0]+ba:ca[2]>ba&&(ka=ba-ca[2]);ca[1]<-ia?na=ca[1]+ia:ca[3]>ia&&(na=ia-ca[3]);r.offset(ca,ka,na)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Q.noBudget)}}};b.__decorate([l.property()],a.OverlayManager.prototype,"_spatialReference",void 0);b.__decorate([l.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);b.__decorate([l.property()],
a.OverlayManager.prototype,"_placementDirty",void 0);b.__decorate([l.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);b.__decorate([l.property()],a.OverlayManager.prototype,"_isSpherical",null);b.__decorate([l.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);b.__decorate([l.property({autoDestroy:!0})],a.OverlayManager.prototype,"renderer",void 0);b.__decorate([l.property({constructOnly:!0})],a.OverlayManager.prototype,"view",void 0);b.__decorate([l.property({constructOnly:!0})],
a.OverlayManager.prototype,"surface",void 0);b.__decorate([l.property()],a.OverlayManager.prototype,"suspended",null);b.__decorate([l.property()],a.OverlayManager.prototype,"updating",null);b.__decorate([l.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=b.__decorate([h.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);class Z{constructor(){this.inner=r.create();this.outer=r.create();this.mapUnitsPerPixel=0;this.pixelRatioAdjustment=1;
this.stretch=1.3}}const P=q.create(),R=x.create(),W=new Z,N=r.create(),V=r.create(),S=y.create();var X;(function(ca){ca[ca.NONE=0]="NONE";ca[ca.EXTENT=1]="EXTENT";ca[ca.RERENDER_ONLY=2]="RERENDER_ONLY"})(X||(X={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){const b=globalThis.require?.modules;if(b){const g=Object.keys(b);for(const d of g)d.includes(".glsl")&&
delete b[d]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/vec3f64 ../../../geometry/SpatialReference ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./ITile ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),function(a,b,g,d,k,m,f,
c,l,e,p){class h extends e.Tile{constructor(w,x,n,q,t){super();this._horizontalScaleFactor=1;this._extentInRenderSR=m.create();this._baseUsedMemory=900;this.init(w,x,n,q,t)}init(w,x,n,q,t){super.init(w,x,n,q,t);w=t.view.renderSpatialReference;t=t.spatialReference;this._horizontalScaleFactor=x=null!=w&&f.isPlateCarree(w)&&null!=t&&t.isGeographic?this.ellipsoid.radius*Math.PI/180:1;t=this._extentInRenderSR;w=this.extent;if(this.surface.isWebMercatorOnPlateeCarree)x=b.fromValues(w[0],w[1],0),d.projectVectorToVector(x,
g.WebMercator,x,g.PlateCarree),w=b.fromValues(w[2],w[3],0),d.projectVectorToVector(w,g.WebMercator,w,g.PlateCarree),t[0]=x[0],t[1]=x[1],t[2]=w[0],t[3]=w[1];else for(n=0;4>n;++n)t[n]=w[n]*x;this.centerAtSeaLevel[0]=.5*(t[0]+t[2]);this.centerAtSeaLevel[1]=.5*(t[1]+t[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(t[2]-t[0],t[3]-t[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();var w=this._extentInRenderSR;const x=.5*(w[2]-
w[0]);w=.5*(w[3]-w[1]);this._center[e.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(x*x+w*w),.5*(this.elevationBounds[0]-this.elevationBounds[1]))}_calculateFrustumVisibilityStatus(w){var x=this._aabb();const n=x[0],q=x[1],t=x[2],v=x[3],r=x[4];x=x[5];let y=!0;for(let D=0;6>D;D++){var z=w[D];const C=z[0],E=z[1],A=z[2];z=z[3];if(0<=C*(0<C?n:v)+E*(0<E?q:r)+A*(0<A?t:x)+z)return c.TileFrustumVisibility.OUTSIDE;y=y&&0>=C*(0>C?n:v)+E*(0>E?q:r)+A*(0>A?t:x)+z}return y?c.TileFrustumVisibility.INSIDE:c.TileFrustumVisibility.INTERSECTS}_aabb(){const w=
this._extentInRenderSR;return k.wrap(w[0],w[1],this.elevationBounds[0],w[2],w[3],this.elevationBounds[1])}intersectsRay(w,x,n,q){u[0]=1/x[0];u[1]=1/x[1];u[2]=1/x[2];return p.intersectAabbInvDirBefore(this._aabb(),w,u,n,q)}createGeometry(){l.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor);this.setMemoryDirty()}getDefaultVerticesPerSide(){return 9>this.level?3:2}updateCornerElevations(){l.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){l.updateEdgesAndCornersPlanar(this.renderData,
this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}}const u=b.create();a.PlanarPatch=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./ITile ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils ../webgl-engine/lib/Normals".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(M){var T=M.tile;if(T.intersectsClippingArea){var Q=M.geometryState,O=Q.numVerticesPerSide,U=O-2;--O;var Z=M.geometry,P=Z.vertexAttributes,R=P.position,W=P.uv0,{typedBuffer:N,typedBufferStride:V}=P.normalCompressed,S=T.extent;P=S[0];var X=S[2],ca=S[1];S=S[3];T=T.ellipsoid.radius;Q=Q.samplerData;var ba=M.localOrigin;M=ba[0];var ia=ba[1];ba=ba[2];var ka=R.typedBuffer;R=R.typedBufferStride;var na=1/O;Z=Z.boundingBox;var Y=0;if(1<=U){var ea=ca*(1-na)+
S*na,fa=K.sinLatLUT[1],aa=K.cosLatLUT[1];for(var da=1;da<=U;da++){var ma=da*na,ua=K.sinLonLUT[da],sa=K.cosLonLUT[da],ra=T+m.sampleElevation(P*(1-ma)+X*ma,ea,Q);sa=-M+ra*sa*aa;ua=-ia+ra*ua*aa;ra=-ba+ra*fa;l.minMaxBoundingBox(sa,ua,ra,Z);var Aa=(da-1)*R;ka[Aa]=sa;ka[Aa+1]=ua;ka[Aa+2]=ra;l.encodeUVInBuffer(W,da-1,ma,na)}}for(ea=1;ea<=U;ea++){fa=ea*na;fa=ca*(1-fa)+S*fa;aa=K.sinLatLUT[ea];da=K.cosLatLUT[ea];ua=ea+1;ma=ua*na;sa=ca*(1-ma)+S*ma;ra=K.sinLatLUT[ua];ua=K.cosLatLUT[ua];var qa=K.sinLonLUT[0];
Aa=K.cosLonLUT[0];var la=T+m.sampleElevation(P,fa,Q);Aa=Aa*da*la-M;qa=qa*da*la-ia;la=aa*la-ba;var ja=Y*R;let cb=ka[ja],Na=ka[ja+1];ja=ka[ja+2];for(let xa=1;xa<=U;xa++){var oa=xa*na,za=P*(1-oa)+X*oa,ta=K.sinLonLUT[xa],Ca=K.cosLonLUT[xa],Ga=0,La=0,Ma=0;xa<U?(Ma=(Y+1)*R,Ga=ka[Ma],La=ka[Ma+1],Ma=ka[Ma+2]):(La=K.sinLonLUT[O],Ga=K.cosLonLUT[O],Ma=T+m.sampleElevation(X,fa,Q),Ga=Ga*da*Ma-M,La=La*da*Ma-ia,Ma=aa*Ma-ba);var Ra=Aa,Ya=qa,ab=la;Aa=cb;qa=Na;la=ja;cb=Ga;Na=La;ja=Ma;Ga-=Ra;La-=Ya;Ma-=ab;Ra=Ya=ab=
0;if(1<ea)Ra=(Y-U)*R,ab=ka[Ra],Ya=ka[Ra+1],Ra=ka[Ra+2];else{Ra=K.sinLatLUT[0];Ya=K.cosLatLUT[0];var Wa=T+m.sampleElevation(za,ca,Q);ab=Ca*Ya*Wa-M;Ya=ta*Ya*Wa-ia;Ra=Ra*Wa-ba}Wa=T+m.sampleElevation(za,sa,Q);const Da=Ca*ua*Wa-M;za=ta*ua*Wa-ia;Wa=ra*Wa-ba;if(ea<U){const Ka=Y+U,ha=Ka*R;ka[ha]=Da;ka[ha+1]=za;ka[ha+2]=Wa;l.minMaxBoundingBox(Da,za,Wa,Z);l.encodeUVInBuffer(W,Ka,oa,ma)}oa=ab-Da;za=Ya-za;ab=Ra-Wa;Ca*=da;ta*=da;Ya=aa;.999>Ya*Ya&&(Ca=Ma*za-La*ab,ta=Ga*ab-Ma*oa,Ya=La*oa-Ga*za);oa=1/Math.sqrt(Ca*
Ca+ta*ta+Ya*Ya);x.compressNormal(N,Y,Ca*oa,ta*oa,Ya*oa,V);++Y}}}}function q(M){M.tile.intersectsClippingArea&&(F(M),t(M))}function t(M,T=!1){var Q=M.geometryState;const O=M.geometry,U=Q.neighborData,Z=M.tile,P=Z.level,R=Z.extent,W=Z.ellipsoid.radius;var N=Z.extentInRadians;const V=N[0],S=N[2],X=N[1];N=N[3];const ca=Q.samplerData,ba=R[0],ia=R[2],ka=R[1],na=R[3],Y=v(M),ea=O.boundingBox;Q=M.localOrigin;const fa=Q[0],aa=Q[1],da=Q[2];Q=O.vertexAttributes;var ma=Q.position;const ua=ma.typedBuffer,sa=ma.typedBufferStride,
ra=Q.uv0;for(let la=0;4>la;++la){const ja=1===la||3===la;Q=U.edgeResolutions[la];h.internalAssert(b.isPowerOfTwo(Q));const oa=Q+1;var Aa=p.neighborTileIfLoadedOrSelf(Z,U.edgePeerNeighbors[la]);if(H(Z,Aa,la)){A(M,la,Aa);continue}const za=null!=Aa;h.internalAssert(!za||Aa.level===Z.level);h.internalAssert(!za||0>=w.compareTilesByLij(Z,Aa));ma=Aa?.renderData?.geometryState;if(h.enableTerrainInternalChecks){var qa=Z.surface;if(!Aa&&qa&&!qa.updatingRootTiles){const Ba=h.neighborEdgeIndices[la],Ja=Z.findNeighborTile(Ba,
Ta=>Ta.isLoaded||Ta.isLeaf||Ta.level===Z.level);Ja?Ja.intersectsClippingArea&&(h.internalAssert(!Ja.isLoaded),h.internalAssert(!Ja.isLeaf),h.internalAssert(Ja.level===P)):h.internalAssert(null==qa?.rootTiles||!Z.shouldHaveNeighbor(Ba))}}const ta=1===la?R[2]:R[0],Ca=(Aa=Aa?.extent)&&ja?1===la?Aa[0]:Aa[2]:ta,Ga=0===la?R[3]:R[1],La=1===la?1:0,Ma=0===la?1:0,Ra=1===la?S:V,Ya=0===la?N:X,ab=Math.sin(Ra),Wa=Math.cos(Ra),cb=Math.sin(Ya),Na=Math.cos(Ya),xa=ma?.samplerData;ma=(Ba,Ja,Ta)=>m.sampleElevation(Ba,
Ja,ca);qa=(Ba,Ja,Ta)=>.5*(m.sampleElevation(Ba,Ja,ca)+m.sampleElevation(Ta,Ja,xa));const Da=za?qa:ma,Ka=O.outerEdges[la],ha=T&&3<oa?oa-3:1;ma=null!=ca&&ca.some(Ba=>null!=Ba);qa=null!=xa&&xa.some(Ba=>null!=Ba);const Sa=ma||qa,Va=1/Q,wa=Ka.index0;h.internalAssert(!Aa||h.almostEquals(Aa[2]-Aa[0],R[2]-R[0]));(()=>{const Ba=1===la?-1:3===la?1:0,Ja=0===la?-1:2===la?1:0,Ta=(R[2]-R[0])*Va,db=Ba*Ta,lb=Ja*Ta,mb=S-V,ob=ja?Ba*mb*Va:0,pb=ja?0:Ja*Va,zb=Ma,rb=ja?Ra+ob:Ra,Jb=ja?Math.sin(rb):ab,fb=ja?Math.cos(rb):
Wa,Cb=ja?Ra-ob:Ra,Lb=ja?Math.sin(Cb):ab,Hb=ja?Math.cos(Cb):Wa,Mb=ja?Ya:Y(zb+pb),Ha=ja?cb:Math.sin(Mb),Oa=ja?Na:Math.cos(Mb),Za=ja?Ya:Y(zb-pb),ib=ja?cb:Math.sin(Za),jb=ja?Na:Math.cos(Za);let nb=0,vb=0,Kb=0;const gb=0*Va,va=ja?ta:ba*(1-gb)+ia*gb,Fa=ja?Ca:va,Pa=ja?ka*(1-gb)+na*gb:Ga,Qa=ja?Ra:V*(1-gb)+S*gb,$a=ja?ab:Math.sin(Qa),eb=ja?Wa:Math.cos(Qa),kb=ja?Y(gb):Ya,tb=ja?Math.sin(kb):cb,ub=ja?Math.cos(kb):Na,xb=W+Da(va,Pa,Fa);nb=eb*ub*xb;vb=$a*ub*xb;Kb=tb*xb;let yb=0,Fb=0,Sb=0;const Pb=1*Va,qb=ja?ta:ba*
(1-Pb)+ia*Pb,wb=ja?Ca:qb,Ab=ja?ka*(1-Pb)+na*Pb:Ga,Gb=ja?Ra:V*(1-Pb)+S*Pb,Ib=ja?ab:Math.sin(Gb),Ub=ja?Wa:Math.cos(Gb),Vb=ja?Y(Pb):Ya,$b=ja?Math.sin(Vb):cb,ac=ja?Math.cos(Vb):Na,kc=W+Da(qb,Ab,wb);yb=Ub*ac*kc;Fb=Ib*ac*kc;Sb=$b*kc;for(let Yb=1;Yb<oa-1;Yb+=ha){let lc=0,ec=0,Zb=0;const bc=(Yb+1)*Va,mc=ja?ta:ba*(1-bc)+ia*bc,Tb=ja?Ca:mc,tc=ja?ka*(1-bc)+na*bc:Ga,Qb=ja?Ra:V*(1-bc)+S*bc,cc=ja?ab:Math.sin(Qb),hd=ja?Wa:Math.cos(Qb),$c=ja?Y(bc):Ya,id=ja?Math.sin($c):cb,ad=ja?Math.cos($c):Na,jd=W+Da(mc,tc,Tb);lc=
hd*ad*jd;ec=cc*ad*jd;Zb=id*jd;const Nd=lc,Od=ec,kd=Zb,ld=yb,md=Fb,bd=Sb;yb=Nd;Fb=Od;Sb=kd;const Pd=wa+Yb,cd=Pd*sa,Qd=ld-fa,Rd=md-aa,Sd=bd-da;ua[cd]=Qd;ua[cd+1]=Rd;ua[cd+2]=Sd;l.minMaxBoundingBox(Qd,Rd,Sd,ea);const Td=Yb*Va;l.encodeUVInBuffer(ra,Pd,ja?La:Td,ja?Td:Ma);const Ud=nb,Ie=vb,Vd=Kb;nb=ld;vb=md;Kb=bd;const Dc=ld,Ec=md,Bc=bd,dd=1/Math.sqrt(Dc*Dc+Ec*Ec+Bc*Bc),Wd=Bc*dd;let Cc=0,oc=0,pc=0;if(Sa&&.999>Wd*Wd){let nd=0,od=0,pd=0;const qd=0===la?-1:1;nd=qd*(Nd-Ud);od=qd*(Od-Ie);pd=qd*(kd-Vd);const uc=
Yb*Va,rd=ja?ta:ba*(1-uc)+ia*uc,Je=ja?Ca:rd,Xd=ja?ka*(1-uc)+na*uc:Ga,sd=ja?Ra:V*(1-uc)+S*uc,Yd=ja?ab:Math.sin(sd),td=ja?Wa:Math.cos(sd),ud=ja?Y(uc):Ya,Zd=ja?Math.sin(ud):cb,$d=ja?Math.cos(ud):Na;let vd=Dc,wd=Ec,xd=Bc;if(za){const yd=W+m.sampleElevation(Je-db,Xd-lb,xa),Ke=ja?Lb:Yd,Le=ja?Zd:ib,ae=ja?$d:jb;vd=(ja?Hb:td)*ae*yd;wd=Ke*ae*yd;xd=Le*yd}const zd=W+m.sampleElevation(rd+db,Xd+lb,ca),be=ja?$d:Oa,ce=(ja?fb:td)*be*zd,de=(ja?Jb:Yd)*be*zd,ee=(ja?Zd:Ha)*zd;za||(vd=2*Dc-ce,wd=2*Ec-de,xd=2*Bc-ee);const Ad=
3===la?-1:1,fe=Ad*(vd-ce),ge=Ad*(wd-de),he=Ad*(xd-ee);Cc=pd*ge-od*he;oc=nd*he-pd*fe;pc=od*fe-nd*ge;const Bd=1/Math.sqrt(Cc*Cc+oc*oc+pc*pc);Cc*=Bd;oc*=Bd;pc*=Bd}else Cc=Dc*dd,oc=Ec*dd,pc=Bc*dd;Ka.setNormalFromValues(Yb,Cc,oc,pc)}})()}}function v(M){M=M.tile;if(M.surface.isWebMercator){const Q=M.extent,O=M.ellipsoid.radius;return U=>Math.PI/2-2*Math.atan(Math.exp(-(Q[1]*(1-U)+Q[3]*U)/O))}const T=M.extentInRadians;return Q=>T[1]*(1-Q)+T[3]*Q}function r(M){const T=M.tile;if(T.intersectsClippingArea){var Q=
M.geometryState,O=Q.samplerData,U=M.localOrigin,Z=T.surface.isWebMercatorOnPlateeCarree,P=Q.clippingArea,R=null!=P?P:L,W=T.extent,N=W[0],V=W[1],S=W[2],X=W[3],ca=Math.max(N,R[0]),ba=Math.min(S,R[2]),ia=Math.max(V,R[1]),ka=Math.min(X,R[3]),na=T.ellipsoid.radius,Y=T.horizontalScale,ea=Q.numVerticesPerSide,fa=ea-1,aa=ea-2,da=M.geometry,ma=da.vertexAttributes,ua=ma.position,sa=ma.uv0,{typedBuffer:ra,typedBufferStride:Aa}=ma.normalCompressed,qa=da.uvRange,la=qa[0],ja=qa[1],oa=qa[2],za=qa[3],ta=da.boundingBox,
Ca=U[0],Ga=U[1],La=U[2],Ma=ua.typedBuffer,Ra=ua.typedBufferStride,Ya=0,ab=b.clamp(V,ia,ka),Wa=Z?(Math.PI/2-2*Math.atan(Math.exp(-ab/na)))*na:ab*Y,cb=1/fa,Na=b.clamp(V*(1-cb)+X*cb,ia,ka),xa=Wa,Da=Z?(Math.PI/2-2*Math.atan(Math.exp(-Na/na)))*na:Na*Y;for(let Ka=1;Ka<=aa;Ka++){const ha=Ka/fa,Sa=b.clamp(V*(1-ha)+X*ha,ia,ka),Va=b.clamp(ha,ja,za),wa=Da,Ba=(Ka-1)/fa,Ja=b.clamp(V*(1-Ba)+X*Ba,ia,ka),Ta=xa,db=(Ka+1)/fa,lb=b.clamp(V*(1-db)+X*db,ia,ka),mb=Z?(Math.PI/2-2*Math.atan(Math.exp(-lb/na)))*na:lb*Y,ob=
b.clamp(db,ja,za);xa=Da;Da=mb;const pb=b.clamp(N,ca,ba);let zb=pb*Y,rb=m.sampleElevation(pb,Sa,O);const Jb=1/fa,fb=b.clamp(Jb,la,oa),Cb=b.clamp(N*(1-fb)+S*fb,ca,ba);let Lb=fb,Hb=Cb,Mb=Cb*Y,Ha=m.sampleElevation(Cb,Sa,O);if(1===Ka){const Oa=Mb-Ca,Za=xa-Ga,ib=Ha-La,jb=0*Ra;Ma[jb]=Oa;Ma[jb+1]=Za;Ma[jb+2]=ib;l.minMaxBoundingBox(Oa,Za,ib,ta);const nb=b.clamp(Jb,la,oa);l.encodeUVInBuffer(sa,Ya,nb,Va)}for(let Oa=1;Oa<=aa;Oa++){const Za=Mb,ib=Ha,jb=(Oa+1)/fa,nb=b.clamp(jb,la,oa),vb=b.clamp(N*(1-jb)+S*jb,ca,
ba),Kb=Hb;Hb=vb;const gb=Ya+1,va=gb*Ra;if(1===Ka||Oa===aa){const qb=m.sampleElevation(vb,Sa,O),wb=vb*Y,Ab=wa,Gb=qb;if(1===Ka&&Oa<aa){const Ib=wb-Ca,Ub=Ab-Ga,Vb=Gb-La;Ma[va]=Ib;Ma[va+1]=Ub;Ma[va+2]=Vb;l.minMaxBoundingBox(Ib,Ub,Vb,ta);l.encodeUVInBuffer(sa,gb,nb,Va)}Mb=wb;Ha=Gb}else Mb=Ma[va]+Ca,Ha=Ma[va+2]+La;const Fa=Mb,Pa=Ha,Qa=zb,$a=rb;zb=Za;rb=ib;const eb=(Ya-aa)*Ra,kb=1===Ka?m.sampleElevation(Kb,Ja,O):Ma[eb+2]+La,tb=m.sampleElevation(Kb,lb,O);if(Ka<aa){const qb=Ya+aa,wb=qb*Ra,Ab=Za-Ca,Gb=mb-Ga,
Ib=tb-La;Ma[wb]=Ab;Ma[wb+1]=Gb;Ma[wb+2]=Ib;l.minMaxBoundingBox(Ab,Gb,Ib,ta);const Ub=Lb;Lb=nb;l.encodeUVInBuffer(sa,qb,Ub,ob)}const ub=Fa-Qa,xb=Ta-mb,yb=xb*(Pa-$a),Fb=ub*(kb-tb),Sb=-xb*ub,Pb=yb*yb+Fb*Fb+Sb*Sb;if(0===Pb)x.compressNormal(ra,Ya,0,0,1,Aa);else{const qb=1/Math.sqrt(Pb);x.compressNormal(ra,Ya,yb*qb,Fb*qb,Sb*qb,Aa)}++Ya}}}}function y(M,T){M.tile.intersectsClippingArea&&(F(M),z(M,!1))}function z(M,T){const Q=M.geometryState,O=Q.neighborData,U=M.tile,Z=U.surface,P=U.extent,R=Q.clippingArea,
W=null!=R?R:L,N=P[0],V=P[2],S=P[1],X=P[3],ca=[X>W[3],V>W[2],S<W[1],N<W[0]],ba=M.geometry,ia=U.horizontalScale,ka=D(Z.isWebMercatorOnPlateeCarree,U.ellipsoid.radius,ia),na=ba.boundingBox,Y=ba.uvRange[0],ea=ba.uvRange[1],fa=ba.uvRange[2],aa=ba.uvRange[3],da=Math.max(N,W[0]),ma=Math.min(V,W[2]),ua=Math.max(S,W[1]),sa=Math.min(X,W[3]),ra=M.localOrigin,Aa=ra[0],qa=ra[1],la=ra[2],ja=Q.samplerData;for(let oa=0;4>oa;++oa){const za=1===oa||3===oa,ta=O.edgeResolutions[oa];h.internalAssert(b.isPowerOfTwo(ta));
const Ca=ta+1,Ga=ca[oa],La=p.neighborTileIfLoadedOrSelf(U,O.edgePeerNeighbors[oa]);if(!Ga&&H(U,La,oa)){A(M,oa,La);continue}const Ma=null!=La&&!Ga,Ra=La?.renderData?.geometryState;if(h.enableTerrainInternalChecks&&(h.internalAssert(!Ma||La.level===U.level),h.internalAssert(!Ma||0>=w.compareTilesByLij(U,La)),U&&!La&&!Z.updatingRootTiles)){const jb=h.neighborEdgeIndices[oa],nb=U.findNeighborTile(jb,vb=>vb.isLoaded||vb.isLeaf||vb.level===U.level);Z.updatingRootTiles||(nb?nb.intersectsClippingArea&&(h.internalAssert(!nb.isLoaded),
h.internalAssert(!nb.isLeaf),h.internalAssert(nb.level===U.level)):h.internalAssert(null==Z?.rootTiles||!U.shouldHaveNeighbor(jb)))}const Ya=b.clamp(1===oa?V:N,da,ma),ab=b.clamp(0===oa?X:S,ua,sa),Wa=Ra?.samplerData,cb=ba.outerEdges[oa],Na=T&&3<Ca?Ca-3:1,xa=b.clamp(1===oa?1:0,Y,fa),Da=b.clamp(0===oa?1:0,ea,aa),Ka=(jb,nb)=>m.sampleElevation(jb,nb,ja),ha=(jb,nb)=>.5*(m.sampleElevation(jb,nb,Wa)+m.sampleElevation(jb,nb,ja)),Sa=Ma?ha:Ka,Va=(V-N)/ta,wa=za?1===oa?Va:-Va:0,Ba=za?0:0===oa?Va:-Va,Ja=-wa,Ta=
-Ba;let db=0,lb=0,mb=0;const ob=0/ta,pb=za?Ya:b.clamp(N*(1-ob)+V*ob,da,ma),zb=za?b.clamp(S*(1-ob)+X*ob,ua,sa):ab,rb=Sa(pb,zb);db=pb*ia;lb=ka(zb);mb=rb;let Jb=0,fb=0,Cb=0;const Lb=1/ta,Hb=za?Ya:b.clamp(N*(1-Lb)+V*Lb,da,ma),Mb=za?b.clamp(S*(1-Lb)+X*Lb,ua,sa):ab,Ha=Sa(Hb,Mb),Oa=Hb*ia,Za=ka(Mb),ib=Ha;Jb=Oa;fb=Za;Cb=ib;for(let jb=1;jb<Ca-1;jb+=Na){const nb=jb/ta,vb=Jb,Kb=fb,gb=Cb,va=za?xa:b.clamp(nb,Y,fa),Fa=za?b.clamp(nb,ea,aa):Da,Pa=vb-Aa,Qa=Kb-qa,$a=gb-la;l.minMaxBoundingBox(vb,Qa,$a,na);cb.setVertexFromValuesRawPositionUV(jb,
Pa,Qa,$a,va,Fa);const eb=(jb+1)/ta,kb=za?Ya:b.clamp(N*(1-eb)+V*eb,da,ma),tb=za?b.clamp(S*(1-eb)+X*eb,ua,sa):ab,ub=Sa(kb,tb);Jb=kb*ia;fb=ka(tb);Cb=ub;const xb=Jb,yb=fb,Fb=Cb,Sb=db,Pb=lb,qb=mb;db=vb;lb=Kb;mb=gb;let wb=0,Ab=0,Gb=0;if(za){const Ub=yb-Kb,Vb=Fb-gb,$b=Pb-Kb,ac=qb-gb,kc=b.clamp(S*(1-nb)+X*nb,ua,sa),Yb=Ya+Ja,lc=Yb*ia,ec=m.sampleElevation(Yb,kc,ja),Zb=lc-vb,bc=ec-gb,mc=3===oa?-1:1;wb=mc*(-$b+Ub)*bc;Ab=mc*Zb*(-ac+Vb);Gb=-mc*Zb*(-$b+Ub);if(Ma){const Tb=Ya+wa,tc=Tb*ia,Qb=m.sampleElevation(Tb,
kc,Wa),cc=tc-vb;wb=(-$b+Ub)*(bc-(Qb-gb));Ab=(Zb-cc)*(-ac+Vb);Gb=-(Zb-cc)*(-$b+Ub)}}else{const Ub=xb-vb,Vb=Fb-gb,$b=Sb-vb,ac=qb-gb,kc=b.clamp(N*(1-nb)+V*nb,da,ma),Yb=ab+Ta,lc=m.sampleElevation(kc,Yb,ja)-gb,ec=ka(Yb)-Kb,Zb=2===oa?-1:1;wb=Zb*ec*(-ac+Vb);Ab=Zb*(-$b+Ub)*lc;Gb=-Zb*ec*(-$b+Ub);if(Ma){const bc=kc,mc=ab+Ba,Tb=ka(mc),tc=m.sampleElevation(bc,mc,Wa)-gb,Qb=Tb-Kb;wb=(-ec+Qb)*(-ac+Vb);Ab=(-$b+Ub)*(-lc+tc);Gb=-(-ec+Qb)*(-$b+Ub)}}const Ib=1/Math.sqrt(wb*wb+Ab*Ab+Gb*Gb);cb.setNormalFromValues(jb,wb*
Ib,Ab*Ib,Gb*Ib)}}}function D(M,T,Q){return M?O=>(Math.PI/2-2*Math.atan(Math.exp(-O/T)))*T:O=>O*Q}function C(M,T,Q,O,U,Z){const P=T-1,R=M.vertexAttributes.count,W=2*(Math.min(T-2,O[1])-Math.max(1,O[0]))*(Math.min(T-2,U[1])-Math.max(1,U[0])),N=h.neighborEdgeIndices.map((ea,fa)=>0===fa&&U[1]<T-2||1===fa&&O[1]<T-2||2===fa&&1<U[0]||3===fa&&1<O[0]),V=M.outerEdges.reduce((ea,fa,aa)=>ea+(N[aa]?0:P-2+fa.count-1),0),S=Q.reduce((ea,fa)=>ea+P*(2*(fa.latitudeResolution-1)+1),0),X=Z?2:1,ca=3*(W+V+S)*X,ba=65536<=
R?new Uint32Array(ca):new Uint16Array(ca);let ia=0;const ka=T-2,na=P-2;h.internalAssert(0<=na);const Y=(ea,fa,aa,da,ma,ua)=>{var sa=ea*ma;ea=ua[sa];const ra=ua[sa+1];sa=ua[sa+2];var Aa=fa*ma;fa=ua[Aa];const qa=ua[Aa+1];Aa=ua[Aa+2];var la=aa*ma;aa=ua[la];const ja=ua[la+1];la=ua[la+2];const oa=da*ma;da=ua[oa];ma=ua[oa+1];ua=ua[oa+2];return(fa-da)*(fa-da)+(qa-ma)*(qa-ma)+(Aa-ua)*(Aa-ua)>(ea-aa)*(ea-aa)+(ra-ja)*(ra-ja)+(sa-la)*(sa-la)};if(Z){const ea=(fa,aa,da)=>{ba[ia++]=fa;ba[ia++]=aa;ba[ia++]=aa;ba[ia++]=
da;ba[ia++]=da;ba[ia++]=fa;h.enableTerrainInternalChecks&&(h.internalAssert(fa<R),h.internalAssert(aa<R),h.internalAssert(da<R),h.internalAssert(ia<=ca))};(()=>{for(let fa=Math.max(U[0],1)-1;fa<Math.min(U[1],T-2)-1;++fa){const aa=fa*ka;for(let da=Math.max(O[0],1)-1;da<Math.min(O[1],T-2)-1;++da){const ma=fa*ka+da,ua=ma+1,sa=ua+ka,ra=sa-1,Aa=aa+da,qa=Aa+1,la=qa+ka;Y(Aa,qa,la,la-1,M.vertexAttributes.position.typedBufferStride,M.vertexAttributes.position.typedBuffer)?(ea(ma,ua,sa),ea(sa,ra,ma)):(ea(ma,
ua,ra),ea(ra,sa,ua))}}})();h.internalAssert(ia===3*W*X);(()=>{for(let aa=0;4>aa;++aa){const da=ia;if(N[aa])continue;const ma=M.outerEdges[aa],ua=M.innerEdges[aa];let sa=0,ra=0;const Aa=ma.count,qa=ua.count;h.internalAssert(qa===P-1);let la=0;const ja=1===aa||2===aa?(oa,za,ta)=>ea(oa,za,ta):(oa,za,ta)=>ea(oa,ta,za);for(;sa<Aa-1||ra<qa-1;){const oa=ua.getVertexIndex(ra),za=ma.getVertexIndex(sa);var fa=sa<Aa-1;const ta=ra<qa-1,Ca=fa?P*(sa+.5)/(Aa-1):0,Ga=ta?1+na*(ra+.5)/(qa-1):0;fa&&(!ta||Ca<=Ga)?(++sa,
h.enableTerrainInternalChecks&&h.internalAssert(sa<Aa),fa=ma.getVertexIndex(sa),ja(oa,za,fa)):(++ra,h.enableTerrainInternalChecks&&h.internalAssert(ra<qa),fa=ua.getVertexIndex(ra),ja(oa,za,fa));la++}h.enableTerrainInternalChecks&&(h.internalAssert(sa===Aa-1),h.internalAssert(ra===qa-1),h.internalAssert(la===Aa+qa-2),h.internalAssert(la===P-2+ma.count-1),h.internalAssert(ia===da+3*la*X))}})();h.internalAssert(ia===3*(W+V)*X);Q.forEach(fa=>{var aa=M.outerEdges[fa.connectedOuterEdgeOffset];let da=aa.getVertexIndex(0);
aa=aa.stride;for(let ma=0;ma<fa.latitudeResolution;++ma){const ua=0===ma?fa.rowOffset:da+T;for(let sa=0;sa<P;sa++)ea(da,da+1,ua+sa),ma<fa.latitudeResolution-1&&ea(da+1,ua+sa+1,ua+sa),da+=aa;da=ua;aa=1}})}else(()=>{var ea=Math.max(U[0],1)-1;const fa=Math.min(U[1],T-2)-1,aa=Math.max(O[0],1)-1,da=Math.min(O[1],T-2)-1;for(;ea<fa;++ea){const ma=ea*ka;for(let ua=aa;ua<da;++ua){const sa=ma+ua,ra=sa+1,Aa=ra+ka,qa=Aa-1;Y(sa,ra,Aa,qa,M.vertexAttributes.position.typedBufferStride,M.vertexAttributes.position.typedBuffer)?
(ba[ia]=sa,ba[ia+1]=ra,ba[ia+2]=Aa,ba[ia+3]=Aa,ba[ia+4]=qa,ba[ia+5]=sa):(ba[ia]=sa,ba[ia+1]=ra,ba[ia+2]=qa,ba[ia+3]=qa,ba[ia+4]=ra,ba[ia+5]=Aa);ia+=6}}})(),h.internalAssert(ia===3*W*X),(()=>{for(let ma=0;4>ma;++ma){if(N[ma])continue;var ea=M.outerEdges[ma],fa=M.innerEdges[ma];let ua=0,sa=0;const ra=ea.count,Aa=fa.count;h.internalAssert(Aa===P-1);var aa=1===ma||2===ma;const qa=aa?1:2;aa=aa?2:1;const la=ea.index0;ea=ea.stride;const ja=fa.index0;for(fa=fa.stride;ua<ra-1||sa<Aa-1;){const oa=ja+sa*fa,
za=la+ua*ea;var da=ua<ra-1;const ta=sa<Aa-1,Ca=da?P*(ua+.5)/(ra-1):0,Ga=ta?1+na*(sa+.5)/(Aa-1):0;(da=da&&(!ta||Ca<=Ga))?++ua:++sa;da=da?za+ea:oa+fa;ba[ia]=oa;ba[ia+qa]=za;ba[ia+aa]=da;ia+=3}}})(),h.internalAssert(ia===3*(W+V)*X),Q.forEach(ea=>{var fa=M.outerEdges[ea.connectedOuterEdgeOffset];let aa=fa.getVertexIndex(0);fa=fa.stride;for(let da=0;da<ea.latitudeResolution;++da){const ma=0===da?ea.rowOffset:aa+T;for(let ua=0;ua<P;ua++){const sa=ma+ua;ba[ia]=aa;ba[ia+1]=aa+1;ba[ia+2]=sa;da<ea.latitudeResolution-
1?(ba[ia+3]=aa+1,ba[ia+4]=sa+1,ba[ia+5]=sa,ia+=6):ia+=3;aa+=fa}aa=ma;fa=1}});h.internalAssert(ia===ca);M.indices=ba;M.indexCount=ca}function E(M,T){const Q=M.localOrigin,O=M.geometry;M=M.geometryState.neighborData.edgeResolutions;const U=O.numVerticesPerSide-2,Z=O.vertexAttributes;for(let R=0;4>R;++R){var P=0===R||2===R;O.innerEdges[R]=new l.EdgeDescriptor(Z,Q,(0===R?U-1:0)*U+(1===R?U-1:0),(P?0:1)*U+(P?1:0),U);P=M[R]+1;O.outerEdges[R]=new l.EdgeDescriptor(Z,Q,T,1,P);T+=P}}function A(M,T,Q){var O=
(T+2)%4,U=M.tile,Z=U.level-Q.level;const P=1===T||3===T,R=M.geometryState.neighborData.edgeResolutions[T];h.internalAssert(b.isPowerOfTwo(R));const W=R+1;var N=M.geometry;const V=N.boundingBox;var S=N.outerEdges[T];const X=N.uvRange[0],ca=N.uvRange[1],ba=N.uvRange[2];N=N.uvRange[3];const ia=b.clamp(1===T?1:0,X,ba),ka=b.clamp(0===T?1:0,ca,N);var na=Q.renderData,Y=na.geometryState,ea=na.geometry.outerEdges[O];T=U.getNeighborEdgeStartVertexIndex(T,Q)*R;Z=R*2**Z;h.internalAssert(Y.neighborData.edgeResolutions[O]===
Z);h.internalAssert(ea.count-1===Z);O=na.localOrigin[0]-M.localOrigin[0];Z=na.localOrigin[1]-M.localOrigin[1];M=na.localOrigin[2]-M.localOrigin[2];var fa=S.attributes;na=S.index0;S=S.stride;Y=fa.position.typedBuffer;Q=fa.position.typedBufferStride;U=fa.normalCompressed.typedBuffer;const aa=fa.normalCompressed.typedBufferStride;fa=fa.uv0;var da=ea.attributes;const ma=ea.index0;ea=ea.stride;const ua=da.position.typedBuffer,sa=da.position.typedBufferStride,ra=da.normalCompressed.typedBuffer;da=da.normalCompressed.typedBufferStride;
for(let ja=1;ja<W-1;++ja){const oa=na+S*ja;var Aa=ma+ea*(T+ja),qa=oa*Q,la=Aa*sa;const za=ua[la]+O,ta=ua[la+1]+Z;la=ua[la+2]+M;Y[qa]=za;Y[qa+1]=ta;Y[qa+2]=la;l.minMaxBoundingBox(za,ta,la,V);qa=oa*aa;Aa*=da;U[qa]=ra[Aa];U[qa+1]=ra[Aa+1];qa=ja/R;Aa=P?ia:b.clamp(qa,X,ba);qa=P?b.clamp(qa,ca,N):ka;l.encodeUVInBuffer(fa,oa,Aa,qa)}}function F(M){const T=M.geometryState,Q=M.localOrigin,O=T.neighborData.cornerNeighborData,U=M.geometry,Z=U.outerEdges,P=U.boundingBox,R=M.tile,W="local"===M.tile.surface.view?.viewingMode,
N=R.ellipsoid.radius,V=R.extentInRadians,S=R.horizontalScale;let X=0,ca=0,ba=0;const ia=()=>{const Da=M.geometryState.clippingArea,Ka=R.extent,ha=null!=Da&&(Ka[3]>Da[3]||Ka[2]>Da[2]||Ka[1]<Da[1]||Ka[0]<Da[0]),Sa=D(R.surface.isWebMercatorOnPlateeCarree,R.ellipsoid.radius,S);return(Va,wa,Ba)=>{Va=0===Va?la[0]:la[2];wa=0===wa?la[1]:la[3];Va=ha?b.clamp(Va,Da[0],Da[2]):Va;wa=ha?b.clamp(wa,Da[1],Da[3]):wa;X=Va*S;ca=Sa(wa);ba=Ba}},ka=(Da,Ka,ha)=>{var Sa=V[0===Ka?1:3];Da=V[0===Da?0:2];Ka=Math.cos(Sa);Sa=
Math.sin(Sa);const Va=Math.sin(Da);ha=N+ha;X=Math.cos(Da)*Ka*ha;ca=Va*Ka*ha;ba=Sa*ha},na=W?ia():ka;let Y=0,ea=0,fa=0,aa=0,da=0,ma=0,ua=0,sa=0,ra=0;const Aa=W&&M.tile.surface.isWebMercatorOnPlateeCarree,qa=(Da,Ka,ha,Sa,Va)=>{var wa=0,Ba=0;let Ja=0;W?(ha=Aa?(Math.PI/2-2*Math.atan(Math.exp(-ha/N)))*N:ha*S,wa=Ka*S-X,Ba=ha-ca,Ja=Sa-ba):(wa=v(Da),Da=Da.tile,Ba=Da.extent,Da=Da.extentInRadians,Ka=(Ka-Ba[0])/(Ba[2]-Ba[0]),Ka=Da[0]*(1-Ka)+Da[2]*Ka,wa=wa((ha-Ba[1])/(Ba[3]-Ba[1])),ha=Math.cos(wa),Da=Math.sin(wa),
Ba=Math.sin(Ka),Sa=N+Sa,wa=Math.cos(Ka)*ha*Sa-X,Ba=Ba*ha*Sa-ca,Ja=Da*Sa-ba);switch(Va){case 0:ua+=wa;sa+=Ba;ra+=Ja;break;case 1:aa-=wa;da-=Ba;ma-=Ja;break;case 2:ua-=wa;sa-=Ba;ra-=Ja;break;case 3:aa+=wa,da+=Ba,ma+=Ja}},la=R.extent,ja=T.clippingArea??L,oa=la[0],za=la[2],ta=la[1],Ca=la[3],Ga=[Ca>ja[3],za>ja[2],ta<ja[1],oa<ja[0]],La=Math.max(oa,ja[0]),Ma=Math.min(za,ja[2]),Ra=Math.max(ta,ja[1]),Ya=Math.min(Ca,ja[3]),ab=U.uvRange[0],Wa=U.uvRange[1],cb=U.uvRange[2],Na=U.uvRange[3],xa=Da=>{Da=O[Da].cornerTiles;
ea=Y=0;fa=1;ra=sa=ua=ma=da=aa=0;var Ka=Infinity;for(var ha=0;4>ha;++ha)Ka=Math.min(Ka,Da[ha]?.level??Infinity);for(ha=0;4>ha;++ha){var Sa=Da[ha];J[ha]=Sa?.level===Ka?Sa:null}Da=1;Ka=0;for(ha=0;4>ha;++ha)if(Sa=J[ha])Da=Math.max(Da,Sa?.renderData.geometryState.numVerticesPerSide),Ka=Sa.extent[2]-Sa.extent[0];h.internalAssert(1<Da);Da=Ka/Da;for(Ka=0;4>Ka;++Ka){var Va=J[(Ka+3)%4],wa=J[Ka%4];if(Va||wa){Sa=0===Ka?1:1===Ka?2:2===Ka?3:0;var Ba=0===Ka?2:1===Ka?3:2===Ka?0:1;if(Va&&wa){var Ja=B[Ka][0]*Da,Ta=
B[Ka][1]*Da,db=Va.extent;ha=Math.max(ja[0],Math.min(ja[2],db[0===Sa||1===Sa?2:0]+Ja));Sa=Math.max(ja[1],Math.min(ja[3],db[0===Sa||3===Sa?3:1]+Ta));db=wa.extent;Ja=Math.max(ja[0],Math.min(ja[2],db[0===Ba||1===Ba?2:0]+Ja));Ba=Math.max(ja[1],Math.min(ja[3],db[0===Ba||3===Ba?3:1]+Ta));Va=Va.renderData;Ta=wa.renderData;wa=m.sampleElevation(ha,Sa,Va.geometryState.samplerData);Ba=m.sampleElevation(Ja,Ba,Ta.geometryState.samplerData);qa(Va,ha,Sa,.5*(wa+Ba),Ka)}else ha=Va??wa,Va=Va?Sa:Ba,wa=ha.extent,Ba=B[Ka],
Sa=Math.max(ja[0],Math.min(ja[2],wa[0===Va||1===Va?2:0]+Ba[0]*Da)),Va=Math.max(ja[1],Math.min(ja[3],wa[0===Va||3===Va?3:1]+Ba[1]*Da)),ha=ha.renderData,wa=m.sampleElevation(Sa,Va,ha.geometryState.samplerData),qa(ha,Sa,Va,wa,Ka)}}W||(Da=Math.sqrt(X*X+ca*ca+ba*ba),Y=X/Da,ea=ca/Da,fa=ba/Da);if(W||.999>fa*fa)Da=Math.sqrt(aa*aa+da*da+ma*ma),aa/=Da,da/=Da,ma/=Da,Da=Math.sqrt(ua*ua+sa*sa+ra*ra),ua/=Da,sa/=Da,ra/=Da,Y=ma*sa-da*ra,ea=aa*ra-ma*ua,fa=da*ua-aa*sa,Da=1/Math.sqrt(Y*Y+ea*ea+fa*fa),Y*=Da,ea*=Da,fa*=
Da};for(let Da=0;4>Da;++Da){const Ka=Da,ha=(Da+1)%4,Sa=0===Da||1===Da?1:0,Va=0===Da||3===Da?1:0,wa=b.clamp(Sa,ab,cb),Ba=b.clamp(Va,Wa,Na),Ja=Z[Ka],Ta=0===Da||3===Da?Ja.count-1:0,db=Z[ha],lb=0===Da||1===Da?db.count-1:0,mb=O[Da].cornerTiles;let ob=-1;for(let rb=0;4>rb;++rb){const Jb=mb[rb];Jb&&(-1===ob||0<w.compareTilesByLij(mb[ob],Jb))&&(ob=rb)}const pb=ob,zb=mb[pb];if(zb!==R){const rb=R.level-zb.level,Jb=2**rb,fb=[zb.lij[0]+rb,zb.lij[1]*Jb,zb.lij[2]*Jb],Cb=[fb[1]+Jb===R.lij[1],0===Da&&(1===pb||0===
pb&&zb!==mb[3])||1===Da&&(0===pb||1===pb&&zb!==mb[2]),fb[1]===R.lij[1]+1,2===Da&&(3===pb||2===pb&&zb!==mb[1])||3===Da&&(2===pb||3===pb&&zb!==mb[0])],Lb=Cb.reduce((Ib,Ub)=>Ib+(Ub?1:0),0);h.internalAssert(1===Lb||2===Lb);let Hb=-1,Mb=-1;const Ha=zb.renderData;if(1===Lb){const Ib=Cb.findIndex(Vb=>Vb);h.internalAssert(0<=Ib&&3>=Ib);Hb=(Ib+2)%4;const Ub=M.geometryState.neighborData.edgeResolutions[Ib];Mb=R.getNeighborEdgeStartVertexIndex(Ib,zb)*Ub+Ub*(0===Ib&&0===Da||1===Ib&&0===Da||2===Ib&&1===Da||3===
Ib&&3===Da?1:0)}else{h.internalAssert(Cb[1]||Cb[3]);Hb=Cb[1]?3:1;const Ib=Ha.geometryState.neighborData.edgeResolutions[Hb];Mb=0===Da||3===Da?0:Ib}const Oa=Ha.geometry.outerEdges[Hb],Za=Ja.index0+Ta*Ja.stride,ib=db.index0+lb*db.stride,jb=Oa.index0+Mb*Oa.stride,nb=Oa.attributes.position,vb=nb.typedBuffer,Kb=jb*nb.typedBufferStride,gb=M.localOrigin,va=Oa.localOrigin,Fa=vb[Kb]+va[0]-gb[0],Pa=vb[Kb+1]+va[1]-gb[1],Qa=vb[Kb+2]+va[2]-gb[2];l.minMaxBoundingBox(Fa,Pa,Qa,P);const $a=Ja.attributes.position,
eb=$a.typedBuffer,kb=Za*$a.typedBufferStride;eb[kb]=Fa;eb[kb+1]=Pa;eb[kb+2]=Qa;const tb=db.attributes.position,ub=tb.typedBuffer,xb=ib*tb.typedBufferStride;ub[xb]=Fa;ub[xb+1]=Pa;ub[xb+2]=Qa;l.encodeUVInBuffer(Ja.attributes.uv0,Za,wa,Ba);l.encodeUVInBuffer(db.attributes.uv0,ib,wa,Ba);const yb=Oa.attributes.normalCompressed.typedBuffer,Fb=jb*Oa.attributes.normalCompressed.typedBufferStride,Sb=Ja.attributes.normalCompressed,Pb=Sb.typedBuffer,qb=Za*Sb.typedBufferStride;Pb[qb]=yb[Fb];Pb[qb+1]=yb[Fb+1];
const wb=db.attributes.normalCompressed,Ab=wb.typedBuffer,Gb=ib*wb.typedBufferStride;Ab[Gb]=yb[Fb];Ab[Gb+1]=yb[Fb+1]}else{const rb=Ga[ha];let Jb=void 0;if(Ga[Ka]||rb){const Hb=b.clamp(oa*(1-Sa)+za*Sa,La,Ma),Mb=b.clamp(ta*(1-Va)+Ca*Va,Ra,Ya);Jb=m.sampleElevation(Hb,Mb,T.samplerData)}else Jb=G(mb);na(Sa,Va,Jb);xa(Da);const fb=X-Q[0],Cb=ca-Q[1],Lb=ba-Q[2];l.minMaxBoundingBox(fb,Cb,Lb,P);Ja.setVertexFromValuesRawPositionUVNormal(Ta,fb,Cb,Lb,wa,Ba,Y,ea,fa);db.setVertexFromValuesRawPositionUVNormal(lb,
fb,Cb,Lb,wa,Ba,Y,ea,fa)}}for(let Da=0;4>Da;++Da)J[Da]=null}function G(M){const T=M.reduce((Z,P)=>Math.min(Z,P?.level??Infinity),Infinity);h.enableTerrainInternalChecks&&(h.internalAssert(!M[0]||!M[2]||u.isCornerNeighbor(M[0],M[2],c.NeighborIndex.SOUTH_WEST)),h.internalAssert(!M[1]||!M[3]||u.isCornerNeighbor(M[1],M[3],c.NeighborIndex.NORTH_WEST)));let Q=0,O=0;for(let Z=0;4>Z;++Z){var U=M[Z];if(U&&U.level===T){const P=U.extent;U=m.sampleElevation(P[0===Z||1===Z?0:2],P[0===Z||3===Z?1:3],U.renderData?.geometryState?.samplerData);
O+=U;Q++}}M=Q?O/Q:0;h.internalAssert(null!=M);return M}function I(M){const T=M.geometry.vertexAttributes.position.typedBuffer;M.vao.vertexBuffers.geometry.setSubData(T,0,0,T.length)}function H(M,T,Q){if(!T)return!1;M=w.compareTilesByLij(M,T);return 0<M||0===M&&2<=Q}const B=[[0,1],[1,0],[0,-1],[-1,0]],K=new e.PatchGeometryLUT,L=k.fromValues(-Infinity,-Infinity,Infinity,Infinity),J=[null,null,null,null];a.createPlanarGlobePatch=function(M,T){const {extent:Q,surface:O}=M.tile;T=M.geometryState;var U=
Q[0],Z=Q[1],P=Q[2]-U,R=Q[3]-Z,W=T.clippingArea;const N=null!=W?Math.max(0,(W[0]-U)/P):0,V=null!=W?Math.max(0,(W[1]-Z)/R):0;U=null!=W?Math.min(1,(W[2]-U)/P):1;Z=null!=W?Math.min(1,(W[3]-Z)/R):1;R=T.numVerticesPerSide;W=(R-2)**2;P=T.neighborData.edgeResolutions.reduce((X,ca)=>X+ca+1,0);P=O.renderer.tileGeometryCache.acquire(W+P);const S=M.geometry;d.empty(S.boundingBox);S.numVerticesPerSide=T.numVerticesPerSide;S.vertexAttributes=P;g.set(S.uvRange,N,V,U,Z);r(M);E(M,W);y(M);C(S,T.numVerticesPerSide,
[],[0,R-1],[0,R-1],T.wireframe);M.intersectionData=null};a.createSphericalGlobePatch=function(M,T){const Q=M.tile,{extent:O,extentInRadians:U,surface:Z}=Q,P=M.localOrigin,R=M.geometryState;var W=Z.isWebMercator;const N=R.numVerticesPerSide,V=N-1,S=(N-2)**2,X=W&&(T===f.PatchType.HAS_SOUTH_POLE||T===f.PatchType.HAS_BOTH_POLES),ca=W&&(T===f.PatchType.HAS_NORTH_POLE||T===f.PatchType.HAS_BOTH_POLES);W=6*((X?1:0)+(ca?1:0))*(V+1);T=R.neighborData;const ba=T.edgeResolutions.reduce((ea,fa)=>ea+fa+1,0),ia=
Z.renderer.tileGeometryCache.acquire(S+W+ba);W=M.geometry;W.numVerticesPerSide=R.numVerticesPerSide;W.vertexAttributes=ia;const ka=W.boundingBox;d.empty(ka);const na=v(M);K.update(V,U,na);n(M);E(M,S);q(M);const Y=[];(()=>{let ea=S+ba;const fa=P[0],aa=P[1],da=P[2],ma=Q.ellipsoid.radius,ua=O[1],sa=O[3],ra=(Aa,qa)=>{qa*=N;l.minMaxBoundingBox(-fa,-aa,-da+Aa*ma,ka);Y.push({connectedRowOffset:qa,connectedOuterEdgeOffset:1===Aa?0:2,rowOffset:ea,latitudeResolution:6});qa=Math.PI/2-2*Math.atan(Math.exp(-(-1===
Aa?ua:sa)/ma));const la=Aa*Math.PI/2-qa;Aa=.99*(1===Aa?1:-1);const ja=ma+0,{position:oa,uv0:za}=ia,{typedBuffer:ta,typedBufferStride:Ca}=ia.normalCompressed;for(let La=1;6>=La;++La){var Ga=qa+La/6*la;const Ma=Math.cos(Ga);Ga=Math.sin(Ga);for(let Ra=0;Ra<=V;Ra++){const Ya=Ra/V,ab=K.cosLonLUT[Ra]*Ma,Wa=K.sinLonLUT[Ra]*Ma,cb=Ga,Na=ab*ja-fa,xa=Wa*ja-aa,Da=cb*ja-da;l.minMaxBoundingBox(Na,xa,Da,ka);oa.setValues(ea,Na,xa,Da);l.encodeUVInBuffer(za,ea,Ya,Aa);x.compressNormal(ta,ea,ab,Wa,cb,Ca);++ea}}};X&&
ra(-1,0);ca&&ra(1,V)})();C(W,R.numVerticesPerSide,Y,[0,N-1],[0,N-1],R.wireframe);M.intersectionData=null;if(h.enableTerrainInternalChecks)for(M=0;4>M;++M)h.internalAssert(W.outerEdges[M].count===T.edgeResolutions[M]+1)};a.updateCornerSpherical=function(M){M.tile.intersectsClippingArea&&(F(M),t(M,!0),I(M))};a.updateCornersPlanar=function(M,T){M.tile.intersectsClippingArea&&(F(M),z(M,!0),I(M))};a.updateEdgesAndCornersPlanar=function(M,T){M.tile.intersectsClippingArea&&(y(M),I(M))};a.updateEdgesAndCornersSpherical=
function(M){M.tile.intersectsClippingArea&&(q(M),I(M))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../geometry/support/aaBoundingBox ./terrainUtils ../webgl-engine/lib/Normals".split(" "),function(a,b,g,d,k,m){function f(e,p,h,u){e.setValues(p,16384*h,16384*u)}class c{constructor(){this.vertexAttributes=this.indices=null;this.boundingBox=d.empty();this.numVerticesPerSide=
this.indexCount=0;this.uvRange=[0,0,1,1];this.outerEdges=[null,null,null,null];this.innerEdges=[null,null,null,null]}release(){this.vertexAttributes=b.releaseMaybe(this.vertexAttributes);this.indices=null}}class l{constructor(e,p,h,u,w){this.attributes=e;this.localOrigin=p;this.index0=h;this.stride=u;this.count=w}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){k.internalAssert(0<=e&&e<this.count);return this.index0+this.stride*e}_getVertexRaw(e,p){this.attributes.position.getVec(e,
p)}getVertexPos(e,p){this._getVertexRaw(this.getAttributeIndex(p),e);g.add(e,e,this.localOrigin)}getNormal(e,p){const {typedBuffer:h,typedBufferStride:u}=this.attributes.normalCompressed;m.decompressNormal(e,h,this.getAttributeIndex(p),u)}_setNormal(e,p,h,u){const {typedBuffer:w,typedBufferStride:x}=this.attributes.normalCompressed;m.compressNormal(w,e,p,h,u,x)}_setUV(e,p,h){f(this.attributes.uv0,e,p,h)}setNormalFromValues(e,p,h,u){this._setNormal(this.getAttributeIndex(e),p,h,u)}setVertexFromValuesRawPositionUV(e,
p,h,u,w,x){e=this.getAttributeIndex(e);this.attributes.position.setValues(e,p,h,u);this._setUV(e,w,x)}setVertexFromValuesRawPositionUVNormal(e,p,h,u,w,x,n,q,t){e=this.getAttributeIndex(e);this.attributes.position.setValues(e,p,h,u);this._setUV(e,w,x);this._setNormal(e,n,q,t)}}a.EdgeDescriptor=l;a.PatchGeometry=c;a.encodeUVInBuffer=f;a.minMaxBoundingBox=function(e,p,h,u){e<u[0]?u[0]=e:e>u[3]&&(u[3]=e);p<u[1]?u[1]=p:p>u[4]&&(u[4]=p);h<u[2]?u[2]=h:h>u[5]&&(u[5]=h)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports","./TerrainConst"],function(a,b){class g{constructor(){this.sinLonLUT=Array(b.maxPatchTesselation+1);this.cosLonLUT=Array(b.maxPatchTesselation+1);this.sinLatLUT=Array(b.maxPatchTesselation+1);this.cosLatLUT=Array(b.maxPatchTesselation+1)}update(d,k,m){const f=k[0];k=k[2];for(let l=0;l<=d;l++){var c=l/d;const e=f*(1-c)+k*c;this.sinLonLUT[l]=Math.sin(e);this.cosLonLUT[l]=Math.cos(e);c=m(c);this.sinLatLUT[l]=Math.sin(c);
this.cosLatLUT[l]=Math.cos(c)}}}a.PatchGeometryLUT=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./ITile ./LayerClass ./PatchGeometry ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){function C(L,J){return J?.isLoaded||J===L?J:null}class E{constructor(){this.geometry=new w.PatchGeometry;this.geometryState=this.intersectionData=null;this._textureRef=new n.TextureFader(()=>this.tile.surface.textureFadeDuration);this.overlay=new t;this._geometryStateChangedSinceLastUpdate=!0;this._wireframeChanged=this._clippingAreaChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=this._hasGeometry=!1;this._dirtyCorners=this._dirtyEdges=
this._dirtyEdgeResolutions=15}get tile(){return this._tile}init(L){this.clear();this._tile=L;L=this.geometry;L.indices=null;L.vertexAttributes=null;f.empty(L.boundingBox);L.indexCount=0;L.numVerticesPerSide=0;this.intersectionData=null;this.geometryState=new p.GeometryState;this.localOrigin=null;this.overlay.clear()}clear(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=null}updateGeometryIfNeeded(L){if(!this._vao||this._geometryStateChangedSinceLastUpdate||
this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)this._updateGeometry(L),this._geometryStateChangedSinceLastUpdate=!1;if(x.enableTerrainInternalChecks&&this.tile.intersectsClippingArea)for(L=0;4>L;++L)x.internalAssert(this.geometry.outerEdges[L].count===this.geometryState.neighborData.edgeResolutions[L]+1)}_calculateEdgeResolution(L,J){const M=this.tile,T=this.geometryState.numVerticesPerSide-
1;if(!M.surface.isGlobal){var Q=M.surface.extent;if(null!=Q&&(0===L&&M.extent[3]>Q[3]||1===L&&M.extent[2]>Q[2]||2===L&&M.extent[1]<Q[1]||3===L&&M.extent[0]<Q[0]))return T}const O=M.level;Q=x.neighborEdgeIndices[L];if(!J)return x.internalAssert(null==M.surface?.rootTiles||M.surface.updatingRootTiles||!M.shouldHaveNeighbor(Q)),T;if(J.isLoaded)return Q=J.renderData.geometryState,J=O-J.level,x.internalAssert(0<=J),0===J?Math.max(Q.numVerticesPerSide-1,T):Math.max(1,Q.neighborData.edgeResolutions[(L+2)%
4]/2**J);x.internalAssert(!J.isLeaf);let U=T;J.forAllSubtreeOnSide(x.oppositeEdge(Q),Z=>{if(Z===M)return!0;if(Z.isLoaded)return U=Math.max(U,2**(Z.level-O)),!0;x.internalAssert(!Z.isLeaf);return!1});return U}updateNeighborData(){const L=this.tile;if(L.intersectsClippingArea){var J=L.renderData.geometryState.neighborData,M=W=>(W.isLoaded||W.level===L.level)&&W?.intersectsClippingArea,T=J.edgePeerNeighbors,Q=J.edgePeerNeighborSamplerVersions;for(var O=0;4>O;++O){var U=L.findNeighborTile(x.neighborEdgeIndices[O],
M),Z=C(L,U),P=Z?.renderData?.geometryState.samplerDataVersion??-1,R=C(L,T[O]);Z=Z!==R;R=Q[O]!==P;T[O]=U;if(Z||R)Q[O]=P,this._markEdgeDirty(O);P=J.edgeResolutions[O];U=this._calculateEdgeResolution(O,U);x.internalAssert(g.isPowerOfTwo(U));x.internalAssert(1<=U);J.edgeResolutions[O]=U;P!==U&&this._markEdgeResolutionDirty(O)}Q=J.cornerPeerNeighbors;for(O=0;4>O;++O){Z=L.findNeighborTile(x.neighborCornerIndices[O],M);Q[O]=Z;U=C(L,T[O]);P=C(L,T[(O+1)%4]);Z=C(L,Z);K[O]=Z;K[(O+1)%4]=P;K[(O+2)%4]=L;K[(O+3)%
4]=U;x.internalAssert(K.some(N=>N?.isLoaded||N===L));const W=K.reduce((N,V)=>Math.min(N,V?.level??Infinity),Infinity);K.forEach((N,V)=>{N&&N?.level>W&&(K[V]=null)});x.internalAssert(K.some(N=>N?.isLoaded||N===L));U=J.cornerNeighborData[O].cornerTiles;P=J.cornerNeighborData[O].cornerTileSamplerVersions;for(Z=0;4>Z;++Z){R=K[Z];const N=R?.renderData.geometryState.samplerDataVersion??-1,V=U[Z]!==R,S=!V&&P[Z]!==N;if(V||S)U[Z]=R,P[Z]=N,this._markCornerDirty(O)}x.internalAssert(U.some(N=>N?.isLoaded||N===
L))}x.enableTerrainInternalChecks&&x.internalAssert(this.geometryState.neighborData.edgeResolutions.every(W=>0<W));for(J=0;4>J;++J)K[J]=null}}_updateGeometry(L){if(this.tile.intersectsClippingArea){x.enableTerrainInternalChecks&&x.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(O=>0<O));this.intersectionData=null;var J=this.tile,M=this.geometry.vertexAttributes;M=!this._vao||!M||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||
this._clippingAreaChanged||this._dirtyEdgeResolutions;var T=!M&&(0!==this._dirtyEdges||0!==this._dirtyEdgeResolutions),Q=!T&&0!==this._dirtyCorners;M?(this.releaseGeometry(),this._createGeometry(L)):T||Q?J.updateEdgeElevations():Q?J.updateCornerElevations():console.warn("Update for no reason?");this._samplerDataChanged=this._numVerticesPerSideChanged=!1;this._dirtyCorners=this._dirtyEdges=this._dirtyEdgeResolutions=0;this._wireframeChanged=this._clippingAreaChanged=!1}}get hasGeometry(){return this._hasGeometry}releaseGeometry(){this._hasGeometry=
!1;this.intersectionData=null;if(!this._vao)return!1;this._vao=d.disposeMaybe(this._vao);this.geometry.release();return!0}ensureTexture(L,J,M){J=J?D.PixelFormat.RGBA:D.PixelFormat.RGB;null==this._texture||this._texture.descriptor.width===L&&this._texture.descriptor.pixelFormat===J||this.releaseTexture();null==this._texture&&(this._texture=M(),this.tile.setMemoryDirty());return this._texture}releaseTexture(){null!=this._texture&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(L){this._dirtyCorners|=
1<<L}_markEdgeDirty(L){this._dirtyEdges|=1<<L;this._markCornerDirty((L+0)%4);this._markCornerDirty((L+3)%4)}_markEdgeResolutionDirty(L){this._dirtyEdgeResolutions|=1<<L;this._markEdgeDirty(L)}_markAllEdgesAndCornersDirty(){this._dirtyEdgeResolutions=this._dirtyEdges=this._dirtyCorners=15}updateGeometryState(){var L=this._getElevationInfo();const J=this.tile;var M=L.samplerData?J.getElevationVerticesPerSide(L.maxTileLevel):J.getDefaultVerticesPerSide();const T=Math.max(M,5);let Q=J.clippingArea;if(!J.intersectsClippingArea||
J.isWithinClippingArea)Q=null;M=this.geometryState;let O=!1;M.numVerticesPerSide!==T&&(this._numVerticesPerSideChanged=!0,M.numVerticesPerSide=T,M.samplerDataVersion++,O=!0);L.changed&&(this._samplerDataChanged=!0,M.samplerData=L.samplerData,M.samplerDataVersion++,O=!0);b.equals(M.clippingArea,Q)||(this._clippingAreaChanged=!0,M.clippingArea=Q,O=!0);L=J.surface.wireframe;M.wireframe!==L&&(this._wireframeChanged=!0,M.wireframe=L,O=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=
O);O&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate}_createGeometry(L){this.tile.createGeometry();const J=this.geometry.vertexAttributes,M=this.geometry.indices,T=L.gl;this._vao=new r.VertexArrayObject(L,y.terrainVertexAttributeLocations,{geometry:e.glLayout(J.layout)},{geometry:z.BufferObject.createVertex(L,T.STATIC_DRAW,J.buffer)},z.BufferObject.createIndex(L,T.STATIC_DRAW,M));this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(L,
J=n.ActivationTime.Immediate){null!=L&&L.texture!==this._texture&&this.releaseTexture();this._textureRef.push(L,J)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){var L=this.geometryState.samplerData;const J=this.tile.layerInfo[u.LayerClass.ELEVATION],M=J.length,T=Array(M);let Q=0;var O=0;let U=!1;for(let R=
0;R<M;R++){var Z=J[R];if(null!=Z.upsampleInfo){Z=Z.upsampleInfo.tile;var P=Z.layerInfo[u.LayerClass.ELEVATION][R].data;P=P&&P.samplerData;L&&L[Q]===P||(U=!0);T[Q++]=P;O=Math.max(O,Z.lij[0])}else Z.data&&(P=this.tile.surface.layerViewByIndex(R,u.LayerClass.ELEVATION),v.fallsWithinLayer(this.tile,P.layer,!1)&&(O=Z.data,L&&L[Q]===O.samplerData||(U=!0),T[Q++]=O.samplerData,O=this.tile.level))}null!=L&&L.length!==Q&&(U=!0);if(L=0<Q)T.length=Q;return{changed:U,samplerData:L?T:null,maxTileLevel:O}}get estimatedGeometryMemoryUsage(){return(this.geometry.indices?.byteLength??
0)+(this.geometry.vertexAttributes?.byteLength??0)+(this.intersectionData?.estimatedMemoryUsage??0)}get texture(){return this._texture}get test(){return{hasTexture:null!=this._texture}}checkGeometryWaterproofness(){if(x.enableTerrainInternalChecks){var L=this.tile;if(L.isLoaded&&L.intersectsClippingArea&&0!==L.level){var J=L.surface.extent;if(null==J||L.intersectsExtent(J)){var M=x.neighborEdgeIndices.map((U,Z)=>null!=J?0>(2>Z?-1:1)*(L.extent[3-Z]-J[3-Z]):!1),T=L.level;x.internalAssert(0===this._dirtyCorners);
x.internalAssert(0===this._dirtyEdges);x.internalAssert(0===this._dirtyEdgeResolutions);x.internalAssert(!this._numVerticesPerSideChanged);x.internalAssert(!this._samplerDataChanged);x.internalAssert(!this._clippingAreaChanged);x.internalAssert(!this._wireframeChanged);var Q=x.neighborCornerIndices.map(U=>L.findNeighborCornerTileExact(U,Z=>!Z.intersectsClippingArea||Z.isLoaded||Z.level===L.level)??null).map(U=>U?.intersectsClippingArea?U:null),O=this.geometryState.neighborData;for(let U=0;4>U;++U){const Z=
O.cornerPeerNeighbors[U],P=Q[U];x.internalAssert(P===Z,`Tile[${L.lij}].corner[${U}] out of date: cur=[${Z?.lij}] exp=[${P?.lij}]`)}x.neighborEdgeIndices.forEach((U,Z)=>{if(!M[Z]){var P=L.findNeighborTile(U,ma=>(ma.level===T||ma?.isLoaded)&&ma?.intersectsClippingArea);if(P){x.internalAssert(P.isLoaded||P.level===L.level);x.internalAssert(P===this.geometryState.neighborData.edgePeerNeighbors[Z]);var R=T-P.level;if(P.isLoaded){var W=P.renderData;x.internalAssert(q.isEdgeNeighbor(L,P,U));x.internalAssert(0<=
R);var N=2**R;if(0>R)x.internalAssert(!1);else{var V=L.renderData,S=V.geometry,X=S.outerEdges[Z],ca=S.numVerticesPerSide-1,ba=W.geometry;if(ba){S=this.geometryState.neighborData.edgePeerNeighbors[Z];if(S?.isLoaded){var ia=S.renderData;x.internalAssert(S===S);x.internalAssert(V.geometryState.neighborData.edgePeerNeighborSamplerVersions[Z]===ia.geometryState.samplerDataVersion);x.internalAssert(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[Z]===ia.geometryState.samplerDataVersion)}var ka=
(Z+2)%4,na=ba.outerEdges[ka];S=X.count-1;ia=na.count-1;x.internalAssert(S*N===ia,`Tile[${L.lij}]:e${Z},res=${S} edgeRes mismatch with`+` Neighbor[${P.lij}]:e${ka},res=${ia} (expected:${S*N})`);S=L.extent;ia=U===h.NeighborIndex.NORTH||U===h.NeighborIndex.SOUTH;var Y=na.count-1,ea=Y/2**R,fa=X.count-1;if(1>ea)x.internalAssert(1===fa);else{x.internalAssert(ea===fa);x.internalAssert(g.isPowerOfTwo(ea));ba=ba.numVerticesPerSide-1;x.internalAssert(0<R||ea===Math.max(ba,ca));R=L.getNeighborEdgeStartVertexIndex(Z,
P);x.internalAssert(0<=R&&R<N);N=R*ea;x.internalAssert(0<=N&&N<=Y-ea);var aa=0,da=N;X.getVertexPos(A,0);X.getVertexPos(F,X.count-1);N=k.distance(A,F);N=Math.max(1,1E-4*N);for(R=0;R<=ea;++R){X.getVertexPos(A,aa);na.getVertexPos(F,da);ba=R/ea;ca=ia?S[0]+ba*(S[2]-S[0]):U===h.NeighborIndex.WEST?S[0]:S[2];const ma=ia?U===h.NeighborIndex.SOUTH?S[1]:S[3]:S[1]+ba*(S[3]-S[1]),ua=L.surface.extent;if(null==ua||c.containsXY(ua,ca,ma)){ba=k.dist(A,F);Y=k.len(A)-l.earth.radius;fa=k.len(F)-l.earth.radius;const sa=
ba<N;sa||(console.warn("Tile edge vertex position mismatch: between"+` [${L.lij}].edge${Z}[${aa}/${X.count}] and`+` [${P.lij}].edge${ka}[${da}/${na.count}]`),null!=ua&&console.warn("  surface extent\x3d ",ua," x,y\x3d",ca,",",ma),ca=m.create(),k.subtract(ca,V.localOrigin,W.localOrigin),0<k.len(ca)&&console.warn(`   localOrigins: ${V.localOrigin} vs ${W.localOrigin}`+` d=${k.len(ca)} [${ca}]`),(()=>{const Aa=m.clone(A),qa=m.clone(F);L.updateEdgeElevations();P.updateEdgeElevations();X.getVertexPos(A,
aa);na.getVertexPos(F,da);const la=m.create();k.sub(la,A,Aa);0<k.len(la)&&console.warn(`  XXX Tile[${L.lij}] edge out of date: ${Aa} vs ${A} d=${k.len(la)} [${la}]`);k.sub(la,F,qa);0<k.len(la)&&console.warn(`  XXX Neighbor[${P.lij}] edge out of date: ${qa} vs ${F} d=${k.len(la)} [${la}]`)})(),x.internalAssert(sa,"Mismatch in tile"+` [${L.lij}].edge[${Z}][${aa}/${X.count}] vs neighbor`+` [${P.lij}].edge[${ka}][${da}/${na.count}]`+` ${x.v32s(A)} vs ${x.v32s(F)}  dist=${ba} h(t|n|d)=${Y}|${fa}|${fa-
Y}`));X.getNormal(G,aa);na.getNormal(I,da);k.normalize(H,G);k.normalize(B,I);const ra=k.dot(H,B);ca=.01>1-ra||L===P;if(!ca){const Aa=m.create();k.sub(Aa,G,I);ba=()=>`Mismatch in tile edge normal ${x.lij2s(L.lij)} (${aa}/${X.count-1}) edge ${Z} vs neighbor ${x.lij2s(P.lij)}  (${da}/${na.count-1}) nedge ${ka} :`+`${x.v32s(G)} vs ${x.v32s(I)}  dot = ${ra} : ${x.v32s(Aa)}`;console.warn("Mismatch in tile edge normal: ",ba());L.updateEdgeElevations();P.updateEdgeElevations();Y=m.create();fa=m.create();
X.getNormal(Y,aa);na.getNormal(fa,da);k.equals(G,Y)||console.warn("Missing update in tile normal: ",x.v32s(G)," \x3d\x3e ",x.v32s(Y));k.equals(I,fa)||console.warn("Missing update in neighbor normal: ",x.v32s(I)," \x3d\x3e ",x.v32s(fa));x.internalAssert(ca,ba())}}aa+=1;da+=1}}}else x.internalAssert(!1)}}else x.internalAssert(!P.isLeaf),x.internalAssert(0===R)}else U=!L.surface.updatingRootTiles&&null!=L.surface.rootTiles&&0<L.surface.rootTiles.length&&L.shouldHaveNeighbor(U),x.internalAssert(!U)}})}}else x.internalAssert(L?.isLoaded)}}}
const A=m.create(),F=m.create(),G=m.create(),I=m.create(),H=m.create(),B=m.create(),K=[null,null,null,null];Object.defineProperty(a,"ActivationTime",{enumerable:!0,get:()=>n.ActivationTime});a.PatchRenderData=E;a.neighborTileIfLoadedOrSelf=C;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){class b{constructor(){this.cornerTiles=[null,null,null,null];this.cornerTileSamplerVersions=[-1,-1,-1,-1]}}class g{constructor(){this.cornerNeighborData=
[new b,new b,new b,new b];this.edgeResolutions=[-1,-1,-1,-1];this.edgePeerNeighbors=[null,null,null,null];this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1];this.cornerPeerNeighbors=[null,null,null,null]}}class d{constructor(){this.numVerticesPerSide=0;this.clippingArea=this.samplerData=null;this.wireframe=!1;this.samplerDataVersion=0;this.neighborData=new g}}a.CornerNeighborData=b;a.GeometryState=d;a.NeighborhoodData=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports",
"../../../core/maybe","./interfaces"],function(a,b,g){class d{constructor(k){this._getFadeDuration=k;this._delayedTime=this._fadeStart=0}clear(){this._current=b.destroyMaybe(this._current);this._next=b.destroyMaybe(this._next);this._waiting=b.destroyMaybe(this._waiting);this._delayed=b.destroyMaybe(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){var k=this._delayed||this._waiting||this._next||this._current;k!==this._current&&(this._current=null,this.clear(),
this._current=k)}k=d.test.fadeMoment;null!=this._delayed&&(k=k||performance.now(),k>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(null!=this._next){k=k||performance.now();const m=this._next.type!==g.TextureUpdate.FADING,f=k-this._fadeStart>=this._fadeDuration;if(null!=this._current&&this._next.texture===this._current.texture||m||f)b.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(k)}return this._current}get next(){return this._next}get fadeFactor(){if(null==
this._next)return 1;var k=d.test.fadeMoment||performance.now();k=Math.max(0,k-this._fadeStart);const m=this._fadeDuration;return k>m?0:1-k/m}get isFading(){return null!=this._next||null!=this._delayed}push(k,m=a.ActivationTime.Immediate){this._delayed=b.destroyMaybe(this._delayed);this._push(k,m)}_push(k,m){this._isFadingEnabled||this.clear();if(null==this._current)this._current=k;else{var f=d.test.fadeMoment||performance.now();m!==a.ActivationTime.Immediate?(this._delayed=k,this._delayedTime=f+m):
null==this._next?(this._next=k,this._fadeStart=this._alignFadeStart(f)):null!=k&&(b.destroyMaybe(this._waiting),this._waiting=k)}}get _fadeDuration(){return null==this._waiting?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(k){const m=this._getFadeDuration();return k+m-k%m}get _isFadingEnabled(){return 0<this._getFadeDuration()}}d.test={fadeMoment:0};a.ActivationTime=void 0;(function(k){k[k.Immediate=0]="Immediate";k[k.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime=
{}));a.TextureFader=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/common ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../../layers/support/layerUtils ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./ITile ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I){function H(P){P.dispose();P instanceof q.ElevationTileAgent?M.release(P):P instanceof y.MapTileAgent&&J.release(P)}function B(P,R,W){return null==P||null==R||R===P?!1:P.level>=R.level?K(P,R,W):K(R,P,C.oppositeCorner(W))}function K(P,R,W){C.internalAssert(P.level>=R.level);var N=C.isWestCorner(W),V=C.isNorthCorner(W),S=P.extent;W=R.extent;var X=[N?S[0]:S[2],V?S[3]:S[1]];const ca=[N?W[2]:W[0],V?W[1]:W[3]];N=1E-5*(S[2]-S[0]);V=C.almostEquals(X[0],
ca[0],N)||P.surface.isGlobal&&C.almostEquals(X[0],-ca[0],N);X=C.almostEquals(X[1],ca[1],N);if(V&&X)return!0;if(P.level===R.level||!V&&!X)return C.internalAssert(!1),!1;V?(P=S[1],S=S[3],W=W[1]-N<=P&&P<=S&&S<=W[3]+N):(P=S[0],S=S[2],W=W[0]-N<=P&&P<=S&&S<=W[2]+N);C.internalAssert(W);return W}class L{constructor(){this.lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this.renderData=null;this._dirty=!0;this._previouslyRendered=!1;this.extent=p.create();this._elevationBounds=m.create();
this.layerInfo=[[],[]];this.extentInRadians=p.create();this.centerAtSeaLevel=c.create();this._center=[c.create(),h.create(),c.create()];this.up=c.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=this._mapDataRefCount=this._mapTileMemoryInternal=0;this.distanceToPOI=-1;this._lastPOI=c.create()}static prune(){J.prune(0);M.prune(0);
A.TilePerLayerInfo.prune()}get _isCached(){return!this.shouldLoad&&0>=this._mapDataRefCount}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[a.CenterPosition.MIDDLE][3]}get visible(){this._dirty&&
this.computeVisibility();return this._visible}get frustumVisibility(){this._dirty&&this.computeVisibility();return this._frustumVisibility}computeVisibility(){this._dirty=!1;var P=this.parent?.frustumVisibility??v.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=P===v.TileFrustumVisibility.INSIDE?v.TileFrustumVisibility.INSIDE:P===v.TileFrustumVisibility.OUTSIDE?v.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);P=this._frustumVisibility!==v.TileFrustumVisibility.OUTSIDE&&
this._intersectsClippingArea;P!==this._visible&&(this._visible=P,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const P=!!this.renderData;P!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=P,this._surface.renderer.setDirty());return P}get shouldLoad(){return this.isLeaf}init(P,R,W,N,V){this.lij[0]=
P;this.lij[1]=R;this.lij[2]=W;this.ellipsoid=e.getReferenceEllipsoid(V.tilingScheme.spatialReference);V.tilingScheme.getExtent(P,R,W,this.extent);V.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+this.extent[3]);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;V.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=
0;this.elevationLevel=P;N&&N.elevationBounds?k.copy(this._elevationBounds,N.elevationBounds):k.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=N;this.unsetChildren();this._surface=V;this.updateVisibility();for(const S of r.LayerClasses){P=V.numLayers(S);R=this.layerInfo[S];for(const X of R)X.release();R.length=P;for(W=0;W<P;W++)R[W]=A.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),S===r.LayerClass.ELEVATION&&
this.findElevationBoundsForLayer(W,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(V.tilingScheme.pixelSize,D.maxPatchTesselation)}dispose(){C.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(var P of r.LayerClasses){for(const R of this.layerInfo[P])R.release();this.layerInfo[P].length=0}this._parent=null;for(P=0;4>P;++P)this._children[P]=null;this._surface=null;this.setMemoryDirty()}refMapData(){++this._mapDataRefCount;
this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount;if(this._isCached){this.setMemoryDirty();const P=this._cachedMemory;0<P&&this._surface.upsampleMapCache.put(this.key,this,P)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){this._ensureUsedMemory();return this.layerInfo[r.LayerClass.MAP].reduce((P,
R)=>P+(R instanceof w.VectorTile?R.memoryUsed/R.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const P=this._surface.tilingScheme.pixelSize;return P*P*4}_ensureUsedMemory(){if(null!=this._usedMemory)return this._usedMemory;this._usedMemory=this._baseUsedMemory;let P=this._mapTileMemoryInternal=0;for(var {data:R}of this.layerInfo[r.LayerClass.MAP])R instanceof w.VectorTile?P+=this._getTerrainDataMemory(R):this._mapTileMemoryInternal+=this._getTerrainDataMemory(R);R=this._cpuImageMemorySize;
for(const W of this.layerInfo[r.LayerClass.ELEVATION])this._usedMemory+=W.data?R:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0);this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+P);return this._usedMemory}getUsedMemoryForLayer(P,R){R=this.layerInfo[P][R];return R?.data?P===r.LayerClass.MAP?this._isCached?0:this._getTerrainDataMemory(R.data):P===
r.LayerClass.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(P){return P instanceof F?P.texture.gpuMemoryUsage:P instanceof HTMLImageElement||P instanceof x.ImageWithType?this._cpuImageMemorySize:P instanceof z.RasterTile?P.memoryUsage:P instanceof w.VectorTile?P.memoryUsed/P.referenced:0}updateScreenDepth(P){var R=this._center[a.CenterPosition.MIDDLE];const W=R[0],N=R[1];R=R[2];const V=P[2]*W+P[6]*N+P[10]*R+P[14];this.screenDepth=0>V?0:V/(P[3]*W+P[7]*N+P[11]*R+P[15])}shouldSplit(P,R,
W){if(!this.visible||P.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(P.frustum)===v.TileFrustumVisibility.OUTSIDE))return G.TileUpdate.NONE;const N=this.level;f.subtract(Q,this._center[a.CenterPosition.MIDDLE],R);var V=f.squaredLength(Q),S=Q;let X=a.CenterPosition.MIDDLE;f.subtract(O,this._center[a.CenterPosition.TOP],R);var ca=f.squaredLength(O);ca<V&&(V=ca,S=O,X=a.CenterPosition.TOP);f.subtract(U,this._center[a.CenterPosition.BOTTOM],R);ca=f.squaredLength(U);ca<
V&&(V=ca,S=U,X=a.CenterPosition.BOTTOM);if(this._edgeLen2>V&&N<P.maxLod)return G.TileUpdate.SPLIT;const ba=null!=W?W-N:Infinity;V=Math.sqrt(V);const ia=this._edgeLen/(P.fovX*V*2),ka=()=>{if(N<P.maxLod)return this.elevationLevel=N,G.TileUpdate.NONE;const ea=N+Math.ceil(-Math.log2(P.relativeWidthLimit/ia));return ea!==this.elevationLevel?(this.elevationLevel=ea,G.TileUpdate.ELEVATION):G.TileUpdate.NONE};if(.5>=ba)return ka();const na=f.dot(this.up,Q);ca=this._elevationBounds[1]-this._elevationBounds[0];
const Y=ca/this.edgeLen;if(P.aboveGround&&0<na&&.001>Y&&0<na/V-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-Y)return G.TileUpdate.NONE;W=null!=W?3-Math.min(ba,2):1;if(ia*W<P.relativeWidthLimit||N>=P.maxLod)return ka();if(7>N)return G.TileUpdate.SPLIT;f.scale(Z,this.up,na);f.subtract(Z,Z,S);S=f.squaredLength(Z);if(S<=this.radius*this.radius)return G.TileUpdate.SPLIT;f.scale(Z,Z,this.radius/Math.sqrt(S));f.add(Z,Z,this._center[X]);f.subtract(Z,R,Z);return Math.min(1,(Math.abs(f.dot(Z,
this.up))+.5*ca+this._curvatureHeight)/f.length(Z))*(this._edgeLen/(P.fovY*V*2))*W<.1/P.angledSplitBias*P.relativeHeightLimit?G.TileUpdate.NONE:G.TileUpdate.SPLIT}setChildren(P,R,W,N){C.weakAssert(!!(P&&R&&W&&N),"Null child passed");this._children[0]=P;this._children[1]=R;this._children[2]=W;this._children[3]=N}unsetChildren(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();
for(const P of r.LayerClasses)this._createOrUpdateAgents(0,P);this.surface.renderer.loadTile(this)}unload(P){P.unloadTile(this);for(const R of r.LayerClasses){P=this.layerInfo[R];for(const W of P)W.loadingAgent&&W.loadingAgent!==E.tileAgentDone&&(H(W.loadingAgent),W.loadingAgent=null),W.pendingUpdates=0}this.resetPendingUpdate(G.TileUpdate.GEOMETRY);this.resetPendingUpdate(G.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(G.TileUpdate.TEXTURE_FADING);this.unrefMapData()}unloadMapData(){const P=
this.layerInfo[r.LayerClass.MAP];for(const R of P)R.loadingAgent&&R.loadingAgent!==E.tileAgentDone&&(H(R.loadingAgent),R.loadingAgent=null),R.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()}updateClippingStatus(P){if(p.equals(P,this._clippingArea))return!1;var R=this._intersectsClippingArea;const W=this._isWithinClippingArea;null!=P?(this._intersectsClippingArea=this.intersectsExtent(P),this._isWithinClippingArea=this._isWithinExtent(P)):this._isWithinClippingArea=
this._intersectsClippingArea=!0;this._clippingArea=P;this.updateVisibility();P=W&&this._isWithinClippingArea;R=!W&&!R&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||P||R||this.setPendingUpdate(G.TileUpdate.GEOMETRY);return!0}updateVisibility(){this._dirty=!0;this._surface.setTileTreeDirty()}getLayerInfo(P,R){return this.layerInfo[R][P]}hasLayerData(P,R){P=this.layerInfo[R][P];return!(!P?.data||P.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const P of r.LayerClasses){const R=
this.layerInfo[P];for(const W of R)if(W.loadingAgent&&W.loadingAgent!==E.tileAgentDone&&W.loadingAgent.updating)return!0}return!1}_isSuspended(P){return this.hasPendingUpdate(G.TileUpdate.SPLIT)?!0:P===r.LayerClass.ELEVATION?!1:!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(P){return(this._pendingUpdates&P)===P}setPendingUpdate(P){this._pendingUpdates|=P;P===G.TileUpdate.SPLIT||P===G.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(P){return this.hasPendingUpdate(P)?
(this._pendingUpdates&=~P,!0):!1}requestLayerData(P,R,W){const N=this.layerInfo[R][P];if(N.waitingAgents.has(W))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),W.tile.lij.toString(),R,P),!0;N.waitingAgents.push(W);if(N.data&&!N.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),W.tile.lij.toString(),R,P),W.dataArrived(this,N.data&&"type"in N.data&&
"vector-tile"===N.data.type),!0;if(N.requestPromise)return!0;g.abortMaybe(N.requestAbort);N.requestAbort=new AbortController;const V=this._surface.requestTileData(this,P,R,N.requestAbort);if(!V)return N.requestAbort=null,!1;P=()=>{N.requestPromise===V&&(N.requestPromise=null,N.requestAbort=null)};N.requestPromise=V;V.then(P,P);return!0}get isLeaf(){return null==this._children[0]}hasLij(P){return this.lij[0]===P[0]&&this.lij[1]===P[1]&&this.lij[2]===P[2]}findByLij(P){if(this.hasLij(P))return this;
const R=this._children;return R[0]?R[0].findByLij(P)||R[1].findByLij(P)||R[2].findByLij(P)||R[3].findByLij(P):null}distanceToSquared(P){return f.squaredLength(f.subtract(Z,this._center[a.CenterPosition.MIDDLE],P))}containsPoint(P){const R=this.extent;return P[0]>=R[0]&&P[1]>=R[1]&&P[0]<=R[2]&&P[1]<=R[3]}containsPointXY(P,R){const W=this.extent;return P>=W[0]&&R>=W[1]&&P<=W[2]&&R<=W[3]}unrequestLayerData(P,R,W){P=this.layerInfo[R][P];R=P.waitingAgents;W=null!=R.removeUnordered(W);C.weakAssert(W,"agent has not requested this piece of map data");
1>R.length&&(P.abortRequest(),this.setMemoryDirty())}dataArrived(P,R,W){const N=null!=W&&"type"in W&&"vector-tile"===W.type;P=this.layerInfo[R][P];P.data=W;P.dataInvalidated=!1;P.waitingAgents.forAll(V=>V.dataArrived(this,N));P.waitingAgents.clear();this.setMemoryDirty()}dataMissing(P,R,W){W.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${R}/${P} error ${W}`);P=this.layerInfo[R][P];P.dataMissing=!0;P.waitingAgents.forAll(N=>N.dataMissing());P.waitingAgents.clear();this.setMemoryDirty()}updateRenderData(P,
R,W){W&&this.forEachLoadedNeighbor(N=>N.updateRenderData(P,R));switch(P){case r.LayerClass.MAP:return this._updateTexture(R);case r.LayerClass.ELEVATION:return this._updateGeometry()}}_updateTexture(P){this.renderData&&(this.resetPendingUpdate(P===t.TextureUpdate.FADING?G.TileUpdate.TEXTURE_NOFADING:G.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(P===t.TextureUpdate.FADING?G.TileUpdate.TEXTURE_FADING:G.TileUpdate.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(G.TileUpdate.GEOMETRY);
for(const P of this.layerInfo[r.LayerClass.ELEVATION])P.pendingUpdates|=G.TileUpdate.GEOMETRY}invalidateLayerData(P,R){this.layerInfo[R][P].invalidateSourceData();this.restartAgents(R)}computeElevationBounds(){const P=this._elevationBounds,R=P[0],W=P[1];k.set(P,Infinity,-Infinity);const N=this.layerInfo[r.LayerClass.ELEVATION];let V=!0;for(const S of N)null!=S.elevationBounds&&(P[0]=Math.min(P[0],S.elevationBounds.min),P[1]=Math.max(P[1],S.elevationBounds.max),S.elevationBounds.hasNoDataValues||(V=
!1));V&&(P[0]=Math.min(P[0],0),P[1]=Math.max(P[1],0));if(R!==P[0]||W!==P[1])this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const P=this._elevationBounds,R=this._center;f.scale(Z,this.up,.5*(P[0]+P[1]));f.add(R[a.CenterPosition.MIDDLE],this.centerAtSeaLevel,Z);f.scale(Z,this.up,P[0]);f.add(R[a.CenterPosition.TOP],this.centerAtSeaLevel,Z);f.scale(Z,this.up,P[1]);f.add(R[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,Z)}findElevationBoundsForLayer(P,R){const W=this.layerInfo[r.LayerClass.ELEVATION][P],
N=D.getElevationDesiredResolutionLevel(this.level),V=Math.max(this.elevationLevel-N,0);var S=W.elevationBounds;if(!(null!=S&&S.level>=R&&S.level<=V)&&(R=this._surface.layerViewByIndex(P,r.LayerClass.ELEVATION),R=C.getLayerWithExtentRange(R),I.fallsWithinLayer(this,R,!1))){R=T;S=!1;var X=W.data;if(X&&X.level<=V)P=W.data,R.min=P.samplerData.data.minValue,R.max=P.samplerData.data.maxValue,R.hasNoDataValues=P.samplerData.data.hasNoDataValues,R.level=this.level,S=!0;else{X=0;let ca,ba;for(let ia=this._parent;ia&&
(!ba||X<N)&&!(X=this.elevationLevel-ia.level,ca=ba||ca,ba=ia.layerInfo[r.LayerClass.ELEVATION][P].data,!ba&&ca&&ia.level<=V);ia=ia.parent);if(ba=ba||ca)ba.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],R),Infinity!==R.min&&(R.level=ba.level,S=!0)}S&&(null==W.elevationBounds&&(W.elevationBounds=new n.ElevationBounds),W.elevationBounds.copyFrom(R))}}modifyLayers(P,R,W){W=this.layerInfo[W];for(var N of W)N.loadingAgent&&N.loadingAgent!==E.tileAgentDone&&(H(N.loadingAgent),N.loadingAgent=null),
N.waitingAgents.clear();for(N=0;N<W.length;++N)void 0===P[N]&&W[N].release();P=Array(...W);N=R.length;W.length=N;for(let V=0;V<N;V++){const S=R[V];W[V]=-1<S?P[S]:A.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(P){this.renderData&&(this._createOrUpdateAgents(0,P),this.updateRenderData(P,t.TextureUpdate.FADING))}updateAgents(P){if(this.renderData){const R=this.layerInfo[P];for(const W of R)W.loadingAgent===E.tileAgentDone&&(W.loadingAgent=null);this._createOrUpdateAgents(0,
P)}}updateAgentSuspension(){for(const P of r.LayerClasses){const R=this._isSuspended(P);for(const W of this.layerInfo[P])W.loadingAgent&&W.loadingAgent!==E.tileAgentDone&&(W.loadingAgent.setSuspension(R),W.loadingAgent===E.tileAgentDone&&this.updateRenderData(P,t.TextureUpdate.FADING))}}removeLayerAgent(P,R){P=this.layerInfo[R][P];P.loadingAgent&&P.loadingAgent!==E.tileAgentDone&&P.loadingAgent.dispose();P.loadingAgent=null}agentDone(P,R){const W=this.layerInfo[R][P];W.loadingAgent=E.tileAgentDone;
W.data||null!=W.upsampleInfo||this._createOrUpdateAgents(P+1,R)}_hasBlendableAncestor(P){return"normal"!==P.blendMode||u.isGroupLayer(P.parent)&&this._hasBlendableAncestor(P.parent)}_hasBlendModes(P,R,W){for(;P<R;++P){const N=this._surface.layerViewByIndex(P,W);if(C.isBlendableLayerView(N)&&"normal"!==N?.layer?.blendMode||u.isGroupLayer(N?.layer?.parent)&&this._hasBlendableAncestor(N?.layer?.parent))return!0}return!1}_createOrUpdateAgents(P,R){const W=this.layerInfo[R];if(0!==W.length){var N=this._isSuspended(R);
for(let ca=P;ca<W.length;++ca){const ba=W[ca];var V=!1;const ia=this._surface.layerViewByIndex(ca,R);var S=C.getLayerWithExtentRange(ia);if(ba.loadingAgent)I.fallsWithinLayer(this,S,!1)?(ba.loadingAgent!==E.tileAgentDone&&ba.loadingAgent.setSuspension(N),ba.loadingAgent!==E.tileAgentDone&&(V=ba.loadingAgent.update())):ba.dispose();else if(I.fallsWithinLayer(this,S,!1)){V=ca;S=R;var X=N;const ka=S===r.LayerClass.ELEVATION?M.acquire():J.acquire();ka.init(this,V,S,X);ba.loadingAgent=ka;(V=ba.loadingAgent.startLoading())?
ba.loadingAgent===E.tileAgentDone&&this.setPendingUpdate(G.TileUpdate.GEOMETRY):(H(ba.loadingAgent),ba.loadingAgent=E.tileAgentDone)}ba.loadingAgent===E.tileAgentDone&&this.updateRenderData(R,t.TextureUpdate.FADING);if(!this._hasBlendModes(P,W.length,R)&&V&&ia.isOpaque)break}}}_isWithinExtent(P){const R=this.extent;return R[0]>=P[0]&&P[2]>=R[2]&&R[1]>=P[1]&&P[3]>=R[3]}intersectsExtent(P){const R=this.extent;return R[2]>=P[0]&&P[2]>=R[0]&&R[3]>=P[1]&&P[3]>=R[1]}getElevationVerticesPerSide(P){var R=
this.elevationLevel-this.level;P=Math.max(this.level-P,D.getElevationDesiredResolutionLevel(this.level)-R);P=b.clamp((this.maxTesselation>>P)+1,2,this.maxTesselation+1);R=this.getDefaultVerticesPerSide();return Math.max(P,R)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(P,R){if(!P)return null;var W=this.surface.rootTiles;if(null!=W)for(var N of W){W=N.level;var V=P[0];W>V?W=!1:(W=V-W,V=Math.floor(P[2]/2**W),W=Math.floor(P[1]/2**W)===N.lij[1]&&V===N.lij[2]);if(W){for(W=P[0]-N.level-1;0<=
W&&!N.isLeaf&&!R(N);)N=N.children[2*(P[1]>>W&1)+(P[2]>>W&1)],W--;return R(N)?N:null}}return null}findNeighborTile(P,R){const W=this.lij;return(P=this.getNeighborLIJ(W,P))?W[0]===P[0]&&W[1]===P[1]&&W[2]===P[2]?R(this)?this:null:this._findLIJ(P,R):null}findCorner(P,R){P=P===v.NeighborIndex.NORTH_EAST?1:P===v.NeighborIndex.NORTH_WEST?0:P===v.NeighborIndex.SOUTH_WEST?2:3;let W=this;for(;W.children[0]&&(!R||!R(W));)W=W.children[P];return W}findNeighborCornerTileExact(P,R){return this.findNeighborTile(P,
W=>R(W)||W.level===this.level)?.findCorner(C.oppositeCorner(P),R)||null}forAllSubtreeOnSide(P,R){const W=P===v.NeighborIndex.NORTH?[0,1]:P===v.NeighborIndex.NORTH_EAST?[1]:P===v.NeighborIndex.EAST?[1,3]:P===v.NeighborIndex.SOUTH_EAST?[3]:P===v.NeighborIndex.SOUTH?[2,3]:P===v.NeighborIndex.SOUTH_WEST?[2]:P===v.NeighborIndex.WEST?[0,2]:[0],N=V=>{const S=V.children;!R(V)&&S[0]&&W.forEach(X=>N(S[X]))};N(this)}getNeighborEdgeStartVertexIndex(P,R){if(!R)return 0;var W=this.level-R.level;C.internalAssert(!C.enableTerrainInternalChecks||
0<=W);if(0===W)return 0;W=2**W;var N=(P=1===(P&1))?0:1;R=R.lij[N+1]*W;N=this.lij[N+1];const V=N-R;P=P?W-1-V:V;C.enableTerrainInternalChecks&&(C.internalAssert(R<=N&&N<R+W),C.internalAssert(0<=P&&P<W));return P}forEachLoadedNeighbor(P){const R=this.level,W=N=>N.level===R||N.isLoaded;C.neighborEdgeIndices.forEach(N=>{const V=this.findNeighborTile(N,W);null!=V&&V!==this&&V.forAllSubtreeOnSide(C.oppositeEdge(N),S=>S.isLoaded?(P(S,N),!0):!1)});C.neighborCornerIndices.forEach(N=>{const V=this.findNeighborTile(N,
W)?.findCorner(C.oppositeCorner(N),S=>S.isLoaded);C.internalAssert(!V||B(this,V,N));V?.isLoaded&&P(V,N)})}getNeighborLIJ(P,R){const W=C.isNorth(R)?-1:C.isSouth(R)?1:0;R=C.isWest(R)?-1:C.isEast(R)?1:0;P=[P[0],P[1]+W,P[2]+R];return 0>P[1]?null:this.surface.isGlobal?this.wrapLIJ(P):0>P[2]?null:P}wrapLIJ(P){return!P||0>P[1]||P[1]>=2**P[0]?null:this.surface.wrapEastWest(P)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?
-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this.lij[2]}get isNorthEnd(){return 0===this.lij[1]}get isSouthEnd(){const P=this.surface.extent?.[1]??null;return null!=P&&this.extent[1]+l.getEpsilon()>=P}checkGeometryWaterproofness(){C.enableWaterproofnessTests&&(C.internalAssert(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(P){const R=this.extent,W=this.surface.rootTilesExtent,N=.25*(R[2]-R[0]);if(C.isNorth(P)&&
R[3]+N>=W[3]||C.isSouth(P)&&R[1]-N<=W[1])return!1;const V=this.surface.isGlobal;return!V&&C.isWest(P)&&R[0]-N<=W[0]||!V&&C.isEast(P)&&R[2]+N>=W[2]?!1:!0}updateDistanceToPOI(P){var R=this._lastPOI;if(!(0<=this.distanceToPOI&&R[0]===P[0]&&R[1]===P[1]&&R[2]===P[2])){f.copy(this._lastPOI,P);var W=this._center[a.CenterPosition.MIDDLE];R=P[0]-W[0];var N=P[1]-W[1];P=P[2]-W[2];this.distanceToPOI=R*R+N*N+P*P}}}const J=new d(y.MapTileAgent),M=new d(q.ElevationTileAgent),T=new n.ElevationBounds;a.CenterPosition=
void 0;(function(P){P[P.TOP=0]="TOP";P[P.MIDDLE=1]="MIDDLE";P[P.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));const Q=c.create(),O=c.create(),U=c.create(),Z=c.create();a.Tile=L;a.isCornerNeighbor=B;a.isEdgeNeighbor=function(P,R,W){if(null==P||null==R)return!1;if(0===P.level&&0===R.level&&(P.isEastEnd&&R.isWestEnd&&W===v.NeighborIndex.EAST||P.isWestEnd&&R.isEastEnd&&W===v.NeighborIndex.WEST))return!0;const N=Math.max(1E-6*(P.extent[2]-P.extent[0]),1);switch(W){case v.NeighborIndex.NORTH:return C.almostEquals(P.extent[3],
R.extent[1],N);case v.NeighborIndex.SOUTH:return C.almostEquals(P.extent[1],R.extent[3],N);case v.NeighborIndex.EAST:return C.almostEquals(P.extent[2],R.extent[0],N)||C.almostEquals(P.extent[2],-R.extent[0],N);case v.NeighborIndex.WEST:return C.almostEquals(P.extent[0],R.extent[2],N)||C.almostEquals(P.extent[0],-R.extent[2],N)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(a,
b,g){class d extends g.TileAgent{constructor(){super(...arguments);this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return b.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}a.ElevationTileAgent=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileAgent":function(){define(["exports","./interfaces","./TerrainConst","./terrainUtils","./tileUtils"],function(a,b,g,d,k){class m{get updating(){return!!this._tileRequested}init(e,
p,h,u){this.tile=e;this._layerIdx=p;this._layerClass=h;this._suspended=u;this._tileLayerInfo=e.getLayerInfo(p,h);this._tileRequested=null;e=this._findAncestorWithData();this._setUpsampleTile(e)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null}setSuspension(e){e!==this._suspended&&((this._suspended=e)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,
this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();this._setUpsampleTile(e);return this._requestNext()}dataArrived(e,p){this._setUpsampleTile(e,p);this._tileRequested=null;e===this.tile?this.tile.updateRenderData(this._layerClass,b.TextureUpdate.FADING,p):this._requestNext()}dataMissing(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass);
this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}null!=e?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone();return!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,p=this._layerClass;var h=this.tile.surface.layerViewByIndex(e,p),u=d.getLayerWithExtentRange(h);
const {minLevel:w,maxLevel:x}=h.dataLevelRange,n=this._desiredMinLevelDelta,q=this._progressiveLevelModulo+n,t=this._scaleRangeEnabled?k.fallsWithinLayer:()=>!0;let v=this.tile;const r=v.level;let y;const z=this._tileLayerInfo.upsampleInfo,D=null!=z?z.tile.level:-1,C=null!=z?D-r>=n:!1,E=u?.tilemapCache;for(h="vector-tile-3d"===h.type?h.schemaHelper:null;v&&t(v,u,!1)&&v.level>=w;){const A=v.level,F=r-A,G=v.layerInfo[p][e];if(G.data&&F>=n){(!C||A>D)&&this._setUpsampleTile(v);G.dataInvalidated&&(y=v);
break}const I=h?.getLevelRowColumn(v.lij)??v.lij;if("unavailable"!==E?.getAvailability(I[0],I[1],v.lij[2])&&A<=x&&!G.data&&!G.dataMissing){if(!y||v.level===w||0===A%g.progressiveLoadingModulo||r-y.level<n)y=v;if(F>=q)break}v=v.parent}null!=y&&r-y.level<n&&(z?y=null:(u=this._findAncestorWithData(),null!=u&&(this._setUpsampleTile(u),y=u.layerInfo[p][e].dataInvalidated?u:null)));return y}_findAncestorWithData(){const e=this.tile.elevationLevel,p=this._desiredMinLevelDelta;let h;for(let u=this.tile;u;u=
u.parent)if(u.hasLayerData(this._layerIdx,this._layerClass)){if(e-u.level>=p)return u;h=u}return h}_setUpsampleTile(e,p){this._tileLayerInfo.setUpsampleInfo(this.tile,e);this.tile.updateRenderData(this._layerClass,b.TextureUpdate.FADING,p)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class f extends m{get _desiredMinLevelDelta(){throw c;}get _progressiveLevelModulo(){throw c;}dispose(){}}const c=Error("Abstract method called on TileAgent"),l=
new f;a.TileAgent=m;a.tileAgentDone=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../core/PooledArray","./RenderOrder"],function(a,b,g){function d(w,x){x(w);if(!w.isLeaf)for(const n of w.children)d(n,x)}function k(w,x){w=w.lij;x=x.lij;return w[0]-x[0]||w[1]-x[1]||w[2]-x[2]}function m(w,x){const n=x.screenDepth-w.screenDepth;if(0!==n)return n;w=w.lij;x=x.lij;return w[0]-x[0]||w[1]-x[1]||w[2]-x[2]}function f(w,
x){const n=w.screenDepth-x.screenDepth;if(0!==n)return n;w=w.lij;x=x.lij;return w[0]-x[0]||w[1]-x[1]||w[2]-x[2]}function c(w,x,n){const q=w.screenDepth,t=x.screenDepth;return q<t?-n:q>t?n:k(w,x)}function l(w,x,n,q){const t=e(w,q);q=e(x,q);return t===q?c(w,x,n):w?n:-n}function e(w,x){for(const n of x)if(w.intersectsExtent(n))return!0;return!1}function p(w,x){const n=w.distanceToPOI-x.distanceToPOI;if(0!==n)return n;w=w.lij;x=x.lij;return w[0]-x[0]||w[1]-x[1]||w[2]-x[2]}class h{constructor(){this._queue=
new b;this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(w){this._queue.clear();this._queue.push(w);this._last=void 0}reset(w=null){this._queue.clear();null!=w&&this._queue.pushArray(w);this._last=void 0}skipSubtree(){this._last=void 0}next(){const w=this._last?.children;w?.[0]&&this._queue.pushArray(w);return this._last=this._queue.pop()}}class u{constructor(){this._q=new b}get done(){return 0===this._q.length}reset(w){this._q.clear();if(null!=
w)for(this._q.pushArray(w),w=0;w<this._q.length;++w){const x=this._q.data[w];x.isLeaf||this._q.pushArray(x.children)}}next(){return this._q.pop()}}a.IteratorPostorder=u;a.IteratorPreorder=h;a.compareTiles=c;a.compareTilesByLij=k;a.compareTilesWithStencil=l;a.computeUpsampleInfo=function(w,x,n){let q=1,t=0,v=0;for(;w!==x;)if(q*=.5,t*=.5,v*=.5,w.lij[2]&1&&(t+=.5),0===(w.lij[1]&1)&&(v+=.5),w=w.parent,null==w)throw Error("tile was not a descendant of upsampleTile");n.init(x,t,v,q)};a.fallsWithinLayer=
function(w,x,n){if(null==x?.fullExtent)return!1;const q=x.fullExtent,t=w.extent;if(n){if(t[0]<q.xmin||t[1]<q.ymin||t[2]>q.xmax||t[3]>q.ymax)return!1}else if(q.xmin>t[2]||q.ymin>t[3]||q.xmax<t[0]||q.ymax<t[1])return!1;w=w.surface.tilingScheme.levels[w.level].scale;n=x.minScale;if(0<n&&w>1.00000001*n)return!1;x=x.maxScale;return 0<x&&w<.99999999*x?!1:!0};a.hasLoadableSiblings=function(w){for(let x=0;x<w.length;x++){const n=w[x],q=n.parent;if(q)for(let t=0;4>t;t++){const v=q.children[t];if(v&&v!==n)return!0}}return!1};
a.sortTiles=function(w,x,n=null){null==n||0===n.length?w===g.RenderOrder.BACK_TO_FRONT?x.sort(m):x.sort(f):x.sort((q,t)=>l(q,t,w,n))};a.sortTilesByPOI=function(w,x){const n=w.length;for(let q=0;q<n;++q)w.at(q).updateDistanceToPOI(x);w.sort(p)};a.tilesAreRelated=function(w,x){if(!w||!x||w[0]===x[0])return!1;const n=w[0]<x[0],q=n?w:x;w=n?x:w;x=1<<w[0]-q[0];return Math.floor(w[1]/x)===q[1]&&Math.floor(w[2]/x)===q[2]};a.traverseTilesPreorder=function(w,x){if(Array.isArray(w))for(let n=0;n<w.length;n++)d(w[n],
x);else d(w,x)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(a,b,g){class d extends g.TileAgent{constructor(){super();
this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return b.progressiveLoadingModulo}}a.MapTileAgent=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterTile":function(){define(["exports","../../../core/maybe","../../../chunks/RasterColorizer.glsl","../../webgl/enums","../../webgl/rasterUtils"],function(a,b,g,d,k){const m={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,
1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class f{constructor(c,l,e=null,p=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.lij=c;this.source=l;this.width=e||l.width;this.height=p||l.height}get source(){return this._source}set source(c){this._source=
c;this._rasterTexture=b.disposeMaybe(this._rasterTexture);this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...m,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||m}set symbolizerParameters(c){this._symbolizerParameters=c}get bandIds(){return this._bandIds}set bandIds(c){null!=c&&0<c.length?this._bandIds&&c.every((l,e)=>this._bandIds?.[e]?l===this._bandIds[e]:!1)||(this._bandIds=c,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||
"nearest"}set interpolation(c){this._interpolation=c;null!=this._rasterTexture&&(c=this._getRasterTextureInterpolation(c),this._rasterTexture.setSamplingMode("bilinear"===c?d.TextureSamplingMode.LINEAR:d.TextureSamplingMode.NEAREST))}get transformGrid(){return this._transformGrid}set transformGrid(c){this._transformGrid=c;this._transformGridTexture=b.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}bind(c){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;(null==
this._rasterTexture||this._dirty)&&this._updateRasterTexture(c,this.bandIds);null!=this._rasterTexture&&(this._updateColormapTexture(c),this.transformGrid&&null==this._transformGridTexture&&(this._transformGridTexture=k.createTransformTexture(c,this.transformGrid)));return!0}getUniforms(){const {symbolizerParameters:c,transformGrid:l,width:e,height:p,opacity:h}=this,u=k.getCommonUniforms(l,[e,p],[this.source.width,this.source.height],h),w=k.getColormapUniforms(c.colormap,c.colormapOffset),x="stretch"===
this.symbolizerParameters.type?k.getStretchUniforms(this.symbolizerParameters):null,n="hillshade"===this.symbolizerParameters.type?k.getShadedReliefUniforms(this.symbolizerParameters):null;return new g.ColorizerUniforms(u,w,x||n,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const {symbolizerParameters:c}=this;return"bilinear"===this.interpolation&&null!=c.colormap&&"stretch"===c.type}get memoryUsage(){null==this._memoryUsed&&(this._memoryUsed=
[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(c=>null!=c?c.descriptor.width*c.descriptor.height*4:0).reduce((c,l)=>c+l,0));return this._memoryUsed}release(){this._rasterTexture=b.disposeMaybe(this._rasterTexture);this._transformGridTexture=b.disposeMaybe(this._transformGridTexture);this._colormapTexture=b.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0}_updateRasterTexture(c,l){const e=this.source?this.source.extractBands(l):
null;e&&e.pixels&&0<e.pixels.length?(l=null==l&&null==this.bandIds||null!=l&&null!=this.bandIds&&l.join("")===this.bandIds.join(""),null!=this._rasterTexture&&l||(this._rasterTexture=b.disposeMaybe(this._rasterTexture),l=this._getRasterTextureInterpolation(this.interpolation),this._rasterTexture=k.createRasterTexture(c,e,l,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=b.disposeMaybe(this._rasterTexture)}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&
"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(c){return"lut"===this.symbolizerParameters.type||"nearest"===c||"majority"===c||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(c){const l=this._colormap,e=this.symbolizerParameters.colormap;if(!e)this._colormapTexture=b.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!l)this._colormapTexture=k.createColormapTexture(c,
e),this._colormap=e;else if(e.length!==l.length||e.some((p,h)=>p!==l[h]))this._colormapTexture=b.disposeMaybe(this._colormapTexture),this._colormapTexture=k.createColormapTexture(c,e),this._colormap=e}}a.RasterTile=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ./vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n){function q(C){const E=new x.ShaderBuilder;E.include(f.TileComposite);E.include(k.Common,C);E.include(d.Colormap,C);E.include(m.TileBackground,C);E.fragment.code.add(w.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`);C.colorizerType===g.RasterColorizerType.Stretch?t(E,C):C.colorizerType===g.RasterColorizerType.Lut?E.fragment.code.add(w.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):C.colorizerType===g.RasterColorizerType.Hillshade&&v(E,C);return E}function t(C,E){C.fragment.uniforms.add(new u.IntegerPassUniform("u_bandCount",F=>F.symbolizer.u_bandCount),new h.FloatsPassUniform("u_minCutOff",F=>F.symbolizer.u_minCutOff,3),new h.FloatsPassUniform("u_maxCutOff",F=>F.symbolizer.u_maxCutOff,3),new h.FloatsPassUniform("u_factor",F=>F.symbolizer.u_factor,3),new p.FloatPassUniform("u_minOutput",F=>F.symbolizer.u_minOutput),new p.FloatPassUniform("u_maxOutput",F=>F.symbolizer.u_maxOutput),
new l.BooleanPassUniform("u_useGamma",F=>F.symbolizer.u_useGamma),new h.FloatsPassUniform("u_gamma",F=>F.symbolizer.u_gamma,3),new h.FloatsPassUniform("u_gammaCorrection",F=>F.symbolizer.u_gammaCorrection,3),new p.FloatPassUniform("u_opacity",F=>F.common.u_opacity));C.fragment.code.add(w.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const A=E.applyColormap?w.glsl`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:w.glsl`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;C.fragment.code.add(w.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${E.stretchType===g.RasterColorizerStretchType.Noop?w.glsl`
        fragColor = applyBackgroundBlend(currentPixel);`:w.glsl`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${A}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function v(C,E){C=C.fragment;C.uniforms.add(new n.Texture2DPassUniform("u_image",A=>A.u_image),new u.IntegerPassUniform("u_hillshadeType",A=>A.symbolizer.u_hillshadeType),new h.FloatsPassUniform("u_sinZcosAs",A=>A.symbolizer.u_sinZcosAs,6),new h.FloatsPassUniform("u_sinZsinAs",A=>A.symbolizer.u_sinZsinAs,6),new h.FloatsPassUniform("u_cosZs",A=>A.symbolizer.u_cosZs,6),new h.FloatsPassUniform("u_weights",A=>A.symbolizer.u_weights,6),new e.Float2PassUniform("u_factor",A=>A.symbolizer.u_factor),
new p.FloatPassUniform("u_minValue",A=>A.symbolizer.u_minValue),new p.FloatPassUniform("u_maxValue",A=>A.symbolizer.u_maxValue),new e.Float2PassUniform("u_srcImageSize",A=>A.common.u_srcImageSize));C.include(c.ColorConversion);C.code.add(w.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`);C.code.add(w.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);E=E.applyColormap?w.glsl`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:w.glsl`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;C.code.add(w.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${E}
    }
  `)}class r extends k.CommonPassParameters{constructor(C,E,A,F,G,I){super(C,F,G);this.colormap=E;this.symbolizer=A;this.u_colormap=I;this.backgroundColor=b.ZEROS;this.fboTexture=null;this.baseOpacity=1}}class y extends r{}class z extends r{}const D=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:z,ColorizerStretchUniforms:y,ColorizerUniforms:r,build:q},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=z;a.ColorizerStretchUniforms=y;a.ColorizerUniforms=
r;a.RasterColorizer=D;a.build=q})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,g,d){a.Colormap=function(k){k.fragment.uniforms.add(new d.Texture2DPassUniform("u_colormap",m=>m.u_colormap),new b.FloatPassUniform("u_colormapOffset",m=>m.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",m=>m.colormap.u_colormapMaxIndex),
new b.FloatPassUniform("u_opacity",m=>m.common.u_opacity));k.fragment.code.add(g.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,g,d,k,m,f){class c extends g.TileCompositePassParameters{constructor(l,e,p){super();this.common=l;this.u_image=e;this.u_transformGrid=
p}}a.Common=function(l,e){l.include(b.Projection);l.fragment.uniforms.add(new f.Texture2DPassUniform("u_image",p=>p.u_image),new d.BooleanPassUniform("u_flipY",p=>p.common.u_flipY),new d.BooleanPassUniform("u_applyTransform",p=>p.common.u_applyTransform));({requireBilinearWithNN:e}=e);e&&l.fragment.uniforms.add(new k.Float2PassUniform("u_srcImageSize",p=>p.common.u_srcImageSize));l.fragment.code.add(m.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`);e?l.fragment.code.add(m.glsl`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):l.fragment.code.add(m.glsl`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)};a.CommonPassParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,g,d){a.Projection=function(k){k.fragment.uniforms.add(new d.Texture2DPassUniform("u_transformGrid",m=>m.u_transformGrid),new b.Float2PassUniform("u_transformSpacing",m=>m.common.u_transformSpacing),
new b.Float2PassUniform("u_targetImageSize",m=>m.common.u_targetImageSize));k.fragment.code.add(g.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,g,d,k,m){class f extends k.NoParameters{constructor(){super(...arguments);this.scale=1;this.offset=b.ZEROS}}a.TileComposite=function(c){c.attributes.add(m.VertexAttribute.POSITION,
"vec2");c.attributes.add(m.VertexAttribute.UV0,"vec2");c.vertex.uniforms.add(new d.FloatPassUniform("scale",l=>l.scale));c.vertex.uniforms.add(new g.Float2PassUniform("offset",l=>l.offset));c.varyings.add("uv","vec2");c.varyings.add("vuv","vec2");c.vertex.code.add(k.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../chunks/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ../util/BlendModes.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,g,d,k,m,f,c,l){a.BlendLayersOutput=
void 0;(function(p){p[p.Composite=0]="Composite";p[p.ColorComposite=1]="ColorComposite";p[p.GridComposite=2]="GridComposite";p[p.GroupBackgroundComposite=3]="GroupBackgroundComposite";p[p.COUNT=4]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(p){p[p.NotRequired=0]="NotRequired";p[p.Required=1]="Required";p[p.COUNT=2]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));a.PremultipliedAlphaSource=void 0;(function(p){p[p.Off=0]="Off";p[p.On=1]="On";p[p.COUNT=
2]="COUNT"})(a.PremultipliedAlphaSource||(a.PremultipliedAlphaSource={}));class e extends c.NoParameters{constructor(){super(...arguments);this.baseOpacity=1;this.backgroundColor=b.ZEROS;this.fboTexture=null}}a.TileBackground=function(p,h){const u=h.output===a.BlendLayersOutput.GridComposite,w=h.output===a.BlendLayersOutput.ColorComposite,x=h.output===a.BlendLayersOutput.GroupBackgroundComposite,n=h.output===a.BlendLayersOutput.Composite;u&&p.fragment.include(d.BackgroundGrid);w&&p.fragment.uniforms.add(new m.Float3PassUniform("backgroundColor",
r=>r.backgroundColor));const q=h.baseOpacityMode===a.BaseOpacityMode.Required;q&&p.fragment.uniforms.add(new f.FloatPassUniform("baseOpacity",r=>r.baseOpacity));n&&p.fragment.uniforms.add(new l.Texture2DPassUniform("fboColor",r=>r.fboTexture));const t=h.blendMode!==g.LayerBlendMode.Normal,v=h.premultipliedSource===a.PremultipliedAlphaSource.On;p.fragment.include(k.BlendModes,h);p.fragment.code.add(c.glsl`
    vec4 getBackground(vec2 uv) {
      return ${q?c.glsl`baseOpacity *`:""} ${x?c.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:w?c.glsl`vec4(backgroundColor, 1.0)`:u?c.glsl`vec4(gridColor(uv), 1.0)`:c.glsl`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${t?c.glsl`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:c.glsl`
          float composeAlpha = colorLayer.a * opacity;
          return ${!v&&(n&&!q||x)?c.glsl`colorLayer * opacity;`:c.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)};a.TileBackgroundPassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";b[b.ColorBurn=9]="ColorBurn";
b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";b[b.Xor=25]="Xor";b[b.Difference=
26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString={normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,
"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,
"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||
b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(g){g.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,g){a.BlendModes=function(d,k){k=k.blendMode;if(k!==b.LayerBlendMode.Normal){k===b.LayerBlendMode.Reflect&&d.code.add(g.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);k!==b.LayerBlendMode.ColorDodge&&k!==b.LayerBlendMode.VividLight||d.code.add(g.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);k!==b.LayerBlendMode.ColorBurn&&k!==b.LayerBlendMode.VividLight||d.code.add(g.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);k===b.LayerBlendMode.Overlay&&d.code.add(g.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);k===b.LayerBlendMode.HardLight&&d.code.add(g.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);k===b.LayerBlendMode.SoftLight&&d.code.add(g.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);k===b.LayerBlendMode.VividLight&&d.code.add(g.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(k===b.LayerBlendMode.Hue||k===b.LayerBlendMode.Saturation||k===b.LayerBlendMode.Color||k===b.LayerBlendMode.Luminosity)d.code.add(g.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),k!==b.LayerBlendMode.Hue&&k!==b.LayerBlendMode.Saturation||d.code.add(g.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);d.code.add(g.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${k===b.LayerBlendMode.Multiply?g.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Average?g.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Lighten?g.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Darken?g.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
k===b.LayerBlendMode.Lighter?g.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:k===b.LayerBlendMode.Plus?g.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:k===b.LayerBlendMode.Minus?g.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:k===b.LayerBlendMode.Screen?g.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Difference?g.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
k===b.LayerBlendMode.Invert?g.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:k===b.LayerBlendMode.DestinationOver?g.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:k===b.LayerBlendMode.DestinationAtop?g.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:k===b.LayerBlendMode.DestinationOut?g.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:k===b.LayerBlendMode.SourceAtop?g.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:k===b.LayerBlendMode.SourceOut?
g.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:k===b.LayerBlendMode.Xor?g.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:k===b.LayerBlendMode.DestinationIn?g.glsl`return vec4(cb * ob * ol, ol * ob);`:k===b.LayerBlendMode.SourceIn?g.glsl`return vec4(cl * ol * ob, ol * ob);`:k===b.LayerBlendMode.Hue?g.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Saturation?g.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Color?g.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Luminosity?g.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Exclusion?g.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Reflect?g.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.ColorDodge?g.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.ColorBurn?g.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Overlay?g.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.SoftLight?g.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.HardLight?g.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.VividLight?g.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:g.glsl``}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../chunks/vec2f64 ./contextUtils ./enums ./Texture ./TextureDescriptor".split(" "),function(a,b,g,d,k,m){a.createColormapTexture=function(f,c){const l=new m.TextureDescriptor;l.internalFormat=d.PixelFormat.RGBA;l.width=c.length/4;l.height=1;l.samplingMode=d.TextureSamplingMode.NEAREST;l.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;return new k.Texture(f,l,c)};a.createRasterTexture=
function(f,c,l="nearest",e=!1){const p=(e=!(e&&"u8"===c.pixelType))?d.PixelType.FLOAT:d.PixelType.UNSIGNED_BYTE,h=null==c.pixels||0===c.pixels.length?null:e?c.getAsRGBAFloat():c.getAsRGBA(),u=f.capabilities.textureFloat?.textureFloatLinear,w=new m.TextureDescriptor;w.width=c.width;w.height=c.height;w.internalFormat=f.type===g.ContextType.WEBGL2&&e?d.SizedPixelFormat.RGBA32F:d.PixelFormat.RGBA;w.samplingMode=!u||"bilinear"!==l&&"cubic"!==l?d.TextureSamplingMode.NEAREST:d.TextureSamplingMode.LINEAR;
w.dataType=p;w.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;return new k.Texture(f,w,h)};a.createTransformTexture=function(f,c){const {spacing:l,offsets:e,coefficients:p,size:[h,u]}=c;var w=1<l[0];c=new m.TextureDescriptor;c.width=w?4*h:h;c.height=u;c.internalFormat=f.type===g.ContextType.WEBGL2?d.SizedPixelFormat.RGBA32F:d.PixelFormat.RGBA;c.dataType=d.PixelType.FLOAT;c.samplingMode=d.TextureSamplingMode.NEAREST;c.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const x=new Float32Array(w?h*u*16:2*e.length);
if(w&&null!=p)for(let n=0,q=0;n<p.length;n++)x[q++]=p[n],2===n%3&&(x[q++]=1);else for(w=0;w<u;w++)for(let n=0;n<h;n++){const q=4*(w*h+n),t=2*(n*u+w);x[q]=e[t];x[q+1]=e[t+1];x[q+3]=-1===e[t]?0:1}return new k.Texture(f,c,x)};a.getBasicGridUniforms=function(f,c){return{u_scale:f,u_offset:c}};a.getColormapUniforms=function(f,c){return{u_colormapOffset:c||0,u_colormapMaxIndex:f?f.length/4-1:0}};a.getCommonUniforms=function(f,c,l,e=1,p=!0){return{u_flipY:p,u_applyTransform:!!f,u_opacity:e,u_transformSpacing:f?
f.spacing:b.ZEROS,u_transformGridSize:f?f.size:b.ZEROS,u_targetImageSize:c,u_srcImageSize:l}};a.getShadedReliefUniforms=function(f){return{u_hillshadeType:f.hillshadeType,u_sinZcosAs:f.sinZcosAs,u_sinZsinAs:f.sinZsinAs,u_cosZs:f.cosZs,u_weights:f.weights,u_factor:f.factor,u_minValue:f.minValue,u_maxValue:f.maxValue}};a.getStretchUniforms=function(f){return{u_bandCount:f.bandCount,u_minOutput:f.outMin,u_maxOutput:f.outMax,u_minCutOff:f.minCutOff,u_maxCutOff:f.maxCutOff,u_factor:f.factor,u_useGamma:f.useGamma,
u_gamma:f.gamma,u_gammaCorrection:f.gammaCorrection}};a.getUniformLocationInfos=function(f,c){f=f.gl;c=c.glName;const l=new Map;if(null==c)return l;const e=f.getProgramParameter(c,f.ACTIVE_UNIFORMS);let p;for(let h=0;h<e;h++)(p=f.getActiveUniform(c,h))&&l.set(p.name,{location:f.getUniformLocation(c,p.name),info:p});return l};a.setTextures=function(f,c,l,e){l.length===e.length&&(e.some(p=>null==p)||l.some(p=>null==p)||l.forEach((p,h)=>{c.setUniform1i(p,h);f.bindTexture(e[h],h)}))};a.setUniforms=function(f,
c,l){Object.keys(l).forEach(e=>{var p=c.get(e)||c.get(e+"[0]");if(p){var h=l[e];if(null!==p&&null!=h)switch({info:p}=p,p.type){case d.UniformType.FLOAT:1<p.size?f.setUniform1fv(e,h):f.setUniform1f(e,h);break;case d.UniformType.FLOAT_VEC2:f.setUniform2fv(e,h);break;case d.UniformType.FLOAT_VEC3:f.setUniform3fv(e,h);break;case d.UniformType.FLOAT_VEC4:f.setUniform4fv(e,h);break;case d.UniformType.FLOAT_MAT3:f.setUniformMatrix3fv(e,h);break;case d.UniformType.FLOAT_MAT4:f.setUniformMatrix4fv(e,h);break;
case d.UniformType.INT:1<p.size?f.setUniform1iv(e,h):f.setUniform1i(e,h);break;case d.UniformType.BOOL:f.setUniform1i(e,h?1:0);break;case d.UniformType.INT_VEC2:case d.UniformType.BOOL_VEC2:f.setUniform2iv(e,h);break;case d.UniformType.INT_VEC3:case d.UniformType.BOOL_VEC3:f.setUniform3iv(e,h);break;case d.UniformType.INT_VEC4:case d.UniformType.BOOL_VEC4:f.setUniform4iv(e,h)}}})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),
function(a,b,g,d,k,m){class f{constructor(){this.waitingAgents=new d;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}static acquire(e){const p=c.acquire();p._init(e);return p}release(){this.dispose();l.delete(this);c.release(this)}dispose(){this.loadingAgent=b.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=k.releaseTileData(this._data)}static prune(){c.prune(0)}_init(e){this.waitingAgents.clear();
this._data=k.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=e;this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=b.abortMaybe(this.requestAbort);this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){null!=this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),
this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,p){if(e===p||null==p)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===p)return;this._upsampleInfo.tile.unrefMapData()}p.refMapData();m.computeUpsampleInfo(e,p,this._upsampleInfo)}}get data(){return this._data}set data(e){k.releaseTileData(this._data);this._data=e}}const c=new g(f,null,()=>{}),l=new Map;a.TilePerLayerInfo=f;a.printAllocations=
function(){0<l.size&&(console.log(`${l.size} live TilePerLayerInfo allocations:`),l.forEach(e=>console.log(e,"\n")))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileTexture":function(){define(function(){class a{constructor(b,g){this._texture=b;this._cache=g;this.type="tile-texture";this._refCount=1}retain(){++this._refCount}release(){--this._refCount;0===this._refCount&&(this._cache?this._cache.put(`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`,
this):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.gpuMemoryUsage}}return a})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.SPLIT=1]="SPLIT";b[b.ELEVATION=2]="ELEVATION";b[b.MERGE=4]="MERGE";b[b.RENDERDATA=8]="RENDERDATA";
b[b.GEOMETRY=16]="GEOMETRY";b[b.TEXTURE_NOFADING=32]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=64]="TEXTURE_FADING";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/vec4f64"],function(a){class b{constructor(){this._scales=a.fromValues(-1,-1,-1,-1);this._offsets=a.fromValues(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=
this._offsets[3]=-1}setScale(g,d,k){this._scales[2*g]=d;this._scales[2*g+1]=k}setOffset(g,d,k){this._offsets[2*g]=d;this._offsets[2*g+1]=k}get scales(){return this._scales}get offsets(){return this._offsets}}return b})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){class u extends m.ShaderTechnique{constructor(){super(...arguments);this.useStencil=!1}initializeConfiguration(x,n){n.spherical=x.viewingMode===g.ViewingMode.Global}initializeProgram(x){return new c.Program(x.rctx,u.shader.get().build(this.configuration),w)}initializePipeline(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)}_createPipeline(x){const n=this.configuration,q=n.backfaceCullingEnabled&&!n.renderOccluded;return h.makePipelineState({blending:n.renderOccluded?
h.simpleBlendingParams(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:q?h.backFaceCullingParams:null,depthTest:n.renderOccluded?null:{func:p.CompareFunction.LESS},depthWrite:n.renderOccluded?null:h.defaultDepthWriteParams,colorWrite:h.defaultColorWriteParams,stencilTest:x?l.renderWhenBitIsNotSet(f.StencilBits.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}u.shader=new k.ReloadableShaderModule(d.Terrain,()=>
new Promise((x,n)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],x,n)));const w=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.UV0,1],[e.VertexAttribute.NORMALCOMPRESSED,2]]);b.TerrainTechnique=u;b.terrainVertexAttributeLocations=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Terrain.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H){function B(M){const T=new I.ShaderBuilder,{vertex:Q,fragment:O,varyings:U}=T;T.include(h.PositionAttribute);T.include(p.NormalAttribute,M);T.include(u.TextureCoordinateAttribute,M);var Z=()=>{T.include(r.NormalUtils,M);Q.code.add(F.glsl`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};E.addProjViewLocalOrigin(Q,M);T.include(e.Transform,M);const P=M.overlayMode!==D.OverlayMode.Disabled;var R=P&&M.invisible;switch(M.output){case c.ShaderOutput.Color:T.include(C.TerrainTexture,M);T.include(t.EvaluateSceneLighting,M);P&&T.include(D.OverlayTerrain,{...M,pbrMode:M.pbrMode===y.PBRMode.Terrain?y.PBRMode.TerrainWithWater:y.PBRMode.Water});(R=M.overlayMode===D.OverlayMode.EnabledWithWater)&&T.include(w.VertexTangent,M);U.add("vnormal","vec3");U.add("vpos","vec3");U.add("vup","vec3");
Z();M.screenSizePerspective&&E.addViewNormal(Q);(Z=M.receiveShadows&&!M.renderOccluded)&&T.include(f.ForwardLinearDepth,M);M.screenSizePerspective&&(U.add("screenSizeDistanceToCamera","float"),U.add("screenSizeCosAngle","float"));Q.code.add(F.glsl`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${R?F.glsl`forwardVertexTangent(vnormal);`:F.glsl``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${P?F.glsl`setOverlayVTC(uv);`:""}
          ${M.tileBorders?F.glsl`forwardTextureCoordinates();`:""}

          ${M.screenSizePerspective?F.glsl`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${Z?F.glsl`forwardLinearDepth();`:""}

        }
      `);T.include(l.SliceDraw,M);T.include(t.EvaluateSceneLighting,M);T.include(q.EvaluateAmbientOcclusion,M);T.include(z.ReadShadowMapDraw,M);E.addCameraPosition(O,M);t.addAmbientBoostFactor(O);t.addLightingGlobalFactor(O);O.uniforms.add(Q.uniforms.get("localOrigin"),new A.Float3PassUniform("viewDirection",(W,N)=>d.normalize(J,d.set(J,N.camera.viewMatrix[12],N.camera.viewMatrix[13],N.camera.viewMatrix[14]))));R&&O.uniforms.add(new H.Texture2DPassUniform("ovWaterTex",(W,N)=>N.overlay?.getTexture(m.OverlayContent.WaterNormal)),
new G.Matrix4DrawUniform("view",(W,N)=>b.translate(L,N.camera.viewMatrix,W.origin)));O.code.add(F.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);v.addMainLightDirection(O);v.addMainLightIntensity(O);O.code.add(F.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${M.receiveShadows&&!M.renderOccluded?"readShadowMap(vpos, linearDepth)":M.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${P?F.glsl`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${M.invisible?F.glsl`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${M.pbrMode===y.PBRMode.Terrain||M.pbrMode===y.PBRMode.TerrainWithWater?F.glsl`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:F.glsl`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${R?F.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${M.screenSizePerspective?F.glsl`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${M.visualizeNormals?M.spherical?F.glsl`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:F.glsl`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${M.tileBorders?F.glsl`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `);break;case c.ShaderOutput.Depth:R&&T.include(D.OverlayTerrain,M);T.include(x.OutputDepth,M);f.addLinearDepth(T);f.addNearFar(T);Q.code.add(F.glsl`
              void main(void) {
                ${R?F.glsl`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `);O.code.add(F.glsl`
              void main() {
                ${R?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExcludeHighlight:T.include(x.OutputDepth,M);f.addLinearDepth(T);f.addNearFar(T);Q.code.add(F.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`);O.code.add(F.glsl`void main() {
outputDepth(linearDepth);
}`);break;case c.ShaderOutput.Normal:R&&T.include(D.OverlayTerrain,M);U.add("vnormal","vec3");E.addViewNormal(Q);Z();Q.code.add(F.glsl`
            void main(void) {
              ${R?F.glsl`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `);O.code.add(F.glsl`
            void main() {
              ${R?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case c.ShaderOutput.Highlight:P&&T.include(D.OverlayTerrain,M),Q.code.add(F.glsl`
          void main() {
            ${P?F.glsl`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),T.include(n.OutputHighlight,M),O.code.add(F.glsl`
          void main() {
            ${P?F.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}M.output===c.ShaderOutput.ObjectAndLayerIdColor&&(P?(T.include(D.OverlayTerrain,{...M,pbrMode:y.PBRMode.Disabled}),Q.code.add(F.glsl`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),O.code.add(F.glsl`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(Q.code.add(F.glsl`void main(void) {}`),O.code.add(F.glsl`void main() {
fragColor = vec4(0.0);
}`)));return T}class K extends C.OverlayTerrainPassParameters{}const L=g.create(),J=k.create();g=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:K,build:B},Symbol.toStringTag,{value:"Module"}));a.Terrain=g;a.TerrainPassParameters=K;a.build=B})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.VertexTangent=function(g,d){g.varyings.add("tbnTangent","vec3");g.varyings.add("tbnBiTangent",
"vec3");d.spherical?g.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):g.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);g.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../shading/ReadShadowMap.glsl ./BackgroundGrid.glsl ./TileBlendInput ../../shaderModules/interfaces ../../shaderModules/Uniform".split(" "),function(a,b,g,d,k,m){class f extends b.ReadShadowMapPassParameters{constructor(){super(...arguments);this.overlayOpacity=1}}class c extends m.Uniform{constructor(h){super(h,"float")}}class l extends m.Uniform{constructor(h){super(h,
"vec3")}}class e extends m.Uniform{constructor(h){super(h,"vec4")}}class p extends m.Uniform{constructor(h){super(h,"sampler2D")}}a.Float3Uniform=l;a.OverlayTerrainPassParameters=f;a.TerrainTexture=function(h,u){const {vertex:w,fragment:x,varyings:n}=h;n.add("vtc","vec2");w.uniforms.add(new e("texOffsetAndScale"));x.uniforms.add(new p("tex"));x.uniforms.add(new l("textureOpacities"));if(h=u.textureFadingEnabled&&!u.renderOccluded)w.uniforms.add(new e("nextTexOffsetAndScale")),n.add("nvtc","vec2"),
x.uniforms.add(new p("texNext")),x.uniforms.add(new l("nextTexOpacities")),x.uniforms.add(new c("fadeFactor"));const q=u.tileBlendInput===d.TileBlendInput.ColorComposite;(u=u.tileBlendInput===d.TileBlendInput.GridComposite)&&x.include(g.BackgroundGrid);q&&x.uniforms.add(new l("backgroundColor"));w.code.add(k.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${h?k.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:k.glsl``}
  }`);x.code.add(k.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${u||q?k.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${q?k.glsl`backgroundColor`:k.glsl`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:k.glsl`return color;`}
    }`);h?x.code.add(k.glsl`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):x.code.add(k.glsl`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)};a.Texture2DUniform=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4 ../../../chunks/vec4f64".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){class u{constructor(){this.extent=h.create();this.maxLevel=this.minLevel=0;this.callback=null}}a.ScaleRangeQueries=class extends g{constructor(){super(...arguments);this._queries=new k({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new k({initialSize:30});this._queryPool=new d(u)}queryVisibleLevelRange(w,x,n,q){const t=this._queryPool.acquire();p.copy(t.extent,w);t.minLevel=null==x?-Number.MAX_VALUE:x;t.maxLevel=null==n?Number.MAX_VALUE:n;t.callback=q;this._queryQueue.push(t);
this.notifyChange("updating")}get updating(){return 0!==this._queryQueue.length}prepare(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const w=this._queryQueue.pop();this._queries.push(w)}this._queriesInvPtr=this._queries.length}process(){for(let w=0;w<this._queries.length;w++){const x=this._queries.data[w];this._queryPool.release(x);x.callback(w>=this._queriesInvPtr);x.callback=null}this._queries.clear();this.notifyChange("updating")}queriesForTile(w){const x=
w.level;let n=0;for(;n<this._queriesInvPtr;){const q=this._queries.data[n],t=q.extent;x>=q.minLevel&&x<=q.maxLevel&&t[0]<=w.extent[2]&&t[2]>=w.extent[0]&&t[1]<=w.extent[3]&&t[3]>=w.extent[1]?(this._queries.swapElements(n,this._queriesInvPtr-1),this._queriesInvPtr--):n++}}};b.__decorate([m.property()],a.ScaleRangeQueries.prototype,"updating",null);a.ScaleRangeQueries=b.__decorate([e.subclass("esri.views.3d.terrain.ScaleRangeQueries")],a.ScaleRangeQueries);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection/lonLatToSphericalPCPF ../../../geometry/support/DoubleArray ../../../geometry/support/frustum ../../../chunks/sphere ./interfaces ./ITile ./PatchGeometryFactory ./terrainUtils ./Tile ./tileUtils".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(z,D,C,E,A,F){z=E-z;D=A-D;C=F-C;return z*z+D*D+C*C}class n extends u.Tile{constructor(z,
D,C,E,A){super();this._convexHull=Array(24);this._boundingSphere=c.create();this._baseUsedMemory=1816;this.init(z,D,C,E,A)}init(z,D,C,E,A){super.init(z,D,C,E,A);D=this.ellipsoid.radius;C=this.extentInRadians[0];E=this.extentInRadians[1];A=this.extentInRadians[2];const F=this.extentInRadians[3],G=b.lerp(E,F,.5),I=b.lerp(C,A,.5);this._edgeLen=(A-C)*Math.cos(0===z?0:Math.min(Math.abs(E),Math.abs(F)))*D;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=D-Math.sqrt(D*D-this._edgeLen2/4);
k.lonLatToSphericalPCPF(this.centerAtSeaLevel,I,G,this.ellipsoid.radius);g.normalize(this.up,this.centerAtSeaLevel);this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const z=this._center;if(0===this.lij[0])g.set(z[u.CenterPosition.MIDDLE],0,0,0),g.set(z[u.CenterPosition.TOP],0,0,0),g.set(z[u.CenterPosition.BOTTOM],0,0,0),z[u.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const F=z[u.CenterPosition.MIDDLE],G=this.convexHull;
var D=0;for(let I=0;8>I;++I){var C=Math,E=C.max;var A=3*I;A=x(F[0],F[1],F[2],G[A],G[A+1],G[A+2]);D=E.call(C,D,A)}z[u.CenterPosition.MIDDLE][3]=Math.sqrt(D)}}_calculateFrustumVisibilityStatus(z){if(!f.intersectsSphere(z,this._boundingSphere))return e.TileFrustumVisibility.OUTSIDE;if(10>this.lij[0])return e.TileFrustumVisibility.INTERSECTS;const D=this.convexHull,C=this.surface.view.state.camera.near;let E=!0;for(let F=0;F<f.NumPlanes;F++){var A=z[F];const G=A[0],I=A[1],H=A[2];A=A[3]-(F===f.PlaneIndex.NEAR?
C:0);let B=!1;for(let K=0;8>K;++K){const L=3*K;if(0>G*D[L]+I*D[L+1]+H*D[L+2]+A){if(B=!0,!E)break}else E=!1}if(!B)return e.TileFrustumVisibility.OUTSIDE}return E?e.TileFrustumVisibility.INSIDE:e.TileFrustumVisibility.INTERSECTS}computeElevationBounds(){super.computeElevationBounds();this._updateBoundingVolumes()}createGeometry(){p.createSphericalGlobePatch(this.renderData,this._getPatchType());this._updateBoundingVolumes();this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull();this._updateBoundingSphere();
h.enableTerrainInternalChecks&&this._checkBVs()}_updateBoundingSphere(){const z=this._boundingSphere;var D=this.elevationBounds,C=this.ellipsoid.radius,E=D[1];if(0===this.level)g.set(z,0,0,0),z[3]=C+E;else{E=this.extentInRadians;var A=.5*(E[0]+E[2]),F=E[3];t(r,A,E[1],C);t(y,A,F,C);g.add(z,r,y);g.scale(z,z,(C+.5*(D[0]+D[1]))/g.len(z));D=this.convexHull;C=0;for(E=0;8>E;++E){A=z[0]-D[3*E];F=z[1]-D[3*E+1];const G=z[2]-D[3*E+2];C=Math.max(C,Math.sqrt(A*A+F*F+G*G))}z[3]=C+2}}_updateConvexHull(){var z=this.extentInRadians,
D=this.ellipsoid.radius;if(0!==this.level){var C=this.elevationBounds,E=this._getPatchType(),A=this.surface.isWebMercator,F=A&&E===l.PatchType.HAS_NORTH_POLE,G=(E=A&&E===l.PatchType.HAS_SOUTH_POLE)||F;A=Math.PI/2;var I=z[0],H=z[2];E=E?-A:z[1];var B=F?A:z[3],K=.5*(I+H);z=C[0];var L=D+(G?Math.min(0,z-1):z);z=d.create();F=d.create();A=d.create();var J=d.create();t(z,I,E,L);t(F,I,B,L);t(A,H,B,L);t(J,H,E,L);I=(U,Z)=>{for(let P=0;3>P;++P)this._convexHull[3*Z+P]=U[P]};I(z,0);I(F,1);I(A,2);I(J,3);C=C[1];
var M=D+(G?Math.max(0,C+1):C),T=d.create();D=d.create();C=d.create();t(D,K,B,L);t(C,K,E,L);g.add(T,D,C);g.normalize(T,T);var Q=d.create(),O=d.create();E=(U,Z)=>{g.sub(O,U,Z);g.normalize(O,O);Z=-g.dot(U,Q)/g.dot(O,Q);h.internalAssert(0<=Z);g.scale(O,O,Z);g.add(U,U,O)};2**this.lij[0]>2*this.lij[1]?(D=d.create(),g.cross(D,v,C),g.normalize(D,D),g.cross(Q,C,D),g.normalize(Q,Q),h.internalAssert(h.almostEquals(g.dot(Q,C)/g.len(C),0)),E(z,F),E(J,A),I(z,0),I(J,3)):2**this.lij[0]!==2*this.lij[1]&&(C=d.create(),
g.cross(C,v,D),g.normalize(C,C),g.cross(Q,C,D),g.normalize(Q,Q),E(F,z),E(A,J),I(F,1),I(A,2));D=(U,Z)=>{const P=M/g.dot(Z,T);for(let R=0;3>R;++R)this._convexHull[3*U+R]=Z[R]*P};D(4,z);D(5,F);D(6,A);D(7,J)}}_getPatchType(){const z=this.lij[1],D=z===(1<<this.level)-1;return 0===z?D?l.PatchType.HAS_BOTH_POLES:l.PatchType.HAS_NORTH_POLE:D?l.PatchType.HAS_SOUTH_POLE:l.PatchType.REGULAR}intersectsRay(z,D,C,E){var A=this._boundingSphere;C=A[3]+C;var F=A[0]-z[0];E=A[1]-z[1];z=A[2]-z[2];A=(F*D[0]+E*D[1]+z*
D[2])/(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);F=D[0]*A-F;E=D[1]*A-E;D=D[2]*A-z;return F*F+E*E+D*D<C*C}getDefaultVerticesPerSide(){return this.level<q.length?q[this.level]+1:2}updateCornerElevations(){p.updateCornerSpherical(this.renderData);this._updateBoundingVolumes()}updateEdgeElevations(){p.updateEdgesAndCornersSpherical(this.renderData);this._updateBoundingVolumes()}_checkBVs(){if(h.enableTerrainInternalChecks&&!(2>=this.level)){var z=this._boundingSphere,D=z[3],C=d.create(),E=this.ellipsoid.radius,
A=this.elevationBounds;A[1]-A[0];var F=E+A[0],G=this._center[u.CenterPosition.MIDDLE][3],I=this.convexHull,H=(da,ma)=>{for(let ua=0;3>ua;++ua)da[ua]=I[3*ma+ua]},B=d.create(),K=d.create(),L=d.create(),J=d.create(),M=d.create(),T=(da,ma,ua,sa)=>{H(K,da);H(L,ma);H(J,ua);g.sub(K,K,L);g.sub(J,J,L);g.cross(B,K,J);g.normalize(B,B);var ra=g.dot(B,L);H(M,sa);const Aa=g.dot(B,M);ra=Math.abs(Aa-ra);h.internalAssert(h.almostEquals(ra,0),`Non coplanar ${da},${ma},${ua},${sa} diff = ${ra}`)};T(0,1,2,3);T(4,5,6,
7);T(0,1,4,5);T(1,2,5,6);T(2,3,6,7);T(3,0,7,4);var Q=m.newDoubleArray(24),O=d.create(),U=d.create(),Z=d.create(),P=d.create();T=(da,ma,ua,sa)=>{H(O,ma);H(U,ua);H(Z,sa);g.sub(O,O,U);g.normalize(O,O);g.sub(Z,Z,U);g.normalize(Z,Z);g.cross(P,O,Z);g.normalize(P,P);ma=g.dot(P,U);da*=4;for(ua=0;3>ua;++ua)Q[da+ua]=P[ua];Q[da+3]=ma};T(0,0,1,2);T(1,1,0,4);T(2,1,5,2);T(3,3,2,6);T(4,4,0,3);T(5,4,6,5);var R=(da,ma,ua,sa)=>{da*=4;return Q[da]*ma+Q[da+1]*ua+Q[da+2]*sa-Q[da+3]},W=(da,ma,ua,sa)=>-1<=R(da,ma,ua,sa),
N=2**this.lij[0]>2*this.lij[1];T=(da,ma,ua)=>Math.sqrt(x(da,ma,ua,z[0],z[1],z[2]))<D;var V=this.extentInRadians,S=.5*(V[0]+V[2]),X=V[1],ca=V[3];V=d.create();var ba=d.create();t(V,S,ca,F);t(ba,S,X,F);F=N?"Upper":"Lower";N=!0;for(S=0;6>S;++S){for(X=0;8>X;++X)ca=3*X,ca=-1<=R(S,I[ca],I[ca+1],I[ca+2]),N&&(N=ca),h.internalAssert(ca,`Tile[${this.lij}] Convex hull point ${X} outside of plane ${S}`);h.internalAssert(W(S,ba[0],ba[1],ba[2]),`Tile[${this.lij}] (${F}) bottom mid outside of plane ${S}`);h.internalAssert(W(S,
V[0],V[1],V[2]),`Tile[${this.lij}] (${F}) top mid outside of plane ${S}`)}h.internalAssert(N,"Not all convex hull points are inside  convex hull polyhedron");h.internalAssert(T(ba[0],ba[1],ba[2]),`Tile[${this.lij}] (${F}) bottom mid outside of bounding sphere`);h.internalAssert(T(V[0],V[1],V[2]),`Tile[${this.lij}] (${F}) top mid outside of bounding sphere`);for(W=0;8>W;++W)V=3*W,V=T(I[V],I[V+1],I[V+2]),h.internalAssert(V,`Tile[${this.lij}] Convex hull point ${W} outside of bounding sphere`);for(T=
0;6>T;++T)for(W=0;8>W;++W)V=3*W,-1<=R(T,I[V],I[V+1],I[V+2])||console.error(`Tile[${this.lij}] Convex hull point ${W} outside of plane ${T}`);T=this.extentInRadians;T=Math.round(Math.max(T[2]-T[0],T[3]-T[1])*E);if(S=this.renderData){var {geometry:ia,localOrigin:ka}=S;if(W=ia.vertexAttributes?.position){V=W.count;ba=d.create();F=ia.numVerticesPerSide-2;N=F*F;S=S.geometryState.neighborData;X=S.edgeResolutions.reduce((da,ma)=>da+ma+1,0);for(let da=0;da<V;++da){const ma=da<N,ua=!ma&&da<N+X;let sa=!1;ca=
-1;if(ua){var na=N;for(var Y=0;4>Y;++Y){var ea=S.edgeResolutions[Y];if(da===na||da===na+ea-1){sa=!0;break}na+=ea;if(da<na){ca=Y;break}}}ca=ua?S.edgePeerNeighbors[ca]:null;const ra=ua&&ca&&0<w.compareTilesByLij(this,ca);W.getVec(da,C);g.add(ba,C,ka);ca=g.len(ba)-E;na=0;Y=!1;ea=A[0]-ca;const Aa=ca-A[1],qa=1<ea,la=1<Aa;var fa=qa||la;const ja=()=>{const oa=ua&&!sa;return`Tile[${this.lij}].vertex[${da}]:${ma?"internal":oa?"edge":sa?"corner":"pole"}`+(qa?"(below)":la?"(above)":"")+(ra?"(Neighbor)":"")};
var aa=g.dist(ba,z);aa>=D+0&&(aa-=D,fa||(console.error(`${ja()} is out of the bounding sphere by ${aa.toFixed(0)} / ${D.toFixed(0)}`+"[tol\x3d0]"+` h=${ca.toFixed(0)} / [${A[0].toFixed(0)}..${A[1].toFixed(0)}] (${(aa/D).toFixed(0)})`),Y=!0));for(fa=0;6>fa;++fa)if(!(-1<=R(fa,ba[0],ba[1],ba[2]))){aa=R(fa,ba[0],ba[1],ba[2]);const oa=da%F,za=(da-oa)/F;0===fa&&ea||5===fa&&Aa||(console.error(`${ja()} (${oa},${za})|${F}] is out of the bounding trapezoid plane ${fa}`+` h=${Math.round(ca)} / [${Math.round(A[0])}..${Math.round(A[1])}] dist=${Math.round(aa)}`+
` radii = ${Math.round(D)}/${Math.round(G)}} : maxL = ${T}`),++na)}if(Y||0<na)break}}}}}get convexHull(){return this._convexHull}}const q=[128,64,64,32,16,8,8,4],t=(z,D,C,E)=>{const A=Math.sin(D),F=Math.cos(C);C=Math.sin(C);z[0]=E*F*Math.cos(D);z[1]=E*F*A;z[2]=E*C},v=[0,0,1],r=d.create(),y=d.create();a.SphericalPatch=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/lonLatToSphericalPCPF":function(){define(["exports"],function(a){a.lonLatToSphericalPCPF=function(b,
g,d,k){const m=Math.cos(d);b[0]=Math.cos(g)*m*k;b[1]=Math.sin(g)*m*k;b[2]=Math.sin(d)*k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SplitLimits":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,g,d,k,m,f,c){a.SplitLimits=
class extends g{constructor(){super(...arguments);this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}};b.__decorate([d.property()],a.SplitLimits.prototype,"fovX",void 0);b.__decorate([d.property()],a.SplitLimits.prototype,"fovY",void 0);b.__decorate([d.property()],a.SplitLimits.prototype,"relativeWidthLimit",void 0);b.__decorate([d.property()],a.SplitLimits.prototype,"relativeHeightLimit",void 0);b.__decorate([d.property()],
a.SplitLimits.prototype,"maxLod",void 0);b.__decorate([d.property()],a.SplitLimits.prototype,"angledSplitBias",void 0);b.__decorate([d.property()],a.SplitLimits.prototype,"aboveGround",void 0);b.__decorate([d.property()],a.SplitLimits.prototype,"frustum",void 0);a.SplitLimits=b.__decorate([c.subclass("esri.views.3d.terrain.SplitLimits")],a.SplitLimits);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../Color ../../../core/has ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./OverlayContent ./OverlayRenderer ./PatchRenderData ./RenderOrder ./TerrainAttributesCache ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba){const ia=n.create();a.TransparencyMode=void 0;(function(fa){fa[fa.Opaque=0]="Opaque";fa[fa.Semitransparent=1]="Semitransparent";fa[fa.TransparentWithDraped=2]="TransparentWithDraped";fa[fa.Empty=3]="Empty"})(a.TransparencyMode||(a.TransparencyMode={}));a.TerrainRenderer=class extends J.SyncPrepareRenderPlugin{get _isGlobal(){return this._stage.viewingMode===t.ViewingMode.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(fa,
aa,da,ma,ua){super({});this._overlayRenderer=fa;this._stage=aa;this._allTiles=da;this._ellipsoidRadius=ma;this.type=U.IntersectorType.TERRAIN;this.isGround=!0;this._tileSize=256;this._techniqueConfiguration=new ca.TerrainTechniqueConfiguration;this._passParameters=new K.TerrainPassParameters;this._renderDataPool=new f(D.PatchRenderData);this._visiblePatchesByOrigin=new Map;this._allPatchesByOrigin=new Map;this._patchSortingDirty=this._patchesByOriginDirty=!0;this._tileIterator=new I.IteratorPreorder;
this._transparencyState=a.TransparencyMode.Opaque;this._castShadows=!1;this._tileRenderer=this._emptyTex=null;this._stencilEnabledLayerExtents=[];this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;this.renderOccludedFlags=Z.RenderOccludedFlag.Occlude;this.produces=new Map([[P.RenderSlot.OPAQUE_TERRAIN,()=>this._produces()],[P.RenderSlot.TRANSPARENT_TERRAIN,()=>this._produces()],[P.RenderSlot.OCCLUDED_TERRAIN,()=>this._produces()]]);this._tileTextureCache=new m.MemCachePool((sa,
ra)=>ua.newCache(sa,ra),"TileTexture");this.tileGeometryCache=new E.TerrainAttributesCache(ua)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this)}destroy(){this._stage.removeRenderPlugin(this);this._tileTextureCache.destroy();this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?J.ConsumesDepth:J.ConsumesNone}set renderingDisabled(fa){this._set("renderingDisabled",!!fa);
this.setDirty()}set visible(fa){this._set("visible",!!fa);this.setDirty()}set transparency(fa){this._transparencyState!==fa&&(this._techniqueConfiguration.invisible=fa===a.TransparencyMode.TransparentWithDraped||fa===a.TransparencyMode.Empty,this._transparencyState=fa,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(fa){this._techniqueConfiguration.tileBorders!==fa&&(this._techniqueConfiguration.tileBorders=
fa,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(fa){this._techniqueConfiguration.visualizeNormals!==fa&&(this._techniqueConfiguration.visualizeNormals=fa,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(fa){this._techniqueConfiguration.backfaceCullingEnabled!==fa&&(this._techniqueConfiguration.backfaceCullingEnabled=
fa,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(fa){this._set("renderOrder",fa);this._setSortingDirty()}get layerUid(){return N.terrainId}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(fa){this._techniqueConfiguration.hasSlicePlane!==fa&&(this._techniqueConfiguration.hasSlicePlane=fa,this.setNeedsRender())}set textureFadingEnabled(fa){this._techniqueConfiguration.textureFadingEnabled!==fa&&(this._techniqueConfiguration.textureFadingEnabled=
fa,this.setNeedsRender())}set pbrMode(fa){this._techniqueConfiguration.pbrMode!==fa&&(this._techniqueConfiguration.pbrMode=fa,this.setNeedsRender())}setDebugScreenSizePerspective(fa){this._techniqueConfiguration.screenSizePerspective!==fa&&(this._techniqueConfiguration.screenSizePerspective=fa,this.setNeedsRender())}setRootTiles(fa){this._rootTiles=fa;this.setDirty()}setRenderOccludedOverlay(fa){this.renderOccludedFlags=fa?z.overlayRenderOccludedFlag:Z.RenderOccludedFlag.Occlude;this.setNeedsRender()}setStencilEnabledLayerExtents(fa){this._stencilEnabledLayerExtents=
fa;this._setSortingDirty()}setTileSize(fa){this._tileSize=fa;null!=this._tileRenderer&&(this._tileRenderer.tileSize=fa);this.setDirty()}_prepareTileForLoading(fa){fa.renderData||(fa.renderData=this._renderDataPool.acquire(),fa.renderData.init(fa),fa.renderData.localOrigin=this._getLocalOriginOfTile(fa))}loadTile(fa){this._prepareTileForLoading(fa);this.updateTileGeometryState(fa);this.updateTileTexture(fa,G.TileUpdate.TEXTURE_FADING)}updateTileTexture(fa,aa){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(fa,
aa===G.TileUpdate.TEXTURE_FADING?v.TextureUpdate.FADING:v.TextureUpdate.UNFADED),this.setNeedsRender(),fa.resetPendingUpdate(aa))}updateTileGeometryState(fa){for(const aa of fa.layerInfo[r.LayerClass.ELEVATION])aa.pendingUpdates&=~G.TileUpdate.GEOMETRY;fa.resetPendingUpdate(G.TileUpdate.GEOMETRY);(fa=fa.renderData.updateGeometryState())&&this.setDirty();return fa}updateGeometryIfNeeded(fa){fa.isLoaded&&fa.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(fa){const aa=fa.renderData;aa&&(aa.releaseGeometry(),
this._renderDataPool.release(aa),aa.clear(),fa.renderData=null,fa.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(fa){const aa=Math.max(0,7*Math.floor((fa.level-3)/7));if(this._isGlobal&&0===aa)return w.ZEROS;for(;fa.parent&&fa.level>aa;)fa=fa.parent;return fa.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(fa){this._get("wireframe")!==fa&&(this._set("wireframe",fa),this.setNeedsRender())}setDirty(fa=
T.RenderRequestType.UPDATE){this._patchesByOriginDirty=!0;this._context.requestRender(fa)}_setSortingDirty(fa=T.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(fa)}setNeedsRender(fa=T.RenderRequestType.UPDATE){this._context.requestRender(fa)}initializeRenderContext(fa){this._context=fa;this._tileRenderer=new F.TileRenderer(this._rctx,this._tileSize,this._techniques,this._tileTextureCache);this.updateTileBackground();this._emptyTex=Q.createEmptyTexture(this._rctx)}uninitializeRenderContext(){this._emptyTex=
k.disposeMaybe(this._emptyTex);this._tileRenderer=k.disposeMaybe(this._tileRenderer)}intersect(fa,aa,da,ma){if(!(!this._rootTiles||fa.options.selectOpaqueTerrainOnly&&fa.options.selectionMode&&this.transparency!==a.TransparencyMode.Opaque)){var ua=ka,sa=na;u.subtract(ua,ma,da);u.set(sa,1/ua[0],1/ua[1],1/ua[2]);var ra=fa.results.min,Aa=fa.results.max,qa=fa.results.ground,la=fa.options.store===U.StoreResults.MIN,ja=!!fa.results.ground.target,oa=N.getVerticalOffsetTerrain(fa.verticalOffset),za=fa.tolerance,
ta,Ca=la&&null!=ra.dist?ra.dist:Infinity,Ga=Ma=>{var Ra=Ma.renderData;if(Ra?.vao){var Ya=Ra.geometry;n.set(ia,Ya.boundingBox);var ab=Ra.localOrigin;null!=oa&&(oa.localOrigin=ab,oa.applyToAabb(ia));Y[0]=da[0]-ab[0];Y[1]=da[1]-ab[1];Y[2]=da[2]-ab[2];if(S.intersectAabbInvDirBefore(ia,Y,sa,za,Ca)){var Wa=(Da,Ka,ha)=>{Da.set(this.type,Ma,Ka,ha,h.IDENTITY);Ca=la&&null!=ra.dist?ra.dist:Infinity};Ra=(Da,Ka)=>{null!=Ka&&0<=Da&&(fa.options.backfacesTerrain||0>u.dot(Ka,ua))&&(fa.options.invisibleTerrain||!fa.options.selectionMode||
null==aa||aa(da,ma,Da))&&((null==qa.dist||Da<qa.dist)&&Wa(qa,Da,Ka),fa.options.isFiltered||(fa.options.store===U.StoreResults.ALL&&(null==ta?(ta=O.newIntersectorResult(fa.ray),Wa(ta,Da,Ka),fa.results.all.push(ta)):Da<ta.dist&&Wa(ta,Da,Ka)),(null==ra.dist||Da<ra.dist)&&Wa(ra,Da,Ka),fa.options.store!==U.StoreResults.MIN&&(null==Aa.dist||Da>Aa.dist)&&Wa(Aa,Da,Ka)))};var cb=ea;u.subtract(cb,ma,ab);ab=Ya.indices;var Na=Ya.vertexAttributes,xa=Na.getField(W.VertexAttribute.POSITION,q.BufferViewVec3f);Na=
new M.Vertices(xa.typedBuffer,3,Na.stride/4);Ya=Ya.indexCount/3;!oa&&Ya>H.componentMinimalSizeForIntersectionData?(xa=Ma.renderData,null==xa.intersectionData&&(xa.intersectionData=new H.ComponentIntersectionData(ab,0,Ya,Na)),xa.intersectionData.intersectRay({r0:Y,r1:cb},Ra)):S.intersectTriangles(Y,cb,0,Ya,ab,Na,null,oa,Ra)}}},La=this._rootTiles;null!=La&&(()=>{const Ma=this._tileIterator;Ma.reset(La);const Ra=fa.options.invisibleTerrain;for(let Ya=Ma.next();Ya;Ya=Ma.next())!(Ya.visible||Ra&&Ya.intersectsClippingArea)||
null==oa&&!Ya.intersectsRay(da,ua,za,Ca)||ja&&this._useStencilForTile(Ya)?Ma.skipSubtree():Ga(Ya)})()}}processScaleRangeQueries(fa,aa){if(!aa.done)for(this._updatePatchGroups();fa.updating&&!aa.done;){fa.prepare();for(const da of this._visiblePatchesByOrigin.values())for(const ma of da)null!=ma.renderData?.textureReference&&fa.queriesForTile(ma);fa.process();aa.madeProgress()}}prepareTechnique(fa){const aa=d("enable-feature:terrain-shadows")&&fa.bindParameters.shadowMap.enabled;aa!==this._castShadows&&
(this._castShadows=aa,this._patchesByOriginDirty=!0);if(fa.bindParameters.slot===P.RenderSlot.OCCLUDED_TERRAIN){if(0===(fa.renderOccludedMask&z.overlayRenderOccludedFlag))return null}else if(fa.bindParameters.slot!==(this.transparency===a.TransparencyMode.Opaque?P.RenderSlot.OPAQUE_TERRAIN:P.RenderSlot.TRANSPARENT_TERRAIN))return null;if(this.transparency===a.TransparencyMode.Empty)return null;switch(fa.output){case B.ShaderOutput.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=
null!=fa.bindParameters.ssr.lastFrameColor,this._techniqueConfiguration.hasCloudsReflections=null!=fa.bindParameters.cloudsFade.data,this._techniqueConfiguration.receiveShadows=fa.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=null!=fa.bindParameters.ssao,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(B.ShaderOutput.Color,fa.bindParameters.slot===P.RenderSlot.OCCLUDED_TERRAIN);case B.ShaderOutput.Shadow:case B.ShaderOutput.ShadowExcludeHighlight:if(this._castShadows)return this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(B.ShaderOutput.Shadow,!1);break;case B.ShaderOutput.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(B.ShaderOutput.Depth,!1);case B.ShaderOutput.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(B.ShaderOutput.Normal,!1);case B.ShaderOutput.ObjectAndLayerIdColor:return this._updateTechnique(B.ShaderOutput.ObjectAndLayerIdColor,
!1);case B.ShaderOutput.Highlight:if(this._overlayRenderer.hasHighlights)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(B.ShaderOutput.Highlight,!1)}return null}renderNode(fa,aa){this._updatePatchGroups();aa.useStencil=!1;switch(fa.output){case B.ShaderOutput.Color:this._renderMaterialPass(fa,aa,fa.bindParameters.slot===P.RenderSlot.OCCLUDED_TERRAIN?y.OverlayContent.Occluded:y.OverlayContent.Color);break;case B.ShaderOutput.Depth:case B.ShaderOutput.Normal:this._renderAuxiliaryPass(fa,
aa,y.OverlayContent.Color,this._visiblePatchesByOrigin);break;case B.ShaderOutput.Highlight:this._renderAuxiliaryPass(fa,aa,y.OverlayContent.Highlight,this._visiblePatchesByOrigin);break;case B.ShaderOutput.Shadow:case B.ShaderOutput.ShadowExcludeHighlight:this._renderAuxiliaryPass(fa,aa,null,this._allPatchesByOrigin);break;case B.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(fa,aa,y.OverlayContent.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(fa){if(null!=
this._tileRenderer){var aa=this._tileRenderer;if(null!=fa){fa=g.toUnitRGBA(fa);var da=w.fromValues(fa[0]||0,fa[1]||0,fa[2]||0)}aa.setBackground(da);this._allTiles.forAll(ma=>aa.updateTileTexture(ma,v.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=aa.backgroundIsGrid?L.TileBlendInput.GridComposite:null!=aa.backgroundColor?L.TileBlendInput.ColorComposite:L.TileBlendInput.LayerOnly;this.setNeedsRender()}}_updatePatchGroups(){this._patchesByOriginDirty&&(this._rebuildPatchGroups(),
this._patchesByOriginDirty=!1,this._patchSortingDirty=!0);if(this._patchSortingDirty&&this.renderOrder!==C.RenderOrder.NONE){const fa=Array.from(this._visiblePatchesByOrigin.values()),aa=this._stencilEnabledLayerExtents;for(const da of fa)I.sortTiles(this.renderOrder,da,aa);fa.sort((da,ma)=>I.compareTiles(da[0],ma[0],this.renderOrder));this._visiblePatchesByOrigin=new Map(fa.map(da=>[da[0].renderData.localOrigin,da]));this._patchSortingDirty=!1}}_rebuildPatchGroups(){const fa=this._rootTiles;if(null!=
fa){fa[0]?.surface.checkAllTilesWaterproofness();this._visiblePatchesByOrigin.clear();this._allPatchesByOrigin.clear();for(const aa of fa)this._rebuildPatchGroupsForRootTile(aa)}}_rebuildPatchGroupsForRootTile(fa){const aa=this._tileIterator;for(aa.resetOne(fa);!aa.done;){fa=aa.next();var da=fa.renderData;if(da){da=da.localOrigin;if(this._castShadows){var ma=this._allPatchesByOrigin.get(da);ma||(ma=[],this._allPatchesByOrigin.set(da,ma));ma.push(fa)}fa.visible?(ma=this._visiblePatchesByOrigin.get(da),
ma||(ma=[],this._visiblePatchesByOrigin.set(da,ma)),ma.push(fa),aa.skipSubtree()):(this._numTilesCulled++,aa.skipSubtree())}else this._numTilesCulled++}}_useStencilForTile(fa){for(const aa of this._stencilEnabledLayerExtents)if(fa.intersectsExtent(aa))return!0;return!1}_renderAuxiliaryPass(fa,aa,da,ma){const ua=fa.rctx;this._passParameters.overlayContent=da;ua.bindTechnique(aa,this._passParameters,fa.bindParameters);const sa=0<this._stencilEnabledLayerExtents.length;ma.forEach(ra=>{aa.program.bindDraw(new V.DrawParameters(ra[0].renderData.localOrigin),
fa.bindParameters,this._passParameters);for(let Aa=0;Aa<ra.length;Aa++)this._renderPatch(fa,aa,ra[Aa],ba.PrimitiveType.TRIANGLES,sa,da)});fa.rctx.bindVAO(null)}_renderMaterialPass(fa,aa,da){var {rctx:ma}=fa;this._passParameters.overlayContent=da;ma.bindTechnique(aa,this._passParameters,fa.bindParameters);this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;var ua=fa.bindParameters.camera;ma=aa.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&R.getSettings(this._stage.viewingMode,
this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:ua.fovY});ua=0<this._stencilEnabledLayerExtents.length;const sa=da===y.OverlayContent.Occluded;sa&&(ma.bindTexture("tex",this._emptyTex),ma.setUniform3fv("textureOpacities",w.ZEROS),ma.setUniform4fv("texOffsetAndScale",x.ZEROS));var ra=null!=this._tileRenderer?.backgroundColor?this._tileRenderer.backgroundColor:w.ZEROS;this._techniqueConfiguration.tileBlendInput===L.TileBlendInput.ColorComposite&&ma.setUniform3fv("backgroundColor",
ra);ra=this.wireframe?ba.PrimitiveType.LINES:ba.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&ma.bindTexture("texNext",this._emptyTex);var Aa=this._visiblePatchesByOrigin;for(const qa of Aa.values()){aa.program.bindDraw(new V.DrawParameters(qa[0].renderData.localOrigin),fa.bindParameters,this._passParameters);this._numOriginsRendered++;for(const la of qa){Aa=la.renderData;const ja=Aa.textureReference;if(null!=ja){if(!sa){ma.setUniform4fv("texOffsetAndScale",ja.offsetAndScale);
ma.bindTexture("tex",ja.texture.texture);const oa=Aa.textureFadeFactor,za=1>oa?Aa.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&null!=za&&1>oa?(ma.setUniform1f("fadeFactor",oa),ma.setUniform4fv("nextTexOffsetAndScale",za.offsetAndScale),ma.setUniform3fv("nextTexOpacities",za.opacities),ma.bindTexture("texNext",za.texture.texture)):ma.setUniform1f("fadeFactor",1);Aa.textureIsFading&&this.setNeedsRender();ma.setUniform3fv("textureOpacities",ja.opacities)}this._renderPatch(fa,
aa,la,ra,ua,da);la.renderOrder=this._numTilesRendered;this._numTilesRendered++}}}fa.rctx.bindVAO(null)}_renderPatch(fa,aa,da,ma,ua,sa){const ra=da.renderData,Aa=ra.vao,qa=Aa?.indexBuffer;if(null==qa)A.enableTerrainInternalChecks&&console.error("Rendered tile with no indices: ",da.lij," : ",ra);else{var la=aa.program;null==sa||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(la,ra.overlay);ua&&(aa.useStencil=this._useStencilForTile(da),fa.rctx.setPipelineState(aa.getPipeline()));aa=ra.geometry.indexCount;
fa.rctx.bindVAO(Aa);la.assertCompatibleVertexAttributeLocations(Aa);fa.rctx.drawElements(ma,aa,qa.indexType,0)}}_bindOverlayPatchData(fa,aa){fa.setUniform4fv("overlayTexOffset",aa.offsets);fa.setUniform4fv("overlayTexScale",aa.scales)}_updateTechnique(fa,aa){this._techniqueConfiguration.output=fa;this._techniqueConfiguration.renderOccluded=aa;return this._shaderTechnique=this._techniques.releaseAndAcquire(X.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)}get test(){return{tileRenderer:this._tileRenderer}}};
b.__decorate([c.property({readOnly:!0})],a.TerrainRenderer.prototype,"_isGlobal",null);b.__decorate([c.property({value:!1})],a.TerrainRenderer.prototype,"renderingDisabled",null);b.__decorate([c.property({value:!0})],a.TerrainRenderer.prototype,"visible",null);b.__decorate([c.property()],a.TerrainRenderer.prototype,"renderPatchBorders",null);b.__decorate([c.property()],a.TerrainRenderer.prototype,"visualizeNormals",null);b.__decorate([c.property()],a.TerrainRenderer.prototype,"cullBackFaces",null);
b.__decorate([c.property({value:C.RenderOrder.FRONT_TO_BACK})],a.TerrainRenderer.prototype,"renderOrder",null);b.__decorate([c.property()],a.TerrainRenderer.prototype,"wireframe",null);a.TerrainRenderer=b.__decorate([p.subclass("esri.views.3d.terrain.TerrainRenderer")],a.TerrainRenderer);const ka=w.create(),na=w.create(),Y=w.create(),ea=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainAttributesCache":function(){define(["exports","../../../core/MemCachePool",
"./TerrainAttributes"],function(a,b,g){class d{constructor(k){this._storage=new b.MemCachePool((m,f)=>k.newCache(m,f),"TileGeometry")}acquire(k){k=4*Math.ceil(k/4);const m=this._storage.pop(k.toString());if(m)return m;const f=g.terrainAttributesLayout.createBuffer(k);f.release=()=>this._release(f);return f}_release(k){this._storage.put(k.count.toString(),k)}clear(){this._storage.clear()}destroy(){this._storage.destroy()}}a.TerrainAttributesCache=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/TerrainAttributes":function(){define(["exports","../support/buffer/InterleavedLayout","../webgl-engine/lib/VertexAttribute"],function(a,b,g){b=b.newLayout().vec3f(g.VertexAttribute.POSITION).vec2i16(g.VertexAttribute.UV0).vec2i16(g.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});a.terrainAttributesLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./ITile ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileRenderInfo ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){function C(J,M,T){B.layerIndex=M;B.vtlNeighborInfos.clear();const Q=J.layerInfo[e.LayerClass.MAP][M];g.set(B.offset,0,0);B.tile=J;B.scale=1;B.sourceLod=J.lij;B.sourceLayerInfo=Q;B.isVTLBackground=T;if(Q.data)return T&&J.forEachLoadedNeighbor((U,Z)=>{if(U.level===J.level){var P=U.layerInfo[e.LayerClass.MAP][M];if(p.isVectorTilePerLayerInfo(P)&&Q.data!==P.data){var R=B.vtlNeighborInfos.pushNew();R.offset=L[Z];R.sourceLod=U.lij;R.sourceLayerInfo=
P}}}),B;const O=Q.upsampleInfo;return O?(T=O.tile.layerInfo[e.LayerClass.MAP][M],B.tile=O.tile,g.copy(B.offset,O.offset),B.scale=O.scale,B.sourceLod=O.tile.lij,B.sourceLayerInfo=T,B):T?B:null}function E(J){let M="normal"!==J.blendMode;k.isGroupLayer(J.parent)&&(M=E(J.parent)||M);return M}function A(J,M){k.isGroupLayer(J.parent)&&A(J.parent,M);const T=J.uid;if(null!=T&&""!==T){const Q=I.get(T);Q?Q.start=M:I.set(T,new F(M,M,J.blendMode,J.opacity,v.BlendLayersOutput.Composite,1))}}class F{constructor(J,
M,T,Q,O,U){this.start=J;this.end=M;this.blendMode=T;this.opacity=Q;this.output=O;this.baseOpacity=U}}class G{constructor(J,M,T,Q){this._rctx=J;this.tileSize=M;this._techniques=T;this._cache=Q;this._passParameters=new f.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new w.TileCompositor(this._rctx,this._techniques);this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=
b.disposeMaybe(this._composition);this._backgroundTexture=b.releaseMaybe(this._backgroundTexture)}get backgroundIsGrid(){return null==this._backgroundColor}get backgroundColor(){return this._backgroundColor}updateTileTexture(J,M){if(J.renderData){var T=J.surface,Q=T.baseOpacity,O=0,U=0,Z=this.tileSize,P=!1,R=!1,W=T.view.state.contentPixelRatio,N=!1;I.clear();H.length=0;for(var V=J.layerInfo[e.LayerClass.MAP],S=0,X=null;S<V.length;S++){const ka=T.layerViewByIndex(S,e.LayerClass.MAP);var ca=ka.layer.opacity;
const na=ka.fullOpacity;R=R||k.isBaseLayer(ka.layer);if(p.isBlendableLayerView(ka)){var ba="normal"!==ka.layer.blendMode;if(k.isGroupLayer(ka.layer.parent)){var ia=ka.layer.parent.uid;null!=ia&&""!==ia&&(ba=E(ka.layer.parent)||ba)}ba&&(N=ba,P=!1)}if(0!==ca||N){if(++U,ca=p.isVectorTileLayerView(ka),ba=C(J,S,ca))V[S].pendingUpdates&=~(q.TileUpdate.TEXTURE_NOFADING&q.TileUpdate.TEXTURE_FADING),k.isGroupLayer(ka.layer.parent)&&(ia=ka.layer.parent.uid,null!=ia&&""!==ia&&A(ka.layer.parent,S)),ca?Z=Math.max(Z,
this.tileSize*W):1===Q&&1===na&&(ka.isOpaque||this._dataToTexture(ba)&&ba.sourceLayerInfo.data.descriptor.isOpaque)&&(P=!0),++O,null===X&&(X=S)}else V[S].pendingUpdates&=~(q.TileUpdate.TEXTURE_NOFADING&q.TileUpdate.TEXTURE_FADING)}T=Z/this.tileSize;0===O||null===X?this._useBackgroundTexture(J,U):(1!==O||N||!this._useLayerTexture(J,X))&&this._composeMapLayers(J,M,S-1,R,Z,T,!P||N,I,N)}}_ensureBackgroundTexture(J){null==this._backgroundTexture&&(this._backgroundTexture=this._buildTexture(J,!1),this._backgroundDirty=
!0);this._backgroundDirty&&(this._composition.bind(J),this._passParameters.offset=d.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,null!=this.backgroundColor),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1);return this._backgroundTexture}_useBackgroundTexture(J,M){const T=this._ensureBackgroundTexture(this.tileSize);
let Q=h.ActivationTime.Immediate;if(J.surface.view.layerViewManager.updating||0<M)Q=h.ActivationTime.Delayed;M=J.renderData;null==M.textureReference&&(Q=h.ActivationTime.Immediate);M.setTextureReference(new u.TextureReference(T,c.TextureUpdate.FADING,K,J.surface.baseOpacity,0,1),Q)}_useLayerTexture(J,M){var T=J.surface.layerViewByIndex(M,e.LayerClass.MAP),Q=k.isBaseLayer(T.layer);const O=Q?J.surface.baseOpacity:1;Q=Q?1:J.surface.baseOpacity;T=T.fullOpacity;M=C(J,M,!1);return this._dataToTexture(M)?
(J.renderData.setTextureReference(new u.TextureReference(M.sourceLayerInfo.data,c.TextureUpdate.FADING,M,O,Q,T)),!0):!1}_composeMapLayers(J,M,T,Q,O,U,Z,P,R){this._composition.ensureBuffer(O);const W=J.surface.baseOpacity;let N=!1,V=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,S=!1,X=0;for(let ka=T;0<=ka;ka--){T=J.surface.layerViewByIndex(ka,e.LayerClass.MAP);var ca=p.isVectorTileLayerView(T);ca=C(J,ka,ca);const na=T.layer.opacity;if(!ca||0===na&&!R)continue;const Y=!k.isBaseLayer(T.layer)&&!N;Y&&(N=
!0);let ea=!1;P.forEach(aa=>{aa.start===ka&&(aa.output=Q?v.BlendLayersOutput.Composite:Z&&Y?this.backgroundIsGrid?v.BlendLayersOutput.GridComposite:v.BlendLayersOutput.ColorComposite:v.BlendLayersOutput.Composite,aa.baseOpacity=Y?W:1,H.push(aa),this._composition.openGroup(O),ea=!0)});this._passParameters.baseOpacity=Y&&!ea&&1>W?W:1;const fa=1>this._passParameters.baseOpacity?v.BaseOpacityMode.Required:v.BaseOpacityMode.NotRequired;var ba=0===X;ba=ea?v.BlendLayersOutput.GroupBackgroundComposite:Z&&
ba?this.backgroundIsGrid?v.BlendLayersOutput.GridComposite:v.BlendLayersOutput.ColorComposite:v.BlendLayersOutput.Composite;T=t.blendModeFromString[p.isBlendableLayerView(T)?T.layer.blendMode:"normal"];this._passParameters.opacity=na;p.isVectorTileRenderInfo(ca)?S=this._composition.drawVectorData(this._passParameters,ba,O,T,fa,ca,U,this.tileSize,S):p.isImageryTileRenderInfo(ca)?(this._composition.drawImageryTileData(this._passParameters,ba,O,T,fa,ca),this._hasNearestInterpolation(ca)&&(V=y.TextureSamplingMode.NEAREST)):
this._dataToTexture(ca)&&(this._passParameters.texture=ca.sourceLayerInfo.data.texture,this._passParameters.offset=ca.offset,this._passParameters.scale=ca.scale,this._composition.drawRasterData(this._passParameters,ba,O,T,fa));for(;0<H.length&&H[H.length-1].end===ka;)T=H.pop(),this._passParameters.baseOpacity=T.baseOpacity,ca=1>this._passParameters.baseOpacity?v.BaseOpacityMode.Required:v.BaseOpacityMode.NotRequired,this._passParameters.opacity=T.opacity,this._passParameters.offset=d.ZEROS,this._passParameters.scale=
1,this._composition.drawGroup(this._passParameters,T.output,O,t.blendModeFromString[T.blendMode],ca);X++}J=J.renderData;const ia=R||N&&1>W;R=J.ensureTexture(O,ia,()=>this._buildTexture(O,ia,V));this._composition.copyFBOToTexture(R);this._composition.unbind();J.setTextureReference(new u.TextureReference(R,M,K,N?1:W,0,1))}_hasNearestInterpolation(J){J=J.sourceLayerInfo.data;return J.source?"nearest"===J.interpolation:!1}_dataToTexture(J){if(p.isRasterTileRenderInfo(J)){const M=J.sourceLayerInfo;M.data=
this._buildTexture(M.data,!0);J.tile.setMemoryDirty()}return p.isTextureTileRenderInfo(J)}setBackground(J){this._backgroundColor!==J&&(this._backgroundColor=J,this._backgroundDirty=!0)}_buildTexture(J,M,T=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(null==J)return null;const Q=new D.TextureDescriptor;Q.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;Q.samplingMode=T;Q.maxAnisotropy=this._maxAnisotropy;Q.preMultiplyAlpha=!0;Q.flipped=!0;Q.hasMipmap=!0;M||(Q.pixelFormat=y.PixelFormat.RGB);M=this._rctx;let O;
if("number"===typeof J)Q.width=Q.height=J,(O=this._cache.pop(`${J} ${Q.pixelFormat}`))?O.retain():O=new n(new z.Texture(M,Q),this._cache);else if(m.isImageWithType(J))Q.isOpaque=J.isOpaque,Q.isOpaque&&(Q.pixelFormat=y.PixelFormat.RGB),(O=this._cache.pop(`${J} ${Q.pixelFormat}`))?(O.retain(),O.texture.setData(J.image)):O=new n(new z.Texture(M,Q,J.image),this._cache),J.release();else try{Q.width=J.width,Q.height=J.height,O=new n(new z.Texture(M,Q,J))}catch(U){O=new n(r.createEmptyTexture(M)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}J=
M.bindTexture(O.texture,z.Texture.TEXTURE_UNIT_FOR_UPDATES);O.generateMipmap();M.bindTexture(J,z.Texture.TEXTURE_UNIT_FOR_UPDATES);return O}get test(){return{backgroundTexture:this._backgroundTexture}}}const I=new Map,H=[],B=new x.TileRenderInfo,K={offset:[0,0],scale:1},L=[];L[l.NeighborIndex.NORTH]=[0,-1];L[l.NeighborIndex.NORTH_EAST]=[-1,-1];L[l.NeighborIndex.EAST]=[-1,0];L[l.NeighborIndex.SOUTH_EAST]=[-1,1];L[l.NeighborIndex.SOUTH]=[0,1];L[l.NeighborIndex.SOUTH_WEST]=[1,1];L[l.NeighborIndex.WEST]=
[1,0];L[l.NeighborIndex.NORTH_WEST]=[1,-1];a.GroupInfo=F;a.TileRenderer=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/tslib.es6 ../../../chunks/vec3f64 ./TileBlendTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){class x extends m.TileCompositePassParameters{constructor(){super(...arguments);this.baseOpacity=this.opacity=1;this.fboTexture=this.texture=null;this.backgroundColor=d.ZEROS}}class n extends l.ShaderTechnique{initializeProgram(t){return new h.Program(t.rctx,n.shader.get().build(this.configuration),p.Default3D)}initializePipeline(){return w.makePipelineState({blending:w.simpleBlendingParams(u.BlendFactor.ONE,u.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:w.defaultColorWriteParams})}}
n.shader=new c.ReloadableShaderModule(f.BlendLayers,()=>new Promise((t,v)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],t,v)));class q extends k.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.background=f.BackgroundMode.BelowLayer}}g.__decorate([e.parameter()],q.prototype,"background",void 0);b.BlendLayersPassParameters=x;b.BlendLayersTechnique=n;b.BlendLayersTechniqueConfiguration=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define(["exports",
"../../../chunks/tslib.es6","./BlendModeTechniqueConfiguration","../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,g,d,k){class m extends g.BlendModeTechniqueConfiguration{constructor(){super(...arguments);this.output=d.BlendLayersOutput.Composite;this.baseOpacityMode=d.BaseOpacityMode.NotRequired;this.premultipliedSource=d.PremultipliedAlphaSource.Off}}b.__decorate([k.parameter({count:d.BlendLayersOutput.COUNT})],
m.prototype,"output",void 0);b.__decorate([k.parameter({count:d.BaseOpacityMode.COUNT})],m.prototype,"baseOpacityMode",void 0);b.__decorate([k.parameter()],m.prototype,"premultipliedSource",void 0);a.TileBlendTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,g,d){class k extends d.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.blendMode=g.LayerBlendMode.Normal}}b.__decorate([d.parameter({count:g.LayerBlendMode.COUNT})],k.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(h){const u=new c.ShaderBuilder;u.include(d.TileComposite);if(h.background===a.BackgroundMode.Only)return(h=h.output===g.BlendLayersOutput.ColorComposite)?u.fragment.uniforms.add(new k.Float3PassUniform("backgroundColor",w=>w.backgroundColor)):u.fragment.include(b.BackgroundGrid),u.fragment.code.add(f.glsl`
    void main() {
      fragColor = vec4(${h?f.glsl`backgroundColor`:f.glsl`gridColor(uv)`}, 1.0);
    }
  `),u;u.include(g.TileBackground,h);u.fragment.uniforms.add(new l.Texture2DPassUniform("tex",w=>w.texture));u.fragment.uniforms.add(new m.FloatPassUniform("opacity",w=>w.opacity));u.fragment.code.add(f.glsl`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`);return u}a.BackgroundMode=void 0;(function(h){h[h.BelowLayer=0]="BelowLayer";h[h.Only=1]="Only";h[h.COUNT=2]="COUNT"})(a.BackgroundMode||(a.BackgroundMode={}));const p=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a.BackgroundMode},build:e},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=p;a.build=e})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(a,b,g){class d{constructor(k,
m,f,c,l,e){this.texture=k;this.type=m;k.retain();this.offsetAndScale=g.fromValues(f.offset[0],f.offset[1],f.scale,f.scale);this.opacities=b.fromValues(c,l,e)}destroy(){this.texture.release()}}a.TextureReference=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){const r=b.getLogger("esri.views.3d.terrain");class y{constructor(z,D){this._rctx=z;this._techniqueRepository=D;this._fbos=[];this._vectorTileHelper=new m.VectorTileRendererHelper3D;this._bindParameters=new w.BindParameters(null,null);this._blendLayersTechniqueConfig=new f.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=n.createQuadVAO(this._rctx,x.Pos2Tex)}dispose(){this._fbos.forEach(g.disposeMaybe);
this._fbos=null;this._vtFBO=g.disposeMaybe(this._vtFBO);this._vaoQuad=g.disposeMaybe(this._vaoQuad);this._vectorTileHelper=g.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=g.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=g.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=g.releaseMaybe(this._blendLayersTechnique)}_getBlendLayersTechnique(z,D,C,E=h.PremultipliedAlphaSource.Off,A=u.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=
D;this._blendLayersTechniqueConfig.blendMode=z;this._blendLayersTechniqueConfig.baseOpacityMode=C;this._blendLayersTechniqueConfig.premultipliedSource=E;this._blendLayersTechniqueConfig.background=A;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(f.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)}drawBackground(z,D){D=this._getBlendLayersTechnique(p.LayerBlendMode.Normal,D?h.BlendLayersOutput.ColorComposite:h.BlendLayersOutput.GridComposite,
h.BaseOpacityMode.NotRequired,h.PremultipliedAlphaSource.Off,u.BackgroundMode.Only);z=this._rctx.bindTechnique(D,z,this._bindParameters);this._render(z)}_render(z){this._rctx.bindVAO(this._vaoQuad);z.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(q.PrimitiveType.TRIANGLE_STRIP,0,v.vertexCount(this._vaoQuad,"geometry"))}drawGroup(z,D,C,E,A,F=h.PremultipliedAlphaSource.On){D===h.BlendLayersOutput.Composite&&(z.fboTexture=this._fbos[this.getLastOnHoldId()].get(C).colorTexture);
z.texture=this.currentFBO(C).colorTexture;this.closeGroup(C);D=this._getBlendLayersTechnique(E,D,A,F);z=this._rctx.bindTechnique(D,z,this._bindParameters);this._render(z)}drawRasterData(z,D,C,E,A,F=h.PremultipliedAlphaSource.Off){null!=z.texture&&(z.fboTexture=D===h.BlendLayersOutput.GroupBackgroundComposite||E===p.LayerBlendMode.Normal&&A===h.BaseOpacityMode.NotRequired&&F===h.PremultipliedAlphaSource.Off?null:this.switch(C).colorTexture,D=this._getBlendLayersTechnique(E,D,A,F),z=this._rctx.bindTechnique(D,
z,this._bindParameters),this._render(z))}drawImageryTileData(z,D,C,E,A,F){var G=F.sourceLayerInfo.data;G.source&&(F.tile.surface.layerViewByIndex(F.layerIndex,c.LayerClass.MAP).ensureSymbolizerParameters(G),G.bind(this._rctx)&&(z.fboTexture=E===p.LayerBlendMode.Normal&&A===h.BaseOpacityMode.NotRequired?null:this.switch(C).colorTexture,D=this._getRasterColorizerTechnique(G,D,E,A),G.opacity=z.opacity,G=G.getUniforms(),G.scale=F.scale,G.offset=F.offset,G.backgroundColor=z.backgroundColor,G.fboTexture=
z.fboTexture,G.baseOpacity=z.baseOpacity,z=this._rctx.bindTechnique(D,G,null),this._render(z)))}_getRasterColorizerTechnique(z,D,C,E){const A=z.symbolizerParameters,F=["stretch","lut","hillshade"].indexOf(A.type);null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new l.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.output=D;this._rasterColorizerConfig.blendMode=C;
this._rasterColorizerConfig.baseOpacityMode=E;this._rasterColorizerConfig.colorizerType=F;this._rasterColorizerConfig.applyColormap=!!A.colormap;this._rasterColorizerConfig.requireBilinearWithNN=z.isBilinearWithStretchColorRamp;this._rasterColorizerConfig.stretchType=z.hasStretchTypeNone()?k.RasterColorizerStretchType.Noop:k.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(l.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)}drawVectorData(z,
D,C,E,A,F,G,I,H){const B=this._rctx,K=F.sourceLayerInfo.data,L=F.tile.surface.layerViewByIndex(F.layerIndex,c.LayerClass.MAP),J=A===h.BaseOpacityMode.Required||1>z.opacity||E!==p.LayerBlendMode.Normal||D!==h.BlendLayersOutput.Composite,M=J?h.PremultipliedAlphaSource.On:h.PremultipliedAlphaSource.Off;var T=this._getBlendLayersTechnique(E,D,A,M);B.setPipelineState(T.getPipeline());let Q=T=null;J?(Q=this.currentFBO(C),null==this._vtFBO&&(this._vtFBO=new e.MultiSizeFramebuffer(this._rctx)),T=this._vtFBO.get(C),
B.bindFramebuffer(T),this._clearCurrentFBO()):H&&B.clearSafe(q.ClearBufferBit.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(B,F.sourceLod,L.painter,L.layer.styleRepository,L.schemaHelper,Math.round(1/F.scale),F.offset,I,G,L.contentZoom),K&&this._vectorTileHelper.renderContent(B,F.sourceLod,K,F.vtlNeighborInfos,L.painter,L.layer.styleRepository,L.schemaHelper,Math.round(1/F.scale),F.offset,I,G,L.contentZoom)}catch(O){r.warnOnce("A render call containing vector tiles did not resolve correctly.",
O)}return null!=T?(B.bindFramebuffer(Q),z.texture=T.colorTexture,z.offset=d.ZEROS,z.scale=1,this.drawRasterData(z,D,C,E,A,M),H):!0}copyFBOToTexture(z){const D=this._rctx,C=D.bindTexture(z.texture,t.Texture.TEXTURE_UNIT_FOR_UPDATES),E=z.descriptor;D.gl.copyTexImage2D(q.TextureType.TEXTURE_2D,0,E.pixelFormat,0,0,E.width,E.height,0);z.generateMipmap();D.bindTexture(C,t.Texture.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255);this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);
this._rctx.setClearStencil(0);this._rctx.clearSafe(q.ClearBufferBit.COLOR_BUFFER_BIT|q.ClearBufferBit.DEPTH_BUFFER_BIT|q.ClearBufferBit.STENCIL_BUFFER_BIT)}_initFBO(z,D,C){this._rctx.bindFramebuffer(z);C&&(this._rctx.setViewport(0,0,D,D),this._clearCurrentFBO())}ensureBuffer(z){this._lastUsedIds.length=0;this._lastUsedIds.push(1);this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(z)}bind(z,D=0,C=!0){this._current=D;if(D>=this._fbos.length)for(let E=this._fbos.length;E<=D;E++)this._fbos.push(new e.MultiSizeFramebuffer(this._rctx));
this._initFBO(this._fbos[D].get(z),z,C)}_bindNextFreeBuffer(z){0<this._lastUsedIds.length?this.bind(z,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(z,this._lastCreatedBufferId))}openGroup(z){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(z)}switch(z){const D=this.currentFBO(z),C=this._current;this._bindNextFreeBuffer(z);this._lastUsedIds.push(C);return D}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(z){const D=this._current;this._bindNextFreeBuffer(z);
this._lastUsedIds.push(D);this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(z){return this._fbos[this._current].get(z)}}a.TileCompositor=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define("exports ../../../../geometry ../../../../Viewpoint ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../ViewState ./style/StyleDefinition ../webgl/RenderableTile ../../../webgl/enums ../../../../geometry/Point".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){class u{constructor(){this._renderParams={context:null,drawPhase:1,state:new c({viewpoint:new g({targetGeometry:new h(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,
blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null};this._backgroundTile=new e.RenderableTile(new k(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(w,x,n,q,t,v,r,y,z,D){const C=this._backgroundTile;this._updateRenderParams(w,x,C,n,t,v,r,y,z,D);this._renderParams.stencilSymbols=!1;n.drawBackground(this._renderParams,C,q)}renderContent(w,x,n,q,t,v,r,y,z,D,C,E){this._stencilSymbols(w,
x,n,q,t,v,r,Math.round(1/y),z,D,C,E);let A=1;n.stencilRef=A++;w.setStencilFunction(p.CompareFunction.EQUAL,n.stencilRef,255);this._render(w,x,n,t,v,r,y,z,D,C,E);q.forAll(F=>{F.sourceLayerInfo.data.stencilRef=A++;this._renderSymbols(w,F.sourceLod,F.sourceLayerInfo.data,t,v,r,Math.round(1/y),F.offset,D,C,E)})}_stencilSymbols(w,x,n,q,t,v,r,y,z,D,C,E){let A=1;n.stencilRef=A++;w.setDepthTestEnabled(!1);w.setDepthWriteEnabled(!1);w.setStencilTestEnabled(!0);w.setBlendingEnabled(!1);w.setColorMask(!1,!1,
!1,!1);w.setStencilOp(p.StencilOperation.KEEP,p.StencilOperation.KEEP,p.StencilOperation.REPLACE);w.setStencilWriteMask(255);w.setStencilFunction(p.CompareFunction.ALWAYS,n.stencilRef,255);this._stencilTileSymbols(w,x,n,t,v,r,y,z,D,C,E);for(const F of q.toArray()){const {sourceLod:G,offset:I,sourceLayerInfo:H}=F;H.data.stencilRef=A++;w.setStencilFunction(p.CompareFunction.ALWAYS,H.data.stencilRef,255);this._stencilTileSymbols(w,G,H.data,t,v,r,y,I,D,C,E)}w.setStencilWriteMask(0);w.setBlendingEnabled(!0);
w.setDepthTestEnabled(!0);w.setColorMask(!0,!0,!0,!0)}_renderSymbols(w,x,n,q,t,v,r,y,z,D,C){w.setStencilFunction(p.CompareFunction.EQUAL,n.stencilRef,255);this._render(w,x,n,q,t,v,r,y,z,D,C,l.StyleLayerType.SYMBOL)}_render(w,x,n,q,t,v,r,y,z,D,C,E){this._updateRenderParams(w,x,n,q,v,r,y,z,D,C);this._renderParams.stencilSymbols=!1;q.drawTile(this._renderParams,n,t,E)}_stencilTileSymbols(w,x,n,q,t,v,r,y,z,D,C){this._updateRenderParams(w,x,n,q,v,r,y,z,D,C);this._renderParams.stencilSymbols=!0;n.triangleCount=
0;q.drawSymbols(this._renderParams,n,t)}_updateRenderParams(w,x,n,q,t,v,r,y,z,D){"type"in n&&"vector-tile"===n.type&&!n.stage&&n.attachWithContext(w);const C=x[0]-t.getLevelShift(x[0]),E=this._renderParams;E.context=w;E.painter=q;E.glyphMosaic=q.glyphMosaic;E.spriteMosaic=q.spriteMosaic;E.pixelRatio=z*D;E.displayLevel=C;E.requiredLevel=C;w=t.getScale(x[0]);const [A,F]=t.getOffset(x,v*w);x=.125*v*w/y;n=n.transforms.dvs;n[0]=x;n[4]=-x;n[6]=-1-A-r[0]*v*2;n[7]=1+F+(1-r[1])*v*2-2;E.state.size[0]=y/D;E.state.size[1]=
y/D;E.state.pixelRatio=D}}a.VectorTileRendererHelper3D=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils","./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(a,b,g,d,k){const m=new d("0/0/0/0");class f{static create(e,p){e[1]>p[1]&&([e,p]=[p,e]);const [h,u]=e,[w,x]=p;e=w-h;p=x-u;p=0!==p?e/p:0;const n=(Math.ceil(u)-u)*p,q=(Math.floor(u)-u)*p;return new f(h,Math.floor(u),
Math.ceil(x),p,0>e?n:q,0>e?q:n,0>e?w:h,0>e?h:w)}constructor(e,p,h,u,w,x,n,q){this.x=e;this.ymin=p;this.ymax=h;this.invM=u;this.leftAdjust=w;this.rightAdjust=x;this.leftBound=n;this.rightBound=q}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const c=[[0,0],[0,0],[0,0],[0,0]];class l{constructor(e,p=null,h=e.lods[0].level,u=e.lods[e.lods.length-1].level){this.tileInfo=e;this.fullExtent=
p;this.scales=[];this._infoByScale={};this._infoByLevel={};const w=e.lods.filter(n=>n.level>=h&&n.level<=u);this.minScale=w[0].scale;this.maxScale=w[w.length-1].scale;const x=this._lodInfos=w.map(n=>b.create(e,n,p));w.forEach((n,q)=>{this._infoByLevel[n.level]=x[q];this._infoByScale[n.scale]=x[q];this.scales[q]=n.scale},this);this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"===typeof e?e:e.level]}getTileBounds(e,
p,h=!1){m.set(p);return(p=this._infoByLevel[m.level])?p.getTileBounds(e,m,h):e}getTileCoords(e,p,h=!1){m.set(p);return(p=this._infoByLevel[m.level])?p.getTileCoords(e,m,h):e}getTileCoverage(e,p=192,h=!0,u="closest"){if(!h&&(e.scale>this.minScale||e.scale<this.maxScale))return null;h="closest"===u?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale);u=g.pool.acquire(h);const w=this._wrap;var x=Infinity;let n=-Infinity;const q=u.spans;c[0][0]=c[0][1]=c[1][1]=c[3][0]=-p;c[1][0]=
c[2][0]=e.size[0]+p;c[2][1]=c[3][1]=e.size[1]+p;for(t of c)e.toMap(t,t),t[0]=h.getColumnForX(t[0]),t[1]=h.getRowForY(t[1]);e=[];var t=3;for(p=0;4>p;p++)c[p][1]===c[t][1]?t=p:(t=f.create(c[p],c[t]),x=Math.min(t.ymin,x),n=Math.max(t.ymax,n),void 0===e[t.ymin]&&(e[t.ymin]=[]),e[t.ymin].push(t),t=p);if(null==x||null==n||100<n-x)return null;for(p=[];x<n;){null!=e[x]&&(p=p.concat(e[x]));t=Infinity;var v=-Infinity;for(var r=p.length-1;0<=r;r--){var y=p[r];t=Math.min(t,y.getLeftCol());v=Math.max(v,y.getRightCol())}t=
Math.floor(t);v=Math.floor(v);if(x>=h.first[1]&&x<=h.last[1])if(w)if(h.size[0]<h.worldSize[0])for(r=Math.floor(v/h.worldSize[0]),y=Math.floor(t/h.worldSize[0]);y<=r;y++)q.push(new k(x,Math.max(h.getFirstColumnForWorld(y),t),Math.min(h.getLastColumnForWorld(y),v)));else q.push(new k(x,t,v));else t>h.last[0]||v<h.first[0]||(t=Math.max(t,h.first[0]),v=Math.min(v,h.last[0]),q.push(new k(x,t,v)));x+=1;for(t=p.length-1;0<=t;t--)v=p[t],v.ymax>=x?v.incrRow():p.splice(t,1)}return u}getTileParentId(e){m.set(e);
e=this._lodInfos.indexOf(this._infoByLevel[m.level])-1;if(0>e)return null;this._getTileIdAtLOD(m,this._lodInfos[e],m);return m.id}getTileResolution(e){return(e=this._infoByLevel["object"===typeof e?e.level:e])?e.resolution:-1}getTileScale(e){return(e=this._infoByLevel[e.level])?e.scale:-1}intersects(e,p){m.set(p);p=this._infoByLevel[m.level];const h=e.lodInfo;if(h.resolution>p.resolution){this._getTileIdAtLOD(m,h,m);var u=h.denormalizeCol(m.col,m.world);for(var w of e.spans)if(w.row===m.row&&w.colFrom<=
u&&w.colTo>=u)return!0}if(h.resolution<p.resolution){const [n,q,t,v]=e.spans.reduce((r,y)=>{r[0]=Math.min(r[0],y.row);r[1]=Math.max(r[1],y.row);r[2]=Math.min(r[2],y.colFrom);r[3]=Math.max(r[3],y.colTo);return r},[Infinity,-Infinity,Infinity,-Infinity]);u=p.denormalizeCol(m.col,m.world);e=h.getColumnForX(p.getXForColumn(u));w=h.getRowForY(p.getYForRow(m.row));u=h.getColumnForX(p.getXForColumn(u+1))-1;p=h.getRowForY(p.getYForRow(m.row+1))-1;return!(e>v||u<t||w>q||p<n)}const x=h.denormalizeCol(m.col,
m.world);return e.spans.some(n=>n.row===m.row&&n.colFrom<=x&&n.colTo>=x)}normalizeBounds(e,p,h){e[0]=p[0];e[1]=p[1];e[2]=p[2];e[3]=p[3];this._wrap&&(p=a.getInfo(this.tileInfo.spatialReference),h=-h*(p.valid[1]-p.valid[0]),e[0]+=h,e[2]+=h);return e}getSmallestInfoForScale(e){const p=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>p[0])return this._infoByScale[p[0]];for(let h=1;h<p.length-1;h++)if(e>p[h]+1E-6)return this._infoByScale[p[h-1]];return this._infoByScale[p[p.length-
1]]}getClosestInfoForScale(e){const p=this.scales;if(this._infoByScale[e])return this._infoByScale[e];e=p.reduce((h,u)=>Math.abs(u-e)<Math.abs(h-e)?u:h,p[0]);return this._infoByScale[e]}scaleToLevel(e){const p=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let h=p.length-1;0<=h;h--)if(e<p[h])return h===p.length-1?this._infoByScale[p[p.length-1]].level:this._infoByScale[p[h]].level+(p[h]-e)/(p[h]-p[h+1]);return this._infoByScale[p[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,
p,h){const u=this._infoByLevel[h.level];e.set(h);if(p.resolution<u.resolution)return null;if(p.resolution===u.resolution)return e;e.level=p.level;e.col=Math.floor(h.col*u.resolution/p.resolution+.01);e.row=Math.floor(h.row*u.resolution/p.resolution+.01);return e}}return l})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(a,b){function g(m,f,c){m[0]=f;m[1]=c;return m}const d=new b("0/0/0/0");class k{static create(m,f,c=null){var l=
a.getInfo(m.spatialReference);const e=f.origin||[m.origin.x,m.origin.y],p=[m.size[0]*f.resolution,m.size[1]*f.resolution],h=[-Infinity,-Infinity],u=[Infinity,Infinity],w=[Infinity,Infinity];null!=c&&(g(h,Math.max(0,Math.floor((c.xmin-e[0])/p[0])),Math.max(0,Math.floor((e[1]-c.ymax)/p[1]))),g(u,Math.max(0,Math.floor((c.xmax-e[0])/p[0])),Math.max(0,Math.floor((e[1]-c.ymin)/p[1]))),g(w,u[0]-h[0]+1,u[1]-h[1]+1));const {cols:x,rows:n}=f;!c&&x&&n&&(g(h,x[0],n[0]),g(u,x[1],n[1]),g(w,x[1]-x[0]+1,n[1]-n[0]+
1));let q;m.isWrappable?(m=[Math.ceil(Math.round((l.valid[1]-l.valid[0])/f.resolution)/m.size[0]),w[1]],l=[Math.floor((l.origin[0]-e[0])/p[0]),h[1]],c=[m[0]+l[0]-1,u[1]],q=!0):(l=h,c=u,m=w,q=!1);return new k(f.level,f.resolution,f.scale,e,h,u,w,p,l,c,m,q)}constructor(m,f,c,l,e,p,h,u,w,x,n,q){this.level=m;this.resolution=f;this.scale=c;this.origin=l;this.first=e;this.last=p;this.size=h;this.norm=u;this.worldStart=w;this.worldEnd=x;this.worldSize=n;this.wrap=q}normalizeCol(m){if(!this.wrap)return m;
const f=this.worldSize[0];return 0>m?f-1-Math.abs((m+1)%f):m%f}denormalizeCol(m,f){return this.wrap?this.worldSize[0]*f+m:m}getWorldForColumn(m){return this.wrap?Math.floor(m/this.worldSize[0]):0}getFirstColumnForWorld(m){return m*this.worldSize[0]+this.first[0]}getLastColumnForWorld(m){return m*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(m){return(m-this.origin[0])/this.norm[0]}getXForColumn(m){return this.origin[0]+m*this.norm[0]}getRowForY(m){return(this.origin[1]-m)/this.norm[1]}getYForRow(m){return this.origin[1]-
m*this.norm[1]}getTileBounds(m,f,c=!1){d.set(f);var l=c?d.col:this.denormalizeCol(d.col,d.world),e=d.row;f=this.getXForColumn(l);c=this.getYForRow(e+1);l=this.getXForColumn(l+1);e=this.getYForRow(e);m[0]=f;m[1]=c;m[2]=l;m[3]=e;return m}getTileCoords(m,f,c=!1){d.set(f);f=c?d.col:this.denormalizeCol(d.col,d.world);Array.isArray(m)?g(m,this.getXForColumn(f),this.getYForRow(d.row)):(m.x=this.getXForColumn(f),m.y=this.getYForRow(d.row));return m}}return k})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool"],
function(a){class b{constructor(){this.spans=[]}acquire(g){this.lodInfo=g}release(){this.lodInfo=null;this.spans.length=0}forEach(g,d){const {spans:k,lodInfo:m}=this,{level:f}=m;if(0!==k.length)for(const {row:c,colFrom:l,colTo:e}of k)for(let p=l;p<=e;p++)g.call(d,f,c,m.normalizeCol(p),m.getWorldForColumn(p))}}b.pool=new a(b);return b})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class a{constructor(b,g,d){this.row=b;this.colFrom=g;this.colTo=d}}return a})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../support/QueueProcessor".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(n,q){n.length=0;q.forEach(t=>n.push(t));return n}const h=new Set,u=[],w=new Map,x=[0,0];b=class extends b{constructor(n){super(n);this._keyToItem=new Map;this.concurrency=6;this.strategy="scale-first";this.tileInfoView=null}initialize(){const {concurrency:n,process:q,strategy:t}=this;this._queue=new e.QueueProcessor({concurrency:n,process:(v,r)=>{v=this._keyToItem.get(v);return q(v,{signal:r})},peeker:"scale-first"===t?v=>this._peekByScaleFirst(v):v=>this._peekByCenterFirst(v)})}destroy(){this.clear();
this._queue=g.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(n){this._queue.abort("string"===typeof n?n:n.id)}clear(){this._queue.clear();this._keyToItem.clear()}has(n){return"string"===typeof n?this._keyToItem.has(n):this._keyToItem.has(n.id)}isOngoing(n){n="string"===typeof n?n:n.id;return this.has(n)&&this._queue.isOngoing(n)}pause(){this._queue.pause()}push(n){const q=n.key.id;if(this._queue.has(q))return this._queue.get(q);
const t=this._queue.push(q),v=()=>{this._keyToItem.delete(q)};this._keyToItem.set(q,n);t.then(v,v);return t}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(n){if(!this.state)return n.values().next().value;const q=this.tileInfoView;let t=Number.NEGATIVE_INFINITY,v=Number.POSITIVE_INFINITY;n.forEach(C=>{C=this._keyToItem.get(C);const E=this.tileInfoView.getTileScale(C.key);w.has(E)||(w.set(E,[]),t=Math.max(E,t),v=Math.min(E,v));w.get(E).push(C.key);h.add(E)});let r=this.state.scale;
w.has(r)||(p(u,h),u.sort((C,E)=>C-E),r=u.reduce((C,E)=>Math.abs(E-r)<Math.abs(C-r)?E:C,u[0]));r=Math.min(r,t);r=Math.max(r,v);n=w.get(r);const y=q.getClosestInfoForScale(r),z=y.getColumnForX(this.state.center[0]),D=y.getRowForY(this.state.center[1]);n.sort((C,E)=>{const A=y.denormalizeCol(C.col,C.world),F=y.denormalizeCol(E.col,E.world);return Math.sqrt((z-A)*(z-A)+(D-C.row)*(D-C.row))-Math.sqrt((z-F)*(z-F)+(D-E.row)*(D-E.row))});h.clear();w.clear();return n[0].id}_peekByCenterFirst(n){if(!this.state)return n.values().next().value;
const q=this.tileInfoView,t=this.state.center;let v=Number.POSITIVE_INFINITY,r;n.forEach(y=>{y=this._keyToItem.get(y);q.getTileCoords(x,y.key);const z=l.distance(x,t);z<v&&(v=z,r=y.key)});return r.id}};a.__decorate([d.property({constructOnly:!0})],b.prototype,"concurrency",void 0);a.__decorate([d.property({constructOnly:!0})],b.prototype,"process",void 0);a.__decorate([d.property()],b.prototype,"state",void 0);a.__decorate([d.property({constructOnly:!0})],b.prototype,"strategy",void 0);a.__decorate([d.property({constructOnly:!0})],
b.prototype,"tileInfoView",void 0);return b=a.__decorate([c.subclass("esri.views.2d.tiling.TileQueue")],b)})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),function(a,b,g,d,k,m,f){class c{constructor(e,p){this.item=e;this.controller=p;this.promise=null}}class l{constructor(e){this._task=this._schedule=null;this._deferreds=new k;this._controllers=new k;
this._processingItems=new k;this._pausedSignal=f.signal(!1);this.concurrency=1;e.concurrency&&(this.concurrency=e.concurrency);this._queue=new d(e.peeker);this.process=e.process;const p=e.scheduler;e.priority&&p&&(this._task=p.registerTask(e.priority,this))}destroy(){this.clear();this._schedule=b.removeMaybe(this._schedule);this._task=b.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){(e=this._controllers.get(e))&&
e.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(p=>e.push(p));this._controllers.clear();e.forEach(p=>p.abort());this._processingItems.clear();this._cancelNext()}forEach(e){this._deferreds.forEach((p,h)=>e(h))}get(e){return(e=this._deferreds.get(e))?e.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,p){const h=this.get(e);if(h)return h;
const u=new AbortController;let w=null;p&&(w=g.onAbort(p,()=>u.abort()));const x=()=>{n.remove();null!=w&&w.remove();this._deferreds.delete(e);this._controllers.delete(e);this._queue.remove(e);this._processingItems.delete(e);this._scheduleNext()},n=g.onAbortOrThrow(u.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort();x();q.reject(g.createAbortError())}),q=g.createResolver();this._deferreds.set(e,q);this._controllers.set(e,u);q.promise.then(x,x);this._queue.push(e);this._scheduleNext();
return q.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach(p=>e.push(p));this._processingItems.clear();for(const p of e)this._queue.push(p.item),p.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());this.clear();return e}get running(){return!this._pausedSignal.value&&
0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=m.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),
this._schedule=null)}_processResult(e,p){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(p))}_processError(e,p){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(p))}_canProcessFulfillment(e){return this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e?!0:!1}_process(e){if(null!=e){var p=new AbortController,h=new c(e,p);this._processingItems.set(e,h);try{var u=this.process(e,p.signal)}catch(w){this._processError(h,
w)}g.isPromiseLike(u)?(h.promise=u,u.then(w=>this._processResult(h,w),w=>this._processError(h,w))):this._processResult(h,u)}}get test(){return{update:e=>this.runTask(e)}}}a.QueueProcessor=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,b){class g{constructor(){this._map=new Map;this._observable=new b.SimpleObservable}get size(){a.trackAccess(this._observable);
return this._map.size}clear(){0<this._map.size&&(this._map.clear(),this._observable.notify())}delete(d){(d=this._map.delete(d))&&this._observable.notify();return d}entries(){a.trackAccess(this._observable);return this._map.entries()}forEach(d,k){a.trackAccess(this._observable);this._map.forEach((m,f)=>d.call(k,m,f,this),k)}get(d){a.trackAccess(this._observable);return this._map.get(d)}has(d){a.trackAccess(this._observable);return this._map.has(d)}keys(){a.trackAccess(this._observable);return this._map.keys()}set(d,
k){this._map.set(d,k);this._observable.notify();return this}values(){a.trackAccess(this._observable);return this._map.values()}[Symbol.iterator](){a.trackAccess(this._observable);return this._map[Symbol.iterator]()}get [Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}return g})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache","./TileCoverage","./TileKey"],function(a,b,g,d){const k=new d(0,0,0,0),m=new Map,f=[],c=[];class l{constructor(e){this._previousScale=
Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=e.acquireTile;this.releaseTile=e.releaseTile;this.tileInfoView=e.tileInfoView;null!=e.resampling&&(this.resampling=e.resampling);e.cachePolicy&&(this.cachePolicy=e.cachePolicy);e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy);null!=e.buffer&&(this.buffer=e.buffer);e.cacheSize&&(this._tileCache=new b(e.cacheSize,this.tileInfoView,
p=>{this.releaseTile(p)}))}destroy(){this.tileIndex.clear()}update(e){const {resampling:p,tileIndex:h}=this,{scale:u,center:w,resolution:x}=e.state,{minScale:n,maxScale:q}=this.tileInfoView,t=!e.stationary&&u>this._previousScale;this._previousScale=u;if(!p&&(u>n||u<q))this.tiles.length=0,this.clear();else if(e=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy)){var {spans:v,lodInfo:r}=e,{level:y}=r;this.tiles.length=0;h.forEach(E=>E.visible=!0);var z=0,D=0;
if(0<v.length)for(const {row:E,colFrom:A,colTo:F}of v)for(var C=A;C<=F;C++){z++;const G=k.set(y,E,r.normalizeCol(C),r.getWorldForColumn(C)).id;let I=h.get(G);if(I)I.isReady?(m.set(G,I),D++):t||this._addParentTile(G,m);else{if(this._tileCache?.has(G)){if(I=this._tileCache.pop(G),this.tileIndex.set(G,I),I.isReady){m.set(G,I);D++;continue}}else I=this.acquireTile(k),this.tileIndex.set(G,I);t||this._addParentTile(G,m)}}z=D===z;for(const [E,A]of h)m.has(E)||(k.set(E),D=this.tileInfoView.intersects(e,k),
C="purge"===this.cachePolicy?k.level!==y:k.level>y,!D||!t&&z?!C&&D||f.push(A):A.isReady?C&&"purge"===this.cachePolicy&&this._hasReadyAncestor(k,y)?f.push(A):c.push(A):C&&f.push(A));for(const E of c)E.isReady&&m.set(E.key.id,E);for(const E of f)this._tileCache?this._tileCache.add(E):this.releaseTile(E),h.delete(E.key.id);for(const E of m.values())this.tiles.push(E);for(const E of h.values())m.has(E.key.id)||(E.visible=!1);this._tileCache?.prune(y,w,x);g.pool.release(e);c.length=0;f.length=0;m.clear()}else this.tiles.length=
0,this.clear()}clear(){const {tileIndex:e}=this;for(const p of e.values())this.releaseTile(p);e.clear()}refresh(e){for(const p of this.tileIndex.values())this.tiles.includes(p)?e(p):f.push(p);for(const p of f)this.releaseTile(p),this.tileIndex.delete(p.key.id);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,p){let h=null;for(;;){e=this.tileInfoView.getTileParentId(e);if(!e)break;if(this.tileIndex.has(e)){if(h=this.tileIndex.get(e),h?.isReady){p.has(h.key.id)||
p.set(h.key.id,h);break}}else if(this._tileCache?.has(e)&&(h=this._tileCache.pop(e),this.tileIndex.set(e,h),h?.isReady)){p.has(h.key.id)||p.set(h.key.id,h);break}}}_hasReadyAncestor(e,p){const h=a.create();this.tileInfoView.getTileBounds(h,e,!0);for(const u of this.tileIndex.values())if(u.isReady&&u.key.level>=p&&u.key.level<e.level){const w=a.create();this.tileInfoView.getTileBounds(w,u.key,!0);if(a.contains(w,h))return!0}return!1}}return l})},"esri/views/2d/tiling/TileCache":function(){define(["../../../chunks/vec2"],
function(a){class b{constructor(g,d,k){this.maxSize=g;this._tileInfoView=d;this._removedFunc=k;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=[]}has(g){return this._tilePerId.has(g)}get(g){return this._tilePerId.get(g)}pop(g){const d=this._tilePerId.get(g);if(d){var k=this._tileKeysPerLevel[d.key.level];this._tilePerId["delete"](g);for(let m=0;m<k.length;m++)if(k[m].id===g){k.splice(m,1);break}d.visible=!0;return d}}add(g){g.visible=!1;const d=
g.key,k=d.id;this._tilePerId.has(k)||(this._tilePerId.set(k,g),g=d.level,this._tileKeysPerLevel[g]||(this._tileKeysPerLevel[g]=[]),this._tileKeysPerLevel[g].push(d))}prune(g,d,k){let m=this._tilePerId.size;if(!(m<=this.maxSize)){for(var f=this._tileKeysPerLevel.length-1;m>this.maxSize&&0<=f;)f!==g&&(m=this._pruneAroundCenterTile(m,d,k,f)),f--;m>this.maxSize&&(m=this._pruneAroundCenterTile(m,d,k,g))}}_pruneAroundCenterTile(g,d,k,m){m=this._tileKeysPerLevel[m];if(!m||0===m.length)return g;const {size:f,
origin:c}=this._tileInfoView.tileInfo,l=k*f[0],e=k*f[1],p=[0,0],h=[0,0];for(m.sort((u,w)=>{p[0]=c.x+l*(u.col+.5);p[1]=c.y-e*(u.row+.5);h[0]=c.x+l*(w.col+.5);h[1]=c.y-e*(w.row+.5);return a.squaredDistance(p,d)-a.squaredDistance(h,d)});0<m.length&&(k=m.pop(),this._removeTile(k.id),g--,g!==this.maxSize););return g}_removeTile(g){const d=this._tilePerId.get(g);this._removedFunc&&d&&this._removedFunc(d);this._tilePerId["delete"](g)}}return b})},"esri/views/2d/ViewState":function(){define("../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ../../geometry/support/normalizeUtils ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){var C;const E=[0,0];b=C=class extends d.JSONSupport{constructor(A){super(A);this._viewpoint2D={center:t.create(),rotation:0,scale:0,spatialReference:void 0};this.center=[0,0];this.extent=new z;this.id=0;this.inverseTransform=u.create();this.scale=this.rotation=this.resolution=0;this.transform=u.create();this.transformNoRotation=u.create();this.displayMat3=x.create();this.displayViewMat3=x.create();this.viewMat3=x.create();this.viewMat2d=h.create();
this.worldScreenWidth=0;this.size=[0,0]}set pixelRatio(A){this._set("pixelRatio",A);this._update()}set size(A){this._set("size",A);this._update()}set viewpoint(A){if(A){const F=this._viewpoint2D,G=A.targetGeometry;F.center[0]=G.x;F.center[1]=G.y;F.rotation=A.rotation;F.scale=A.scale;F.spatialReference=G.spatialReference}this._update()}copy(A){const F=this.size,G=this.viewpoint;G&&F?(this.viewpoint=y.copy(G,A.viewpoint),this._set("size",n.copy(F,A.size))):(this.viewpoint=A.viewpoint.clone(),this._set("size",
[A.size[0],A.size[1]]));this._set("pixelRatio",A.pixelRatio);return this}clone(){return new C({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(A,F,G){if(v.isVec2(F))return n.transformMat2d(A,F,this.inverseTransform);E[0]=F;E[1]=G;return n.transformMat2d(A,E,this.inverseTransform)}toScreen(A,F,G){if(v.isVec2(F))return n.transformMat2d(A,F,this.transform);E[0]=F;E[1]=G;return n.transformMat2d(A,E,this.transform)}toScreenNoRotation(A,F,G){if(v.isVec2(F))return n.transformMat2d(A,
F,this.transformNoRotation);E[0]=F;E[1]=G;return n.transformMat2d(A,E,this.transformNoRotation)}toScreenClosest(A,F,G){v.isVec2(F)?(E[0]=F[0],E[1]=F[1]):(E[0]=F,E[1]=G);[F]=E;const {center:I,extent:H,spatialReference:B,transform:K}=this;if(F<H.xmin||F>H.xmax)E[0]=r.getClosestDenormalizedXToReference(F,I[0],B);return n.transformMat2d(A,E,K)}getScreenTransform(A,F){const {center:G}=this._viewpoint2D,I=this._get("pixelRatio")||1,H=this._get("size");y.getMatrix(A,G,H,F,0,I);return A}_update(){const {center:A,
spatialReference:F,scale:G,rotation:I}=this._viewpoint2D,H=this._get("pixelRatio")||1,B=this._get("size"),K=new g({targetGeometry:new D(A[0],A[1],F),scale:G,rotation:I});this._set("viewpoint",K);if(B&&F&&G){this.resolution=y.getResolution(K);this.rotation=I;this.scale=G;this.spatialReference=F;n.copy(this.center,A);w.set(this.displayMat3,0!==B[0]?2/B[0]:0,0,0,0,0!==B[1]?-2/B[1]:0,0,-1,1,1);var L=w.identity(this.viewMat3),J=q.fromValues(B[0]/2,B[1]/2),M=q.fromValues(-B[0]/2,-B[1]/2),T=e.toRadian(I);
w.translate(L,L,J);w.rotate(L,L,T);w.translate(L,L,M);w.multiply(this.displayViewMat3,this.displayMat3,L);L=p.fromTranslation(this.viewMat2d,J);p.rotate(L,L,T);p.translate(L,L,M);y.getExtent(this.extent,K,B);y.getTransform(this.transform,K,B,H);p.invert(this.inverseTransform,this.transform);y.getTransformNoRotation(this.transformNoRotation,K,B,H);this.worldScreenWidth=y.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",this.id+1);return this}}};a.__decorate([k.property({readOnly:!0})],
b.prototype,"id",void 0);a.__decorate([k.property({value:1,json:{write:!0}})],b.prototype,"pixelRatio",null);a.__decorate([k.property({json:{write:!0}})],b.prototype,"size",null);a.__decorate([k.property()],b.prototype,"spatialReference",void 0);a.__decorate([k.property({type:g,json:{write:!0}})],b.prototype,"viewpoint",null);return b=C=a.__decorate([l.subclass("esri.views.2d.ViewState")],b)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,b){function g(C,E){C[0]=E[0];C[1]=
E[1];C[2]=E[2];C[3]=E[3];C[4]=E[4];C[5]=E[5];return C}function d(C){C[0]=1;C[1]=0;C[2]=0;C[3]=1;C[4]=0;C[5]=0;return C}function k(C,E,A,F,G,I,H){C[0]=E;C[1]=A;C[2]=F;C[3]=G;C[4]=I;C[5]=H;return C}function m(C,E){const A=E[0],F=E[1],G=E[2],I=E[3],H=E[4];E=E[5];let B=A*I-F*G;if(!B)return null;B=1/B;C[0]=I*B;C[1]=-F*B;C[2]=-G*B;C[3]=A*B;C[4]=(G*E-I*H)*B;C[5]=(F*H-A*E)*B;return C}function f(C){return C[0]*C[3]-C[1]*C[2]}function c(C,E,A){const F=E[0],G=E[1],I=E[2],H=E[3],B=E[4];E=E[5];const K=A[0],L=
A[1],J=A[2],M=A[3],T=A[4];A=A[5];C[0]=F*K+I*L;C[1]=G*K+H*L;C[2]=F*J+I*M;C[3]=G*J+H*M;C[4]=F*T+I*A+B;C[5]=G*T+H*A+E;return C}function l(C,E,A){const F=E[0],G=E[1],I=E[2],H=E[3],B=E[4];E=E[5];const K=Math.sin(A);A=Math.cos(A);C[0]=F*A+I*K;C[1]=G*A+H*K;C[2]=F*-K+I*A;C[3]=G*-K+H*A;C[4]=B;C[5]=E;return C}function e(C,E,A){const F=E[1],G=E[2],I=E[3],H=E[4],B=E[5],K=A[0];A=A[1];C[0]=E[0]*K;C[1]=F*K;C[2]=G*A;C[3]=I*A;C[4]=H;C[5]=B;return C}function p(C,E,A){const F=E[0],G=E[1],I=E[2],H=E[3],B=E[4];E=E[5];
const K=A[0];A=A[1];C[0]=F;C[1]=G;C[2]=I;C[3]=H;C[4]=F*K+I*A+B;C[5]=G*K+H*A+E;return C}function h(C,E){const A=Math.sin(E);E=Math.cos(E);C[0]=E;C[1]=A;C[2]=-A;C[3]=E;C[4]=0;C[5]=0;return C}function u(C,E){C[0]=E[0];C[1]=0;C[2]=0;C[3]=E[1];C[4]=0;C[5]=0;return C}function w(C,E){C[0]=1;C[1]=0;C[2]=0;C[3]=1;C[4]=E[0];C[5]=E[1];return C}function x(C){return"mat2d("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+")"}function n(C){return Math.sqrt(C[0]**2+C[1]**2+C[2]**2+C[3]**2+C[4]**2+C[5]**2+
1)}function q(C,E,A){C[0]=E[0]+A[0];C[1]=E[1]+A[1];C[2]=E[2]+A[2];C[3]=E[3]+A[3];C[4]=E[4]+A[4];C[5]=E[5]+A[5];return C}function t(C,E,A){C[0]=E[0]-A[0];C[1]=E[1]-A[1];C[2]=E[2]-A[2];C[3]=E[3]-A[3];C[4]=E[4]-A[4];C[5]=E[5]-A[5];return C}function v(C,E,A){C[0]=E[0]*A;C[1]=E[1]*A;C[2]=E[2]*A;C[3]=E[3]*A;C[4]=E[4]*A;C[5]=E[5]*A;return C}function r(C,E,A,F){C[0]=E[0]+A[0]*F;C[1]=E[1]+A[1]*F;C[2]=E[2]+A[2]*F;C[3]=E[3]+A[3]*F;C[4]=E[4]+A[4]*F;C[5]=E[5]+A[5]*F;return C}function y(C,E){return C[0]===E[0]&&
C[1]===E[1]&&C[2]===E[2]&&C[3]===E[3]&&C[4]===E[4]&&C[5]===E[5]}function z(C,E){const A=C[0],F=C[1],G=C[2],I=C[3],H=C[4];C=C[5];const B=E[0],K=E[1],L=E[2],J=E[3],M=E[4];E=E[5];const T=b.getEpsilon();return Math.abs(A-B)<=T*Math.max(1,Math.abs(A),Math.abs(B))&&Math.abs(F-K)<=T*Math.max(1,Math.abs(F),Math.abs(K))&&Math.abs(G-L)<=T*Math.max(1,Math.abs(G),Math.abs(L))&&Math.abs(I-J)<=T*Math.max(1,Math.abs(I),Math.abs(J))&&Math.abs(H-M)<=T*Math.max(1,Math.abs(H),Math.abs(M))&&Math.abs(C-E)<=T*Math.max(1,
Math.abs(C),Math.abs(E))}const D=Object.freeze(Object.defineProperty({__proto__:null,add:q,copy:g,determinant:f,equals:z,exactEquals:y,frob:n,fromRotation:h,fromScaling:u,fromTranslation:w,identity:d,invert:m,mul:c,multiply:c,multiplyScalar:v,multiplyScalarAndAdd:r,rotate:l,scale:e,set:k,str:x,sub:t,subtract:t,translate:p},Symbol.toStringTag,{value:"Module"}));a.add=q;a.copy=g;a.determinant=f;a.equals=z;a.exactEquals=y;a.frob=n;a.fromRotation=h;a.fromScaling=u;a.fromTranslation=w;a.identity=d;a.invert=
m;a.mat2d=D;a.mul=c;a.multiply=c;a.multiplyScalar=v;a.multiplyScalarAndAdd=r;a.rotate=l;a.scale=e;a.set=k;a.str=x;a.sub=t;a.subtract=t;a.translate=p})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function b(){const l=new Float32Array(6);l[0]=1;l[3]=1;return l}function g(l){const e=new Float32Array(6);e[0]=l[0];e[1]=l[1];e[2]=l[2];e[3]=l[3];e[4]=l[4];e[5]=l[5];return e}function d(l,e,p,h,u,w){const x=new Float32Array(6);x[0]=l;x[1]=e;x[2]=p;x[3]=h;x[4]=u;x[5]=w;return x}function k(l,
e){return new Float32Array(l,e,6)}function m(l,e,p,h){const u=e[h];e=e[h+1];l[h]=p[0]*u+p[2]*e+p[4];l[h+1]=p[1]*u+p[3]*e+p[5]}function f(l,e,p,h=0,u=0,w=2){for(u=u||e.length/w;h<u;h++)m(l,e,p,h*w)}const c=Object.freeze(Object.defineProperty({__proto__:null,clone:g,create:b,createView:k,fromValues:d,transform:m,transformMany:f},Symbol.toStringTag,{value:"Module"}));a.clone=g;a.create=b;a.createView=k;a.fromValues=d;a.mat2df32=c;a.transform=m;a.transformMany=f})},"esri/chunks/mat2df64":function(){define(["exports"],
function(a){function b(){return[1,0,0,1,0,0]}function g(f){return[f[0],f[1],f[2],f[3],f[4],f[5]]}function d(f,c,l,e,p,h){return[f,c,l,e,p,h]}function k(f,c){return new Float64Array(f,c,6)}const m=Object.freeze(Object.defineProperty({__proto__:null,clone:g,create:b,createView:k,fromValues:d},Symbol.toStringTag,{value:"Module"}));a.clone=g;a.create=b;a.createView=k;a.fromValues=d;a.mat2df64=m})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function b(d){return d instanceof
Float32Array&&2<=d.length}function g(d){return Array.isArray(d)&&2<=d.length}a.isVec2=function(d){return b(d)||g(d)};a.isVec2f32=b;a.isVec2f64=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../Viewpoint ../../core/Collection ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/normalizeUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n){function q(N,V){return V.type?c.set(N,V.x,V.y):c.copy(N,V)}function t(N,V){return Math.max(N.width/Math.max(1,V[0]),N.height/Math.max(1,V[1]))*E(N.spatialReference)}async function v(N,V,S,X){if(!N||Array.isArray(N)&&!N.length)return null;g.isCollection(N)&&(N=N.toArray());if(Array.isArray(N)&&N.length&&"object"===typeof N[0]){var ca=N.every(ea=>"attributes"in ea);var ba=N.some(ea=>!ea.geometry),ia=N;if(ca&&ba&&V&&V.allLayerViews){ca=new Map;for(var ka of N)N=
ka.layer,ba=ca.get(N)||[],ia=ka.attributes[N.objectIdField],null!=ia&&ba.push(ia),ca.set(N,ba);const ea=[];ca.forEach((fa,aa)=>{const da=V.allLayerViews.find(ma=>ma.layer.id===aa.id);if(da&&"queryFeatures"in da){const ma=aa.createQuery();ma.objectIds=fa;ma.returnGeometry=!0;ea.push(da.queryFeatures(ma))}});ka=await Promise.all(ea);N=[];for(var na of ka)if(na&&na.features&&na.features.length)for(var Y of na.features)null!=Y.geometry&&N.push(Y.geometry);ia=N}for(const ea of ia)X=await v(ea,V,S,X);return X}if(Array.isArray(N)&&
2===N.length&&"number"===typeof N[0]&&"number"===typeof N[1])ca=new h(N);else if(N instanceof p)ca=N;else if("geometry"in N)if(N.geometry)ca=N.geometry;else if(N.layer){const ea=N.layer;(na=V.allLayerViews.find(fa=>fa.layer.id===ea.id))&&"queryFeatures"in na&&(Y=ea.createQuery(),Y.objectIds=[N.attributes[ea.objectIdField]],Y.returnGeometry=!0,ca=(await na.queryFeatures(Y))?.features?.[0]?.geometry)}if(null==ca)return null;switch(ca.type){case "point":na=new e({xmin:ca.x,ymin:ca.y,xmax:ca.x,ymax:ca.y,
spatialReference:ca.spatialReference});break;case "extent":case "multipoint":case "polygon":case "polyline":na=x.getDenormalizedExtent(ca);break;default:na=ca.extent}if(!na)return null;u.isLoaded()||u.canProjectWithoutEngine(na.spatialReference,S)||await u.load();S=u.project(na,S);return S?X=X?X.union(S):S:null}function r(N){if(N&&(!Array.isArray(N)||"number"!==typeof N[0])&&("object"===typeof N||Array.isArray(N)&&"object"===typeof N[0])){if("layer"in N&&null!=N.layer?.minScale&&null!=N.layer.maxScale){var V=
N.layer;return{min:V.minScale,max:V.maxScale}}if(Array.isArray(N)&&N.length&&N.every(S=>"layer"in S)){let S=V=0;for(const X of N)N=X.layer,N?.minScale&&N.maxScale&&(V=N.minScale<V?N.minScale:V,S=N.maxScale>S?N.maxScale:S);return V&&S?{min:V,max:S}:null}}}function y(N,V){return n.equals(N.wkid?N:N.spatialReference||w.WGS84,V)?N:u.project(N,V)}function z(N,V){const S=N.targetGeometry,X=V.targetGeometry;S.x=X.x;S.y=X.y;S.spatialReference=X.spatialReference;N.scale=V.scale;N.rotation=V.rotation;return N}
function D(N,V,S){return S?c.set(N,.5*(V[0]-S.right+S.left),.5*(V[1]-S.bottom+S.top)):c.scale(N,V,.5)}function C(N){var V=N.scale;N=N.targetGeometry;N=null!=N&&n.isValid(N.spatialReference)?1/(39.37*d.getMetersPerUnitForSR(N.spatialReference)*96):1;return V*N}function E(N){return n.isValid(N)?39.37*d.getMetersPerUnitForSR(N)*96:1}function A(N){return(N=n.getInfo(N))?N.valid[1]-N.valid[0]:0}const F=180/Math.PI,G=function(){const N=l.create();return function(V,S,X){const ca=S.targetGeometry;q(N,ca);
S=.5*C(S);V.xmin=N[0]-S*X[0];V.ymin=N[1]-S*X[1];V.xmax=N[0]+S*X[0];V.ymax=N[1]+S*X[1];V.spatialReference=ca.spatialReference;return V}}(),I=function(){const N=l.create();return function(V,S,X){return c.sub(V,c.scale(V,S,.5),D(N,S,X))}}(),H=function(){const N=f.create(),V=l.create();return function(S,X,ca,ba){const ia=C(X);X=k.toRadian(X.rotation)||0;c.set(V,ia,ia);m.fromScaling(N,V);m.rotate(N,N,X);m.translate(N,N,I(V,ca,ba));m.translate(N,N,[0,ba.top-ba.bottom]);return c.set(S,N[4],N[5])}}(),B=function(){const N=
l.create(),V=l.create(),S=l.create();return function(X,ca,ba,ia,ka,na){c.negate(N,ca);c.scale(V,ba,.5*na);c.set(S,1/ia*na,-1/ia*na);m.fromTranslation(X,V);ka&&m.rotate(X,X,ka);m.scale(X,X,S);m.translate(X,X,N);return X}}(),K=function(){const N=l.create();return function(V,S,X,ca){const ba=C(S),ia=k.toRadian(S.rotation)||0;q(N,S.targetGeometry);return B(V,N,X,ba,ia,ca)}}(),L=function(){const N=l.create();return function(V,S,X,ca){const ba=C(S);q(N,S.targetGeometry);return B(V,N,X,ba,0,ca)}}(),J=function(){const N=
l.create(),V=l.create(),S=[0,0,0];return function(X,ca,ba){c.subtract(N,X,ca);c.normalize(N,N);c.subtract(V,X,ba);c.normalize(V,V);c.cross(S,N,V);X=Math.acos(c.dot(N,V)/(c.length(N)*c.length(V)))*F;0>S[2]&&(X=-X);isNaN(X)&&(X=0);return X}}(),M=function(){const N=l.create();return function(V,S,X,ca){const ba=V.targetGeometry;z(V,S);H(N,S,X,ca);ba.x+=N[0];ba.y+=N[1];return V}}(),T=function(){return function(N,V,S){z(N,V);V=N.targetGeometry;V.x=S.x;V.y=S.y;V.spatialReference=S.spatialReference;return N}}(),
Q=function(){const N=l.create();return function(V,S,X,ca,ba){ba||(ba="center");c.sub(N,X,ca);c.scale(N,N,.5);X=N[0];ca=N[1];switch(ba){case "center":c.set(N,0,0);break;case "left":c.set(N,-X,0);break;case "top":c.set(N,0,ca);break;case "right":c.set(N,X,0);break;case "bottom":c.set(N,0,-ca);break;case "top-left":c.set(N,-X,ca);break;case "bottom-left":c.set(N,-X,-ca);break;case "top-right":c.set(N,X,ca);break;case "bottom-right":c.set(N,X,-ca)}W(V,S,N);return V}}(),O=function(){const N=l.create();
return function(V,S,X,ca,ba){z(V,S);isNaN(X)||0===X||(P(N,ca,S,ba),V.scale=S.scale*X,R(N,N,V,ba),W(V,V,c.set(N,N[0]-ca[0],ca[1]-N[1])));return V}}(),U=function(){const N=l.create();return function(V,S,X,ca,ba,ia){z(V,S);isNaN(X)||0===X||(P(N,ba,S,ia),V.scale=S.scale*X,V.rotation+=ca,R(N,N,V,ia),W(V,V,c.set(N,N[0]-ba[0],ba[1]-N[1])));return V}}(),Z=function(){const N=l.create(),V=l.create();return function(S,X,ca,ba,ia,ka,na){I(V,ka,na);c.add(N,ia,V);return ba?U(S,X,ca,ba,N,ka):O(S,X,ca,N,ka)}}(),
P=function(){const N=f.create();return function(V,S,X,ca){var ba=c.transformMat2d;K(N,X,ca,1);X=m.invert(N,N);return ba.call(c,V,S,X)}}(),R=function(){const N=f.create();return function(V,S,X,ca){return c.transformMat2d(V,S,K(N,X,ca,1))}}(),W=function(){const N=l.create(),V=f.create();return function(S,X,ca){z(S,X);const ba=C(X),ia=S.targetGeometry;m.fromRotation(V,k.toRadian(X.rotation)||0);m.scale(V,V,l.fromValues(ba,ba));c.transformMat2d(N,ca,V);ia.x+=N[0];ia.y+=N[1];return S}}();a.addPadding=
M;a.angleBetween=J;a.centerAt=T;a.copy=z;a.create=async function(N,V){if(!N||!V)return new b({targetGeometry:new h,scale:0,rotation:0});let S=V.spatialReference;const {constraints:X,padding:ca,viewpoint:ba,size:ia}=V,ka=[ca?ia[0]-ca.left-ca.right:ia[0],ca?ia[1]-ca.top-ca.bottom:ia[1]];let na=null;N instanceof b?na=N:N.viewpoint?na=N.viewpoint:N.target&&"esri.Viewpoint"===N.target.declaredClass&&(na=N.target);let Y=null;if(na?.targetGeometry)Y=na.targetGeometry;else if(N instanceof e)Y=N;else if(N||
N&&("center"in N||"extent"in N||"target"in N))Y=await v(N.center,V,S)||await v(N.extent,V,S)||await v(N.target,V,S)||await v(N,V,S);!Y&&ba?.targetGeometry?Y=ba.targetGeometry:!Y&&V.extent&&(Y=V.extent);if(!S){var ea=V.spatialReference||V.extent||Y;S=ea.wkid?ea:ea.spatialReference||w.WGS84}u.isLoaded()||n.equals(Y.spatialReference,S)||u.canProjectWithoutEngine(Y.spatialReference,S)||await u.load();ea=y("center"in Y?Y.center:Y,S);!1!==V.pickClosestTarget&&"point"===ea.type&&"point"===ba.targetGeometry?.type&&
(ea.x=x.getClosestDenormalizedXToReference(ea.x,ba.targetGeometry.x,ea.spatialReference));var fa=0;null!=na?.targetGeometry&&"point"===na.targetGeometry.type?fa=na.scale:"scale"in N&&N.scale?fa=N.scale:"zoom"in N&&-1!==N.zoom&&X&&X.effectiveLODs?fa=X.zoomToScale(N.zoom):Array.isArray(Y)||"point"===Y.type||"extent"===Y.type&&0===Y.width&&0===Y.height?(fa=y(V.extent,S),fa=null!=fa?t(fa,ka):V.extent?t(V.extent,ka):ba.scale):fa=t(y(Y.extent,S),ka);if(V=r(N.target??N))V.min&&V.min<fa?fa=V.min:V.max&&V.max>
fa&&(fa=V.max);V=0;na?V=na.rotation:N.hasOwnProperty("rotation")?V=N.rotation:ba&&(V=ba.rotation);N=new b({targetGeometry:ea,scale:fa,rotation:V});X&&(N=X.fit(N),X.constrainByGeometry(N),X.rotationEnabled||(N.rotation=ba.rotation));return N};a.extentToScale=t;a.getAnchor=D;a.getExtent=G;a.getMatrix=B;a.getPaddingMapTranslation=H;a.getPaddingScreenTranslation=I;a.getResolution=C;a.getResolutionToScaleFactor=E;a.getTransform=K;a.getTransformNoRotation=L;a.getWorldScreenWidth=function(N,V){return Math.round(A(N)/
V)};a.getWorldWidth=A;a.padAndScaleAndRotateBy=Z;a.resize=Q;a.rotateBy=function(N,V,S){z(N,V);N.rotation+=S;return N};a.rotateTo=function(N,V,S){z(N,V);N.rotation=S;return N};a.scaleAndRotateBy=U;a.scaleTo=function(N,V,S){z(N,V);N.scale=S;return N};a.setExtent=function(N,V,S,X,ca){T(N,V,S.center);N.scale=t(S,X);ca?.constraints?.constrain(N);return N};a.toMap=P;a.toScreen=R;a.translateBy=W;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports",
"../../../../../symbols/cim/enums"],function(a,b){a.StyleLayerType=void 0;(function(d){d[d.BACKGROUND=0]="BACKGROUND";d[d.FILL=1]="FILL";d[d.LINE=2]="LINE";d[d.SYMBOL=3]="SYMBOL";d[d.CIRCLE=4]="CIRCLE"})(a.StyleLayerType||(a.StyleLayerType={}));a.Visibility=void 0;(function(d){d[d.VISIBLE=0]="VISIBLE";d[d.NONE=1]="NONE"})(a.Visibility||(a.Visibility={}));a.SymbolPlacement=void 0;(function(d){d[d.POINT=0]="POINT";d[d.LINE=1]="LINE";d[d.LINE_CENTER=2]="LINE_CENTER"})(a.SymbolPlacement||(a.SymbolPlacement=
{}));a.RotationAlignment=void 0;(function(d){d[d.MAP=0]="MAP";d[d.VIEWPORT=1]="VIEWPORT";d[d.AUTO=2]="AUTO"})(a.RotationAlignment||(a.RotationAlignment={}));a.TextJustification=void 0;(function(d){d[d.AUTO=0]="AUTO";d[d.LEFT=1]="LEFT";d[d.CENTER=2]="CENTER";d[d.RIGHT=3]="RIGHT"})(a.TextJustification||(a.TextJustification={}));a.SymbolAnchor=void 0;(function(d){d[d.CENTER=0]="CENTER";d[d.LEFT=1]="LEFT";d[d.RIGHT=2]="RIGHT";d[d.TOP=3]="TOP";d[d.BOTTOM=4]="BOTTOM";d[d.TOP_LEFT=5]="TOP_LEFT";d[d.TOP_RIGHT=
6]="TOP_RIGHT";d[d.BOTTOM_LEFT=7]="BOTTOM_LEFT";d[d.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(a.SymbolAnchor||(a.SymbolAnchor={}));a.TextTransform=void 0;(function(d){d[d.NONE=0]="NONE";d[d.UPPERCASE=1]="UPPERCASE";d[d.LOWERCASE=2]="LOWERCASE"})(a.TextTransform||(a.TextTransform={}));a.TranslateAnchor=void 0;(function(d){d[d.MAP=0]="MAP";d[d.VIEWPORT=1]="VIEWPORT"})(a.TranslateAnchor||(a.TranslateAnchor={}));a.TextWritingMode=void 0;(function(d){d[d.HORIZONTAL=0]="HORIZONTAL";d[d.VERTICAL=1]="VERTICAL"})(a.TextWritingMode||
(a.TextWritingMode={}));class g{}g.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};g.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};g.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:b.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:b.JoinType.MITER},
"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};g.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:a.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},
"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",
values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",
values:["auto","left","center","right"],default:a.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",
default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:a.TextTransform.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[a.TextWritingMode.HORIZONTAL]}};g.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};g.backgroundPaintDefinition=
{"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};g.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",
values:["map","viewport"],default:a.TranslateAnchor.MAP}};g.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",
values:["map","viewport"],default:a.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};g.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",
values:["map","viewport"],default:a.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};g.rasterPaintDefinition=
{"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};g.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,
default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};
a.StyleDefinition=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/enums":function(){define(["exports"],function(a){a.CapType=void 0;(function(b){b[b.BUTT=0]="BUTT";b[b.ROUND=1]="ROUND";b[b.SQUARE=2]="SQUARE";b[b.UNKNOWN=4]="UNKNOWN"})(a.CapType||(a.CapType={}));a.JoinType=void 0;(function(b){b[b.BEVEL=0]="BEVEL";b[b.ROUND=1]="ROUND";b[b.MITER=2]="MITER";b[b.UNKNOWN=4]="UNKNOWN"})(a.JoinType||(a.JoinType={}));a.Alignment=void 0;(function(b){b[b.SCREEN=0]="SCREEN";
b[b.MAP=1]="MAP"})(a.Alignment||(a.Alignment={}));a.ExternalColorMixMode=void 0;(function(b){b[b.Tint=0]="Tint";b[b.Ignore=1]="Ignore";b[b.Multiply=99]="Multiply"})(a.ExternalColorMixMode||(a.ExternalColorMixMode={}));a.ExtremityPlacement=void 0;(function(b){b.Both="Both";b.JustBegin="JustBegin";b.JustEnd="JustEnd";b.None="None"})(a.ExtremityPlacement||(a.ExtremityPlacement={}));a.FillMode=void 0;(function(b){b[b.Mosaic=0]="Mosaic";b[b.Centered=1]="Centered"})(a.FillMode||(a.FillMode={}));a.FontEffects=
void 0;(function(b){b[b.Normal=0]="Normal";b[b.Superscript=1]="Superscript";b[b.Subscript=2]="Subscript"})(a.FontEffects||(a.FontEffects={}));a.FontEncoding=void 0;(function(b){b[b.MSSymbol=0]="MSSymbol";b[b.Unicode=1]="Unicode"})(a.FontEncoding||(a.FontEncoding={}));a.FontType=void 0;(function(b){b[b.Unspecified=0]="Unspecified";b[b.TrueType=1]="TrueType";b[b.PSOpenType=2]="PSOpenType";b[b.TTOpenType=3]="TTOpenType";b[b.Type1=4]="Type1"})(a.FontType||(a.FontType={}));a.AngleAlignment=void 0;(function(b){b[b.Display=
0]="Display";b[b.Map=1]="Map"})(a.AngleAlignment||(a.AngleAlignment={}));a.AnimatedSymbolRepeatType=void 0;(function(b){b.None="None";b.Loop="Loop";b.Oscillate="Oscillate"})(a.AnimatedSymbolRepeatType||(a.AnimatedSymbolRepeatType={}));a.DominantSizeAxis=void 0;(function(b){b[b.Z=0]="Z";b[b.X=1]="X";b[b.Y=2]="Y"})(a.DominantSizeAxis||(a.DominantSizeAxis={}));a.RotationOrder=void 0;(function(b){b[b.XYZ=0]="XYZ";b[b.ZXY=1]="ZXY";b[b.YXZ=2]="YXZ"})(a.RotationOrder||(a.RotationOrder={}));a.BalloonCalloutStyle=
void 0;(function(b){b[b.Rectangle=0]="Rectangle";b[b.RoundedRectangle=1]="RoundedRectangle";b[b.Oval=2]="Oval"})(a.BalloonCalloutStyle||(a.BalloonCalloutStyle={}));a.BlendingMode=void 0;(function(b){b[b.None=0]="None";b[b.Alpha=1]="Alpha";b[b.Screen=2]="Screen";b[b.Multiply=3]="Multiply";b[b.Add=4]="Add"})(a.BlendingMode||(a.BlendingMode={}));a.BlockProgression=void 0;(function(b){b[b.TTB=0]="TTB";b[b.RTL=1]="RTL";b[b.BTT=2]="BTT"})(a.BlockProgression||(a.BlockProgression={}));a.BillBoardMode=void 0;
(function(b){b[b.None=0]="None";b[b.SignPost=1]="SignPost";b[b.FaceNearPlane=2]="FaceNearPlane"})(a.BillBoardMode||(a.BillBoardMode={}));a.CGAAttributeType=void 0;(function(b){b[b.Float=0]="Float";b[b.String=1]="String";b[b.Boolean=2]="Boolean"})(a.CGAAttributeType||(a.CGAAttributeType={}));a.ClippingType=void 0;(function(b){b[b.Intersect=0]="Intersect";b[b.Subtract=1]="Subtract"})(a.ClippingType||(a.ClippingType={}));a.GeometricEffectArrowType=void 0;(function(b){b.OpenEnded="OpenEnded";b.Block=
"Block";b.Crossed="Crossed"})(a.GeometricEffectArrowType||(a.GeometricEffectArrowType={}));a.GeometricEffectControlMeasureLineRule=void 0;(function(b){b.FullGeometry="FullGeometry";b.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment";b.ReversedFirstSegment="ReversedFirstSegment";b.PerpendicularToSecondSegment="PerpendicularToSecondSegment";b.SecondSegmentWithTicks="SecondSegmentWithTicks";b.DoublePerpendicular="DoublePerpendicular";b.OppositeToFirstSegment="OppositeToFirstSegment";b.TriplePerpendicular=
"TriplePerpendicular";b.HalfCircleFirstSegment="HalfCircleFirstSegment";b.HalfCircleSecondSegment="HalfCircleSecondSegment";b.HalfCircleExtended="HalfCircleExtended";b.OpenCircle="OpenCircle";b.CoverageEdgesWithTicks="CoverageEdgesWithTicks";b.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks";b.GapExtentMidline="GapExtentMidline";b.Chevron="Chevron";b.PerpendicularWithArc="PerpendicularWithArc";b.ClosedHalfCircle="ClosedHalfCircle";b.TripleParallelExtended="TripleParallelExtended";b.ParallelWithTicks=
"ParallelWithTicks";b.Parallel="Parallel";b.PerpendicularToFirstSegment="PerpendicularToFirstSegment";b.ParallelOffset="ParallelOffset";b.OffsetOpposite="OffsetOpposite";b.OffsetSame="OffsetSame";b.CircleWithArc="CircleWithArc";b.DoubleJog="DoubleJog";b.PerpendicularOffset="PerpendicularOffset";b.LineExcludingLastSegment="LineExcludingLastSegment";b.MultivertexArrow="MultivertexArrow";b.CrossedArrow="CrossedArrow";b.ChevronArrow="ChevronArrow";b.ChevronArrowOffset="ChevronArrowOffset";b.PartialFirstSegment=
"PartialFirstSegment";b.Arch="Arch";b.CurvedParallelTicks="CurvedParallelTicks";b.Arc90Degrees="Arc90Degrees"})(a.GeometricEffectControlMeasureLineRule||(a.GeometricEffectControlMeasureLineRule={}));a.GeometricEffectDonutMethod=void 0;(function(b){b.Mitered="Mitered";b.Bevelled="Bevelled";b.Rounded="Rounded";b.Square="Square";b.TrueBuffer="TrueBuffer"})(a.GeometricEffectDonutMethod||(a.GeometricEffectDonutMethod={}));a.GeometricEffectEnclosingPolygonMethod=void 0;(function(b){b.ClosePath="ClosePath";
b.ConvexHull="ConvexHull";b.RectangularBox="RectangularBox"})(a.GeometricEffectEnclosingPolygonMethod||(a.GeometricEffectEnclosingPolygonMethod={}));a.GeometricEffectExtensionOrigin=void 0;(function(b){b.BeginningOfLine="BeginningOfLine";b.EndOfLine="EndOfLine"})(a.GeometricEffectExtensionOrigin||(a.GeometricEffectExtensionOrigin={}));a.GeometricEffectOffsetMethod=void 0;(function(b){b.Mitered="Mitered";b.Bevelled="Bevelled";b.Rounded="Rounded";b.Square="Square"})(a.GeometricEffectOffsetMethod||(a.GeometricEffectOffsetMethod=
{}));a.GeometricEffectOffsetOption=void 0;(function(b){b.Fast="Fast";b.Accurate="Accurate"})(a.GeometricEffectOffsetOption||(a.GeometricEffectOffsetOption={}));a.GeometricEffectOffsetTangentMethod=void 0;(function(b){b.BeginningOfLine="BeginningOfLine";b.EndOfLine="EndOfLine"})(a.GeometricEffectOffsetTangentMethod||(a.GeometricEffectOffsetTangentMethod={}));a.GeometricEffectWaveform=void 0;(function(b){b.Sinus="Sinus";b.Square="Square";b.Triangle="Triangle";b.Random="Random"})(a.GeometricEffectWaveform||
(a.GeometricEffectWaveform={}));a.GlyphHinting=void 0;(function(b){b[b.None=0]="None";b[b.Default=1]="Default";b[b.Force=2]="Force"})(a.GlyphHinting||(a.GlyphHinting={}));a.GradientAlignment=void 0;(function(b){b[b.Buffered=0]="Buffered";b[b.Left=1]="Left";b[b.Right=2]="Right";b[b.AlongLine=3]="AlongLine"})(a.GradientAlignment||(a.GradientAlignment={}));a.GradientFillMethod=void 0;(function(b){b[b.Linear=0]="Linear";b[b.Rectangular=1]="Rectangular";b[b.Circular=2]="Circular";b[b.Buffered=3]="Buffered"})(a.GradientFillMethod||
(a.GradientFillMethod={}));a.GradientStrokeType=void 0;(function(b){b[b.Discrete=0]="Discrete";b[b.Continuous=1]="Continuous"})(a.GradientStrokeType||(a.GradientStrokeType={}));a.GradientStrokeMethod=void 0;(function(b){b[b.AcrossLine=0]="AcrossLine";b[b.AloneLine=1]="AloneLine"})(a.GradientStrokeMethod||(a.GradientStrokeMethod={}));a.HorizontalAlignment=void 0;(function(b){b[b.Left=0]="Left";b[b.Right=1]="Right";b[b.Center=2]="Center";b[b.Justify=3]="Justify"})(a.HorizontalAlignment||(a.HorizontalAlignment=
{}));a.LeaderLineStyle=void 0;(function(b){b[b.Base=0]="Base";b[b.MidPoint=1]="MidPoint";b[b.ThreePoint=2]="ThreePoint";b[b.FourPoint=3]="FourPoint";b[b.Underline=4]="Underline";b[b.CircularCW=5]="CircularCW";b[b.CircularCCW=6]="CircularCCW"})(a.LeaderLineStyle||(a.LeaderLineStyle={}));a.LineCapStyle=void 0;(function(b){b.Butt="Butt";b.Round="Round";b.Square="Square"})(a.LineCapStyle||(a.LineCapStyle={}));a.LineDashEnding=void 0;(function(b){b.NoConstraint="NoConstraint";b.HalfPattern="HalfPattern";
b.HalfGap="HalfGap";b.FullPattern="FullPattern";b.FullGap="FullGap";b.Custom="Custom"})(a.LineDashEnding||(a.LineDashEnding={}));a.LineDecorationStyle=void 0;(function(b){b[b.None=-1]="None";b[b.Custom=0]="Custom";b[b.Circle=1]="Circle";b[b.OpenArrow=2]="OpenArrow";b[b.ClosedArrow=3]="ClosedArrow";b[b.Diamond=4]="Diamond"})(a.LineDecorationStyle||(a.LineDecorationStyle={}));a.LineGapType=void 0;(function(b){b[b.ExtraLeading=0]="ExtraLeading";b[b.Multiple=1]="Multiple";b[b.Exact=2]="Exact"})(a.LineGapType||
(a.LineGapType={}));a.LineJoinStyle=void 0;(function(b){b.Bevel="Bevel";b.Round="Round";b.Miter="Miter"})(a.LineJoinStyle||(a.LineJoinStyle={}));a.ExpressionReturnType=void 0;(function(b){b[b.Default=0]="Default";b[b.String=1]="String";b[b.Numeric=2]="Numeric"})(a.ExpressionReturnType||(a.ExpressionReturnType={}));a.MarkerPlacementType=void 0;(function(b){b[b.InsidePolygon=0]="InsidePolygon";b[b.PolygonCenter=1]="PolygonCenter";b[b.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"})(a.MarkerPlacementType||
(a.MarkerPlacementType={}));a.MaterialMode=void 0;(function(b){b[b.Tint=0]="Tint";b[b.Replace=1]="Replace";b[b.Multiply=2]="Multiply"})(a.MaterialMode||(a.MaterialMode={}));a.PlacementClip=void 0;(function(b){b[b.ClipAtBoundary=0]="ClipAtBoundary";b[b.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary";b[b.DoNotTouchBoundary=2]="DoNotTouchBoundary";b[b.DoNotClip=3]="DoNotClip"})(a.PlacementClip||(a.PlacementClip={}));a.PlacementEndings=void 0;(function(b){b.NoConstraint="NoConstraint";
b.WithMarkers="WithMarkers";b.WithFullGap="WithFullGap";b.WithHalfGap="WithHalfGap";b.Custom="Custom"})(a.PlacementEndings||(a.PlacementEndings={}));a.PlacementGridType=void 0;(function(b){b.Fixed="Fixed";b.Random="Random";b.RandomFixedQuantity="RandomFixedQuantity"})(a.PlacementGridType||(a.PlacementGridType={}));a.PlacementOnLineRelativeTo=void 0;(function(b){b.LineMiddle="LineMiddle";b.LineBeginning="LineBeginning";b.LineEnd="LineEnd";b.SegmentMidpoint="SegmentMidpoint"})(a.PlacementOnLineRelativeTo||
(a.PlacementOnLineRelativeTo={}));a.PlacementPolygonCenterMethod=void 0;(function(b){b.OnPolygon="OnPolygon";b.CenterOfMass="CenterOfMass";b.BoundingBoxCenter="BoundingBoxCenter"})(a.PlacementPolygonCenterMethod||(a.PlacementPolygonCenterMethod={}));a.PlacementRandomlyAlongLineRandomization=void 0;(function(b){b[b.Low=0]="Low";b[b.Medium=1]="Medium";b[b.High=2]="High"})(a.PlacementRandomlyAlongLineRandomization||(a.PlacementRandomlyAlongLineRandomization={}));a.PlacementStepPosition=void 0;(function(b){b[b.MarkerCenter=
0]="MarkerCenter";b[b.MarkerBounds=1]="MarkerBounds"})(a.PlacementStepPosition||(a.PlacementStepPosition={}));a.PointSymbolCalloutScale=void 0;(function(b){b[b.None=0]="None";b[b.PropUniform=1]="PropUniform";b[b.PropNonuniform=2]="PropNonuniform";b[b.DifUniform=3]="DifUniform";b[b.DifNonuniform=4]="DifNonuniform"})(a.PointSymbolCalloutScale||(a.PointSymbolCalloutScale={}));a.Simple3DLineStyle=void 0;(function(b){b.Tube="Tube";b.Strip="Strip";b.Wall="Wall"})(a.Simple3DLineStyle||(a.Simple3DLineStyle=
{}));a.SizeVariationMethod=void 0;(function(b){b[b.Random=0]="Random";b[b.Increasing=1]="Increasing";b[b.Decreasing=2]="Decreasing";b[b.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"})(a.SizeVariationMethod||(a.SizeVariationMethod={}));a.SymbolUnits=void 0;(function(b){b[b.Relative=0]="Relative";b[b.Absolute=1]="Absolute"})(a.SymbolUnits||(a.SymbolUnits={}));a.TextCase=void 0;(function(b){b[b.Normal=0]="Normal";b[b.LowerCase=1]="LowerCase";b[b.Allcaps=2]="Allcaps"})(a.TextCase||(a.TextCase=
{}));a.TextReadingDirection=void 0;(function(b){b[b.LTR=0]="LTR";b[b.RTL=1]="RTL"})(a.TextReadingDirection||(a.TextReadingDirection={}));a.TextureFilter=void 0;(function(b){b.Draft="Draft";b.Picture="Picture";b.Text="Text"})(a.TextureFilter||(a.TextureFilter={}));a.VerticalAlignment=void 0;(function(b){b[b.Top=0]="Top";b[b.Center=1]="Center";b[b.Baseline=2]="Baseline";b[b.Bottom=3]="Bottom"})(a.VerticalAlignment||(a.VerticalAlignment={}));a.VerticalGlyphOrientation=void 0;(function(b){b[b.Right=0]=
"Right";b[b.Upright=1]="Upright"})(a.VerticalGlyphOrientation||(a.VerticalGlyphOrientation={}));a.WaterbodySize=void 0;(function(b){b[b.Small=0]="Small";b[b.Medium=1]="Medium";b[b.Large=2]="Large"})(a.WaterbodySize||(a.WaterbodySize={}));a.WaveStrength=void 0;(function(b){b[b.Calm=0]="Calm";b[b.Rippled=1]="Rippled";b[b.Slight=2]="Slight";b[b.Moderate=3]="Moderate"})(a.WaveStrength||(a.WaveStrength={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports",
"../../../../chunks/mat3f32","./TiledDisplayObject"],function(a,b,g){class d extends g.TiledDisplayObject{_createTransforms(){return{dvs:b.create(),tileMat3:b.create()}}}a.RenderableTile=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./TileBlendTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){class w extends c.ShaderTechnique{initializeProgram(n){return new p.Program(n.rctx,w.shader.get().build(this.configuration),e.Default3D)}initializePipeline(){return u.makePipelineState({blending:u.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:u.defaultColorWriteParams})}}w.shader=new f.ReloadableShaderModule(m.RasterColorizer,()=>new Promise((n,q)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],n,q)));
class x extends k.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.colorizerType=d.RasterColorizerType.Stretch;this.stretchType=d.RasterColorizerStretchType.Noop;this.applyColormap=!0;this.requireBilinearWithNN=!1}}g.__decorate([l.parameter({count:d.RasterColorizerType.COUNT})],x.prototype,"colorizerType",void 0);g.__decorate([l.parameter({count:d.RasterColorizerStretchType.COUNT})],x.prototype,"stretchType",void 0);g.__decorate([l.parameter()],x.prototype,"applyColormap",void 0);
g.__decorate([l.parameter()],x.prototype,"requireBilinearWithNN",void 0);b.RasterColorizerTechnique=w;b.RasterColorizerTechniqueConfiguration=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define(["exports","../../../webgl/enums","../../../webgl/FramebufferObject","../../../webgl/RenderbufferDescriptor","../../../webgl/TextureDescriptor"],function(a,b,g,d,k){class m{constructor(f){this._rctx=f;this._fbos=new Map}get(f){return this._getPool(f)}dispose(){this._fbos.forEach(f=>
f.dispose());this._fbos.clear()}_getPool(f){var c=this._fbos.get(f);if(c)return c;c=new g.FramebufferObject(this._rctx,new k.TextureDescriptor(f),new d.RenderbufferDescriptor(b.RenderbufferFormat.DEPTH24_STENCIL8,f));this._fbos.set(f,c);return c}}a.MultiSizeFramebuffer=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderInfo":function(){define(["exports","../../../core/PooledArray"],function(a,b){class g{constructor(){this.sourceLod=[0,0,0];this.offset=
[0,0];this.scale=1;this.layerIndex=0;this.isVTLBackground=!1;this.vtlNeighborInfos=new b({allocator:k=>k||new d})}}class d{constructor(){this.sourceLayerInfo=null;this.sourceLod=[0,0,0];this.offset=[-1,0]}}a.TileRenderInfo=g;a.VTLNeighhborInfo=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../core/mathUtils","../../../../../chunks/vec3f64","../../../../../geometry/support/aaBoundingBox",
"../../materials/internal/MaterialUtil"],function(a,b,g,d,k){function m(q,t,v){let r=0,y=Infinity;for(let D=0;3>D;++D){var z=q[D];if(t[D]<z){if(1E-6>=v[D])return!1;r=Math.max(r,(z-t[D])/v[D])}else-1E-6>=v[D]&&(y=Math.min(y,(z-t[D])/v[D]));if(r>y)return!1;z=q[D+3];if(t[D]>z){if(-1E-6<=v[D])return!1;r=Math.max(r,(z-t[D])/v[D])}else 1E-6<=v[D]&&(y=Math.min(y,(z-t[D])/v[D]));if(r>y)return!1}return!0}function f(q,t,v,r,y,z){let D=r;for(;v<D;){var C=q[v];t[6*C+y+3]<=z?++v:(--D,q[v]=q[D],q[D]=C)}C=v;for(D=
r;C<D;)r=q[D-1],t[6*r+y]>=z?--D:(q[D-1]=q[C],q[C]=r,++C);return{next:v,mid:C}}function c(q,t,v,r){if(r<=v)return d.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var y=6*q[v];for(var z=0;3>z;++z)x[z]=t[y+0+z],n[z]=t[y+3+z];for(v+=1;v<r;++v)for(y=6*q[v],z=0;3>z;++z)x[z]=Math.min(x[z],t[y+0+z]),n[z]=Math.max(n[z],t[y+3+z]);return d.fromValues(x[0],x[1],x[2],n[0],n[1],n[2])}function l(q){var t=q[3]-q[0];const v=q[4]-q[1],r=q[5]-q[2];t=t>v?t>r?0:v>r?1:2:v>r?1:r>t?2:0;return{axis:t,midValue:(q[t]+q[t+3])/2}}function e(q,
t,v,r,y){v-=t;const z=new Float32Array(6*v);for(let C=0;C<v;++C){var D=3*(C+t);const E=q[D]*y,A=q[D+1]*y;D=q[D+2]*y;for(let F=0;3>F;++F){const G=r[E+F],I=r[A+F],H=r[D+F];z[6*C+F]=Math.min(G,I,H);z[6*C+3+F]=Math.max(G,I,H)}}return z}function p(q,t,v,r){const y=r-v;var z=0;for(var D=v;D<r;++D)for(var C=0;3>C;++C)z=Math.max(t[3*D+C],z);r=65535>=z?new Uint16Array(3*y):new Uint32Array(3*y);for(z=0;z<y;++z)for(D=3*(q[z]+v),C=0;3>C;++C)r[3*z+C]=t[D+C];return r}class h{constructor(q,t,v,r,y){this.aabb=q;
this.axis=t;this.d=v;this.midStartIndex=r;this.rightStartIndex=y}}class u{constructor(q,t,v,r){this.globalTriangleVertexIndices=q;this.firstTriangleIndex=t;this.positions=r;this._rayDirection=g.create();this.bspNodeTree=[];const y=v-t,z=65535>=y?new Uint16Array(y):new Uint32Array(y);this.indices=z;for(let A=0;A<y;++A)z[A]=A;const D=e(q,t,v,r.data,r.stride),C=b.clamp(Math.log2(y/40),2,10),E=(A,F,G)=>{var I=c(z,D,A,F);const H=F-A;if(40>=H)return A=new h(I,void 0,0,A,F),this.bspNodeTree.push(A),A;const {axis:B,
midValue:K}=l(I),L=f(z,D,A,F,B,K),J=(M,T)=>{if(!(G>C)){var Q=T-M;if(!(40>Q||Q>=.8*H))return E(M,T,G+1)}};I=new h(I,B,K,L.next,L.mid);this.bspNodeTree.push(I);I.leftNode=J(A,L.next);I.rightNode=J(L.mid,F);return I};E(0,y,0);this.triangleVertexIndices=p(z,q,t,v)}intersectRayTriangleRange(q,t){if(!(q>=t)){var v=this.triangleVertexIndices,r=this.positions.data,y=this.positions.stride,z=this._rayOrigin,D=z[0],C=z[1];z=z[2];var E=this._rayDirection,A=E[0],F=E[1];E=E[2];for(let Z=q,P=3*q;Z<t;++Z){var G=
v[P++]*y,I=r[G++],H=r[G++],B=r[G];G=v[P++]*y;var K=r[G++],L=r[G++],J=r[G];G=v[P++]*y;var M=r[G++],T=r[G++];K-=I;L-=H;J-=B;M-=I;T-=H;G=r[G]-B;var Q=F*G-T*E,O=E*M-G*A;const R=A*T-M*F;var U=K*Q+L*O+J*R;if(!(Math.abs(U)<=Number.EPSILON)){I=D-I;H=C-H;B=z-B;Q=I*Q+H*O+B*R;if(0<U){if(0>Q||Q>U)continue}else if(0<Q||Q<U)continue;O=H*J-L*B;B=B*K-J*I;H=I*L-K*H;I=A*O+F*B+E*H;if(0<U){if(0>I||Q+I>U)continue}else if(0<I||Q+I<U)continue;B=(M*O+T*B+G*H)/U;0<=B&&(U=this.indices[Z]+this.firstTriangleIndex,K=k.computeNormal(K,
L,J,M,T,G,w),this._callback(B,K,U,!1))}}u.numFacesTested+=t-q}}intersectRay(q,t){u.numFacesTested=0;var v=g.fromValues(q.r0[0],q.r0[1],q.r0[2]),r=g.fromValues(q.r1[0],q.r1[1],q.r1[2]);q=r[0]-v[0];const y=r[1]-v[1];r=r[2]-v[2];1E-6>q*q+y*y+r*r||(this._rayOrigin=v,v=this._rayDirection,v[0]=q,v[1]=y,v[2]=r,v=this.triangleVertexIndices.length/3,this._callback=t,this.intersectRayBSP(this.bspNodeTree[0],0,v))}intersectRayBSP(q,t,v){const r=this._rayOrigin,y=this._rayDirection;if(m(q.aabb,r,y)){var z=q.axis,
D=q.d;if(r[z]<D||0>y[z]){const C=q.midStartIndex;if(t<C){const E=q.leftNode;void 0!==E?this.intersectRayBSP(E,t,C):this.intersectRayTriangleRange(t,C)}}this.intersectRayTriangleRange(q.midStartIndex,q.rightStartIndex);if(r[z]>D||0<y[z])t=q.rightStartIndex,t<v&&(q=q.rightNode,void 0!==q?this.intersectRayBSP(q,t,v):this.intersectRayTriangleRange(t,v))}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}u.numFacesTested=0;const w=g.create(),x=[Infinity,Infinity,
Infinity],n=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=u;a.componentMinimalSizeForIntersectionData=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends e.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=g.ShaderOutput.Color;this.overlayMode=f.OverlayMode.Disabled;this.tileBlendInput=c.TileBlendInput.LayerOnly;this.receiveAmbientOcclusion=this.screenSizePerspective=this.visualizeNormals=this.tileBorders=this.invisible=this.hasCloudsReflections=this.hasScreenSpaceReflections=this.renderOccluded=this.textureFadingEnabled=this.backfaceCullingEnabled=this.hasSlicePlane=this.receiveShadows=
this.doublePrecisionRequiresObfuscation=this.spherical=!1;this.pbrMode=m.PBRMode.Terrain}}b.__decorate([l.parameter({count:g.ShaderOutput.COUNT})],p.prototype,"output",void 0);b.__decorate([l.parameter({count:f.OverlayMode.COUNT})],p.prototype,"overlayMode",void 0);b.__decorate([l.parameter({count:c.TileBlendInput.COUNT})],p.prototype,"tileBlendInput",void 0);b.__decorate([l.parameter()],p.prototype,"spherical",void 0);b.__decorate([l.parameter()],p.prototype,"doublePrecisionRequiresObfuscation",
void 0);b.__decorate([l.parameter()],p.prototype,"receiveShadows",void 0);b.__decorate([l.parameter()],p.prototype,"hasSlicePlane",void 0);b.__decorate([l.parameter()],p.prototype,"backfaceCullingEnabled",void 0);b.__decorate([l.parameter()],p.prototype,"textureFadingEnabled",void 0);b.__decorate([l.parameter()],p.prototype,"renderOccluded",void 0);b.__decorate([l.parameter()],p.prototype,"hasScreenSpaceReflections",void 0);b.__decorate([l.parameter()],p.prototype,"hasCloudsReflections",void 0);b.__decorate([l.parameter()],
p.prototype,"invisible",void 0);b.__decorate([l.parameter()],p.prototype,"tileBorders",void 0);b.__decorate([l.parameter()],p.prototype,"visualizeNormals",void 0);b.__decorate([l.parameter()],p.prototype,"screenSizePerspective",void 0);b.__decorate([l.parameter()],p.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([l.parameter({count:m.PBRMode.COUNT})],p.prototype,"pbrMode",void 0);b.__decorate([l.parameter({constValue:d.NormalType.Compressed})],p.prototype,"normalType",void 0);b.__decorate([l.parameter({constValue:k.TextureCoordinateAttributeType.Compressed})],
p.prototype,"textureCoordinateType",void 0);b.__decorate([l.parameter({constValue:!1})],p.prototype,"highStepCount",void 0);b.__decorate([l.parameter({constValue:!1})],p.prototype,"useCustomDTRExponentForWater",void 0);b.__decorate([l.parameter({constValue:!1})],p.prototype,"useFillLights",void 0);b.__decorate([l.parameter({constValue:!0})],p.prototype,"hasColorTexture",void 0);a.TerrainTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){class a{constructor(){this.numMerged=
this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}}return a})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n){a.TilingSchemeLogic=class extends g{constructor(q){super(q)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),d.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]);this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null;this.layers.destroy()}_update(){this._waitTask=null;if(!this.tilingSchemeLocked){var q;this.layers.some(v=>!u.isTiledLayer(v)||v.isRejected()?!1:
v.isFulfilled()&&null==x.getTiledLayerInfo(v,this.viewSpatialReference,this.viewingMode)?!1:(q=v,"vector-tile"!==v?.type&&!x.isProjectableRasterLayer(v)));if(q)if(q.isResolved()){var t=x.getTiledLayerInfo(q,this.viewSpatialReference,this.viewingMode);null!=t&&(t=new n.TilingScheme(t.tileInfo),this._lockTilingScheme(t))}else this._updateWhen(q)}}_updateWhen(q){const t=q.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(q){if(this.viewingMode===
w.ViewingMode.Global){const t=q.levels.length-1;q.spatialReference.isWebMercator?q=n.TilingScheme.makeWebMercatorAuxiliarySphere(t):e.canProjectToWGS84ComparableLonLat(q.spatialReference)&&(q=n.TilingScheme.makeGCSWithTileSize(q.spatialReference,q.pixelSize,t))}this.tilingSchemeLocked=!0;this.tilingScheme=q;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this.removeAllHandles();this.addHandles(d.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",
this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===w.ViewingMode.Global){var q=this.extentHelper.viewSpatialReference;const t=e.canProjectToWGS84ComparableLonLat(q)||h.isMars(q)||h.isMoon(q);q.isWebMercator?this.tilingScheme=n.TilingScheme.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=n.TilingScheme.makeGCSWithTileSize(q,256));this._set("extent",this.extentHelper.layerViewsExtent)}else q=this.extentHelper.layerViewsExtent,null==q||p.equals(q,this.extent)||(this.tilingScheme=
n.TilingScheme.fromExtent(q,this.extentHelper.viewSpatialReference),this._set("extent",q))}get test(){return{lockTilingScheme:q=>this._lockTilingScheme(q),done:!this._waitTask}}};b.__decorate([k.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);b.__decorate([k.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);b.__decorate([k.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,
"viewSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"extentHelper",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=b.__decorate([l.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports",
"../../../chunks/vec2f64"],function(a,b){class g{constructor(){this.offset=b.create();this.scale=0;this.tile=null}init(d,k,m,f){this.tile=d;this.offset[0]=k;this.offset[1]=m;this.scale=f}dispose(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0}}a.UpsampleInfo=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/ChangeSet ./lib/UpdatePolicy ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){a.Stage=class extends g{constructor(t){super(t);this._model=new x.Model;this._layers=new d;this._asyncChangeSet=new h.ChangeSet;this._syncChangeSet=new h.ChangeSet;this._layerSyncSet=new Set}initialize(){this._set("renderView",new n.RenderView(this));this._frameTask=this.view.resourceController.scheduler.registerTask(q.TaskPriority.STAGE,this);this.addHandles(this._frameTask)}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||
this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(t){this._model.add(t);w.isWebGLLayer(t)&&this._addLayer(t);this.renderView.requestRender()}remove(t){null!=t&&!this.destroyed&&this._model.remove(t)&&(w.isWebGLLayer(t)&&this._removeLayer(t),this.renderView.requestRender())}addMany(t){null!=t&&(this._model.addMany(t),this.renderView.requestRender())}removeMany(t){null!=t&&(this._model?.removeMany(t),this.renderView?.requestRender())}forEachOfType(t,
v){this._model.forEachOfType(t,v)}handleEvent(t,v){this.destroyed||(this._model.dirtySet[t](v),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(t){this._frameTask.processQueue(t);this._commit(t)}_commit(t){const v=this._model.dirtySet;this._asyncChangeSet.empty||t.done||(this.renderer.modify(this._asyncChangeSet,t),this.renderView.requestRender(),t.madeProgress());this._layers.forAll(r=>{if(!t.done){var y=this._layerSyncSet.has(r.id)||
r.updatePolicy===u.UpdatePolicy.SYNC,z=y?this._syncChangeSet:this._asyncChangeSet;v.commitLayer(r.id,z);this._layerSyncSet.delete(r.id);z.empty||(this.renderer.modify(z,y?q.noBudget:t),this.renderView.requestRender(),t.madeProgress())}});this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,q.noBudget),this.renderView.requestRender(),t.madeProgress());this._layers.forAll(r=>{t.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==u.UpdatePolicy.ASYNC||(v.commitLayer(r.id,this._asyncChangeSet),
this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,t),this.renderView.requestRender(),t.madeProgress()))});this._layerSyncSet.clear();this.notifyChange("running")}commitSyncLayers(){const t=this._model.dirtySet;this._layers.forAll(v=>{this._layerSyncSet.has(v.id)||v.updatePolicy===u.UpdatePolicy.SYNC?(t.commitLayer(v.id,this._syncChangeSet),this._layerSyncSet.delete(v.id)):t.commitSyncUpdates(v.id,this._syncChangeSet)});for(const v of this._layerSyncSet)t.commitLayer(v,this._syncChangeSet);
this._layerSyncSet.clear();this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,q.noBudget),this.renderView.requestRender())}_commitLayer(t){this._model.dirtySet.commitLayer(t.id,this._syncChangeSet);this._layerSyncSet.delete(t.id);this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,q.noBudget),this.renderView.requestRender())}schedule(t,v){return this._frameTask.schedule(t,v)}reschedule(t,v){return this._frameTask.reschedule(t,v)}syncLayer(t){this._layerSyncSet.add(t);
this.renderView.requestRender()}getObject(t){return this._model.getObject(t)}get layers(){return this._layers}_addLayer(t){this._layers.includes(t)||this._layers.push(t)}_removeLayer(t){this._commitLayer(t);null!=this._layers.removeUnordered(t)&&(this._model.dirtySet.getResidentRenderGeometries(t.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,q.noBudget))}addRenderPlugin(t,v){v=this.renderer.renderPlugins.add(t,v);const r=()=>{p.isIntersectionHandler(t)&&this.view.sceneIntersectionHelper.addIntersectionHandler(t)};
if(k.isPromiseLike(v))return v.then(r);r()}removeRenderPlugin(t){this.destroyed||(p.isIntersectionHandler(t)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(t),this.renderer.renderPlugins.remove(t))}get performanceInfo(){return this._model.getStats()}get test(){const t=this;return{getCount(v){return t._model.test.content.filter(r=>r.type===v).length},model:t._model}}};a.Stage.DebugSettings={endFrameContentValidation:!1};b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,
"view",void 0);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"updating",null);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);b.__decorate([m.property({autoDestroy:!0})],a.Stage.prototype,"renderView",void 0);b.__decorate([m.property({readOnly:!0})],
a.Stage.prototype,"renderer",null);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"running",null);a.Stage=b.__decorate([e.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){a.Model=class extends g{constructor(){super(...arguments);this.dirtySet=new h({model:this});this._content=new Map;this._originFactory=new p.GridLocalOriginFactory(null)}getObject(q){return this._content.get(q)}add(q){const t=q.id;w.assert(!this._content.has(t),"Model/Stage already contains object to be added");this._content.set(t,q);x.isWebGLLayer(q)&&this.dirtySet.layerAdded(q)}remove(q){if(!this._content.has(q.id))return!1;this._content.delete(q.id);x.isWebGLLayer(q)&&
this.dirtySet.layerRemoved(q);return!0}addMany(q){for(const t of q)t&&(w.assert(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(q){for(const t of q)t&&(w.assert(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id))}has(q){return this._content.has(q.id)}forEachOfType(q,t){this._content.forEach(v=>{v.type===q&&t(v)})}getRenderGeometry(q,t){const v=new u.RenderGeometry(t,{castShadow:q.castShadow,
objectShaderTransformation:q.shaderTransformation});v.transformation=q.getCombinedStaticTransformation(t,n);({localOrigin:q}=t);v.localOrigin=null!=q?q:this._originFactory.getOrigin(v.boundingSphere);return v}updateRenderGeometryTransformation(q,t,v){if(null==q)return!1;v.transformation=q.getCombinedStaticTransformation(t,n);q=this._originFactory.getOrigin(v.boundingSphere);return v.localOrigin!==q}getStats(){const q={},t=Array.from(this._content.values());for(let v=0;v<e.ContentObjectType.COUNT;++v)q[v]=
t.filter(r=>r.type===v).length;return{contentTypes:q,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};b.__decorate([d.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=b.__decorate([c.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);const n=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./ModelDirtyTypes ./Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){class h{constructor(u,w,x,n){this.operation=u;this.geometry=w;this.states=x;this.sync=n}}b=class extends b{constructor(u){super(u);this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this.dirty=!1}commitLayer(u,w){const x=this._dirtyGeomRecords.get(u);x&&(x.forEach((n,q)=>{const t=this._ensureGeomRecord(u,q);n.forEach(({geometry:v,operation:r,states:y},z)=>{let D=!1;if(r===e.DirtyOperation.UPDATE){const C=t.get(z);if(C){if(y&e.DirtyState.TRANSFORMATION){const E=
this.model.getObject(q);this.model.updateRenderGeometryTransformation(E,v,C)&&(D=!0)}D||w.updates.push({renderGeometry:C,updateType:y})}else p.assert(!1,"ModelDirtySet.commitLayer: invalid update")}if(r===e.DirtyOperation.REMOVE||D)(y=t.get(z))?(w.removes.push(y),t.delete(z)):r===e.DirtyOperation.REMOVE&&p.assert(!1,"ModelDirtySet.commitLayer: invalid remove");if(r===e.DirtyOperation.ADD||D)r=this.model.getObject(q),null!=r&&(v=this.model.getRenderGeometry(r,v),w.adds.push(v),t.set(z,v))});0===t.size&&
this._residentGeomRecords.get(u).delete(q)}),0===this._residentGeomRecords.get(u).size&&this._residentGeomRecords.delete(u),this._dirtyGeomRecords.delete(u),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(u,w){const x=this._dirtyGeomRecords.get(u);x&&x.forEach((n,q)=>{const t=this._ensureGeomRecord(u,q);n.forEach(({geometry:v,operation:r,states:y,sync:z},D)=>{let C=!1;r===e.DirtyOperation.UPDATE&&z&&((r=t.get(D))?(y&e.DirtyState.TRANSFORMATION&&(z=this.model.getObject(q),this.model.updateRenderGeometryTransformation(z,
v,r)&&(C=!0)),C||w.updates.push({renderGeometry:r,updateType:y})):p.assert(!1,"ModelDirtySet.commitSyncUpdates: invalid update"))})})}getResidentRenderGeometries(u,w){(u=this._residentGeomRecords.get(u))&&u.forEach(x=>x.forEach(n=>w.push(n)))}_objectStateChanged(u,w){for(const x of w.geometries)this._updateOrCreateDirtyRecord(w,x,null,e.DirtyOperation.UPDATE,u)}visibilityChanged(u){this._objectStateChanged(e.DirtyState.VISIBILITY,u)}highlightChanged(u){this._objectStateChanged(e.DirtyState.HIGHLIGHT,
u)}occlusionChanged(u){this._objectStateChanged(e.DirtyState.OCCLUDEE,u)}attributesChanged({object:u,geometry:w,sync:x}){this._updateOrCreateDirtyRecord(u,w,null,e.DirtyOperation.UPDATE,e.DirtyState.GEOMETRY,x)}layerAdded(u){u.objects.forAll(w=>this._layerObjectAdded(u,w))}layerRemoved(u){u.objects.forAll(w=>this._layerObjectRemoved(u,w))}layerObjectAdded(u){this._layerObjectAdded(u.layer,u.object)}_layerObjectAdded(u,w){u=u.id;for(const x of w.geometries)this._geometryAdded(w,x,u)}layerObjectRemoved(u){this._layerObjectRemoved(u.layer,
u.object)}layerObjectsAdded(u){for(const w of u.objects)this._layerObjectAdded(u.layer,w)}layerObjectsRemoved(u){for(const w of u.objects)this._layerObjectRemoved(u.layer,w)}_layerObjectRemoved(u,w){u=u.id;for(const x of w.geometries)this._geometryRemoved(w,x,u)}transformationChanged(u){const w=this._getParentLayerId(u);this._ensureGeomRecord(w,u.id).forEach(x=>{this._updateOrCreateDirtyRecord(u,x.geometry,w,e.DirtyOperation.UPDATE,e.DirtyState.TRANSFORMATION)})}shaderTransformationChanged(u){const w=
this._getParentLayerId(u);this._ensureGeomRecord(w,u.id).forEach(x=>{x.objectShaderTransformationChanged(u.shaderTransformation)})}geometryAdded(u){this._geometryAdded(u.object,u.geometry)}_geometryAdded(u,w,x=null){this._updateOrCreateDirtyRecord(u,w,x,e.DirtyOperation.ADD)}geometryRemoved(u){this._geometryRemoved(u.object,u.geometry)}_geometryRemoved(u,w,x=null){this._updateOrCreateDirtyRecord(u,w,x,e.DirtyOperation.REMOVE)}_updateOrCreateDirtyRecord(u,w,x,n,q=e.DirtyState.NONE,t=!1){x=x??this._getParentLayerId(u);
const v=w.id;u=this._ensureDirtyRecord(x,u.id);(x=u.get(v))?(w=x.operation,w===e.DirtyOperation.REMOVE&&n===e.DirtyOperation.ADD&&x.states!==e.DirtyState.NONE?x.operation=e.DirtyOperation.UPDATE:w===e.DirtyOperation.REMOVE&&n===e.DirtyOperation.ADD||w===e.DirtyOperation.ADD&&n===e.DirtyOperation.REMOVE?u.delete(v):(w!==e.DirtyOperation.UPDATE||n!==e.DirtyOperation.REMOVE&&n!==e.DirtyOperation.UPDATE?p.assert((w===e.DirtyOperation.REMOVE||w===e.DirtyOperation.ADD)&&n===e.DirtyOperation.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"):
x.operation=n,x.states|=q),x.sync=x.sync||t):u.set(v,new h(n,w,q,t));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(u,w){let x=this._residentGeomRecords.get(u);x||(x=new Map,this._residentGeomRecords.set(u,x));u=x.get(w);u||(u=new Map,x.set(w,u));return u}get _hasDirtyGeometryRecords(){return g.someMap(this._dirtyGeomRecords,u=>g.someMap(u,w=>w&&0<w.size))}_ensureDirtyRecord(u,w){let x=this._dirtyGeomRecords.get(u);x||(x=new Map,this._dirtyGeomRecords.set(u,x));u=x.get(w);u||(u=new Map,
x.set(w,u));return u}_getParentLayerId(u){return u.parentLayer?u.parentLayer.id:d.NullUID}formatDebugInfo(){const u=["ADD","UPD",void 0,"REM"];let w="";this._dirtyGeomRecords.forEach((x,n)=>{x.forEach((q,t)=>{0<w.length&&(w+="\n");w+=n+"."+t;const v=[];q.forEach(r=>{const y=r.operation;v[y]||(v[y]=[]);v[y].push(r.geometry.id)});for(q=0;q<v.length;q++)if(v[q])for(w+=" "+u[q-1]+": ",t=0;t<v[q].length;t++)w+=v[q][t]+", "})});return w}get test(){const u=this;return{get residentLayerCount(){return u._residentGeomRecords.size},
get residentObjectCount(){return Array.from(u._residentGeomRecords.values()).reduce((w,x)=>w+x.size,0)},commit:w=>u._dirtyGeomRecords.forEach((x,n)=>u.commitLayer(n,w))}}};a.__decorate([k.property({constructOnly:!0})],b.prototype,"model",void 0);a.__decorate([k.property()],b.prototype,"dirty",void 0);return b=a.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],b)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Material ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/markerTextureRepository ../materials/stippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../support/RenderState ../../../webgl/contextUtils ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T){a.RenderView=class extends g{constructor(O){super({});this.events=new d;this.waterTextureRepository=new I.WaterTextureRepository;this._magnifierHelper=new y.MagnifierHelper;this.objectAndLayerIdRenderHelper=k("enable-feature:objectAndLayerId-rendering")?new D.ObjectAndLayerIdRenderHelper:null;this._idleSuspend=this._needsRender=this._needsUpdate=!0;this._needsWaterReflectionUpdate=!1;this._lastAnimationUpdate=0;this._container=
O.container;this._viewingMode=O.viewingMode;this._initializeContext(O);this.addHandles([c.watch(()=>this.waterTextureRepository?.updating,()=>this.requestRender(),c.initial),c.watch(()=>O.view.qualityProfile,Z=>this.renderer?.updateRenderFeatures(Z),c.syncAndInitial),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const {memoryController:U}=O.view.resourceController;this.stippleTextureRepository=G.createStippleTextureRepository(this._rctx,U);this.markerTextureRepository=
F.createMarkerTextureRepository(this._rctx,U);this._shaderTechniqueRepository=new n.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:O.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository});this._textureRepository=new A.TextureRepository(O,this._shaderTechniqueRepository,this._rctx);this.addHandles(this._textureRepository.events.on("changed",Z=>this.requestRender(Z)));this._materialRepository=
new r.GLMaterialRepository(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender());this._compositingHelper=new t(this._rctx,this._shaderTechniqueRepository);this.renderer=new C.Renderer(O,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,Z=>this.requestRender(Z));this._screenshotManager=new K.ScreenshotManager(this._rctx,{renderScene:(Z,P,R,W,N)=>this.renderer.render(Z,
P,R,W,N),requestRenderScene:Z=>this.requestRender(Z),prepareOverlay:()=>O.options.screenshot.prepareOverlay(),renderOverlay:(Z,P,R)=>O.options.screenshot.renderOverlay(Z,P,R)},Z=>this.events.emit("force-camera-for-screenshot",Z));this._registerFrameTask(O)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=f.removeMaybe(this._frameTask);this._shaderTechniqueRepository=f.destroyMaybe(this._shaderTechniqueRepository)}requestRender(O=
q.RenderRequestType.UPDATE){this._needsRender=!0;O===q.RenderRequestType.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(O){this._magnifierHelper.magnifier=O}setIdleSuspend(O){this._idleSuspend!==
O&&(this._idleSuspend=O,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(O){return this._screenshotManager.takeScreenshot(O).then(U=>U[0])}takeScreenshotWithOID(O){O.objectAndLayerIdColor=!0;return this._screenshotManager.takeScreenshot(O)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(O,U,Z,P,R,W=R){W=P.constrainWindowSize(U,Z,R*P.pixelRatio,W*P.pixelRatio);
const N=this._ensureDepthBuffer(W);this.renderer.readDepthPixels(P,W,N);R=Number.MAX_VALUE;for(let V=0;V<W[2]*W[3];V++){const S=v.textureToDepth(4*V,N,P.nearFar);R>S&&S!==P.nearFar[0]&&S!==P.nearFar[1]&&(R=S)}O&&(O=O.pickDepth(U*P.pixelRatio,Z*P.pixelRatio,P),null!=O&&R>O&&O!==P.nearFar[0]&&O!==P.nearFar[1]&&(R=O));return R===Number.MAX_VALUE?void 0:R}_ensureDepthBuffer(O){O=4*O[2]*O[3];if(null==this._tmpDepthBuffer||this._tmpDepthBuffer.byteLength<O)this._tmpDepthBuffer=new Uint8Array(O);return this._tmpDepthBuffer}async reloadShaders(){B.removeLoadedShaderModules();
await this._shaderTechniqueRepository.reloadAll();this.requestRender()}_registerFrameTask(O){const U=O.view.state;let Z=!1,P=q.RenderRequestType.BACKGROUND,R=!1;this._frameTask=l.addFrameTask({preRender:({time:W})=>{Z=this.updating;P=this._needsUpdate?q.RenderRequestType.UPDATE:q.RenderRequestType.BACKGROUND;O.commitSyncLayers();var N=e.Milliseconds(W-this._lastAnimationUpdate);if(N>this.renderer.animationTimestep||null!=U.forcedAnimationTime||Z||this._needsRender)N=e.Milliseconds(N/this.renderer.animationTimeDilation),
N=new z.UpdateParameters(U.camera,N,U.forcedAnimationTime),this.renderer.updateAnimation(N)&&this.requestRender(q.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=W},render:({time:W})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<U.camera.fullWidth&&0<U.camera.fullHeight){const N=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this.renderer.render(null,
null,U,q.Decorations.ON,W);R=!0;N&&this.renderer.hasReflections&&(this.requestRender(q.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:W})=>{const N=new K.ScreenshotContext(U,this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,this.renderer.fboCache);this._textureRepository.update();this._screenshotManager.update(N,W)},finish:()=>{R&&(this.renderer.finish(U.mode===J.RenderState.IDLE?P:q.RenderRequestType.UPDATE),
R=!1)}})}_initializeContext(O){const U=O.options;this._canvas=U.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const Z=M.createContextForView("3d",this._canvas,{alpha:U.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:U.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:U.preserveDrawingBuffer??!1});null!=Z&&T(Z)?(this._rctx=this._newRenderingContext(Z,O),this._loadShaderOnlyExtensions(),
!U.alpha&&this._rctx.contextAttributes.alpha&&m.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=k("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):m.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(O,U){const Z={disabledExtensions:U.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:U.options.debugWebGLExtensions||
{},maxAnisotropy:8},P=(R,W)=>U.view.resourceController.memoryController.newCache(R,W);if(L.contextCache.enabled){let R=Q.get(O);if(R)return R.configure(Z),R.newCache=P,R.ref(),R;R=new E.RenderingContext(O,Z,P);Q.set(O,R);R.ref();return R}return new E.RenderingContext(O,Z,P)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(O){return null!=this.objectAndLayerIdRenderHelper?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(O):null}get componentObjectCollection(){null==
this._componentObjectCollection&&(this._componentObjectCollection=new x.ComponentObjectCollection(this.renderer.renderPassManager,this._viewingMode));return this._componentObjectCollection}set componentObjectCollection(O){this._componentObjectCollection=O}};b.__decorate([p.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,"_rctx",void 0);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,
"_container",void 0);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,"_canvas",void 0);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,"stippleTextureRepository",void 0);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,"markerTextureRepository",void 0);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,"waterTextureRepository",void 0);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,"_magnifierHelper",void 0);
b.__decorate([p.property({readOnly:!0})],a.RenderView.prototype,"objectAndLayerIdRenderHelper",void 0);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,"_textureRepository",void 0);b.__decorate([p.property({autoDestroy:!0,readOnly:!0})],a.RenderView.prototype,"renderer",void 0);b.__decorate([p.property({autoDestroy:!0})],a.RenderView.prototype,"_screenshotManager",void 0);b.__decorate([p.property()],a.RenderView.prototype,"componentObjectCollection",null);b.__decorate([p.property({autoDestroy:!0})],
a.RenderView.prototype,"_componentObjectCollection",void 0);b.__decorate([p.property()],a.RenderView.prototype,"_needsUpdate",void 0);b.__decorate([p.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=b.__decorate([w.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const Q=H.getContextCache();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../core/has ../../../../../core/Logger ../../../../../core/PooledArray ../../../../../core/typedArrayUtil ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/Indices ../../../../../chunks/vec32 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./UniformComponentParameters ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/edgeProcessing ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O){function U(S,X){return S===X?A.ComponentParameterSummary.All:0===S?A.ComponentParameterSummary.None:A.ComponentParameterSummary.Some}const Z=g.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class P{constructor(S,X){this._renderManager=S;this._viewingMode=X;this._objects=[new d,new d];this._renderSubmit=new D.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);
this._hasObjectAndLayerId=b("enable-feature:objectAndLayerId-rendering");this._componentBufferManager=new M.BufferManager(S.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){H.assert(0===this._objects[v.State.Hidden].length&&0===this._objects[v.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy();const S=this._objects.flatMap(X=>X.toArray());for(const X of S)X?.destroy()}createObject(S){const X=new v.ComponentObject;X.toMapSpace=S.toMapSpace;
X.transform=S.transform;X.obb=x.clone(S.obb);X.components=new t(this._componentBufferManager,e.compactIndices(S.geometry.componentOffsets));X.renderable=this._createRenderable(S,X.components);X.intersectionGeometry=new r(S.geometry.positionData,X.components);this._objects[X.visible].push(X);return X}destroyObject(S){this._objects[S.visible].removeUnordered(S);S.destroy();this._notifyDirty()}setObjectVisibility(S,X){X!==S.visible&&(this._objects[S.visible].removeUnordered(S),this._objects[X].push(S),
S.visible=X,this._notifyDirty())}preSubmit(S){const X=S.camera.eye;this.visibleObjects.forAll(ca=>ca.renderable.meta.cameraDepthSquared=c.squaredDistance(X,ca.obb.center))}getMaterial(S){return S.renderable.material}updateMaterial(S,X){S=S.renderable.material;X(S);S.dirty&&this._notifyDirty()}setAllComponentVisibilities(S,X){S.components.visibility.reset(X);S.components.visibilityDirty();this._notifyDirty()}forEachVisibleComponent(S,X){return S.components.visibility.forEachComponent(X)}getComponentCount(S){const X=
S.components.visibility.componentCount();return{visible:X,invisible:S.components.count-X}}setComponentData(S,X){const ca=S.renderable.material,ba=S.components;var ia=ba.materialDataBuffer;const ka=ba.materialDataIndices,na=new E.UniformComponentParameters;ia=ia.textureBuffer;const Y=new Uint8Array(4),ea=new Uint32Array(Y.buffer);let fa=0,aa=0,da=0,ma=ba.verticalOffsets,ua=Infinity,sa=-Infinity,ra=!1,Aa=!1,qa=0;for(let la=0;la<ba.count;la++){X(la,na);fa+=+(1>na.externalColor[3]);aa+=+(na.externalColorMixMode===
w.ColorMixModeEnum.Replace&&1===na.externalColor[3]);da+=+na.castShadows;w.encodeSymbolColor(na.externalColor,na.externalColorMixMode,Y);Y[2]=Y[2]&254|+na.castShadows;ia.setData(ka[la],0,Y[0],Y[1],Y[2],Y[3]);ra||(ra=0<la&&qa!==ea[0]);qa=ea[0];Aa||(Aa=0!==na.elevationOffset);Aa&&null==ma&&(ma=Array(la).fill(0));null!=ma&&(ma[la]=na.elevationOffset);ua=Math.min(ua,na.elevationOffset);sa=Math.max(sa,na.elevationOffset);G.encodeElevationOffset(na.elevationOffset,Y);ia.setData(ka[la],1,Y[0],Y[1],Y[2],
Y[3]);const ja=na.objectAndLayerIdColor;null!=ja&&ia.setData(ka[la],2,ja[0],ja[1],ja[2],ja[3]);na.pickable!==I.getVisibility(ba.pickability,la)&&(ba.pickability=I.updateVisibilityWithCount(ba.pickability,ba.count,la,na.pickable))}ba.verticalOffsets=Aa?ma:null;S.offsetObb=Aa?x.computeOffsetObb(S.obb,ua,sa,this._viewingMode,null!=S.offsetObb?S.offsetObb:x.clone(S.obb)):null;ra||Aa||this._hasObjectAndLayerId?(ca.componentParameters=new A.ComponentParametersVarying,ca.componentParameters.castShadows=
U(da,ba.count),ca.componentParameters.transparent=U(fa,ba.count),ca.componentParameters.opaqueOverride=U(aa,ba.count),ca.componentParameters.texture=ia,ia.updateTexture()):(ca.componentParameters=new A.ComponentParametersUniform,ca.componentParameters.castShadows=na.castShadows?A.ComponentParameterSummary.All:A.ComponentParameterSummary.None,ca.componentParameters.externalColor=na.externalColor,ca.componentParameters.externalColorMixMode=na.externalColorMixMode);this._notifyDirty()}getComponentAabb(S,
X,ca,ba=!1){S.intersectionGeometry.getComponentAabb(X,ca);const ia=S.components.verticalOffsets;if(ba||null==ia)return ca;X=ia[X];if(this._viewingMode===u.ViewingMode.Local||0===X)return ca[2]+=X,ca[5]+=X,ca;X=K.getVerticalOffsetI3S(X);X.localOrigin=S.transform.position;return X.applyToAabb(ca)}getComponentObb(S){return S.obb}getObjectTransform(S){return S.transform}getComponentPositions(S,X,ca){return S.intersectionGeometry.getComponentPositions(X,ca)}intersect(S,X,ca,ba,ia,ka){null!=ia&&(ia.localOrigin=
S.transform.position);const na=m.invert(W,S.transform.rotationScale);c.sub(N,X,S.transform.position);c.sub(V,ca,S.transform.position);c.transformMat3(N,N,na);c.transformMat3(V,V,na);X=m.transpose(W,na);return S.intersectionGeometry.intersect(N,V,ba,X,ia,S.components.verticalOffsets,ka)}addEdges(S,X,ca,ba){const {indices:ia,positions:ka}=S.intersectionGeometry,na=S.components.offsets;return X.addComponentObject(S,S.transform,{center:S.obb.center,radius:x.radius(S.obb)},ka,ia,na,ca,ba)}async extractEdgeInformation(S,
X,ca){var ba=S.components.visibility;if(ba.allInvisible())return{buffer:J.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const {indices:ia,positions:ka}=S.intersectionGeometry,na=S.components.offsets,Y=L.EdgeInputBufferLayout.createBuffer(ka.length/3);h.copy(Y.position.typedBuffer,ka,Y.position.typedBufferStride,3);p.transformMat3View(Y.position,Y.position,S.transform.rotationScale);this._setComponentIndices(Y.componentIndex,ia,na);ba=this._computeVisibilityIndices(ia,ba,na,
Y.count);S=l.clone(S.transform.position);X=await X.extractComponentsEdgeLocations({indices:ba,indicesLength:ba.length,skipDeduplicate:!0,data:Y,writerSettings:{reducedPrecision:!1,variants:0}},ca);return{origin:S,buffer:X}}_setComponentIndices(S,X,ca){let ba=0;for(let ka=0;ka<ca.length-1;ka++){var ia=ca[ka];const na=ca[ka+1];for(;ia<na;ia++)S.set(X?X[ia]:ia,ba);ba++}}_computeVisibilityIndices(S,X,ca,ba){if(S&&X.allVisible())return S;let ia=0;X.forEachComponentRange((Y,ea)=>{ia+=ca[ea]-ca[Y];return!0});
const ka=k.isArray(S)?Array(ia):2===S?.BYTES_PER_ELEMENT||65536>=ba?new Uint16Array(ia):new Uint32Array(ia);let na=0;X.forEachComponentRange((Y,ea)=>{Y=ca[Y];for(ea=ca[ea];Y<ea;Y++)ka[na++]=S?S[Y]:Y;return!0});return ka}addComponentHighlight(S,X){S=S.components;null==S.highlightCounts&&(S.highlightCounts=new Uint32Array(S.count+1));0===S.highlightCounts[X]++&&(S.highlightsDirty(),this._notifyDirty());S.highlightCounts[S.count]++}removeComponentHighlight(S,X){S=S.components;if(null==S.highlightCounts)Z.warn("Removing non-existing highlight.");
else{var ca=S.highlightCounts[X],ba=S.highlightCounts[S.count];0===ca?Z.warn("Removing non-existing highlight."):1<ca?(S.highlightCounts[X]=ca-1,S.highlightCounts[S.count]=ba-1):(S.highlightCounts[X]=0,S.highlightsDirty(),this._notifyDirty(),1===ba?S.highlightCounts=null:S.highlightCounts[S.count]=ba-1)}}clearHighlights(S){S=S.components;null!=S.highlightCounts&&(S.highlightCounts=null,S.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(S){return S.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[v.State.Visible]}_createRenderable(S,
X){var ca=this._renderManager.rctx;const ba=S.geometry;var ia=ba.vertices.layoutParameters;const ka=T.BufferObject.createVertex(ca,Q.Usage.STATIC_DRAW,ba.vertices.data),na=ba.indices?T.BufferObject.createIndex(ca,Q.Usage.STATIC_DRAW,ba.indices):null,Y=n.glLayout(C.createVertexBufferLayout(ia)),ea=new Uint16Array(ba.vertices.count);for(let aa=0;aa<X.count;aa++){var fa=X.offsets[aa];const da=X.offsets[aa+1],ma=X.materialDataIndices[aa];if(null!=ba.indices)for(;fa<da;fa++)ea[ba.indices[fa]]=ma;else for(;fa<
da;fa++)ea[fa]=ma}X=T.BufferObject.createVertex(ca,Q.Usage.STATIC_DRAW,ea.buffer);S=new A.ComponentMaterial(S.transform,S.toMapSpace);ca=new O.VertexArrayObject(ca,F.attributeLocations,{data:Y,componentIndices:R},{data:ka,componentIndices:X},na);ia=new z.RenderGeometry(ca,Q.PrimitiveType.TRIANGLES,ia,null!=na);return new y.Renderable(S,ia,{cameraDepthSquared:.5,gpuMemoryEstimate:ka.byteLength+X.byteLength+(null!=na?na.byteLength:0)})}_notifyDirty(){this._renderManager.notifyDirty()}}const R=n.glLayout(q.newLayout().u16(B.VertexAttribute.COMPONENTINDEX)),
W=f.create(),N=l.create(),V=l.create();a.ComponentObjectCollection=P;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["./IndexRange/ComponentRangeRunLengthEncoded"],function(a){function b(d,k,m){const f=[],c=[];let l=m.length,e=m.length;k.forEachComponent(p=>{0<d[p]?(l!==p-1&&(f.length&&f.push(m[l+1]-f[f.length-1]),f.push(m[p])),l=p):(e!==p-1&&(c.length&&c.push(m[e+1]-c[c.length-1]),c.push(m[p])),e=
p);return!0});f.length&&f.push(m[l+1]-f[f.length-1]);c.length&&c.push(m[e+1]-c[c.length-1]);return{highlightRanges:f,defaultRanges:c}}class g{constructor(d,k){this.offsets=k;this.cachedDefaultRanges=this.cachedHighlightRanges=this.cachedGeometryRanges=this.verticalOffsets=this.highlightCounts=this.pickability=null;k=this.count;this.visibility=new a.ComponentRangeRunLengthEncoded(k);this.materialDataBuffer=d.getBuffer(k);this.materialDataIndices=new Uint16Array(k);for(d=0;d<k;d++)this.materialDataIndices[d]=
this.materialDataBuffer.acquireIndex()}destroy(){for(let d=0;d<this.count;d++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[d])}get count(){return this.offsets.length-1}get geometryRanges(){null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}get highlightRanges(){if(null==this.highlightCounts)return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}get defaultShadowMapRanges(){if(null==
this.highlightCounts)return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}highlightsDirty(){this.cachedDefaultRanges=this.cachedHighlightRanges=null}visibilityDirty(){this.cachedGeometryRanges=null;this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRanges||null==this.cachedDefaultRanges)&&null!=this.highlightCounts){const {highlightRanges:d,defaultRanges:k}=b(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=
d;this.cachedDefaultRanges=k}}}return g})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){class b{constructor(g){this._totalCount=g;this._indexRanges=[0,g]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return 0===this._indexRanges.length}componentCount(){const g=this._indexRanges;let d=0;for(let k=0;k<g.length;k+=2)d+=g[k+1];return d}reset(g){if("all"===g||g.length===this._totalCount)this._indexRanges=
[0,this._totalCount];else{{const m=[];if(0!==g.length){var d=g[0],k=1;for(let f=1;f<g.length;f++){const c=g[f];d+k===c?k+=1:(m.push(d),m.push(k),d=c,k=1)}m.push(d);m.push(k)}g=m}this._indexRanges=g}}forEachComponent(g){const d=this._indexRanges;for(let m=0;m<d.length;m+=2){var k=d[m];const f=k+d[m+1];for(;k<f;k++)if(!g(k))return!1}return!0}forEachComponentRange(g){const d=this._indexRanges;for(let k=0;k<d.length;k+=2){const m=d[k];if(!g(m,m+d[k+1]))return!1}return!0}computeOffsetRanges(g){const d=
Array(this._indexRanges.length),k=this._indexRanges;for(let f=0;f<k.length;f+=2){var m=k[f];const c=g[m];m=g[m+k[f+1]];d[f]=c;d[f+1]=m-c}return d}}a.ComponentRangeRunLengthEncoded=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c,l){a.ComponentObject=class extends g{constructor(){super(...arguments);this.visible=a.State.Hidden}destroy(){this.intersectionGeometry=d.destroyMaybe(this.intersectionGeometry)}};b.__decorate([k.property({autoDestroy:!0})],a.ComponentObject.prototype,"renderable",void 0);b.__decorate([k.property({autoDestroy:!0})],a.ComponentObject.prototype,"components",void 0);a.ComponentObject=b.__decorate([l.subclass("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],
a.ComponentObject);a.State=void 0;(function(e){e[e.Hidden=0]="Hidden";e[e.Visible=1]="Visible"})(a.State||(a.State={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/FloatArray ../../../../../geometry/support/Indices ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,g,d,k,m,f,c,l){class e{constructor(u,w){this._components=w;this._indices=u.indices?k.compactIndices(u.indices):k.getContinuousIndexArray(u.positions.length/3);this._positions=u.positions;this._componentIntersectionData=Array(w.count)}destroy(){this._indices=this._positions=null;this._componentIntersectionData.length=0;this._perComponentAabbs=null}getComponentAabb(u,w){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let x=0;6>x;x++)w[x]=this._perComponentAabbs[6*
u+x];return w}getComponentPositions(u,w){w.indices=this._indices;w.data=this._positions;w.stride=3;w.startIndex=this._components.offsets[u];w.endIndex=this._components.offsets[u+1]}intersect(u,w,x,n,q,t,v){const r=new f.Vertices(this._positions,3),y=this._indices,z=this._components.offsets,D=l.computeInvDir(u,w,p),C=u[2],E=w[2];this._components.visibility.forEachComponent(A=>{if(!c.getVisibility(this._components.pickability,A))return!0;var F=this.getComponentAabb(A,h);if(null!=t){var G=t[A];null!=
q?q.componentOffset=G:(u[2]=C-G,w[2]=E-G)}null!=q&&q.applyToAabb(F);if(!l.intersectAabbInvDir(F,u,D,x))return!0;F=z[A]/3;G=z[A+1]/3;const I=(H,B,K)=>v(A,H,a.transformMat3(B,B,n),K);null==q&&G-F>m.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[A]&&(this._componentIntersectionData[A]=new m.ComponentIntersectionData(this._indices,F,G,r)),this._componentIntersectionData[A].intersectRay({r0:u,r1:w},I)):l.intersectTriangles(u,w,F,G,y,r,void 0,q,I);return!0})}_computePerComponentAabbs(){const u=
this._components.count,w=d.newFloatArray(6*u),x=this._indices,n=this._positions,q=this._components.offsets;let t=0;for(let y=0;y<u;y++){var v=q[y];const z=q[y+1];let D=Infinity,C=Infinity,E=Infinity,A=-Infinity,F=-Infinity,G=-Infinity;for(;v<z;v++){var r=3*x[v];const I=n[r],H=n[r+1];r=n[r+2];D=Math.min(D,I);C=Math.min(C,H);E=Math.min(E,r);A=Math.max(A,I);F=Math.max(F,H);G=Math.max(G,r)}w[t++]=D;w[t++]=C;w[t++]=E;w[t++]=A;w[t++]=F;w[t++]=G}return w}get positions(){return this._positions}get indices(){return this._indices}}
const p=b.create(),h=g.create();return e})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports","../../../../core/arrayUtils"],function(a,b){function g(d=!0){return{isVisibleBit:!d,data:new Uint32Array(0)}}a.defaultVisibilities=g;a.getVisibility=function(d,k){if(null==d)return!0;const {isVisibleBit:m,data:f}=d,c=8*f.BYTES_PER_ELEMENT;return k<f.length*c?(d=k/c|0,0!==(f[d]&1<<k-d*c)===m):!d.isVisibleBit};a.updateVisibilityWithCount=function(d,k,m,f){if(m>=k)return d;null==
d&&(d=g());let c=d.data;const l=8*c.BYTES_PER_ELEMENT,e=m/l|0,p=m-l*e,h=c;f=f===d.isVisibleBit;m<h.length*l||!f||(m=Math.max(e+1,Math.ceil(h.length*b.ReallocGrowthFactor)),m=Math.min(m,((k-1)/l|0)+1),c=new Uint32Array(m),c.set(h));e<c.length&&(c[e]=c[e]&~(1<<p)|(f?1:0)<<p);d.data=c;return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){class b{constructor(g,d,k){this.material=
g;this.geometry=d;this.meta=k}destroy(){this.material.dispose();this.geometry.dispose()}}a.Renderable=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports"],function(a){class b{constructor(g,d,k,m){this.vao=g;this.primitiveType=d;this.parameters=k;this.indexed=m}dispose(){this.vao.dispose()}}a.RenderGeometry=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports",
"./DepthRange"],function(a,b){class g{constructor(d){this._objects=d}submit(d,k){this._objects.preSubmit(k);this._objects.visibleObjects.forAll(m=>m.renderable.material.submit(d,k,m))}queryShadowCasterDepthRange(d){return this._objects.visibleObjects.length?b.computeDepthRange(d,this._objects.visibleObjects):null}}a.RenderSubmitSystem=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(I,H,B){return f.set(I,H.data[B],H.data[B+1],H.data[B+2])}function u(I,H){I.push(H[0]);I.push(H[1]);I.push(H[2])}function w(I,H,B,K){k.conjugate(D,I.quaternion);f.sub(C,H,I.center);f.transformQuat(C,C,D);const L=8*((C[0]<-I.halfSize[0]?-1:C[0]>I.halfSize[0]?1:0)+3*(C[1]<-I.halfSize[1]?-1:C[1]>I.halfSize[1]?1:0)+9*(C[2]<-I.halfSize[2]?-1:C[2]>I.halfSize[2]?1:0)+13);H=y[L];if(0===H)return H;g.fromQuat(z,I.quaternion);g.scale(z,z,I.halfSize);const J=(M,T)=>{T=
y[L+T+1];f.set(M,((T&1)<<1)-1,(T&2)-1,((T&4)>>1)-1);f.transformMat3(M,M,z);return f.add(M,I.center,M)};B.length=0;u(B,J(E,0));u(B,J(A,1));u(B,J(C,2));u(B,J(F,3));K(B);if(1===H)return H;B.length=0;u(B,E);u(B,F);u(B,J(C,4));u(B,J(G,5));K(B);if(2===H)return H;B.length=0;u(B,E);u(B,G);u(B,J(C,6));u(B,A);K(B);return H}const x=new b({allocator:I=>I||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:I=>{I.object=null;return I}}),n=p.empty(),q=c.create(),t=c.create(),v=new b({deallocator:null}),
r=new b({deallocator:null}),y=(()=>{const I=Array(216);let H=0;const B=K=>{for(let L=0;L<K.length;L++)I[H+L]=K[L];H+=8};B([3,0,6,2,3,1,5,4]);B([2,0,2,3,1,5,4,0]);B([3,1,0,2,3,7,5,4]);B([2,0,1,3,2,6,4,0]);B([1,0,1,3,2,0,0,0]);B([2,1,5,7,3,2,0,0]);B([3,2,0,1,3,7,6,4]);B([2,2,0,1,3,7,6,0]);B([3,3,0,1,5,7,6,2]);B([2,0,1,5,4,6,2,0]);B([1,0,1,5,4,0,0,0]);B([2,1,3,7,5,4,0,0]);B([1,0,2,6,4,0,0,0]);B([0,0,0,0,0,0,0,0]);B([1,1,3,7,5,0,0,0]);B([2,2,3,7,6,4,0,0]);B([1,2,3,7,6,0,0,0]);B([2,3,1,5,7,6,2,0]);B([3,
4,0,1,5,7,6,2]);B([2,5,7,6,4,0,1,0]);B([3,5,0,1,3,7,6,4]);B([2,4,5,7,6,2,0,0]);B([1,4,5,7,6,0,0,0]);B([2,5,1,3,7,6,4,0]);B([3,6,0,2,3,7,5,4]);B([2,6,2,3,7,5,4,0]);B([3,7,6,2,3,1,5,4]);return I})(),z=d.create(),D=m.create(),C=c.create(),E=c.create(),A=c.create(),F=c.create(),G=c.create();a.computeDepthRange=function(I,H){const B=p.empty(),{eye:K,frustum:L,viewForward:J}=I;H.forAll(M=>{var T=null!=M.offsetObb?M.offsetObb:M.obb;const Q=f.dot(f.sub(C,T.center,K),J),O=e.projectedRadius(T,J);if(!p.within(B,
Q-O)||!p.within(B,Q+O)){a:{var U=0;for(let Z=0;4>Z;Z++){const P=e.intersectPlane(T,L[Z]);if(0<P){T=-1;break a}0===P&&(U|=1<<Z)}T=U}-1!==T&&(0===T?(n.far=Q+O,n.near=Q-O,p.union(B,n)):(U=x.pushNew(),U.near=Q-O,U.far=Q+O,U.mask=T,U.object=M))}});for(I=0;I<x.length;I++){const M=x.data[I];p.within(B,M.near)&&p.within(B,M.far)||(n.far=M.far,n.near=Infinity,0===w(null!=M.object.offsetObb?M.object.offsetObb:M.object.obb,K,v,T=>{var Q=r;for(var O=0;4>O&&0<T.length;O++){if(0===(M.mask&1<<O))continue;var U=
L[O],Z=T,P=Q;P.length=0;const R=Z.length-3;h(q,Z,R);const W=l.signedDistance(U,q);0>=W&&(P.push(q[0]),P.push(q[1]),P.push(q[2]));let N=0,V=W;for(N;N<R;N+=3){h(t,Z,N);const S=l.signedDistance(U,t);0>V*S&&(f.lerp(q,t,q,S/(S-V)),u(P,q));0>=S&&u(P,t);V=S;f.copy(q,t)}0>V*W&&(h(t,Z,R),f.lerp(q,t,q,W/(W-V)),u(P,q));U=T;T=Q;Q=U}for(Q=0;Q<T.length;Q+=3)f.set(q,T.data[Q],T.data[Q+1],T.data[Q+2]),O=f.dot(f.sub(q,q,K),J),n.near=Math.min(n.near,O)})&&(n.near=0),p.union(B,n))}x.length=0;return B};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function b(k,m){return{near:k,far:m}}function g(k,m,f){k.near=m;k.far=f;return k}class d{constructor(){this.near=Number.MAX_VALUE;this.far=-Number.MAX_VALUE}}a.DepthRange=d;a.create=b;a.empty=function(k){return k?g(k,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=g;a.union=function(k,m){null!=m&&(k.near=Math.min(k.near,m.near),k.far=Math.max(k.far,m.far))};a.within=function(k,
m){return k.near<=m&&m<=k.far};a.zero={near:0,far:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,g,d){a.createVertexBufferLayout=function(k){const m=b.newLayout().vec3f(d.VertexAttribute.POSITION);k.normals&&m.vec2i16(d.VertexAttribute.NORMALCOMPRESSED,
{glNormalized:!0});k.textureCoordinates===g.TextureCoordinateAttributeType.Default?m.vec2f(d.VertexAttribute.UV0):k.textureCoordinates===g.TextureCoordinateAttributeType.Atlas&&(m.vec2f(d.VertexAttribute.UV0),m.vec4u16(d.VertexAttribute.UVREGION,{glNormalized:!0}));k.colors&&m.vec4u8(d.VertexAttribute.COLOR,{glNormalized:!0});return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/UniformComponentParameters":function(){define(["exports",
"../../../../../chunks/vec4f64","../../../layers/support/symbolColorUtils"],function(a,b,g){class d{constructor(){this.externalColor=b.create();this.externalColorMixMode=g.ColorMixModeEnum.Multiply;this.pickable=this.castShadows=!0;this.elevationOffset=0}}a.UniformComponentParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f32 ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../../../layers/support/symbolColorUtils ../../../../terrain/OverlayContent ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/TransparencyPassType ../../../materials/pbrUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G){class I extends q.MaterialBase{constructor(J,M){super();this.toMapSpace=M;this.baseColor=e.fromValues(1,1,1,1);this.hasParametersFromSource=this.usePBR=!1;this.mrrFactors=c.fromArray(G.defaultAdvancedMRRFactors);this.emissiveFactor=c.fromValues(0,0,0);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null;this.objectOpacity=1;this.commonMaterialParameters=new B;this.componentParameters=
new K;this.textureAlphaCutoff=D.defaultMaskAlphaCutoff;this.alphaDiscardMode=A.AlphaDiscardMode.Opaque;this.polygonOffsetEnabled=this.isIntegratedMesh=!1;this.ellipsoidMode=C.EllipsoidMode.Earth;this.hasOccludees=!1;this._techniqueConfiguration=new w.ComponentTechniqueConfiguration;M=new E.TwoVectorPosition(J.position);const T=k.clone(J.rotationScale);d.invert(T,T);this.transformNormalGlobalFromModel=m.clone(d.transpose(T,T));this.transformWorldFromModelTL=M.low;this.transformWorldFromModelTH=M.high;
this.transformWorldFromModelRS=J.rotationScale}dispose(){this._technique=g.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null}get texture(){return null!=this.baseColorTexture?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return null!=this.metallicRoughnessTexture?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return null!=this.emissionTexture?this.emissionTexture.glTexture:
null}get textureOcclusion(){return null!=this.occlusionTexture?this.occlusionTexture.glTexture:null}get textureNormal(){return null!=this.normalTexture?this.normalTexture.glTexture:null}prepareTechnique(J,M,T,Q){const O=this._techniqueConfiguration;O.hasVertexColors=Q.colors;O.hasNormals=Q.normals;O.textureCoordinateType=Q.textureCoordinates;O.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture;O.hasEmissionTexture=null!=this.emissionTexture;O.hasOcclusionTexture=null!=this.occlusionTexture;
O.hasNormalTexture=null!=this.normalTexture;O.transparencyPassType=M.identifier===t.RenderPassIdentifier.Material&&null!=T.transparencyPassType?T.transparencyPassType:F.TransparencyPassType.NONE;O.multipassEnabled=M.identifier===t.RenderPassIdentifier.Material&&T.multipassEnabled;O.cullAboveGround=M.identifier===t.RenderPassIdentifier.Material?T.multipassTerrain.cullAboveGround:!1;O.ellipsoidMode=this.ellipsoidMode;O.componentData=this.componentParameters.type;O.cullFace=this.commonMaterialParameters.cullFace;
O.doubleSidedMode=this.commonMaterialParameters.doubleSided?y.NormalsDoubleSidedMode.View:y.NormalsDoubleSidedMode.None;O.hasColorTexture=null!=this.baseColorTexture;Q=this._computeWhichMaterialPass();O.blendingEnabled=Q===H.Transparent||Q===H.OpaqueAndTransparent;O.alphaDiscardMode=this.alphaDiscardMode;O.integratedMeshMode=this.isIntegratedMesh?null!=T.overlay?.getTexture(h.OverlayContent.ColorNoRasterImage)?null!=T.overlay?.getTexture(h.OverlayContent.WaterNormal)?w.IntegratedMeshMode.ColorOverlayWithWater:
w.IntegratedMeshMode.ColorOverlay:w.IntegratedMeshMode.NoOverlay:w.IntegratedMeshMode.None;O.hasPolygonOffset=this.polygonOffsetEnabled;O.pbrMode=O.integratedMeshMode===w.IntegratedMeshMode.ColorOverlayWithWater?z.PBRMode.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?z.PBRMode.Schematic:z.PBRMode.Normal:z.PBRMode.Disabled;O.normalType=O.integratedMeshMode===w.IntegratedMeshMode.None?O.hasNormals?r.NormalType.Compressed:r.NormalType.ScreenDerivative:r.NormalType.Ground;O.hasSlicePlane=
null!=T.slicePlane&&this.commonMaterialParameters.hasSlicePlane;if(M.identifier===t.RenderPassIdentifier.ShadowMap)O.output=v.ShaderOutput.Shadow,O.vertexDiscardMode=n.VertexDiscardMode.None;else if(M.identifier===t.RenderPassIdentifier.Highlight)O.output=v.ShaderOutput.Highlight,O.vertexDiscardMode=n.VertexDiscardMode.None;else{O.vertexDiscardMode=Q===H.OpaqueAndTransparent?M.transparent?n.VertexDiscardMode.Opaque:n.VertexDiscardMode.Transparent:n.VertexDiscardMode.None;O.output=M.output;O.receiveAmbientOcclusion=
!1;O.receiveShadows=!1;switch(M.output){case v.ShaderOutput.Color:O.receiveAmbientOcclusion=null!=T.ssao;O.hasOccludees=T.hasOccludees;O.receiveShadows=T.shadowMap.ready;O.hasScreenSpaceReflections=null!=T.ssr.lastFrameColor;O.hasCloudsReflections=null!=T.cloudsFade.data;break;case v.ShaderOutput.Alpha:O.hasOccludees=T.hasOccludees;break;case v.ShaderOutput.ObjectAndLayerIdColor:O.objectAndLayerIdColor=!0}O.snowCover=this.hasSnowCover(T)}this._technique=J.releaseAndAcquire(u.ComponentTechnique,O,
this._technique);this._setClean();return this._technique}hasSnowCover(J){return null!=J.weather&&J.weatherVisible&&"snowy"===J.weather.type&&"enabled"===J.weather.snowCover}submit(J,M,T){if(0!==this.objectOpacity){var Q=T.renderable.geometry,O=T.components;T=T.renderable.meta.cameraDepthSquared;var U=O.geometryRanges,Z=O.highlightRanges;O=O.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case H.Opaque:J.materialOpaque.submitDraw(this,Q,U,T);break;case H.Transparent:J.materialTransparent.submitDraw(this,
Q,U,T);break;case H.OpaqueAndTransparent:J.materialOpaque.submitDraw(this,Q,U,T);J.materialTransparent.submitDraw(this,Q,U,T);break;case H.IntegratedMesh:J.materialIntegratedMesh.submitDraw(this,Q,U,T),null!=M.overlay?.getTexture(h.OverlayContent.Highlight)&&J.highlightIntegratedMesh.submitDraw(this,Q,U,T)}(M=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&J.shadowMap.submitDraw(this,Q,U,T);null!=Z&&(J.highlight.submitDraw(this,Q,Z,T),M&&J.highlightShadowMap.submitDraw(this,
Q,Z,T));M&&null!=O&&J.defaultShadowMap.submitDraw(this,Q,O,T)}}_computeWhichMaterialPass(){return this.isIntegratedMesh?H.IntegratedMesh:1>this.objectOpacity?H.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?H.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===A.AlphaDiscardMode.Blend||this.alphaDiscardMode===A.AlphaDiscardMode.MaskBlend?H.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?H.Opaque:this.componentParameters.transparent===
a.ComponentParameterSummary.All?H.Transparent:H.OpaqueAndTransparent}}b.__decorate([q.parameter({vectorOps:l.vec4})],I.prototype,"baseColor",void 0);b.__decorate([q.parameter()],I.prototype,"usePBR",void 0);b.__decorate([q.parameter()],I.prototype,"hasParametersFromSource",void 0);b.__decorate([q.parameter({vectorOps:f.vec3})],I.prototype,"mrrFactors",void 0);b.__decorate([q.parameter({vectorOps:f.vec3})],I.prototype,"emissiveFactor",void 0);b.__decorate([q.parameter({dispose:!0})],I.prototype,"baseColorTexture",
void 0);b.__decorate([q.parameter({dispose:!0})],I.prototype,"metallicRoughnessTexture",void 0);b.__decorate([q.parameter({dispose:!0})],I.prototype,"emissionTexture",void 0);b.__decorate([q.parameter({dispose:!0})],I.prototype,"occlusionTexture",void 0);b.__decorate([q.parameter({dispose:!0})],I.prototype,"normalTexture",void 0);b.__decorate([q.parameter()],I.prototype,"objectOpacity",void 0);b.__decorate([q.parameterBlock()],I.prototype,"commonMaterialParameters",void 0);b.__decorate([q.parameterBlock()],
I.prototype,"componentParameters",void 0);b.__decorate([q.parameter()],I.prototype,"textureAlphaCutoff",void 0);b.__decorate([q.parameter()],I.prototype,"alphaDiscardMode",void 0);b.__decorate([q.parameter()],I.prototype,"isIntegratedMesh",void 0);b.__decorate([q.parameter()],I.prototype,"polygonOffsetEnabled",void 0);b.__decorate([q.parameter()],I.prototype,"ellipsoidMode",void 0);b.__decorate([q.parameter()],I.prototype,"hasOccludees",void 0);var H;(function(J){J[J.Opaque=0]="Opaque";J[J.Transparent=
1]="Transparent";J[J.OpaqueAndTransparent=2]="OpaqueAndTransparent";J[J.IntegratedMesh=3]="IntegratedMesh"})(H||(H={}));class B extends q.MaterialParameterBlock{constructor(){super(...arguments);this.doubleSided=!1;this.cullFace=A.CullFaceOptions.Back;this.hasSlicePlane=!0}}b.__decorate([q.parameter()],B.prototype,"doubleSided",void 0);b.__decorate([q.parameter()],B.prototype,"cullFace",void 0);b.__decorate([q.parameter()],B.prototype,"hasSlicePlane",void 0);class K extends q.MaterialParameterBlock{constructor(){super(...arguments);
this.externalColor=e.fromValues(1,1,1,1);this.externalColorMixMode=p.ColorMixModeEnum.Multiply;this.castShadows=a.ComponentParameterSummary.All}get transparent(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}get opaqueOverride(){return this.externalColorMixMode===p.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}get visible(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:
a.ComponentParameterSummary.None}get type(){return x.ComponentDataType.Uniform}}b.__decorate([q.parameter({vectorOps:l.vec4})],K.prototype,"externalColor",void 0);b.__decorate([q.parameter()],K.prototype,"externalColorMixMode",void 0);b.__decorate([q.parameter()],K.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(J){J[J.All=0]="All";J[J.Some=1]="Some";J[J.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));class L extends q.MaterialParameterBlock{constructor(){super(...arguments);
this.texture=null;this.castShadows=this.opaqueOverride=this.transparent=a.ComponentParameterSummary.None}get type(){return x.ComponentDataType.Varying}}b.__decorate([q.parameter()],L.prototype,"texture",void 0);b.__decorate([q.parameter()],L.prototype,"transparent",void 0);b.__decorate([q.parameter()],L.prototype,"opaqueOverride",void 0);b.__decorate([q.parameter()],L.prototype,"castShadows",void 0);a.CommonMaterialParameters=B;a.ComponentMaterial=I;a.ComponentParametersUniform=K;a.ComponentParametersVarying=
L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../ViewingMode ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../lib/TransparencyPassType ../../../lib/VertexAttribute ../../../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){class n extends c.ShaderTechnique{initializeConfiguration(t,v){v.spherical=t.viewingMode===g.ViewingMode.Global;v.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new p.Program(t.rctx,n.shader.get().build(this.configuration),q)}_setPipelineState(t){const v=this.configuration,r=v.integratedMeshMode!==d.IntegratedMeshMode.None,y=t===u.TransparencyPassType.NONE,z=t===u.TransparencyPassType.FrontFace;
return x.makePipelineState({blending:v.output!==m.ShaderOutput.Color&&v.output!==m.ShaderOutput.Alpha||!v.blendingEnabled?null:y?e.blendingDefault:e.oitBlending(t),culling:x.cullingParams(v.cullFace),depthTest:{func:e.oitDepthTest(t)},depthWrite:y||z?x.defaultDepthWriteParams:null,colorWrite:x.defaultColorWriteParams,stencilWrite:r||v.hasOccludees?h.stencilWriteMaskOn:null,stencilTest:r?h.replaceBitWhenDepthTestPasses(l.StencilBits.IntegratedMeshMaskExcluded):v.hasOccludees?h.stencilBaseAllZerosParams:
null,polygonOffset:y||z?v.hasPolygonOffset?{factor:2,units:2}:null:e.OITPolygonOffset})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}n.shader=new f.ReloadableShaderModule(k.ComponentShader,()=>new Promise((t,v)=>a(["./shader/ComponentShader.glsl"],t,v)));const q=new Map([[w.VertexAttribute.POSITION,0],[w.VertexAttribute.NORMAL,1],[w.VertexAttribute.NORMALCOMPRESSED,1],[w.VertexAttribute.COLOR,2],[w.VertexAttribute.UV0,3],[w.VertexAttribute.UVREGION,
4],[w.VertexAttribute.COMPONENTINDEX,5]]);b.ComponentTechnique=n;b.attributeLocations=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){a.IntegratedMeshMode=void 0;(function(n){n[n.None=0]="None";n[n.NoOverlay=1]="NoOverlay";n[n.ColorOverlay=2]="ColorOverlay";n[n.ColorOverlayWithWater=3]="ColorOverlayWithWater";n[n.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));class x extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.output=k.ShaderOutput.Color;this.textureCoordinateType=f.TextureCoordinateAttributeType.None;this.componentData=g.ComponentDataType.Uniform;
this.cullFace=u.CullFaceOptions.Back;this.vertexDiscardMode=d.VertexDiscardMode.None;this.doubleSidedMode=c.NormalsDoubleSidedMode.WindingOrder;this.alphaDiscardMode=u.AlphaDiscardMode.Opaque;this.integratedMeshMode=a.IntegratedMeshMode.None;this.transparencyPassType=w.TransparencyPassType.NONE;this.ellipsoidMode=e.EllipsoidMode.Earth;this.pbrMode=l.PBRMode.Disabled;this.normalType=m.NormalType.Attribute;this.hasColorTexture=this.hasSlicePlane=this.hasNormals=this.hasVertexColors=this.doublePrecisionRequiresObfuscation=
this.spherical=!1;this.blendingEnabled=this.receiveShadows=this.receiveAmbientOcclusion=!0;this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.hasNormalTexture=this.hasOcclusionTexture=this.hasEmissionTexture=this.hasMetallicRoughnessTexture=this.hasPolygonOffset=this.hasScreenSpaceReflections=!1;this.hasCloudsReflections=!0;this.objectAndLayerIdColor=this.snowCover=!1}}b.__decorate([h.parameter({count:k.ShaderOutput.COUNT})],x.prototype,"output",void 0);b.__decorate([h.parameter({count:f.TextureCoordinateAttributeType.COUNT})],
x.prototype,"textureCoordinateType",void 0);b.__decorate([h.parameter({count:g.ComponentDataType.COUNT})],x.prototype,"componentData",void 0);b.__decorate([h.parameter({count:u.CullFaceOptions.COUNT})],x.prototype,"cullFace",void 0);b.__decorate([h.parameter({count:d.VertexDiscardMode.COUNT})],x.prototype,"vertexDiscardMode",void 0);b.__decorate([h.parameter({count:c.NormalsDoubleSidedMode.COUNT})],x.prototype,"doubleSidedMode",void 0);b.__decorate([h.parameter({count:u.AlphaDiscardMode.COUNT})],
x.prototype,"alphaDiscardMode",void 0);b.__decorate([h.parameter({count:a.IntegratedMeshMode.COUNT})],x.prototype,"integratedMeshMode",void 0);b.__decorate([h.parameter({count:w.TransparencyPassType.COUNT})],x.prototype,"transparencyPassType",void 0);b.__decorate([h.parameter({count:e.EllipsoidMode.COUNT})],x.prototype,"ellipsoidMode",void 0);b.__decorate([h.parameter({count:l.PBRMode.COUNT})],x.prototype,"pbrMode",void 0);b.__decorate([h.parameter({count:m.NormalType.COUNT})],x.prototype,"normalType",
void 0);b.__decorate([h.parameter()],x.prototype,"spherical",void 0);b.__decorate([h.parameter()],x.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([h.parameter()],x.prototype,"hasVertexColors",void 0);b.__decorate([h.parameter()],x.prototype,"hasNormals",void 0);b.__decorate([h.parameter()],x.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],x.prototype,"hasColorTexture",void 0);b.__decorate([h.parameter()],x.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([h.parameter()],
x.prototype,"receiveShadows",void 0);b.__decorate([h.parameter()],x.prototype,"blendingEnabled",void 0);b.__decorate([h.parameter()],x.prototype,"hasScreenSpaceReflections",void 0);b.__decorate([h.parameter()],x.prototype,"hasPolygonOffset",void 0);b.__decorate([h.parameter()],x.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([h.parameter()],x.prototype,"hasEmissionTexture",void 0);b.__decorate([h.parameter()],x.prototype,"hasOcclusionTexture",void 0);b.__decorate([h.parameter()],x.prototype,
"hasNormalTexture",void 0);b.__decorate([h.parameter()],x.prototype,"hasOccludees",void 0);b.__decorate([h.parameter()],x.prototype,"multipassEnabled",void 0);b.__decorate([h.parameter()],x.prototype,"cullAboveGround",void 0);b.__decorate([h.parameter()],x.prototype,"hasCloudsReflections",void 0);b.__decorate([h.parameter()],x.prototype,"snowCover",void 0);b.__decorate([h.parameter()],x.prototype,"objectAndLayerIdColor",void 0);b.__decorate([h.parameter({constValue:!1})],x.prototype,"occlusionPass",
void 0);b.__decorate([h.parameter({constValue:p.BindType.Draw})],x.prototype,"pbrTextureBindType",void 0);b.__decorate([h.parameter({constValue:!0})],x.prototype,"hasSliceHighlight",void 0);b.__decorate([h.parameter({constValue:!1})],x.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([h.parameter({constValue:!1})],x.prototype,"useCustomDTRExponentForWater",void 0);b.__decorate([h.parameter({constValue:!1})],x.prototype,"hasVertexTangents",void 0);b.__decorate([h.parameter({constValue:!0})],
x.prototype,"supportsTextureAtlas",void 0);b.__decorate([h.parameter({constValue:!1})],x.prototype,"highStepCount",void 0);b.__decorate([h.parameter({constValue:!1})],x.prototype,"instancedDoublePrecision",void 0);b.__decorate([h.parameter({constValue:!1})],x.prototype,"hasModelTransformation",void 0);b.__decorate([h.parameter({constValue:!0})],x.prototype,"useFillLights",void 0);b.__decorate([h.parameter({constValue:!1})],x.prototype,"objectAndLayerIdColorInstanced",void 0);a.ComponentTechniqueConfiguration=
x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ../../../../../../../core/has ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){function u(n,q){const {vertex:t,fragment:v}=n;t.include(f.RgbaFloatEncoding);t.uniforms.add(new p.Texture2DDrawUniform("componentColorTex",r=>r.componentParameters.texture.texture));n.attributes.add(h.VertexAttribute.COMPONENTINDEX,"float");n.varyings.add("vExternalColorMixMode","mediump float");n.varyings.add("vExternalColor","vec4");(q=q.output===m.ShaderOutput.ObjectAndLayerIdColor)&&n.varyings.add("vObjectAndLayerIdColor","vec4");n.include(k.DecodeSymbolColor);
t.constants.add("elevationScale","float",2*x);t.constants.add("stride","float",d("enable-feature:objectAndLayerId-rendering")?3:2);t.code.add(e.glsl`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`);t.code.add(e.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${q?e.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:e.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);v.code.add(e.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${q?e.glsl`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function w(n){const {vertex:q,fragment:t}=n;q.uniforms.add(new c.Float4DrawUniform("externalColor",v=>v.componentParameters.externalColor));t.uniforms.add(new l.IntegerDrawUniform("externalColorMixMode",v=>v.componentParameters.externalColorMixMode));n.varyings.add("vExternalColor","vec4");q.code.add(e.glsl`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);t.code.add(e.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}a.ComponentDataType=void 0;(function(n){n[n.Uniform=0]="Uniform";n[n.Varying=1]="Varying";n[n.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const x=2**32/1E4;a.ComponentData=function(n,q){switch(q.componentData){case a.ComponentDataType.Varying:return u(n,q);case a.ComponentDataType.Uniform:return w(n);case a.ComponentDataType.COUNT:break;default:b.neverReached(q.componentData)}};a.encodeElevationOffset=function(n,q){g.packFloatRGBA(n/x*.5+.5,q)};a.maxElevationOffset=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,g){class d extends b.Uniform{constructor(k,m){super(k,"int",g.BindType.Draw,(f,c,l)=>f.setUniform1i(k,m(c,l)))}}a.IntegerDrawUniform=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports",
"../../../../../../../core/compilerUtils","../../../../core/shaderModules/interfaces"],function(a,b,g){a.VertexDiscardMode=void 0;(function(d){d[d.None=0]="None";d[d.Transparent=1]="Transparent";d[d.Opaque=2]="Opaque";d[d.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(d,k){d=d.vertex;d.code.add(g.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(k.vertexDiscardMode){case a.VertexDiscardMode.None:d.code.add(g.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);
break;case a.VertexDiscardMode.Opaque:d.code.add(g.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.Transparent:d.code.add(g.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.COUNT:break;default:b.neverReached(k.vertexDiscardMode)}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(g){g[g.Earth=1]="Earth";g[g.Mars=2]="Mars";g[g.Moon=3]="Moon";g[g.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(g){return g&&b.isMars(g)?a.EllipsoidMode.Mars:g&&b.isMoon(g)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J){function M(Q){const O=new K.ShaderBuilder;O.include(w.VertexPosition,Q);O.include(u.VertexNormal,Q);O.include(h.VertexColor,Q);O.include(p.TextureCoordinateAttribute,Q);O.include(f.ForwardLinearDepth,Q);O.include(k.ComponentData,Q);O.include(I.DiscardOrAdjustAlphaDraw,Q);O.include(l.SlicePass,Q);O.include(E.ReadBaseColorTexture,Q);O.include(m.VertexDiscardByOpacity,Q);const {vertex:U,fragment:Z}=O;if(Q.pbrMode===C.PBRMode.Normal||
Q.pbrMode===C.PBRMode.Schematic)O.include(C.PhysicallyBasedRenderingParameters,Q),Q.hasNormalTexture&&O.include(v.ComputeNormalTexture,Q);const P=Q.output===c.ShaderOutput.Shadow||Q.output===c.ShaderOutput.ShadowHighlight||Q.output===c.ShaderOutput.ShadowExcludeHighlight;P&&Q.componentData===k.ComponentDataType.Varying?U.code.add(B.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):U.code.add(B.glsl`#define discardShadows(castShadows) {}`);
const R=Q.integratedMeshMode===d.IntegratedMeshMode.ColorOverlay||Q.integratedMeshMode===d.IntegratedMeshMode.ColorOverlayWithWater,W=R&&Q.output===c.ShaderOutput.Color&&Q.pbrMode===C.PBRMode.WaterOnIntegratedMesh;R&&(O.include(y.EvaluateSceneLighting,Q),O.include(F.OverlayIM,Q),Q.spherical?U.code.add(B.glsl`
      const float invEllipsoidRadius = ${B.glsl.float(1/(Q.ellipsoidMode===H.EllipsoidMode.Earth?b.earth.radius:Q.ellipsoidMode===H.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):U.code.add(B.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));W&&(O.varyings.add("tbnTangent","vec3"),O.varyings.add("tbnBiTangent","vec3"),O.varyings.add("groundNormal","vec3"));U.code.add(B.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${Q.output===c.ShaderOutput.ObjectAndLayerIdColor?B.glsl`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${B.glsl.float(G.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${Q.output===c.ShaderOutput.ObjectAndLayerIdColor?B.glsl`forwardObjectAndLayerIdColor();`:""}
      ${W?Q.spherical?B.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:B.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${R?B.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);Q.output===c.ShaderOutput.Alpha&&(Z.include(q.ReadLinearDepth),O.include(D.multipassTerrainTest,Q),O.include(t.ComputeMaterialColor,Q),R&&Z.uniforms.add(new L.Texture2DPassUniform("ovColorTex",(N,V)=>F.getIMColorTexture(N,V))),Z.code.add(B.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${Q.multipassEnabled?B.glsl`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${R?B.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `));Q.output===c.ShaderOutput.Color&&(Z.include(q.ReadLinearDepth),O.include(D.multipassTerrainTest,Q),O.include(t.ComputeMaterialColor,Q),O.include(r.ComputeShadingNormal,Q),O.include(y.EvaluateSceneLighting,Q),Q.receiveShadows?(O.include(A.ReadShadowMapPass,Q),Z.code.add(B.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):Z.code.add(B.glsl`float evaluateShadow() { return 0.0; }`),R&&Z.uniforms.add(new L.Texture2DPassUniform("ovColorTex",(N,V)=>F.getIMColorTexture(N,V))),Z.code.add(B.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${Q.multipassEnabled?B.glsl`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${R?B.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),Q.pbrMode===C.PBRMode.Normal||Q.pbrMode===C.PBRMode.Schematic?(z.addMainLightIntensity(Z),Z.code.add(B.glsl`
        ${Q.pbrMode===C.PBRMode.Normal?B.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),Q.hasNormalTexture?Z.code.add(B.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):Z.code.add(B.glsl`vec3 shadingNormal = normalVertex;`),Z.code.add(B.glsl`${Q.spherical?B.glsl`vec3 normalGround = normalize(positionWorld());`:B.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),Z.code.add(B.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();

        ${Q.snowCover?B.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${R?B.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(Q.receiveShadows?Z.code.add(B.glsl`float shadow = evaluateShadow();`):Q.spherical?(y.addLightingGlobalFactor(Z),Z.code.add(B.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):Z.code.add(B.glsl`float shadow = 0.0;`),W&&Z.uniforms.add(new L.Texture2DPassUniform("ovNormalTex",(N,V)=>V.overlay?.getTexture(g.OverlayContent.WaterNormal))),Q.snowCover&&Z.code.add(B.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),Z.code.add(B.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${R?B.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${W?B.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),Z.code.add(B.glsl`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${Q.transparencyPassType===J.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `));if(Q.output===c.ShaderOutput.Depth||P)O.include(x.OutputDepth,Q),Z.code.add(B.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);Q.output===c.ShaderOutput.Normal&&(O.include(r.ComputeShadingNormal,Q),Z.code.add(B.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${Q.normalType===e.NormalType.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));Q.output===c.ShaderOutput.ObjectAndLayerIdColor&&O.fragment.code.add(B.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${R?B.glsl`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `);Q.output===c.ShaderOutput.Highlight&&(O.include(n.OutputHighlight),Z.code.add(B.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${R?B.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return O}const T=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}));a.ComponentShader=T;a.build=M})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),function(a,b,g,d,k,m){a.ComputeMaterialColor=function(f,
c){f.include(b.VertexColor,c);f.fragment.include(g.MixExternalColor);f=f.fragment;f.uniforms.add(new d.Float4DrawUniform("baseColor",l=>l.baseColor));f.uniforms.add(new k.FloatDrawUniform("objectOpacity",l=>l.objectOpacity));c.hasVertexColors?f.code.add(m.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):f.code.add(m.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);f.code.add(m.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,g,d,k,m,f){a.ComputeShadingNormal=function(c,l){const e=c.fragment;switch(l.doubleSidedMode){case m.NormalsDoubleSidedMode.None:e.code.add(f.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case m.NormalsDoubleSidedMode.View:c.include(k.VertexPosition,l);e.code.add(f.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case m.NormalsDoubleSidedMode.WindingOrder:e.code.add(f.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(l.doubleSidedMode);case m.NormalsDoubleSidedMode.COUNT:}switch(l.normalType){case g.NormalType.Attribute:case g.NormalType.Compressed:c.include(d.VertexNormal,l);e.code.add(f.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case g.NormalType.ScreenDerivative:c.include(k.VertexPosition,l);e.code.add(f.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case g.NormalType.Ground:l.spherical?(c.include(k.VertexPosition,l),e.code.add(f.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):e.code.add(f.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);e.code.add(f.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(l.normalType);case g.NormalType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../../lib/basicInterfaces".split(" "),function(a,
b,g,d,k,m,f,c){a.ReadBaseColorTexture=function(l,e){const p=l.fragment;!e.hasColorTexture||e.output!==b.ShaderOutput.Color&&e.alphaDiscardMode===c.AlphaDiscardMode.Opaque?p.code.add(m.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`):(l.include(d.VertexTextureCoordinates,e),e=e.textureCoordinateType===g.TextureCoordinateAttributeType.Atlas,p.uniforms.add(new f.Texture2DDrawUniform("baseColorTexture",h=>h.texture)),e?(l.include(k.TextureAtlasLookup),p.code.add(m.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):p.code.add(m.glsl`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../shaderModules/interfaces"],function(a,b){class g extends b.NoParameters{constructor(){super(...arguments);this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1;if(null!=this._parameterBlocks)for(const k of this._parameterBlocks)this[k]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==
this._parameterBlocks)return!1;for(const k of this._parameterBlocks)if(this[k].dirty)return!0;return!1}}class d{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}a.MaterialBase=g;a.MaterialParameterBlock=d;a.parameter=function(k={}){return(m,f)=>{const c=m._parameterCount??0;m._parameterCount=c+1;if(k.vectorOps){const l=k.vectorOps;Object.defineProperty(m,f,{get(){return this[c]},set(e){const p=this[c];if(null==p)this[c]=e;else{if(l.equals(p,
e))return;l.copy(p,e)}this._setDirty()}})}else Object.defineProperty(m,f,{get(){return this[c]},set(l){this[c]!==l&&(k.dispose&&this[c]&&this[c].dispose(),this[c]=l,this._setDirty())}})}};a.parameterBlock=function(){return(k,m)=>{const f=k._parameterCount??0;k._parameterCount=f+1;k._parameterBlocks=k._parameterBlocks||[];k._parameterBlocks.push(f);Object.defineProperty(k,m,{get(){return this[f]},set(c){this[f]!==c&&(this[f]=c,this._setDirty())}})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],function(a,b,g,d){class k{constructor(f){this._low=d.create();this._high=d.create();f&&this.set(f)}get low(){return this._low}get high(){return this._high}set(f){b.copy(this._low,b.copy(m,f));f=b.sub(m,f,this._low);b.copy(this._high,f)}get(f){return b.add(f,this._low,this._high)}getLowScaled(f){return b.scale(f,this._low,
1)}}const m=g.create();a.TwoVectorPosition=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,g,d){const k=g.newLayout().vec3f(d.VertexAttribute.POSITION).u16(d.VertexAttribute.COMPONENTINDEX),m=g.newLayout().vec2u8(d.VertexAttribute.SIDENESS);b=b.glLayout(m);const f=g.newLayout().vec3f(d.VertexAttribute.POSITION0).vec3f(d.VertexAttribute.POSITION1).vec3f(d.VertexAttribute.NORMAL).u16(d.VertexAttribute.COMPONENTINDEX).u8(d.VertexAttribute.VARIANTOFFSET,
{glNormalized:!0}).u8(d.VertexAttribute.VARIANTSTROKE).u8(d.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0});g=g.newLayout().vec3f(d.VertexAttribute.POSITION0).vec3f(d.VertexAttribute.POSITION1).vec3f(d.VertexAttribute.NORMALA).vec3f(d.VertexAttribute.NORMALB).u16(d.VertexAttribute.COMPONENTINDEX).u8(d.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(d.VertexAttribute.VARIANTSTROKE).u8(d.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0});d=new Map([[d.VertexAttribute.POSITION0,0],[d.VertexAttribute.POSITION1,
1],[d.VertexAttribute.COMPONENTINDEX,2],[d.VertexAttribute.VARIANTOFFSET,3],[d.VertexAttribute.VARIANTSTROKE,4],[d.VertexAttribute.VARIANTEXTENSION,5],[d.VertexAttribute.NORMAL,6],[d.VertexAttribute.NORMALA,6],[d.VertexAttribute.NORMALB,7],[d.VertexAttribute.SIDENESS,8]]);a.EdgeInputBufferLayout=k;a.EdgeShaderAttributeLocations=d;a.RegularEdgeInstancesLayout=f;a.SilhouetteEdgeInstancesLayout=g;a.VertexLayout=m;a.glVertexLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing":function(){define("exports ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(a,b,g,d,k,m,f,c){function l(u,w,x,n){if(w)return w=g.computeNeighbors(x,n,u.count),new e(x,n,w,u);u=b.deduplicate(u.buffer,u.stride/4,{originalIndices:x,originalIndicesLength:n});n=g.computeNeighbors(u.indices,n,u.uniqueCount);return{faces:u.indices,facesLength:u.indices.length,neighbors:n,vertices:m.EdgeInputBufferLayout.createView(u.buffer)}}class e{constructor(u,w,x,n){this.faces=u;this.facesLength=w;this.neighbors=x;this.vertices=n}}const p=new f.RegularEdgeBufferWriter,h=new f.SilhouetteEdgeBufferWriter;
f=d.newLayout().vec3f(k.VertexAttribute.POSITION0).vec3f(k.VertexAttribute.POSITION1);d=d.newLayout().vec3f(k.VertexAttribute.POSITION0).vec3f(k.VertexAttribute.POSITION1).u16(k.VertexAttribute.COMPONENTINDEX);a.extract=function(u){const w=l(u.data,u.skipDeduplicate,u.indices,u.indicesLength);p.updateSettings(u.writerSettings);h.updateSettings(u.writerSettings);return c.extractEdges(w,p,h)};a.extractComponentsEdgeLocationsLayout=d;a.extractEdgeInformation=l;a.extractEdgeLocationsLayout=f;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(b,g,d){g/=3;const k=new Uint32Array(d+1),m=new Uint32Array(d+1);var f=(n,q)=>{n<q?k[n+1]++:m[q+1]++};for(var c=0;c<g;c++){var l=b[3*c],e=b[3*c+1],p=b[3*c+2];f(l,e);f(e,p);f(p,l)}c=f=0;for(l=0;l<d;l++)e=k[l+1],p=m[l+1],k[l+1]=f,m[l+1]=c,f+=e,c+=p;const h=new Uint32Array(6*g),u=k[d];f=(n,q,t)=>{n<q?(n=k[n+1]++,h[2*n]=q,h[2*n+1]=t):(q=m[q+1]++,h[2*u+2*q]=
n,h[2*u+2*q+1]=t)};for(c=0;c<g;c++)l=b[3*c],e=b[3*c+1],p=b[3*c+2],f(l,e,c),f(e,p,c),f(p,l,c);f=(n,q)=>{const t=2*n;n=q-n;for(q=1;q<n;q++){const v=h[t+2*q],r=h[t+2*q+1];let y=q-1;for(y;0<=y&&h[t+2*y]>v;y--)h[t+2*y+2]=h[t+2*y],h[t+2*y+3]=h[t+2*y+1];h[t+2*y+2]=v;h[t+2*y+3]=r}};for(c=0;c<d;c++)f(k[c],k[c+1]),f(u+m[c],u+m[c+1]);const w=new Int32Array(3*g),x=(n,q)=>n===b[3*q]?0:n===b[3*q+1]?1:n===b[3*q+2]?2:-1;g=(n,q)=>{n=x(n,q);w[3*q+n]=-1};f=(n,q,t,v)=>{n=x(n,q);w[3*q+n]=v;t=x(t,v);w[3*v+t]=q};for(c=
0;c<d;c++){l=k[c];e=k[c+1];p=m[c];const n=m[c+1];for(;l<e&&p<n;){const q=h[2*l],t=h[2*u+2*p];q===t?(f(c,h[2*l+1],t,h[2*u+2*p+1]),l++,p++):q<t?(g(c,h[2*l+1]),l++):(g(t,h[2*u+2*p+1]),p++)}for(;l<e;)g(c,h[2*l+1]),l++;for(;p<n;)g(h[2*u+2*p],h[2*u+2*p+1]),p++}return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(a,b,g,d,k,m){function f(t){const v=p;v[0]=t.position0[0];v[1]=t.position0[1];v[2]=t.position0[2];v[3]=t.position1[0];v[4]=t.position1[1];v[5]=t.position1[2];u[0]=5381;for(t=0;t<h.length;t++)u[0]=31*u[0]+h[t];return u[0]}function c(t){const v=p;v[0]=l(t.position0[0]);v[1]=l(t.position0[1]);v[2]=l(t.position0[2]);v[3]=l(t.position1[0]);v[4]=l(t.position1[1]);v[5]=l(t.position1[2]);u[0]=5381;for(t=0;t<h.length;t++)u[0]=31*u[0]+h[t];return u[0]}function l(t){return Math.round(1E4*t)/1E4}class e{updateSettings(t){this.settings=
t;this._edgeHashFunction=t.reducedPrecision?c:f}write(t,v,r){var y=this._edgeHashFunction(r);q.seed=y;y=q.getIntRange(0,255);const z=q.getIntRange(0,this.settings.variants-1);var D=q.getFloat();D=-(1-Math.min(D/.7,1))+Math.max(0,D-.7)/(1-.7);D=255*(Math.abs(D)**1.2*(0>D?-1:1)*.5+.5);t.position0.setVec(v,r.position0);t.position1.setVec(v,r.position1);t.componentIndex.set(v,r.componentIndex);t.variantOffset.set(v,y);t.variantStroke.set(v,z);t.variantExtension.set(v,D)}trim(t,v){return t.slice(0,v)}}
const p=new Float32Array(6),h=new Uint32Array(p.buffer),u=new Uint32Array(1);class w{constructor(){this._commonWriter=new e}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return m.RegularEdgeInstancesLayout.createBuffer(t)}write(t,v,r){this._commonWriter.write(t,v,r);g.add(n,r.faceNormal0,r.faceNormal1);g.normalize(n,n);t.normal.setVec(v,n)}trim(t,v){return this._commonWriter.trim(t,v)}}w.Layout=m.RegularEdgeInstancesLayout;w.glLayout=k.glLayout(m.RegularEdgeInstancesLayout,1);
class x{constructor(){this._commonWriter=new e}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return m.SilhouetteEdgeInstancesLayout.createBuffer(t)}write(t,v,r){this._commonWriter.write(t,v,r);t.normalA.setVec(v,r.faceNormal0);t.normalB.setVec(v,r.faceNormal1)}trim(t,v){return this._commonWriter.trim(t,v)}}x.Layout=m.SilhouetteEdgeInstancesLayout;x.glLayout=k.glLayout(m.SilhouetteEdgeInstancesLayout,1);const n=d.create(),q=new b;a.CommonBufferWriter=e;a.RegularEdgeBufferWriter=
w;a.SilhouetteEdgeBufferWriter=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec3","../../../../../chunks/vec3f64"],function(a,b,g,d,k){function m(h,u){const w=g.acosClamped(h.cosAngle),x=l.fwd,n=l.ortho;d.direction(x,h.position1,h.position0);h=0<d.dot(d.cross(n,h.faceNormal0,h.faceNormal1),x)?-1:1;
return w*h>u}function f(h){const u=h.faces.length/3,w=h.faces;h=h.neighbors;var x=0;for(var n=0;n<u;n++){var q=h[3*n+1],t=h[3*n+2],v=w[3*n],r=w[3*n+1],y=w[3*n+2];x+=-1===h[3*n]||v<r?1:0;x+=-1===q||r<y?1:0;x+=-1===t||y<v?1:0}x=new Int32Array(4*x);n=0;for(q=0;q<u;q++){t=h[3*q];v=h[3*q+1];r=h[3*q+2];y=w[3*q];const z=w[3*q+1],D=w[3*q+2];if(-1===t||y<z)x[n++]=y,x[n++]=z,x[n++]=q,x[n++]=t;if(-1===v||z<D)x[n++]=z,x[n++]=D,x[n++]=q,x[n++]=v;if(-1===r||D<y)x[n++]=D,x[n++]=y,x[n++]=q,x[n++]=r}return x}function c(h){const u=
h.faces.length/3,w=h.vertices.position;h=h.faces;const x=e.v0,n=e.v1,q=e.v2,t=new Float32Array(3*u);for(let v=0;v<u;v++){const r=h[3*v+1],y=h[3*v+2];w.getVec(h[3*v],x);w.getVec(r,n);w.getVec(y,q);d.subtract(n,n,x);d.subtract(q,q,x);d.cross(x,n,q);d.normalize(x,x);t[3*v]=x[0];t[3*v+1]=x[1];t[3*v+2]=x[2]}return t}a.EdgeType=void 0;(function(h){h[h.SOLID=0]="SOLID";h[h.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const l={edge:{position0:k.create(),position1:k.create(),faceNormal0:k.create(),faceNormal1:k.create(),
componentIndex:0,cosAngle:0},ortho:k.create(),fwd:k.create()},e={v0:k.create(),v1:k.create(),v2:k.create()},p={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(h,u,w,x=p){const n=h.vertices.position;var q=h.vertices.componentIndex,t=g.deg2rad(x.anglePlanar);x=g.deg2rad(x.angleSignificantEdge);const v=Math.cos(x),r=Math.cos(t),y=l.edge,z=y.position0,D=y.position1,C=y.faceNormal0,E=y.faceNormal1,A=c(h),F=f(h),G=F.length/4;h=u.allocate(G);x=0;const I=w.allocate(G);let H=0,B=0,K=0;const L=
b.range(0,G),J=new Float32Array(G);J.forEach((O,U,Z)=>{n.getVec(F[4*U],z);n.getVec(F[4*U+1],D);Z[U]=d.distance(z,D)});L.sort((O,U)=>J[U]-J[O]);const M=[],T=[];for(let O=0;O<G;O++){var Q=L[O];const U=J[Q],Z=F[4*Q],P=F[4*Q+1],R=F[4*Q+2];Q=F[4*Q+3];const W=-1===Q;n.getVec(Z,z);n.getVec(P,D);if(W)d.set(C,A[3*R],A[3*R+1],A[3*R+2]),d.copy(E,C),y.componentIndex=q.get(Z),y.cosAngle=d.dot(C,E);else{d.set(C,A[3*R],A[3*R+1],A[3*R+2]);d.set(E,A[3*Q],A[3*Q+1],A[3*Q+2]);y.componentIndex=q.get(Z);y.cosAngle=d.dot(C,
E);if(y.cosAngle>r)continue;-.9999>y.cosAngle&&d.copy(E,C)}B+=U;K++;W||y.cosAngle<v?(u.write(h,x++,y),M.push(U)):m(y,t)&&(w.write(I,H++,y),T.push(U))}q=new Float32Array(M.reverse());t=new Float32Array(T.reverse());return{regular:{instancesData:u.trim(h,x),lodInfo:{lengths:q}},silhouette:{instancesData:w.trim(I,H),lodInfo:{lengths:t}},averageEdgeLength:B/K}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports",
"./ManagedTextureBackedBuffer"],function(a,b){class g{constructor(d,k=1){this._rctx=d;this._fieldCount=k;this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(d=>0===d.activeCount?(d.dispose(),!1):!0)}destroy(){this._buffers.forEach(d=>d.dispose());this._buffers=[]}getBuffer(d){for(const k of this._buffers)if(k.availableCount>=d)return k;if(d>b.maxIndexCount)return null;d=new b.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(d);return d}updateTextures(){for(const d of this._buffers)d.textureBuffer.updateTexture()}}
a.BufferManager=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,g){class d{constructor(k,m=1){this.textureBuffer=new g.TextureBackedBuffer(k,m);this._indexManager=new b.SimpleIndexManager(65536)}dispose(){this.textureBuffer.dispose();this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const k=
this._indexManager.acquire();this.textureBuffer.resizeToFit(k);return k}releaseIndex(k){this._indexManager.release(k)}}a.ManagedTextureBackedBuffer=d;a.maxIndexCount=65536;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports"],function(a){class b{constructor(g){this._maxCount=g;this._nextIndex=0;this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+
this._maxCount-this._nextIndex}acquire(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++}release(g){this._recycledIndices.push(g)}}a.SimpleIndexManager=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],
function(a,b,g,d,k){class m{constructor(f,c=1){this._rctx=f;this._fieldCount=c;this.textureWidth=4096;this._dirty=!0;f=new k.TextureDescriptor(this.textureWidth,1);f.samplingMode=g.TextureSamplingMode.NEAREST;f.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;this._texture=new d.Texture(this._rctx,f);this._data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose();this._data=this._texture=void 0}setData(f,c,l,e,p,h){f=f*this._fieldCount+c;this._dirty=!0;this._data.set(f,
0,l);this._data.set(f,1,e);this._data.set(f,2,p);this._data.set(f,3,h)}setDataElement(f,c,l,e){f=f*this._fieldCount+c;this._dirty=!0;this._data.set(f,l,e)}getDataElement(f,c,l){f=f*this._fieldCount+c;this._dirty=!0;return this._data.get(f,l)}resizeToFit(f){f=(f+1)*this._fieldCount;f>this._data.count&&(f=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil(f/this.textureWidth)*this.textureWidth*4)),f.typedBuffer.set(this._data.typedBuffer),this._data=f)}updateTexture(){if(this._dirty){var f=this._texture.descriptor.width;
this._data.count>f*this._texture.descriptor.height&&this._texture.resize(f,this._data.count/f);this._texture.setData(this._data.typedBuffer);this._dirty=!1}}get texture(){return this._texture}}a.TextureBackedBuffer=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../../chunks/HUDCompositing.glsl ../shaders/HUDCompositingTechnique ../../../../chunks/OITCompositing.glsl ../shaders/OITCompositingTechnique".split(" "),
function(a,b,g,d,k,m,f){class c{constructor(l,e){this._rctx=l;this._techniqueRepository=e;this._configuration=new g.CompositingTechniqueConfiguration;this._passParameters=new a.CompositingPassParameters;this._oitParameters=new m.OITCompositingPassParameters;this._hudParameters=new d.HUDCompositingPassParameters}compositeOIT(l,e,p,h){this._oitParameters.colorTexture=e;this._oitParameters.alphaTexture=p;this._oitParameters.frontFaceTexture=h;e=this._techniqueRepository.acquire(f.OITCompositingTechnique);
this._rctx.bindTechnique(e,this._oitParameters,l);this._rctx.screen.draw();e.release()}compositeHUD(l,e){this._hudParameters.texture=e;e=this._techniqueRepository.acquire(k.HUDCompositingTechnique);this._rctx.bindTechnique(e,this._hudParameters,l);this._rctx.screen.draw();e.release()}composite(l,e,p=g.AlphaMode.None,h=1){this._configuration.alphaMode=p;this._configuration.hasOpacityFactor=1!==h;this._passParameters.texture=e;this._passParameters.opacity=h;e=this._techniqueRepository.acquire(b.CompositingTechnique,
this._configuration);this._rctx.bindTechnique(e,this._passParameters,l);this._rctx.screen.draw();e.release()}}return c})},"esri/chunks/Compositing.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,
b,g,d,k,m){function f(e){const p=new k.ShaderBuilder;p.include(b.ScreenSpacePass);p.fragment.uniforms.add(new m.Texture2DPassUniform("tex",h=>h.texture));e.hasOpacityFactor&&p.fragment.uniforms.add(new g.FloatPassUniform("opacity",h=>h.opacity));p.fragment.code.add(d.glsl`
    void main() {
      fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};
    }`);return p}class c extends d.NoParameters{constructor(){super(...arguments);this.opacity=1}}const l=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:c,build:f},Symbol.toStringTag,{value:"Module"}));a.Compositing=l;a.CompositingPassParameters=c;a.build=f})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends d.ShaderTechnique{initializeProgram(h){return new m.Program(h.rctx,p.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){switch(this.configuration.alphaMode){case c.AlphaMode.None:return e.makePipelineState({colorWrite:e.defaultColorWriteParams});case c.AlphaMode.Alpha:return e.makePipelineState({blending:e.separateBlendingParams(l.BlendFactor.SRC_ALPHA,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),
colorWrite:e.defaultColorWriteParams});case c.AlphaMode.PremultipliedAlpha:case c.AlphaMode.COUNT:return e.makePipelineState({blending:e.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams})}}}p.shader=new g.ReloadableShaderModule(f.Compositing,()=>new Promise((h,u)=>a(["./Compositing.glsl"],h,u)));b.CompositingTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,g){a.AlphaMode=void 0;(function(k){k[k.None=0]="None";k[k.Alpha=1]="Alpha";k[k.PremultipliedAlpha=2]="PremultipliedAlpha";k[k.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));class d extends g.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.alphaMode=a.AlphaMode.None;this.hasOpacityFactor=!1}}b.__decorate([g.parameter({count:a.AlphaMode.COUNT})],d.prototype,"alphaMode",void 0);
b.__decorate([g.parameter()],d.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,g,d,
k){function m(){const l=new d.ShaderBuilder;l.include(b.ScreenSpacePass);l.fragment.uniforms.add(new k.Texture2DPassUniform("tex",e=>e.texture));l.fragment.code.add(g.glsl`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`);return l}class f extends g.NoParameters{}const c=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:f,build:m},Symbol.toStringTag,{value:"Module"}));a.HUDCompositing=c;a.HUDCompositingPassParameters=f;a.build=m})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c){class l extends d.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,l.shader.get().build(),k.Default3D)}initializePipeline(){return c.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}l.shader=new g.ReloadableShaderModule(f.HUDCompositing,()=>new Promise((e,p)=>a(["./HUDCompositing.glsl"],e,p)));b.HUDCompositingTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OITCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,g,d,k){function m(){const l=new d.ShaderBuilder;l.include(b.ScreenSpacePass);l.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",e=>e.colorTexture),new k.Texture2DPassUniform("alphaTexture",e=>e.alphaTexture),new k.Texture2DPassUniform("frontFaceTexture",e=>e.frontFaceTexture));l.fragment.code.add(g.glsl`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);return l}class f extends g.NoParameters{}const c=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:f,build:m},Symbol.toStringTag,{value:"Module"}));a.OITCompositing=c;a.OITCompositingPassParameters=f;a.build=m})},"esri/views/3d/webgl-engine/shaders/OITCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OITCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l){class e extends d.ShaderTechnique{initializeProgram(p){return new m.Program(p.rctx,e.shader.get().build(),k.Default3D)}initializePipeline(){return l.makePipelineState({blending:l.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:l.defaultColorWriteParams})}}e.shader=new g.ReloadableShaderModule(f.OITCompositing,()=>new Promise((p,h)=>a(["./OITCompositing.glsl"],p,h)));b.OITCompositingTechnique=
e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../core/floatRGBA ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(B,
K){if(K.visible){var L=h.empty(),J=K.getSpatialQueryAccelerator();J?n(L,B,J):q(L,B,K.objects);return L}}function n(B,K,L){var J=K.eye;const M=K.viewForward,T=K.frustum,Q=U=>U.visible;var O=L.objectCount;500>O?(h.set(F,K.near,Math.min(B.near,K.far)),L.forEachInDepthRange(J,M,u.DepthOrder.FRONT_TO_BACK,F,(U,Z)=>{t(B,K,U);F.far=B.near;Z.setRange(F)},T,Q),h.set(F,Math.max(B.far,K.near),K.far),L.forEachInDepthRange(J,M,u.DepthOrder.BACK_TO_FRONT,F,(U,Z)=>{t(B,K,U);F.near=B.far;Z.setRange(F)},T,Q)):(O=
Math.max(Math.min(O,500),Math.ceil(.1*O)),J=L.findClosest(M,u.DepthOrder.FRONT_TO_BACK,T,Q,O),L=L.findClosest(M,u.DepthOrder.BACK_TO_FRONT,T,Q,O),J&&L&&(r(B,K,J.boundingVolumeWorldSpace.bounds),r(B,K,L.boundingVolumeWorldSpace.bounds)))}function q(B,K,L){G.clear();L.forAll(J=>{J.visible&&0!==J.geometries.length&&G.add(J)});G.empty||(G.sort(K),h.set(F,K.near,Math.min(B.near,K.far)),G.forEachInDepthRange(F,u.DepthOrder.FRONT_TO_BACK,(J,M)=>{M<B.near&&t(B,K,J)}),h.set(F,Math.max(B.far,K.near),K.far),
G.forEachInDepthRange(F,u.DepthOrder.BACK_TO_FRONT,(J,M,T)=>{B.far=Math.max(B.far,T)}))}function t(B,K,L){if(L.visible&&l.intersectsSphere(K.frustum,L.boundingVolumeWorldSpace.bounds)){var J=L.transformation,M=A;L.geometries.forEach(T=>{d.multiply(M,J,T.transformation);const Q=p.maxScale(M);v(B,K,T.boundingInfo,M,Q)})}}function v(B,K,L,J,M){if(null!=L){m.transformMat4(E,L.center,J);var {eye:T,viewForward:Q}=K,O=Q[0]*(E[0]-T[0])+Q[1]*(E[1]-T[1])+Q[2]*(E[2]-T[2]);E[3]=L.radius*M;if(!(O-E[3]>B.near&&
O+E[3]<B.far)&&l.intersectsSphere(K.frustum,E))if(100<L.radius&&L.getChildren())for(const U of L.getChildren())v(B,K,U,J,M);else H.unionDepthRangeWithAABB(B,K.viewProjectionMatrix,J,L.bbMin,L.bbMax)}}function r(B,K,L){var J=K.eye;K=K.viewForward;J=(L[0]-J[0])*K[0]+(L[1]-J[1])*K[1]+(L[2]-J[2])*K[2];B.near=Math.min(B.near,J-L[3]);B.far=Math.max(B.far,J+L[3])}class y{constructor(){this._items=new g({allocator:B=>B||{object:null,distance:0,near:0,far:0},deallocator:B=>{B.object=null;B.distance=0;B.near=
0;B.far=0;return B}})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(B){this._items.pushNew().object=B}sort(B){const K=B.eye,L=B.viewForward;this._items.forAll(J=>{const M=J.object.boundingVolumeWorldSpace.bounds,T=(M[0]-K[0])*L[0]+(M[1]-K[1])*L[1]+(M[2]-K[2])*L[2];J.distance=T;J.near=T-M[3];J.far=T+M[3]});this._items.sort((J,M)=>J.distance-M.distance)}forEachInDepthRange(B,K,L){if(K===u.DepthOrder.FRONT_TO_BACK)for(K=0;K<this._items.length;++K){var J=
this._items.data[K];J.far<B.near||J.near>B.far||L(J.object,J.near,J.far)}else for(K=this._items.length-1;0<=K;--K)J=this._items.data[K],J.far<B.near||J.near>B.far||L(J.object,J.near,J.far)}}class z{constructor(){this._view=k.create();this._viewProj=k.create();this._frustum=l.create();this._geometries=[];this._near=[];this._far=[];this._nearCandidates=[];this._farCandidates=[];this._looseRange={near:0,far:0}}compute(B,K){this._reset();d.copy(this._view,B.viewMatrix);d.multiply(this._viewProj,B.projectionMatrix,
this._view);l.copy(this._frustum,B.frustum);B=this._view;const L=B[2],J=B[6],M=B[10],T=B[14];K.forAll(U=>U.forEachGeometry(Z=>{if(Z.visible&&Z.castShadow){var P=Z.boundingSphere,R=L*P[0]+J*P[1]+M*P[2]+T,W=R-P[3];P=R+P[3];this._geometries.push(Z);this._near.push(-P);this._far.push(-W)}}));K=new h.DepthRange;if(0===this._geometries.length)return K;for(B=0;B<this._geometries.length;++B)this._near[B]>K.far&&(K.far=this._near[B]),2<this._near[B]&&this._far[B]<K.near&&(K.near=this._far[B]);B=this._looseRange;
B.near=Math.max(.5*K.near,2);B.far=2*K.far;var Q=0;let O=0;for(let U=0;U<this._geometries.length;++U)this._near[U]<K.near&&(this._near[U]>=B.near?K.near=this._near[U]:this._nearCandidates[Q++]=U),this._far[U]>K.far&&(this._far[U]<=B.far?K.far=this._far[U]:this._farCandidates[O++]=U);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return K;this._nearCandidates.sort((U,Z)=>this._near[U]<this._near[Z]?-1:this._near[U]>this._near[Z]?1:0);this._farCandidates.sort((U,Z)=>this._far[U]<
this._far[Z]?1:this._far[U]>this._far[Z]?-1:0);for(B=0;B<this._nearCandidates.length;++B)Q=this._nearCandidates[B],this._near[Q]<K.near&&(Q=this._geometries[Q],this._includeNearBoundingInfoRec(Q.boundingInfo,Q.shaderTransformation,K));for(B=0;B<this._farCandidates.length;++B)Q=this._farCandidates[B],this._far[Q]>K.far&&(Q=this._geometries[Q],this._includeFarBoundingInfoRec(Q.boundingInfo,Q.shaderTransformation,K));this._reset();return K}_reset(){this._geometries.length=0;this._near.length=0;this._far.length=
0;this._nearCandidates.length=0;this._farCandidates.length=0}_includeNearBoundingInfoRec(B,K,L){if(null!=B){m.transformMat4(E,B.center,K);var J=p.maxScale(K),M=E[0],T=E[1],Q=E[2];J*=B.radius;var O=this._frustum;if(!(O[0][0]*M+O[0][1]*T+O[0][2]*Q+O[0][3]>J||O[1][0]*M+O[1][1]*T+O[1][2]*Q+O[1][3]>J||O[2][0]*M+O[2][1]*T+O[2][2]*Q+O[2][3]>J||O[3][0]*M+O[3][1]*T+O[3][2]*Q+O[3][3]>J||(M=this._view[2]*M+this._view[6]*T+this._view[10]*Q+this._view[14],T=M+J,2>-(M-J)||-T>=L.near)))if(-T>this._looseRange.near)L.near=
-T;else{if(100<J&&(J=B.getChildren(),void 0!==J)){for(const U of J)this._includeNearBoundingInfoRec(U,K,L);return}H.unionDepthRangeWithAABB(L,this._viewProj,K,B.bbMin,B.bbMax)}}}_includeFarBoundingInfoRec(B,K,L){if(null!=B){var J=B.radius;m.transformMat4(E,B.center,K);var M=p.maxScale(K),T=E[0],Q=E[1],O=E[2];J*=M;M=this._frustum;if(!(M[0][0]*T+M[0][1]*Q+M[0][2]*O+M[0][3]>J||M[1][0]*T+M[1][1]*Q+M[1][2]*O+M[1][3]>J||M[2][0]*T+M[2][1]*Q+M[2][2]*O+M[2][3]>J||M[3][0]*T+M[3][1]*Q+M[3][2]*O+M[3][3]>J||(T=
this._view[2]*T+this._view[6]*Q+this._view[10]*O+this._view[14]-J,-T<=L.far)))if(-T<this._looseRange.far)L.far=-T;else{if(100<J&&(J=B.getChildren(),void 0!==J)){for(const U of J)this._includeFarBoundingInfoRec(U,K,L);return}H.unionDepthRangeWithAABB(L,this._viewProj,K,B.bbMin,B.bbMax)}}}}class D{constructor(){this._modelViewProj=k.create();this._clipPosition=[c.create(),c.create(),c.create(),c.create(),c.create(),c.create(),c.create(),c.create()]}unionDepthRangeWithAABB(B,K,L,J,M){var T=this._modelViewProj;
d.multiply(T,K,L);K=!1;for(L=0;8>L;++L){const Q=this._clipPosition[L],O=0===L||3===L||4===L||7===L?J[0]:M[0],U=0===L||1===L||4===L||5===L?J[1]:M[1],Z=4>L?J[2]:M[2];Q[0]=T[0]*O+T[4]*U+T[8]*Z+T[12];Q[1]=T[1]*O+T[5]*U+T[9]*Z+T[13];Q[2]=T[2]*O+T[6]*U+T[10]*Z+T[14];Q[3]=T[3]*O+T[7]*U+T[11]*Z+T[15]}for(J=0;12>J;++J){M=this._clipTriangle(this._clipPosition[C[J][0]],this._clipPosition[C[J][1]],this._clipPosition[C[J][2]]);T=!0;for(L=0;L<M.length;++L)if(2<=M[L][3]){T=!1;break}if(!T)for(K=!0,T=0;T<M.length;++T)L=
M[T][3],Number.isFinite(L)&&(B.near=Math.min(L,B.near),B.far=Math.max(L,B.far))}return K}_inside(B,K){if(0===K)return B[0]>=-B[3];if(1===K)return B[1]>=-B[3];if(2===K)return B[0]<=B[3];if(3===K)return B[1]<=B[3];w.assert(!1)}_intersect(B,K,L){let J=0;0===L?J=(-B[3]-B[0])/(K[0]-B[0]+K[3]-B[3]):1===L?J=(-B[3]-B[1])/(K[1]-B[1]+K[3]-B[3]):2===L?J=(B[3]-B[0])/(K[0]-B[0]-K[3]+B[3]):3===L&&(J=(B[3]-B[1])/(K[1]-B[1]-K[3]+B[3]));return f.lerp(c.create(),B,K,J)}_clipTriangle(B,K,L){B=[B,K,L];for(K=0;4>K;++K){L=
B;B=[];for(let J=0;J<L.length;++J){const M=L[J],T=L[(J+1)%L.length];this._inside(T,K)?(this._inside(M,K)||B.push(this._intersect(M,T,K)),B.push(T)):this._inside(M,K)&&B.push(this._intersect(M,T,K))}}return B}}const C=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],E=e.create(),A=k.create(),F=h.empty(),G=new y,I=new z,H=new D;a.DepthRangeFromRenderGeometries=z;a.depthRangeFromLayer=x;a.depthRangeFromScene=function(B,K,L){let J=0;if(!K.some(T=>{J+=T.numGeometries;
return 1E4<=J}))return I.compute(B,K);const M=h.empty();L.forAll(T=>h.union(M,x(B,T)));return M};a.textureToDepth=function(B,K,L){return b.unpackFloatRGBA(K,B)*(L[1]-L[0])+L[0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Evented ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E){a.MagnifierHelper=class extends g{constructor(){super(...arguments);this._resources=this._imageLoadTask=this._imageSources=this._magnifier=null;this._passParameters=new r.MagnifierPassParameters;this.events=new k;this.attributeLocations=new Map([[v.VertexAttribute.POSITION,0]]);this._tmpScreenPoint=c.createScreenPointArray();this._tmpRenderPoint=c.createRenderScreenPointArray()}get updating(){return null==this._imageSources&&null!=this._imageLoadTask&&
!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(A){A!==this._magnifier&&(this.removeAllHandles(),this._magnifier=A,A=()=>{this._updateResourceLoading();this.events.emit("request-render")},null!=this._magnifier&&this.addHandles(f.watch(()=>this._magnifier?.version,A)),A())}get enabled(){return null!=this._validMagnifier}get _validMagnifier(){return null!=this._magnifier&&this._magnifier.visible&&null!=this._magnifier.position&&0<this._magnifier.size?this._magnifier:
null}get _factor(){return null!=this._magnifier?this._magnifier.factor||1:1}destroy(){this._magnifier=null;null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()}render(A,F){const G=this._validMagnifier;if(null!=G){var I=Math.ceil(F.camera.pixelRatio*G.size);this._updateResources(A,I);if(null!=this._resources){var H=this._passParameters.textures;I=Math.ceil(1/this._factor*I);H.input.resize(I,I);c.screenPointObjectToArray(G.position,this._tmpScreenPoint);
var B=F.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),K=F.camera.fullHeight,L=.5*I,J=.5*I;B[0]=m.clamp(B[0],L,F.camera.fullWidth-L-1);B[1]=m.clamp(B[1],J,K-J-1);K=Math.floor(B[0]-L);B=Math.floor(B[1]-J);J=this._resources.program;J.bindTexture("textureInput",H.input);A.gl.copyTexImage2D(H.input.descriptor.target,0,H.input.descriptor.pixelFormat,K,B,I,I,0);this._passParameters.magnifier=G;A.useProgram(J);J.bindPass(this._passParameters,F);A.bindVAO(this._resources.vao);A.setPipelineState(this._resources.pipelineState);
A.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,4)}}}_updateResourceLoading(){const A=this._validMagnifier;if(null!=A){var F=A.maskUrl,G=A.overlayUrl;null==this._imageLoadTask||this._imageLoadTask.maskUrl===F&&this._imageLoadTask.overlayUrl===G||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);null==this._imageSources&&null==this._imageLoadTask&&(this._imageLoadTask={maskUrl:F,overlayUrl:G,task:d.createTask(async I=>{const H=null==F||null==G?y.loadMagnifierResources(I):
null,B=null!=F?x.requestImage(F,{signal:I}):H.then(K=>K.mask);I=null!=G?x.requestImage(G,{signal:I}):H.then(K=>K.overlay);this._imageSources={mask:await B,overlay:await I};this._disposeResources();this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}}_updateResources(A,F){this.enabled?null!=this._resources?this._passParameters.textures.size!==F&&(A=this._createTextureResources(A,F),null==A?this._disposeResources():
(this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=A)):(F=this._createTextureResources(A,F),null!=F&&(this._resources={program:this._createProgram(A),vao:q.createQuadVAO(A,n.Pos2,this.attributeLocations,0,1),pipelineState:D.makePipelineState({blending:D.simpleBlendingParams(z.BlendFactor.ONE,z.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:D.defaultColorWriteParams})},this._passParameters.textures=F)):this._disposeResources()}_disposeResources(){null!=
this._resources&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(A){A.mask.dispose();A.overlay.dispose();A.input.dispose()}_createTextureResources(A,F){if(null==this._imageSources)return null;this._imageSources.overlay.width=F;this._imageSources.overlay.height=F;this._imageSources.mask.width=F;this._imageSources.mask.height=F;const G=new E.TextureDescriptor;G.internalFormat=
z.PixelFormat.RGBA;G.wrapMode=z.TextureWrapMode.CLAMP_TO_EDGE;G.flipped=!0;G.preMultiplyAlpha=!l.isSVG(this._imageSources.overlay.src)||!A.driverTest.svgPremultipliesAlpha.result;const I=new C.Texture(A,G,this._imageSources.overlay);G.pixelFormat=G.internalFormat=z.PixelFormat.ALPHA;G.preMultiplyAlpha=!1;const H=new C.Texture(A,G,this._imageSources.mask);G.pixelFormat=G.internalFormat=z.PixelFormat.RGBA;G.flipped=!1;return{input:new C.Texture(A,G),mask:H,overlay:I,size:F}}_createProgram(A){return new t.Program(A,
r.build(),this.attributeLocations)}};b.__decorate([e.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);b.__decorate([e.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);b.__decorate([e.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=b.__decorate([w.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DPassUniform ../lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p{}class h extends f.NoParameters{constructor(){super(...arguments);this.textures=new p}}const u=b.createScreenPointArray(),w=b.createRenderScreenPointArray(),x=d.create();a.MagnifierPassParameters=h;a.TextureResources=p;a.build=function(){const n=new c.ShaderBuilder;n.attributes.add(e.VertexAttribute.POSITION,"vec2");n.vertex.uniforms.add(new m.Float4PassUniform("drawPosition",(q,t)=>{var v=t.camera.pixelRatio;const r=q.magnifier.offset.x*v,y=q.magnifier.offset.y*
v;b.screenPointObjectToArray(q.magnifier.position,u);const z=t.camera.screenToRender(u,w);q=Math.ceil(v*q.magnifier.size);v=t.camera.fullWidth;t=t.camera.fullHeight;return g.set(x,-1+(z[0]+r)/v*2,-1+(z[1]-y)/t*2,q/v*2,q/t*2)}));n.varyings.add("vUV","vec2");n.vertex.code.add(f.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);n.fragment.uniforms.add(new l.Texture2DPassUniform("textureInput",q=>q.textures.input));n.fragment.uniforms.add(new l.Texture2DPassUniform("textureMask",q=>q.textures.mask));n.fragment.uniforms.add(new l.Texture2DPassUniform("textureOverlay",q=>q.textures.overlay));n.fragment.uniforms.add(new k.BooleanPassUniform("maskEnabled",q=>q.magnifier.maskEnabled));n.fragment.uniforms.add(new k.BooleanPassUniform("overlayEnabled",q=>q.magnifier.overlayEnabled));n.fragment.code.add(f.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,g,d){const k=m=>Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=async function(m){var f=new Promise((l,e)=>a(["./mask-svg"],p=>l(k(p)),e)),c=new Promise((l,e)=>a(["./overlay-svg"],p=>l(k(p)),e));f=d.requestImage((await f).default,
{signal:m});c=d.requestImage((await c).default,{signal:m});c={mask:await f,overlay:await c};g.throwIfAborted(m);return c};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports","../../../../core/Logger","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView"],function(a,b,g,d){class k{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";
this.colorZero=new d.BufferViewVec4u8(new ArrayBuffer(4));this._uidToRenderColor=new Map;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new Map;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(m,f,c,l,e,p=null,h=null,u=null){m&&f&&c&&l&&(this._layerUidToId.set(l,c),this._layerUidToPopupEnabled.set(l,e),e&&(c=this._layerUidToGraphicsUidToObjectId.get(l),c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(l,c)),c.set(f,{objectId:m,attributeNodeId:p,
attributeIndex:h,subLayerId:u})))}getObjectAndLayerIdColor(m){m=this.getObjectAndLayerIdColorArray(m);return g.fromValues(m.get(0,1),m.get(0,2),m.get(0,3),255)}getObjectAndLayerIdColorArray(m){if(!m.layerUid||!m.graphicUid)return this.colorZero;var f=this._layerUidToPopupEnabled.get(m.layerUid);if(void 0===f)return b.getLogger(this).warn("popupEnabled is undefined for layerUid "+m.layerUid),this.colorZero;if(!1===f)return this.colorZero;let c=this._uidToRenderColor.get(m.layerUid);c||(c=new Map,this._uidToRenderColor.set(m.layerUid,
c));f=c.get(m.graphicUid);if(!f){for(;!f;){const l=Math.floor(16777214*Math.random())+1;this._colorToUID.has(l)||(f=l)}if(16777215<f)throw Error("Object ID Overflow");c.set(m.graphicUid,f);this._colorToUID.set(f,m)}m=new ArrayBuffer(4);(new DataView(m)).setUint32(0,f,!1);return new d.BufferViewVec4u8(m)}getColorToObjectAndLayerIdMapping(){const m=new Map;for(const [c,l]of this._colorToUID.entries()){var f=this._layerUidToGraphicsUidToObjectId.get(l.layerUid);let e=null;f?(e=f.get(l.graphicUid))||
b.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+l.graphicUid):b.getLogger(this).warn("getColorMapping: no entry found for layerUid "+l.layerUid);(f=this._layerUidToId.get(l.layerUid))||b.getLogger(this).warn("no layerId found for uid "+l.layerUid);e&&f&&m.set(c,e.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:e.objectId,lid:f,attrId:e.attributeNodeId,attrIdx:e.attributeIndex,subLayerId:e.subLayerId}:{type:"object-and-layer-id",oid:e.objectId,lid:f})}return m}}a.ObjectAndLayerIdRenderHelper=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/colorUtils ../../../../core/has ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../chunks/boundedPlane ../../support/debugFlags ../../terrain/TerrainRenderer ../core/FBOCache ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDRenderStyle ../effects/RenderPluginInput ../effects/RenderPluginManager ../effects/blit/Blit ../effects/highlight/Highlight ../effects/highlight/ShadowHighlight ../effects/smaa/SMAA ../effects/ssao/SSAO ./AnimationTimeStep ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderFeature ./RenderSlot ./ShadowAccumulator ./ShadowMap ./SliceHelper ./TransparencyPassType ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../support/RenderState ../../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba,ia,ka,na){function Y(sa){return ra=>sa.immediate.schedule(ra)}a.Renderer=class extends g{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(sa=null,ra=!m("disable-feature:high-quality-idle")){this._renderStateFeatures=Z.setupFeatureDefaults(ra,sa);this.notifyChange("_renderStateFeatures");this._renderPlugins.renderFeatureChanged();this._requestRender()}isFeatureEnabled(sa,
ra=this._state){return this._renderStateFeatures.get(ra,sa)??!1}setFeatureEnabled(sa,ra,Aa){this._renderStateFeatures.set(ra,sa,Aa);this.notifyChange("_renderStateFeatures");this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Z.RenderFeature.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Z.RenderFeature.WaterReflection))}get hasDecorations(){return this._materialRenderersHas.decorations||
this._renderPlugins.hasDecorations}get hasHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(P.RenderSlot.OPAQUE_MATERIAL,z.ShaderOutput.Highlight)||this._renderPlugins.produces(P.RenderSlot.DRAPED_MATERIAL,z.ShaderOutput.Highlight)}get hasShadowHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces(P.RenderSlot.OPAQUE_MATERIAL,z.ShaderOutput.ShadowHighlight)}get _magnifierEnabled(){return this._bindParameters.decorations===K.Decorations.ON&&
this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Z.RenderFeature.HighResolutionAtmosphere)}get hasWater(){return this._materialRenderersHas.water||this._hasOverlayWater}constructor(sa,ra,Aa,qa,la,ja,oa,za){super({});this._stage=sa;this._techniqueRepository=qa;this._rctx=la;this._compositingHelper=ja;this._magnifierHelper=oa;this._requestRender=za;this._materialRenderers=new c;this._needsTransparentPass=
!1;this._materialRenderersHas={hudElements:!1,highlights:!1,water:!1,decorations:!1,occludees:!1};this._hasOverlayWater=!1;this.renderOverlay=ta=>{};this._isRendering=!1;this._backgroundColor=n.fromValues(0,0,0,1);this._sliceHelper=new N;this._state=ka.RenderState.IDLE;this._highQualityTransparencyEnabled=!0;this._terrainTransparency=v.TransparencyMode.Opaque;this._hasAnimations=this._ssrEnabled=!1;this._animationTimestep=new B.AnimationTimeStep;this._renderHiddenTransparentEdges=()=>{};this._pluginInput=
new C.RenderPluginInput;this._releaseGeometryLinearDepth=ta=>ta?.release();this._geometryLinearDepthFormat=r.DepthFormat.DEPTH16_BUFFER;this.fboCache=new r.FBOCache(la);this._renderStateFeatures=Z.setupFeatureDefaults(!m("disable-feature:high-quality-idle"),sa.view.qualityProfile);this._offscreen=new Q.OffscreenRendering(this.fboCache,this._compositingHelper);this.performanceInfo=new ia.RendererPerformanceInfo(this._rctx);this._shadowMap=new W.ShadowMap(this.fboCache,sa.viewingMode);this._highlight=
new F.Highlight({view:sa.view});this._shadowHighlight=new G.ShadowHighlight({view:sa.view,viewingMode:sa.viewingMode});this._shadowAccumulator=new R.ShadowAccumulator(this.fboCache,qa,sa,ta=>{const Ca=this.shadowsEnabled;this._shadowMap.enabled=!0;this._prepare(ta.camera,ta.contentCamera);this._renderPlugins.prepareRender();this._shadowMap.enabled=Ca},(ta,Ca,Ga)=>{ta.shadowMap.start(ta.camera,Ca,Ga,!0,this._stage.view.qualitySettings.maximumPixelRatio);this._renderShadowCascades(z.ShaderOutput.Shadow,
ta.shadowMap);ta.shadowMap.finish();ta.camera.setGLViewport(this._rctx);this._prepare(ta.camera,ta.contentCamera)},za);this._ssao=new H.SSAO({view:this._stage.view});this._renderContext=new O.RenderContext(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper);this._renderPlugins=new E.RenderPluginManager({renderContext:this._renderContext,techniqueRepository:qa,textureRepository:Aa,materialRepository:ra,requestRender:za,controller:sa,fbos:this.fboCache,isFeatureEnabled:ta=>this.isFeatureEnabled(ta)});
this.renderPassManager=new y.RenderPassManager;this._renderPlugins.add(this.renderPassManager);this._smaa=new I.SMAA({view:this._stage.view});this._renderPlugins.add(this._smaa);this._blit=new A.Blit({opacity:1,alphaMode:ba.AlphaMode.None});this._renderPlugins.add(this._blit);this._renderPlugins.add(this._ssao);this._renderPlugins.add(this._highlight);this._renderPlugins.add(this._shadowHighlight);this.addHandles([l.watch(()=>this._stage.view.state.camera,()=>za(),l.syncAndInitial),l.watch(()=>t.debugFlags.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,
ta=>{this._renderHiddenTransparentEdges=ta?()=>this._renderEdges(X.Transparency.TRANSPARENT):()=>{};za()},l.initial),l.watch(()=>this._stage.view.environment.background?.color,ta=>{ta=ta?k.unitRGBAFromColor(ta):n.ZEROS;x.set(this._backgroundColor,ta[0]*ta[3],ta[1]*ta[3],ta[2]*ta[3],ta[3]);za()},l.syncAndInitial)])}normalizeCtorArgs(){return{}}destroy(){this._smaa.destroy();this._blit.destroy();this._gpuTimerHandle=f.removeMaybe(this._gpuTimerHandle);this._materialRenderers.forAll(sa=>sa.dispose());
this._materialRenderers.clear();this._offscreen.dispose();this._shadowMap.dispose();this._ssao.destroy();this._highlight.dispose();this._shadowHighlight.destroy();this._shadowAccumulator.dispose();this._edgeView=f.destroyMaybe(this._edgeView);this.renderPassManager.dispose();this._releaseFBOs();this._disposeOffscreenBuffers();this.fboCache.destroy();L.BoundingInfo.prune()}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=f.releaseMaybe(this._bindParameters.ssr.lastFrameColor);this._bindParameters.multipassTerrain.linearDepth=
f.releaseMaybe(this._bindParameters.multipassTerrain.linearDepth);this._bindParameters.multipassGeometry.linearDepth=f.releaseMaybe(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose();this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers();this._bindParameters.linearDepth=f.releaseMaybe(this._bindParameters.linearDepth);this._bindParameters.hudVisibility=f.releaseMaybe(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||
null!=this._edgeView&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){null==this._edgeView&&(this._edgeView=new S.EdgeView({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:Y(this._stage.view.resourceController)}),this.addHandles(l.watch(()=>this._edgeView?.updating,()=>this._requestRender(),
l.sync)),this._requestRender());return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return u.equals(this._bindParameters.ssr.reprojectionMatrix,w.IDENTITY)}set _reprojectionMatrix(sa){d.update(this._bindParameters.ssr.reprojectionMatrix,sa)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(sa){const {_shadowMap:ra,_bindParameters:Aa}=this;void 0!==sa.qualitySettings?.reflections&&this._ssrEnabled!==sa.qualitySettings.reflections&&
(this._ssrEnabled=sa.qualitySettings.reflections,this._requestRender());void 0!==sa.shadowMap&&this._shadowMap.enabled!==sa.shadowMap&&(this._shadowMap.enabled=sa.shadowMap,this._requestRender());void 0!==sa.shadowMapMaxCascades&&ra.maxCascades!==sa.shadowMapMaxCascades&&(ra.maxCascades=sa.shadowMapMaxCascades,this._requestRender());if(null!=sa.environment){null!=sa.environment.weather&&(this._bindParameters.weather=sa.environment.weather,this._bindParameters.weatherVisible=!!sa.weatherVisible);const qa=
"virtual"!==sa.environment.lighting.type;Aa.enableFillLights!==qa&&(Aa.enableFillLights=qa,this._requestRender())}void 0!==sa.highQualityTransparency&&this._highQualityTransparencyEnabled!==sa.highQualityTransparency&&(this._highQualityTransparencyEnabled=sa.highQualityTransparency,this._requestRender());void 0!==sa.hasOverlayWater&&this._hasOverlayWater!==sa.hasOverlayWater&&(this._hasOverlayWater=sa.hasOverlayWater,this._requestRender());void 0!==sa.slicePlane&&this._sliceHelper.plane!==sa.slicePlane&&
(this._sliceHelper.plane=sa.slicePlane,this._requestRender());void 0!==sa.terrainTransparency&&this._terrainTransparency!==sa.terrainTransparency&&(this._terrainTransparency=sa.terrainTransparency,this._requestRender());void 0!==sa.shadowCastOptions&&this._shadowAccumulator.setOptions(sa.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&
this._hasOITSupport}modify(sa,ra){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:Aa,removes:qa,updates:la}=sa;if(0!==Aa.length||0!==qa.length||0!==la.length){var ja=!1;U.splitRenderGeometryChangeSetByMaterial(sa).forEach((oa,za)=>{if(!ra.done){var ta=this._materialRenderers.find(Ca=>Ca.material===za);null==ta&&0<oa.adds.length&&(ta=new ca.MergedRenderer({material:za}),ta.initializeRenderContext(this._renderPlugins._context),this._materialRenderers.push(ta));
ta&&(ta.modify(oa),ta.isEmpty&&(ja=!0));oa.removes.forEach(Ca=>sa.removes.removeUnordered(Ca));oa.adds.forEach(Ca=>sa.adds.removeUnordered(Ca));oa.updates.forEach(Ca=>sa.updates.removeUnordered(Ca));ra.madeProgress()}});ja&&this._materialRenderers.filterInPlace(oa=>oa.isEmpty?(oa.dispose(),!1):!0);this._updateHasFlags();this._requestRender()}}_updateHasFlags(){const sa=this._materialRenderersHas;sa.decorations=!1;sa.highlights=!1;sa.hudElements=!1;sa.water=!1;sa.occludees=!1;this._materialRenderers.forAll(ra=>
{sa.highlights||(sa.highlights=ra.hasHighlights);sa.occludees||(sa.occludees=ra.hasOccludees);sa.water||(sa.water=ra.hasWater);sa.decorations||(sa.decorations=ra.isDecoration);sa.hudElements||(sa.hudElements=ra.material.produces(P.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,z.ShaderOutput.Color)||ra.material.produces(P.RenderSlot.HUD_MATERIAL,z.ShaderOutput.Color)||ra.material.produces(P.RenderSlot.LABEL_MATERIAL,z.ShaderOutput.Color))});this._bindParameters.hasOccludees=sa.occludees}updateAnimation(sa){const ra=
this._hasAnimations;this._hasAnimations=!1;this._materialRenderers.forAll(Aa=>this._hasAnimations=Aa.updateAnimation(sa)||this._hasAnimations);this._hasAnimations=this._renderPlugins.updateAnimation(sa)||this._hasAnimations;this._hasAnimations!==ra&&(this._gpuTimerHandle=ra?f.removeMaybe(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo());return this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(sa,
ra,Aa,qa,la){const ja=null!=sa;this._isRendering=!0;this.performanceInfo.startFrame();this.fboCache.frame();this._disposeBindBuffers();var oa=this._offscreen;const {camera:za,contentCamera:ta,mode:Ca,alignPixelEnabled:Ga}=Aa;this._state=Ca;this._bindParameters.overlay=this.renderOverlay(la);this.performanceInfo.advance(ia.PerformanceCategory.OVERLAY);this._renderContext.time=la;this._bindParameters.transparencyPassType=V.TransparencyPassType.NONE;this._bindParameters.alignPixelEnabled=Ga;this._bindParameters.decorations=
qa;Aa=q.create(this._sliceHelper.plane);qa===K.Decorations.OFF&&(this._sliceHelper.plane=null);za.setGLViewport(this._rctx);qa=oa.initializeFrame(za,this._backgroundColor,ja);this.hasReflections?this._bindParameters.ssr.lastFrameColor=qa:qa?.release();this._prepare(za,ta);this._renderPlugins.prepareRender();this.performanceInfo.advance(ia.PerformanceCategory.PREPARE);const La=this._computeDepthRange(za);this._renderShadowMap(za,this._bindParameters.lighting.mainLight.direction,La);this.performanceInfo.advance(ia.PerformanceCategory.SHADOW_MAP);
this._ensureBindParameters(za,ta);const Ma=this._renderPlugins.produces(P.RenderSlot.OPAQUE_TERRAIN)&&(this._terrainTransparency===v.TransparencyMode.Semitransparent||this._terrainTransparency===v.TransparencyMode.TransparentWithDraped);qa=this._highQualityTransparency&&Ma;const Ra=this._needsTransparentPass||this._renderPlugins.produces(P.RenderSlot.TRANSPARENT_MATERIAL);this._prepareShaders(qa,Ra);this._renderLinearDepth();this.performanceInfo.advance(ia.PerformanceCategory.LINEAR_DEPTH);this._renderShadowAccumulation(La,
za,ta);this.performanceInfo.advance(ia.PerformanceCategory.ACCUMULATED_SHADOWS);this._ensureBindParametersSSR(la);this._renderSSAO();this.performanceInfo.advance(ia.PerformanceCategory.SSAO);this._renderContext.output=z.ShaderOutput.Color;oa.bindFbo();this._renderOpaqueGeometry();this._renderPlugins.render(P.RenderSlot.ENVIRONMENT_OPAQUE);this.performanceInfo.advance(ia.PerformanceCategory.OPAQUE);this._renderTerrainLinearDepth(qa);this._setMultipassTerrain(qa);this._renderEdges(X.Transparency.OPAQUE);
this.performanceInfo.advance(ia.PerformanceCategory.OPAQUE_EDGES);oa.bindFbo();this._renderPlugins.render(P.RenderSlot.VOXEL);this.performanceInfo.advance(ia.PerformanceCategory.VOXEL);this._renderHiddenTransparentEdges();Ra&&(this._oitEnabled?this._renderOITPass(ea.Geometry):this._renderTransparentMaterial());this.performanceInfo.advance(ia.PerformanceCategory.TRANSPARENT);la=this._renderGeometryLinearDepth(qa);this._renderHUDVisibility(la);qa||this._renderInternalSlot(P.RenderSlot.LINE_CALLOUTS);
this.performanceInfo.advance(ia.PerformanceCategory.HUD_VISIBILITY);this._renderObjectAndLayerIdColor(ra);this.performanceInfo.advance(ia.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);this._renderEdges(X.Transparency.TRANSPARENT,la);this._releaseGeometryLinearDepth(la);this.performanceInfo.advance(ia.PerformanceCategory.TRANSPARENT_EDGES);(ra=Ma?this._renderTransparentTerrain():null)&&this._bindParameters.hudVisibility&&(qa?this._renderLineCallouts(D.HUDRenderStyle.Occluded):oa.compositeToHUDVisibility(this._bindParameters,
ra.colorTexture),this._renderHUD(D.HUDRenderStyle.Occluded,oa.color),this.performanceInfo.advance(ia.PerformanceCategory.HUD_OCCLUDED));this.performanceInfo.advance(ia.PerformanceCategory.TRANSPARENT_TERRAIN);this._setTerrainCulling(!1);ra&&(oa.compositeToFramebuffer(this._bindParameters,ra.colorTexture,ba.AlphaMode.PremultipliedAlpha,1),ra.release(),qa&&(this._renderEdges(X.Transparency.OPAQUE),this.performanceInfo.advance(ia.PerformanceCategory.OPAQUE_EDGES),Ra&&(this._oitEnabled?this._renderOITPass(ea.Geometry):
this._renderTransparentMaterial()),this.performanceInfo.advance(ia.PerformanceCategory.TRANSPARENT),this._renderEdges(X.Transparency.TRANSPARENT),this.performanceInfo.advance(ia.PerformanceCategory.TRANSPARENT_EDGES)));this._bindParameters.ssao=f.releaseMaybe(this._bindParameters.ssao);qa&&this._renderLineCallouts(D.HUDRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);oa.bindFbo();this._renderInternalSlot(P.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);
this._renderPlugins.render(P.RenderSlot.ENVIRONMENT_TRANSPARENT);this.performanceInfo.advance(ia.PerformanceCategory.ENVIRONMENT);this._renderLaserlines();this.performanceInfo.advance(ia.PerformanceCategory.LASER_LINES);this._renderOccluded();this.performanceInfo.advance(ia.PerformanceCategory.OCCLUDED);oa=this._magnifierEnabled&&null==sa?this.fboCache.acquire(r.ColorFormat.RGBA,this._offscreen.width,this._offscreen.height):null;ra=this._renderComposite(oa??sa,this._offscreen.color)??sa;this.performanceInfo.advance(ia.PerformanceCategory.ANTIALIASING);
this._renderHUD(D.HUDRenderStyle.NotOccluded,ra);this.performanceInfo.advance(ia.PerformanceCategory.HUD);this._renderHighlights(ra,this._bindParameters);this.performanceInfo.advance(ia.PerformanceCategory.HIGHLIGHTS);this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters);ra!==sa&&(this._rctx.bindFramebuffer(sa?.fbo),this._compositingHelper.composite(this._bindParameters,oa?.colorTexture,ba.AlphaMode.None));oa!==sa&&oa?.release();if(this.onPostRender)this.onPostRender();
this._releaseFBOs();this._offscreen.releaseBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=Aa;this._isRendering=!1;this.performanceInfo.finishFrame();ja&&(this._releaseFBOs(),this._disposeOffscreenBuffers())}_prepareShaders(sa,ra){this._renderContext.output=z.ShaderOutput.Color;this._prepareOpaqueGeometrySlots();this._setMultipassTerrain(sa);this._renderPlugins.prepare(P.RenderSlot.TRANSPARENT_TERRAIN);this._setMultipassTerrain(!1);sa||this._prepareInternalSlots(this._materialRenderers,
P.RenderSlot.LINE_CALLOUTS);ra&&this._prepareTransparencySlots();this._prepareInternalSlots(this._materialRenderers,P.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderPlugins.prepare(P.RenderSlot.ENVIRONMENT_TRANSPARENT);this._renderPlugins.prepare(P.RenderSlot.LASERLINES);this._rctx.gl.flush()}_renderObjectAndLayerIdColor(sa){if(null!=sa&&m("enable-feature:objectAndLayerId-rendering")){var ra=this._renderContext.output;this._rctx.bindFramebuffer(sa.fbo);this._offscreen.renderToFBO(()=>
this._renderAllGeometry(z.ShaderOutput.ObjectAndLayerIdColor),[0,0,0,0],!0,!0);this._rctx.bindFramebuffer(sa.fbo);this._offscreen.renderToFBO(()=>{this._bindParameters.hudRenderStyle=D.HUDRenderStyle.NotOccluded;this._renderInternalSlot(P.RenderSlot.HUD_MATERIAL)},void 0,!0,!0);this._renderContext.output=ra}}finish(sa){this._hasAnimations||this._animationTimestep.clear();var ra=this.performanceInfo.gpuSamplingEnabled;if((sa=sa===K.RenderRequestType.BACKGROUND)||ra){const Aa=sa?this.performanceInfo.elapsedTime:
0;ra=ra?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();this._animationTimestep.frame(Math.max(Aa,ra),sa)}}readDepthPixels(sa,ra,Aa){var qa=this._bindParameters.linearDepth?.fbo;qa?.colorTexture?qa.readPixels(ra[0],ra[1],ra[2],ra[3],na.PixelFormat.RGBA,na.PixelType.UNSIGNED_BYTE,Aa):(qa=this.fboCache.acquire(r.ColorFormat.RGBA,this._offscreen.width,this._offscreen.height).acquireDepth(r.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(qa.fbo),this._ensureBindParameters(sa,
sa),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(na.ClearBufferBit.COLOR_BUFFER_BIT|na.ClearBufferBit.DEPTH_BUFFER_BIT|na.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderAllGeometry(z.ShaderOutput.Depth),qa.fbo.readPixels(ra[0],ra[1],ra[2],ra[3],na.PixelFormat.RGBA,na.PixelType.UNSIGNED_BYTE,Aa),qa.release())}readHUDVisibility(sa,ra,Aa,qa,la){this._bindParameters.hudVisibility?.fbo.readPixels(sa,ra,Aa,qa,na.PixelFormat.RGBA,na.PixelType.UNSIGNED_BYTE,
la)}readAccumulatedShadow(sa){return this._shadowAccumulator.readAccumulatedShadow(sa[0],sa[1])}_setMultipassTerrain(sa){this._setMultipassEnabled(sa);this._setTerrainCulling(sa)}_setMultipassEnabled(sa){this._bindParameters.multipassEnabled=sa}_setTerrainCulling(sa){this._bindParameters.multipassTerrain.cullAboveGround=sa}_renderEdges(sa,ra){const Aa=this._edgeView;if(Aa?.shouldRender()){const {width:qa,height:la,depth:ja}=this._offscreen,oa=this.fboCache.acquire(r.ColorFormat.RGBA,qa,la);this._offscreen.renderToTargets(()=>
Aa.render(this._bindParameters,sa),oa,ra??ja,fa);this._offscreen.compositeToFramebuffer(this._bindParameters,oa.colorTexture,ba.AlphaMode.Alpha,1);oa.release()}}_renderShadowMap(sa,ra,Aa){const qa=this._shadowMap;qa.enabled&&(qa.start(sa,ra,Aa,this.isFeatureEnabled(Z.RenderFeature.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(sa,ra),this._needsShadowHighlight?(this._renderShadowCascades(z.ShaderOutput.ShadowHighlight,this._shadowMap),
qa.moveSnapshot(W.SnapshotSlot.Highlight),qa.clear(),this._renderShadowCascades(z.ShaderOutput.ShadowExcludeHighlight,this._shadowMap),qa.copySnapshot(W.SnapshotSlot.Default),this._renderShadowCascades(z.ShaderOutput.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(z.ShaderOutput.Shadow),qa.finish(),sa.setGLViewport(this._rctx))}_renderShadowCascades(sa,ra=this._shadowMap){for(const Aa of ra.cascades)Aa.camera.setGLViewport(this._rctx),this._prepare(Aa.camera,Aa.camera),this._renderAllGeometry(sa)}get _needsLinearDepth(){return this._renderPlugins.consumes(z.ShaderOutput.Depth)||
this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,()=>this._renderAllGeometry(z.ShaderOutput.Depth),[0,0,0,0],r.ColorFormat.RGBA,r.DepthFormat.DEPTH_STENCIL_BUFFER),this._bindParameters.linearDepth.releaseDepth(),this._offscreen.bindFbo()):this._bindParameters.linearDepth=f.releaseMaybe(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(sa){sa?
(sa=this._renderContext.output,this._renderContext.output=z.ShaderOutput.Depth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,()=>this._renderTransparentTerrain(),[-1E10,-1E10,-1E10,1]),this._bindParameters.multipassTerrain.linearDepth.releaseDepth(),this._renderContext.output=sa):this._bindParameters.multipassTerrain.linearDepth=f.releaseMaybe(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(sa){if(sa)return sa=
this._renderContext.output,this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,()=>this._renderOpaqueGeometryAndTransparentMaterial(z.ShaderOutput.Depth),[1,1,1,1],r.ColorFormat.RGBA,this._geometryLinearDepthFormat),this._renderContext.output=sa,this._bindParameters.multipassGeometry.linearDepth.detachDepth();this._bindParameters.multipassGeometry.linearDepth=f.releaseMaybe(this._bindParameters.multipassGeometry.linearDepth)}get _needsDepthRange(){return this._shadowMap.enabled||
this._needsShadowCast}_computeDepthRange(sa){if(!this._needsDepthRange)return J.zero;const ra=M.depthRangeFromScene(sa,this._materialRenderers,this._stage.layers);J.union(ra,this._renderPlugins.queryDepthRange(sa));ra.near=Math.max(sa.near,ra.near);ra.far=Math.min(sa.far,ra.far);return ra}_renderAllGeometry(sa){this._renderContext.output=sa;this._renderPlugins.prepare(P.RenderSlot.TRANSPARENT_TERRAIN);this._renderOpaqueGeometryAndTransparentMaterial(sa);this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(sa){this._renderContext.output=
sa;this._renderPlugins.prepare(P.RenderSlot.TRANSPARENT_MATERIAL);this._renderOpaqueGeometry();this._renderTransparentMaterial()}_renderSSAO(){if(this._renderPlugins.produces(P.RenderSlot.SSAO)){var sa=this._offscreen.renderToCachedFBO(null,()=>this._renderAllGeometry(z.ShaderOutput.Normal),[0,0,0,0],r.ColorFormat.RGBA4,r.DepthFormat.DEPTH24_BUFFER);sa.releaseDepth();this._offscreen.bindFbo();this._pluginInput.normal=sa;this._bindParameters.ssao=this._renderPlugins.render(P.RenderSlot.SSAO,this._pluginInput);
sa.release()}}_prepareOpaqueGeometrySlots(){this._renderPlugins.prepare(P.RenderSlot.INTEGRATED_MESH);this._renderPlugins.prepare(P.RenderSlot.OPAQUE_TERRAIN);this._renderPlugins.prepare(P.RenderSlot.OPAQUE_MATERIAL);this._renderPlugins.prepare(P.RenderSlot.ENVIRONMENT_OPAQUE);this._prepareInternalSlots(this._materialRenderers,P.RenderSlot.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderPlugins.render(P.RenderSlot.INTEGRATED_MESH);this._renderPlugins.render(P.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(P.RenderSlot.OPAQUE_MATERIAL);
this._renderPlugins.render(P.RenderSlot.OPAQUE_MATERIAL)}_renderTransparentMaterial(){this._renderInternalSlot(P.RenderSlot.TRANSPARENT_MATERIAL);this._renderPlugins.render(P.RenderSlot.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){if(this._renderPlugins.produces(P.RenderSlot.TRANSPARENT_TERRAIN)){var sa=()=>this._renderPlugins.render(P.RenderSlot.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==z.ShaderOutput.Color)sa();else{var {width:ra,height:Aa,depth:qa}=this._offscreen,la=this.fboCache.acquire(r.ColorFormat.RGBA,
ra,Aa);this._offscreen.renderToTargets(sa,la,qa,[0,0,0,0]);return la}}}_renderHUDVisibility(sa){this._shouldRenderInternalSlot(this._materialRenderers,P.RenderSlot.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._renderInternalSlot(P.RenderSlot.OCCLUSION_PIXELS),sa),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=f.releaseMaybe(this._bindParameters.hudVisibility)}_renderLineCallouts(sa){this._bindParameters.hudRenderStyle=
sa;if(sa===D.HUDRenderStyle.Occluded){const {width:ra,height:Aa,color:qa}=this._offscreen;sa=this.fboCache.acquireDepth(r.DepthFormat.DEPTH16_BUFFER,ra,Aa);this._offscreen.renderToTargets(()=>this._renderInternalSlot(P.RenderSlot.LINE_CALLOUTS),qa,sa,void 0,!0,!0);sa.release()}else this._renderInternalSlot(P.RenderSlot.LINE_CALLOUTS)}_renderLaserlines(){this._renderPlugins.render(P.RenderSlot.LASERLINES);if(this._renderPlugins.produces(P.RenderSlot.LASERLINES_CONTRAST_CONTROL)){const sa=this._offscreen,
{width:ra,height:Aa,depth:qa}=sa,la=this.fboCache.acquire(r.ColorFormat.RGBA,ra,Aa);sa.renderToTargets(()=>this._renderPlugins.render(P.RenderSlot.LASERLINES_CONTRAST_CONTROL),la,qa,fa);sa.compositeToFramebuffer(this._bindParameters,la.colorTexture,ba.AlphaMode.PremultipliedAlpha,1);la.release()}}_renderHUD(sa,ra){if(this._materialRenderersHas.hudElements)if(this._oitEnabled){const Aa=this._renderOITPass(ea.HUD,sa);this._rctx.bindFramebuffer(ra?.fbo);this._compositingHelper.composite(this._bindParameters,
Aa.colorTexture,ba.AlphaMode.PremultipliedAlpha);Aa.release()}else if(sa===D.HUDRenderStyle.Occluded){const {width:Aa,height:qa,color:la}=this._offscreen;ra=this.fboCache.acquireDepth(r.DepthFormat.DEPTH16_BUFFER,Aa,qa);this._offscreen.renderToTargets(()=>this._renderHUDElements(sa),la,ra,void 0,!0,!0);ra.release()}else this._rctx.bindFramebuffer(null),ra?.acquireDepth(r.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(ra?.fbo),this._renderHUDElements(sa),ra?.releaseDepth()}_renderHUDElements(sa){this._bindParameters.hudRenderStyle=
sa;this._prepareInternalSlots(this._materialRenderers,P.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,P.RenderSlot.HUD_MATERIAL,P.RenderSlot.LABEL_MATERIAL);this._renderInternalSlot(P.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(P.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(P.RenderSlot.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._renderPlugins.produces(P.RenderSlot.SHADOW_HIGHLIGHT)&&this.hasShadowHighlights}_renderHighlights(sa,ra){this.hasHighlights&&
ra.decorations!==K.Decorations.OFF&&(ra=this._offscreen.renderToCachedFBO(null,()=>{this._renderAllGeometry(z.ShaderOutput.Highlight);this._rctx.clearSafe(na.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(D.HUDRenderStyle.Both)},[0,0,0,0],r.ColorFormat.RGBA4,r.DepthFormat.DEPTH_STENCIL_BUFFER),ra.releaseDepth(),this._needsShadowHighlight&&(this._pluginInput.highlight=ra,this._renderPlugins.render(P.RenderSlot.SHADOW_HIGHLIGHT,this._pluginInput,sa)),this._renderPlugins.produces(P.RenderSlot.HIGHLIGHT)&&
(this._pluginInput.composite=null,this._pluginInput.normal=null,this._pluginInput.highlight=ra,this._renderPlugins.render(P.RenderSlot.HIGHLIGHT,this._pluginInput,sa)),ra.release())}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(sa,ra,Aa){this._needsShadowCast&&this._bindParameters.linearDepth?.colorTexture&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,sa,ra,Aa)}_prepareTransparencySlots(){this._renderContext.output=z.ShaderOutput.Alpha;
this._bindParameters.transparencyPassType=V.TransparencyPassType.Alpha;this._prepareInternalSlots(this._materialRenderers,P.RenderSlot.TRANSPARENT_MATERIAL);this._renderPlugins.prepare(P.RenderSlot.TRANSPARENT_MATERIAL);this._renderContext.output=z.ShaderOutput.Color;this._bindParameters.transparencyPassType=V.TransparencyPassType.Color;this._prepareInternalSlots(this._materialRenderers,P.RenderSlot.TRANSPARENT_MATERIAL);this._renderPlugins.prepare(P.RenderSlot.TRANSPARENT_MATERIAL);this._bindParameters.transparencyPassType=
V.TransparencyPassType.FrontFace;this._prepareInternalSlots(this._materialRenderers,P.RenderSlot.TRANSPARENT_MATERIAL);this._renderPlugins.prepare(P.RenderSlot.TRANSPARENT_MATERIAL);this._bindParameters.transparencyPassType=V.TransparencyPassType.NONE}_renderOITPass(sa,ra=D.HUDRenderStyle.Both){var Aa=sa===ea.HUD;sa=Aa?this.fboCache.acquire(r.ColorFormat.RGBA,this._offscreen.width,this._offscreen.height):null;const qa=Aa?()=>this._renderHUDElements(ra):()=>this._renderTransparentMaterial(),la=this._renderContext.output;
this._renderContext.output=z.ShaderOutput.Alpha;this._bindParameters.transparencyPassType=V.TransparencyPassType.Alpha;const ja=this._offscreen.renderOITPass(qa,V.TransparencyPassType.Alpha,Aa);this._renderContext.output=z.ShaderOutput.Color;this._bindParameters.transparencyPassType=V.TransparencyPassType.Color;const oa=this._offscreen.renderOITPass(qa,V.TransparencyPassType.Color,Aa);this._bindParameters.transparencyPassType=V.TransparencyPassType.FrontFace;Aa=this._offscreen.renderOITPass(qa,V.TransparencyPassType.FrontFace,
Aa);this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,oa,ja,Aa,sa);sa?.releaseDepth();Aa.release();oa.release();ja.release();this._bindParameters.transparencyPassType=V.TransparencyPassType.NONE;this._renderContext.output=la;return sa}_renderOccluded(){let sa=0;aa.clear();this._materialRenderers.forAll(ja=>{ja.material&&ja.material.isVisible()&&ja.material.parameters.renderOccluded===T.RenderOccludedFlag.OccludeAndTransparentStencil&&(sa|=ja.material.parameters.renderOccluded,aa.push(ja))});
const ra=this._offscreen,Aa=(ja,oa,za,ta,Ca)=>{if(0!==(sa&oa)){var {width:Ga,height:La,depth:Ma}=ra;oa=this.fboCache.acquire(r.ColorFormat.RGBA,Ga,La);ra.renderToTargets(za,oa,Ma,[0,0,0,0],ta,Ca);ra.compositeToFramebuffer(this._bindParameters,oa.colorTexture,ba.AlphaMode.PremultipliedAlpha,ja);oa.release()}};0!==aa.length&&(this._prepareInternalSlots(aa,P.RenderSlot.OCCLUDER_MATERIAL,P.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(P.RenderSlot.OCCLUDER_MATERIAL,aa),Aa(.5,T.RenderOccludedFlag.OccludeAndTransparentStencil,
()=>this._renderInternalSlot(P.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,aa),!1,!1));aa.clear();this._materialRenderers.forAll(ja=>{ja.material&&ja.material.isVisible()&&(ja.material.parameters.renderOccluded===T.RenderOccludedFlag.OccludeAndTransparent||ja.material.parameters.renderOccluded===T.RenderOccludedFlag.Transparent||ja.material.parameters.renderOccluded===T.RenderOccludedFlag.Opaque)&&(sa|=ja.material.parameters.renderOccluded,aa.push(ja))});const qa=this._renderPlugins.renderOccludedFlags;
if(sa|=qa){var la=ja=>{this._renderContext.renderOccludedMask=ja;this._prepareInternalSlots(aa,P.RenderSlot.OPAQUE_MATERIAL,P.RenderSlot.TRANSPARENT_MATERIAL,P.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);qa>T.RenderOccludedFlag.Occlude&&this._renderPlugins.render(P.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(P.RenderSlot.OPAQUE_MATERIAL,aa);this._renderInternalSlot(P.RenderSlot.TRANSPARENT_MATERIAL,aa);this._renderInternalSlot(P.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,
aa);this._renderContext.resetRenderOccludedMask()};this._renderContext.output=z.ShaderOutput.Color;Aa(.5,T.RenderOccludedFlag.OccludeAndTransparent,()=>la(T.RenderOccludedFlag.OccludeAndTransparent),!0,K.StencilBits.OutlineVisualElementMask);Aa(.5,T.RenderOccludedFlag.Transparent,()=>la(T.RenderOccludedFlag.Transparent),!0,K.StencilBits.OutlineVisualElementMask);Aa(1,T.RenderOccludedFlag.Opaque,()=>la(T.RenderOccludedFlag.Opaque),!0,K.StencilBits.OutlineVisualElementMask);aa.clear()}}_renderComposite(sa,
ra){this._renderPlugins.consumes(z.ShaderOutput.CompositeColor)&&(this._pluginInput.composite=ra);ra=null;const Aa=this._renderPlugins.produces(P.RenderSlot.COMPOSITE);Aa&&(ra=this._renderPlugins.renderComposition(P.RenderSlot.COMPOSITE,this._pluginInput),this._pluginInput.composite=ra);const qa=this._renderPlugins.produces(P.RenderSlot.ANTIALIASING);sa=this._renderPlugins.render(qa?P.RenderSlot.ANTIALIASING:P.RenderSlot.BLIT,this._pluginInput,sa);Aa&&ra?.release();return sa}_prepare(sa,ra){this._needsTransparentPass=
this._materialRenderers.some(Aa=>Aa.material.produces(P.RenderSlot.TRANSPARENT_MATERIAL,z.ShaderOutput.Color));this._bindParameters.camera=sa;this._bindParameters.contentCamera=ra}_ensureBindParameters(sa,ra){this._bindParameters.camera=sa;this._bindParameters.contentCamera=ra;sa=this._renderContext.offscreenRenderingHelper;this._bindParameters.mainColor=sa.colorTexture;this._bindParameters.mainDepth=sa.depthTexture}_ensureBindParametersSSR(sa){if(this._bindParameters.ssr.lastFrameColor){null==this._ssrEnableTime&&
(this._ssrEnableTime=sa);this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=w.IDENTITY:(u.invert(ma,this._bindParameters.camera.viewMatrix),u.invert(da,this._bindParameters.camera.projectionMatrix),u.multiply(ua,ma,da),u.multiply(ua,this._renderContext.lastFrameCamera.viewMatrix,ua),u.multiply(ua,this._renderContext.lastFrameCamera.projectionMatrix,ua),this._reprojectionMatrix=ua);const ra=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=
0<ra?Math.min(ra,sa-this._ssrEnableTime)/ra:1;1>this._bindParameters.ssr.fadeFactor&&this._requestRender()}else this._reprojectionMatrix=w.IDENTITY,this._ssrEnableTime=null}_shouldRenderInternalSlot(sa,ra){this._bindParameters.slot=ra;return sa.some(Aa=>null!=Aa.prepareTechnique(this._renderContext))}_prepareInternalSlots(sa,...ra){for(const Aa of ra)this._bindParameters.slot=Aa,sa.forAll(qa=>null!=qa.prepareTechnique(this._renderContext))}_renderInternalSlot(sa,ra=this._materialRenderers){this._bindParameters.slot=
sa;ra.forAll(Aa=>{const qa=Aa.prepareTechnique(this._renderContext);qa&&Aa.renderNode(this._renderContext,qa)})}get memoryInfo(){return{fbos:this.fboCache.usedMemory,vaos:this._materialRenderers.reduce((sa,ra)=>sa+ra.usedMemory,0),plugins:this._renderPlugins.usedMemory}}getMemoryForMaterial(sa){return null==sa?0:this._materialRenderers.find(ra=>ra.material===sa)?.usedMemory??0}get usedMemory(){return this.fboCache.usedMemory+(this.edgeView?.usedMemory??0)+this._renderPlugins.usedMemory}get test(){const sa=
this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{sa._renderStateFeatures=Z.setupFeatureDefaults();this._renderPlugins.renderFeatureChanged();this._requestRender()},releaseGeometryLinearDepth(ra){sa._releaseGeometryLinearDepth=ra??(Aa=>Aa?.release());
sa._geometryLinearDepthFormat=ra?r.DepthFormat.DEPTH_STENCIL_TEXTURE:r.DepthFormat.DEPTH16_BUFFER},getFramebufferTexture:ra=>{switch(ra){case a.FramebufferId.Color:return sa._offscreen.colorTexture;case a.FramebufferId.LinearDepth:return sa._bindParameters.linearDepth?.colorTexture;case a.FramebufferId.ShadowMap:return sa._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return sa._bindParameters.hudVisibility?.colorTexture}}}}};b.__decorate([e.property()],a.Renderer.prototype,"_renderPlugins",
void 0);b.__decorate([e.property()],a.Renderer.prototype,"_shadowAccumulator",void 0);b.__decorate([e.property()],a.Renderer.prototype,"_state",void 0);b.__decorate([e.property()],a.Renderer.prototype,"_renderStateFeatures",void 0);b.__decorate([e.property({readOnly:!0})],a.Renderer.prototype,"fullResolutionAtmosphere",null);b.__decorate([e.property()],a.Renderer.prototype,"_smaa",void 0);b.__decorate([e.property()],a.Renderer.prototype,"_blit",void 0);b.__decorate([e.property({autoDestroy:!0})],
a.Renderer.prototype,"_edgeView",void 0);b.__decorate([e.property()],a.Renderer.prototype,"updating",null);b.__decorate([e.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=b.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.Renderer")],a.Renderer);var ea;(function(sa){sa[sa.Geometry=0]="Geometry";sa[sa.HUD=1]="HUD"})(ea||(ea={}));a.FramebufferId=void 0;(function(sa){sa[sa.Color=0]="Color";sa[sa.LinearDepth=1]="LinearDepth";sa[sa.ShadowMap=2]="ShadowMap";sa[sa.HudVisibility=3]=
"HudVisibility"})(a.FramebufferId||(a.FramebufferId={}));const fa=[0,0,0,0],aa=new c,da=w.create(),ma=w.create(),ua=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../effects/RenderPlugin ../../lib/depthRange ../../lib/RenderSlot".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){a.RenderPassManager=class extends t.SyncPreparesRenderPlugin{constructor(){super({});this._passes=null;this.produces=new Map([[r.RenderSlot.OPAQUE_MATERIAL,C=>this._produces(C)],[r.RenderSlot.TRANSPARENT_MATERIAL,C=>this._passes&&0<this._passes.materialTransparent.count?this._produces(C):!1],[r.RenderSlot.INTEGRATED_MESH,C=>this._produces(C)]]);this._materialPassParameters=new w.MaterialPassParameters;this._shadowPassParameters=new w.ShadowMapPassParameters;
this._highlightPassParameters=new w.HighlightPassParameters;this._systems=new Set}initializeRenderContext(C){this._context=C;const E=C.renderContext.rctx;C=C.techniqueRepository;this._passes={materialOpaque:new x.RenderPass(E,C),materialTransparent:new x.RenderPass(E,C,x.RenderPassSorting.BackToFront),materialIntegratedMesh:new x.RenderPass(E,C),shadowMap:new x.RenderPass(E,C),highlight:new x.RenderPass(E,C),highlightIntegratedMesh:new x.RenderPass(E,C),highlightShadowMap:new x.RenderPass(E,C),defaultShadowMap:new x.RenderPass(E,
C)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null;this._systems.clear()}register(C){this._systems.add(C)}_produces(C){return 0===this._systems.size||null===this._passes?!1:C===n.ShaderOutput.Highlight?0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count:C===n.ShaderOutput.ShadowHighlight?0<this._passes.highlight.count:!0}prepareRender(C){if(0!==this._systems.size&&null!==this._passes){for(const E of Object.values(this._passes))E.prepareSubmit();
this._systems.forEach(E=>E.submit(this._passes,C.bindParameters));for(const E of Object.values(this._passes))E.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(C){if(0===this._systems.size)return null;const E=C.bindParameters;this._updateParameters(E.camera,C.output===n.ShaderOutput.Shadow||C.output===n.ShaderOutput.ShadowHighlight||C.output===n.ShaderOutput.ShadowExcludeHighlight?this._shadowPassParameters:C.output===n.ShaderOutput.Highlight?this._highlightPassParameters:
this._materialPassParameters,E.slot===r.RenderSlot.TRANSPARENT_MATERIAL);this._materialPassParameters.output=C.output;return this._invoke(C,(A,F)=>A.prepare(F,C.bindParameters))}renderNode(C,E){this._invoke(C,(A,F)=>A.dispatch(F,C.bindParameters,E))}_invoke(C,E){if(null===this._passes)return null;switch(C.bindParameters.slot){case r.RenderSlot.OPAQUE_MATERIAL:switch(C.output){case n.ShaderOutput.Color:case n.ShaderOutput.Depth:case n.ShaderOutput.Normal:case n.ShaderOutput.ObjectAndLayerIdColor:return E(this._passes.materialOpaque,
this._materialPassParameters);case n.ShaderOutput.Highlight:return E(this._passes.highlight,this._highlightPassParameters);case n.ShaderOutput.Shadow:return E(this._passes.shadowMap,this._shadowPassParameters);case n.ShaderOutput.ShadowHighlight:return E(this._passes.highlightShadowMap,this._shadowPassParameters);case n.ShaderOutput.ShadowExcludeHighlight:return E(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case r.RenderSlot.TRANSPARENT_MATERIAL:switch(C.output){case n.ShaderOutput.Color:case n.ShaderOutput.Alpha:case n.ShaderOutput.Depth:case n.ShaderOutput.Normal:case n.ShaderOutput.ObjectAndLayerIdColor:return E(this._passes.materialTransparent,
this._materialPassParameters)}break;case r.RenderSlot.INTEGRATED_MESH:switch(C.output){case n.ShaderOutput.Color:case n.ShaderOutput.Depth:case n.ShaderOutput.Normal:case n.ShaderOutput.ObjectAndLayerIdColor:return E(this._passes.materialIntegratedMesh,this._materialPassParameters);case n.ShaderOutput.Highlight:return E(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(C){const E=new v.DepthRange;this._systems.forEach(A=>
v.union(E,A.queryShadowCasterDepthRange(C)));return E}_updateParameters(C,E,A){const F=C.viewInverseTransposeMatrix;h.set(y,F[3],F[7],F[11]);D.set(y);h.copy(E.transformWorldFromViewTH,D.high);h.copy(E.transformWorldFromViewTL,D.low);h.copy(E.slicePlaneLocalOrigin,y);l.fromMat4(E.transformViewFromCameraRelativeRS,C.viewMatrix);p.copy(E.transformProjFromView,C.projectionMatrix);E.identifier===w.RenderPassIdentifier.Material&&(this._materialPassParameters.transparent=A,l.transpose(z,E.transformViewFromCameraRelativeRS),
l.invert(E.transformNormalViewFromGlobal,z))}};a.RenderPassManager=b.__decorate([c.subclass("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],a.RenderPassManager);const y=u.create(),z=e.create(),D=new q.TwoVectorPosition;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../core/PooledArray","../../lib/TransparencyPassType","../../../../webgl/enums"],function(a,b,g,d){a.RenderPassSorting=
void 0;(function(f){f[f.FrontToBack=0]="FrontToBack";f[f.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));class k{constructor(f,c,l=a.RenderPassSorting.FrontToBack){this._rctx=f;this._techniqueRepository=c;this._sorting=l;this._draws=new b({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}submitDraw(f,c,l,e){const p=this._draws.pushNew();p.geometry=c;
p.geometryRanges=l;p.material=f;p.depthSquaredHint=e;p.indexType=(c.indexed?c.vao.indexBuffer.indexType:null)??0}prepare(f,c){return this._draws.map(l=>l.material.prepareTechnique(this._techniqueRepository,f,c,l.geometry.parameters))}dispatch(f,c,l){const e=this._rctx;this._previouslyBoundDraw.clear();let p=null;const h=this._draws.length;for(let x=0;x<h;x++){var u=l[x];if(u!==p||u.configuration.transparencyPassType!==g.TransparencyPassType.NONE)e.bindTechnique(u,f,c),p=u;var w=this._draws.data[x];
const n=w.geometry;e.bindVAO(n.vao);this._previouslyBoundDraw.get(u)!==w.material&&(u.program.bindDraw(w.material,c,f),this._previouslyBoundDraw.set(u,w.material));u=w.geometryRanges;const q=u.length;if(0!==w.indexType){const t=m.get(w.indexType);for(let v=0;v<q;v+=2)e.drawElements(n.primitiveType,u[v+1],w.indexType,u[v]*t)}else for(w=0;w<q;w+=2)e.drawArrays(n.primitiveType,u[w],u[w+1])}}prepareSubmit(){this._draws.clear()}finishSubmit(){const f=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;
this._draws.sort((c,l)=>{const e=f*(c.depthSquaredHint-l.depthSquaredHint);return 0!==e?e:c.geometry.vao.byteSize-l.geometry.vao.byteSize})}get count(){return this._draws.length}}const m=new Map;m.set(d.DataType.UNSIGNED_BYTE,1);m.set(d.DataType.UNSIGNED_SHORT,2);m.set(d.DataType.UNSIGNED_INT,4);a.RenderPass=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderPluginInput":function(){define(["exports"],function(a){class b{constructor(g=null,d=
null,k=null){this.composite=g;this.normal=d;this.highlight=k}}a.RenderPluginInput=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderPluginManager":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/depthRange ../lib/Material ../lib/RenderSlot".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){a.RenderPluginManager=class extends g{constructor(n){super({});this._context=n;this._renderPlugins=new d;this._slots=[];for(n=0;n<x.RenderSlot.MAX_SLOTS;++n)this._slots[n]=[]}normalizeCtorArgs(){return{}}add(n,q){const t=()=>{if(q?.aborted)throw n.uninitializeRenderContext(),k.createAbortError();this._renderPlugins.push(n);n.produces.forEach((r,y)=>{this._slots[y].push(n)});this._context.requestRender();this.notifyChange("updating")},v=n.initializeRenderContext(this._context,
q);if(k.isPromiseLike(v))return v.then(t);t()}remove(n){if(null!=this._renderPlugins.removeUnordered(n)){for(let q=0;q<this._slots.length;++q)this._slots[q]=this._slots[q].filter(t=>t!==n);n.uninitializeRenderContext();this._context.requestRender();this.notifyChange("updating")}}prepareRender(){this._renderPlugins.forAll(n=>{n.prepareRender&&n.prepareRender(this._context.renderContext)})}updateAnimation(n){let q=!1;this._renderPlugins.forAll(t=>{t.updateAnimation&&(q=t.updateAnimation(n)||q)});return q}renderFeatureChanged(){this._renderPlugins.forAll(n=>
{n.renderFeatureChanged&&n.renderFeatureChanged()})}prepare(n){this._context.renderContext.bindParameters.slot=n;this._slots[n].forEach(q=>{const t=q.produces.get(n);t&&t(p.ShaderOutput.Color)&&("prepareTechnique"in q&&q.prepareTechnique(this._context.renderContext),"prepareTechniques"in q&&q.prepareTechniques(this._context.renderContext))})}_getRenderables(n){this._context.renderContext.bindParameters.slot=n;const q=new Map;this._slots[n].forEach(t=>{var v=t.produces.get(n);!v||!v(p.ShaderOutput.Color)||
t.isDecoration&&this._context.renderContext.bindParameters.decorations===h.Decorations.OFF||("prepareTechnique"in t?(v=t.prepareTechnique(this._context.renderContext),null!=v&&q.set(t,v)):"prepareTechniques"in t?(v=t.prepareTechniques(this._context.renderContext),null!=v&&q.set(t,v)):q.set(t,null))});return q}render(n,q=null,t=null){this._getRenderables(n).forEach((v,r)=>t=r.renderNode(this._context.renderContext,v,q,t));return t}renderComposition(n,q){let t=null;this._getRenderables(n).forEach((v,
r)=>{v=r.renderNode(this._context.renderContext,v,q,null);t?.release();t=v;q.composite=t});return t}queryDepthRange(n){const q=new u.DepthRange;this._renderPlugins.forAll(t=>{t=t.queryDepthRange?.(n);u.union(q,t)});return q}get updating(){return this._renderPlugins.some(n=>n.running)}produces(n,q=p.ShaderOutput.Color){return this._slots[n].some(t=>(t=t.produces.get(n))?t(q):!1)}consumes(n){return this._renderPlugins.some(q=>q.consumes().required.includes(n))}get hasDecorations(){return this._renderPlugins.some(n=>
n.isDecoration)}get renderOccludedFlags(){return this._renderPlugins.reduce((n,q)=>n|q.renderOccludedFlags,w.RenderOccludedFlag.None)}get usedMemory(){return this._renderPlugins.reduce((n,q)=>n+(q.usedMemory??0),0)}};b.__decorate([m.property({readOnly:!0})],a.RenderPluginManager.prototype,"updating",null);a.RenderPluginManager=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.RenderPluginManager")],a.RenderPluginManager);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/blit/Blit":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../RenderPlugin ../../lib/RenderSlot ../../../../../chunks/Compositing.glsl ../../shaders/CompositingTechnique ../../shaders/CompositingTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){a.Blit=class extends c.SyncRenderPlugin{constructor(u){super(u);this._context=null;this.opacity=1;this.alphaMode=h.AlphaMode.None;this._blitConfiguration=new h.CompositingTechniqueConfiguration;this._blitParameters=new e.CompositingPassParameters;this.produces=new Map([[l.RenderSlot.BLIT,()=>null!=this._context]])}consumes(){return c.ConsumesCompositeColor}initializeRenderContext(u){this._context=u}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(u,
w,x,n){w=x?.composite?.colorTexture;if(!this._context||!w)return n;x=this._context.techniqueRepository.acquire(p.CompositingTechnique,this._blitConfiguration);if(!x?.compiled)return this._context.requestRender(),n;u.rctx.bindFramebuffer(n?.fbo);this._blitParameters.texture=w;this._blitParameters.opacity=this.opacity;u.rctx.bindTechnique(x,this._blitParameters,u.bindParameters);u.rctx.screen.draw();x.release();return n}};b.__decorate([g.property()],a.Blit.prototype,"_context",void 0);b.__decorate([g.property()],
a.Blit.prototype,"opacity",void 0);b.__decorate([g.property()],a.Blit.prototype,"alphaMode",void 0);a.Blit=b.__decorate([f.subclass("esri.views.3d.webgl-engine.effects.blit.Blit")],a.Blit);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/Highlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/has ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../core/FBOCache ../RenderPlugin ./HighlightApplyTechnique ./HighlightBlurTechnique ./HighlightDefaults ./HighlightDownsampleTechnique ./HighlightPassParameters ../../lib/DefaultVertexAttributeLocations ../../lib/DefaultVertexBufferLayouts ../../lib/RenderSlot ../../lib/VertexArrayObject ../../../../../chunks/HighlightBlur.glsl ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F){a.Highlight=class extends u.SyncRenderPlugin{constructor(G){super(G);this._context=null;this._passParameters=new t.HighlightPassParameters;this._downsampleDrawParameters=new C.HighlightDownsampleDrawParameters;this._blurDrawParameters=new D.HighlightBlurDrawParameters;this._blurColorFormat=d("mac")?h.ColorFormat.RGBA:h.ColorFormat.RGBA4;this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0};
this.produces=new Map([[y.RenderSlot.HIGHLIGHT,()=>!0]])}consumes(){return u.ConsumesHighlight}initializeRenderContext(G){this._context=G;null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(x.HighlightBlurTechnique));null==this._downsampleTechnique&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(q.HighlightDownsampleTechnique));null==this._applyTechnique&&(this._applyTechnique=this._context.techniqueRepository.acquire(w.HighlightApplyTechnique));
this.addHandles([m.watch(()=>this.view.highlightOptions.color,I=>{this._passParameters.color=g.unitRGBAFromColor(I??n.defaultColor);this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color);this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.haloColor,I=>{this._passParameters.haloColor=null!=I?g.unitRGBAFromColor(I):this._passParameters.color;this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.haloOpacity,
I=>{this._passParameters.haloOpacity=I??n.defaultHaloOpacity;this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity;this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.fillOpacity,I=>{this._passParameters.fillOpacity=I??n.defaultFillOpacity;this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity;this._context.requestRender()},m.syncAndInitial)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=
k.releaseMaybe(this._blurTechnique);this._downsampleTechnique=k.releaseMaybe(this._downsampleTechnique);this._applyTechnique=k.releaseMaybe(this._applyTechnique);this._grid.coverage=k.releaseMaybe(this._grid.coverage);this._grid.vao=k.disposeMaybe(this._grid.vao)}renderNode(G,I,H,B){H=H?.highlight?.colorTexture;if(this._context&&H)if(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled){I=G.bindParameters.camera;var K=I.pixelRatio,L=Math.ceil(I.fullWidth/
K);K=Math.ceil(I.fullHeight/K);var J=this._context.fbos,M=J.rctx;this._gridUpdateResources(H);this._gridComputeCoverage(H,G.bindParameters);this._passParameters.highlightTexture=H;this._passParameters.coverageTexture=this._grid.coverage?.colorTexture;var {width:T,height:Q}=H.descriptor;p.set(this._passParameters.coverageRounding,T/(Math.ceil(T/C.gridCellPixelSize)*C.gridCellPixelSize),Q/(Math.ceil(Q/C.gridCellPixelSize)*C.gridCellPixelSize));var O=M.bindTechnique(this._blurTechnique,this._passParameters,
G.bindParameters),U=this._grid.vao;M.bindVAO(U);var Z=J.acquire(this._blurColorFormat,L,K);M.bindFramebuffer(Z.fbo);M.setViewport(0,0,L,K);M.clear(A.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=H;p.set(this._blurDrawParameters.blurSize,1/L,0);O.bindDraw(this._blurDrawParameters,G.bindParameters,this._passParameters);M.drawArrays(this._blurTechnique.primitiveType,0,F.vertexCount(U,"geometry"));H=J.acquire(this._blurColorFormat,L,K);M.bindFramebuffer(H.fbo);M.clear(A.ClearBufferBit.COLOR_BUFFER_BIT);
this._blurDrawParameters.blurInputTexture=Z.colorTexture;p.set(this._blurDrawParameters.blurSize,0,1/K);O.bindDraw(this._blurDrawParameters,G.bindParameters,this._passParameters);M.drawArrays(this._blurTechnique.primitiveType,0,F.vertexCount(U,"geometry"));M.bindFramebuffer(B?.fbo);M.setViewport4fv(I.fullViewport);this._passParameters.blurTexture=H.colorTexture;M.bindTechnique(this._applyTechnique,this._passParameters,G.bindParameters);M.drawArrays(this._applyTechnique.primitiveType,0,F.vertexCount(U,
"geometry"));H.release();Z.release()}else this._context.requestRender()}_gridUpdateResources(G){if(this._context){var I=this._context.fbos.rctx,H=this._grid,B=Math.ceil(G.descriptor.height/C.gridCellPixelSize),K=Math.ceil(G.descriptor.width/C.gridCellPixelSize);if(!H.vao||H.verticalCellCount!==B||H.horizontalCellCount!==K){H.verticalCellCount=B;H.horizontalCellCount=K;G=B+1;var L=K+1;B=1/B;K=1/K;var J=new Float32Array(24*G*L),M=0;for(let T=0;T<G;T++)for(let Q=0;Q<L;Q++)J[M++]=(Q-.5)*K*2-1,J[M++]=
(T-.5)*B*2-1,J[M++]=Q*K,J[M++]=T*B,J[M++]=(Q+.5)*K*2-1,J[M++]=(T-.5)*B*2-1,J[M++]=Q*K,J[M++]=T*B,J[M++]=(Q-.5)*K*2-1,J[M++]=(T+.5)*B*2-1,J[M++]=Q*K,J[M++]=T*B,J[M++]=(Q-.5)*K*2-1,J[M++]=(T+.5)*B*2-1,J[M++]=Q*K,J[M++]=T*B,J[M++]=(Q+.5)*K*2-1,J[M++]=(T-.5)*B*2-1,J[M++]=Q*K,J[M++]=T*B,J[M++]=(Q+.5)*K*2-1,J[M++]=(T+.5)*B*2-1,J[M++]=Q*K,J[M++]=T*B;H.vao?.dispose();H.vao=new z.VertexArrayObject(I,v.Default3D,{geometry:r.Pos2Tex},{geometry:E.BufferObject.createVertex(I,A.Usage.STATIC_DRAW,J)})}}}_gridComputeCoverage(G,
I){if(this._context){var H=this._context.fbos.rctx,B=this._grid,K=G.descriptor,L=Math.ceil(K.width/C.gridCellPixelSize);K=Math.ceil(K.height/C.gridCellPixelSize);B.coverage?.release();B.coverage=this._context.fbos.acquire(h.ColorFormat.RG,L,K);this._downsampleDrawParameters.input=G;H.bindFramebuffer(B.coverage.fbo);H.bindTechnique(this._downsampleTechnique,this._passParameters,I).bindDraw(this._downsampleDrawParameters,I,this._passParameters);H.setViewport(0,0,L,K);H.screen.draw()}}get test(){return{coverage:this._grid.coverage}}};
b.__decorate([f.property()],a.Highlight.prototype,"_context",void 0);b.__decorate([f.property()],a.Highlight.prototype,"view",void 0);a.Highlight=b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.highlight.Highlight")],a.Highlight);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightApplyTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightApply.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l){class e extends d.ShaderTechnique{initializeProgram(p){return new m.Program(p.rctx,e.shader.get().build(),k.Default3D)}initializePipeline(){return l.makePipelineState({blending:l.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:l.defaultColorWriteParams})}}e.shader=new g.ReloadableShaderModule(f.HighlightApply,()=>new Promise((p,h)=>a(["../../shaders/HighlightApply.glsl"],p,
h)));b.HighlightApplyTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec4 ./vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ./HighlightDownsample.glsl".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(){const u=new f.ShaderBuilder,{vertex:w,fragment:x}=u,n=w.code,q=x.code;u.attributes.add(l.VertexAttribute.POSITION,"vec2");u.varyings.add("uv","vec2");u.attributes.add(l.VertexAttribute.UV0,"vec2");w.uniforms.add(new c.Texture2DPassUniform("coverageTex",t=>t.coverageTexture),new d.Float2PassUniform("coverageRounding",t=>t.coverageRounding));n.add(m.glsl`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);x.uniforms.add(new c.Texture2DPassUniform("tex",t=>t.blurTexture),new c.Texture2DPassUniform("highlightTexture",t=>t.highlightTexture),new k.Float4PassUniform("uColor",t=>t.color),new k.Float4PassUniform("haloColor",t=>t.haloColor),new k.Float4PassUniform("opacities",t=>b.set(h,t.haloOpacity,t.haloOpacityOccluded,t.fillOpacity,t.fillOpacityOccluded)));x.constants.add("outlineSize","float",e.outlineSize);x.constants.add("blurSize","float",e.blurSize);q.add(m.glsl`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - (outlineSize - blurSize) / outlineSize;
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return u}const h=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=g;a.build=p})},"esri/chunks/HighlightDownsample.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform"],function(a,b,g,d,
k){function m(){const l=new d.ShaderBuilder,{outputs:e,fragment:p}=l;l.include(b.ScreenSpacePass);p.uniforms.add(new k.Texture2DDrawUniform("textureInput",h=>h.input));p.constants.add("outlineSize","int",5);e.add("fragGrid","vec2");p.code.add(g.glsl`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${g.glsl.int(32)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -outlineSize; x < cellSize + outlineSize; x += 2) {
        for(int y = -outlineSize; y < cellSize + outlineSize; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`);return l}class f extends g.NoParameters{}const c=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:f,blurSize:.4,build:m,gridCellPixelSize:32,outlineSize:9},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=c;a.HighlightDownsampleDrawParameters=f;a.blurSize=.4;a.build=m;a.gridCellPixelSize=32;a.outlineSize=9})},"esri/views/3d/webgl-engine/effects/highlight/HighlightBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightBlur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c){class l extends d.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,l.shader.get().build(),k.Default3D)}initializePipeline(){return c.makePipelineState({colorWrite:c.defaultColorWriteParams})}}l.shader=new g.ReloadableShaderModule(f.HighlightBlur,()=>new Promise((e,p)=>a(["../../shaders/HighlightBlur.glsl"],e,p)));b.HighlightBlurTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l){function e(){const u=new m.ShaderBuilder,{attributes:w,varyings:x,vertex:n,fragment:q}=u;w.add(l.VertexAttribute.POSITION,"vec2");w.add(l.VertexAttribute.UV0,"vec2");x.add("blurCoordinate","vec3");n.uniforms.add(new c.Texture2DPassUniform("coverageTex",t=>t.coverageTexture),new d.Float2PassUniform("coverageRounding",t=>t.coverageRounding));n.code.add(k.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`);q.uniforms.add(new g.Float2DrawUniform("blurSize",t=>t.blurSize),new f.Texture2DDrawUniform("tex",t=>t.blurInputTexture));q.code.add(k.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`);return u}class p extends k.NoParameters{constructor(){super(...arguments);this.blurSize=b.create()}}const h=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:p,build:e},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=h;a.HighlightBlurDrawParameters=p;a.build=e})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDownsampleTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c){class l extends d.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,l.shader.get().build(),k.Default3D)}initializePipeline(){return c.makePipelineState({colorWrite:c.defaultColorWriteParams})}}l.shader=new g.ReloadableShaderModule(f.HighlightDownsample,()=>new Promise((e,p)=>a(["../../shaders/HighlightDownsample.glsl"],e,p)));b.HighlightDownsampleTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightPassParameters":function(){define(["exports",
"../../../../../chunks/vec2f64","../../../../../chunks/vec4f64","../../core/shaderModules/interfaces"],function(a,b,g,d){class k extends d.NoParameters{constructor(){super(...arguments);this.color=g.fromValues(1,0,1,1);this.haloColor=g.fromValues(1,0,1,1);this.haloOpacity=1;this.haloOpacityOccluded=.25;this.fillOpacity=.2;this.fillOpacityOccluded=.05;this.coverageRounding=b.fromValues(1,1)}}a.HighlightPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/mathUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../ViewingMode ../../core/shaderLibrary/shading/ReadShadowMap.glsl ../RenderPlugin ./HighlightDefaults ./ShadowHighlightTechnique ../../lib/RenderSlot".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){a.ShadowHighlight=class extends x.SyncRenderPlugin{constructor(r){super(r);this._maxOpacity=1;this._passParameters=new q.ShadowHighlightPassParameters;this._drawParameters=new w.ReadShadowMapDrawParameters;this._shadowDifference=.2;this._context=null;this.produces=new Map([[t.RenderSlot.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return x.ConsumesHighlight}initializeRenderContext(r){this._context=r;this.addHandles([k.watch(()=>this.view.highlightOptions.shadowOpacity,
y=>{this._passParameters.shadowOpacity=y??n.defaultShadowOpacity;this._updateOccludedShadowOpacity();this._updateMaxOpacity()},k.syncAndInitial),k.watch(()=>this.view.highlightOptions.shadowDifference,y=>{this._shadowDifference=y??n.defaultShadowDifference;this._updateOccludedShadowOpacity();this._updateMaxOpacity()},k.syncAndInitial),k.watch(()=>this.view.highlightOptions.shadowColor,y=>{this._passParameters.shadowColor=g.unitRGBAFromColor(y??n.defaultShadowColor);this._updateMaxOpacity()},k.syncAndInitial)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=
this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&null==this._technique&&(this._technique=this._context.techniqueRepository.acquire(q.ShadowHighlightTechnique))}renderNode(r,y,z,D){y=z?.highlight?.colorTexture;if(this._context&&z&&y&&this._isVisible)if(this._technique?.compiled){if(z=
r.bindParameters,z.shadowMap.enabled&&z.linearDepth){r=r.rctx;var C=this._technique;this._passParameters.highlight=y;this._drawParameters.origin=z.camera.center;r.bindFramebuffer(D?.fbo);r.bindTechnique(C,this._passParameters,z).bindDraw(this._drawParameters,z,this._passParameters);r.screen.draw()}}else this._context.requestRender()}updateParameters(r,y){this._passParameters.opacityElevation=1-d.smoothstep(4E4,5E4,r.relativeElevation);r=this.viewingMode===u.ViewingMode.Global?p.normalize(v,r.center):
p.set(v,0,0,1);y=p.dot(r,y);this._passParameters.dayNightTerminator=d.smoothstep(0,1,d.clamp(30*y,0,1));this._isVisible&&this.enable()}get _isVisible(){const {opacityElevation:r,dayNightTerminator:y}=this._passParameters;return.001953125<=this._maxOpacity*r*y}};b.__decorate([m.property()],a.ShadowHighlight.prototype,"_context",void 0);b.__decorate([m.property()],a.ShadowHighlight.prototype,"view",void 0);b.__decorate([m.property()],a.ShadowHighlight.prototype,"viewingMode",void 0);a.ShadowHighlight=
b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],a.ShadowHighlight);const v=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlightTechnique":function(){define("require exports ../../../../../chunks/vec4f64 ../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../shaders/ShadowConfiguration ../../../../../chunks/ShadowHighlight.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){class u extends d.ReadShadowMapPassParameters{constructor(){super(...arguments);this.shadowColor=g.fromValues(1,0,1,1);this.shadowOpacity=.2;this.occludedShadowOpacity=.1;this.dayNightTerminator=this.opacityElevation=1}}class w extends m.ShaderTechnique{constructor(x){super(x,new l.ShadowConfiguration,()=>this.destroy())}initializeProgram(x){return new c.Program(x.rctx,w.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return h.makePipelineState({blending:h.separateBlendingParams(p.BlendFactor.SRC_ALPHA,
p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA,p.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:h.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return p.PrimitiveType.TRIANGLE_STRIP}}w.shader=new k.ReloadableShaderModule(e.ShadowHighlight,()=>new Promise((x,n)=>a(["../../shaders/ShadowHighlight.glsl"],x,n)));b.ShadowHighlightPassParameters=u;b.ShadowHighlightTechnique=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowConfiguration":function(){define(["exports",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,g){class d extends g.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.receiveShadows=!0}}b.__decorate([g.parameter()],d.prototype,"receiveShadows",void 0);a.ShadowConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){function y(C){const E=new t.ShaderBuilder;E.include(l.ReadShadowMapDraw,C);E.include(e.CameraSpace);E.include(m.ScreenSpacePass);C=E.fragment;C.include(p.RgbaFloatEncoding);C.include(c.ReadLinearDepth);C.uniforms.add(new v.Texture2DPassUniform("defaultDepthTex",(A,F)=>F.shadowMap.getSnapshot(r.SnapshotSlot.Default)),new v.Texture2DPassUniform("highlightDepthTex",(A,F)=>F.shadowMap.getSnapshot(r.SnapshotSlot.Highlight)),new v.Texture2DPassUniform("depthMap",
(A,F)=>F.linearDepth?.colorTexture),new v.Texture2DPassUniform("highlightTexture",A=>A.highlight),new w.Float4PassUniform("uColor",A=>A.shadowColor),new h.Float2PassUniform("nearFar",(A,F)=>F.camera.nearFar),new x.FloatPassUniform("opacity",A=>A.shadowOpacity),new x.FloatPassUniform("occludedOpacity",A=>A.occludedShadowOpacity),new x.FloatPassUniform("terminationFactor",A=>A.opacityElevation*A.dayNightTerminator),new u.Float3PassUniform("lightingMainDirectionView",(A,F)=>d.normalize(D,d.transformMat4(D,
F.lighting.mainLight.direction,F.camera.viewInverseTransposeMatrix))),new q.Matrix4PassUniform("inverseViewMatrix",(A,F)=>b.invert(z,b.translate(z,F.camera.viewMatrix,F.camera.center))));C.constants.add("unoccludedHighlightFlag","vec4",f.unoccludedHighlightFlag);C.code.add(n.glsl`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${n.glsl.float(.99999)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);

      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;

      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${n.glsl.float(.025)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `);return E}const z=g.create(),D=k.create();g=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=g;a.build=y})},"esri/views/3d/webgl-engine/effects/smaa/SMAA":function(){define("require exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/FBOCache ../RenderPlugin ./SMAABlendWeightsTechnique ./SMAABlurTechnique ./SMAAEdgeDetectTechnique ./SMAAPassParameters ../../lib/RenderFeature ../../lib/RenderSlot ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){function C(E,A,F,G){const I=new D.TextureDescriptor;I.pixelFormat=F;I.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;I.width=G.width;I.height=G.height;I.samplingMode=A;return new z.Texture(E,I,G)}b.SMAA=class extends w.SyncRenderPlugin{constructor(E){super(E);this._searchTexture=this._areaTexture=this._context=null;this._isEnabled=!1;this._smaaParameters=new t.SMAAPassParameters;this.produces=new Map([[r.RenderSlot.ANTIALIASING,()=>this._isEnabled&&
null!=this._context]])}consumes(){return w.ConsumesCompositeColor}get updating(){return null!=this._abortController}initializeRenderContext(E){this._context=E;this.addHandles([m.watch(()=>this.view.qualitySettings.antialiasingEnabled,A=>A||this._context?.isFeatureEnabled(v.RenderFeature.Antialiasing)?this.enable():this.disable(),m.syncAndInitial)])}renderFeatureChanged(){this.view.qualitySettings.antialiasingEnabled||this._context?.isFeatureEnabled(v.RenderFeature.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable();
this._context=null}enable(){if(!this._isEnabled&&this._context&&!this._abortController)if(null==this._edgeTechnique&&(this._edgeTechnique=this._context.techniqueRepository.acquire(q.SMAAEdgeDetectTechnique)),null==this._blendTechnique&&(this._blendTechnique=this._context.techniqueRepository.acquire(x.SMAABlendWeightsTechnique)),null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(n.SMAABlurTechnique)),this._areaTexture&&this._searchTexture)this._isEnabled=!0;else{this._abortController=
new AbortController;var E=this._abortController.signal;(new Promise((A,F)=>a(["./SMAAData"],A,F))).then(A=>this._loadTextures(this._context,A,E)).then(()=>{this._context?.requestRender();this._abortController=null}).catch(A=>{k.isAbortError(A)||this._disposeTextures()})}}_loadTextures(E,A,F){k.throwIfAborted(F);return E?Promise.all([h.requestImage(A.areaTexture).then(G=>C(E.fbos.rctx,y.TextureSamplingMode.LINEAR,y.PixelFormat.RGB,G)),h.requestImage(A.searchTexure).then(G=>C(E.fbos.rctx,y.TextureSamplingMode.NEAREST,
y.PixelFormat.LUMINANCE,G))]).then(([G,I])=>{k.isAborted(F)?(G.dispose(),I.dispose(),k.throwIfAborted(F)):(this._areaTexture=G,this._searchTexture=I,this._isEnabled=!0)}):Promise.reject()}_disposeTextures(){this._areaTexture=d.disposeMaybe(this._areaTexture);this._searchTexture=d.disposeMaybe(this._searchTexture)}disable(){this._abortController=d.abortMaybe(this._abortController);this._isEnabled=!1}destroy(){this.disable();this._disposeTextures()}renderNode(E,A,F,G){A=F?.composite?.colorTexture;if(!(this._isEnabled&&
this._context&&F&&A))return G;if(!(this._edgeTechnique?.compiled&&this._blendTechnique?.compiled&&this._blurTechnique?.compiled))return this._context.requestRender(),G;F=A.descriptor.width;const I=A.descriptor.height,H=this._context.fbos;E=E.rctx;E.setViewport(0,0,F,I);const B=H.acquire(u.ColorFormat.RG,F,I);E.bindFramebuffer(B.fbo);E.setClearColor(0,0,0,1);E.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.color=A;E.bindTechnique(this._edgeTechnique,this._smaaParameters);E.screen.draw();
A=H.acquire(u.ColorFormat.RGBA,F,I);E.bindFramebuffer(A.fbo);E.setClearColor(0,0,1,1);E.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=B.colorTexture;this._smaaParameters.areaTexture=this._areaTexture;this._smaaParameters.searchTexture=this._searchTexture;E.bindTechnique(this._blendTechnique,this._smaaParameters);E.screen.draw();E.bindFramebuffer(G?.fbo);B.release();E.setClearColor(0,1,0,1);E.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=A.colorTexture;
E.bindTechnique(this._blurTechnique,this._smaaParameters);E.screen.draw();A.release();return G}};g.__decorate([f.property()],b.SMAA.prototype,"view",void 0);g.__decorate([f.property()],b.SMAA.prototype,"_context",void 0);g.__decorate([f.property()],b.SMAA.prototype,"_abortController",void 0);g.__decorate([f.property({readOnly:!0})],b.SMAA.prototype,"updating",null);b.SMAA=g.__decorate([p.subclass("esri.views.3d.webgl-engine.effects.smaa.SMAA")],b.SMAA);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/effects/smaa/SMAABlendWeightsTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/BlendWeights.glsl ../../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c){class l extends d.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,l.shader.get().build(),k.Default3D)}initializePipeline(){return c.makePipelineState({colorWrite:c.defaultColorWriteParams})}}
l.shader=new g.ReloadableShaderModule(f.BlendWeights,()=>new Promise((e,p)=>a(["../../shaders/BlendWeights.glsl"],e,p)));b.SMAABlendWeightsTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendWeights.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],
function(a,b,g,d,k){function m(){const l=new d.ShaderBuilder;l.include(b.ScreenSpacePass);l.fragment.uniforms.add(new k.Texture2DPassUniform("edgesTexture",e=>e.inputTexture));l.fragment.uniforms.add(new k.Texture2DPassUniform("areaTexture",e=>e.areaTexture));l.fragment.uniforms.add(new k.Texture2DPassUniform("searchTexture",e=>e.searchTexture));l.fragment.code.add(g.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
        return texture(tex, coord + offset.x * resolution, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${g.glsl.int(f.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${g.glsl.int(f.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${g.glsl.int(f.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${g.glsl.int(f.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${g.glsl.int(f.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        vec2 size = vec2(textureSize(edgesTexture, 0));
        vec2 resolution = 1.0 / size;
        vec2 pixelCoord = uv * size;
        vec4 offsets[2];
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${g.glsl.int(f.maxSearchSteps)} );

        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
          d.y = coords.x;
          d = d * size.x - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
          d.y = coords.y;
          d = d * size.y - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `);return l}const f={maxSearchSteps:8,maxDistanceAreaTex:16},c=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.BlendWeights=c;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAABlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/Blur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c){class l extends d.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,l.shader.get().build(),k.Default3D)}initializePipeline(){return c.makePipelineState({colorWrite:c.defaultColorWriteParams})}}l.shader=new g.ReloadableShaderModule(f.Blur,()=>new Promise((e,p)=>a(["../../shaders/Blur.glsl"],e,p)));b.SMAABlurTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Blur.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,g,d,k){function m(){const c=new d.ShaderBuilder;c.include(b.ScreenSpacePass);c.fragment.uniforms.add(new k.Texture2DPassUniform("blendWeightsTexture",l=>l.inputTexture),new k.Texture2DPassUniform("colorTexture",l=>l.color));c.fragment.code.add(g.glsl`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`);return c}const f=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.Blur=f;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAAEdgeDetectTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/EdgeDetect.glsl ../../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c){class l extends d.ShaderTechnique{initializeProgram(e){return new m.Program(e.rctx,
l.shader.get().build(),k.Default3D)}initializePipeline(){return c.makePipelineState({colorWrite:c.defaultColorWriteParams})}}l.shader=new g.ReloadableShaderModule(f.EdgeDetect,()=>new Promise((e,p)=>a(["../../shaders/EdgeDetect.glsl"],e,p)));b.SMAAEdgeDetectTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeDetect.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,g,d,k){function m(){const l=new d.ShaderBuilder;l.include(b.ScreenSpacePass);l.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",e=>e.color));l.outputs.add("fragEdges","vec2");l.fragment.code.add(g.glsl`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${g.glsl.float(f.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${g.glsl.float(f.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `);return l}const f={threshold:.05,localConstrastAdaption:2},c=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.EdgeDetect=c;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAAPassParameters":function(){define(["exports","../../core/shaderModules/interfaces"],function(a,b){class g extends b.NoParameters{}a.SMAAPassParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimeStep":function(){define(["exports",
"../../../../core/has","../../../../core/mathUtils","../../../../core/time"],function(a,b,g,d){class k{constructor(){this._step=c;this._dilation=1;this._firstIdleTime=d.Milliseconds(0)}frame(e,p){p?0===this._firstIdleTime&&(this._firstIdleTime=d.Milliseconds(performance.now())):this._firstIdleTime=d.Milliseconds(0);if(b("disable-feature:high-quality-idle"))this._dilation=1;else{p=p?performance.now()-this._firstIdleTime:0;if(p>=m+f){this._step=d.Milliseconds(Infinity);this._dilation=1;return}this._dilation=
p>=m?10:1}e=g.clamp(e/.5,c,l);this._step=Infinity===this._step?d.Milliseconds(e):d.Milliseconds(.9*this._step+e*(1-.9))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=d.Milliseconds(0)}}const m=d.Milliseconds(12E4),f=d.Milliseconds(1E4),c=d.Milliseconds(1E3),l=d.Milliseconds(1E3/30);a.AnimationTimeStep=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../core/has ../../../../core/maybe ../core/FBOCache ./TransparencyPassType ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),
function(a,b,g,d,k,m,f){class c{constructor(e,p){this._fbos=e;this.compositingHelper=p;this._height=this._width=4}dispose(){this._color=g.releaseMaybe(this._color);this.releaseBuffers()}get framebuffer(){this.color.detachDepth();this.color.attachDepth(this.depth);return this.color.fbo}get colorTexture(){return this.color.colorTexture}get depthTexture(){return this.depth.attachment}initializeFrame(e,p,h){this._fbos.interactive=!h;h=this._fbos.rctx;this._width=e.fullWidth;this._height=e.fullHeight;
f.ensureAttachmentMaxSize(this,h.parameters.maxTextureSize);e=this._color;this._color=null;this.releaseBuffers();this.bindFbo();h.setClearStencil(0);h.setClearColor(p[0],p[1],p[2],p[3]);h.clearSafe(m.ClearBufferBit.COLOR_BUFFER_BIT|m.ClearBufferBit.DEPTH_BUFFER_BIT|m.ClearBufferBit.STENCIL_BUFFER_BIT);return e}releaseBuffers(){this._color?.detachDepth();this._depth=g.releaseMaybe(this._depth)}renderHUDVisibility(e,p,h){if(e?.fbo.width!==this._width||e?.fbo.height!==this._height)e?.release(),e=this._fbos.acquire(d.ColorFormat.RGBA4,
this._width,this._height);e.attachDepth(h||this.depth);this._fbos.rctx.bindFramebuffer(e.fbo);this.renderToFBO(p,l);e.detachDepth();return e}compositeToHUDVisibility(e,p){this._fbos.rctx.bindFramebuffer(e.hudVisibility?.fbo);this.compositingHelper.compositeHUD(e,p)}renderOITPass(e,p,h){let u,w;switch(p){case k.TransparencyPassType.Color:u=this._fbos.acquire(d.ColorFormat.RGBA16F,this._width,this._height);w=[0,0,0,0];break;case k.TransparencyPassType.Alpha:u=this._fbos.acquire(d.ColorFormat.R16F,this._width,
this._height);w=[1,1,1,1];break;case k.TransparencyPassType.FrontFace:u=this._fbos.acquire(d.ColorFormat.RGBA,this._width,this._height),w=[0,0,0,0]}h?(u.acquireDepth(d.DepthFormat.DEPTH16_BUFFER),this._fbos.rctx.bindFramebuffer(u.fbo),this.renderToFBO(e,w,!0,!0),u.releaseDepth()):(u.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(u.fbo),this.renderToFBO(e,w),u.detachDepth());return u}compositeToFramebuffer(e,p,h,u){this.bindFbo();this.compositingHelper.composite(e,p,h,u)}compositeTransparentOntoOpaque(e,
p,h,u,w){w?(this._fbos.rctx.bindFramebuffer(w.fbo),this._fbos.rctx.setClearColor(0,0,0,1E-13),this._fbos.rctx.clearSafe(m.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFbo();this.compositingHelper.compositeOIT(e,p.colorTexture,h.colorTexture,u.colorTexture)}renderDepthDetached(e){this._bindTarget(this.color);e();this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,p,h,u=d.ColorFormat.RGBA,w=d.DepthFormat.DEPTH16_BUFFER,x=this._width,n=this._height,q=null){if(e?.fbo.width!==x||e?.fbo.height!==
n)e=g.releaseMaybe(e);e=e??this._fbos.acquire(u,x,n);null!=w&&e.acquireDepth(w);q?.forEach(t=>{e.acquireColor(t.format,t.attachment)});this._fbos.rctx.bindFramebuffer(e.fbo);this.renderToFBO(p,h,!0,!0);return e}renderToFBO(e,p,h=!1,u=!1){const w=this._fbos.rctx;let x=0;p&&(w.setClearColor(p[0],p[1],p[2],Math.max(1E-13,p[3])),x|=m.ClearBufferBit.COLOR_BUFFER_BIT);h&&(x|=m.ClearBufferBit.DEPTH_BUFFER_BIT);!1===u?u=0:(!0===u&&(u=255),x|=m.ClearBufferBit.STENCIL_BUFFER_BIT);x&&w.clearSafe(x,u);e();w.gl.flush()}renderToTargets(e,
p,h,u,w=!1,x=!1){this._bindTarget(p,h);this.renderToFBO(e,u,w,x);p.detachDepth()}bindFbo(){this._bindTarget(this.color,this.depth)}_bindTarget(e,p){e.detachDepth();e.attachDepth(p);this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){this._color||(this._color=this._fbos.acquire(d.ColorFormat.RGBA,this._width,this._height));return this._color}get depth(){this._depth||(this._depth=this._fbos.acquireDepth(d.DepthFormat.DEPTH_STENCIL_TEXTURE,
this._width,this._height));return this._depth}}const l=[0,1,0,1];a.OffscreenRendering=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../core/shaderLibrary/shading/ReadShadowMap.glsl ./BindParameters ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A){a.ShadowAccumulator=class extends g{constructor(G,I,H,B,K,L){super({});this.fbos=G;this._stage=H;this._prepareForShadowMapPass=B;this._renderToShadowMap=K;this._requestRender=L;this._sampleCount=this._progress=0;this._passParameters=new w.ReadShadowMapPassParameters;this._cachedLightDirections=[];this._depthRange=n.zero;this._cameraForcedForScreenshot=this._previewing=!1;this._shadowAccumulatorKey="shadowAccumulator";this._rctx=G.rctx;
this._bindParameters=new x.BindParameters(new v.ShadowMap(G,H.viewingMode),null);this._bindParameters.shadowMap.enabled=!0;this._vao=q.createQuadVAO(this._rctx);this._accumulationRenderer=new t.ShadowCastRenderer(I,this._rctx,this,L);this.addHandles([this._stage.view.resourceController.scheduler.registerTask(z.TaskPriority.SHADOW_ACCUMULATOR,this),f.watch(()=>H.renderView,J=>{this.removeHandles("renderView");null!=J&&this.addHandles(J.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=
!0),"renderView")},f.syncAndInitial),f.watch(()=>this._previewing,()=>this._requestRenderIfEnabled(),f.sync)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable();this.removeHandles(this._shadowAccumulatorKey);this._accumulationRenderer=m.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=m.disposeMaybe(this._fbo);this._vao=m.disposeMaybe(this._vao);this._accumulationTechniqueCached=m.releaseMaybe(this._accumulationTechniqueCached);
this._sampleCount=this._cachedLightDirections.length=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){null==this._accumulationTechniqueCached&&(this._accumulationTechniqueCached=new y.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode}));return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&
!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return null!=this._fbo&&0<this._sampleCount}get canAccumulate(){return null!==this._bindParameters.linearDepth?.colorTexture&&this._depthRange!==n.zero&&this._opacityFromElevation>t.shadowCastDisabledElevationThreshold}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(G){const I=this._cachedLightDirections;if(!d.equals(I,
G,h.equals)){var H=Math.min(r.ShadowCastMaxSamples,G.length);this._sampleCount=I.length=H;for(let B=0;B<H;++B)I[B]=h.copy(I[B]??u.create(),G[B]);this._invalidate()}}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(G){this._accumulationRenderer.opacityFromElevation=G}get running(){return this._isRefining&&this.canAccumulate&&0<this._progress}runTask(G){for(this._prepareForShadowMapPass(this._bindParameters);!G.done&&!this._isDoneAccumulating;)this._accumulateShadow(),
G.madeProgress();this._requestRender()}renderAccumulation(G,I,H,B){this._depthRange=I;this._updateCamera(H);this._bindParameters.contentCamera=B;this._bindParameters.linearDepth=G;this._passParameters.origin=this._bindParameters.camera.center;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();G=this._cameraForcedForScreenshot?this._sampleCount:Math.min(6,this._sampleCount-this._progress);
for(I=0;I<G;++I)this._accumulateShadow();this._cameraForcedForScreenshot=!1;this._requestRender()}}render(G){this._accumulationRenderer.render(G)}setOptions(G){void 0!==G.enabled&&G.enabled!==(null!=this._fbo)&&(G.enabled?this._enable():this._disable());void 0!==G.previewing&&(this._previewing=G.previewing);void 0!==G.lightDirections&&(this._lightDirections=G.lightDirections);this._accumulationRenderer.setOptions(G)}readAccumulatedShadow(G,I){if(!this._isActive||!this._fbo||1>this._progress||0>G||
G>=this._fbo.width||0>I||I>=this._fbo.height)return 0;this._fbo.readPixels(G,I,1,1,D.PixelFormat.RED,D.PixelType.UNSIGNED_BYTE,F);return F[0]/this._progress}_enable(){this._progress=0;const G=new E.TextureDescriptor;G.pixelFormat=D.PixelFormat.RED;G.internalFormat=D.SizedPixelFormat.R8;G.wrapMode=D.TextureWrapMode.CLAMP_TO_EDGE;this._fbo=new C.FramebufferObject(this._rctx,G)}_disable(){this._fbo=m.disposeMaybe(this._fbo)}_invalidate(){this._progress=0;this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo);
this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(D.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const G=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo);this._rctx.bindTechnique(G,this._passParameters,this._bindParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(G.primitiveType,0,A.vertexCount(this._vao,"geometry"))}_updateCamera(G){!G.equals(this._bindParameters.camera)&&
this._fbo&&(this._bindParameters.camera.copyFrom(G),this._fbo.resize(G.fullWidth,G.fullHeight),this._opacityFromElevation=1-k.smoothstep(t.shadowCastDisableElevationMin,t.shadowCastDisableElevationMax,G.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const G=this;return{lightDirections:this._lightDirections,get isDone(){return G._isDoneAccumulating},get isActive(){return G._isActive}}}};b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_progress",
void 0);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_fbo",void 0);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_isRefining",null);b.__decorate([c.property()],
a.ShadowAccumulator.prototype,"_isActive",null);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"_opacityFromElevation",null);b.__decorate([c.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=b.__decorate([p.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const F=
new Uint8Array(1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ./glUtil3D ../../../../chunks/ShadowCastVisualize.glsl ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){const n=1/512;a.ShadowCastRenderer=class extends g{constructor(q,t,v,r){super({});this._techniqueRepository=q;this._rctx=t;this._data=v;this._requestRender=r;this._passParameters=new h.ShadowCastVisualizePassParameters(this._data);this._techniqueConfig=new w.ShadowCastVisualizeTechniqueConfiguration;this._enabled=!1;this._vao=p.createQuadVAO(t)}normalizeCtorArgs(){return{}}dispose(){this._stop();this._vao=d.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);
this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(u.ShadowCastVisualizeTechnique,this._techniqueConfig,this._technique)}render(q){if(this._showVisualization){this._passParameters.sampleScale=1/this._data.computedSamples;var t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(t,this._passParameters,q);this._rctx.drawArrays(t.primitiveType,0,x.vertexCount(this._vao,"geometry"))}}setOptions(q){void 0!==
q.enabled&&this._setEnabled(q.enabled);void 0!==q.color&&this._setColor(q.color);void 0!==q.threshold&&(this._threshold=q.threshold);void 0!==q.visualization&&(this._visualization=q.visualization);void 0!==q.bandSize&&(this._bandSize=q.bandSize);void 0!==q.bandsEnabled&&(this._bandsEnabled=q.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(q){this._passParameters.opacityFromElevation!==q&&(this._passParameters.opacityFromElevation=
q,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&0<this._data.computedSamples&&this.opacityFromElevation>n}get _threshold(){return this._passParameters.threshold}set _threshold(q){this._threshold!==q&&(this._passParameters.threshold=q,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(q){q!==this._visualization&&(this._techniqueConfig.visualization=q,this._techniqueRepository.release(this._technique),
this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(q){q!==this._bandSize&&(this._passParameters.bandSize=q,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(q){q!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=q,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(q){e.exactEquals(q,this._passParameters.color)||
(e.copy(this._passParameters.color,q),this._requestRenderIfRunning())}_setEnabled(q){q!==this._enabled&&(q?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0;this._requestRender()}_stop(){this._enabled=!1;this._requestRender()}};b.__decorate([k.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",null);a.ShadowCastRenderer=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);
a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(t){const v=new e.ShaderBuilder,r=v.fragment;r.include(m.RgbaFloatEncoding);r.include(d.ReadLinearDepth);v.include(k.CameraSpace);v.include(g.ScreenSpacePass);const {visualization:y,bandsEnabled:z}=t;r.constants.add("inverseSampleValue","float",h.ShadowCastMaxSamples);r.uniforms.add(new p.Texture2DPassUniform("shadowCastMap",C=>C.shadowCastMap),new c.FloatPassUniform("sampleScale",C=>C.sampleScale),new c.FloatPassUniform("opacityFromElevation",C=>C.opacityFromElevation),
new f.Float4PassUniform("uColor",C=>C.color));t=y===u.ShadowCastVisualization.Gradient;const D=y===u.ShadowCastVisualization.Threshold;t&&z?r.uniforms.add(new c.FloatPassUniform("bandSize",C=>C.bandSize)):D&&r.uniforms.add(new c.FloatPassUniform("threshold",C=>C.threshold));r.code.add(l.glsl`
      void main(void) {
        float record = texture(shadowCastMap, uv).r;
        float pixelSamples = record * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${D?l.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${t&&z?l.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${t?l.glsl`* strength`:""});
      }
    `);return v}class x extends l.NoParameters{constructor(t){super();this._data=t;this.sampleScale=0;this.opacityFromElevation=1;this.color=b.clone(n);this.bandSize=.1;this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}}const n=b.fromValues(.01,0,.25,1),q=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:x,build:w},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=q;a.ShadowCastVisualizePassParameters=x;a.build=w})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(q){const t=new h.ShaderBuilder,v=t.fragment;v.include(c.RgbaFloatEncoding);v.include(k.ReadLinearDepth);t.include(f.CameraSpace);t.include(d.ScreenSpacePass);t.include(m.ReadShadowMapPass,q);v.uniforms.add(new u.Texture2DPassUniform("depthMap",(r,y)=>y.linearDepth?.colorTexture),new p.Matrix4PassUniform("inverseViewMatrix",(r,y)=>b.invert(n,b.translate(n,y.camera.viewMatrix,y.camera.center))),new l.Float2PassUniform("nearFar",(r,y)=>y.camera.nearFar));
v.constants.add("sampleValue","float",x);t.outputs.add("sampleCount","float");v.code.add(e.glsl`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMapTex, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`);return t}const x=1/255,n=g.create();g=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:255,build:w},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=g;a.ShadowCastMaxSamples=255;a.build=w})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,g){a.ShadowCastVisualization=void 0;(function(k){k[k.Gradient=
0]="Gradient";k[k.Threshold=1]="Threshold";k[k.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));class d extends g.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.visualization=a.ShadowCastVisualization.Gradient;this.bandsEnabled=!1}}b.__decorate([g.parameter({count:a.ShadowCastVisualization.COUNT})],d.prototype,"visualization",void 0);b.__decorate([g.parameter()],d.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c,l,e){class p extends d.ShaderTechnique{constructor(h,u){super(h,
u,()=>this.destroy())}initializeProgram(h){return new f.Program(h.rctx,p.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return e.makePipelineState({blending:m.blendingDefault,colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return l.PrimitiveType.TRIANGLE_STRIP}}p.shader=new g.ReloadableShaderModule(c.ShadowCastVisualize,()=>new Promise((h,u)=>a(["./ShadowCastVisualize.glsl"],h,u)));b.ShadowCastVisualizeTechnique=p;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ./ShadowConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,g,d,k,m,f,c,l,e){class p extends d.ShaderTechnique{constructor(h){super(h,new c.ShadowConfiguration,
()=>this.destroy())}initializeProgram(h){return new m.Program(h.rctx,p.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE,l.BlendFactor.ONE,l.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return l.PrimitiveType.TRIANGLE_STRIP}}p.shader=new g.ReloadableShaderModule(f.ShadowCastAccumulate,()=>new Promise((h,u)=>a(["./ShadowCastAccumulate.glsl"],
h,u)));b.ShadowCastAccumulateTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/boundedPlane"],function(a){const b=a.create();class g{constructor(){this._plane=a.create()}get isEnabled(){return!a.equals(this.plane,b)}get plane(){return this._plane}set plane(d){a.copy(d||b,this._plane)}}return g})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../core/support/UpdatingHandles ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../Attribute ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexArrayObject ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R){function W(aa){null!=aa&&(aa.vao.vertexBuffers.instances.dispose(),aa.vao.disposeVAOOnly(),aa.vao=null)}function N(aa){let da=null,ma=null;for(let ua=0;ua<aa.geometries.length;ua++){const sa=aa.geometries[ua];if(sa.material.supportsEdges){if(!da)da=sa.transformation;else if(!d.equals(da,sa.transformation))return!1;if(!ma&&null!=sa.localOrigin)ma=sa;else if(null!=ma?.localOrigin&&null!=sa.localOrigin&&ma.localOrigin.id!==
sa.localOrigin.id)return!1}}return!0}function V(aa,da,ma){da*=ma;ma=d.binaryIndexOf(aa,da,!0);return-1===ma?da<aa[0]?aa.length:0:aa.length-ma}a.EdgeView=class extends g{constructor(aa){super(aa);this._updatingHandles=new q.UpdatingHandles;this._perObjectData=new Map;this._perObjectDataEvictionCache=new Set;this._renderers=new Map;this._gpuMemoryUsage=0;this._workerAbort=new AbortController;this._tmpModelPosition=n.create();this._localOrigins=new A.LocalOriginManager(new C.GridLocalOriginFactory(aa.renderSR))}initialize(){this._worker=
new M.EdgeWorkerHandle(this.schedule);this._componentColorManager=new U.BufferManager(this.rctx,3);const aa=H.VertexLayout.createBuffer(4);for(let da=0;4>da;da++)aa.sideness.set(da,0,0===da||3===da?0:1),aa.sideness.set(da,1,0===da||1===da?0:1);this._verticesBufferObject=P.BufferObject.createVertex(this.rctx,R.Usage.STATIC_DRAW,aa.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(aa=>this._discardObjectEntry(aa)),this._perObjectData.clear(),this._strokesTexture=f.disposeMaybe(this._strokesTexture),
this._componentColorManager=f.destroyMaybe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=f.disposeMaybe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",fa))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return 0<this._renderers.size}async addComponentObject(aa,da,ma,ua,sa,ra,Aa,qa){if(this.hasObject(aa))return this.getObjectMemoryUsage(aa);
let la;ma=new S(new Promise(ja=>la=ja),ma.center,ma.radius);this._perObjectData.set(aa,ma);aa=await this._updatingHandles.addPromise(this._addComponentGeometry(da,ma,ua,sa,ra,Aa,qa));this.setNeedsRender();la();return aa}async addOrUpdateObject3D(aa,da,ma,ua){if(this.destroyed)k.getLogger(this).warn("Attempt to add an object to a destroyed instance");else{var sa=this._perObjectData.get(aa);0<sa?.renderables.length&&this._perObjectDataEvictionCache.add(sa);var ra,Aa=aa.boundingVolumeWorldSpace.bounds;
Aa=new S(new Promise(la=>ra=la),t.getCenter(Aa),t.getRadius(Aa));this._perObjectData.set(aa,Aa);var qa=[];if(ma.mergeGeometries&&1<aa.geometries.length&&N(aa))qa.push(this._addObjectMergedGeometries(aa,Aa,da,ma,ua));else for(let la=0;la<aa.geometries.length;la++){const ja=aa.geometries[la];ja.material.supportsEdges&&qa.push(this._addGeometry(aa,Aa,ja,da[0],ma,ua))}await this._updatingHandles.addPromise(Promise.all(qa));this._perObjectDataEvictionCache.delete(Aa);this._discardObjectEntry(sa);this.setNeedsRender();
ra()}}fastUpdateObject3DEdgesTransform(aa){if(this.destroyed)return!1;var da=this._perObjectData.get(aa);if(!da)return!1;var {geometries:ma}=aa;({renderables:da}=da);if(0===ma.length||0===da.length)return!0;if(1<da.length)return!1;[da]=da;var ua=da.transform;if(!(ua instanceof ba))return!1;[ma]=ma;if(ma.localOrigin!==ua.origin.origin)return!1;ua=w.create();aa=this._computeModelTransformWithLocalOrigin(aa,ma,ua);da.transform=new ba(ua,aa);this.setNeedsRender();return!0}_discardObjectEntry(aa){aa&&
(aa.renderables.length&&(aa.renderables.forEach(da=>this._removeRenderable(da)),this.setNeedsRender()),aa.loaded=null)}hasObject(aa){return this._perObjectData.has(aa)}async updateAllComponentOpacities(aa,da){aa=await this._updatingHandles.addPromise(this._getObjectEntry(aa));if(null!=aa){var ma=da instanceof Array?ua=>da[ua]:()=>da;aa.renderables.forEach(ua=>{const sa=ua.components.meta.length;for(let ra=0;ra<sa;ra++){const Aa=ma(ra),qa=ua.components.meta[ra],la=qa.index;qa.material.opacity=Aa;ua.components.buffer.textureBuffer.setDataElement(la,
1,3,255*Aa)}this._updateTransparency(ua)});this.setNeedsRender()}}async getObjectMemoryUsage(aa){aa=await this._getObjectEntry(aa);return null!=aa?aa.renderables.reduce((da,ma)=>da+ma.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(aa,da,ma,ua){const sa=aa instanceof F.Object3D,ra=!!ma.hasSlicePlane,Aa=O.determineRendererType(da),qa=L.EdgeRenderer.getKey(Aa,ra,sa);aa=await this._updatingHandles.addPromise(this._getObjectEntry(aa));null!=aa&&(aa.renderables.forEach(la=>{if(qa!==la.rendererKey){var ja=
this._renderers.get(la.rendererKey);const oa=this._acquireRenderer(Aa,ra,sa);ja.removeRenderable(la);--ja.refCount;la.rendererKey=qa;oa.addRenderable(la)}for(ja=0;ja<da.length;ja++)la.components.meta[ja].material=da[ja];ua&&this._updateComponentBuffer(la.components);this._updateTransparency(la)}),this.setNeedsRender())}async updateAllVerticalOffsets(aa,da){aa=await this._updatingHandles.addPromise(this._getObjectEntry(aa));null!=aa&&(aa.renderables.forEach(ma=>{const ua=ma.components.meta;for(let sa=
0;sa<ua.length;sa++)ma.components.meta[sa].verticalOffset=da?.[sa]??0;this._updateComponentBuffer(ma.components)}),this.setNeedsRender())}async updateObjectVisibility(aa,da){aa=await this._updatingHandles.addPromise(this._getObjectEntry(aa));null!=aa&&(aa.renderables.forEach(ma=>ma.visible=da),this.setNeedsRender())}removeObject(aa){const da=this._perObjectData.get(aa);da&&(this._perObjectData.delete(aa),this._discardObjectEntry(da))}async _getObjectEntry(aa){aa=this._perObjectData.get(aa);if(!aa)throw Error("no object");
await aa.loaded;return null==aa.loaded?null:aa}render(aa,da){if(null!=this._componentColorManager){this._localOrigins.updateViewMatrices(aa.camera.viewMatrix);var ma=aa.camera.viewInverseTransposeMatrix,ua=n.create(),sa=new z.TwoVectorPosition,ra=0,Aa=0;this._renderers.forEach(la=>{if(0===la.refCount)this._renderers.delete(la.key),la.dispose();else{var ja=!0,oa=!0;la.forEachRenderable(za=>{za.visible&&(ra+=za.statistics.averageEdgeLength,Aa++,ja&&za.regular&&(la.updateTechnique(aa,!1),ja=!1),oa&&
za.silhouette&&(la.updateTechnique(aa,!0),oa=!1))},da)}});this._componentColorManager.garbageCollect();this._componentColorManager.updateTextures();if(0!==Aa){var qa=new J.EdgePassParameters(40*ra/Aa,da);x.set(ua,ma[3],ma[7],ma[11]);sa.set(ua);x.copy(qa.transformWorldFromViewTH,sa.high);x.copy(qa.transformWorldFromViewTL,sa.low);h.fromMat4(qa.transformViewFromCameraRelativeRS,aa.camera.viewMatrix);h.transpose(ea,qa.transformViewFromCameraRelativeRS);h.invert(qa.transformNormalViewFromGlobal,ea);qa.transformProjFromView=
aa.camera.projectionMatrix;this._updateObjectCameraDistances(aa);this._renderers.forEach(la=>{this._renderRegularEdges(la,aa,qa);this._renderSilhouetteEdges(la,aa,qa)})}}}_updateTransparency(aa){const da=O.determineEdgeTransparency(aa.components.meta),ma=O.determineObjectTransparency(aa.components.meta);if(da!==aa.edgeTransparency||ma!==aa.objectTransparency)aa.edgeTransparency=da,aa.objectTransparency=ma,this._renderers.get(aa.rendererKey).setRenderablesDirty()}_computeModelTransformWithLocalOrigin(aa,
da,ma){aa.getCombinedShaderTransformation(da,ma);aa=null!=da.localOrigin?this._localOrigins.register(da.localOrigin):this._localOrigins.acquire(x.set(this._tmpModelPosition,ma[12],ma[13],ma[14]));da.localOrigin=aa.origin;E.applyToModelMatrix(aa.origin.vec3,ma);return aa}_updateComponentBuffer(aa){const {meta:da,buffer:ma}=aa;aa=new Uint8Array(4);for(let sa=0;sa<da.length;sa++){var ua=da[sa].material;const ra=da[sa].index,Aa=m.clamp(Math.round(ua.size*L.lineWidthFractionFactor),0,255),qa=m.clamp(ua.extensionLength,
-L.extensionLengthOffset,255-L.extensionLengthOffset)+L.extensionLengthOffset,la="solid"===ua.type?K.EdgeType.SOLID:K.EdgeType.SKETCH,ja=255*ua.opacity;ua=ua.color;ma.textureBuffer.setData(ra,0,255*ua[0],255*ua[1],255*ua[2],255*ua[3]);ma.textureBuffer.setData(ra,1,Aa,qa,la,ja);y.encodeElevationOffset(da[sa].verticalOffset,aa);ma.textureBuffer.setData(ra,2,aa[0],aa[1],aa[2],aa[3])}}_createComponentBuffers(aa){if(null==this._componentColorManager)return null;const da=[],ma=this._componentColorManager.getBuffer(aa.length);
for(let ua=0;ua<aa.length;ua++){const sa=aa[ua],ra=ma.acquireIndex();da.push({index:ra,verticalOffset:0,material:sa})}aa=new X(ma,da);this._updateComponentBuffer(aa);return aa}_extractEdges(aa,da,ma,ua,sa,ra=sa.length){return this._worker.process({data:da,indices:sa,indicesLength:ra,writerSettings:aa,skipDeduplicate:ma},this._workerAbort.signal,ua)}_createRenderable(aa,da,ma,ua,sa){var ra=qa=>null!=this._verticesBufferObject?new ca(new G.VertexArrayObject(this.rctx,H.EdgeShaderAttributeLocations,
{vertices:H.glVertexLayout,instances:qa===Z.EdgeSilhouette.REGULAR?B.RegularEdgeBufferWriter.glLayout:B.SilhouetteEdgeBufferWriter.glLayout},{vertices:this._verticesBufferObject,instances:P.BufferObject.createVertex(this.rctx,R.Usage.STATIC_DRAW,qa===Z.EdgeSilhouette.REGULAR?aa.regular.instancesData.buffer:aa.silhouette.instancesData.buffer)}),qa===Z.EdgeSilhouette.REGULAR?aa.regular.lodInfo:aa.silhouette.lodInfo):null;const Aa=0<aa.regular.lodInfo.lengths.length?ra(Z.EdgeSilhouette.REGULAR):null;
ra=0<aa.silhouette.lodInfo.lengths.length?ra(Z.EdgeSilhouette.SILHOUETTE):null;return new ia(Aa,ra,{gpuMemoryUsage:(Aa?.vao.usedMemory??0)+(ra?.vao.usedMemory??0),externalMemoryUsage:sa,averageEdgeLength:aa.averageEdgeLength},ma,O.determineEdgeTransparency(da.meta),O.determineObjectTransparency(da.meta),da,ua)}async _addGeometry(aa,da,ma,ua,sa,ra){if(!(0>=ma.edgeIndicesLength)){var Aa=ma.attributes.get(I.VertexAttribute.POSITION),qa=w.create();aa=this._computeModelTransformWithLocalOrigin(aa,ma,qa);
Aa=new Y(Aa,qa,aa);return this._addPositionData(da,Aa,ma.edgeIndicesLength,ua,sa,ra)}}async _addPositionData(aa,da,ma,ua,sa,ra=!1){if(null!=aa.loaded){var Aa=this._createComponentBuffers([ua]);if(null!=Aa){ua=this._acquireRenderer(ua.type,!!sa.hasSlicePlane,!0);var {modelTransform:qa,origin:la}=da;sa=da.position.indices;da=da.position;var ja=da.data.length/da.size,oa=H.EdgeInputBufferLayout.createBuffer(ja);for(let za=0;za<ja;za++)oa.position.set(za,0,da.data[za*da.size]),oa.position.set(za,1,da.data[za*
da.size+1]),oa.position.set(za,2,da.data[za*da.size+2]);O.fillComponenBufferIndices(Aa.meta,[0,oa.componentIndex.count],oa.componentIndex);ma=await this._updatingHandles.addPromise(this._extractEdges(ua.writerSettings,oa,!1,ra,sa,ma));null!=aa.loaded&&(Aa=this._createRenderable(ma,Aa,new ba(qa,la),ua.key,!1),aa.renderables.push(Aa),ua.addRenderable(Aa),this._gpuMemoryUsage+=Aa.statistics.gpuMemoryUsage)}}}async _addComponentGeometry(aa,da,ma,ua,sa,ra,Aa){if(null==da.loaded)return 0;const qa=this._createComponentBuffers(ra);
if(null==qa)return 0;ra=O.determineRendererType(ra);Aa=this._acquireRenderer(ra,Aa.hasSlicePlane||!1,!1);ra=H.EdgeInputBufferLayout.createBuffer(ma.length/3);v.copy(ra.position.typedBuffer,ma,ra.position.typedBufferStride,3);O.fillComponenBufferIndices(qa.meta,sa,ra.componentIndex,ua);ma=await this._updatingHandles.addPromise(this._extractEdges(Aa.writerSettings,ra,!0,!1,ua));if(null==da.loaded)return 0;aa=this._createRenderable(ma,qa,aa,Aa.key,!0);da.renderables.push(aa);Aa.addRenderable(aa);return aa.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(aa,
da,ma,ua,sa){const ra=new Map;let Aa=0,qa=null,la=0;var ja=aa.geometries.filter(Ga=>{if(0>=Ga.edgeIndicesLength||!Ga.material.supportsEdges)return!1;!qa&&Ga.localOrigin&&(qa=Ga);const La=Ga.attributes.get(I.VertexAttribute.POSITION);la+=La.data.length/La.size;Aa+=Ga.edgeIndicesLength;return!0});if(0!==ja.length){var oa=65536<=la?Uint32Array:Uint16Array,za=Aa?new oa(Aa):null,ta=[],Ca=0;ja.forEach(Ga=>{var La=Ga.attributes.get(I.VertexAttribute.POSITION);const Ma=La.indices;let Ra=ra.get(La.data);if(null==
Ra){Ra=ta.length/3;for(let Ya=0;Ya<La.data.length;Ya+=La.size)ta.push(La.data[Ya]),ta.push(La.data[Ya+1]),ta.push(La.data[Ya+2]);ra.set(La.data,Ra)}for(La=0;La<Ga.edgeIndicesLength;La++)za[Ca++]=Ra+Ma[La]});oa=qa||aa.geometries[0];ja=w.create();oa=this._computeModelTransformWithLocalOrigin(aa,oa,ja);for(let Ga=0;Ga<aa.geometries.length;Ga++)aa.geometries[Ga].localOrigin=oa.origin;aa=new Y(new D.Attribute(ta,za,3),ja,oa);await this._updatingHandles.addPromise(this._addPositionData(da,aa,za.length,
ma[0],ua,sa))}}_acquireRenderer(aa,da,ma){const ua=L.EdgeRenderer.getKey(aa,da,ma);let sa=this._renderers.get(ua);null==this._strokesTexture&&(this._strokesTexture=Q.generateStrokesTexture(this.rctx));sa||(sa=new L.EdgeRenderer(this.rctx,this.techniqueRepository,{type:aa,hasSlicePlane:da,strokesTexture:this._strokesTexture,legacy:ma,spherical:this.viewingMode===r.ViewingMode.Global}),this._renderers.set(ua,sa));++sa.refCount;return sa}_removeRenderable(aa){W(aa.regular);W(aa.silhouette);const da=
this._renderers.get(aa.rendererKey);if(da){da.removeRenderable(aa);--da.refCount;"origin"in aa.transform&&this._localOrigins.release(aa.transform.origin);this._gpuMemoryUsage-=aa.statistics.externalMemoryUsage?0:aa.statistics.gpuMemoryUsage;for(const ma of aa.components.meta)aa.components.buffer.releaseIndex(ma.index)}}_updateObjectCameraDistances(aa){const da=aa.camera.eye,ma=aa.camera.viewForward,ua=n.create();aa=sa=>{x.sub(ua,sa.center,da);const ra=x.dot(ua,ma),Aa=sa.radius,qa=ra<-Aa?Infinity:
ra<Aa?0:ra-Aa;sa.renderables.forEach(la=>la.distanceToCamera=qa)};this._perObjectData.forEach(aa);this._perObjectDataEvictionCache.forEach(aa)}_renderRegularEdges(aa,da,ma){const ua=aa.bindRegularEdges(ma,da),sa=da.camera.perScreenPixelRatio;aa.forEachRenderable(ra=>{if(null!=ra.regular&&ra.visible){var Aa=V(ra.regular.lod.lengths,ra.distanceToCamera,sa);aa.renderRegularEdges(ua,ra,ma,da,Aa)}},ma.transparency)}_renderSilhouetteEdges(aa,da,ma){const ua=aa.bindSilhouetteEdges(ma,da),sa=da.camera.perScreenPixelRatio;
aa.forEachRenderable(ra=>{if(null!=ra.silhouette&&ra.visible){var Aa=V(ra.silhouette.lod.lengths,ra.distanceToCamera,sa);aa.renderSilhouetteEdges(ua,ra,ma,da,Aa)}},ma.transparency)}get test(){return{hasRenderedPrimitives:aa=>{let da=!1;const ma=aa.perScreenPixelRatio,ua=(sa,ra)=>sa.forEachRenderable(Aa=>{Aa.visible&&!da&&(null!=Aa.regular&&(da=0<V(Aa.regular.lod.lengths,Aa.distanceToCamera,ma)),da||null==Aa.silhouette||(da=0<V(Aa.silhouette.lod.lengths,Aa.distanceToCamera,ma)))},ra);this._renderers.forEach(sa=>
{da||(ua(sa,T.Transparency.OPAQUE),ua(sa,T.Transparency.TRANSPARENT))});return da},getObjectData:aa=>this._perObjectData.get(aa)}}};b.__decorate([c.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);b.__decorate([c.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);b.__decorate([c.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);b.__decorate([c.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);b.__decorate([c.property({constructOnly:!0})],
a.EdgeView.prototype,"setNeedsRender",void 0);b.__decorate([c.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);b.__decorate([c.property({readOnly:!0})],a.EdgeView.prototype,"_updatingHandles",void 0);b.__decorate([c.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=b.__decorate([p.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],a.EdgeView);class S{constructor(aa,da,ma){this.center=da;this.radius=ma;this.renderables=[];this.loaded=aa;
this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})}}class X{constructor(aa,da){this.buffer=aa;this.meta=da}}class ca{constructor(aa,da){this.vao=aa;this.lod=da}}class ba{constructor(aa,da){this.modelMatrix=aa;this.origin=da}}class ia{constructor(aa,da,ma,ua,sa,ra,Aa,qa){this.regular=aa;this.silhouette=da;this.statistics=ma;this.transform=ua;this.edgeTransparency=sa;this.objectTransparency=ra;this.components=Aa;this.rendererKey=qa;this.distanceToCamera=0;this.visible=!0}}class ka extends ia{}
class na extends ia{}class Y{constructor(aa,da,ma){this.position=aa;this.modelTransform=da;this.origin=ma}}const ea=u.create(),fa=()=>Promise.reject();a.LegacyTransform=ba;a.RegularRenderable=ka;a.Renderable=ia;a.SilhouetteRenderable=na;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,g){const d=-b[0],k=-b[1];b=-b[2];const m=g[3],f=g[7],c=g[11],l=g[15];g[0]+=
m*d;g[1]+=m*k;g[2]+=m*b;g[4]+=f*d;g[5]+=f*k;g[6]+=f*b;g[8]+=c*d;g[9]+=c*k;g[10]+=c*b;g[12]+=l*d;g[13]+=l*k;g[14]+=l*b};a.applyToViewMatrix=function(b,g){const d=b[0],k=b[1];b=b[2];g[12]+=d*g[0]+k*g[4]+b*g[8];g[13]+=d*g[1]+k*g[5]+b*g[9];g[14]+=d*g[2]+k*g[6]+b*g[10];g[14]+=d*g[3]+k*g[7]+b*g[11]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],
function(a,b,g,d){class k{constructor(f){this._factory=f;this._originData=new Map}acquire(f){return this.register(this._factory.getOrigin(f))}register(f){f=this._originData.get(f.id)||new m(f);f.refCount++;this._originData.has(f.origin.id)||this._originData.set(f.origin.id,f);return f}release(f){f.refCount--;0===f.refCount&&this._originData.delete(f.origin.id)}updateViewMatrices(f){this._originData.forEach(c=>{b.copy(c.viewMatrix,f);d.applyToViewMatrix(c.origin.vec3,c.viewMatrix)})}}class m{constructor(f){this.origin=
f;this.refCount=0;this.viewMatrix=g.create()}}a.LocalOriginManager=k;a.OriginData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){const x={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},n={solid:u.EdgeUtilMode.SOLID,sketch:u.EdgeUtilMode.SKETCH,uber:u.EdgeUtilMode.MIXED};class q{constructor(v,r,y){this._rctx=v;this._shaderTechniqueRepository=r;this._configuration=new p.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[h.Transparency.TRANSPARENT]:{[h.Transparency.TRANSPARENT]:new g,[h.Transparency.OPAQUE]:new g},
[h.Transparency.OPAQUE]:{[h.Transparency.TRANSPARENT]:new g,[h.Transparency.OPAQUE]:new g}};this._renderablesDirty=!1;this._drawParameters=new l.EdgeDrawParameters;this._settings={...x,...y};this.key=q.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:f.debugFlags.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=n[this._settings.type];
this._configuration.silhouette=!1;this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=v.driverTest.doublePrecisionRequiresObfuscation.result;this._configuration.spherical=y.spherical}dispose(){this._technique=b.releaseMaybe(this._technique)}addRenderable(v){this._renderables.add(v);this._renderablesDirty=!0}removeRenderable(v){this._renderables.delete(v);this._renderablesDirty=
!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(v,r){this._renderablesDirty&&this._sortRenderables();r=this._sortedRenderables[r];r[h.Transparency.TRANSPARENT].forAll(v);r[h.Transparency.OPAQUE].forAll(v)}updateTechnique(v,r){this._configuration.multipassEnabled=!!v.multipassEnabled;this._configuration.cullAboveGround=!!v.multipassTerrain.cullAboveGround;this._configuration.silhouette=r;return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(e.EdgeShaderTechnique,
this._configuration,this._technique)}bindRegularEdges(v,r){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(r,!1),v,r)}bindSilhouetteEdges(v,r){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(r,!0),v,r)}renderRegularEdges(v,r,y,z,D){this._render(v,r,r.regular.vao,y,z,D)}renderSilhouetteEdges(v,r,y,z,D){this._render(v,r,r.silhouette.vao,y,z,D)}_render(v,r,y,z,D,C){0<C&&(this._bindDraw(v,r,z,D),this._rctx.bindVAO(y),this._rctx.drawArraysInstanced(w.PrimitiveType.TRIANGLE_FAN,
0,4,C))}_bindDraw(v,r,y,z){this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(v.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),v.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const D=
new c.TwoVectorPosition(r.transform.position),C=d.transpose(t,d.invert(t,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=D.low;this._drawParameters.transformWorldFromModelTH=D.high;this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale;this._drawParameters.transformNormalGlobalFromModel=C;r=z.camera.viewInverseTransposeMatrix;m.set(this._drawParameters.slicePlaneLocalOrigin,r[3],r[7],r[11])}v.bindDraw(this._drawParameters,z,y)}_sortRenderables(){this._renderablesDirty=
!1;this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.TRANSPARENT].clear();this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.OPAQUE].clear();this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.TRANSPARENT].clear();this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.OPAQUE].clear();this._renderables.forEach(r=>{r.objectTransparency!==h.Transparency.INVISIBLE&&r.edgeTransparency!==h.Transparency.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});
const v=(r,y)=>"origin"in r.transform?"origin"in y.transform?r.transform.origin.origin.id<y.transform.origin.origin.id?-1:r.transform.origin.origin.id>y.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.TRANSPARENT].sort(v);this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.OPAQUE].sort(v);this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.TRANSPARENT].sort(v);this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.OPAQUE].sort(v)}static getKey(v,
r,y){return`edges-t:${v}:${r}:${y}`}}const t=k.create();a.EdgeRenderer=q;a.extensionLengthOffset=128;a.lineWidthFractionFactor=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports","../../../../../chunks/mat3f64","../../../../../chunks/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,b,g,d){class k extends d.VertexPositionPassParameters{constructor(f,c){super();
this.distanceFalloffFactor=f;this.transparency=c;this.transformNormalViewFromGlobal=b.create()}}class m extends d.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=b.create();this.slicePlaneLocalOrigin=g.create();this.transformNormalGlobalFromModel=b.create()}}a.EdgeDrawParameters=m;a.EdgePassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l){class e extends d.ShaderTechnique{initializeProgram(p){return new k.Program(p.rctx,e.shader.get().build(this.configuration),m.EdgeShaderAttributeLocations)}initializePipeline(p){return p.blendMinMax?l.makePipelineState({blending:l.separateBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE,c.BlendFactor.ZERO,c.BlendFactor.ONE,c.BlendOperation.ADD,p.blendMinMax.MAX),depthTest:{func:c.CompareFunction.LEQUAL},colorWrite:l.defaultColorWriteParams}):l.makePipelineState({depthTest:{func:c.CompareFunction.LEQUAL},
depthWrite:l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams})}}e.shader=new g.ReloadableShaderModule(f.EdgeShader,()=>new Promise((p,h)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],p,h)));b.EdgeShaderTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Uniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){function r(D){const C=new e.ShaderBuilder,{vertex:E,fragment:A}=C;D.legacy&&E.uniforms.add(new z("model"),new z("localView"));C.include(u.AdjustProjectedPosition,D);C.include(n.EdgeUtil,D);C.include(q.LineAmplitude,D);C.include(v.UnpackAttributes,D);C.include(t.LineOffset,D);C.include(d.SliceDraw,D);C.include(x.DiscardNonSilhouetteEdges,D);C.include(w.DiscardByCoverage,D);C.include(k.multipassTerrainTest,D);C.varyings.add("vColor","vec4");C.varyings.add("vRadius",
"float");C.varyings.add("vPosition","vec3");C.varyings.add("vWorldPosition","vec3");D.multipassEnabled&&C.varyings.add("vViewPos","vec3");C.varyings.add("vLineLengthPixels","float");C.varyings.add("vSizeFalloffFactor","float");E.uniforms.add(new m.Float2PassUniform("pixelToNDC",(F,G)=>b.set(y,2/G.camera.fullViewport[2],2/G.camera.fullViewport[3])),new f.Float4PassUniform("viewport",(F,G)=>G.camera.fullViewport),new c.FloatPassUniform("pixelRatio",(F,G)=>G.camera.pixelRatio));C.attributes.add(h.VertexAttribute.POSITION0,
"vec3");C.attributes.add(h.VertexAttribute.POSITION1,"vec3");C.attributes.add(h.VertexAttribute.VARIANTOFFSET,"float");C.attributes.add(h.VertexAttribute.VARIANTSTROKE,"float");C.attributes.add(h.VertexAttribute.VARIANTEXTENSION,"float");E.code.add(l.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${D.multipassEnabled?"vViewPos \x3d viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${D.antialiasing?l.glsl`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:l.glsl`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${D.mode===n.EdgeUtilMode.SKETCH?l.glsl`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:D.mode===n.EdgeUtilMode.MIXED?l.glsl`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);A.code.add(l.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${D.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `);return C}const y=g.create();class z extends p.Uniform{constructor(D){super(D,"mat4")}}g=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=g;a.build=r})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform".split(" "),
function(a,b,g,d,k,m,f){const c=b.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(l,e){l=l.vertex;l.include(g.IsNaN);l.constants.add("depthBias","vec2",c);l.uniforms.add(new d.Float2PassUniform("inverseViewport",(p,h)=>h.inverseViewport));e.legacy?(l.uniforms.add(new f.Matrix4PassUniform("proj",(p,h)=>h.camera.projectionMatrix)),l.code.add(k.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(l.uniforms.add(new m.Matrix3PassUniform("transformNormalViewFromGlobal",p=>p.transformNormalViewFromGlobal),new f.Matrix4PassUniform("transformProjFromView",p=>p.transformProjFromView)),l.code.add(k.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));l.code.add(k.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(g){const d=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;g.code.add(d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(g,d){g=g.fragment;g.constants.add("coverageTestThreshold","float",.01);d.antialiasing?g.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):g.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(g,d){g=g.vertex;d.silhouette?(g.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),d.legacy?g.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):g.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):g.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){a.EdgeUtilMode=void 0;(function(w){w[w.SOLID=0]="SOLID";w[w.SKETCH=1]="SKETCH";w[w.MIXED=2]="MIXED";w[w.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeSilhouette=void 0;(function(w){w[w.REGULAR=0]="REGULAR";w[w.SILHOUETTE=1]="SILHOUETTE"})(a.EdgeSilhouette||(a.EdgeSilhouette={}));a.EdgeUtil=function(w,x){const n=w.vertex;n.include(d.RgbaFloatEncoding);n.uniforms.add(new f.FloatPassUniform("distanceFalloffFactor",q=>q.distanceFalloffFactor));n.code.add(c.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);n.uniforms.add(new h.Texture2DDrawUniform("componentDataTex",q=>q.componentDataTexture));w.attributes.add(u.VertexAttribute.COMPONENTINDEX,"float");n.constants.add("componentColorFieldOffset","float",0);n.constants.add("componentOtherFieldOffset","float",1);n.constants.add("componentVerticalOffsetFieldOffset","float",2);n.constants.add("componentFieldCount","float",3);n.constants.add("lineWidthFractionFactor","float",8);n.constants.add("extensionLengthOffset","float",128);n.constants.add("verticalOffsetScale",
"float",2*b.maxElevationOffset);n.code.add(c.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`);x.legacy?n.code.add(c.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(n.uniforms.add(new l.Matrix3DrawUniform("transformNormalGlobalFromModel",q=>q.transformNormalGlobalFromModel)),n.code.add(c.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));x.silhouette?(w.attributes.add(u.VertexAttribute.NORMALA,"vec3"),w.attributes.add(u.VertexAttribute.NORMALB,"vec3"),n.code.add(c.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(w.attributes.add(u.VertexAttribute.NORMAL,"vec3"),n.code.add(c.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));x.legacy?n.code.add(c.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(n.include(g.DoublePrecision,x),n.uniforms.add(new e.Matrix3PassUniform("transformViewFromCameraRelativeRS",q=>q.transformViewFromCameraRelativeRS),new l.Matrix3DrawUniform("transformWorldFromModelRS",q=>q.transformWorldFromModelRS),new k.Float3DrawUniform("transformWorldFromModelTL",q=>q.transformWorldFromModelTL),new k.Float3DrawUniform("transformWorldFromModelTH",q=>q.transformWorldFromModelTH),new m.Float3PassUniform("transformWorldFromViewTL",q=>q.transformWorldFromViewTL),new m.Float3PassUniform("transformWorldFromViewTH",
q=>q.transformWorldFromViewTH)),n.code.add(c.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${x.spherical?c.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:c.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));n.uniforms.add(new p.Matrix4PassUniform("transformProjFromView",(q,t)=>t.camera.projectionMatrix));n.code.add(c.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);n.code.add(c.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(w){return w.mode===a.EdgeUtilMode.SKETCH||w.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(w){return w.mode===a.EdgeUtilMode.SOLID||w.mode===a.EdgeUtilMode.MIXED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatDrawUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],
function(a,b,g,d,k){a.LineAmplitude=function(m,f){const c=m.vertex;m.include(k.UnpackAttributes,f);switch(f.mode){case d.EdgeUtilMode.SOLID:c.code.add(g.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case d.EdgeUtilMode.SKETCH:c.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",l=>l.strokesTexture.amplitude));c.code.add(g.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case d.EdgeUtilMode.MIXED:c.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",l=>l.strokesTexture.amplitude)),c.code.add(g.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,g,d,k){a.UnpackAttributes=function(m,f){const c=m.vertex;m.attributes.add(d.VertexAttribute.SIDENESS,"vec2");f.mode===k.EdgeUtilMode.MIXED?c.code.add(g.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):c.code.add(g.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(f.mode){case k.EdgeUtilMode.MIXED:c.code.add(g.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case k.EdgeUtilMode.SKETCH:c.code.add(g.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case k.EdgeUtilMode.SOLID:c.code.add(g.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case k.EdgeUtilMode.COUNT:break;default:b.neverReached(f.mode)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/FloatDrawUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DDrawUniform ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(a,b,g,d,k,m,
f){class c extends d.NoParameters{}a.LineOffset=function(l,e){l.include(f.UnpackAttributes,e);const {vertex:p,fragment:h}=l;m.usesSketchLogic(e)&&(p.uniforms.add(new k.Texture2DDrawUniform("strokesTexture",u=>u.strokesTexture.texture)),p.uniforms.add(new g.FloatDrawUniform("strokesLog2Resolution",u=>Math.log2(u.strokesTexture.resolution)),new g.FloatDrawUniform("strokeVariants",u=>u.strokesTexture.variants)),l.varyings.add("vStrokeUV","vec2"),h.uniforms.add(new k.Texture2DDrawUniform("strokesTexture",
u=>u.strokesTexture.texture),new g.FloatDrawUniform("strokesNormalizationScale",u=>u.strokesTexture.normalizationScale)),p.code.add(d.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),l.fragment.include(b.RgbaFloatEncoding),h.code.add(d.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(e.mode){case m.EdgeUtilMode.SOLID:p.code.add(d.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);h.code.add(d.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case m.EdgeUtilMode.SKETCH:p.code.add(d.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);h.code.add(d.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case m.EdgeUtilMode.MIXED:l.varyings.add("vType","float"),p.code.add(d.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),h.code.add(d.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};a.LineOffsetDrawParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/tslib.es6","../../core/shaderTechnique/ShaderTechniqueConfiguration","../../materials/DefaultTechniqueConfiguration","../../shaders/sources/edgeRenderer/EdgeUtil.glsl"],function(a,b,g,d,k){class m extends d.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.mode=k.EdgeUtilMode.SOLID;this.spherical=this.cullAboveGround=this.multipassEnabled=this.doublePrecisionRequiresObfuscation=this.antialiasing=this.legacy=this.silhouette=this.hasSlicePlane=!1}}b.__decorate([g.parameter({count:k.EdgeUtilMode.COUNT})],m.prototype,"mode",void 0);b.__decorate([g.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([g.parameter()],m.prototype,"silhouette",void 0);b.__decorate([g.parameter()],m.prototype,"legacy",void 0);b.__decorate([g.parameter()],m.prototype,
"antialiasing",void 0);b.__decorate([g.parameter()],m.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([g.parameter()],m.prototype,"multipassEnabled",void 0);b.__decorate([g.parameter()],m.prototype,"cullAboveGround",void 0);b.__decorate([g.parameter()],m.prototype,"spherical",void 0);b.__decorate([g.parameter({constValue:!1})],m.prototype,"occlusionPass",void 0);a.EdgeShaderTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["exports",
"../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./edgeProcessing"],function(a,b,g,d,k){class m extends g.WorkerHandle{constructor(c){super("EdgeProcessingWorker","extract",{extract:l=>[l.dataBuffer],extractComponentsEdgeLocations:l=>[l.dataBuffer],extractEdgeLocations:l=>[l.dataBuffer]},c)}async process(c,l,e){if(e)return k.extract(c);c=await this.invoke(new f(c),l);return this._unpackOutput(c)}async extractEdgeLocations(c,l){c=
await this.invokeMethod("extractEdgeLocations",new f(c),l);return d.unpackInterleavedBuffer(c)}async extractComponentsEdgeLocations(c,l){c=await this.invokeMethod("extractComponentsEdgeLocations",new f(c),l);return d.unpackInterleavedBuffer(c)}_unpackOutput(c){return{regular:{instancesData:d.unpackInterleavedBuffer(c.regular.instancesData),lodInfo:{lengths:new Float32Array(c.regular.lodInfo.lengths)}},silhouette:{instancesData:d.unpackInterleavedBuffer(c.silhouette.instancesData),lodInfo:{lengths:new Float32Array(c.silhouette.lodInfo.lengths)}},
averageEdgeLength:c.averageEdgeLength}}}class f{constructor(c){this.dataBuffer=c.data.buffer;this.writerSettings=c.writerSettings;this.skipDeduplicate=c.skipDeduplicate;this.indices=b.isArray(c.indices)?c.indices:c.indices.buffer;this.indicesType=b.isArray(c.indices)?"Array":b.isUint32Array(c.indices)?"Uint32Array":"Uint16Array";this.indicesLength=c.indicesLength}}a.EdgeWorkerHandle=m;a.PackedInput=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports",
"./InterleavedLayout"],function(a,b){a.packInterleavedBuffer=function(g,d){d.push(g.buffer);return{buffer:g.buffer,layout:new b.PackedLayout(g.layout)}};a.unpackInterleavedBuffer=function(g){return(new b.InterleavedLayout(g.layout)).createView(g.buffer)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports","../../../../../core/floatRGBA","../../../../../core/maybe","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],
function(a,b,g,d,k){function m(e,p){if(!e)return null;var h=e.length/2;const u=.1*h;h=Array(h);let w=0;p=p===f.PRESSURE;for(let x=0;x<e.length;x+=2){const n=(e[x]+e[x+1])/2;p?h[w++]=Math.min(u,1-.5*(1-n)):h[w++]=Math.min(u,.5*n)}return h}var f;(function(e){e[e.DISTANCE=0]="DISTANCE";e[e.PRESSURE=1]="PRESSURE"})(f||(f={}));class c{constructor(e,p,h,u,w){this.resolution=e;this.normalizationScale=p;this.amplitude=h;this.variants=u;this.texture=w}dispose(){this.texture=g.disposeMaybe(this.texture)}}const l=
{amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,
-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,
.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,
-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,
.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,
.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,
.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,
-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,
-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,
1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,
.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,
-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,
.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,
.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,
.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,
.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,
4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,
3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,
1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],
pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,
.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,
.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,
.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,
2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,
-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,
.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,
2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,
.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,
.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,
.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,
-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,
.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,
.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,
-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,
.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,
.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,
.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,
.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,
6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,
.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,
-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,
3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,
.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,
.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,
.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=c;a.generateStrokesTexture=function(e){const p=l.resolution;var h=p/2;const u=new Uint8Array(4*
p*p),w=4*p*h;h=l.amplitude;const x=2*h,n=4*p,q=Math.log2(p)+1,t=l.strokes.length;let v=(q-1)*t*n;for(const {distance:r,pressure:y}of l.strokes){let z=r,D=y,C=v;for(let E=0;E<q;E++){0!==E&&(z=m(z,f.DISTANCE),D=m(D,f.PRESSURE));for(let A=0;A<l.resolution;A++){const F=D?D[A%D.length]:1;b.packFloatRGBA((z?z[A%z.length]/x:0)+.5,u,C);b.packFloatRGBA(F,u,C+w);C+=4}C-=n*(t+1)}v+=n}e=new d.Texture(e,new k.TextureDescriptor(p),u);return new c(p,x,h,t,e)};a.strokesDefinition=l;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","./interfaces"],function(a,b){a.determineEdgeTransparency=function(g){let d=b.Transparency.INVISIBLE;for(const {material:k}of g)if(0<k.size*k.color[3]*k.opacity){if(1>k.color[3]*k.opacity)return b.Transparency.TRANSPARENT;d=b.Transparency.OPAQUE}return d};a.determineObjectTransparency=function(g){let d=b.Transparency.INVISIBLE;for(const {material:k}of g)if(0<k.size*k.color[3]*k.opacity){switch(k.objectTransparency){case b.Transparency.TRANSPARENT:case b.Transparency.INVISIBLE:return b.Transparency.TRANSPARENT;
case b.Transparency.OPAQUE:if(1>k.opacity)return b.Transparency.TRANSPARENT}d=b.Transparency.OPAQUE}return d};a.determineRendererType=function(g){let d=null;for(const k of g)if(g=k.type,0<k.size*k.color[3])if(null==d)d=g;else if(d!==g)return"uber";return null!=d?d:"uber"};a.fillComponenBufferIndices=function(g,d,k,m){for(let c=0;c<g.length;c++){const l=g[c].index;var f=d[c];const e=d[c+1];if(m)for(;f<e;f++)k.set(m[f],l);else for(;f<e;f++)k.set(f,l)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define(["exports","../../../../core/maybe","../../../../core/PerformanceSampler","../../../../core/time","../../../webgl/TimerPool"],function(a,b,g,d,k){a.PerformanceCategory=void 0;(function(f){f.OVERLAY="overlay";f.PREPARE="prepare";f.SHADOW_MAP="shadow map";f.LINEAR_DEPTH="linear depth";f.ACCUMULATED_SHADOWS="accumulated shadows";f.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";f.SSAO="SSAO";f.OPAQUE="opaque";f.OPAQUE_EDGES=
"opaque edges";f.VOXEL="voxel";f.TRANSPARENT="transparent";f.TRANSPARENT_EDGES="transparent edges";f.HUD_VISIBILITY="HUD visibility";f.TRANSPARENT_TERRAIN="transparent terrain";f.ENVIRONMENT="environment";f.LASER_LINES="laser lines";f.OCCLUDED="occluded";f.ANTIALIASING="antialiasing";f.HIGHLIGHTS="highlights";f.HUD="HUD";f.HUD_OCCLUDED="HUD occluded";f.FINISH="finish"})(a.PerformanceCategory||(a.PerformanceCategory={}));class m{constructor(f){this._rctx=f;this._startTimeStampCPU=d.Milliseconds(0);
this._lastTimeStampCPU=d.Milliseconds(0);this._totalCPUTime=new g("Total");this._cpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(c=>[c,new g(c)]));this._enableGPUTimer=0;this._totalGPUTime=new g("GPU");this._gpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(c=>[c,new g(c)]));this._totalTime=d.Milliseconds(0);this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=
this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return d.Milliseconds(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const c=[...Object.values(a.PerformanceCategory),"Total"];this._gpuTimerPool=k.createElapsedTimerPool(this._rctx,c)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let f=!1;return{hasGPUTimerSupport:!0,remove:()=>
{f||(f=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=b.disposeMaybe(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=d.Milliseconds(performance.now());this._gpuTimerPool&&this._gpuTimerPool.start()}advance(f){var c=d.Milliseconds(performance.now());this._cpuTimeSamplers.get(f).record(c-this._lastTimeStampCPU);this._lastTimeStampCPU=c;this._gpuTimerPool&&(c=this._gpuTimerPool.stop(f),this._gpuTimeSamplers.get(f).record(c),this._gpuTimerPool.start())}finishFrame(){if(this._gpuTimerPool){var f=
this._gpuTimerPool.stop(a.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(a.PerformanceCategory.FINISH).record(f);this._rctx.gl.flush()}f=d.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=d.Milliseconds(this._totalTime+f);this._totalCPUTime.record(f);this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((c,l)=>c+(l.last||0),0));++this._totalFrameCount}}a.RendererPerformanceInfo=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TimerPool":function(){define(["exports",
"./capabilities/DisjointTimerQuery"],function(a,b){class g{constructor(d,k){this._timer=d;this._queryPool=[];this._queryResults=new Map;this._currentQuery=null;k.forEach(m=>{const f=this._timer.createQuery(),c=this._timer.createQuery();this._queryPool.push(f,c);this._queryResults.set(m,null)})}start(){b.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(d){if(this._timer.disjoint()||
null==this._currentQuery||!this._queryResults.has(d))return this.abort(),null;this._timer.endTimeElapsed();const k=this._queryResults.get(d);if(null==k)return this._queryResults.set(d,this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(k))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const m=this._timer.getResult(k)/1E6;this._queryPool.unshift(k);this._queryResults.set(d,this._currentQuery);this._currentQuery=null;return m}abort(){null!=this._currentQuery&&
(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(d=>{this._timer.deleteQuery(d)});this._queryResults.forEach(d=>{null!=d&&this._timer.deleteQuery(d)})}}a.createElapsedTimerPool=function(d,k){d=d.capabilities.disjointTimerQuery;return null==d?null:new g(d,k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports",
"./isWebGL2Context"],function(a,b){class g{constructor(d,k,m,f,c,l,e,p,h){this.createQuery=d;this.deleteQuery=k;this.resultAvailable=m;this.getResult=f;this.disjoint=c;this.beginTimeElapsed=l;this.endTimeElapsed=e;this.createTimestamp=p;this.timestampBits=h}}a.hasRunningElapsedTimer=!1;a.DisjointTimerQuery=g;a.createDisjointTimerQuery=function(d,k){if(k.disjointTimerQuery)return null;let m=d.getExtension("EXT_disjoint_timer_query_webgl2");return m&&b(d)?new g(()=>d.createQuery(),f=>{d.deleteQuery(f);
a.hasRunningElapsedTimer=!1},f=>d.getQueryParameter(f,d.QUERY_RESULT_AVAILABLE),f=>d.getQueryParameter(f,d.QUERY_RESULT),()=>d.getParameter(m.GPU_DISJOINT_EXT),f=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,d.beginQuery(m.TIME_ELAPSED_EXT,f))},()=>{d.endQuery(m.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},f=>m.queryCounterEXT(f,m.TIMESTAMP_EXT),()=>d.getQuery(m.TIMESTAMP_EXT,m.QUERY_COUNTER_BITS_EXT)):(m=d.getExtension("EXT_disjoint_timer_query"))?new g(()=>m.createQueryEXT(),f=>{m.deleteQueryEXT(f);
a.hasRunningElapsedTimer=!1},f=>m.getQueryObjectEXT(f,m.QUERY_RESULT_AVAILABLE_EXT),f=>m.getQueryObjectEXT(f,m.QUERY_RESULT_EXT),()=>d.getParameter(m.GPU_DISJOINT_EXT),f=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,m.beginQueryEXT(m.TIME_ELAPSED_EXT,f))},()=>{m.endQueryEXT(m.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},f=>m.queryCounterEXT(f,m.TIMESTAMP_EXT),()=>m.getQueryEXT(m.TIMESTAMP_EXT,m.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports","../effects/ScreenSpaceGeometry","../../../webgl/AppleAmdDriverHelper","../../../webgl/RenderingContext"],function(a,b,g,d){class k extends d.RenderingContext{constructor(m,f,c){super(m,f);this.gl=m;this.newCache=c;this._appleAmdDriverHelper=
null;this._refCount=1;this.screen=new b.ScreenSpaceGeometry(this)}destroy(){0<--this._refCount||this.dispose()}ref(){++this._refCount}dispose(){super.dispose();this._appleAmdDriverHelper?.dispose();this.screen.destroy()}bindTechnique(m,f,c,l){this.useProgram(m.program);this.setPipelineState(m.getPipeline(!!l));m.program.bindPass(f,c);return m.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new g.AppleAmdDriverHelper(this)),
this._appleAmdDriverHelper.run())}get test(){return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(this._appleAmdDriverHelper?.test.cachedWebGLObjects??0)}}}a.RenderingContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ScreenSpaceGeometry":function(){define(["exports","../../../../core/maybe","../lib/glUtil3D","../../../webgl/enums"],function(a,b,g,d){class k{constructor(m){this._rctx=
m;this._vao=g.createScreenSizeTriangleVAO(m)}destroy(){this._vao=b.disposeMaybe(this._vao)}draw(){null!=this._vao&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(d.PrimitiveType.TRIANGLES,0,3))}get test(){return{cachedWebGLObjects:(null!=this._vao?.glName?1:0)+(null!=this._vao?.indexBuffer?.glName?1:0)+(null!=this._vao?.vertexBuffers.geometry?1:0)}}}a.ScreenSpaceGeometry=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports",
"./BufferObject","./enums"],function(a,b,g){class d{constructor(k){this._rctx=k;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const k=
d.getShaderSources();return this._rctx.programCache.acquire(k.vertex,k.fragment,new Map([]))}_createIndexbuffer(){return b.BufferObject.createIndex(this._rctx,g.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,g.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(g.PrimitiveType.POINTS,1,g.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?
1:0}}}a.AppleAmdDriverHelper=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./contextUtils ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){function t(r,y,z,D){y?
D!==y&&r.bindBuffer(z,y.glName):r.bindBuffer(z,null);return y}function v(r,y){switch(r){case c.PrimitiveType.POINTS:return 2*y;case c.PrimitiveType.TRIANGLES:return y/3;case c.PrimitiveType.TRIANGLE_STRIP:return y-2;case c.PrimitiveType.TRIANGLE_FAN:return y-2;default:return 0}}a.RenderingContext=class{constructor(r,y){this.gl=r;this.instanceCounter=new l.InstanceCounter;this.programCache=new p.ProgramCache(this);this._state=new m.ContextState;this._numOfTriangles=this._numOfDrawCalls=0;this.type=
q(r)?f.ContextType.WEBGL2:f.ContextType.WEBGL1;this._loadExtensions();this.configure(y)}get gl2(){return this.type===f.ContextType.WEBGL1?null:this.gl}configure(r){this._capabilities=new n.Capabilities(this.gl,r);this._parameters=new e.Parameters(this.gl,this._capabilities,r);u.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new m.ContextState;this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]};this._stateTracker=
new h.StateTracker({setBlending:y=>{y?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(y.opRgb,y.opAlpha),this.setBlendFunctionSeparate(y.srcRgb,y.dstRgb,y.srcAlpha,y.dstAlpha),y=y.color,this.setBlendColor(y.r,y.g,y.b,y.a)):this.setBlendingEnabled(!1)},setCulling:y=>{y?(this.setFaceCullingEnabled(!0),this.setCullFace(y.face),this.setFrontFace(y.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:y=>{y?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(y.factor,y.units)):this.setPolygonOffsetFillEnabled(!1)},
setDepthTest:y=>{y?(this.setDepthTestEnabled(!0),this.setDepthFunction(y.func)):this.setDepthTestEnabled(!1)},setStencilTest:y=>{if(y){this.setStencilTestEnabled(!0);const z=y.function;this.setStencilFunction(z.func,z.ref,z.mask);y=y.operation;this.setStencilOp(y.fail,y.zFail,y.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:y=>{y?(this.setDepthWriteEnabled(!0),this.setDepthRange(y.zNear,y.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:y=>{y?this.setColorMask(y.r,y.g,y.b,y.a):this.setColorMask(!1,
!1,!1,!1)},setStencilWrite:y=>{y?this.setStencilWriteMask(y.mask):this.setStencilWriteMask(0)},setDrawBuffers:y=>{const {drawBuffers:z}=this._capabilities;y?z?.drawBuffers(y.buffers):({drawFramebuffer:y}=this._state,null===y||0===y.colorAttachments.length?z?.drawBuffers([c.SpecialDrawBuffers.BACK]):z?.drawBuffers([c.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();b.disposeMaybe(this._driverTest);this._driverTest=new x.WebGLDriverTest(this)}dispose(){b.disposeMaybe(this._driverTest);this.programCache.dispose();
this.bindVAO(null);this.unbindBuffer(c.BufferType.ARRAY_BUFFER);this.unbindBuffer(c.BufferType.ELEMENT_ARRAY_BUFFER);this.type===f.ContextType.WEBGL2&&(this.unbindBuffer(c.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(c.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(c.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(c.BufferType.COPY_READ_BUFFER),this.unbindBuffer(c.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;k.webglDebugEnabled()&&
console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(r){this._stateTracker.setPipeline(r)}setBlendingEnabled(r){this._state.blend!==r&&(!0===r?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=r,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();this._state.program=null}externalTextureUnitUpdate(r,
y){for(let z=0;z<r.length;++z)this._state.textureUnitMap[r[z]]=null;0<=y&&(this._state.activeTexture=y)}externalVertexArrayObjectUpdate(){const r=this.capabilities.vao;r&&(r.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(r,y,z,D){if(r!==this._state.blendColor.r||y!==this._state.blendColor.g||z!==this._state.blendColor.b||
D!==this._state.blendColor.a)this.gl.blendColor(r,y,z,D),this._state.blendColor.r=r,this._state.blendColor.g=y,this._state.blendColor.b=z,this._state.blendColor.a=D,this._stateTracker.invalidateBlending()}setBlendFunction(r,y){if(r!==this._state.blendFunction.srcRGB||y!==this._state.blendFunction.dstRGB)this.gl.blendFunc(r,y),this._state.blendFunction.srcRGB=r,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=y,this._state.blendFunction.dstAlpha=y,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(r,
y,z,D){if(this._state.blendFunction.srcRGB!==r||this._state.blendFunction.srcAlpha!==z||this._state.blendFunction.dstRGB!==y||this._state.blendFunction.dstAlpha!==D)this.gl.blendFuncSeparate(r,y,z,D),this._state.blendFunction.srcRGB=r,this._state.blendFunction.srcAlpha=z,this._state.blendFunction.dstRGB=y,this._state.blendFunction.dstAlpha=D,this._stateTracker.invalidateBlending()}setBlendEquation(r){this._state.blendEquation.mode!==r&&(this.gl.blendEquation(r),this._state.blendEquation.mode=r,this._state.blendEquation.modeAlpha=
r,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(r,y){if(this._state.blendEquation.mode!==r||this._state.blendEquation.modeAlpha!==y)this.gl.blendEquationSeparate(r,y),this._state.blendEquation.mode=r,this._state.blendEquation.modeAlpha=y,this._stateTracker.invalidateBlending()}setColorMask(r,y,z,D){if(this._state.colorMask.r!==r||this._state.colorMask.g!==y||this._state.colorMask.b!==z||this._state.colorMask.a!==D)this.gl.colorMask(r,y,z,D),this._state.colorMask.r=r,this._state.colorMask.g=
y,this._state.colorMask.b=z,this._state.colorMask.a=D,this._stateTracker.invalidateColorWrite()}setClearColor(r,y,z,D){if(this._state.clearColor.r!==r||this._state.clearColor.g!==y||this._state.clearColor.b!==z||this._state.clearColor.a!==D)this.gl.clearColor(r,y,z,D),this._state.clearColor.r=r,this._state.clearColor.g=y,this._state.clearColor.b=z,this._state.clearColor.a=D}setFaceCullingEnabled(r){this._state.faceCulling!==r&&(!0===r?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),
this._state.faceCulling=r,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(r){this._state.polygonOffsetFill!==r&&(!0===r?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=r,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(r,y){if(this._state.polygonOffset[0]!==r||this._state.polygonOffset[1]!==y)this._state.polygonOffset[0]=r,this._state.polygonOffset[1]=y,this.gl.polygonOffset(r,y),this._stateTracker.invalidatePolygonOffset()}setCullFace(r){this._state.cullFace!==
r&&(this.gl.cullFace(r),this._state.cullFace=r,this._stateTracker.invalidateCulling())}setFrontFace(r){this._state.frontFace!==r&&(this.gl.frontFace(r),this._state.frontFace=r,this._stateTracker.invalidateCulling())}setScissorTestEnabled(r){this._state.scissorTest!==r&&(!0===r?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=r)}setScissorRect(r,y,z,D){if(this._state.scissorRect.x!==r||this._state.scissorRect.y!==y||this._state.scissorRect.width!==
z||this._state.scissorRect.height!==D)this.gl.scissor(r,y,z,D),this._state.scissorRect.x=r,this._state.scissorRect.y=y,this._state.scissorRect.width=z,this._state.scissorRect.height=D}setDepthTestEnabled(r){this._state.depthTest!==r&&(!0===r?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=r,this._stateTracker.invalidateDepthTest())}setClearDepth(r){this._state.clearDepth!==r&&(this.gl.clearDepth(r),this._state.clearDepth=r)}setDepthFunction(r){this._state.depthFunction!==
r&&(this.gl.depthFunc(r),this._state.depthFunction=r,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(r){this._state.depthWrite!==r&&(this.gl.depthMask(r),this._state.depthWrite=r,this._stateTracker.invalidateDepthWrite())}setDepthRange(r,y){if(this._state.depthRange.zNear!==r||this._state.depthRange.zFar!==y)this.gl.depthRange(r,y),this._state.depthRange.zNear=r,this._state.depthRange.zFar=y,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(r){this._state.stencilTest!==
r&&(!0===r?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=r,this._stateTracker.invalidateStencilTest())}setClearStencil(r){r!==this._state.clearStencil&&(this.gl.clearStencil(r),this._state.clearStencil=r)}setStencilFunction(r,y,z){if(this._state.stencilFunction.func!==r||this._state.stencilFunction.ref!==y||this._state.stencilFunction.mask!==z)this.gl.stencilFunc(r,y,z),this._state.stencilFunction.face=c.Face.FRONT_AND_BACK,this._state.stencilFunction.func=
r,this._state.stencilFunction.ref=y,this._state.stencilFunction.mask=z,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(r,y,z,D){if(this._state.stencilFunction.face!==r||this._state.stencilFunction.func!==y||this._state.stencilFunction.ref!==z||this._state.stencilFunction.mask!==D)this.gl.stencilFuncSeparate(r,y,z,D),this._state.stencilFunction.face=r,this._state.stencilFunction.func=y,this._state.stencilFunction.ref=z,this._state.stencilFunction.mask=D,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(r){this._state.stencilWriteMask!==
r&&(this.gl.stencilMask(r),this._state.stencilWriteMask=r,this._stateTracker.invalidateStencilWrite())}setStencilOp(r,y,z){if(this._state.stencilOperation.face!==c.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==r||this._state.stencilOperation.zFail!==y||this._state.stencilOperation.zPass!==z)this.gl.stencilOp(r,y,z),this._state.stencilOperation.face=c.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=y,this._state.stencilOperation.zPass=z,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(r,
y,z,D){if(this._state.stencilOperation.face!==r||this._state.stencilOperation.fail!==y||this._state.stencilOperation.zFail!==z||this._state.stencilOperation.zPass!==D)this.gl.stencilOpSeparate(r,y,z,D),this._state.stencilOperation.face=r,this._state.stencilOperation.fail=y,this._state.stencilOperation.zFail=z,this._state.stencilOperation.zPass=D,this._stateTracker.invalidateStencilTest()}setActiveTexture(r,y=!1){const z=this._state.activeTexture;0<=r&&(y||r!==this._state.activeTexture)&&(this.gl.activeTexture(c.baseTextureUnit+
r),this._state.activeTexture=r);return z}clear(r){r&&this.gl.clear(r)}clearSafe(r,y=255){r&&(r&c.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),r&c.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),r&c.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(y),this.gl.clear(r))}drawArrays(r,y,z){k.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=v(r,z));this.gl.drawArrays(r,y,z);k.checkWebGLError(this.gl)}drawArraysInstanced(r,y,z,D){this.gl2?.drawArraysInstanced(r,
y,z,D);k.checkWebGLError(this.gl)}drawElements(r,y,z,D){k.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=v(r,y));this.gl.drawElements(r,y,z,D);if(k.webglDebugEnabled()){const C=w.getErrorString(this);if(C){const E=this.getBoundVAO(),A=E?.indexBuffer,F=A?.size??0,G=D+y;console.error(`drawElements: ${C}${F<G?`. Buffer is too small. Attempted to draw index ${G} of ${F}`:""}`,{args:{mode:r,count:y,type:z,offset:D},vao:{indexBuffer:A,vertexBuffers:E?.vertexBuffers}})}}}logInfo(){k.webglDebugEnabled()&&
console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){k.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(r,y,z,D){z=Math.max(Math.round(z),1);D=Math.max(Math.round(D),1);const C=this._state.viewport;if(C.x!==r||C.y!==y||C.width!==z||C.height!==D)C.x=r,C.y=y,C.width=z,C.height=D,this.gl.viewport(r,y,z,D)}setViewport4fv(r){this.setViewport(r[0],r[1],r[2],r[3])}getViewport(){const r=
this._state.viewport;return{x:r.x,y:r.y,width:r.width,height:r.height}}useProgram(r){this._state.program!==r&&(this._state.program?.stop(),this._state.program=r,this.gl.useProgram(r?.glName??null))}bindTexture(r,y,z=!1){(y>=this.parameters.maxTextureImageUnits||0>y)&&console.error("Input texture unit is out of range of available units!");const D=this._state.textureUnitMap[y];if(null==r?.glName)return null!=D&&(this.setActiveTexture(y,z),this.gl.bindTexture(D.descriptor.target,null)),this._state.textureUnitMap[y]=
null,D;if(!z&&D===r)return r.isDirty&&(this.setActiveTexture(y,z),r.applyChanges()),D;this.setActiveTexture(y,z);this.gl.bindTexture(r.descriptor.target,r.glName);r.applyChanges();this._state.textureUnitMap[y]=r;return D}unbindTexture(r){if(null!=r)for(let y=0;y<this.parameters.maxTextureImageUnits;y++)this._state.textureUnitMap[y]===r&&(this.bindTexture(null,y),this._state.textureUnitMap[y]=null)}bindFramebuffer(r,y=!1){if(y||this._state.readFramebuffer!==r||this._state.drawFramebuffer!==r)this._stateTracker.invalidateDrawBuffers(),
null==r?(this.gl.bindFramebuffer(c.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(r.initializeAndBind(c.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=r,this._state.drawFramebuffer=r)}bindFramebufferSeparate(r,y,z=!1){const D=y===c.FramebufferTarget.READ_FRAMEBUFFER,C=D?this._state.readFramebuffer:this._state.drawFramebuffer;if(z||C!==r)null==r?this.gl.bindFramebuffer(y,null):r.initializeAndBind(y),D?this._state.readFramebuffer=
r??null:this._state.drawFramebuffer=r??null}blitFramebuffer(r,y,z=0,D=0,C=r.width,E=r.height,A=0,F=0,G=y.width,I=y.height,H=c.ClearBufferBit.COLOR_BUFFER_BIT,B=c.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(r,c.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(y,c.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(z,D,C,E,A,F,G,I,H,B)}bindBuffer(r,y){if(r)switch(y??(y=r.bufferType),y){case c.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=t(this.gl,r,y,this._state.vertexBuffer);
break;case c.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=t(this.gl,r,y,this._state.indexBuffer);break;case c.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=t(this.gl,r,y,this._state.uniformBuffer);break;case c.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=t(this.gl,r,y,this._state.pixelPackBuffer);break;case c.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=t(this.gl,r,y,this._state.pixelUnpackBuffer);break;case c.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=
t(this.gl,r,y,this._state.copyReadBuffer);break;case c.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=t(this.gl,r,y,this._state.copyWriteBuffer)}}bindRenderbuffer(r){const y=this.gl;r||(y.bindRenderbuffer(y.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==r&&(y.bindRenderbuffer(y.RENDERBUFFER,r.glName),this._state.renderbuffer=r)}_getBufferBinding(r,y){if(y>=this.parameters.maxUniformBufferBindings||0>y)return console.error("Uniform buffer binding point is out of range!"),
null;r=this._state.uniformBufferBindingPoints;let z=r[y];null==z&&(z={buffer:null,offset:0,size:0},r[y]=z);return z}bindBufferBase(r,y,z){const D=this._getBufferBinding(r,y);null==D||D.buffer===z&&0===D.offset&&0===D.size||(this.gl.bindBufferBase(r,y,z?z.glName:null),D.buffer=z,D.offset=0,D.size=0)}bindBufferRange(r,y,z,D,C){const E=this._getBufferBinding(r,y);null==E||E.buffer===z&&E.offset===D&&E.size===C||(0!==D%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):
(this.gl.bindBufferRange(r,y,z.glName,D,C),E.buffer=z,E.offset=D,E.size=C))}bindUBO(r,y,z,D){null==y?this.bindBufferBase(c.BufferType.UNIFORM_BUFFER,r,null):(k.webglDebugEnabled()&&(D??y.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),y.initialize(),void 0!==z&&void 0!==D?this.bindBufferRange(c.BufferType.UNIFORM_BUFFER,r,y.buffer,z,D):this.bindBufferBase(c.BufferType.UNIFORM_BUFFER,r,y.buffer))}unbindUBO(r){for(let y=
0,z=this._state.uniformBufferBindingPoints.length;y<z;y++){const D=this._state.uniformBufferBindingPoints[y];null!=D&&D.buffer===r.buffer&&this.bindBufferBase(c.BufferType.UNIFORM_BUFFER,y,null)}}unbindBuffer(r){switch(r){case c.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=t(this.gl,null,r,this._state.vertexBuffer);break;case c.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=t(this.gl,null,r,this._state.indexBuffer);break;case c.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=t(this.gl,
null,r,this._state.uniformBuffer);break;case c.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=t(this.gl,null,r,this._state.pixelPackBuffer);break;case c.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=t(this.gl,null,r,this._state.pixelUnpackBuffer);break;case c.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=t(this.gl,null,r,this._state.copyReadBuffer);break;case c.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=t(this.gl,null,r,this._state.copyWriteBuffer)}}bindVAO(r=
null){null==r?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==r&&(r.bind(),this._state.vertexArrayObject=r)}async clientWaitAsync(r=d.Milliseconds(10)){const y=this.gl,z=y.fenceSync(c.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!z)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(c.ResourceType.Sync,z);y.flush();let D;do await g.after(r),D=y.clientWaitSync(z,0,
0);while(D===c.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(c.ResourceType.Sync,z);y.deleteSync(z);if(D===c.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");}getBoundFramebufferObject(r=c.FramebufferTarget.FRAMEBUFFER){return r===c.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(c.BufferType.ARRAY_BUFFER);
this.unbindBuffer(c.BufferType.ELEMENT_ARRAY_BUFFER);this.type===f.ContextType.WEBGL2&&(this.unbindBuffer(c.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(c.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(c.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(c.BufferType.COPY_READ_BUFFER),this.unbindBuffer(c.BufferType.COPY_WRITE_BUFFER));for(let r=0;r<this.parameters.maxTextureImageUnits;++r)this.bindTexture(null,r);this.setBlendingEnabled(!1);this.setBlendFunction(c.BlendFactor.ONE,
c.BlendFactor.ZERO);this.setBlendEquation(c.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(c.Face.BACK);this.setFrontFace(c.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(c.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(c.CompareFunction.ALWAYS,
0,0);this.setStencilOp(c.StencilOperation.KEEP,c.StencilOperation.KEEP,c.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r=this.capabilities.vao;r&&r.bindVertexArray(null);const {gl:y,gl2:z}=this;for(var D=0;D<this.parameters.maxVertexAttributes;D++)y.disableVertexAttribArray(D);
this._state.vertexBuffer?y.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):y.bindBuffer(c.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?y.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):y.bindBuffer(c.BufferType.ELEMENT_ARRAY_BUFFER,null);if(null!=z){this._state.uniformBuffer?z.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):z.bindBuffer(c.BufferType.UNIFORM_BUFFER,null);for(D=0;D<this._parameters.maxUniformBufferBindings;D++){const C=
this._state.uniformBufferBindingPoints[D];if(null!=C){const {buffer:E,offset:A,size:F}=C;null!==E?0===A&&0===F?z.bindBufferBase(c.BufferType.UNIFORM_BUFFER,D,E.glName):z.bindBufferRange(c.BufferType.UNIFORM_BUFFER,D,E.glName,A,F):z.bindBufferBase(c.BufferType.UNIFORM_BUFFER,D,null)}}this._state.pixelPackBuffer?z.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):z.bindBuffer(c.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?z.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):z.bindBuffer(c.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?z.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):z.bindBuffer(c.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?z.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):z.bindBuffer(c.BufferType.COPY_WRITE_BUFFER,null);z.bindFramebuffer(c.FramebufferTarget.READ_FRAMEBUFFER,null);z.readBuffer(z.BACK);this._state.readFramebuffer&&
(z.bindFramebuffer(c.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),z.readBuffer(c.ColorAttachment.COLOR_ATTACHMENT0));z.bindFramebuffer(c.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,y.bindFramebuffer(c.FramebufferTarget.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(r&&this._state.vertexArrayObject){if(r=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(r)}y.useProgram(this._state.program?.glName??null);y.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);y.bindRenderbuffer(y.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?y.enable(this.gl.BLEND):y.disable(this.gl.BLEND);y.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);y.blendFuncSeparate(this._state.blendFunction.srcRGB,
this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);y.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);y.clearDepth(this._state.clearDepth);y.clearStencil(this._state.clearStencil);y.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);y.cullFace(this._state.cullFace);y.depthFunc(this._state.depthFunction);y.depthRange(this._state.depthRange.zNear,
this._state.depthRange.zFar);!0===this._state.depthTest?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST);y.depthMask(this._state.depthWrite);y.frontFace(this._state.frontFace);y.lineWidth(1);!0===this._state.faceCulling?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE);y.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?y.enable(y.POLYGON_OFFSET_FILL):y.disable(y.POLYGON_OFFSET_FILL);y.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,
this._state.scissorRect.height);!0===this._state.scissorTest?y.enable(y.SCISSOR_TEST):y.disable(y.SCISSOR_TEST);y.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);y.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST);y.stencilMask(this._state.stencilWriteMask);
for(r=0;r<this.parameters.maxTextureImageUnits;r++)y.activeTexture(c.baseTextureUnit+r),y.bindTexture(c.TextureType.TEXTURE_2D,null),y.bindTexture(c.TextureType.TEXTURE_CUBE_MAP,null),this.type===f.ContextType.WEBGL2&&(y.bindTexture(c.TextureType.TEXTURE_3D,null),y.bindTexture(c.TextureType.TEXTURE_2D_ARRAY,null)),D=this._state.textureUnitMap[r],null!=D&&y.bindTexture(D.descriptor.target,D.glName);y.activeTexture(c.baseTextureUnit+this._state.activeTexture);r=this._state.viewport;y.viewport(r.x,r.y,
r.width,r.height);this.resetInfo()}_loadExtensions(){this.type===f.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,b){class g{constructor(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,
dstAlpha:b.BlendFactor.ZERO};this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];
this.stencilFunction={face:b.Face.FRONT_AND_BACK,func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];
this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}a.ContextState=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../support/AllocationTracer","./enums"],function(a,b,g){const d={RECORD_ALLOCATIONS:!1};class k{constructor(){this._current=[];for(this._allocations=new b.AllocationTracer(d.RECORD_ALLOCATIONS);this._current.length<g.ResourceType.COUNT;)this._current.push(0)}increment(m,
f,c=1){this._current[m]+=c;this._allocations.add(f)}decrement(m,f,c=1){this._current[m]-=c;this._allocations.remove(f)}get current(){return this._current}get total(){return this.current.reduce((m,f,c)=>m+(c<g.ResourceType.UNCOUNTED?f:0),0)}get resourceInformation(){let m="";if(0<this.total){m+="Live objects:\n";for(let f=0;f<g.ResourceType.COUNT;++f){const c=this._current[f];0<c&&(m+=`${g.ResourceType[f]}: ${c}\n`)}}return m+=this._allocations.information}}a.InstanceCounter=k;a.test=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/support/AllocationTracer":function(){define(["exports"],function(a){class b{constructor(g){this._allocations=new Map;g?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}add(g){this._allocations.set(g,Error().stack)}remove(g){this._allocations.delete(g)}get information(){let g="";if(0<this._allocations.size){g+=`${this._allocations.size} live object allocations:\n`;const d=new Map;this._allocations.forEach(k=>{d.set(k,(d.get(k)??
0)+1)});d.forEach((k,m)=>{m=m.split("\n");m.shift();m.shift();g+=`${k}: ${m.shift()}\n`;m.forEach(f=>g+=`   ${f}\n`)})}return g}}a.AllocationTracer=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports","./capabilities/isWebGL2Context"],function(a,b){class g{constructor(d,k,m){k=k.textureFilterAnisotropic;m=m.maxAnisotropy??Infinity;this.versionString=d.getParameter(d.VERSION);this.maxVertexTextureImageUnits=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
this.maxVertexAttributes=d.getParameter(d.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=k?Math.min(d.getParameter(k.MAX_TEXTURE_MAX_ANISOTROPY),m):1;this.maxTextureImageUnits=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=d.getParameter(d.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=d.getParameter(d.MAX_VIEWPORT_DIMS);b(d)?(this.maxUniformBufferBindings=d.getParameter(d.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=d.getParameter(d.MAX_VERTEX_UNIFORM_BLOCKS),
this.maxFragmentUniformBlocks=d.getParameter(d.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=d.getParameter(d.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=d.getParameter(d.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=d.getParameter(d.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=d.getParameter(d.MAX_SAMPLES)):(this.maxUniformBlockSize=this.maxFragmentUniformBlocks=this.maxVertexUniformBlocks=this.maxUniformBufferBindings=0,this.maxSamples=this.maxArrayTextureLayers=
this.uniformBufferOffsetAlignment=1)}}a.Parameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../core/NestedMap","./Program"],function(a,b,g){class d{constructor(k){this._rctx=k;this._store=new b.NestedMap}dispose(){this._store.forEach(k=>k.forEach(m=>m.dispose()));this._store.clear()}acquire(k,m,f,c){const l=this._store.get(k,m);if(null!=l)return l.ref(),l;f=new g.Program(this._rctx,k,m,f,c);f.ref();this._store.set(k,
m,f);return f}get test(){let k=0;this._store.forEach(m=>m.forEach(f=>k+=f.hasGLName?2:1));return{cachedWebGLProgramObjects:k}}}a.ProgramCache=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define("exports ../../core/arrayUtils ../../core/has ./checkWebGLError ./contextUtils ./enums ./ShaderTranspiler".split(" "),function(a,b,g,d,k,m,f){function c(u,w,x){u=u.gl;const n=u.createShader(w);u.shaderSource(n,x);u.compileShader(n);d.webglValidateShadersEnabled()&&
!u.getShaderParameter(n,u.COMPILE_STATUS)&&(console.error("Compile error in ".concat(w===m.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(u.getShaderInfoLog(n)),console.error(l(x)));return n}function l(u){let w=2;return u.replaceAll("\n",()=>{var x=w++;x=1E3<=x?x.toString():("  "+x).slice(-3);return"\n"+x+":"})}function e(u,w,x){const n=u.get(w);return n?b.update(n,x):(u.set(w,Array.from(x)),!0)}class p{constructor(u,w,x,n,q=new Map){this._context=u;this._locations=n;this._uniformBlockBindings=
q;this._refCount=1;this._compiled=!1;this._linesOfCode=0;this._nameToUniformLocation=new Map;this._nameToUniform1=new Map;this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;u||console.error("RenderingContext isn't initialized!");0===w.length&&console.error("Shaders source should not be empty!");this._context.type===k.ContextType.WEBGL2&&(w=f.transpileShader(w,m.ShaderType.VERTEX_SHADER),
x=f.transpileShader(x,m.ShaderType.FRAGMENT_SHADER));this._vShader=c(this._context,m.ShaderType.VERTEX_SHADER,w);this._fShader=c(this._context,m.ShaderType.FRAGMENT_SHADER,x);h.enabled&&(this._linesOfCode=w.match(/\n/g).length+x.match(/\n/g).length+2,this._context.instanceCounter.increment(m.ResourceType.LinesOfCode,this._vShader,this._linesOfCode));this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(m.ResourceType.Shader,this);d.webglValidateShadersEnabled()&&
(this.vertexShader=w,this.fragmentShader=x);const t=this._context.gl,v=t.createProgram();t.attachShader(v,this._vShader);t.attachShader(v,this._fShader);this._locations.forEach((r,y)=>t.bindAttribLocation(v,r,y));t.linkProgram(v);d.webglValidateShadersEnabled()&&!t.getProgramParameter(v,t.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${t.getProgramParameter(v,t.VALIDATE_STATUS)}`+`, gl error ${t.getError()}`+`, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}`+`, fragment: ${t.getShaderParameter(this._fShader,
t.COMPILE_STATUS)}`+`, info log: ${t.getProgramInfoLog(v)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===k.ContextType.WEBGL2)for(const [r,y]of this._uniformBlockBindings)u=t.getUniformBlockIndex(v,r),4294967295>u&&t.uniformBlockBinding(v,u,y);this._glName=v;this._context.instanceCounter.increment(m.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get compiled(){if(this._compiled)return!0;
const u=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==u||null==this.glName?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,u.COMPLETION_STATUS_KHR)}dispose(){if(!(0<--this._refCount)){var u=this._context.gl,w=this._context.instanceCounter;this._nameToUniformLocation.forEach(x=>x&&w.decrement(m.ResourceType.Uniform,x));this._nameToUniformLocation.clear();this._vShader&&(0<this._linesOfCode&&(w.decrement(m.ResourceType.LinesOfCode,this._vShader,
this._linesOfCode),this._linesOfCode=0),u.deleteShader(this._vShader),this._vShader=null,w.decrement(m.ResourceType.Shader,this));this._fShader&&(u.deleteShader(this._fShader),this._fShader=null);this._glName&&(u.deleteProgram(this._glName),this._glName=null,w.decrement(m.ResourceType.Program,this))}}ref(){++this._refCount}_getUniformLocation(u){var w=this._nameToUniformLocation.get(u);return void 0!==w?w:this.glName?(w=this._context.gl.getUniformLocation(this.glName,u),this._nameToUniformLocation.set(u,
w),w&&this._context.instanceCounter.increment(m.ResourceType.Uniform,w),w):null}hasUniform(u){return null!=this._getUniformLocation(u)}setUniform1i(u,w){const x=this._nameToUniform1.get(u);if(void 0===x||w!==x)this._context.gl.uniform1i(this._getUniformLocation(u),w),this._nameToUniform1.set(u,w)}setUniform1iv(u,w){e(this._nameToUniform1v,u,w)&&this._context.gl.uniform1iv(this._getUniformLocation(u),w)}setUniform2iv(u,w){e(this._nameToUniform2,u,w)&&this._context.gl.uniform2iv(this._getUniformLocation(u),
w)}setUniform3iv(u,w){e(this._nameToUniform3,u,w)&&this._context.gl.uniform3iv(this._getUniformLocation(u),w)}setUniform4iv(u,w){e(this._nameToUniform4,u,w)&&this._context.gl.uniform4iv(this._getUniformLocation(u),w)}setUniform1f(u,w){const x=this._nameToUniform1.get(u);if(void 0===x||w!==x)this._context.gl.uniform1f(this._getUniformLocation(u),w),this._nameToUniform1.set(u,w)}setUniform1fv(u,w){e(this._nameToUniform1v,u,w)&&this._context.gl.uniform1fv(this._getUniformLocation(u),w)}setUniform2f(u,
w,x){const n=this._nameToUniform2.get(u);if(void 0===n)this._context.gl.uniform2f(this._getUniformLocation(u),w,x),this._nameToUniform2.set(u,[w,x]);else if(w!==n[0]||x!==n[1])this._context.gl.uniform2f(this._getUniformLocation(u),w,x),n[0]=w,n[1]=x}setUniform2fv(u,w){e(this._nameToUniform2,u,w)&&this._context.gl.uniform2fv(this._getUniformLocation(u),w)}setUniform3f(u,w,x,n){const q=this._nameToUniform3.get(u);if(void 0===q)this._context.gl.uniform3f(this._getUniformLocation(u),w,x,n),this._nameToUniform3.set(u,
[w,x,n]);else if(w!==q[0]||x!==q[1]||n!==q[2])this._context.gl.uniform3f(this._getUniformLocation(u),w,x,n),q[0]=w,q[1]=x,q[2]=n}setUniform3fv(u,w){e(this._nameToUniform3,u,w)&&this._context.gl.uniform3fv(this._getUniformLocation(u),w)}setUniform4f(u,w,x,n,q){const t=this._nameToUniform4.get(u);if(void 0===t)this._context.gl.uniform4f(this._getUniformLocation(u),w,x,n,q),this._nameToUniform4.set(u,[w,x,n,q]);else if(void 0===t||w!==t[0]||x!==t[1]||n!==t[2]||q!==t[3])this._context.gl.uniform4f(this._getUniformLocation(u),
w,x,n,q),t[0]=w,t[1]=x,t[2]=n,t[3]=q}setUniform4fv(u,w){e(this._nameToUniform4,u,w)&&this._context.gl.uniform4fv(this._getUniformLocation(u),w)}setUniformMatrix3fv(u,w,x=!1){e(this._nameToUniformMatrix3,u,w)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(u),x,w)}setUniformMatrix4fv(u,w,x=!1){e(this._nameToUniformMatrix4,u,w)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(u),x,w)}stop(){}}const h={enabled:!1};a.Program=p;a.test=h;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(a,b,g,d,k,m){function f(){function q(O){O.length&&H.push({type:w[A],data:O,position:L,line:B,column:K})}function t(){I=I.length?[]:I;if("/"===G&&"*"===F)return L=E+C-1,A=0,G=F,C+1;if("/"===G&&"/"===F)return L=E+C-1,A=1,G=F,C+1;if("#"===F)return A=2,L=E+C,C;if(/\s/.test(F))return A=9,L=E+C,C;J=/\d/.test(F);M=/[^\w_]/.test(F);
L=E+C;A=J?4:M?3:9999;return C}function v(){if(("\r"===F||"\n"===F)&&"\\"!==G)return q(I.join("")),A=999,C;I.push(F);G=F;return C+1}function r(){if("."===G&&/\d/.test(F))return A=5,C;if("/"===G&&"*"===F)return A=0,C;if("/"===G&&"/"===F)return A=1,C;if("."===F&&I.length){for(;y(I););A=5;return C}if(";"===F||")"===F||"("===F){if(I.length)for(;y(I););q(F);A=999;return C+1}var O=2===I.length&&"\x3d"!==F;if(/[\w_\d\s]/.test(F)||O){for(;y(I););A=999;return C}I.push(F);G=F;return C+1}function y(O){var U=
0;do{var Z=m.operators.indexOf(O.slice(0,O.length+U).join(""));var P=m.operators[Z];if(-1===Z){if(0<U--+O.length)continue;P=O.slice(0,1).join("")}q(P);L+=P.length;I=I.slice(P.length);return I.length}while(1)}function z(){if("."===F||/[eE]/.test(F))return I.push(F),A=5,G=F,C+1;if("x"===F&&1===I.length&&"0"===I[0])return A=11,I.push(F),G=F,C+1;if(/[^\d]/.test(F))return q(I.join("")),A=999,C;I.push(F);G=F;return C+1}function D(){"f"===F&&(I.push(F),G=F,C+=1);if(/[eE]/.test(F)||"-"===F&&/[eE]/.test(G))return I.push(F),
G=F,C+1;if(/[^\d]/.test(F))return q(I.join("")),A=999,C;I.push(F);G=F;return C+1}var C=0,E=0,A=999,F,G,I=[],H=[],B=1,K=0,L=0,J=!1,M=!1,T="",Q;return function(O){H=[];if(null!==O){O=O.replace?O.replace(/\r\n/g,"\n"):O;C=0;T+=O;for(Q=T.length;F=T[C],C<Q;){O=C;switch(A){case 0:"/"===F&&"*"===G?(I.push(F),q(I.join("")),A=999):(I.push(F),G=F);C+=1;break;case 1:C=v();break;case 2:C=v();break;case 3:C=r();break;case 4:C=z();break;case 11:/[^a-fA-F0-9]/.test(F)?(q(I.join("")),A=999):(I.push(F),G=F,C+=1);
break;case 5:C=D();break;case 9999:if(/[^\d\w_]/.test(F)){var U=I.join("");A=-1<m.literals.indexOf(U)?8:-1<m.builtins.indexOf(U)?7:6;q(I.join(""));A=999}else I.push(F),G=F,C+=1;break;case 9:/[^\s]/g.test(F)?(q(I.join("")),A=999):(I.push(F),G=F,C+=1);break;case 999:C=t()}if(O!==C)switch(T[O]){case "\n":K=0;++B;break;default:++K}}E+=C;T=T.slice(C);return H}I.length&&q(I.join(""));A=10;q("(eof)");return H}}function c(q){return q.map(t=>"eof"!==t.type?t.data:"").join("")}function l(q,t="100",v="300 es"){const r=
/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const y of q)if("preprocessor"===y.type){const z=r.exec(y.data);if(z){q=z[1].replaceAll(/\s\s+/g," ");if(q===v)return q;if(q===t)return y.data="#version "+v,t;throw Error("unknown glsl version: "+q);}}q.splice(0,0,{type:"preprocessor",data:"#version "+v},{type:"whitespace",data:"\n"});return null}function e(q,t,v,r){r=r||v;for(const y of q)if("ident"===y.type&&y.data===v)return r in t?t[r]++:t[r]=0,e(q,t,r+"_"+t[r],r);return v}function p(q,t,v="afterVersion"){const r=
{data:"\n",type:"whitespace"},y=D=>D<q.length?/[^\r\n]$/.test(q[D].data):!1;let z=function(D){let C=-1,E=0,A=-1;for(let G=0;G<D.length;G++){var F=D[G];"preprocessor"===F.type&&(/#(if|ifdef|ifndef)\s+.+/.test(F.data)?++E:/#endif\s*.*/.test(F.data)&&--E);("afterVersion"===v||"afterPrecision"===v)&&"preprocessor"===F.type&&F.data.startsWith("#version")&&(A=Math.max(A,G));if("afterPrecision"===v&&"keyword"===F.type&&"precision"===F.data){a:{for(F=G;F<D.length;F++){const I=D[F];if("operator"===I.type&&
";"===I.data)break a}F=null}if(null===F)throw Error("precision statement not followed by any semicolons!");A=Math.max(A,F)}C<A&&0===E&&(C=G)}return C+1}(q);y(z-1)&&q.splice(z++,0,r);for(const D of t)q.splice(z++,0,D);y(z-1)&&y(z)&&q.splice(z,0,r)}function h(q,t,v,r="lowp"){p(q,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}
function u(q,t,v,r,y="lowp"){p(q,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",
data:";"}],"afterPrecision")}var w="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const x=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]),n=new Map;a.transpileShader=function(q,t){if(q.startsWith("#version 300"))return q;var v=k.shaderTranspiler.enableCache?n.get(q):null;if(null!=v)return v;v=f();var r=[];r=r.concat(v(q));v=r=r.concat(v(null));if("300 es"===l(v,
"100","300 es"))return q;var y=r=null;const z={},D={};for(let F=0;F<v.length;++F){const G=v[F];switch(G.type){case "keyword":t===g.ShaderType.VERTEX_SHADER&&"attribute"===G.data?G.data="in":"varying"===G.data&&(G.data=t===g.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(G.data.trim())&&(G.data=G.data.replaceAll(/(2D|Cube|EXT)/g,""));t===g.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===G.data&&(r||(r=e(v,z,"fragColor"),h(v,r,"vec4")),G.data=
r);if(t===g.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===G.data){var C=void 0;let I=void 0;var E=v,A=F+1;let H=-1;for(;A<E.length;A++){const B=E[A];if("operator"===B.type&&("["===B.data&&(I=A),"]"===B.data)){C=A;break}"integer"===B.type&&(H=parseInt(B.data,10))}I&&C&&E.splice(I,C-I+1);E=H;C=e(v,z,"fragData");u(v,C,"vec4",E,"mediump");G.data=C}else t===g.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===G.data&&(y||(y=e(v,z,"gl_FragDepth")),G.data=y);break;case "ident":if(d.includes(G.data)){if(E=t===
g.ShaderType.VERTEX_SHADER)a:{for(E=F-1;0<=E;E--)if(C=v[E],"whitespace"!==C.type&&"block-comment"!==C.type)if("keyword"===C.type){if("attribute"===C.data||"in"===C.data){E=!0;break a}}else break;E=!1}if(E)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");G.data in D||(D[G.data]=e(v,z,G.data));G.data=D[G.data]}}}for(t=v.length-1;0<=t;--t)r=v[t],"preprocessor"===r.type&&((y=r.data.match(/#extension\s+(.*):/))&&y[1]&&x.has(y[1].trim())&&(y=v[t+1],v.splice(t,
y&&"whitespace"===y.type?2:1)),(y=r.data.match(/#ifdef\s+(.*)/))&&y[1]&&x.has(y[1].trim())&&(r.data="#if 1"),(y=r.data.match(/#ifndef\s+(.*)/))&&y[1]&&x.has(y[1].trim())&&(r.data="#if 0"));v=c(v);k.shaderTranspiler.enableCache&&n.set(q,v);return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports","./_commonjsHelpers"],function(a,b){var g={exports:{}};g.exports;(function(m){(function(f){f=f();void 0!==f&&(m.exports=f)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(g);
g=b.getDefaultExportFromCjs(g.exports);var d={exports:{}};d.exports;(function(m){(function(f){f=f();void 0!==f&&(m.exports=f)})(function(){return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(d);d=b.getDefaultExportFromCjs(d.exports);var k={exports:{}};k.exports;(function(m){(function(f){f=f();void 0!==f&&(m.exports=f)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})(k);
b=b.getDefaultExportFromCjs(k.exports);a.builtins=b;a.literals=g;a.operators=d})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,b,g,d,k,m){class f{constructor(c){this.rctx=c;this.floatBufferBlend=new d.FloatBufferBlend(c);this.svgPremultipliesAlpha=new m.SVGPremultipliedAlpha(c);this.doublePrecisionRequiresObfuscation=new g.DoublePrecisionRequiresObfuscation(c);
this.ignoresSamplerPrecision=new k.IgnoresSamplerPrecision(c);this.drawArraysRequiresIndicesTypeReset=new b.DrawArraysRequiresIndicesTypeReset(c)}dispose(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}a.WebGLDriverTest=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./contextUtils ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends e.WebGLDriverTestModule{constructor(h){super();this._rctx=h;this._helperProgram=null;this._rctx.type===m.ContextType.WEBGL2&&b("mac")&&b("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(h){const u=this._rctx,w=u.getBoundFramebufferObject(),{x,y:n,width:q,height:t}=u.getViewport();u.resetState();var v=new l.TextureDescriptor(1);
v.wrapMode=f.TextureWrapMode.CLAMP_TO_EDGE;v.samplingMode=f.TextureSamplingMode.NEAREST;v=new c.FramebufferObject(u,v);const r=k.BufferObject.createIndex(this._rctx,f.Usage.STATIC_DRAW,new Uint8Array([0]));u.bindFramebuffer(v);u.setViewport(0,0,1,1);u.useProgram(this._helperProgram);u.bindBuffer(r,f.BufferType.ELEMENT_ARRAY_BUFFER);u.drawElements(f.PrimitiveType.POINTS,1,f.DataType.UNSIGNED_BYTE,0);u.useProgram(h);u.bindVAO(null);u.drawArrays(f.PrimitiveType.TRIANGLES,0,258);h=new Uint8Array(4);v.readPixels(0,
0,1,1,f.PixelFormat.RGBA,f.PixelType.UNSIGNED_BYTE,h);u.setViewport(x,n,q,t);u.bindFramebuffer(w);v.dispose();r.dispose();return 255===h[0]}_prepareProgram(){const h=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${g.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
u=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${g.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(h,u,new Map([]))}_prepareHelperProgram(){const h=d.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(h.vertex,h.fragment,new Map([]))}}a.DrawArraysRequiresIndicesTypeReset=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(a,b){class g{constructor(){this._result=!1}dispose(){this._program=b.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}a.WebGLDriverTestModule=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(n,q){return n.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${q?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class x extends u.WebGLDriverTestModule{constructor(n){super();this._rctx=n;this._program=w(this._rctx,!1);this._obfuscated=w(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=d.disposeMaybe(this._obfuscated)}_test(n){if(g("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;n=this._runProgram(n);const q=this._runProgram(this._obfuscated);
return 0!==n&&(0===q||5<n/q)}_runProgram(n){var q=this._rctx;q.resetState();var t=new e.TextureDescriptor(1);t.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;t.samplingMode=c.TextureSamplingMode.NEAREST;t=new l.FramebufferObject(q,t);var v=m.BufferObject.createVertex(q,c.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));v=new p.VertexArrayObject(q,new Map([["position",0]]),{geometry:[new h.VertexElementDescriptor("position",2,c.DataType.UNSIGNED_SHORT,0,4)]},{geometry:v});const r=k.fromValues(5633261.287538229,
2626832.878767164,1434988.0495278358),y=k.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),z=new Float32Array(6);f.encodeDoubleArray(r,z,3);const D=new Float32Array(6);f.encodeDoubleArray(y,D,3);q.useProgram(n);n.setUniform3f("u_highA",z[0],z[2],z[4]);n.setUniform3f("u_lowA",z[1],z[3],z[5]);n.setUniform3f("u_highB",D[0],D[2],D[4]);n.setUniform3f("u_lowB",D[1],D[3],D[5]);q.bindFramebuffer(t);q.setViewport(0,0,1,1);q.bindVAO(v);q.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4);n=new Uint8Array(4);
t.readPixels(0,0,1,1,c.PixelFormat.RGBA,c.PixelType.UNSIGNED_BYTE,n);v.dispose();t.dispose();q=(r[2]-y[2])/25;n=b.unpackFloatRGBA(n);return Math.abs(q-n)}}a.DoublePrecisionRequiresObfuscation=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./contextUtils ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){class h extends p.WebGLDriverTestModule{constructor(u){super();this._rctx=u;u.gl&&(u.type===d.ContextType.WEBGL1?this._result=!(!u.capabilities.textureFloat?.textureFloat||!u.capabilities.colorBufferFloat?.textureFloat):u.capabilities.textureFloat?.textureFloat&&u.capabilities.colorBufferFloat?.textureFloat&&u.capabilities.colorBufferFloat?.floatBlend&&(this._program=u.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]))))}_test(u){const w=this._rctx;var x=new c.TextureDescriptor(1);x.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;x.dataType=k.PixelType.FLOAT;x.internalFormat=k.SizedPixelFormat.RGBA32F;x.samplingMode=k.TextureSamplingMode.NEAREST;x=new m.FramebufferObject(w,x);var n=g.BufferObject.createVertex(w,k.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));n=new l.VertexArrayObject(w,
new Map([["a_pos",0]]),{geometry:[new e.VertexElementDescriptor("a_pos",2,k.DataType.UNSIGNED_SHORT,0,4)]},{geometry:n});w.useProgram(u);u=w.getBoundFramebufferObject();const {x:q,y:t,width:v,height:r}=w.getViewport();w.bindFramebuffer(x);w.setViewport(0,0,1,1);w.bindVAO(n);w.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4);var y=f.makePipelineState({blending:b.blendingAlpha});w.setPipelineState(y);w.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4);y=w.gl.getError();w.setViewport(q,t,v,r);w.bindFramebuffer(u);
n.dispose();x.dispose();return 1282===y?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0}}a.FloatBufferBlend=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,
b,g,d,k,m,f,c,l,e){class p extends e.WebGLDriverTestModule{constructor(h){super();this._rctx=h;this._program=h.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]))}_test(h){const u=this._rctx;var w=new f.TextureDescriptor(1);w.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;w.samplingMode=d.TextureSamplingMode.NEAREST;const x=new k.FramebufferObject(u,w),n=new Uint8Array(4);var q=g.BufferObject.createVertex(u,d.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));q=new c.VertexArrayObject(u,new Map([["a_position",
0]]),{geometry:[new l.VertexElementDescriptor("a_position",2,d.DataType.SHORT,0,4)]},{geometry:q});u.useProgram(h);w=new m.Texture(u,w,new Uint8Array([2,255,0,0]));h.setUniform1i("u_texture",0);u.bindTexture(w,0);w=u.getBoundFramebufferObject();u.bindFramebuffer(x);u.useProgram(h);const {x:t,y:v,width:r,height:y}=u.getViewport();u.setViewport(0,0,1,1);u.bindVAO(q);u.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);u.setViewport(t,v,r,y);x.readPixels(0,0,1,1,d.PixelFormat.RGBA,d.PixelType.UNSIGNED_BYTE,
n);q.dispose();x.dispose();(h=255!==n[0]||255!==n[1]||255!==n[2]||255!==n[3])&&b.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`);u.bindFramebuffer(w);return h}}
a.IgnoresSamplerPrecision=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(a,b,g,d,k,m,f,c,l){class e extends l.WebGLDriverTestModule{constructor(h){super();this._rctx=h;this._program=h.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(h){const u=this._rctx;if(!u.gl)return h.dispose(),!0;var w=new f.TextureDescriptor(1);w.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;w.samplingMode=d.TextureSamplingMode.NEAREST;w=new k.FramebufferObject(u,w);var x=g.BufferObject.createVertex(u,d.Usage.STATIC_DRAW,new Uint16Array([0,
0,1,0,0,1,1,1]));x=new c.VertexArrayObject(u,new Map([["a_pos",0]]),b.Pos2us,{geometry:x});var n=new f.TextureDescriptor;n.samplingMode=d.TextureSamplingMode.LINEAR;n.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;n=new m.Texture(u,n,p);u.useProgram(h);u.bindTexture(n,0);h.setUniform1i("u_texture",0);h=u.getBoundFramebufferObject();const {x:q,y:t,width:v,height:r}=u.getViewport();u.bindFramebuffer(w);u.setViewport(0,0,1,1);u.setClearColor(0,0,0,0);u.setBlendingEnabled(!1);u.clearSafe(d.ClearBufferBit.COLOR_BUFFER_BIT);
u.bindVAO(x);u.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);w.readPixels(0,0,1,1,d.PixelFormat.RGBA,d.PixelType.UNSIGNED_BYTE,y);x.dispose();w.dispose();n.dispose();u.setViewport(q,t,v,r);u.bindFramebuffer(h);return 255!==y[0]}}const p=new Image;p.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
p.width=5;p.height=5;p.decode();a.SVGPremultipliedAlpha=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,g){const d={geometry:[new g.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},k={geometry:[new g.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new g.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,
2,4)]};b={geometry:[new g.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=d;a.Pos2us=b;a.PosTex2b=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ./DisjointTimerQuery ./DrawBuffers ./load ./LoseContext ./VertexArrayObjects".split(" "),function(a,b,g,d,k,m){class f{constructor(c,l){this._gl=c;this._textureFloatLinear=this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=
this._minMaxBlending=this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=null;this._disabledExtensions=l.disabledExtensions||{};this._debugWebGLExtensions=l.debugWebGLExtensions||{}}get drawBuffers(){this._drawBuffers||(this._drawBuffers=g.load(this._gl,this._disabledExtensions));return this._drawBuffers}get vao(){this._vertexArrayObject||(this._vertexArrayObject=m.load(this._gl,this._disabledExtensions));
return this._vertexArrayObject}get compressedTextureETC(){this._compressedTextureETC||(this._compressedTextureETC=d.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC||(this._compressedTextureS3TC=d.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=d.loadTextureFilterAnisotropicCapability(this._gl,
this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery||(this._disjointTimerQuery=b.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get textureFloat(){this._textureFloat||(this._textureFloat=d.loadTextureFloat(this._gl,this._disabledExtensions));return this._textureFloat}get colorBufferFloat(){this._colorBufferFloat||(this._colorBufferFloat=d.loadColorBufferFloat(this._gl,this._disabledExtensions));
return this._colorBufferFloat}get blendMinMax(){this._minMaxBlending||(this._minMaxBlending=d.loadMinMaxBlending(this._gl,this._disabledExtensions));return this._minMaxBlending}get depthTexture(){null===this._depthTexture&&(this._depthTexture=d.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}get loseContext(){this._loseContext||(this._loseContext=k.load(this._gl,this._debugWebGLExtensions));
return this._loseContext}get textureNorm16(){this._textureNorm16||(this._textureNorm16=d.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}get textureFloatLinear(){null===this._textureFloatLinear&&(this._textureFloatLinear=d.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}enable(c){return this[c]}}a.Capabilities=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(g,d){return d.disjointTimerQuery?null:b(g)?{drawBuffers:g.drawBuffers.bind(g),MAX_DRAW_BUFFERS:g.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:g.MAX_COLOR_ATTACHMENTS}:d.drawBuffers?null:(g=g.getExtension("WEBGL_draw_buffers"))?{drawBuffers:g.drawBuffersWEBGL.bind(g),MAX_DRAW_BUFFERS:g.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:g.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(a,b){a.loadBooleanExtension=function(g,d,k,m,f){if(m&&b(g))return!0;if(d[k])return!1;for(const c of f)if(g.getExtension(c))return!0;return!1};a.loadColorBufferFloat=function(g,d){if(b(g)){var k=!d.colorBufferHalfFloat&&g.getExtension("EXT_color_buffer_half_float")||!d.colorBufferFloat&&g.getExtension("EXT_color_buffer_float"),m=!d.colorBufferFloat&&g.getExtension("EXT_color_buffer_float");
d=!d.floatBlend&&!d.colorBufferFloat&&g.getExtension("EXT_float_blend");return k||m||d?{textureFloat:!!m,textureHalfFloat:!!k,floatBlend:!!d,R16F:g.R16F,RG16F:g.RG16F,RGBA16F:g.RGBA16F,R32F:g.R32F,RG32F:g.RG32F,RGBA32F:g.RGBA32F,R11F_G11F_B10F:g.R11F_G11F_B10F,RGB16F:g.RGB16F}:null}return g instanceof WebGLRenderingContext?(k=!d.colorBufferHalfFloat&&g.getExtension("EXT_color_buffer_half_float"),m=!d.colorBufferFloat&&g.getExtension("WEBGL_color_buffer_float"),g=!d.floatBlend&&!d.colorBufferFloat&&
g.getExtension("EXT_float_blend"),k||m||g?{textureFloat:!!m,textureHalfFloat:!!k,floatBlend:!!g,RGBA16F:k?k.RGBA16F_EXT:void 0,RGB16F:k?k.RGB16F_EXT:void 0,RGBA32F:m?m.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(g,d){return d.compressedTextureETC?null:(g=g.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:g.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:g.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:g.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:g.COMPRESSED_SIGNED_RG11_EAC,
COMPRESSED_RGB8_ETC2:g.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:g.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:g.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:g.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(g,d){return d.compressedTextureS3TC?null:(g=g.getExtension("WEBGL_compressed_texture_s3tc"))?
{COMPRESSED_RGB_S3TC_DXT1:g.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:g.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:g.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:g.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=function(g,d){return b(g)?{MIN:g.MIN,MAX:g.MAX}:d.blendMinMax?null:(g=g.getExtension("EXT_blend_minmax"))?{MIN:g.MIN_EXT,MAX:g.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(g,d){return d.textureFilterAnisotropic?null:(g=g.getExtension("EXT_texture_filter_anisotropic")||
g.getExtension("MOZ_EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:g.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:g.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureFloat=function(g,d){if(b(g))return{textureFloat:!0,textureFloatLinear:!d.textureFloatLinear&&!!g.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:g.HALF_FLOAT,R16F:g.R16F,RG16F:g.RG16F,RGBA16F:g.RGBA16F,R32F:g.R32F,
RG32F:g.RG32F,RGBA32F:g.RGBA32F,R11F_G11F_B10F:g.R11F_G11F_B10F,RGB16F:g.RGB16F};if(g instanceof WebGLRenderingContext){const k=!d.textureHalfFloat&&g.getExtension("OES_texture_half_float");return{textureFloat:!d.textureFloat&&!!g.getExtension("OES_texture_float"),textureFloatLinear:!d.textureFloatLinear&&!!g.getExtension("OES_texture_float_linear"),textureHalfFloat:!!k,textureHalfFloatLinear:!d.textureHalfFloatLinear&&!!g.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:k?k.HALF_FLOAT_OES:
void 0}}return null};a.loadTextureNorm16=function(g,d){return!b(g)||d.textureNorm16?null:(g=g.getExtension("EXT_texture_norm16"))?{R16:g.R16_EXT,RG16:g.RG16_EXT,RGB16:g.RGB16_EXT,RGBA16:g.RGBA16_EXT,R16_SNORM:g.R16_SNORM_EXT,RG16_SNORM:g.RG16_SNORM_EXT,RGB16_SNORM:g.RGB16_SNORM_EXT,RGBA16_SNORM:g.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,g){const d=
g.loseContext&&b.getExtension("WEBGL_lose_context");return d?{loseRenderingContext:()=>d.loseContext()}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(g,d){return b(g)?{createVertexArray:g.createVertexArray.bind(g),deleteVertexArray:g.deleteVertexArray.bind(g),bindVertexArray:g.bindVertexArray.bind(g)}:d.vao?null:(g=g.getExtension("OES_vertex_array_object")||
g.getExtension("MOZ_OES_vertex_array_object")||g.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:g.createVertexArrayOES.bind(g),deleteVertexArray:g.deleteVertexArrayOES.bind(g),bindVertexArray:g.bindVertexArrayOES.bind(g)}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./ITexture ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){a.TextureRepository=class extends g{constructor(r,y,z){super({});this._stage=r;this._techniqueRepository=y;this._rctx=z;this._textures=new Map;this._loadingCount=0;this._frameUpdates=new Map;this.events=new d;this._frameTask=r.view.resourceController.scheduler.registerTask(t.TaskPriority.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove();this._stage.forEachOfType(u.ContentObjectType.Texture,r=>r.unload())}get updating(){return 0<
this._loadingCount||this._frameTask.updating}get textureTechnique(){null==this._textureTechnique&&(this._textureTechnique=this._techniqueRepository.acquire(x.TextureTechnique,new n.TextureTechniqueConfiguration));return this._textureTechnique}acquire(r){const y=this._textures.get(r);return y?(y.ref(),y.loadingPromise??y):this._createNewRef(r)}update(){let r=!1;this._frameUpdates.forEach(y=>{const z=y.texture.frameUpdate(y.previousToken);0<=z&&z!==y.previousToken&&(y.previousToken=z,r=!0)});r&&this.events.emit("changed",
h.RenderRequestType.BACKGROUND)}_createNewRef(r){const y=this._stage.getObject(r);if(null==y)return q.assert(void 0!==y),null;const z=y.events.on("unloaded",()=>{z.remove();this._onTextureUnloaded(r)}),D=new v(r,()=>{this._frameTask.schedule(()=>{D.isUnreferenced&&y.unload()})});this._textures.set(r,D);D.ref();if(y.glTexture)return this._updateGLTexture(D,y.glTexture),w.isFrameUpdateTexture(y)&&this._frameUpdates.set(r,{texture:y,previousToken:-1}),D;this._loadingCount++;D.loadingPromise=this._stage.schedule(()=>
{const C=y.load(this._rctx),E=F=>{this._loadingCount--;D.loadingPromise=null;this._updateGLTexture(D,F);w.isFrameUpdateTexture(y)&&this._frameUpdates.set(r,{texture:y,previousToken:-1});return D},A=F=>{this._loadingCount--;D.loadingPromise=null;m.isAbortError(F)||k.getLogger(this).error(F);return null};return m.isPromiseLike(C)?C.then(E,A):E(C)});return D.loadingPromise}_updateGLTexture(r,y){r.glTexture=y;this.events.emit("changed",h.RenderRequestType.UPDATE)}_onTextureUnloaded(r){this._textures.delete(r);
this._frameUpdates.delete(r)}};b.__decorate([f.property()],a.TextureRepository.prototype,"_loadingCount",void 0);b.__decorate([f.property()],a.TextureRepository.prototype,"_frameTask",void 0);b.__decorate([f.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=b.__decorate([p.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);class v{constructor(r,y){this.id=r;this._release=y;this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount;
0<this._refCount||(0===this._refCount?this._release():(k.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0))}}Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ITexture":function(){define(["exports"],function(a){a.isFrameUpdateTexture=function(b){return!!b.frameUpdate};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/markerTextureRepository":function(){define(["exports",
"../../support/engineContent/marker","./ProceduralTextureRepository"],function(a,b,g){a.createMarkerTextureRepository=function(d,k){return new g.ProceduralTextureRepository(m=>b.createMarkerTexture(m,d),m=>m,k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/asyncUtils ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){a.WaterTextureRepository=class extends d{constructor(){super(...arguments);this._passParameters=new r;this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=f.abortMaybe(this._resourcesTask);this._passParameters.waveNormal=f.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePerturbation=f.disposeMaybe(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&
!this._resourcesTask.finished}ensureResources(y){this._resourcesTask||(this._resourcesTask=k.createTask(async z=>{await Promise.allSettled([this._loadImageResource(y,g.getAssetUrl("esri/images/materials/water/normals.jpg"),D=>this._passParameters.waveNormal=D,z),this._loadImageResource(y,g.getAssetUrl("esri/images/materials/water/perturbation.jpg"),D=>this._passParameters.wavePerturbation=D,z)])}));return this._resourcesTask.finished?n.ResourceState.LOADED:n.ResourceState.LOADING}async _loadImageResource(y,
z,D,C){try{const E=await w.requestImage(z,{signal:C});c.throwIfAborted(C);const A=new v.TextureDescriptor(E.width,E.height);A.pixelFormat=q.PixelFormat.RGB;A.samplingMode=q.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;A.hasMipmap=!0;A.maxAnisotropy=8;D(new t.Texture(y,A,E))}catch(E){m.getLogger(this).error("Failed to load water material normal texture.",E)}}};b.__decorate([l.property()],a.WaterTextureRepository.prototype,"_resourcesTask",void 0);b.__decorate([l.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,
"updating",null);a.WaterTextureRepository=b.__decorate([u.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);class r extends x.NoParameters{}a.WaterTexturePassParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../core/FBOCache ../lib/basicInterfaces ../../../support/RenderState ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../core/imageUtils".split(" "),function(a,b,g,d,k,m,f,c,l,e){class p{constructor(u,w,x){this.parameters=u;this.frameHasDecorations=w;this.fbos=x}}class h{constructor(u,w,x){this._rctx=u;this._renderFunctions=
w;this._forceCameraHook=x;this.supersample=!0;this._screenshotQueue=[]}destroy(){this._rctx=null}async takeScreenshot(u){await this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(k.RenderRequestType.BACKGROUND);const w=b.createResolver();this._screenshotQueue.push({settings:u,resolver:w});return w.promise}update(u,w){for(const x of this._screenshotQueue){if(null==this._rctx){x.resolver.reject();continue}const n=this._renderScreenshot(u,{...x.settings,pixelRatio:x.settings.pixelRatio*
u.parameters.camera.pixelRatio},w);x.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(u,w,x){u.width=w.width;u.height=w.height;const n=u.getContext("2d"),q=x.pixelRatio;n.save();n.translate(0,w.height);n.scale(1,-1);x.region&&n.translate(-x.region.x,-x.region.y);n.scale(q,q);w=this._renderFunctions.renderOverlay(u,x.disableDecorations?k.Decorations.OFF:k.Decorations.ON,w);n.restore();return w}_readbackScreenshot(u,w){return u.resample?this._readbackScreenshotResampled({...u,resample:u.resample},
w):this._readbackScreenshotImmediate(u,w)}_readbackScreenshotResampled(u,w){const {framebufferWidth:x,framebufferHeight:n,region:q,resample:t}=u,v=this._ensureScreenshotEncodeCanvas();let r=e.createEmptyImageData(x,n,v);this._rctx.gl.readPixels(0,0,x,n,c.PixelFormat.RGBA,c.DataType.UNSIGNED_BYTE,new Uint8Array(r.data.buffer));w();r=this._renderScreenshotOverlay(v,r,{...u,region:void 0});u=e.createEmptyImageData(q.width,q.height,v);return f.resampleHermite(r,u,!0,t.region.x,n-(t.region.y+t.region.height),
t.region.width,t.region.height)}_readbackScreenshotImmediate(u,w){const {framebufferHeight:x,region:n}=u,q=this._ensureScreenshotEncodeCanvas(),t=e.createEmptyImageData(n.width,n.height,q);this._rctx.gl.readPixels(n.x,x-(n.y+n.height),n.width,n.height,c.PixelFormat.RGBA,c.DataType.UNSIGNED_BYTE,new Uint8Array(t.data.buffer));w();return this._renderScreenshotOverlay(q,t,u)}_renderScreenshot(u,w,x){var n=u.parameters.camera,q={width:w.framebufferWidth,height:w.framebufferHeight};l.ensureAttachmentMaxSize(q,
Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));var t=!1,v=w.disableDecorations&&u.frameHasDecorations,r=w.ignorePadding&&n.pixelRatio!==w.pixelRatio;v=q.width!==n.fullWidth||q.height!==n.fullHeight||v||r||w.objectAndLayerIdColor;let y=null;w.objectAndLayerIdColor&&(y=u.fbos.acquire(d.ColorFormat.RGBA,q.width,q.height),y.acquireDepth(d.DepthFormat.DEPTH_STENCIL_BUFFER));let z=null;if(v){t=n.clone();if(w.ignorePadding){r=g.clone(t.padding);for(var D=0;4>D;D++)r[D]=
Math.round(r[D]/t.pixelRatio*w.pixelRatio);t.padding=r}t.fullWidth=q.width;t.fullHeight=q.height;t.pixelRatio=w.pixelRatio;r=n.fovX-t.fovX;D=n.fovY-t.fovY;0>r&&r<D?t.fovX=n.fovX:0>D&&D<r&&(t.fovY=n.fovY);n={camera:t,contentCamera:t,mode:m.RenderState.IDLE,alignPixelEnabled:!0,contentPixelRatio:t.pixelRatio};this._forceCameraHook(n);t=!0;z=u.fbos.acquire(d.ColorFormat.RGBA,q.width,q.height);this._renderFunctions.renderScene(z,y,n,w.disableDecorations?k.Decorations.OFF:k.Decorations.ON,x)}this._rctx.bindFramebuffer(z?.fbo);
x=this._readbackScreenshot(w,()=>{this._rctx.bindFramebuffer(null);z?.release()});q=null;w.objectAndLayerIdColor&&(this._rctx.bindFramebuffer(y?.fbo),q=this._readbackScreenshot(w,()=>{this._rctx.bindFramebuffer(null);y?.release()}),this._rctx.bindFramebuffer(null));if(v&&!this._rctx.contextAttributes.alpha)for(w=3;w<x.data.length;w+=4)x.data[w]=255;if(q&&!this._rctx.contextAttributes.alpha)for(w=3;w<q.data.length;w+=4)q.data[w]=255;t&&this._forceCameraHook(u.parameters);return[x,q]}_ensureScreenshotEncodeCanvas(){this._screenshotEncodeCanvas||
(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas}}a.ScreenshotContext=p;a.ScreenshotManager=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/imageUtils"],function(a,b,g,d){function k(n,q){const {format:t,quality:v,rotation:r,disableDecorations:y}=n||{};var z=e(n,q.padding);var D=q.width-z.left-z.right;q=q.height-z.top-
z.bottom;z={x:0,y:0,width:D,height:q};if(n?.area){null!=n.area.x&&(z.x=Math.floor(n.area.x));null!=n.area.y&&(z.y=Math.floor(n.area.y));var C=null!=n.area.width?Math.floor(n.area.width):null,E=null!=n.area.height?Math.floor(n.area.height):null;z.width=D-z.x;z.height=q-z.y;null!=C&&null!=E?(z.width=Math.min(z.width,C),z.height=Math.min(z.height,E)):null==C&&null!=E?(C=Math.min(z.width,C),z.height*=C/z.width,z.width=C):null!=C&&null==E&&(C=Math.min(z.height,E),z.width*=C/z.height,z.height=C)}z=l(z,
n);C=Math.floor(Math.max(z.x,0));E=Math.floor(Math.max(z.y,0));D={x:C,y:E,width:Math.floor(Math.min(z.width,D-C)),height:Math.floor(Math.min(z.height,q-E))};q=D.width/D.height;z=z.width/z.height;z!==q&&(z>q?(q=Math.floor(D.width/z),D={x:D.x,y:Math.floor(D.y+(D.height-q)/2),width:D.width,height:q}):(q=Math.floor(D.height*z),D={x:Math.floor(D.x+(D.width-q)/2),y:D.y,width:q,height:D.height}));const {width:A,height:F}=c(n,D);q=p(t);z=w[q];z=g.clamp(null!=v?v:z,0,100);return{format:q,quality:z,area:D,
width:A,height:F,rotation:r,disableDecorations:!!y,ignoreBackground:!!n?.ignoreBackground,ignorePadding:!!n?.ignorePadding}}function m(n,q){null==h&&(h=document.createElement("canvas"));var t=h;if(q.premultipliedAlpha){var v=n.data;const y=v.length;for(let z=0;z<y;z+=4){var r=v[z+3];255!==r&&0<r&&(r=255/r,v[z]*=r,v[z+1]*=r,v[z+2]*=r)}}t.width=n.width;t.height=n.height;v=t.getContext("2d",{willReadFrequently:!0});v.putImageData(n,0,0);q.flipY&&(v.save(),v.globalCompositeOperation="copy",v.scale(1,
-1),v.translate(0,-v.canvas.height),v.drawImage(v.canvas,0,0),v.restore());return{ctx:v,canvas:t}}function f(n,q){return n.toDataURL(u[q.format],q.quality/100)}function c(n,q){if(!n)return q;const t=n.width;n=n.height;if(null!=t&&null!=n)return{width:Math.floor(t),height:Math.floor(n)};if(null==t&&null==n)return q;q=q.width/q.height;return null==n?{width:Math.floor(t),height:Math.floor(t/q)}:{width:Math.floor(n*q),height:Math.floor(n)}}function l(n,q){if(null==q?.width||null==q.height)return n;q=
q.width/q.height;const t=n.width/n.height;if(t===q)return n;if(t<q)return q=Math.floor(n.height*q),n.x-=(q-n.width)/2,n.width=q,n;q=Math.floor(n.width/q);n.y-=(q-n.height)/2;n.height=q;return n}function e(n,q){return!q||n&&n.ignorePadding?x:q}function p(n){switch(n){case "png":case "jpg":case "jpeg":return n;case null:case void 0:return"png";default:return"png"}}let h=null;const u={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},w={png:100,jpg:98,jpeg:98},x={top:0,right:0,bottom:0,left:0};a.createEmptyImageData=
d.createEmptyImageData;a.completeUserSettings=k;a.encode=function(n,q,t){const {ctx:v,canvas:r}=m(n,t);n=v.getImageData(0,0,n.width,n.height);q=f(r,q);r.width=0;r.height=0;return{dataUrl:q,data:n}};a.encodeData=function(n,q){const {ctx:t,canvas:v}=m(n,q);n=t.getImageData(0,0,n.width,n.height);v.width=0;v.height=0;return n};a.getFormatAndQuality=function(n,q){n=p(n);const t=w[n];q=g.clamp(null!=q?q:t,0,100);return{format:n,quality:q}};a.getMaximumResolutionScale=function(n,q){return q/Math.max(n[0],
n[1])};a.resampleHermite=function(n,q,t,v=0,r=0,y=n.width-v,z=n.height-r,D=!1){const {data:C}=n,{width:E,height:A,data:F}=q;y/=E;z/=A;const G=Math.ceil(y/2),I=Math.ceil(z/2);n=n.width;for(let K=0;K<A;K++)for(let L=0;L<E;L++){const J=4*(L+(D?A-K-1:K)*E);let M=0,T=0,Q=0,O=0,U=0,Z=0;const P=(K+.5)*z;for(let R=Math.floor(K*z);R<(K+1)*z;R++){var H=Math.abs(P-(R+.5))/I;const W=(L+.5)*y;H*=H;for(let N=Math.floor(L*y);N<(L+1)*y;N++){var B=Math.abs(W-(N+.5))/G;B=Math.sqrt(H+B*B);if(1<=B)continue;B=2*B*B*B-
3*B*B+1;const V=4*(v+N+(r+R)*n);Z+=B*C[V+3];T+=B;!t&&255>C[V+3]&&(B=B*C[V+3]/255);Q+=B*C[V];O+=B*C[V+1];U+=B*C[V+2];M+=B}}F[J]=Q/M;F[J+1]=O/M;F[J+2]=U/M;F[J+3]=Z/T}return q};a.screenshotSuperSampleSettings=function(n,q,t){if(!q)return n;const {framebufferWidth:v,framebufferHeight:r,pixelRatio:y,region:z}=n;q=e(n,t);t=q.left+q.right;const D=q.top+q.bottom,C=v-t,E=r-D,A=Math.min(8,Math.min((2048-t)/C,(2048-D)/E));return 1.5>A?n:{...n,framebufferWidth:Math.round(C*A)+t,framebufferHeight:Math.round(E*
A)+D,pixelRatio:y*A,resample:{region:{x:Math.round((z.x-q.left)*A)+q.left,y:Math.round((z.y-q.top)*A)+q.top,width:Math.round(z.width*A),height:Math.round(z.height*A)},width:v,height:r}}};a.toDataUrl=f;a.toRenderSettings=function(n,q){const t=k(n,q),v=t.area,r=t.width/v.width,y=e(t,q.padding),z=y.left+y.right,D=y.top+y.bottom;return{framebufferWidth:Math.floor((q.width-z)*r+z),framebufferHeight:Math.floor((q.height-D)*r+D),region:{x:Math.floor(v.x*r)+y.left,y:Math.floor(v.y*r)+y.top,width:t.width,
height:t.height},format:t.format,quality:t.quality,rotation:t.rotation,pixelRatio:r,layers:n?.layers??[],disableDecorations:t.disableDecorations,ignoreBackground:t.ignoreBackground,ignorePadding:t.ignorePadding,objectAndLayerIdColor:!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>{const g=b.getContextCache();g.forEach(d=>
d.dispose());g.clear()}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../chunks/mat4 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),function(a,b,g,d,k,m,f,c,l){function e(q,t){return null==q?null:c.isObjectIntersectorResult(q)||
c.isHudIntersectorResult(q)?p(q.target?.object,t):m.isPclIntersectorResult(q)?(q=q.target.createGraphic(),{type:"graphic",graphic:q,layer:q.layer}):m.isVoxelIntersectorResult(q)?(q=q.target.createVoxelGraphic(),{type:"graphic",graphic:q,layer:q.layer}):f.isOverlayIntersectorResult(q)||l.isLodIntersectorResult(q)?p(q.target,t):m.isI3sIntersectorResult(q)?h(q.target,t):null}function p(q,t){if(null==q?.graphicUid)return null;const v=x(q,t);if(null==v)return null;if(v===t.graphics)return null==t.graphicsView||
"number"!==typeof q.graphicUid?null:t.graphicsView.getHit(q.graphicUid);t=t.allLayerViews.find(r=>r.layer===v);return!t||t.suspended||null==q.graphicUid?null:"getHit"in t?t.getHit(q.graphicUid):null}function h(q,t){const v=x(q,t);return null==v?null:(t=t.allLayerViews.find(r=>r.layer===v))&&!t.suspended&&"getGraphicFromIntersectorTarget"in t?w(t.getGraphicFromIntersectorTarget(q)):null}function u(q,t){const v=x(q,t);return null==v?null:(t=t.allLayerViews.find(r=>r.layer===v))&&!t.suspended&&"getAABBFromIntersectorTarget"in
t?t.getAABBFromIntersectorTarget(q):null}function w(q){return null!=q?{type:"graphic",graphic:q,layer:q.layer}:null}function x(q,t){return null==q?.layerUid?null:null!=t.graphicsView&&q.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(q.layerUid)}const n=g.create();a.getIntersectedFeatureBSRadius=function(q,t){return c.isObjectIntersectorResult(q)||c.isHudIntersectorResult(q)?k.getRadius(q.target.object.boundingVolumeWorldSpace.bounds):l.isLodIntersectorResult(q)?(b.getScaling(n,
q.transformation),q.target.baseBoundingSphere.radius*Math.max(n[0],n[1],n[2])):m.isI3sIntersectorResult(q)?(q=u(q.target,t))?.5*d.diameter(q):null:null};a.hasLod=function(q){return c.isObjectIntersectorResult(q)||c.isHudIntersectorResult(q)?!1:l.isLodIntersectorResult(q)?1<q.target.numLodLevels:m.isI3sIntersectorResult(q)?!0:!1};a.toGraphic=function(q,t){q=e(q,t);return null!=q&&"graphic"===q.type?q.graphic:null};a.toHit=e;a.toOwner=function(q,t){return c.isObjectIntersectorResult(q)||c.isHudIntersectorResult(q)?
x(q.target?.object,t):f.isTerrainIntersectorResult(q)?t.map?.ground:m.isPclIntersectorResult(q)||m.isI3sIntersectorResult(q)||f.isOverlayIntersectorResult(q)||m.isVoxelIntersectorResult(q)?x(q.target,t):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/IntersectorTarget","../../webgl-engine/lib/intersectorUtils"],function(a,b,g,d){class k extends g.Graphic3DTarget{constructor(c,
l,e,p){super(l,e);this.point=c;this.createGraphic=p}}class m extends g.LayerTarget{constructor(c,l,e,p,h){super(c);this.layerUid=c;this.sublayerUid=l;this.nodeIndex=e;this.componentIndex=p;this.triangleNr=h}}class f extends g.Graphic3DTarget{constructor(c,l,e){super(l,null);this.point=c;this.createVoxelGraphic=e}}a.I3sTarget=m;a.PclTarget=k;a.VoxelTarget=f;a.isI3sIntersectorResult=function(c){return d.isValidIntersectorResult(c)&&c.intersector===b.IntersectorType.I3S&&!!c.target};a.isPclIntersectorResult=
function(c){return d.isValidIntersectorResult(c)&&c.intersector===b.IntersectorType.PCL&&!!c.target};a.isVoxelIntersectorResult=function(c){return d.isValidIntersectorResult(c)&&c.intersector===b.IntersectorType.VOXEL&&!!c.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(a){function b(g){return"graphic"===g?.type}a.filterGraphicHits=function(g){return g.filter(b)};a.findFirstGraphicHit=function(g){return g.find(b)??
null};a.hitTestSelectSimilarDistance=async function(g,d){if("2d"===g.type)return g.hitTest(d);g=await g.hitTest(d);if(0===g.results.length)return g;const k=1.05*(g.results[0].distance??0);d=g.results.findIndex(m=>(m.distance??0)>k);-1!==d&&(g.results=g.results.slice(0,d));return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/layerViewUtils":function(){define(["exports"],function(a){a.extractSafeScaleBounds=function(b){b=b.effectiveScaleRange;return{minScale:b?.minScale??
0,maxScale:b?.maxScale??0}};a.highlightsSupported=function(b){return b&&"function"===typeof b.highlight};a.isScaleRangeActive=function(b,g){return null!=b&&0<b||null!=g&&0<g};a.isSelectableLayerView2D=function(b){return null!=b&&"object"===typeof b&&"createQuery"in b&&"queryFeatures"in b&&"layer"in b&&"view"in b};a.occludeesSupported=function(b){return b&&"function"===typeof b.maskOccludee};a.scaleBoundsPredicate=function(b,g,d){return null==b||b>d&&(0===g||b<g)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities","../webgl/contextUtils"],function(a,b,g,d){a.check=function(k){const m=g.getWebGLCapabilities(k);if(!m.available)return"3d"===k?new b("webgl:required","WebGL2 is required but not supported.",Error().stack):new b("webgl:required","WebGL is required but not supported.",Error().stack);if("3d"===k&&m.majorPerformanceCaveat)return new b("webgl:major-performance-caveat-detected",
"Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!m.supportsHighPrecisionFragment)return new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!m.supportsVertexShaderSamplers)return new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(m.type===d.ContextType.WEBGL1){if(!m.supportsElementIndexUint)return new b("webgl:element-index-uint-required",
"WebGL support for uint vertex indices is required but not supported.");if(!m.supportsStandardDerivatives)return new b("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!m.supportsInstancedArrays)return new b("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports",
"./contextUtils"],function(a,b){function g(h){switch(h){case b.ContextType.WEBGL1:return d();case b.ContextType.WEBGL2:return k()}}function d(){if(!f){{const h=new e,u=m(b.ContextType.WEBGL1,h);null!=u&&(h.supportsElementIndexUint=null!==u.getExtension("OES_element_index_uint"),h.supportsStandardDerivatives=null!==u.getExtension("OES_standard_derivatives"),h.supportsInstancedArrays=null!==u.getExtension("ANGLE_instanced_arrays"),h.supportsTextureFloat=null!==u.getExtension("OES_texture_float"),h.supportsTextureHalfFloat=
null!==u.getExtension("OES_texture_half_float"),h.supportsColorBufferFloat=null!==u.getExtension("WEBGL_color_buffer_float"),h.supportsColorBufferFloatBlend=null!==u.getExtension("EXT_float_blend"),h.supportsColorBufferHalfFloat=null!==u.getExtension("EXT_color_buffer_half_float"));f=h}}return f}function k(){if(!c){{const h=new p,u=m(b.ContextType.WEBGL2,h);null!=u&&(h.supportsColorBufferFloat=null!==u.getExtension("EXT_color_buffer_float"),h.supportsColorBufferFloatBlend=null!==u.getExtension("EXT_float_blend"),
h.supportsColorBufferHalfFloat=h.supportsColorBufferFloat||null!==u.getExtension("EXT_color_buffer_half_float"));c=h}}return c}function m(h,u){if(h===b.ContextType.WEBGL1&&"undefined"===typeof WebGLRenderingContext||h===b.ContextType.WEBGL2&&"undefined"===typeof WebGL2RenderingContext)return null;const w=document.createElement("canvas");if(!w)return null;let x=b.createContext(w,h,{failIfMajorPerformanceCaveat:!0});null==x&&(x=b.createContext(w,h),null!=x&&(u.majorPerformanceCaveat=!0));if(null==x)return x;
if(h===b.ContextType.WEBGL1){if(h=x.getParameter(x.VERSION)?.match(/^WebGL\s+([\d.]*)/))h=parseFloat(h[1]),u.available=.94<=h}else u.available=!0;u.maxTextureSize=x.getParameter(x.MAX_TEXTURE_SIZE);u.supportsVertexShaderSamplers=0<x.getParameter(x.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(h=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.HIGH_FLOAT))u.supportsHighPrecisionFragment=0<h.precision;return x}let f,c;class l{constructor(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=
this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsTextureHalfFloat=this.supportsTextureFloat=this.supportsInstancedArrays=this.supportsStandardDerivatives=this.supportsElementIndexUint=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1}}class e extends l{constructor(){super(...arguments);this.type=b.ContextType.WEBGL1}}class p extends l{constructor(){super(...arguments);this.type=b.ContextType.WEBGL2;this.supportsTextureHalfFloat=this.supportsTextureFloat=
this.supportsInstancedArrays=this.supportsStandardDerivatives=this.supportsElementIndexUint=!0}}a.getWebGL1Capabilities=d;a.getWebGL2Capabilities=k;a.getWebGLCapabilities=function(h){for(h=b.getContextTypes(h);1<h.length;){const u=g(h.shift());if(u.available)return u}return g(h.shift())};a.getWebGLVersionCapabilities=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/DefaultUI":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){b=class extends e{constructor(x){super(x);this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};this.components=[];this._updateViewAwareWidgets=n=>{this.components.forEach(q=>{q=this._find(q)?.widget;void 0!==q?.view&&(q.view=n)})};this._componentsWatcher=(n,q)=>{this._removeComponents(q);this._addComponents(n);this._adjustPadding(n)}}initialize(){this.addHandles([d.watch(()=>this.components,this._componentsWatcher,
d.initial),d.watch(()=>this.view,this._updateViewAwareWidgets,d.initial)])}_add(x,n,q,t,v){let r=x;if("string"===typeof x&&this._defaultPositionLookup[x]){if(this._find(x))return;r=this._createComponent(x)}super._add(r,n,q,t,v)}_removeComponents(x){x.forEach(n=>{if(n=this._find(n))this.remove(n),n.destroy()})}_adjustPadding(x){x.includes("attribution")||this._isOverridden("padding")||({top:x}=this.padding,this.padding=x)}_addComponents(x){this.constructed&&x.forEach(n=>this.add(this._createComponent(n),
this._defaultPositionLookup[n]))}_createComponent(x){const n=this._createWidget(x);return new l({id:x,node:n})}_createWidget(x){const {view:n}=this;switch(x){case "attribution":return new p({view:n});case "compass":return new h({view:n});case "navigation-toggle":return new u({view:n});case "zoom":return new w({view:n})}}};a.__decorate([k.property()],b.prototype,"components",void 0);return b=a.__decorate([c.subclass("esri.views.ui.DefaultUI")],b)})},"esri/views/ui/Component":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){b=class extends b{constructor(){super(...arguments);this.widget=null}destroy(){this.node=null;this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(l){this._set("id",l)}set node(l){const e=this._get("node");l!==e&&(l&&l.classList.add("esri-component"),e&&e.classList.remove("esri-component"),this._set("node",l))}castNode(l){this.widget?.destroy();if(!l)return this._set("widget",null),null;if("string"===typeof l||l&&"nodeType"in l)return this._set("widget",
null),g.byId(l);l&&"function"===typeof l.render&&!l.domNode&&(l.domNode=document.createElement("div"));this._set("widget",l);return l.domNode}};a.__decorate([d.property()],b.prototype,"id",null);a.__decorate([d.property()],b.prototype,"node",null);a.__decorate([k.cast("node")],b.prototype,"castNode",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"widget",void 0);return b=a.__decorate([c.subclass("esri.views.ui.Component")],b)})},"esri/views/ui/UI":function(){define("../../chunks/tslib.es6 ../../intl ../../core/arrayUtils ../../core/domUtils ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils ../../intl/locale".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(r){return 0===r?"0":`${r}px`}function n(r){const y="object"===typeof r&&null!==r&&Object.getPrototypeOf(r);return null!==y&&y!==Object.prototype||!("component"in r||"index"in r||"position"in r)?null:r}function q(r,{top:y,bottom:z,left:D,right:C}){r.style.top=y;r.style.bottom=z;r.style.left=D;r.style.right=C}const t={left:0,top:0,bottom:0,right:0},v={bottom:30,top:15,right:15,left:15};b=class extends k.EventedAccessor{constructor(r){super(r);this._cornerNameToContainerLookup=
{};this._positionNameToContainerLookup={};this._components=[];this._componentMap=new Map;this._locale=w.getLocale();this.view=null;this._applyViewPadding=()=>{const y=this.container;y&&q(y,this._toPixelPosition(this._getViewPadding()))};this._applyUIPadding=()=>{const y=this._innerContainer;y&&q(y,this._toPixelPosition(this.padding))};this._initContainers()}initialize(){this.addHandles([m.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,m.initial),m.watch(()=>this.padding,this._applyUIPadding,
m.initial),m.watch(()=>[this.container,this._locale],([r,y])=>{r&&r.setAttribute("lang",y)},m.initial),w.onLocaleChange(r=>{this._locale=r})])}destroy(){this.container=null;for(const r of this._components)r.destroy();this._components.length=0;this._componentMap.clear()}set container(r){const y=this._get("container");r!==y&&(r&&(r.classList.add("esri-ui"),p.setCalciteThemeClass(r),this._attachContainers(r)),y&&(y.classList.remove("esri-ui"),q(y,{top:"",bottom:"",left:"",right:""}),d.empty(y)),this._set("container",
r))}get height(){const r=this.view?.height??0;if(0===r)return r;const y=this._getViewPadding(),{top:z,bottom:D}=y;return Math.max(r-z-D,0)}get padding(){return this._get("padding")}set padding(r){this._overrideIfSome("padding",r)}castPadding(r){return"number"===typeof r?{bottom:r,top:r,right:r,left:r}:{...v,...r}}get width(){const r=this.view?.width??0;if(0===r)return r;const y=this._getViewPadding(),{left:z,right:D}=y;return Math.max(r-z-D,0)}add(r,y){let z,D,C;if(Array.isArray(r))r.forEach(A=>this.add(A,
y));else{var E=n(r);E&&({index:z,position:y,component:r,key:D}=E);y&&"object"===typeof y&&({index:z,key:D,position:y,internal:C}=y);!r||y&&!this._isValidPosition(y)||this._add(r,y,z,D,C)}}remove(r,y){if(r){if(Array.isArray(r))return r.map(D=>this.remove(D,y));if((r=this._find(r))&&(!this._componentMap.has(r)||this._componentMap.get(r)?.key===y)){var z=this._components.indexOf(r);r.node.parentNode?.removeChild(r.node);this._componentMap.delete(r);return this._components.splice(z,1)[0]}}}empty(r,y=
{removeInternal:!1}){if(Array.isArray(r))for(const z of r)this.empty(z,y);else{r=Array.prototype.slice.call(this._positionNameToContainerLookup[r??"manual"].children).map(z=>this._findByNode(z)).filter(z=>null==z?!1:!(this._componentMap.get(z)?.internal??!1)||y.removeInternal);for(const z of r)this.remove(z)}}move(r,y){Array.isArray(r)&&r.forEach(C=>this.move(C,y));if(r){var z=n(r)||n(y);if(z){var D=z.index;y=z.position;r=z.component||r}(!y||this._isValidPosition(y))&&(r=this.remove(r))&&this.add(r,
{position:y,index:D})}}find(r){return r?(r=this._findById(r))&&(r.widget||r.node):null}getComponents(r,y={includeInternal:!1}){return r?Array.isArray(r)?r.flatMap(z=>this._getComponentsAtPosition(z,y)):this._getComponentsAtPosition(r,y):this._components.filter(z=>y.includeInternal||!(this._componentMap.get(z)?.internal??!1)).map(({widget:z,node:D})=>z??D)}getPosition(r){for(const y in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[y].contains(r))return y;return null}_add(r,
y,z,D,C){r instanceof h||(r=new h({node:r}));this._place({component:r,position:y,index:z});this._components.push(r);this._componentMap.set(r,{key:D,internal:C})}_find(r){return r?r instanceof h?this._findByComponent(r):"string"===typeof r?this._findById(r):this._findByNode(r.domNode||r):null}_getViewPadding(){return this.view?.padding??t}_attachContainers(r){r.appendChild(this._innerContainer);r.appendChild(this._manualContainer)}_initContainers(){var r=document.createElement("div");r.classList.add("esri-ui-inner-container",
"esri-ui-corner-container");const y=document.createElement("div");y.classList.add("esri-ui-inner-container","esri-ui-manual-container");const z=document.createElement("div");z.classList.add("esri-ui-top-left","esri-ui-corner");r.appendChild(z);const D=document.createElement("div");D.classList.add("esri-ui-top-right","esri-ui-corner");r.appendChild(D);const C=document.createElement("div");C.classList.add("esri-ui-bottom-left","esri-ui-corner");r.appendChild(C);const E=document.createElement("div");
E.classList.add("esri-ui-bottom-right","esri-ui-corner");r.appendChild(E);this._innerContainer=r;this._manualContainer=y;r=u.isRTL();this._cornerNameToContainerLookup={"top-left":z,"top-right":D,"bottom-left":C,"bottom-right":E,"top-leading":r?D:z,"top-trailing":r?z:D,"bottom-leading":r?E:C,"bottom-trailing":r?C:E};this._positionNameToContainerLookup={manual:y,...this._cornerNameToContainerLookup}}_isValidPosition(r){return!!this._positionNameToContainerLookup[r]}_place(r){var y=r.position??"manual";
const {component:z,index:D}=r;r=this._positionNameToContainerLookup[y];y=null!=D&&-1<D;var C=z.widget;C&&!C._started&&"function"===typeof C.postMixInProperties&&"function"===typeof C.buildRendering&&"function"===typeof C.postCreate&&"function"===typeof C.startup&&z.widget.startup();y?(y=Array.from(r.children),0===D?r.firstChild?d.insertBefore(z.node,r.firstChild):r.appendChild(z.node):D>=y.length?r.appendChild(z.node):d.insertBefore(z.node,y[D])):r.appendChild(z.node)}_toPixelPosition(r){return{top:x(r.top),
left:x(r.left),right:x(r.right),bottom:x(r.bottom)}}_findByComponent(r){return this._components.find(y=>y===r)??null}_findById(r){return this._components.find(({id:y})=>y===r)??null}_findByNode(r){return this._components.find(({node:y})=>y===r)??null}_getComponentsAtPosition(r,y){return Array.prototype.slice.call(this._positionNameToContainerLookup[r].children).map(z=>this._findByNode(z)).filter(g.isSome).filter(z=>y.includeInternal||!(this._componentMap.get(z)?.internal??!1)).map(({widget:z,node:D})=>
z??D)}};a.__decorate([f.property()],b.prototype,"_locale",void 0);a.__decorate([f.property()],b.prototype,"container",null);a.__decorate([f.property()],b.prototype,"height",null);a.__decorate([f.property({value:v})],b.prototype,"padding",null);a.__decorate([c.cast("padding")],b.prototype,"castPadding",null);a.__decorate([f.property()],b.prototype,"view",void 0);a.__decorate([f.property()],b.prototype,"width",null);return b=a.__decorate([e.subclass("esri.views.ui.UI")],b)})},"esri/widgets/Attribution":function(){define("../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/globalCss ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){var n=p.legacyIcon.description;d=class extends c{constructor(q,t){super(q,t);this._attributionTextOverflowed=this._isOpen=!1;this._prevSourceNodeHeight=0;this._resizeObserver=new ResizeObserver(v=>v.forEach(({target:r})=>this._checkSourceTextOverflow(r)));this.iconClass=n;this.icon=null;this.itemDelimiter=" | ";this.messages=null;this.viewModel=new l}initialize(){this.addHandles(b.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||
this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((q,t)=>{q.includes(t.text)||q.push(t.text);return q},[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(q){this._overrideIfSome("label",q)}get view(){return this.viewModel.view}set view(q){this.viewModel.view=q}render(){return w.tsx("div",{bind:this,class:this.classes("esri-attribution",e.globalCss.widget,{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,
onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return w.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",w.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const q=this._isOpen,t=this._isInteractive,v=t?0:void 0,{attributionText:r}=this;return w.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",
{["esri-attribution__sources--open"]:q,[e.globalCss.interactive]:t}),innerHTML:r,tabIndex:v})}_afterSourcesNodeCreate(q){this._prevSourceNodeHeight=q.clientWidth;this._resizeObserver.observe(q)}_checkSourceTextOverflow(q){let t=!1;const {clientHeight:v,clientWidth:r,scrollWidth:y}=q;q=y>r;const z=this._attributionTextOverflowed!==q;this._attributionTextOverflowed=q;z&&(t=!0);this._isOpen&&(q=v<this._prevSourceNodeHeight,this._prevSourceNodeHeight=v,q&&(this._isOpen=!1,t=!0));t&&this.scheduleRender()}_toggleState(){this._isInteractive&&
(this._isOpen=!this._isOpen)}};a.__decorate([g.property()],d.prototype,"_isOpen",void 0);a.__decorate([g.property()],d.prototype,"_isInteractive",null);a.__decorate([g.property()],d.prototype,"_attributionTextOverflowed",void 0);a.__decorate([g.property()],d.prototype,"_prevSourceNodeHeight",void 0);a.__decorate([g.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],d.prototype,"attributionText",null);a.__decorate([g.property()],d.prototype,"iconClass",void 0);a.__decorate([g.property()],
d.prototype,"icon",void 0);a.__decorate([g.property()],d.prototype,"itemDelimiter",void 0);a.__decorate([g.property()],d.prototype,"label",null);a.__decorate([g.property(),u.messageBundle("esri/widgets/Attribution/t9n/Attribution")],d.prototype,"messages",void 0);a.__decorate([g.property()],d.prototype,"view",null);a.__decorate([g.property({type:l})],d.prototype,"viewModel",void 0);a.__decorate([h.accessibleHandler()],d.prototype,"_toggleState",null);return d=a.__decorate([f.subclass("esri.widgets.Attribution")],
d)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Collection ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(a,
b,g,d,k,m,f,c,l,e,p,h,u,w){function x(v,r){return v&&"copyright"in v&&(!r||"function"===typeof v.originOf&&"user"===v.originOf("copyright"))}function n(v,r){return v.length!==r.length||v.some((y,z)=>y.text!==r[z].text)}function q(v,r,y){y&&r&&(v.find(z=>z.layerView===r&&z.text===y)||v.push({text:y,layerView:r}))}const t=[];b=class extends b{constructor(v){super(v);this._clear=()=>{this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.removeHandles("suspension");this.notifyChange("state")};
this._pendingAttributions=new Set;this._fetchedAttributionData=new Map;this.items=new d;this.view=null;this._allLayerViewsChange=r=>{this.removeHandles("suspension");const y=this.view?.allLayerViews;y&&this.addHandles(y.map(z=>k.watch(()=>[z.suspended,z.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension");r?.removed&&r.removed.forEach(z=>{this._pendingAttributions.delete(z);this._fetchedAttributionData.delete(z)});this._updateAttributionItems()};this.addHandles([k.on(()=>
this.view?.allLayerViews,"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),k.when(()=>!0===this.view?.stationary,()=>this._updateAttributionItems())])}destroy(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()}get state(){return this.view?.ready?0<this._pendingAttributions.size?"loading":"ready":"disabled"}_updateAttributionItems(){const v=this.view,r=v?.allLayerViews;t.length=
0;v&&r?(r.forEach(y=>{if(!y.suspended&&y.layer?.attributionVisible){var z=y.layer;if(x(z,"user"))q(t,y,z.copyright);else if(z.hasAttributionData)if(this._fetchedAttributionData.has(y)){var D=this._fetchedAttributionData.get(y);D?q(t,y,this._getDynamicAttribution(D,v,z)):x(z)&&q(t,y,z.copyright)}else this._fetchAttributionData(y);else(D="portalItem"in z?z.portalItem?.accessInformation:void 0)?q(t,y,D):q(t,y,z.copyright)}}),n(this.items,t)&&(this.items.removeAll(),this.items.addMany(t)),t.length=0,
this.notifyChange("state")):this._clear()}async _fetchAttributionData(v){if(!this._pendingAttributions.has(v)){this._pendingAttributions.add(v);var r=await g.result(v.layer.fetchAttributionData());this._pendingAttributions.has(v)&&(r=r.ok?this._createContributionIndex(r.value,"bing-maps"===v.layer.type):null,this._pendingAttributions.delete(v),this._fetchedAttributionData.set(v,r));this._updateAttributionItems()}}_createContributionIndex(v,r){v=v.contributors;const y={};if(!v)return y;for(let A=0;A<
v.length;A++){const F=v[A];var z=F.coverageAreas;if(!z)return;for(const G of z){var D=G.bbox,C=G.zoomMin-(r&&G.zoomMin?1:0);z=G.zoomMax-(r&&G.zoomMax?1:0);D=new p({xmin:D[1],ymin:D[0],xmax:D[3],ymax:D[2],spatialReference:h.WGS84});for(D={extent:w.geographicToWebMercator(D),attribution:F.attribution||"",score:null!=G.score?G.score:100,id:A};C<=z;C++){var E;y[E=C]??(y[E]=[]);y[C].push(D)}}}y.maxKey=Math.max.apply(null,Object.keys(y));return y}_getDynamicAttribution(v,r,y){const {extent:z,scale:D}=r;
y=y.tileInfo?.scaleToZoom(D)??0;y=Math.min(v.maxKey??0,Math.round(y));if(!z||null==y||-1>=y)return"";v=v[y];const C=w.project(z.center.clone().normalize(),r.spatialReference),E=new Set;return v?v.filter(A=>{const F=A.id;(A=!E.has(F)&&C&&A.extent&&u.extentContainsPoint(A.extent,C))&&E.add(F);return A}).sort((A,F)=>F.score-A.score||A.objectId-F.objectId).map(A=>A.attribution).join(", "):""}};a.__decorate([m.property({readOnly:!0,type:d})],b.prototype,"items",void 0);a.__decorate([m.property({readOnly:!0})],
b.prototype,"state",null);a.__decorate([m.property()],b.prototype,"view",void 0);return b=a.__decorate([e.subclass("esri.widgets.Attribution.AttributionViewModel")],b)})},"esri/widgets/support/globalCss":function(){define(["exports"],function(a){a.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",
buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",
menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",
widgetDisabled:"esri-widget--disabled"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./Compass/css ./support/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){d=class extends c{constructor(n,q){super(n,q);this.iconClass=e.css.widgetIcon;this.messages=this.icon=null;this.viewModel=new l;this._reset=()=>{this.viewModel.reset()};this._toRotationTransform=t=>({transform:`rotateZ(${t.z}deg)`})}loadDependencies(){return p.loadCalciteComponents({button:()=>new Promise((n,q)=>a(["../chunks/calcite-button"],n,q)),icon:()=>new Promise((n,q)=>a(["../chunks/calcite-icon"],n,q))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(n){this.viewModel.goToOverride=
n}get label(){return this.messages?.widgetLabel??""}set label(n){this._overrideIfSome("label",n)}get view(){return this.viewModel.view}set view(n){this.viewModel.view=n}reset(){return this.viewModel.reset()}render(){const {orientation:n,state:q}=this.viewModel,t="rotation"===q?"arrow-up":"compass-needle",{messages:v}=this;return x.tsx("div",{class:this.classes(e.css.base,h.globalCss.widget)},x.tsx("calcite-button",{"aria-label":v.reset,class:h.globalCss.widgetButton,disabled:"disabled"===q,kind:"neutral",
onclick:this._reset,round:!0,scale:"s",title:v.reset},x.tsx("div",{"aria-hidden":"true",class:e.css.iconContainer,title:v.reset},x.tsx("calcite-icon",{icon:t,scale:"m",styles:this._toRotationTransform(n)}))))}};b.__decorate([g.property()],d.prototype,"goToOverride",null);b.__decorate([g.property()],d.prototype,"iconClass",void 0);b.__decorate([g.property()],d.prototype,"icon",void 0);b.__decorate([g.property()],d.prototype,"label",null);b.__decorate([g.property(),w.messageBundle("esri/widgets/Compass/t9n/Compass")],
d.prototype,"messages",void 0);b.__decorate([g.property()],d.prototype,"view",null);b.__decorate([g.property({type:l})],d.prototype,"viewModel",void 0);return d=b.__decorate([f.subclass("esri.widgets.Compass")],d)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./utils ../support/GoTo".split(" "),
function(a,b,g,d,k,m,f,c,l,e){b=class extends e.GoToMixin(b){constructor(p){super(p);this.orientation={x:0,y:0,z:0};this.view=null;this._updateForCamera=this._updateForCamera.bind(this);this._updateForRotation=this._updateForRotation.bind(this);this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(g.watch(()=>this.view,this._updateRotationWatcher,g.initial))}destroy(){this.view=null}get canShowNorth(){return l.canShowNorth(this.view)}get state(){return!this.view?.ready||
"2d"===this.view.type&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){if(this.view?.ready){var p={};"2d"===this.view?.type?p.rotation=0:p.heading=0;this.callGoTo({target:p})}}_updateForRotation(p){void 0!==p&&null!==p&&(this.orientation={z:p})}_updateForCamera(p){p&&(this.orientation={x:0,y:0,z:-p.heading})}_updateRotationWatcher(p){this.removeAllHandles();p&&this.addHandles("2d"===p.type?g.watch(()=>p?.rotation,this._updateForRotation,g.initial):
g.watch(()=>p?.camera,this._updateForCamera,g.initial))}};a.__decorate([d.property({readOnly:!0})],b.prototype,"canShowNorth",null);a.__decorate([d.property()],b.prototype,"orientation",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([d.property()],b.prototype,"view",void 0);return b=a.__decorate([c.subclass("esri.widgets.CompassViewModel")],b)})},"esri/widgets/Compass/utils":function(){define(["exports"],function(a){a.canShowNorth=function(b){return b?.spatialReference?.isWebMercator||
b?.spatialReference?.isGeographic||!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/tslib.es6 ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,g,d,k,m,f,c){a.GoToMixin=l=>{l=class extends l{constructor(...e){super(...e);this.view=this.goToOverride=null}callGoTo(e){const {view:p}=
this;g.assertIsSome(p);return this.goToOverride?this.goToOverride(p,e):p.goTo(e.target,e.options)}};b.__decorate([d.property()],l.prototype,"goToOverride",void 0);b.__decorate([d.property()],l.prototype,"view",void 0);return l=b.__decorate([c.subclass("esri.widgets.support.GoTo")],l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass/css":function(){define(["exports","../support/legacyIcon"],function(a,b){a.css={base:"esri-compass",widgetIcon:b.legacyIcon.locateCircled,
iconContainer:"esri-compass__icon-container"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle":function(){define("../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/css ./NavigationToggle/NavigationToggleViewModel ./support/globalCss ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){g=class extends f{constructor(n,q){super(n,q);this.iconClass=c.css.widgetIcon;this.messages=this.icon=null;this.viewModel=new l}get label(){return this.messages?.widgetLabel??""}set label(n){this._overrideIfSome("label",n)}set layout(n){"horizontal"!==n&&(n="vertical");this._set("layout",n)}get view(){return this.viewModel.view}set view(n){this.viewModel.view=n}toggle(){return this.viewModel.toggle()}render(){const n="disabled"===this.viewModel?.state;var q=
"pan"===this.viewModel?.navigationMode;const t={[c.css.activeButton]:q};q={[c.css.activeButton]:!q};const v=n?-1:0,r=this.messages.toggle;return w.tsx("div",{"aria-label":r,bind:this,class:this.classes(c.css.base,e.globalCss.widget,{[e.globalCss.disabled]:n,[c.css.isLayoutHorizontal]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:v,title:r},w.tsx("div",{class:this.classes(c.css.button,e.globalCss.widgetButton,c.css.panButton,t)},w.tsx("span",{class:p.legacyIcon.pan})),
w.tsx("div",{class:this.classes(c.css.button,e.globalCss.widgetButton,c.css.rotateButton,q)},w.tsx("span",{class:p.legacyIcon.rotate})))}_toggle(){this.toggle()}};a.__decorate([b.property()],g.prototype,"iconClass",void 0);a.__decorate([b.property()],g.prototype,"icon",void 0);a.__decorate([b.property()],g.prototype,"label",null);a.__decorate([b.property({value:"vertical"})],g.prototype,"layout",null);a.__decorate([b.property(),u.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],
g.prototype,"messages",void 0);a.__decorate([b.property()],g.prototype,"view",null);a.__decorate([b.property({type:l})],g.prototype,"viewModel",void 0);a.__decorate([h.accessibleHandler()],g.prototype,"_toggle",null);return g=a.__decorate([m.subclass("esri.widgets.NavigationToggle")],g)})},"esri/widgets/NavigationToggle/css":function(){define(["exports","../support/legacyIcon"],function(a,b){a.css={base:"esri-navigation-toggle",widgetIcon:b.legacyIcon.pan2,button:"esri-navigation-toggle__button",
activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){b=class extends b{constructor(l){super(l);this.navigationMode="pan";this.view=null}initialize(){this.addHandles(g.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&"3d"===this.view?.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){const l=this.view?.inputManager;l&&(l.primaryDragAction=
"pan"===this.navigationMode?"pan":"rotate")}};a.__decorate([d.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([d.property()],b.prototype,"navigationMode",void 0);a.__decorate([d.property()],b.prototype,"view",void 0);return b=a.__decorate([c.subclass("esri.widgets.NavigationToggleViewModel")],b)})},"esri/widgets/Zoom":function(){define("../chunks/tslib.es6 ../core/maybe ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./support/globalCss ./support/legacyIcon ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){var n=e.legacyIcon.zoomInMagnifyingGlass;d=class extends c{constructor(q,t){super(q,t);this.iconClass=n;this.messages=this.icon=null;this.viewModel=new x}initialize(){this._zoomInButton=new w({action:this.zoomIn.bind(this),iconClass:e.legacyIcon.plus});this._zoomOutButton=new w({action:this.zoomOut.bind(this),iconClass:e.legacyIcon.minus})}destroy(){this._zoomInButton=b.destroyMaybe(this._zoomInButton);this._zoomOutButton=b.destroyMaybe(this._zoomOutButton)}get label(){return this.messages?.widgetLabel??
""}set label(q){this._overrideIfSome("label",q)}set layout(q){"horizontal"!==q&&(q="vertical");this._set("layout",q)}set view(q){this.viewModel.view=q}get view(){return this.viewModel.view}render(){const q={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:t,canZoomOut:v}=this.viewModel;this._zoomInButton.enabled=t;this._zoomOutButton.enabled=v;const {zoomIn:r,zoomOut:y}=this.messages;this._zoomInButton.title=r;this._zoomOutButton.title=y;return u.tsx("div",{class:this.classes("esri-zoom",
l.globalCss.widget,q)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};a.__decorate([g.property()],d.prototype,"iconClass",void 0);a.__decorate([g.property()],d.prototype,"icon",void 0);a.__decorate([g.property()],d.prototype,"label",null);a.__decorate([g.property({value:"vertical"})],d.prototype,"layout",null);a.__decorate([g.property(),h.messageBundle("esri/widgets/Zoom/t9n/Zoom")],d.prototype,"messages",
void 0);a.__decorate([g.property()],d.prototype,"view",null);a.__decorate([g.property({type:x})],d.prototype,"viewModel",void 0);return d=a.__decorate([f.subclass("esri.widgets.Zoom")],d)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ../Feature/resources ../support/globalCss ../support/legacyIcon ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){g=class extends f{constructor(){super(...arguments);this.enabled=!0;this.icon=this.iconClass=null;this.title=""}render(){const w=this.enabled?0:-1;return h.tsx("div",{bind:this,class:this.classes(l.globalCss.widgetButton,l.globalCss.widget,{[l.globalCss.disabled]:!this.enabled,[l.globalCss.interactive]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:w,title:this.title},h.tsx("span",{"aria-hidden":"true",class:this.classes(c.css.icon,
this.iconClass??""),role:"presentation"}),h.tsx("span",{class:e.legacyIcon.fontFallbackText},this.title))}_triggerAction(){this.action.call(this)}};a.__decorate([b.property()],g.prototype,"action",void 0);a.__decorate([b.property()],g.prototype,"enabled",void 0);a.__decorate([b.property()],g.prototype,"iconClass",void 0);a.__decorate([b.property()],g.prototype,"icon",void 0);a.__decorate([b.property()],g.prototype,"title",void 0);a.__decorate([p.accessibleHandler()],g.prototype,"_triggerAction",null);
return g=a.__decorate([m.subclass("esri.widgets.IconButton")],g)})},"esri/widgets/Feature/resources":function(){define(["exports"],function(a){a.css={base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentNode:"esri-feature__content-node",contentNodeText:"esri-feature__content-node--text",contentElement:"esri-feature__content-element",text:"esri-feature__text",
lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),
function(a,b,g,d,k,m,f,c,l,e){b=class extends b{constructor(p){super(p)}destroy(){this.view=null}get canZoomIn(){return null!=this._zoomConditions&&this._zoomConditions.canZoomIn}get canZoomOut(){return null!=this._zoomConditions&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(p){p?"2d"===p.type?this._zoomConditions=new l({view:p}):"3d"===p.type&&(this._zoomConditions=new e({view:p})):this._zoomConditions=null;this._set("view",p)}zoomIn(){if(this.canZoomIn){var p=
this.view;"2d"===p.type?p.mapViewNavigation.zoomIn():g.ignoreAbortErrors(p.goTo({zoomFactor:2}))}}zoomOut(){if(this.canZoomOut){var p=this.view;"2d"===p.type?p.mapViewNavigation.zoomOut():g.ignoreAbortErrors(p.goTo({zoomFactor:.5}))}}};a.__decorate([d.property()],b.prototype,"_zoomConditions",void 0);a.__decorate([d.property()],b.prototype,"canZoomIn",null);a.__decorate([d.property()],b.prototype,"canZoomOut",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([d.property()],
b.prototype,"view",null);return b=a.__decorate([c.subclass("esri.widgets.Zoom.ZoomViewModel")],b)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,g,d,k,m,f){b=class extends b{get canZoomIn(){if(!this.view?.ready)return!1;const c=this.view?.constraints?.effectiveMaxScale;
return 0===c||this._scale>c}get canZoomOut(){var {view:c}=this;if(!c?.ready)return!1;c=c.constraints?.effectiveMinScale;return 0===c||this._scale<c}get _scale(){const c=this.view?.animation?.target;return(c&&"then"in c?void 0:c?.scale)??this.view?.scale??0}};a.__decorate([g.property({readOnly:!0})],b.prototype,"canZoomIn",null);a.__decorate([g.property({readOnly:!0})],b.prototype,"canZoomOut",null);a.__decorate([g.property()],b.prototype,"view",void 0);a.__decorate([g.property()],b.prototype,"_scale",
null);return b=a.__decorate([f.subclass("esri.widgets.Zoom.ZoomConditions2D")],b)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,g,d,k,m,f){b=class extends b{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};a.__decorate([g.property({readOnly:!0})],
b.prototype,"canZoomIn",null);a.__decorate([g.property({readOnly:!0})],b.prototype,"canZoomOut",null);a.__decorate([g.property()],b.prototype,"view",void 0);return b=a.__decorate([f.subclass("esri.widgets.Zoom.ZoomConditions3D")],b)})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(a,b,g,d,k,m,f){g=class extends f{constructor(c){super(c);this.components=["attribution","zoom","navigation-toggle","compass"]}};a.__decorate([b.property()],g.prototype,"components",void 0);return g=a.__decorate([m.subclass("esri.views.ui.3d.DefaultUI3D")],g)})},"esri/layers/SceneLayer":function(){define("require ../chunks/tslib.es6 ../Graphic ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Clonable ../core/Collection ../core/Error ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/utils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/EditBusLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/arcgisLayerUrl ./support/associatedFeatureServiceUtils ./support/capabilities ./support/commonProperties ./support/featureLayerUtils ./support/FeatureReduction ./support/FeatureReductionSelection ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/lazyLayerLoader ./support/RangeInfo ./support/SceneFilter ../renderers/support/styleUtils ../rest/support/Query ../support/elevationInfoUtils ../support/featureFlags ../support/popupUtils ../views/3d/layers/i3s/I3SUtil ../views/layers/support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba,ia,ka,na,Y,ea,fa,aa,da,ma,ua,sa,ra,Aa,qa,la){const ja=new Set(["3DObject","Point"]);k=X.defineFieldProperties();n=class extends M.EditBusLayer(U.SceneService(J.ArcGISService(T.OperationalLayer(Q.PortalLayer(O.ScaleRangeLayer(r.MultiOriginJSONMixin(L.APIKeyMixin(n.ClonableMixin(K))))))))){constructor(...ta){super(...ta);this.rangeInfos=this.featureReduction=null;this.operationalLayerType="ArcGISSceneServiceLayer";
this.type="scene";this.serviceUpdateTimeStamp=this.geometryDefinitions=this.textureSetDefinitions=this.materialDefinitions=this.nodePages=this.outFields=this.floorInfo=this.fields=null;this.excludeObjectIds=new q;this.path=this.filter=this.definitionExpression=null;this.labelsVisible=!0;this.labelingInfo=null;this.legendEnabled=!0;this.semantic=this.priority=null;this.cachedDrawingInfo={color:!1};this.popupEnabled=!0;this.globalIdField=this.objectIdField=this.popupTemplate=null;this._fieldUsageInfo=
{};this.screenSizePerspectiveEnabled=!0;this.serviceItemId=void 0}normalizeCtorArgs(ta,Ca){return"string"===typeof ta?{url:ta,...Ca}:ta}destroy(){this._set("renderer",null)}getField(ta){return this.fieldsIndex.get(ta)}getFieldDomain(ta,Ca){return(Ca=this.getFeatureType(Ca?.feature)?.domains?.[ta])&&"inherited"!==Ca.type?Ca:this.getField(ta)?.domain??null}getFeatureType(ta){return ta&&this.associatedLayer?this.associatedLayer.getFeatureType(ta):null}get types(){return this.associatedLayer?.types??
[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new ca(this.fields)}readNodePages(ta,Ca,Ga){"Point"===Ca.layerType&&(ta=Ca.pointNodePages);return null==ta||"object"!==typeof ta?null:ia.I3SNodePageDefinition.fromJSON(ta,Ga)}set elevationInfo(ta){this._set("elevationInfo",ta);this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=
this.associatedLayer&&N.computeEffectiveEditingEnabled(this.associatedLayer)}get geometryType(){return za[this.profile]||"mesh"}set renderer(ta){ba.fixRendererFields(ta,this.fieldsIndex);this._set("renderer",ta)}readCachedDrawingInfo(ta){if(null==ta||"object"!==typeof ta)ta={};null==ta.color&&(ta.color=!1);return ta}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(ta){ta=null!=ta?ta:R.zeroCapabilities;
const {query:Ca,queryRelated:Ga,editing:{supportsGlobalId:La,supportsRollbackOnFailure:Ma,supportsUploadWithItemId:Ra,supportsGeometryUpdate:Ya,supportsReturnServiceEditsInSourceSpatialReference:ab},data:{supportsZ:Wa,supportsM:cb,isVersioned:Na,supportsAttachment:xa},operations:{supportsEditing:Da,supportsAdd:Ka,supportsUpdate:ha,supportsDelete:Sa,supportsQuery:Va,supportsQueryAttachments:wa,supportsAsyncConvert3D:Ba}}=ta;ta=ta.operations.supportsChangeTracking;const Ja=!!this.associatedLayer?.infoFor3D&&
sa.sceneLayerEditingEnabled();return{query:Ca,queryRelated:Ga,editing:{supportsGlobalId:La,supportsReturnServiceEditsInSourceSpatialReference:ab,supportsRollbackOnFailure:Ma,supportsGeometryUpdate:Ja&&Ya,supportsUploadWithItemId:Ra},data:{supportsAttachment:xa,supportsZ:Wa,supportsM:cb,isVersioned:Na},operations:{supportsQuery:Va,supportsQueryAttachments:wa,supportsEditing:Da&&ta,supportsAdd:Ja&&Ka&&ta,supportsDelete:Ja&&Sa&&ta,supportsUpdate:ha&&ta,supportsAsyncConvert3D:Ba}}}get editingEnabled(){return this._isOverridden("editingEnabled")?
this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(ta){this._overrideIfSome("editingEnabled",ta)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(ta,Ca){!ta&&Ca.fields&&Ca.fields.some(Ga=>{"esriFieldTypeOID"===Ga.type&&(ta=Ga.name);return!!ta});return ta||void 0}readGlobalIdField(ta,
Ca){!ta&&Ca.fields&&Ca.fields.some(Ga=>{"esriFieldTypeGlobalID"===Ga.type&&(ta=Ga.name);return!!ta});return ta||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(ta,Ca){ta=Ca.store.profile;if(null!=ta&&oa[ta])return oa[ta];v.getLogger(this).error("Unknown or missing profile",{profile:ta,layer:this});return"mesh-pyramids"}load(ta){this.addResolvingPromise(this._load(ta));return Promise.resolve(this)}async _load(ta){const Ca=null!=ta?ta.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},
ta).catch(y.throwIfAbortError);await this._fetchService(Ca);await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Ca),this._setAssociatedFeatureLayer(Ca),this._loadFilterGeometries()]);this._validateElevationInfo();this._applyAssociatedLayerOverrides();this._populateFieldUsageInfo();await da.loadStyleRenderer(this,{origin:"service"},Ca);ba.fixRendererFields(this.renderer,this.fieldsIndex);await this.finishLoadEditablePortalLayer(ta)}async beforeSave(){null!=this.filter&&(this.filter=this.filter.clone(),
await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(ta){v.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:ta}),this.filter=null}}createQuery(){const ta=new ma;"mesh"!==this.geometryType&&(ta.returnGeometry=!0,ta.returnZ=!0);ta.where=this.definitionExpression||"1\x3d1";ta.sqlFormat="standard";ta.outFields=["*"];return ta}queryExtent(ta,
Ca){return this._getAssociatedLayerForQuery().then(Ga=>Ga.queryExtent(ta||this.createQuery(),Ca))}queryFeatureCount(ta,Ca){return this._getAssociatedLayerForQuery().then(Ga=>Ga.queryFeatureCount(ta||this.createQuery(),Ca))}queryFeatures(ta,Ca){return this._getAssociatedLayerForQuery().then(Ga=>Ga.queryFeatures(ta||this.createQuery(),Ca)).then(Ga=>{if(Ga?.features)for(const La of Ga.features)La.layer=this,La.sourceLayer=this;return Ga})}async queryRelatedFeatures(ta,Ca){await this.load();if(!this.associatedLayer)throw new t("scenelayer:query-not-available",
"SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(ta,Ca)}async queryRelatedFeaturesCount(ta,Ca){await this.load();if(!this.associatedLayer)throw new t("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(ta,Ca)}async queryCachedAttributes(ta,Ca){const Ga=ba.unpackFieldNames(this.fieldsIndex,
await qa.getRequiredFields(this,qa.getFetchPopupTemplate(this)));return Aa.queryAttributesFromCachedAttributesId(this.parsedUrl.path,this.attributeStorageInfo??[],ta,Ca,Ga)}async queryCachedFeature(ta,Ca){ta=await this.queryCachedAttributes(ta,[Ca]);if(!ta||0===ta.length)throw new t("scenelayer:feature-not-in-cached-data","Feature not found in cached data");Ca=new g;Ca.attributes=ta[0];Ca.layer=this;Ca.sourceLayer=this;return Ca}queryObjectIds(ta,Ca){return this._getAssociatedLayerForQuery().then(Ga=>
Ga.queryObjectIds(ta||this.createQuery(),Ca))}queryAttachments(ta,Ca){return this._getAssociatedLayerForQuery().then(Ga=>Ga.queryAttachments(ta,Ca))}getFieldUsageInfo(ta){const Ca={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[ta]||Ca:(v.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Ca)}createPopupTemplate(ta){return ra.createPopupTemplate(this,ta)}_getAssociatedLayerForQuery(){const ta=
this.associatedLayer;return ta?.loaded?Promise.resolve(ta):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){await this.load();if(!this.associatedLayer)throw new t("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(ta){throw new t("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:ta});}return this.associatedLayer}hasCachedStatistics(ta){return null!=
this.statisticsInfo&&this.statisticsInfo.some(Ca=>Ca.name===ta)}async queryCachedStatistics(ta,Ca){await this.load(Ca);if(!this.statisticsInfo)throw new t("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const Ga=this.fieldsIndex.get(ta);if(!Ga)throw new t("scenelayer:field-unexisting",`Field '${ta}' does not exist on the layer`);for(const La of this.statisticsInfo)if(La.name===Ga.name)return ta=D.join(this.parsedUrl.path,La.href),x(ta,{query:{f:"json",token:this.apiKey},
responseType:"json",signal:Ca?Ca.signal:null}).then(Ma=>Ma.data);throw new t("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");}async saveAs(ta,Ca){return this._debouncedSaveOperations(U.SaveOperationType.SAVE_AS,{...Ca,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},ta)}async save(){return this._debouncedSaveOperations(U.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})}async applyEdits(ta,
Ca){const {applyEdits:Ga}=await new Promise((ab,Wa)=>a(["./graphics/editingSupport"],ab,Wa));await this.load();const La=this.associatedLayer;if(!La)throw new t(`${this.type}-layer:not-editable`,"Service is not editable");await La.load();const {globalIdField:Ma}=La,Ra=!!La.infoFor3D,Ya=Ca?.globalIdUsed??!0;if(Ra&&null==Ma)throw new t(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(Ra&&!Ya)throw new t(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");
Z.isHostedAgolService(La.url)&&Ra&&null!=ta.deleteFeatures&&null!=Ma&&(Ca={...Ca,globalIdToObjectId:await N.getGlobalIdToObjectIdMap(La,ta.deleteFeatures,Ma)});return Ga(this,La.source,ta,Ca)}async uploadAssets(ta,Ca){await this.load();if(null==this.associatedLayer)throw new t(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();return this.associatedLayer.uploadAssets(ta,Ca)}on(ta,Ca){return super.on(ta,Ca)}validateLayer(ta){if(ta.layerType&&!ja.has(ta.layerType))throw new t("scenelayer:layer-type-not-supported",
"SceneLayer does not support this layer type",{layerType:ta.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new t("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new t("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});ta=this.normalReferenceFrame;var Ca=this.spatialReference;
let Ga=!1,La=!1;if(null==ta)La=Ga=!0;else switch(Ca=Ca&&Ca.isGeographic,ta){case "east-north-up":case "earth-centered":Ga=!0;La=Ca;break;case "vertex-reference-frame":Ga=!0;La=!Ca;break;default:Ga=!1}if(!Ga)throw new t("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!La)throw new t("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");}_getTypeKeywords(){const ta=[];if("points"===this.profile)ta.push("Point");
else if("mesh-pyramids"===this.profile)ta.push("3DObject");else throw new t("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return ta}_populateFieldUsageInfo(){this._fieldUsageInfo={};if(this.fields)for(const ta of this.fields){const Ca=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(La=>La.name===ta.name)),Ga=!!this.associatedLayer?.fields?.some(La=>La&&ta.name===La.name);this._fieldUsageInfo[ta.name]={supportsLabelingInfo:Ca,
supportsRenderer:Ca,supportsPopupTemplate:Ca||Ga,supportsLayerQuery:Ga}}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides();this._applyAssociatedLayerExtentOverride();this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(this.associatedLayer?.fields){var ta=null;for(const Ca of this.associatedLayer.fields){const Ga=this.getField(Ca.name);Ga?(!Ga.domain&&Ca.domain&&(Ga.domain=Ca.domain.clone()),Ga.editable=
Ca.editable,Ga.nullable=Ca.nullable,Ga.length=Ca.length):(ta||(ta=this.fields?this.fields.slice():[]),ta.push(Ca.clone()))}ta&&this._set("fields",ta)}}_applyAssociatedLayerPopupOverrides(){if(this.associatedLayer){var ta=["popupTemplate","popupEnabled"],Ca=G.getProperties(this);for(let Ga=0;Ga<ta.length;Ga++){const La=ta[Ga],Ma=this.originIdOf(La),Ra=this.associatedLayer.originIdOf(La);Ma<Ra&&(Ra===B.OriginId.SERVICE||Ra===B.OriginId.PORTAL_ITEM)&&Ca.setAtOrigin(La,this.associatedLayer[La],Ra)}}}_applyAssociatedLayerExtentOverride(){const ta=
this.associatedLayer?.editingInfo?.lastEditDate,Ca=this.associatedLayer?.serverGens,Ga=this.associatedLayer?.getAtOrigin("fullExtent","service");sa.sceneLayerEditingEnabled()&&null!=this.associatedLayer?.infoFor3D&&Ga&&Z.isHostedAgolService(this.associatedLayer?.url)&&ta&&this.serviceUpdateTimeStamp?.lastUpdate!==ta.getTime()&&(this.serviceUpdateTimeStamp||Ca?.minServerGen!==Ca?.serverGen)&&G.getProperties(this).setAtOrigin("fullExtent",Ga.clone(),B.OriginId.SERVICE)}_applyAssociatedLayerPrivileges(){const ta=
this.associatedLayer;ta&&(this._set("userHasEditingPrivileges",ta.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",ta.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",ta.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(ta){if(["mesh-pyramids","points"].includes(this.profile))try{const {serverUrl:Ca,layerId:Ga,portalItem:La}=await P.findAssociatedFeatureService(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,apiKey:this.apiKey,
signal:ta});this.associatedLayer=new (await ea.layerLookupMap.FeatureLayer())({url:Ca,layerId:Ga,portalItem:La});await this.associatedLayer.load()}catch(Ca){y.isAbortError(Ca)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await z.whenOnce(()=>this.popupEnabled&&null!=this.popupTemplate);const ta=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?v.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${ta}`):
v.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${ta}`)}_validateElevationInfo(){const ta=this.elevationInfo;"mesh-pyramids"===this.profile&&ua.logInvalidElevationInfoWarning(v.getLogger(this),ua.elevationModeUnsupportedMessage("Mesh scene layers","relative-to-scene",ta));ua.logInvalidElevationInfoWarning(v.getLogger(this),ua.featureExpressionUnsupportedMessage("Scene layers",ta))}};b.__decorate([C.property({types:{key:"type",base:V.FeatureReduction,
typeMap:{selection:S}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],n.prototype,"featureReduction",void 0);b.__decorate([C.property({type:[fa.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],n.prototype,"rangeInfos",void 0);b.__decorate([C.property({json:{read:!1}})],n.prototype,"associatedLayer",
void 0);b.__decorate([C.property({type:["show","hide"]})],n.prototype,"listMode",void 0);b.__decorate([C.property({type:["ArcGISSceneServiceLayer"]})],n.prototype,"operationalLayerType",void 0);b.__decorate([C.property({json:{read:!1},readOnly:!0})],n.prototype,"type",void 0);b.__decorate([C.property({...k.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],n.prototype,"fields",void 0);b.__decorate([C.property()],n.prototype,"types",null);b.__decorate([C.property()],n.prototype,"typeIdField",
null);b.__decorate([C.property()],n.prototype,"templates",null);b.__decorate([C.property()],n.prototype,"formTemplate",null);b.__decorate([C.property({readOnly:!0,clonable:!1})],n.prototype,"fieldsIndex",null);b.__decorate([C.property({type:Y,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],n.prototype,"floorInfo",void 0);b.__decorate([C.property(k.outFields)],n.prototype,"outFields",void 0);b.__decorate([C.property({type:ia.I3SNodePageDefinition,readOnly:!0,
json:{read:!1}})],n.prototype,"nodePages",void 0);b.__decorate([I.reader("service","nodePages",["nodePages","pointNodePages"])],n.prototype,"readNodePages",null);b.__decorate([C.property({type:[ia.I3SMaterialDefinition],readOnly:!0})],n.prototype,"materialDefinitions",void 0);b.__decorate([C.property({type:[ia.I3STextureSetDefinition],readOnly:!0})],n.prototype,"textureSetDefinitions",void 0);b.__decorate([C.property({type:[ia.I3SGeometryDefinition],readOnly:!0})],n.prototype,"geometryDefinitions",
void 0);b.__decorate([C.property({readOnly:!0})],n.prototype,"serviceUpdateTimeStamp",void 0);b.__decorate([C.property({readOnly:!0})],n.prototype,"attributeStorageInfo",void 0);b.__decorate([C.property({readOnly:!0})],n.prototype,"statisticsInfo",void 0);b.__decorate([C.property({type:q.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],n.prototype,"excludeObjectIds",void 0);b.__decorate([C.property({type:String,
json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],n.prototype,"definitionExpression",void 0);b.__decorate([C.property({type:aa,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],n.prototype,"filter",void 0);b.__decorate([C.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],n.prototype,"path",void 0);b.__decorate([C.property(W.elevationInfo)],
n.prototype,"elevationInfo",null);b.__decorate([C.property({readOnly:!0,json:{read:!1}})],n.prototype,"effectiveCapabilities",null);b.__decorate([C.property({readOnly:!0})],n.prototype,"effectiveEditingEnabled",null);b.__decorate([C.property({type:String})],n.prototype,"geometryType",null);b.__decorate([C.property(W.labelsVisible)],n.prototype,"labelsVisible",void 0);b.__decorate([C.property({type:[ka],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:na.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",
read:{reader:na.reader},write:!0}})],n.prototype,"labelingInfo",void 0);b.__decorate([C.property(W.legendEnabled)],n.prototype,"legendEnabled",void 0);b.__decorate([C.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(ta,Ca){if("number"===typeof ta&&0<=ta&&1>=ta)return ta;ta=Ca.layerDefinition?.drawingInfo?.transparency;
return void 0!==ta?la.transparencyToOpacity(ta):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],n.prototype,"opacity",void 0);b.__decorate([C.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],n.prototype,"priority",void 0);b.__decorate([C.property({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],n.prototype,"semantic",void 0);b.__decorate([C.property({types:w.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},
name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],n.prototype,"renderer",null);b.__decorate([C.property({json:{read:!1}})],n.prototype,"cachedDrawingInfo",void 0);b.__decorate([I.reader("service","cachedDrawingInfo")],n.prototype,"readCachedDrawingInfo",null);b.__decorate([C.property({readOnly:!0,json:{read:!1}})],n.prototype,"capabilities",null);b.__decorate([C.property({type:Boolean,json:{read:!1}})],n.prototype,"editingEnabled",null);b.__decorate([C.property({readOnly:!0,json:{write:!1,
read:!1}})],n.prototype,"infoFor3D",null);b.__decorate([C.property({readOnly:!0,json:{write:!1,read:!1}})],n.prototype,"relationships",null);b.__decorate([C.property(W.popupEnabled)],n.prototype,"popupEnabled",void 0);b.__decorate([C.property({type:d,json:{name:"popupInfo",write:!0}})],n.prototype,"popupTemplate",void 0);b.__decorate([C.property({readOnly:!0,json:{read:!1}})],n.prototype,"defaultPopupTemplate",null);b.__decorate([C.property({type:String,json:{read:!1}})],n.prototype,"objectIdField",
void 0);b.__decorate([I.reader("service","objectIdField",["objectIdField","fields"])],n.prototype,"readObjectIdField",null);b.__decorate([C.property({type:String,json:{read:!1}})],n.prototype,"globalIdField",void 0);b.__decorate([I.reader("service","globalIdField",["globalIdField","fields"])],n.prototype,"readGlobalIdField",null);b.__decorate([C.property({readOnly:!0,type:String,json:{read:!1}})],n.prototype,"displayField",null);b.__decorate([C.property({type:String,json:{read:!1}})],n.prototype,
"profile",void 0);b.__decorate([I.reader("service","profile",["store.profile"])],n.prototype,"readProfile",null);b.__decorate([C.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],n.prototype,"normalReferenceFrame",void 0);b.__decorate([C.property(W.screenSizePerspectiveEnabled)],n.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([C.property({json:{read:!1,origins:{service:{read:!0}}}})],n.prototype,"serviceItemId",void 0);
n=b.__decorate([H.subclass("esri.layers.SceneLayer")],n);const oa={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},za={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return n})},"esri/layers/mixins/SceneService":function(){define("exports ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../support/schemaValidatorLoader ../../portal/Portal ../../portal/PortalItem ../../webdoc/saveAPIKeyUtils ../../webdoc/support/saveUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A){const F=k.getLogger("esri.layers.mixins.SceneService");var G;(function(H){H[H.existingItem=0]="existingItem";H[H.newItem=1]="newItem"})(G||(G={}));const I={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};a.SaveOperationType=void 0;(function(H){H[H.SAVE=0]="SAVE";H[H.SAVE_AS=1]="SAVE_AS"})(a.SaveOperationType||(a.SaveOperationType={}));a.SceneService=H=>{H=class extends H{constructor(){super(...arguments);
this.heightModelInfo=this.fullExtent=this.spatialReference=null;this.maxScale=this.minScale=0;this.version={major:Number.NaN,minor:Number.NaN,versionString:""};this.copyright=null;this.sublayerTitleMode="item-title";this.indexInfo=this.layerId=this.title=null;this._debouncedSaveOperations=m.debounce(async(B,K,L)=>{switch(B){case a.SaveOperationType.SAVE:return this._save(K);case a.SaveOperationType.SAVE_AS:return this._saveAs(L,K)}})}readSpatialReference(B,K){return this._readSpatialReference(K)}_readSpatialReference(B){if(null!=
B.spatialReference)return t.fromJSON(B.spatialReference);B=B.store;B=(B=B.indexCRS||B.geographicCRS)&&parseInt(B.substring(B.lastIndexOf("/")+1,B.length),10);return null!=B?new t(B):null}readFullExtent(B,K,L){if(null!=B&&"object"===typeof B)return K=null==B.spatialReference?{...B,spatialReference:this._readSpatialReference(K)}:B,n.fromJSON(K,L);L=K.store;K=this._readSpatialReference(K);return null==K||null==L?.extent||!Array.isArray(L.extent)||L.extent.some(J=>-1E38>J)?null:new n({xmin:L.extent[0],
ymin:L.extent[1],xmax:L.extent[2],ymax:L.extent[3],spatialReference:K})}parseVersionString(B){const K={major:Number.NaN,minor:Number.NaN,versionString:B};B=B.split(".");2<=B.length&&(K.major=parseInt(B[0],10),K.minor=parseInt(B[1],10));return K}readVersion(B,K){B=K.store;return this.parseVersionString(null!=B.version?B.version.toString():"")}readTitlePortalItem(B){return"item-title"!==this.sublayerTitleMode?void 0:B}readTitleService(B,K){B=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return v.titleFromUrlAndName(this.url,
K.name);K=K.name;if(!K&&this.url){const L=v.parse(this.url);null!=L&&(K=L.title)}"item-title-and-service-name"===this.sublayerTitleMode&&B&&(K=B+" - "+K);return v.cleanTitle(K)}set url(B){B=v.sanitizeUrlWithLayerId({layer:this,url:B,nonStandardUrlAllowed:!1,logger:F});this._set("url",B.url);null!=B.layerId&&this._set("layerId",B.layerId)}writeUrl(B,K,L,J){v.writeUrlWithLayerId(this,B,"layers",K,J)}get parsedUrl(){var B=this._get("url");B=f.urlToObject(B);null!=this.layerId&&(B.path=`${B.path}/layers/${this.layerId}`);
return B}async _fetchIndexAndUpdateExtent(B,K){this.indexInfo=y.fetchIndexInfo(this.parsedUrl.path,this.rootNode,B,this.apiKey,F,K);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(B){if("page"===B?.type){var K=B.rootIndex%B.pageSize;K=B.rootPage?.nodes?.[K];if(null==K?.obb?.center||null==K.obb.halfSize)throw new d("sceneservice:invalid-node-page","Invalid node page.");-1E38>K.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(B=K.obb.halfSize,
K=K.obb.center[2],B=Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2]),this.fullExtent.zmin=K-B,this.fullExtent.zmax=K+B)}else if("node"===B?.type&&(K=B.rootNode?.mbs,Array.isArray(K)&&4===K.length&&!(-1E38>K[0]))){B=K[2];K=K[3];var {fullExtent:L}=this;L&&(L.zmin=B-K,L.zmax=B+K)}}async _fetchService(B){if(null==this.url)throw new d("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const K=await this._fetchFirstLayerId(B);
null!=K&&(this.layerId=K)}return this._fetchServiceLayer(B)}async _fetchFirstLayerId(B){B=await g(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:B});if(B.data&&Array.isArray(B.data.layers)&&0<B.data.layers.length)return B.data.layers[0].id}async _fetchServiceLayer(B){B=await g(this.parsedUrl?.path??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:B});B.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let K=!1;B.data.layerType&&"Voxel"===B.data.layerType&&
(K=!0);if(K)return this._fetchVoxelServiceLayer();B=B.data;this.read(B,this._getServiceContext());this.validateLayer(B)}async _fetchVoxelServiceLayer(B){B=(await g(this.parsedUrl?.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:B})).data;this.read(B,this._getServiceContext());this.validateLayer(B)}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load();"beforeSave"in
this&&"function"===typeof this.beforeSave&&await this.beforeSave()}validateLayer(B){}_updateTypeKeywords(B,K,L){B.typeKeywords||(B.typeKeywords=[]);K=K.getTypeKeywords();for(const J of K)B.typeKeywords.push(J);B.typeKeywords&&(B.typeKeywords=B.typeKeywords.filter((J,M,T)=>T.indexOf(J)===M),L===G.newItem&&(B.typeKeywords=B.typeKeywords.filter(J=>"Hosted Service"!==J)))}async _saveAs(B,K){K={...I,...K};B=C.from(B);if(!B)throw new d("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");
E.validateSaveAPIKey(B);B.id&&(B=B.clone(),B.id=null);const L=B.portal||D.getDefault();await this._ensureLoadBeforeSave();B.type="Scene Service";B.portal=L;const J={origin:"portal-item",url:null,messages:[],portal:L,portalItem:B,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},M={layers:[this.write({},J)]};await Promise.all(J.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(M,J,K);B.url=this.url;B.title||(B.title=this.title);
this._updateTypeKeywords(B,K,G.newItem);await L.signIn();await L.user?.addItem({item:B,folder:K?.folder,data:M});await A.saveResources(this.resourceReferences,J,null);this.portalItem=B;x.updateOrigins(J);return J.portalItem=B}async _save(B){B={...I,...B};if(!this.portalItem)throw new d("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");E.validateSaveAPIKey(this.portalItem);if("Scene Service"!==this.portalItem.type)throw new d("sceneservice:portal-item-wrong-type",
'Portal item needs to have type "Scene Service"');await this._ensureLoadBeforeSave();const K={origin:"portal-item",url:this.portalItem.itemUrl&&f.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||D.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},L={layers:[this.write({},K)]};await Promise.all(K.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(L,K,
B);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,B,G.existingItem);await A.updateItemWithResources(this.portalItem,L,this.resourceReferences,K,null);x.updateOrigins(K);return this.portalItem}async _validateAgainstJSONSchema(B,K,L){K=K.messages?.filter(Q=>"error"===Q.type).map(Q=>new d(Q.name,Q.message,Q.details))??[];L?.validationOptions?.ignoreUnsupported&&(K=K.filter(Q=>"layer:unsupported"!==Q.name&&"symbol:unsupported"!==
Q.name&&"symbol-layer:unsupported"!==Q.name&&"property:unsupported"!==Q.name&&"url:unsupported"!==Q.name&&"scenemodification:unsupported"!==Q.name));const J=L?.validationOptions,M=J?.enabled,T=z.getLoader();if(M&&T&&(B=(await T()).validate(B,L.portalItemLayerType),0<B.length&&(L=`Layer item did not validate:\n${B.join("\n")}`,F.error(`_validateAgainstJSONSchema(): ${L}`),"throw"===J.failPolicy)))throw K=B.map(Q=>new d("sceneservice:schema-validation",Q)).concat(K),new d("sceneservice-validate:error",
"Failed to save layer item due to schema validation, see `details.errors`.",{combined:K});if(0<K.length)throw new d("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:K});}};b.__decorate([c.property(r.id)],H.prototype,"id",void 0);b.__decorate([c.property({type:t})],H.prototype,"spatialReference",void 0);b.__decorate([h.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],
H.prototype,"readSpatialReference",null);b.__decorate([c.property({type:n})],H.prototype,"fullExtent",void 0);b.__decorate([h.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],H.prototype,"readFullExtent",null);b.__decorate([c.property({readOnly:!0,type:q})],H.prototype,"heightModelInfo",void 0);b.__decorate([c.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],H.prototype,
"minScale",void 0);b.__decorate([c.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],H.prototype,"maxScale",void 0);b.__decorate([c.property({readOnly:!0})],H.prototype,"version",void 0);b.__decorate([h.reader("version",["store.version"])],H.prototype,"readVersion",null);b.__decorate([c.property({type:String,json:{read:{source:"copyrightText"}}})],H.prototype,"copyright",void 0);b.__decorate([c.property({type:String,json:{read:!1}})],
H.prototype,"sublayerTitleMode",void 0);b.__decorate([c.property({type:String})],H.prototype,"title",void 0);b.__decorate([h.reader("portal-item","title")],H.prototype,"readTitlePortalItem",null);b.__decorate([h.reader("service","title",["name"])],H.prototype,"readTitleService",null);b.__decorate([c.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],H.prototype,"layerId",void 0);b.__decorate([c.property(r.url)],
H.prototype,"url",null);b.__decorate([w.writer("url")],H.prototype,"writeUrl",null);b.__decorate([c.property()],H.prototype,"parsedUrl",null);b.__decorate([c.property({readOnly:!0})],H.prototype,"store",void 0);b.__decorate([c.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],H.prototype,"rootNode",void 0);return H=b.__decorate([u.subclass("esri.layers.mixins.SceneService")],H)};a.sceneServiceItemType="Scene Service";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(g){g?.writtenProperties&&g.writtenProperties.forEach(({target:d,propName:k,newOrigin:m})=>{b.isMultiOriginJSONMixin(d)&&m&&d.originOf(k)!==m&&d.updateOrigin(k,m)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in
b&&"originOf"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../request","../../core/Error"],function(a,b,g){a.fetchIndexInfo=async function(d,k,m,f,c,l){var e=null;if(null!=m){e=`${d}/nodepages/`;const p=e+Math.floor(m.rootIndex/m.nodesPerPage);try{return{type:"page",rootPage:(await b(p,{query:{f:"json",token:f},responseType:"json",signal:l})).data,rootIndex:m.rootIndex,pageSize:m.nodesPerPage,lodMetric:m.lodSelectionMetricType,
urlPrefix:e}}catch(h){null!=c&&c.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",p,h),e=h}}if(!k)return null;k=k?.split("/").pop();d=`${d}/nodes/`;k=d+k;try{return{type:"node",rootNode:(await b(k,{query:{f:"json",token:f},responseType:"json",signal:l})).data,urlPrefix:d}}catch(p){throw new g("sceneservice:root-node-missing","Root node missing.",{pageError:e,nodeError:p,url:k});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/schemaValidatorLoader":function(){define(["exports"],
function(a){let b=null;a.getLoader=function(){return b};a.registerLoader=function(g){b=g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/saveAPIKeyUtils":function(){define(["exports","../config","../core/Error","../support/apiKeyUtils"],function(a,b,g,d){a.validateSaveAPIKey=function(k){if(b.apiKey&&d.supportsApiKey(k.portal.url))throw new g("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${k.portal.url} when using an api key`);};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(a,b,g,d,k,m){async function f(p,h,u=null){if(h?.resources){var w=h.portalItem===p.portalItem?new Set(p.paths):new Set;p.paths.length=0;p.portalItem=h.portalItem;var x=new Set(h.resources.toKeep.map(t=>t.resource.path)),n=new Set,q=[];x.forEach(t=>{w.delete(t);p.paths.push(t)});
for(const t of h.resources.toUpdate)if(w.delete(t.resource.path),x.has(t.resource.path)||n.has(t.resource.path)){const {resource:v,content:r,finish:y,error:z}=t,D=m.getSiblingOfSameTypeI(v,k.generateUUID());p.paths.push(D.path);q.push(l({resource:D,content:r,compress:t.compress,finish:y,error:z},u))}else p.paths.push(t.resource.path),q.push(e(t,u)),n.add(t.resource.path);for(const t of h.resources.toAdd)p.paths.push(t.resource.path),w.has(t.resource.path)?w.delete(t.resource.path):q.push(l(t,u));
if(0===q.length)return w;h=await d.allSettledErrors(q);d.throwIfAborted(u);if(0<h.length)throw new g("save:resources","Failed to save one or more resources",{errors:h});return w}}async function c(p,h,u=null){if(p&&h.portalItem){var w=[];for(const x of p)p=h.portalItem.resourceFromPath(x),w.push(p.portalItem.removeResource(p,u));await d.eachAlways(w)}}async function l(p,h){h={...(null!=h?h:{}),compress:p.compress};h=await b.result(p.resource.portalItem.addResource(p.resource,await m.contentToBlob(p.content),
h));if(!0===h.ok)p.finish?.(p.resource);else throw p.error?.(h.error),h.error;}async function e(p,h){h=await b.result(p.resource.update(await m.contentToBlob(p.content),h));if(!0===h.ok)p.finish?.(p.resource);else throw p.error?.(h.error),h.error;}a.beforeSave=async function(p){const h=[];for(const u of p.allLayers)"beforeSave"in u&&"function"===typeof u.beforeSave&&(p=u.beforeSave())&&h.push(p);await Promise.allSettled(h)};a.saveResources=async function(p,h,u=null){p=await f(p,h,u);await c(p,h,u)};
a.updateItemWithResources=async function(p,h,u,w,x=null){u=await f(u,w,x);await p.update({data:h});await c(u,w,x)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils"],function(a,b,g,d){function k(f){const c=f.lastIndexOf("/");return-1===c?[".",f]:[f.slice(0,c),f.slice(c+1)]}function m(f){{const h=d.getPathExtension(f);f=null==h?[f,""]:[f.slice(0,f.length-h.length-
1),`.${h}`]}const [c,l]=f,[e,p]=k(c);return[e,p,l]}a.addOrUpdateResource=async function(f,c,l,e){if(!f.hasPath())throw new g(`portal-item-resource-${c}:invalid-path`,"Resource does not have a valid path");const p=f.portalItem;await p.load(e);c=d.join(p.userItemUrl,"add"===c?"addResources":"updateResources");const [h,u]=k(f.path),w=new FormData;h&&"."!==h&&w.append("resourcesPrefix",h);null!=e&&e.compress&&w.append("compress","true");w.append("fileName",u);w.append("file",l,u);w.append("f","json");
e?.access&&w.append("access",e.access);await p.portal.request(c,{method:"post",body:w,signal:e?.signal});return f};a.contentToBlob=async function(f){return"blob"===f.type?f.blob:"json"===f.type?new Blob([f.jsonString],{type:"application/json"}):(await b(f.url,{responseType:"blob"})).data};a.fetchResources=async function(f,c={},l){await f.load(l);const e=d.join(f.itemUrl,"resources"),{start:p=1,num:h=10,sortOrder:u="asc",sortField:w="created"}=c;c=await f.portal.request(e,{query:{start:p,num:h,sortOrder:u,
sortField:w,token:f.apiKey},signal:l?.signal});return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:x,size:n,resource:q})=>({created:new Date(x),size:n,resource:f.resourceFromPath(q)}))}};a.getSiblingOfSameType=function(f,c){if(!f.hasPath())return null;const [l,,e]=m(f.path);return f.portalItem.resourceFromPath(d.join(l,c+e))};a.getSiblingOfSameTypeI=function(f,c){if(!f.hasPath())return null;const [l,,e]=m(f.path);return f.portalItem.resourceFromPath(d.join(l,c+e))};a.removeAllResources=
async function(f,c){await f.load(c);const l=d.join(f.userItemUrl,"removeResources");return f.portal.request(l,{method:"post",query:{deleteAll:!0},signal:c?.signal})};a.removeResource=async function(f,c,l){if(!c.hasPath())throw new g("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await f.load(l);const e=d.join(f.userItemUrl,"removeResources");await f.portal.request(e,{method:"post",query:{resource:c.path},signal:l?.signal});c.portalItem=null};a.splitPrefixFileNameAndExtension=
m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,
supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,
supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,
supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,
supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c,l){a.I3SNodePageDefinition=class extends g.JSONSupport{constructor(){super(...arguments);this.nodesPerPage=null;this.rootIndex=0;this.lodSelectionMetricType=null}};b.__decorate([d.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);b.__decorate([d.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);b.__decorate([d.property({type:String})],a.I3SNodePageDefinition.prototype,"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=
b.__decorate([l.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=class extends g.JSONSupport{constructor(){super(...arguments);this.factor=1}};b.__decorate([d.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);b.__decorate([d.property({type:Number})],a.I3SMaterialTexture.prototype,"factor",void 0);a.I3SMaterialTexture=b.__decorate([l.subclass("esri.layer.support.I3SMaterialTexture")],
a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=class extends g.JSONSupport{constructor(){super(...arguments);this.baseColorFactor=[1,1,1,1];this.metallicRoughnessTexture=this.baseColorTexture=null;this.roughnessFactor=this.metallicFactor=1}};b.__decorate([d.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",void 0);b.__decorate([d.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);b.__decorate([d.property({type:a.I3SMaterialTexture})],
a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);b.__decorate([d.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);b.__decorate([d.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=b.__decorate([l.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=class extends g.JSONSupport{constructor(){super(...arguments);
this.alphaMode="opaque";this.alphaCutoff=.25;this.doubleSided=!1;this.cullFace="none";this.pbrMetallicRoughness=this.emissiveFactor=this.emissiveTexture=this.occlusionTexture=this.normalTexture=null}};b.__decorate([c.enumeration({opaque:"opaque",mask:"mask",blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);b.__decorate([d.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);b.__decorate([d.property({type:Boolean})],a.I3SMaterialDefinition.prototype,
"doubleSided",void 0);b.__decorate([c.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);b.__decorate([d.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);b.__decorate([d.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);b.__decorate([d.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);b.__decorate([d.property({type:[Number]})],
a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);b.__decorate([d.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=b.__decorate([l.subclass("esri.layer.support.I3SMaterialDefinition")],a.I3SMaterialDefinition);a.I3STextureFormat=class extends g.JSONSupport{};b.__decorate([d.property({type:String,json:{read:{source:["name","index"],reader:(e,p)=>null!=e?e:`${p.index}`}}})],a.I3STextureFormat.prototype,
"name",void 0);b.__decorate([c.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=b.__decorate([l.subclass("esri.layer.support.I3STextureFormat")],a.I3STextureFormat);a.I3STextureSetDefinition=class extends g.JSONSupport{constructor(){super(...arguments);this.atlas=!1}};b.__decorate([d.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);b.__decorate([d.property({type:Boolean})],
a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=b.__decorate([l.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);a.I3SGeometryAttribute=class extends g.JSONSupport{};b.__decorate([c.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);b.__decorate([d.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=
b.__decorate([l.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);a.I3SGeometryCompressedAttributes=class extends g.JSONSupport{};b.__decorate([c.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);b.__decorate([d.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=b.__decorate([l.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=class extends g.JSONSupport{constructor(){super(...arguments);this.offset=0}};b.__decorate([d.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);b.__decorate([d.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);b.__decorate([d.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);b.__decorate([d.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uv0",void 0);b.__decorate([d.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"color",void 0);b.__decorate([d.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);b.__decorate([d.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);b.__decorate([d.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);b.__decorate([d.property({type:a.I3SGeometryCompressedAttributes})],a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=
b.__decorate([l.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=class extends g.JSONSupport{};b.__decorate([c.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);b.__decorate([d.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=b.__decorate([l.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,g,d,k,m,f,c){a.RangeInfo=class extends g.JSONSupport{constructor(){super(...arguments);this.fullRangeExtent=this.currentRangeExtent=this.field=this.name=null;this.type="rangeInfo"}};b.__decorate([d.property({type:String,
json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);b.__decorate([d.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);b.__decorate([d.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"currentRangeExtent",void 0);b.__decorate([d.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);b.__decorate([d.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,
"type",void 0);a.RangeInfo=b.__decorate([c.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/tslib.es6 ../../request ../../core/JSONSupport ../../core/lang ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){var u;g=u=class extends g.JSONSupport{constructor(w){super(w);this.spatialRelationship="disjoint";this.geometries=new p;this._geometriesSource=null}initialize(){this.addHandles(k.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,k.sync))}readGeometries(w,x,n){Array.isArray(w)?this.geometries=p.fromJSON(w,n):this._geometriesSource={url:h.fromJSON(w,n),context:n}}async loadGeometries(w,x){if(null!=this._geometriesSource){var {url:n,context:q}=
this._geometriesSource;x=await b(n,{responseType:"json",signal:x?.signal});var t=w.toJSON();w=x.data.map(v=>({...v,spatialReference:t}));this.geometries=p.fromJSON(w,q);this._geometriesSource=null}}clone(){const w=new u({geometries:d.clone(this.geometries),spatialRelationship:this.spatialRelationship});w._geometriesSource=this._geometriesSource;return w}};a.__decorate([m.property({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],g.prototype,"spatialRelationship",void 0);a.__decorate([m.property({type:p,
nonNullable:!0,json:{write:!0}}),e.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],g.prototype,"geometries",void 0);a.__decorate([c.reader(["web-scene","portal-item"],"geometries")],g.prototype,"readGeometries",null);return g=u=a.__decorate([l.subclass("esri.layers.support.SceneFilter")],g)})},"esri/core/accessorSupport/decorators/persistable":function(){define("exports ../../Error ../../MD5 ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(q,t,v){const r=f.getPropertyMetadata(t,v);return{type:String,read:(y,z,D)=>{y=p.read(y,z,D);if(r.type===String)return y;if("function"===typeof r.type)return new r.type({url:y})},write:{writer(y,z,D,C){if(C?.resources){var E=null==y?null:"string"===typeof y?y:y.url;E=p.toJSON(E,{...C,verifyItemRelativeUrls:C?.verifyItemRelativeUrls?{writtenUrls:C.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},p.MarkKeep.NO);var A=r.type!==String&&(!d.isMultiOriginJSONMixin(this)||
C?.origin&&this.originIdOf(v)>c.nameToId(C.origin));y={object:this,propertyName:v,value:y,targetUrl:E,dest:z,targetPropertyName:D,context:C,params:q};if(C?.portalItem&&E&&!k.isAbsolute(E))if(A&&q?.contentAddressed)u(y);else if(A){{const {context:F,targetUrl:G,params:I,value:H,dest:B,targetPropertyName:K}=y;F.portalItem&&(z=F.portalItem.resourceFromPath(G),D=n(H,G,F),C=e.getResourceContentExtension(D),E=k.getPathExtension(z.path),A=I?.compress??!1,C!==E?u(y):(F.resources&&x({...y,resource:z,content:D,
compress:A,updates:F.resources.toUpdate}),B[K]=G))}}else w(y);else C?.portalItem&&(null==E||null!=p.itemIdFromResourceUrl(E)||k.isBlobProtocol(E)||A)?u(y):z[D]=E}else z[D]="string"===typeof y?p.toJSON(y,C):y.write({},C)}}}}function u(q){const {targetUrl:t,params:v,value:r,context:y,dest:z,targetPropertyName:D}=q;if(y.portalItem){var C=p.prefixAndFilenameFromResourceUrl(t),E=n(r,t,y);if(v?.contentAddressed&&"json"!==E.type)y.messages?.push(new b("persistable:contentAddressingUnsupported",`Property "${D}" is trying to serializing a resource with content of type ${E.type} with content addressing. Content addressing is only supported for json resources.`,
{content:E}));else{var A=v?.contentAddressed&&"json"===E.type?g.createMD5Hash(E.jsonString):C?.filename??m.generateUUID(),F=k.join(v?.prefix??C?.prefix,A),G=`${F}.${e.getResourceContentExtension(E)}`;if(v?.contentAddressed&&y.resources&&"json"===E.type&&(C=y.resources.toKeep.find(H=>H.resource.path===G)??y.resources.toAdd.find(H=>H.resource.path===G))){z[D]=C.resource.itemRelativeUrl;return}var I=y.portalItem.resourceFromPath(G);k.isBlobProtocol(t)&&y.resources&&y.resources.pendingOperations.push(k.blobUrlToBlob(t).then(H=>
{I.path=`${F}.${e.getResourceContentExtension({type:"blob",blob:H})}`;z[D]=I.itemRelativeUrl}).catch(()=>{}));y.resources&&x({...q,resource:I,content:E,compress:v?.compress??!1,updates:y.resources.toAdd});z[D]=I.itemRelativeUrl}}}function w({context:q,targetUrl:t,dest:v,targetPropertyName:r}){q.portalItem&&q.resources&&(q.resources.toKeep.push({resource:q.portalItem.resourceFromPath(t),compress:!1}),v[r]=t)}function x({object:q,propertyName:t,updates:v,resource:r,content:y,compress:z}){v.push({resource:r,
content:y,compress:z,finish:D=>{"string"===typeof q[t]?q[t]=D.url:q[t].url=D.url}})}function n(q,t,v){return"string"===typeof q?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(q.toJSON(v))}}a.persistable=function(q){const t=q?.origins??[void 0];return(v,r)=>{a:if("resource"===q?.type)var y=h(q,v,r);else{switch(q?.type??"other"){case "other":y={read:!0,write:!0};break a;case "url":const {read:z,write:D}=p.persistableUrlUtils;y={read:z,write:D};break a}y=void 0}for(const z of t){const D=l.propertyJSONMeta(v,
z,r);for(const C in y)D[C]=y[C]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],function(a,b){const g={},d=g["text/plain"],k={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};
for(const m in k)g[k[m]]=m;a.getResourceContentExtension=function(m){"json"===m.type?m="application/json":"blob"===m.type?m=m.blob.type:(m=b.getPathExtension(m.url),m=k[m]||"text/plain");return g[m]||d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PolygonCollection":function(){define("../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/Error ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){var u;b=u=class extends g.JSONSupportMixin(b.ofType(p)){constructor(w){super(w)}clone(){return new u(this.items.map(w=>w.clone()))}write(w,x){return this.toJSON(x)}toJSON(w){const x=w?.layer?.spatialReference;return x?this.toArray().map(n=>{if(!x.equals(n.spatialReference)){if(!h.canProjectWithoutEngine(n.spatialReference,x))return w?.messages&&w.messages.push(new d("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,
spatialReference:w.layer.spatialReference,context:w})),null;const q=new p;h.projectPolygon(n,q,x);n=q}n=n.toJSON(w);delete n.spatialReference;return n}).filter(n=>null!=n):(w?.messages&&w.messages.push(new d("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:w.layer.spatialReference,context:w})),this.toArray().map(n=>n.toJSON(w)))}static fromJSON(w,x){const n=new u;w.forEach(q=>n.add(p.fromJSON(q,x)));return n}};return b=u=
a.__decorate([e.subclass("esri.layers.support.PolygonCollection")],b)})},"esri/support/elevationInfoUtils":function(){define(["exports","../symbols/support/unitConversionUtils"],function(a,b){function g(h,u){return u?.mode?u.mode:(h?e:p).mode}function d(h,u){return null!=u?u:h?e:p}function k(h,u){return g(null!=h?h.hasZ:!1,u)}function m(h){const u=f(h);return k(h.geometry,u)}function f(h){return h.layer&&"elevationInfo"in h.layer?h.layer.elevationInfo:null}function c(h,u,w,x,n,q,t=null){if(null!=
q){var v=null!=t?t.mode:"absolute-height";if("on-the-ground"===v)return 0;({absoluteZ:q}=l(u,w,x,n,h,q));a:{t=null!=t?.offset?t.offset:0;switch(v){case "absolute-height":h=q-t;break a;case "relative-to-ground":h=q-((h.elevationProvider.getElevation(u,w,x,n,"ground")??0)+t);break a;case "relative-to-scene":h=q-((h.elevationProvider.getElevation(u,w,x,n,"scene")??0)+t);break a}h=void 0}return h}}function l(h,u,w,x,n,q){const t=null!=q.offset?q.offset:0;switch(q.mode){case "absolute-height":return{absoluteZ:w+
t,elevation:0};case "on-the-ground":return w=n.elevationProvider.getElevation(h,u,0,x,"ground")??0,{absoluteZ:w,elevation:w};case "relative-to-ground":return h=n.elevationProvider.getElevation(h,u,w,x,"ground")??0,{absoluteZ:w+h+t,elevation:h};case "relative-to-scene":return h=n.elevationProvider.getElevation(h,u,w,x,"scene")??0,{absoluteZ:w+h+t,elevation:h}}}const e={mode:"absolute-height",offset:0},p={mode:"on-the-ground",offset:null};a.absoluteHeightElevationInfo=e;a.elevationContextAffectsAlignment=
function(h,u){if(null==u)return!1;({mode:u}=u);return null!=u&&("scene"===h&&"relative-to-scene"===u||"ground"===h&&"absolute-height"!==u)};a.elevationInfoLikeEquals=function(h,u){return h===u||null!=h&&null!=u&&h.mode===u.mode&&h.offset===u.offset};a.elevationModeRequiredMessage=function(h,u,w){return w&&w.mode!==u?`${h} only support ${u} elevation mode`:null};a.elevationModeUnsupportedMessage=function(h,u,w){return w?.mode===u?`${h} do not support ${u} elevation mode`:null};a.featureExpressionUnsupportedMessage=
function(h,u){return null!=u?.featureExpressionInfo&&"0"!==u.featureExpressionInfo.expression?`${h} do not support featureExpressionInfo`:null};a.getConvertedElevation=function(h,u,w,x=null){return c(h,u.x,u.y,u.hasZ?u.z:0,u.spatialReference,w,x)};a.getConvertedElevationFromVector=function(h,u,w,x,n=null){return c(h,u[0],u[1],2<u.length?u[2]:0,w,x,n)};a.getEffectiveElevationInfo=d;a.getEffectiveElevationMode=g;a.getGeometryEffectiveElevationInfo=function(h,u){return d(null!=h?!!h.hasZ:!1,u)};a.getGeometryEffectiveElevationMode=
k;a.getGraphicEffectiveElevationInfo=function(h){var u=f(h);h=k(h.geometry,u);u=null!=u&&"on-the-ground"!==h?(u.offset??0)*b.getMetersPerUnit(u.unit??"meters"):0;return{mode:h,offset:u}};a.getGraphicEffectiveElevationMode=m;a.getZForElevationMode=function(h,u,w){if(w?.mode){var x=h.hasZ?h.z:0,n=null!=w.offset?w.offset:0;switch(w.mode){case "absolute-height":return x-n;case "on-the-ground":return 0;case "relative-to-ground":return h=(u.elevationProvider.getElevation(h.x,h.y,x,h.spatialReference,"ground")??
0)+n,x-h;case "relative-to-scene":return h=(u.elevationProvider.getElevation(h.x,h.y,x,h.spatialReference,"scene")??0)+n,x-h}}};a.hasGraphicFeatureExpressionInfo=function(h){if("on-the-ground"===m(h))return!1;h=f(h);h=h?.featureExpressionInfo?h.featureExpressionInfo.expression:null;return!(!h||"0"===h)};a.logInvalidElevationInfoWarning=function(h,u){u&&h.warn(".elevationInfo\x3d",u)};a.onTheGroundElevationInfo=p;a.zValueInAbsoluteHeightMode=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/SpatialReference ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/Attribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H){function B(la){return la?parseInt(la.substring(la.lastIndexOf("/")+1,la.length),10):void 0}function K(la,ja){var oa=ja[0],za=ja[1];ja=ja[3];const ta=la[0]-oa;oa-=la[2];const Ca=la[1]-za;la=za-la[3];za=Math.max(ta,oa,0);const Ga=Math.max(Ca,la,0);za=za*za+Ga*Ga;return za>ja*ja?a.MbsIntersectResult.OUTSIDE:0<za?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(ta,oa,Ca,la)>ja?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function L(la,ja,oa){const za=[],ta=oa?.missingFields;oa=oa?.originalFields;for(const Ca of la){la=Ca.toLowerCase();let Ga=!1;for(const La of ja)if(la===La.name.toLowerCase()){za.push(La.name);Ga=!0;oa&&oa.push(Ca);break}!Ga&&ta&&ta.push(Ca)}return za}function J(la,ja,oa){const za=new Map,ta=[];oa=oa();for(const La of la){var Ca=La.attributes[ja];for(var Ga=0;Ga<oa.length;Ga++){la=oa[Ga];const Ma=la.featureIds.indexOf(Ca);if(0<=Ma){Ca=za.get(la.node);Ca||(Ca={node:la.node,indices:[],graphics:[]},
ta.push(Ca),za.set(la.node,Ca));Ca.indices.push(Ma);for(Ca.graphics.push(La);0<Ga;Ga--)oa[Ga]=oa[Ga-1];oa[0]=la;break}}}return ta}async function M(la,ja,oa,za){ja.sort((Ga,La)=>Ga.attributes[oa]-La.attributes[oa]);var ta=ja.map(Ga=>Ga.attributes[oa]);const Ca=[];za=L(za,la.fields,{originalFields:Ca});la=await T(la,ta,za);for(ta=0;ta<ja.length;ta++){const Ga=ja[ta],La=la[ta],Ma={};if(Ga.attributes)for(const Ra in Ga.attributes)Ma[Ra]=Ga.attributes[Ra];for(let Ra=0;Ra<Ca.length;Ra++)Ma[Ca[Ra]]=La[za[Ra]];
Ga.attributes=Ma}return ja}function T(la,ja,oa){var za=la.capabilities.query.maxRecordCount;if(null!=za&&ja.length>za)return za=g.splitIntoChunks(ja,za),Promise.all(za.map(ta=>T(la,ta,oa))).then(ta=>ta.flat());za=new C({objectIds:ja,outFields:oa,orderByFields:[la.objectIdField]});return la.queryFeatures(za).then(ta=>{if(ta&&ta.features&&ta.features.length===ja.length)return ta.features.map(Ca=>Ca.attributes);throw new d("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");
})}async function Q(la,ja,oa,za,ta){const Ca=[];for(const Ga of ja)Ga&&ta.includes(Ga.name)&&Ca.push({url:`${la}/nodes/${oa}/attributes/${Ga.key}/0`,storageInfo:Ga});la=await Promise.allSettled(Ca.map(Ga=>b(Ga.url,{responseType:"array-buffer"}).then(La=>E.readBinaryAttribute(Ga.storageInfo,La.data))));ja=[];for(const Ga of za){za={};for(oa=0;oa<la.length;oa++)ta=la[oa],"fulfilled"===ta.status&&(za[Ca[oa].storageInfo.name]=O(ta.value,Ga));ja.push(za)}return ja}function O(la,ja){if(!la)return null;
ja=la[ja];return m.isInt16Array(la)?-32768===ja?null:ja:m.isInt32Array(la)?ja===X?null:ja:ja!==ja?null:ja}function U(la){var ja=la.store,oa=ja.indexCRS||ja.geographicCRS;if(ja=void 0===oa?ja.indexWKT:void 0)if(la.spatialReference){if(ja!==la.spatialReference.wkt)throw new d("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new d("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference",
"Found indeWKT in the scene layer store but no layer spatial reference",{});oa=oa?new q(B(oa)):la.spatialReference;return oa.equals(la.spatialReference)?la.spatialReference:oa}function Z(la){var ja=la.store,oa=ja.vertexCRS||ja.projectedCRS;if(ja=void 0===oa?ja.vertexWKT:void 0)if(la.spatialReference){if(ja!==la.spatialReference.wkt)throw new d("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",
{});}else throw new d("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});oa=oa?new q(B(oa)):la.spatialReference;return oa.equals(la.spatialReference)?la.spatialReference:oa}function P(la,ja,oa){if(!n.canProjectWithoutEngine(la,ja))throw new d("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
oa&&!R(la,ja))throw new d("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});}function R(la,ja){return la.equals(ja)||la.isWGS84&&ja.isWebMercator||la.isWebMercator&&ja.isWGS84}function W(la,ja,oa){const za=U(la);la=Z(la);P(za,ja,oa);P(la,ja,oa)}function N(la,ja,oa,za,ta=0){if(za===t.getSphericalPCPF(za))if(ja.isGeographic){var Ca=x.getReferenceEllipsoid(ja);za=1+Math.max(0,ta)/(Ca.radius+la.center[2]);
u.set(oa.center,la.center[0],la.center[1],la.center[2]+ta);r.projectBuffer(oa.center,ja,0,oa.center,t.getSphericalPCPF(ja),0,1);p.copy(oa.quaternion,la.quaternion);p.conjugate(aa,la.quaternion);u.set(ra,0,0,1);u.transformQuat(ra,ra,aa);u.set(ra,la.halfSize[0]*Math.abs(ra[0]),la.halfSize[1]*Math.abs(ra[1]),la.halfSize[2]*Math.abs(ra[2]));u.scale(ra,ra,Ca.inverseFlattening);u.add(oa.halfSize,la.halfSize,ra);u.scale(oa.halfSize,oa.halfSize,za)}else{I.corners(la,da);u.set(oa.center,la.center[0],la.center[1],
la.center[2]+ta);v.computeTranslationToOriginAndRotation(ja,oa.center,fa,t.getSphericalPCPF(ja));u.set(oa.center,fa[12],fa[13],fa[14]);za=2*Math.sqrt(1+fa[0]+fa[5]+fa[10]);aa[0]=(fa[6]-fa[9])/za;aa[1]=(fa[8]-fa[2])/za;aa[2]=(fa[1]-fa[4])/za;aa[3]=.25*za;p.multiply(oa.quaternion,aa,la.quaternion);p.conjugate(aa,oa.quaternion);let Ga=za=la=0;for(Ca of da)Ca[2]+=ta,r.projectBuffer(Ca,ja,0,Ca,t.getSphericalPCPF(ja),0,1),u.sub(ra,Ca,oa.center),u.transformQuat(ra,ra,aa),la=Math.max(la,Math.abs(ra[0])),
za=Math.max(za,Math.abs(ra[1])),Ga=Math.max(Ga,Math.abs(ra[2]));u.set(oa.halfSize,la,za,Ga)}else ja.isWGS84&&(za.isWebMercator||D.isPlateCarree(za))?(u.copy(Y,la.center),Y[2]+=ta,ta=t.getSphericalPCPF(za),r.projectBuffer(Y,ja,0,Y,ta,0,1),V(ta,la,Y,za,oa)):ja.isWebMercator&&D.isPlateCarree(za)?(u.copy(Y,la.center),Y[2]+=ta,V(ja,la,Y,za,oa)):la===oa?(oa.center[2]+=ta,r.projectBuffer(oa.center,ja,0,oa.center,za,0,1)):(u.set(oa.center,la.center[0],la.center[1],la.center[2]+ta),r.projectBuffer(oa.center,
ja,0,oa.center,za,0,1),p.copy(oa.quaternion,la.quaternion),u.copy(oa.halfSize,la.halfSize))}function V(la,ja,oa,za,ta){const Ca=f.fromQuat(ea,ja.quaternion);for(let La=0;8>La;++La){for(var Ga=0;3>Ga;++Ga)na[Ga]=ja.halfSize[Ga]*(0!==(La&1<<Ga)?-1:1);for(Ga=0;3>Ga;++Ga){let Ma=oa[Ga];for(let Ra=0;3>Ra;++Ra)Ma+=na[Ra]*Ca[3*Ra+Ga];ia[3*La+Ga]=Ma}}r.projectBuffer(ia,la,0,ia,za,0,8);I.compute(ka,ta)}const S=z.create();a.MbsIntersectResult=void 0;(function(la){la[la.OUTSIDE=0]="OUTSIDE";la[la.INTERSECTS_CENTER_OUTSIDE=
1]="INTERSECTS_CENTER_OUTSIDE";la[la.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";la[la.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const X=-(2**31),ca=F.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});class ba{constructor(){this.material=this.edgeMaterial=null;this.castShadows=!0}}const ia=Array(24),ka=new H.Vertices(ia,3),na=w.create(),Y=w.create(),ea=c.create(),fa=e.create(),aa=h.create(),da=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,
0]],ma=z.create(),ua=z.create(),sa=I.create(),ra=w.create(),Aa={data:Array(72),size:3,exclusive:!0,stride:3},qa=e.create();a.SymbolInfo=ba;a.addWraparound=function(la,ja){return(la|0)+(ja|0)|0};a.checkPointCloudLayerCompatibleWithView=function(la,ja){P(la.spatialReference,ja.spatialReference,ja.viewingMode)};a.checkPointCloudLayerValid=function(la){var ja;(ja=null==la.store?.defaultGeometrySchema)||(la=la.store.defaultGeometrySchema,ja=!!(null==la.geometryType||"points"!==la.geometryType||null!=la.topology&&
"PerAttributeArray"!==la.topology||null!=la.encoding&&""!==la.encoding&&"lepcc-xyz"!==la.encoding||null==la.vertexAttributes?.position));if(ja)throw new d("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkRecyclable=function(la,ja,oa){if(la.serviceUpdateTimeStamp?.lastUpdate!==ja.serviceUpdateTimeStamp?.lastUpdate||!oa.isEmpty||la.associatedLayer?.url!==ja.associatedLayer?.url)throw new d("layerview:recycle-failed");};a.checkSceneLayerCompatibleWithView=
function(la,ja){W(la,ja.spatialReference,ja.viewingMode)};a.checkSceneLayerValid=function(la){var ja;(ja=null==la.store?.defaultGeometrySchema)||(ja=la.store.defaultGeometrySchema,ja=!!(null!=ja.geometryType&&"triangles"!==ja.geometryType||null!=ja.topology&&"PerAttributeArray"!==ja.topology||null==ja.vertexAttributes?.position));if(ja)throw new d("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:la.parsedUrl.path});};a.checkSpatialReference=
P;a.checkSpatialReferences=W;a.computeVisibilityObb=function(la,ja,oa,za,ta,Ca){if(!Ca||0===Ca.length||null==ja||!la.mbs)return null;const Ga=A.computeGlobalTransformation(la.mbs,ta,oa,ja);l.invert(qa,Ga);let La=null;const Ma=()=>{if(!La)if(La=da,z.empty(ua),null!=la.serviceObb){N(la.serviceObb,oa,sa,ja,ta);I.corners(sa,La);for(var Wa of La)u.transformMat4(Wa,Wa,qa),z.expandPointInPlace(ua,Wa)}else{var cb=la.mbs;if(cb)for(Wa=cb[3],y.projectVectorToVector(cb,oa,ra,ja),u.transformMat4(ra,ra,qa),ra[2]+=
ta,cb=0;8>cb;++cb){const Na=La[cb];u.copy(Na,[ra[0]+(cb&1?Wa:-Wa),ra[1]+(cb&2?Wa:-Wa),ra[2]+(cb&4?Wa:-Wa)]);z.expandPointInPlace(ua,Na)}}};let Ra=Infinity,Ya=-Infinity;const ab=Wa=>{if("replace"===Wa.type&&(Wa=Wa.geometry,Wa?.hasZ)){z.empty(ma);var cb=Wa.spatialReference||za;Wa=Wa.rings.reduce((Na,xa)=>xa.reduce((Da,Ka)=>{y.projectVectorToVector(Ka,cb,ra,ja);u.transformMat4(ra,ra,qa);z.expandPointInPlace(ma,ra);return Math.min(ra[2],Da)},Na),Infinity);Ma();z.intersects(ua,ma)&&(Ra=Math.min(Ra,Wa),
Ya=Math.max(Ya,Wa))}};Ca.forEach(Wa=>ab(Wa));if(Infinity===Ra)return null;Ca=(Wa,cb,Na)=>{u.transformMat4(ra,Na,Ga);Wa[cb]=ra[0];Wa[cb+1]=ra[1];Wa[cb+2]=ra[2];cb+=24;Na[2]=Ra;u.transformMat4(ra,Na,Ga);Wa[cb]=ra[0];Wa[cb+1]=ra[1];Wa[cb+2]=ra[2];cb+=24;Na[2]=Ya;u.transformMat4(ra,Na,Ga);Wa[cb]=ra[0];Wa[cb+1]=ra[1];Wa[cb+2]=ra[2]};for(let Wa=0;8>Wa;++Wa)Ca(Aa.data,3*Wa,La[Wa]);return I.compute(Aa)};a.containsDraco=function(la){if(k("disable-feature:i3s-draco")||!la)return!1;for(const ja of la)for(const oa of ja.geometryBuffers)if("draco"===
oa.compressedAttributes?.encoding)return!0;return!1};a.extractWkid=B;a.filterInPlace=function(la,ja,oa){let za=0,ta=0;for(let Ca=0;Ca<ja.length&&za<la.length;Ca++)la[za]===ja[Ca]&&(oa(Ca)&&(la[ta]=la[za],ta++),za++);la.length=ta};a.findFieldsCaseInsensitive=L;a.findIntersectingNodes=function(la,ja,oa,za){oa.traverse(ja,ta=>{const Ca=ta.mbs;if((null!=Ca&&K(la,Ca))===a.MbsIntersectResult.OUTSIDE)return!1;za(ta);return!0})};a.getCacheKeySuffix=function(la,ja){return null==ja?"@null":ja===t.getSphericalPCPF(ja)?
"@ECEF":la.equals(ja)?"":null!=ja.wkid?"@"+ja.wkid:null};a.getCachedAttributeValue=O;a.getClipRect=function(la,ja){if(0===ja.rotationScale[1]&&0===ja.rotationScale[2]&&0===ja.rotationScale[3]&&0===ja.rotationScale[5]&&0===ja.rotationScale[6]&&0===ja.rotationScale[7])return S[0]=(la[0]-ja.position[0])/ja.rotationScale[0],S[1]=(la[1]-ja.position[1])/ja.rotationScale[4],S[2]=(la[2]-ja.position[0])/ja.rotationScale[0],S[3]=(la[3]-ja.position[1])/ja.rotationScale[4],S};a.getIndexCrs=U;a.getSymbolInfo=
function(la){const ja=new ba;var oa=!1;let za=!1;for(const Ca of la.symbolLayers.items)if("fill"===Ca.type&&Ca.enabled){var ta=Ca.material;la=Ca.edges;null==ta||oa||(oa=ta.color,ta=G.parseColorMixMode(ta.colorMixMode),ja.material=null!=oa?{color:[oa.r/255,oa.g/255,oa.b/255],alpha:oa.a,colorMixMode:ta}:{color:[1,1,1],alpha:1,colorMixMode:G.ColorMixModeEnum.Multiply},ja.castShadows=Ca.castShadows,oa=!0);null==la||za||(ja.edgeMaterial=F.createMaterialFromEdges(la,{}),za=!0)}ja.material||(ja.material=
{color:[1,1,1],alpha:1,colorMixMode:G.ColorMixModeEnum.Multiply});return ja};a.getVertexCrs=Z;a.intersectBoundingRectWithMbs=K;a.invalidateMbs=function(la){null!=la&&(la[3]=-1)};a.invalidateObb=function(la){null!=la&&(la.halfSize[0]=-1)};a.isSupportedLocalModeProjection=R;a.isValidMbs=function(la){return 0<=la[3]};a.isValidObb=function(la){return null!=la&&0<=la.halfSize[0]};a.objectIdFilter=function(la,ja,oa){let za=0,ta=0;for(;za<oa.length;)0<=g.binaryIndexOf(la,oa[za])===ja&&(oa[ta]=oa[za],ta++),
za++;oa.length=ta};a.queryAttributesFromCachedAttributesId=Q;a.rendererNeedsTextures=function(la){if(null==la||"simple"!==la.type&&"class-breaks"!==la.type&&"unique-value"!==la.type||("unique-value"===la.type||"class-breaks"===la.type)&&null==la.defaultSymbol)return!0;la=la.getSymbols();if(0===la.length)return!0;for(const ja of la){if("mesh-3d"!==ja.type||0===ja.symbolLayers.length)return!0;for(const oa of ja.symbolLayers.items)if("fill"!==oa.type||null==oa.material?.color||"replace"!==oa.material.colorMixMode)return!0}return!1};
a.transformObb=N;a.transparentEdgeMaterial=ca;a.whenGraphicAttributes=async function(la,ja,oa,za,ta){if(0===ja.length)return[];const Ca=la.attributeStorageInfo;if(null!=la.associatedLayer)try{return await M(la.associatedLayer,ja,oa,za)}catch(Ga){if(la.associatedLayer.loaded)throw Ga;}if(Ca){ja=J(ja,oa,ta);if(null==ja)throw new d("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const Ga=la.parsedUrl.path;return(await Promise.all(ja.map(La=>Q(Ga,Ca,La.node.resources.attributes,
La.indices,za).then(Ma=>{for(let Ra=0;Ra<La.graphics.length;Ra++){const Ya=La.graphics[Ra],ab=Ma[Ra];if(Ya.attributes)for(const Wa in Ya.attributes)Wa in ab||(ab[Wa]=Ya.attributes[Wa]);Ya.attributes=ab}return La.graphics})))).flat()}throw new d("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m){function f(D,C){const E={byteOffset:0,byteCount:0,fields:Object.create(null)};let A=0;for(let F=0;F<C.length;F++){const G=C[F],I=G.valueType||G.type;E.fields[G.property]=(0,z[I])(D,A);A+=y[I].BYTES_PER_ELEMENT}E.byteCount=A;return E}function c(D,C,E){return l(D,C,E).map(A=>(A=A?Date.parse(A):null)&&!Number.isNaN(A)?A:null)}function l(D,C,E){const A=[];let F,G=0,I;for(I=0;I<D;I+=1){F=C[I];if(0<F){var H=A,B=H.push,K=E,L=G,J=F-1;let T="",Q=0;for(;Q<J;){var M=K[L+Q];if(128>M)T+=
String.fromCharCode(M),Q++;else if(192<=M&&224>M){if(Q+1>=J)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");T+=String.fromCharCode((M&31)<<6|K[L+Q+1]&63);Q+=2}else if(224<=M&&240>M){if(Q+2>=J)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");T+=String.fromCharCode((M&15)<<12|(K[L+Q+1]&63)<<6|K[L+Q+2]&63);Q+=3}else if(240<=M&&248>M){if(Q+3>=J)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");
M=(M&7)<<18|(K[L+Q+1]&63)<<12|(K[L+Q+2]&63)<<6|K[L+Q+3]&63;T=65536<=M?T+String.fromCharCode((M-65536>>10)+55296,(M&1023)+56320):T+String.fromCharCode(M);Q+=4}else throw new b("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}B.call(H,T);if(0!==E[G+F-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else A.push(null);G+=F}return A}function e(D,C){return new y[C.valueType](D,C.byteOffset,C.count*C.valuesPerElement)}function p(D,C){return new Uint8Array(D,
C.byteOffset,C.byteCount)}function h(D,C,E){D=null!=C.header?f(D,C.header):{byteOffset:0,byteCount:0,fields:{count:E}};E={header:D,byteOffset:D.byteCount,byteCount:0,entries:Object.create(null)};let A=D.byteCount;for(let F=0;F<C.ordering.length;F++){const G=C.ordering[F],I=g.clone(C[G]);I.count=D.fields.count??0;if("String"===I.valueType){I.byteOffset=A;I.byteCount=D.fields[G+"ByteCount"];if("UTF-8"!==I.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:I.encoding});
if(I.timeEncoding&&"ECMA_ISO8601"!==I.timeEncoding)throw new b("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:I.timeEncoding});}else if(q(I.valueType)){const H=t(I.valueType);A+=0!==A%H?H-A%H:0;I.byteOffset=A;I.byteCount=H*I.valuesPerElement*I.count}else throw new b("unsupported-value-type","Unsupported binary valueType",{valueType:I.valueType});A+=I.byteCount??0;E.entries[G]=I}E.byteCount=A-E.byteOffset;return E}function u(D,C,E){C!==D&&v.error(`Invalid ${E} buffer size\n expected: ${D}, actual: ${C})`);
if(C<D)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:D,actualSize:C});}function w(D){return{isDraco:!1,isLegacy:!1,color:null!=D.color,normal:null!=D.normal,uv0:null!=D.uv0,uvRegion:null!=D.uvRegion,featureIndex:null!=D.faceRange&&null!=D.featureId}}function x(D){const C={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const E of D.ordering)if(D.vertexAttributes[E])switch(E){case "normal":C.normal=!0;break;case "color":C.color=!0;break;
case "uv0":C.uv0=!0;break;case "region":C.uvRegion=!0}D.featureAttributes&&D.featureAttributeOrder&&(C.featureIndex=!0);return C}function n(D){const C={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const E of D)switch(E){case "normal":C.normal=!0;break;case "uv0":C.uv0=!0;break;case "color":C.color=!0;break;case "uv-region":C.uvRegion=!0;break;case "feature-index":C.featureIndex=!0}return C}function q(D){return y.hasOwnProperty(D)}function t(D){return q(D)?y[D].BYTES_PER_ELEMENT:
0}const v=d.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),r={position:m.VertexAttribute.POSITION,normal:m.VertexAttribute.NORMAL,color:m.VertexAttribute.COLOR,uv0:m.VertexAttribute.UV0,region:m.VertexAttribute.UVREGION},y={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},z={Float32:(D,C)=>(new DataView(D,0)).getFloat32(C,!0),Float64:(D,C)=>(new DataView(D,0)).getFloat64(C,!0),UInt8:(D,C)=>(new DataView(D,
0)).getUint8(C),Int8:(D,C)=>(new DataView(D,0)).getInt8(C),UInt16:(D,C)=>(new DataView(D,0)).getUint16(C,!0),Int16:(D,C)=>(new DataView(D,0)).getInt16(C,!0),UInt32:(D,C)=>(new DataView(D,0)).getUint32(C,!0),Int32:(D,C)=>(new DataView(D,0)).getInt32(C,!0)};a.createAttributeDataIndex=h;a.createGeometryDescriptor=function(D,C){return D&&D.compressedAttributes&&"draco"===D.compressedAttributes.encoding?n(D.compressedAttributes.attributes):D?w(D):x(C)};a.createGeometryDescriptorForDraco=n;a.createGeometryDescriptorFromDefinition=
w;a.createGeometryDescriptorFromSchema=x;a.createGeometryIndexFromSchema=function(D,C){var E=f(D,C&&C.header);let A=E.byteCount;const F={isDraco:!1,header:E,byteOffset:E.byteCount,byteCount:0,vertexAttributes:{}};E=E.fields;var G=null!=E.vertexCount?E.vertexCount:E.count;for(var I of C.ordering){if(!C.vertexAttributes[I])continue;const B={...C.vertexAttributes[I],byteOffset:A,count:G};F.vertexAttributes[r[I]||"_"+I]=B;A+=t(B.valueType)*B.valuesPerElement*G}I=E.faceCount;if(C.faces&&I){F.faces={};
for(var H of C.ordering)C.faces[H]&&(G={...C.faces[H],byteOffset:A,count:I},F.faces[H]=G,A+=t(G.valueType)*G.valuesPerElement*I)}H=E.featureCount;if(C.featureAttributes&&C.featureAttributeOrder&&H){F.featureAttributes={};for(const B of C.featureAttributeOrder)C.featureAttributes[B]&&(E={...C.featureAttributes[B],byteOffset:A,count:H},F.featureAttributes[B]=E,I="UInt64"===E.valueType?8:t(E.valueType),A+=I*E.valuesPerElement*H)}u(A,D.byteLength,"geometry");F.byteCount=A-F.byteOffset;return F};a.createRawView=
p;a.createTypedView=e;a.getBytesPerValue=t;a.isValueType=q;a.readBinaryAttribute=function(D,C,E){if("lepcc-rgb"===D.encoding)return k.decodeRGB(C);if("lepcc-intensity"===D.encoding)return k.decodeIntensity(C);if(null!=D.encoding&&""!==D.encoding)throw new b("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");D["attributeByteCounts "]&&!D.attributeByteCounts&&(v.warn("Warning: Trailing space in 'attributeByteCounts '."),D.attributeByteCounts=D["attributeByteCounts "]);
"ObjectIds"===D.ordering[0]&&D.hasOwnProperty("objectIds")&&(v.warn("Warning: Case error in objectIds"),D.ordering[0]="objectIds");E=h(C,D,E);u(E.byteOffset+E.byteCount,C.byteLength,"attribute");if(D=E.entries.attributeValues||E.entries.objectIds){if("String"===D.valueType){E=E.entries.attributeByteCounts;const A=e(C,E);C=p(C,D);return D.timeEncoding?c(E.count,A,C):l(E.count,A,C)}return e(C,D)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readDateStringArray=
c;a.readHeader=f;a.readStringArray=l;a.valueType2ArrayBufferReader=z;a.valueType2TypedArrayClassMap=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function g(f,c,l){return{identifier:String.fromCharCode.apply(null,new Uint8Array(f,l+m.identifierOffset,m.identifierLength)),version:c.getUint16(l+m.versionOffset,!0),checksum:c.getUint32(l+m.checksumOffset,!0)}}function d(f,c,l){const e=
[];c=k(f,c,e);const p=[];for(let h=0;h<e.length;h++){p.length=0;c=k(f,c,p);for(let u=0;u<p.length;u++)l.push(p[u]+e[h])}return c}function k(f,c,l){var e=new DataView(f,c),p=e.getUint8(0);const h=p&31;var u=!!(p&32),w=(p&192)>>6;p=0;if(0===w)p=e.getUint32(1,!0),c+=5;else if(1===w)p=e.getUint16(1,!0),c+=3;else if(2===w)p=e.getUint8(1),c+=2;else throw new b("lepcc-decode-error","Bad count type");if(u)throw new b("lepcc-decode-error","LUT not implemented");f=new Uint8Array(f,c,Math.ceil(p*h/8));w=u=e=
0;const x=-1>>>32-h;for(let n=0;n<p;n++){for(;u<h;)e|=f[w]<<u,u+=8,w+=1;l[n]=e&x;e>>>=h;u-=h;32<u+h&&(e|=f[w-1]>>8-u)}return c+w}const m={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(f){const c=new DataView(f,0);var l=0;const {identifier:e,version:p}=g(f,c,l);l+=m.byteCount;if("Intensity "!==e)throw new b("lepcc-decode-error","Bad identifier");if(1<p)throw new b("lepcc-decode-error","Unknown version");var h=l;var u=c.getUint32(h+
0,!0);var w=c.getUint32(h+4,!0);var x=c.getUint32(h+8,!0);var n=c.getUint16(h+12,!0);var q=c.getUint8(h+14);c.getUint8(h+15);l+=16;if(w*2**32+u!==f.byteLength)throw new b("lepcc-decode-error","Bad size");u=new Uint16Array(x);if(8===q){if(x+l!==f.byteLength)throw new b("lepcc-decode-error","Bad size");f=new Uint8Array(f,l,x);for(l=0;l<x;l++)u[l]=f[l]*n}else if(16===q){if(2*x+l!==f.byteLength)throw new b("lepcc-decode-error","Bad size");f=new Uint16Array(f,l,x);for(l=0;l<x;l++)u[l]=f[l]*n}else{q=[];
if(k(f,l,q)!==f.byteLength)throw new b("lepcc-decode-error","Bad size");for(f=0;f<x;f++)u[f]=q[f]*n}return u};a.decodeRGB=function(f){var c=new DataView(f,0),l=0;const {identifier:e,version:p}=g(f,c,l);l+=m.byteCount;if("ClusterRGB"!==e)throw new b("lepcc-decode-error","Bad identifier");if(1<p)throw new b("lepcc-decode-error","Unknown version");var h=l;var u=c.getUint32(h+0,!0);var w=c.getUint32(h+4,!0);var x=c.getUint32(h+8,!0);var n=c.getUint16(h+12,!0);var q=c.getUint8(h+14);h=c.getUint8(h+15);
l+=16;if(w*2**32+u!==f.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===q||1===q)&&0===h){if(3*n+x+l!==f.byteLength||256<n)throw new b("lepcc-decode-error","Bad count");c=new Uint8Array(f,l,3*n);l=new Uint8Array(f,l+3*n,x);f=new Uint8Array(3*x);for(n=0;n<x;n++)u=l[n],f[3*n]=c[3*u],f[3*n+1]=c[3*u+1],f[3*n+2]=c[3*u+2];return f}if(0===q&&0===h){if(3*x+l!==f.byteLength||0!==n)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(f,l)).slice()}if(2>=q&&1===h){if(l+3!==f.byteLength||
1!==n)throw new b("lepcc-decode-error","Bad count");f=c.getUint8(l);n=c.getUint8(l+1);l=c.getUint8(l+2);c=new Uint8Array(3*x);for(u=0;u<x;u++)c[3*u]=f,c[3*u+1]=n,c[3*u+2]=l;return c}throw new b("lepcc-decode-error","Bad method "+q+","+h);};a.decodeXYZ=function(f){var c=new DataView(f,0),l=0;const {identifier:e,version:p}=g(f,c,l);l+=m.byteCount;if("LEPCC     "!==e)throw new b("lepcc-decode-error","Bad identifier");if(1<p)throw new b("lepcc-decode-error","Unknown version");var h=l;var u=c.getUint32(h+
0,!0);var w=c.getUint32(h+4,!0);var x=c.getFloat64(h+8,!0);var n=c.getFloat64(h+16,!0);var q=c.getFloat64(h+24,!0);var t=c.getFloat64(h+32,!0);var v=c.getFloat64(h+40,!0);var r=c.getFloat64(h+48,!0);var y=c.getFloat64(h+56,!0);var z=c.getFloat64(h+64,!0);var D=c.getFloat64(h+72,!0);var C=c.getUint32(h+80,!0);c.getUint32(h+84,!0);l+=88;if(w*2**32+u!==f.byteLength)throw new b("lepcc-decode-error","Bad size");u=new Float64Array(3*C);w=[];C=[];c=[];h=[];l=d(f,l,w);l=d(f,l,C);l=d(f,l,c);l=d(f,l,h);if(l!==
f.byteLength)throw new b("lepcc-decode-error","Bad length");l=f=0;for(let E=0;E<w.length;E++){l+=w[E];let A=0;for(let F=0;F<C[E];F++){A+=c[f];const G=h[f];u[3*f]=Math.min(t,x+2*y*A);u[3*f+1]=Math.min(v,n+2*z*l);u[3*f+2]=Math.min(r,q+2*D*G);f++}}return{errorX:y,errorY:z,errorZ:D,result:u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64","../../../../geometry/ellipsoidUtils",
"../../../../geometry/projection/computeTranslationToOriginAndRotation"],function(a,b,g,d,k){function m(f,c,l){const e=g.create(),p=2**(4*Math.ceil(Math.log(f[3])*Math.LOG2E/4)+1);if(l.isGeographic){var h=p/d.getReferenceEllipsoid(l).radius*180/Math.PI;l=Math.max(-90,Math.min(90,Math.round(f[1]/h)*h));h/=Math.cos((Math.abs(l)-h/2)/180*Math.PI);e[0]=Math.round(f[0]/h)*h;e[1]=l}else l=Math.round(f[1]/p),e[0]=Math.round(f[0]/p)*p,e[1]=l*p;e[2]=Math.round((f[2]+c)/p)*p;return e}a.computeGlobalTransformation=
function(f,c,l,e){f=m(f,c,l);c=b.create();k.computeTranslationToOriginAndRotation(l,f,c,e);return c};a.getLocalOrigin=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(a,b){function g(d,k){return d.popupTemplate?d.popupTemplate:null!=k&&k.defaultPopupTemplateEnabled&&null!=d.defaultPopupTemplate?d.defaultPopupTemplate:null}a.getFetchPopupTemplate=g;a.getRequiredFields=
async function(d,k=d.popupTemplate){if(null==k)return[];const m=await k.getRequiredFields(d.fieldsIndex);({lastEditInfoEnabled:k}=k);const {objectIdField:f,typeIdField:c,globalIdField:l,relationships:e}=d;if(m.includes("*"))return["*"];k=k?b.getFeatureEditFields(d):[];const p=b.fixFields(d.fieldsIndex,[...m,...k]);c&&p.push(c);p&&f&&d.fieldsIndex?.has(f)&&!p.includes(f)&&p.push(f);p&&l&&d.fieldsIndex?.has(l)&&!p.includes(l)&&p.push(l);e&&e.forEach(h=>{({keyField:h}=h);p&&h&&d.fieldsIndex?.has(h)&&
!p.includes(h)&&p.push(h)});return p};a.hasPopupTemplate=function(d,k){return null!=g(d,{defaultPopupTemplateEnabled:k})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,b,g,d,k,m,f,c,l,e){d=class extends l.TiledLayerView3D(c.LayerView3D(e)){constructor(){super(...arguments);this.type="elevation-3d"}get tileInfo(){return this.layer.tileInfo}initialize(){var p=this.view?.map?.allLayers;p=p&&p.includes(this.layer);var h=this.view?.map?.ground?.layers;h=h&&h.includes(this.layer);p&&!h&&(p=new b("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),this.addResolvingPromise(Promise.reject(p)));this._addTilingSchemeMatchPromise()}};
a.__decorate([g.property()],d.prototype,"layer",void 0);a.__decorate([g.property()],d.prototype,"tileInfo",null);return d=a.__decorate([f.subclass("esri.views.3d.layers.ElevationLayerView3D")],d)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){a.LayerView3D=h=>{h=class extends h{constructor(){super(...arguments);this.supportsHeightUnitConversion=this.slicePlaneEnabled=!1}postscript(u){super.postscript(u);p.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const u=new AbortController;var w=u.signal;this.addHandles(g.makeHandle(()=>u.abort()));await k.whenOnce(()=>this.view.defaultsFromMap?.heightModelInfoReady,w);d.throwIfAborted(w);
if(w=p.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw w;}canResume(){const u=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!u?.minScale||!u.maxScale||u.minScale>=u.maxScale)}getSuspendInfo(){const u=super.getSuspendInfo(),w=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;w&&w.minScale&&w.maxScale&&w.minScale<w.maxScale&&(u.outsideScaleRange=!0);return u}};
b.__decorate([m.property()],h.prototype,"view",void 0);b.__decorate([m.property()],h.prototype,"slicePlaneEnabled",void 0);return h=b.__decorate([e.subclass("esri.views.3d.layers.LayerView3D")],h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){a.TiledLayerView3D=h=>{h=class extends h{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}get dataScaleRange(){var u=this.tileInfo.lods;let w=u[0].scale;u=u[u.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const {effectiveMinLOD:x,effectiveMaxLOD:n}=this.layer.tilemapCache;w=this.tileInfo.lodAt(x).scale;u=this.tileInfo.lodAt(n).scale}return{minScale:w,
maxScale:u}}get dataLevelRange(){const {minScale:u,maxScale:w}=this.dataScaleRange;return this.levelRangeFromScaleRange(u,w)}get displayLevelRange(){const u=this.levelRangeFromScaleRange(this.layer.minScale||this.dataScaleRange.minScale,this.layer.maxScale||this.dataScaleRange.maxScale);this.layer.maxScale&&u.maxLevel++;return u}getTileUrl(u,w,x){return this.layer.getTileUrl(u,w,x)}_addTilingSchemeMatchPromise(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new g("tilingscheme:extent-not-defined",
"This layer doesn't define a fullExtent.")));var u=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(null!=u)return this.addResolvingPromise(Promise.reject(u));u=d.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const w=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(w)throw w;});this.addResolvingPromise(u)}_getTileInfoSupportError(u,w){if(u=p.checkIfTileInfoSupportedForView(u,w,this.view.spatialReference,this.view.state.viewingMode)){w=
{layer:this.layer,error:u};switch(u.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":u=new g("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",w);break;default:u=new g("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",w)}return u}return null}_getTileInfoCompatibilityError(u,
w){return null!=u&&w.compatibleWith(u)?null:new g("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(u,w){const x={minLevel:0,maxLevel:Infinity};var n=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!n)return x;const q=n.levels[0];n=t=>{t=Math.log(q.scale/t)/Math.LN2;return 1E-9>.5-Math.abs(.5-t%1)?Math.round(t):Math.ceil(t)};null!=u&&0<u&&(x.minLevel=Math.max(0,n(u)));
null!=w&&0<w&&(x.maxLevel=Math.max(0,n(w)));return x}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};b.__decorate([k.property({readOnly:!0})],h.prototype,"imageFormatIsOpaque",null);b.__decorate([k.property({readOnly:!0})],h.prototype,"updating",void 0);b.__decorate([k.property(e.updatingProgress)],h.prototype,"updatingProgress",void 0);b.__decorate([k.property(e.updatingProgressValue)],h.prototype,"updatingProgressValue",void 0);b.__decorate([k.property()],
h.prototype,"fullExtent",null);b.__decorate([k.property({readOnly:!0})],h.prototype,"isOpaque",null);b.__decorate([k.property()],h.prototype,"dataScaleRange",null);b.__decorate([k.property({readOnly:!0})],h.prototype,"dataLevelRange",null);b.__decorate([k.property({readOnly:!0})],h.prototype,"displayLevelRange",null);b.__decorate([k.property()],h.prototype,"layer",void 0);b.__decorate([k.property()],h.prototype,"tileInfo",void 0);return h=b.__decorate([l.subclass("esri.views.3d.layers.TiledLayerView3D")],
h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../layers/support/layerUtils ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),function(a,
b,g,d,k,m,f,c,l,e,p){d=class extends p{constructor(){super(...arguments);this.type="feature-3d";this.direct3DObjectFeatureLayerDisplayEnabled=e.direct3DObjectFeatureLayerDisplayEnabled()}initialize(){const {layer:h,view:u}=this;l.getEffectiveLayerCapabilities(h)?.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new b("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:h})));null!=h.infoFor3D&&(this.direct3DObjectFeatureLayerDisplayEnabled?
this._set("suspendResumeExtentMode","computed"):this.addResolvingPromise(Promise.reject(new b("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${h.geometryType}`))));"mesh"!==h.geometryType||c.canProjectWithoutEngine(h.spatialReference,u.spatialReference)||this.addResolvingPromise(Promise.reject(new b("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))}get featureSpatialReference(){return this.view.featureTiles?.tilingScheme?.spatialReference}};
a.__decorate([g.property({constructOnly:!0})],d.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);a.__decorate([g.property()],d.prototype,"layer",void 0);return d=a.__decorate([f.subclass("esri.views.3d.layers.FeatureLayerView3D")],d)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/UpdatePolicy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r){m=class extends r(h.FeatureLikeLayerView3D(t(u.LayerView3D(v)))){constructor(z){super(z);this._processorTotal=this._controllerTotal=0;this.suspendResumeExtentMode="data"}initialize(){this.addHandles(d.watch(()=>this._updatingRequiredFieldsPromise,z=>this._updatingHandles.addPromise(z),d.syncAndInitial))}destroy(){this._updatingHandles.removeAll();this._fetcherContext=g.destroyMaybe(this._fetcherContext)}get maximumNumberOfFeatures(){return this.controller?.maximumNumberOfFeatures??
this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(z){this._set("maximumNumberOfFeatures",z);this.controller&&(this.controller.maximumNumberOfFeatures=z)}get maximumNumberOfFeaturesExceeded(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}get updatingProgressValue(){let z=0;if(this.controller?.updating){var D=this.controller.updatingRemaining,C=Math.max(this.controller.updatingTotal,this._controllerTotal);0<C&&(z=(C-D)/C,this._controllerTotal=
C)}D=0;if(this.processor?.updating){C=this.processor.updatingRemaining;const E=Math.max(C,this._processorTotal);0<E&&(D=(E-C)/E,this._processorTotal=E)}return.5*(z+D)}get updatePolicy(){if(!this.controller)return q.UpdatePolicy.ASYNC;switch(this.controller.mode){case "snapshot":const z=y.get(this.layer.geometryType);return null==z||this.controller.serviceDataCount>z?q.UpdatePolicy.ASYNC:q.UpdatePolicy.SYNC;case "tiles":return q.UpdatePolicy.ASYNC}}get hasZ(){const z=this.layer,D=z.capabilities&&z.capabilities.data;
return D&&D.supportsZ?"returnZ"in z&&null!=z.returnZ?z.returnZ:D.supportsZ:!1}get hasM(){const z=this.layer,D=z.capabilities&&z.capabilities.data;return D&&D.supportsM?"returnM"in z&&null!=z.returnM?z.returnM:!1:!1}setVisibility(z,D){this.processor?.setObjectIdVisibility(z,D)}createQuery(){return super.createQuery()}queryFeatures(z,D){const C=()=>super.queryFeatures(z,D);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(z),C):C()}beforeSetController(z){z.maximumNumberOfFeatures=
this.maximumNumberOfFeatures}createController(){this._fetcherContext=new w.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const z=new p.FeatureTileController3D({layerView:this,context:this._fetcherContext,graphics:new x.EventedSet,extent:this.clippingExtent});this._updatingHandles.add(()=>z.serviceDataExtent,D=>{this.processor&&(this.processor.dataExtent=D)},d.initial);this.addHandles(d.watch(()=>this.suspended,D=>{D?z.suspend():z.resume()},d.syncAndInitial));
this._updatingHandles.add(()=>this.processor?.displayFeatureLimit,D=>z.displayFeatureLimit=D,d.initial);this.addHandles(d.when(()=>!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return z}async doRefresh(z){z&&!this.suspended&&this.controller&&this.controller.refetch();this.processor.refreshFilter()}get usedMemory(){return(this.processor?.usedMemory??0)+(this.controller?.memoryForUnusedFeatures??0)}get unloadedMemory(){const z=this.controller?.expectedFeatureDiff??0,D=this.processor?.loadedFeatures??
0;return(this.processor?.unprocessedMemoryEstimate??0)+z*(this.processor?.usedMemoryPerFeature??0)*(0<D+z?D/(D+z):1)}get ignoresMemoryFactor(){return this.controller?.hasMaximumNumberOfFeaturesOverride}async _queryFeaturesMesh(z,D){await this._validateQueryFeaturesMesh(z);D=await D();if(z?.outStatistics||null==this.graphics3DProcessor)return D;z=this.layer.objectIdField;const C=this.graphics3DProcessor.graphics3DGraphicsByObjectID,E=[];for(const A of D.features)if(A.geometry){const F=C.get(A.attributes[z]);
F&&(A.geometry=e.hydrateGeometry(F.graphic.geometry),E.push(A))}else E.push(A);D.features=E;return D}async _validateQueryFeaturesMesh(z){if(z){var D=E=>{throw new b("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${E}'`);},C=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const E of C)null!=z[E]&&D(E);"returnM"in z&&z.returnM&&D("returnM");"returnCentroid"in z&&z.returnCentroid&&D("returnCentroid");null==z.outSpatialReference||
z.outSpatialReference.equals(this.view.spatialReference)||D("outSpatialReference")}}get performanceInfo(){var z=this.controller?.displayFeatureLimit;z=null!=z?z.averageSymbolComplexity:void 0;z=null!=z?`f:${z.verticesPerFeature},v:${z.verticesPerCoordinate}`:"n/a";return{...this._getResourceInfo(),partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?.mode??"n/a",symbolComplexity:z,nodes:this.controller?.tileDescriptors.length??0,...(this.controller?.performanceInfo??{storedFeatures:0,
totalVertices:0})}}get test(){return{updatePolicy:this.updatePolicy,controller:this.controller,loadedGraphics:this.controller?.graphics}}};a.__decorate([k.property()],m.prototype,"layer",void 0);a.__decorate([k.property()],m.prototype,"controller",void 0);a.__decorate([k.property()],m.prototype,"_controllerTotal",void 0);a.__decorate([k.property()],m.prototype,"_processorTotal",void 0);a.__decorate([k.property()],m.prototype,"maximumNumberOfFeatures",null);a.__decorate([k.property()],m.prototype,
"maximumNumberOfFeaturesExceeded",null);a.__decorate([k.property(n.updatingProgress)],m.prototype,"updatingProgress",void 0);a.__decorate([k.property({readOnly:!0})],m.prototype,"updatingProgressValue",null);a.__decorate([k.property({readOnly:!0})],m.prototype,"updatePolicy",null);a.__decorate([k.property({readOnly:!0})],m.prototype,"hasZ",null);a.__decorate([k.property({readOnly:!0})],m.prototype,"hasM",null);a.__decorate([k.property()],m.prototype,"suspendResumeExtentMode",void 0);m=a.__decorate([l.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],
m);const y=new Map([["point",5E3],["polygon",500],["polyline",1E3]]);return m})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/support/UpdatingHandles ../../support/arcgisLayerUrl ../../support/layerUtils ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C){function E(A,F){if(!F)return!1;for(const G of F)if(!A.has(G))return!0;return!1}a.FeatureTileController3D=class extends p.EsriPromiseMixin(g){set extent(A){if(null==A||A.spatialReference.equals(this.layerView.view.spatialReference)){var F=this._get("extent");F===A||null!=F&&A&&F.equals(A)||(A=null!=A?A.clone():null,this._set("extent",A))}else l.getLogger(this).error("#extent\x3d","extent needs to be in the same spatial reference as the view")}get updating(){return!!(null!=
this._tileFetcher&&this._tileFetcher.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._updatingHandles&&this._updatingHandles.updating)}get updatingTotal(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingTotal:0}get updatingRemaining(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingRemaining:0}get expectedFeatureDiff(){return this.updating&&null!=this._tileFetcher?
this._tileFetcher.expectedFeatureDiff:0}get memoryForUnusedFeatures(){return null!=this._tileFetcher?this._tileFetcher.memoryForUnusedFeatures:0}get maximumNumberOfFeaturesExceeded(){return!(null==this._tileFetcher||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}get maximumNumberOfFeatures(){return this.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(A){A!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",A)}get hasMaximumNumberOfFeaturesOverride(){return this._isOverridden("maximumNumberOfFeatures")}get mode(){var A=
this.layerView.layer;if("feature"===A.type&&null!=A.infoFor3D)return"snapshot";if(this._forceTilesMode)return"tiles";var F=this.layerView.view;if(!1===F.qualitySettings?.graphics3D?.snapshotAvailable||this.serviceDataCount===a.FeatureTileController3DConstants.noServiceDataCount||this._snapshotLimitExceeded||this.maximumNumberOfFeaturesExceeded||1>F.quality)return"tiles";F=(F=F&&F.featureTiles)&&F.tilingScheme;return A&&A.minScale&&this.serviceDataExtent&&F&&(A=this._approximateExtentSizeAtScale(A.minScale,
F),(this.serviceDataExtent.width/A+this.serviceDataExtent.height/A)/2>a.FeatureTileController3DConstants.maxSnapshotMinScaleFactor)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}get maxTotalSnapshotVertices(){const A=this._get("maxTotalSnapshotVertices")||0;return Math.max(A,"snapshot"===this.mode&&this._tileFetcher?.totalVertices||0)}_approximateExtentSizeAtScale(A,F){const G=this.layerView.view,I=F.levels[0];return(I.tileSize[0]/(I.scale/
A)+I.tileSize[1]/(I.scale/A))/2*Math.ceil((G.width/F.pixelSize+G.height/F.pixelSize)/2)}get tileDescriptors(){return"snapshot"===this.mode?new k([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new k}get test(){return{fetchDataInfoPromise:this._fetchDataInfoPromise,tileFetcher:this._tileFetcher}}constructor(A){super(A);this.type="feature-tile-3d";this._updatingHandles=new q.UpdatingHandles;this.serviceDataExtent=null;this.serviceDataCount=
a.FeatureTileController3DConstants.noServiceDataCount;this._snapshotLimitExceeded=!1;this.displayFeatureLimit=null;this._suspended=this._forceTilesMode=!1;this._fetchDataInfoAbortController=this._fetchDataInfoPromise=this._tileFetcher=null;this._lifeCycleAbortController=new AbortController}initialize(){this._updatingHandles.add(()=>this.displayFeatureLimit,A=>this._updatingHandles.addPromise(this._updateSnapshotLimit(A,null,this._lifeCycleAbortController.signal)));this._updatingHandles.add(()=>this.mode,
()=>this._modeChanged(),u.initial);this._updatingHandles.add(()=>this.mode,(A,F)=>{"tiles"===A&&"snapshot"===F&&(this._forceTilesMode=!0)},u.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this._updatingHandles.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))}_verifyCapabilities(){const A=this.layerView.layer;if("ogc-feature"!==A.type&&!v.getEffectiveLayerCapabilities(A)?.operations.supportsQuery)throw new f("graphicscontroller:query-capability-required",
"Service requires query capabilities to be used as a feature layer",{layer:A});}destroy(){this._cancelFetchServiceDataInfo();this._tileFetcher=e.destroyMaybe(this._tileFetcher);this._tilesHandle=e.removeMaybe(this._tilesHandle);this._lifeCycleAbortController=e.abortMaybe(this._lifeCycleAbortController);this._updatingHandles.destroy();this._set("_updatingHandles",null)}suspend(){this._suspended||(this._suspended=!0,null!=this._tileFetcher&&this._tileFetcher.suspend())}resume(){this._suspended&&(this._suspended=
!1,null!=this._tileFetcher&&this._tileFetcher.resume())}restart(){const A=()=>{null!=this._tileFetcher&&this._tileFetcher.restart()};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(A,A))}refetch(){this._refetch({resetForceTilesMode:!1})}_refetch(A){const F=()=>{null!=this._tileFetcher&&(A.resetForceTilesMode&&(this._forceTilesMode=!1),this._tileFetcher.refetch())};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(F,F))}_initializeTileFetcher(){const A=this.layerView.view;
if(A){var F=u.whenOnce(()=>A.featureTiles?.tilingScheme,this._lifeCycleAbortController.signal);this._updatingHandles.addPromise(F);F.then(()=>{const {layerView:G,tileDescriptors:I}=this,H=G.layer,B=new z.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:I,features:this.graphics});this._tileFetcher=B;this._suspended?this._tileFetcher.suspend():this._tileFetcher.resume();const K=this.layerView.view;K&&this.addHandles(u.watch(()=>K.quality,J=>B.memoryFactor=J,u.syncAndInitial));
const L="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;L&&this.addHandles(u.watch(()=>this.layerView.view?.qualitySettings?.graphics3D?.[L],J=>B.lodFactor=J||1,u.initial));"ogc-feature"!==H.type&&this._updatingHandles.add(()=>H.createQueryVersion,()=>this._dataFilterChanged());this._updatingHandles.add(()=>G.availableFields,(J,M)=>this._availableFieldsChanged(M,J));this._updatingHandles.add(()=>G.requiredFields,(J,M)=>this._requiredFieldsChanged(M,
J));this.addHandles([H.on("apply-edits",J=>this._applyEdits(J)),u.watch(()=>this.extent,J=>B.filterExtent=J,u.sync),u.watch(()=>this.tileDescriptors,J=>B.tileDescriptors=J,u.sync),u.watch(()=>this.maximumNumberOfFeatures,J=>{B.maximumNumberOfFeatures=J;B.useTileCount=this.serviceDataCount>J},u.syncAndInitial),u.watch(()=>this.serviceDataCount,J=>{B.useTileCount=J>this.maximumNumberOfFeatures},u.syncAndInitial),u.watch(()=>C.debugFlags.FEATURE_TILE_FETCH_SHOW_TILES,J=>{J&&B&&!B.debugger?(B.debugger=
new D.FeatureTileFetcher3DDebugger(B,K.featureTiles.tilingScheme.toTileInfo(),K),B.debugger.update()):!J&&this._tileFetcher&&B.debugger&&(B.debugger.destroy(),B.debugger=null)},u.syncAndInitial)]);this._supportsExceedsLimitQuery||this._updatingHandles.add(()=>this.maxTotalSnapshotVertices,()=>this._updatingHandles.addPromise(this._updateSnapshotLimit(this.displayFeatureLimit,null,this._lifeCycleAbortController.signal)))}).catch(()=>{})}}_modeChanged(){switch(this.mode){case "tiles":this._tilesHandle||
(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:l.getLogger(this).warn("Unhandled feature layer mode "+this.mode);case "snapshot":null!=this._tilesHandle&&(this._tilesHandle.remove(),this._tilesHandle=null)}}_dataFilterChanged(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this._refetch({resetForceTilesMode:!0})}_applyEdits(A){null!=this._tileFetcher&&this._tileFetcher.applyEdits(A).then(F=>{if(F){if(!this._lifeCycleAbortController)throw h.createAbortError();
F.exceededTransferLimit?this.layerView.layer.refresh():(F.deletedFeatures.length||F.updatedFeatures.length||F.addedFeatures.length)&&this._updatingHandles.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}}).catch(F=>{if(!h.isAbortError(F))throw F;})}_availableFieldsChanged(A,F){null!=this._tileFetcher&&E(this._tileFetcher.availableFields,F)&&this._refetch({resetForceTilesMode:!1})}_requiredFieldsChanged(A,F){null!=this._tileFetcher&&E(this._tileFetcher.availableFields,
F)&&this.restart()}_createVertexLimitExceededQuery(A){const F=this.layerView.layer,G=F.createQuery();G.returnGeometry=!1;G.outStatistics=[new y({statisticType:"exceedslimit",maxVertexCount:A,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];F.capabilities?.query.supportsCacheHint&&(G.cacheHint=!0);return G}_createDataInfoQuery(){const A=this.layerView.layer,F=A.createQuery();F.returnGeometry=!1;F.outSpatialReference=this.layerView.view.spatialReference;A.capabilities?.query.supportsCacheHint&&
(F.cacheHint=!0);return F}_fullExtentIsAccurate(){const A=this.layerView.layer;if(A.definitionExpression)return!1;switch(A.type){case "feature":case "oriented-imagery":return t.isHostedAgolService(A.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}}async _updateServiceDataExtent(A){try{await this._tryUpdateServiceDataExtent(A)}catch(F){h.isAbortError(F)||this._set("serviceDataExtent",c.clone(this.layerView.fullExtentInLocalViewSpatialReference))}}async _tryUpdateServiceDataExtent(A){var F=
this.layerView;const G=F.layer,I=G.capabilities?.query.supportsExtent??!1,H=c.clone(F.fullExtentInLocalViewSpatialReference),B=G.fullExtent,K=this._fullExtentIsAccurate(),L=this.serviceDataCount;I&&L<=a.FeatureTileController3DConstants.maxFeatureCountForExtent&&(!H||!K)&&"queryExtent"in G?(F=this._createDataInfoQuery(),A=await G.queryExtent(F,{timeout:a.FeatureTileController3DConstants.queryExtentTimeout,signal:A}),this._set("serviceDataExtent",A.extent)):H?this._set("serviceDataExtent",H):null!=
B?(A=await r.projectGeometry(B,F.view.spatialReference,"portalItem"in G?G.portalItem:null,A),this._set("serviceDataExtent",A)):this._set("serviceDataExtent",null)}async _updateServiceDataCount(A){const F=this.layerView.layer;if("queryFeatureCount"in F&&m("featurelayer-snapshot-enabled"))if(A=await d.result(F.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.queryStatisticsTimeout,signal:A})),!0===A.ok)this._set("serviceDataCount",A.value);else{if(h.isAbortError(A.error))throw A.error;
this._set("serviceDataCount",a.FeatureTileController3DConstants.noServiceDataCount)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.noServiceDataCount)}get _supportsExceedsLimitQuery(){const A=this.layerView.layer;return null!=A.capabilities&&A.capabilities.operations&&A.capabilities.operations.supportsExceedsLimitStatistics}get _minimumNumberOfVerticesForGeometry(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;
case "polyline":return 2;case "multipatch":case "mesh":return 3;case null:return 0;default:return 0}}async _updateSnapshotLimit(A,F,G){if(null==A?.averageSymbolComplexity)this._snapshotLimitExceeded=!1;else{var {maximumTotalNumberOfVertices:I,averageSymbolComplexity:H}=A,{verticesPerFeature:B,verticesPerCoordinate:K}=H;A=1<this._minimumNumberOfVerticesForGeometry;if(0>=B||A){0!==B&&null!=F&&await F;var L=Math.min(I,1E6);F=this.serviceDataCount;var J=F!==a.FeatureTileController3DConstants.noServiceDataCount;
L=J?Math.ceil((L-F*B)/(K||1)):Math.ceil(L/(K||1));A&&(L=Math.min(L,5E6));if(J&&this._minimumNumberOfVerticesForGeometry*F>L)this._snapshotLimitExceeded=!0;else if(this._supportsExceedsLimitQuery&&m("featurelayer-snapshot-enabled"))if(G=await d.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(L),{timeout:a.FeatureTileController3DConstants.queryStatisticsTimeout,signal:G})),!1===G.ok){if(h.isAbortError(G.error))throw G.error;this._snapshotLimitExceeded=!1}else G=G.value.features[0],
this._snapshotLimitExceeded=G?.attributes?!!G.attributes.exceedslimit:!1;else this._snapshotLimitExceeded=this.maxTotalSnapshotVertices>L}else this._snapshotLimitExceeded=!1}}async _fetchServiceDataInfo(){this._cancelFetchServiceDataInfo();let A=new AbortController;const F=A.signal;var G=this._updateServiceDataCount(F);G=Promise.allSettled([G,this._updateSnapshotLimit(this.displayFeatureLimit,G,F)]);const I=G.then(()=>this._updateServiceDataExtent(F)).catch(H=>{h.isAbortError(H)||l.getLogger(this).error("#fetchServiceDataInfo()",
H)}).then(()=>{I===this._fetchDataInfoPromise&&(this._fetchDataInfoAbortController=this._fetchDataInfoPromise=null);A=null});A&&(this._fetchDataInfoPromise=I);this._fetchDataInfoAbortController=A;return G.then(()=>{},()=>{})}_cancelFetchServiceDataInfo(){const A=this._fetchDataInfoAbortController;A&&(this._fetchDataInfoPromise=this._fetchDataInfoAbortController=null,A.abort())}get performanceInfo(){return{storedFeatures:this._tileFetcher?.storedFeatures??0,totalFeatures:this._tileFetcher?.totalFeatures??
0,totalVertices:this._tileFetcher?.totalVertices??0,missingTiles:this._tileFetcher?.missingTiles??0}}};b.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);b.__decorate([w.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"graphics",void 0);b.__decorate([w.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);b.__decorate([w.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"context",void 0);b.__decorate([w.property()],
a.FeatureTileController3D.prototype,"extent",null);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"updating",null);b.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"_updatingHandles",void 0);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"expectedFeatureDiff",null);
b.__decorate([w.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);b.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"_snapshotLimitExceeded",void 0);
b.__decorate([w.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);b.__decorate([w.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"_forceTilesMode",void 0);b.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"mode",null);b.__decorate([w.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);b.__decorate([w.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"tileDescriptors",null);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"_tileFetcher",void 0);b.__decorate([w.property()],a.FeatureTileController3D.prototype,"_fetchDataInfoPromise",void 0);a.FeatureTileController3D=b.__decorate([n.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(A){A.noServiceDataCount=Infinity;A.maxSnapshotMinScaleFactor=5;A.reset=
function(){A.maxFeatureCountForExtent=1E4;A.queryStatisticsTimeout=12E3;A.queryExtentTimeout=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){function D(B){return"dummy-tile-full-extent"===B.id}function C(B){let K=0;for(const L of B)L.features&&0<L.features.length&&L.alive&&(K=Math.max(K,L.descriptor.lij[0]));return K}function E(B){B.setFeatures([],0,null);B.featuresMissing=!1;return r.FetchStatus.DONE}function A(B){return null==B?new Set:new Set(B.map(K=>K.name))}function F(B,K){if(null==B||null==K)return A(K);const L=new Set;for(const {name:J}of K)B.has(J)&&L.add(J);return L}const G=
d.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=class extends g{set maximumNumberOfFeatures(B){B=B||Infinity;const K=this._get("maximumNumberOfFeatures");B===K||1>B||(this._set("maximumNumberOfFeatures",B),this._maximumFeaturesUpdated(K,B))}set memoryFactor(B){this.memoryFactor!==B&&(this._set("memoryFactor",B),this._setDirty())}set lodFactor(B){this.lodFactor!==B&&(this._set("lodFactor",B),this._supportsResolution&&this.refetch())}get useTileCount(){return this._useTileCount&&
null!=this.context.query.queryFeatureCount}set useTileCount(B){this._useTileCount=B;this.notifyChange("useTileCount")}get memoryForUnusedFeatures(){let B=0;this._featureTiles.forEach(K=>B+=K.estimatedUnusedSize);return B}get totalVertices(){let B=0;this._featureTiles.forEach(K=>B+=K.numVertices);return B}get totalFeatures(){let B=0;this._featureTiles.forEach(K=>B+=K.numFeatures);return B}set filterExtent(B){if(null!=B&&this.context.tilingScheme&&!B.spatialReference.equals(this.context.tilingScheme.spatialReference))G.error("#filterExtent\x3d",
"extent needs to be in the same spatial reference as the tiling scheme");else{var K=this._get("filterExtent");K===B||null!=K&&B&&K.equals(B)||(B=null!=B?B.clone():null,this._set("filterExtent",B),this._reclip(B,K))}}constructor(B){super(B);this.running=this.updating=this._useTileCount=!1;this.expectedFeatureDiff=this.updatingRemaining=this.updatingTotal=0;this.maximumNumberOfFeaturesExceeded=!1;this._farRatio=this._fullRatio=1;this._changes={updates:{adds:[],removes:[]},adds:[],removes:[]};this._frameTask=
z.ImmediateTask;this._dirty=!1;this._featureTiles=new Map;this._displayingFeatureReferences=new Map;this._numDisplayingFeatureReferences=0;this._suspended=!0;this._pendingEdits=null}initialize(){this.addHandles(f.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{onListenerAdd:()=>this._setDirty()}));this._objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?v.MultiFeatureReference:v.SingleFeatureReference;const B=this.context.scheduler;
null!=B&&(this._frameTask=B.registerTask(z.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()}destroy(){this._frameTask.remove();this._featureTiles.forEach(B=>{this._cancelFetchTile(B);this._removeTile(B)});this._featureTiles.clear();this._displayingFeatureReferences.clear();this._pendingEdits?.controller.abort();this._pendingEdits=null}get _paused(){return this._suspended||!!this._pendingEdits}restart(){this._featureTiles.forEach(B=>{this._cancelFetchTile(B);this._clearTile(B);this._resetFetchTile(B)});
null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()}refetch(){this._featureTiles.forEach(B=>{this._cancelFetchTile(B);this._resetFetchTile(B)});null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()}suspend(){this._suspended||(this._suspended=!0,this._pause(),this._setDirty())}resume(){this._suspended&&(this._suspended=!1,this._unpause())}_pause(){this._paused&&(this._featureTiles.forEach(B=>this._cancelFetchTile(B)),this._updated())}_unpause(){this._paused||
(this._setDirty(),this._updated())}get availableFields(){let B=null;this._featureTiles.forEach(K=>{null!=K.displayingFeatures&&0!==K.displayingFeatures.length&&(null==B?B=new Set(K.availableFields):B.forEach(L=>{K.availableFields.has(L)||B.delete(L)}))});return null!=B?B:new Set}applyEdits(B){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const K=this._pendingEdits;K.count++;const L=K.edits.then(()=>B.result.catch(J=>{if(m.isAbortError(J))throw J;
return null}).then(J=>{if(!J)return J;this._applyEditsDeleteFeatures(J.deletedFeatures);return this._applyEditsAddUpdateFeatures(J.addedFeatures,J.updatedFeatures,K.controller.signal).then(()=>J)}).then(J=>{0===--K.count&&(this._pendingEdits===K&&(this._pendingEdits=null),null!=this.context.memoryCache&&this.context.memoryCache.clear(),this._unpause(),this._updated());return J}));K.edits=L;this._updated();return L}_applyEditsDeleteFeatures(B){if(0!==B.length){var K=this.context.globalIdField,L=K&&
this.availableFields.has(K),J=new Set,M=this._objectIdField;B.forEach(({objectId:T,globalId:Q})=>{(!T||0>T)&&K&&Q&&(L||G.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${K} to be included the layer's outFields for updates to be reflected in the view`),T=this._objectIdFromGlobalId(Q,M,K));null!=T&&0<=T&&J.add(T)});this._featureTiles.forEach(T=>{if(T.features){var Q=T.features.filter(O=>!J.has(x.getObjectId(O,this._objectIdField)));Q.length!==T.features.length&&
(T.setFeatures(Q,0,T.availableFields),this._invalidateCounts())}})}}_objectIdFromGlobalId(B,K,L){if(null==B)return null;const J=this.features.find(M=>M.attributes?.[L]===B);return J?x.getObjectId(J,K):null}async _applyEditsAddUpdateFeatures(B,K,L){const {objectIdField:J,globalIdField:M}=this.context,T=M&&this.availableFields.has(M),Q=new Set,O=new Set;for(const Z of B)B=Z.objectId,null!=B&&Q.add(B);for(const {objectId:Z,globalId:P}of K)K=Z,(null==K||0>K)&&M&&(T||G.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${M} to be included the layer's outFields for updates to be reflected in the view`),
K=this._objectIdFromGlobalId(P,J,M)),null!=K&&0<=K&&(Q.add(K),O.add(K));if(0!==Q.size){var U=[];this._featureTiles.forEach(Z=>{(Z=this._applyEditsAddUpdateTile(Z,Q,O,L))&&U.push(Z)});await Promise.allSettled(U)}}async _applyEditsAddUpdateTile(B,K,L,J){if(B.features){var M=this._createQuery(B);M.resultType=void 0;M.cacheHint=!1;M.objectIds=Array.from(K);K=await this._queryFeatures(M,J);J=null;0<L.size&&(M=B.features.filter(T=>!L.has(x.getObjectId(T,this._objectIdField))),M.length!==B.features.length&&
(J=M));if(0<K.features.length){J||(J=B.features.slice());for(const T of K.features)J.push(T)}J&&(B.hasPreciseFeatureCount&&(B.numFeatures=Math.max(B.numFeatures,J.length)),B.setFeatures(J,0,F(B.availableFields,K.fields)),this._invalidateCounts())}}_queryFeatures(B,K){return this.context.query.queryFeaturesDehydrated(B,{signal:K,timeout:6E5})}_setDirty(){this._dirty=!0;this._updated()}runTask(B){this._frameTask.processQueue(B);if(this._dirty&&this.initialized){this._dirty=!1;var K=this._getListOfTiles();
this._markTilesNotAlive(K);if(B.run(()=>this._addTiles(K,B))&&B.run(()=>this._filterExtentTiles(K,B))&&B.run(()=>this._removeTiles(K,B))&&!B.done){var L=this._sortTiles(K);B.run(()=>this._showTiles(L,B))&&B.run(()=>this._fetchTiles(L,B))&&B.run(()=>this._updateMemoryEstimates(L,B))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}}_markTilesNotAlive(B){for(const K of B)K.alive=!1}_addTiles(B,K){if(this._suspended||!this.tileDescriptors)return!1;
this.tileDescriptors.forEach(L=>{const J=this._featureTiles.get(L.id);J?J.alive=!0:K.done||(B.push(this._addTile(L)),K.madeProgress())});return K.hasProgressed}_filterExtentTiles(B,K){for(const L of B){if(K.done)break;L.alive&&(L.filtered=!L.intersects(this.filterExtent),L.filtered&&(this._clearTile(L),K.madeProgress()))}return K.hasProgressed}_removeTiles(B,K){for(let L=B.length-1;0<=L&&!K.done;L--){const J=B[L];J.alive||(this._removeTile(J),L!==B.length-1&&(B[L]=B[B.length-1]),B.pop(),K.madeProgress())}return K.hasProgressed}_sortTiles(B){B.sort((K,
L)=>(K.descriptor.loadPriority??0)-(L.descriptor.loadPriority??0));return B}_showTiles(B,K){const L=this._updateRatio(B),J=M=>{const T=1>this._fullRatio?L(M)*this._farRatio:1;M.reduceFeatures(T,this.memoryFactor,this._objectIdField)&&this._setDirty();return this._showTile(M)};for(const M of B)if(!K.run(()=>J(M))){this._setDirty();break}return K.hasProgressed}_fetchTiles(B,K){if(this._paused)return!1;var L=!1;for(const M of B)if(M.needsFetching){var J=null!=this.context.memoryCache?this.context.memoryCache.pop(M.id):
null;if(null!=J)M.cache=J,this._setDirty(),this._scheduleUpdated(),K.madeProgress();else if(this._needsNumFeatures(M)&&(L=new AbortController,J=this._fetchTileCount(M,L.signal),this._handleRequest(M,J,L,()=>M.numFeatures=r.failedFeatureCount),L=!0,K.madeProgress()),K.done)return!0}if(L)return K.hasProgressed;for(const M of B)if(M.needsFetching&&(B=new AbortController,L=this._fetchTile(M,B.signal),this._handleRequest(M,L,B,T=>{M.setFeatures([],0,null);this._invalidateCounts();M.featuresMissing=!1;
this.context.logFetchError(G,T)}),K.madeProgress()))return!0;return K.hasProgressed}_updateMemoryEstimates(B,K){B.some(L=>K.run(()=>L.updateMemoryEstimates())?!1:(this._setDirty(),!0));return K.hasProgressed}_reclip(B,K){if(this.initialized){var L=[];this._featureTiles.forEach(J=>{null!=J.displayingFeatures&&0!==J.displayingFeatures.length&&(J.intersectionIncludingBorrowed(K,I),J.intersectionIncludingBorrowed(B,H),w.equals(I,H)||L.push(J))});this._refreshDisplayingFeatures(L);this._updated()}}_refreshDisplayingFeatures(B){const K=
new Set,L=this._changes.updates;for(const J of B)if(null!=J.displayingFeatures)for(const M of J.displayingFeatures)B=x.getObjectId(M,this._objectIdField),K.has(B)||(K.add(B),B=this._displayingFeatureReferences.get(B).feature,L.removes.push(B),L.adds.push(B));this._applyChanges()}_updated(){let B=0;this._paused||this._featureTiles.forEach(L=>L.isFetching?++B:0);var K=this._dirty||!!this._pendingEdits||0<B;this._set("running",this._dirty);this._set("updating",K);if(K){let L=0,J=0,M=0,T=0,Q=0;const O=
this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(Z=>{++J;if(Z.isFetching&&Z.hasPreciseFeatureCount){const P=this._maximumFeaturesForTile(Z)*(1-Z.emptyFeatureRatio);Q+=P-(null!=Z.displayingFeatures?Z.displayingFeatures.length*O:0)}Z.needsFetching?++T:0<Z.numFeatures&&(++M,L+=Z.numFeatures)});T+=B;let U=K=0;L?(U=L,K=Math.min(T*L/M,L)):(U=J,K=T);Q=Math.min(this.maximumNumberOfFeatures-this.features.length,Q);this._set("updatingTotal",U);this._set("updatingRemaining",
K);this._set("expectedFeatureDiff",Q)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}_updateMaximumNumberOfFeaturesExceeded(){const B=k.someMap(this._featureTiles,K=>K.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",B)}_updateRatio(B){const K=C(B),L=T=>1/(1<<Math.max(0,K-T.descriptor.lij[0]));let J=0,M=0;for(const T of B)B=T.numFeatures,J+=B,M+=B*L(T);this._fullRatio=Math.min(1,
this.maximumNumberOfFeatures/J);this._farRatio=this.maximumNumberOfFeatures/M;this._scheduleUpdated();return L}_maximumFeaturesUpdated(B,K){B!==K&&(K>B&&this._featureTiles.forEach(L=>{if(L.featuresMissing){var J=this._maximumFeaturesForTile(L);L.features&&(L.features.length>=J||L.fetchStatus===r.FetchStatus.FULL)||(this._cancelFetchTile(L),this._resetFetchTile(L))}}),this._setDirty())}_addTile(B){B=new r.FeatureTile(B);this._featureTiles.set(B.id,B);this._resetFetchTile(B);this._referenceDisplayingFeaturesFromRelatedTiles(B);
return B}_referenceDisplayingFeaturesFromRelatedTiles(B){const K=B.descriptor.resolution;this._featureTiles.forEach(L=>{if(!(null==L.displayingFeatures||B===L||B.descriptor.lij&&L.descriptor.lij&&!y.tilesAreRelated(B.descriptor.lij,L.descriptor.lij))){null==B.displayingFeatures&&(B.displayingFeatures=[]);B.descriptor.extent&&L.descriptor.extent&&(null==B.extentIncludingBorrowedFeatures&&(B.extentIncludingBorrowedFeatures=w.clone(B.descriptor.extent)),w.expand(B.extentIncludingBorrowedFeatures,L.descriptor.extent,
B.extentIncludingBorrowedFeatures));for(const J of L.displayingFeatures)B.displayingFeatures.push(J),L=this._displayingFeatureReferences.get(x.getObjectId(J,this._objectIdField)),L.ref(L.feature,K),this._numDisplayingFeatureReferences++}});B.featureLimit=null!=B.displayingFeatures?B.displayingFeatures.length:0}_removeTile(B){this._clearTile(B);this._featureTiles.delete(B.id)}_resetFetchTile(B){B.filtered=!B.intersects(this.filterExtent);B.filtered?B.needsFetching&&(B.fetchStatus=r.FetchStatus.DONE):
B.fetchStatus=r.FetchStatus.FETCH_NEEDED}_cancelFetchTile(B){const K=B.requestController;null!=K&&(B.requestController=null,B.resetFetching(),K.abort())}async _fetchTileCount(B,K){B.numFeatures=await this._fetchCount(B,K);this._updateRatio(this._getListOfTiles());return B.fetchStatus===r.FetchStatus.REFETCHING?r.FetchStatus.REFETCH_NEEDED:r.FetchStatus.FETCH_NEEDED}async _fetchTile(B,K){var L=this._maximumFeaturesForTile(B);if(0>=L)return E(B);const J=this._getMaxRecordCount(B);var M=Math.ceil(L/
J);if(D(B)||!this.context.capabilities.supportsMaxRecordCountFactor||B.numFeatures<=L&&M>q.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(B,K);M=this._createQuery(B);M.maxRecordCountFactor=Math.ceil(L/J);B.isRefetching&&B.features&&0<B.features.length&&(M.maxRecordCountFactor=Math.max(Math.ceil(B.features.length/(1-B.emptyFeatureRatio)/J)+1,M.maxRecordCountFactor));const {features:T,exceededTransferLimit:Q,fields:O}=await this._queryFeatures(M,K);L=Q?M.maxRecordCountFactor>=q.MAX_MAX_RECORD_COUNT_FACTOR?
r.FetchStatus.FULL:r.FetchStatus.DONE:r.FetchStatus.FULL;await this._frameTask.schedule(()=>{B.featuresMissing=T.length<B.numFeatures||!!Q;const U=this._removeEmptyFeatures(T);B.setFeatures(T,U,A(O))},K);m.throwIfAborted(K);this._invalidateCounts();return L}async _fetchCount(B,K){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(B),{signal:K})}async _fetchPagedTile(B,K){let L=0,J=0,M,T=0,Q=this._maximumFeaturesForTile(B)-T;const O=this._getMaxRecordCount(B);let U=null;for(;;){const Z=
this._createQuery(B),P=this._setPagingParameters(Z,L,Q,O),{features:R,exceededTransferLimit:W,fields:N}=await this._queryFeatures(Z,K);await this._frameTask.schedule(()=>{P&&(L+=Z.num);T+=R.length;J+=this._removeEmptyFeatures(R);B.featuresMissing=L<B.numFeatures||!!W;M=M?M.concat(R):R;U=F(U,N);B.setFeatures(M,J,U)},K);m.throwIfAborted(K);this._invalidateCounts();this._setDirty();Q=this._maximumFeaturesForTile(B)-T;if(!P||!W||0>=Q)return W?r.FetchStatus.DONE:r.FetchStatus.FULL}}_createFeatureCountQuery(B){B=
this._createQuery(B);this.context.capabilities.supportsCacheHint&&(B.resultType=void 0,B.cacheHint=!0);return B}_createQuery(B){const K=this.context.createQuery(),L=B.descriptor.extent;L&&(K.geometry=w.toExtent(L,this.context.tilingScheme.spatialReference));this._setResolutionParams(K,B);this._useTileQuery(B)?K.resultType="tile":this.context.capabilities.supportsCacheHint&&(K.cacheHint=!0);return K}_setPagingParameters(B,K,L,J){if(!this.context.capabilities.supportsPagination)return!1;B.start=K;0<
L&&this.context.capabilities.supportsMaxRecordCountFactor?(B.maxRecordCountFactor=Math.ceil(L/J),B.num=Math.min(B.maxRecordCountFactor*J,L)):B.num=Math.min(J);return!0}_getEffectiveTileResolution(B){if(null==B.descriptor.resolution)return null;const K=this.context.viewingMode===t.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(B.descriptor.resolution,K)/this.lodFactor}get _supportsResolution(){return this.context.capabilities.supportsMultipleResolutions&&
"point"!==this.context.geometryType}_setResolutionParams(B,K){this._supportsResolution&&(K=this._getEffectiveTileResolution(K),null!=K&&(this.context.capabilities.supportsQuantization?B.quantizationParameters=new n({mode:"view",originPosition:"upper-left",tolerance:K,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(B.maxAllowableOffset=K)))}_removeEmptyFeatures(B){const K=B.length;for(let L=0;L<B.length;)x.hasVertices(B[L].geometry)?++L:(B[L]=B[B.length-1],--B.length);return K-
B.length}_needsNumFeatures(B){return this.useTileCount&&B.needsFeatureCount&&!D(B)}_getMaxRecordCount(B){const {tileMaxRecordCount:K,maxRecordCount:L}=this.context;return this._useTileQuery(B)&&null!=K&&0<K&&this.context.capabilities.supportsResultType?K:null!=L&&0<L?L:2E3}_useTileQuery(B){return D(B)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType}_handleRequest(B,K,L,J){B.fetchStatus=B.needsRefetching?r.FetchStatus.REFETCHING:r.FetchStatus.FETCHING;B.requestController=
L;let M=!1;K.then(T=>{B.requestController=null;B.fetchStatus=T}).catch(T=>{B.requestController===L&&(B.requestController=null,B.fetchStatus=r.FetchStatus.DONE);m.isAbortError(T)?M=!0:J(T)}).then(()=>{M||this._setDirty();this._scheduleUpdated()})}_scheduleUpdated(){this.hasHandles("scheduleUpdated")||this.addHandles(c.schedule(()=>{this.removeHandles("scheduleUpdated");this._updated()}),"scheduleUpdated")}_showTile(B){if(null!=B.displayingFeatures&&!B.needsDisplayUpdate)return!1;var K=B.features;if(0===
B.featureLimit||!K)return K=null!=B.displayingFeatures&&0<B.displayingFeatures.length,this._hideTileFeatures(B),B.displayingFeatures=[],K;const L=B.descriptor.resolution,J=this._changes.updates,M=this._changes.adds,T=Math.min(B.featureLimit,K.length);B.featureLimit=T;for(let O=0;O<T;++O){var Q=K[O];const U=x.getObjectId(Q,this._objectIdField),Z=this._displayingFeatureReferences.get(U);Z?(Q=Z.ref(Q,L),Q.oldVersion!==Q.newVersion&&(Q.oldVersion&&J.removes.push(Q.oldVersion),Q.newVersion&&J.adds.push(Q.newVersion))):
(this._displayingFeatureReferences.set(U,new this.FeatureReferenceClass(Q,L)),M.push(Q));this._numDisplayingFeatureReferences++}this._hideTileFeatures(B);this._applyChanges();B.displayingFeatures=K.slice(0,T);return!0}_hideTile(B){this._cancelFetchTile(B);this._hideTileFeatures(B)}_hideTileFeatures(B){if(null!=B.displayingFeatures){var K=this._changes.updates,L=this._changes.removes;for(const M of B.displayingFeatures){const T=x.getObjectId(M,this._objectIdField);var J=this._displayingFeatureReferences.get(T);
J&&((J=J.unref(B.descriptor.resolution),this._numDisplayingFeatureReferences--,J)?J.oldVersion!==J.newVersion&&(null==J.newVersion?(this._displayingFeatureReferences.delete(T),J.oldVersion&&L.push(J.oldVersion)):(K.adds.push(J.newVersion),J.oldVersion&&K.removes.push(J.oldVersion))):console.error("Hiding unreferenced feature"))}this._applyChanges();B.displayingFeatures=null}}_applyChanges(){var B=this._changes.updates;0<B.removes.length&&(this.features.removeMany(B.removes),B.removes.length=0);0<
B.adds.length&&(this.features.addMany(B.adds),B.adds.length=0);B=this._changes.adds;const K=this._changes.removes,L=Math.min(B.length,K.length);let J=0;for(;J<L;){const M=Math.min(J+200,L);this.features.addMany(B.slice(J,M));this.features.removeMany(K.slice(J,M));J=M}B.length>L&&this.features.addMany(0===J?B:B.slice(J));K.length>L&&this.features.removeMany(0===J?K:K.slice(J));B.length=0;K.length=0}_clearTile(B){this._hideTile(B);B.features&&null!=this.context.memoryCache&&this.context.memoryCache.put(B.id,
B.cache,16+B.estimatedSize);B.setFeatures(null,0,null);this._invalidateCounts()}_invalidateCounts(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")}_getListOfTiles(){return Array.from(this._featureTiles.values())}get storedFeatures(){return this._getListOfTiles().reduce((B,K)=>B+(K.features?K.features.length:0),0)}get missingTiles(){return Array.from(this._featureTiles.values()).reduce((B,K)=>B+(K.needsFetching||K.isFetching?1:0),
0)}_maximumFeaturesForTile(B){const K=B.hasPreciseFeatureCount?B.numFeatures:Infinity;return Math.min(Math.ceil((B.hasPreciseFeatureCount?K:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-B.emptyFeatureRatio)),K)}get test(){return{process:B=>this.runTask(B),getFeatureTileById:B=>this._featureTiles.get(B),forEachFeatureTile:B=>this._featureTiles.forEach(B)}}};b.__decorate([l.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);b.__decorate([l.property()],
a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);b.__decorate([l.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([l.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);b.__decorate([l.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,
"updating",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"running",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",
null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);b.__decorate([l.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=
b.__decorate([u.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const I=w.create(),H=w.create();a.contextCapabilitiesFromLayer=function(B){const K=B.capabilities.query;a:switch(B.geometryType){case "polyline":B=!0;break a;case "polygon":B=B.capabilities&&B.capabilities.query&&B.capabilities.query.supportsQuantization;break a;default:B=!1}return{supportsMultipleResolutions:B,supportsPagination:!(!K||!K.supportsPagination),supportsResultType:!(!K||!K.supportsResultType),
supportsCacheHint:!(!K||!K.supportsCacheHint),supportsQuantization:!(!K||!K.supportsQuantization),supportsQuantizationEditMode:!(!K||!K.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!K||!K.supportsMaxRecordCountFactor),supportsFormatPBF:!(!K||!K.supportsFormatPBF)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureReference":function(){define("exports ../../../../core/has ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../core/mathUtils ../../../../geometry/Extent ../../../../geometry/Geometry ../../../../geometry/Multipoint ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/support/typeUtils ../../../../layers/support/Field ../../../../layers/graphics/dehydratedFeatureComparison".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){class x{get isReferenced(){return 0!==this.versions.length}get isSingle(){return 1===this.versions.length&&1===this.versions[0].refCount}constructor(t,v){this._highestResolutionVersion=null;this.versions=[];this.ref(t,v)}ref(t,v){const r=this.feature;q.oldVersion=r;this.feature&&Object.defineProperty(t,"uid",{value:this.feature.uid,configurable:!0});for(var y of this.versions)if(y.resolution===v){y.refCount++;if((v=this._highestResolutionVersion===y&&!w.equals(t,
y.feature))||this._highestResolutionVersion!==y)y.feature=t;q.newVersion=v?t:r;return q}y={feature:t,resolution:v,refCount:1};this.versions.push(y);!this._highestResolutionVersion||v<this._highestResolutionVersion.resolution?(q.newVersion=t,this._highestResolutionVersion=y):q.newVersion=r;return q}unref(t){for(let v=0;v<this.versions.length;v++){const r=this.versions[v];if(r.resolution===t)return r.refCount--,q.oldVersion=this.feature,0===r.refCount&&(this.versions[v]=this.versions[this.versions.length-
1],this.versions.length--,this._highestResolutionVersion===r&&(this._recalculateHighestResolutionVersion(),q.oldVersion=r.feature)),q.newVersion=this.feature,q}return null}get feature(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}_recalculateHighestResolutionVersion(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var t=this.versions[0];for(let v=1;v<this.versions.length;v++){const r=this.versions[v];r.resolution<t.resolution&&(t=r)}this._highestResolutionVersion=
t}}}class n{get isReferenced(){return 0!==this._refCount}get isSingle(){return 1===this._refCount}constructor(t){this._feature=t;this._refCount=1}ref(t){++this._refCount;q.oldVersion=this._feature;this.feature&&Object.defineProperty(t,"uid",{value:this.feature.uid,configurable:!0});w.equals(this._feature,t)||(this._feature=t);q.newVersion=this._feature;return q}unref(){q.oldVersion=this._feature;if(0<this._refCount&&(this._refCount--,!this.isReferenced))return q.newVersion=null,q;q.newVersion=this._feature;
return q}get feature(){return this._feature}}const q={oldVersion:null,newVersion:null};a.MultiFeatureReference=x;a.SingleFeatureReference=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTile":function(){define(["exports","../../../../core/arrayUtils","../../../../geometry/support/aaBoundingRect","../../../../layers/graphics/dehydratedFeatures"],function(a,b,g,d){const k=new Set;class m{get displayingFeatures(){return this._displayingFeatures}set displayingFeatures(c){this._displayingFeatures=
c;this.extentIncludingBorrowedFeatures=null}get perTileMaximumNumberOfFeaturesExceeded(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}get features(){return this._features}get featureLimit(){return this._featureLimit}set featureLimit(c){this._featureLimit!==c&&(this._featureLimit=c,this._estimatedUnusedSizeDirty=!0)}get availableFields(){return this._availableFields}setFeatures(c,l,e){this._availableFields=e??k;this._features=c;this._shuffled=
!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;c&&0<c.length?(this._emptyFeatureRatio=l/(c.length+l),this._numVertices=c.reduce((p,h)=>p+d.numVertices(h.geometry),0)):this._numVertices=this._emptyFeatureRatio=0}get emptyFeatureRatio(){return this._emptyFeatureRatio}get numFeatures(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0}set numFeatures(c){this._numFeatures=c}get hasPreciseFeatureCount(){return-1<this._numFeatures}get needsFeatureCount(){return-1===
this._numFeatures}get numVertices(){return this._numVertices}constructor(c){this.descriptor=c;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=k;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}get id(){return this.descriptor.id}get estimatedSize(){this.updateMemoryEstimates();
return this._estimatedSize}get estimatedUnusedSize(){return this._estimatedUnusedSize}updateMemoryEstimates(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var c=0;c<this._features.length;++c){const l=d.estimateSize(this._features[c]);this._estimatedSize+=l;c>=this.featureLimit&&(this._estimatedUnusedSize+=l)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(c=this.featureLimit;c<
this._features.length;++c)this._estimatedUnusedSize+=d.estimateSize(this._features[c]);return!0}return!1}get isFetching(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}get isRefetching(){return this.fetchStatus===a.FetchStatus.REFETCHING}get needsFetching(){return this.fetchStatus===a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}get needsRefetching(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}get isFetched(){return this.fetchStatus===
a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}resetFetching(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED}get needsDisplayUpdate(){var c;if(c=!!this._features){a:{c=this._features;var l=this.displayingFeatures,e=this.featureLimit;if(null==l||null==c||e!==l.length||e>c.length)c=!1;else{for(let p=0;p<e;++p)if(c[p]!==l[p]){c=!1;break a}c=!0}}c=!c}return c}intersects(c){if(null==c||!this.descriptor.extent)return!0;g.fromExtent(c,
f);return g.intersects(this.descriptor.extent,f)}intersectionIncludingBorrowed(c,l){const e=null!=this.extentIncludingBorrowedFeatures?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!c&&!e)return g.copy(l,g.positiveInfinity),l;null!=c?(g.fromExtent(c,l),g.intersection(l,e,l)):g.copy(l,e);return l}_shuffle(c){this._features.sort((l,e)=>d.getObjectId(l,c)-d.getObjectId(e,c));b.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0}reduceFeatures(c,l,e){if(0>=
c)return!1;if(!this._features)return this.featureLimit=0,!1;let p=!1;this.featureLimit=Math.ceil(this.numFeatures*c);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,p=!0));!this._shuffled&&1>c&&this._shuffle(e);c=Math.max(this.featureLimit,Math.ceil(l*this.numFeatures));this._features.length>c&&(this._features.length=c,this.featuresMissing=!0,this.fetchStatus===
a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return p}get cache(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}}set cache(c){this.requestController=null;this._availableFields=c.availableFields;this._features=c.features;this._numFeatures=c.numFeatures;this._emptyFeatureRatio=c.emptyFeatureRatio;this.fetchStatus=c.fetchStatus;
this.featuresMissing=c.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}a.FetchStatus=void 0;(function(c){c[c.FETCH_NEEDED=0]="FETCH_NEEDED";c[c.REFETCH_NEEDED=1]="REFETCH_NEEDED";c[c.FETCHING=2]="FETCHING";c[c.REFETCHING=3]="REFETCHING";c[c.DONE=4]="DONE";c[c.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));const f=g.create();a.FeatureTile=m;a.failedFeatureCount=-2;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../Graphic ../../../../symbols ../../../../core/Collection ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../../../symbols/support/Symbol3DVerticalOffset ../../terrain/TilingScheme ../../../../symbols/callouts/LineCallout3D".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){const u=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];class w{constructor(x,n,q){this._loadingGraphics=new Map;this._loadedGraphics=new Map;this._pendingGraphics=new Map;this._dataExtentGraphic=null;this._enabled=!0;this._tileFetcher=x;this._view=q;this._tilingScheme=new p.TilingScheme(n);
this._loadedSymbols=u.map(t=>new c({symbolLayers:new d([new m({material:{color:[t[0],t[1],t[2],.6]},outline:{color:"black",size:1}})])}));this._loadingSymbols=[new c({symbolLayers:new d([new m({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}})])})];this._pendingSymbols=[new c({symbolLayers:new d([new m({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}})])})];this._dataExtentSymbol=new c({symbolLayers:new d([new m({material:{color:[0,0,0,0]},outline:{color:"green",
size:4}})])})}destroy(){this.enabled=!1}get enabled(){return this._enabled}set enabled(x){this._enabled=x;this.update()}update(){this._enabled?(this._synchronizeMaps(this._loadingGraphics,{filter:x=>x.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:x=>!x.isFetching,symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:x=>!x.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(x=>
{this._view.graphics.removeMany(x)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(x=>{this._view.graphics.removeMany(x)}),this._loadedGraphics.clear(),this._pendingGraphics.forEach(x=>{this._view.graphics.removeMany(x)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))}showDataExtent(x){this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null);null!=
x&&(x=k.fromExtent(x),this._dataExtentGraphic=new b({geometry:x,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic))}_synchronizeMaps(x,n){const q=[];x.forEach((t,v)=>{const r=this._tileFetcher.test.getFeatureTileById(v);r&&n.filter(r)||(this._view.graphics.removeMany(t),q.push(v))});q.forEach(t=>x.delete(t));this._tileFetcher.test.forEachFeatureTile(t=>{if(n.filter(t)&&!x.has(t.id)){const [y,z,D]=t.descriptor.lij;this._tilingScheme.ensureMaxLod(y);var v=this._tilingScheme.getExtentGeometry(y,
z,D),r=new b({geometry:v,symbol:n.symbols[y%n.symbols.length]});v=new b({geometry:v.center,symbol:new f({verticalOffset:new e({screenLength:40/.75}),callout:new h({color:"white",border:{color:"black"}}),symbolLayers:new d([new l({text:`${y}/${z}/${D}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})])})});r=[r,v];x.set(t.id,r);this._view.graphics.addMany(r)}})}}a.FeatureTileFetcher3DDebugger=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ../../../symbols/support/utils ./graphics/elevationAlignPointsInFeatures ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./graphics/queryForSymbologySnapping ./support/HeatmapFeatureProcessor ./support/projectExtentUtils ../webgl-engine/lib/UpdatePolicy ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){a.FeatureLikeLayerView3D=D=>{D=class extends D{constructor(){super(...arguments);this.controller=null;this.updatePolicy=y.UpdatePolicy.SYNC;this.suspendResumeExtentMode="computed";this.slicePlaneEnabled=!1;this.suspendResumeExtent=this.fullExtentInLocalViewSpatialReference=null;this._controllerCreated=!1;this.supportsHeightUnitConversion=!0;this.queryEngine=this._pendingController=null}initialize(){const C=this.layer;if("isTable"in C&&C.isTable)this.addResolvingPromise(Promise.reject(new g("featurelayerview:table-not-supported",
"table feature layer can't be displayed",{layer:C})));else{this.addResolvingPromise(this._validateGeometryType());this._updatingHandles.add(()=>this.layer.renderer,A=>this._recreateProcessor(A),k.initial);this.addResolvingPromise((async()=>{this.fullExtentInLocalViewSpatialReference=await r.toViewIfLocal(this);await this._initializeController()})());this._updatingHandles.add(()=>this.updatePolicy,A=>this.processor.preferredUpdatePolicy=A);var E=()=>this.processor.featureStore;this.queryEngine=new q.QueryEngine({context:{spatialReference:this.view.spatialReference,
layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return E()},hasZ:this.hasZ,hasM:this.hasM},priority:z.TaskPriority.FEATURE_QUERY_ENGINE});this.notifyChange("updating")}}destroy(){this._destroyPendingController();this.controller=d.destroyMaybe(this.controller);this._set("processor",d.destroyMaybe(this.processor));this.queryEngine=d.destroyMaybe(this.queryEngine);this.loadedGraphics=null}_destroyPendingController(){this._pendingController=d.destroyMaybe(this._pendingController)}get legendEnabled(){return this.canResume()&&
this.processor?.legendEnabled}get graphics3DProcessor(){return"graphics-3d"===this.processor?.type?this.processor:null}get heatmapProcessor(){return"heatmap"===this.processor?.type?this.processor:null}get symbologySnappingSupported(){return this.layer?.renderer?.getSymbols()?.some(w.symbolHasExtrudeSymbolLayer)??!1}getHit(C){let E;this.loadedGraphics?.forEach(A=>{A.uid===C&&(E=p.hydrateGraphic(A,this.layer))});return E?{type:"graphic",graphic:E,layer:E.layer}:null}whenGraphicBounds(C,E){return this.processor?.whenGraphicBounds(C,
E)}computeAttachmentOrigin(C,E){return this.processor?.computeAttachmentOrigin(C,E)}async elevationAlignPointsInFeatures(C,E){const A=this.graphics3DProcessor;if(null==A)throw new g("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");return x.elevationAlignPointsInFeatures(this.view,this.layer,F=>A.getGraphics3DGraphicByObjectId(F),C,E)}async queryForSymbologySnapping(C,E){return this.symbologySnappingSupported?t.queryForSymbologySnapping(this.graphics3DProcessor,
C,E):{candidates:[],sourceCandidateIndices:[]}}queryFeatures(C,E){return this.queryEngine.executeQuery(this._ensureQuery(C),E?.signal)}queryObjectIds(C,E){return this.queryEngine.executeQueryForIds(this._ensureQuery(C),E?.signal)}queryFeatureCount(C,E){return this.queryEngine.executeQueryForCount(this._ensureQuery(C),E?.signal)}queryExtent(C,E){return this.queryEngine.executeQueryForExtent(this._ensureQuery(C),E?.signal)}_ensureQuery(C){return null==C?this.createQuery():u.from(C)}highlight(C){return this.processor.highlight(C,
this.layer.objectIdField)}maskOccludee(C){return this.processor.maskOccludee(C)}canResume(){return super.canResume()&&!this.processor?.scaleVisibilitySuspended}getSuspendInfo(){const C=super.getSuspendInfo();return this.processor?{...C,...this.processor.suspendInfo}:C}isUpdating(){return!this.processor||this.processor.destroyed?!1:!(this._controllerCreated&&!this.controller?.updating&&this.view?.basemapTerrain?.ready&&!this.processor.updating)}async _initializeController(){const C=this.createController();
this._pendingController=C;await C.when();this._setControllerWhenInitialized(C)}async _setControllerWhenInitialized(C){try{await this.when()}catch(E){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this._destroyPendingController():(await k.whenOnce(()=>this.view?.basemapTerrain?.ready),this.beforeSetController(C),this._pendingController=null,this.controller=C,this.loadedGraphics=C.graphics,this.notifyChange("updating"))}_updateClippingExtent(C){this.clippingExtent=
C;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=C,!0}}async _validateGeometryType(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new g("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}}_recreateProcessor(C){var E="heatmap"===C?.type;const A="heatmap"===this.processor?.type;C=this.processor;C&&E===A||
(E=E?new v.HeatmapFeatureProcessor({owner:this}):new n.Graphics3DFeatureProcessor({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:F=>this._updateClippingExtent(F)}),this._set("processor",E),C?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(E.initializePromise))}_getResourceInfo(){const C=this.controller instanceof
h.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics?.length,maximumNumberOfFeatures:C?.maximumNumberOfFeatures??-1,totalNumberOfFeatures:C?.serviceDataCount??-1,nodes:0,...this.processor.performanceInfo}}get performanceInfo(){return this._getResourceInfo()}};b.__decorate([m.property()],D.prototype,"loadedGraphics",void 0);b.__decorate([m.property()],D.prototype,"suspended",void 0);b.__decorate([m.property({readOnly:!0})],D.prototype,"legendEnabled",
null);b.__decorate([m.property()],D.prototype,"updating",void 0);b.__decorate([m.property()],D.prototype,"controller",void 0);b.__decorate([m.property()],D.prototype,"processor",void 0);b.__decorate([m.property({readOnly:!0})],D.prototype,"updatePolicy",void 0);b.__decorate([m.property({readOnly:!0})],D.prototype,"suspendResumeExtentMode",void 0);b.__decorate([m.property({type:Boolean})],D.prototype,"slicePlaneEnabled",void 0);b.__decorate([m.property({readOnly:!0})],D.prototype,"suspendInfo",void 0);
b.__decorate([m.property()],D.prototype,"graphics3DProcessor",null);b.__decorate([m.property()],D.prototype,"heatmapProcessor",null);b.__decorate([m.property()],D.prototype,"symbologySnappingSupported",null);return D=b.__decorate([e.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],D)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignPointsInFeatures":function(){define("exports ../../../../geometry ../../../../core/promiseUtils ../../../../geometry/projection/projectPointToVectorWithEngine ../../../../layers/graphics/dehydratedPoint ../../../../support/elevationInfoUtils ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ../../../../geometry/SpatialReference".split(" "),
function(a,b,g,d,k,m,f,c,l,e){const p=new c.ElevationContext,h=k.makeDehydratedPoint(0,0,0,e.WGS84),u=new f.SampleElevationInfo,w=[0,0,0];a.elevationAlignPointsInFeatures=async function(x,n,q,t,v){const {elevationProvider:r,renderCoordsHelper:y}=x,{elevationInfo:z}=n,{pointsInFeatures:D,spatialReference:C}=t;var E=e.fromJSON(C);t=l.extractExpressionInfo(z,!0);t=await l.createContext(t,E,v);g.throwIfAborted(v);const A=[],F=new Set,G=new Set;h.spatialReference=E;x=x.elevationProvider.spatialReference??
x.spatialReference;for(const {objectId:I,points:H}of D)if(E=q(I),null==E){for(const B of H)A.push(B.z??0);F.add(I)}else{E.isDraped&&G.add(I);p.setFromElevationInfo(m.getGeometryEffectiveElevationInfo(E.graphic.geometry,z));p.updateFeatureExpressionInfoContext(t,E.graphic,n);for(const {x:B,y:K,z:L}of H)h.x=B,h.y=K,h.z=L??0,await d.projectPointToVectorWithEngine(h,w,x,0,{signal:v}),f.evaluateElevationInfoAtPoint(w,r,p,y,u),A.push(u.z)}return{elevations:A,drapedObjectIds:G,failedObjectIds:F}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../arcade/functions/hash ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../core/support/UpdatingHandles ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/randomRotationExpression ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./DisplayFeatureLimit ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../support/FeatureVisibilityFilter ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/UpdatePolicy".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L){a.Graphics3DFeatureProcessor=class extends k{constructor(J){super(J);this.type="graphics-3d";this._randomRotationRenderers=null;this._updatingHandles=new n.UpdatingHandles;this.timeExtentEnabled=this.elevationAlignmentEnabled=this.frustumVisibilityEnabled=this.filterVisibilityEnabled=this.scaleVisibilityEnabled=this.elevationFeatureExpressionEnabled=!1;this.setUidToIdOnAdd=!0;this.dataExtent=null;this.drapeSourceType=y.DrapeSourceType.Features;
this.preferredUpdatePolicy=L.UpdatePolicy.ASYNC;this._suspendResumeExtent=null}initialize(){const J=this.owner,M=new C.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:J.hasZ,hasM:J.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:T=>J.view.deconflictor.addGraphicsOwner(T),labeler:(T,Q)=>J.view.labeler.addGraphicsOwner(T,Q),elevationAlignment:this.elevationAlignmentEnabled?
(T,Q)=>new E.Graphics3DElevationAlignment({graphicsCoreOwner:this,graphicsCore:T,queryGraphicUIDsInExtent:Q,elevationProvider:J.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(T,Q)=>new G.Graphics3DScaleVisibility({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:Q,graphicsCore:T,basemapTerrain:J.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==J.layer.geometryType?T=>new B.FeatureVisibilityFilter({context:{layerView:J,
...T}}):null,objectStates:T=>new F.Graphics3DObjectStates(T)}});this._set("graphicsCore",M);this.frustumVisibilityEnabled&&this._set("frustumVisibility",new A.Graphics3DFrustumVisibility({graphicsCoreOwner:this}));this.elevationAlignment&&this._updatingHandles.add(()=>this.layer.elevationInfo,(T,Q)=>{x.diff(T,Q)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this._updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this._updatingHandles.add(()=>
this.layer.labelingInfo,(T,Q)=>{x.diff(T,Q)&&this.graphicsCore.updateLabelingInfo()});this._updatingHandles.add(()=>this.preferredUpdatePolicy,T=>this.graphicsCore.preferredUpdatePolicy=T);this._set("initializePromise",this._initializeAsync());this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){await l.logOnError(this.graphicsCore.initializePromise);const J=this.owner;this._updatingHandles.add(()=>this.renderer,M=>this._updatingHandles.addPromise(this.graphicsCore.rendererChange(M)));
this._updatingHandles.add(()=>J.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this._updatingHandles.add(()=>J.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await l.logOnError(this.graphicsCore.updateLabelingInfo())}destroy(){this._updatingHandles.destroy();this._set("frustumVisibility",c.destroyMaybe(this.frustumVisibility));
this._set("graphicsCore",c.destroyMaybe(this.graphicsCore));this._set("owner",null)}get layer(){return this.owner.layer}get renderer(){const {renderer:J,objectIdField:M}=this.layer;if(!J||!M||"heatmap"===J.type||!J.visualVariables)return J;const T=J.visualVariables.findIndex(O=>"rotation"===O.type&&null!=O.valueExpression&&t.matchRandomRotationExpression(O.valueExpression)===M&&(null==O.axis||"heading"===O.axis)&&"geographic"===O.rotationType);if(0>T)return J;const Q=J.clone();Q.visualVariables.splice(T,
1);this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap);this._randomRotationRenderers.set(Q,M);return Q}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get filterVisibility(){return this.graphicsCore?.filterVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get objectStates(){return this.graphicsCore?.objectStates}get suspendResumeExtentMode(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}get scaleVisibilitySuspended(){return null!=
this.scaleVisibility&&this.scaleVisibility.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return null==this.frustumVisibility||!this.frustumVisibility.suspended}get suspendInfo(){const J={};this.scaleVisibilitySuspended&&(J.outsideScaleRange=!0);null!=this.frustumVisibility&&this.frustumVisibility.suspended&&(J.outsideOfView=!0);return J}get updating(){return!!(this.graphicsCore?.updating||this.frustumVisibility?.updating||this._updatingHandles.updating)}get updatingRemaining(){return this.graphicsCore?.updatingRemaining??
0}get featureStore(){return this.graphicsCore?.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner?.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}get featureSpatialReference(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get symbolUpdateType(){return this.graphicsCore?.symbolUpdateType}get displayFeatureLimit(){const J=
this.view.quality,M=this.graphicsCore?.displayFeatureLimit;return 1===J?M:new D.DisplayFeatureLimit(M.maximumTotalNumberOfVertices,Math.ceil(M.maximumNumberOfFeatures*J),M.averageSymbolComplexity)}get usedMemory(){return this.graphicsCore?.usedMemory??0}get loadedFeatures(){return this.graphicsCore?.numberOfGraphics??0}get usedMemoryPerFeature(){return this.graphicsCore?.usedMemoryPerGraphic??0}get unprocessedMemoryEstimate(){return this.graphicsCore?.unprocessedMemoryEstimate??0}get performanceInfo(){return{core:this.graphicsCore.performanceInfo,
elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:null==this.frustumVisibility||!this.frustumVisibility.suspended,visibilityScale:!this.scaleVisibilitySuspended}}maskOccludee(J){const {set:M,handle:T}=this.objectStates.acquireSet(K.Object3DState.MaskOccludee,null);this.objectStates.setUid(M,J.uid);return T}highlight(J,M){if(J instanceof r){const {set:T,handle:Q}=this.objectStates.acquireSet(K.Object3DState.Highlight,M);this.owner.queryObjectIds(J).then(O=>this.objectStates.setObjectIds(T,
O));return Q}if("number"===typeof J||"string"===typeof J||J instanceof g)return this.highlight([J],M);"toArray"in J&&(J=J.toArray());if(Array.isArray(J)&&0<J.length){if(J[0]instanceof g)if(null!=H.attributeLookup(this.layer.fieldsIndex,J[0].attributes,M))J=J.map(T=>H.attributeLookup(this.layer.fieldsIndex,T.attributes,M));else{J=J.map(O=>O.uid);const {set:T,handle:Q}=this.objectStates.acquireSet(K.Object3DState.Highlight,null);this.objectStates.setUids(T,J);return Q}if(Array.isArray(J)&&("number"===
typeof J[0]||"string"===typeof J[0])){const {set:T,handle:Q}=this.objectStates.acquireSet(K.Object3DState.Highlight,M);this.objectStates.setObjectIds(T,J);return Q}}return f.makeHandle()}resetObjectStates(){this.objectStates.reset()}whenGraphicBounds(J,M){return this.graphicsCore?.whenGraphicBounds(J,M)}computeAttachmentOrigin(J,M){return this.graphicsCore?.computeAttachmentOrigin(J,M)}notifyGraphicGeometryChanged(J){this.graphicsCore.notifyGraphicGeometryChanged(J)}notifyGraphicVisibilityChanged(J){this.graphicsCore.notifyGraphicVisibilityChanged(J)}getRenderingInfo(J,
M,T){T=v.getRenderingInfo(J,{renderer:M,arcade:T});if(T?.color){const Q=T.color;Q[0]/=255;Q[1]/=255;Q[2]/=255}null!=T&&null!=M&&this._randomRotationRenderers?.has(M)&&(M=this._randomRotationRenderers.get(M),J=J.attributes[M],M=new d.XXH(0),M.updateFloatArray([J]),M.updateUint8Array([173]),T.heading=8.381E-8*M.digest());return T}getRenderingInfoAsync(J,M,T,Q){return v.getRenderingInfoAsync(J,{renderer:M,arcade:T,...Q})}getSymbolLayerSize(J,M){return this.graphicsCore?.getSymbolLayerSize(J,M)}setObjectIdVisibility(J,
M){this.graphicsCore?.setObjectIdVisibility(J,M)}refreshFilter(){null!=this.filterVisibility&&this.filterVisibility.reapply()}getGraphics3DGraphicByObjectId(J){return this.graphicsCore?.getGraphics3DGraphicByObjectId(J)}_updateClippingExtent(){const J=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(J,this.owner.view.spatialReference)&&(this.updateClippingExtent(J)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&
this.addHandles(e.watch(()=>this.suspendResumeExtentMode,()=>{this.removeHandles("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.addHandles([e.watch(()=>this.graphicsCore.computedExtent,J=>this._updateSuspendResumeExtent(J),e.initial),e.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this.addHandles([e.when(()=>this.dataExtent,J=>this._updateSuspendResumeExtent(J),
e.initial),e.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.dataExtent))],"suspendResumeExtentMode");break;default:m.neverReached(this.suspendResumeExtentMode)}},e.initial))}_updateSuspendResumeExtent(J){J?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(J,this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)}_extentToSuspendResumeRect(J,M){const T=this.owner.view.spatialReference;if(!J.spatialReference.equals(T)){if(!q.canProject(J,
T))return;J=q.project(J,T)}return I.enlargeExtent(J,M,z.suspendResumeExtentOptimism,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(J){null!=this.frustumVisibility&&this.frustumVisibility.setExtent(J);null!=this.scaleVisibility&&this.scaleVisibility.setExtent(J)}};b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"type",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"owner",void 0);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,
"layer",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"renderer",null);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"updateClippingExtent",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"graphicsCore",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,
"scaleVisibilityEnabled",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"filterVisibilityEnabled",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"frustumVisibilityEnabled",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"elevationAlignmentEnabled",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"timeExtentEnabled",void 0);
b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"setUidToIdOnAdd",void 0);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"scaleVisibility",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"filterVisibility",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"elevationAlignment",null);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"frustumVisibility",void 0);
b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"objectStates",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"initializePromise",void 0);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"suspendResumeExtentMode",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"dataExtent",void 0);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"scaleVisibilitySuspended",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,
"suspended",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"legendEnabled",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"suspendInfo",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"updating",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"updatingRemaining",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"featureStore",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,
"view",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"loadedGraphics",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"filter",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"slicePlaneEnabled",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"drapeSourceType",void 0);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,
"updatePolicy",null);b.__decorate([p.property()],a.Graphics3DFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([p.property({readOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"displayFeatureLimit",null);a.Graphics3DFeatureProcessor=b.__decorate([w.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],a.Graphics3DFeatureProcessor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/functions/hash":function(){define(["exports"],function(a){function b(d){const k=
[];for(let m=0,f=d.length;m<f;m++){let c=d.charCodeAt(m);128>c?k.push(c):2048>c?k.push(192|c>>6,128|c&63):55296>c||57344<=c?k.push(224|c>>12,128|c>>6&63,128|c&63):(m++,c=65536+((c&1023)<<10|d.charCodeAt(m)&1023),k.push(240|c>>18,128|c>>12&63,128|c>>6&63,128|c&63))}return new Uint8Array(k)}class g{constructor(d){this._seed=d;this._totallen=0;this._bufs=[];this.init()}init(){this._bufs=[];this._totallen=0;return this}updateFloatArray(d){const k=[];for(const m of d)isNaN(m)?k.push("NaN"):Infinity===
m?k.push("Infinity"):-Infinity===m?k.push("-Infinity"):0===m?k.push("0"):k.push(m.toString(16));this.update(b(k.join("")))}updateIntArray(d){d=Int32Array.from(d);this.update(new Uint8Array(d.buffer))}updateUint8Array(d){this.update(Uint8Array.from(d))}updateWithString(d){return this.update(b(d))}update(d){this._bufs.push(d);this._totallen+=d.length;return this}digest(){const d=new Uint8Array(this._totallen);let k=0;for(const m of this._bufs)d.set(m,k),k+=m.length;this.init();return this._xxHash32(d,
this._seed)}_xxHash32(d,k=0){var m=k+374761393&4294967295;let f=0;if(16<=d.length){m=[k+2654435761+2246822519&4294967295,k+2246822519&4294967295,k+0&4294967295,k-2654435761&4294967295];k=d.length-16;var c=0;for(f=0;(f&4294967280)<=k;f+=4){var l=f;l=m[c]+(2246822519*(d[l]+(d[l+1]<<8))+(2246822519*(d[l+2]+(d[l+3]<<8))<<16))&4294967295;l=l<<13|l>>>19;m[c]=2654435761*(l&65535)+(2654435761*(l>>>16)<<16)&4294967295;c=c+1&3}m=(m[0]<<1|m[0]>>>31)+(m[1]<<7|m[1]>>>25)+(m[2]<<12|m[2]>>>20)+(m[3]<<18|m[3]>>>
14)&4294967295}m=m+d.length&4294967295;for(k=d.length-4;f<=k;f+=4)c=f,m=m+(3266489917*(d[c]+(d[c+1]<<8))+(3266489917*(d[c+2]+(d[c+3]<<8))<<16))&4294967295,m=m<<17|m>>>15,m=668265263*(m&65535)+(668265263*(m>>>16)<<16)&4294967295;for(;f<d.length;++f)m+=374761393*d[f],m=m<<11|m>>>21,m=2654435761*(m&65535)+(2654435761*(m>>>16)<<16)&4294967295;m^=m>>>15;m=(2246822519*(m&65535)&4294967295)+(2246822519*(m>>>16)<<16);m^=m>>>13;m=(3266489917*(m&65535)&4294967295)+(3266489917*(m>>>16)<<16);m^=m>>>16;return 0>
m?m+4294967296:m}}a.XXH=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/DisplayFeatureLimit":function(){define(["exports"],function(a){class b{constructor(g,d,k){this.maximumTotalNumberOfVertices=g;this.maximumNumberOfFeatures=d;this.averageSymbolComplexity=k}}a.DisplayFeatureLimit=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../core/Logger ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/handleUtils ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToVector ../../../../geometry/projection/projectXYZToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../support/basemapUtils ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./defaultSymbolComplexity ./DisplayFeatureLimit ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/WebGLLayer ../../../layers/support/popupUtils ../../../support/Scheduler ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba,ia,ka,na,Y,ea,fa,aa,da,ma,ua,sa,ra,Aa,qa,la,ja,oa,za,ta,Ca,Ga,La,Ma,Ra,Ya,ab){var Wa;const cb=B.create(),Na=T.create(),xa=u.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=Wa=class extends x{get _viewSpatialReference(){return this.owner.view.spatialReference}get spatialIndex(){this._spatialIndex||(this._spatialIndex=new ra.SpatialIndex2D({objectIdField:this.owner.layer?.objectIdField,
spatialReference:this._viewSpatialReference,hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}get numberOfGraphics(){return this._numberOfGraphics}get effectiveUpdatePolicy(){return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?oa.UpdatePolicy.ASYNC:this._forcedUpdatePolicy??this.preferredUpdatePolicy}get featureStore(){return this._featureStore}get initializePromise(){return this._initializePromise}get scaleVisibility(){return this._scaleVisibility}get elevationAlignment(){return this._elevationAlignment}get objectStates(){return this._objectStates}get filterVisibility(){return this._filterVisibility}get updating(){return!!(0<
this._graphicsWaitingForSymbol.size||this.running||this._elevationAlignment?.updating||this._scaleVisibility?.updating||this._filterVisibility?.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating||0<this._loadingSymbols)}get running(){return 0<this._pendingUpdates.size||!!this._spatialIndex?.updating}get suspendedOrOutsideOfView(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}get updatingRemaining(){return this.updating?
this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}get displayFeatureLimit(){var wa=this.owner&&this.owner.view&&this.owner.view.qualitySettings,Ba=wa?.graphics3D.maxTotalNumberOfFeatures??0;const Ja=wa?.graphics3D.maxNumberOfDrawCalls??0,Ta=wa?.graphics3D.maxTotalNumberOfVertices??0,db=this.averageSymbolComplexity;wa=Math.max(wa?.graphics3D.minTotalNumberOfFeatures??0,Math.min(Ba,Math.ceil(Ta/Math.max(1,db?.verticesPerFeature??
1)),db&&0<db.drawCallsPerFeature&&0<Ja?Ja/db.drawCallsPerFeature:Ba));return(Ba=this._get("displayFeatureLimit"))&&Ba.maximumTotalNumberOfVertices===Ta&&Ba.averageSymbolComplexity===db&&Ba.maximumNumberOfFeatures===wa?Ba:new ca.DisplayFeatureLimit(Ta,wa,db)}get averageSymbolComplexity(){const wa=X.averageSymbolComplexities(this._symbolComplexities),Ba=this._get("averageSymbolComplexity");return 0===wa.numComplexities||null!=Ba&&(wa.estimated&&(Ba.verticesPerFeature>=wa.verticesPerFeature||Ba.verticesPerCoordinate>=
wa.verticesPerCoordinate||Ba.drawCallsPerFeature>=wa.drawCallsPerFeature)||Ba.verticesPerFeature===wa.verticesPerFeature&&Ba.verticesPerCoordinate===wa.verticesPerCoordinate&&Ba.drawCallsPerFeature===wa.drawCallsPerFeature)?Ba:wa}get usedMemory(){const wa=null!=this.averageSymbolComplexity&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,Ba=this._getSymbolComplexitiesUsed().reduce((lb,mb)=>lb+mb.memory.resourceBytes,0),Ja=this.owner.view._stage.renderer,
Ta=this.owner.view.basemapTerrain.overlayManager.renderer,db=Array.from(this._symbols.values()).reduce((lb,mb)=>lb+(mb?.symbolLayers.reduce((ob,pb)=>ob+(pb?.materials.reduce((zb,rb)=>zb+Ja.getMemoryForMaterial(rb)+Ta.getMemoryForMaterial(rb),0)??0),0)??0),0);return this._usedMemory+wa+Ba+db}get usedMemoryPerGraphic(){return this._usedMemory&&this._numberOfGraphics?this._usedMemory/this._numberOfGraphics*(this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves))):
null!=this.averageSymbolComplexity?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}get unprocessedMemoryEstimate(){return(this._pendingAdds-this._pendingRemoves)*this.usedMemoryPerGraphic}get _symbolComplexities(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}get visible(){return this._visible}_getConvertedSymbol(wa){if("web-style"===
wa.type)return wa.clone();var Ba=this._symbolConversionCache.get(wa.id);if(null!=Ba)return Ba;Ba=S.to3D(wa,{geometryType:this.layer?.geometryType??void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(wa)});const Ja=Ba.symbol||null;null==Ja&&Ba.error&&xa.error(Ba.error.message);this._symbolConversionCache.set(wa.id,Ja);return Ja}_getSymbolComplexitiesUsedOrRenderer(wa){if(null==wa)return[];var Ba=wa.getSymbols(),Ja="backgroundFillSymbol"in wa?wa.backgroundFillSymbol:null;if(!Ja&&!Ba?.length)return[];
wa=[];Ja=this._getSymbolComplexityUsedOrRenderer(Ja);null!=Ja&&wa.push(Ja);for(const Ta of Ba)Ba=this._getSymbolComplexityUsedOrRenderer(Ta),null!=Ba&&wa.push(Ba);return wa}_getSymbolComplexityUsedOrRenderer(wa){if(null==wa)return null;const Ba=this._symbols.get(wa.id);if(null!=Ba)return Ba.complexity;wa=this._getConvertedSymbol(wa);return null!=wa?X.defaultSymbolComplexity(wa):null}_getSymbolComplexitiesUsed(){const wa=[];this._symbols.forEach(Ba=>{null!=Ba&&wa.push(Ba.complexity)});return wa}get _objectIdField(){return this.layer.objectIdField}constructor(wa){super(wa);
this._propertiesPool=new la.PropertiesPool({computedExtent:La},this);this.currentRenderer=this.computedExtent=null;this.rendererHasGeometryOperations=!1;this._graphicStateTracking=null;this.graphics3DGraphics=new Map;this.stage=this.stageLayer=null;this._graphicsDrapedUids=new Set;this._graphicsBySymbol=new Map;this._symbolConversionCache=new Map;this._symbols=new Map;this._graphicsWithoutSymbol=new Map;this._graphicsWaitingForSymbol=new Map;this._graphicsUpdateId=0;this._frameTask=Ga.ImmediateTask;
this._suspendSymbolCleanup=!1;this._spatialIndex=this._filterVisibility=this._scaleVisibility=this._initializeAbortController=this._elevationInfoChangeAbortController=this._rendererChangeAbortController=this._arcadeOnDemand=null;this.extentPadding=0;this._sharedSymbolResourcesOwnerHandle=this._stageLayerElevationProvider=this._viewElevationProvider=this._objectStates=this._labeler=this._deconflictor=this._featureStore=this._updatingPendingLoadedGraphicsChange=null;this._whenGraphics3DGraphicRequests=
{};this._pendingUpdates=new Map;this._pendingRemoves=this._pendingAdds=this._numberOfGraphicsProvidingElevation=this._numberOfGraphics=0;this._applyPendingRemovesFirst=!1;this._loadingSymbols=0;this._pendingUpdatesPool=new z({allocator:Ba=>Ba||new Ka,deallocator:Ba=>{Ba.clear();return Ba}});this._geometryWarningLogged=this._symbolWarningLogged=!1;this._objectIdInvisibleSet=new Set;this._whenSymbolRemoved=new z;this.preferredUpdatePolicy=oa.UpdatePolicy.SYNC;this._forcedUpdatePolicy=null;this.elevationFeatureExpressionEnabled=
!0;this.layer=this.owner=null;this.graphicSymbolSupported=!0;this.getRenderingInfoWithoutRenderer=!1;this.setUidToIdOnAdd=!0;this.hasM=this.hasZ=null;this._usedMemory=0;this._startCreateGraphics=this._visible=!1;this.symbolCreationContext=new ea.Graphics3DSymbolCreationContext(wa.owner.view.resourceController.scheduler,(Ba,Ja)=>this._frameTask.schedule(Ba,Ja))}initialize(){this._featureStore=new na.Graphics3DFeatureStore({objectIdField:this.owner.layer?.objectIdField,hasZ:!!this.hasZ,hasM:!!this.hasM,
viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:Ja=>this.graphics3DGraphics.forEach(Ja)});const wa=(Ja,Ta,db)=>this.spatialIndex.queryGraphicUIDsInExtent(Ja,Ta,db),{componentFactories:Ba}=this;null!=Ba.elevationAlignment&&(this._elevationAlignment=Ba.elevationAlignment(this,wa));null!=Ba.scaleVisibility&&(this._scaleVisibility=Ba.scaleVisibility(this,wa));null!=Ba.filterVisibility&&(this._filterVisibility=
Ba.filterVisibility({featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:Ja=>this.modifyGraphics3DGraphicVisibilities(Ta=>Ta.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,ia.VisibilityFlag.FILTER,Ja(Z.getObjectId(Ta.graphic,this._objectIdField)))),setAllFeaturesVisibility:Ja=>this.modifyGraphics3DGraphicVisibilities(Ta=>Ta.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,ia.VisibilityFlag.FILTER,Ja)),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities(Ja=>
Ja.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,ia.VisibilityFlag.FILTER,!0))}));null!=Ba.deconflictor&&(this._deconflictor=Ba.deconflictor(this));null!=Ba.labeler&&null!=this._scaleVisibility&&(this._labeler=Ba.labeler(this,this._scaleVisibility));null!=Ba.objectStates&&(this._objectStates=Ba.objectStates(this));this._initializeAbortController=new AbortController;this._initializePromise=this._initializeAsync()}async _initializeAsync(){const wa=this._initializeAbortController?.signal,Ba=this.owner.view;
this._viewElevationProvider=new ba.ViewElevationProvider(this._viewSpatialReference,Ba);this._initializeStage(Ba,this.layer.uid);var Ja=Ba.sharedSymbolResources;this.symbolCreationContext.sharedResources=Ja;this._sharedSymbolResourcesOwnerHandle=Ja.addGraphicsOwner(this.owner);null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Ja.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=
Ba.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new ja.GridLocalOriginFactory(Ba.renderSpatialReference);this.symbolCreationContext.elevationProvider=Ba.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Ta=>this.notifyGraphicGeometryChanged(Ta);this.symbolCreationContext.notifyGraphicVisibilityChanged=Ta=>this.notifyGraphicVisibilityChanged(Ta);Ja=ka.extractExpressionInfo(this.layer.elevationInfo,
this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await ka.createContext(Ja,this._viewSpatialReference,wa,xa);D.throwIfAborted(wa);this.symbolCreationContext.screenSizePerspectiveEnabled=Ba.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled;
this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods;if("drapeSourceType"in this.owner){const {owner:Ta}=this;this.symbolCreationContext.drapeSourceRenderer=Ba.basemapTerrain.overlayManager.registerGeometryDrapeSource(Ta);this.addHandles(v.makeHandle(()=>Ba.basemapTerrain.overlayManager.unregisterDrapeSource(Ta)))}this.addHandles([C.watch(()=>this.suspendedOrOutsideOfView,()=>this._frameTask.reschedule(()=>this._updateLayerVisibility())),
C.watch(()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view?.screenSizePerspectiveEnabled],()=>{const Ta=Ba.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;Ta!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=Ta,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())}),C.watch(()=>this.owner.slicePlaneEnabled,Ta=>this._slicePlaneEnabledChange(!!Ta)),C.watch(()=>this.owner.view.state?.rasterPixelRatio,
()=>this._pixelRatioChange()),C.watch(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,Ta=>this._physicalBasedRenderingChange(Ta)),C.watch(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,Ta=>this._skipHighSymbolLoDsChange(Ta)),C.when(()=>Ba.basemapTerrain?.tilingScheme,Ta=>{Ta.spatialReference.equals(this.symbolCreationContext.overlaySR)||null==Ba.basemapTerrain.spatialReference||(this.symbolCreationContext.overlaySR=Ba.basemapTerrain.spatialReference);
this.hasHandles("loaded-graphics")?this.recreateAllGraphics():this.addHandles([C.on(()=>this.owner?.loadedGraphics,"change",db=>{this._graphicsCollectionChanged(db);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),C.watch(()=>this.effectiveUpdatePolicy,Ta=>{null!=this.stageLayer&&(this.stageLayer.updatePolicy=Ta);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===
oa.UpdatePolicy.ASYNC;Ta===oa.UpdatePolicy.SYNC&&this.runTask(Ga.noBudget)},C.syncAndInitial)]);this._frameTask=Ba.resourceController.scheduler.registerTask(Ga.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this.addHandles(C.watch(()=>this.layer.featureReduction,()=>this._deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");this.rendererChange(this.owner.renderer).catch(()=>{});this._initializeAbortController=null}_abortInitialize(){this._initializeAbortController&&
(this._initializeAbortController.abort(),this._initializeAbortController=null)}destroy(){this._abortInitialize();this._abortRendererChange();this._abortElevationInfoChange();this._frameTask.remove();this._frameTask=Ga.ImmediateTask;this.owner.view?.deconflictor?.removeGraphicsOwner(this);this.owner.view?.labeler?.removeGraphicsOwner(this);this._elevationAlignment=y.destroyMaybe(this._elevationAlignment);this._scaleVisibility=y.destroyMaybe(this._scaleVisibility);this._filterVisibility=y.destroyMaybe(this._filterVisibility);
this._labeler=this._deconflictor=null;this._objectStates=y.destroyMaybe(this._objectStates);this.clear();this._featureStore=y.destroyMaybe(this._featureStore);this._updatingPendingLoadedGraphicsChange=y.removeMaybe(this._updatingPendingLoadedGraphicsChange);this._graphicStateTracking=y.destroyMaybe(this._graphicStateTracking);this.stage&&(this.stageLayer=y.destroyMaybe(this.stageLayer),this.stage=null);this._set("owner",null);for(const wa in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[wa].reject(new t("graphic:layer-destroyed",
"Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null;this._sharedSymbolResourcesOwnerHandle=y.removeMaybe(this._sharedSymbolResourcesOwnerHandle);this._propertiesPool=y.destroyMaybe(this._propertiesPool);this._pendingUpdatesPool=null;this._symbolConversionCache.clear();this._objectIdInvisibleSet.clear();this._spatialIndex=y.destroyMaybe(this._spatialIndex)}clear(){this._objectStates?.allGraphicsDeleted();null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted();
this.graphics3DGraphics.forEach(wa=>wa.destroy());this._spatialIndex?.clear();this.graphics3DGraphics.clear();this._usedMemory=this._numberOfGraphics=0;this._updateLayerVisibility();this._symbols.forEach(y.destroyMaybe);this._symbols.clear();this._graphicsBySymbol.clear();this._graphicsWithoutSymbol.clear();this._graphicsWaitingForSymbol.clear();this._pendingUpdates.clear();this._pendingUpdatesPool.clear();this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1;this.notifyChange("updating");
this.notifyChange("running");this.notifyChange("updatingRemaining");this._featureStore.events.emit("changed")}_initializeStage(wa,Ba){this.stage=wa._stage;this.stageLayer=new ta.WebGLLayer(this.stage,{pickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},Ba);wa=this.stageLayer.events;wa.on("transformationChanged",Ja=>this.notifyGraphicGeometryChanged(Ja.graphicUid));wa.on("shaderTransformationChanged",Ja=>this.notifyGraphicGeometryChanged(Ja.graphicUid));wa.on("visibilityChanged",
Ja=>this.notifyGraphicVisibilityChanged(Ja.graphicUid));wa.on("geometryAdded",Ja=>this.notifyGraphicGeometryChanged(Ja.object.graphicUid));wa.on("geometryRemoved",Ja=>this.notifyGraphicGeometryChanged(Ja.object.graphicUid));wa.on("attributesChanged",Ja=>za.affectsGeometry(Ja.attribute)&&this.notifyGraphicGeometryChanged(Ja.object.graphicUid))}notifyGraphicGeometryChanged(wa){null!=this._graphicStateTracking&&null!=wa&&(wa=this.graphics3DGraphics.get(wa))&&this._graphicStateTracking.updateGraphicGeometry(wa)}notifyGraphicVisibilityChanged(wa){null!=
this._graphicStateTracking&&null!=wa&&(wa=this.graphics3DGraphics.get(wa))&&this._graphicStateTracking.updateGraphicVisibility(wa)}_updateLayerVisibility(){var wa=this._numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;wa=!this.suspendedOrOutsideOfView&&!wa;wa!==this._visible&&((this._visible=wa)?(this.stageLayer.pickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.pickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())}_updateStageLayerVisibility(){this.stageLayer.visible=
this._visible&&(null==this.layer.opacity||0<this.layer.opacity)}getGraphics3DGraphicById(wa){return null!=wa?this.graphics3DGraphics.get(wa):void 0}getGraphics3DGraphicByObjectId(wa){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(wa):null}_getGraphicObjectID(wa,Ba=this.owner.layer?.objectIdField){return Z.getObjectId(wa,Ba)}get graphics3DGraphicsByObjectID(){const wa=this.owner.layer?.objectIdField;if(wa){var Ba=new Map;this.graphics3DGraphics.forEach(Ja=>{if(Ja){var Ta=
this._getGraphicObjectID(Ja.graphic,wa);null!=Ta&&Ba.set(Ta,Ja)}});return Ba}}get labelsEnabled(){return!(!this._labeler||!this._labeler.layerLabelsEnabled())}async updateLabelingInfo(wa){const Ba=this._deconflictor&&this._deconflictor.labelingInfoChange(wa);wa=this._labeler&&this._labeler.labelingInfoChange(wa);await Promise.allSettled([Ba,wa])}updateVisibilityInfo(){this._deconflictor&&this._deconflictor.labelingInfoChange();this._labeler&&this._labeler.visibilityInfoChange()}get symbolUpdateType(){if(0<
this._pendingUpdates.size)return"unknown";let wa=0,Ba=0;return r.someMap(this._symbols,(Ja,Ta)=>{if(null!=Ja){Ja=Ja.getFastUpdateStatus();if(0<Ja.loading)return!0;this._graphicsBySymbol.has(Ta)&&(Ba+=Ja.fast,wa+=Ja.slow)}return!1})?"unknown":0<=Ba&&0===wa?"fast":0<=wa&&0===Ba?"slow":"mixed"}runTask(wa){this._frameTask.processQueue(wa);this._applyPendingUpdates(wa);this.notifyChange("running");this.running||this.notifyChange("updating");this.notifyChange("updatingRemaining");if(!wa.hasProgressed)return Ga.Task.YIELD}setObjectIdVisibility(wa,
Ba){Ba?this._objectIdInvisibleSet.delete(wa):this._objectIdInvisibleSet.add(wa);wa=this._findGraphics3DGraphicByObjectId(wa);null!=wa&&this._updateUserVisibility(wa)}_findGraphics3DGraphicByObjectId(wa){return r.findInMap(this.graphics3DGraphics,Ba=>this._getGraphicObjectID(Ba.graphic)===wa)}_updateUserVisibility(wa){if(null==wa)return!1;var Ba=wa.graphic;const Ja=this._getGraphicObjectID(Ba);Ba=Ba.visible&&!this.owner.suspended&&(null==Ja||!this._objectIdInvisibleSet.has(Ja));return wa.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,
ia.VisibilityFlag.USER,Ba)}_whenGraphics3DGraphic(wa){var Ba=this.graphics3DGraphics.get(wa.uid);if(Ba)return Promise.resolve(Ba);if(Ba=this._whenGraphics3DGraphicRequests[wa.uid])return Ba.promise;Ba=D.createResolver();this._whenGraphics3DGraphicRequests[wa.uid]=Ba;return Ba.promise}async _boundsForGraphics3DGraphic(wa,Ba){const Ja=this._viewSpatialReference,Ta=this.owner.view.renderSpatialReference,db=this.owner.view.basemapTerrain.spatialReference;wa=await wa.getProjectedBoundingBox((mb,ob,pb)=>
L.projectBuffer(mb,Ta,ob,mb,Ja,ob,pb),(mb,ob,pb)=>L.projectBuffer(mb,db,ob,mb,Ja,ob,pb),this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=Ba?!!Ba.useViewElevation:!1,minDemResolution:null!=Ba?Ba.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null,Ba?.signal);if(!wa)return null;Ba=wa.boundingBox;if(wa.requiresDrapedElevation){var lb=this.symbolCreationContext.elevationProvider;lb&&(T.center(Ba,cb),lb=lb.getElevation(cb[0],cb[1],0,Ja,
"ground")??0,Ba[2]=Math.min(Ba[2],lb),Ba[5]=Math.max(Ba[5],lb))}return{boundingBox:Ba,screenSpaceObjects:wa.screenSpaceObjects}}async whenGraphicBounds(wa,Ba){await C.whenOnce(()=>this.owner?.loadedGraphics);const Ja=this.owner.layer?.objectIdField;var Ta=this.owner.loadedGraphics.find(db=>db===wa?!0:null!=Ja&&null!=db.attributes&&wa.attributes&&db.attributes[Ja]===wa.attributes[Ja]);if(!Ta)throw new t("internal:graphic-not-part-of-view","Graphic is not part of this view");Ta=await this._whenGraphics3DGraphic(Ta);
return this._boundsForGraphics3DGraphic(Ta,Ba)}computeAttachmentOrigin(wa,Ba){wa=this.graphics3DGraphics.get(wa.uid);if(!wa)return null;var Ja=wa.computeAttachmentOrigin();if(0===Ja.render.num&&0===Ja.draped.num)return null;H.set(ha,0,0,0);wa=0;if(0<Ja.render.num){if(!J.projectVectorToVector(Ja.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,Sa,Ba))return null;H.add(ha,ha,Sa);wa++}if(0<Ja.draped.num){const [Ta,db]=Ja.draped.origin;Ja=this._viewElevationProvider.getElevation(Ta,
db,"ground")??0;H.set(Sa,Ta,db,Ja);if(!J.projectVectorToVector(Sa,this._viewElevationProvider.spatialReference,Sa,Ba))return null;H.add(ha,ha,Sa);wa++}1<wa&&H.scale(ha,ha,1/wa);return new Ma({x:ha[0],y:ha[1],z:ha[2],spatialReference:Ba})}getSymbolLayerSize(wa,Ba){var Ja=this._symbols.get(wa.id);if(null==Ja)throw new t("internal:symbol-not-part-of-view","Symbol is not part of this view");wa=wa.symbolLayers.indexOf(Ba);if(-1===wa)throw new t("internal:missing-symbol-layer","Symbol layer is not in symbol");
Ja=Ja.getSymbolLayerSize(wa);if(null==Ja)throw new t("internal:missing-size","Symbol layer has no valid size");return Ja}_graphicsCollectionChanged(wa){this._startCreateGraphics&&(this.add(wa.added),this.remove(wa.removed))}graphicUpdateHandler(wa){const Ba=wa.graphic.uid,Ja=this.graphics3DGraphics.get(Ba);if(null!=Ja||null!=this._graphicsWithoutSymbol.get(Ba))switch(wa.property){case "visible":this._graphicUpdateVisibleHandler(Ja);break;case "geometry":this._graphicUpdateGeometryHandler(Ja,wa);break;
case "symbol":this._graphicUpdateSymbolHandler(Ja,wa);break;case "origin-transform":this._graphicUpdateTransformHandler(Ja,wa)}}_graphicUpdateGeometryHandler(wa,Ba){this._graphicUpdateGeometryOrTransformHandler(wa,Ba,()=>null!=Ba.newValue&&null!=wa&&wa.graphics3DSymbol.updateGeometry(wa,Ba.newValue));const Ja=Ba.graphic.geometry;null!=Ja&&this._expandComputedExtent(Ja)}_graphicUpdateTransformHandler(wa,Ba){const Ja=Ba.graphic.geometry;this._graphicUpdateGeometryOrTransformHandler(wa,Ba,()=>null!=
Ba.newValue&&null!=wa&&null!=Ja&&wa.graphics3DSymbol.updateTransform(wa,Ja.spatialReference,Ba.newValue,Ba.action))}_graphicUpdateGeometryOrTransformHandler(wa,Ba,Ja){if(null==Ba.graphic.geometry)this._recreateGraphic(Ba.graphic);else if(null==wa){if(wa=Ba.graphic.symbol?.id)if(wa=this._symbols.get(wa),null!=wa&&wa.loadStatus===sa.LoadStatus.LOADING)return;this._recreateGraphic(Ba.graphic)}else Ja()||this._recreateGraphic(wa.graphic)}_graphicUpdateSymbolHandler(wa,Ba){var Ja=Ba.graphic;const Ta=null!=
wa?wa.graphics3DSymbol:null!=Ba.oldValue?this._symbols.get(Ba.oldValue.id):null;if(null==Ta||null==Ba.newValue)this._recreateGraphic(Ja);else{var db=Ta.symbol;Ba=this._getConvertedSymbol(Ba.newValue);if(null!=Ba&&(Ba.type!==db.type||"web-style"===Ba.type)||"web-style"===db.type)this._recreateGraphic(Ja);else{var lb=this._graphicsBySymbol.get(db.id);if(lb&&1!==lb.size)this._recreateGraphic(Ja);else if(lb=I.diff(db,Ba),null==lb)this._updateSymbolMapping(db.id,Ba);else if(lb={diff:lb,graphics3DGraphicPatches:[],
symbolStatePatches:[]},Ta.prepareSymbolPatch(lb),I.isEmpty(lb.diff)){var mb=this._getRenderingInfo(Ja);if(null==mb)this._recreateGraphic(Ja);else{Ja=Ta.extentPadding;for(const ob of lb.symbolStatePatches)ob();Ja!==Ta.extentPadding&&this._recomputeExtentPadding();if(null!=wa)for(const ob of lb.graphics3DGraphicPatches)ob(wa,mb);this._updateSymbolMapping(db.id,Ba)}}else this._recreateGraphic(Ja)}}}_graphicUpdateVisibleHandler(wa){this._updateUserVisibility(wa)&&(this._labeler&&this.owner.view.labeler.setDirty(),
this.owner.view.deconflictor.setDirty())}recreateGraphics(wa){this._suspendSymbolCleanup=!0;this.remove(wa);this.add(wa);this._suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===oa.UpdatePolicy.SYNC&&this._cleanupSymbols()}_recreateGraphic(wa){this.recreateGraphics([wa])}_beginGraphicUpdate(wa){const Ba=this._graphicsUpdateId;this._graphicsUpdateId++;this._graphicsWaitingForSymbol.set(wa.uid,Ba);1===this._graphicsWaitingForSymbol.size&&this.notifyChange("updating");return Ba}_endGraphicUpdate(wa){wa&&
(this._graphicsWaitingForSymbol.delete(wa.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))}_recomputeExtentPadding(){let wa=0;this._symbols.forEach(Ba=>{null!=Ba&&(wa=Math.max(wa,Ba.extentPadding))});this._set("extentPadding",wa)}_expandComputedExtent(wa){var Ba=wa.spatialReference;Z.computeAABB(wa,Na);wa=this._viewSpatialReference;var Ja=Wa.tmpVec;!O.equals(Ba,wa)&&M.projectXYZToVector(Na[0],Na[1],0,Ba,Ja,wa)&&(Na[0]=Ja[0],Na[1]=Ja[1],M.projectXYZToVector(Na[3],
Na[4],0,Ba,Ja,wa),Na[3]=Ja[0],Na[4]=Ja[1]);if(isFinite(Na[0])&&isFinite(Na[3])&&isFinite(Na[1])&&isFinite(Na[4])){Ba=this.computedExtent;Ja=null;var Ta=isFinite(Na[2])&&isFinite(Na[5]),db=Ta&&(null==Ba?.zmin||Na[2]<Ba.zmin);Ta=Ta&&(null==Ba?.zmax||Na[5]>Ba.zmax);if(Ba){if(Na[0]<Ba.xmin||Na[1]<Ba.ymin||Na[3]>Ba.xmax||Na[4]>Ba.ymax||db||Ta)Ja=this._propertiesPool.get("computedExtent"),Ja.xmin=Math.min(Na[0],Ba.xmin),Ja.ymin=Math.min(Na[1],Ba.ymin),Ja.xmax=Math.max(Na[3],Ba.xmax),Ja.ymax=Math.max(Na[4],
Ba.ymax),Ja.spatialReference=wa}else Ja=this._propertiesPool.get("computedExtent"),Ja.xmin=Na[0],Ja.ymin=Na[1],Ja.xmax=Na[3],Ja.ymax=Na[4],Ja.spatialReference=wa;Ja&&(db&&(Ja.zmin=Na[2]),Ta&&(Ja.zmax=Na[5]),this._set("computedExtent",Ja))}}_abortElevationInfoChange(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)}async elevationInfoChange(){this._abortElevationInfoChange();const wa=new AbortController;this._elevationInfoChangeAbortController=
wa;const Ba=ka.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await ka.createContext(Ba,this._viewSpatialReference,wa.signal,xa);D.throwIfAborted(wa.signal);this._elevationInfoChangeAbortController=null;this._labeler?.elevationInfoChange();this.forEachGraphics3DSymbol((Ja,Ta,db)=>{Ja.globalPropertyChanged("elevationInfo",Ta)?Ta.forEach(lb=>{const mb=lb.graphic;lb=lb.labelLayers;for(const ob of lb)ob.graphics3DSymbolLayer.updateGraphicElevationContext(mb,
ob)}):this._recreateSymbol(db)});this.updateStageLayerElevationProvider();this._elevationAlignment?.elevationInfoChange()}updateStageLayerElevationProvider(){if(this._stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=y.disposeMaybe(this._stageLayerElevationProvider)}else(!this.layer.elevationInfo||
this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this._numberOfGraphicsProvidingElevation&&(this._stageLayerElevationProvider=new Aa.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))}_clearSymbolsAndGraphics(){this.clear();null!=this._filterVisibility&&this._filterVisibility.clear();this._labeler?.reset();this._deconflictor?.clear();
this._elevationAlignment?.clear();this.stageLayer?.invalidateSpatialQueryAccelerator();this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=y.disposeMaybe(this._stageLayerElevationProvider))}startCreateGraphics(){this._startCreateGraphics=!0;this.recreateAllGraphics()}recreateAllGraphics(){this._recreateAllGraphics(!1)}recreateAllGraphicsAndSymbols(){this._recreateAllGraphics(!0)}_recreateAllGraphics(wa=
!1){if(this._startCreateGraphics){var {loadedGraphics:Ba,view:Ja}=this.owner,Ta=Ja.basemapTerrain.tilingScheme&&Ba?.length?Ba.toArray():null;!wa&&Ta||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);Ta&&(wa?this.add(Ta):this.recreateGraphics(Ta))}}_recreateSymbol(wa){var Ba=
this._graphicsBySymbol.get(wa);const Ja=[];Ba&&(Ba.forEach((Ta,db)=>{const lb=Ta.usedMemory;this._conditionalRemove(Ta,db);this._spatialIndex?.remove(Ta);Ja.push(Ta.graphic);Ta.destroy();this._removeGraphics3DGraphic(db,lb);this._updateLayerVisibility();this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(wa,new Map));Ba=this._symbols.get(wa);y.destroyMaybe(Ba);this._symbols.delete(wa);this.add(Ja)}_recreateGraphicsForSymbol(wa){if(wa=this._graphicsBySymbol.get(wa)){const Ba=[];
wa.forEach(Ja=>Ba.push(Ja.graphic));this.recreateGraphics(Ba)}}_conditionalRemove(wa,Ba){this._graphicsDrapedUids.delete(Ba);this._objectStates?.removeGraphic(wa);this._labeler?.removeGraphic(wa);this._deconflictor?.removeGraphic(wa);null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(wa)}add(wa){wa&&0!==wa.length&&(this.owner.view.basemapTerrain?.tilingScheme?(this._updatePolicyForGraphics(wa)===oa.UpdatePolicy.ASYNC?this._addDelayed(wa):this._addImmediate(wa),this.notifyChange("updating")):
xa.error("#add()","Cannot add graphics before terrain surface has been initialized"))}_updatePolicyForGraphics(wa){if(this.effectiveUpdatePolicy===oa.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const Ba of wa)if(null!=Ba.geometry&&"mesh"===Ba.geometry.type&&!Ba.geometry.loaded)return oa.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy}_addImmediate(wa){this._symbolWarningLogged=this._geometryWarningLogged=!1;for(const Ba of wa)this._addGraphic(Ba,this._getRenderingInfo(Ba,
xa),oa.UpdatePolicy.SYNC);this._cleanupSymbols();this._labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()}_addDelayed(wa){for(const Ba of wa){wa=Ba.uid;let Ja=this._pendingUpdates.get(wa);Ja?Ja.add?Ja.state!==Da.NEW&&Ja.abortController?.abort():this._pendingAdds++:(Ja=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(wa,Ja));Ja.add=Ba}this.notifyChange("running");this.notifyChange("updatingRemaining")}remove(wa){this.effectiveUpdatePolicy===
oa.UpdatePolicy.ASYNC?this._removeDelayed(wa):this._removeImmediate(wa);this.notifyChange("updating")}_removeImmediate(wa){for(const Ba of wa)this._removeGraphic(Ba);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()}_removeDelayed(wa){for(const Ja of wa){wa=Ja.uid;var Ba=this._pendingUpdates.get(wa);Ba?Ba.add&&(Ba.remove?Ba.add=null:this._pendingUpdates.delete(wa),Ba.state===Da.LOADING&&Ba.abortController?.abort(),this._pendingAdds--):
(Ba=this._pendingUpdatesPool.pushNew(),Ba.remove=Ja,this._pendingUpdates.set(wa,Ba),this._pendingRemoves++,this._applyPendingRemovesFirst=!0)}0===this._pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")}_finishPendingUpdates(){this._pendingUpdatesPool.clear();this._cleanupSymbols();(this._pendingAdds||this._pendingRemoves)&&xa.warn("pendingAdds/Removes in inconsistent state!");this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=
!1}_applyPendingUpdates(wa){this._symbolWarningLogged=this._geometryWarningLogged=!1;if(0===this._pendingUpdates.size&&this._spatialIndex?.updating)this._spatialIndex.update(),wa.madeProgress();else{if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const [Ba,Ja]of this._pendingUpdates){if(wa.done){this._applyPendingRemovesFirst=!0;break}if(Ja.remove&&!Ja.add&&(this._pendingRemoves--,wa.madeProgress(),this._removeGraphic(Ja.remove),Ja.remove=null,this._pendingUpdates.delete(Ba),
0===this._pendingRemoves))break}}for(const [Ba,Ja]of this._pendingUpdates){if(wa.done)break;Ja.add&&Ja.state===Da.NEW&&this._processPendingUpdateNew(Ja);let Ta=this.effectiveUpdatePolicy;!Ja.remove||Ja.add&&Ja.state!==Da.READY||(this._pendingRemoves--,wa.madeProgress(),this._removeGraphic(Ja.remove),Ja.remove=null,Ta=oa.UpdatePolicy.SYNC);if(Ja.add)switch(Ja.state){case Da.READY:this._addGraphic(Ja.add,Ja.renderingInfo,Ta);Ja.add=null;this._pendingAdds--;wa.madeProgress();break;case Da.REJECTED:Ja.add=
null,this._pendingAdds--}null==Ja.remove&&null==Ja.add&&this._pendingUpdates.delete(Ba)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}}_processPendingUpdateNew(wa){if(wa.add){var Ba=wa.add.geometry;null==Ba||"mesh"!==Ba.type||Ba.loaded?this._processPendingUpdateNewRenderingInfo(wa):this._processPendingUpdateNewMesh(wa,Ba)}else wa.state=Da.READY}async _processPendingUpdateNewMesh(wa,Ba){wa.state=Da.LOADING;wa.abortController=new AbortController;const Ja=
wa.abortController.signal;try{await Ba.load({signal:Ja})}catch(Ta){return this._processPendingUpdateNewError(wa,Ta)}wa.abortController=null;this._processPendingUpdateNewRenderingInfo(wa)}_processPendingUpdateNewError(wa,Ba){wa.abortController=null;D.isAbortError(Ba)?wa.state=Da.NEW:wa.state=Da.REJECTED}async _processPendingUpdateNewRenderingInfo(wa){if(null==this.layer.renderer||"dictionary"!==this.layer.renderer.type)wa.renderingInfo=this._getRenderingInfo(wa.add,xa);else{wa.state=Da.LOADING;wa.abortController=
new AbortController;var Ba=null;try{Ba=await this._getRenderingInfoAsync(wa.add,{signal:wa.abortController.signal})}catch(Ja){wa.abortController=null;D.isAbortError(Ja)?wa.state=Da.NEW:wa.state=Da.REJECTED;return}null==Ba?.symbol?(xa&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,xa.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),wa.renderingInfo=null):wa.renderingInfo=Ba}wa.state=Da.READY}_addGraphic(wa,Ba,Ja){this._graphicsWithoutSymbol.set(wa.uid,wa);if(null!=
Ba?.symbol&&Z.hasGeometry(wa)){if(null!=this.stage.renderView.objectAndLayerIdRenderHelper&&this.setUidToIdOnAdd){const rb=N.isBasemapLayer(this.owner.view.map,this.layer.uid);this.stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(wa.objectId,wa.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled&&!rb&&Ca.hasPopupTemplate(this.layer,this.owner.view.popup?.defaultPopupTemplateEnabled))}var Ta=this.getOrCreateGraphics3DSymbol(Ba.symbol,Ba.renderer);if(null!=Ta){this._expandComputedExtent(wa.geometry);
var db=this._beginGraphicUpdate(wa),lb=new Y.Graphics3DGraphicCreationContext(wa,Ba,this.layer),mb=!1,ob=rb=>{rb===Ta.symbol.id&&(mb=!0)};this._whenSymbolRemoved.push(ob);var pb=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(ob);if(this._graphicsWaitingForSymbol.get(wa.uid)!==db||mb||Ta.destroyed||this.graphicSymbolSupported&&wa.symbol&&wa.symbol.id!==Ta.symbol.id)--Ta.referenced,this._cleanupSymbols();else{const rb=this._createGraphics3DGraphic(Ta,lb);this._spatialIndex&&
null!=rb&&this._spatialIndex.add(rb);--Ta.referenced;this._endGraphicUpdate(wa)}this._featureStore.events.emit("changed");this._labeler&&this.owner.view.labeler.setDirty()}},zb=rb=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(ob),mb||(D.isAbortError(rb)?this.add([wa]):Ta.destroyed||this._endGraphicUpdate(wa)))};++this._loadingSymbols;Ja===oa.UpdatePolicy.ASYNC?Ta.load(()=>this._frameTask.schedule(pb),rb=>this._frameTask.schedule(()=>zb(rb))):Ta.load(pb,zb)}}}_removeGraphic(wa){wa=
wa.uid;const Ba=this.graphics3DGraphics.get(wa);if(Ba){Ba.graphics3DSymbol.onRemoveGraphic(Ba);const Ja=Ba.usedMemory,Ta=Ba.isElevationSource;this._conditionalRemove(Ba,wa);this._spatialIndex?.remove(Ba);this._graphicsBySymbol.get(Ba.graphics3DSymbol.symbol.id)?.delete(wa);this._graphicsWithoutSymbol.delete(wa);this._removeGraphics3DGraphic(wa,Ja,Ta);Ba.destroy();this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(wa),this._graphicsWaitingForSymbol.delete(wa),0===this._graphicsWaitingForSymbol.size&&
(this._cleanupSymbols(),this.notifyChange("updating"))}_hasLabelingContext(wa){if(wa instanceof Ra||wa instanceof Ya){const Ba=this.symbolCreationContext.layer;return Ba.labelingInfo?Ba.labelingInfo.some(Ja=>Ja.symbol===wa):!1}return!1}_hasValidSymbolCreationContext(wa){return wa instanceof Ra&&!this._hasLabelingContext(wa)?(xa.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0}_getRenderingInfo(wa,Ba){const Ja=wa.geometry;
if(null==Ja)return Ba&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,Ba.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!K.canProjectWithoutEngine(Ja.spatialReference,this._viewSpatialReference))return Ba&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,Ba.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&null!=wa.symbol)return Ba&&!this._symbolWarningLogged&&
(this._symbolWarningLogged=!0,Ba.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;wa=this.rendererHasGeometryOperations?P.hydrateGraphic(wa,this.layer):wa;wa=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||null!=this.currentRenderer)?this.owner.getRenderingInfo(wa,this.currentRenderer,this._arcadeOnDemand):{symbol:wa.symbol||V.getDefaultSymbol3D(wa.geometry)};return null==wa?.symbol?(Ba&&!this._symbolWarningLogged&&(this._symbolWarningLogged=
!0,Ba.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):wa}_getRenderingInfoAsync(wa,Ba){if(null==wa.geometry)return xa&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,xa.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&null!=wa.symbol)return xa&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,xa.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),
null;wa=this.rendererHasGeometryOperations?P.hydrateGraphic(wa,this.layer):wa;return this.owner.getRenderingInfoAsync(wa,this.currentRenderer,this._arcadeOnDemand,Ba)}_createGraphics3DSymbol(wa,Ba){if(!this._hasValidSymbolCreationContext(wa))return null;wa=this._getConvertedSymbol(wa);if(!wa)return null;let Ja;null!=Ba&&"backgroundFillSymbol"in Ba&&Ba.backgroundFillSymbol&&(Ba=S.to3D(Ba.backgroundFillSymbol,{ignoreDrivers:!0}),null!=Ba.symbol&&"web-style"!==Ba.symbol.type&&"cim"!==Ba.symbol.type&&
(Ja=Ba.symbol.symbolLayers));const Ta=fa.make(wa,this.symbolCreationContext,Ja);Ta.load(()=>{const db=Ta.extentPadding;db>this.extentPadding&&this._set("extentPadding",db);this.notifyChange("averageSymbolComplexity")},()=>{});return Ta}getOrCreateGraphics3DSymbol(wa,Ba){let Ja=this._symbols.get(wa.id);void 0===Ja&&(Ja=wa instanceof ab?new aa.Graphics3DWebStyleSymbol(wa,Ta=>this._frameTask.schedule(Ta),Ta=>this._createGraphics3DSymbol(Ta,Ba)):this._createGraphics3DSymbol(wa,Ba),this._symbols.set(wa.id,
Ja));null!=Ja&&++Ja.referenced;return Ja}trackGraphicState(wa){null==this._graphicStateTracking&&(this._graphicStateTracking=new da.GraphicStateTracking(this));return this._graphicStateTracking.add(wa)}_addGraphics3DGraphic(wa){this._usedMemory+=wa.usedMemory;this.graphics3DGraphics.set(wa.graphic.uid,wa);this._numberOfGraphics++;wa.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()}_removeGraphics3DGraphic(wa,Ba,
Ja=!1){this._usedMemory-=Ba;this.graphics3DGraphics.delete(wa);this._numberOfGraphics--;Ja&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()}_createGraphics3DGraphic(wa,Ba){const Ja=Ba.graphic;this._graphicsWithoutSymbol.delete(Ja.uid);if(!this._symbols.has(wa.symbol.id))return this.add([Ja]),null;if(this.graphics3DGraphics.has(Ja.uid))return null;Ba=wa.createGraphics3DGraphic(Ba);if(null==Ba)return null;this._addGraphics3DGraphic(Ba);
wa=wa.symbol.id;this._graphicsBySymbol.has(wa)||this._graphicsBySymbol.set(wa,new Map);this._graphicsBySymbol.get(wa).set(Ja.uid,Ba);Ba.isDraped&&this._graphicsDrapedUids.add(Ja.uid);Ba.centroid=null;null!=Ja.geometry&&"point"!==Ja.geometry.type&&(Ba.centroid=ma.computeCentroid(Ja.geometry,this._viewSpatialReference));this._updateUserVisibility(Ba);null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(Ba);null!=this._filterVisibility&&({defaultVisibility:wa}=this._filterVisibility,Ba.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,
ia.VisibilityFlag.FILTER,wa),wa||this._filterVisibility.reapply());this._deconflictor?.addGraphic(Ba);this._labeler?.addGraphic(Ba);this._objectStates?.addGraphic(Ba);this._deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,Ba);Ba.initialize(this.stageLayer,this.owner);null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(Ba);if(wa=this._whenGraphics3DGraphicRequests[Ja.uid])delete this._whenGraphics3DGraphicRequests[Ja.uid],wa.resolve(Ba);return Ba}_abortRendererChange(){this._rendererChangeAbortController&&
(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)}async rendererChange(wa){this._abortRendererChange();if(wa!==this.currentRenderer)if(this._validateRenderer(wa),null==wa&&this._currentRendererChange(null,!1),R.isSupportedRenderer3D(wa))if(null!=wa&&wa.arcadeRequired){var Ba=new AbortController;this._rendererChangeAbortController=Ba;const {arcadeUtils:Ja}=await this._ensureArcade();D.throwIfAborted(Ba);const Ta=Ja.hasGeometryOperations(wa);Ta&&(await Ja.enableGeometryOperations(),
D.throwIfAborted(Ba));this.effectiveUpdatePolicy===oa.UpdatePolicy.ASYNC?await this._frameTask.schedule(()=>this._currentRendererChange(wa,Ta),Ba.signal):this._currentRendererChange(wa,Ta);this._rendererChangeAbortController=null}else this.effectiveUpdatePolicy===oa.UpdatePolicy.ASYNC?(this._rendererChangeAbortController=Ba=new AbortController,await this._frameTask.schedule(()=>this._currentRendererChange(wa,!1),Ba.signal),this._rendererChangeAbortController=null):this._currentRendererChange(wa,!1);
else this._currentRendererChange(wa,!1)}async _ensureArcade(){null==this._arcadeOnDemand&&(this._arcadeOnDemand=await W.loadArcade());return this._arcadeOnDemand}_currentRendererChange(wa,Ba){this.currentRenderer=wa;this.rendererHasGeometryOperations=Ba;this.symbolCreationContext.arcade=this._arcadeOnDemand;Ba=this.symbolCreationContext.renderer;if(wa!==Ba)if(this._symbolConversionCache.clear(),null==wa)this.symbolCreationContext.renderer=null,this.recreateAllGraphicsAndSymbols();else{var Ja=I.diff(Ba,
wa);this._updateUnchangedSymbolMappings(Ja,wa,Ba);this.symbolCreationContext.renderer=wa;null!=Ja&&("complete"===Ja.type?this.recreateAllGraphicsAndSymbols():"partial"===Ja.type&&(this._applyRendererDiff(Ja,wa,Ba)?this._labeler?.reset():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}}_diffHasSymbolChange(wa){for(const Ba in wa.diff)switch(Ba){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "uniqueValueGroups":case "authoringInfo":case "fieldDelimiter":delete wa.diff[Ba];
break;default:return!0}return!1}_applySymbolSetDiff(wa,Ba,Ja){wa=wa||[];Ba=Ba||[];const Ta=[];for(const db of Ba){const lb=this._graphicsBySymbol.get(db.id);lb&&lb.forEach((mb,ob)=>{var pb=mb.graphic,zb=this.layer instanceof U?this.layer:null;const rb=this._arcadeOnDemand;if(db!==Ja.defaultSymbol||Ja.getSymbol(P.hydrateGraphic(pb,zb),{arcade:rb})!==Ja.defaultSymbol)zb=mb.usedMemory,wa.length||Ja.defaultSymbol?Ta.push(pb):this._graphicsWithoutSymbol.set(ob,pb),pb=this.graphics3DGraphics.get(ob),this._conditionalRemove(pb,
ob),mb.destroy(),lb.delete(ob),this._removeGraphics3DGraphic(ob,zb),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(mb=>mb(db.id))}if(wa.length||Ta.length)this._graphicsWithoutSymbol.forEach(db=>Ta.push(db)),this._graphicsWithoutSymbol.clear(),this.add(Ta);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()}_applyUniqueValueRendererDiff(wa,Ba,Ja){const Ta=wa.diff.defaultSymbol,db=wa.diff.uniqueValueInfos;if(Ta||db){const lb=
db?db.added.map(ob=>ob.symbol).filter(n.isSome):[],mb=db?db.removed.map(ob=>ob.symbol).filter(n.isSome):[];if(db)for(let ob=0;ob<db.changed.length;ob++)lb.push(db.changed[ob].newValue.symbol),mb.push(db.changed[ob].oldValue.symbol);Ta?(Ja.defaultSymbol&&mb.push(Ja.defaultSymbol),Ba.defaultSymbol&&lb.push(Ba.defaultSymbol)):Ja.defaultSymbol&&lb.length&&mb.push(Ba.defaultSymbol);this._applySymbolSetDiff(lb,mb,Ba);delete wa.diff.defaultSymbol;delete wa.diff.uniqueValueInfos;return!0}return!1}_calculateUnchangedSymbolMapping(wa,
Ba,Ja){if("unique-value"!==Ba?.type||"unique-value"!==Ja?.type||null!=wa&&"partial"!==wa.type)return[];const Ta=lb=>null!=lb?lb.id:null;var db=wa&&wa.diff;wa=db?.defaultSymbol;if(db=db&&db.uniqueValueInfos)db=db.unchanged.map(lb=>({oldId:Ta(lb.oldValue.symbol),newId:Ta(lb.newValue.symbol)}));else{db=[];for(const lb of Ja.uniqueValueInfos??[]){const mb=Ta(lb.symbol),ob=Ba.uniqueValueInfos?.find(pb=>pb.value===lb.value);ob&&mb!==Ta(ob.symbol)&&db.push({oldId:mb,newId:Ta(ob.symbol)})}}!wa&&Ja.defaultSymbol&&
db.push({oldId:Ta(Ja.defaultSymbol),newId:Ta(Ba.defaultSymbol)});return db}_updateSymbolMapping(wa,Ba){const Ja=null!=Ba&&Ba?"string"===typeof Ba?Ba:Ba.id:null;if(null!=wa&&wa!==Ja){var Ta=this._graphicsBySymbol.get(wa);this._graphicsBySymbol.delete(wa);void 0!==Ta&&this._graphicsBySymbol.set(Ja,Ta);Ta=this._symbols.get(wa);void 0!==Ta&&(this._symbols.delete(wa),this._symbols.set(Ja,Ta),null!=Ta&&(wa="string"===typeof Ba?null:Ba,null!=wa?Ta.symbol=wa:Ta.symbol.id=Ja))}}_updateUnchangedSymbolMappings(wa,
Ba,Ja){wa=this._calculateUnchangedSymbolMapping(wa,Ba,Ja);for(const {oldId:Ta,newId:db}of wa)this._updateSymbolMapping(Ta,db)}_applyRendererDiff(wa,Ba,Ja){if(this._diffHasSymbolChange(wa))return!1;if(Ba instanceof p&&Ja instanceof p&&this._applyUniqueValueRendererDiff(wa,Ba,Ja)&&0===Object.keys(wa.diff).length)return!0;for(const [Ta]of this._graphicsBySymbol)if(Ja=this._symbols.get(Ta),null!=Ja)switch(Ja.applyRendererDiff(wa,Ba)){case ua.ApplyRendererDiffResult.RecreateSymbol:this._recreateSymbol(Ta);
break;case ua.ApplyRendererDiffResult.RecreateGraphics:this._recreateGraphicsForSymbol(Ta)}return!0}opacityChange(){this.forEachGraphics3DSymbol((wa,Ba)=>wa.globalPropertyChanged("opacity",Ba));this._updateStageLayerVisibility()}_slicePlaneEnabledChange(wa){wa!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=wa,this.stageLayer.sliceable=wa,this.forEachGraphics3DSymbol((Ba,Ja)=>Ba.globalPropertyChanged("slicePlaneEnabled",Ja)),this._deconflictor&&this._deconflictor.slicePlaneEnabledChange(),
this._labeler&&this._labeler.slicePlaneEnabledChange())}_physicalBasedRenderingChange(wa){this.symbolCreationContext.physicalBasedRenderingEnabled=wa;this.forEachGraphics3DSymbol((Ba,Ja,Ta)=>{Ba.globalPropertyChanged("physicalBasedRenderingEnabled",Ja)||this._recreateSymbol(Ta)})}_skipHighSymbolLoDsChange(wa){this.symbolCreationContext.skipHighSymbolLods=wa;this.forEachGraphics3DSymbol((Ba,Ja,Ta)=>{Ba.globalPropertyChanged("skipHighSymbolLods",Ja)||this._recreateSymbol(Ta)})}_pixelRatioChange(){this.forEachGraphics3DSymbol((wa,
Ba,Ja)=>{wa.globalPropertyChanged("pixelRatio",Ba)||this._recreateSymbol(Ja)})}_signalUpdatingDuringAsyncLoadedGraphicsChange(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=E.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})}setClippingExtent(wa,Ba){const Ja=this.symbolCreationContext.clippingExtent,Ta=Q.create();qa.toBoundingRect(wa,Ta,Ba)?this.symbolCreationContext.clippingExtent=T.fromRect(T.create(),
Ta):this.symbolCreationContext.clippingExtent=null;return!T.equals(this.symbolCreationContext.clippingExtent,Ja)}modifyGraphics3DGraphicVisibilities(wa){if(!this.destroyed){var Ba=!1;this.graphics3DGraphics.forEach(Ja=>{wa(Ja)&&(Ba=!0)});Ba&&(this.owner.view.labeler?.setDirty(),this.owner.view.deconflictor?.setDirty())}}forEachGraphics3DSymbol(wa){for(const [Ba,Ja]of this._symbols){if(null==Ja)break;const Ta=this._graphicsBySymbol.get(Ba);wa(Ja,Ta||Va,Ba)}}updateAllGraphicsVisibility(){null!=this._filterVisibility&&
this._filterVisibility.reapply();this.modifyGraphics3DGraphicVisibilities(wa=>{const Ba=this._updateUserVisibility(wa);wa=null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(wa);return Ba||wa})}_hideAllGraphics(){this.modifyGraphics3DGraphicVisibilities(wa=>wa.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,ia.VisibilityFlag.USER,!1))}_validateRenderer(wa){(wa=R.validateTo3D(wa,{geometryType:this.layer?.geometryType}))&&xa.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:
""}, id:${this.layer.id}' is not supported in a SceneView`,wa.message)}_cleanupSymbols(){if(!(0<this._graphicsWaitingForSymbol.size||this._suspendSymbolCleanup)){var wa=!1;this._symbols.forEach((Ba,Ja)=>{if(!(null==Ba||0<Ba.referenced)){var Ta=this._graphicsBySymbol.get(Ja);Ta&&0!==Ta.size||(this._graphicsBySymbol.delete(Ja),this._symbols.delete(Ja),y.destroyMaybe(Ba),wa=!0)}});wa&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}}get test(){return{snapshotInternals:()=>
({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this._symbols.keys()].sort(),graphicsBySymbol:[...this._graphicsBySymbol.keys()].sort().map(wa=>({symbolId:wa,graphics:[...this._graphicsBySymbol.get(wa).keys()].sort()})),graphicsWithoutSymbol:[...this._graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this._graphicsDrapedUids].sort(),pendingUpdates:this._pendingUpdates}),symbols:this._symbols,filterVisibility:this._filterVisibility,numPending:this._pendingUpdates.size,forceUpdatePolicy:wa=>
{this._forcedUpdatePolicy=wa}}}get performanceInfo(){return{visible:this.graphics3DGraphics.size,missing:this._graphicsWithoutSymbol.size,pending:this._pendingUpdates.size}}};a.Graphics3DCore.tmpVec=B.create();b.__decorate([A.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);b.__decorate([A.property()],
a.Graphics3DCore.prototype,"_frameTask",void 0);b.__decorate([A.property({readOnly:!0})],a.Graphics3DCore.prototype,"_viewSpatialReference",null);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_rendererChangeAbortController",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_elevationInfoChangeAbortController",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_initializeAbortController",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_elevationAlignment",
void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_scaleVisibility",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_filterVisibility",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_initializePromise",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);b.__decorate([A.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",
void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_featureStore",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_deconflictor",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_labeler",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_objectStates",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_loadingSymbols",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);b.__decorate([A.property()],
a.Graphics3DCore.prototype,"_forcedUpdatePolicy",void 0);b.__decorate([A.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);b.__decorate([A.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([A.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);b.__decorate([A.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);b.__decorate([A.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"graphicSymbolSupported",void 0);b.__decorate([A.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);b.__decorate([A.property({constructOnly:!0})],a.Graphics3DCore.prototype,"componentFactories",void 0);b.__decorate([A.property({constructOnly:!0})],a.Graphics3DCore.prototype,"setUidToIdOnAdd",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"featureStore",null);b.__decorate([A.property()],a.Graphics3DCore.prototype,"initializePromise",null);
b.__decorate([A.property()],a.Graphics3DCore.prototype,"scaleVisibility",null);b.__decorate([A.property()],a.Graphics3DCore.prototype,"elevationAlignment",null);b.__decorate([A.property()],a.Graphics3DCore.prototype,"objectStates",null);b.__decorate([A.property()],a.Graphics3DCore.prototype,"filterVisibility",null);b.__decorate([A.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);b.__decorate([A.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);b.__decorate([A.property({readOnly:!0})],
a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);b.__decorate([A.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);b.__decorate([A.property({readOnly:!0})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);b.__decorate([A.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);b.__decorate([A.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);b.__decorate([A.property({constructOnly:!0})],
a.Graphics3DCore.prototype,"hasM",void 0);b.__decorate([A.property()],a.Graphics3DCore.prototype,"_objectIdField",null);a.Graphics3DCore=Wa=b.__decorate([G.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var Da;(function(wa){wa[wa.NEW=0]="NEW";wa[wa.LOADING=1]="LOADING";wa[wa.READY=2]="READY";wa[wa.REJECTED=3]="REJECTED"})(Da||(Da={}));class Ka{constructor(){this.renderingInfo=this.add=null;this.state=Da.NEW;this.remove=this.abortController=null}clear(){this.renderingInfo=
this.add=null;this.state=Da.NEW;this.remove=this.abortController=null}}const ha=B.create(),Sa=B.create(),Va=new Map;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/Error","../../symbols/support/symbolConversion"],function(a,b,g,d,k){function m(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===
e.type}function f(e,p){if(!p)return null;p=Array.isArray(p)?p:[p];if(0<p.length){const h=p.map(w=>w.details.symbol.type||w.details.symbol.declaredClass).filter(w=>!!w);h.sort();const u=[];h.forEach((w,x)=>{0!==x&&w===h[x-1]||u.push(w)});return new d("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${u.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:p})}return null}function c(e,p){const h={...k.defaultTo3DOptions,...p};p=e.uniqueValueInfos?.map(w=>k.to3D(w.symbol,
h).error).filter(b.isSome);const u=k.to3D(e.defaultSymbol,h);u.error&&p?.unshift(u.error);return f(e,p)}function l(e){const p=e.classBreakInfos.map(u=>k.to3D(u.symbol).error).filter(b.isSome),h=k.to3D(e.defaultSymbol);h.error&&p.unshift(h.error);return f(e,p)}a.isSupportedRenderer3D=m;a.validateTo3D=function(e,p){if(null==e)return null;if(!m(e))return new d("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case "simple":return f(e,
k.to3D(e.symbol).error);case "unique-value":return c(e,p);case "class-breaks":return l(e)}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/Collection ../../core/has ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),function(a,b,g,d,k,m,f,c,l,e,p){const h=f.fromSimpleMarkerSymbol(e.defaultPointSymbol2D),
u=k.fromSimpleLineSymbol(e.defaultPolylineSymbol2D),w=c.fromSimpleFillSymbol(e.defaultPolygonSymbol2D),x=new m({symbolLayers:new b([new d({material:{color:p.defaultColor},edges:new l({size:"1px",color:p.defaultOutlineColor})})])});a.getDefaultSymbol3D=function(n){if(null==n)return null;switch(n.type){case "mesh":return x;case "point":case "multipoint":return h;case "polyline":return u;case "polygon":case "extent":return w}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){const n=p.create();a.Graphics3DFeatureStore=class extends g{constructor(t){super(t);this.events=new d;this.objectIdField=this.hasM=this.hasZ=null;this.featureAdapter={getAttribute(v,r){return"graphic"in v?v.graphic.attributes[r]:x.optimizedFeatureQueryEngineAdapter.getAttribute(v,r)},getAttributes(v){return"graphic"in v?v.graphic.attributes:x.optimizedFeatureQueryEngineAdapter.getAttributes(v)},getObjectId:v=>"graphic"in v?h.getObjectId(v.graphic,this.objectIdField)??
void 0:x.optimizedFeatureQueryEngineAdapter.getObjectId(v),getGeometry:v=>"graphic"in v?v.getAsOptimizedGeometry(this.hasZ,this.hasM):x.optimizedFeatureQueryEngineAdapter.getGeometry(v),getCentroid:(v,r)=>{if("graphic"in v){let y=null;null!=v.centroid?y=v.centroid:"point"===v.graphic.geometry.type&&e.projectPoint(v.graphic.geometry,q,this.viewSpatialReference)&&(y=q);v=Array(2+(r.hasZ?1:0)+(r.hasM?1:0));null==y?(v[0]=0,v[1]=0,v[2]=0,v[3]=0):(v[0]=y.x,v[1]=y.y,r.hasZ&&(v[2]=y.hasZ?y.z:0),r.hasM&&(v[r.hasZ?
3:2]=y.hasM?y.m:0));return new w([],v)}return x.optimizedFeatureQueryEngineAdapter.getCentroid(v,r)},cloneWithGeometry:(v,r)=>"graphic"in v?new u.OptimizedFeature(r,this.featureAdapter.getAttributes(v),null,this.featureAdapter.getObjectId(v)):x.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(v,r)}}forEachInBounds(t,v){this.getSpatialIndex().forEachInBounds(t,v)}forEachBounds(t,v){const r=this.getSpatialIndex();for(const y of t)t=this.featureAdapter.getObjectId(y),null!=r.getBounds(t,n)&&v(n)}};
b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);
b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=b.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const q={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports",
"../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,g,d){a.optimizedFeatureQueryEngineAdapter={getObjectId(k){return k.objectId},getAttributes(k){return k.attributes},getAttribute(k,m){return k.attributes[m]},cloneWithGeometry(k,m){return new g.OptimizedFeature(m,k.attributes,null,k.objectId)},getGeometry(k){return k.geometry},getCentroid(k,m){null==k.centroid&&(k.centroid=b.getCentroidOptimizedGeometry(new d,k.geometry,m.hasZ,m.hasM));return k.centroid}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function b(d,k,m,f,c,l,e=1){l=c?l?4:3:l?3:2;let p=m,h=m+l,u=0,w=0,x=m=0,n=0;for(let q=0,t=f-1;q<t;q++,p+=l,h+=l){f=k[p];const v=k[p+1],r=k[p+2],y=k[h],z=k[h+1],D=k[h+2];let C=f*z-y*v;x+=C;u+=(f+y)*C;w+=(v+z)*C;c&&(C=f*D-y*r,m+=(r+D)*C,n+=C);f<d[0]&&(d[0]=f);f>d[1]&&(d[1]=f);v<d[2]&&(d[2]=v);v>d[3]&&(d[3]=v);c&&(r<d[4]&&(d[4]=r),r>d[5]&&(d[5]=r))}0<x*e&&(x*=-1);0<n*e&&(n*=-1);if(!x)return null;
d=[u,w,.5*x];c&&(d[3]=m,d[4]=.5*n);return d}function g(d,k,m,f,c){c=f?c?4:3:c?3:2;let l=k,e=k+c,p=0,h=0,u=0,w=0;for(let t=0,v=m-1;t<v;t++,l+=c,e+=c){var x=d[l];const r=d[l+1],y=d[l+2],z=d[e],D=d[e+1],C=d[e+2];if(f){var n=z-x;var q=D-r;const E=C-y;n=Math.sqrt(n*n+q*q+E*E)}else n=z-x,q=D-r,n=Math.sqrt(n*n+q*q);n&&(p+=n,f?(x=[x+.5*(z-x),r+.5*(D-r),y+.5*(C-y)],h+=n*x[0],u+=n*x[1],w+=n*x[2]):(x=[x+.5*(z-x),r+.5*(D-r)],h+=n*x[0],u+=n*x[1]))}return 0<p?f?[h/p,u/p,w/p]:[h/p,u/p]:0<m?f?[d[k],d[k+1],d[k+2]]:
[d[k],d[k+1]]:null}a.getCentroidOptimizedGeometry=function(d,k,m,f,c){if(!k?.lengths.length)return null;const l="upperLeft"===c?.originPosition?-1:1;d.lengths.length&&(d.lengths.length=0);d.coords.length&&(d.coords.length=0);c=d.coords;const e=[],p=m?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],
{lengths:h,coords:u}=k,w=m?f?4:3:f?3:2;let x=0;for(var n of h){const q=b(p,u,x,n,m,f,l);q&&e.push(q);x+=n*w}e.sort((q,t)=>{let v=l*q[2]-l*t[2];0===v&&m&&(v=q[4]-t[4]);return v});e.length&&(n=6*e[0][2],c[0]=e[0][0]/n,c[1]=e[0][1]/n,m&&(n=6*e[0][4],c[2]=0!==n?e[0][3]/n:0),c[0]<p[0]||c[0]>p[1]||c[1]<p[2]||c[1]>p[3]||m&&(c[2]<p[4]||c[2]>p[5]))&&(c.length=0);if(!c.length)if(k=k.lengths[0]?g(u,0,h[0],m,f):null)c[0]=k[0],c[1]=k[1],m&&2<k.length&&(c[2]=k[2]);else return null;return d};a.lineCentroid=g;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,g){a.make=function(d,k,m){switch(d.type){case "point-3d":return new b.Graphics3DPointSymbol(d,k,m);default:return new g.Graphics3DSymbol(d,k,m)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("exports ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./Graphics3DSymbol".split(" "),
function(a,b,g,d,k,m,f){class c extends f.Graphics3DSymbol{constructor(l,e,p){super(l,e,p);this._calloutSymbolLayer=null;this.symbol.hasVisibleCallout()&&(this._calloutSymbolLayer=k.make(this.symbol,e))}async doLoad(l){const e=this._calloutSymbolLayer?b.result(this._calloutSymbolLayer.load()):null;try{await super.doLoad(l),d.throwIfAborted(l)}catch(p){throw this._calloutSymbolLayer?.abortLoad(),p;}e&&await e}destroy(){super.destroy();this._calloutSymbolLayer=g.destroyMaybe(this._calloutSymbolLayer)}createGraphics3DGraphic(l,
e){e=super.createGraphics3DGraphic(l,e);null!=this._calloutSymbolLayer&&null!=e&&(l=this._createCalloutGraphic(l))&&e.setCalloutGraphic(l);return e}globalPropertyChanged(l,e){return super.globalPropertyChanged(l,e)?this._calloutSymbolLayer?this._calloutSymbolLayer.globalPropertyChanged(l,e,p=>p.calloutLayer):!0:!1}updateGeometry(l,e){const p=super.updateGeometry(l,e);return p&&this._calloutSymbolLayer&&(l=l.calloutLayer)?this._calloutSymbolLayer.updateGeometry(l,e):p}_createCalloutGraphic(l){const e=
l.renderingInfo;l.renderingInfo=new m.LineCalloutSymbolLayerRenderingInfo(e.renderer,e.symbol);return this._calloutSymbolLayer.createGraphics3DGraphic(l)}}a.Graphics3DPointSymbol=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/handleUtils","../../../../layers/graphics/dehydratedFeatures"],function(a,b,g,d){class k{constructor(m){this._graphicsCore=m;this._idToState=
new Map;this._states=new Set;const f=m.owner.layer?.objectIdField;f?(this._getGraphicId=c=>d.getObjectId(c,f),this._getGraphics3DGraphicById=c=>this._graphicsCore.getGraphics3DGraphicByObjectId(c)):(this._getGraphicId=c=>c.uid,this._getGraphics3DGraphicById=c=>this._graphicsCore.getGraphics3DGraphicById(c))}destroy(){this._idToState.clear();this._states.forEach((m,f)=>this.remove(f))}add(m){const f=g.makeHandle(()=>this.remove(m));if(this._states.has(m))return f;const c=this._getGraphicId(m.graphic),
l=this._getGraphics3DGraphicById(c);this._states.has(m)||this._states.add(m);this._ensureStateList(c).push(m);m.displaying=null!=l?l.isVisible():!1;m.isDraped=null!=l?l.isDraped:!1;m.tracking=!0;null!=l&&m.emit("changed");return f}remove(m){if(this._states.has(m)){if(this._idToState.size){const f=this._getGraphicId(m.graphic),c=this._idToState.get(f);c&&(b.remove(c,m),0===c.length&&this._idToState.delete(f))}this._states.delete(m);m.tracking=!1;m.displaying=!1}}addGraphic(m){this._forEachState(m,
f=>{f.displaying=m.isVisible();f.isDraped=m.isDraped;f.emit("changed")})}removeGraphic(m){this._forEachState(m,f=>{f.displaying=!1;f.isDraped=!1})}updateGraphicGeometry(m){this._forEachState(m,f=>f.emit("changed"))}updateGraphicVisibility(m){this._forEachState(m,f=>f.displaying=m.isVisible())}allGraphicsDeleted(){this._states.forEach(m=>{m.displaying=!1})}_ensureStateList(m){var f=this._idToState.get(m);if(f)return f;f=[];this._idToState.set(m,f);return f}_forEachState(m,f){0!==this._states.size&&
0!==this._idToState.size&&(m=this._getGraphicId(m.graphic),m=this._idToState.get(m),null!=m&&m.forEach(f))}}a.GraphicStateTracking=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){a.SpatialIndex2D=class extends g{constructor(w){super(w);this._index=new e.PooledRBush(9,d("esri-csp-restrictions")?x=>({minX:x.extent[0],minY:x.extent[1],maxX:x.extent[2],maxY:x.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);this._missing=new Set;this._boundsByFeature=new Map;this.objectIdField=this.hasM=this.hasZ=this.spatialReference=null;this.updating=!1}setup(w){this._addMany(w)}destroy(){this._missing.clear();this._index=k.destroyMaybe(this._index);
this._boundsByFeature.clear();this._boundsByFeature=null}update(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(w,x,n){null!=x&&x.equals(this.spatialReference)&&(u.minX=w[0],u.minY=w[1],u.maxX=w[2],u.maxY=w[3],this.update(),this._index.search(u,q=>n(q.graphic.uid)))}add(w){this._missing.add(w);this.updating=!0}remove(w){this._missing.delete(w)?this.updating=
0<this._missing.size:(this._index.remove(w),w=h.getObjectId(w.graphic,this._get("objectIdField")),null!=w&&this._boundsByFeature.delete(w))}_addMany(w){if(0!==w.length){var x=this._get("objectIdField");for(const n of w){n.computeExtent(this.spatialReference);const q=h.getObjectId(n.graphic,x);null!=q&&this._boundsByFeature.set(q,n.extent)}this._index.load(w)}}clear(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();this.updating=!1}forEachInBounds(w,x){u.minX=w[0];u.minY=w[1];
u.maxX=w[2];u.maxY=w[3];this.update();this._index.search(u,n=>{x(n)})}getBounds(w,x){this.update();return(w=this._boundsByFeature.get(w))?p.fromRect(x,w):null}};b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasZ",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"objectIdField",void 0);b.__decorate([m.property()],a.SpatialIndex2D.prototype,"updating",void 0);b.__decorate([m.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=b.__decorate([l.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const u={minX:0,minY:0,maxX:0,maxY:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../PooledArray",
"../../../chunks/quickselect"],function(a,b,g,d){function k(C,E){m(C,0,C.children.length,E,C)}function m(C,E,A,F,G){G||(G=new z([]));G.minX=Infinity;G.minY=Infinity;G.maxX=-Infinity;G.maxY=-Infinity;for(let I=E,H;I<A;I++)H=C.children[I],f(G,C.leaf?F(H):H);return G}function f(C,E){C.minX=Math.min(C.minX,E.minX);C.minY=Math.min(C.minY,E.minY);C.maxX=Math.max(C.maxX,E.maxX);C.maxY=Math.max(C.maxY,E.maxY)}function c(C,E){return C.minX-E.minX}function l(C,E){return C.minY-E.minY}function e(C){return(C.maxX-
C.minX)*(C.maxY-C.minY)}function p(C){return C.maxX-C.minX+(C.maxY-C.minY)}function h(C,E){return C.minX<=E.minX&&C.minY<=E.minY&&E.maxX<=C.maxX&&E.maxY<=C.maxY}function u(C,E){return E.minX<=C.maxX&&E.minY<=C.maxY&&E.maxX>=C.minX&&E.maxY>=C.minY}function w(C,E,A,F,G){for(E=[E,A];E.length;){A=E.pop();const I=E.pop();if(A-I<=F)continue;const H=I+Math.ceil((A-I)/F/2)*F;d.quickselect(C,H,I,A,G);E.push(I,H,H,A)}}class x{constructor(C=9,E){this._compareMinX=c;this._compareMinY=l;this._toBBox=A=>A;this._maxEntries=
Math.max(4,C||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));E&&("function"===typeof E?this._toBBox=E:this._initFormat(E));this.clear()}destroy(){this.clear();n.prune();q.prune();t.prune();v.prune()}all(C){this._all(this._data,C)}search(C,E){let A=this._data;const F=this._toBBox;if(u(C,A))for(n.clear();A;){for(let G=0,I=A.children.length;G<I;G++){const H=A.children[G],B=A.leaf?F(H):H;u(C,B)&&(A.leaf?E(H):h(C,B)?this._all(H,E):n.push(H))}A=n.pop()}}collides(C){let E=this._data;const A=
this._toBBox;if(!u(C,E))return!1;for(n.clear();E;){for(let F=0,G=E.children.length;F<G;F++){const I=E.children[F],H=E.leaf?A(I):I;if(u(C,H)){if(E.leaf||h(C,H))return!0;n.push(I)}}E=n.pop()}return!1}load(C){if(!C.length)return this;if(C.length<this._minEntries){for(let E=0,A=C.length;E<A;E++)this.insert(C[E]);return this}C=this._build(C.slice(0,C.length),0,C.length-1,0);if(this._data.children.length)if(this._data.height===C.height)this._splitRoot(this._data,C);else{if(this._data.height<C.height){const E=
this._data;this._data=C;C=E}this._insert(C,this._data.height-C.height-1,!0)}else this._data=C;return this}insert(C){C&&this._insert(C,this._data.height-1);return this}clear(){this._data=new z([]);return this}remove(C){if(!C)return this;let E=this._data,A=null,F=0,G=!1,I;const H=this._toBBox(C);t.clear();for(v.clear();E||0<t.length;){E||(E=t.pop(),A=t.data[t.length-1],F=v.pop()??0,G=!0);if(E.leaf&&(I=b.indexOf(E.children,C,E.children.length,E.indexHint),-1!==I)){E.children.splice(I,1);t.push(E);this._condense(t);
break}G||E.leaf||!h(E,H)?A?(F++,E=A.children[F],G=!1):E=null:(t.push(E),v.push(F),F=0,A=E,E=E.children[0])}return this}toJSON(){return this._data}fromJSON(C){this._data=C;return this}_all(C,E){for(q.clear();C;){if(!0===C.leaf)for(const A of C.children)E(A);else q.pushArray(C.children);C=q.pop()??null}}_build(C,E,A,F){var G=A-E+1,I=this._maxEntries;if(G<=I)return C=new z(C.slice(E,A+1)),k(C,this._toBBox),C;F||(F=Math.ceil(Math.log(G)/Math.log(I)),I=Math.ceil(G/I**(F-1)));const H=new D([]);H.height=
F;G=Math.ceil(G/I);I=G*Math.ceil(Math.sqrt(I));for(w(C,E,A,I,this._compareMinX);E<=A;E+=I){const B=Math.min(E+I-1,A);w(C,E,B,G,this._compareMinY);for(let K=E;K<=B;K+=G)H.children.push(this._build(C,K,Math.min(K+G-1,B),F-1))}k(H,this._toBBox);return H}_chooseSubtree(C,E,A,F){for(;;){F.push(E);if(!0===E.leaf||F.length-1===A)break;let G=Infinity,I=Infinity,H=void 0;for(let B=0,K=E.children.length;B<K;B++){const L=E.children[B],J=e(L),M=(Math.max(L.maxX,C.maxX)-Math.min(L.minX,C.minX))*(Math.max(L.maxY,
C.maxY)-Math.min(L.minY,C.minY))-J;M<I?(I=M,G=J<G?J:G,H=L):M===I&&J<G&&(G=J,H=L)}E=H||E.children[0]}return E}_insert(C,E,A){var F=this._toBBox;A=A?C:F(C);t.clear();F=this._chooseSubtree(A,this._data,E,t);F.children.push(C);for(f(F,A);0<=E;)if(t.data[E].children.length>this._maxEntries)this._split(t,E),E--;else break;this._adjustParentBBoxes(A,t,E)}_split(C,E){const A=C.data[E];var F=A.children.length;const G=this._minEntries;this._chooseSplitAxis(A,G,F);(F=this._chooseSplitIndex(A,G,F))?(F=A.children.splice(F,
A.children.length-F),F=A.leaf?new z(F):new D(F),F.height=A.height,k(A,this._toBBox),k(F,this._toBBox),E?C.data[E-1].children.push(F):this._splitRoot(A,F)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}_splitRoot(C,E){this._data=new D([C,E]);this._data.height=C.height+1;k(this._data,this._toBBox)}_chooseSplitIndex(C,E,A){let F,G,I=void 0;F=G=Infinity;for(let B=E;B<=A-E;B++){var H=m(C,0,B,this._toBBox);const K=m(C,B,A,this._toBBox),L=Math.max(0,Math.min(H.maxX,
K.maxX)-Math.max(H.minX,K.minX))*Math.max(0,Math.min(H.maxY,K.maxY)-Math.max(H.minY,K.minY));H=e(H)+e(K);L<F?(F=L,I=B,G=H<G?H:G):L===F&&H<G&&(G=H,I=B)}return I}_chooseSplitAxis(C,E,A){const F=C.leaf?this._compareMinX:c,G=C.leaf?this._compareMinY:l,I=this._allDistMargin(C,E,A,F);E=this._allDistMargin(C,E,A,G);I<E&&C.children.sort(F)}_allDistMargin(C,E,A,F){C.children.sort(F);F=this._toBBox;var G=m(C,0,E,F);const I=m(C,A-E,A,F);let H=p(G)+p(I);for(let B=E;B<A-E;B++){const K=C.children[B];f(G,C.leaf?
F(K):K);H+=p(G)}for(A=A-E-1;A>=E;A--)G=C.children[A],f(I,C.leaf?F(G):G),H+=p(I);return H}_adjustParentBBoxes(C,E,A){for(;0<=A;A--)f(E.data[A],C)}_condense(C){for(let E=C.length-1;0<=E;E--){const A=C.data[E];if(0===A.children.length)if(0<E){const F=C.data[E-1],G=F.children;G.splice(b.indexOf(G,A,G.length,F.indexHint),1)}else this.clear();else k(A,this._toBBox)}}_initFormat(C){const E=["return a"," - b",";"];this._compareMinX=new Function("a","b",E.join(C[0]));this._compareMinY=new Function("a","b",
E.join(C[1]));this._toBBox=new Function("a","return {minX: a"+C[0]+", minY: a"+C[1]+", maxX: a"+C[2]+", maxY: a"+C[3]+"};")}}const n=new g,q=new g,t=new g,v=new g({deallocator:void 0});class r{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity}}class y extends r{constructor(){super(...arguments);this.height=1;this.indexHint=new b.PositionHint}}class z extends y{constructor(C){super();this.children=C;this.leaf=!0}}class D extends y{constructor(C){super();this.children=C;this.leaf=
!1}}a.BBox=r;a.PooledRBush=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(a,b){var g={exports:{}};g.exports;(function(d){(function(k){k=k();void 0!==k&&(d.exports=k)})(function(){function k(c,l,e,p,h){for(;p>e;){if(600<p-e){var u=p-e+1,w=l-e+1,x=Math.log(u),n=.5*Math.exp(2*x/3);x=.5*Math.sqrt(x*n*(u-n)/u)*(0>w-u/2?-1:1);k(c,l,Math.max(e,Math.floor(l-w*n/u+x)),Math.min(p,Math.floor(l+(u-w)*n/u+
x)),h)}u=c[l];w=e;n=p;m(c,e,l);for(0<h(c[p],u)&&m(c,e,p);w<n;){m(c,w,n);w++;for(n--;0>h(c[w],u);)w++;for(;0<h(c[n],u);)n--}0===h(c[e],u)?m(c,e,n):(n++,m(c,n,p));n<=l&&(e=n+1);l<=n&&(p=n-1)}}function m(c,l,e){var p=c[l];c[l]=c[e];c[e]=p}function f(c,l){return c<l?-1:c>l?1:0}return function(c,l,e,p,h){k(c,l,e||0,p||c.length-1,h||f)}})})(g);b=b.getDefaultExportFromCjs(g.exports);a.quickselect=b})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v){a.StageLayerElevationProvider=class extends d.EventedMixin(g){get spatialReference(){return this.view?.spatialReference}constructor(A){super(A);this._elevationOffset=0;this._layerHandlesKey="layerHandles"}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersectLayers=[this.stageLayer];this._intersector=q.newIntersector(this.view.state.viewingMode);this._intersector.options.store=t.StoreResults.MIN;var A=this._computeLayerExtent(this.spatialReference,
this.stageLayer);this._zmin=A[2];this._zmax=A[5];A=this.stageLayer.events;this.addHandles([A.on("layerObjectAdded",({object:F})=>this._objectChanged(F)),A.on("layerObjectRemoved",({object:F})=>this._objectChanged(F)),A.on("geometryAdded",({object:F})=>this._objectChanged(F)),A.on("geometryRemoved",({object:F})=>this._objectChanged(F)),A.on("attributesChanged",({attribute:F,object:G})=>v.affectsGeometry(F)&&this._objectChanged(G)),A.on("transformationChanged",F=>this._objectChanged(F))],this._layerHandlesKey)}dispose(){this.removeHandles(this._layerHandlesKey)}elevationInfoChanged(){const A=
null!=this.layer?this.layer.elevationInfo:null;if(null!=A&&"on-the-ground"!==A.mode){const F=m.getMetersPerVerticalUnitForSR(this.layer.spatialReference),G=n.getMetersPerUnit(A.unit??"meters");this._elevationOffset=(A.offset??0)*G/F}else this._elevationOffset=0}getElevation(A,F,G,I){D[0]=A;D[1]=F;D[2]=G;if(!this._renderCoordsHelper.toRenderCoords(D,I,D))return k.getLogger(this).error("could not project point for elevation alignment"),null;A=this._elevationOffset;F=this._zmin+A;this._renderCoordsHelper.setAltitude(C,
this._zmax+A,D);this._renderCoordsHelper.setAltitude(E,F,D);this._intersector.reset(C,E,null);this._intersector.intersect(this._intersectLayers,null,1,null,H=>!!H.lastValidElevationBB);return this._intersector.results.min.getIntersectionPoint(D)?this._renderCoordsHelper.getAltitude(D):null}_objectChanged(A){const F=this.spatialReference;if(A.lastValidElevationBB&&F){w.empty(r);var G=A.lastValidElevationBB;G.isEmpty()||this._expandExtent(F,G.min,G.max,r);var {min:I,max:H}=A.boundingVolumeWorldSpace;
this._expandExtent(F,I,H,r);w.toRect(r,y);this._zmin=Math.min(this._zmin,r[2]);this._zmax=Math.max(this._zmax,r[5]);z.extent=y;z.spatialReference=F;this.emit("elevation-change",z);h.copy(G.min,I);h.copy(G.max,H)}}_computeLayerExtent(A,F){w.empty(r);null!=A&&F.objects.forAll(G=>this._expandExtent(A,G.boundingVolumeWorldSpace.min,G.boundingVolumeWorldSpace.max,r));return r}_expandExtent(A,F,G,I){for(let H=0;8>H;++H)D[0]=H&1?F[0]:G[0],D[1]=H&2?F[1]:G[1],D[2]=H&4?F[2]:G[2],this._renderCoordsHelper.fromRenderCoords(D,
D,A),w.expandWithVec3(I,D);return I}};b.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);b.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"stageLayer",void 0);b.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);b.__decorate([f.property()],a.StageLayerElevationProvider.prototype,"spatialReference",null);a.StageLayerElevationProvider=b.__decorate([p.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],
a.StageLayerElevationProvider);const r=w.empty(),y=x.empty(),z={spatialReference:null,extent:y,context:"scene"},D=u.create(),C=u.create(),E=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/UpdatePolicy ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){a.Graphics3DElevationAlignment=class extends g{constructor(w){super(w);this._dirtyExtents=new p.ExtentSet;this._globalDirty=!1;this._averageExtentUpdateSize=0;this._dirtyGraphicsSet=new Set;this._updateElevation=!1;this.graphicsCore=this.graphicsCoreOwner=null;this.events=new d}initialize(){const w=this.graphicsCoreOwner.view.resourceController.scheduler;this.addHandles([this.elevationProvider.on("elevation-change",x=>this._elevationChanged(x)),k.watch(()=>this.graphicsCoreOwner.suspended,
()=>this._suspendedChange()),w.registerTask(u.TaskPriority.ELEVATION_ALIGNMENT,this)])}destroy(){this._dirtyGraphicsSet.clear();this.elevationProvider=this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=null}clear(){this._dirtyGraphicsSet.clear();this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=
!0;this.notifyChange("updating")}get updating(){return this.running}get running(){return 0<this._dirtyGraphicsSet.size||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(w){this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,w.madeProgress());for(w.run(()=>this._dirtyExtents.merge(w));this.running&&!w.done;)this._updateDirtyGraphics(w),
this._updateDirtyExtents(w);this.notifyChange("updating")}_updateDirtyGraphics(w){const x=this.graphicsCoreOwner.view.renderCoordsHelper,n=this.graphicsCore.effectiveUpdatePolicy===h.UpdatePolicy.ASYNC;for(const q of this._dirtyGraphicsSet.keys()){const t=this.graphicsCore.getGraphics3DGraphicById(q);this._dirtyGraphicsSet.delete(q);null!=t&&(t.alignWithElevation(this.elevationProvider,x,n),this.graphicsCoreOwner.view.deconflictor.setDirty(),w.madeProgress());if(w.done)break}}_updateDirtyExtents(w){for(;!this._dirtyExtents.empty&&
!w.done;){const x=this._dirtyExtents.pop(),n=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:x,spatialReference:n});const q=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(x,n,t=>{const v=this.graphicsCore.getGraphics3DGraphicById(t);null!=v&&v.needsElevationUpdates()&&this._dirtyGraphicsSet.add(t)});this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-q)+.9*this._averageExtentUpdateSize;w.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear();
this._dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((w,x)=>this._dirtyGraphicsSet.add(x))}_elevationChanged(w){if("scene"!==w.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:x,spatialReference:n}=w;this.graphicsCoreOwner.suspended?(this._updateElevation||(w=this.graphicsCore.computedExtent)&&x[2]>w.xmin&&x[0]<w.xmax&&x[3]>w.ymin&&x[1]<w.ymax&&(this._updateElevation=!0),this.events.emit("invalidate-elevation",
{extent:x,spatialReference:n})):(-Infinity===x[0]?this._globalDirty=!0:this._dirtyExtents.add(x),this.notifyChange("updating"))}}};b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"graphicsCoreOwner",void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"graphicsCore",void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"elevationProvider",
void 0);b.__decorate([m.property({readOnly:!0})],a.Graphics3DElevationAlignment.prototype,"updating",null);b.__decorate([m.property({readOnly:!0})],a.Graphics3DElevationAlignment.prototype,"updatingRemaining",null);a.Graphics3DElevationAlignment=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],a.Graphics3DElevationAlignment);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports",
"../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,g,d){class k{constructor(){this._extents=new b({allocator:m=>m||g.create()});this._tmpExtent=g.create();this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(m){this._contains(m)||(this._removeContained(m),g.copy(this._extents.pushNew(),m),this._dirty=!0)}pop(){this._dirty&&this._mergeTight();return this._extents.pop()}merge(m){this._mergeTight(m);
return m.hasProgressed}_mergeTight(m=d.noBudget){const f=this._extents,c=new Set;let l=0;for(;l!==f.length;){f.sort((e,p)=>e[0]-p[0]);l=f.length;c.clear();for(let e=0;e<f.length;++e){if(m.done)return;const p=f.at(e);if(p){for(let h=e+1;h<f.length;++h){const u=f.at(h);if(null==u||u[0]>=p[2])break;c.add(u)}c.forEach(h=>{if(p!==h)if(h[2]<=p[0])c.delete(h);else{var u=g.area(p),w=g.area(h),x=this._tmpExtent;g.expand(p,h,x);u+=w;.05>(g.area(x)-u)/u&&(g.copy(p,x),c.delete(h),f.remove(h),m.madeProgress())}});
c.add(p)}}}this._dirty=!1}_contains(m){return this._extents.some(f=>g.contains(f,m))}_removeContained(m){this._extents.filterInPlace(f=>!g.contains(m,f))}get test(){const m=this;return{containsPoint:f=>m._extents.some(c=>g.containsPoint(c,f))}}}a.ExtentSet=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/ellipsoidUtils ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){a.Graphics3DFrustumVisibility=class extends g{constructor(u){super(u);this.suspended=!1;this._extent=null;this._extentIntersectionDirty=!0;this._isVisibleBelowSurfaceInternal=!1;this.graphicsCoreOwner=null;this.updating=!0}initialize(){var {graphicsCoreOwner:u}=this;this._extentIntersection=new p.FrustumExtentIntersection({renderCoordsHelper:u.view.renderCoordsHelper});const w=u.view,x=w.basemapTerrain;u=w.resourceController.scheduler;this.addHandles([w.on("resize",
()=>this._viewChange()),d.watch(()=>w.state.camera,()=>this._viewChange(),d.sync),u.registerTask(h.TaskPriority.FRUSTUM_VISIBILITY,this),d.watch(()=>x.visibleElevationBounds,()=>this._elevationBoundsChange())]);"local"===w.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([d.watch(()=>[x.baseOpacity,x.wireframe,w.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),d.initial)])}destroy(){this._set("graphicsCoreOwner",null);this._extentIntersection=this._extent=
null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(u){this._extent=u;this._extentIntersectionDirty=!0;this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty();this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(u){this._isVisibleBelowSurfaceInternal=u;this._setDirty();this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const u=this.graphicsCoreOwner.view,w=u.basemapTerrain,x="none"===u.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=
"local"===u.viewingMode||!w.opaque||x}_updateExtentIntersection(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var u=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)var w=-.3*e.getReferenceEllipsoid(u.spatialReference).radius;else{const {min:x,max:n}=u.basemapTerrain.visibleElevationBounds;w=x-Math.max(1,(n-x)*(1.2-1))}this._extentIntersection.update(this._extent,u.spatialReference,w)}}get running(){return this.updating}runTask(u){this._set("updating",!1);
if(!this._extent)return this._set("suspended",!1),h.Task.YIELD;this._updateExtentIntersection();const w=this.graphicsCoreOwner.view.frustum,x=e.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(w,x));u.madeProgress()}};b.__decorate([k.property({readOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"suspended",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"graphicsCoreOwner",
void 0);b.__decorate([k.property({readOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"updating",void 0);a.Graphics3DFrustumVisibility=b.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],a.Graphics3DFrustumVisibility);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(a,b,g){class d{constructor(k){this._graphicsCore=
k;this._stateSets=[]}destroy(){this.reset();this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach(k=>k.objectStateSet.removeAll()),this._stateSets.length=0)}acquireSet(k,m){const f=new g.Graphics3DObjectStateSet(k,m);this._stateSets.push(f);k=b.makeHandle(()=>this.releaseSet(f));return{set:f,handle:k}}releaseSet(k){k.objectStateSet.removeAll();k=this._stateSets?this._stateSets.indexOf(k):-1;-1!==k&&this._stateSets.splice(k,1)}_addObjectStateSet(k,m){k.addObjectStateSet(m.stateType,
m.objectStateSet)}_removeObjectStateSet(k,m){k.removeObjectState(m.objectStateSet)}setUid(k,m){k.ids.add(m);(m=this._graphicsCore.graphics3DGraphics.get(m))&&this._addObjectStateSet(m,k)}setUids(k,m){m.forEach(f=>this.setUid(k,f))}setObjectIds(k,m){m.forEach(f=>k.ids.add(f));this._initializeSet(k)}addGraphic(k){this._stateSets.forEach(m=>{!m.paused&&m.hasGraphic(k)&&this._addObjectStateSet(k,m)})}removeGraphic(k){this._stateSets.forEach(m=>{m.hasGraphic(k)&&this._removeObjectStateSet(k,m)})}allGraphicsDeleted(){this._stateSets&&
this._stateSets.forEach(k=>k.objectStateSet.removeAll())}_initializeSet(k){const m=this._graphicsCore.graphics3DGraphics;k.objectIdField?m.forEach(f=>{f&&k.hasGraphic(f)&&this._addObjectStateSet(f,k)}):k.ids.forEach(f=>{(f=m.get(f))&&this._addObjectStateSet(f,k)})}get test(){return{states:this._stateSets}}}a.Graphics3DObjectStates=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../webgl-engine/lib/Object3DStateSet"],
function(a,b){class g{constructor(d,k){this.stateType=d;this.objectIdField=k;this.objectStateSet=new b.Object3DStateSet;this.ids=new Set;this.paused=!1}hasGraphic(d){return this.objectIdField?this.ids.has(d.graphic.attributes[this.objectIdField]):this.ids.has(d.graphic.uid)}}a.Graphics3DObjectStateSet=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./basicInterfaces"],function(a,b){var g;(function(k){k[k.Object=
0]="Object";k[k.RenderGeometry=1]="RenderGeometry";k[k.External=2]="External";k[k.COUNT=3]="COUNT"})(g||(g={}));class d{constructor(){this._items=[]}addObject(k,m){this._items.push({type:g.Object,objectStateId:m,object:k})}addRenderGeometry(k,m,f){this._items.push({type:g.RenderGeometry,objectStateId:m,renderGeometry:k,owner:f})}addExternal(k,m){this._items.push({type:g.External,objectStateId:m,remove:k})}remove(k){for(let m=this._items.length-1;0<=m;--m){const f=this._items[m];f.objectStateId===
k&&(this._removeObjectStateItem(f),this._items.splice(m,1))}}removeObject(k){for(let m=this._items.length-1;0<=m;--m){const f=this._items[m];f.type===g.Object&&f.object===k&&(this._removeObjectStateItem(f),this._items.splice(m,1))}}removeRenderGeometry(k){for(let m=this._items.length-1;0<=m;--m){const f=this._items[m];f.type===g.RenderGeometry&&f.renderGeometry===k&&(this._removeObjectStateItem(f),this._items.splice(m,1))}}removeAll(){this._items.forEach(k=>{this._removeObjectStateItem(k)});this._items=
[]}_removeObjectStateItem(k){switch(k.type){case g.Object:k.objectStateId.channel===b.Object3DState.Highlight?k.object.removeHighlight(k.objectStateId):k.objectStateId.channel===b.Object3DState.MaskOccludee&&k.object.removeOcclude(k.objectStateId);break;case g.RenderGeometry:k.owner.removeRenderGeometryObjectState(k.renderGeometry,k.objectStateId);break;case g.External:k.remove(k.objectStateId)}}}a.Object3DStateSet=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){const n=d.getLogger("esri.views.3d.layers.graphics.Graphics3DScaleVisibility");a.Graphics3DScaleVisibility=class extends g{constructor(t){super(t);this._layerScaleRangeVisibilityQuery=this._scaleRangeActive=!1;this._extent=null;this._updatingHandles=new e.UpdatingHandles;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=null;this.layerScaleEnabled=!0;this.suspended=!1;this._dirty=!0}initialize(){this.updateScaleRangeActive();
this.addHandles(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(x.TaskPriority.SCALE_VISIBILITY,this));this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())}destroy(){this._updatingHandles.destroy();this.removeHandles();this._dirty=!1;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=this._extent=null}get updating(){return this._dirty||this._updatingHandles.updating}_setDirty(){this._dirty=
!0}setExtent(t){const v=this.graphicsCoreOwner.view.spatialReference,r=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(v===r)this._extent=t??null;else{const y=h.create();p.projectBoundingRect(t,v,y,r)?this._extent=y:this._extent=null}this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){var t=this.layer,v=t.effectiveScaleRange;v=this.layerScaleEnabled&&null!=v&&(0<v.minScale||0<v.maxScale);t.labelingInfo&&!v&&(v=t.labelingInfo.some(r=>r&&(0<(r.minScale??
0)||0<(r.maxScale??0))));t=this._scaleRangeActive!==v;(this._scaleRangeActive=v)&&!this.hasHandles("terrain-events")&&this.basemapTerrain?(this.addHandles(this.basemapTerrain.on("scale-change",r=>this._scaleUpdateHandler(r)),"terrain-events"),this.layerScaleEnabled&&this.addHandles(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!v&&this.hasHandles("terrain-events")&&this.removeHandles("terrain-events");return t}get running(){return!(!this.graphicsCoreOwner.view.basemapTerrain||
!this.updating)}runTask(t){const v=this.graphicsCoreOwner.view.basemapTerrain;if(this._extent&&v&&v.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return x.Task.YIELD;this._layerScaleRangeVisibilityQuery=!0;const {minScale:r,maxScale:y}=this.layer.effectiveScaleRange;v.queryVisibleScaleRange(this._extent,r,y,z=>this._finishUpdate(z))}else this._finishUpdate(!0);t.madeProgress()}_finishUpdate(t){this._layerScaleRangeVisibilityQuery=!1;this._set("suspended",
!t);this._dirty=!1}_visibleAtLayerScale(t){const v=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||w.scaleBoundsPredicate(t,v.minScale||0,v.maxScale||0)}_visibleAtLabelScale(t,v){return w.scaleBoundsPredicate(t,v.minScale||0,v.maxScale||0)}_graphicScale(t){let v;null!=t.centroid?v=t.centroid:null!=t.graphic.geometry&&"point"===t.graphic.geometry.type&&(v=t.graphic.geometry);return v?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(v):1:null}_graphicVisible(t){if(!this.layerScaleEnabled)return!0;
t=this._graphicScale(t);return this._visibleAtLayerScale(t)}updateVisibility(t){if(this._scaleRangeActive){const v=this._graphicVisible(t);return t.setVisibilityFlag(u.VisibilityGroup.GRAPHIC,u.VisibilityFlag.SCALE_RANGE,v)}return!1}updateGraphicLabelScaleVisibility(t){if(!this._scaleRangeActive||!t.labelLayers||0===t.labelLayers.length)return!1;const v=this._graphicScale(t);if(t=this._updateLabelScaleVisibility(t,v))this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty();
return t}_updateLabelScaleVisibility(t,v){if(!t.labelLayers||0===t.labelLayers.length)return!1;const r=t.labelLayers[0]._labelClass;return null!=r?.minScale&&null!=r.maxScale&&(v=this._visibleAtLabelScale(v,r),t.setVisibilityFlag(u.VisibilityGroup.LABEL,u.VisibilityFlag.SCALE_RANGE,v))?!0:!1}_scaleUpdateHandler(t){this._setDirty();if(this.graphicsCore.visible){var v=t.extent,r=t.scale,y=this._visibleAtLayerScale(r),z=!1,D=this.graphicsCoreOwner.view.spatialReference;t=t.spatialReference;if(null==
t)n.error("scaleUpdate: Internal error, no SpatialReference given for tiles");else{var C=!t.equals(D);C&&!p.projectBoundingRect(v,t,q,D)?n.error("scaleUpdate: Internal error, cannot project AABR from "+t+" to wkid "+D):(this.queryGraphicUIDsInExtent(C?q:v,D,E=>{E=this.graphicsCore.getGraphics3DGraphicById(E);if(null!=E){var A=E.centroid;null!=A&&(v[0]>A.x||v[1]>A.y||v[2]<A.x||v[3]<A.y)||(E.setVisibilityFlag(u.VisibilityGroup.GRAPHIC,u.VisibilityFlag.SCALE_RANGE,y)&&(z=!0),this._updateLabelScaleVisibility(E,
r)&&(z=!0))}}),z&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty()))}}}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(t=>t.setVisibilityFlag(u.VisibilityGroup.GRAPHIC,u.VisibilityFlag.SCALE_RANGE,!0)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()}};b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,
"graphicsCoreOwner",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"layer",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"graphicsCore",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"basemapTerrain",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DScaleVisibility.prototype,"layerScaleEnabled",void 0);
b.__decorate([k.property({readOnly:!0})],a.Graphics3DScaleVisibility.prototype,"suspended",void 0);b.__decorate([k.property({readOnly:!0})],a.Graphics3DScaleVisibility.prototype,"updating",null);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"_dirty",void 0);a.Graphics3DScaleVisibility=b.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],a.Graphics3DScaleVisibility);const q=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=function(b,g,d){if(!d||null==g)return null;if(!b){a:{b=d.toLowerCase();for(var k in g)if(k.toLowerCase()===b){g=g[k];break a}g=null}return g}return(k=b.get(d))?g[k.name]:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureVisibilityFilter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ../graphics/QueryEngine ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){a.FeatureVisibilityFilter=class extends g{constructor(v){super(v);this._queryEngine=this._frameTask=this._updateTask=null;this._updateRequested=!0;this._updatingHandles=new w.UpdatingHandles;this._updateVisibility=async r=>{if(null==this._compositedFeatureFilter&&null==this._sceneFilter||0===this.context.getFeatureCount())return this._frameTask.schedule(()=>this.clear(),r);try{const y=await this._queryEngine.executeQueryForIdSet(this._compositedFeatureFilter,
this._sceneFilter,r);return this._frameTask.schedule(()=>{this.context.updateFeatureVisibilities(z=>y.has(z))},r)}catch(y){return f.throwIfAbortError(y),k.getLogger(this).warn(`FeatureFilter query failed: ${y}`,{error:y}),this._frameTask.schedule(()=>{this.context.setAllFeaturesVisibility(!0)},r)}}}initialize(){const v=t.TaskPriority.FILTER_VISIBILITY,{layer:r,view:y}=this._layerView,{featureStore:z}=this.context;this._queryEngine=new q.QueryEngine({context:{spatialReference:y.spatialReference,layer:r,
scheduler:y.resourceController.scheduler,featureStore:z,hasM:"hasM"in this._layerView?this._layerView.hasM:!1,hasZ:"hasZ"in this._layerView?this._layerView.hasZ:!1},priority:v});this._frameTask=this._layerView.view.resourceController.scheduler.registerTask(v,this);this._updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this.reapply(),c.initial)}destroy(){this._updateRequested=!1;this._updatingHandles.destroy();this.clear();this._updateTask=m.abortMaybe(this._updateTask);
this._frameTask=m.removeMaybe(this._frameTask);this._queryEngine=m.destroyMaybe(this._queryEngine);this._set("context",null)}get updating(){return this.running||this._updatingHandles.updating||null!=this._updateTask&&!this._updateTask.finished}get running(){return this._updateRequested||this._frameTask.updating}get defaultVisibility(){return null==this._compositedFeatureFilter&&null==this._sceneFilter}get _featureFilter(){return"filter"in this._layerView?this._layerView.filter:null}get _sceneFilter(){return"layerFilter"in
this._layerView?this._layerView.layerFilter:null}get _floorFilter(){return n.getFloorFilterClause(this._layerView)}get _timeExtent(){return"timeExtent"in this._layerView?this._layerView.timeExtent:null}get _compositedFeatureFilter(){const {_featureFilter:v,_timeExtent:r,_floorFilter:y}=this;if(null==r&&null==y)return v;const z=null!=v?v.clone():new x;null!=r&&(z.timeExtent=null!=z.timeExtent?z.timeExtent.intersection(r):r);null!=y&&(z.where=null==z.where||""===z.where?y:`(${z.where}) AND (${y})`);
return z}get _layerView(){return this.context.layerView}reapply(){this._updateRequested=!0}clear(){this._queryEngine.clear();this.context.clearFeaturesVisibility()}runTask(v){this._updateRequested&&(this._updateTask=m.abortMaybe(this._updateTask),this._updateTask=d.createTask(this._updateVisibility),this._updateRequested=!1,v.madeProgress());this._frameTask.processQueue(v)}};b.__decorate([l.property({constructOnly:!0})],a.FeatureVisibilityFilter.prototype,"context",void 0);b.__decorate([l.property()],
a.FeatureVisibilityFilter.prototype,"updating",null);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"running",null);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"defaultVisibility",null);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"_featureFilter",null);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"_sceneFilter",null);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"_floorFilter",null);b.__decorate([l.property()],
a.FeatureVisibilityFilter.prototype,"_timeExtent",null);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"_compositedFeatureFilter",null);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"_layerView",null);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"_updateTask",void 0);b.__decorate([l.property()],a.FeatureVisibilityFilter.prototype,"_updateRequested",void 0);a.FeatureVisibilityFilter=b.__decorate([u.subclass("esri.views.3d.layers.support.FeatureVisibilityFilter")],
a.FeatureVisibilityFilter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(a){function b(g,d){if(!g?.length)return null;g=g.filter(k=>""!==k).map(k=>`'${k}'`);g.push("''");return`${d} IN (${g.join(",")}) OR ${d} IS NULL`}a.getFloorFilterClause=function(g){const d=g.layer;return"floorInfo"in d&&d.floorInfo?.floorField&&"floors"in g.view?b(g.view.floors,d.floorInfo.floorField):null};a.getLayerFloorFilterClause=
function(g,d){return"floorInfo"in d&&d.floorInfo?.floorField?b(g,d.floorInfo.floorField):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){const n=p.QueryEngine;a.QueryEngine=class extends d{get layer(){return this.context.layer}get spatialReference(){return this.context.spatialReference}get _queryGeometryType(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}get defaultQueryJSON(){return(new w({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(q){super(q);
this._dataQueryEngineInstance=null}destroy(){this.clear()}clear(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1}async executeQueryForIdSet(q,t,v){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(q,t),v)}async executeQueryForCount(q,t){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(q),t)}async executeQueryForExtent(q,t){const {count:v,extent:r}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(q),
t);q=e.fromJSON(r);return{count:v,extent:q}}async executeQueryForIds(q,t){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(q),t)}async executeQueryForLatestObservations(q,t){q=await this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(q),t);q=u.fromJSON(q);q.features.forEach(v=>{v.layer=this.layer;v.sourceLayer=this.layer});return q}async executeQuery(q,t){q=await this._dataQueryEngine.executeQuery(this._ensureQueryJSON(q),t);q=u.fromJSON(q);q.features.forEach(v=>
{v.layer=this.layer;v.sourceLayer=this.layer});return q}_ensureQueryJSON(q,t){let v=this.defaultQueryJSON;null!=q&&("outSpatialReference"in q&&!q.outSpatialReference&&(q.outSpatialReference=this.spatialReference),v=q.toJSON());null!=t&&(q=t.geometries.map(r=>r.toJSON()).reduce((r,y)=>{r.rings=r.rings.concat(y.rings);return r}),v={...v,sceneFilter:{...t,geometry:q}});return v}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const q="timeInfo"in this.layer&&
this.layer.timeInfo?.toJSON()||null,t=this.layer.objectIdField,v=x.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),r=this.layer.fieldsIndex?.toJSON()||new h([]),y=this.priority,z=this.spatialReference.toJSON(),{hasZ:D,hasM:C,featureStore:E,scheduler:A}=this.context;return this._dataQueryEngineInstance=new n({hasZ:D,hasM:C,geometryType:v,fieldsIndex:r,timeInfo:q,spatialReference:z,objectIdField:t,featureStore:E,scheduler:A,priority:y})}};b.__decorate([k.property({constructOnly:!0})],
a.QueryEngine.prototype,"context",void 0);b.__decorate([k.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);b.__decorate([k.property()],a.QueryEngine.prototype,"layer",null);b.__decorate([k.property()],a.QueryEngine.prototype,"spatialReference",null);b.__decorate([k.property()],a.QueryEngine.prototype,"_queryGeometryType",null);b.__decorate([k.property()],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=b.__decorate([l.subclass("esri.views.3d.layers.graphics.QueryEngine")],
a.QueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../core/arrayUtils ../../../core/Error ../../../core/JSONSupport ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./geometryUtils ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./queryUtils ./queryValidationUtils ./spatialQuerySupport ./timeSupport ../../support/FieldsIndex ../../../views/support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G){class I{constructor(L,J=null,M,T,Q){this.attributes=L;this.geometry=M;this.centroid=T;this.filterFlags=Q;this.groupId=-1;this.displayId=J}}const H=new f.MemCacheStorage(2E6);let B=0;class K{constructor(L){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:y.queryCapabilities};this.geometryType=L.geometryType;this.hasM=!!L.hasM;this.hasZ=!!L.hasZ;this.objectIdField=L.objectIdField;this.spatialReference=L.spatialReference;
this.definitionExpression=L.definitionExpression;this.featureStore=L.featureStore;this.aggregateAdapter=L.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=L.timeInfo;L.cacheSpatialQueries&&(this._geometryQueryCache=new f.MemCache(B++ +"$$",H));this.fieldsIndex=d.isSerializable(L.fieldsIndex)?L.fieldsIndex:F.fromJSON(L.fieldsIndex);this.availableFields=null==L.availableFields?new Set(this.fieldsIndex.fields.map(J=>J.name)):new Set(L.availableFields.map(J=>
this.fieldsIndex.get(J)?.name).filter(J=>null!=J));L.scheduler&&L.priority&&(this._frameTask=L.scheduler.registerTask(L.priority))}destroy(){this._frameTask=m.removeMaybe(this._frameTask);this.clearCache();m.destroyMaybe(this._geometryQueryCache);this._changeHandle=m.removeMaybe(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear();this._fullExtentPromise=this._timeExtentPromise=this._allFeaturesPromise=null}async executeQuery(L,
J){try{return(await this._executeQuery(L,{},J)).createQueryResponse()}catch(M){if(M!==D.queryEngineEmptyResult)throw M;return(new z.QueryEngineResult([],L,this)).createQueryResponse()}}async executeQueryForCount(L={},J){try{return(await this._executeQuery(L,{returnGeometry:!1,returnCentroid:!1,outSR:null},J)).createQueryResponseForCount()}catch(M){if(M!==D.queryEngineEmptyResult)throw M;return 0}}async executeQueryForExtent(L,J){const M=L.outSR;try{const T=await this._executeQuery(L,{returnGeometry:!0,
returnCentroid:!1,outSR:null},J),Q=T.size;if(!Q)return{count:0,extent:null};const O=await this._getBounds(T.items,T.spatialReference,M||this.spatialReference);return{count:Q,extent:O}}catch(T){if(T===D.queryEngineEmptyResult)return{count:0,extent:null};throw T;}}async executeQueryForIds(L,J){return this.executeQueryForIdSet(L,J).then(M=>Array.from(M))}async executeQueryForIdSet(L,J){try{const M=await this._executeQuery(L,{returnGeometry:!0,returnCentroid:!1,outSR:null},J),T=M.items,Q=new Set;await this._reschedule(()=>
{for(const O of T)Q.add(M.featureAdapter.getObjectId(O))},J);return Q}catch(M){if(M===D.queryEngineEmptyResult)return new Set;throw M;}}async executeQueryForSnapping(L,J){const {point:M,distance:T,returnEdge:Q,vertexMode:O}=L;if(!Q&&"none"===O)return{candidates:[]};let U=k.clone(L.query);U=await this._schedule(()=>D.normalizeQueryLike(U,this.definitionExpression,this.spatialReference),J);U=await this._reschedule(()=>C.validateQuery(U,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,
geometryType:this.geometryType,spatialReference:this.spatialReference}),J);const Z=!n.equals(M.spatialReference,this.spatialReference);Z&&await r.checkProjectionSupport(M.spatialReference,this.spatialReference);var P="number"===typeof T?T:T.x,R="number"===typeof T?T:T.y;P={xmin:M.x-P,xmax:M.x+P,ymin:M.y-R,ymax:M.y+R,spatialReference:M.spatialReference};P=Z?r.project(P,this.spatialReference):P;if(!P)return{candidates:[]};R=(await x.normalizeCentralMeridian(w.fromJSON(M),null,{signal:J}))[0];const W=
(await x.normalizeCentralMeridian(w.fromJSON(P),null,{signal:J}))[0];if(null==R||null==W)return{candidates:[]};const N=new z.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(W.toJSON())),J),U,this);await this._reschedule(()=>this._executeObjectIdsQuery(N),J);await this._reschedule(()=>this._executeTimeQuery(N),J);await this._reschedule(()=>this._executeAttributesQuery(N),J);await this._reschedule(()=>this._executeGeometryQueryForSnapping(N,J),J);R=R.toJSON();
R=Z?r.project(R,this.spatialReference):R;return N.createSnappingResponse({...L,point:R,distance:Z?Math.max(P.xmax-P.xmin,P.ymax-P.ymin)/2:T},M.spatialReference)}async executeQueryForLatestObservations(L,J){if(!this.timeInfo?.trackIdField)throw new g("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:L,timeInfo:this.timeInfo});try{const M=await this._executeQuery(L,{},J);await this._reschedule(()=>this._filterLatest(M),J);return M.createQueryResponse()}catch(M){if(M!==D.queryEngineEmptyResult)throw M;
return(new z.QueryEngineResult([],L,this)).createQueryResponse()}}async executeQueryForSummaryStatistics(L={},J,M){const {field:T,normalizationField:Q,valueExpression:O}=J;return(await this._executeQueryForStatistics(L,{field:T,normalizationField:Q,valueExpression:O},M)).createSummaryStatisticsResponse(J)}async executeQueryForUniqueValues(L={},J,M){const {field:T,field2:Q,field3:O,valueExpression:U}=J;return(await this._executeQueryForStatistics(L,{field:T,field2:Q,field3:O,valueExpression:U},M)).createUniqueValuesResponse(J)}async executeQueryForClassBreaks(L=
{},J,M){const {field:T,normalizationField:Q,valueExpression:O}=J;return(await this._executeQueryForStatistics(L,{field:T,normalizationField:Q,valueExpression:O},M)).createClassBreaksResponse(J)}async executeQueryForHistogram(L={},J,M){const {field:T,normalizationField:Q,valueExpression:O}=J;return(await this._executeQueryForStatistics(L,{field:T,normalizationField:Q,valueExpression:O},M)).createHistogramResponse(J)}async fetchRecomputedExtents(L){this._timeExtentPromise||(this._timeExtentPromise=
A.getTimeExtent(this.timeInfo,this.featureStore));const [J,M]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);c.throwIfAborted(L);return{fullExtent:J,timeExtent:M}}async _getBounds(L,J,M){const T=p.set(p.create(),p.negativeInfinity);await this.featureStore.forEachBounds(L,Q=>p.expandWithAABB(T,Q));L={xmin:T[0],ymin:T[1],xmax:T[3],ymax:T[4],spatialReference:v.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(T[2])&&isFinite(T[5])&&(L.zmin=T[2],L.zmax=T[5]);J=r.project(L,
J,M);J.spatialReference=v.cleanFromGeometryEngine(M);0===J.xmax-J.xmin&&(M=l.getMetersPerUnitForSR(J.spatialReference),J.xmin-=M,J.xmax+=M);0===J.ymax-J.ymin&&(M=l.getMetersPerUnitForSR(J.spatialReference),J.ymin-=M,J.ymax+=M);this.hasZ&&null!=J.zmin&&null!=J.zmax&&0===J.zmax-J.zmin&&(M=l.getMetersPerUnitForSR(J.spatialReference),J.zmin-=M,J.zmax+=M);return J}_getFullExtent(){this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):
this._getAllFeatures().then(L=>this._getBounds(L,this.spatialReference,this.spatialReference)));return this._fullExtentPromise}async _schedule(L,J){return null!=this._frameTask?this._frameTask.schedule(L,J):L(G.noBudget)}async _reschedule(L,J){return null!=this._frameTask?this._frameTask.reschedule(L,J):L(G.noBudget)}async _getAllFeaturesQueryEngineResult(L){return new z.QueryEngineResult(await this._getAllFeatures(),L,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const M=[];this._allFeaturesPromise=
(async()=>{await this.featureStore.forEach(T=>M.push(T))})().then(()=>M)}const L=this._allFeaturesPromise,J=await L;return L===this._allFeaturesPromise?J.slice():this._getAllFeatures()}async _executeQuery(L,J,M){L=k.clone(L);L=await this._schedule(()=>D.normalizeQuery(L,this.definitionExpression,this.spatialReference),M);L=await this._reschedule(()=>C.validateQuery(L,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),
M);L={...L,...J};const T=await this._reschedule(()=>this._executeSceneFilterQuery(L,M),M),Q=await this._reschedule(()=>this._executeGeometryQuery(L,T,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(Q),M);await this._reschedule(()=>this._executeObjectIdsQuery(Q),M);await this._reschedule(()=>this._executeTimeQuery(Q),M);await this._reschedule(()=>this._executeAttributesQuery(Q),M);return Q}async _executeSceneFilterQuery(L,J){if(null==L.sceneFilter)return null;const {outSR:M,returnGeometry:T,
returnCentroid:Q}=L;var O=this.featureStore.featureSpatialReference,U=L.sceneFilter.geometry;const Z=null==O||n.equals(O,U.spatialReference)?U:r.project(U,O);if(!Z)return null;O=T||Q;O=n.isValid(M)&&!n.equals(this.spatialReference,M)&&O?async N=>this._project(N,M):N=>N;const P=this.featureAdapter;U=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(Z)),J);if("disjoint"===L.sceneFilter.spatialRelationship){if(!U.length)return null;const N=new Set;for(var R of U)N.add(P.getObjectId(R));
const V=await this._reschedule(()=>this._getAllFeatures(),J);R=await this._reschedule(async()=>{const S=await E.getSpatialQueryOperator("esriSpatialRelDisjoint",Z,this.geometryType,this.hasZ,this.hasM),X=await this._runSpatialFilter(V,ca=>!N.has(P.getObjectId(ca))||S(P.getGeometry(ca)),J);return new z.QueryEngineResult(X,L,this)},J);return O(R)}if(!U.length)return new z.QueryEngineResult([],L,this);if(this._canExecuteSinglePass(Z,L))return O(new z.QueryEngineResult(U,L,this));const W=await E.getSpatialQueryOperator("esriSpatialRelContains",
Z,this.geometryType,this.hasZ,this.hasM);R=await this._runSpatialFilter(U,N=>W(P.getGeometry(N)),J);return O(new z.QueryEngineResult(R,L,this))}async _executeGeometryQuery(L,J,M){if(null!=J&&0===J.items.length)return J;L=null!=J?J.query:L;const {geometry:T,outSR:Q,spatialRel:O,returnGeometry:U,returnCentroid:Z}=L;var P=this.featureStore.featureSpatialReference;const R=!T||null==P||n.equals(P,T.spatialReference)?T:r.project(T,P),W=U||Z,N=n.isValid(Q)&&!n.equals(this.spatialReference,Q),V=this._geometryQueryCache&&
null==J?N&&W?JSON.stringify({originalFilterGeometry:T,spatialRelationship:O,outSpatialReference:Q}):JSON.stringify({originalFilterGeometry:T,spatialRelationship:O}):null;P=V?this._geometryQueryCache.get(V):null;if(null!=P)return new z.QueryEngineResult(P,L,this);P=async ia=>{N&&W&&await this._project(ia,Q);V&&this._geometryQueryCache.put(V,ia.items,ia.items.length+1);return ia};if(!R)return P(null!=J?J:await this._getAllFeaturesQueryEngineResult(L));const S=this.featureAdapter;let X=await this._reschedule(()=>
this._searchFeatures(this._getQueryBBoxes(T)),M);if("esriSpatialRelDisjoint"===O){if(!X.length)return P(null!=J?J:await this._getAllFeaturesQueryEngineResult(L));const ia=new Set;for(var ca of X)ia.add(S.getObjectId(ca));const ka=null!=J?J.items:await this._reschedule(()=>this._getAllFeatures(),M);ca=await this._reschedule(async()=>{const na=await E.getSpatialQueryOperator(O,R,this.geometryType,this.hasZ,this.hasM),Y=await this._runSpatialFilter(ka,ea=>!ia.has(S.getObjectId(ea))||na(S.getGeometry(ea)),
M);return new z.QueryEngineResult(Y,L,this)},M);return P(ca)}if(null!=J){const ia=new b.PositionHint;X=X.filter(ka=>0<=b.indexOf(J.items,ka,J.items.length,ia))}if(!X.length)return P=new z.QueryEngineResult([],L,this),V&&this._geometryQueryCache.put(V,P.items,1),P;if(this._canExecuteSinglePass(R,L))return P(new z.QueryEngineResult(X,L,this));const ba=await E.getSpatialQueryOperator(O,R,this.geometryType,this.hasZ,this.hasM);ca=await this._runSpatialFilter(X,ia=>ba(S.getGeometry(ia)),M);return P(new z.QueryEngineResult(ca,
L,this))}async _executeGeometryQueryForSnapping(L,J){const {query:M}=L,{spatialRel:T}=M;if(L?.items?.length&&M.geometry&&T){var Q=await E.getSpatialQueryOperator(T,M.geometry,this.geometryType,this.hasZ,this.hasM);J=await this._runSpatialFilter(L.items,O=>Q(O.geometry),J);L.items=J}}_executeAggregateIdsQuery(L){if(0!==L.items.length&&L.query.aggregateIds?.length&&null!=this.aggregateAdapter){var J=new Set;for(const T of L.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(T).forEach(Q=>
J.add(Q));var M=this.featureAdapter.getObjectId;L.items=L.items.filter(T=>J.has(M(T)))}}_executeObjectIdsQuery(L){if(0!==L.items.length&&L.query.objectIds?.length){var J=new Set(L.query.objectIds),M=this.featureAdapter.getObjectId;L.items=L.items.filter(T=>J.has(M(T)))}}_executeTimeQuery(L){if(0!==L.items.length){var J=A.getTimeOperator(this.timeInfo,L.query.timeExtent,this.featureAdapter);null!=J&&(L.items=L.items.filter(J))}}_executeAttributesQuery(L){if(0!==L.items.length){var J=t.getWhereClause(L.query.where,
this.fieldsIndex);if(J){if(!J.isStandardized)throw new TypeError("Where clause is not standardized");L.items=L.items.filter(M=>J.testFeature(M,this.featureAdapter))}}}async _runSpatialFilter(L,J,M){if(!J)return L;if(null==this._frameTask)return L.filter(U=>J(U));let T=0;const Q=[],O=async U=>{for(;T<L.length;){const Z=L[T++];J(Z)&&(Q.push(Z),U.madeProgress());U.done&&await this._reschedule(P=>O(P),M)}};return this._reschedule(U=>O(U),M).then(()=>Q)}_filterLatest(L){const {trackIdField:J,startTimeField:M,
endTimeField:T}=this.timeInfo,Q=T||M,O=new Map,U=this.featureAdapter.getAttribute;for(const Z of L.items){const P=U(Z,J),R=U(Z,Q),W=O.get(P);(!W||R>U(W,Q))&&O.set(P,Z)}L.items=Array.from(O.values())}_canExecuteSinglePass(L,J){({spatialRel:J}=J);return E.canQueryWithRBush(L)&&("esriSpatialRelEnvelopeIntersects"===J||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===J||"esriSpatialRelContains"===J))}async _project(L,J){if(!J||n.equals(this.spatialReference,J))return L;const M=this.featureAdapter;
let T=void 0;try{const Q=await this._getFullExtent();T=e.getTransformation(this.spatialReference,J,Q)}catch{}J=await r.projectMany(L.items.map(Q=>v.getGeometry(this.geometryType,this.hasZ,this.hasM,M.getGeometry(Q))),this.spatialReference,J,T);L.items=J.map((Q,O)=>M.cloneWithGeometry(L.items[O],q.convertFromGeometry(Q,this.hasZ,this.hasM)));return L}_getQueryBBoxes(L){if(E.canQueryWithRBush(L)){if(w.isExtent(L))return[h.fromValues(Math.min(L.xmin,L.xmax),Math.min(L.ymin,L.ymax),Math.max(L.xmin,L.xmax),
Math.max(L.ymin,L.ymax))];if(w.isPolygon(L))return L.rings.map(J=>h.fromValues(Math.min(J[0][0],J[2][0]),Math.min(J[0][1],J[2][1]),Math.max(J[0][0],J[2][0]),Math.max(J[0][1],J[2][1])))}return[u.getBoundsXY(h.create(),L)]}async _searchFeatures(L){const J=new Set;await Promise.all(L.map(M=>this.featureStore.forEachInBounds(M,T=>J.add(T))));L=Array.from(J.values());J.clear();return L}async _executeQueryForStatistics(L,J,M){L=k.clone(L);try{L=await this._schedule(()=>D.normalizeQuery(L,this.definitionExpression,
this.spatialReference),M);L=await this._reschedule(()=>C.validateStatisticsQuery(L,J,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);const T=await this._reschedule(()=>this._executeSceneFilterQuery(L,M),M),Q=await this._reschedule(()=>this._executeGeometryQuery(L,T,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(Q),M);await this._reschedule(()=>this._executeObjectIdsQuery(Q),M);await this._reschedule(()=>
this._executeTimeQuery(Q),M);await this._reschedule(()=>this._executeAttributesQuery(Q),M);return Q}catch(T){if(T!==D.queryEngineEmptyResult)throw T;return new z.QueryEngineResult([],L,this)}}}a.Feature=I;a.QueryEngine=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(a,b,g,d){function k(u,w,x={}){const n=m(w,u);if(!n)throw x=
e.getError(w,u),new b("unsupported-query","invalid SQL expression",{expression:w,error:x});u=x.expressionName||"expression";if(x.validateStandardized&&!n.isStandardized)throw new b("unsupported-query",`${u} is not standard`,{expression:w});if(x.validateAggregate&&!n.isAggregate)throw new b("unsupported-query",`${u} does not contain a valid aggregate function`,{expression:w});return n.fieldNames}function m(u,w){return u?e.get(u,w):null}function f(u){return/\((.*?)\)/.test(u)?u:u.split(" as ")[0]}function c(u,
w,x,n={}){const q=new Map;var t=n.allowedFieldTypes??h;for(const v of x)if("*"!==v)if(u.get(v))l(q,u,w,t,v);else try{const r=f(v),y=k(u,r,{validateStandardized:!0});for(const z of y)l(q,u,w,t,z)}catch(r){q.set(v,{type:"expression-error",expression:v,error:r})}if(q.size)throw new b("unsupported-query",`${n.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(q.values()),query:n.query});}function l(u,w,x,n,q){"*"!==q&&((w=w.get(q))?x.has(w.name)?!1===n?.has(w.type)&&
u.set(q,{type:"invalid-type",fieldName:w.name,fieldType:d.kebabDict.fromJSON(w.type),allowedFieldTypes:Array.from(n,t=>d.kebabDict.fromJSON(t))}):u.set(q,{type:"missing-field",fieldName:w.name}):u.set(q,{type:"invalid-field",fieldName:q}))}const e=new g.WhereClauseCache(50,500);g=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeBigInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong".split(" "));const p=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly",
"esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),h=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...g,...p]);a.allDateAndTimeFieldTypes=p;a.getAliasFromFieldName=function(u){return u.split(" as ")[1]};a.getExpressionFromFieldName=f;a.getWhereClause=m;a.numericFieldTypes=g;a.validateFields=c;a.validateHaving=function(u,w,x,n,q){if(!x)return!0;const t=k(u,x,{validateAggregate:!0,expressionName:"having clause"});c(u,w,t,{expressionName:"having clause",query:q});if(!m(x,
u)?.getExpressions().every(v=>{const {aggregateType:r,field:y}=v,z=u.get(y)?.name;return n.some(D=>{const {onStatisticField:C,statisticType:E}=D;return u.get(C)?.name===z&&E.toLowerCase().trim()===r})}))throw new b("unsupported-query","expressions in having clause should also exist in outStatistics",{having:x});return!0};a.validateWhere=function(u,w,x,n){if(!x)return!0;x=k(u,x,{validateStandardized:!0,expressionName:"where clause"});c(u,w,x,{expressionName:"where clause",query:n});return!0};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(a,b,g){class d{constructor(k,m){this._cache=new b.LRUCache(k);this._invalidCache=new b.LRUCache(m)}get(k,m){const f=`${m.uid}:${k}`,c=this._cache.get(f);if(c)return c;if(null!=this._invalidCache.get(f))return null;try{const l=g.WhereClause.create(k,m);this._cache.put(f,l);return l}catch(l){return this._invalidCache.put(f,l),null}}getError(k,m){return this._invalidCache.get(`${m.uid}:${k}`)??
null}}a.WhereClauseCache=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../arcade/ArcadeDate ../../arcade/featureset/support/errorsupport ../has ./AggregateFunctions ./DateOnly ./sqlArithmeticUtils ./sqlCompareUtils ./sqlDateParsingUtils ./SqlInterval ./SqlTimestampOffset ./StandardizedFunctions ./TimeOnly ./WhereGrammar ../../chunks/datetime".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(G){return Array.isArray(G)?
G:[G]}function q(G){return null!==G?!0!==G:null}function t(G,I){return null!=G&&null!=I?!0===G&&!0===I:!1===G||!1===I?!1:null}function v(G,I){return null!=G&&null!=I?!0===G||!0===I:!0===G||!0===I?!0:null}function r(G,I){if(null==G)return null;let H=!1;for(const B of I)if(null==B)H=null;else if(G===B){H=!0;break}return H}function y(G,I,H){if(null==G)return null;let B="",K=A.Normal;for(let L=0;L<I.length;L++){const J=I.charAt(L);switch(K){case A.Normal:J===H?K=A.Escaped:B="-[]/{}()*+?.\\^$|".includes(J)?
B+("\\"+J):"%"===J?B+".*":"_"===J?B+".":B+J;break;case A.Escaped:B="-[]/{}()*+?.\\^$|".includes(J)?B+("\\"+J):B+J,K=A.Normal}}return(new RegExp("^"+B+"$","m")).test(G)}function z(G,I,H,B){G=B.getAttribute(G,I);I=H?.get(I);return null==G||"esriFieldTypeDate"!==I?.type&&"date"!==I?.type?null==G||"esriFieldTypeDateOnly"!==I?.type&&"date-only"!==I?.type?null==G||"esriFieldTypeTimeOnly"!==I?.type&&"time-only"!==I?.type?null==G||"esriFieldTypeTimestampOffset"!==I?.type&&"timestamp-offset"!==I?.type?G:new p.SqlTimeStampOffset(G):
u.TimeOnly.fromReader(G):m.DateOnly.fromReader(G):l.convertToExecutingTimeZone(new Date(G),H?.getLuxonTimeZone(I.name)??x.FixedOffsetZone.utcInstance)}const D=new Set(["current_timestamp","current_date","current_time"]);class C{static makeBool(G){return!0===G}static featureValue(G,I,H,B){return z(G,I,H,B)}static equalsNull(G){return null===G}static applyLike(G,I,H){return y(G,I,H)}static ensureArray(G){return n(G)}static applyIn(G,I){return r(G,I)}static currentDate(G){return m.DateOnly.fromNow(G)}static makeSqlInterval(G,
I,H){return e.SqlInterval.createFromValueAndQualifer(G,I,H)}static convertInterval(G){return G instanceof e.SqlInterval?G.valueInMilliseconds():G}static currentTimestamp(G){return l.convertToExecutingTimeZone(new Date,G)}static compare(G,I,H,B){return c.sqlCompare(I,H,G)}static calculate(G,I,H,B){return f.sqlCalculateFunction(G,I,H,B)}static evaluateTime(G){return l.parseTime(G)}static evaluateTimestamp(G,I,H){return l.parseTimestamp(G,I,H)}static evaluateDate(G,I){return l.parseDate(G,I)}static evaluateFunction(G,
I,H){return h.evaluateFunction(G,I,H)}static lookup(G,I){G=I[G];return void 0===G?null:G}static between(G,I,H){return null==G||null==I[0]||null==I[1]?null:c.sqlCompare(G,I[0],"\x3e\x3d")&&c.sqlCompare(G,I[1],"\x3c\x3d")}static notbetween(G,I,H){return null==G||null==I[0]||null==I[1]?null:c.sqlCompare(G,I[0],"\x3c")||c.sqlCompare(G,I[1],"\x3e")}static ternaryNot(G){return q(G)}static ternaryAnd(G,I){return t(G,I)}static ternaryOr(G,I){return v(G,I)}}class E{constructor(G,I,H="UTC"){this.fieldsIndex=
I;this.timeZone=H;this.parameters={};this._hasDateFunctions=void 0;this.parseTree=w.WhereGrammar.parse(G);const {isStandardized:B,isAggregate:K,referencedFieldNames:L}=this._extractExpressionInfo(I);this._referencedFieldNames=L;this.isStandardized=B;this.isAggregate=K}static convertValueToStorageFormat(G,I=null){if(null===I)return l.isDate(G)?G.getTime():l.isDateTime(G)?G.toMillis():l.isTimestampOffset(G)?G.toStorageFormat():l.isTimeOnly(G)?G.toStorageString():l.isDateOnly(G)?G.toStorageFormat():
G;switch(I){case "date":if(l.isDate(G))return G.getTime();if(l.isDateTime(G))return G.toMillis();if(l.isTimestampOffset(G))return G.toMilliseconds();if(l.isDateOnly(G))return G.toNumber();break;case "date-only":if(l.isDate(G))return m.DateOnly.fromDateJS(G).toString();if(l.isTimestampOffset(G))return m.DateOnly.fromSqlTimeStampOffset(G).toString();if(l.isDateTime(G))return m.DateOnly.fromDateTime(G).toString();break;case "time-only":if(l.isDate(G))return u.TimeOnly.fromDateJS(G).toStorageString();
if(l.isDateTime(G))return u.TimeOnly.fromDateTime(G).toStorageString();if(l.isTimestampOffset(G))return u.TimeOnly.fromSqlTimeStampOffset(G).toStorageString();if(l.isTimeOnly(G))return G.toStorageString();break;case "timestamp-offset":if(l.isDate(G))return p.SqlTimeStampOffset.fromJSDate(G).toStorageFormat();if(l.isDateTime(G))return p.SqlTimeStampOffset.fromDateTime(G).toStorageFormat();if(l.isTimestampOffset(G))return G.toStorageFormat()}return G}static create(G,I,H="UTC"){return new E(G,I,H)}get fieldNames(){return this._referencedFieldNames}testSet(G,
I=F){return!!this._evaluateNode(this.parseTree,null,I,G)}calculateValue(G,I=F){G=this._evaluateNode(this.parseTree,G,I,null);return G instanceof e.SqlInterval?G.valueInMilliseconds()/864E5:G}calculateValueCompiled(G,I=F){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(G,this.parameters,I,this.fieldsIndex,this.timeZone);if(d("esri-csp-restrictions"))return this.calculateValue(G,I);this._compileMe();return this.parseTree._compiledVersion(G,this.parameters,I,this.fieldsIndex,
this.timeZone)}testFeature(G,I=F){return!!this._evaluateNode(this.parseTree,G,I,null)}testFeatureCompiled(G,I=F){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(G,this.parameters,I,this.fieldsIndex,this.timeZone);if(d("esri-csp-restrictions"))return this.testFeature(G,I);this._compileMe();return!!this.parseTree._compiledVersion(G,this.parameters,I,this.fieldsIndex,this.timeZone)}get hasDateFunctions(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=
!1;this._visitAll(this.parseTree,G=>{"current-time"===G.type?this._hasDateFunctions=!0:"function"===G.type&&(this._hasDateFunctions=this._hasDateFunctions||D.has(G.name.toLowerCase()))});return this._hasDateFunctions}getFunctions(){const G=new Set;this._visitAll(this.parseTree,I=>{"function"===I.type&&G.add(I.name.toLowerCase())});return Array.from(G)}getExpressions(){const G=new Map;this._visitAll(this.parseTree,I=>{if("function"===I.type){const H=I.name.toLowerCase();I=I.args.value[0];if("column-reference"===
I.type){I=I.column;const B=`${H}-${I}`;G.has(B)||G.set(B,{aggregateType:H,field:I})}}});return[...G.values()]}getVariables(){const G=new Set;this._visitAll(this.parseTree,I=>{"parameter"===I.type&&G.add(I.value.toLowerCase())});return Array.from(G)}_compileMe(){const G="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone",G)).bind(C)}_extractExpressionInfo(G){const I=
[],H=new Set;let B=!0,K=!1;this._visitAll(this.parseTree,L=>{switch(L.type){case "column-reference":var J=G?.get(L.column);let M;J?J=M=J.name??"":(M=L.column,J=M.toLowerCase());H.has(J)||(H.add(J),I.push(M));L.column=M;break;case "function":const {name:T,args:Q}=L;L=Q.value.length;B&&(B=h.isStandardized(T,L));!1===K&&(K=k.isAggregate(T,L))}});return{referencedFieldNames:Array.from(I),isStandardized:B,isAggregate:K}}_visitAll(G,I){if(null!=G)switch(I(G),G.type){case "when-clause":this._visitAll(G.operand,
I);this._visitAll(G.value,I);break;case "case-expression":for(const H of G.clauses)this._visitAll(H,I);"simple"===G.format&&this._visitAll(G.operand,I);null!==G.else&&this._visitAll(G.else,I);break;case "expression-list":for(const H of G.value)this._visitAll(H,I);break;case "unary-expression":this._visitAll(G.expr,I);break;case "binary-expression":this._visitAll(G.left,I);this._visitAll(G.right,I);break;case "function":this._visitAll(G.args,I)}}evaluateNodeToJavaScript(G){switch(G.type){case "interval":return"this.makeSqlInterval("+
this.evaluateNodeToJavaScript(G.value)+", "+JSON.stringify(G.qualifier)+","+JSON.stringify(G.op)+")";case "case-expression":var I="";if("simple"===G.format){var H=this.evaluateNodeToJavaScript(G.operand);I="( ";for(let B=0;B<G.clauses.length;B++)I+=" (this.compare('\x3d',"+H+","+this.evaluateNodeToJavaScript(G.clauses[B].operand)+") ? ("+this.evaluateNodeToJavaScript(G.clauses[B].value)+") : "}else for(I="( ",H=0;H<G.clauses.length;H++)I+=" this.makeBool("+this.evaluateNodeToJavaScript(G.clauses[H].operand)+
")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(G.clauses[H].value)+") : ";I=null!==G.else?I+this.evaluateNodeToJavaScript(G.else):I+"null";return I+" )";case "parameter":return"this.lookup("+JSON.stringify(G.value.toLowerCase())+",lookups)";case "expression-list":I="[";for(H of G.value)"["!==I&&(I+=","),I+=this.evaluateNodeToJavaScript(H);return I+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(G.expr)+")";case "binary-expression":switch(G.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+" )";case "IS":if("null"!==G.right.type)throw new g.SqlError(g.SqlErrorCodes.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(G.left)+")";case "ISNOT":if("null"!==G.right.type)throw new g.SqlError(g.SqlErrorCodes.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(G.left)+
")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(G.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(G.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(G.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(G.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+", timeZone)";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(G.left)+
","+this.evaluateNodeToJavaScript(G.right)+", timeZone)";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+","+JSON.stringify(G.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+","+JSON.stringify(G.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(G.operator)+
","+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+", timeZone)";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(G.operator)+","+this.evaluateNodeToJavaScript(G.left)+","+this.evaluateNodeToJavaScript(G.right)+", timeZone)"}throw new g.SqlError(g.SqlErrorCodes.UnsupportedOperator,{operator:G.operator});case "null":case "boolean":case "string":case "number":return JSON.stringify(G.value);case "time":return"this.evaluateTime(JSON.stringify(node.value))";
case "date":return"this.evaluateDate(JSON.stringify(node.value), 'unknown')";case "timestamp":return"this.evaluateTimestamp(JSON.stringify(node.value), 'unknown')";case "current-time":return"date"===G.mode?"this.currentDate(timeZone)":"this.currentTimestamp(timeZone)";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(G.column)+",fieldsIndex,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(G.name)+","+this.evaluateNodeToJavaScript(G.args)+", timeZone)"}throw new g.SqlError(g.SqlErrorCodes.UnsupportedSyntax,
{node:G.type});}_evaluateNode(G,I,H,B){switch(G.type){case "interval":return H=this._evaluateNode(G.value,I,H,B),e.SqlInterval.createFromValueAndQualifer(H,G.qualifier,G.op);case "case-expression":if("simple"===G.format){var K=this._evaluateNode(G.operand,I,H,B);for(var L=0;L<G.clauses.length;L++)if(c.sqlCompare(K,this._evaluateNode(G.clauses[L].operand,I,H,B),"\x3d",this.timeZone))return this._evaluateNode(G.clauses[L].value,I,H,B)}else for(K=0;K<G.clauses.length;K++)if(!0===this._evaluateNode(G.clauses[K].operand,
I,H,B))return this._evaluateNode(G.clauses[K].value,I,H,B);return null!==G.else?this._evaluateNode(G.else,I,H,B):null;case "parameter":return G=this.parameters[G.value.toLowerCase()],l.isDate(G)?x.DateTime.fromJSDate(G):G instanceof b.ArcadeDate?G.toDateTime():G;case "expression-list":K=[];for(var J of G.value)K.push(this._evaluateNode(J,I,H,B));return K;case "unary-expression":return q(this._evaluateNode(G.expr,I,H,B));case "binary-expression":switch(G.operator){case "AND":return t(this._evaluateNode(G.left,
I,H,B),this._evaluateNode(G.right,I,H,B));case "OR":return v(this._evaluateNode(G.left,I,H,B),this._evaluateNode(G.right,I,H,B));case "IS":if("null"!==G.right.type)throw new g.SqlError(g.SqlErrorCodes.UnsupportedIsRhs);return null===this._evaluateNode(G.left,I,H,B);case "ISNOT":if("null"!==G.right.type)throw new g.SqlError(g.SqlErrorCodes.UnsupportedIsRhs);return null!==this._evaluateNode(G.left,I,H,B);case "IN":return K=n(this._evaluateNode(G.right,I,H,B)),r(this._evaluateNode(G.left,I,H,B),K);case "NOT IN":return K=
n(this._evaluateNode(G.right,I,H,B)),q(r(this._evaluateNode(G.left,I,H,B),K));case "BETWEEN":return K=this._evaluateNode(G.left,I,H,B),G=this._evaluateNode(G.right,I,H,B),null==K||null==G[0]||null==G[1]?null:c.sqlCompare(K,G[0],"\x3e\x3d",this.timeZone)&&c.sqlCompare(K,G[1],"\x3c\x3d",this.timeZone);case "NOTBETWEEN":return K=this._evaluateNode(G.left,I,H,B),G=this._evaluateNode(G.right,I,H,B),null==K||null==G[0]||null==G[1]?null:c.sqlCompare(K,G[0],"\x3c",this.timeZone)||c.sqlCompare(K,G[1],"\x3e",
this.timeZone);case "LIKE":return y(this._evaluateNode(G.left,I,H,B),this._evaluateNode(G.right,I,H,B),G.escape);case "NOT LIKE":return q(y(this._evaluateNode(G.left,I,H,B),this._evaluateNode(G.right,I,H,B),G.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return c.sqlCompare(this._evaluateNode(G.left,I,H,B),this._evaluateNode(G.right,I,H,B),G.operator,this.timeZone);case "-":case "+":case "*":case "/":case "||":return f.sqlCalculateFunction(G.operator,
this._evaluateNode(G.left,I,H,B),this._evaluateNode(G.right,I,H,B),this.timeZone)}case "null":case "boolean":case "string":case "number":return G.value;case "date":return G.parsedValue??(G.parsedValue=l.parseDate(G.value,"unknown")),G.parsedValue;case "timestamp":return G.parsedValue??(G.parsedValue=l.parseTimestamp(G.value,"unknown")),G.parsedValue;case "time":return l.parseTime(G.value);case "current-time":return"date"===G.mode?m.DateOnly.fromNow(this.timeZone):l.convertToExecutingTimeZone(new Date,
this.timeZone);case "column-reference":return z(I,G.column,this.fieldsIndex,H);case "data-type":return G.value;case "function":if(this.isAggregate&&k.isAggregate(G.name,G.args.value.length)){I=[];for(K of G.args?.value||[]){J=[];for(L of B||[])J.push(this._evaluateNode(K,L,H,null));I.push(J)}return k.aggregateFunction(G.name,I)}H=this._evaluateNode(G.args,I,H,B);return h.evaluateFunction(G.name,H,this.timeZone)}throw new g.SqlError(g.SqlErrorCodes.UnsupportedSyntax,{node:G.type});}}var A;(function(G){G[G.Normal=
0]="Normal";G[G.Escaped=1]="Escaped"})(A||(A={}));const F={getAttribute(G,I){return(G&&"object"===typeof G.attributes?G.attributes:G)[I]}};a.WhereClause=E;a.defaultAttributeAdapter=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(a,b,g,d){function k(e,p,h){return e<p?e-p:e>h?e-h:0}function m(e,p=!0){if(e instanceof d.Zone)return e;if("system"===e.toLowerCase())return"system";
if("utc"===e.toLowerCase())return"UTC";if("unknown"===e.toLowerCase())return g.UnknownTimeZone.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const h=d.FixedOffsetZone.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(h)return h}e=d.IANAZone.create(e);if(!e.isValid){if(p)throw new c(a.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return e}a.ArcadeDateErrorCodes=void 0;(a.ArcadeDateErrorCodes||(a.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";
const f={[a.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class c extends Error{constructor(e,p){super(b.replace(f[e],p));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,c)}}class l{constructor(e){this._date=e;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,p=1,h=1,u=0,w=0,x=0,n=0,q){if(isNaN(e)||isNaN(p)||isNaN(h)||isNaN(u)||isNaN(w)||isNaN(x)||isNaN(n))return null;const t=
d.DateTime.local(e,p).daysInMonth;e=d.DateTime.fromObject({day:1>h?1:h>t?t:h,year:e,month:1>p?1:12<p?12:p,hour:0>u?0:23<u?23:u,minute:0>w?0:59<w?59:w,second:0>x?0:59<x?59:x,millisecond:0>n?0:999<n?999:n},{zone:m(q)});e=e.plus({months:k(p,1,12),days:k(h,1,t),hours:k(u,0,23),minutes:k(w,0,59),seconds:k(x,0,59),milliseconds:k(n,0,999)});return new l(e)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,p){p=
m(p);return e.isUnknownTimeZone||p===g.UnknownTimeZone.instance?l.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,p):new l(e._date.setZone(p))}static dateJSToArcadeDate(e){return new l(d.DateTime.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,p="system"){p=m(p);return new l(d.DateTime.fromJSDate(e,{zone:p}))}static unknownEpochToArcadeDate(e){return new l(d.DateTime.fromMillis(e,{zone:g.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(e){return new l(d.DateTime.fromMillis(e.getTime(),
{zone:g.UnknownTimeZone.instance}))}static epochToArcadeDate(e,p="system"){p=m(p);return new l(d.DateTime.fromMillis(e,{zone:p}))}static dateTimeToArcadeDate(e){return new l(e)}clone(){return new l(this._date)}changeTimeZone(e){e=m(e);return l.dateTimeToArcadeDate(this._date.setZone(e))}static dateTimeAndZoneToArcadeDate(e,p){p=m(p);return e.zone===g.UnknownTimeZone.instance||p===g.UnknownTimeZone.instance?l.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,p):new l(e.setZone(p))}static nowToArcadeDate(e){e=
m(e);return new l(d.DateTime.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new l(d.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===l.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone!==e.isUnknownTimeZone?!1:this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===g.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=
this._date.weekday;6<e&&(e=0);return e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const e=this.zone;return"fixed"===e.type?0===e.fixed?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new l(this._date.plus(e))}diff(e,p="milliseconds"){return this._date.diff(e._date,p)[p]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,p){return this._date.toISOTime({suppressMilliseconds:e,
includeOffset:p&&!this.isUnknownTimeZone})}toFormat(e,p){this.isUnknownTimeZone&&(e=e.replaceAll("Z",""));return this._date.toFormat(e,p)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new l(this._date.toUTC())}toLocal(){return new l(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;
e=d.DateTime.fromISO(e,{setZone:!0});return new l(e)}}a.ArcadeDate=l;a.ArcadeDateError=c;a.ArcadeDateErrorMessages=f;a.createDateTimeZone=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports","../../../core/string"],function(a,b){a.SqlErrorCodes=void 0;(function(f){f.InvalidFunctionParameters="InvalidFunctionParameters";f.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction";f.UnsupportedSqlFunction=
"UnsupportedSqlFunction";f.UnsupportedOperator="UnsupportedOperator";f.UnsupportedSyntax="UnsupportedSyntax";f.UnsupportedIsRhs="UnsupportedIsRhs";f.UnsupportedIsLhs="UnsupportedIsLhs";f.InvalidDataType="InvalidDataType";f.CannotCastValue="CannotCastValue";f.FunctionNotRecognized="FunctionNotRecognized";f.InvalidTime="InvalidTime";f.InvalidParameterCount="InvalidParameterCount";f.InvalidTimeStamp="InvalidTimeStamp";f.InvalidDate="InvalidDate";f.InvalidOperator="InvalidOperator";f.IllegalInterval=
"IllegalInterval";f.YearMonthIntervals="YearMonthIntervals";f.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers";f.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||(a.SqlErrorCodes={}));const g={[a.SqlErrorCodes.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",
[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",[a.SqlErrorCodes.InvalidDate]:"Invalid date encountered",[a.SqlErrorCodes.InvalidOperator]:"Invalid operator encountered",[a.SqlErrorCodes.InvalidTime]:"Invalid time encountered",
[a.SqlErrorCodes.IllegalInterval]:"Illegal interval",[a.SqlErrorCodes.FunctionNotRecognized]:"Function not recognized",[a.SqlErrorCodes.InvalidTimeStamp]:"Invalid timestamp encountered",[a.SqlErrorCodes.InvalidParameterCount]:"Invalid parameter count for call to {name}",[a.SqlErrorCodes.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[a.SqlErrorCodes.YearMonthIntervals]:"Year-Month Intervals not supported",[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};
class d extends Error{constructor(f,c){super(b.replace(g[f],c));this.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(this,d)}}a.FeatureSetErrorCodes=void 0;(function(f){f.NeverReach="NeverReach";f.NotImplemented="NotImplemented";f.Cancelled="Cancelled";f.InvalidStatResponse="InvalidStatResponse";f.InvalidRequest="InvalidRequest";f.RequestFailed="RequestFailed";f.MissingFeatures="MissingFeatures";f.AggregationFieldNotFound="AggregationFieldNotFound";
f.DataElementsNotFound="DataElementsNotFound"})(a.FeatureSetErrorCodes||(a.FeatureSetErrorCodes={}));const k={[a.FeatureSetErrorCodes.Cancelled]:"Cancelled",[a.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",[a.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[a.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",[a.FeatureSetErrorCodes.MissingFeatures]:"Missing features",[a.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",
[a.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[a.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[a.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};class m extends Error{constructor(f,c){super(b.replace(k[f],c));this.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&Error.captureStackTrace(this,m)}}a.FeatureSetError=m;a.FeatureSetErrorMessages=k;a.SqlError=d;a.SqlErrorMessages=g;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlTimestampOffset ./TimeOnly ../../chunks/datetime".split(" "),function(a,b,g,d,k,m){function f(p){if(null===p)return null;let h=0,u=0;for(let w=0;w<p.length;w++){const x=p[w];if(null!==x){if("number"!==typeof x)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);u++;h+=x}}return 0===u?null:h/p.length}function c(p,h){if(null===
p)return null;let u=null,w=null;for(const x of p)p=x,p=x instanceof g.DateOnly?x.toNumber():x instanceof k.TimeOnly?x.toNumber():x instanceof m.DateTime?x.toMillis():x instanceof d.SqlTimeStampOffset?x.toMilliseconds():x,null===u?(u=x,w=p):"max"===h&&null!==w&&null!==p&&w<=p?(u=x,w=p):"min"===h&&null!==w&&null!==p&&w>=p&&(u=x,w=p);return u}function l(p){if(null===p)return null;p=p.filter(w=>null!==w);if(0===p.length)return null;const h=f(p);if(null===h)return null;let u=0;for(const w of p){if("number"!==
typeof w)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);u+=(h-w)**2}return u/(p.length-1)}const e={min:{minParams:1,maxParams:1,evaluate:p=>c(p[0],"min")},max:{minParams:1,maxParams:1,evaluate:p=>c(p[0],"max")},avg:{minParams:1,maxParams:1,evaluate:p=>f(p[0])},sum:{minParams:1,maxParams:1,evaluate:p=>{p=p[0];if(null===p)p=null;else{var h=0;for(let u=0;u<p.length;u++){const w=p[u];if(null!==w){if("number"!==typeof w)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);
h+=w}}p=h}return p}},stddev:{minParams:1,maxParams:1,evaluate:p=>{p=p[0];null===p?p=null:(p=l(p),p=null===p?null:Math.sqrt(p));return p}},count:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:p[0].length},var:{minParams:1,maxParams:1,evaluate:p=>l(p[0])}};a.aggregateFunction=function(p,h){const u=e[p.toLowerCase()];if(null==u)throw new b.SqlError(b.SqlErrorCodes.FunctionNotRecognized);if(h.length<u.minParams||h.length>u.maxParams)throw new b.SqlError(b.SqlErrorCodes.InvalidParameterCount,{name:p.toUpperCase()});
return u.evaluate(h)};a.isAggregate=function(p,h){p=e[p.toLowerCase()];return null!=p&&h>=p.minParams&&h<=p.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(a,b,g,d){function k(f){f=f.replaceAll(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let c="";const l=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const e of f.match(l)||[])switch(e){case "D":c+="d";break;case "DD":c+="dd";break;case "DDD":c+="o";break;case "d":c+="c";break;case "ddd":c+="ccc";break;case "dddd":c+="cccc";break;case "M":c+="L";break;case "MM":c+="LL";break;case "MMM":c+="LLL";break;case "MMMM":c+="LLLL";break;case "YY":c+="yy";break;case "Y":case "YYYY":c+="yyyy";break;case "Q":c+="q";break;case "X":case "x":c+=e;break;default:c=2<=e.length&&"["===e.slice(0,1)&&"]"===e.slice(-1)?c+`'${e.slice(1,-1)}'`:c+`'${e}'`}return c}
class m{constructor(f,c,l){this._year=f;this._month=c;this._day=l;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(f){return f instanceof m&&f.day===this.day&&f.month===this.month&&f.year===this.year}clone(){return new m(this._year,this._month,this._day)}toDateTime(f){return d.DateTime.fromObject({day:this.day,month:this.month,
year:this.year},{zone:b.createDateTimeZone(f)})}toDateTimeLuxon(f){return d.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:b.createDateTimeZone(f)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(f=null){if(null===f||""===f)return this.toString();f=k(f);if(!f)return"";const c=this.toDateTime("unknown");return b.ArcadeDate.dateTimeToArcadeDate(c).toFormat(f,{locale:g.getLocale(),
numberingSystem:"latn"})}toArcadeDate(){const f=this.toDateTime("unknown");return b.ArcadeDate.dateTimeToArcadeDate(f)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd")}toSQLValue(){return this.toFormat("yyyy-LL-dd")}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd")+"'"}plus(f,c){return m.fromDateTime(this.toUTCDateTime().plus({[f]:c}))}toUTCDateTime(){return d.DateTime.utc(this.year,
this.month,this.day,0,0,0,0)}difference(f,c){switch(c.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(f.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(f.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===c?this.toUTCDateTime().diff(f.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(f.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(f.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(f.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(f.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(f.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(f.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(f){f=d.DateTime.fromMillis(f,{zone:d.FixedOffsetZone.utcInstance});
return f.isValid?m.fromParts(f.year,f.month,f.day):null}static fromSeconds(f){f=d.DateTime.fromSeconds(f,{zone:d.FixedOffsetZone.utcInstance});return f.isValid?m.fromParts(f.year,f.month,f.day):null}static fromReader(f){if(!f)return null;f=f.split("-");return 3!==f.length?null:new m(parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10))}static fromParts(f,c,l){f=new m(f,c,l);return!1===f.isValid?null:f}static fromDateJS(f){return m.fromParts(f.getFullYear(),f.getMonth()+1,f.getDay())}static fromDateTime(f){return m.fromParts(f.year,
f.month,f.day)}static fromSqlTimeStampOffset(f){return this.fromDateTime(f.toDateTime())}static fromString(f,c=null){if(""===f||null===f)return null;var l=[];if(c)(c=k(c))&&l.push(c);else if(null===c||""===c)return f=d.DateTime.fromISO(f,{setZone:!0}),f.isValid?m.fromParts(f.year,f.month,f.day):null;for(const e of l)if(l=d.DateTime.fromFormat(f,c??e),l.isValid)return new m(l.year,l.month,l.day);return null}static fromNow(f="system"){f=d.DateTime.fromJSDate(new Date).setZone(b.createDateTimeZone(f));
return new m(f.year,f.month,f.day)}}a.DateOnly=m;a.standardiseDateOnlyFormat=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlTimestampOffset":function(){define(["exports","../../chunks/datetime"],function(a,b){function g(k){return Number.isNaN(k)||0===k?k:Math.trunc(k)}class d{constructor(k){this._timeStampOffset=k;this._date=null}toDateTime(){this._date??(this._date=b.DateTime.fromISO(this._timeStampOffset,{setZone:!0}));return this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return g(this.toDateTime().offset/
60)}get timezoneOffsetMinutes(){return g(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return d.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(k){return new d(b.DateTime.fromJSDate(k).toISO({includeOffset:!0}))}static fromDateTime(k){return new d(k.toISO({includeOffset:!0}))}static fromParts(k,
m,f=0,c=0,l=0,e=0,p=0,h=!1,u=0,w=0){k=`${k.toString().padStart(4,"0")}-${m.toString().padStart(2,"0")}-${f.toString().padStart(2,"0")}`;m="";10>e&&(m="0");c=`${c.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${m+e.toString()}`;0!==p&&(c+="."+p.toString().padStart(3,"0"));p=`${h?"-":"+"}${u.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`;return new d(k+"T"+c+p)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let k=this.toDateTime().toSQL({includeOffset:!0,
includeOffsetSpace:!0});k&&(k=k.replace(".000",""));return k}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(k){k=this.toDateTime().plus(k);return d.fromDateTime(k)}}a.SqlTimeStampOffset=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(a,b,g,d){function k(f){if(!f)return"";const c=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let l="";for(const e of f.match(c)||
[])switch(e){case "SSS":l+=e;break;case "A":case "a":l+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":l+=e;break;default:l+=`'${e}'`}return l}class m{constructor(f,c,l,e){this._hour=f;this._minute=c;this._second=l;this._millisecond=e;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(f){return f instanceof m&&f.hour===
this.hour&&f.minute===this.minute&&f.second===this.second&&f.millisecond===this.millisecond}clone(){return new m(this.hour,this.minute,this.second,this.millisecond)}isValid(){return b.isInteger(this.hour)&&b.isInteger(this.minute)&&b.isInteger(this.second)&&b.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,
"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}`}toFormat(f=null){return null===f||""===f?this.toString():(f=k(f))?d.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(f,{locale:g.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(f,c,l,e){f=new m(f,c,l,e);return f.isValid()?f:null}static fromReader(f){if(!f)return null;f=f.split(":");return 3!==f.length?null:new m(parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],
10),0)}static fromMilliseconds(f){return 864E5<f||0>f?null:new m(Math.floor(f/36E5%24),Math.floor(f/6E4%60),Math.floor(f/1E3%60),Math.floor(f%1E3))}static fromDateJS(f){return new m(f.getHours(),f.getMinutes(),f.getSeconds(),f.getMilliseconds())}static fromDateTime(f){return new m(f.hour,f.minute,f.second,f.millisecond)}static fromSqlTimeStampOffset(f){return this.fromDateTime(f.toDateTime())}static fromString(f,c=null){if(""===f||null===f)return null;const l=[];if(c)(c=k(c))&&l.push(c);else if(null===
c||""===c)l.push("HH:mm:ss"),l.push("HH:mm:ss.SSS"),l.push("hh:mm:ss a"),l.push("hh:mm:ss.SSS a"),l.push("HH:mm"),l.push("hh:mm a"),l.push("H:mm"),l.push("h:mm a"),l.push("H:mm:ss"),l.push("h:mm:ss a"),l.push("H:mm:ss.SSS"),l.push("h:mm:ss.SSS a");for(const e of l)if(c=d.DateTime.fromFormat(f,e),c.isValid)return new m(c.hour,c.minute,c.second,c.millisecond);return null}plus(f,c){switch(f){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return m.fromDateTime(this.toUTCDateTime().plus({[f]:c}))}return null}toUTCDateTime(){return d.DateTime.utc(1970,
1,1,this.hour,this.minute,this.second,this.millisecond)}difference(f,c){switch(c.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(f.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(f.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===c?this.toUTCDateTime().diff(f.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(f.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(f.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(f.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(f.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(f.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(f.toUTCDateTime(),"milliseconds").milliseconds}}}a.TimeOnly=m;a.standardiseTimeFormat=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(a,b){a.cloneGeometry=function(g){if(null==g)return null;const d=g.clone();void 0!==g.cache._geVersion&&(d.cache._geVersion=g.cache._geVersion);return d};a.convertLinearUnitsToCode=function(g){if(null==g)return null;if("number"===typeof g)return g;g=g.toLowerCase();g=g.replaceAll(/\s/g,"");g=g.replaceAll("-","");switch(g){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};a.convertSquareUnitsToCode=
function(g){if(null==g)return null;if("number"===typeof g)return g;g=g.toLowerCase();g=g.replaceAll(/\s/g,"");g=g.replaceAll("-","");switch(g){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};a.isInteger=function(g){return"number"===typeof g&&isFinite(g)&&Math.floor(g)===g};a.sameGeomType=function(g,d){return g===d||"point"===g&&"esriGeometryPoint"===d||"polyline"===g&&"esriGeometryPolyline"===
d||"polygon"===g&&"esriGeometryPolygon"===d||"extent"===g&&"esriGeometryEnvelope"===d||"multipoint"===g&&"esriGeometryMultipoint"===d||"point"===d&&"esriGeometryPoint"===g||"polyline"===d&&"esriGeometryPolyline"===g||"polygon"===d&&"esriGeometryPolygon"===g||"extent"===d&&"esriGeometryEnvelope"===g||"multipoint"===d&&"esriGeometryMultipoint"===g?!0:!1};a.shapeExtent=function(g){if(null==g)return null;switch(g.type){case "polygon":case "multipoint":case "polyline":return g.extent;case "point":return new b({xmin:g.x,
ymin:g.y,xmax:g.x,ymax:g.y,spatialReference:g.spatialReference});case "extent":return g}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlArithmeticUtils":function(){define(["exports","../../arcade/featureset/support/errorsupport","./sqlDateParsingUtils","./SqlInterval","./StandardizedFunctions"],function(a,b,g,d,k){function m(fa,aa,da){switch(da){case "+":return fa+aa;case "-":return fa-aa;case "*":return fa*aa;case "/":return fa/aa}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function f(fa,aa,da){switch(da){case "+":return aa.plus({milliseconds:fa.valueInMilliseconds()});case "-":return fa.valueInMilliseconds()-aa.toMillis()}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function c(fa,aa,da){switch(da){case "+":return aa.plus("milliseconds",fa.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function l(fa,aa,da){switch(da){case "+":return aa.plus("milliseconds",fa.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function e(fa,aa,da){switch(da){case "+":return fa.plus("milliseconds",aa.valueInMilliseconds());case "-":return fa.plus("milliseconds",-1*aa.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function p(fa,aa,da){switch(da){case "+":return aa.addMilliseconds(fa.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function h(fa,aa,da){switch(da){case "+":return d.SqlInterval.createFromMilliseconds(fa.valueInMilliseconds()+aa.valueInMilliseconds());
case "-":return d.SqlInterval.createFromMilliseconds(fa.valueInMilliseconds()-aa.valueInMilliseconds());case "*":return d.SqlInterval.createFromMilliseconds(fa.valueInMilliseconds()*aa.valueInMilliseconds());case "/":return d.SqlInterval.createFromMilliseconds(fa.valueInMilliseconds()/aa.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function u(fa,aa,da){switch(da){case "+":return d.SqlInterval.createFromMilliseconds(fa.valueInMilliseconds()+aa);case "-":return d.SqlInterval.createFromMilliseconds(fa.valueInMilliseconds()-
aa);case "*":return d.SqlInterval.createFromMilliseconds(fa.valueInMilliseconds()*aa);case "/":return d.SqlInterval.createFromMilliseconds(fa.valueInMilliseconds()/aa)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function w(fa,aa,da){switch(da){case "+":return d.SqlInterval.createFromMilliseconds(fa+aa.valueInMilliseconds());case "-":return d.SqlInterval.createFromMilliseconds(fa-aa.valueInMilliseconds());case "*":return d.SqlInterval.createFromMilliseconds(fa*aa.valueInMilliseconds());
case "/":return d.SqlInterval.createFromMilliseconds(fa/aa.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function x(fa,aa,da){switch(da){case "+":return fa.plus("milliseconds",aa.valueInMilliseconds());case "-":return fa.plus("milliseconds",-1*aa.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function n(fa,aa,da){switch(da){case "+":return fa.plus({milliseconds:aa.valueInMilliseconds()});case "-":return fa.minus({milliseconds:aa.valueInMilliseconds()})}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function q(fa,aa,da){switch(da){case "+":return fa.addMilliseconds(aa.valueInMilliseconds());case "-":return fa.addMilliseconds(-1*aa.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function t(fa,aa,da){aa*=864E5;switch(da){case "+":return fa.plus({milliseconds:aa});case "-":return fa.minus({milliseconds:aa})}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function v(fa,aa,da){aa*=864E5;switch(da){case "+":return fa.plus("milliseconds",aa);case "-":return fa.plus("milliseconds",
-1*aa)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function r(fa,aa,da){aa*=864E5;switch(da){case "+":return fa.plus("milliseconds",aa);case "-":return fa.plus("milliseconds",-1*aa)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function y(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function z(fa,aa,da){aa*=864E5;switch(da){case "+":return fa.addMilliseconds(aa);case "-":return fa.addMilliseconds(-1*aa)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function D(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function C(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function E(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function A(fa,aa,da){aa=parseFloat(aa);if(isNaN(aa))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);return m(fa,aa,da)}function F(fa,aa,da){fa=parseFloat(fa);if(isNaN(fa))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);return m(fa,aa,da)}function G(fa,aa,da){switch(da){case "+":return fa+
aa}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function I(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function H(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function B(fa,aa,da){switch(da){case "-":return fa.toDateTimeLuxon(aa.zone).diff(aa).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function K(fa,aa,da){switch(da){case "-":return fa.toDateTimeLuxon(aa.toDateTime().zone).diff(aa.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function L(fa,aa,da){switch(da){case "-":return fa.toDateTimeLuxon("UTC").diff(aa.toDateTimeLuxon("UTC")).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function J(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function M(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function T(fa,aa,da){switch(da){case "-":return fa.toDateTime().diff(aa.toDateTimeLuxon(fa.toDateTime().zone)).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function Q(fa,aa,da){switch(da){case "-":return fa.toDateTime().diff(aa).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function O(fa,aa,da){switch(da){case "-":return fa.toDateTime().diff(aa.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function U(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function Z(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function P(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function R(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function W(fa,aa,da){switch(da){case "-":return fa.diff(aa).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function N(fa,aa,da){switch(da){case "-":return fa.diff(aa.toDateTimeLuxon(fa.zone)).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function V(fa,aa,da){switch(da){case "-":return fa.diff(aa.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function S(fa,
aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function X(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ca(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ba(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ia(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ka(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function na(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function Y(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ea(fa,aa,da){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}a.calculateDateOnlyAndDateOnly=L;a.calculateDateOnlyAndDateTime=B;a.calculateDateOnlyAndNumber=v;a.calculateDateOnlyAndSqlInterval=x;a.calculateDateOnlyAndString=X;a.calculateDateOnlyAndTimeOnly=J;a.calculateDateOnlyAndTimestamp=K;a.calculateDateTimeAndDateOnly=N;a.calculateDateTimeAndDateTime=W;a.calculateDateTimeAndNumber=t;a.calculateDateTimeAndSqlInterval=
n;a.calculateDateTimeAndString=ba;a.calculateDateTimeAndTimeOnly=S;a.calculateDateTimeAndTimestamp=V;a.calculateNumberAndDateOnly=E;a.calculateNumberAndDateTime=y;a.calculateNumberAndNumber=m;a.calculateNumberAndSqlInterval=w;a.calculateNumberAndString=A;a.calculateNumberAndTimeOnly=C;a.calculateNumberAndTimestamp=D;a.calculateSqlIntervalAndDateOnly=l;a.calculateSqlIntervalAndDateTime=f;a.calculateSqlIntervalAndNumber=u;a.calculateSqlIntervalAndSqlInterval=h;a.calculateSqlIntervalAndString=I;a.calculateSqlIntervalAndTimeOnly=
c;a.calculateSqlIntervalAndTimestamp=p;a.calculateStringAndDateOnly=na;a.calculateStringAndDateTime=Y;a.calculateStringAndNumber=F;a.calculateStringAndSqlInterval=H;a.calculateStringAndString=G;a.calculateStringAndTimeOnly=ka;a.calculateStringAndTimestamp=ea;a.calculateTimeOnlyAndDateOnly=Z;a.calculateTimeOnlyAndDateTime=U;a.calculateTimeOnlyAndNumber=r;a.calculateTimeOnlyAndSqlInterval=e;a.calculateTimeOnlyAndString=ca;a.calculateTimeOnlyAndTimeOnly=R;a.calculateTimeOnlyAndTimestamp=P;a.calculateTimestampAndDateOnly=
T;a.calculateTimestampAndDateTime=Q;a.calculateTimestampAndNumber=z;a.calculateTimestampAndSqlInterval=q;a.calculateTimestampAndString=ia;a.calculateTimestampAndTimeOnly=M;a.calculateTimestampAndTimestamp=O;a.sqlCalculateFunction=function(fa,aa,da,ma){if("||"===fa)return k.evaluateFunction("concat",[aa,da],ma);if(null===aa||null===da)return null;if(g.isNumber(aa)){if(g.isNumber(da))return m(aa,da,fa);if(g.isSqlInterval(da))return w(aa,da,fa);if(g.isTimeOnly(da))return C();if(g.isDateOnly(da))return E();
if(g.isTimestampOffset(da))return D();if(g.isDateTime(da))return y();if(g.isString(da))return A(aa,da,fa)}else if(g.isDateOnly(aa)){if(g.isNumber(da))return v(aa,da,fa);if(g.isSqlInterval(da))return x(aa,da,fa);if(g.isTimeOnly(da))return J();if(g.isDateOnly(da))return L(aa,da,fa);if(g.isTimestampOffset(da))return K(aa,da,fa);if(g.isDateTime(da))return B(aa,da,fa);if(g.isString(da))return X()}else if(g.isTimeOnly(aa)){if(g.isNumber(da))return r(aa,da,fa);if(g.isSqlInterval(da))return e(aa,da,fa);if(g.isTimeOnly(da))return R();
if(g.isDateOnly(da))return Z();if(g.isTimestampOffset(da))return P();if(g.isDateTime(da))return U();if(g.isString(da))return ca()}else if(g.isSqlInterval(aa)){if(g.isNumber(da))return u(aa,da,fa);if(g.isSqlInterval(da))return h(aa,da,fa);if(g.isTimeOnly(da))return c(aa,da,fa);if(g.isDateOnly(da))return l(aa,da,fa);if(g.isTimestampOffset(da))return p(aa,da,fa);if(g.isDateTime(da))return f(aa,da,fa);if(g.isString(da))return I()}else if(g.isDateTime(aa)){if(g.isNumber(da))return t(aa,da,fa);if(g.isSqlInterval(da))return n(aa,
da,fa);if(g.isTimeOnly(da))return S();if(g.isDateOnly(da))return N(aa,da,fa);if(g.isTimestampOffset(da))return V(aa,da,fa);if(g.isDateTime(da))return W(aa,da,fa);if(g.isString(da))return ba()}else if(g.isTimestampOffset(aa)){if(g.isNumber(da))return z(aa,da,fa);if(g.isSqlInterval(da))return q(aa,da,fa);if(g.isTimeOnly(da))return M();if(g.isDateOnly(da))return T(aa,da,fa);if(g.isTimestampOffset(da))return O(aa,da,fa);if(g.isDateTime(da))return Q(aa,da,fa);if(g.isString(da))return ia()}else if(g.isString(aa)){if(g.isNumber(da))return F(aa,
da,fa);if(g.isSqlInterval(da))return H();if(g.isTimeOnly(da))return ka();if(g.isDateOnly(da))return na();if(g.isTimestampOffset(da))return ea();if(g.isDateTime(da))return Y();if(g.isString(da))return G(aa,da,fa)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlDateParsingUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlInterval ./SqlTimestampOffset ./TimeOnly ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,b,g,d,k,m,f,c){function l(t,v,r){r=w.exec(t);if(null!==r){const [,y,z,D,C,E,A,F]=r;t=c.DateTime.fromObject({year:parseInt(y,10),month:parseInt(z,10),day:parseInt(D,10),hour:parseInt(C,10),minute:parseInt(E,10),second:parseInt(A,10),millisecond:F?parseInt(F.replace(".",""),10):0},{zone:f.substituteUnknownTimezone(v)});if(!1===t.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return t}r=x.exec(t);if(null!==r){const [,y,z,D,C,E,A,F,G,I,H]=r;t=k.SqlTimeStampOffset.fromParts(parseInt(y,
10),parseInt(z,10),parseInt(D,10),parseInt(C,10),parseInt(E,10),parseInt(A,10),F?parseInt(F.replace(".",""),10):0,"-"===G,parseInt(I,10),parseInt(H,10));if(!1===t.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return t}r=n.exec(t);if(null!==r){const [,y,z,D,C,E,A,F,G]=r;t=k.SqlTimeStampOffset.fromParts(parseInt(y,10),parseInt(z,10),parseInt(D,10),parseInt(C,10),parseInt(E,10),0,0,"-"===A,parseInt(F,10),parseInt(G,10));if(!1===t.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);
return t}r=q.exec(t);if(null!==r){const [,y,z,D,C,E]=r;t=c.DateTime.fromObject({year:parseInt(y,10),month:parseInt(z,10),day:parseInt(D,10),hour:parseInt(C,10),minute:parseInt(E,10),second:0},{zone:f.substituteUnknownTimezone(v)});if(!1===t.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return t}r=u.exec(t);if(null!==r){const [,y,z,D]=r;t=c.DateTime.fromObject({year:parseInt(y,10),month:parseInt(z,10),day:parseInt(D,10),hour:0,minute:0,second:0},{zone:f.substituteUnknownTimezone(v)});
if(!1===t.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return t}throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);}const e=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,p=/^(\d{1,2}):(\d{1,2})$/,h=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,u=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,n=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,
q=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;a.convertToExecutingTimeZone=function(t,v){if(v instanceof c.Zone)return v===f.UnknownTimeZone.instance?c.DateTime.fromMillis(t.getTime(),{zone:f.UnknownTimeZone.instance}):c.DateTime.fromJSDate(t,{zone:v});switch(v){case "system":case "local":case null:return c.DateTime.fromJSDate(t);default:return"unknown"===v?.toLowerCase()?c.DateTime.fromMillis(t.getTime(),{zone:f.UnknownTimeZone.instance}):c.DateTime.fromJSDate(t,{zone:v})}};a.isDate=function(t){return t instanceof
Date};a.isDateOnly=function(t){return t instanceof g.DateOnly};a.isDateTime=function(t){return t instanceof c.DateTime};a.isNumber=function(t){return"number"===typeof t};a.isSqlInterval=function(t){return t instanceof d.SqlInterval};a.isString=function(t){return"string"===typeof t||t instanceof String};a.isTimeOnly=function(t){return t instanceof m.TimeOnly};a.isTimestampOffset=function(t){return t instanceof k.SqlTimeStampOffset};a.parseDate=function(t,v){const r=u.exec(t);if(null===r)try{return l(t,
v)}catch{throw new b.SqlError(b.SqlErrorCodes.InvalidDate);}const [,y,z,D]=r;t=g.DateOnly.fromParts(parseInt(y,10),parseInt(z,10),parseInt(D,10));if(null===t)throw new b.SqlError(b.SqlErrorCodes.InvalidDate);return t};a.parseTime=function(t){let v=e.exec(t);if(null!==v){const [,r,y,z]=v;t=m.TimeOnly.fromParts(parseInt(r,10),parseInt(y,10),parseInt(z,10),0);if(null!==t)return t;throw new b.SqlError(b.SqlErrorCodes.InvalidTime);}v=p.exec(t);if(null!==v){const [,r,y]=v;t=m.TimeOnly.fromParts(parseInt(r,
10),parseInt(y,10),0,0);if(null!==t)return t;throw new b.SqlError(b.SqlErrorCodes.InvalidTime);}v=h.exec(t);if(null!==v){const [,r,y,z,D]=v;t=m.TimeOnly.fromParts(parseInt(r,10),parseInt(y,10),parseInt(z,10),parseInt(D,10));if(null!==t)return t}throw new b.SqlError(b.SqlErrorCodes.InvalidTime);};a.parseTimestamp=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlInterval":function(){define(["exports","../../arcade/featureset/support/errorsupport"],function(a,b){class g{constructor(){this.op=
"+";this.millis=this.minute=this.year=this.month=this.hour=this.second=this.day=0}static _fixDefaults(d){if(null!==d.precision||null!==d.secondary)throw new b.SqlError(b.SqlErrorCodes.PrimarySecondaryQualifiers);}static _parseSecondsComponent(d,k){k.includes(".")?(k=k.split("."),d.second=parseFloat(k[0]),d.millis=parseInt(k[1],10)):d.second=parseFloat(k)}static createFromMilliseconds(d){const k=new g;k.second=d/1E3;return k}static createFromValueAndQualifer(d,k,m){let f=null;const c=new g;c.op="-"===
m?"-":"+";if("interval-period"===k.type){g._fixDefaults(k);m=RegExp("^[0-9]{1,}$");if("year"===k.period||"month"===k.period)throw new b.SqlError(b.SqlErrorCodes.YearMonthIntervals);if("second"===k.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(d))g._parseSecondsComponent(c,d);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);else if(m.test(d))c[k.period]=parseFloat(d);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}else{g._fixDefaults(k.start);g._fixDefaults(k.end);if("year"===
k.start.period||"month"===k.start.period||"year"===k.end.period||"month"===k.end.period)throw new b.SqlError(b.SqlErrorCodes.YearMonthIntervals);switch(k.start.period){case "day":switch(k.end.period){case "hour":f=RegExp("^[0-9]{1,} [0-9]{1,}$");if(f.test(d))c[k.start.period]=parseFloat(d.split(" ")[0]),c[k.end.period]=parseFloat(d.split(" ")[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "minute":f=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(f.test(d))c[k.start.period]=
parseFloat(d.split(" ")[0]),d=d.split(" ")[1].split(":"),c.hour=parseFloat(d[0]),c.minute=parseFloat(d[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "second":f=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(f.test(d))c[k.start.period]=parseFloat(d.split(" ")[0]),d=d.split(" ")[1].split(":"),c.hour=parseFloat(d[0]),c.minute=parseFloat(d[1]),g._parseSecondsComponent(c,d[2]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);
}break;case "hour":switch(k.end.period){case "minute":f=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(f.test(d))c.hour=parseFloat(d.split(":")[0]),c.minute=parseFloat(d.split(":")[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "second":f=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(f.test(d))d=d.split(":"),c.hour=parseFloat(d[0]),c.minute=parseFloat(d[1]),g._parseSecondsComponent(c,d[2]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);
}break;case "minute":switch(k.end.period){case "second":f=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(f.test(d))d=d.split(":"),c.minute=parseFloat(d[0]),g._parseSecondsComponent(c,d[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}}return c}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*
this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)}}a.SqlInterval=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ../string ./DateOnly ./sqlCompareUtils ./sqlDateParsingUtils ./TimeOnly ../../chunks/datetime".split(" "),function(a,b,g,d,k,m,f,c){function l(n){return"string"===typeof n||n instanceof String}function e(n){return m.isDate(n)||m.isDateOnly(n)||
m.isDateTime(n)||m.isTimeOnly(n)||m.isTimestampOffset(n)?!1:!0}function p(n){return m.isDateOnly(n)||m.isTimeOnly(n)?n.toString():m.isTimestampOffset(n)?n.toSQLValue():m.isDateTime(n)?0===n.millisecond?n.toFormat("yyyy-LL-dd HH:mm:ss"):n.toSQL({includeOffset:!1}):m.isDate(n)?p(c.DateTime.fromJSDate(n)):n.toString()}function h(n){if(m.isDate(n))return d.DateOnly.fromDateJS(n);if(m.isDateTime(n))return d.DateOnly.fromParts(n.year,n.month,n.day);if(m.isDateOnly(n))return n;if(m.isTimeOnly(n))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);
if(m.isTimestampOffset(n)&&null===d.DateOnly.fromParts(n.year,n.month,n.day))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(l(n)&&(n=d.DateOnly.fromReader(n),null!==n&&n.isValid))return n;throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}function u(n,q,t){if(m.isDate(n))return m.convertToExecutingTimeZone(n,q);if(m.isDateTime(n))return n;if(m.isDateOnly(n))return n.toDateTimeLuxon("unknown");if(m.isTimeOnly(n))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(m.isTimestampOffset(n))return n;
if(l(n))return m.parseTimestamp(n,"unknown",t);throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}function w(n){if(m.isDate(n))return f.TimeOnly.fromDateJS(n);if(m.isDateTime(n))return f.TimeOnly.fromDateTime(n);if(m.isDateOnly(n))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(m.isTimeOnly(n))return n;if(m.isTimestampOffset(n))return f.TimeOnly.fromSqlTimeStampOffset(n);if(l(n))return m.parseTime(n);throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}const x={extract:{minParams:2,
maxParams:2,evaluate:([n,q])=>{if(null==q)return null;if(m.isDate(q))switch(n.toUpperCase()){case "SECOND":return q.getSeconds();case "MINUTE":return q.getMinutes();case "HOUR":return q.getHours();case "DAY":return q.getDate();case "MONTH":return q.getMonth()+1;case "YEAR":return q.getFullYear();case "TIMEZONE_HOUR":return 0;case "TIMEZONE_MINUTE":return 0}else if(m.isDateTime(q))switch(n.toUpperCase()){case "SECOND":return q.second;case "MINUTE":return q.minute;case "HOUR":return q.hour;case "DAY":return q.day;
case "MONTH":return q.month;case "YEAR":return q.year}else if(m.isDateOnly(q))switch(n.toUpperCase()){case "DAY":return q.day;case "MONTH":return q.month;case "YEAR":return q.year}else if(m.isTimeOnly(q))switch(n.toUpperCase()){case "SECOND":return q.second;case "MINUTE":return q.minute;case "HOUR":return q.hour}else if(m.isTimestampOffset(q))switch(n.toUpperCase()){case "SECOND":return q.second;case "MINUTE":return q.minute;case "HOUR":return q.hour;case "DAY":return q.day;case "MONTH":return q.month;
case "YEAR":return q.year;case "TIMEZONE_HOUR":return q.timezoneOffsetHour;case "TIMEZONE_MINUTE":return q.timezoneOffsetMinutes}throw new b.SqlError(b.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});}},substring:{minParams:2,maxParams:3,evaluate:n=>{if(2===n.length){const [q,t]=n;return null==q||null==t?null:q.toString().substring(t-1)}if(3===n.length){const [q,t,v]=n;return null==q||null==t||null==v?null:0>=v?"":q.toString().substring(t-1,t+v-1)}}},position:{minParams:2,maxParams:2,
evaluate:([n,q])=>null==n||null==q?null:q.indexOf(n)+1},trim:{minParams:2,maxParams:3,evaluate:n=>{var q=3===n.length,t=q?n[1]:" ";q=q?n[2]:n[1];if(null==t||null==q)return null;t=`(${g.escapeRegExpString(t)})`;switch(n[0]){case "BOTH":return q.replaceAll(new RegExp(`^${t}*|${t}*$`,"g"),"");case "LEADING":return q.replaceAll(new RegExp(`^${t}*`,"g"),"");case "TRAILING":return q.replaceAll(new RegExp(`${t}*$`,"g"),"")}throw new b.SqlError(b.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"});
}},abs:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.abs(n[0])},ceiling:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.ceil(n[0])},floor:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.floor(n[0])},log:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.log(n[0])},log10:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.log(n[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.sin(n[0])},cos:{minParams:1,maxParams:1,evaluate:n=>
null==n[0]?null:Math.cos(n[0])},tan:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.tan(n[0])},asin:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.asin(n[0])},acos:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.acos(n[0])},atan:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.atan(n[0])},sign:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:0<n[0]?1:0>n[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:n=>null==n[0]||null==n[1]?null:n[0]**n[1]},mod:{minParams:2,
maxParams:2,evaluate:n=>null==n[0]||null==n[1]?null:n[0]%n[1]},round:{minParams:1,maxParams:2,evaluate:n=>{const q=n[0];n=2===n.length?10**n[1]:1;return null==q?null:Math.round(q*n)/n}},truncate:{minParams:1,maxParams:2,evaluate:n=>null==n[0]?null:1===n.length?parseInt(n[0].toFixed(0),10):parseFloat(n[0].toFixed(n[1]))},char_length:{minParams:1,maxParams:1,evaluate:n=>l(n[0])?n[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:n=>{let q="";for(let t=0;t<n.length;t++){if(null==n[t])return null;
q+=n[t].toString()}return q}},lower:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:n[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:n[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:n=>{for(const q of n)if(null!==q)return q;return null}},cosh:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.cosh(n[0])},sinh:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.sinh(n[0])},tanh:{minParams:1,maxParams:1,evaluate:n=>
null==n[0]?null:Math.tanh(n[0])},nullif:{minParams:2,maxParams:2,evaluate:(n,q)=>k.sqlCompare(n[0],n[1],"\x3d")?null:n[0]},cast:{minParams:2,maxParams:2,evaluate:(n,q)=>{const t=n[0];n=n[1];if(null===t)return null;switch(n.type){case "integer":if(!e(t))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);q=parseInt(t,10);if(isNaN(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return q;case "smallint":if(!e(t))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);q=parseInt(t,10);if(isNaN(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);
if(32767<q||-32767>q)throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return q;case "float":case "real":if(!e(t))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);q=parseFloat(t);if(isNaN(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return q;case "time":return w(t);case "date":return h(t);case "timestamp":return u(t,q,!0===n.withtimezone);case "varchar":q=p(t);if(q.length>n.size)throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return q;default:throw new b.SqlError(b.SqlErrorCodes.InvalidDataType);
}}}};a.evaluateFunction=function(n,q,t){const v=x[n.toLowerCase()];if(null==v)throw new b.SqlError(b.SqlErrorCodes.FunctionNotRecognized);if(q.length<v.minParams||q.length>v.maxParams)throw new b.SqlError(b.SqlErrorCodes.InvalidParameterCount,{name:n.toUpperCase()});return v.evaluate(q,t)};a.isStandardized=function(n,q){n=x[n.toLowerCase()];return null!=n&&q>=n.minParams&&q<=n.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlCompareUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./sqlDateParsingUtils ./SqlTimestampOffset ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,b,g,d,k,m){function f(n){return g.isDateTime(n)||g.isTimestampOffset(n)?!0:!1}function c(n){return g.isDateTime(n)||g.isDateOnly(n)||g.isTimestampOffset(n)||g.isTimeOnly(n)?!0:!1}function l(n){if(g.isDateTime(n))return n.toMillis();if(g.isDateOnly(n))return n.toNumber();if(g.isTimestampOffset(n))return n.toMilliseconds();throw new b.SqlError(b.SqlErrorCodes.InvalidDataType);}function e(n,q,t){switch(t){case "\x3c\x3e":return n!==q;case "\x3d":return n===q;case "\x3e":return n>q;case "\x3c":return n<
q;case "\x3e\x3d":return n>=q;case "\x3c\x3d":return n<=q}}function p(n,q,t){const v=parseFloat(q);if(!isNaN(v))return e(n,v,t);n=n.toString();switch(t){case "\x3c\x3e":return n!==q;case "\x3d":return n===q;case "\x3e":return n>q;case "\x3c":return n<q;case "\x3e\x3d":return n>=q;case "\x3c\x3d":return n<=q}}function h(n,q,t){const v=parseFloat(n);if(!isNaN(v))return e(v,q,t);q=q.toString();switch(t){case "\x3c\x3e":return n!==q;case "\x3d":return n===q;case "\x3e":return n>q;case "\x3c":return n<
q;case "\x3e\x3d":return n>=q;case "\x3c\x3d":return n<=q}}function u(n,q,t){switch(t){case "\x3c\x3e":return n!==q;case "\x3d":return n===q;case "\x3e":return n>q;case "\x3c":return n<q;case "\x3e\x3d":return n>=q;case "\x3c\x3d":return n<=q}}function w(n,q,t){n instanceof d.SqlTimeStampOffset&&(n=n.toDateTime());q instanceof d.SqlTimeStampOffset&&(q=q.toDateTime());n=x(n);q=x(q);switch(t){case "\x3c\x3e":return n!==q;case "\x3d":return n===q;case "\x3e":return n>q;case "\x3c":return n<q;case "\x3e\x3d":return n>=
q;case "\x3c\x3d":return n<=q}}function x(n){return 321408E5*n.year+26784E5*n.month+864E5*n.day+36E5*n.hour+6E4*n.minute+1E3*n.second+n.millisecond}a.dateValueInMilliseconds=l;a.isDateOrTimeValue=c;a.isDateTimeComparableValue=f;a.sqlCompare=function(n,q,t,v){if(null==n||null==q)return null;if(g.isNumber(n)){if(g.isNumber(q))return e(n,q,t);if(g.isString(q))return p(n,q,t);if(c(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isDateOnly(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}else if(g.isString(n)){if(g.isNumber(q))return h(n,q,t);if(g.isString(q))return u(n,q,t);if(g.isDateTime(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isDateOnly(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isTimeOnly(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isTimestampOffset(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(g.isDateTime(n)){if(f(q)){if(n instanceof m.DateTime&&k.isUnknownTimeZone(n.zone)){if(q instanceof m.DateTime&&
!1===k.isUnknownTimeZone(q.zone)||q instanceof d.SqlTimeStampOffset)return w(n,q,t)}else if(q instanceof m.DateTime&&k.isUnknownTimeZone(q.zone)&&(n instanceof m.DateTime&&!1===k.isUnknownTimeZone(n.zone)||n instanceof d.SqlTimeStampOffset))return w(n,q,t);return e(l(n),l(q),t)}if(g.isString(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isDateOnly(q))return q=q.toDateTimeLuxon(n.zone),n=n.startOf("day"),e(n.toMillis(),q.toMillis(),t);if(g.isTimeOnly(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
if(g.isNumber(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(g.isDateOnly(n)){if(g.isTimestampOffset(q))return n=n.toDateTimeLuxon(q.toDateTime().zone),q=q.startOfDay(),e(n.toMillis(),q.toMilliseconds(),t);if(g.isDateTime(q))return n=n.toDateTimeLuxon(q.zone),q=q.startOf("day"),e(n.toMillis(),q.toMillis(),t);if(g.isString(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isDateOnly(q))return e(n.toNumber(),q.toNumber(),t);if(g.isTimeOnly(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
if(g.isNumber(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(g.isTimeOnly(n)){if(g.isTimeOnly(q))return e(n.toNumber(),q.toNumber(),t);if(g.isString(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isNumber(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isDateOnly(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(f(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(g.isTimestampOffset(n)){if(f(q))return q instanceof m.DateTime&&
k.isUnknownTimeZone(q.zone)?w(n,q,t):e(l(n),l(q),t);if(g.isString(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isDateOnly(q))return q=q.toDateTimeLuxon(n.toDateTime().zone),n=n.startOfDay(),e(n.toMilliseconds(),q.toMillis(),t);if(g.isTimeOnly(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g.isNumber(q))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}switch(t){case "\x3c\x3e":return n!==q;case "\x3d":return n===q;case "\x3e":return n>q;case "\x3c":return n<q;case "\x3e\x3d":return n>=
q;case "\x3c\x3d":return n<=q}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,b){var g={exports:{}};g.exports;(function(m){(function(f,c){m.exports&&(m.exports=c())})(b.commonjsGlobal,function(){function f(l,e,p,h){l=Error.call(this,l);Object.setPrototypeOf&&Object.setPrototypeOf(l,f.prototype);l.expected=e;l.found=p;l.location=h;l.name="SyntaxError";return l}function c(l,e,p){p=
p||" ";if(l.length>e)return l;e-=l.length;p+=p.repeat(e);return l+p.slice(0,e)}(function(l,e){function p(){this.constructor=l}p.prototype=e.prototype;l.prototype=new p})(f,Error);f.prototype.format=function(l){var e="Error: "+this.message;if(this.location){var p=null,h;for(h=0;h<l.length;h++)if(l[h].source===this.location.source){p=l[h].text.split(/\r\n|\n|\r/g);break}l=this.location.start;h=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(l):l;var u=
this.location.source+":"+h.line+":"+h.column;if(p){var w=this.location.end,x=c("",h.line.toString().length," ");p=p[l.line-1];w=(l.line===w.line?w.column:p.length+1)-l.column||1;e+="\n --\x3e "+u+"\n"+x+" |\n"+h.line+" | "+p+"\n"+x+" | "+c("",l.column-1," ")+c("",w,"^")}else e+="\n at "+u}return e};f.buildMessage=function(l,e){function p(n){return n.charCodeAt(0).toString(16).toUpperCase()}function h(n){return n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,
"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(q){return"\\x0"+p(q)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(q){return"\\x"+p(q)})}function u(n){return n.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(q){return"\\x0"+p(q)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(q){return"\\x"+p(q)})}function w(n){return x[n.type](n)}var x={literal:function(n){return'"'+
h(n.text)+'"'},class:function(n){var q=n.parts.map(function(t){return Array.isArray(t)?u(t[0])+"-"+u(t[1]):u(t)});return"["+(n.inverted?"^":"")+q.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(n){return n.description}};return"Expected "+function(n){n=n.map(w);var q,t;n.sort();if(0<n.length){for(t=q=1;q<n.length;q++)n[q-1]!==n[q]&&(n[t]=n[q],t++);n.length=t}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,
-1).join(", ")+", or "+n[n.length-1]}}(l)+" but "+(e?'"'+h(e)+'"':"end of input")+" found."};return{SyntaxError:f,parse:function(l,e){function p(ya,Ea){Ea=void 0!==Ea?Ea:x(bb,pa);throw new f(ya,null,null,Ea);}function h(ya,Ea){return{type:"literal",text:ya,ignoreCase:Ea}}function u(ya,Ea,Ia){return{type:"class",parts:ya,inverted:Ea,ignoreCase:Ia}}function w(ya){var Ea=ie[ya],Ia;if(!Ea){for(Ia=ya-1;!ie[Ia];)Ia--;Ea=ie[Ia];for(Ea={line:Ea.line,column:Ea.column};Ia<ya;)10===l.charCodeAt(Ia)?(Ea.line++,
Ea.column=1):Ea.column++,Ia++;ie[ya]=Ea}return Ea}function x(ya,Ea,Ia){var Ua=w(ya),hb=w(Ea);ya={source:Sa,start:{offset:ya,line:Ua.line,column:Ua.column},end:{offset:Ea,line:hb.line,column:hb.column}};Ia&&Sa&&"function"===typeof Sa.offset&&(ya.start=Sa.offset(ya.start),ya.end=Sa.offset(ya.end));return ya}function n(ya){pa<qc||(pa>qc&&(qc=pa,Me=[]),Me.push(ya))}function q(){var ya=pa;Na();var Ea=v();Ea!==ha?(Na(),bb=ya,ya=Ea):(pa=ya,ya=ha);return ya}function t(){var ya=pa;var Ea=v();if(Ea!==ha){var Ia=
[];var Ua=pa;var hb=Na();var sb=ab();if(sb!==ha){var Bb=Na();var Db=v();Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)}else pa=Ua,Ua=ha;for(;Ua!==ha;)Ia.push(Ua),Ua=pa,hb=Na(),sb=ab(),sb!==ha?(Bb=Na(),Db=v(),Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)):(pa=Ua,Ua=ha);bb=ya;ya={type:"expression-list"};Ea=[Ea];for(Ua=0;Ua<Ia.length;Ua++)Ea.push(Ia[Ua][3]);ya.value=Ea}else pa=ya,ya=ha;return ya}function v(){var ya=pa;var Ea=r();if(Ea!==ha){var Ia=[];var Ua=pa;var hb=Na();var sb=da();if(sb!==ha){var Bb=Na();
var Db=r();Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)}else pa=Ua,Ua=ha;for(;Ua!==ha;)Ia.push(Ua),Ua=pa,hb=Na(),sb=da(),sb!==ha?(Bb=Na(),Db=r(),Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)):(pa=Ua,Ua=ha);bb=ya;ya=Ka(Ea,Ia)}else pa=ya,ya=ha;return ya}function r(){var ya=pa;var Ea=y();if(Ea!==ha){var Ia=[];var Ua=pa;var hb=Na();var sb=aa();if(sb!==ha){var Bb=Na();var Db=y();Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)}else pa=Ua,Ua=ha;for(;Ua!==ha;)Ia.push(Ua),Ua=pa,hb=Na(),sb=aa(),sb!==ha?(Bb=Na(),Db=y(),
Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)):(pa=Ua,Ua=ha);bb=ya;ya=Ka(Ea,Ia)}else pa=ya,ya=ha;return ya}function y(){var ya=pa;var Ea=fa();if(Ea===ha){Ea=pa;if(33===l.charCodeAt(pa)){var Ia=Ba;pa++}else Ia=ha,0===Xa&&n(Ie);if(Ia!==ha){var Ua=pa;Xa++;if(61===l.charCodeAt(pa)){var hb=Ja;pa++}else hb=ha,0===Xa&&n(Vd);Xa--;hb===ha?Ua=void 0:(pa=Ua,Ua=ha);Ua!==ha?Ea=Ia=[Ia,Ua]:(pa=Ea,Ea=ha)}else pa=Ea,Ea=ha}Ea!==ha?(Ia=Na(),Ua=y(),Ua!==ha?(bb=ya,ya={type:"unary-expression",operator:"NOT",expr:Ua}):(pa=
ya,ya=ha)):(pa=ya,ya=ha);if(ya===ha){Ea=pa;ya=E();if(ya!==ha){Na();Ia=pa;Ua=[];hb=pa;var sb=Na();var Bb=z();if(Bb!==ha){var Db=Na();var Fc=E();Fc!==ha?hb=sb=[sb,Bb,Db,Fc]:(pa=hb,hb=ha)}else pa=hb,hb=ha;if(hb!==ha)for(;hb!==ha;)Ua.push(hb),hb=pa,sb=Na(),Bb=z(),Bb!==ha?(Db=Na(),Fc=E(),Fc!==ha?hb=sb=[sb,Bb,Db,Fc]:(pa=hb,hb=ha)):(pa=hb,hb=ha);else Ua=ha;Ua!==ha&&(bb=Ia,Ua={type:"arithmetic",tail:Ua});Ia=Ua;Ia===ha&&(Ia=pa,Ua=C(),Ua!==ha?(Na(),hb=Wa(),hb!==ha?(Na(),hb=t(),hb!==ha?(Na(),sb=cb(),sb!==ha?
(bb=Ia,Ia={op:Ua,right:hb}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha),Ia===ha&&(Ia=pa,Ua=C(),Ua!==ha?(Na(),hb=Wa(),hb!==ha?(Na(),hb=cb(),hb!==ha?(bb=Ia,Ia={op:Ua,right:{type:"expression-list",value:[]}}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha),Ia===ha&&(Ia=pa,Ua=C(),Ua!==ha?(Na(),hb=T(),hb!==ha?(bb=Ia,Ia={op:Ua,right:hb}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha))),Ia===ha&&(Ia=pa,sb=fa(),sb!==ha?(Na(),Ua=ma(),Ua!==ha?(Na(),hb=E(),hb!==ha?(Na(),Bb=aa(),Bb!==ha?(Na(),sb=E(),sb!==ha?(bb=Ia,
Ia={op:"NOT"+Ua,right:{type:"expression-list",value:[hb,sb]}}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha),Ia===ha&&(Ia=pa,sb=ma(),sb!==ha?(Na(),Ua=E(),Ua!==ha?(Na(),hb=aa(),hb!==ha?(Na(),Bb=E(),Bb!==ha?(bb=Ia,Ia={op:sb,right:{type:"expression-list",value:[Ua,Bb]}}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)),Ia===ha&&(Ia=pa,Ua=Y(),Ua!==ha?(Na(),hb=fa(),hb!==ha?(Na(),hb=E(),hb!==ha?(bb=Ia,Ia={op:Ua+"NOT",right:hb}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,
Ia=ha),Ia===ha&&(Ia=pa,Ua=Y(),Ua!==ha?(Na(),hb=E(),hb!==ha?(bb=Ia,Ia={op:Ua,right:hb}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)),Ia===ha&&(Ia=pa,Ua=D(),Ua!==ha?(Na(),hb=R(),hb!==ha?(Na(),sb=pa,l.substr(pa,6).toLowerCase()===gb?(Bb=l.substr(pa,6),pa+=6):(Bb=ha,0===Xa&&n(Ad)),Bb!==ha?(Bb=pa,Xa++,Db=K(),Xa--,Db===ha?Bb=void 0:(pa=Bb,Bb=ha),Bb!==ha?(bb=sb,sb="ESCAPE"):(pa=sb,sb=ha)):(pa=sb,sb=ha),sb!==ha?(Na(),sb=W(),sb!==ha?(bb=Ia,Ia={op:Ua,right:hb,escape:sb.value}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):
(pa=Ia,Ia=ha),Ia===ha&&(Ia=pa,Ua=D(),Ua!==ha?(Na(),hb=R(),hb!==ha?(bb=Ia,Ia={op:Ua,right:hb,escape:""}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha))))));Ia===ha&&(Ia=null);bb=Ea;Ea=Ia;""==Ea||void 0==Ea||null==Ea?Ea=ya:(Ia=null,Ea=Ia="arithmetic"==Ea.type?Ka(ya,Ea.tail):Da(Ea.op,ya,Ea.right,Ea.escape))}else pa=Ea,Ea=ha;ya=Ea}return ya}function z(){if(l.substr(pa,2)===Ta){var ya=Ta;pa+=2}else ya=ha,0===Xa&&n(Dc);ya===ha&&(62===l.charCodeAt(pa)?(ya=db,pa++):(ya=ha,0===Xa&&n(Ec)),ya===ha&&(l.substr(pa,2)===lb?(ya=
lb,pa+=2):(ya=ha,0===Xa&&n(Bc)),ya===ha&&(l.substr(pa,2)===mb?(ya=mb,pa+=2):(ya=ha,0===Xa&&n(dd)),ya===ha&&(60===l.charCodeAt(pa)?(ya=ob,pa++):(ya=ha,0===Xa&&n(Wd)),ya===ha&&(61===l.charCodeAt(pa)?(ya=Ja,pa++):(ya=ha,0===Xa&&n(Vd)),ya===ha&&(l.substr(pa,2)===pb?(ya=pb,pa+=2):(ya=ha,0===Xa&&n(Cc))))))));return ya}function D(){var ya;var Ea=ya=pa;var Ia=fa();if(Ia!==ha){var Ua=Na();var hb=ea();hb!==ha?Ea=Ia=[Ia,Ua,hb]:(pa=Ea,Ea=ha)}else pa=Ea,Ea=ha;Ea!==ha&&(bb=ya,Ea=Ea[0]+" "+Ea[2]);ya=Ea;ya===ha&&
(ya=ea());return ya}function C(){var ya;var Ea=ya=pa;var Ia=fa();if(Ia!==ha){var Ua=Na();var hb=na();hb!==ha?Ea=Ia=[Ia,Ua,hb]:(pa=Ea,Ea=ha)}else pa=Ea,Ea=ha;Ea!==ha&&(bb=ya,Ea=Ea[0]+" "+Ea[2]);ya=Ea;ya===ha&&(ya=na());return ya}function E(){var ya=pa;var Ea=F();if(Ea!==ha){var Ia=[];var Ua=pa;var hb=Na();var sb=A();if(sb!==ha){var Bb=Na();var Db=F();Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)}else pa=Ua,Ua=ha;for(;Ua!==ha;)Ia.push(Ua),Ua=pa,hb=Na(),sb=A(),sb!==ha?(Bb=Na(),Db=F(),Db!==ha?Ua=hb=[hb,sb,
Bb,Db]:(pa=Ua,Ua=ha)):(pa=Ua,Ua=ha);bb=ya;ya=Ka(Ea,Ia)}else pa=ya,ya=ha;return ya}function A(){if(43===l.charCodeAt(pa)){var ya=zb;pa++}else ya=ha,0===Xa&&n(oc);ya===ha&&(45===l.charCodeAt(pa)?(ya=rb,pa++):(ya=ha,0===Xa&&n(pc)),ya===ha&&(l.substr(pa,2)===Jb?(ya=Jb,pa+=2):(ya=ha,0===Xa&&n(nd))));return ya}function F(){var ya=pa;var Ea=I();if(Ea!==ha){var Ia=[];var Ua=pa;var hb=Na();var sb=G();if(sb!==ha){var Bb=Na();var Db=I();Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)}else pa=Ua,Ua=ha;for(;Ua!==ha;)Ia.push(Ua),
Ua=pa,hb=Na(),sb=G(),sb!==ha?(Bb=Na(),Db=I(),Db!==ha?Ua=hb=[hb,sb,Bb,Db]:(pa=Ua,Ua=ha)):(pa=Ua,Ua=ha);bb=ya;ya=Ka(Ea,Ia)}else pa=ya,ya=ha;return ya}function G(){if(42===l.charCodeAt(pa)){var ya=fb;pa++}else ya=ha,0===Xa&&n(od);ya===ha&&(47===l.charCodeAt(pa)?(ya=Cb,pa++):(ya=ha,0===Xa&&n(pd)));return ya}function I(){var ya=W();if(ya===ha){var Ea=pa;var Ia=pa;var Ua=X();if(Ua!==ha){var hb=ca();if(hb!==ha){var sb=ba();sb!==ha?(bb=Ia,Ia=parseFloat(Ua+hb+sb)):(pa=Ia,Ia=ha)}else pa=Ia,Ia=ha}else pa=Ia,
Ia=ha;Ia===ha&&(Ia=pa,Ua=X(),Ua!==ha?(hb=ca(),hb!==ha?(bb=Ia,Ia=parseFloat(Ua+hb)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha),Ia===ha&&(Ia=pa,Ua=X(),Ua!==ha?(hb=ba(),hb!==ha?(bb=Ia,Ia=parseFloat(Ua+hb)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha),Ia===ha&&(Ia=pa,Ua=X(),Ua!==ha&&(bb=Ia,Ua=parseFloat(Ua)),Ia=Ua)));var Bb=Ia;if(Bb!==ha){var Db=pa;Xa++;var Fc=B();Xa--;Fc===ha?Db=void 0:(pa=Db,Db=ha);Db!==ha?(bb=Ea,Ea={type:"number",value:Bb}):(pa=Ea,Ea=ha)}else pa=Ea,Ea=ha;ya=Ea;if(ya===ha){var Gc=pa;var ed=pa;if(l.substr(pa,4).toLowerCase()===
ib){var je=l.substr(pa,4);pa+=4}else je=ha,0===Xa&&n(zd);if(je!==ha){var Cd=pa;Xa++;var Ef=K();Xa--;Ef===ha?Cd=void 0:(pa=Cd,Cd=ha);Cd!==ha?ed=je=[je,Cd]:(pa=ed,ed=ha)}else pa=ed,ed=ha;var Hc=ed;Hc!==ha&&(bb=Gc,Hc={type:"boolean",value:!0});Gc=Hc;if(Gc===ha){Gc=pa;var fd=pa;if(l.substr(pa,5).toLowerCase()===jb){var ke=l.substr(pa,5);pa+=5}else ke=ha,0===Xa&&n(be);if(ke!==ha){var Dd=pa;Xa++;var Ff=K();Xa--;Ff===ha?Dd=void 0:(pa=Dd,Dd=ha);Dd!==ha?fd=ke=[ke,Dd]:(pa=fd,fd=ha)}else pa=fd,fd=ha;Hc=fd;Hc!==
ha&&(bb=Gc,Hc={type:"boolean",value:!1});Gc=Hc}ya=Gc;if(ya===ha){var Gf=pa;var gd=pa;if(l.substr(pa,4).toLowerCase()===Za){var le=l.substr(pa,4);pa+=4}else le=ha,0===Xa&&n(xd);if(le!==ha){var Ed=pa;Xa++;var Hf=K();Xa--;Hf===ha?Ed=void 0:(pa=Ed,Ed=ha);Ed!==ha?gd=le=[le,Ed]:(pa=gd,gd=ha)}else pa=gd,gd=ha;var Ne=gd;Ne!==ha&&(bb=Gf,Ne={type:"null",value:null});ya=Ne;if(ya===ha){var Ic=pa;if(Aa()!==ha){Na();var me=R();me!==ha?(bb=Ic,"string"===me.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(me.value)&&
p("Date literal is invalid"),Ic={type:"date",value:me.value}):(pa=Ic,Ic=ha)}else pa=Ic,Ic=ha;ya=Ic;if(ya===ha){var Jc=pa;if(ra()!==ha){Na();var ne=R();ne!==ha?(bb=Jc,"string"===ne.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(ne.value)&&
p("Timestamp literal is invalid"),Jc={type:"timestamp",value:ne.value}):(pa=Jc,Jc=ha)}else pa=Jc,Jc=ha;ya=Jc;if(ya===ha){var Wb=pa;var Oe=la();if(Oe!==ha){Na();if(45===l.charCodeAt(pa)){var vc=rb;pa++}else vc=ha,0===Xa&&n(pc);vc===ha&&(43===l.charCodeAt(pa)?(vc=zb,pa++):(vc=ha,0===Xa&&n(oc)));if(vc!==ha){Na();var Fd=R();if(Fd!==ha){Na();var af=O();af!==ha?(bb=Wb,Wb={type:"interval",value:Fd,qualifier:af,op:vc}):(pa=Wb,Wb=ha)}else pa=Wb,Wb=ha}else pa=Wb,Wb=ha}else pa=Wb,Wb=ha;Wb===ha&&(Wb=pa,Oe=la(),
Oe!==ha?(Na(),vc=R(),vc!==ha?(Na(),Fd=O(),Fd!==ha?(bb=Wb,Wb={type:"interval",value:vc,qualifier:Fd,op:""}):(pa=Wb,Wb=ha)):(pa=Wb,Wb=ha)):(pa=Wb,Wb=ha));ya=Wb;if(ya===ha){var Kc=pa;if(qa()!==ha){Na();var oe=R();oe!==ha?(bb=Kc,"string"===oe.type&&!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(oe.value)&&p("Time literal is invalid"),Kc={type:"time",value:oe.value}):(pa=Kc,Kc=ha)}else pa=Kc,Kc=ha;ya=Kc}}}}}}}var Nb=ya;if(Nb===ha){var fc=pa;var Lc=
pa;if(l.substr(pa,7).toLowerCase()===tb){var bf=l.substr(pa,7);pa+=7}else bf=ha,0===Xa&&n(ae);if(bf!==ha){var pe=pa;Xa++;var If=K();Xa--;If===ha?pe=void 0:(pa=pe,pe=ha);pe!==ha?(bb=Lc,Lc="EXTRACT"):(pa=Lc,Lc=ha)}else pa=Lc,Lc=ha;if(Lc!==ha){Na();var Jf=Wa();if(Jf!==ha){Na();var gc=ja();if(gc===ha&&(gc=oa(),gc===ha&&(gc=za(),gc===ha&&(gc=ta(),gc===ha&&(gc=Ca(),gc===ha&&(gc=Ga(),gc===ha)))))){var Mc=pa;if(l.substr(pa,13).toLowerCase()===ec){var cf=l.substr(pa,13);pa+=13}else cf=ha,0===Xa&&n(Kf);if(cf!==
ha){var qe=pa;Xa++;var Lf=K();Xa--;Lf===ha?qe=void 0:(pa=qe,qe=ha);qe!==ha?(bb=Mc,Mc="TIMEZONE_HOUR"):(pa=Mc,Mc=ha)}else pa=Mc,Mc=ha;gc=Mc;if(gc===ha){var Nc=pa;if(l.substr(pa,15).toLowerCase()===Zb){var df=l.substr(pa,15);pa+=15}else df=ha,0===Xa&&n(Mf);if(df!==ha){var re=pa;Xa++;var Nf=K();Xa--;Nf===ha?re=void 0:(pa=re,re=ha);re!==ha?(bb=Nc,Nc="TIMEZONE_MINUTE"):(pa=Nc,Nc=ha)}else pa=Nc,Nc=ha;gc=Nc}}var ef=gc;if(ef!==ha){Na();var Of=ua();if(Of!==ha){Na();var ff=v();if(ff!==ha){Na();var Pf=cb();
Pf!==ha?(bb=fc,fc={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:ef},ff]}}):(pa=fc,fc=ha)}else pa=fc,fc=ha}else pa=fc,fc=ha}else pa=fc,fc=ha}else pa=fc,fc=ha}else pa=fc,fc=ha;Nb=fc;if(Nb===ha){var hc=pa;var Oc=pa;if(l.substr(pa,9).toLowerCase()===kb){var gf=l.substr(pa,9);pa+=9}else gf=ha,0===Xa&&n(Le);if(gf!==ha){var se=pa;Xa++;var Qf=K();Xa--;Qf===ha?se=void 0:(pa=se,se=ha);se!==ha?(bb=Oc,Oc="SUBSTRING"):(pa=Oc,Oc=ha)}else pa=Oc,Oc=ha;if(Oc!==ha){Na();var Rf=
Wa();if(Rf!==ha){Na();var Pe=v();if(Pe!==ha){Na();var Sf=ua();if(Sf!==ha){Na();var Qe=v();if(Qe!==ha){Na();var wc=pa;var Pc=pa;if(l.substr(pa,3).toLowerCase()===eb){var hf=l.substr(pa,3);pa+=3}else hf=ha,0===Xa&&n(Ke);if(hf!==ha){var te=pa;Xa++;var Tf=K();Xa--;Tf===ha?te=void 0:(pa=te,te=ha);te!==ha?(bb=Pc,Pc="FOR"):(pa=Pc,Pc=ha)}else pa=Pc,Pc=ha;var Gd=Pc;if(Gd!==ha){var Uf=Na();var jf=v();if(jf!==ha){var Vf=Na();wc=Gd=[Gd,Uf,jf,Vf]}else pa=wc,wc=ha}else pa=wc,wc=ha;wc===ha&&(wc=null);Gd=cb();Gd!==
ha?(bb=hc,hc={type:"function",name:"substring",args:{type:"expression-list",value:wc?[Pe,Qe,wc[2]]:[Pe,Qe]}}):(pa=hc,hc=ha)}else pa=hc,hc=ha}else pa=hc,hc=ha}else pa=hc,hc=ha}else pa=hc,hc=ha}else pa=hc,hc=ha;Nb=hc;if(Nb===ha){var Rb=pa;var Re=sa();if(Re!==ha){Na();var Se=Wa();if(Se!==ha){Na();var xc=Q();xc===ha&&(xc=null);Na();var Hd=v();if(Hd!==ha){Na();var Te=ua();if(Te!==ha){Na();var kf=v();if(kf!==ha){Na();var Wf=cb();Wf!==ha?(bb=Rb,Rb={type:"function",name:"trim",args:{type:"expression-list",
value:[{type:"string",value:null==xc?"BOTH":xc},Hd,kf]}}):(pa=Rb,Rb=ha)}else pa=Rb,Rb=ha}else pa=Rb,Rb=ha}else pa=Rb,Rb=ha}else pa=Rb,Rb=ha}else pa=Rb,Rb=ha;Rb===ha&&(Rb=pa,Re=sa(),Re!==ha?(Na(),Se=Wa(),Se!==ha?(Na(),xc=Q(),xc===ha&&(xc=null),Na(),Hd=v(),Hd!==ha?(Na(),Te=cb(),Te!==ha?(bb=Rb,Rb={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==xc?"BOTH":xc},Hd]}}):(pa=Rb,Rb=ha)):(pa=Rb,Rb=ha)):(pa=Rb,Rb=ha)):(pa=Rb,Rb=ha));Nb=Rb;if(Nb===ha){var ic=pa;var Qc=
pa;if(l.substr(pa,8).toLowerCase()===xb){var lf=l.substr(pa,8);pa+=8}else lf=ha,0===Xa&&n(Xf);if(lf!==ha){var ue=pa;Xa++;var Yf=K();Xa--;Yf===ha?ue=void 0:(pa=ue,ue=ha);ue!==ha?(bb=Qc,Qc="POSITION"):(pa=Qc,Qc=ha)}else pa=Qc,Qc=ha;if(Qc!==ha){Na();var Zf=Wa();if(Zf!==ha){Na();var mf=v();if(mf!==ha){Na();var $f=na();if($f!==ha){Na();var nf=v();if(nf!==ha){Na();var ag=cb();ag!==ha?(bb=ic,ic={type:"function",name:"position",args:{type:"expression-list",value:[mf,nf]}}):(pa=ic,ic=ha)}else pa=ic,ic=ha}else pa=
ic,ic=ha}else pa=ic,ic=ha}else pa=ic,ic=ha}else pa=ic,ic=ha;Nb=ic;if(Nb===ha){var jc=pa;var Rc=pa;if(l.substr(pa,4).toLowerCase()===Ab){var of=l.substr(pa,4);pa+=4}else of=ha,0===Xa&&n(bg);if(of!==ha){var ve=pa;Xa++;var cg=K();Xa--;cg===ha?ve=void 0:(pa=ve,ve=ha);ve!==ha?(bb=Rc,Rc="CAST"):(pa=Rc,Rc=ha)}else pa=Rc,Rc=ha;if(Rc!==ha){Na();var dg=Wa();if(dg!==ha){Na();var pf=v();if(pf!==ha){Na();var Sc=pa;if(l.substr(pa,2).toLowerCase()===Gb){var qf=l.substr(pa,2);pa+=2}else qf=ha,0===Xa&&n(eg);if(qf!==
ha){var we=pa;Xa++;var fg=K();Xa--;fg===ha?we=void 0:(pa=we,we=ha);we!==ha?(bb=Sc,Sc="AS"):(pa=Sc,Sc=ha)}else pa=Sc,Sc=ha;var gg=Sc;if(gg!==ha){Na();var Eb=pa;var Tc=pa;if(l.substr(pa,7).toLowerCase()===Ib){var rf=l.substr(pa,7);pa+=7}else rf=ha,0===Xa&&n(hg);if(rf!==ha){var xe=pa;Xa++;var ig=K();Xa--;ig===ha?xe=void 0:(pa=xe,xe=ha);xe!==ha?(bb=Tc,Tc="INTEGER"):(pa=Tc,Tc=ha)}else pa=Tc,Tc=ha;var Ob=Tc;Ob!==ha&&(bb=Eb,Ob={type:"data-type",value:{type:"integer"}});Eb=Ob;if(Eb===ha){Eb=pa;var Uc=pa;
if(l.substr(pa,8).toLowerCase()===Ub){var sf=l.substr(pa,8);pa+=8}else sf=ha,0===Xa&&n(jg);if(sf!==ha){var ye=pa;Xa++;var kg=K();Xa--;kg===ha?ye=void 0:(pa=ye,ye=ha);ye!==ha?(bb=Uc,Uc="SMALLINT"):(pa=Uc,Uc=ha)}else pa=Uc,Uc=ha;Ob=Uc;Ob!==ha&&(bb=Eb,Ob={type:"data-type",value:{type:"smallint"}});Eb=Ob;if(Eb===ha){Eb=pa;var Vc=pa;if(l.substr(pa,5).toLowerCase()===Vb){var tf=l.substr(pa,5);pa+=5}else tf=ha,0===Xa&&n(lg);if(tf!==ha){var ze=pa;Xa++;var mg=K();Xa--;mg===ha?ze=void 0:(pa=ze,ze=ha);ze!==
ha?(bb=Vc,Vc="FLOAT"):(pa=Vc,Vc=ha)}else pa=Vc,Vc=ha;Ob=Vc;Ob!==ha&&(bb=Eb,Ob={type:"data-type",value:{type:"float"}});Eb=Ob;if(Eb===ha){Eb=pa;var Wc=pa;if(l.substr(pa,4).toLowerCase()===$b){var uf=l.substr(pa,4);pa+=4}else uf=ha,0===Xa&&n(ng);if(uf!==ha){var Ae=pa;Xa++;var og=K();Xa--;og===ha?Ae=void 0:(pa=Ae,Ae=ha);Ae!==ha?(bb=Wc,Wc="REAL"):(pa=Wc,Wc=ha)}else pa=Wc,Wc=ha;Ob=Wc;Ob!==ha&&(bb=Eb,Ob={type:"data-type",value:{type:"real"}});Eb=Ob;if(Eb===ha&&(Eb=pa,Ob=Aa(),Ob!==ha&&(bb=Eb,Ob={type:"data-type",
value:{type:"date"}}),Eb=Ob,Eb===ha&&(Eb=pa,Ob=ra(),Ob!==ha&&(bb=Eb,Ob={type:"data-type",value:{type:"timestamp"}}),Eb=Ob,Eb===ha&&(Eb=pa,Ob=qa(),Ob!==ha&&(bb=Eb,Ob={type:"data-type",value:{type:"time"}}),Eb=Ob,Eb===ha)))){Eb=pa;var Xc=pa;if(l.substr(pa,7).toLowerCase()===ac){var vf=l.substr(pa,7);pa+=7}else vf=ha,0===Xa&&n(pg);if(vf!==ha){var Be=pa;Xa++;var qg=K();Xa--;qg===ha?Be=void 0:(pa=Be,Be=ha);Be!==ha?(bb=Xc,Xc="VARCHAR"):(pa=Xc,Xc=ha)}else pa=Xc,Xc=ha;Ob=Xc;if(Ob!==ha){Na();var rg=Wa();if(rg!==
ha){Na();var wf=ia();if(wf!==ha){Na();var sg=cb();sg!==ha?(bb=Eb,Eb={type:"data-type",value:{type:"varchar",size:parseInt(wf)}}):(pa=Eb,Eb=ha)}else pa=Eb,Eb=ha}else pa=Eb,Eb=ha}else pa=Eb,Eb=ha}}}}var xf=Eb;if(xf!==ha){Na();var tg=cb();tg!==ha?(bb=jc,jc={type:"function",name:"cast",args:{type:"expression-list",value:[pf,xf]}}):(pa=jc,jc=ha)}else pa=jc,jc=ha}else pa=jc,jc=ha}else pa=jc,jc=ha}else pa=jc,jc=ha}else pa=jc,jc=ha;Nb=jc;if(Nb===ha){var yc=pa;var nc=pa;var Id=H();Id!==ha&&(bb=nc);nc=Id;if(nc===
ha)if(nc=pa,96===l.charCodeAt(pa)?(Id=kd,pa++):(Id=ha,0===Xa&&n(yf)),Id!==ha){var Ce=[];if(Ud.test(l.charAt(pa))){var zc=l.charAt(pa);pa++}else zc=ha,0===Xa&&n(zf);if(zc!==ha)for(;zc!==ha;)Ce.push(zc),Ud.test(l.charAt(pa))?(zc=l.charAt(pa),pa++):(zc=ha,0===Xa&&n(zf));else Ce=ha;Ce!==ha?(96===l.charCodeAt(pa)?(zc=kd,pa++):(zc=ha,0===Xa&&n(yf)),zc!==ha?(bb=nc,nc=Ce.join("")):(pa=nc,nc=ha)):(pa=nc,nc=ha)}else pa=nc,nc=ha;var Af=nc;if(Af!==ha){Na();var ug=Wa();if(ug!==ha){Na();var De=t();De===ha&&(De=
null);Na();var vg=cb();vg!==ha?(bb=yc,yc={type:"function",name:Af,args:De?De:{type:"expression-list",value:[]}}):(pa=yc,yc=ha)}else pa=yc,yc=ha}else pa=yc,yc=ha;Nb=yc;if(Nb===ha){var rc;var Xb=pa;var Ue=La();if(Ue!==ha){Na();var Jd=v();if(Jd!==ha){Na();var Kd=[];for(rc=V();rc!==ha;)Kd.push(rc),rc=V();rc=Na();var Ee=Ma();Ee!==ha?(bb=Xb,Xb={type:"case-expression",format:"simple",operand:Jd,clauses:Kd,else:null}):(pa=Xb,Xb=ha)}else pa=Xb,Xb=ha}else pa=Xb,Xb=ha;if(Xb===ha)if(Xb=pa,Ue=La(),Ue!==ha)if(Na(),
Jd=v(),Jd!==ha){Na();Kd=[];for(rc=V();rc!==ha;)Kd.push(rc),rc=V();rc=Na();Ee=S();if(Ee!==ha){Na();var wg=Ma();wg!==ha?(bb=Xb,Xb={type:"case-expression",format:"simple",operand:Jd,clauses:Kd,else:Ee.value}):(pa=Xb,Xb=ha)}else pa=Xb,Xb=ha}else pa=Xb,Xb=ha;else pa=Xb,Xb=ha;var Ve=Xb;if(Ve===ha){var sc;var dc=pa;var We=La();if(We!==ha){Na();var Ld=[];for(sc=N();sc!==ha;)Ld.push(sc),sc=N();sc=Na();var Fe=Ma();Fe!==ha?(bb=dc,dc={type:"case-expression",format:"searched",clauses:Ld,else:null}):(pa=dc,dc=
ha)}else pa=dc,dc=ha;if(dc===ha)if(dc=pa,We=La(),We!==ha){Na();Ld=[];for(sc=N();sc!==ha;)Ld.push(sc),sc=N();sc=Na();Fe=S();if(Fe!==ha){Na();var xg=Ma();xg!==ha?(bb=dc,dc={type:"case-expression",format:"searched",clauses:Ld,else:Fe.value}):(pa=dc,dc=ha)}else pa=dc,dc=ha}else pa=dc,dc=ha;Ve=dc}Nb=Ve;if(Nb===ha){var Yc=pa;var yg=pa;var Ge;var Md=pa;var Bf=B();if(Bf!==ha){var Cf=[];for(Ge=L();Ge!==ha;)Cf.push(Ge),Ge=L();bb=Md;Md=Bf+Cf.join("")}else pa=Md,Md=ha;var Df=Md;Df!==ha&&(bb=yg);var Ac=Df;if(Ac!==
ha){bb=Yc;var Xe=Ac;Ac=/^CURRENT_DATE$/i.test(Xe)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Xe)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:Xe}}Yc=Ac;if(Yc===ha){Yc=pa;var Zc=pa;if(M()!==ha){var He;var zg=pa;var Ye=[];for(He=J();He!==ha;)Ye.push(He),He=J();bb=zg;var Ag=Ye=Ye.join("");var Bg=M();Bg!==ha?(bb=Zc,Zc=Ag):(pa=Zc,Zc=ha)}else pa=Zc,Zc=ha;Ac=Zc;Ac!==ha&&(bb=Yc,Ac={type:"column-reference",table:"",column:Ac,delimited:!0});Yc=Ac}Nb=Yc;
if(Nb===ha&&(Nb=T(),Nb===ha)){Nb=pa;var Cg=Wa();if(Cg!==ha){Na();var Ze=v();if(Ze!==ha){Na();var Dg=cb();Dg!==ha?(bb=Nb,Ze.paren=!0,Nb=Ze):(pa=Nb,Nb=ha)}else pa=Nb,Nb=ha}else pa=Nb,Nb=ha}}}}}}}}}return Nb}function H(){var ya;var Ea=pa;var Ia=B();if(Ia!==ha){var Ua=[];for(ya=K();ya!==ha;)Ua.push(ya),ya=K();bb=Ea;Ea=Ia+Ua.join("")}else pa=Ea,Ea=ha;return Ea}function B(){if(ld.test(l.charAt(pa))){var ya=l.charAt(pa);pa++}else ya=ha,0===Xa&&n(qd);return ya}function K(){if(md.test(l.charAt(pa))){var ya=
l.charAt(pa);pa++}else ya=ha,0===Xa&&n(uc);return ya}function L(){if(bd.test(l.charAt(pa))){var ya=l.charAt(pa);pa++}else ya=ha,0===Xa&&n(rd);return ya}function J(){if(bd.test(l.charAt(pa))){var ya=l.charAt(pa);pa++}else ya=ha,0===Xa&&n(rd);if(ya===ha)if(ya=pa,M()!==ha){var Ea=M();Ea!==ha?(bb=ya,ya='"'):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function M(){if(Pd.test(l.charAt(pa))){var ya=l.charAt(pa);pa++}else ya=ha,0===Xa&&n(Je);return ya}function T(){var ya;var Ea=ya=pa;if(64===l.charCodeAt(pa)){var Ia=
Lb;pa++}else Ia=ha,0===Xa&&n(Xd);if(Ia!==ha){var Ua=H();Ua!==ha?Ea=Ia=[Ia,Ua]:(pa=Ea,Ea=ha)}else pa=Ea,Ea=ha;Ea!==ha&&(bb=ya,Ea={type:"parameter",value:Ea[1]});return Ea}function Q(){var ya=pa;if(l.substr(pa,7).toLowerCase()===Pb){var Ea=l.substr(pa,7);pa+=7}else Ea=ha,0===Xa&&n(Eg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="LEADING"):(pa=ya,ya=ha)}else pa=ya,ya=ha;ya===ha&&(ya=pa,l.substr(pa,8).toLowerCase()===qb?(Ea=l.substr(pa,8),pa+=8):(Ea=ha,0===
Xa&&n(Fg)),Ea!==ha?(Ea=pa,Xa++,Ia=K(),Xa--,Ia===ha?Ea=void 0:(pa=Ea,Ea=ha),Ea!==ha?(bb=ya,ya="TRAILING"):(pa=ya,ya=ha)):(pa=ya,ya=ha),ya===ha&&(ya=pa,l.substr(pa,4).toLowerCase()===wb?(Ea=l.substr(pa,4),pa+=4):(Ea=ha,0===Xa&&n(Gg)),Ea!==ha?(Ea=pa,Xa++,Ia=K(),Xa--,Ia===ha?Ea=void 0:(pa=Ea,Ea=ha),Ea!==ha?(bb=ya,ya="BOTH"):(pa=ya,ya=ha)):(pa=ya,ya=ha)));return ya}function O(){var ya=pa;var Ea=pa;var Ia=U();if(Ia!==ha){Na();var Ua=Wa();if(Ua!==ha)if(Na(),Ua=P(),Ua!==ha){Na();var hb=cb();hb!==ha?(bb=Ea,
Ea={type:"interval-period",period:Ia.value,precision:Ua,secondary:null}):(pa=Ea,Ea=ha)}else pa=Ea,Ea=ha;else pa=Ea,Ea=ha}else pa=Ea,Ea=ha;Ea===ha&&(Ea=pa,Ia=U(),Ia!==ha&&(bb=Ea,Ia={type:"interval-period",period:Ia.value,precision:null,secondary:null}),Ea=Ia);if(Ea!==ha)if(Na(),Ia=pa,l.substr(pa,2).toLowerCase()===kc?(Ua=l.substr(pa,2),pa+=2):(Ua=ha,0===Xa&&n(Hg)),Ua!==ha?(Ua=pa,Xa++,hb=K(),Xa--,hb===ha?Ua=void 0:(pa=Ua,Ua=ha),Ua!==ha?(bb=Ia,Ia="TO"):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha),Ia!==ha){Na();Ia=pa;
Ua=U();Ua!==ha&&(bb=Ia,Ua={type:"interval-period",period:Ua.value,precision:null,secondary:null});Ia=Ua;if(Ia===ha){Ia=pa;Ua=Ga();if(Ua!==ha)if(Na(),Ua=Wa(),Ua!==ha)if(Na(),Ua=P(),Ua!==ha)if(Na(),hb=ab(),hb!==ha)if(Na(),hb=Z(),hb!==ha){Na();var sb=cb();sb!==ha?(bb=Ia,Ia={type:"interval-period",period:"second",precision:Ua,secondary:hb}):(pa=Ia,Ia=ha)}else pa=Ia,Ia=ha;else pa=Ia,Ia=ha;else pa=Ia,Ia=ha;else pa=Ia,Ia=ha;else pa=Ia,Ia=ha;Ia===ha&&(Ia=pa,Ua=Ga(),Ua!==ha?(Na(),Ua=Wa(),Ua!==ha?(Na(),Ua=
P(),Ua!==ha?(Na(),hb=cb(),hb!==ha?(bb=Ia,Ia={type:"interval-period",period:"second",precision:Ua,secondary:null}):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha)):(pa=Ia,Ia=ha),Ia===ha&&(Ia=pa,Ua=Ga(),Ua!==ha&&(bb=Ia,Ua={type:"interval-period",period:"second",precision:null,secondary:null}),Ia=Ua))}Ia!==ha?(bb=ya,ya={type:"interval-qualifier",start:Ea,end:Ia}):(pa=ya,ya=ha)}else pa=ya,ya=ha;else pa=ya,ya=ha;ya===ha&&(ya=pa,Ia=U(),Ia!==ha?(Na(),Ea=Wa(),Ea!==ha?(Na(),Ea=Z(),Ea!==ha?(Na(),Ua=cb(),Ua!==ha?
(bb=ya,ya={type:"interval-period",period:Ia.value,precision:Ea,secondary:null}):(pa=ya,ya=ha)):(pa=ya,ya=ha)):(pa=ya,ya=ha)):(pa=ya,ya=ha),ya===ha&&(ya=pa,Ia=U(),Ia!==ha&&(bb=ya,Ia={type:"interval-period",period:Ia.value,precision:null,secondary:null}),ya=Ia,ya===ha&&(ya=pa,Ia=Ga(),Ia!==ha?(Na(),Ea=Wa(),Ea!==ha?(Na(),Ea=P(),Ea!==ha?(Na(),Ua=ab(),Ua!==ha?(Na(),Ia=Z(),Ia!==ha?(Na(),Ua=cb(),Ua!==ha?(bb=ya,ya={type:"interval-period",period:"second",precision:Ea,secondary:Ia}):(pa=ya,ya=ha)):(pa=ya,ya=
ha)):(pa=ya,ya=ha)):(pa=ya,ya=ha)):(pa=ya,ya=ha)):(pa=ya,ya=ha),ya===ha&&(ya=pa,Ia=Ga(),Ia!==ha?(Na(),Ea=Wa(),Ea!==ha?(Na(),Ea=Z(),Ea!==ha?(Na(),Ua=cb(),Ua!==ha?(bb=ya,ya={type:"interval-period",period:"second",precision:Ea,secondary:null}):(pa=ya,ya=ha)):(pa=ya,ya=ha)):(pa=ya,ya=ha)):(pa=ya,ya=ha),ya===ha&&(ya=pa,Ia=Ga(),Ia!==ha&&(bb=ya,Ia={type:"interval-period",period:"second",precision:null,secondary:null}),ya=Ia)))));return ya}function U(){var ya=pa;var Ea=za();Ea!==ha&&(bb=ya,Ea={type:"string",
value:"day"});ya=Ea;ya===ha&&(ya=pa,Ea=ta(),Ea!==ha&&(bb=ya,Ea={type:"string",value:"hour"}),ya=Ea,ya===ha&&(ya=pa,Ea=Ca(),Ea!==ha&&(bb=ya,Ea={type:"string",value:"minute"}),ya=Ea,ya===ha&&(ya=pa,Ea=oa(),Ea!==ha&&(bb=ya,Ea={type:"string",value:"month"}),ya=Ea,ya===ha&&(ya=pa,Ea=ja(),Ea!==ha&&(bb=ya,Ea={type:"string",value:"year"}),ya=Ea))));return ya}function Z(){var ya=pa;var Ea=ia();Ea!==ha&&(bb=ya,Ea=parseFloat(Ea));return Ea}function P(){var ya=pa;var Ea=ia();Ea!==ha&&(bb=ya,Ea=parseFloat(Ea));
return Ea}function R(){var ya=W();ya===ha&&(ya=T());return ya}function W(){var ya=pa;if(39===l.charCodeAt(pa)){var Ea=Hb;pa++}else Ea=ha,0===Xa&&n(sd);Ea===ha&&(l.substr(pa,2)===Mb?(Ea=Mb,pa+=2):(Ea=ha,0===Xa&&n(Yd)));if(Ea!==ha){Ea=[];var Ia=pa;if(l.substr(pa,2)===Ha){var Ua=Ha;pa+=2}else Ua=ha,0===Xa&&n(td);Ua!==ha&&(bb=Ia,Ua="'");Ia=Ua;Ia===ha&&(cd.test(l.charAt(pa))?(Ia=l.charAt(pa),pa++):(Ia=ha,0===Xa&&n(ud)));for(;Ia!==ha;)Ea.push(Ia),Ia=pa,l.substr(pa,2)===Ha?(Ua=Ha,pa+=2):(Ua=ha,0===Xa&&n(td)),
Ua!==ha&&(bb=Ia,Ua="'"),Ia=Ua,Ia===ha&&(cd.test(l.charAt(pa))?(Ia=l.charAt(pa),pa++):(Ia=ha,0===Xa&&n(ud)));39===l.charCodeAt(pa)?(Ia=Hb,pa++):(Ia=ha,0===Xa&&n(sd));Ia!==ha?(bb=ya,ya={type:"string",value:Ea.join("")}):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function N(){var ya=pa;if(Ra()!==ha){Na();var Ea=v();if(Ea!==ha){Na();var Ia=Ya();Ia!==ha?(Na(),Ia=v(),Ia!==ha?(bb=ya,ya={type:"when-clause",operand:Ea,value:Ia}):(pa=ya,ya=ha)):(pa=ya,ya=ha)}else pa=ya,ya=ha}else pa=ya,ya=ha;return ya}function V(){var ya=
pa;if(Ra()!==ha){Na();var Ea=v();if(Ea!==ha){Na();var Ia=Ya();Ia!==ha?(Na(),Ia=v(),Ia!==ha?(bb=ya,ya={type:"when-clause",operand:Ea,value:Ia}):(pa=ya,ya=ha)):(pa=ya,ya=ha)}else pa=ya,ya=ha}else pa=ya,ya=ha;return ya}function S(){var ya=pa;var Ea=pa;if(l.substr(pa,4).toLowerCase()===ad){var Ia=l.substr(pa,4);pa+=4}else Ia=ha,0===Xa&&n(Ig);if(Ia!==ha){Ia=pa;Xa++;var Ua=K();Xa--;Ua===ha?Ia=void 0:(pa=Ia,Ia=ha);Ia!==ha?(bb=Ea,Ea="ELSE"):(pa=Ea,Ea=ha)}else pa=Ea,Ea=ha;Ea!==ha?(Na(),Ea=v(),Ea!==ha?(bb=
ya,ya={type:"else-clause",value:Ea}):(pa=ya,ya=ha)):(pa=ya,ya=ha);return ya}function X(){var ya=ia();if(ya===ha){ya=pa;if(45===l.charCodeAt(pa)){var Ea=rb;pa++}else Ea=ha,0===Xa&&n(pc);Ea===ha&&(43===l.charCodeAt(pa)?(Ea=zb,pa++):(Ea=ha,0===Xa&&n(oc)));if(Ea!==ha){var Ia=ia();Ia!==ha?(bb=ya,ya=Ea[0]+Ia):(pa=ya,ya=ha)}else pa=ya,ya=ha}return ya}function ca(){var ya=pa;if(46===l.charCodeAt(pa)){var Ea=Oa;pa++}else Ea=ha,0===Xa&&n(Zd);Ea!==ha?(Ea=ia(),Ea===ha&&(Ea=null),bb=ya,ya="."+(null!=Ea?Ea:"")):
(pa=ya,ya=ha);return ya}function ba(){var ya;var Ea=ya=pa;if(Rd.test(l.charAt(pa))){var Ia=l.charAt(pa);pa++}else Ia=ha,0===Xa&&n(vd);Ia!==ha?(Sd.test(l.charAt(pa))?(Ia=l.charAt(pa),pa++):(Ia=ha,0===Xa&&n(wd)),Ia===ha&&(Ia=null),bb=Ea,Ea="e"+(null===Ia?"":Ia)):(pa=Ea,Ea=ha);Ea!==ha?(Ia=ia(),Ia!==ha?(bb=ya,ya=Ea+Ia):(pa=ya,ya=ha)):(pa=ya,ya=ha);return ya}function ia(){var ya=pa;var Ea=[];var Ia=ka();if(Ia!==ha)for(;Ia!==ha;)Ea.push(Ia),Ia=ka();else Ea=ha;Ea!==ha&&(bb=ya,Ea=Ea.join(""));return Ea}function ka(){if(Qd.test(l.charAt(pa))){var ya=
l.charAt(pa);pa++}else ya=ha,0===Xa&&n($d);return ya}function na(){var ya=pa;if(l.substr(pa,2).toLowerCase()===nb){var Ea=l.substr(pa,2);pa+=2}else Ea=ha,0===Xa&&n(ce);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="IN"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function Y(){var ya=pa;if(l.substr(pa,2).toLowerCase()===vb){var Ea=l.substr(pa,2);pa+=2}else Ea=ha,0===Xa&&n(de);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=
ya,ya="IS"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function ea(){var ya=pa;if(l.substr(pa,4).toLowerCase()===Kb){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(ee);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="LIKE"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function fa(){var ya=pa;if(l.substr(pa,3).toLowerCase()===va){var Ea=l.substr(pa,3);pa+=3}else Ea=ha,0===Xa&&n(fe);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=
ya,ya="NOT"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function aa(){var ya=pa;if(l.substr(pa,3).toLowerCase()===Fa){var Ea=l.substr(pa,3);pa+=3}else Ea=ha,0===Xa&&n(ge);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="AND"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function da(){var ya=pa;if(l.substr(pa,2).toLowerCase()===Pa){var Ea=l.substr(pa,2);pa+=2}else Ea=ha,0===Xa&&n(he);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=
ya,ya="OR"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function ma(){var ya=pa;if(l.substr(pa,7).toLowerCase()===Qa){var Ea=l.substr(pa,7);pa+=7}else Ea=ha,0===Xa&&n(Bd);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="BETWEEN"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function ua(){var ya=pa;if(l.substr(pa,4).toLowerCase()===$a){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(yd);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?
(bb=ya,ya="FROM"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function sa(){var ya=pa;if(l.substr(pa,4).toLowerCase()===ub){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(Jg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="TRIM"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function ra(){var ya=pa;if(l.substr(pa,9).toLowerCase()===yb){var Ea=l.substr(pa,9);pa+=9}else Ea=ha,0===Xa&&n(Kg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==
ha?(bb=ya,ya="TIMESTAMP"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function Aa(){var ya=pa;if(l.substr(pa,4).toLowerCase()===Fb){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(Lg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="DATE"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function qa(){var ya=pa;if(l.substr(pa,4).toLowerCase()===Sb){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(Mg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=
ha);Ea!==ha?(bb=ya,ya="TIME"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function la(){var ya=pa;if(l.substr(pa,8).toLowerCase()===Yb){var Ea=l.substr(pa,8);pa+=8}else Ea=ha,0===Xa&&n(Ng);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="INTERVAL"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function ja(){var ya=pa;if(l.substr(pa,4).toLowerCase()===lc){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(Og);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=
Ea,Ea=ha);Ea!==ha?(bb=ya,ya="YEAR"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function oa(){var ya=pa;if(l.substr(pa,5).toLowerCase()===bc){var Ea=l.substr(pa,5);pa+=5}else Ea=ha,0===Xa&&n(Pg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="MONTH"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function za(){var ya=pa;if(l.substr(pa,3).toLowerCase()===mc){var Ea=l.substr(pa,3);pa+=3}else Ea=ha,0===Xa&&n(Qg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:
(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="DAY"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function ta(){var ya=pa;if(l.substr(pa,4).toLowerCase()===Tb){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(Rg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="HOUR"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function Ca(){var ya=pa;if(l.substr(pa,6).toLowerCase()===tc){var Ea=l.substr(pa,6);pa+=6}else Ea=ha,0===Xa&&n(Sg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:
(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="MINUTE"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function Ga(){var ya=pa;if(l.substr(pa,6).toLowerCase()===Qb){var Ea=l.substr(pa,6);pa+=6}else Ea=ha,0===Xa&&n(Tg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="SECOND"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function La(){var ya=pa;if(l.substr(pa,4).toLowerCase()===cc){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(Ug);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=
void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="CASE"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function Ma(){var ya=pa;if(l.substr(pa,3).toLowerCase()===hd){var Ea=l.substr(pa,3);pa+=3}else Ea=ha,0===Xa&&n(Vg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="END"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function Ra(){var ya=pa;if(l.substr(pa,4).toLowerCase()===$c){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(Wg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?
Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="WHEN"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function Ya(){var ya=pa;if(l.substr(pa,4).toLowerCase()===id){var Ea=l.substr(pa,4);pa+=4}else Ea=ha,0===Xa&&n(Xg);if(Ea!==ha){Ea=pa;Xa++;var Ia=K();Xa--;Ia===ha?Ea=void 0:(pa=Ea,Ea=ha);Ea!==ha?(bb=ya,ya="THEN"):(pa=ya,ya=ha)}else pa=ya,ya=ha;return ya}function ab(){if(44===l.charCodeAt(pa)){var ya=jd;pa++}else ya=ha,0===Xa&&n(Yg);return ya}function Wa(){if(40===l.charCodeAt(pa)){var ya=Nd;pa++}else ya=ha,0===
Xa&&n(Zg);return ya}function cb(){if(41===l.charCodeAt(pa)){var ya=Od;pa++}else ya=ha,0===Xa&&n($g);return ya}function Na(){var ya;var Ea=[];for(ya=xa();ya!==ha;)Ea.push(ya),ya=xa();return Ea}function xa(){if(Td.test(l.charAt(pa))){var ya=l.charAt(pa);pa++}else ya=ha,0===Xa&&n(ah);return ya}function Da(ya,Ea,Ia,Ua){ya={type:"binary-expression",operator:ya,left:Ea,right:Ia};void 0!==Ua&&(ya.escape=Ua);return ya}function Ka(ya,Ea){for(var Ia=0;Ia<Ea.length;Ia++)ya=Da(Ea[Ia][1],ya,Ea[Ia][3]);return ya}
e=void 0!==e?e:{};var ha={},Sa=e.grammarSource,Va={start:q},wa=q,Ba="!",Ja="\x3d",Ta="\x3e\x3d",db="\x3e",lb="\x3c\x3d",mb="\x3c\x3e",ob="\x3c",pb="!\x3d",zb="+",rb="-",Jb="||",fb="*",Cb="/",Lb="@",Hb="'",Mb="N'",Ha="''",Oa=".",Za="null",ib="true",jb="false",nb="in",vb="is",Kb="like",gb="escape",va="not",Fa="and",Pa="or",Qa="between",$a="from",eb="for",kb="substring",tb="extract",ub="trim",xb="position",yb="timestamp",Fb="date",Sb="time",Pb="leading",qb="trailing",wb="both",Ab="cast",Gb="as",Ib="integer",
Ub="smallint",Vb="float",$b="real",ac="varchar",kc="to",Yb="interval",lc="year",ec="timezone_hour",Zb="timezone_minute",bc="month",mc="day",Tb="hour",tc="minute",Qb="second",cc="case",hd="end",$c="when",id="then",ad="else",jd=",",Nd="(",Od=")",kd="`",ld=/^[A-Za-z_\x80-\uFFFF]/,md=/^[A-Za-z0-9_]/,bd=/^[A-Za-z0-9_.\x80-\uFFFF]/,Pd=/^["]/,cd=/^[^']/,Qd=/^[0-9]/,Rd=/^[eE]/,Sd=/^[+\-]/,Td=/^[ \t\n\r]/,Ud=/^[^`]/,Ie=h("!",!1),Vd=h("\x3d",!1),Dc=h("\x3e\x3d",!1),Ec=h("\x3e",!1),Bc=h("\x3c\x3d",!1),dd=h("\x3c\x3e",
!1),Wd=h("\x3c",!1),Cc=h("!\x3d",!1),oc=h("+",!1),pc=h("-",!1),nd=h("||",!1),od=h("*",!1),pd=h("/",!1),qd=u([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),uc=u([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),rd=u([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Je=u(['"'],!1,!1),Xd=h("@",!1),sd=h("'",!1),Yd=h("N'",!1),td=h("''",!1),ud=u(["'"],!0,!1),Zd=h(".",!1),$d=u([["0","9"]],!1,!1),vd=u(["e","E"],!1,!1),wd=u(["+","-"],!1,!1),xd=h("NULL",!0),zd=h("TRUE",!0),be=h("FALSE",!0),
ce=h("IN",!0),de=h("IS",!0),ee=h("LIKE",!0),Ad=h("ESCAPE",!0),fe=h("NOT",!0),ge=h("AND",!0),he=h("OR",!0),Bd=h("BETWEEN",!0),yd=h("FROM",!0),Ke=h("FOR",!0),Le=h("SUBSTRING",!0),ae=h("EXTRACT",!0),Jg=h("TRIM",!0),Xf=h("POSITION",!0),Kg=h("TIMESTAMP",!0),Lg=h("DATE",!0),Mg=h("TIME",!0),Eg=h("LEADING",!0),Fg=h("TRAILING",!0),Gg=h("BOTH",!0),bg=h("CAST",!0),eg=h("AS",!0),hg=h("INTEGER",!0),jg=h("SMALLINT",!0),lg=h("FLOAT",!0),ng=h("REAL",!0),pg=h("VARCHAR",!0),Hg=h("TO",!0),Ng=h("INTERVAL",!0),Og=h("YEAR",
!0),Kf=h("TIMEZONE_HOUR",!0),Mf=h("TIMEZONE_MINUTE",!0),Pg=h("MONTH",!0),Qg=h("DAY",!0),Rg=h("HOUR",!0),Sg=h("MINUTE",!0),Tg=h("SECOND",!0),Ug=h("CASE",!0),Vg=h("END",!0),Wg=h("WHEN",!0),Xg=h("THEN",!0),Ig=h("ELSE",!0),Yg=h(",",!1),Zg=h("(",!1),$g=h(")",!1),ah=u([" ","\t","\n","\r"],!1,!1),yf=h("`",!1),zf=u(["`"],!0,!1),pa=0,bb=0,ie=[{line:1,column:1}],qc=0,Me=[],Xa=0;if("startRule"in e){if(!(e.startRule in Va))throw Error("Can't start parsing from rule \""+e.startRule+'".');wa=Va[e.startRule]}var $e=
wa();if($e!==ha&&pa===l.length)return $e;$e!==ha&&pa<l.length&&n({type:"end"});throw function(ya,Ea,Ia){return new f(f.buildMessage(ya,Ea),ya,Ea,Ia)}(Me,qc<l.length?l.charAt(qc):null,qc<l.length?x(qc,qc+1):x(qc,qc));}}})})(g);var d=g.exports;class k{static parse(m){return d.parse(m)}}a.WhereGrammar=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(a,b,
g){const d=new g,k=new g,m=new g,f={esriGeometryPoint:b.convertToPoint,esriGeometryPolyline:b.convertToPolyline,esriGeometryPolygon:b.convertToPolygon,esriGeometryMultipoint:b.convertToMultipoint},c=(l,e)=>"_geVersion"!==l?e:void 0;a.cleanFromGeometryEngine=function(l){return l&&"_geVersion"in l?JSON.parse(JSON.stringify(l,c)):l};a.getGeometry=function(l,e,p,h,u,w,x=e,n=p){const q=e&&x,t=p&&n;h=null!=h?"coords"in h?h:h.geometry:null;if(null==h)return null;if(u)return e=b.generalizeOptimizedGeometry(k,
h,e,p,l,u,x,n),w&&(e=b.quantizeOptimizedGeometry(m,e,q,t,l,w)),f[l]?.(e,q,t)??null;if(w)return w=b.quantizeOptimizedGeometry(m,h,e,p,l,w,x,n),f[l]?.(w,q,t)??null;b.removeZMValues(d,h,e,p,x,n);return f[l]?.(d,q,t)??null};a.transformCentroid=function(l,e,p,h=l.hasZ,u=l.hasM){if(null==e)return null;const w=l.hasZ&&h,x=l.hasM&&u;return p?(l=b.quantizeOptimizedGeometry(m,e,l.hasZ,l.hasM,"esriGeometryPoint",p,h,u),b.convertToPoint(l,w,x)):b.convertToPoint(e,w,x)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(a,b,g,d,k,m,f){function c(n,q){if(!q)return null;if("x"in q){var t={x:0,y:0};[t.x,t.y]=n(q.x,q.y,p);null!=q.z&&(t.z=q.z);null!=q.m&&(t.m=q.m);return t}return"xmin"in q?(t={xmin:0,
ymin:0,xmax:0,ymax:0},[t.xmin,t.ymin]=n(q.xmin,q.ymin,p),[t.xmax,t.ymax]=n(q.xmax,q.ymax,p),q.hasZ&&(t.zmin=q.zmin,t.zmax=q.zmax,t.hasZ=!0),q.hasM&&(t.mmin=q.mmin,t.mmax=q.mmax,t.hasM=!0),t):"rings"in q?{rings:l(q.rings,n),hasM:q.hasM,hasZ:q.hasZ}:"paths"in q?{paths:l(q.paths,n),hasM:q.hasM,hasZ:q.hasZ}:"points"in q?{points:e(q.points,n),hasM:q.hasM,hasZ:q.hasZ}:null}function l(n,q){const t=[];for(const v of n)t.push(e(v,q));return t}function e(n,q){const t=[];for(const v of n)n=q(v[0],v[1],[0,0]),
t.push(n),2<v.length&&n.push(v[2]),3<v.length&&n.push(v[3]);return t}const p=[0,0],h=c.bind(null,f.lngLatToXY),u=c.bind(null,f.xyToLngLat);class w{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(n,q,t,v){if(!n?.length||!q||!t||m.equals(q,t))return n;n={geometries:n,inSpatialReference:q,outSpatialReference:t,geographicTransformation:v,resolve:g.createResolver()};this._jobs.push(n);this._timer??(this._timer=setTimeout(this._process,10));return n.resolve.promise}_process(){this._timer=
null;const n=this._jobs.shift();if(n){var {geometries:q,inSpatialReference:t,outSpatialReference:v,resolve:r,geographicTransformation:y}=n;f.canProject(t,v)?m.isWebMercator(v)?r(q.map(h)):r(q.map(u)):r(d.projectMany(k.jsonAdapter,q,t,v,y,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}}}const x=new w;a.checkProjectionSupport=async function(n,q){n&&q&&(n=Array.isArray(n)?n.map(t=>null!=t.geometry?t.geometry.spatialReference:null).filter(b.isSome):[n],await d.initializeProjection(n.map(t=>
({source:t,dest:q}))))};a.project=function(n,q,t,v){if(!n)return n;t||(t=q,q=n.spatialReference);return m.isValid(q)&&m.isValid(t)&&!m.equals(q,t)?f.canProject(q,t)?(n=m.isWebMercator(t)?h(n):u(n),n.spatialReference=t,n):d.projectMany(k.jsonAdapter,[n],q,t,null,v)[0]:n};a.projectMany=function(n,q,t,v){return x.push(n,q,t,v)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){class b{constructor(f,c,l){this.x=
f;this.y=c;this.spatialReference=l;this.m=this.z=void 0}}class g{constructor(f,c,l,e){this.rings=f;this.spatialReference=c;this.hasM=this.hasZ=void 0;l&&(this.hasZ=l);e&&(this.hasM=e)}}class d{constructor(f,c,l,e){this.paths=f;this.spatialReference=c;this.hasM=this.hasZ=void 0;l&&(this.hasZ=l);e&&(this.hasM=e)}}class k{constructor(f,c,l,e){this.points=f;this.spatialReference=c;this.hasM=this.hasZ=void 0;l&&(this.hasZ=l);e&&(this.hasM=e)}}class m{constructor(f,c,l,e,p){this.xmin=f;this.ymin=c;this.xmax=
l;this.ymax=e;this.spatialReference=p;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}a.jsonAdapter={convertToGEGeometry:function(f,c){return null==c?null:f.convertJSONToGeometry(c)},exportPoint:function(f,c,l){l=new b(f.getPointX(c),f.getPointY(c),l);const e=f.hasZ(c),p=f.hasM(c);e&&(l.z=f.getPointZ(c));p&&(l.m=f.getPointM(c));return l},exportPolygon:function(f,c,l){return new g(f.exportPaths(c),l,f.hasZ(c),f.hasM(c))},exportPolyline:function(f,c,l){return new d(f.exportPaths(c),l,f.hasZ(c),f.hasM(c))},
exportMultipoint:function(f,c,l){return new k(f.exportPoints(c),l,f.hasZ(c),f.hasM(c))},exportExtent:function(f,c,l){var e=f.hasZ(c);const p=f.hasM(c);l=new m(f.getXMin(c),f.getYMin(c),f.getXMax(c),f.getYMax(c),l);e&&(e=f.getZExtent(c),l.zmin=e.vmin,l.zmax=e.vmax);p&&(f=f.getMExtent(c),l.mmin=f.vmin,l.mmax=f.vmax);return l}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/lang ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./geometryUtils ./projectionSupport ./SnappingCandidate ../../support/fieldUtils ../../../statistics/utils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(t,v,r,y){const z=y.x-r.x;y=y.y-r.y;v=Math.min(1,Math.max(0,((v.x-r.x)*z+(v.y-r.y)*y)/(z*z+y*y)));t.x=r.x+z*v;t.y=r.y+y*v}function x(t,v){return t?v?4:3:v?3:2}class n{constructor(t,v,r){this.items=t;this.query=v;this.geometryType=r.geometryType;this.hasM=r.hasM;this.hasZ=r.hasZ;this.fieldsIndex=r.fieldsIndex;this.objectIdField=r.objectIdField;this.spatialReference=r.spatialReference;this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const t=
new c(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return t.countDistinctValues(this.items);const {groupByFieldsForStatistics:v,having:r,outStatistics:y}=this.query;if(!v?.length)return 1;const z=new Map,D=new Map,C=new Set;for(const F of y){var {statisticType:E}=F;E="exceedslimit"!==E?F.onStatisticField:void 0;if(!D.has(E)){var A=[];for(const G of v){const I=this._getAttributeValues(t,G,z);A.push(I)}D.set(E,this._calculateUniqueValues(A,t.returnDistinctValues))}E=
D.get(E);for(const G in E){const {data:I,items:H}=E[G];A=I.join(",");r&&!t.validateItems(H,r)||C.add(A)}}return C.size}async createQueryResponse(){let t;t=this.query.outStatistics?this.query.outStatistics.some(v=>"exceedslimit"===v.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const v=this.query.geometry;f.isValid(this.query.outSR)&&!f.equals(v.spatialReference,
this.query.outSR)?t.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...e.project(v,v.spatialReference,this.query.outSR)}):t.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...v})}return t}createSnappingResponse(t,v){const r=this.featureAdapter,y=x(this.hasZ,this.hasM),{point:z,mode:D}=t,C="number"===typeof t.distance?t.distance:t.distance.x,E="number"===typeof t.distance?t.distance:t.distance.y,A={candidates:[]},F="esriGeometryPolygon"===this.geometryType;
v=this._getPointCreator(D,this.spatialReference,v);const G=new q(null,0),I=new q(null,0),H={x:0,y:0,z:0};for(const Q of this.items){var B=r.getGeometry(Q);if(null==B)continue;const {coords:O,lengths:U}=B;G.coords=O;I.coords=O;if(t.returnEdge){B=0;for(var K=0;K<U.length;K++){var L=U[K];for(var J=0;J<L;J++,B+=y){var M=G;M.coordsIndex=B;if(J!==L-1){const Z=I;Z.coordsIndex=B+y;const P=H;w(H,z,M,Z);var T=(z.x-P.x)/C;const R=(z.y-P.y)/E;T=T*T+R*R;1>=T&&A.candidates.push(p.makeEdgeCandidate(r.getObjectId(Q),
v(P),Math.sqrt(T),v(M),v(Z)))}}}}if("none"!==t.vertexMode)if(B=F?O.length-y:O.length,"all"===t.vertexMode)for(K=0;K<B;K+=y)L=G,L.coordsIndex=K,J=(z.x-L.x)/C,M=(z.y-L.y)/E,J=J*J+M*M,1>=J&&A.candidates.push(p.makeVertexCandidate(r.getObjectId(Q),v(L),Math.sqrt(J)));else if("ends"===t.vertexMode){B=[0];F||B.push(O.length-y);for(const Z of B)B=G,B.coordsIndex=Z,K=(z.x-B.x)/C,L=(z.y-B.y)/E,K=K*K+L*L,1>=K&&A.candidates.push(p.makeVertexCandidate(r.getObjectId(Q),v(B),Math.sqrt(K)))}}A.candidates.sort((Q,
O)=>Q.distance-O.distance);return A}_getPointCreator(t,v,r){const y=null==r||f.equals(v,r)?D=>D:D=>e.project(D,v,r),{hasZ:z}=this;return"3d"===t?z?({x:D,y:C,z:E})=>y({x:D,y:C,z:E}):({x:D,y:C})=>y({x:D,y:C,z:0}):({x:D,y:C})=>y({x:D,y:C})}async createSummaryStatisticsResponse(t){const {field:v,valueExpression:r,normalizationField:y,normalizationType:z,normalizationTotal:D,minValue:C,maxValue:E,scale:A,timeZone:F}=t;var G=this.fieldsIndex.get(v);t=h.isDateField(G)||h.isDateOnlyField(G)||h.isTimestampOffsetField(G);
const I=await this._getDataValues({field:v,valueExpression:r,normalizationField:y,normalizationType:z,normalizationTotal:D,scale:A,timeZone:F}),H=u.isNullCountSupported({normalizationType:z,normalizationField:y,minValue:C,maxValue:E}),B={value:.5,fieldType:G?.type};G=h.isStringField(G)?u.calculateStringStatistics({values:I,supportsNullCount:H,percentileParams:B}):u.calculateStatistics({values:I,minValue:C,maxValue:E,useSampleStdDev:!z,supportsNullCount:H,percentileParams:B});return u.processSummaryStatisticsResult(G,
t)}async createUniqueValuesResponse(t){const {field:v,valueExpression:r,domains:y,returnAllCodedValues:z,scale:D,timeZone:C}=t;var E=await this._getDataValues({field:v,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:r,scale:D,timeZone:C},!1);E=u.calculateUniqueValuesCount(E);return u.createUVResult(E,y,z,t.fieldDelimiter)}async createClassBreaksResponse(t){const {field:v,valueExpression:r,normalizationField:y,normalizationType:z,normalizationTotal:D,classificationMethod:C,
standardDeviationInterval:E,minValue:A,maxValue:F,numClasses:G,scale:I,timeZone:H}=t;t=await this._getDataValues({field:v,valueExpression:r,normalizationField:y,normalizationType:z,normalizationTotal:D,scale:I,timeZone:H});t=u.calculateClassBreaks(t,{field:v,normalizationField:y,normalizationType:z,normalizationTotal:D,classificationMethod:C,standardDeviationInterval:E,minValue:A,maxValue:F,numClasses:G});return u.resolveCBResult(t,C)}async createHistogramResponse(t){const {field:v,valueExpression:r,
normalizationField:y,normalizationType:z,normalizationTotal:D,classificationMethod:C,standardDeviationInterval:E,minValue:A,maxValue:F,numBins:G,scale:I,timeZone:H}=t;t=await this._getDataValues({field:v,valueExpression:r,normalizationField:y,normalizationType:z,normalizationTotal:D,scale:I,timeZone:H});return u.calculateHistogram(t,{field:v,normalizationField:y,normalizationType:z,normalizationTotal:D,classificationMethod:C,standardDeviationInterval:E,minValue:A,maxValue:F,numBins:G})}_sortFeatures(t,
v,r){if(1<t.length&&v?.length)for(const y of v.reverse()){v=y.split(" ");const z=v[0],D=this.fieldsIndex.get(z);v=v[1]?"desc"===v[1].toLowerCase():!1;const C=u.getAttributeComparator(D?.type,v);t.sort((E,A)=>{E=r(E,z,D);A=r(A,z,D);return C(E,A)})}}_createFeatureQueryResponse(t){const v=this.items,{geometryType:r,hasM:y,hasZ:z,objectIdField:D,spatialReference:C}=this,{outFields:E,outSR:A,quantizationParameters:F,resultRecordCount:G,resultOffset:I,returnZ:H,returnM:B}=t,K=null!=G?v.length>(I||0)+G:
!1,L=E&&(E.includes("*")?[...this.fieldsIndex.fields]:E.map(J=>this.fieldsIndex.get(J)));return{exceededTransferLimit:K,features:this._createFeatures(t,v),fields:L,geometryType:r,hasM:y&&B,hasZ:z&&H,objectIdFieldName:D,spatialReference:l.cleanFromGeometryEngine(A||C),transform:F&&m.toQuantizationTransform(F)||null}}_createFeatures(t,v){const r=new c(t,this.featureAdapter,this.fieldsIndex),{hasM:y,hasZ:z}=this,{orderByFields:D,quantizationParameters:C,returnGeometry:E,returnCentroid:A,maxAllowableOffset:F,
resultOffset:G,resultRecordCount:I,returnZ:H=!1,returnM:B=!1}=t,K=z&&H,L=y&&B;t=[];var J=0;v=[...v];this._sortFeatures(v,D,(Q,O,U)=>r.getFieldValue(Q,O,U));if(this.geometryType&&(E||A)){var M=m.toQuantizationTransform(C)??void 0;if(E&&!A)for(var T of v)t[J++]={attributes:r.getAttributes(T),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(T),F,M,K,L)};else if(!E&&A)for(const Q of v)t[J++]={attributes:r.getAttributes(Q),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(Q,
this),M)};else for(const Q of v)t[J++]={attributes:r.getAttributes(Q),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),M),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),F,M,K,L)}}else for(M of v)(T=r.getAttributes(M))&&(t[J++]={attributes:T});J=G||0;null!=I&&(t=t.slice(J,Math.min(t.length,J+I)));return t}_createExceedsLimitQueryResponse(t){var v=!1;let r=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY;v=Number.POSITIVE_INFINITY;
for(const z of t.outStatistics??[])if("exceedslimit"===z.statisticType){r=null!=z.maxPointCount?z.maxPointCount:Number.POSITIVE_INFINITY;y=null!=z.maxRecordCount?z.maxRecordCount:Number.POSITIVE_INFINITY;v=null!=z.maxVertexCount?z.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)v=this.items.length>r;else if(this.items.length>y)v=!0;else{t=x(this.hasZ,this.hasM);const z=this.featureAdapter;v=this.items.reduce((D,C)=>{C=z.getGeometry(C);return D+(null!=C&&C.coords.length||
0)},0)/t>v}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(v)}}]}}async _createStatisticsQueryResponse(t){var v={attributes:{}};const r=[],y=new Map,z=new Map,D=new Map,C=new Map,E=new c(t,this.featureAdapter,this.fieldsIndex);var A=t.outStatistics;const {groupByFieldsForStatistics:F,having:G,orderByFields:I,resultRecordCount:H}=t;t=F?.length;const B=!!t,K=B?F[0]:
null,L=B&&!this.fieldsIndex.get(K);for(const O of A??[]){const {outStatisticFieldName:U,statisticType:Z}=O;A=O;const P="exceedslimit"!==Z?O.onStatisticField:void 0,R="percentile_disc"===Z||"percentile_cont"===Z;var J="EnvelopeAggregate"===Z||"CentroidAggregate"===Z||"ConvexHullAggregate"===Z;const W=B&&1===t&&(P===K||L)&&"count"===Z;if(B){if(!D.has(P)){var M=[];for(const N of F){var T=this._getAttributeValues(E,N,y);M.push(T)}D.set(P,this._calculateUniqueValues(M,J?!1:E.returnDistinctValues))}M=D.get(P);
if(!M)continue;T=Object.keys(M);for(const N of T){const {count:V,data:S,items:X,itemPositions:ca}=M[N];T=S.join(",");if(!G||E.validateItems(X,G)){const ba=C.get(T)||{attributes:{}};if(J){ba.aggregateGeometries||(ba.aggregateGeometries={});const {aggregateGeometries:ka,outStatisticFieldName:na}=await this._getAggregateGeometry(A,X);ba.aggregateGeometries[na]=ka}else{var Q=null;if(W)Q=V;else{const ka=this._getAttributeValues(E,P,y);Q=ca.map(na=>ka[na]);Q=R&&"statisticParameters"in A?this._getPercentileValue(A,
Q):this._getStatisticValue(A,Q,null,E.returnDistinctValues)}ba.attributes[U]=Q}let ia=0;F.forEach((ka,na)=>ba.attributes[this.fieldsIndex.get(ka)?ka:`EXPR_${++ia}`]=S[na]);C.set(T,ba)}}}else if(J){v.aggregateGeometries||(v.aggregateGeometries={});const {aggregateGeometries:N,outStatisticFieldName:V}=await this._getAggregateGeometry(A,this.items);v.aggregateGeometries[V]=N}else J=this._getAttributeValues(E,P,y),v.attributes[U]=R&&"statisticParameters"in A?this._getPercentileValue(A,J):this._getStatisticValue(A,
J,z,E.returnDistinctValues);A="min"!==Z&&"max"!==Z||!h.isStringField(this.fieldsIndex.get(P))&&!this._isAnyDateField(P)?null:this.fieldsIndex.get(P)?.type;r.push({name:U,alias:U,type:A||"esriFieldTypeDouble"})}v=B?Array.from(C.values()):[v];this._sortFeatures(v,I,(O,U)=>O.attributes[U]);H&&(v.length=Math.min(H,v.length));return{fields:r,features:v}}_isAnyDateField(t){t=this.fieldsIndex.get(t);return h.isDateField(t)||h.isDateOnlyField(t)||h.isTimestampOffsetField(t)||h.isTimeOnlyField(t)}async _getAggregateGeometry(t,
v){const {convexHull:r,union:y}=await new Promise((H,B)=>a(["../../../geometry/geometryEngineJSON"],H,B)),{statisticType:z,outStatisticFieldName:D}=t,{featureAdapter:C,spatialReference:E,geometryType:A,hasZ:F,hasM:G}=this;v=v.map(H=>l.getGeometry(A,F,G,C.getGeometry(H)));const I=r(E,v,!0)[0];t={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===z?(v=I?k.getPolygonExtent(I):k.getGeometryExtent(y(E,v)),t.aggregateGeometries={...v,spatialReference:E},t.outStatisticFieldName=D||
"extent"):"CentroidAggregate"===z?(v=I?d.polygonCentroid(I):d.extentCentroid(k.getGeometryExtent(y(E,v))),t.aggregateGeometries={x:v[0],y:v[1],spatialReference:E},t.outStatisticFieldName=D||"centroid"):"ConvexHullAggregate"===z&&(t.aggregateGeometries=I,t.outStatisticFieldName=D||"convexHull");return t}_getStatisticValue(t,v,r,y){const {onStatisticField:z,statisticType:D}=t;t=null;t=r?.has(z)?r.get(z):h.isStringField(this.fieldsIndex.get(z))||this._isAnyDateField(z)?u.calculateStringStatistics({values:v,
returnDistinct:y}):u.calculateStatistics({values:y?[...(new Set(v))]:v,minValue:null,maxValue:null,useSampleStdDev:!0});r&&r.set(z,t);return t["var"===D?"variance":D]}_getPercentileValue(t,v){const {onStatisticField:r,statisticParameters:y,statisticType:z}=t,{value:D,orderBy:C}=y;t=this.fieldsIndex.get(r);return u.calculatePercentile(v,{value:D,orderBy:C,fieldType:t?.type,isDiscrete:"percentile_disc"===z})}_getAttributeValues(t,v,r){if(r.has(v))return r.get(v);const y=this.fieldsIndex.get(v),z=this.items.map(D=>
t.getFieldValue(D,v,y));r.set(v,z);return z}_calculateUniqueValues(t,v){const r={},y=this.items,z=y.length;for(let D=0;D<z;D++){const C=y[D],E=[];for(const F of t)E.push(F[D]);const A=E.join(",");null==r[A]?r[A]={count:1,data:E,items:[C],itemPositions:[D]}:(v||r[A].count++,r[A].items.push(C),r[A].itemPositions.push(D))}return r}async _getDataValues(t,v=!0){const r=new c(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:y,scale:z,timeZone:D}=t;return y?r.getExpressionValues(this.items,
y,{viewingMode:"map",scale:z,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},D):r.getDataValues(this.items,g.clone(t),v)}}class q{constructor(t,v){this.coords=t;this.coordsIndex=v}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}b.QueryEngineResult=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define("./attributeSupport ./geometryUtils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(a,b,g,d,k,m){class f{constructor(c,l,e){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=c.returnDistinctValues??!1;this.fieldsIndex=e;this.featureAdapter=l;if((l=c.outFields)&&!l.includes("*")){this.outFields=l;c=0;for(const h of l){var p=a.getExpressionFromFieldName(h);p=(l=this.fieldsIndex.get(p))?null:a.getWhereClause(p,e);l=l?l.name:a.getAliasFromFieldName(h)||`FIELD_EXP_${c++}`;this._fieldDataCache.set(h,{alias:l,clause:p})}}}countDistinctValues(c){if(!this.returnDistinctValues)return c.length;
c.forEach(l=>this.getAttributes(l));return this._returnDistinctMap.size}getAttributes(c){c=this._processAttributesForOutFields(c);return this._processAttributesForDistinctValues(c)}getFieldValue(c,l,e){const p=e?e.name:l;let h=null;this._fieldDataCache.has(p)?h=this._fieldDataCache.get(p)?.clause:e||(h=a.getWhereClause(l,this.fieldsIndex),this._fieldDataCache.set(p,{alias:p,clause:h}));return e?this.featureAdapter.getAttribute(c,p):h?.calculateValue(c,this.featureAdapter)}getDataValues(c,l,e=!0){const p=
l.normalizationType,h=l.normalizationTotal,u=this.fieldsIndex.get(l.field),w=g.isDateOnlyField(u)||g.isTimestampOffsetField(u),x=g.isTimeOnlyField(u);return c.map(n=>{let q=l.field&&this.getFieldValue(n,l.field,this.fieldsIndex.get(l.field));l.field2?(q=`${k.processNullValue(q)}${l.fieldDelimiter}${k.processNullValue(this.getFieldValue(n,l.field2,this.fieldsIndex.get(l.field2)))}`,l.field3&&(q=`${q}${l.fieldDelimiter}${k.processNullValue(this.getFieldValue(n,l.field3,this.fieldsIndex.get(l.field3)))}`)):
"string"===typeof q&&e&&(w?q=q?(new Date(q)).getTime():null:x&&(q=q?d.timeOnlyToMilliseconds(q):null));p&&Number.isFinite(q)&&(n="field"===p&&l.normalizationField?this.getFieldValue(n,l.normalizationField,this.fieldsIndex.get(l.normalizationField)):null,q=k.getNormalizedValue(q,p,n,h));return q})}async getExpressionValues(c,l,e,p,h){const {arcadeUtils:u}=await m.loadArcade(),w=u.hasGeometryOperations(l);w&&await u.enableGeometryOperations();const x=u.createFunction(l),n=u.getViewInfo(e),q={fields:this.fieldsIndex.fields};
return c.map(t=>{t={attributes:this.featureAdapter.getAttributes(t),layer:q,geometry:w?{...b.getGeometry(p.geometryType,p.hasZ,p.hasM,this.featureAdapter.getGeometry(t)),spatialReference:e?.spatialReference}:null};t=u.createExecContext(t,n,h);return u.executeFunction(x,t)})}validateItem(c,l){this._fieldDataCache.has(l)||this._fieldDataCache.set(l,{alias:l,clause:a.getWhereClause(l,this.fieldsIndex)});return this._fieldDataCache.get(l)?.clause?.testFeature(c,this.featureAdapter)??!1}validateItems(c,
l){this._fieldDataCache.has(l)||this._fieldDataCache.set(l,{alias:l,clause:a.getWhereClause(l,this.fieldsIndex)});return this._fieldDataCache.get(l)?.clause?.testSet(c,this.featureAdapter)??!1}_processAttributesForOutFields(c){const l=this.outFields;if(!l?.length)return this.featureAdapter.getAttributes(c);const e={};for(const p of l){const {alias:h,clause:u}=this._fieldDataCache.get(p);e[h]=u?u.calculateValue(c,this.featureAdapter):this.featureAdapter.getAttribute(c,h)}return e}_processAttributesForDistinctValues(c){if(null==
c||!this.returnDistinctValues)return c;var l=this.outFields,e=[];if(l)for(const h of l){var {alias:p}=this._fieldDataCache.get(h);e.push(c[p])}else for(p in c)e.push(c[p]);l=`${(l||["*"]).join(",")}=${e.join(",")}`;e=this._returnDistinctMap.get(l)||0;this._returnDistinctMap.set(l,++e);return 1<e?null:c}}return f})},"esri/smartMapping/statistics/support/utils":function(){define("exports ../../../geometry ../../../core/Error ../../../core/screenUtils ../../../core/timeUtils ../../../geometry/SpatialReference ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/support/fieldUtils ../../../renderers/support/heatmapUtils ../../support/utils ../../../statistics/utils ../../../support/arcadeOnDemand ../../../geometry/Point".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){function x(y){y=r.exec(y);if(!y)return null;const {hh:z,mm:D,ss:C,ms:E}=y.groups;return Number(z)*k.millisecondsPerTimeUnit.hours+Number(D)*k.millisecondsPerTimeUnit.minutes+Number(C)*k.millisecondsPerTimeUnit.seconds+Number(E||0)}function n(y,z){y=null!=y?y:"";null!=z&&z&&(y=y?"("+y+") AND ("+z+")":z);return y}function q(y){const z=y.layer;return y.fields.filter(D=>!z.getField(D))}function t(y){const z=y.layer;return y.fields.filter(D=>{D=z.getFieldUsageInfo(D);
return!D||!D.supportsStatistics})}let v=null;const r=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;a.calculateHeatmapStats=function(y,z=18,D,C,E,A){const F=new Float64Array(E*A);z=Math.round(d.pt2px(z));let G=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY;var H=0;let B=0,K=0,L=0;D=e.createValueFunction(C,D);for(const {geometry:M,attributes:T}of y){const {x:Q,y:O}=M;y=Math.max(0,Q-z);H=Math.max(0,O-z);C=Math.min(A,O+z);const U=Math.min(E,Q+z),Z=+D(T);
for(let P=H;P<C;P++)for(let R=y;R<U;R++){H=P*E+R;const W=e.evaluateDensityKernel(R-Q,P-O,z);var J=F[H];H=F[H]+=W*Z;J=H-J;B+=J;K+=J*J;H<G&&(G=H);H>I&&(I=H);L++}}return L?{mean:B/L,stdDev:Math.sqrt((K-B*B/L)/L),min:G,max:I,mid:(I-G)/2,count:L}:{mean:0,stddev:0,min:0,max:0,mid:0,count:0}};a.getDataValues=async function(y,z,D=!0){if(!z)return[];const {field:C,field2:E,field3:A,fieldDelimiter:F,fieldInfos:G,timeZone:I}=y;var H=C&&G?.find(P=>P.name.toLowerCase()===C.toLowerCase());const B=H?l.isTimeOnlyField(H):
!1,K=H?p.isAnyDateField(H):!1,L=y.valueExpression,J=y.normalizationType,M=y.normalizationField,T=y.normalizationTotal,Q=[];H=y.viewInfoParams;let O=null,U=null;if(L){if(!v){const {arcadeUtils:P}=await u.loadArcade();v=P}v.hasGeometryOperations(L)&&await v.enableGeometryOperations();O=v.createFunction(L);U=H?v.getViewInfo({viewingMode:H.viewingMode,scale:H.scale,spatialReference:new m(H.spatialReference)}):null}y=y.fieldInfos;const Z=z[0]&&"declaredClass"in z[0]&&"esri.Graphic"===z[0].declaredClass||
!y?null:{fields:y};z.forEach(P=>{var R=P.attributes;if(L){var W=v.createExecContext(Z?{...P,layer:Z}:P,U,I);W=v.executeFunction(O,W)}else R&&(W=R[C],E?(W=`${h.processNullValue(W)}${F}${h.processNullValue(R[E])}`,A&&(W=`${W}${F}${h.processNullValue(R[A])}`)):"string"===typeof W&&D&&(K?W=W?(new Date(W)).getTime():null:B&&(W=W?x(W):null)));J&&"number"===typeof W&&isFinite(W)&&(R=R&&parseFloat(R[M]),W=h.getNormalizedValue(W,J,R,T));Q.push(W)});return Q};a.getRangeExpr=function(y,z,D){z=null!=z?y+" \x3e\x3d "+
z:"";y=null!=D?y+" \x3c\x3d "+D:"";D="";return(D=z&&y?n(z,y):z||y)?"("+D+")":""};a.getSQLFilterForNormalization=function(y){const z=y.field,D=y.normalizationType;y=y.normalizationField;let C;if("field"===D)C="(NOT "+y+" \x3d 0)";else if("log"===D||"natural-log"===D||"square-root"===D)C=`(${z} > 0)`;return C};a.getSumOfAttributesExpr=function(y,z,D){const C=[],E=[],A=[],F=[],G=[];y.forEach((B,K)=>{const L=B.field?"field":"expression",J=B.field||B.valueExpression;B.field?(G.push(J),E.push(`var ${L}${K} = Number($feature["${J}"]);`)):
(C.push(`function getValueForExpr${K}() {\n  ${J} \n}`),E.push(`var ${L}${K} = Number(getValueForExpr${K}());`));D||A.push(`${L}${K} = IIf(${L}${K} < 0, 0, ${L}${K});`);F.push(`${L}${K}`)});y="return sum;";const I=C.length?null:G.reduce((B,K)=>`${B} + ${K}`);let H=null;z||D?z?D||(y="return IIf(sum \x3e\x3d 0, sum, null);",I&&(H=`(( ${I} ) >= 0)`)):(y="return IIf(sum !\x3d 0, sum, null);",I&&(H=`(( ${I} ) <> 0)`)):(y="return IIf(sum \x3e 0, sum, null);",I&&(H=`(( ${I} ) > 0)`));return{valueExpression:[C.length?
C.join("\n"):"",E.join("\n"),A.join("\n"),`var sum = ${F.join(" + ")};`,y].filter(Boolean).join("\n\n"),sqlExpression:I,sqlWhere:H}};a.mergeWhereClauses=n;a.quantizeFeatures=function(y,z,D,C){const E=c.isWrappable(D)?c.getInfo(D):null,A=E?Math.round((E.valid[1]-E.valid[0])/z.scale[0]):null;return y.map(F=>{const G=new w(F.geometry);f.quantizePoint(z,G,G,G.hasZ,G.hasM);if(E){var I=A??0,H=C[0];0>G.x?G.x+=I:G.x>H&&(G.x-=I)}F.geometry=G;return F})};a.timeOnlyToMilliseconds=x;a.verifyBasicFieldValidity=
function(y,z,D){const C=q({layer:y,fields:z});if(C.length)return new g(D,"Unknown fields: "+C.join(", ")+". You can only use fields defined in the layer schema");y=t({layer:y,fields:z});if(y.length)return new g(D,"Unsupported fields: "+y.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};a.verifyFieldType=function(y,z,D,C){let E;z?z.name!==y.objectIdField&&C.includes(z.type)||(E=new g(D,"'field' should be one of these types: "+C.join(","))):
E=new g(D,"'field' is not defined in the layer schema");return E};a.verifyFilterValidty=function(y,z){if(y&&"intersects"!==y.spatialRelationship)return new g(z,"Only 'intersects' spatialRelationship is supported for featureFilter")};a.verifyNumericField=function(y,z,D){let C;z?z.name!==y.objectIdField&&l.isNumericField(z)||(C=new g(D,"'field' should be one of these numeric types: "+l.numericTypes.join(","))):C=new g(D,"'field' is not defined in the layer schema");return C};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),function(a,b,g,d,k,m){function f(w){return String(w).padStart(2,"0")}function c(w,x,n){if("date"===x||"number"===x){"number"===x&&(w=new Date(w));x=n?w.getFullYear():w.getUTCFullYear();const q=f((n?w.getMonth():w.getUTCMonth())+1),t=f(n?w.getDate():w.getUTCDate()),
v=f(n?w.getHours():w.getUTCHours()),r=f(n?w.getMinutes():w.getUTCMinutes());w=f(n?w.getSeconds():w.getUTCSeconds());w=`TIMESTAMP'${x}-${q}-${t} ${v}:${r}:${w}'`}return w}function l(w,x){if(x instanceof Date)return"date";if("number"===typeof x)return"number";if("string"===typeof x&&(w=w.getField(x),"\x3cnow\x3e"!==x.toLowerCase()&&g.isDateField(w)))return"field"}const e={light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},p={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},h=new Set(["integer","small-integer"]);let u=null;a.castIntegerFieldToFloat=function(w){return`cast(${w} as float)`};a.dateTypes=["date","date-only","timestamp-offset"];
a.defaultBasemapGroups=e;a.fieldDelimiter=",";a.formatAnyDate=function(w,x){const {format:n,timeZoneOptions:q,fieldType:t}=x??{};let v;q&&({timeZone:r,timeZoneName:v}=m.getTimeZoneFormattingOptions(q.layerTimeZone,q.datesInUnknownTimezone,q.viewTimeZone,b.convertDateFormatToIntlOptions(n||"short-date-short-time"),t));if("string"===typeof w&&isNaN(Date.parse("time-only"===t?`1970-01-01T${w}Z`:w)))return w;switch(t){case "date-only":var r=b.convertDateFormatToIntlOptions(n||"short-date");return"string"===
typeof w?b.formatDateOnly(w,{...r}):b.formatDate(w,{...r,timeZone:m.utc});case "time-only":return r=b.convertDateFormatToIntlOptions(n||"short-time"),"string"===typeof w?b.formatTimeOnly(w,r):b.formatDate(w,{...r,timeZone:m.utc});case "timestamp-offset":if(!r&&"string"===typeof w&&(new Date(w)).toISOString()!==w)return w;r=(x=n||q?b.convertDateFormatToIntlOptions(n||"short-date-short-time"):void 0)?{...x,timeZone:r,timeZoneName:v}:void 0;return"string"===typeof w?b.formatTimestamp(w,r):b.formatDate(w,
r);default:return x=n||q?b.convertDateFormatToIntlOptions(n||"short-date-short-time"):void 0,b.formatDate("string"===typeof w?new Date(w):w,x?{...x,timeZone:r,timeZoneName:v}:void 0)}};a.getBasemapGroup=function(w,x=e){for(const n in x)if(x[n].includes(w))return n};a.getBasemapId=function(w,x,n=!0){let q=null;w&&("string"===typeof w?x.includes(w)&&(q=w):q=k.getWellKnownBasemapId(w));return n?q||"gray":q};a.getDateDiffSQL=function(w,x,n,q){const {hasQueryEngine:t}=w;n=c(n,l(w,n),t);w=c(x,l(w,x),t);
w=`(${n} - ${w})`;q=p[q];x="/";1>q&&(q=1/q,x="*");return{sqlExpression:1===q?w:`(${w} ${x} ${q})`,sqlWhere:null}};a.getDateType=l;a.getFieldsList=async function(w){const {field:x,field2:n,field3:q,normalizationField:t,valueExpression:v}=w;w=[];v&&(u||({arcadeUtils:w}=await d.loadArcade(),u=w),w=u.extractFieldNames(v));x&&w.push(x);n&&w.push(n);q&&w.push(q);t&&w.push(t);return w};a.getNormalizationType=function(w){let x=w.normalizationType;x||(w.normalizationField?x="field":null!=w.normalizationTotal&&
(x="percent-of-total"));return x??void 0};a.isAnyDateField=function(w){return g.isDateField(w)||g.isDateOnlyField(w)||g.isTimestampOffsetField(w)};a.isIntegerField=function(w,x){w=x&&w.getField(x);return!!w&&h.has(w.type)};a.unitValueInDays=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,b,g){function d(H){return null==H||"string"===typeof H&&
!H?"\x3cNull\x3e":H}function k(H){const B=null!=H.minValue||null!=H.maxValue,K=!!H.sqlExpression&&H.supportsSQLExpression;return!(null!=H.normalizationField||null!=H.normalizationType)&&!B&&!K}function m(H){const {values:B,useSampleStdDev:K,supportsNullCount:L}=H;var J=Number.POSITIVE_INFINITY;let M=Number.NEGATIVE_INFINITY,T=null,Q=null;var O=null;let U=null,Z=0;const P=null==H.minValue?-Infinity:H.minValue,R=null==H.maxValue?Infinity:H.maxValue;for(const W of B)Number.isFinite(W)?W>=P&&W<=R&&(T=
null===T?W:T+W,J=Math.min(J,W),M=Math.max(M,W),Z++):"string"===typeof W&&Z++;if(Z&&null!=T){Q=T/Z;O=0;for(const W of B)Number.isFinite(W)&&W>=P&&W<=R&&(O+=(W-Q)**2);U=K?1<Z?O/(Z-1):0:0<Z?O/Z:0;O=Math.sqrt(U)}else M=J=null;J={avg:Q,count:Z,max:M,min:J,stddev:O,sum:T,variance:U};L&&(J.nullcount=B.length-Z);H.percentileParams&&(J.median=f(B,H.percentileParams));return J}function f(H,B){const {fieldType:K,value:L,orderBy:J,isDiscrete:M}=B,T=c(K,"desc"===J);H=[...H].filter(Z=>null!=Z).sort((Z,P)=>T(Z,
P));if(0===H.length)return null;if(0>=L)return H[0];if(1<=L)return H[H.length-1];var Q=(H.length-1)*L,O=Math.floor(Q);B=O+1;Q%=1;O=H[O];const U=H[B];return B>=H.length||M||"string"===typeof O||"string"===typeof U?O:O*(1-Q)+U*Q}function c(H,B){if(H){if(v.has(H))return B?G:I;if(r.has(H))return l(B,!1);if("esriFieldTypeTimestampOffset"===H)return B?E:C;const M=l(B,!0);if("esriFieldTypeString"===H)return M;if("esriFieldTypeGUID"===H||"esriFieldTypeGlobalID"===H)return(T,Q)=>M(e(T),e(Q))}const K=B?1:-1,
L=B?G:I,J=l(B,!0);return(M,T)=>"number"===typeof M&&"number"===typeof T?L(M,T):"string"===typeof M&&"string"===typeof T?J(M,T):K}function l(H,B){if(!B)return H?F:A;const K=H?z:D;return H?(L,J)=>{const M=K(L,J);if(null!=M)return M;L=L.toUpperCase();J=J.toUpperCase();return L>J?-1:L<J?1:0}:(L,J)=>{const M=K(L,J);if(null!=M)return M;L=L.toUpperCase();J=J.toUpperCase();return L<J?-1:L>J?1:0}}function e(H){return H.substr(24,12)+H.substr(19,4)+H.substr(16,2)+H.substr(14,2)+H.substr(11,2)+H.substr(9,2)+
H.substr(6,2)+H.substr(4,2)+H.substr(2,2)+H.substr(0,2)}function p(H){return"coded-value"!==H?.type?[]:H.codedValues.map(B=>B.code)}function h(H,B){const K=w({field:B.field,normalizationType:B.normalizationType,normalizationField:B.normalizationField,classificationMethod:B.classificationMethod,standardDeviationInterval:B.standardDeviationInterval,breakCount:B.numClasses||5});H=u(H,B.minValue,B.maxValue);return g.createGenerateRendererClassBreaks({definition:K,values:H,normalizationTotal:B.normalizationTotal})}
function u(H,B,K){const L=null==B?-Infinity:B,J=null==K?Infinity:K;return H.filter(M=>Number.isFinite(M)&&M>=L&&M<=J)}function w(H){const {breakCount:B,field:K,normalizationField:L,normalizationType:J}=H,M=H.classificationMethod||"equal-interval";return new b({breakCount:B,classificationField:K,classificationMethod:M,normalizationField:"field"===J?L:void 0,normalizationType:J,standardDeviationInterval:"standard-deviation"===M?H.standardDeviationInterval||1:void 0})}function x(H,B){const {field:K,
classificationMethod:L,standardDeviationInterval:J,normalizationType:M,normalizationField:T,normalizationTotal:Q,minValue:O,maxValue:U}=B,Z=B.numBins||10;let P=B=null,R=null;L&&"equal-interval"!==L||M?({classBreaks:H}=h(H,{field:K,normalizationType:M,normalizationField:T,normalizationTotal:Q,classificationMethod:L,standardDeviationInterval:J,minValue:O,maxValue:U,numClasses:Z}),B=H[0].minValue,P=H[H.length-1].maxValue,R=H.map(W=>[W.minValue,W.maxValue])):(null!=O&&null!=U?(B=O,P=U):(H=m({values:H,
minValue:O,maxValue:U,useSampleStdDev:!M,supportsNullCount:k({normalizationType:M,normalizationField:T,minValue:O,maxValue:U})}),B=H.min??null,P=H.max??null),R=q(B??0,P??0,Z));return{min:B,max:P,intervals:R}}function n(H,B){let K=-1;for(let L=H.length-1;0<=L;L--)if(B>=H[L][0]){K=L;break}return K}function q(H,B,K){const L=(B-H)/K,J=[];let M;for(let T=1;T<=K;T++)M=H+L,M=Number(M.toFixed(16)),J.push([H,T===K?B:M]),H=M;return J}const t=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,v=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),
r=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),y="min max avg stddev count sum variance nullcount median".split(" "),z=(H,B)=>null==H?null==B?0:1:null==B?-1:null,D=(H,B)=>null==H?null==B?0:-1:null==B?1:null,C=(H,B)=>D(H,B)??(H===B?0:(new Date(H)).getTime()-(new Date(B)).getTime()),E=(H,B)=>z(H,B)??(H===B?0:(new Date(B)).getTime()-(new Date(H)).getTime()),A=(H,B)=>D(H,B)??(H===B?0:H<B?-1:1),F=(H,B)=>z(H,B)??(H===B?0:H<B?1:-1),G=(H,B)=>z(H,B)??B-H,I=(H,B)=>D(H,B)??H-B;a.calculateClassBreaks=
h;a.calculateHistogram=function(H,B){var K=x(H,B);if(null==K.min&&null==K.max)return{bins:[],minValue:K.min,maxValue:K.max,normalizationTotal:B.normalizationTotal};const L=K.intervals,J=K.min??0;K=K.max??0;const M=L.map((T,Q)=>({minValue:L[Q][0],maxValue:L[Q][1],count:0}));for(const T of H)null!=T&&T>=J&&T<=K&&(H=n(L,T),-1<H&&M[H].count++);return{bins:M,minValue:J,maxValue:K,normalizationTotal:B.normalizationTotal}};a.calculatePercentile=f;a.calculateStatistics=m;a.calculateStringStatistics=function(H){const B=
H.returnDistinct?[...(new Set(H.values))]:H.values;var K=B.filter(J=>null!=J).sort();const L=K.length;K={count:L,min:K[0],max:K[L-1]};H.supportsNullCount&&(K.nullcount=B.length-L);H.percentileParams&&(K.median=f(B,H.percentileParams));return K};a.calculateUniqueValuesCount=function(H){const B={};for(let K of H){if(null==K||"string"===typeof K&&""===K.trim())K=null;null==B[K]?B[K]={count:1,data:K}:B[K].count++}return{count:B}};a.createClassBreaksDefinition=w;a.createUVResult=function(H,B,K,L){H=H.count;
const J=[];if(K&&B){K=[];var M=p(B[0]);for(const T of M)if(B[1]){M=p(B[1]);for(const Q of M)if(B[2]){M=p(B[2]);for(const O of M)K.push(`${d(T)}${L}${d(Q)}${L}${d(O)}`)}else K.push(`${d(T)}${L}${d(Q)}`)}else K.push(T);for(const T of K)H.hasOwnProperty(T)||(H[T]={data:T,count:0})}for(const T in H)B=H[T],J.push({value:B.data,count:B.count,label:B.label});return{uniqueValueInfos:J}};a.getAttributeComparator=c;a.getEqualIntervalBins=q;a.getNormalizedValue=function(H,B,K,L){let J=null;switch(B){case "log":0!==
H&&(J=Math.log(H)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(L)&&0!==L&&(J=H/L*100);break;case "field":Number.isFinite(K)&&0!==K&&(J=H/K);break;case "natural-log":0<H&&(J=Math.log(H));break;case "square-root":0<H&&(J=H**.5)}return J};a.isNullCountSupported=k;a.processNullValue=d;a.processSummaryStatisticsResult=function(H,B){let K;for(K in H)y.includes(K)&&(Number.isFinite(H[K])||(H[K]=null));if(!B)return H;["avg","stddev","variance"].forEach(L=>{null!=H[L]&&(H[L]=Math.ceil(H[L]??
0))});return H};a.resolveCBResult=function(H,B){let K=H.classBreaks;const L=K[0]?.minValue,J=K[K.length-1]?.maxValue,M="standard-deviation"===B;K=K.map(T=>{const Q=T.label;T={minValue:T.minValue,maxValue:T.maxValue,label:Q};if(M&&Q){const O=Q.match(t)?.map(U=>+U.trim())??[];2===O.length?(T.minStdDev=O[0],T.maxStdDev=O[1],0>O[0]&&0<O[1]&&(T.hasAvg=!0)):1===O.length&&(Q.includes("\x3c")?(T.minStdDev=null,T.maxStdDev=O[0]):Q.includes("\x3e")&&(T.minStdDev=O[0],T.maxStdDev=null))}return T});return{minValue:L,
maxValue:J,classBreakInfos:K,normalizationTotal:H.normalizationTotal}};a.statisticTypes=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c,l){k=new b.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});b=new b.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});g=class extends g.JSONSupport{constructor(e){super(e);this.type="class-breaks-definition";
this.normalizationType=this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};a.__decorate([c.enumeration({classBreaksDef:"class-breaks-definition"})],g.prototype,"type",void 0);a.__decorate([d.property({json:{write:!0}})],g.prototype,
"breakCount",void 0);a.__decorate([d.property({json:{write:!0}})],g.prototype,"classificationField",void 0);a.__decorate([d.property({type:String,json:{read:k.read,write:k.write}})],g.prototype,"classificationMethod",void 0);a.__decorate([d.property({json:{write:!0}})],g.prototype,"normalizationField",void 0);a.__decorate([d.property({json:{read:b.read,write:b.write}})],g.prototype,"normalizationType",void 0);a.__decorate([d.property({value:null,json:{write:!0}})],g.prototype,"standardDeviationInterval",
null);a.__decorate([d.property({value:null,json:{write:!0}})],g.prototype,"definedInterval",null);return g=a.__decorate([l.subclass("esri.rest.support.ClassBreaksDefinition")],g)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,b){function g(u){var w=u.definition;const {classificationMethod:x,normalizationType:n,definedInterval:q}=w;w=w.breakCount??1;const t=[];var v=u.values;if(0===v.length)return[];v=v.sort((E,A)=>E-A);var r=v[0],y=v[v.length-
1];if("equal-interval"===x)if(v.length>=w){v=(y-r)/w;u=r;for(var z=1;z<w;z++){var D=Number((r+z*v).toFixed(6));t.push({minValue:u,maxValue:D,label:d(u,D,n)});u=D}t.push({minValue:u,maxValue:y,label:d(u,y,n)})}else v.forEach(E=>{t.push({minValue:E,maxValue:E,label:d(E,E,n)})});else if("natural-breaks"===x){v=k(v);u=m(v.uniqueValues,u.valueFrequency||v.valueFrequency,w);for(z=1;z<w;z++)v.uniqueValues.length>z&&(D=Number(v.uniqueValues[u[z]].toFixed(6)),t.push({minValue:r,maxValue:D,label:d(r,D,n)}),
r=D);t.push({minValue:r,maxValue:y,label:d(r,y,n)})}else if("quantile"===x)if(v.length>=w&&r!==y){u=Math.ceil(v.length/w);z=0;for(D=1;D<w;D++){var C=u+z-1;C>v.length&&(C=v.length-1);0>C&&(C=0);t.push({minValue:r,maxValue:v[C],label:d(r,v[C],n)});r=v[C];z+=u;u=Math.ceil((v.length-z)/(w-D))}t.push({minValue:r,maxValue:y,label:d(r,y,n)})}else for(w=-1,y=0;y<v.length;y++)r=v[y],r!==w&&(w=r,t.push({minValue:w,maxValue:r,label:d(w,r,n)}),w=r);else if("standard-deviation"===x)if(u=l(v),z=e(v,u),0===z)t.push({minValue:v[0],
maxValue:v[0],label:d(v[0],v[0],n)});else{v=c(r,y,w,u,z)*z;z=0;for(D=w;1<=D;D--)C=Number((u-(D-.5)*v).toFixed(6)),t.push({minValue:r,maxValue:C,label:d(r,C,n)}),r=C,z++;D=Number((u+.5*v).toFixed(6));t.push({minValue:r,maxValue:D,label:d(r,D,n)});r=D;z++;for(C=1;C<=w;C++)D=z===2*w?y:Number((u+(C+.5)*v).toFixed(6)),t.push({minValue:r,maxValue:D,label:d(r,D,n)}),r=D,z++}else if("defined-interval"===x){if(!q)return t;w=v[0];y=v[v.length-1];v=Math.ceil((y-w)/q);r=w;for(u=1;u<v;u++)z=Number((w+u*q).toFixed(6)),
t.push({minValue:r,maxValue:z,label:d(r,z,n)}),r=z;t.push({minValue:r,maxValue:y,label:d(r,y,n)})}return t}function d(u,w,x){let n=null;return n=u===w?x&&"percent-of-total"===x?u+"%":u.toString():x&&"percent-of-total"===x?u+"% - "+w+"%":u+" - "+w}function k(u){const w=[],x=[];let n=Number.MIN_VALUE,q=1,t=-1;for(let v=0;v<u.length;v++){const r=u[v];r===n?(q++,x[t]=q):null!==r&&(w.push(r),n=r,q=1,x.push(q),t++)}return{uniqueValues:w,valueFrequency:x}}function m(u,w,x){var n=u.length;const q=[];x>n&&
(x=n);for(var t=0;t<x;t++)q.push(Math.round(t*n/x-1));q.push(n-1);t=f(q,u,w,x);n=t.mean;t=t.sdcm;var v=x,r=0,y=0;let z=0,D=0,C=!0;for(let A=0;2>A&&C;A++){0===A&&(C=!1);for(var E=0;E<v-1;E++)for(;q[E+1]+1!==q[E+2];)if(q[E+1]+=1,r=p(E,q,u,w),z=r.sbMean,r=r.sbSdcm,y=p(E+1,q,u,w),D=y.sbMean,y=y.sbSdcm,r+y<t[E]+t[E+1])t[E]=r,t[E+1]=y,n[E]=z,n[E+1]=D,C=!0;else{--q[E+1];break}for(E=v-1;0<E;E--)for(;q[E]!==q[E-1]+1;)if(--q[E],r=p(E-1,q,u,w),z=r.sbMean,r=r.sbSdcm,y=p(E,q,u,w),D=y.sbMean,y=y.sbSdcm,r+y<t[E-
1]+t[E])t[E-1]=r,t[E]=y,n[E-1]=z,n[E]=D,C=!0;else{q[E]+=1;break}}C&&(t=f(q,u,w,x));return q}function f(u,w,x,n){let q=[];var t=[],v=[];let r=0;const y=[],z=[];for(var D=0;D<n;D++){var C=p(D,u,w,x);y.push(C.sbMean);z.push(C.sbSdcm);r+=z[D]}C=r;for(D=!0;D||r<C;){D=!1;q=[];for(t=0;t<n;t++)q.push(u[t]);for(v=0;v<n;v++)for(C=u[v]+1;C<=u[v+1];C++)if(t=w[C],0<v&&C!==u[v+1]&&Math.abs(t-y[v])>Math.abs(t-y[v-1]))u[v]=C;else if(v<n-1&&u[v]!==C-1&&Math.abs(t-y[v])>Math.abs(t-y[v+1])){u[v+1]=C-1;break}C=r;r=0;
t=[];v=[];for(let E=0;E<n;E++){t.push(y[E]);v.push(z[E]);const A=p(E,u,w,x);y[E]=A.sbMean;z[E]=A.sbSdcm;r+=z[E]}}if(r>C){for(w=0;w<n;w++)u[w]=q[w],y[w]=t[w],z[w]=v[w];r=C}return{mean:y,sdcm:z}}function c(u,w,x,n,q){u=Math.max(n-u,w-n)/q/x;return 1<=u?1:.5<=u?.5:.25}function l(u){let w=0;for(let x=0;x<u.length;x++)w+=u[x];return w/=u.length}function e(u,w){let x=0;for(let n=0;n<u.length;n++){const q=u[n];x+=(q-w)*(q-w)}x/=u.length;return Math.sqrt(x)}function p(u,w,x,n){var q=0,t=0;for(var v=w[u]+
1;v<=w[u+1];v++){const r=n[v];q+=x[v]*r;t+=r}0>=t&&h.warn("Exception in Natural Breaks calculation");q/=t;t=0;for(v=w[u]+1;v<=w[u+1];v++)t+=n[v]*(x[v]-q)**2;return{sbMean:q,sbSdcm:t}}const h=b.getLogger("esri.rest.support.generateRendererUtils");a.createGenerateRendererClassBreaks=function(u){const {normalizationTotal:w}=u;return{classBreaks:g(u),normalizationTotal:w}};a.createGenerateRendererUniqueValues=function(u){u=k(u);const w=[],x=u.uniqueValues.length;for(let n=0;n<x;n++){const q=u.uniqueValues[n];
w.push({value:q,count:u.valueFrequency[n],label:q.toString()})}return{uniqueValues:w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),function(a,
b,g,d,k,m,f,c,l,e){async function p(q,t,v){if(!q)return null;var {where:r}=q;q.where=r=r?.trim();if(!r||/^1 *= *1$/.test(r)||t&&t===r)q.where=null;if(!q.geometry)return q;t=await u(q);q.distance=0;q.units=null;"esriSpatialRelEnvelopeIntersects"===q.spatialRel&&({spatialReference:r}=q.geometry,t=m.getGeometryExtent(t),t.spatialReference=r);if(t){await e.checkProjectionSupport(t.spatialReference,v);r=t.spatialReference;t=h(t,v)&&f.isExtent(t)?{spatialReference:r,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],
[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t;r=(await c.normalizeCentralMeridian(f.fromJSON(t)))[0];if(null==r)throw n;const y="quantizationParameters"in q&&q.quantizationParameters?.tolerance||"maxAllowableOffset"in q&&q.maxAllowableOffset||0;t=y&&h(t,v)?{densificationStep:8*y}:void 0;r=r.toJSON();t=e.project(r,r.spatialReference,v,t);if(!t)throw n;t.spatialReference=v;q.geometry=t}return q}function h(q,t){if(!q)return!1;const v=q.spatialReference;return(f.isExtent(q)||f.isPolygon(q)||f.isPolyline(q))&&
!l.equals(v,t)&&!k.canProjectWithoutEngine(v,t)}async function u(q){const {distance:t,units:v}=q,r=q.geometry;if(null==t||"vertexAttributes"in r)return r;var y=r.spatialReference;q=v?x.fromJSON(v):d.getUnitString(y);y=y&&(l.isGeographic(y)||l.isWebMercator(y))?r:await e.checkProjectionSupport(y,l.WGS84).then(()=>e.project(r,l.WGS84));return(await w())(y.spatialReference,y,t,q)}async function w(){return(await new Promise((q,t)=>a(["../../../geometry/geometryEngineJSON"],q,t))).geodesicBuffer}const x=
new g.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),n=Object.freeze({});b.normalizeQuery=async function(q,t,v){const {outFields:r,orderByFields:y,groupByFieldsForStatistics:z,outStatistics:D}=q;if(r)for(var C=0;C<r.length;C++)r[C]=r[C].trim();if(y)for(C=0;C<y.length;C++)y[C]=y[C].trim();if(z)for(C=0;C<z.length;C++)z[C]=z[C].trim();if(D)for(C=
0;C<D.length;C++)D[C].onStatisticField&&(D[C].onStatisticField=D[C].onStatisticField.trim());q.geometry&&!q.outSR&&(q.outSR=q.geometry.spatialReference);return p(q,t,v)};b.normalizeQueryLike=p;b.queryEngineEmptyResult=n;b.unitsKebabDict=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryValidationUtils":function(){define("exports ../../../core/Error ./attributeSupport ./projectionSupport ./spatialQuerySupport ../../../support/arcadeOnDemand".split(" "),
function(a,b,g,d,k,m){function f(h,u,w){const {outFields:x,orderByFields:n,returnDistinctValues:q,outStatistics:t}=w,v=t?t.map(r=>r.outStatisticFieldName&&r.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(n&&0<n.length){const r=n.map(y=>{const z=y.toLowerCase();return z.includes(" asc")?z.split(" asc")[0]:z.includes(" desc")?z.split(" desc")[0]:y}).filter(y=>!v.includes(y));g.validateFields(h,u,r,{expressionName:"orderByFields",query:w})}if(x&&0<x.length)g.validateFields(h,u,x,{expressionName:"outFields",
query:w});else if(q)throw new b("unsupported-query","outFields should be specified for returnDistinctValues",{query:w});g.validateWhere(h,u,w.where,w)}function c(h,u,w){const {outStatistics:x,groupByFieldsForStatistics:n,having:q}=w;var t=n?.length,v=x?.length;if(q){if(!t||!v)throw new b("unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:w});g.validateHaving(h,u,q,x,w)}if(v&&e(x)){v=x.map(r=>r.onStatisticField).filter(Boolean);g.validateFields(h,
u,v,{expressionName:"onStatisticFields",query:w});t&&g.validateFields(h,u,n,{expressionName:"groupByFieldsForStatistics",query:w});for(const r of x){const {onStatisticField:y,statisticType:z}=r;if(("percentile_disc"===z||"percentile_cont"===z)&&"statisticParameters"in r){if({statisticParameters:t}=r,!t)throw new b("unsupported-query","statisticParameters should be set for percentile type",{definition:r,query:w});}else h.get(y)&&"count"!==z&&"min"!==z&&"max"!==z&&g.validateFields(h,u,[y],{expressionName:`outStatistics with '${z}' statistic type`,
allowedFieldTypes:p,query:w})}}}async function l(h,u,w,x){var n=[];w.valueExpression&&({arcadeUtils:n}=await m.loadArcade(),n=n.extractFieldNames(w.valueExpression));w.field&&n.push(w.field);w.field2&&n.push(w.field2);w.field3&&n.push(w.field3);w.normalizationField&&n.push(w.normalizationField);if(!n.length&&!w.valueExpression)throw new b("unsupported-query","field or valueExpression is required",{params:w});g.validateFields(h,u,n,{expressionName:"statistics",query:x})}function e(h){return null!=
h&&h.every(u=>"exceedslimit"!==u.statisticType)}const p=new Set([...g.numericFieldTypes,...g.allDateAndTimeFieldTypes]);a.validateQuery=async function(h,{fieldsIndex:u,geometryType:w,spatialReference:x,availableFields:n}){if(0>(h.distance??0)||null!=h.geometryPrecision||h.multipatchOption&&"xyFootprint"!==h.multipatchOption||h.pixelSize||h.relationParam||h.text)throw new b("unsupported-query","Unsupported query options",{query:h});f(u,n,h);c(u,n,h);return Promise.all([k.checkSpatialQuerySupport(h,
w,x),d.checkProjectionSupport(x,h.outSR)]).then(()=>h)};a.validateStatisticsQuery=async function(h,u,{fieldsIndex:w,geometryType:x,spatialReference:n,availableFields:q}){if(0>(h.distance??0)||null!=h.geometryPrecision||h.multipatchOption||h.pixelSize||h.relationParam||h.text||h.outStatistics||h.groupByFieldsForStatistics||h.having||h.orderByFields)throw new b("unsupported-query","Unsupported query options",{query:h});f(w,q,h);return Promise.all([l(w,q,u,h),k.checkSpatialQuerySupport(h,x,n),d.checkProjectionSupport(n,
h.outSR)]).then(()=>h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(a,b,g,d,k,m,f,c,l,e,p,h){function u(){return new Promise((t,
v)=>a(["../../../geometry/geometryEngineJSON"],t,v))}const w={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var x={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,
esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},n={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},q={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.canQueryWithRBush=function(t){if(m.isExtent(t))return!0;if(m.isPolygon(t)){for(const v of t.rings)if(5!==
v.length||v[0][0]!==v[1][0]||v[0][0]!==v[4][0]||v[2][0]!==v[3][0]||v[0][1]!==v[3][1]||v[0][1]!==v[4][1]||v[1][1]!==v[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=async function(t,v,r){const {spatialRel:y,geometry:z}=t;if(z){if(null==y||!0!==x[y])throw new g("unsupported-query","Unsupported query spatial relationship",{query:t});if(f.isValid(z.spatialReference)&&f.isValid(r)){if(null==z||!0!==n[m.getJsonType(z)])throw new g("unsupported-query","Unsupported query geometry type",{query:t});
if(null==v||!0!==q[v])throw new g("unsupported-query","Unsupported layer geometry type",{query:t});if(t.outSR)return h.checkProjectionSupport(t.geometry?.spatialReference,t.outSR)}}};b.getSpatialQueryOperator=function(t,v,r,y,z){if(m.isPolygon(v)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t)){const D=l.convertFromPolygon(new e,v,!1,!1);return Promise.resolve(C=>c.polygonContainsPoint(D,!1,!1,C))}if(m.isPolygon(v)&&"esriGeometryMultipoint"===r){const D=l.convertFromPolygon(new e,
v,!1,!1);if("esriSpatialRelContains"===t)return Promise.resolve(C=>c.polygonContainsMultipoint(D,!1,!1,C,y,z))}if(m.isExtent(v)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t))return Promise.resolve(D=>d.extentContainsPoint(v,p.getGeometry(r,y,z,D)));if(m.isExtent(v)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===t)return Promise.resolve(D=>d.extentContainsMultipoint(v,p.getGeometry(r,y,z,D)));if(m.isExtent(v)&&"esriSpatialRelIntersects"===t){const D=
k.getExtentIntersector(r);return Promise.resolve(C=>D(v,p.getGeometry(r,y,z,C)))}return u().then(D=>{const C=D[w[t]].bind(null,v.spatialReference,v);return E=>C(p.getGeometry(r,y,z,E))})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;a.extentIntersectsPoint=b.extentIntersectsPoint;
a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;a.extentIntersectsRings=b.extentIntersectsRings;a.getFeatureExtentIntersector=b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=b.segmentIntersects;a.getExtentIntersector=function(g){return"mesh"===g?b.extentIntersectsExtent:b.getFeatureExtentIntersector(g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],
function(a){function b(g,d,k,m,f){if(!g)return!1;d=d?k?4:3:k?3:2;const {coords:c,lengths:l}=g;k=!1;g=0;for(const p of l){var e=g;for(let h=g,u=g+p*d;h<u;h+=d){e=h+d;e===u&&(e=g);const w=c[h],x=c[h+1],n=c[e];e=c[e+1];(x<f&&e>=f||e<f&&x>=f)&&w+(f-x)/(e-x)*(n-w)<m&&(k=!k)}g+=p*d}return k}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(g,d,k,m,f,c){f=f?c?4:3:c?3:2;const {coords:l,lengths:e}=m;if(!e)return!1;for(let p=0,h=0;p<e.length;p++,h+=f)if(!b(g,d,k,l[h],l[h+1]))return!1;return!0};
a.polygonContainsPoint=function(g,d,k,m){return b(g,d,k,m.coords[0],m.coords[1])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function b(k,m,f,c,l){if(null!=c&&null!=l)return e=>{const p=k(e,m);e=k(e,f);return(null==p||p<=l)&&(null==e||e>=c)};if(null!=c)return e=>{e=k(e,f);return null==e||e>=c};if(null!=l)return e=>{e=k(e,m);return null==e||e<=l}}function g(k,m,f,c){if(null!=f&&null!=c&&f===c)return l=>
k(l,m)===f;if(null!=f&&null!=c)return l=>{l=k(l,m);return null!=l&&l>=f&&l<=c};if(null!=f)return l=>{l=k(l,m);return null!=l&&l>=f};if(null!=c)return l=>{l=k(l,m);return null!=l&&l<=c}}function d(){return()=>!1}a.getTimeExtent=async function(k,m){if(!k)return null;const f=m.featureAdapter,{startTimeField:c,endTimeField:l}=k;let e=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY;if(c&&l)await m.forEach(h=>{const u=f.getAttribute(h,c);h=f.getAttribute(h,l);null==u||isNaN(u)||(e=Math.min(e,u));null==
h||isNaN(h)||(p=Math.max(p,h))});else{const h=c||l;await m.forEach(u=>{u=f.getAttribute(u,h);null==u||isNaN(u)||(e=Math.min(e,u),p=Math.max(p,u))})}return{start:e,end:p}};a.getTimeOperator=function(k,m,f){if(!m||!k)return null;const {startTimeField:c,endTimeField:l}=k;if(!c&&!l)return null;const {start:e,end:p}=m;if(null===e&&null===p)return null;if(void 0===e&&void 0===p)return d();k=f.getAttributeAsTimestamp?.bind(f)??f.getAttribute.bind(f);return c&&l?b(k,c,l,e,p):g(k,c||l,e,p)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/queryForSymbologySnapping":function(){define(["exports","../../../../core/promiseUtils","../../../../support/arcadeOnDemand"],function(a,b,g){const d={candidates:[],sourceCandidateIndices:[]};a.queryForSymbologySnapping=async function(k,m,f){if(null==k||0===m.candidates.length)return d;var c=k.graphics3DGraphicsByObjectID??k.graphics3DGraphics,l=[];const e=[],{renderer:p}=k,h=null!=p&&"arcadeRequired"in p&&p.arcadeRequired?g.loadArcade():
null;var u=async(t,{graphic:v,graphics3DSymbol:r})=>{const y=await h;v=await k.getRenderingInfoAsync(v,p,y,{signal:f});return null==v?[]:r.queryForSnapping(t,x,v,f)};const {candidates:w,spatialReference:x}=m;for(m=0;m<w.length;++m){var n=w[m],{objectId:q}=n;q="number"===typeof q?c?.get(q):void 0;if(null==q)continue;const {graphics3DSymbol:t}=q;t.symbologySnappingSupported&&(l.push(u(n,q)),e.push(m))}if(0===l.length)return d;c=await Promise.all(l);b.throwIfAborted(f);l=[];u=[];for(m=0;m<c.length;++m){n=
c[m];q=e[m];for(const t of n)l.push(t),u.push(q)}return{candidates:l,sourceCandidateIndices:u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/byteSizeEstimations ../../../../core/handleUtils ../../../../core/Logger ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../core/support/UpdatingHandles ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/Indices ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ../graphics/DisplayFeatureLimit ./FeatureVisibilityFilter ../../terrain/OverlayRenderer ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial ../../../support/layerViewUtils ../../../webgl/enums ../../../webgl/heatmapTextureUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P){const R=f.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor");a.HeatmapFeatureProcessor=class extends g{constructor(W){super(W);this.type="heatmap";this.preferredUpdatePolicy=T.UpdatePolicy.ASYNC;this.dataExtent=null;this.drapeSourceType=A.DrapeSourceType.Features;this._renderGeometries=new Map;this._fieldTotal=0;this._drapeSourceRenderer=null;this._dataType=Z.PixelType.HALF_FLOAT;this._pixelFormat=
Z.PixelFormat.RGBA;this._updatingHandles=new x.UpdatingHandles;this.initializePromise=Promise.resolve()}initialize(){this._featureStore=new D({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {dataType:W,samplingMode:N,pixelFormat:V,internalFormat:S}=P.loadHeatmapTextureConfiguration(this._renderView.renderingContext,R);this._dataType=W;this._pixelFormat=V;const X=W!==Z.PixelType.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,
K.DrapedHeatmapRenderer,{...this._rendererParameters,dataType:W,samplingMode:N,pixelFormat:V,internalFormat:S});this._material=new O.HeatmapDensityMaterial({usesHalfFloats:X});this._materialWithField=new O.HeatmapDensityMaterial({usesHalfFloats:X,isAttributeDriven:!0});this._filterVisibility=new G.FeatureVisibilityFilter({context:{layerView:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:ca=>this._setAllFeaturesVisibility(ca),
clearFeaturesVisibility:()=>this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:ca=>this._updateFeatureVisibilities(ca)}});this._updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,ca=>this._onLoadedFeaturesChange(ca),c.initial);this._updatingHandles.addWhen(()=>this._materialParameters,ca=>this._forEachMaterial(ba=>ba.setParameters(ca)),c.initial);this._updatingHandles.add(()=>this._rendererParameters,ca=>this._drapeSourceRenderer.set(ca));this._updatingHandles.add(()=>this._heatmapRendererField,
()=>{this._recreate()},c.sync);this._updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:ca,numeric:ba})=>{if(null!=ca&&ba){let ia=0;this._featureStore.forEach(ka=>ia+=ka.attributes[ca]??0);this._fieldTotal=ia}else this._fieldTotal=this._featureStore.numFeatures},c.initial);this.addHandles([c.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:ca,field:ba})=>{ca&&!ba&&R.warn(`Heatmap renderer field '${ca}' for layer '${this.layer.title??
this.layer.id}' not found`)}),c.watch(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:ca,numeric:ba})=>{null==ca||ba||R.warn(`Heatmap renderer field '${ca.name}' for layer '${this.layer.title??this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),m.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])}destroy(){this._renderGeometries.clear();this._materialWithField=this._material=
null;this._featureStore.clear();this._featureStore=null;this._updatingHandles.destroy()}get layer(){return this.owner.layer}get featureStore(){return this._featureStore}get updating(){return this._updatingHandles.updating||this.filterVisibility.updating}get updatingRemaining(){return 0}get suspendInfo(){return{}}get legendEnabled(){return!0}get filterVisibility(){return this._filterVisibility}get displayFeatureLimit(){var W=this.owner?.view?.quality??1;const N=this.owner?.view?.qualitySettings;W=
N?Math.ceil(N.heatmap.maxTotalNumberOfFeatures*W):0;return new F.DisplayFeatureLimit(6*W,W)}get hasZ(){return"hasZ"in this.layer&&this.layer.hasZ}get hasM(){return"hasM"in this.layer&&this.layer.hasM}get view(){return this.owner.view}get fullOpacity(){return this.owner.fullOpacity}get updatePolicy(){return this.owner.updatePolicy}get scaleVisibilitySuspended(){if(!this._isScaleRangeActive)return!1;const {minScale:W,maxScale:N}=this.layer.effectiveScaleRange,{scale:V}=this.view;return!U.scaleBoundsPredicate(V,
W??0,N??0)}get usedMemory(){const W=Math.ceil((this._overlayRenderer?.overlays[0]?.resolution??0)*this._densityMapPixelRatio)??0;return W*W*(this._pixelFormat===Z.PixelFormat.RED?1:4)*(this._dataType===Z.PixelType.FLOAT?4:2)+this.usedMemoryPerFeature*this._featureStore.numFeatures}get usedMemoryPerFeature(){var W=this._loadedPointGraphics.find(()=>!0);if(null==W)return 0;W=k.estimateAttributesObjectSize(W);const N=k.estimateNumberByteSize(),V=6*k.estimateFixedArraySize([0,0,0],N),S=6*k.estimateFixedArraySize([0,
0],N);return V+S+(this._heatmapRendererFieldIsNumeric?6*N:0)+W}get loadedFeatures(){return this._featureStore.numFeatures}get unprocessedMemoryEstimate(){return 0}get performanceInfo(){return{core:{visible:this._visibleFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}get renderer(){return this._heatmapRenderer}get _overlayRenderer(){return this.view.basemapTerrain.overlayManager.renderer}get _overlaySpatialReference(){return this._overlayRenderer.spatialReference}get _rendererParameters(){return{...this._radiusParameter,
...this._densityParameters,...this._colorRampParameter,...this._pixelRatioParameter}}get _materialParameters(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}get _densityParameters(){const W=this._heatmapRenderer;if(null==W)return null;const {minDensity:N,maxDensity:V}=W;return{minDensity:N,maxDensity:V,fieldTotal:this._fieldTotal}}get _radiusParameter(){const W=this._heatmapRenderer;return W?{searchRadius:l.pt2px(this._clampSearchRadius(W.radius))}:null}get _resolutionForScaleParameter(){var W=
this._heatmapRenderer;if(!W)return null;({referenceScale:W}=W);return{resolutionForScale:0===W?0:t.getResolutionForScale(W,this.view.spatialReference)}}get _colorRampParameter(){const W=this._heatmapRenderer;return W?{colorRampData:E.generateGradient(W.colorStops)}:null}get _pixelRatioParameter(){return{pixelRatio:this._densityMapPixelRatio}}get _densityMapPixelRatio(){return this.owner?.view?.qualitySettings.heatmap.pixelRatio??1}get _renderView(){return this.view._stage.renderView}get _featuresArePoints(){return"point"===
this.layer.geometryType}get _loadedPointGraphics(){return this.owner.loadedGraphics}get _heatmapRenderer(){const W=this.layer.renderer;return"heatmap"===W?.type?W:null}get _heatmapRendererFieldName(){return this._heatmapRenderer?.field}get _heatmapRendererField(){const W=this._heatmapRendererFieldName;return null!=W?this.layer.fieldsIndex.get(W):null}get _heatmapRendererFieldIsNumeric(){const W=this._heatmapRendererField;return null==W?!1:C.isNumericField(W)}get _isScaleRangeActive(){const {layer:W}=
this;if(!("effectiveScaleRange"in W))return!1;const {minScale:N,maxScale:V}=W.effectiveScaleRange;return U.isScaleRangeActive(N,V)}get _visibleFeatures(){let W=0;this._renderGeometries.forEach(N=>{N.visible&&++W});return W}async whenGraphicBounds(){return null}computeAttachmentOrigin(){return null}highlight(){return m.makeHandle()}maskOccludee(){return m.makeHandle()}setObjectIdVisibility(){}refreshFilter(){this.filterVisibility.reapply()}_onLoadedFeaturesChange(W){if(this._featuresArePoints){var {objectIdField:N}=
this.layer;this._featureStore.removeManyById(W.removed.map(S=>v.getObjectId(S,N)));this._featureStore.addMany(W.added.map(S=>{const {attributes:X,centroid:ca,geometry:ba}=S,ia=new y.OptimizedFeature(r.convertFromPoint(new z,ba),X,ca?r.convertFromPoint(new z,ca):null,v.getObjectId(S,N));ia.displayId=S.uid;return ia}));var V=W.added;W=W.removed;this._fieldTotal+=this._computeFieldTotalChange(V,W);W=W.map(({uid:S})=>{const X=this._renderGeometries.get(S);this._renderGeometries.delete(S);return X}).filter(d.isSome);
V=V.map(S=>{const X=this._pointGraphicToRenderGeometry(S);this._renderGeometries.set(S.uid,X);return X});0<W.length&&this._drapeSourceRenderer.removeGeometries(W,J.DirtyOperation.REMOVE);0<V.length&&this._drapeSourceRenderer.addGeometries(V,J.DirtyOperation.ADD);if(0<V.length||0<W.length)this.filterVisibility.reapply(),this._renderView.requestRender()}}_recreate(){if(this._loadedPointGraphics){var W=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:W,removed:W})}}_pointGraphicToRenderGeometry(W){const N=
this._heatmapRendererFieldName,V=null!=N?this._materialWithField:this._material;var S=w.create();n.projectPointToVector(W.geometry,S,this._overlaySpatialReference);S[2]=I.drapedZ;const X=q.getContinuousIndexArray(1);S=[[Q.VertexAttribute.POSITION,new H.Attribute(S,X,S.length)]];const ca=this._heatmapRendererFieldIsNumeric;null!=N&&S.push([Q.VertexAttribute.FEATUREATTRIBUTE,new H.Attribute([ca?W.attributes[N]??0:0],X,1)]);W=new M.RenderGeometry(new L.Geometry(V,S,null,B.ContentObjectType.Point),{layerUid:this.layer.uid,
graphicUid:W.uid});W.visible=this.filterVisibility.defaultVisibility;return W}_forEachMaterial(W){W(this._material);W(this._materialWithField)}_computeFieldTotalChange(W,N){if(null==this._heatmapRendererFieldName||!this._heatmapRendererFieldIsNumeric)return W.length-N.length;const V=this._heatmapRendererFieldName,S=(X,ca)=>X+(ca.attributes[V]??0);return W.reduce(S,0)-N.reduce(S,0)}_clampSearchRadius(W){112<W&&R.warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");return Math.min(W,
112)}_updateFeatureVisibilities(W){const N=[];this._featureStore.forEach(({objectId:V,displayId:S})=>{V=W(V);(S=this._renderGeometries.get(S))&&S.visible!==V&&(N.push(S),S.visible=V)});this._drapeSourceRenderer.modifyGeometries(N,J.DirtyState.VISIBILITY)}_setAllFeaturesVisibility(W){const N=[];for(const V of this._renderGeometries.values())V.visible!==W&&(N.push(V),V.visible=W);this._drapeSourceRenderer.modifyGeometries(N,J.DirtyState.VISIBILITY)}get test(){return{visibleFeatureCount:this._visibleFeatures}}};
b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"type",void 0);b.__decorate([e.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"layer",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",
null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"suspendInfo",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"filterVisibility",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"hasZ",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"hasM",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"view",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",
void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"scaleVisibilitySuspended",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"renderer",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_filterVisibility",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_overlaySpatialReference",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_rendererParameters",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",null);b.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_pixelRatioParameter",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_renderGeometries",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",
void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_heatmapRendererField",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldIsNumeric",null);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_drapeSourceRenderer",void 0);b.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_isScaleRangeActive",null);a.HeatmapFeatureProcessor=b.__decorate([u.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],
a.HeatmapFeatureProcessor);a.maxRadiusPt=112;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../core/arrayUtils ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./geometryUtils ./optimizedFeatureQueryEngineAdapter".split(" "),function(a,b,g,d,k,m,f,c,l,e){const p=k.create();class h{constructor(u){this.geometryInfo=
u;this._boundsStore=new c.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new g;this.featureAdapter=e.optimizedFeatureQueryEngineAdapter}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let u=0;this._featuresById.forEach(w=>{null!=w.geometry&&w.geometry.coords&&
(u+=w.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:u/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(u){if(null==this.fullBounds)return null;const [w,x,n,q]=this.fullBounds;return{xmin:w,ymin:x,xmax:n,ymax:q,spatialReference:l.cleanFromGeometryEngine(u)}}add(u){this._add(u);this._emitChanged()}addMany(u){for(const w of u)this._add(w);this._emitChanged()}upsertMany(u){u=u.map(w=>this._upsert(w));this._emitChanged();return u.filter(a.isSome)}clear(){this._featuresById.clear();
this._boundsStore.clear();this._emitChanged()}removeById(u){u=this._featuresById.get(u);if(!u)return null;this._remove(u);this._emitChanged();return u}removeManyById(u){this._boundsStore.invalidateIndex();for(const w of u)(u=this._featuresById.get(w))&&this._remove(u);this._emitChanged()}forEachBounds(u,w){for(const x of u)(u=this._boundsStore.get(x.objectId))&&w(k.fromRect(p,u))}getFeature(u){return this._featuresById.get(u)}has(u){return this._featuresById.has(u)}forEach(u){this._featuresById.forEach(w=>
u(w))}forEachInBounds(u,w){this._boundsStore.forEachInBounds(u,x=>{w(this._featuresById.get(x))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex();this._markedIds.clear()}sweep(){let u=!1;this._featuresById.forEach((w,x)=>{this._markedIds.has(x)||(u=!0,this._remove(w))});this._markedIds.clear();u&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(u){if(u){var w=u.objectId;if(null==w)d.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature",
"feature id is missing",{feature:u}));else{var x=this._featuresById.get(w);this._markedIds.add(w);if(x){u.displayId=x.displayId;var n=this._boundsStore.get(w);this._boundsStore.delete(w)}else if(null!=this.onFeatureAdd)this.onFeatureAdd(u);u.geometry?.coords?.length?(n=f.getBoundsOptimizedGeometry(null!=n?n:m.create(),u.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=n&&this._boundsStore.set(w,n)):this._boundsStore.set(w,null);this._featuresById.set(w,u)}}}_upsert(u){const w=u?.objectId;
if(null==w)return d.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature","feature id is missing",{feature:u})),null;const x=this._featuresById.get(w);if(!x)return this._add(u),u;this._markedIds.add(w);const {geometry:n,attributes:q}=u;for(const t in q)x.attributes[t]=q[t];n&&(x.geometry=n,this._boundsStore.set(w,f.getBoundsOptimizedGeometry(m.create(),n,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null));return x}_remove(u){if(null!=this.onFeatureRemove)this.onFeatureRemove(u);
const w=u.objectId;this._markedIds.delete(w);this._boundsStore.delete(w);this._featuresById.delete(w);return u}}return h})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(a,b,g,d){function k(c,l,e){m.minX=l[0];m.minY=l[1];m.maxX=l[2];m.maxY=l[3];c.search(m,e)}const m={minX:0,minY:0,maxX:0,maxY:0};class f{constructor(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=
new Map;this._idByBounds=new Map;this._index=new g.PooledRBush(9,b("esri-csp-restrictions")?c=>({minX:c[0],minY:c[1],maxX:c[2],maxY:c[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const c=Array(this._idByBounds.size);let l=0;this._idByBounds.forEach((e,p)=>{c[l++]=p});this._indexInvalid=!1;this._index.clear();this._index.load(c)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(c=>this._idByBounds.has(c))))),this._boundsToLoad.length=
0)}}get fullBounds(){if(!this._boundsById.size)return null;const c=d.empty();for(const l of this._boundsById.values())l&&(c[0]=Math.min(l[0],c[0]),c[1]=Math.min(l[1],c[1]),c[2]=Math.max(l[2],c[2]),c[3]=Math.max(l[3],c[3]));return c}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()}delete(c){const l=this._boundsById.get(c);this._boundsById.delete(c);l&&(this._idByBounds.delete(l),this._indexInvalid||
this._index.remove(l))}forEachInBounds(c,l){this._loadIndex();k(this._index,c,e=>l(this._idByBounds.get(e)))}get(c){return this._boundsById.get(c)}has(c){return this._boundsById.has(c)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(c,l){if(!this._indexInvalid){const e=this._boundsById.get(c);e&&(this._index.remove(e),this._idByBounds.delete(e))}this._boundsById.set(c,l);l&&(this._idByBounds.set(l,c),this._indexInvalid||(this._boundsToLoad.push(l),5E4<
this._boundsToLoad.length&&this._loadIndex()))}}a.BoundsStore=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){a.DrapedHeatmapRenderer=class extends h.SortedRenderGeometryRenderer{constructor(v){super(v);this.pixelRatio=1;this._colorRampData=new Uint8ClampedArray(4);this.type="draped-heatmap";this._heatmapParameters=new u.HeatmapPassParameters;var r=new q.TextureDescriptor;r.pixelFormat=v.pixelFormat;r.internalFormat=v.internalFormat;r.dataType=v.dataType;r.samplingMode=v.samplingMode;r.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE;const y=v.rendererContext.rctx;this._densityMap=
new x.FramebufferObject(y,r);this._quad=p.createQuadVAO(y);r=new u.HeatmapTechniqueConfiguration;r.usesHalfFloat=v.dataType!==w.PixelType.FLOAT;this._technique=new u.HeatmapTechnique({rctx:y,viewingMode:e.ViewingMode.Local},r)}initialize(){const v=this._colorRampData,r=new q.TextureDescriptor(v.length/4,1);r.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE;this._colorRamp=new n.Texture(this.rctx,r,v);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(d.watch(()=>[this.colorRampData,
this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))}destroy(){this._technique=g.releaseMaybe(this._technique);this._densityMap=g.disposeMaybe(this._densityMap);this._quad=g.disposeMaybe(this._quad);this._colorRamp=g.disposeMaybe(this._colorRamp)}get searchRadius(){return this._heatmapParameters.searchRadius}set searchRadius(v){v!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=v,this.notifyChange("searchRadius"))}get minDensity(){return this._heatmapParameters.minDensity}set minDensity(v){v!==
this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=v,this.notifyChange("minDensity"))}get maxDensity(){return this._heatmapParameters.maxDensity}set maxDensity(v){v!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=v,this.notifyChange("maxDensity"))}get fieldTotal(){return this._heatmapParameters.fieldTotal}set fieldTotal(v){this._heatmapParameters.fieldTotal=v;this.notifyChange("fieldTotal")}get colorRampData(){return this._colorRampData}set colorRampData(v){const {colorRamp:r}=
this._heatmapParameters;if(null!=r&&v!==this._colorRampData){const y=v.length/4;y!==r.descriptor.width&&r.resize(y,1);r.setData(v)}this._colorRampData=v}get _colorRamp(){return this._heatmapParameters.colorRamp}set _colorRamp(v){this._heatmapParameters.colorRamp=v}get hasHighlights(){return!1}get hasWater(){return!1}get rendersOccluded(){return!1}render(v){const r=this._sortedMaterialRenderers;if(0!==r.length){var y=this.rctx.getBoundFramebufferObject(),z=this.rctx.getViewport(),{pixelRatio:D}=this,
C=Math.ceil(z.width*D);D=Math.ceil(z.height*D);this._densityMap.resize(C,D);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,C,D);this.rctx.clear(w.ClearBufferBit.COLOR_BUFFER_BIT);var E=!1;r.forAll(A=>{const F=A.prepareTechnique(v);null!=F&&(A.renderNode(v,F),E=!0)});this.rctx.bindFramebuffer(y);this.rctx.setViewport(z.x,z.y,z.width,z.height);E&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,v.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,
0,t.vertexCount(this._quad,"geometry")))}}};b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"searchRadius",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,
"colorRampData",null);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"dataType",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",
void 0);a.DrapedHeatmapRenderer=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){class x extends d.NoParameters{constructor(){super(...arguments);this.densityMap=this.colorRamp=null;this.searchRadius=1;this.minDensity=this.fieldTotal=0;this.maxDensity=100}}class n extends m.ShaderTechnique{constructor(t,v){super(t,v,()=>this.destroy())}initializeProgram(t){return new e.Program(t.rctx,n.shader.get().build(this.configuration),c.Default3D)}initializePipeline(){return w.makePipelineState({blending:l.blendingDefault,colorWrite:w.defaultColorWriteParams,
depthTest:null,depthWrite:null})}get primitiveType(){return u.PrimitiveType.TRIANGLE_STRIP}}n.shader=new k.ReloadableShaderModule(h.HeatmapShader,()=>new Promise((t,v)=>a(["./Heatmap.glsl"],t,v)));class q extends p.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.usesHalfFloat=!1}}g.__decorate([f.parameter()],q.prototype,"usesHalfFloat",void 0);b.HeatmapPassParameters=x;b.HeatmapTechnique=n;b.HeatmapTechniqueConfiguration=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,g,d,k,m,f){function c(e){const p=new m.ShaderBuilder;
p.include(b.ScreenSpacePass);p.include(g.DiscardOrAdjustAlphaBlend);({usesHalfFloat:e}=e);p.fragment.uniforms.add(new f.Texture2DPassUniform("densityMap",h=>h.densityMap),new f.Texture2DPassUniform("tex",h=>h.colorRamp),new d.FloatPassUniform("densityNormalizer",h=>1/(h.maxDensity-h.minDensity)),new d.FloatPassUniform("minDensity",h=>h.minDensity),new d.FloatPassUniform("densityMultiplier",h=>3/(h.searchRadius*h.searchRadius*Math.PI)));e&&p.constants.add("compressionFactor","float",4);p.fragment.code.add(k.glsl`
    void main() {
      float density = texture(densityMap, uv).r * densityMultiplier${e?k.glsl` * compressionFactor`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      fragColor = color;
    }
  `);return p}const l=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}));a.HeatmapShader=l;a.build=c})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){class h extends p.HeatmapDensityPassParameters{constructor(){super(...arguments);this.usesHalfFloats=this.isAttributeDriven=!1}}class u extends f.Material{constructor(v){super(v,new h);this._configuration=new p.HeatmapDensityTechniqueConfiguration}produces(v,r){return v===c.RenderSlot.DRAPED_MATERIAL&&r===k.ShaderOutput.Color}getConfiguration(){this._configuration.isAttributeDriven=this.parameters.isAttributeDriven;this._configuration.usesHalfFloat=this.parameters.usesHalfFloats;
return this._configuration}createGLMaterial(v){return new w(v)}intersect(){}intersectDraped(v,r,y,z,D,C){r=v.attributes.get(l.VertexAttribute.POSITION);({parameters:y}=this);({searchRadius:y}=y);({screenToWorldRatio:v}=v);v=y*v+2*v;v*=v;y=r.data.length/r.size;for(let A=0;A<y;A++){var E=A*r.size;E=b.set(t,r.data[E],r.data[E+1]);b.squaredDistance(E,z)<v&&D(C.dist,C.normal,-1,!1)}}createBufferWriter(){return new x(this.parameters.isAttributeDriven?q:n)}}class w extends m{beginSlot(v){return this.ensureTechnique(p.HeatmapDensityTechnique,
v)}}class x{constructor(v){this.vertexBufferLayout=v}elementCount(v){return 6*v.attributes.get(l.VertexAttribute.POSITION).indices.length}write(v,r,y,z,D){e.writePosition(y.attributes.get(l.VertexAttribute.POSITION),v,z.position,D,6);v=y.attributes.get(l.VertexAttribute.POSITION).indices.length;r=z.uv0;let C=D;for(let E=0;E<v;++E)r.setValues(C++,-1,-1),r.setValues(C++,1,-1),r.setValues(C++,1,1),r.setValues(C++,1,1),r.setValues(C++,-1,1),r.setValues(C++,-1,-1);(z=l.VertexAttribute.FEATUREATTRIBUTE in
z?z.featureAttribute:null)&&e.writeBufferFloat(y.attributes.get(l.VertexAttribute.FEATUREATTRIBUTE),z,D,6)}}const n=d.newLayout().vec3f(l.VertexAttribute.POSITION).vec2f(l.VertexAttribute.UV0),q=n.clone().f32(l.VertexAttribute.FEATUREATTRIBUTE),t=g.create();a.HeatmapDensityMaterial=u;a.HeatmapDensityMaterialParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){class w extends c.MaterialParameters{constructor(){super(...arguments);this.searchRadius=128;this.resolutionForScale=0}}class x extends k.ShaderTechnique{initializeProgram(q){return new l.Program(q.rctx,x.shader.get().build(this.configuration),f.Default3D)}initializePipeline(){return u.makePipelineState({blending:u.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendOperation.ADD),colorWrite:u.defaultColorWriteParams,depthTest:null,depthWrite:null})}destroy(){super.destroy()}}
x.shader=new d.ReloadableShaderModule(p.HeatmapDensity,()=>new Promise((q,t)=>a(["./HeatmapDensity.glsl"],q,t)));class n extends e.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.usesHalfFloat=this.isAttributeDriven=!1}}g.__decorate([m.parameter()],n.prototype,"isAttributeDriven",void 0);g.__decorate([m.parameter()],n.prototype,"usesHalfFloat",void 0);b.HeatmapDensityPassParameters=w;b.HeatmapDensityTechnique=x;b.HeatmapDensityTechniqueConfiguration=n;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,b,g,d,k,m){function f(l){const e=new k.ShaderBuilder,{vertex:p,fragment:h,attributes:u,varyings:w}=
e;b.addProjViewLocalOrigin(p,l);const {isAttributeDriven:x,usesHalfFloat:n}=l;u.add(m.VertexAttribute.POSITION,"vec3");u.add(m.VertexAttribute.UV0,"vec2");x&&(u.add(m.VertexAttribute.FEATUREATTRIBUTE,"float"),w.add("attributeValue","float"));n&&e.constants.add("compressionFactor","float",.25);w.add("unitCirclePos","vec2");p.uniforms.add(new g.FloatPassUniform("radius",({resolutionForScale:q,searchRadius:t},{camera:v,screenToWorldRatio:r,overlayStretch:y})=>2*t*(0===q?1:q/r)*v.pixelRatio/v.fullViewport[2]/
y));p.code.add(d.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${m.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${x?d.glsl`attributeValue = ${m.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);h.code.add(d.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${x?d.glsl` * attributeValue`:""} ${n?d.glsl` * compressionFactor`:""};
      fragColor = vec4(density);
    }
  `);return e}const c=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=c;a.build=f})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(a,b,g){class d{constructor(k,m,f,c){this.dataType=k;this.samplingMode=m;this.pixelFormat=f;this.internalFormat=c}}a.HeatmapTextureConfiguration=d;a.loadHeatmapTextureConfiguration=function(k,m){const {textureFloat:f,colorBufferFloat:c}=k.capabilities,
l=f?.textureFloat,e=f?.textureFloatLinear;var p=f?.textureHalfFloat;const h=f?.textureHalfFloatLinear,u=c?.textureFloat;var w=c?.textureHalfFloat;const x=c?.floatBlend;k=k.driverTest.floatBufferBlend.result;if(!l&&!p)throw new b("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");if(!u&&!w)throw new b("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");
if(!(x&&k||w))throw new b("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${k?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);p=p&&w;w=!!c?.R32F;const n=!!c?.R16F;if(l&&u&&x&&k&&(e||!h))return e||m.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new d(g.PixelType.FLOAT,e?g.TextureSamplingMode.LINEAR:g.TextureSamplingMode.NEAREST,w?g.PixelFormat.RED:
g.PixelFormat.RGBA,w?g.SizedPixelFormat.R32F:g.PixelFormat.RGBA);if(p)return h||m.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),new d(g.PixelType.HALF_FLOAT,h?g.TextureSamplingMode.LINEAR:g.TextureSamplingMode.NEAREST,n?g.PixelFormat.RED:g.PixelFormat.RGBA,n?g.SizedPixelFormat.R16F:g.PixelFormat.RGBA);throw new b("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");
};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,b,g){a.toViewIfLocal=function(d){const k=d.view.spatialReference,m=d.layer.fullExtent;var f=null!=m&&m.spatialReference;if(null==m||!f)return Promise.resolve(null);if(f.equals(k))return Promise.resolve(m.clone());f=b.project(m,k);return null!=f?Promise.resolve(f):
d.view.state.isLocal?g.projectGeometry(m,k,d.layer.portalItem).then(c=>!d.destroyed&&c?c:null).catch(()=>null):Promise.resolve(null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,b,g,d){class k{constructor(m){this._capabilities=this._memoryCache=null;const f=m.layerView.layer;this._layerView=m.layerView;
this.objectIdField=f.objectIdField;this.globalIdField="globalIdField"in f?f.globalIdField:null;this._returnZ=m.returnZ;this._returnM=m.returnM;m=this._layerView.view.resourceController;this.query=d.createFeatureTileQuery3D(f,m.normal);m&&this._memoryCacheEnabled&&(this._memoryCache=m.memoryController.newCache(`fl-${f.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;case "csv":case "geojson":case "memory":case "wfs":return!1}}destroy(){this._memoryCache=
b.destroyMaybe(this._memoryCache);this.query.destroy()}createQuery(){const m=this._layerView.layer.createQuery();m.outFields=this._layerView.availableFields;m.returnZ=this._returnZ;m.returnM=this._returnM;m.outSpatialReference=this.tilingScheme.spatialReference;return m}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){const m=this._layerView.view.resourceController;
return m?m.scheduler:null}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get capabilities(){return null!=this._capabilities?this._capabilities:this._capabilities=g.contextCapabilitiesFromLayer(this._layerView.layer)}logFetchError(m,f){m.error("#fetchTile()",
this._layerView.layer,f?.message??f)}}a.FeatureTileFetcher3DLayerViewContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){let w=class extends g{constructor(t){super(t)}get queryFeaturesDehydrated(){var t=this.layer.capabilities;t=t&&t.query;const v=this.layer.parsedUrl;if(t&&t.supportsFormatPBF){null==this._decoder&&(this._decoder=new u.PBFDecoder(this.controller));const r={sourceSpatialReference:this.layer.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeLength:1024};return(y,z)=>h.runQuery(v,y,"pbf",this._createRequestOptions(z)).then(D=>{k.throwIfAborted(z);
return null!=this._decoder?this._decoder.invoke({buffer:D.data,options:r},z.signal):Promise.reject(k.createAbortError())})}return(r,y)=>h.executeQuery(v,r,this.layer.spatialReference,this._createRequestOptions(y)).then(z=>p.fromFeatureSetJSON(z.data))}queryFeatureCount(t,v){return this.layer.queryFeatureCount(t,v)}destroy(){this._decoder=d.destroyMaybe(this._decoder)}_createRequestOptions(t){return{...t,query:{...this.layer.customParameters,token:this.layer.apiKey,...t?.query}}}};b.__decorate([m.property({constructOnly:!0})],
w.prototype,"layer",void 0);b.__decorate([m.property({constructOnly:!0})],w.prototype,"controller",void 0);b.__decorate([m.property({readOnly:!0})],w.prototype,"queryFeaturesDehydrated",null);w=b.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],w);let x=class extends g{constructor(t){super(t)}queryFeaturesDehydrated(t,v){return this.layer.queryFeatures(t,v)}queryFeatureCount(t,v){return this.layer.queryFeatureCount(t,v)}};b.__decorate([m.property({constructOnly:!0})],
x.prototype,"layer",void 0);b.__decorate([m.property({readOnly:!0})],x.prototype,"queryFeaturesDehydrated",null);x=b.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],x);let n=class extends g{constructor(t){super(t)}queryFeaturesDehydrated(t,v){return this.layer.queryFeatures(t,v)}};b.__decorate([m.property({constructOnly:!0})],n.prototype,"layer",void 0);n=b.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],
n);let q=class extends g{constructor(t){super(t)}queryFeaturesDehydrated(t,v){return this.source.queryFeaturesJSON(t,v).then(p.fromFeatureSetJSON,r=>{if(r&&"query-features-json:unsupported"===r.name)return this.layer.queryFeatures(t,v);throw r;})}queryFeatureCount(t,v){return this.layer.queryFeatureCount(t,v)}};b.__decorate([m.property({constructOnly:!0})],q.prototype,"layer",void 0);b.__decorate([m.property({constructOnly:!0})],q.prototype,"source",void 0);q=b.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
q);a.createFeatureTileQuery3D=function(t,v){return"feature"===t.type&&"feature-layer"===t.source.type?null!=t.infoFor3D?new x({layer:t}):new w({layer:t,controller:v}):"feature"===t.type&&"memory"===t.source.type||"csv"===t.type||"geojson"===t.type||"oriented-imagery"===t.type||"wfs"===t.type?new q({layer:t,source:t.source}):"ogc-feature"===t.type?new n({layer:t}):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../Graphic ../../../core/typedArrayUtil ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,g,d,k,m){function f(e){switch(e.type){case "polyline":e.paths.reduce((p,h)=>p+h.length,0)<g.nativeArrayMaxSize&&(e.paths=e.hasZ||e.hasM?e.paths.map(p=>p.map(h=>[h[0],h[1],h[2]])):e.paths.map(p=>p.map(h=>[h[0],h[1]])));break;case "polygon":e.rings.reduce((p,h)=>p+h.length,0)<g.nativeArrayMaxSize&&(e.rings=e.hasZ||e.hasM?e.rings.map(p=>p.map(h=>[h[0],h[1],h[2]])):e.rings.map(p=>p.map(h=>[h[0],h[1]])))}}class c{constructor(e){this._controller=e;this._handle=new l(p=>e.schedule(p))}destroy(){this._handle.destroy()}invoke(e,
p){if(!e.buffer||0===e.buffer.byteLength)return Promise.resolve(null);e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof k&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()});return this._handle.invoke(e,p).then(h=>{let u=0,w=0;const x=k.fromJSON(h.spatialReference);h.spatialReference=x;const n=async q=>{if(h.fields)for(;u<h.fields.length;)if(h.fields[u]=m.fromJSON(h.fields[u]),u++,q.madeProgress())return this._controller.reschedule(t=>
n(t));for(;w<h.features.length;){const t=h.features[w];++w;t.uid=b.generateUID();if(null!=t.geometry&&(t.geometry.spatialReference=x,f(t.geometry),q.madeProgress()))return this._controller.reschedule(v=>n(v))}return h};return this._controller.schedule(q=>n(q))})}}class l extends d.WorkerHandle{constructor(e){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:p=>[p.buffer]},e)}}a.PBFDecoder=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/EventedSet":function(){define(["exports",
"../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils"],function(a,b,g,d){class k extends b{constructor(){super(...arguments);this._set=new Set}clear(){if(0<this._set.size){const m=this.toArray();this._set.clear();this.emit("after-changes",{type:g.ObservableChangesType.REMOVE});this.emit("change",{added:[],removed:m})}}get length(){return this._set.size}addMany(m){if(0!==m.length){for(const f of m)this._set.add(f);this.emit("after-changes",{type:g.ObservableChangesType.ADD});
this.emit("change",{added:m,removed:[]})}}remove(m){this._set.delete(m)&&(this.emit("after-changes",{type:g.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:[m]}))}removeMany(m){const f=[];for(const c of m)this._set.delete(c)&&f.push(c);0<f.length&&(this.emit("after-changes",{type:g.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:f}))}toArray(){return[...this._set]}find(m){let f;d.someSet(this._set,c=>m(c)?(f=c,!0):!1);return f}forEach(m){this._set.forEach(f=>
m(f))}}a.EventedSet=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){const t=g.getLogger("esri.views.layers.FeatureLayerView");return v=>{v=class extends v{constructor(...r){super(...r);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.timeExtent=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([d.watch(()=>{const r=this.layer;return[r?.elevationInfo?.featureExpressionInfo,r&&"displayField"in r?r.displayField:null,r&&"timeInfo"in r&&r.timeInfo,r&&"renderer"in
r&&r.renderer,r&&"labelingInfo"in r&&r.labelingInfo,r&&"floorInfo"in r&&r.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),d.syncAndInitial),d.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),d.on(()=>{const r=this.layer;return r&&"sublayers"in r?r.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){const {layer:r,layer:{fieldsIndex:y},requiredFields:z}=this;return"outFields"in r&&r.outFields?
u.fixFields(y,[...u.unpackFieldNames(y,r.outFields),...z]):u.fixFields(y,z)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(r){this._override("featureEffect",r)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(r){t.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(r){throw Error("missing implementation");}createQuery(){var r=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};r=null!=this.filter?this.filter.createQuery(r):new x(r);if("feature"===this.layer.type){const y=w.getFloorFilterClause(this);null!=y&&(r.where=r.where?`(${r.where}) AND (${y})`:y)}null!=this.timeExtent&&(r.timeExtent=null!=r.timeExtent?r.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return r}createAggregateQuery(){return new x({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(r,
y){throw Error("missing implementation");}queryObjectIds(r,y){throw Error("missing implementation");}queryFeatureCount(r,y){throw Error("missing implementation");}queryExtent(r,y){throw Error("missing implementation");}async fetchPopupFeatures(r,y){if(r=this.validateFetchPopupFeatures(y))throw r;return this.fetchClientPopupFeatures(y)}_loadArcadeModules(r){return r.expressionInfos?.length||Array.isArray(r.content)&&r.content.some(y=>"expression"===y.type)?n.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const r=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",r);r.then(()=>{this._updatingRequiredFieldsPromise===r&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var r="3d"===this.view.type,{layer:y,layer:{fieldsIndex:z,objectIdField:D}}=this,C="renderer"in y&&y.renderer,E="orderBy"in y&&y.orderBy,A="featureReduction"in y?y.featureReduction:null,F=new Set;C=await Promise.allSettled([C?C.collectRequiredFields(F,z):null,u.collectLabelingFields(F,
y),r?u.collectElevationFields(F,y):null,null!=this.filter?u.collectFilterFields(F,y,this.filter):null,null!=this.featureEffect?u.collectFilterFields(F,y,this.featureEffect.filter):null,A?u.collectFeatureReductionFields(F,y,A):null,E?u.collectOrderByInfos(F,y,E):null]);"timeInfo"in y&&y.timeInfo&&this.timeExtent&&u.collectFields(F,y.fieldsIndex,[y.timeInfo.startField,y.timeInfo.endField]);"feature"===y.type&&(y.floorInfo&&u.collectFields(F,y.fieldsIndex,[y.floorInfo.floorField]),r&&null!=y.infoFor3D&&
(null==y.globalIdField&&t.error("globalIdField missing on 3DObjectFeatureLayer"),u.collectFields(F,y.fieldsIndex,[y.globalIdField])));"subtype-group"===y.type&&(u.collectField(F,z,y.subtypeField),E=y.sublayers.map(G=>Promise.all([G.renderer?.collectRequiredFields(F,z),u.collectLabelingFields(F,G)])),await Promise.allSettled(E));for(const G of C)"rejected"===G.status&&t.error(G.reason);u.collectField(F,z,D);r&&"displayField"in y&&y.displayField&&u.collectField(F,z,y.displayField);r=Array.from(F).sort();
this._set("requiredFields",r)}}validateFetchPopupFeatures(r){if(null==r)return null;for(const y of r.clientGraphics??[]){const z=y.layer;if("popupEnabled"in z&&!z.popupEnabled)return new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:z});if(y.isAggregate){const D="featureReduction"in z?z.featureReduction:null;if(!(D&&"popupTemplate"in D&&D.popupEnabled&&D.popupTemplate))return new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:z})}else if("popupTemplate"in
z&&!q.getFetchPopupTemplate(z,r))return new b("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:z})}}async fetchClientPopupFeatures(r){const y=null!=r?r.clientGraphics:null;if(!y||0===y.length)return[];const z=Array(y.length),D=new Map,C=await this.createPopupQuery(r);for(let A=0;A<y.length;A++){const F=y[A];if(F.isAggregate){z[A]=F;continue}var E=F.layer;if(!("popupEnabled"in E))continue;const G=u.unpackFieldNames(this.layer.fieldsIndex,C.outFields);E=q.getFetchPopupTemplate(E,
r);if(null==E)continue;const I=await this._loadArcadeModules(E);I&&I.arcadeUtils.hasGeometryOperations(E)||!u.featureHasFields(G,F)?D.set(F.getObjectId(),{graphic:F,index:A}):z[A]=F}if("stream"===this.layer.type||0===D.size)return z.filter(Boolean);C.objectIds=Array.from(D.keys());try{const A=await this.layer.queryFeatures(C);for(const F of A.features){const {graphic:{geometry:G},index:I}=D.get(F.getObjectId());F.geometry||(F.geometry=G);z[I]=F}}catch{}return z.filter(Boolean)}async createPopupQuery(r){const y=
this.layer.createQuery(),z=new Set;var D=!1,C=r?.clientGraphics?r.clientGraphics.map(E=>E.layer):[this.layer];for(const E of C)if("popupEnabled"in E&&(C=q.getFetchPopupTemplate(E,r),null!=C)){D=(D=await this._loadArcadeModules(C))&&D.arcadeUtils.hasGeometryOperations(C);D=!("point"!==this.layer.geometryType&&!D);C=await q.getRequiredFields(this.layer,C);for(const A of C)z.add(A)}y.returnGeometry=D;y.returnZ=D;y.returnM=D;y.outFields=Array.from(z);y.outSpatialReference=this.view.spatialReference;"feature"===
this.layer.type&&(r=w.getFloorFilterClause(this),null!=r&&(y.where=y.where?`(${y.where}) AND (${r})`:r));return y}canResume(){return!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty?!1:!0}};a.__decorate([k.property()],v.prototype,"_updatingRequiredFieldsPromise",void 0);a.__decorate([k.property({readOnly:!0})],v.prototype,"availableFields",null);a.__decorate([k.property({readOnly:!0})],v.prototype,"dataUpdating",void 0);a.__decorate([k.property({type:p})],v.prototype,"featureEffect",
null);a.__decorate([k.property({type:h})],v.prototype,"filter",void 0);a.__decorate([k.property(e.combinedViewLayerTimeExtentProperty)],v.prototype,"timeExtent",void 0);a.__decorate([k.property()],v.prototype,"layer",void 0);a.__decorate([k.property({type:Number})],v.prototype,"maximumNumberOfFeatures",null);a.__decorate([k.property({readOnly:!0,type:Boolean})],v.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([k.property({readOnly:!0})],v.prototype,"requiredFields",void 0);a.__decorate([k.property()],
v.prototype,"suspended",void 0);a.__decorate([k.property()],v.prototype,"view",void 0);return v=a.__decorate([l.subclass("esri.views.layers.FeatureLayerView")],v)}})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,
b,g,d,k,m,f,c,l){return e=>{e=class extends e{initialize(){this.addHandles(d.on(()=>this.layer,"refresh",p=>{this.doRefresh(p.dataChanged).catch(h=>{g.isAbortError(h)||b.getLogger(this).error(h)})}),"RefreshableLayerView")}};a.__decorate([k.property()],e.prototype,"layer",void 0);return e=a.__decorate([l.subclass("esri.layers.mixins.RefreshableLayerView")],e)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/handleUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection/projectBoundingRect ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedPoint ../../../layers/support/CodedValue ../../../core/has ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/RenderSlot ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba){function ia(Y){return ea=>Y.immediate.schedule(ea)}const ka=y.create();w=class extends P.PopupSceneLayerView(K.LayerView3D(X)){constructor(){super(...arguments);this.type="point-cloud-3d";this.slots=[S.RenderSlot.OPAQUE_MATERIAL];this.maximumPointCount=4E6;this.slicePlaneEnabled=!1;this._renderer=null;this._rendererAdded=!1;this._renderedNodes=new Set;this._nodeScales=new Map;this._updateViewNeeded=
!0;this._lodFactor=1;this._maxLoggedBoxWarnings=5;this._pageMultiplier=1;this._nodeLoadEpoch=0;this._indexQueue=[];this._workQueue=[];this._idleQueue=new H.PromiseQueue;this._indexPagesLoading=new Map;this._loadingNodes=new Map;this._recalcWork=!0;this._layerIsVisible=!1;this._codedDomainPopulationAbortController=this._codedDomainPopulationPromise=null;this._totalWork=0;this._index=null;this._loadingInitNodePage=!1;this._nodeIdArray=[];this.ignoresMemoryFactor=!1}get baseUrl(){return this.layer.parsedUrl.path}get pointScale(){const Y=
Q.getSplatSizeAlgorithm(this.layer?.renderer);return null!=Y?.scaleFactor?Y.scaleFactor:1}get useRealWorldSymbolSizes(){const Y=Q.getFixedSizeAlgorithm(this.layer?.renderer);return null!=Y?.useRealWorldSymbolSizes?Y.useRealWorldSymbolSizes:!1}get pointSize(){const Y=Q.getFixedSizeAlgorithm(this.layer?.renderer);return null!=Y?.size?Y.size:0}get inverseDensity(){return this.layer?.renderer?96/this.layer.renderer.pointsPerInch:5}get availableFields(){var Y=Q.getRendererInfo(this.layer);const ea=new Set;
Y.primaryAttribute&&ea.add(Y.primaryAttribute.name);Y.modulationAttribute&&ea.add(Y.modulationAttribute.name);if(Y=Q.getFilterInfo(this.layer))for(const fa of Y)fa.attributeInfo&&ea.add(fa.attributeInfo.name);if(this.layer.outFields)for(const fa of I.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))ea.add(fa);return Array.from(ea)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const Y=v.create();return R.projectToBoundingBox(this.view.clippingArea,Y,this.view.renderSpatialReference)?
Y:null}get _elevationOffset(){const Y=this.layer&&this.layer.elevationInfo;if(Y&&"absolute-height"===Y.mode){const ea=h.getMetersPerVerticalUnitForSR(this.layer.spatialReference),fa=B.getMetersPerUnit(Y.unit);return(Y.offset??0)*fa/ea}return 0}initialize(){const Y=this.view.resourceController;var ea=ia(Y);this._worker=new L.PointCloudWorkerHandle(ea);this.addResolvingPromise(this._worker.promise);this._tmpPoint=z.makeDehydratedPoint(0,0,0,this.layer.spatialReference);J.checkPointCloudLayerValid(this.layer);
J.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=Y.createStreamDataRequester(W.ClientType.I3S_INDEX);this._dataRequester=Y.createStreamDataRequester(W.ClientType.I3S_DATA);this._initRenderer();ea=this._initNodePages();this._memCache=this.view.resourceController.memoryController.newCache(`pcl-${this.layer.uid}`);this._updatingHandles.add(()=>this._clippingBox,()=>this._setUpdateViewNeeded(),l.initial);this._updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),
l.initial);this._updatingHandles.add(()=>this.layer.renderer,()=>this._rendererChanged(),l.initial);this._updatingHandles.add(()=>this.layer.filters,()=>this._reload(),l.initial);this._updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),l.initial);this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this._updatingHandles.add(()=>this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.addHandles([this.view.basemapTerrain.on("scale-change",
fa=>this._scaleUpdateHandler(fa)),l.watch(()=>this.view.quality,()=>this._setUpdateViewNeeded(),l.sync)]);this.addResolvingPromise(ea);this.when(()=>{this.addHandles([Y.scheduler.registerTask(ba.TaskPriority.POINT_CLOUD_LAYER,this),Y.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this._updatingHandles.add(()=>this.suspended,fa=>{fa?this._clearNodeState():this._setUpdateViewNeeded()},l.initial)])},()=>{this._updatingHandles.removeAll();this.removeAllHandles()})}_setUpdateViewNeeded(){this._updateViewNeeded=
!0;this._updateLoading()}destroy(){this.cancelLoading();this._worker=f.destroyMaybe(this._worker);this._destroyRenderer();this._memCache=f.destroyMaybe(this._memCache);this._codedDomainPopulationAbortController=f.abortMaybe(this._codedDomainPopulationAbortController);this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new Z.PointRenderer({createGraphic:(Y,ea,fa)=>this._createGraphic(Y,ea,fa)});this._renderer.layerUid=this.layer.uid;this._updatingHandles.add(()=>this._clippingBox,
Y=>this._renderer.clippingBox=Y,l.initial);this._updatingHandles.add(()=>this.suspended,Y=>this._setPointsVisible(!Y),l.initial);this._updatingHandles.add(()=>this.pointScale,Y=>this._renderer.scaleFactor=Y,l.initial);this._renderer.minSizePx=Math.sqrt(2);this._updatingHandles.add(()=>this.useRealWorldSymbolSizes,Y=>this._renderer.useRealWorldSymbolSizes=Y,l.initial);this._updatingHandles.add(()=>this.pointSize,Y=>{const ea=e.pt2px(Y);this._renderer.size=Y;this._renderer.sizePx=ea},l.initial);this._updatingHandles.add(()=>
this.slicePlaneEnabled,Y=>this._renderer.slicePlaneEnabled=Y,l.initial);this._updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),l.initial);this._updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),l.initial);this._updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,Y=>{this._lodFactor=Y;this._setUpdateViewNeeded()},l.initial)}_destroyRenderer(){this._renderer.removeAll();this._setPointsVisible(!1)}_createGraphic(Y,
ea,fa){const aa=null!=Y.pointIdFilterMap?Y.pointIdFilterMap[ea]:ea;fa=this.view.computeMapPointFromVec3d(fa);const da=this._createGraphicAttributes(Y,aa);return new U.PointGraphic({pointCloudMetadata:{nodeId:Y.id,pointIndexInNode:ea,attributePointIndexInNode:aa,epoch:this._nodeLoadEpoch},geometry:fa,attributes:da,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(Y,ea){const fa={};for(const aa of Y.attributes)this._encodeGraphicAttribute(aa.attributeInfo,aa.values,ea,fa);return fa}_encodeGraphicAttribute(Y,
ea,fa,aa){var da=Y.storageInfo?.attributeValues;const ma=da?.valuesPerElement??1;if(1===ma)aa[Y.name]=ea[fa];else if("UInt8"===da?.valueType&&4>=ma){da=0;fa*=ma;for(let ua=fa;ua<fa+ma;ua++)da=(da<<8)+ea[ua];aa[Y.name]=da}else aa[Y.name]=void 0}_setPointsVisible(Y){Y&&!this._rendererAdded?(this.view._stage.addRenderPlugin(this._renderer),this._rendererAdded=!0):!Y&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=
Q.rendererUsesFixedSizes(this.layer.renderer);this._reload()}_reload(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState();this._memCache.clear();this._initNodePages()}_scaleUpdateHandler(Y){const ea=this.layer.effectiveScaleRange;ca.isScaleRangeActive(ea.minScale,ea.maxScale)?t.projectBoundingRect(Y.extent,Y.spatialReference,na,this.layer.spatialReference)&&(this._nodeScales.forEach((fa,aa)=>{this._renderedNodes.has(aa)?(fa=this._index.getNode(aa),
r.containsPoint(na,fa.obb.center)&&this._nodeScales.set(aa,Y.scale)):this._nodeScales.delete(aa)}),this._setUpdateViewNeeded()):this._nodeScales.clear()}_displayNodes(Y){this._workQueue=M.nodeDiff([...this._renderedNodes],Y,this._index);M.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);M.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<Y.length||this._loadingInitNodePage;
this.notifyChange("suspended")}cancelLoading(){this._cancelNodeLoading();this._cancelIndexLoading()}_cancelNodeLoading(){const Y=[];this._loadingNodes.forEach(({abortController:ea})=>Y.push(ea));this._loadingNodes.clear();for(const ea of Y)ea.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()}_updateQueues(){const Y=new Set;this._workQueue.forEach(aa=>aa.load.forEach(da=>Y.add(da)));const ea=[],fa=new Map;this._loadingNodes.forEach((aa,
da)=>{Y.has(da)?fa.set(da,aa):ea.push(aa)});this._loadingNodes=fa;for(const {abortController:aa}of ea)aa.abort();this._workQueue=this._workQueue.filter(aa=>{for(const da of aa.load)if(this._loadingNodes.has(da))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:Y})=>Y.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++;
this._renderedNodes.forEach(Y=>this._removeFromRenderer(Y));this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}get running(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||this._idleQueue.running}runTask(Y){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,Y=this._isRootNodeVisible(),Y!==this._layerIsVisible&&(this._layerIsVisible=Y,this.notifyChange("suspended")),
this._updateLoading());else{for(Y.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&Y.run(()=>this._processIndexQueue()););this._processWorkQueue(Y);this._idleQueue.runTask(Y)}}_processIndexQueue(){const Y=this._indexQueue.shift(),ea=this._loadNodePage(Y);this._indexPagesLoading.set(Y,ea);ea.promise.then(fa=>{this._index.addPage(Y,fa,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(Y)},()=>{this._indexPagesLoading.delete(Y)});return!0}_processWorkQueue(Y){for(;!Y.done;){const ea=
this._scheduleWorkEntry();if(null==ea){Y.madeProgress();break}this._processWorkEntry(ea);Y.madeProgress()}}_scheduleWorkEntry(){let Y=this._workQueue.length;for(;Y--;){const ea=this._workQueue.shift();if(ea.remove.find(fa=>!this._renderedNodes.has(fa)))this._workQueue.push(ea);else return ea}return null}_processWorkEntry(Y){if(0===Y.load.length)for(const ea of Y.remove)this._removeFromRenderer(ea);else Promise.all(Y.load.map(ea=>{const fa=new AbortController,aa=this._memCache.pop(ea.toString());null!=
aa?this._loadingNodes.set(ea,{abortController:fa,promise:Promise.resolve(aa)}):this._loadingNodes.has(ea)||this._loadingNodes.set(ea,{abortController:fa,promise:this._loadNode(ea,fa.signal)});return this._loadingNodes.get(ea).promise})).then(ea=>{for(let fa=0;fa<Y.load.length;fa++)if(ea[fa]){const aa=this._setupRendererData(Y.load[fa],ea[fa]);this._addToRenderer(aa)}for(const fa of Y.remove)this._removeFromRenderer(fa)}).catch(()=>{}).then(()=>{for(const ea of Y.load)this._loadingNodes.delete(ea);
this._updateLoading();this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()}async _populateClassCodeCodedDomain(Y,ea){const fa=this.layer.fieldsIndex.get("CLASS_CODE");fa&&!fa.domain&&Y.includes(fa.name)&&(Y=await g.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:ea})),!1!==Y.ok&&(Y=Y.value?.stats?.labels?.labels)&&Array.isArray(Y)&&(fa.domain=new E({name:"CLASS_CODE",
codedValues:Y.map(aa=>new D.CodedValue({code:aa.value,name:aa.label}))})))}async prepareFetchPopupFeatures(Y){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(Y,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise}async whenGraphicAttributes(Y,ea){const fa=this._splitGraphicsPerNode(Y),
aa=this.layer.attributeStorageInfo,da=ea.map(sa=>Q.getAttributeInfo(aa,sa)).filter(b.isSome),ma=async(sa,ra)=>{const Aa=this._index.getNode(ra);await g.forEach(da,async qa=>{const la=qa.useElevation?await this._loadElevationAttributeFromGeometry(Aa.resourceId):await this._loadAndParseAttribute(Aa,qa);if(la)for(const ja of sa)this._isValidPointGraphic(ja)&&this._encodeGraphicAttribute(qa,la,ja.pointCloudMetadata.attributePointIndexInNode,ja.attributes)})},ua=[];fa.forEach((sa,ra)=>{ua.push(ma(sa,ra))});
await Promise.allSettled(ua);return Y}_isValidPointGraphic(Y){return Y instanceof U.PointGraphic&&Y.pointCloudMetadata?.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(Y){const ea=new Map;for(const fa of Y){if(!this._isValidPointGraphic(fa))continue;Y=fa.pointCloudMetadata;const aa=ea.get(Y.nodeId);aa?aa.push(fa):ea.set(Y.nodeId,[fa])}return ea}async _loadAndParseAttribute(Y,ea){const fa=await this._loadAttribute(Y.resourceId,ea,null);return null!=fa?O.getAttributeValues({attributeInfo:ea,buffer:fa},
null,Y.vertexCount):null}async _loadElevationAttributeFromGeometry(Y){Y=O.readGeometry(this.layer.store.defaultGeometrySchema,await this._loadGeometry(Y,null));return O.elevationFromPositions(Y,Y.length/3)}highlight(Y){if(!Y)return k.makeHandle();Y=d.isCollection(Y)?Y.toArray():Array.isArray(Y)?Y:[Y];return this._renderer.highlight(Y.map(ea=>this._graphicToPointDefinition(ea)))}_graphicToPointDefinition(Y){if(!this._isValidPointGraphic(Y))return null;const {nodeId:ea,pointIndexInNode:fa}=Y.pointCloudMetadata;
return null!=ea&&null!=fa?{nodeId:ea,pointId:fa}:null}_computeWork(){let Y=0;for(const ea of this._workQueue)Y+=ea.load.length+ea.remove.length;Y+=this._loadingNodes.size;Y+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;Y+=this._loadingInitNodePage?100:0;return Y+=this._updateViewNeeded?100:0}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const Y=this._computeWork();return 1-Math.min(this._totalWork,Y)/this._totalWork}_updateLoading(){this.notifyChange("updating");
this.notifyChange("updatingProgressValue")}canResume(){return super.canResume()&&this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:0<this._computeWork()}_initNodePages(){const Y=this.layer.store.index;this._index=new T(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,Y.nodesPerPage||Y.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");
this._updateLoading();this._pageMultiplier=null!=Y.nodesPerPage?1:Y.nodePerIndexBlock;return this._loadNodePage(0).promise.then(ea=>{this._index.addPage(0,ea,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})}_loadNodePage(Y){const ea=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${Y*this._pageMultiplier}`,ea.signal).then(fa=>fa.nodes.map((aa,da)=>({resourceId:null!=aa.resourceId?aa.resourceId:Y*this._index.pageSize+da,obb:aa.obb,
obbInRenderSR:N.create(),firstChild:aa.firstChild,childCount:aa.childCount,vertexCount:aa.vertexCount??aa.pointCount,lodThreshold:aa.lodThreshold??aa.effectiveArea}))),abortController:ea}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;var Y=this.view.quality;let ea=this.inverseDensity/this._lodFactor*Y;Y*=this.maximumPointCount*this._lodFactor;let fa=this._computeNodesForMinimumDensity(ea),aa=this._computePointCount(fa),da=Math.sqrt(aa/(.75*Y));for(;aa>Y;)ea*=da,fa=this._computeNodesForMinimumDensity(ea),
aa=this._computePointCount(fa),da=Math.sqrt(2);this._displayNodes(fa);this._updateViewNeeded=!1;this._updateLoading();return!0}_computePointCount(Y){let ea=0;for(let fa=0;fa<Y.length;fa++){const aa=this._index.getNode(Y[fa]);aa&&(ea+=aa.vertexCount)}return ea}_isRootNodeVisible(){let Y=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(ea,fa,aa)=>{Y=aa;return!1},pageMiss:()=>{}});return Y}_computeNodesForMinimumDensity(Y){const ea=this.view.state.contentCamera,
fa=ea.frustum,aa=this._clippingBox,da=ea.viewForward,ma=n.dot(da,ea.eye),ua=y.fromNormalAndOffset(da,-ma,ka),sa=ea.perScreenPixelRatio/2,ra=Y*Y,Aa=this._nodeIdArray;Aa.length=0;const {minScale:qa,maxScale:la}=ca.extractSafeScaleBounds(this.layer),ja=0===qa&&0===la?oa=>Aa.push(oa):oa=>{const za=this._getScale(oa);ca.scaleBoundsPredicate(za,qa,la)&&Aa.push(oa)};this._traverseVisible({frustum:fa,clippingBox:aa},{predicate:(oa,za,ta)=>{if(!ta)return!1;if(0===za.childCount)return ja(oa),!1;ta=this._index.getRenderObb(oa);
return this._computeAveragePixelArea(ta,za.lodThreshold,za.vertexCount,ua,sa)<=ra?(ja(oa),!1):!0},pageMiss:(oa,za)=>{ja(oa);this._indexQueue.includes(za)||this._indexQueue.push(za)}});return Aa}_getScale(Y){var ea=this._nodeScales.get(Y);null==ea&&(ea=this._index.getNode(Y).obb.center,this._tmpPoint.x=ea[0],this._tmpPoint.y=ea[1],this._tmpPoint.z=ea[2],ea=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(Y,ea));return ea}_computeAveragePixelArea(Y,ea,fa,aa,da){Y=Math.max(1E-7,
N.minimumDistancePlane(Y,aa));return ea/(Y*Y)/(4*da*da)/fa}_loadNode(Y,ea){try{return this._loadNodeAsync(Y,ea)}catch(fa){throw c.isAbortError(fa)||m.getLogger(this).error(fa),fa;}}async _loadAdditionalUserAttributes(Y,ea,fa){var aa=this.layer.outFields;if(!aa)return[];aa=I.unpackFieldNames(this.layer.fieldsIndex,aa);Y=new Set(Y.map(ua=>null!=ua?ua.name:null));const da=this.layer.attributeStorageInfo,ma=[];for(const ua of aa)Y.has(ua)||(aa=Q.getAttributeInfo(da,ua))&&ma.push(ea(aa));ea=await c.allSettledValues(ma);
c.throwIfAborted(fa);return ea.filter(b.isSome)}async _loadNodeAsync(Y,ea){const fa=this._index.getNode(Y),aa=Q.getRendererInfo(this.layer),da=Q.getFilterInfo(this.layer),ma=fa.resourceId,ua=async sa=>{if(!sa)return null;if(sa.useElevation)return{attributeInfo:sa,buffer:null};const ra=await this._loadAttribute(ma,sa,ea);return null!=ra?{attributeInfo:sa,buffer:ra}:null};return this._idleQueue.push(async()=>{var sa=this._loadGeometry(ma,ea);const {primaryAttribute:ra,modulationAttribute:Aa}=aa,qa=
ua(ra),la=ua(Aa);var ja=da.map(Ma=>Ma.attributeInfo);const oa=ja.map(Ma=>ua(Ma));ja=this._loadAdditionalUserAttributes([ra,Aa,...ja],ua,ea);const [za,ta,Ca,Ga,La]=await Promise.all([sa,qa,la,Promise.all(oa),ja]);c.throwIfAborted(ea);sa={geometryBuffer:za,primaryAttributeData:ta,modulationAttributeData:Ca,filterAttributesData:Ga,userAttributesData:La,schema:this.layer.store.defaultGeometrySchema,rendererInfo:aa,filterInfo:da,obb:this._index.getRenderObb(Y),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),
outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(sa,ea)},ea)}async _loadGeometry(Y,ea){return this._requestData(`${this.baseUrl}/nodes/${Y}/geometries/0`,ea)}async _loadAttribute(Y,ea,fa){return ea?.storageInfo?this._requestData(`${this.baseUrl}/nodes/${Y}/attributes/${ea.storageInfo.key}`,fa):null}_requestNodePage(Y,ea){return this._indexRequester.request(Y,"json",{query:{f:"json",token:this.layer.apiKey},signal:ea})}_requestData(Y,ea){return this._dataRequester.request(Y,
"binary",{query:{token:this.layer.apiKey},signal:ea})}_removeFromRenderer(Y){if(this._renderedNodes.has(Y)){const ea=this._renderer.removeNode(Y);this._renderedNodes.delete(Y);this._nodeScales.delete(Y);this._memCache.put(ea.id.toString(),ea,5*ea.coordinates.length+128)}}_addToRenderer(Y){this._renderedNodes.has(Y.id)||(this._renderedNodes.add(Y.id),this._renderer.addNode(Y))}_setupRendererData(Y,ea){const fa=this._index.getNode(Y),aa=Math.sqrt(fa.lodThreshold/fa.vertexCount),da=this._index.getRenderObb(Y);
if(Z.isInstanceOfNode(ea))return ea.splatSize=aa,ea.obb=da,n.copy(ea.origin,ea.obb.center),ea;var ma=.01*Math.max(da.halfSize[0],da.halfSize[1],da.halfSize[2]);if(ea.obb.halfSize[0]>da.halfSize[0]+ma||ea.obb.halfSize[1]>da.halfSize[1]+ma||ea.obb.halfSize[2]>da.halfSize[2]+ma)0<this._maxLoggedBoxWarnings&&(ma=ua=>`[${ua.halfSize[0]}, ${ua.halfSize[1]}, ${ua.halfSize[2]}]`,m.getLogger(this).warn(`Node ${Y} reported bounding box too small. got ${ma(da)} but points cover ${ma(ea.obb)}`),0===--this._maxLoggedBoxWarnings&&
m.getLogger(this).warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(Y,ea.obb);return new Z.PointRendererNode(Y,aa,q.clone(da.center),da,0===fa.childCount,ea.points,ea.rgb,ea.attributes,ea.pointIdFilterMap)}get usedMemory(){let Y=0;this._renderer.forEachNode(ea=>{Y+=160;Y+=p.estimateSize(ea.coordinates);for(const fa of ea.attributes)ea=fa.values,p.isArrayBuffer(ea.buffer)&&(Y+=p.estimateSize(ea))});return Y}get unloadedMemory(){const Y=this._renderedNodes.size;
if(4>Y)return 0;const ea=[...this._renderedNodes].reduce((aa,da)=>aa+this._index.getNode(da).vertexCount);let fa=this._loadingNodes.size;for(let aa=0;aa<this._workQueue.length;aa++)fa+=this._workQueue[aa].load.length,fa-=this._workQueue[aa].remove.length;return 0>fa?0:fa*ea/Y*((this.usedMemory-160*Y)/ea)+160*fa}get performanceInfo(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((Y,ea)=>Y+this._index.getNode(ea).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,
totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}get test(){return{index:this._index,visibleNodes:this._renderedNodes}}};a.__decorate([u.property()],w.prototype,"layer",void 0);a.__decorate([u.property()],w.prototype,"baseUrl",null);a.__decorate([u.property()],w.prototype,"pointScale",null);a.__decorate([u.property()],w.prototype,"useRealWorldSymbolSizes",null);
a.__decorate([u.property()],w.prototype,"pointSize",null);a.__decorate([u.property()],w.prototype,"inverseDensity",null);a.__decorate([u.property()],w.prototype,"maximumPointCount",void 0);a.__decorate([u.property({readOnly:!0})],w.prototype,"availableFields",null);a.__decorate([u.property({readOnly:!0})],w.prototype,"_clippingBox",null);a.__decorate([u.property({readOnly:!0})],w.prototype,"_elevationOffset",null);a.__decorate([u.property({type:Boolean})],w.prototype,"slicePlaneEnabled",void 0);a.__decorate([u.property()],
w.prototype,"updating",void 0);a.__decorate([u.property(V.updatingProgress)],w.prototype,"updatingProgress",void 0);a.__decorate([u.property({readOnly:!0})],w.prototype,"updatingProgressValue",null);a=w=a.__decorate([x.subclass("esri.views.3d.layers.PointCloudLayerView3D")],w);const na=r.create();return a})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports","../../../core/workers/WorkerHandle"],function(a,b){class g extends b.WorkerHandle{constructor(d){super("PointCloudWorker",
"transform",{transform:k=>this._getTransferList(k)},d)}_getTransferList(d){const k=[d.geometryBuffer];null!=d.primaryAttributeData&&d.primaryAttributeData.buffer&&k.push(d.primaryAttributeData.buffer);null!=d.modulationAttributeData&&d.modulationAttributeData.buffer&&k.push(d.modulationAttributeData.buffer);if(null!=d.filterAttributesData)for(const m of d.filterAttributesData)null!=m&&m.buffer&&k.push(m.buffer);for(const m of d.userAttributesData)m.buffer&&k.push(m.buffer);return k}}a.PointCloudWorkerHandle=
g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,b){function g(l,e,p){for(;0<l;){const h=e.indexOf(l);if(0<=h)return h;l=p.getParentId(l)}return e.indexOf(l)}function d(l,e,p){const h=[e.remove[0]],u=[];for(;1===h.length;){const x=h.pop();u.length=0;for(let n=0;n<e.load.length;n++){let q=e.load[n];for(var w=p.getParentId(q);w!==x;)q=w,w=p.getParentId(q);w=h.indexOf(q);0>w&&(w=h.length,
h.push(q),u.push([]));u[w].push(e.load[n])}}e.load=h;for(e=0;e<h.length;e++)1<u[e].length?l.push({remove:[h[e]],load:u[e]}):h[e]=u[e][0]}const k=[!1],m=[null],f=[!1],c=[null];a.nodeDiff=function(l,e,p){for(var h=0;h<e.length;h++)f[h]=!1,c[h]=null;for(h=0;h<l.length;h++)k[h]=!1,m[h]=null;for(h=0;h<e.length;h++){var u=g(e[h],l,p);0<=u&&(f[h]=!0,null!=m[u]?m[u].push(e[h]):m[u]=[e[h]])}for(h=0;h<l.length;h++)u=g(l[h],e,p),0<=u&&(k[h]=!0,null!=c[u]?c[u].push(l[h]):c[u]=[l[h]]);p=[];for(h=0;h<l.length;h++)null!=
m[h]||k[h]||p.push({load:[],remove:[l[h]]});for(h=0;h<e.length;h++)null!=c[h]||f[h]||p.push({load:[e[h]],remove:[]});for(h=0;h<e.length;h++)null!=c[h]&&(1<c[h].length||c[h][0]!==e[h])&&p.push({load:[e[h]],remove:c[h]});for(e=0;e<l.length;e++)null!=m[e]&&(1<m[e].length||m[e][0]!==l[e])&&p.push({load:m[e],remove:[l[e]]});return p};a.sortFrontToBack=function(l,e,p){return l.sort((h,u)=>{if(0===h.load.length&&0===u.load.length)return 0;if(0===h.load.length)return-1;if(0===u.load.length)return 1;if(0===
h.remove.length&&0===u.remove.length)return h=p.getRenderCenter(h.load[0]),u=p.getRenderCenter(u.load[0]),b.dot(h,e)-b.dot(u,e);if(0===h.remove.length)return-1;if(0===u.remove.length)return 1;if(1===h.load.length&&1===u.load.length)return h=p.getRenderCenter(h.load[0]),u=p.getRenderCenter(u.load[0]),b.dot(h,e)-b.dot(u,e);if(1===h.load.length)return-1;if(1===u.load.length)return 1;h=p.getRenderCenter(h.remove[0]);u=p.getRenderCenter(u.remove[0]);return b.dot(h,e)-b.dot(u,e)})};a.splitWorkEntries=function(l,
e,p){for(let h=0;h<l.length;++h){const u=l[h];u.load.length>e&&1===u.remove.length&&d(l,u,p)}};a.splitWorkEntry=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(a,b,g){class d{constructor(k,m,f){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=k;this._renderSR=m;this.pageSize=f}addPage(k,m,f=
0){for(;this._pages.length<k;)this._pages.push(null);var c=this._nodeSR,l=this._renderSR;for(var e=0;e<m.length;e++){var p=m[e];b.transformObb(p.obb,c,p.obbInRenderSR,l,f)}this._pages[k]={nodes:m,parents:new Uint32Array(this.pageSize)};k=this._pages;m=this.pageSize;for(f=[0];f.length;)for(c=f.pop(),l=k[c/m|0].nodes[c%m],e=0;e<l.childCount;e++)p=l.firstChild+e,null!=k[p/m|0]&&(k[p/m|0].parents[p%m]=c,f.push(p))}hasPage(k){return!!this._pages[k]}getNode(k){const m=this.pageSize;return this._pages[k/
m|0].nodes[k%m]}getRenderObb(k){const m=this.pageSize;return this._pages[k/m|0].nodes[k%m].obbInRenderSR}getRenderCenter(k){return this.getRenderObb(k).center}setRenderObb(k,m){const f=this.pageSize;g.set(m,this._pages[k/f|0].nodes[k%f].obbInRenderSR)}getParentId(k){const m=this.pageSize;return this._pages[k/m|0].parents[k%m]}hasNodes(k,m){var f=k/this.pageSize|0;for(k=(k+m-1)/this.pageSize|0;f<=k;f++)if(null==this._pages[f])return!1;return!0}forEachNodeId(k){for(let m=0;m<this._pages.length;m++){const f=
this._pages[m];if(f)for(let c=0;c<f.nodes.length;c++)k(m*this.pageSize+c)}}createVisibilityTraverse(){var k=this,m=[],f=[],c=a.create();return(l,e)=>{if(k.hasNodes(0,1))for(m.length=0,m.push(0),f.length=0,f.push(0);0<m.length;){var p=m.pop();let q=f.pop();var h=k.getNode(p),u=k.getRenderObb(p),w=!0;if(null!=l.clippingBox){var x=1<<l.frustum.length;if(0===(q&x)){var n=g.toAaBoundingBox(u,c);a.contains(l.clippingBox,n)?q|=x:a.intersects(l.clippingBox,n)||(w=!1)}}for(x=0;x<l.frustum.length&&w;x++)if(n=
1<<x,0===(q&n)){const t=g.intersectPlane(u,l.frustum[x]);0<t?w=!1:0>t&&(q|=n)}if(e.predicate(p,h,w)){u=h.firstChild;h=h.childCount;w=!1;n=u/k.pageSize|0;for(x=(u+h-1)/k.pageSize|0;n<=x;n++)if(!k.hasPage(n)){e.pageMiss(p,n);w=!0;break}if(!w)for(p=0;p<h;p++)m.push(u+p),f.push(q)}}}}}return d})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function b(d,k){for(const m of d??[])if(m.name===k&&null!=m.attributeValues&&"UInt8"===m.attributeValues.valueType&&
3===m.attributeValues.valuesPerElement)return{name:k,storageInfo:m,useElevation:!1};return null}function g(d,k){for(const m of d??[])if(m.name===k)return(d="embedded-elevation"===m.encoding)?{name:k,storageInfo:null,useElevation:d}:{name:k,storageInfo:m,useElevation:d};return"elevation"===k?.toLowerCase()?{name:k,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=g;a.getFilterInfo=function(d){const k=d.filters;return k?k.map(m=>({filterJSON:m.toJSON(),attributeInfo:g(d.attributeStorageInfo,
m.field)})):[]};a.getFixedSizeAlgorithm=function(d){return(d=d?.pointSizeAlgorithm)&&"fixed-size"===d.type?d:null};a.getRendererInfo=function(d){const k=d.renderer;var m=k?.type;const f=k?.toJSON()??null;let c=null,l=!1;d=d.attributeStorageInfo;"point-cloud-unique-value"===m?c=g(d,k.field):"point-cloud-stretch"===m?c=g(d,k.field):"point-cloud-class-breaks"===m?c=g(d,k.field):(c="point-cloud-rgb"===m?b(d,k.field):b(d,"RGB"),l=null!=c);m=null;k?.colorModulation&&(m=g(d,k.colorModulation.field));return{rendererJSON:f,
isRGBRenderer:l,primaryAttribute:c,modulationAttribute:m}};a.getSplatSizeAlgorithm=function(d){return(d=d?.pointSizeAlgorithm)&&"splat"===d.type?d:null};a.rendererUsesFixedSizes=function(d){d=d?.pointSizeAlgorithm;return d?.type?"fixed-size"===d.type:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/has ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(a,b,g,d,k,m,f){function c(p,h){const u=new Float64Array(h);for(let w=0;w<h;w++)u[w]=p[3*w+2];return u}function l(p){switch(p){default:case null:case "none":return h=>h;case "low-four-bit":return h=>h&15;case "high-four-bit":return h=>(h&240)>>4;case "absolute-value":return h=>Math.abs(h);case "modulo-ten":return h=>h%10}}function e(p){let h=0;for(const u of p||[])h|=1<<u;return h}a.elevationFromPositions=c;a.evaluateRenderer=function(p,h,u,w){const {rendererJSON:x,isRGBRenderer:n}=p;var q=
p=null;if(h&&n)p=h;else if(h&&"pointCloudUniqueValueRenderer"===x?.type){q=k.fromJSON(x);var t=q.colorUniqueValueInfos;p=new Uint8Array(3*w);var v=l(q.fieldTransformType);for(var r=0;r<w;r++){var y=(v?v(h[r]):h[r])+"";for(var z=0;z<t.length;z++)if(t[z].values.includes(y)){p[3*r]=t[z].color.r;p[3*r+1]=t[z].color.g;p[3*r+2]=t[z].color.b;break}}}else if(h&&"pointCloudStretchRenderer"===x?.type)for(q=d.fromJSON(x),t=q.stops,p=new Uint8Array(3*w),v=l(q.fieldTransformType),r=0;r<w;r++)if(y=v?v(h[r]):h[r],
z=t.length-1,y<t[0].value)p[3*r]=t[0].color.r,p[3*r+1]=t[0].color.g,p[3*r+2]=t[0].color.b;else if(y>=t[z].value)p[3*r]=t[z].color.r,p[3*r+1]=t[z].color.g,p[3*r+2]=t[z].color.b;else for(z=1;z<t.length;z++){if(y<t[z].value){y=(y-t[z-1].value)/(t[z].value-t[z-1].value);p[3*r]=t[z].color.r*y+t[z-1].color.r*(1-y);p[3*r+1]=t[z].color.g*y+t[z-1].color.g*(1-y);p[3*r+2]=t[z].color.b*y+t[z-1].color.b*(1-y);break}}else if(h&&"pointCloudClassBreaksRenderer"===x?.type)for(q=g.fromJSON(x),t=q.colorClassBreakInfos,
p=new Uint8Array(3*w),v=l(q.fieldTransformType),r=0;r<w;r++)for(y=v?v(h[r]):h[r],z=0;z<t.length;z++){if(y>=t[z].minValue&&y<=t[z].maxValue){p[3*r]=t[z].color.r;p[3*r+1]=t[z].color.g;p[3*r+2]=t[z].color.b;break}}else p=(new Uint8Array(3*w)).fill(255);if(u&&q?.colorModulation)for(h=q.colorModulation.minValue,q=q.colorModulation.maxValue,t=0;t<w;t++)v=u[t],v=v>=q?1:v<=h?.3:.3+.7*(v-h)/(q-h),p[3*t]*=v,p[3*t+1]*=v,p[3*t+2]*=v;return p};a.filterInPlace=function(p,h,u,w,x){const n=p.length/3;let q=0;for(let D=
0;D<n;D++){let C=!0;for(let E=0;E<w.length&&C;E++){var {filterJSON:t}=w[E],v=x[E].values[D];switch(t.type){case "pointCloudValueFilter":var r="exclude"===t.mode;t.values.includes(v)===r&&(C=!1);break;case "pointCloudBitfieldFilter":r=e(t.requiredSetBits);t=e(t.requiredClearBits);if((v&r)!==r||0!==(v&t))C=!1;break;case "pointCloudReturnFilter":var y=v&15,z=v>>>4&15;v=1<z;r=1===y;y=y===z;z=!1;for(const A of t.includedReturns)if("last"===A&&y||"firstOfMany"===A&&r&&v||"lastOfMany"===A&&y&&v||"single"===
A&&!v){z=!0;break}z||(C=!1)}}C&&(u[q]=D,p[3*q]=p[3*D],p[3*q+1]=p[3*D+1],p[3*q+2]=p[3*D+2],h[3*q]=h[3*D],h[3*q+1]=h[3*D+1],h[3*q+2]=h[3*D+2],q++)}return q};a.getAttributeValues=function(p,h,u){return p?.attributeInfo.useElevation?h?c(h,u):null:p?.attributeInfo.storageInfo?m.readBinaryAttribute(p.attributeInfo.storageInfo,p.buffer,u):null};a.readGeometry=function(p,h){if(null==p.encoding||""===p.encoding){p=m.createGeometryIndexFromSchema(h,p);if(null==p.vertexAttributes.position)return;h=m.createTypedView(h,
p.vertexAttributes.position);var u=p.header.fields;p=[u.offsetX,u.offsetY,u.offsetZ];u=[u.scaleX,u.scaleY,u.scaleZ];const w=h.length/3,x=new Float64Array(3*w);for(let n=0;n<w;n++)x[3*n]=h[3*n]*u[0]+p[0],x[3*n+1]=h[3*n+1]*u[1]+p[1],x[3*n+2]=h[3*n+2]*u[2]+p[2];return x}if("lepcc-xyz"===p.encoding)return f.decodeXYZ(h).result};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,g,d,k,m,f,c,l){var e;d=e=class extends f{constructor(p){super(p);this.type="point-cloud-class-breaks";this.colorClassBreakInfos=this.fieldTransformType=this.legendOptions=this.field=null}clone(){return new e({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([k.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],d.prototype,
"type",void 0);a.__decorate([g.property({json:{write:!0},type:String})],d.prototype,"field",void 0);a.__decorate([g.property({type:c.LegendOptions,json:{write:!0}})],d.prototype,"legendOptions",void 0);a.__decorate([g.property({type:f.fieldTransformTypeKebabDict.apiValues,json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);a.__decorate([g.property({type:[l],json:{write:!0}})],
d.prototype,"colorClassBreakInfos",void 0);return d=e=a.__decorate([m.subclass("esri.renderers.PointCloudClassBreaksRenderer")],d)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(a,b,g,d,k,m,f,
c,l){m=b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});g=class extends g.JSONSupport{constructor(e){super(e);this.type=void 0;this.colorModulation=this.pointSizeAlgorithm=null;this.pointsPerInch=10}clone(){console.warn(".clone() is not implemented for "+this.declaredClass);return null}cloneProperties(){return{pointSizeAlgorithm:d.clone(this.pointSizeAlgorithm),
colorModulation:d.clone(this.colorModulation),pointsPerInch:d.clone(this.pointsPerInch)}}};a.__decorate([k.property({type:m.apiValues,readOnly:!0,nonNullable:!0,json:{type:m.jsonValues,read:!1,write:m.write}})],g.prototype,"type",void 0);a.__decorate([k.property({types:l.pointSizeAlgorithmTypes,json:{write:!0}})],g.prototype,"pointSizeAlgorithm",void 0);a.__decorate([k.property({type:c,json:{write:!0}})],g.prototype,"colorModulation",void 0);a.__decorate([k.property({json:{write:!0},nonNullable:!0,
type:Number})],g.prototype,"pointsPerInch",void 0);g=a.__decorate([f.subclass("esri.renderers.PointCloudRenderer")],g);(g||(g={})).fieldTransformTypeKebabDict=new b.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return g})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f){var c;b=c=class extends b.JSONSupport{constructor(){super(...arguments);this.field=null;this.minValue=0;this.maxValue=255}clone(){return new c({field:this.field,minValue:this.minValue,maxValue:this.maxValue})}};a.__decorate([g.property({type:String,json:{write:!0}})],b.prototype,"field",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"minValue",void 0);a.__decorate([g.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,
"maxValue",void 0);return b=c=a.__decorate([f.subclass("esri.renderers.support.pointCloud.ColorModulation")],b)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,b,g,d){a.pointSizeAlgorithmTypes={key:"type",base:b,typeMap:{"fixed-size":g,splat:d}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){b=new b.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});g=class extends g.JSONSupport{};a.__decorate([d.property({type:b.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.jsonValues,read:!1,write:b.write}})],g.prototype,"type",void 0);return g=a.__decorate([c.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],g)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,g,d,k,m,f,c){var l;g=l=class extends c{constructor(){super(...arguments);this.type="fixed-size";this.size=0;this.useRealWorldSymbolSizes=null}clone(){return new l({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})}};a.__decorate([m.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],g.prototype,"type",void 0);a.__decorate([b.property({type:Number,nonNullable:!0,json:{write:!0}})],g.prototype,"size",void 0);a.__decorate([b.property({type:Boolean,json:{write:!0}})],
g.prototype,"useRealWorldSymbolSizes",void 0);return g=l=a.__decorate([f.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],g)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,g,d,k,m,f,c){var l;g=l=class extends c{constructor(){super(...arguments);this.type="splat";this.scaleFactor=1}clone(){return new l({scaleFactor:this.scaleFactor})}};a.__decorate([m.enumeration({pointCloudSplatAlgorithm:"splat"})],g.prototype,"type",void 0);a.__decorate([b.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],g.prototype,"scaleFactor",void 0);return g=l=a.__decorate([f.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],g)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f){var c;g=c=class extends g.JSONSupport{constructor(){super(...arguments);this.label=this.description=null;this.maxValue=this.minValue=0;this.color=null}clone(){return new c({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:d.clone(this.color)})}};a.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"description",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"label",void 0);a.__decorate([k.property({type:Number,
json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],g.prototype,"minValue",void 0);a.__decorate([k.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],g.prototype,"maxValue",void 0);a.__decorate([k.property({type:b,json:{type:[m.Integer],write:!0}})],g.prototype,"color",void 0);return g=c=a.__decorate([f.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],g)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,g,d,k,m,f,c,l){var e;d=e=class extends f{constructor(p){super(p);this.type="point-cloud-stretch";this.stops=this.fieldTransformType=this.legendOptions=this.field=null}clone(){return new e({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([k.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],d.prototype,"type",void 0);a.__decorate([g.property({json:{write:!0},
type:String})],d.prototype,"field",void 0);a.__decorate([g.property({type:c.LegendOptions,json:{write:!0}})],d.prototype,"legendOptions",void 0);a.__decorate([g.property({type:f.fieldTransformTypeKebabDict.apiValues,json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);a.__decorate([g.property({type:[l],json:{write:!0}})],d.prototype,"stops",void 0);return d=e=a.__decorate([m.subclass("esri.renderers.PointCloudStretchRenderer")],
d)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),function(a,b,g,d,k,m,f,c,l){var e;d=e=class extends f{constructor(p){super(p);this.type="point-cloud-unique-value";this.legendOptions=
this.colorUniqueValueInfos=this.fieldTransformType=this.field=null}clone(){return new e({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([k.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],d.prototype,"type",void 0);a.__decorate([g.property({json:{write:!0},type:String})],d.prototype,"field",void 0);a.__decorate([g.property({type:f.fieldTransformTypeKebabDict.apiValues,
json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);a.__decorate([g.property({type:[l],json:{write:!0}})],d.prototype,"colorUniqueValueInfos",void 0);a.__decorate([g.property({type:c.LegendOptions,json:{write:!0}})],d.prototype,"legendOptions",void 0);return d=e=a.__decorate([m.subclass("esri.renderers.PointCloudUniqueValueRenderer")],d)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f){var c;g=c=class extends g.JSONSupport{constructor(){super(...arguments);this.color=this.values=this.label=this.description=null}clone(){return new c({description:this.description,label:this.label,values:d.clone(this.values),color:d.clone(this.color)})}};a.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"description",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],g.prototype,"label",void 0);a.__decorate([k.property({type:[String],json:{write:!0}})],
g.prototype,"values",void 0);a.__decorate([k.property({type:b,json:{type:[m.Integer],write:!0}})],g.prototype,"color",void 0);return g=c=a.__decorate([f.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],g)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,g,d,k,m,f,c){a.PointGraphic=class extends g{constructor(l){super(l);this.pointCloudMetadata=null}};b.__decorate([d.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=b.__decorate([c.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./Intersector ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/effects/RenderPlugin ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/RenderSlot ../../webgl-engine/lib/VertexArrayObject ../../webgl-engine/lib/VertexAttribute ../../../../chunks/PointRenderer.glsl ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K){function L(P,R,W,N,V){if(W.drawScreenSpace)return W.fixedSize*R*N;V=F.getMaxPointSizeScreenspace(V)*R*N;return W.useFixedSizes?Math.min(W.fixedSize/2,V):0<W.screenMinSize?Math.min(Math.max(W.screenMinSize*R*N,P/2),V):Math.min(P/2,V)}function J(P,R,W,N,V){return W.drawScreenSpace?0:L(P,R,W,N,V)}function M(P){return null!=P.component?P.component:-1}function T(P,R){if(null==P)return P;P=P.filter(W=>W.id!==R);return 0===P.length?
null:P}function Q(P){return null!=P.dist&&null!=P.point&&null!=P.pointId&&null!=P.node}const O={positions:[new K.VertexElementDescriptor(A.VertexAttribute.POSITION,3,B.DataType.FLOAT,0,12)],colors:[new K.VertexElementDescriptor(A.VertexAttribute.COLOR,3,B.DataType.UNSIGNED_BYTE,0,3,!0)]};a.PointRenderer=class extends r.SyncPrepareRenderPlugin{constructor(P){super(P);this.type=D.IntersectorType.PCL;this.isGround=!1;this._passParameters=new F.PointRendererPassParameters;this._highlights=new q.PointHighlights({forEachNode:R=>
this.forEachNode(R),addHighlight:(R,W,N)=>this._addHighlight(R,W,N),removeHighlight:(R,W)=>this._removeHighlight(R,W)});this.produces=new Map([[C.RenderSlot.OPAQUE_MATERIAL,R=>R!==v.ShaderOutput.Highlight||!this._highlights.empty]]);this.layerUid="";this._slicePlaneEnabled=!1;this._techniqueConfig=new I.PointRendererTechniqueConfiguration;this._nodes=new d}initializeRenderContext(P){this._context=P;P.requestRender()}uninitializeRenderContext(){}intersect(P,R,W,N){const V=p.create(),S=p.create(),X=
p.create(),ca=p.create(),ba=w.create(),ia=P.camera.perScreenPixelRatio/2,ka=P.camera.near;e.subtract(S,N,W);const na=1/e.length(S);e.scale(S,S,na);e.negate(X,S);h.set(ba,S[0],S[1],S[2],-e.dot(S,W));const Y=new Z,ea=new Z,fa=[],aa=u.create(),da=u.create(this._passParameters.clipBox);u.offset(da,-W[0],-W[1],-W[2],da);this._nodes.forAll(ra=>{const Aa=ra.splatSize*this._passParameters.scaleFactor;var qa=t.minimumDistancePlane(ra.obb,ba),la=t.maximumDistancePlane(ra.obb,ba);qa-=J(Aa,qa+ka,this._passParameters,
ia,ra.isLeaf);la-=J(Aa,la+ka,this._passParameters,ia,ra.isLeaf);qa=null!=Y.dist&&null!=ea.dist&&Y.dist<qa*na&&ea.dist>la*na;if(!(0>la||qa)&&(la=L(Aa,la+ka,this._passParameters,ia,ra.isLeaf),t.intersectLine(ra.obb,W,S,la))){la*=la;t.toAaBoundingBox(ra.obb,aa);u.offset(aa,-W[0],-W[1],-W[2],aa);qa=!u.contains(da,aa);e.subtract(ca,ra.origin,W);var ja=ra.coordinates.length/3;for(let Ca=0;Ca<ja;Ca++){V[0]=ca[0]+ra.coordinates[3*Ca];V[1]=ca[1]+ra.coordinates[3*Ca+1];V[2]=ca[2]+ra.coordinates[3*Ca+2];if(qa&&
!u.containsPoint(da,V))continue;var oa=e.dot(V,S),za=e.squaredLength(V)-oa*oa;if(za>la)continue;var ta=oa+ka;const Ga=J(Aa,ta,this._passParameters,ia,ra.isLeaf);if(0>oa-Ga)continue;ta-=Ga;ta=L(Aa,ta,this._passParameters,ia,ra.isLeaf);if(za>ta*ta)continue;const La=(oa-Ga)*na;oa=Ma=>{var Ra=Ca,Ya=Ma.point;null==Ya&&(Ya=p.create());Ya[0]=ra.origin[0]+ra.coordinates[3*Ra];Ya[1]=ra.origin[1]+ra.coordinates[3*Ra+1];Ya[2]=ra.origin[2]+ra.coordinates[3*Ra+2];Ma.point=Ya;Ma.dist=La;Ma.normal=X;Ma.node=ra;
Ma.pointId=Ca;Ma.layerUid=this.layerUid;return Ma};(null==Y.dist||La<Y.dist)&&(null==R||R(W,N,La))&&oa(Y);P.options.store!==D.StoreResults.MIN&&(null==ea.dist||La>ea.dist)&&(null==R||R(W,N,La))&&oa(ea);P.options.store!==D.StoreResults.ALL||null!=R&&!R(W,N,La)||(za=new Z,fa.push(oa(za)))}}});const ma=ra=>{const {layerUid:Aa,node:qa,pointId:la}=ra;return new n.PclTarget(ra.point,Aa,la,()=>this.createGraphic(qa,la,ra.point))},ua=(ra,Aa)=>{const qa=ma(Aa);ra.set(this.type,qa,Aa.dist,Aa.normal)};if(Q(Y)){var sa=
P.results.min;(null==sa.dist||Y.dist<sa.dist)&&ua(sa,Y)}Q(ea)&&P.options.store!==D.StoreResults.MIN&&(sa=P.results.max,(null==sa.dist||ea.dist>sa.dist)&&ua(sa,ea));if(P.options.store===D.StoreResults.ALL){sa=x.fromPoints(W,N);for(const ra of fa){const Aa=z.newIntersectorResult(sa);ua(Aa,ra);P.results.all.push(Aa)}}}prepareTechnique(P){if(0===this._nodes.length||P.output!==v.ShaderOutput.Color&&P.output!==v.ShaderOutput.Depth&&P.output!==v.ShaderOutput.Highlight)return null;this._nodes.forAll(R=>{null==
R.vao&&this._initNode(P,R)});this._techniqueConfig.drawScreenSize=this._passParameters.drawScreenSpace;this._techniqueConfig.useFixedSizes=this._passParameters.useFixedSizes;this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled;this._techniqueConfig.hasOccludees=P.bindParameters.hasOccludees;this._techniqueConfig.clippingEnabled=this._clippingEnabled;this._techniqueConfig.output=P.output;return this._context.techniqueRepository.releaseAndAcquire(G.PointRendererTechnique,this._techniqueConfig,
this._technique)}renderNode(P,R){const W=P.rctx,N=W.bindTechnique(R,this._passParameters,P.bindParameters),V=P.output===v.ShaderOutput.Highlight;this._nodes.forAll(S=>{0===S.coordinates.length||V&&!S.highlights||(N.bindDraw(S,P.bindParameters,this._passParameters),W.bindVAO(S.vao),V?this._renderHighlightFragments(W,S):W.drawArrays(B.PrimitiveType.POINTS,0,S.coordinates.length/3))})}_renderHighlightFragments(P,R){var W=R.highlights;if(null!=W){R=W[0].component;var N=R+1;for(let V=1;V<W.length;V++){const S=
W[V].component;S!==N&&(N-=R,0<N&&P.drawArrays(B.PrimitiveType.POINTS,R,N),R=S);N=S+1}W=N-R;0<W&&P.drawArrays(B.PrimitiveType.POINTS,R,W)}}set useFixedSizes(P){this._passParameters.useFixedSizes!==P&&(this._passParameters.useFixedSizes=P,this._requestRender())}get useFixedSizes(){return this._passParameters.useFixedSizes}set scaleFactor(P){this._passParameters.scaleFactor!==P&&(this._passParameters.scaleFactor=P,this._requestRender())}get scaleFactor(){return this._passParameters.scaleFactor}set minSizePx(P){this._passParameters.minSizePx!==
P&&(this._passParameters.minSizePx=P,this._requestRender())}get minSizePx(){return this._passParameters.minSizePx}set useRealWorldSymbolSizes(P){this._passParameters.useRealWorldSymbolSizes!==P&&(this._passParameters.useRealWorldSymbolSizes=P,this._requestRender())}get useRealWorldSymbolSizes(){return this._passParameters.useRealWorldSymbolSizes}set size(P){this._passParameters.size!==P&&(this._passParameters.size=P,this._requestRender())}get size(){return this._passParameters.size}set sizePx(P){this._passParameters.sizePx!==
P&&(this._passParameters.sizePx=P,this._requestRender())}get sizePx(){return this._passParameters.sizePx}set clippingBox(P){u.set(this._passParameters.clipBox,P||u.positiveInfinity)}get _clippingEnabled(){return!u.equals(this._passParameters.clipBox,u.positiveInfinity,(P,R)=>P===R)}get slicePlaneEnabled(){return this._slicePlaneEnabled}set slicePlaneEnabled(P){this._slicePlaneEnabled!==P&&(this._slicePlaneEnabled=P,this._requestRender())}addNode(P){this._nodes.push(P);this._highlights.nodeAdded(P);
this._requestRender()}removeNode(P){let R=null;this._nodes.filterInPlace(W=>W.id===P?(R=W,W.vao=g.disposeMaybe(W.vao),this._highlights.nodeRemoved(W),!1):!0);this._requestRender();return R}forEachNode(P){this._nodes.forAll(P)}removeAll(){this._nodes.forAll(P=>P.vao=g.disposeMaybe(P.vao));this._highlights.removeAll();this._nodes.clear();this._requestRender()}highlight(P){return this._highlights.add(P)}_addHighlight(P,R,W){var N=P.highlights;null==N&&(N=[]);R={component:R,id:W};N.push(R);R=M(R);for(W=
N.length-1;0<W&&R<M(N[W-1]);)[N[W-1],N[W]]=[N[W],N[W-1]],--W;P.highlights=N;this._requestRender()}_removeHighlight(P,R){P.highlights=T(P.highlights,R);this._requestRender()}_initNode(P,R){P=P.rctx;R.vao=new E.VertexArrayObject(P,y.Default3D,O,{positions:H.BufferObject.createVertex(P,B.Usage.STATIC_DRAW,R.coordinates),colors:H.BufferObject.createVertex(P,B.Usage.STATIC_DRAW,R.rgb)})}_requestRender(){this._context&&this._context.requestRender()}};b.__decorate([k.property({constructOnly:!0})],a.PointRenderer.prototype,
"createGraphic",void 0);a.PointRenderer=b.__decorate([l.subclass("esri.views.3d.layers.i3s.PointRenderer")],a.PointRenderer);class U extends F.PointRendererDrawParameters{constructor(P,R,W,N,V,S,X,ca,ba=null,ia=null){super(W,V,R);this.id=P;this.obb=N;this.coordinates=S;this.rgb=X;this.attributes=ca;this.pointIdFilterMap=ba;this.highlights=ia}}class Z{constructor(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""}}a.PointRendererNode=U;a.isInstanceOfNode=function(P){return P.hasOwnProperty("splatSize")};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports","../../../../core/handleUtils","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/Object3DStateID"],function(a,b,g,d){class k{constructor(f){this._context=f;this._highlights=new Set}get empty(){return 0===this._highlights.size}destroy(){this._highlights=null}add(f){const c=new m(f);this._highlights.add(c);this._enableSet(c);return b.makeHandle(()=>this._removeSet(c))}_removeSet(f){this._disableSet(f);
this._highlights.delete(f)}_enableSet(f){f.enabled||(f.enabled=!0,this._context.forEachNode(c=>this._enableSetForNode(f,c)))}_enableSetForNode(f,c){if(f.enabled){var l=f.ids.get(c.id);l&&l.forEach(e=>this._context.addHighlight(c,e,f.id))}}_disableSet(f){f.enabled&&(f.enabled=!1,this._context.forEachNode(c=>this._disableSetForNode(f,c)))}_disableSetForNode(f,c){f.enabled||this._context.removeHighlight(c,f.id)}nodeAdded(f){this._highlights.forEach(c=>this._enableSetForNode(c,f))}nodeRemoved(f){this._highlights.forEach(c=>
this._disableSetForNode(c,f))}removeAll(){this._highlights.forEach(f=>this._disableSet(f))}}class m{constructor(f){this.id=new d.Object3DStateID(g.Object3DState.Highlight);this.ids=new Map;this.enabled=!1;for(const c of f)null!=c&&this._add(c.nodeId,c.pointId)}_add(f,c){const l=this.ids.get(f);l?l.add(c):this.ids.set(f,new Set([c]))}}a.PointHighlights=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../geometry/support/aaBoundingBox ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z){function D(H){const B=new y.ShaderBuilder,K=H.output===p.ShaderOutput.Color,L=H.output===p.ShaderOutput.Depth,J=H.output===p.ShaderOutput.Highlight,{vertex:M,fragment:T}=B;B.include(h.SliceDraw,H);B.attributes.add(z.VertexAttribute.POSITION,"vec3");B.attributes.add(z.VertexAttribute.COLOR,"vec3");M.uniforms.add(new v.Matrix4DrawUniform("modelView",(Q,O)=>g.multiply(F,O.camera.viewMatrix,g.fromTranslation(F,Q.origin))),new r.Matrix4PassUniform("proj",
(Q,O)=>O.camera.projectionMatrix),new x.Float2DrawUniform("screenMinMaxSize",(Q,O,U)=>k.set(I,U.useFixedSizes?0:U.minSizePx*O.camera.pixelRatio,(Q.isLeaf?256:64)*O.camera.pixelRatio)),H.useFixedSizes?new n.Float2PassUniform("pointScale",(Q,O)=>k.set(I,Q.fixedSize*O.camera.pixelRatio,O.camera.fullHeight)):new x.Float2DrawUniform("pointScale",(Q,O,U)=>k.set(I,Q.splatSize*U.scaleFactor*O.camera.pixelRatio,O.camera.fullHeight/O.camera.pixelRatio)));H.clippingEnabled?M.uniforms.add(new q.Float3DrawUniform("clipMin",
(Q,O,U)=>f.set(G,U.clipBox[0]-Q.origin[0],U.clipBox[1]-Q.origin[1],U.clipBox[2]-Q.origin[2])),new q.Float3DrawUniform("clipMax",(Q,O,U)=>f.set(G,U.clipBox[3]-Q.origin[0],U.clipBox[4]-Q.origin[1],U.clipBox[5]-Q.origin[2]))):(M.constants.add("clipMin","vec3",[-b.numberMaxFloat32,-b.numberMaxFloat32,-b.numberMaxFloat32]),M.constants.add("clipMax","vec3",[b.numberMaxFloat32,b.numberMaxFloat32,b.numberMaxFloat32]));L?(e.addNearFar(B),e.addCalculateLinearDepth(B),B.varyings.add("depth","float")):H.output!==
p.ShaderOutput.Highlight&&B.varyings.add("vColor","vec3");M.code.add(t.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${H.drawScreenSize?t.glsl`
      float clampedScreenSize = pointSize;`:t.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${L?t.glsl`depth = calculateLinearDepth(nearFar, camera.z);`:""}
     ${K?t.glsl`vColor = color;`:""}
    }
  `);T.include(w.RgbaFloatEncoding,H);J&&B.include(u.OutputHighlight,H);T.code.add(t.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${L?t.glsl`fragColor = float2rgba(depth);`:""}
      ${J?t.glsl`outputHighlight();`:""}
      ${K?t.glsl`fragColor = vec4(vColor, 1.0);`:""}
    }
  `);return B}function C(H){return H?256:64}class E extends t.NoParameters{constructor(){super(...arguments);this.clipBox=l.create(l.positiveInfinity);this.useRealWorldSymbolSizes=this.useFixedSizes=!1;this.scaleFactor=1;this.sizePx=this.size=this.minSizePx=0}get fixedSize(){return this.drawScreenSpace?this.sizePx:this.size}get screenMinSize(){return this.useFixedSizes?0:this.minSizePx}get drawScreenSpace(){return this.useFixedSizes&&!this.useRealWorldSymbolSizes}}class A extends h.SlicePlaneParameters{constructor(H,
B,K){super(H);this.origin=H;this.isLeaf=B;this.splatSize=K}}const F=d.create(),G=c.create(),I=m.create();d=Object.freeze(Object.defineProperty({__proto__:null,PointRendererDrawParameters:A,PointRendererPassParameters:E,build:D,getMaxPointSizeScreenspace:C},Symbol.toStringTag,{value:"Module"}));a.PointRendererDrawParameters=A;a.PointRendererPassParameters=E;a.PointRendererShader=d;a.build=D;a.getMaxPointSizeScreenspace=C})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,g,d,k,m,f,c,l,e){class p extends d.ShaderTechnique{constructor(h,u,w){super(h,u,w)}initializeProgram(h){return new m.Program(h.rctx,p.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return e.makePipelineState({depthTest:{func:l.CompareFunction.LESS},depthWrite:e.defaultDepthWriteParams,colorWrite:e.defaultColorWriteParams,stencilWrite:this.configuration.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:this.configuration.hasOccludees?f.stencilBaseAllZerosParams:
null})}}p.shader=new g.ReloadableShaderModule(c.PointRendererShader,()=>new Promise((h,u)=>a(["./PointRenderer.glsl"],h,u)));b.PointRendererTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,g,
d,k){class m extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=g.ShaderOutput.Color;this.clippingEnabled=this.hasOccludees=this.useFixedSizes=this.drawScreenSize=this.hasSlicePlane=!1}}b.__decorate([d.parameter({count:g.ShaderOutput.COUNT})],m.prototype,"output",void 0);b.__decorate([d.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([d.parameter()],m.prototype,"drawScreenSize",void 0);b.__decorate([d.parameter()],m.prototype,"useFixedSizes",void 0);
b.__decorate([d.parameter()],m.prototype,"hasOccludees",void 0);b.__decorate([d.parameter()],m.prototype,"clippingEnabled",void 0);b.__decorate([d.parameter({constValue:!0})],m.prototype,"hasSliceInVertexProgram",void 0);a.PointRendererTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e){a.PopupSceneLayerView=p=>{p=class extends p{_validateFetchPopupFeatures(h){const {layer:u}=this,{popupEnabled:w}=u;if(!w)throw new g("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:u});if(!e.getFetchPopupTemplate(u,h))throw new g("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:u});}async prepareFetchPopupFeatures(h){}async fetchPopupFeatures(h,u){this._validateFetchPopupFeatures(u);h=null!=u?u.clientGraphics:null;
if(!h||0===h.length)return[];const w="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let x=[];"fieldsIndex"in this.layer&&(x=l.unpackFieldNames(this.layer.fieldsIndex,await e.getRequiredFields(w,e.getFetchPopupTemplate(this.layer,u))));await this.prepareFetchPopupFeatures(x);u=new Set;const n=[],q=[];for(const t of h)l.populateMissingFields(x,t,u)?q.push(t):n.push(t);return 0===q.length?n:this.whenGraphicAttributes(q,[...u]).catch(()=>q).then(t=>n.concat(t))}};
return p=b.__decorate([c.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/ReactiveSet ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ../../../support/featureFlags ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/featureEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T){c=H.defineFieldProperties();q=class extends q.I3SMeshView3D(I.DefinitionExpressionSceneLayerView(B.PopupSceneLayerView(v.LayerView3D(J)))){constructor(){super(...arguments);this.type="scene-layer-3d";this._setVisibilityHiddenObjectIds=new k;this.progressiveLoadFactor=1;this._elevationContext="scene";this._isIntegratedMesh=!1;this._supportsLabeling=!0;this._pendingEditsQueue=Promise.resolve();this._interactiveEditingSessions=
new Map;this._queryEngine=null}get i3slayer(){return this.layer}tryRecycleWith(Q,O){return Q.url===this.layer.url&&this.i3sOverrides.isEmpty?Q.load(O).then(()=>{G.checkRecyclable(this.layer,Q,this.i3sOverrides);this.layer=Q;this.i3sOverrides.destroy();this.i3sOverrides=new C.I3SOverrides({view:this.view,layer:Q,memoryController:this.view.resourceController?.memoryController});this.resetHighlights()}):null}get layerPopupEnabledAndHasTemplate(){return this.layer.popupEnabled&&M.hasPopupTemplate(this.layer,
this.view.popup?.defaultPopupTemplateEnabled)}get filter(){return this._get("filter")}set filter(Q){this._set("filter",z.I3SMeshViewFilter.checkSupport(Q)?Q:null)}get viewFilter(){const Q=this.filter,O=this.layerFilter;if(null==Q&&null==O)return null;const U=this._get("viewFilter");if(null==U)return new z.I3SMeshViewFilter({layerFilter:O,viewFilter:Q,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:Z=>this._loadAsyncModule(Z),addSqlFilter:(Z,P)=>this.addSqlFilter(Z,P,this.logError)});U.viewFilter=
Q;U.layerFilter=O;return U}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get _floorFilterClause(){const Q=w.getFloorFilterClause(this);return null!=Q?h.WhereClause.create(Q,this.layer.fieldsIndex):null}get _excludeObjectIdsSorted(){const Q=this.layer.excludeObjectIds.toArray();return Q.length?Q.sort((O,U)=>O-U):null}get _setVisibilityHiddenObjectIdsSorted(){return this._setVisibilityHiddenObjectIds.size?Array.from(this._setVisibilityHiddenObjectIds).sort((Q,O)=>Q-O):null}get _objectQualitySettings(){return this.view?.qualitySettings?.sceneService?.object}get lodFactor(){return this._objectQualitySettings?.lodFactor??
1}get lodCrossfadeinDuration(){return this._objectQualitySettings.lodCrossfadeinDuration??0}get lodCrossfadeoutDuration(){return this._objectQualitySettings.lodCrossfadeoutDuration??0}get lodCrossfadeUncoveredDuration(){return this._objectQualitySettings.lodCrossfadeUncoveredDuration??0}get updatingProgressValue(){return this._controller?.updatingProgress??0}initialize(){this._fieldsHelper=new K.SceneLayerViewRequiredFields({layerView:this});this._updatingHandles.add(()=>this.layer.rangeInfos,O=>
this._rangeInfosChanged(O),m.initial);this._updatingHandles.add(()=>this.layer.renderer,O=>this._updatingHandles.addPromise(this._rendererChange(O)),m.initial);const Q=()=>this._filterChange();this._updatingHandles.add(()=>this.parsedDefinitionExpression,Q);this._updatingHandles.add(()=>this.filter,Q);this._updatingHandles.add(()=>this._floorFilterClause,Q);this._updatingHandles.add(()=>this._excludeObjectIdsSorted,Q);this._updatingHandles.add(()=>this._setVisibilityHiddenObjectIdsSorted,Q);this._updatingHandles.add(()=>
null!=this.viewFilter?this.viewFilter.sortedObjectIds:null,Q);this._updatingHandles.add(()=>null!=this.viewFilter?this.viewFilter.parsedWhereClause:null,Q);this._updatingHandles.add(()=>[null!=this.viewFilter?this.viewFilter.parsedGeometry:null,null!=this.filter?this.filter.spatialRelationship:null,null!=this.layer.filter?this.layer.filter.spatialRelationship:null],()=>this._geometryFilterChange());n.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&this._updatingHandles.add(()=>this.i3sOverrides.sortedGeometryChangedObjectIds,
Q);this.addHandles(this.layer.on("apply-edits",O=>this._updatingHandles.addPromise(O.result)));this.addHandles(this.layer.on("edits",O=>{const U=this._pendingEditsQueue.then(()=>this._handleEdits(O)).then();this._pendingEditsQueue=U;this._updatingHandles.addPromise(U)}))}destroy(){this._fieldsHelper=d.destroyMaybe(this._fieldsHelper)}_rangeInfosChanged(Q){null!=Q&&0<Q.length&&g.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const Q=
{outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(Q):new x(Q)}queryExtent(Q,O){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(Q),O?.signal)}queryFeatureCount(Q,O){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(Q),O?.signal)}queryFeatures(Q,O){return this._ensureQueryEngine().executeQuery(this._ensureQuery(Q),O?.signal).then(U=>{if(!U?.features)return U;const Z=this.layer;
for(const P of U.features)P.layer=Z,P.sourceLayer=Z;return U})}queryObjectIds(Q,O){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(Q),O?.signal)}_ensureQueryEngine(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine}_createQueryEngine(){const Q=y.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new E.I3SQueryEngine({layerView:this,priority:T.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new F.I3SQueryFeatureStore({featureAdapter:new A.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,
attributeStorageInfo:this.layer.attributeStorageInfo??[],getFeatureExtent:Q}),forAllFeatures:(O,U)=>this._forAllFeatures((Z,P,R)=>O({id:Z,index:P,meta:R}),U,t.ForAllFeaturesMode.QUERYABLE),getFeatureExtent:Q,sourceSpatialReference:G.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(Q){const O=this._highlights;if(Q instanceof x){const {set:U,handle:Z}=O.acquireSet();this.queryObjectIds(Q).then(P=>O.setFeatureIds(U,P));return Z}return super.highlight(Q)}createInteractiveEditSession(Q){return r.createInteractiveEditSession(this._attributeEditingContext,
Q)}_createLayerGraphic(Q){Q=new b(null,null,Q);Q.layer=this.layer;Q.sourceLayer=this.layer;return Q}getFilters(){const Q=super.getFilters();n.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&0<this.i3sOverrides.sortedGeometryChangedObjectIds.length&&Q.push((Z,P)=>{0<=P.node.index&&G.objectIdFilter(this.i3sOverrides.sortedGeometryChangedObjectIds,!1,Z)});const O=this._setVisibilityHiddenObjectIdsSorted;null!=O&&Q.push(Z=>G.objectIdFilter(O,!1,Z));const U=this._excludeObjectIdsSorted;null!=U&&
Q.push(Z=>G.objectIdFilter(U,!1,Z));this._floorFilterClause&&this.addSqlFilter(Q,this._floorFilterClause,this.logError);this.addSqlFilter(Q,this.parsedDefinitionExpression,this.logError);null!=this.viewFilter&&this.viewFilter.addFilters(Q,this.view,this._controller.crsIndex,this._collection);return Q}setVisibility(Q,O){O?this._setVisibilityHiddenObjectIds.delete(Q):this._setVisibilityHiddenObjectIds.add(Q)}isUpdating(){return super.isUpdating()||this.layerFilterUpdating||null!=this.viewFilter&&this.viewFilter.updating||
null!=this.i3sOverrides&&this.i3sOverrides.updating}_ensureQuery(Q){return this._addDefinitionExpressionToQuery(null==Q?this.createQuery():x.from(Q))}get _attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),globalIdField:this._getGlobalIdField(),forEachNode:Q=>this._forAllNodes(O=>null!=O?Q(O.node,O.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this.i3sOverrides,
getAttributeData:Q=>this.getAttributeData(Q),setAttributeData:(Q,O)=>this.setAttributeData(Q,O),clearMemCache:()=>this.clearMemCache()}}async _handleEdits(Q){const O=n.sceneLayerEditingEnabled(),U=this._attributeEditingContext;Q=await r.normalizeEditResultsEvent(U,Q);O&&r.processGeometryEdits(U,Q);r.processAttributeEdits(U,Q)}get hasGeometryFilter(){return null!=this.viewFilter?.parsedGeometry}computeNodeFiltering(Q){const O=this.viewFilter;return null==O||!this.view.spatialReference||O.isMBSGeometryVisible(Q,
this.view.spatialReference,this._controller.crsIndex)?D.NodeFilterImpact.Unmodified:D.NodeFilterImpact.Culled}};a.__decorate([f.property()],q.prototype,"i3slayer",null);a.__decorate([f.property(L.updatingProgress)],q.prototype,"updatingProgress",void 0);a.__decorate([f.property({type:u})],q.prototype,"filter",null);a.__decorate([f.property({readOnly:!0})],q.prototype,"viewFilter",null);a.__decorate([f.property(c.requiredFields)],q.prototype,"requiredFields",null);a.__decorate([f.property(c.availableFields)],
q.prototype,"availableFields",void 0);a.__decorate([f.property()],q.prototype,"_fieldsHelper",void 0);a.__decorate([f.property()],q.prototype,"_floorFilterClause",null);a.__decorate([f.property()],q.prototype,"_excludeObjectIdsSorted",null);a.__decorate([f.property()],q.prototype,"_setVisibilityHiddenObjectIds",void 0);a.__decorate([f.property()],q.prototype,"_setVisibilityHiddenObjectIdsSorted",null);a.__decorate([f.property()],q.prototype,"_objectQualitySettings",null);a.__decorate([f.property()],
q.prototype,"lodFactor",null);a.__decorate([f.property()],q.prototype,"updatingProgressValue",null);return q=a.__decorate([p.subclass("esri.views.3d.layers.SceneLayerView3D")],q)})},"esri/core/ReactiveSet":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,b){class g{constructor(){this._set=new Set;this._observable=new b.SimpleObservable}get size(){a.trackAccess(this._observable);return this._set.size}add(d){const k=this._set.size;this._set.add(d);
this._set.size!==k&&this._observable.notify();return this}clear(){0<this._set.size&&(this._set.clear(),this._observable.notify())}delete(d){(d=this._set.delete(d))&&this._observable.notify();return d}entries(){a.trackAccess(this._observable);return this._set.entries()}forEach(d,k){a.trackAccess(this._observable);this._set.forEach((m,f)=>d.call(k,m,f,this),k)}has(d){a.trackAccess(this._observable);return this._set.has(d)}keys(){a.trackAccess(this._observable);return this._set.keys()}values(){a.trackAccess(this._observable);
return this._set.values()}[Symbol.iterator](){a.trackAccess(this._observable);return this._set[Symbol.iterator]()}get [Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}return g})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/ByteSizeUnit ../../../core/Collection ../../../core/handleUtils ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ../../../geometry/projection/localLinearScaleFactors ../../../geometry/projection/projectBoundingSphere ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectors ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/DoubleArray ../../../geometry/support/FloatArray ../../../geometry/support/Indices ../../../chunks/sphere ../../../geometry/support/UByteArray ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../support/basemapUtils ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba,ia,ka,na,Y,ea,fa,aa,da,ma,ua,sa,ra,Aa,qa,la,ja,oa,za,ta,Ca,Ga,La,Ma,Ra,Ya,ab,Wa,cb,Na,xa,Da,Ka,ha,Sa,Va,wa,Ba){function Ja(gb,va){x.isAbortError(gb)||rb.warn("Error while processing edges. Edges on this layer might not display correctly",va,gb)}function Ta(gb){if(null==gb)return!1;const va=gb.metallicRoughness;return va&&0<=va.baseColorTextureId||va&&0<=va.metallicRoughnessTextureId||0<=gb.normalTextureId||
0<=gb.emissiveTextureId||0<=gb.occlusionTextureId}function db(gb){return null!=gb&&t.isArrayBuffer(gb.data)}function lb(gb,va){gb=1024+gb.interleavedVertexData.byteLength+(gb.indices?gb.indices.byteLength:0)+gb.positionData.data.byteLength+gb.positionData.indices.byteLength;if(null!=va)for(const Fa of va)null!=Fa&&t.isArrayBuffer(Fa.data)&&(gb+=Fa.data.byteLength);return gb}function mb(gb,va){return va.byteSize>Lb?(rb.warn(`Node is too big to store in IndexedDB cache: ${gb.id} (${va.byteSize} bytes)`),
!1):0<va.byteSize}function ob(gb){if(0===gb.length)return null;const va=new Float64Array(10*gb.length);gb.forAll((Fa,Pa)=>{let Qa=Fa.serviceObb;null==Qa&&(Qa=Za,G.copy(Qa.center,Fa.mbs),Qa.halfSize[0]=Qa.halfSize[1]=Qa.halfSize[2]=Fa.mbs[3]);Fa=10*Pa;va[Fa]=Qa.center[0];va[Fa+1]=Qa.center[1];va[Fa+2]=Qa.center[2];va[Fa+3]=Qa.halfSize[0];va[Fa+4]=Qa.halfSize[1];va[Fa+5]=Qa.halfSize[2];va[Fa+6]=Qa.quaternion[0];va[Fa+7]=Qa.quaternion[1];va[Fa+8]=Qa.quaternion[2];va[Fa+9]=Qa.quaternion[3]});return va}
function pb(gb,va){gb.forEach(Fa=>Fa.opacity=va)}function zb(gb){return va=>{if(gb.immediate)return gb.immediate.schedule(va);console.error("Error no immediate schudler");throw Error("cant find immediate scheduler");}}const rb=p.getLogger("esri.views.3d.layers.I3SMeshView3D"),Jb=[1,1,1,1];class fb extends la.NodeCrossfadeMetaData{constructor(gb,va,Fa,Pa,Qa,$a,eb,kb,tb){super();this.node=gb;this.featureIds=va;this.objectHandle=Fa;this.cachedRendererVersion=Pa;this.attributeInfo=Qa;this.material=$a;
this.textures=eb;this.anchorIds=kb;this.anchors=tb;this.cachedElevationAnchors=null;this.cachedEdgeMaterials=[];this.edgeMemoryUsage=0}}var Cb;(function(gb){gb[gb.CastShadows=4]="CastShadows";gb[gb.Pickable=5]="Pickable"})(Cb||(Cb={}));const Lb=100*f.ByteSizeUnit.MEGABYTES;var Hb;(function(gb){gb[gb.ADD=0]="ADD";gb[gb.REMOVE=1]="REMOVE";gb[gb.UPDATE=2]="UPDATE"})(Hb||(Hb={}));const Mb=U.create(),Ha=Z.create(),Oa=Z.create(),Za=xa.create(),ib=[0,0,0,0],jb=new d([0,0,0,0]),nb=N.fromValues(0,0,0,0);b.ElevationMode=
void 0;(function(gb){gb[gb.Absolute=0]="Absolute";gb[gb.RelativeToGround=1]="RelativeToGround";gb[gb.OnTheGround=2]="OnTheGround"})(b.ElevationMode||(b.ElevationMode={}));const vb=I.create(),Kb=U.create();b.I3SMeshView3D=gb=>{gb=class extends gb{constructor(...va){super(va);this._updatingHandles=new K.UpdatingHandles;this._nodeId2Meta=new Map;this._nodeId2MetaReloading=new Map;this._i3sWasmLoaded=!1;this._snappingSourcesTrackers=[];this._hasLoadedPBRTextures=!1;this._asyncModuleLoading=0;this._addTasks=
new Map;this._currentRenderer=null;this._rendererVersion=0;this._symbologyOverrideFields=this._symbologyOverride=this._symbologyFields=this._rendererFields=this._opacityVariable=this._colorVariable=null;this._symbolInfos=new Map;this._visibleGeometryChangedSchedulerHandle=null;this._hasVertexColors=this._hasComponentData=!1;this._nodeColorOverride=null;this.updating=!0;this.holeFilling="auto";this.slicePlaneEnabled=this._hasData=this._hasTextures=this._hasColors=!1;this._modifications=[];this.ignoresMemoryFactor=
!1;this._layerUrl="";this._elevationTask=this._cacheKeySuffix=null;this._filters=[];this._arcade=null;this._tmpAttributeOnlyGraphic=new k(null,null,{});this._crossfadeHelper=new la.I3SCrossfadeHelper(this)}get lodCrossfadeoutDuration(){return 0}get lodCrossfadeinDuration(){return 0}get lodCrossfadeUncoveredDuration(){return 0}get layerUid(){return this.i3slayer&&this.i3slayer.uid}get sublayerUid(){return null}get layerId(){return this.i3slayer&&this.i3slayer.id}get sublayerId(){return null}get contentVisible(){return!this.suspended&&
this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}get updatingProgressValue(){return this._controller?.updatingProgress??0}get hasTexturesOrVertexColors(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}get rendererTextureUsage(){return Ma.rendererNeedsTextures(this._currentRenderer)?this._usePBR||this._hasLoadedPBRTextures?ra.TextureUsage.AllTexturesPBR:ra.TextureUsage.AllTextures:this._usePBR||
this._hasLoadedPBRTextures?ra.TextureUsage.GeometryTexturesPBR:ra.TextureUsage.GeometryTextures}get elevationOffset(){const va=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=va&&"absolute-height"===va.mode){const Fa=v.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Pa=ea.getMetersPerUnit(va.unit);return(va.offset??0)*Pa/Fa}return 0}get elevationInfo(){const va=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==va)return{mode:b.ElevationMode.Absolute,offset:0};
var Fa=v.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);const Pa=ea.getMetersPerUnit(va.unit);Fa=(va.offset??0)*Pa/Fa;switch(va.mode){case "absolute-height":return{mode:b.ElevationMode.Absolute,offset:Fa};case "relative-to-ground":return{mode:b.ElevationMode.RelativeToGround,offset:Fa};case "on-the-ground":return{mode:b.ElevationMode.OnTheGround,offset:0};default:return{mode:b.ElevationMode.Absolute,offset:0}}}get supportedTextureEncodings(){return ta.getSupportedEncodings(this.view._stage.renderView.capabilities)}get uncompressedTextureDownsamplingEnabled(){const va=
0===(this.supportedTextureEncodings&ra.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&va}get clientGeometry(){return this.i3sOverrides.geometryOverrides}get elevationRange(){var va=this._nodeId2Meta;let Fa=Infinity,Pa=-Infinity;for(const Qa of va.values()){if(null==Qa)continue;({node:{mbs:va}}=Qa);const [,$a,eb]=va;Fa=Math.min(Fa,$a-eb);Pa=Math.max(Pa,$a+eb)}return Number.isFinite(Fa)&&Number.isFinite(Pa)?{min:Fa,max:Pa}:null}initialize(){var va=
e("enable-feature:idb-mock-cache");this._idbCache=va?new Ya.IDBMockCache(this.view,va):new Ra.IDBCache("esri-scenelayer-cache","geometries");this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);va=this.view.resourceController;this.i3sOverrides=new Ga.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:va.memoryController});this._worker=new aa.I3SMeshWorkerHandle(zb(va));this.addResolvingPromise(this._worker.promise);va=this.i3slayer.store;this._worker.setLegacySchema(this.uid,
va.defaultGeometrySchema);Ma.checkSceneLayerValid(this.i3slayer);Ma.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new X({layerView:this,worker:this._worker});this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this.resetHighlights();va=va.defaultGeometrySchema;if(this._isIntegratedMesh||!va)this._hasComponentData=
!1;else{const Fa=va.featureAttributes;this._hasComponentData=!!(Fa&&Fa.faceRange&&Fa.id)}this._hasVertexColors=null!=(va?.vertexAttributes.color??null)&&!this.i3slayer.cachedDrawingInfo?.color;this._isIntegratedMesh||(this._edgeView=this._stage.renderer.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(`sl-${this.uid}`,Fa=>this._deleteComponentObject(Fa));this._intersectionHandler=new za.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,
collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:Fa=>null!=this._controller.index?.rootNode?this._controller.index.traverse(this._controller.index.rootNode,Pa=>{var Qa=Pa.index;Qa=this._nodeId2Meta.get(Qa)||this._nodeId2MetaReloading.get(Qa);return Fa(Pa,null!=Qa?Qa.objectHandle:null)}):()=>{}});this._updatingHandles.add(()=>this.layerUid,Fa=>this._intersectionHandler.layerUid=Fa);this._updatingHandles.add(()=>this.sublayerUid,
Fa=>this._intersectionHandler.sublayerUid=Fa);this._elevationProvider=new ja({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR;this._updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),n.initial);this._updatingHandles.add(()=>this.fullOpacity,Fa=>this._opacityChange(Fa));this._updatingHandles.add(()=>this.slicePlaneEnabled,Fa=>this._slicePlaneEnabledChange(Fa));this._updatingHandles.add(()=>this.elevationOffset,(Fa,Pa)=>
{this._reloadAll(Pa);this._controller.invalidateVisibilityObbs()});this._updatingHandles.add(()=>this.elevationInfo,(Fa,Pa)=>this._elevationInfoChanged(Fa,Pa),n.initial);this._updatingHandles.add(()=>!this.suspended&&this.elevationInfo.mode!==b.ElevationMode.Absolute,(Fa,Pa)=>{Fa?this.addHandles(this.view.basemapTerrain.on("elevation-change",({extent:Qa})=>this._ensureElevationTask().addExtent(Qa)),"elevation-change"):Pa&&this.removeHandles("elevation-change")},n.initial);this._updatingHandles.add(()=>
this._usePBR,Fa=>this._updatePBR(Fa));va=()=>{this._reloadAll();this.clearMemCache()};this._updatingHandles.add(()=>this.rendererTextureUsage,va);this._updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,va);this._updatingHandles.add(()=>this.contentVisible,Fa=>this._contentVisibleChanged(Fa),n.initial);this._updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),n.initial);this._updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),
n.initial);this._updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),n.initial);this.addHandles([n.watch(()=>cb.debugFlags.I3S_TREE_SHOW_TILES,Fa=>{if(Fa&&!this._treeDebugger){const Pa=this._controller.crsIndex;(new Promise((Qa,$a)=>a(["./support/I3STreeDebugger"],Qa,$a))).then(({I3STreeDebugger:Qa})=>{!this._treeDebugger&&cb.debugFlags.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Qa({lv:this,view:this.view,nodeSR:Pa}))})}else Fa||cb.debugFlags.I3S_TREE_SHOW_TILES||(this._treeDebugger=
u.destroyMaybe(this._treeDebugger))},n.initial),n.watch(()=>cb.debugFlags.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),n.initial)]);this._cacheKeySuffix=Ma.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(Fa=>rb.warn(`Failed to initialize IndexedDB cache: ${Fa}`))}destroy(){this._clearAddTasks();this._elevationTask=u.destroyMaybe(this._elevationTask);this.i3sOverrides=u.destroyMaybe(this.i3sOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),
this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const va=this._worker;va&&(va.destroyContext(this.uid).then(()=>va.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=u.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=u.destroyMaybe(this._labeler);
this._treeDebugger=u.destroyMaybe(this._treeDebugger);this._controller=u.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this._crossfadeHelper=u.destroyMaybe(this._crossfadeHelper);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null);this._updatingHandles=u.destroyMaybe(this._updatingHandles)}_memEstimateTextureAdded(va){va=
va.memoryEstimate;this._gpuMemoryEstimate+=va;this._texMemoryEstimate+=va;return va}_memEstimateTextureRemoved(va){null!=va&&(va=va.memoryEstimate,this._gpuMemoryEstimate-=va,this._texMemoryEstimate-=va)}_memEstimateGeometryAdded(va){va=this._collection.getObjectGPUMemoryUsage(va);this._gpuMemoryEstimate+=va;this._geoMemoryEstimate+=va;return va}_memEstimateGeometryRemoved(va){va=this._collection.getObjectGPUMemoryUsage(va);this._gpuMemoryEstimate-=va;this._geoMemoryEstimate-=va}isNodeLoaded(va){return this._nodeId2Meta.has(va)}isNodeReloading(va){return this._nodeId2MetaReloading.has(va)}get usedMemory(){let va=
null!=this._labeler?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Fa=>va+=null!=Fa?Fa.node.memory:0);this._nodeId2MetaReloading.forEach(Fa=>va+=null!=Fa?Fa.node.memory:0);return va}get unloadedMemory(){return(null!=this._controller?this._controller.unloadedMemoryEstimate:0)+(null!=this._labeler?this._labeler.unloadedMemoryEstimate:0)}_labelingChanged(){if(!sa.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)null!=this._labeler&&(this._labeler.destroy(),this._labeler=null);else if(null==
this._labeler){var va=new fa({view:this.view,layer:this.i3slayer,collection:this._collection,overrides:this.i3sOverrides});this._nodeId2Meta.forEach(Fa=>null!=Fa&&this._addMetaToLabeler(va,Fa));this._labeler=va}}_loadAsyncModule(va){++this._asyncModuleLoading;return va.then(Fa=>{--this._asyncModuleLoading;return Fa},Fa=>{--this._asyncModuleLoading;throw Fa;})}_modificationsChanged(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=ma.initialize().then(()=>{this._i3sWasmLoaded=!0;
this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var va=this.uid,Fa=this.i3slayer.spatialReference;this._worker.setModifications(va,this._layerClippingArea,this._modifications,Fa);var Pa=aa.toWasmModification(this._layerClippingArea,this._modifications,Fa);ma.setModificationsSync({context:va,modifications:Pa,isGeodetic:Fa.isGeographic});this._controller.modificationsChanged();var Qa=this.hasModifications?new w:null;this._nodeId2Meta.forEach(($a,
eb)=>{null==$a?(this._nodeId2Meta.delete(eb),this._controller.updateLoadStatus(eb,!1)):$a.node.hasModifications?(this._nodeId2Meta.delete(eb),this._nodeId2MetaReloading.set(eb,$a)):null!=Qa&&Qa.push($a.node)});this.notifyChange("elevationRange");null!=Qa&&this._nodeId2MetaReloading.forEach($a=>Qa.push($a.node));null!=Qa&&0<Qa.length&&(this.updateNodeModificationStatus(Qa),Qa.forAll($a=>{if($a.imModificationImpact!==Ca.NodeIMModificationImpact.Culled){const eb=this._nodeId2Meta.get($a.index);this._controller.invalidateGeometryVisibility($a.index);
null!=eb?(this._nodeId2Meta.delete($a.index),this._nodeId2MetaReloading.set($a.index,eb),this.notifyChange("elevationRange")):this._nodeId2Meta.has($a.index)&&(this._nodeId2Meta.delete($a.index),this._controller.updateLoadStatus($a.index,!1))}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}}_showModifications(){null!=this._modificationGraphics&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(cb.debugFlags.I3S_SHOW_MODIFICATIONS&&
0!==this._modifications.length){var va={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Fa={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Pa of this._modifications){const Qa=Pa.geometry;Qa.spatialReference=this.i3slayer.spatialReference;this._modificationGraphics.push(new k({geometry:Qa,symbol:{...Fa,color:va[Pa.type]}}))}this.view.graphics.addMany(this._modificationGraphics)}}_addMetaToLabeler(va,Fa){va.addNodeMeta(Fa,(Pa,Qa)=>
this._createAttributes(Pa,Qa))}_contentVisibleChanged(va){va?(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler)):(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler))}getLoadedAttributes(va){va=this._nodeId2Meta.get(va);
if(null!=va?.attributeInfo)return va.attributeInfo.loadedAttributes}getAttributeData(va){va=this._nodeId2Meta.get(va);if(null!=va?.attributeInfo)return va.attributeInfo.attributeData}setAttributeData(va,Fa){va=this._nodeId2Meta.get(va);null!=va?.attributeInfo&&(va.attributeInfo.attributeData=Fa,this._attributeValuesChanged(va))}async updateAttributes(va,Fa,Pa){const Qa=this._nodeId2Meta.get(va);null!=Qa&&(await this.i3sOverrides.applyAttributeOverrides(Qa.featureIds,Fa,Pa,this._controller.requiredAttributes),
Qa.attributeInfo=Fa,this._controller.reschedule(()=>this._attributeValuesChanged(Qa),Pa).catch($a=>{x.isAbortError($a)||rb.warn("Error while updating attribute values. Layer might not display correctly.",$a)}))}_attributeValuesChanged(va){va.cachedRendererVersion=this._getInvalidRendererVersion();va.filteredIds=null;null!=this._labeler&&this._labeler.setNodeMetaAttributes(va,(Fa,Pa)=>this._createAttributes(Fa,Pa));this._updateEngineObject(va)}clearMemCache(){null!=this._memCache&&this._memCache.clear()}getVisibleNodes(){const va=
[];this._nodeId2Meta.forEach(Fa=>null!=Fa&&va.push(Fa.node));return va}getNodeComponentObb(va){va=this._nodeId2Meta.get(va.index)??this._nodeId2MetaReloading.get(va.index);return null!=va?this._collection.getComponentObb(va.objectHandle):null}getLoadedNodeIndices(va){this._nodeId2Meta.forEach((Fa,Pa)=>va.push(Pa));this._nodeId2MetaReloading.forEach((Fa,Pa)=>va.push(Pa))}_preLoadBasis(){!e("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&ra.TextureEncoding.Basis)&&this.i3slayer.textureSetDefinitions?.some(va=>
va.formats.some(Fa=>"basis"===Fa.format||"ktx2"===Fa.format))&&wa.loadBasis()}_getVertexBufferLayout(va,Fa){va={hasTexture:Ta(va.params.material),hasNormals:Fa.normal,hasRegions:Fa.uvRegion};return Ka.glLayout(Sa.createVertexBufferLayout(this._getGeometryParameters(va)))}_getObjectIdField(){return this.i3slayer.objectIdField||S.fallbackObjectIDAttribute}_getGlobalIdField(){return this.i3slayer.associatedLayer?.globalIdField}_findGraphicNodeAndIndex(va){const Fa=ab.attributeLookup(this.i3slayer.fieldsIndex,
va.attributes,this._getObjectIdField());let Pa=null;h.someMap(this._nodeId2Meta,Qa=>{if(null==Qa)return!1;const $a=Qa.featureIds.indexOf(Fa);if(-1===$a)return!1;Pa={node:Qa.node,index:$a};return!0});return Pa}_getGraphicIndices(va,Fa){va=this._nodeId2Meta.get(va.index);if(null==va)return[];const Pa=[],Qa=this._getObjectIdField(),$a=this.i3slayer.fieldsIndex;for(const eb of Fa)Fa=ab.attributeLookup($a,eb.attributes,Qa),Fa=va.featureIds.indexOf(Fa),-1!==Fa&&Pa.push(Fa);return Pa}whenGraphicBounds(va){va=
this._findGraphicNodeAndIndex(va);if(!va)return Promise.reject();va=this._getAABB(va.node.index,va.index);return null==va?Promise.reject():Promise.resolve({boundingBox:va,screenSpaceObjects:[]})}getAABBFromIntersectorTarget(va){return null==va.nodeIndex||null==va.componentIndex?null:this._getAABB(va.nodeIndex,va.componentIndex)}_getAABB(va,Fa){va=this._nodeId2Meta.get(va);if(null==va?.featureIds||Fa>=va.featureIds.length)return null;Fa=oa.boundingBoxCornerPoints(Fa,this._collection,va.objectHandle,
P.newDoubleArray(24),0);if(!T.projectBuffer(Fa,this.view.renderSpatialReference,0,Fa,this.view.spatialReference,0,8))return null;va=U.empty();U.expandWithBuffer(va,Fa,0,8);return va}whenGraphicAttributes(va,Fa){return Ma.whenGraphicAttributes(this.i3slayer,va,this._getObjectIdField(),Fa,()=>[...this._nodeId2Meta.values()].filter(m.isSome))}getGraphicFromIntersectorTarget(va){if(null==va.nodeIndex||null==va.componentIndex)return null;const Fa=this._nodeId2Meta.get(va.nodeIndex);return null==Fa?.featureIds||
va.componentIndex>=Fa.featureIds.length?null:this._createGraphic(va.componentIndex,Fa)}_getCacheKey(va){return`${this._layerUrl}/v${23}/${va}${this._cacheKeySuffix}`}_getMemCacheKey(va,Fa=this.elevationOffset){return va+"#"+Fa}get _idbCacheEnabled(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}loadCachedGPUData(va){return null!=this._memCache?this._memCache.pop(this._getMemCacheKey(va)):null}deleteCachedGPUData(va){null!=va&&
this._deleteComponentObject(va)}_cacheGPUData(va,Fa=this.elevationOffset){if(null==this._memCache)this._deleteComponentObject(va);else{var Pa=this._controller.indexDepth-va.node.level;this._memCache.put(this._getMemCacheKey(va.node.index,Fa),va,va.node.memory,Pa)}}loadMissingTextures(va,Fa,Pa,Qa){const $a=va?.filter((eb,kb)=>{if(0===(eb.usage&this.rendererTextureUsage))return!1;if(null==Fa)return!0;eb=ta.selectEncoding(eb.encodings,this.supportedTextureEncodings);kb=Fa[kb];return null==kb?.data||
eb&&kb.encoding!==eb.encoding?!0:!1})??[];return 0===$a.length?Promise.resolve(!1):Pa($a,Qa).then(eb=>{let kb=0;for(let tb=0;tb<va.length;tb++)kb<eb.length&&eb[kb].id===va[tb].id&&(Fa[tb]=eb[kb],kb++);return!0})}loadCachedNodeData(va,Fa,Pa){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(va.id),Fa).then(Qa=>{if(null==Qa)return null;if(Qa.nodeVersion!==va.version)return this._idbCache.remove(this._getCacheKey(va.id)),null;this.elevationInfo.mode===b.ElevationMode.Absolute&&(va.geometryObb=
Qa.geometryObb);return this.loadMissingTextures(Qa.requiredTextures,Qa.textureData,Pa,Fa).then($a=>{$a&&this._idbCache.initialized&&null!=Qa.textureData&&(Qa.byteSize=lb(Qa.transformedGeometry,Qa.textureData),Qa.textureData.every(db)&&mb(va,Qa)&&this._idbCache.put(this._getCacheKey(va.id),Qa).catch(eb=>rb.warn(`Failed to update node with textures in IndexedDB cache: ${va.id}: ${eb}`)));x.throwIfAborted(Fa);return Qa})}):Promise.resolve(null)}addNode(va,Fa,Pa){return"geometryData"in Fa?null==Fa.geometryBuffer?
(this._addNodeMeta(va.index,null),Promise.resolve()):this._addData(va,Fa.attributeDataInfo,()=>this._transformNode(va,Fa,Pa).then(Qa=>this._safeReschedule(()=>{if(null==Qa)return va.hasModifications=!1,this._addCachedNodeData(va,null,Pa);va.hasModifications=Qa.transformedGeometry.hasModifications;const {obb:$a,componentOffsets:eb,featureIds:kb,anchorIds:tb,anchors:ub,transformedGeometry:xb}=Qa;var yb=La.computeGlobalTransformation(va.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),
Fb=xa.create([$a.center.x,$a.center.y,$a.center.z],[$a.extents.x,$a.extents.y,$a.extents.z],F.fromValues($a.orientation.x,$a.orientation.y,$a.orientation.z,$a.orientation.w));G.transformMat4(Fb.center,Fb.center,yb);this.elevationInfo.mode===b.ElevationMode.Absolute&&(va.geometryObb=Fb);Fa.geometryData.componentOffsets=eb;kb&&(Fa.geometryData.featureIds=Array.from(kb));Fa.geometryData.anchorIds=tb;Fa.geometryData.anchors=ub;yb={nodeVersion:va.version,geometryData:Fa.geometryData,requiredTextures:Fa.requiredTextures,
textureData:Fa.textureData,transformedGeometry:xb,globalTrafo:yb,geometryObb:Fb,byteSize:lb(xb,Fa.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&mb(va,yb)&&(Fb=null!=yb.textureData?yb.textureData.map(Sb=>db(Sb)?Sb:null):null,this._idbCache.put(this._getCacheKey(va.id),{...yb,textureData:Fb}).catch(Sb=>rb.warn(`Failed to store node in IndexedDB cache: ${va.id}: ${Sb}`)));return this._addCachedNodeData(va,yb,Pa)},Pa))):Promise.reject()}getElevationRange(va){let Fa=Infinity,Pa=-Infinity;
const Qa=L.getReferenceEllipsoid(this.view.renderCoordsHelper.spatialReference);this._nodeId2Meta.forEach($a=>{if(null!=$a?.node.geometryObb&&xa.intersectSphere($a.node.geometryObb,va)){var eb=this._collection.getObjectTransform($a.objectHandle);eb=this.view.renderCoordsHelper.getAltitude(eb.position);for(let tb=0;tb<$a.featureIds.length;tb++){var kb=this._collection.getComponentAabb($a.objectHandle,tb,Kb);if("local"===this.view.viewingMode)Fa=Math.min(Fa,eb+kb[2]),Pa=Math.max(Pa,eb+kb[5]);else{Fa=
Math.min(Fa,eb+kb[2]);const ub=Math.max(Math.abs(kb[3]),Math.abs(kb[0])),xb=Math.max(Math.abs(kb[4]),Math.abs(kb[1]));kb=eb+kb[5]+Qa.radius;Pa=Math.max(Pa,Math.sqrt(ub*ub+xb*xb+kb*kb)-Qa.radius)}}}});return{min:Fa,max:Pa}}computeVisibilityObb(va){return Ma.computeVisibilityObb(va,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)}_transformNode(va,Fa,Pa){var Qa=Fa.geometryData.geometries??[];const $a=Array(Qa.length);
for(var eb=0;eb<Qa.length;++eb)$a[eb]=this._getVertexBufferLayout(Qa[eb],Fa.geometryDescriptor);Qa=va.mbs;eb=this.elevationOffset;var kb=this._controller.crsIndex,tb=this._controller.crsVertex,ub=this.view.renderSpatialReference;const xb=La.getLocalOrigin(Qa,eb,kb),yb=La.computeGlobalTransformation(Qa,eb,kb,ub);kb=Q.getProjectorName(kb,tb);tb=Q.getProjectorName(tb,ub);if(null==kb||null==tb)return Promise.resolve(null);ub=this.i3slayer.normalReferenceFrame;return this._worker.invoke({context:this.uid,
geometryBuffer:Fa.geometryBuffer,geometryData:Fa.geometryData,geometryDescriptor:Fa.geometryDescriptor,layouts:$a,localOrigin:xb,globalTrafo:yb,mbs:Qa,obb:va.serviceObb,elevationOffset:eb,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:Fa.normalReferenceFrame??ub??"none",indexToVertexProjector:kb,vertexToRenderProjector:tb},Pa)}get _supportsNodeCrossFading(){return!this.view?._stage?.renderer.shadowsEnabled}get nodeCrossfadingEnabled(){return this._supportsNodeCrossFading&&
(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}get nodeFadeoutEnabled(){return this._supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}_setNewNodeOpacity(va){this._setNodeOpacity(va,this.nodeCrossfadingEnabled?0:this.fullOpacity)}addCachedGPUData(va,Fa,Pa){this.elevationInfo.mode===b.ElevationMode.Absolute&&(va.geometryObb=xa.clone(this._collection.getComponentObb(Fa.objectHandle)));this._controller.isGeometryVisible(va)?(null!=this._labeler&&
this._addMetaToLabeler(this._labeler,Fa),va=va.index,this._addNodeMeta(va,Fa),this.updateNodeState(va,Pa),this._collection.setObjectVisibility(Fa.objectHandle,ha.State.Visible),this._updateMaterial(Fa),this._setNewNodeOpacity(Fa),this.elevationInfo.mode!==b.ElevationMode.Absolute&&this._ensureElevationTask().schedule(va),this._updateEngineObject(Fa),this._highlights.objectCreated(Fa),null!=this._treeDebugger&&this._treeDebugger.update()):this._cacheGPUData(Fa)}addCachedNodeData(va,Fa,Pa,Qa){return this._addData(va,
Pa,()=>this._addCachedNodeData(va,Fa,Qa))}async deleteCachedNodeData(va){if(this._idbCacheEnabled)return this._idbCache.remove(this._getCacheKey(va))}async _addCachedNodeData(va,Fa,Pa){if(this.contentVisible&&this._controller.isGeometryVisible(va))if(null==Fa)this._addNodeMeta(va.index,null);else{var Qa=this._addTasks.get(va.index),{geometryData:$a,transformedGeometry:eb,globalTrafo:kb}=Fa;await this.i3sOverrides.applyAttributeOverrides($a.featureIds,Qa.attributeInfo,Pa,this._controller.requiredAttributes);
var tb=null!=Fa.textureData?Fa.textureData.filter(Qb=>null!=Qb&&0!==(Qb.usage&this.rendererTextureUsage)):[];!e("disable-feature:i3s-basis")&&tb.some(Qb=>null!=Qb&&(Qb.encoding===ra.TextureEncoding.Basis||Qb.encoding===ra.TextureEncoding.KTX2))&&await wa.loadBasis();va.memory=0;var {componentOffsets:ub,geometries:xb,featureIds:yb,anchorIds:Fb,anchors:Sb}=$a,Pb=this._collection,qb=xb[0],{layout:wb,indices:Ab,interleavedVertexData:Gb,positionData:Ib,hasColors:Ub}=eb,Vb=this._materialParameters(qb,wb),
$b=ub||new Uint32Array([0,Ab?Ab.length:Gb.byteLength/wb[0].stride]);$b={vertices:{data:Gb,count:Gb.byteLength/wb[0].stride,layoutParameters:Vb.geometryParams},positionData:{positions:R.compactFloatArray(Ib.data),indices:W.compactIndices(Ib.indices)},indices:Ab,componentOffsets:$b};var ac=qb.transformation?A.clone(qb.transformation):A.create();E.multiply(ac,kb,ac);qb=E.getTranslation(I.create(),ac);ac=D.fromMat4(C.create(),ac);var kc=this.view.renderSpatialReference,Yb=this.view.basemapTerrain.spatialReference,
lc=I.create(),ec=[1,1,1];J.localLinearScaleFactors(qb,kc,ec,Yb)||rb.errorOnce("Unsupported coordinate system for IM overlay");O.projectVectorToVector(qb,kc,lc,Yb);var Zb=Pb.createObject({toMapSpace:B.fromValues(lc[0],lc[1],ec[0],ec[1]),geometry:$b,obb:Fa.geometryObb,transform:{position:qb,rotationScale:ac}}),{textures:bc,texturePromise:mc}=this._initMaterialAndTextures(Zb,Vb.material,tb,Vb.geometryParams.textureCoordinates===Va.TextureCoordinateAttributeType.Atlas);va.memory+=this._memEstimateGeometryAdded(Zb);
va.memory+=bc.reduce((Qb,cc)=>Qb+(null!=cc?this._memEstimateTextureAdded(cc):0),0);tb=!!Vb.material.hasParametersFromSource;Vb="blend"!==Vb.material.alphaMode&&1<=Vb.material.metallicRoughness.baseColorFactor[3];var Tb=new fb(va,yb,Zb,this._getInvalidRendererVersion(),Qa.attributeInfo,{hasParametersFromSource:tb,isOpaque:Vb},bc,Fb,Sb);Qa.meta=Tb;!this._hasTextures&&Fa.requiredTextures?.some(({usage:Qb})=>0!==(Qb&ra.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=
this._hasColors||Ub;this._hasTextures=this._hasTextures||!!va.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var tc=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(Tb),mc]).then(([Qb])=>{null!=Qb&&Qb.updateObjectVisibility(Tb.objectHandle,!1).catch(cc=>Ja(cc,this.i3slayer.title));return this._safeReschedule(()=>{var cc=this._addTasks.get(va.index);if(cc)if(this._addNodeMeta(va.index,Tb),cc.meta=null,this.contentVisible){Pb.setObjectVisibility(Zb,ha.State.Visible);
null!=Qb&&Qb.updateObjectVisibility(Tb.objectHandle,!0).catch(ad=>Ja(ad,this.i3slayer.title));Tb.attributeInfo=cc.attributeInfo;cc=Tb.cachedRendererVersion!==this._rendererVersion;var hd=tc!==this.slicePlaneEnabled;this._updateElevationOffsets(Tb);var $c=Tb.elevationOffsets;this._updateComponentData(Tb);var id=this._applyFiltersToNode(Tb);(cc||null!=Qb&&(hd||id||$c))&&this._addOrUpdateEdgeRendering(Tb);null!=this._labeler&&this._addMetaToLabeler(this._labeler,Tb);this._visibleGeometryChanged(Tb,Hb.ADD);
this._highlights.objectCreated(Tb);this._updateMaterial(Tb);this._setNewNodeOpacity(Tb);null!=this._treeDebugger&&this._treeDebugger.update()}else this._removeNodeStageData(va.index,this.elevationOffset)},Pa)}).catch(Qb=>{null!=Qa.meta&&(this._cacheGPUData(Qa.meta),Qa.meta=null);throw Qb;})}else this._removeNodeStageData(va.index,this.elevationOffset,this._nodeId2MetaReloading)}_addNodeMeta(va,Fa){this._removeNodeStageData(va,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(va)){rb.error("Removing duplicated node");
const Pa=this._nodeId2Meta.get(va);null!=Pa&&this._deleteComponentObject(Pa)}else this._controller.updateLoadStatus(va,!0);null!=Fa&&(Fa.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&pb(Fa.cachedEdgeMaterials,0));this._nodeId2Meta.set(va,Fa);this.notifyChange("elevationRange")}_updateElevationOffsets(va){const Fa=this.view.renderSpatialReference,Pa=this._controller.crsIndex,Qa=this.elevationInfo,$a=this.view.basemapTerrain,eb=$a.spatialReference,kb=Qa.mode;if(null==Fa||null==eb||kb===b.ElevationMode.Absolute)va.elevationOffsets=
null;else{var tb=this._collection.getObjectTransform(va.objectHandle);va.elevationOffsets=va.elevationOffsets??[];var ub=kb===b.ElevationMode.OnTheGround,xb=this.view.renderCoordsHelper,yb=va.featureIds.length,Fb=(()=>{if(va.cachedElevationAnchors)return va.cachedElevationAnchors;const qb=P.newDoubleArray(3*yb);va.cachedElevationAnchors=qb;for(let wb=0;wb<yb;wb++){const Ab=3*wb,Gb=va.anchorIds?.indexOf(wb)??-1;va.anchors&&0<=Gb?(G.set(vb,va.anchors[3*Gb],va.anchors[3*Gb+1],va.anchors[3*Gb+2]),G.add(vb,
vb,va.node.mbs),O.projectVectorToVector(vb,Pa,vb,eb),qb[Ab]=vb[0],qb[Ab+1]=vb[1],qb[Ab+2]=xb.getAltitude(vb)):(this._collection.getComponentAabb(va.objectHandle,wb,Kb,!0),G.set(vb,(Kb[0]+Kb[3])/2,(Kb[1]+Kb[4])/2,Kb[2]),G.transformMat3(vb,vb,tb.rotationScale),G.add(vb,vb,tb.position),qb[Ab+2]=xb.getAltitude(vb),O.projectVectorToVector(vb,Fa,vb,eb),qb[Ab]=vb[0],qb[Ab+1]=vb[1])}return qb})(),Sb=Qa.offset,Pb=va.elevationOffsets;$a.getElevations(Fb,yb,(qb,wb)=>{const Ab=ub?Fb[3*qb+2]:0;Pb[qb]=Sb+(null!=
wb?wb-Ab:0)})}}_ensureElevationTask(){return null!=this._elevationTask?this._elevationTask:this._elevationTask=new qa.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,va=>{va=this._controller.updateElevationChanged(va,this.view.basemapTerrain.spatialReference);return null!=va?va.filterInPlace(Fa=>null!=this._nodeId2Meta.get(Fa)):null},va=>{va=this._nodeId2Meta.get(va);this._nodeElevationAlignmentChanged(va)})}_elevationInfoChanged(va,Fa){const Pa=va.mode!==b.ElevationMode.Absolute;
va=!!Fa&&Fa!==va&&Fa.mode!==b.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(Pa,this.view.state.viewingMode);Pa&&!va&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(Qa=>this._nodeElevationAlignmentChanged(Qa))}_nodeElevationAlignmentChanged(va){null!=va&&(this._updateElevationOffsets(va),this._updateComponentData(va),this._updateEdgeRendering(va),null!=this._labeler&&this._labeler.updateLabelPositions(va),this._updateSnappingSources(va,Hb.UPDATE))}_safeReschedule(va,
Fa){x.throwIfAborted(Fa);return this._controller.reschedule(va,Fa)}_materialParameters(va,Fa){va=null!=va.params.material?va.params.material:ta.defaultMaterial();const Pa=Fa.some($a=>"uvRegion"===$a.name);Fa=Fa.some($a=>"normalCompressed"===$a.name);const Qa=Ta(va);return{geometryParams:this._getGeometryParameters({hasTexture:Qa,hasNormals:Fa,hasRegions:Pa}),material:va}}_initMaterialAndTextures(va,Fa,Pa,Qa){const $a=this._stage.renderView,eb=Pa.map(tb=>ta.createTexture(tb,Fa,Qa,$a));this._stage.addMany(eb);
let kb=null;this._collection.updateMaterial(va,tb=>{kb=ta.configureMaterial(tb,Fa,eb,Pa,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(tb)});return{textures:eb,texturePromise:kb}}_getGeometryParameters(va){return{textureCoordinates:va.hasTexture?va.hasRegions?Va.TextureCoordinateAttributeType.Atlas:
Va.TextureCoordinateAttributeType.Default:Va.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,normals:va.hasNormals&&!this._isIntegratedMesh}}_addData(va,Fa,Pa){let Qa=this._addTasks.get(va.index);Qa?Qa.attributeInfo=Fa:(Qa={...x.createResolver(),attributeInfo:Fa,meta:null},this._addTasks.set(va.index,Qa),Pa().then(Qa.resolve,Qa.reject).then(()=>this._addTasks.delete(va.index)).catch($a=>{this._addTasks.delete(va.index);throw $a;}));return Qa.promise}_clearAddTasks(){this._addTasks.forEach(va=>
{null!=va.meta&&(this._cacheGPUData(va.meta),va.meta=null)});this._addTasks.clear()}_clippingAreaChanged(){var va=this.view.renderSpatialReference;const Fa=this.i3slayer.spatialReference,Pa=Z.create();this._renderClippingArea=Na.toBoundingRect(this.view.clippingArea,Pa,va)?Pa:null;va=Z.create();this._layerClippingArea=Na.toBoundingRect(this.view.clippingArea,va,Fa)?va:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()}get hasGeometryFilter(){return!1}_geometryFilterChange(){const va=
this.hasGeometryFilter;this._controller.geometryFilterChanged(va);this._applyFilters(va)}_filterChange(){this._applyFilters(this.hasGeometryFilter)}_applyFilters(va){this._filters=this.getFilters();va?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Fa=>{null!=Fa&&this._applyFiltersToNode(Fa)&&(this._addOrUpdateEdgeRendering(Fa),this._visibleGeometryChanged(Fa,Hb.UPDATE))})}getFilters(){const va=[],Fa=this._renderClippingArea;null!=Fa&&va.push((Pa,Qa)=>this._boundingRectFilter(Pa,
Qa,Fa));return va}addSqlFilter(va,Fa,Pa){if(null!=Fa){const Qa=Fa.fieldNames;va.push(($a,eb)=>this._sqlFilter($a,eb,Fa,Qa,Pa))}}_sqlFilter(va,Fa,Pa,Qa,$a){const eb={},kb=this._createLayerGraphic(eb),tb=this.i3slayer.objectIdField,ub=Fa.featureIds,xb=Fa.attributeInfo?.attributeData;Qa.every(yb=>yb===tb||null!=xb?.[yb])&&Ma.filterInPlace(va,ub,yb=>{eb[tb]=ub[yb];for(const Fb of Qa)Fb!==tb&&(eb[Fb]=xb?Ma.getCachedAttributeValue(xb[Fb],yb):null);try{return Pa.testFeature(kb)}catch(Fb){return $a(Fb),!1}})}_boundingRectNodeTest(va,
Fa){M.projectBoundingSphere(va.node.mbs,this._controller.crsIndex,nb,this.view.renderSpatialReference);return Ma.intersectBoundingRectWithMbs(Fa,nb)}_boundingRectFeatureTest(va,Fa,Pa){this._collection.getComponentAabb(va.objectHandle,Fa,Mb);U.toRect(Mb,Ha);return Z.intersects(Pa,Ha)}_boundingRectFilter(va,Fa,Pa){var Qa=this._collection;const $a=this._boundingRectNodeTest(Fa,Pa);if($a!==Ma.MbsIntersectResult.INSIDE)if($a===Ma.MbsIntersectResult.OUTSIDE)va.length=0;else if(Qa=Qa.getComponentCount(Fa.objectHandle),
Qa.invisible+Qa.visible===Fa.featureIds.length){var eb=this._transformClippingArea(Oa,Pa,Fa.objectHandle);Ma.filterInPlace(va,Fa.featureIds,kb=>this._boundingRectFeatureTest(Fa,kb,eb))}}_transformClippingArea(va,Fa,Pa){var Qa=this._collection.getObjectTransform(Pa);Pa=Qa.position;Qa=Qa.rotationScale;va[0]=(Fa[0]-Pa[0])/Qa[0];va[1]=(Fa[1]-Pa[1])/Qa[4];va[2]=(Fa[2]-Pa[0])/Qa[0];va[3]=(Fa[3]-Pa[1])/Qa[4];return va}_addOrUpdateEdgeRendering(va,Fa=!0){const Pa=this._edgeView;if(null==Pa)return Promise.resolve(null);
const Qa=va.objectHandle;var $a=Pa.hasObject(Qa);const {hasEdges:eb,perFeatureEdgeMaterials:kb}=this._getFilteredEdgeMaterials(va),tb={hasSlicePlane:this.slicePlaneEnabled};if(eb&&$a)return this.nodeCrossfadingEnabled&&($a=this.getNodeOpacity(va),pb(kb,$a)),Pa.updateAllComponentMaterials(Qa,kb,tb,Fa).catch(ub=>Ja(ub,this.i3slayer.title)),Pa.updateObjectVisibility(Qa,!0).catch(ub=>Ja(ub,this.i3slayer.title)),Pa.updateAllVerticalOffsets(Qa,va.elevationOffsets).catch(ub=>Ja(ub,this.i3slayer.title)),
Promise.resolve(Pa);if(eb&&!$a)return this._collection.addEdges(Qa,Pa,kb,tb).then(ub=>{va.edgeMemoryUsage=ub;va.node.memory+=ub;Pa.updateAllVerticalOffsets(Qa,va.elevationOffsets).catch(xb=>Ja(xb,this.i3slayer.title));return Pa});!eb&&$a&&(va.node.memory-=va.edgeMemoryUsage,va.edgeMemoryUsage=0,Pa.removeObject(Qa));return Promise.resolve(null)}_applyFiltersToNode(va){return this._applyFiltersToNodeComponents(va)?(null!=this._labeler&&this._labeler.applyFilterChange(va),!0):!1}_applyFiltersToNodeComponents(va){const Fa=
this._collection;var Pa=Fa.getComponentCount(va.objectHandle),Qa=null!=va.filteredIds;Pa=0===Pa.invisible;Fa.setAllComponentVisibilities(va.objectHandle,"all");if(0===this._filters.length)return va.filteredIds=null,!Pa;this._updateCachedFilteredIds(va);if(Qa&&va.filteredIds===va.featureIds)return!Pa;Qa=this._computeFilteredComponentIndices(va);Fa.setAllComponentVisibilities(va.objectHandle,Qa);return!0}_updateCachedFilteredIds(va){if(null==va.filteredIds||va.appliedFilters!==this._filters)va.filteredIds=
this._computeFilteredIds(va),va.appliedFilters=this._filters}_computeFilteredIds(va){const Fa=va.featureIds.slice();for(const Pa of this._filters)if(Pa(Fa,va),0===Fa.length)break;return Fa.length===va.featureIds.length?va.featureIds:Fa}_computeFilteredComponentIndices(va){const Fa=[],Pa=va.filteredIds;null!=Pa&&va.featureIds.forEach((Qa,$a)=>{Pa[Fa.length]===Qa&&Fa.push($a)});return Fa}_removeAllNodeDataFromStage(va=this.elevationOffset){this._nodeId2Meta.forEach((Fa,Pa)=>this._removeNodeStageData(Pa,
va));this._nodeId2MetaReloading.forEach((Fa,Pa)=>this._removeNodeStageData(Pa,va,this._nodeId2MetaReloading));this._elevationTask=u.destroyMaybe(this._elevationTask)}removeNode(va){const Fa=this.elevationOffset;this._removeNodeStageData(va,Fa);this._removeNodeStageData(va,Fa,this._nodeId2MetaReloading);null!=this._elevationTask&&this._elevationTask.remove(va)}_removeNodeStageData(va,Fa,Pa=this._nodeId2Meta){Pa.has(va)&&this._controller.updateLoadStatus(va,!1);const Qa=Pa.get(va);null==Qa?Pa.delete(va):
(this._collection.setObjectVisibility(Qa.objectHandle,ha.State.Hidden),null!=this._edgeView&&this._edgeView.hasObject(Qa.objectHandle)&&this._edgeView.updateObjectVisibility(Qa.objectHandle,!1).catch($a=>Ja($a,this.i3slayer.title)),this._visibleGeometryChanged(Qa,Hb.REMOVE),null!=this._labeler&&this._labeler.removeNodeMeta(Qa),Pa.delete(va),this._highlights.objectDeleted(Qa),Pa===this._nodeId2Meta?(this._cacheGPUData(Qa,Fa),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Qa)):this._deleteComponentObject(Qa),
null!=this._treeDebugger&&this._treeDebugger.update())}_deleteComponentObject(va){null!=this._edgeView&&this._edgeView.removeObject(va.objectHandle);this._memEstimateGeometryRemoved(va.objectHandle);this._collection.destroyObject(va.objectHandle);if(va.textures)for(const Fa of va.textures)this._memEstimateTextureRemoved(Fa),this._stage.remove(Fa)}updateNodeState(va,Fa){va=this._nodeId2Meta.get(va);null!=va&&this._collection.updateMaterial(va.objectHandle,Pa=>Pa.polygonOffsetEnabled=Fa===Ca.NodeState.Hole)}updateNodeIndex(va,
Fa){if(this._nodeId2Meta.has(va)){var Pa=this._nodeId2Meta.get(va);this._nodeId2Meta.delete(va);this._nodeId2Meta.set(Fa,Pa);this.notifyChange("elevationRange")}if(Pa=this._nodeId2MetaReloading.get(va))this._nodeId2MetaReloading.delete(va),this._nodeId2MetaReloading.set(Fa,Pa)}_invalidateAllSymbols(){this._rendererVersion=Ma.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()}_getInvalidRendererVersion(){return Ma.addWraparound(this._rendererVersion,-1)}async _rendererChange(va){this._currentRenderer=
va;this.notifyChange("rendererTextureUsage");this._rendererVersion=Ma.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();va&&(this._rendererFields=await va.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&va&&"arcadeRequired"in va&&va.arcadeRequired&&(this._arcade=await ka.loadArcade());if(va&&"visualVariables"in va&&va.visualVariables)for(const Fa of va.visualVariables)"color"===
Fa.type?this._colorVariable=Fa:"opacity"===Fa.type?this._opacityVariable=Fa:rb.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Fa.type}`);if(va)for(const Fa of va.getSymbols())"mesh-3d"!==Fa.type&&rb.error(`Symbols of type '${Fa.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()}_getCachedEdgeMaterials(va){this._hasComponentData&&va.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(va);return va.cachedEdgeMaterials}_getComponentParameters(va){this._hasComponentData&&
va.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(va);const Fa=va.cachedSymbology;return(Pa,Qa)=>{const $a=5*Pa;H.set(Qa.externalColor,Fa[$a]/255,Fa[$a+1]/255,Fa[$a+2]/255,Fa[$a+3]/255);if(null!=this._stage.renderView.objectAndLayerIdRenderHelper){const eb=va.featureIds[Pa],kb=na.isBasemapLayer(this.view.map,this.layerUid);this._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(eb,eb,this.layerId,this.layerUid+"_"+this.sublayerId,this.layerPopupEnabledAndHasTemplate&&
!kb,va.node.resources.attributes,Pa,this.sublayerId);Qa.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:eb,layerUid:this.layerUid+"_"+this.sublayerId})}Qa.externalColorMixMode=Fa[$a+4]&(1<<Cb.CastShadows)-1;Qa.castShadows=0!==(Fa[$a+4]&1<<Cb.CastShadows);Qa.pickable=0!==(Fa[$a+4]&1<<Cb.Pickable);Qa.elevationOffset=va.elevationOffsets?.[Pa]??0}}_getSymbolInfo(va,Fa){Fa=va?.getSymbol(Fa,{arcade:this._arcade});if(!(Fa instanceof Y))return null;va=Fa.id;if(this._symbolInfos.has(va))return this._symbolInfos.get(va);
Fa=Ma.getSymbolInfo(Fa);this._symbolInfos.set(va,Fa);return Fa}_setSymbologyOverride(va,Fa){this._symbologyOverride!==va&&(this._symbologyOverride=va,this._symbologyOverrideFields=Fa,this._invalidateAllSymbols(),this._updateSymbologyFields())}_updateSymbologyFields(){this._symbologyFields=null!=this._symbologyOverrideFields&&0<this._symbologyOverrideFields.length?null!=this._rendererFields&&0<this._rendererFields.length?ca.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):
this._symbologyOverrideFields:this._rendererFields}_updateCachedRendererData(va){va.cachedRendererVersion=this._rendererVersion;if(this._hasComponentData){var Fa=this._tmpAttributeOnlyGraphic,Pa={};Fa.attributes=Pa;var Qa=this._currentRenderer,$a=va.attributeInfo?.attributeData,eb=null!=va.featureIds?this.i3slayer.objectIdField:null,kb=null!=$a&&null!=this._symbologyFields&&0<this._symbologyFields.length,tb=null,ub=null;if(kb&&null!=this._symbologyFields){tb=[];ub=[];for(var xb of this._symbologyFields){var yb=
$a[xb];yb&&(tb.push(xb),ub.push(yb))}}va.cachedSymbology||(va.cachedSymbology=V.newUByteArray(5*va.featureIds.length));$a={color:ib,castShadows:!0,pickable:!0,colorMixMode:Wa.ColorMixModeEnum.Multiply,edgeMaterial:null};xb=this.fullOpacity;xb=this.nodeCrossfadingEnabled?this.getNodeOpacity(va):xb;yb=null;var Fb=Ba.Transparency.OPAQUE,Sb=Ma.transparentEdgeMaterial,Pb=0;for(let Gb=0;Gb<va.featureIds.length;Gb++){null!=eb&&(Pa[eb]=va.featureIds[Gb]);if(kb&&tb)for(var qb=0;qb<tb.length;qb++)Pa[tb[qb]]=
Ma.getCachedAttributeValue(ub[qb],Gb);var wb=Qa?this._getSymbolInfo(Qa,Fa):null;let Ib=qb=null;if(Qa&&"visualVariables"in Qa){if(this._colorVariable){var Ab=ia.getColor(this._colorVariable,Fa,{color:jb,arcade:this._arcade});Ab&&(qb=ib,qb[0]=Ab.r/255,qb[1]=Ab.g/255,qb[2]=Ab.b/255,this._opacityVariable||null===Ab.a||(Ib=Ab.a))}this._opacityVariable&&(Ib=ia.getOpacity(this._opacityVariable,Fa,{arcade:this._arcade}))}wb?.material&&(Ab=wb.material,qb=null==qb||null==Ib?ua.overrideColor(qb,Ib,Ab.color,
Ab.alpha,Jb,ib):ua.overrideColor(qb,Ib,null,null,Jb,ib));null==qb&&(qb=ib,qb[0]=1,qb[1]=1,qb[2]=1,qb[3]=1);$a.pickable=!0;$a.castShadows=wb?wb.castShadows:!0;$a.colorMixMode=wb?.material?wb.material.colorMixMode:Wa.ColorMixModeEnum.Multiply;$a.edgeMaterial=wb?wb.edgeMaterial:null;null!=this._symbologyOverride&&($a.color=qb,this._symbologyOverride(Fa,$a),qb=$a.color);null!=this._nodeColorOverride&&(this._nodeColorOverride(va.node,qb),$a.colorMixMode=Wa.ColorMixModeEnum.Replace);if(null!=$a.edgeMaterial){wb=
0>=qb[3]?Ba.Transparency.INVISIBLE:1<=qb[3]&&(va.material.isOpaque||$a.colorMixMode===Wa.ColorMixModeEnum.Replace)?Ba.Transparency.OPAQUE:Ba.Transparency.TRANSPARENT;if($a.edgeMaterial!==yb||wb!==Fb)Sb={...$a.edgeMaterial,opacity:xb,objectTransparency:wb},yb=$a.edgeMaterial,Fb=wb;va.cachedEdgeMaterials[Gb]=Sb}else va.cachedEdgeMaterials[Gb]=Ma.transparentEdgeMaterial;va.cachedSymbology[Pb++]=Math.round(255*qb[0]);va.cachedSymbology[Pb++]=Math.round(255*qb[1]);va.cachedSymbology[Pb++]=Math.round(255*
qb[2]);va.cachedSymbology[Pb++]=Math.round(255*qb[3]);va.cachedSymbology[Pb++]=$a.colorMixMode|+$a.castShadows<<Cb.CastShadows|+$a.pickable<<Cb.Pickable}}}_getFilteredEdgeMaterials(va){var Fa=this._getCachedEdgeMaterials(va);this.nodeCrossfadingEnabled||pb(Fa,this.fullOpacity);const Pa=va.filteredIds;if(null==Pa)return{hasEdges:Fa.some(eb=>eb!==Ma.transparentEdgeMaterial),perFeatureEdgeMaterials:Fa};let Qa=0,$a=!1;Fa=Fa.map((eb,kb)=>{if(va.featureIds[kb]!==Pa[Qa])return Ma.transparentEdgeMaterial;
$a=$a||eb!==Ma.transparentEdgeMaterial;Qa++;return eb});return{hasEdges:$a,perFeatureEdgeMaterials:Fa}}_updateComponentData(va){if(this._hasComponentData){var Fa=va.objectHandle;va=this._getComponentParameters(va);this._collection.setComponentData(Fa,va);this._stage.renderView.requestRender()}}_reloadAll(va=this.elevationOffset){this._removeAllNodeDataFromStage(va);null!=this._controller&&this._controller.restartNodeLoading()}_opacityChange(va){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();
this._nodeId2Meta.forEach(Fa=>{null!=Fa&&(this._collection.updateMaterial(Fa.objectHandle,Pa=>Pa.objectOpacity=va),pb(Fa.cachedEdgeMaterials,va),this._updateEdgeRendering(Fa))})}_updateMaterial(va){this._collection.updateMaterial(va.objectHandle,Fa=>{Fa.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;Fa.usePBR=this._usePBR;this._updateMaterialOverlay(Fa)})}_updateMaterialOverlay(va){}_updateEngineObject(va){this._updateComponentData(va);this._applyFiltersToNode(va);this._addOrUpdateEdgeRendering(va);
this._visibleGeometryChanged(va,Hb.UPDATE)}_slicePlaneEnabledChange(va){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=va);null!=this._labeler&&(this._labeler.slicePlaneEnabled=va);this._nodeId2Meta.forEach(Fa=>{null!=Fa&&(this._collection.updateMaterial(Fa.objectHandle,Pa=>Pa.commonMaterialParameters.hasSlicePlane=va),this._updateEdgeRendering(Fa,!1))})}_updatePBR(va){this._nodeId2Meta.forEach(Fa=>{null!=Fa&&this._collection.updateMaterial(Fa.objectHandle,Pa=>Pa.usePBR=va)});
this._hasLoadedPBRTextures=!0}get _usePBR(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled}_updateEdgeRendering(va,Fa=!0){null!=this._edgeView&&this._edgeView.hasObject(va.objectHandle)&&this._addOrUpdateEdgeRendering(va,Fa)}_forAllNodes(va){this._nodeId2Meta.forEach(va)}_ignoreClientNodeOverriddenFeatures(va){return this.i3sOverrides.hasGeometryChanges?(Fa,Pa,Qa)=>0<=Qa.node.index&&this.i3sOverrides.featureHasGeometryChanges(Fa)?da.ForAllFeaturesReturnType.CONTINUE:
va(Fa,Pa,Qa):va}_forAllFeatures(va,Fa,Pa){h.someMap(this._nodeId2Meta,Qa=>{if(null==Qa)return!1;if(null!=Fa)switch(Fa(Qa)){case da.ForAllFeaturesReturnType.EXIT:return!0;case da.ForAllFeaturesReturnType.SKIP:return!1}let $a=da.ForAllFeaturesReturnType.CONTINUE;switch(Pa){case da.ForAllFeaturesMode.ALL:$a=this._forAllFeaturesOfNode(Qa,va);break;case da.ForAllFeaturesMode.VISIBLE_ONLY:$a=this._forAllVisibleFeaturesOfNode(Qa,va);break;case da.ForAllFeaturesMode.QUERYABLE:$a=this._forAllQueryableFeaturesOfNode(Qa,
va)}return $a===da.ForAllFeaturesReturnType.EXIT})}_forAllFeaturesOfNode(va,Fa){let Pa=da.ForAllFeaturesReturnType.CONTINUE;const Qa=va.featureIds;for(let $a=0;$a<Qa.length&&(Pa=Fa(Qa[$a],$a,va),Pa!==da.ForAllFeaturesReturnType.EXIT);$a++);return Pa}_forAllVisibleFeaturesOfNode(va,Fa){let Pa=da.ForAllFeaturesReturnType.CONTINUE;const Qa=va.featureIds;this._collection.forEachVisibleComponent(va.objectHandle,$a=>{Pa=Fa(Qa[$a],$a,va);return Pa===da.ForAllFeaturesReturnType.CONTINUE});return Pa}_forAllQueryableFeaturesOfNode(va,
Fa){Fa=this._ignoreClientNodeOverriddenFeatures(Fa);if(null==this._renderClippingArea)return this._forAllFeaturesOfNode(va,Fa);var Pa=this._boundingRectNodeTest(va,this._renderClippingArea);if(Pa===Ma.MbsIntersectResult.OUTSIDE)return da.ForAllFeaturesReturnType.CONTINUE;if(Pa===Ma.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(va,Fa);Pa=da.ForAllFeaturesReturnType.CONTINUE;const Qa=va.featureIds,$a=Ma.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(va.objectHandle));
for(let eb=0;eb<Qa.length;eb++){if(!this._boundingRectFeatureTest(va,eb,$a))continue;const kb=Fa(Qa[eb],eb,va);if(kb===da.ForAllFeaturesReturnType.EXIT)return kb}return Pa}_createAttributes(va,Fa){const Pa={};null!=Fa.featureIds&&(Pa[this._getObjectIdField()]=Fa.featureIds[va]);Fa=Fa.attributeInfo?.attributeData;if(null!=Fa)for(const Qa of Object.keys(Fa))Pa[Qa]=Ma.getCachedAttributeValue(Fa[Qa],va);return Pa}_createGraphic(va,Fa){return this._createLayerGraphic(this._createAttributes(va,Fa))}highlight(va){"number"===
typeof va?va=[va]:va instanceof k?va=[va]:va instanceof c&&(va=va.toArray());if(Array.isArray(va)&&0<va.length){if(va[0]instanceof k){const Fa=this.i3slayer.fieldsIndex,Pa=this._getObjectIdField();va=va.map(eb=>ab.attributeLookup(Fa,eb.attributes,Pa));const {set:Qa,handle:$a}=this._highlights.acquireSet();this._highlights.setFeatureIds(Qa,va);return $a}if("number"===typeof va[0]){const {set:Fa,handle:Pa}=this._highlights.acquireSet();this._highlights.setFeatureIds(Fa,va);return Pa}}return l.makeHandle()}resetHighlights(){u.destroyMaybe(this._highlights);
this._highlights=new Aa({collection:this._collection,forAllFeatures:va=>this._forAllFeatures(va,null,da.ForAllFeaturesMode.ALL),forAllFeaturesOfNode:(va,Fa)=>this._forAllFeaturesOfNode(va,Fa)})}_visibleGeometryChanged(va,Fa){this._elevationProvider&&(this._elevationProvider.objectChanged(va.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=q.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})),this._updateSnappingSources(va,
Fa))}get performanceInfo(){const va={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this._gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this._geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this._texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.unloadedMemory/1048576).toFixed(1)+"MB"};null!=this._memCache&&(va.MemCache=
Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(va.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(va));return va}get test(){const va=this,Fa=Pa=>{this._nodeColorOverride=Pa;this._invalidateAllSymbols()};return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Pa=[];va._forAllFeatures(Qa=>{Pa.push(Qa);return da.ForAllFeaturesReturnType.CONTINUE},null,da.ForAllFeaturesMode.VISIBLE_ONLY);
Pa.sort((Qa,$a)=>Qa-$a);return Pa},get numNodes(){return va._nodeId2Meta.size},get loadedNodes(){return Array.from(va._nodeId2Meta.keys()).sort((Pa,Qa)=>Pa-Qa)},setNodeColorOverride:Fa,setNodeColoring:Pa=>{switch(Pa){case "client-nodes":Fa((Qa,$a)=>{0>Qa.index?($a[0]=1,$a[1]=0,$a[2]=0):($a[0]=1,$a[1]=1,$a[2]=1)});break;default:Fa(null)}}}}getNodeOpacityByIndex(va){va=this._nodeId2Meta.get(va);return this.getNodeOpacity(va)}getNodeOpacity(va){return null!=va?this._collection.getMaterial(va.objectHandle).objectOpacity:
0}isNodeFullyFadedIn(va){return this._crossfadeHelper.isNodeFullyFadedIn(va)}getNodeCrossfadeMetaData(va){return this._nodeId2Meta.get(va)}markNodeToRemove(va){this._controller&&this._controller.markNodeToRemove(va)}removeMarkedNodes(){this._controller&&this._controller.removeMarkedNodes()}foreachCrossfadeNode(va){this._nodeId2Meta.forEach((Fa,Pa)=>va(Pa,Fa))}fadeNode(va,Fa,Pa){if(this.nodeCrossfadingEnabled){var Qa=this._nodeId2Meta.get(va);null!=Qa&&this._crossfadeHelper.fadeNode(va,Qa,Fa,Pa)}}setNodeOpacityByIndex(va,
Fa){va=this._nodeId2Meta.get(va);null!=va&&this._setNodeOpacity(va,Fa)}_setNodeOpacity(va,Fa){this._collection.updateMaterial(va.objectHandle,Pa=>Pa.objectOpacity=Fa);this._setNodeEdgeOpacity(va,Fa)}_setNodeEdgeOpacity(va,Fa){null!=this._edgeView&&va.cachedEdgeMaterials&&(pb(va.cachedEdgeMaterials,Fa),va=va.objectHandle,this._edgeView.hasObject(va)&&this._edgeView.updateAllComponentOpacities(va,Fa).catch(Pa=>Ja(Pa,this.i3slayer.title)))}get hasModifications(){return this._isIntegratedMesh&&null!=
this._layerClippingArea||this._modifications&&0<this._modifications.length}updateNodeModificationStatus(va){var Fa=va.length;if(this.hasModifications&&!(0>=Fa)&&!0===this._i3sWasmLoaded){Fa=this.uid;var Pa=ob(va);if(null!=Pa){ma.filterObbsForModificationsSync({context:Fa,buffer:Pa.buffer});const Qa=new Float64Array(Pa.buffer);va.forAll(($a,eb)=>{eb=ma.interpretObbModificationResults(Qa[eb]);$a.imModificationImpact=eb;eb!==Ca.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility($a.index)})}}}notifyUpdate(){this.notifyChange("updating")}notifyLODUpdate(){this._controller.notifyLODUpdate()}isUpdating(){return!(!this._controller||
!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||null!=this._labeler&&this._labeler.updating||this._crossfadeHelper?.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||null!=this._elevationTask&&this._elevationTask.running}trackSnappingSources(va){const Fa={events:va,fetchEdgeLocations:async(Pa,Qa,$a)=>{Pa=this._nodeId2Meta.get(Pa);if(null==Pa)throw Error("invalid-node");const {origin:eb,buffer:kb}=await this._collection.extractEdgeInformation(Pa.objectHandle,
Qa,$a);this._snappingLocationsApplyElevation(Pa,kb,eb);return{type:"components",objectIds:Pa.featureIds,locations:kb,origin:eb}},remove:()=>{m.removeUnordered(this._snappingSourcesTrackers,Fa)}};this._snappingSourcesTrackers.push(Fa);this._nodeId2Meta.forEach((Pa,Qa)=>{null!=Pa&&(Pa=this._controller.getRenderMbs(Pa.node),null!=Pa&&va.add(Qa,Pa))});return Fa}_snappingLocationsApplyElevation(va,Fa,Pa){if(va.elevationOffsets&&this.elevationInfo.mode!==b.ElevationMode.Absolute){var Qa=Fa.position0,$a=
Fa.position1;Fa=Fa.componentIndex;var eb=I.create(),kb=I.create(),tb=(ub,xb)=>{G.add(ub,ub,Pa);this.view.renderCoordsHelper.worldUpAtPosition(ub,kb);G.add(ub,ub,G.scale(kb,kb,xb));G.subtract(ub,ub,Pa)};for(let ub=0;ub<Qa.count;ub++){const xb=va.elevationOffsets[Fa.get(ub)];Qa.getVec(ub,eb);tb(eb,xb);Qa.setVec(ub,eb);$a.getVec(ub,eb);tb(eb,xb);$a.setVec(ub,eb)}}}_updateSnappingSources(va,Fa){const {index:Pa}=va.node;va=this._controller.getRenderMbs(va.node);if(null!=va)for(const Qa of this._snappingSourcesTrackers)Fa!==
Hb.REMOVE&&Fa!==Hb.UPDATE||Qa.events.remove(Pa),Fa!==Hb.ADD&&Fa!==Hb.UPDATE||Qa.events.add(Pa,va)}};g.__decorate([r.property()],gb.prototype,"_hasLoadedPBRTextures",void 0);g.__decorate([r.property()],gb.prototype,"_asyncModuleLoading",void 0);g.__decorate([r.property()],gb.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);g.__decorate([r.property()],gb.prototype,"view",void 0);g.__decorate([r.property()],gb.prototype,"i3slayer",void 0);g.__decorate([r.property()],gb.prototype,"_controller",
void 0);g.__decorate([r.property()],gb.prototype,"_labeler",void 0);g.__decorate([r.property()],gb.prototype,"updating",void 0);g.__decorate([r.property()],gb.prototype,"suspended",void 0);g.__decorate([r.property()],gb.prototype,"contentVisible",null);g.__decorate([r.property({readOnly:!0})],gb.prototype,"legendEnabled",null);g.__decorate([r.property()],gb.prototype,"holeFilling",void 0);g.__decorate([r.property(Da.updatingProgress)],gb.prototype,"updatingProgress",void 0);g.__decorate([r.property()],
gb.prototype,"updatingProgressValue",null);g.__decorate([r.property()],gb.prototype,"hasTexturesOrVertexColors",null);g.__decorate([r.property()],gb.prototype,"rendererTextureUsage",null);g.__decorate([r.property()],gb.prototype,"elevationOffset",null);g.__decorate([r.property()],gb.prototype,"elevationInfo",null);g.__decorate([r.property({type:Boolean})],gb.prototype,"slicePlaneEnabled",void 0);g.__decorate([r.property()],gb.prototype,"supportedTextureEncodings",null);g.__decorate([r.property()],
gb.prototype,"uncompressedTextureDownsamplingEnabled",null);g.__decorate([r.property({type:[ba]})],gb.prototype,"_modifications",void 0);g.__decorate([r.property({readOnly:!0})],gb.prototype,"clientGeometry",null);g.__decorate([r.property()],gb.prototype,"elevationRange",null);g.__decorate([r.property()],gb.prototype,"_elevationTask",void 0);g.__decorate([r.property({readOnly:!0})],gb.prototype,"_usePBR",null);return gb=g.__decorate([z.subclass("esri.views.3d.layers.I3SMeshView3D")],gb)};b.makeScheduleFunction=
zb;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localLinearScaleFactors":function(){define(["exports","../../chunks/vec3","./projectors","../support/Ellipsoid","../support/spatialReferenceUtils"],function(a,b,g,d,k){a.localLinearScaleFactors=function(m,f,c,l){if(null==f||null==l)return!1;const e=g.classifySpatialReference(f,g.sourceClassificationCache);var p=g.classifySpatialReference(l,g.destClassificationCache);if(e===p&&e!==g.ProjectionID.UNKNOWN||k.equals(f,
l))return c[0]=1,c[1]=1,c[2]=1,!0;if(e===g.ProjectionID.SPHERICAL_ECEF){f=b.length(m);m=f/Math.sqrt(m[0]*m[0]+m[1]*m[1]);f/=d.earth.radius;if(p===g.ProjectionID.WEB_MERCATOR)return c[0]=m*f,c[1]=m*f,c[2]=1,!0;if(p===g.ProjectionID.WGS84||p===g.ProjectionID.CGCS2000)return p=g.invPlateCarreeScale,c[0]=p*m*f,c[1]=p*f,c[2]=1,!0}else if(e===g.ProjectionID.PLATE_CARREE){if(p===g.ProjectionID.WGS84||p===g.ProjectionID.CGCS2000)return c[0]=g.invPlateCarreeScale,c[1]=g.invPlateCarreeScale,c[2]=1,!0;if(p===
g.ProjectionID.WEB_MERCATOR)return p=m[1]/d.earth.radius,c[0]=1,c[1]=1/Math.cos(p),c[2]=1,!0}return!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectBoundingSphere":function(){define(["exports","../../core/mathUtils","../../chunks/vec3f64","./projectors","../support/Ellipsoid"],function(a,b,g,d,k){function m(e,p,h,u){p=u+p;if(p<u/2||h>p)return Number.MAX_VALUE;e=Math.abs(l*e)+Math.asin(h/p);return e>=Math.PI/2?Number.MAX_VALUE:h/Math.cos(e)}const f=
g.create(),c=d.createEmptyProjectorCache(),l=b.deg2rad(1);a.projectBoundingSphere=function(e,p,h,u){if(null==p||null==u)return!1;p=d.populateProjectorCache(p,u,c);if(p.projector===d.copy3)return h[0]=e[0],h[1]=e[1],h[2]=e[2],h[3]=e[3],!0;if(null==p.projector)return!1;const {source:w,dest:x}=p;if(x.spatialReferenceId===d.ProjectionID.WEB_MERCATOR){p=d.projectionTable[w.spatialReferenceId][d.ProjectionID.WGS84];if(null==p)return!1;p(e,0,f,0);d.wgs84ToWebMercator(f,0,h,0);h[3]=m(f[1],e[2],e[3],k.earth.radius);
return!0}if(w.spatialReferenceId!==d.ProjectionID.WGS84&&w.spatialReferenceId!==d.ProjectionID.CGCS2000||x.spatialReferenceId!==d.ProjectionID.PLATE_CARREE)p.projector(e,0,h,0),h[3]=e[3]*(w.metersPerUnit??1)/(x.metersPerUnit??1);else{u=d.projectionTable[d.ProjectionID.SPHERICAL_ECEF][d.ProjectionID.PLATE_CARREE];let n=e[3];null!=d.projectionTable[w.spatialReferenceId][d.ProjectionID.SPHERICAL_ECEF]&&null!=u&&(n=m(e[1],e[2],e[3],k.earth.radius));p.projector(e,0,h,0);h[3]=n}return!0};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/UByteArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.newUByteArray=function(g,d=!1){return g<=b.nativeArrayMaxSize?d?Array(g).fill(0):Array(g):new Uint8Array(g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection/projectBoundingRect ../../../geometry/support/aaBoundingRect ../dehydratedPoint ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SClientNodeLoader ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/3d/support/MemoryController ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K){function L(P,R){return null!=P&&P.length===R.length&&P.every(W=>0<=J(R,W.name))}function J(P,R){R=R.toLowerCase();for(let W=0;W<P.length;W++)if(P[W].name.toLowerCase()===R)return W;return-1}const M=d.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");b=class extends m.EsriPromiseMixin(b){get isMeshPyramid(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store?.lodType}get isGraphics3D(){return"points"===
this.layer.profile}get useMaximumNumberOfFeatures(){return!this.isMeshPyramid&&(null==this.layer.priority||"High"===this.layer.priority)}get indexStreamController(){const P=this.layerView.view.resourceController.createStreamDataRequester(I.ClientType.I3S_INDEX);return new C.I3SStreamDataController(P,this.layer.apiKey)}get dataStreamController(){const P=this.layerView.view.resourceController.createStreamDataRequester(I.ClientType.I3S_DATA);return new C.I3SStreamDataController(P,this.layer.apiKey)}get crsVertex(){return E.getVertexCrs(this.layer)}get crsIndex(){return E.getIndexCrs(this.layer)}get layer(){return this.layerView.i3slayer}get running(){return this.updating}get rootNodeVisible(){if(this._index){const P=
this._index.rootNode;if(P)return this._updateViewData(),this._index.isNodeVisible(P.index)}return!0}get index(){return this._index}get requiredAttributes(){return this._requiredAttributes}constructor(P){super(P);this.screenSizeFactor=0;this.featureTarget=5E4;this.fixedFeatureTarget=!1;this.updating=!0;this.updatingProgress=1;this.leavesReached=!1;this.scaleVisibilityEnabled=!0;this.worker=null;this._featureLOD=1;this._isIdle=this._stableFeatureLOD=!1;this._cameraDirty=!0;this._invisibleDirty=!1;this._idleStateCallbacks=
null;this._newLoadingNodes=new k({deallocator:null});this._loadedNodeScales=new Map;this._modificationsNodeFilteringArray=new k;this._downloadingCount=0;this._loadingNodes=new Map;this._updatingNodes=new Map;this._progressMaxNumNodes=1;this._requiredAttributes=[];this._requiredAttributesDirty=!0;this._restartNodeLoading=this._disableMemCache=this.disableIDBCache=this._updatesDisabled=!1;this._attributeStorageInfo=this._fields=null;this._idleQueue=new n.PromiseQueue;this._elevationUpdateNodes=new k({deallocator:null});
this._errorCount=0}initialize(){const {layerView:P,layer:R}=this;this._disableMemCache=!P.loadCachedGPUData||!P.addCachedGPUData;this._lodHandling=new y(P);this._defaultGeometrySchema=R.store.defaultGeometrySchema;this.disableIDBCache=g("disable-feature:idb-cache");"fields"in R&&(this._fields=R.fields,this._attributeStorageInfo=R.attributeStorageInfo);this.addResolvingPromise(Promise.all([R.indexInfo,R.when(),P.when()]).then(([W])=>{if(!this.destroyed&&P&&!P.destroyed&&W){var {view:N,clientGeometry:V}=
P,{resourceController:S}=N;this._setClippingArea(N.clippingArea);this.addHandles([c.watch(()=>N?.pointsOfInterest?.focus?.renderLocation,X=>this._pointOfInterestChanged(X),c.initial),c.watch(()=>N.quality,()=>this._setCameraDirty(),c.sync),c.watch(()=>P.contentVisible,X=>{const ca=X?()=>this._updateIdleState(!0):()=>this._updateViewData(),ba=X?()=>this._updateIdleState(!1):()=>{};X&&null!=this._index&&this._index.invalidateAllElevationRanges();this._idleStateCallbacks?(X||this.cancelNodeLoading(),
this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=ca,this._idleStateCallbacks.idleEnd=ba):this._idleStateCallbacks=S.scheduler.registerIdleStateCallbacks(ca,ba)},c.initial),v.addCallback(P.view.resourceController.scheduler,this),c.watch(()=>P.uncompressedTextureDownsamplingEnabled,()=>this.restartNodeLoading()),c.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),c.watch(()=>N.state?.contentCamera,()=>this._setCameraDirty()),c.watch(()=>
R.elevationInfo,X=>this._elevationInfoChanged(X)),c.watch(()=>R.effectiveScaleRange,()=>this._scaleBoundsChanged()),c.watch(()=>P.lodFactor,()=>this._setCameraDirty()),c.watch(()=>P.availableFields,()=>this._requiredFieldsChange()),c.watch(()=>P.holeFilling,X=>null!=this._index&&(this._index.holeFilling=X))]);this._updateScaleHandles();this._viewportQueries=new A(this.crsIndex,N.renderCoordsHelper,N.state.contentCamera,!N.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?
N.basemapTerrain:N.elevationProvider,q.viewingModeFromString(N.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this._lod,angleDependentLoD:.5>this._lod});this._clientNodeLoader=new t.I3SClientNodeLoader(this.layer.uid,{indexSR:this.crsIndex,vertexSR:this.crsVertex,renderSR:N.renderCoordsHelper.spatialReference,localMode:"local"===N.viewingMode},N.resourceController.memoryController,this.worker);this._index=new r.I3SIndex(R,W,this.indexStreamController,
this._clientNodeLoader,this._viewportQueries,M,P.holeFilling,X=>P.isNodeLoaded(X),X=>P.isNodeReloading(X),X=>this._shouldLoadNode(X),X=>this._enableFromGPUCache(X,z.NodeState.Leaf),X=>this._needsUpdate(X),()=>!this.indexStreamController.busy,X=>P.computeVisibilityObb?P.computeVisibilityObb(X):null,P?.computeNodeFiltering?X=>P.computeNodeFiltering(X):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid||this.isGraphics3D);this._index.imModificationsChanged(!!P.hasModifications);
this._index.layerFilterChanged(!!P.hasGeometryFilter);if(null!=V){for(const X of V)this._addMesh(X.mesh,X.oid);this.addHandles(V.on("change",X=>{for(const ca of X.removed)this._removeMesh(ca.oid);for(const ca of X.added)this._addMesh(ca.mesh,ca.oid)}))}this._startNodeLoading()}}));this._tmpPoint=x.makeDehydratedPoint(0,0,0,this.crsIndex)}updateNodeModificationStatus(P){const R=this._index,W=this.layerView;null!=R&&W?.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),P.forAll(N=>
{N=R.getNode(N);null!=N&&this._modificationsNodeFilteringArray.push(N)}),W.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)}destroy(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._nodeLoader=null;T.prune();null!=Q&&(Q.hide(),Q=null)}_getRequiredAttributes(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const P=this._attributeStorageInfo,
R=this._fields,W=this.layer.objectIdField;return this.layerView.availableFields.map(N=>{const V=J(P,N);N=J(R,N);return 0<=V&&0<=N?{index:V,name:R[N].name,field:R[N],attributeStorageInfo:P[V]}:null}).filter(N=>null!=N&&N.name!==W)}_requiredFieldsChange(){const P=this._getRequiredAttributes();L(this._requiredAttributes,P)||(this._requiredAttributes=P,this._requiredAttributesDirty=!1,this.restartNodeLoading())}requestUpdate(){this._requiredAttributesDirty=!0;this.restartNodeLoading()}_setClippingArea(P){const R=
w.create();G.toBoundingRect(P,R,this.layerView.view.renderSpatialReference)?this._clippingArea=R:this._clippingArea=null}_pointOfInterestChanged(P){null!=this._viewportQueries&&(this._viewportQueries.setPointOfInterest(P),null!=this._index&&(this._index.progressiveLoadPenalty=O.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))}updateClippingArea(P){this._setClippingArea(P);null!=this._viewportQueries&&null!=this._index&&(this._viewportQueries.updateClippingArea(this._clippingArea),
this._index.invalidateVisibilityCache());this._setCameraDirty()}_setCameraDirty(){this._cameraDirty=!0;this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()}_addMesh(P,R){null!=this._index&&(P=this._clientNodeLoader.createMeshNodeInfo(P,R),R=this._index.addClientNodeToIndex(P.id,P.mbs),this._clientNodeLoader.addMeshNode(R,P),this._evaluateUpdating(),this.notifyChange("rootNodeVisible"))}_removeMesh(P){P=this._clientNodeLoader.getMeshNodeIndex(P);if(null!=P)if(null!=this._index)this._index.removeClientNodeFromIndex(P,
(R,W)=>{this.layerView.removeNode(W);this._loadedNodeScales.delete(W);this._clientNodeLoader.removeNode(R);this.layerView.deleteCachedNodeData&&null!=R&&this.layerView.deleteCachedNodeData(R);this.layerView.deleteCachedGPUData?.(this.layerView.loadCachedGPUData?.(W))},(R,W,N)=>{this._clientNodeLoader.updateNodeIndex(R,W,N);this.layerView.updateNodeIndex&&this.layerView.updateNodeIndex(W,N)}),this.notifyChange("rootNodeVisible");else throw Error("delayed removal of client side i3s node geometry not supported yet.");
}updateElevationChanged(P,R){const W=this._index;if(null==W?.rootNode||null==R)return null;this.crsIndex.equals(R)||(u.projectBoundingRect(P,R,U,this.crsIndex),P=U);const N=this._elevationUpdateNodes;N.clear();E.findIntersectingNodes(P,W.rootNode,W,V=>N.push(V.index));N.length&&(N.forAll(V=>W.updateElevationChanged(V)),this._setCameraDirty());return N}removeAllGeometryObbs(){null!=this._index&&this._index.removeAllGeometryObbs()}getRenderMbs(P){return null!=this._viewportQueries?this._viewportQueries.getRenderMbs(P):
null}_elevationInfoChanged(P){null!=this._index&&(this._index.updateElevationInfo(P,this.isMeshPyramid||this.isGraphics3D),this._setCameraDirty())}_updateScaleHandles(){this.removeHandles("scale-bounds");this._areScaleBoundsActive&&this.addHandles(this.layerView.view.basemapTerrain.on("scale-change",P=>this._scaleUpdateHandler(P)),"scale-bounds")}_scaleBoundsChanged(){this._areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()}_scaleUpdateHandler(P){this._updateScaleInBoundingRect(P.extent,
P.spatialReference);this._setCameraDirty()}_updateScaleInBoundingRect(P,R){const W=this._index;null!=W&&null!=W.rootNode&&u.projectBoundingRect(P,R,U,this.crsIndex)&&this._loadedNodeScales.forEach((N,V)=>{N=W.getNode(V);null!=N&&w.intersectsSphere(U,N.mbs)&&this._loadedNodeScales.set(V,this._computeScale(N))})}restartNodeLoading(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()}schedule(P,R){return this._idleQueue.push(P,R)}reschedule(P,R){return this._idleQueue.unshift(P,
R)}get _isIntegratedMesh(){return"integrated-mesh"===this.layer.type}get _areScaleBoundsActive(){const {minScale:P,maxScale:R}=B.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<P||0<R)}get unloadedMemoryEstimate(){return null!=this._index&&this.layerView.contentVisible?this._index.unloadedMemoryEstimate*this._lodDropFactor:0}async _loadNodeData(P,R){return 0>P.index?this._clientNodeLoader.loadNodeData(P.id,R):this._nodeLoader.loadNodeData(P,R)}async _loadAttributes(P,R,W){return(0>
P.index?this._clientNodeLoader:this._nodeLoader).loadAttributes(P,R,W)}get indexDepth(){return null!=this._index?this._index.maxLevel:0}set disableMemCache(P){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=P}runTask(P,R){if(!this.layerView.contentVisible)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||null==this._index)return-Infinity;this._processWithErrorLogging(P,R);return this._index.maxPriority}_processWithErrorLogging(P,
R){try{this._process(P,R)}catch(W){50>this._errorCount?M.error("Error during processing: "+W):50===this._errorCount&&M.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}}_process(P,R){this._restartNodeLoading&&this._startNodeLoading();null!=this._nodeLoader&&null!=this._index&&(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(P)&&(this._invisibleDirty=!1),this._isIntegratedMesh&&(P.enabled=!1),P.run(()=>this._processIndex(P)),
this._updateFeatureLOD(),P.run(()=>this._processCache(P)),this._isIntegratedMesh&&(P.enabled=!0),P.run(()=>this._processNodes(P,R)),this._idleQueue.runTask(P),P.run(()=>this._prefetchIndex()),R.numIndexLoading+=this._index.indexLoading,R.numNodesLoading+=this._downloadingCount,P.run(()=>this._lodHandling.lodGlobalHandling(P)),this._evaluateUpdating())}_processIndex(P){if(null==this._index)return!1;this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(Array.from(this._loadingNodes.keys()),
P,R=>this.updateNodeModificationStatus(R)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),P=this._index.featureEstimate.leavesReached,this._index.isLoading||P===this._get("leavesReached")||this._set("leavesReached",P));return this._index.load()}_prefetchIndex(){return null==this._index||0<this._loadingNodes.size||0<this._index.updates.add.length?
!1:this._index.prefetch()}_updateFeatureLOD(){if(this.useMaximumNumberOfFeatures&&null!=this._index&&null!=this._viewportQueries){var P=!this._index.isLoading,R=this.featureTarget*this._baseLOD,W=this._index.featureEstimate;W.estimate=W.estimate||R/2;if(500<this._index.indexMissing){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(P&&W.estimate<R){if(W.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(R/
W.estimate,1.001));P=this._lod;R=this._index.checkFeatureTarget(R,P);R!==P&&(this._featureLOD=R/this._baseLOD,this._stableFeatureLOD=!0)}else if(W.estimate>1.2*R||P&&W.estimate>R){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(W.estimate/R-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.requestUpdate()}}_processCache(P){const R=this._index;if(null==R)return!1;
for(;0<this._newLoadingNodes.length&&!P.done;){var W=this._newLoadingNodes.pop();for(W=R.getParent(W);null!=W&&!this.layerView.isNodeLoaded(W.index)&&this._isNodeInScaleBounds(W);W=R.getParent(W.index))if(this._enableFromGPUCache(W,z.NodeState.Hole)){P.madeProgress();break}}return P.hasProgressed}_processNodes(P,R){if(null==this._index)return!1;let W=(this._isIdle?100:2)-this._loadingNodes.size;const N=this._index.updates;N.cancel.forEach(this._cancelNode,this);for(N.cancel=[];0<N.remove.length&&
!P.done;)this.layerView.removeNode(N.remove.pop()),P.madeProgress();for(;0<N.update.length&&!P.done;){var V=this._index.getNode(N.update.pop());null!=V&&(this._updateLoadedNode(V),P.madeProgress())}for(;0<N.add.length&&!P.done&&0<W;){--W;V=this._index.getNode(N.add.back());if(null==V||V.cacheState!==z.CacheState.Cached&&!this._hasNodeLoadToken(R))break;N.add.pop();this._loadNode(V);P.madeProgress()}return P.hasProgressed}_cancelAllNodes(){this._loadingNodes.forEach(P=>P.abort());this._loadingNodes.clear();
this._updatingNodes.forEach(P=>P.abort());this._updatingNodes.clear()}_cancelNode(P){const R=this._loadingNodes.get(P);R&&(R.abort(),this._loadingNodes.delete(P))}_hasNodeLoadToken(P){return!this._isIdle&&2<=P.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<I.maxDownloadSlots&&!this.dataStreamController.busy}_evaluateUpdating(){let P=!1;var R=0;this.layerView&&(this.layerView.contentVisible?(R=(null!=this._index?this._index.indexMissing:0)+3*(null!=this._index?this._index.updates.add.length:
0)+2*this._loadingNodes.size,P=!!(0<R||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling||null!=this._index&&this._index.isPrefetching),0===R&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(R,this._progressMaxNumNodes),R=1-R/this._progressMaxNumNodes):R=(P=this._cameraDirty)?0:1,this.updating=P,this.updatingProgress=R)}_updateViewData(){if(this._cameraDirty&&null!=this._index&&
null!=this._viewportQueries){var P=this.layerView.view,{contentCamera:R,fixedContentCamera:W}=P.state;this.screenSizeFactor=1/(R.perScreenPixelRatio/2);this._viewportQueries.updateCamera(R,!W||this.isGraphics3D);this._viewportQueries.setPointOfInterest(P.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=O.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();
this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}}_getProgressiveLoadFactor(){return 1>this.layerView.view.quality?1:this.layerView.progressiveLoadFactor}get _lod(){return this._featureLOD*this._baseLOD}get _baseLOD(){const P=this.layerView.lodFactor;return this.fixedFeatureTarget?1:(0<P?P:1)*this.layerView.view.quality}get _lodDropFactor(){return this.fixedFeatureTarget?1:(Math.min(this.layerView.view.quality,.5)-H.minQuality)/(.5-H.minQuality)}isGeometryVisible(P){return!!this._index?.isGeometryVisible(P.index)}updateVisibility(P){this._index?.invalidateNodeVisibilityCache(P)}invalidateGeometryVisibility(P){this._index?.invalidateGeometryVisibility(P)}invalidateVisibilityObbs(){this._index?.invalidateVisibilityObbs()}modificationsChanged(){this._index?.imModificationsChanged(!!this.layerView.hasModifications);
this._invisibleDirty=!0}_shouldLoadNode(P){return this._lodHandling.shouldLoadNode(P)&&!this._shouldDropNode(P)&&null!=this._index&&this._index.isGeometryVisible(P.index)?this._isNodeInScaleBounds(P):!1}_shouldDropNode(P){if(null==this._viewportQueries)return!1;const R=this._lodDropFactor;return 1<=R||!this._lodHandling.hasNoVisibleChildren(P)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(P))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*
R}_startNodeLoading(){this._restartNodeLoading=!1;const P=this._index;this._updatesDisabled||null==P||null==this._viewportQueries||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new D(this.layer,this.dataStreamController,M,this._defaultGeometrySchema,this._requiredAttributes,{textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,
textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures}),P.requestUpdate(),this._lodHandling.startNodeLoading(R=>this._isNodeInScaleBounds(R),(R,W)=>this._removeNodes(R,W,Z.fadeout),P,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())}isNodeLoading(){return null!=this._nodeLoader&&null!=this._index}cancelNodeLoading(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),
this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())}_removeInvisibleNodes(P){const R=this._index;if(null==R||null==this._viewportQueries)return!1;T.clear();this.layerView.getLoadedNodeIndices(T);const W=0===this._viewportQueries.maxDistance,N=W?()=>!1:V=>this._shouldDropNode(V);T.filterInPlace(V=>{const S=R.getNode(V);return null==S||!R.isGeometryVisible(V)||N(S)||!this._isNodeInScaleBounds(S)});0<T.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(T,P,Z.pop);if(W&&
1>this._lodDropFactor)return!1;if(0===T.length)return!0;T.clear();return!1}markNodeToRemove(P){T.push(P)}removeMarkedNodes(){this._removeNodes(T,K.noBudget,Z.pop)}_removeNodes(P,R,W){const N=P.length;if(0!==N&&!R.done){for(null!=this._index&&this._index.requestUpdate();0<P.length&&!R.done;){const V=P.pop(),S=this._index;W===Z.fadeout&&this.layerView.nodeFadeoutEnabled&&null!=S&&S.isGeometryVisible(V)?this.layerView.fadeNode(V,F.FadeDirection.FadeOut,!0):this.layerView.removeNode(V);R.madeProgress()}if(0<
this._loadedNodeScales.size)for(R=P.length;R<N;R++)this._loadedNodeScales.delete(P.data[R])}}_needsUpdate(P){if(P.resources.isEmpty||this._updatingNodes.has(P.index))return!1;P=this.layerView.getLoadedAttributes(P.index);return null!=P&&P!==this._requiredAttributes}async _updateLoadedNode(P){const R=new AbortController;this._updatingNodes.set(P.index,R);this._evaluateUpdating();try{const W=this.layerView.getLoadedAttributes(P.index);let N=null;N=L(W,this._requiredAttributes)?await Promise.resolve(this.layerView.getAttributeData(P.index)):
await this._loadAttributes(P,this._requiredAttributes,R.signal);await this.schedule(()=>this.layerView.updateAttributes(P.index,{loadedAttributes:this._requiredAttributes,attributeData:N},R.signal),R.signal)}catch(W){if(!f.isAbortError(W))return this.layerView.updateAttributes(P.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},R.signal)}this._updatingNodes.delete(P.index);this._evaluateUpdating()}_loadNode(P){if(this._loadingNodes.has(P.index))M.error("already loading node "+P.index);
else{var R=new AbortController;this._loadingNodes.set(P.index,R);this._evaluateUpdating();this._loadAndAddNode(P,R.signal).then(W=>{W&&null!=this._index&&this._loadingNodes.get(P.index)===R&&(this._loadingNodes.delete(P.index),this._index.requestUpdate())}).catch(W=>{if(!f.isAbortError(W))throw W;}).finally(()=>{this._loadingNodes.get(P.index)===R&&this._loadingNodes.delete(P.index);this._evaluateUpdating()})}}_loadAndAddNode(P,R){return P.cacheState===z.CacheState.Uncached?this._loadUncached(P,R).then(()=>
!1):this._loadCached(P,R).then(W=>{if(W)return!1;P.cacheState=z.CacheState.Uncached;return!0}).catch(W=>f.isAbortError(W)?!1:(P.cacheState=z.CacheState.Uncached,!0))}_enableFromGPUCache(P,R){if(this._disableMemCache||null==this._index)return!1;if(R===z.NodeState.Hole&&!this._index.useNodeAsHole(P.index))return!0;const W=this._loadCachedGPUData(P);if(!W)return!1;this.layerView.addCachedGPUData(P,W,R);this._nodeAdded();return!0}_loadCachedGPUData(P){P=this.layerView.loadCachedGPUData(P.index);if(null!=
P?.attributeInfo&&L(P.attributeInfo.loadedAttributes,this._requiredAttributes))return P;this.layerView.deleteCachedGPUData(P);return null}_nodeAdded(){null!=this._index&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()}updateLoadStatus(P,R){const W=this._index;null!=W&&W.updateChildrenLoaded(P,R?1:-1)}async _loadCached(P,R){if(this._enableFromGPUCache(P,z.NodeState.Leaf))return!0;const W=this.layerView;if(this.disableIDBCache||!W.loadCachedNodeData||!W.addCachedNodeData)return!1;
const N=(ia,ka)=>this._nodeLoader.loadTextures(P,ia,ka),V=(ia,ka)=>this._clientNodeLoader.loadTextures(P,ia,ka),S=0<=P.index?N:V,X=await this.schedule(()=>W.loadCachedNodeData(P,R,S),R);if(null==X)return!1;const ca=this._requiredAttributes,ba=await this.reschedule(()=>this._loadAttributes(P,ca,R),R);await this.reschedule(()=>W.addCachedNodeData(P,X,{loadedAttributes:ca,attributeData:ba},R),R);this._nodeAdded();return!0}_loadUncached(P,R){this._downloadingCount++;return this._loadNodeData(P,R).catch(W=>
{this._downloadingCount--;throw W;}).then(W=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(P,W,R),R)}).then(()=>{this._nodeAdded();P.cacheState=z.CacheState.Cached}).catch(W=>{if(!f.isAbortError(W))throw M.error("#loadNodeData()",this.layer,`Failed to load node '${P.id}'`,W),P.failed=!0,null!=this._index&&this._index.requestUpdate(),W;})}_updateIdleState(P){P!==this._isIdle&&(this._isIdle=P,this._evaluateUpdating(),P&&this._index&&null!=this._index&&this._index.resetFailedNodes())}_getScale(P){if(this._loadedNodeScales.has(P.index))return this._loadedNodeScales.get(P.index);
const R=this._computeScale(P);this.layerView.isNodeLoaded(P.index)&&this._loadedNodeScales.set(P.index,R);return R}_computeScale(P){this._tmpPoint.x=P.mbs[0];this._tmpPoint.y=P.mbs[1];this._tmpPoint.z=P.mbs[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,P.mbs[3])}_isNodeInScaleBounds(P){if(!this._areScaleBoundsActive)return!0;P=this._getScale(P);const {minScale:R,maxScale:W}=B.extractSafeScaleBounds(this.layer);return B.scaleBoundsPredicate(P,R,W)}updateStats(P){this.isGraphics3D&&
(P.detail=this._featureLOD,P.target=this.featureTarget*this._baseLOD);this._index?.updateStats(P)}get test(){const P=this;return{index:this._index,set disableUpdates(R){(P._updatesDisabled=R)?P.cancelNodeLoading():P.requestUpdate()},set disableIDBCache(R){P.disableIDBCache=R},set ignoreServiceObb(R){null!=P._index&&(P._index.ignoreServiceObb=R)},shouldLoadNode:R=>P._shouldLoadNode(R)}}notifyLODUpdate(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();null!=this._index&&this._index.requestUpdate()}geometryFilterChanged(P){const R=
this._index;null!=R&&R.layerFilterChanged(P);this._setCameraDirty()}};a.__decorate([l.property({readOnly:!0})],b.prototype,"isMeshPyramid",null);a.__decorate([l.property({readOnly:!0})],b.prototype,"isGraphics3D",null);a.__decorate([l.property({readOnly:!0})],b.prototype,"useMaximumNumberOfFeatures",null);a.__decorate([l.property({readOnly:!0})],b.prototype,"indexStreamController",null);a.__decorate([l.property({readOnly:!0})],b.prototype,"dataStreamController",null);a.__decorate([l.property({readOnly:!0})],
b.prototype,"crsVertex",null);a.__decorate([l.property({readOnly:!0})],b.prototype,"crsIndex",null);a.__decorate([l.property()],b.prototype,"screenSizeFactor",void 0);a.__decorate([l.property()],b.prototype,"featureTarget",void 0);a.__decorate([l.property()],b.prototype,"fixedFeatureTarget",void 0);a.__decorate([l.property()],b.prototype,"layerView",void 0);a.__decorate([l.property()],b.prototype,"layer",null);a.__decorate([l.property()],b.prototype,"updating",void 0);a.__decorate([l.property({readOnly:!0})],
b.prototype,"running",null);a.__decorate([l.property()],b.prototype,"updatingProgress",void 0);a.__decorate([l.property({readOnly:!0})],b.prototype,"leavesReached",void 0);a.__decorate([l.property({constructOnly:!0})],b.prototype,"scaleVisibilityEnabled",void 0);a.__decorate([l.property({constructOnly:!0})],b.prototype,"worker",void 0);a.__decorate([l.property({readOnly:!0,dependsOn:[]})],b.prototype,"rootNodeVisible",null);b=a.__decorate([h.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],
b);const T=new k({deallocator:null});let Q;const O={factorIM:.2,factor3dObject:.05,distancePenalty:10},U=w.create();var Z;(function(P){P[P.pop=0]="pop";P[P.fadeout=1]="fadeout"})(Z||(Z={}));return b})},"esri/views/3d/layers/i3s/I3SClientNodeLoader":function(){define("exports ../../../../core/Error ../../../../core/maybe ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/uuid ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../chunks/sphere ./I3SClientMaterialUtil".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u){function w(t,v){var {spatialReference:r}=t;const y=[1,-1],z=[.5*t.width,.5*t.height,t.hasZ?.5*(t.zmax-t.zmin):0];r=r.isGeographic?r.metersPerUnit:1;const D=t.center;let C=0;if(t.hasZ)for(t=0;2>t;++t)for(var E=0;2>E;++E)for(var A=0;2>A;++A){var F=(D.x+y[t]*z[0]-v.x)*r;const G=(D.y+y[E]*z[1]-v.y)*r,I=D.z+y[A]*z[2]-v.z;C=Math.max(F*F+G*G+I*I,C)}else for(t=0;2>t;++t)for(E=0;2>E;++E)A=(D.x+y[t]*z[0]-v.x)*r,F=(D.y+y[E]*z[1]-v.y)*r,C=Math.max(A*A+F*F,C);return h.fromCenterAndRadius([v.x,
v.y,v.z],Math.sqrt(C))}async function x(t,v,r,y){const {transform:z,vertexAttributes:D}=v.loadedMesh;t="source"===t.shading?D.normal:null;if(null==t||null==z||0===z.rotationAngle&&l.exactEquals(z.scale,e.ONES))return{transformed:t,original:D.normal};if(!v.normalsTransformPromise){g.assertIsSome(r,"SceneLayerWorker is needed to transform mesh normals");const C=c.create();f.normalFromMat4(C,z.localMatrix);v.normalsTransformPromise=r.transformNormals({normalMatrix:C,normals:t},y)}return v.normalsTransformPromise}
function n(t,v,r){t[v]=255&r;t[v+1]=255&r>>8;t[v+2]=255&r>>16;t[v+3]=255&r>>24}class q{constructor(t,v,r,y){this._uid=t;this._worker=y;this._id2Meta=new Map;this._oid2Meta=new Map;this._indexSR=v.indexSR;this._vertexSR=v.vertexSR;this._renderSR=v.renderSR;this._localMode=v.localMode;this._memCache=r.newCache(`sl-client-mesh-data-${this._uid}`)}get uid(){return this._uid}get worker(){return this._worker}get indexSR(){return this._indexSR}get renderSR(){return this._renderSR}createMeshNodeInfo(t,v){const r=
`mesh${v}`;var y=t.extent,z=y.spatialReference,D=this._indexSR;y=w(y,t.origin);p.projectBoundingSphere(y,z,y,D);D=t.metadata.displaySource?.source;if(null==D||!Array.isArray(D)||!D.length||D[0]instanceof File)var C=m.generateUUID();else{z="";for(C of D)z+=C.makeHash();C=JSON.stringify(null!=t.transform?t.transform.toJSON():"");D=t.vertexSpace.isRelative?JSON.stringify(t.vertexSpace.origin):"";C=z+C+D}return{type:"mesh",id:r,version:C,oid:v,mbs:y,componentNodeIds:[],unloadedMesh:t,nodeIndex:null,loadMeshPromise:null}}addMeshNode(t,
v){if(null!=this.getMeshNodeIndex(v.oid))throw new b(`I3SClientNodeLoader: client side mesh for feature oid=${v.oid} already exists`);v.nodeIndex=t;this._id2Meta.set(v.id,v);this._oid2Meta.set(v.oid,v)}getMeshNodeIndex(t){t=this._oid2Meta.get(t);return null==t||"mesh"!==t.type?null:t.nodeIndex}removeNode(t){const v=this._id2Meta.get(t);null!=v&&(this._id2Meta.delete(t),"mesh"===v.type&&this._oid2Meta.delete(v.oid))}async loadNodeJSON(t){const v=this._id2Meta.get(t);if(null==v)throw new b(`I3SClientNodeLoader::loadNodeJSON unable to find node ${t}`);
switch(v.type){case "mesh":return this._loadMeshNodeJSON(v);case "mesh-component":return this._loadMeshComponentNodeJSON(v);default:throw new b(`I3SClientNodeLoader::loadNodeJSON unable to handle node ${t}`);}}async _loadMeshNodeJSON(t){const v=t.id;var r=(await this._getMeshData(t)).loadedMesh;if(null==r.components||0===r.components.length)return{id:v,version:null,mbs:t.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:null};const y=[];r=r.components;
for(let z=0;z<r.length;++z){const D=`${v}-component${z}`,C={type:"mesh-component",id:D,mbs:t.mbs,componentIndex:z,meshNodeInfo:t,textureData:new Map};this._id2Meta.set(C.id,C);t.componentNodeIds.push(D);y.push({id:C.id,href:null,mbs:C.mbs,obb:null})}return{id:v,version:null,mbs:t.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:y}}updateNodeIndex(t,v,r){(t=this._id2Meta.get(t))&&"mesh"===t.type&&(t.nodeIndex=r)}async _loadMeshComponentNodeJSON(t){return{id:t.id,
version:t.meshNodeInfo.version,mbs:t.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:null,isEmpty:!1}}async loadNodeData(t,v){var r=this._id2Meta.get(t);if(null==r||"mesh-component"!==r.type)throw new b(`Failed to load client node data for node ${t} (unexpected node info)`);var y=r.meshNodeInfo,z=await this._getMeshData(y),D=z.loadedMesh;y=y.oid;if(null==D.components)throw new b(`Failed to load client node data for node ${t} (unexpected null reference)`);
t=D.components[r.componentIndex];const {material:C,requiredTextures:E,textureData:A}=await u.convertMeshMaterialToPBRMaterial(t.material);if(null!=A)for(var F of A)null!=F&&r.textureData.set(F.id,F);r={params:{material:C},type:"ArrayBufferView"};const {vertexSpace:G,origin:I,transform:H}=D;F=[I.x,I.y,I.z??0];r={featureDataPosition:F,featureIds:[],geometries:[r]};z.projectionPromise||(g.assertIsSome(this._worker,"SceneLayerWorker is needed to project mesh"),z.projectionPromise=this._worker.project({positions:D.vertexAttributes.position,
localMatrix:H?.localMatrix,vertexSpace:G.toJSON(),origin:F,inSpatialReference:D.spatialReference.toJSON(),outSpatialReference:this._vertexSR.toJSON(),localMode:this._localMode},v));const {projected:B,original:K}=await z.projectionPromise;D.vertexAttributes.position=K;const {transformed:L,original:J}=await x(t,z,this._worker,v);D.vertexAttributes.normal=J;k.throwIfAborted(v);v=t.faces;z=D.vertexAttributes.uv;D=D.vertexAttributes.color;t=v.length/3;var M=3*t,T,Q=0;F=!1;var O=0;let U=!1;var Z=0;let P=
!1;var R=0;let W=0,N=0;Q=T=8;T+=12*M;null!=L&&(F=!0,O=T,T+=12*M);null!=z&&(U=!0,Z=T,T+=8*M);null!=D&&(P=!0,R=T,T+=4*M);W=T;N=T+=8;T=new ArrayBuffer(T+8);const V=new Uint8Array(T);n(V,0,M);n(V,4,1);M=new Float32Array(T,Q);O=null!=L?new Float32Array(T,O):null;Z=null!=z?new Float32Array(T,Z):null;R=null!=D?new Uint8Array(T,R):null;for(Q=0;Q<t;++Q){const ka=3*Q;for(let na=0;3>na;++na){var S=v[ka+na],X=3*S,ca=9*Q+3*na;M[ca]=B[X];M[ca+1]=B[X+1];M[ca+2]=B[X+2];null!=O&&(O[ca]=L[X],O[ca+1]=L[X+1],O[ca+2]=
L[X+2]);null!=Z&&(X=2*S,ca=6*Q+2*na,Z[ca]=z[X],Z[ca+1]=z[X+1]);null!=R&&(S*=4,X=12*Q+4*na,R[X]=D[S],R[X+1]=D[S+1],R[X+2]=D[S+2],R[X+3]=D[S+3])}}n(V,W,y);n(V,W+4,y/2**32);n(V,N,0);n(V,N+4,t-1);const {geometryBuffer:ba,geometryDescriptor:ia}={geometryBuffer:T,geometryDescriptor:{isDraco:!1,isLegacy:!0,color:P,normal:F,uv0:U,uvRegion:!1,featureIndex:!0}};return{geometryData:r,attributeDataInfo:{attributeData:{},loadedAttributes:[]},geometryBuffer:ba,geometryDescriptor:ia,requiredTextures:E,textureData:A,
normalReferenceFrame:this._vertexSR.isGeographic?"east-north-up":"vertex-reference-frame"}}async loadAttributes(t,v,r){t=t.numFeatures;r={};for(const {field:{name:y}}of v)r[y]=Array(t);return r}async loadTextures(t,v,r){r=this._id2Meta.get(t.id);if(null==r||"mesh-component"!==r.type)throw Error(`Failed to load textures for node ${t.id} (unexpected node info)`);t=[];for(const y of v)t.push(r.textureData.get(y.id)||null);return t}async _getMeshData(t){const v=t.version,r=this._memCache.get(v);if(null==
r){if(null!=t.loadMeshPromise)return t.loadMeshPromise;const y=async(z,D)=>{var C=t.unloadedMesh.clone();try{await C.load()}catch(E){D(E)}D=C.memoryUsage;C={loadedMesh:C,projectionPromise:null,normalsTransformPromise:null,usedMemoryInBytes:D};this._memCache.put(v,C,D,d.minPriority);t.loadMeshPromise=null;z(C)};t.loadMeshPromise=new Promise((z,D)=>y(z,D));return t.loadMeshPromise}return r}}a.I3SClientNodeLoader=q;a.createSphereFromExtent=w;a.sizeOfFloat32=4;a.sizeOfInt32=4;a.sizeOfUInt64=8;a.sizeOfUInt8=
1;a.transformNormals=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SClientMaterialUtil":function(){define("exports ../../../../Color ../../../../core/Error ../../../../support/requestUtils ../../glTF/internal/resourceUtils ./enums ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/textureUtils ../../webgl-engine/materials/pbrUtils".split(" "),function(a,b,g,d,k,m,f,c,l){async function e(p,h,u,w){if(null==p)return-1;const x=u.length;var n=
p.data;p=p.url;if(null!=n){if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement)return n=c.downsampleImage(n),u.push({id:x,usage:w,data:n,encoding:m.TextureEncoding.PNG,downsampled:!1}),h.push({id:x,usage:w,encodings:[{name:void 0,encoding:m.TextureEncoding.PNG}]}),x;if(!(n instanceof HTMLVideoElement)){if(n instanceof ImageData)throw new g("ImageData textures not supported yet for client side I3S nodes");if(n instanceof k.EncodedMeshTexture)throw new g("EncodedMeshTexture textures not supported yet for client side I3S nodes");
}}else if(null!=p)return n=new Image,n.src=p,n=await d.loadImageAsync(n,n.src,!1,void 0),n=c.downsampleImage(n),u.push({id:x,usage:w,data:n,encoding:m.TextureEncoding.PNG,downsampled:!1}),h.push({id:x,usage:w,encodings:[{name:void 0,encoding:m.TextureEncoding.PNG}]}),x;return-1}a.convertMeshMaterialToPBRMaterial=async function(p){const h=[],u=[];if(null==p)return{material:{alphaMode:"opaque",alphaCutoff:.1,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,
0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:h,textureData:u};const w=p.hasOwnProperty("metallicRoughnessTexture");"auto"===p.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');const x=l.useSchematicPBR({normalTexture:p.normalTexture,emissiveTexture:w?p.emissiveTexture:null,emissiveFactor:w?
b.toUnitRGB(p.emissiveColor):null,occlusionTexture:w?p.occlusionTexture:null,metallicRoughnessTexture:w?p.metallicRoughnessTexture:null,metallicFactor:w?p.metallic:null,roughnessFactor:w?p.roughness:null}),n=x?l.defaultSchematicMRRFactors[0]:w?p.metallic:0,q=x?l.defaultSchematicMRRFactors[1]:w?p.roughness:0;return{material:{alphaMode:"auto"===p.alphaMode?"blend":p.alphaMode,alphaCutoff:p.alphaCutoff,doubleSided:p.doubleSided,cullFace:p.doubleSided?f.CullFaceOptions.None:f.CullFaceOptions.Back,normalTextureId:await e(p.normalTexture,
h,u,m.TextureUsage.Normal),emissiveTextureId:w?await e(p.emissiveTexture,h,u,m.TextureUsage.Emissive):-1,occlusionTextureId:w?await e(p.occlusionTexture,h,u,m.TextureUsage.Occlusion):-1,emissiveFactor:w&&null!=p.emissiveColor?b.toUnitRGB(p.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=p.color?b.toUnitRGBA(p.color):[1,1,1,1],baseColorTextureId:await e(p.colorTexture,h,u,m.TextureUsage.Color),metallicRoughnessTextureId:w?await e(p.metallicRoughnessTexture,h,u,m.TextureUsage.MetallicRoughness):
-1,metallicFactor:n,roughnessFactor:q},wrapTextures:!0,hasParametersFromSource:x},requiredTextures:h,textureData:u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(b){b[b.None=
0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]="AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||(a.TextureUsage={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/handleUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e){let p=class extends g{constructor(){super();this.referenceCount=0;this.callbacks=[];this.runIndex=0}get running(){return this.callbacks.some(w=>w.running)}runTask(w){this._sort();const x=this.callbacks,n={numIndexLoading:0,numNodesLoading:0};for(let q=0;q<x.length&&!w.done;++q)x[q].priority=x[q].runTask(w,n),this.runIndex=q}_sort(){const w=this.callbacks;let x=w.length;for(let n=this.runIndex;0<n;n--){const q=w[n-1];let t=n;for(;t<w.length&&q.priority<=w[t].priority&&
(t!==x||q.priority<w[t].priority);)w[t-1]=w[t],t++;w[t-1]=q;x=t-1}this.runIndex=0}add(w){this._sort();w.priority=Infinity;this.callbacks.unshift(w);this.notifyChange("running")}remove(w){d.removeUnordered(this.callbacks,w);this.runIndex=this.callbacks.length;this._sort();this.notifyChange("running")}};b.__decorate([m.property({readOnly:!0})],p.prototype,"running",null);p=b.__decorate([l.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],p);class h{constructor(w,x){this.task=w;this.handle=x}}const u=
new Map;a.addCallback=function(w,x){let n=u.get(w);if(null==n){const q=new p,t=w.registerTask(e.TaskPriority.I3S_CONTROLLER,q);n=new h(q,t);u.set(w,n)}n.task.add(x);return k.makeHandle(()=>{null!=n&&(n.task.remove(x),0<n.task.callbacks.length||(u.delete(w),n.handle.remove(),n.task.destroy()),n=null)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../geometry/projection/projectBoundingSphere ../../../../chunks/sphere ../../../../support/featureFlags ./ElevationRange ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(I){null!=I.node&&(e.invalidateMbs(I.node.renderMbs),e.invalidateObb(I.node.serviceObbInRenderSR));null!=I.ref&&(e.invalidateMbs(I.ref.renderMbs),e.invalidateObb(I.ref.serviceObbInRenderSR))}function u(I,H){return 0>I?-1:0<H?I/H|0:0}function w(I,H){return 0>I?-I-1:0===H?I:I%H}function x(I,H,B){return-1===H?-(I+1):0===B?I:H*B+I}function n(I){if(I)for(let H=0;H<I.length;H++)for(const B of D)if(B[0]===I[H].metricType)return{lodMetric:B[1],maxError:I[H].maxError};
return{lodMetric:l.LodMetric.None,maxError:0}}function q(I){return Math.sqrt(4/Math.PI*I)}class t{constructor(I,H,B,K,L){this.childOffset=I;this.childCount=H;this.visibilityCache=B;this.ref=K;this.node=L;this.useAsHole=0;this.filterImpact=l.NodeFilterImpact.NotChecked;this.traversalState=null;this.parent=-1}}class v{constructor(I=[],H=[]){this.nodes=I;this.children=H;this.numNodesWithLoadedChildren=this.lastTraversed=0}}class r{get _useNodePages(){return 0<this._pageSize}constructor(I,H,B,K,L,J,M,
T,Q,O,U,Z,P,R,W){this._layer=I;this._streamDataController=B;this._clientNodeLoader=K;this._viewportQueries=L;this._logger=J;this.holeFilling=M;this._isLoaded=T;this._isReloading=Q;this._isSelected=O;this._enable=U;this._needsUpdate=Z;this._canRequest=P;this._computeVisibilityObb=R;this._computeNodeFiltering=W;this._dirty=!0;this._nodePages=new Map;this._clientNodePage=null;this._rootIndex=this._pageSize=0;this._lodMetric=l.LodMetric.None;this._lodConversion=N=>N;this._isEditable=!1;this._urlPrefix=
"";this._loadingNodes=new Set;this._loadingPages=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._version=e.addWraparound(0,2);this._visibilityCacheVersion=e.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;this._missingPagesAndNodes=new b({deallocator:null});this._prefetchNodes=new b({deallocator:null});
this._updates=new z(this._missingPagesAndNodes);this._imModificationUncategorized=new b({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=[];this._newPages=[];this._layerHasFilter=this.layerHasModifications=this.needNodeElevationRange=!1;this._frameNumber=0;this._isEditable=f.i3sPatchingEnabled()&&null!=I.associatedLayer?.infoFor3D;I.serviceUpdateTimeStamp?.lastUpdate&&(this._lastUpdate=`${I.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this._viewportQueries?
this._viewportQueries.maxLodLevel:1;this._init(H)}_init(I){if("page"===I.type){var H=I.rootPage;this._urlPrefix=I.urlPrefix;this._pageSize=I.pageSize;switch(I.lodMetric){case "maxScreenThreshold":this._lodMetric=l.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this._lodMetric=l.LodMetric.MaxScreenThreshold,this._lodConversion=q}if(this._isEditable){this._rootIndex=-1;var B=w(I.rootIndex,I.pageSize);B=H.nodes[B];B={nodes:[{index:this._rootIndex,children:[I.rootIndex],mesh:void 0,obb:B.obb,
lodThreshold:B.lodThreshold}]};this._addPage(u(this._rootIndex,this._pageSize),B);this.getNode(-1).serviceObb=void 0}else this._rootIndex=I.rootIndex;this._addPage(u(I.rootIndex,this._pageSize),H);this._updateParentsAndLevel()}else"node"===I.type&&(this._urlPrefix=I.urlPrefix,H=new v,this._nodePages.set(0,H),this._isEditable?(this._clientNodePage=new v,H={id:"-1",version:null,mbs:I.rootNode.mbs,obb:I.rootNode.obb,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:[{id:"root",
href:"../root",mbs:I.rootNode.mbs,obb:I.rootNode.obb}]},this._rootIndex=this._makeClientRefNode(new l.NodeBase(H.id,null),-1),(H=this._validateNode(H.id,H))&&this._addNode(H,this._rootIndex)):this._rootIndex=this._makeRefNode(new l.NodeBase(I.rootNode.id,null),-1),(I=this._validateNode(I.rootNode.id,I.rootNode))&&this._addNode(I,0))}addClientNodeToIndex(I,H){I=new l.NodeBase(I,H);I=this._makeClientRefNode(I,-1);this._linkChildToParentNode(-1,I);this.requestUpdate();return I}removeClientNodeFromIndex(I,
H,B){this._destroyClientRefNode(I,H,B);this.requestUpdate()}_loadPage(I){this._loadingPages.add(I);this._streamDataController.request(this._urlPrefix+I,"json").then(H=>{this._pageQueue.push({pageIndex:I,page:H})}).catch(H=>{this._loadingPages.delete(I);g.isAbortError(H)||(this._failedPages.add(I),this._logger.error("#loadPage()",this._layer,`Error when loading page ${I}`,H))})}_addQueuedPages(I){for(;0<this._pageQueue.length&&!I.done;){const {pageIndex:H,page:B}=this._pageQueue.shift();this._addPage(H,
B);this._loadingPages.delete(H);I.madeProgress();this.needNodeElevationRange&&this._newPages.push(H)}this._updateParentsAndLevel()}_invalidateElevationRangeForNewPages(I){if(this.needNodeElevationRange)for(;0<this._newPages.length&&!I.done;){var H=this._nodePages.get(this._newPages.shift());if(null!=H){H=H.nodes;for(let B=0;B<this._pageSize;B++){let K=H[B].parent;for(;null!=K&&K!==this._rootIndex;){const L=this.getNode(K);L&&!Number.isNaN(L?.elevationRangeMin)&&(L.invalidateElevationRange(),this.invalidateBoundingVolumeCache(K));
K=this.getParentIndex(K)}}}}}_addPage(I,H){const B=[],K=[];H=H.nodes.map((L,J)=>{const M=B.length,T=L.children?L.children.length:0;K.push(this._rootIndex);for(var Q=0;Q<T;Q++)B.push(L.children[Q]);const O=`${L.index}`;Q=p.clone(L.obb);const U=m.fromValues(Q.center[0],Q.center[1],Q.center[2],d.length(Q.halfSize));var Z=L.mesh?.attribute;const P=L.mesh?.geometry,R=L.mesh?.material;Z={hasSharedResource:!1,isEmpty:null==P,attributes:null!=Z?.resource?`${Z.resource}`:void 0,geometry:null!=P?.resource?
`${P.resource}`:void 0,texture:null!=R?.resource?`${R.resource}`:void 0,geometryDefinition:P?P.definition:-1,materialDefinition:R?R.definition:-1};L=new l.Node(O,x(J,I,this._pageSize),U,T,0,Z,this._lastUpdate,this._lodMetric,this._lodConversion(L.lodThreshold),P?P.featureCount:null);L.serviceObb=Q;L.visibilityObb=this._computeVisibilityObb(L);L.vertexCount=P?P.vertexCount:0;return new t(M,T,e.addWraparound(this._visibilityCacheVersion,-2),null,L)});H=new v(H,B);-1===I?this._clientNodePage=H:this._nodePages.set(I,
H)}_updateParentsAndLevel(){const I=[],H=(B,K,L)=>{var J=this._getPage(B);if(null!=J){const M=w(B,this._pageSize);J=J.nodes[M];J.parent=null!=K?K:-1;K=J.node;null!=K&&(K.level=L,I.push(B))}};for(H(this._rootIndex,null,0);I.length;){const B=I.pop(),K=this.getNode(B);if(null!=K)for(let L=0;L<K.childCount;L++){const J=this.getChildIndex(K.index,L);H(J,B,K.level+1);this._maxLevel=Math.max(this._maxLevel,K.level+1)}}}_getPage(I){I=u(I,this._pageSize);return 0>I?this._clientNodePage:this._nodePages.get(I)}_getNodeInternal(I){const H=
this._getPage(I);if(null==H)return null;H.lastTraversed=this._frameNumber;return H.nodes[w(I,this._pageSize)]}_addNode(I,H){null!=I.children&&this.populateChildren(H,I.children);var B=this.getParent(H);B=null!=B?B.level+1:0;this._maxLevel=Math.max(this._maxLevel,I.children?B+1:B);const {lodMetric:K,maxError:L}=n(I.lodSelection),J=this._getNodeInternal(H);J.node=new l.Node(I.id,H,I.mbs,J.childCount,B,I.resources,I.version,K,L,I.numFeatures);I.obb&&(J.node.serviceObb=p.clone(I.obb));J.node.visibilityObb=
this._computeVisibilityObb(J.node);null!=J.ref&&(null==J.ref.mbs&&(J.ref.mbs=I.mbs),J.node.renderMbs=J.ref.renderMbs,J.node.serviceObbInRenderSR=J.ref.serviceObbInRenderSR,J.ref.visibilityObb=J.node.visibilityObb);return J.node}_makeRefNode(I,H){const B=this._nodePages.get(0);if(-1>H)return this._makeClientRefNode(I,H);if(null==B)return-1;const K=B.nodes.length,L=new t(0,0,e.addWraparound(this._visibilityCacheVersion,-2),I,null);B.nodes.push(L);L.parent=H;e.invalidateMbs(I.renderMbs);e.invalidateObb(I.serviceObbInRenderSR);
return K}_makeClientRefNode(I,H){const B=this._clientNodePage;if(null==B)return-1;if(0<=H)throw Error("I3SIndex::client side nodes can not be made children of service side nodes.");const K=-(B.nodes.length+1),L=new t(0,0,e.addWraparound(this._visibilityCacheVersion,-2),I,null);B.nodes.push(L);L.parent=H;e.invalidateMbs(I.renderMbs);e.invalidateObb(I.serviceObbInRenderSR);return K}_linkChildToParentNode(I,H){const B=this._clientNodePage;if(!(null==B||0<=I)){var K=w(I,this._pageSize),L=w(H,this._pageSize);
K=B.nodes[K];var J=K.childOffset;B.children.splice(K.childOffset+K.childCount,0,H);K.childCount+=1;null!=K.node&&(K.node.childCount+=1);for(const M of B.nodes)M.childOffset>J&&(M.childOffset+=1);B.nodes[L].parent=I;this._updateParentBoundingInformation(I)}}_destroyClientRefNode(I,H,B){const K=this._clientNodePage;if(null!=K){var L=this.getParentIndex(I);if(null!=L){var J=new Set,M=new Map,T=V=>{var S=w(V,this._pageSize);S=K.nodes[S];if(0<S.childCount)for(var X=S.childOffset;X<S.childOffset+S.childCount;++X)T(K.children[X]);
X=S.node?.id??S.ref?.id;if(null==X)throw Error("Node has no id");H(X,V);J.add(S)};T(I);I=K.nodes;var Q=K.children,O=K.nodes.map(()=>-1),U=[],Z=[];for(var P=0;P<I.length;++P){var R=I[P];if(!J.has(R)){var W=U.length,N=x(P,-1,this._pageSize);W=x(W,-1,this._pageSize);R.node&&(R.node.index=W);O[P]=W;U.push(R);if(N!==W){R=R.node?.id??R.ref?.id;if(null==R)throw Error("Node has no id");B(R,N,W);M.set(N,W)}}}for(B=0;B<U.length;++B){M=x(B,-1,this._pageSize);P=U[B];N=Z.length;for(R=P.childOffset;R<P.childOffset+
P.childCount;++R)if(W=Q[R],0<=W)Z.push(W);else{W=w(W,this._pageSize);const V=I[W];J.has(V)||(Z.push(O[W]),V.parent=M)}P.childOffset=N;P.childCount=Z.length-N;P.node&&(P.node.childCount=P.childCount)}K.nodes=U;K.children=Z;this._updateParentBoundingInformation(O[w(L,this._pageSize)])}}}_updateParentBoundingInformation(I){do{let K=null;var H=this._clientNodeLoader.indexSR;const L=this._clientNodeLoader.renderSR,J=this._getNodeInternal(I);if(null==J)break;for(let M=0;M<J.childCount;M++){var B=this.getChildIndex(I,
M);B=this._getNodeInternal(B);B=null!=B?B.ref||B.node:null;if(null!=B&&0<B.mbs[3])if(null==K)K=m.copy(B.mbs,E);else{const T=A,Q=F,O=G;k.projectBoundingSphere(B.mbs,H,T,L);k.projectBoundingSphere(K,H,Q,L);m.union(T,Q,O);k.projectBoundingSphere(O,L,K,H)}}H=J.ref||J.node;null!=H&&(null!=K?H.mbs=m.copy(K,null!=H.mbs?H.mbs:m.create()):e.invalidateMbs(H.mbs),e.invalidateMbs(H.renderMbs),e.invalidateObb(H.serviceObbInRenderSR),H.geometryObb=null);this.invalidateNodeVisibilityCacheInternal(J);I=this.getParentIndex(I)}while(null!=
I)}populateChildren(I,H){var B=this._getNodeInternal(I);const K=this._getPage(I);B.childOffset=K.children.length;B.childCount=H.length;for(B=0;B<H.length;B++){const L=this._makeRefNode(H[B],I);K.children.push(L)}}getNode(I){I=this._getNodeInternal(I);return null!=I?I.node:null}getIndexById(I){let H;this._forAllNodes((B,K)=>{null!=B.node&&B.node.id===I?H=K:null!=B.ref&&B.ref.id===I&&(H=K)});return H}getNodeById(I){I=this.getIndexById(I);return null!=I&&0<=I?this.getNode(I):null}getChildIndex(I,H){const B=
this._getPage(I);if(null==B)return-1;I=B.nodes[w(I,this._pageSize)];return B.children[I.childOffset+H]}getParentIndex(I){const H=this._getPage(I);return null!=H&&I!==this._rootIndex?H.nodes[w(I,this._pageSize)].parent:null}getParent(I){I=this.getParentIndex(I);return null!=I?this.getNode(I):null}isLeaf(I){I=this._getNodeInternal(I);return null!=I&&0===I.childCount}get rootNode(){return this.getNode(this._rootIndex)}get isEditable(){return this._isEditable}removeAllGeometryObbs(){this._forAllNodes(I=>
{null!=I.node&&(I.node.geometryObb=null)})}invalidateVisibilityCache(){this._visibilityCacheVersion=e.addWraparound(this._visibilityCacheVersion,2)}invalidateNodeVisibilityCache(I){I=this._getNodeInternal(I);null!=I&&this.invalidateNodeVisibilityCacheInternal(I)}invalidateNodeVisibilityCacheInternal(I){I.visibilityCache=e.addWraparound(this._visibilityCacheVersion,-2)}invalidateBoundingVolumeCache(I){I=this._getNodeInternal(I);null!=I&&(h(I),this.invalidateNodeVisibilityCacheInternal(I))}updateElevationChanged(I){const H=
this._getNodeInternal(I);null!=H&&(this.needNodeElevationRange?(I=null!=H.node?H.node:H.ref,null!=I&&I.invalidateElevationRange()):this.invalidateBoundingVolumeCache(I))}invalidateGeometryVisibility(I){I=this._getNodeInternal(I);null!=I?.node&&(I.node.geometryObb=null,e.invalidateMbs(I.node.renderMbs),e.invalidateObb(I.node.serviceObbInRenderSR))}invalidateVisibilityObbs(){null!=this.rootNode&&this.traverse(this.rootNode,I=>{I.visibilityObb=this._computeVisibilityObb(I);I.geometryObb=null;return!0})}_updateElevationRange(I){this._updateElevationRangeInternal(I,
null)}_updateElevationRangeInternal(I,H){const B=this._getNodeInternal(I);if(!B)return!1;const K=B?.node??B?.ref;if(!K)return!1;const L=K.elevationRangeMin;if(!Number.isNaN(L))return c.expandElevationRange(H,K),!0;const J={elevationRangeMin:Infinity,elevationRangeMax:-Infinity};var M=!1;for(let T=0;T<B.childCount;T++){const Q=this.getChildIndex(I,T);this._updateElevationRangeInternal(Q,J)||(M=!0)}(0===B.childCount||M)&&this._viewportQueries.expandElevationRange(K,!B.node?.resources.isEmpty,J);M=K.elevationRangeMax;
if(!Number.isNaN(L)&&L===J.elevationRangeMin&&M===J.elevationRangeMax)return c.expandElevationRange(H,K),!0;B.node&&(B.node.elevationRangeMin=J.elevationRangeMin,B.node.elevationRangeMax=J.elevationRangeMax);B.ref&&(B.ref.elevationRangeMin=J.elevationRangeMin,B.ref.elevationRangeMax=J.elevationRangeMax);this.invalidateBoundingVolumeCache(I);c.expandElevationRange(H,K);return!0}isNodeVisible(I){const H=this._getNodeInternal(I);if(null==H||null!=H.ref&&!H.ref.mbs)return!0;this.needNodeElevationRange&&
this._updateElevationRange(I);if((H.visibilityCache&-2)!==this._visibilityCacheVersion){I=H.node;const K=!I||H.ref&&!I.visibilityObb?H.ref??null:I;if(this._layerHasFilter&&this._computeNodeFiltering&&(null!=I||null!=H.ref)&&H.filterImpact===l.NodeFilterImpact.NotChecked){var B=null!=I?I.mbs:null!=H.ref?H.ref.mbs:null;H.filterImpact=null!=B?this._computeNodeFiltering(B):l.NodeFilterImpact.Unmodified}B=null!=I&&H.filterImpact===l.NodeFilterImpact.Culled;I=!(null!=I&&I.imModificationImpact===l.NodeIMModificationImpact.Culled)&&
(!K||this._viewportQueries.isNodeVisible(K))&&!B;H.visibilityCache=this._visibilityCacheVersion+(I?1:0);return I}return 1===(H.visibilityCache&1)}isGeometryVisible(I){if(!this.isNodeVisible(I))return!1;I=this._getNodeInternal(I);return null==I?.node?.geometryObb||this.layerHasModifications&&I.node.imModificationImpact===l.NodeIMModificationImpact.NotChecked?!0:this._viewportQueries.isGeometryVisible(I.node)}_traverseCoverage(I,H,B,K,L){I=this._getPage(I);if(null!=I&&0!==H.childCount){var J=H.childOffset+
H.childCount,M=[];for(H=H.childOffset;H<J;++H){const T=I.children[H],Q=this._getNodeInternal(T);null!=Q?.node&&this.isGeometryVisible(T)&&M.push(Q)}K/=M.length;for(const T of M)I=T.node.index,this._isLoaded(I)||this._isReloading(I)?(L.delta=Math.max(L.delta,B),L.coverage+=K):this._traverseCoverage(I,T,B+1,K,L)}}useNodeAsHole(I){if("off"===this.holeFilling)return!1;const H=this._getNodeInternal(I);if(null==H)return!1;if("always"===this.holeFilling)return!0;if((H.useAsHole&-2)===this._version)return 1===
(H.useAsHole&1);const B={delta:0,coverage:0};this._traverseCoverage(I,H,0,1,B);I=.5>=B.delta*B.coverage;H.useAsHole=this._version+(I?1:0);return I}get maxLevel(){return this._maxLevel}get dirty(){return this._dirty}destroy(){this._updates.add.prune();this._updates.update.prune()}requestUpdate(){this._dirty=!0;this._indexMissing=1;this._version=e.addWraparound(this._version,2)}imModificationsChanged(I){this.layerHasModifications=I;this._forAllNodes(({node:H})=>{null!=H&&(H.imModificationImpact=l.NodeIMModificationImpact.NotChecked,
H.visibilityObb=this._computeVisibilityObb(H),H.hasModifications&&this.invalidateGeometryVisibility(H.index))});this.invalidateVisibilityCache()}layerFilterChanged(I){this._layerHasFilter=I;this._forAllNodes(H=>{null!=H&&(H.filterImpact=l.NodeFilterImpact.NotChecked,H=H.node,null!=H&&this.invalidateNodeVisibilityCache(H.index))});this.invalidateVisibilityCache()}update(I,H,B){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(H);this._invalidateElevationRangeForNewPages(H);this._maxProcessingPrio=
this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missingPagesAndNodes.clear();this._prefetchNodes.clear();this._updates.reset(I);y.clear();var K=!0,L=new C,J=new C,M=this._imModificationUncategorized;M.clear();var T=new Set;this.traverseVisible((O,U,Z)=>{var P=u(O,this._pageSize);T.add(P);if(null==U)O=this._entryPriority(O),Infinity===O&&(O=this._entryPriority(Z)),y.set(P,Math.max(O,y.get(P)||0)),this._loadingPages.has(P)||this._failedPages.has(P)||this._missingPagesAndNodes.push(P),this._maxProcessingPrio=
Math.max(this._maxProcessingPrio,O);else{var R=U.node;this._updateNodeFeatureEstimate(R,J);if(null==R)U=this._entryPriority(O),this._loadingNodes.has(O)||this._failedNodes.has(O)||(this._missingPagesAndNodes.push(O),y.set(O,U)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,U);else{Z=this._getPage(O);if(0===this._missingPagesAndNodes.length&&!this._useNodePages)for(P=0;P<U.childCount;P++){const W=Z.children[U.childOffset+P],N=this._getNodeInternal(W);null==N||N.node||this._loadingNodes.has(W)||
this._failedNodes.has(W)||(y.set(W,this._entryPriority(W)),this._prefetchNodes.push(W))}R.failed||R.resources.isEmpty?K&&0<U.childCount&&this._isSelected(R)&&(K=!1):this._isLoaded(O)?(L.known+=R.memory,++L.knownNodes,this._isSelected(R)?0<U.childCount&&(K=!1):(L.unremoved+=R.memory,K=!1),this._needsUpdate(R)&&(U=this._entryPriority(O),y.set(O,U),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,U),this._updates.update.push(O))):(R.memory&&(L.known+=R.memory,++L.knownNodes),this._isSelected(R)?
(0<U.childCount&&(K=!1),R.memory?(L.missing+=R.memory,L.known+=R.memory,++L.knownNodes):++L.missingNodes,I.includes(R.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(O)),this._updates.cancel=this._updates.cancel.filter(W=>W!==R.index)):!H.done&&this._enable(R)?H.madeProgress():(U=this._entryPriority(O),y.set(O,U),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,U),this._updates.add.push(O),this.layerHasModifications&&B&&null!=R&&R.imModificationImpact===
l.NodeIMModificationImpact.NotChecked&&M.push(O))):this._isReloading(O)&&this._updates.remove.push(O))}}});this._frameNumber++;this._missingPagesAndNodes.sort((O,U)=>O-U);this._missingPagesAndNodes.filterInPlace((O,U)=>1>U||this._missingPagesAndNodes.data[U-1]!==O);this._missingPagesAndNodes.sort((O,U)=>y.get(O)-y.get(U));0<this._missingPagesAndNodes.length&&(this._maxUnloadedPrio=y.get(this._missingPagesAndNodes.back()),this._prefetchNodes.clear());var Q=this._updates.add;0<Q.length&&this.layerHasModifications&&
(0<M.length&&B?.(M),Q.filterInPlace(O=>{var U=this._getNodeInternal(O);(U=null==U?.node||U.node.imModificationImpact!==l.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(O);return U}));this._unloadedMemoryEstimate=L.missing-L.unremoved;3<L.knownNodes&&0<L.missingNodes&&(this._unloadedMemoryEstimate+=L.known/L.knownNodes*L.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(J);this._featureEstimate.leavesReached=
K;this._updates.add.filterInPlace(O=>y.get(O)>=this._maxUnloadedPrio).sort((O,U)=>y.get(O)-y.get(U));this._updates.update.sort((O,U)=>y.get(O)-y.get(U));this._indexMissing=this._loadingPages.size+this._loadingNodes.size+this._missingPagesAndNodes.length;this._dirty=0<this._indexMissing;y.clear()}}checkFeatureTarget(I,H){const B=this._viewportQueries.updateScreenSpaceErrorBias(H);let K=H,L=H,J=B,M=10;for(;M--;){const T=new C;this._updateFeatureEstimate(K,T);if(this._computeFeatureEstimate(T)<=I){if(K>=
H||0<T.missingNodes||0===M)break;J=K;K=.5*(K+L)}else L=K,K=.5*(K+J)}this._version=e.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(B);return Math.min(H,K)}_updateFeatureEstimate(I,H){this._version=e.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(I);this.traverseVisible((B,K)=>this._updateNodeFeatureEstimate(null!=K?K.node:void 0,H))}_updateNodeFeatureEstimate(I,H){null!=I&&!I.failed&&null!=I.numFeatures&&this._isSelected(I)&&(null!=
I.numFeatures?(H.missing+=I.numFeatures,H.known+=I.numFeatures,++H.knownNodes):++H.missingNodes)}_computeFeatureEstimate(I){let H=I.known-I.unremoved;3<I.knownNodes&&0<I.missingNodes&&(H+=I.known/I.knownNodes*I.missingNodes);return Math.max(0,H)}load(){return this._load(this._missingPagesAndNodes)}prefetch(){this._prefetchNodes.sort((I,H)=>y.get(I)-y.get(H));return this._load(this._prefetchNodes)}_load(I){if(0===I.length||!this._canRequest())return!1;for(;0<I.length&&this._canRequest();){const H=
I.pop();this._useNodePages?0<=H?this._loadPage(H):this._loadNode(H):this._loadNode(H)}return!0}get isLoading(){return 0<this._indexMissing}get isPrefetching(){return 0<this._prefetchNodes.length}get indexLoading(){return this._loadingPages.size+this._loadingNodes.size}get indexMissing(){return this._indexMissing}get unloadedMemoryEstimate(){return this._unloadedMemoryEstimate}get updates(){return this._updates}get featureEstimate(){return this._featureEstimate}get maxPriority(){return Math.max(this._maxProcessingPrio,
this._maxUnloadedPrio)}nodeTraversalState(I){if(null==I)return null;const H=I.index,B=this._getNodeInternal(H);if(!B)return null;let K=B?.traversalState;if(K&&(K.version&-2)===this._version)return K;const L=this._viewportQueries.getLodLevel(I),J=this._viewportQueries.hasLOD(I);let M=!0;J?(I=this.getParentIndex(H),null!=I?(I=this._getNodeInternal(I)?.traversalState,M=!!I&&L>I.lodLevel):M=0<L):M=0===I.childCount;if(K)return K.lodLevel=L,K.isChosen=M,K.version=this._version+1,K;K=new l.NodeTraversalState(J,
M,L,this._version+1);return B.traversalState=K}async _loadNode(I){this._loadingNodes.add(I);var H=this._getNodeInternal(I).ref;if(null==H)this._failedNodes.add(I);else{H=H.id;var B=this._urlPrefix+H,K=()=>{this._loadingNodes.delete(I);0===this._missingPagesAndNodes.length&&0===this._loadingNodes.size&&this.requestUpdate()},L=null;try{L=0<=I?await this._streamDataController.request(B,"json"):await this._clientNodeLoader.loadNodeJSON(H)}catch(J){K();g.isAbortError(J)||(this._logger.error("#loadNode()",
this._layer,"Error loading node: "+B),this._failedNodes.add(I));return}K();H=this._validateNode(H,L);null!=H&&(H.obb&&this.invalidateNodeVisibilityCache(I),H=this._addNode(H,I),this.nodeTraversalState(H))}}_validateNode(I,H){if(null==H||"object"!==typeof H||H.id!==I)return this._logger.error("#validateNode()",this._layer,`Invalid node. Wrong type or wrong id "${I}"`),null;if(!Array.isArray(H.mbs))return this._logger.error("#validateNode()",this._layer,`Invalid bounding volume on node ${I}.`),null;
H.sharedResource&&"./shared"!==H.sharedResource.href&&"./shared/"!==H.sharedResource.href&&this._logger.warn("#validateNode()",this._layer,`Invalid shared resource href on node "${I}"`);var B=H.geometryData;null==B||Array.isArray(B)&&0===B.length||Array.isArray(B)&&1===B.length&&"./geometries/0"===B[0].href||this._logger.warn("#validateNode()",this._layer,`Invalid geometry data on node "${I}"`);B=H.attributeData;const K=this._layer.attributeStorageInfo;null==B||Array.isArray(B)&&!B.some((T,Q)=>T.href!==
`./attributes/${K?.[Q]?.key??`f_${Q}`}/0`)||this._logger.warn("#validateNode()",this._layer,`Invalid attribute data on node "${I}"`);H.featureData&&1<H.featureData.length&&this._logger.warn("#validateNode()",this._layer,`Node ${I} has ${H.featureData.length} bundles. Only the first bundle will be loaded.`);B=H.hasOwnProperty("obb")&&!this.ignoreServiceObb?H.obb:null;const L=H.featureData&&1===H.featureData.length&&H.featureData[0].featureRange?H.featureData[0].featureRange[1]-H.featureData[0].featureRange[0]+
1:void 0;var J=T=>{if(null==T)return null;var Q=O=>this._logger.error("#validateNode()",this._layer,`Invalid node reference on node ${I}: ${O}`);if("number"===typeof T.id)Q(`id ${T.id} is a number instead of a string.`);else if("string"!==typeof T.id||!Array.isArray(T.mbs))return Q("Missing or invalid id."),null;if(!Array.isArray(T.mbs))return Q(`Invalid bounding volume on reference ${T.id}.`),null;T.href&&T.href!=="../"+T.id&&this._logger.error("#validateNode()",this._layer,`Invalid node href on node "${I}"`);
Q=T.hasOwnProperty("obb")&&!this.ignoreServiceObb?T.obb:null;T=new l.NodeBase(`${T.id}`,T.mbs);T.serviceObb=Q;T.visibilityObb=this._computeVisibilityObb(T);return T};J=Array.isArray(H.children)?H.children.map(J).filter(T=>null!=T):null;const M=!0===H.isEmpty;return{id:I,mbs:H.mbs,obb:B,children:J,resources:{isEmpty:!(H.featureData?.length??!1)&&M,hasSharedResource:null!=H.sharedResource,attributes:H.attributeData?I:void 0,texture:H.textureData&&0<H.textureData.length?I:void 0,geometry:null!=H.geometryData?
I:void 0},version:"string"===typeof H.version?H.version:null,lodSelection:Array.isArray(H.lodSelection)?H.lodSelection:null,numFeatures:L}}resetFailedNodes(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(I=>{null!=I.node&&(I.node.failed=!1)})}_entryPriority(I){var H=this._getNodeInternal(I),B=this.getParentIndex(I);if(null==H||null==B&&null==H.node)return null==B?Infinity:this._entryPriority(B);let K=0;H.node&&null!=B&&(B=this._getNodeInternal(B).traversalState,null!=B&&(K=
B.lodLevel));for(B=this.progressiveLoadPenalty;null!=I;I=this.getParentIndex(I))if(this._isLoaded(I)){B=0;break}H=null!=H.ref?this._viewportQueries.distToPOI(H.ref):null!=H.node?this._viewportQueries.distToPOI(H.node):0;return-H-K*(H+this.progressiveLoadPenalty)+B}traverseVisible(I){const H=this._getNodeInternal(this._rootIndex);null==H?I(this._rootIndex,null,null):this._traverseVisible(this._rootIndex,null,H,I)}_traverseVisible(I,H,B,K){if(B.node&&0===B.childCount)this.isGeometryVisible(I)&&K(I,
B,H);else if(this.isNodeVisible(I)&&(K(I,B,H),null!=B.node&&(H=this.nodeTraversalState(B.node),!H?.nodeHasLOD||H.lodLevel!==this._maxLodLevel))){H=this._getPage(I);for(let L=0;L<B.childCount;L++){const J=H.children[B.childOffset+L],M=this._getNodeInternal(J);M?this._traverseVisible(J,I,M,K):K(J,null,I)}}}traverse(I,H){H(I)&&this.traverseChildren(I,H)}traverseChildren(I,H){I=I.index;const B=this._getNodeInternal(I);null!=B&&this._traverseChildren(I,B,H)}_traverseChildren(I,H,B){I=this._getPage(I);
if(null!=I){var K=H.childOffset+H.childCount;for(H=H.childOffset;H<K;++H){const L=I.children[H],J=this._getNodeInternal(L);null!=J?.node&&B(J.node)&&this._traverseChildren(L,J,B)}}}updateChildrenLoaded(I,H){for(I=this.getNode(I);null!=I;){var B=I.childrenLoaded;const K=B+H;I.childrenLoaded=K;B=0===B?1:0===K?-1:0;I=I.index;0!==B&&(this._getPage(I).numNodesWithLoadedChildren+=B);I=this.getParent(I)}}checkChildrenLoadedInvariant(){if(null==this.rootNode)return!0;const I=[],H=B=>{let K=this._isLoaded(B.index)||
this._isReloading(B.index)?1:0;this.traverseChildren(B,L=>{K+=H(L);return!1});B.childrenLoaded!==K&&I.push(B.index);return K};H(this.rootNode);I.length&&this._logger.error("childrenLoaded invariant broken at following nodes: "+I.join(","));return 0<I.length}updateStats(I){0<this._updates.add.length&&(I.nodes+=" + "+this._updates.add.length);I.index=this._nodePages.size*(this._pageSize||1)+(this._clientNodePage?.nodes.length??0);I.prio=this._maxProcessingPrio;if(this._indexMissing||0<this._prefetchNodes.length)I.index+=
" + "+this._indexMissing||this._prefetchNodes.length;if(this._featureEstimate.estimate){const H=this._featureEstimate.estimate-I.features;0<H?I.features+=" + "+H:0>H&&(I.features+=" - "+-H)}}updateElevationInfo(I,H){this.needNodeElevationRange=H&&!!I&&("relative-to-ground"===I.mode||"on-the-ground"===I.mode);this._viewportQueries.updateElevationInfo(I);this.invalidateAllElevationRanges()}invalidateAllElevationRanges(){this._forAllNodes(I=>{h(I);null!=I.node&&I.node.invalidateElevationRange();null!=
I.ref&&I.ref.invalidateElevationRange()})}_forAllNodes(I){if(null!=this._clientNodePage){var H=this._clientNodePage;for(var B=0;B<H.nodes.length;B++)I(H.nodes[B],-(B+1))}for(const [K,L]of this._nodePages)for(H=K*this._pageSize,B=0;B<L.nodes.length;B++)I(L.nodes[B],H+B)}clearCaches(){if(this._useNodePages){const I=this._nodePages,H=new Set;this.traverseVisible(B=>H.add(u(B,this._pageSize)));for(const [B,K]of I)if(0!==K.numNodesWithLoadedChildren||H.has(B))for(const L of K.nodes)L.traversalState=null;
else this._deleteNodePage(B)}}_deleteNodePage(I){this._nodePages.delete(I)}get test(){return{addNode:(I,H)=>this._addNode(I,H),getNodeInternal:I=>this._getNodeInternal(I),getPageIndex:I=>u(I,this._pageSize),getIndexWithinPage:I=>w(I,this._pageSize),getNodePage:I=>0>I?this._clientNodePage:this._nodePages.get(I),getChildIndices:I=>{const H=this._getNodeInternal(I);I=this._getPage(I);if(null==H||null==I)return[];const B=[];for(let K=H.childOffset;K<H.childOffset+H.childCount;++K)B.push(I.children[K]);
return B},rootIndex:this._rootIndex,clientNodePage:this._clientNodePage,nodePages:this._nodePages}}}const y=new Map;class z{constructor(I){this.missing=I;this.update=new b({deallocator:null});this.add=new b({deallocator:null});this.remove=new b({deallocator:null});this.cancel=[]}reset(I){this.add.clear();this.update.clear();this.cancel=I}}const D=[["maxScreenThreshold",l.LodMetric.MaxScreenThreshold],["screenSpaceRelative",l.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",l.LodMetric.RemovedFeatureDiameter],
["distanceRangeFromDefaultCamera",l.LodMetric.DistanceRangeFromDefaultCamera]];class C{constructor(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}const E=m.create(),A=m.create(),F=m.create(),G=m.create();a.I3SIndex=r;a.selectErrorMetric=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/ElevationRange":function(){define(["exports"],function(a){a.expandElevationRange=function(b,g,d){b&&("number"===typeof g?(b.elevationRangeMin=
Math.min(b.elevationRangeMin,g),b.elevationRangeMax=Math.max(b.elevationRangeMax,d)):(b.elevationRangeMin=Math.min(b.elevationRangeMin,g.elevationRangeMin),b.elevationRangeMax=Math.max(b.elevationRangeMax,g.elevationRangeMax)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/sphere"],function(a,b){class g{constructor(m,f){this.id=m;this.mbs=f;this.renderMbs=b.fromValues(0,0,0,-1);this.elevationRangeMax=
this.elevationRangeMin=NaN}invalidateElevationRange(){this.elevationRangeMin=NaN}}a.NodeFilterImpact=void 0;(function(m){m[m.Unmodified=0]="Unmodified";m[m.Culled=1]="Culled";m[m.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(m){m[m.Unmodified=0]="Unmodified";m[m.PotentiallyModified=1]="PotentiallyModified";m[m.Culled=2]="Culled";m[m.Unknown=3]="Unknown";m[m.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact=
{}));class d extends g{constructor(m,f,c,l,e,p,h,u,w,x){super(m,c);this.index=f;this.childCount=l;this.level=e;this.resources=p;this.version=h;this.lodMetric=u;this.maxError=w;this.numFeatures=x;this.failed=!1;this.cacheState=a.CacheState.Unknown;this.childrenLoaded=this.memory=this.vertexCount=0;this.hasModifications=!1;this.imModificationImpact=a.NodeIMModificationImpact.NotChecked}}a.CacheState=void 0;(function(m){m[m.Unknown=0]="Unknown";m[m.Uncached=1]="Uncached";m[m.Cached=2]="Cached"})(a.CacheState||
(a.CacheState={}));a.LodMetric=void 0;(function(m){m[m.None=0]="None";m[m.MaxScreenThreshold=1]="MaxScreenThreshold";m[m.ScreenSpaceRelative=2]="ScreenSpaceRelative";m[m.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";m[m.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=void 0;(function(m){m[m.Hole=0]="Hole";m[m.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));class k{constructor(m,f,c,l){this.nodeHasLOD=m;this.isChosen=f;this.lodLevel=
c;this.version=l}}a.Node=d;a.NodeBase=g;a.NodeTraversalState=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],function(a,b,g){class d{constructor(m){this._layerView=m;this._lodGlobalDirty=!1}startNodeLoading(m,f,c,l){this._maxLodLevel=l.maxLodLevel;this._index=c;this._isNodeInScaleBounds=m;this._removeNodes=f}shouldLoadNode(m){if(null==m)return!1;const f=
this._index.nodeTraversalState(m);return this._isChosenMaxLOD(f)?!0:f.isChosen?this._childrenRequireLoading(m):!1}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return null!=this._index&&!0===this._lodGlobalDirty}lodGlobalHandling(m){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var f=Math.max(0,Math.floor(10*(this._layerView.view.resourceController.memoryController.usedMemory-1)));k.clear();this._lodGlobalHandling(this._index.rootNode,f,!1,!!this._layerView.nodeCrossfadingEnabled);
f=k.length;this._removeNodes(k,m);m=k.length<f;0!==k.length&&(this._lodGlobalDirty=!0);k.clear();return m}_lodGlobalHandling(m,f,c,l){if(null==m)return!1;const e=m.index,p=this._index,h=this._layerView;var u=p.nodeTraversalState(m);u=this._isChosenMaxLOD(u);var w=m.resources.isEmpty;if(u&&w)return 0<m.childrenLoaded&&this._removeChildrenRecursive(m),!0;w=h.isNodeLoaded(e);if(l&&w&&u){var x=!c&&this.hasNoVisibleChildren(m);h.fadeNode(e,g.FadeDirection.FadeIn,!x)}x=w&&(!h.isNodeFullyFadedIn||h.isNodeFullyFadedIn(e));
if(w&&(h.updateNodeState(e,u?b.NodeState.Leaf:b.NodeState.Hole),u))return x&&this._removeChildrenRecursive(m),x;var n=0<m.childCount;let q=n;if(n)for(n=0;n<m.childCount;n++){const t=p.getChildIndex(e,n),v=p.getNode(t);null!=v?p.isGeometryVisible(t)&&!this._lodGlobalHandling(v,f,c||x,l)&&this._isNodeInScaleBounds(v)&&(q=!1):p.isNodeVisible(t)&&(q=!1)}(f=w&&!u&&(q||k.length<f))&&k.push(e);!l||f||!w||c||q||h.fadeNode(e,g.FadeDirection.FadeIn,!1);m=m.resources.isEmpty;return q||x&&!f||m}_removeChildrenRecursive(m){this._index.traverseChildren(m,
f=>{(this._layerView.isNodeLoaded(f.index)||this._layerView.isNodeReloading(f.index))&&k.push(f.index);return 0<f.childrenLoaded})}hasNoVisibleChildren(m){let f=!0;this._index.traverseChildren(m,c=>f&&this._index.isNodeVisible(c.index)?this._layerView.isNodeLoaded(c.index)?f=!1:0<c.childrenLoaded:!1);return f}_childrenRequireLoading(m){let f=!1,c=!0;this._index.traverseChildren(m,l=>{if(!c||!this._index.isNodeVisible(l.index))return!1;const e=this._index.nodeTraversalState(l);this._isChosenMaxLOD(e)&&
this._index.isGeometryVisible(l.index)&&(f=!0);return this._layerView.isNodeLoaded(l.index)?c=!1:0<l.childrenLoaded});return c&&f}_isChosenMaxLOD(m){return m.isChosen&&(!m.nodeHasLOD||m.lodLevel===this._maxLodLevel)}}const k=new a({deallocator:null});return d})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=1]="FadeOut";Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),function(a,b,g,d,k,m,f,c){class l{constructor(e,p,h,u,w,x){this._streamDataController=p;this._logger=h;this._defaultGeometrySchema=u;this._requiredAttributes=w;this._options=x;this._logLayer=e;this._layerUrl=e.parsedUrl.path;this._geometryDefinitions=
e.geometryDefinitions;if(e.materialDefinitions){const n=e.textureSetDefinitions;this._materialAndTextures=e.materialDefinitions.map(q=>c.getMaterialAndTextures(n,q))}}_load(e,p,h){return this._streamDataController.request(e,p,h)}_loadAttribute(e,p,h){return this._load(`${this._layerUrl}/nodes/${e.resources.attributes}/attributes/${p.key}/0`,"binary",h).then(u=>f.readBinaryAttribute(p,u))}async loadAttributes(e,p,h){const u=await Promise.allSettled(p.map(n=>this._loadAttribute(e,n.attributeStorageInfo,
h))),w={};for(let n=0;n<p.length;++n){var x=u[n];const q=p[n];"fulfilled"===x.status?w[q.name]=x.value:(x=x.reason,d.throwIfAbortError(x),this._logger.error("#loadAttributes",this._logLayer,`Failed to load attributeData for '${q.name}' on node '${e.id}'`,x))}return w}async loadNodeData(e,p){var h=null!=this._requiredAttributes&&e.resources.attributes?a.result(this.loadAttributes(e,this._requiredAttributes,p)):null;var u=this._geometryDefinitions;var w={bufferDefinition:null,bufferIndex:0};var x=e.resources.geometryDefinition;
if(!(null==u||null==x||0>x)&&(u=0<=x?u[x].geometryBuffers:null,null!=u))for(x=0;x<u.length;x++){var n=u[x];if(null!=n.compressedAttributes){if("draco"===n.compressedAttributes.encoding&&!b("disable-feature:i3s-draco")){w.bufferIndex=x;w.bufferDefinition=n;break}}else w.bufferIndex=x,w.bufferDefinition=u[x]}const {bufferDefinition:q,bufferIndex:t}=w;x=(n=!!e.resources.geometry)?a.result(this._loadGeometry(e.resources.geometry,t,p)):null;u=e.resources.hasSharedResource?await this._loadShared(e,p):null;
w=e.resources.materialDefinition;w=this._materialAndTextures&&null!=w&&0<=w?this._materialAndTextures[w]:null!=u?c.getMaterialAndTexturesFromShared(u):null;var v=w?.material;w=w?.textures??[];const r=`${e.id}`,y=!n&&this._options.loadFeatureData;n=y?await this._loadFeatureData(r,p):null;if(y)a:{if(n)for(D of n.featureData)if(v=D.geometries,null!=v)for(var z of v){var D={featureIds:[D.id],featureDataPosition:D.position,geometries:[z]};break a}D=null}else D={featureIds:[],geometries:[{type:"ArrayBufferView",
params:{material:v}}],featureDataPosition:[0,0,0]};if(null==D)if(n){z=[];for(C of n.featureData)null!=C.position&&z.push({featureIds:[C.id],featureDataPosition:C.position,geometries:[]});var C=z}else C=null;else C=null;z=0<w.length?a.result(this.loadTextures(e,w,p)):null;p=e=null;x&&(e=a.assertResult(await x),(p=this._defaultGeometrySchema)&&u?.materialDefinitions&&(x=Object.keys(u.materialDefinitions)[0],!u.materialDefinitions[x].params.vertexRegions&&p.vertexAttributes.region&&(p=g.clone(p),delete p.vertexAttributes.region)),
p=f.createGeometryDescriptor(q,p));u=z?a.assertResult(await z):null;h=(h=h?a.assertResult(await h):{})?{attributeData:h,loadedAttributes:this._requiredAttributes}:null;if(null!=D)return{geometryData:D,attributeDataInfo:h,geometryBuffer:e,geometryDescriptor:p,requiredTextures:w,textureData:u};if(null!=C)return{pointData:C,attributeDataInfo:h,geometryBuffer:e,geometryDescriptor:p,requiredTextures:w,textureData:u};throw Error();}static _addAbsoluteHrefTexture(e,p){e=e.textureDefinitions;if(null!=e)for(const h of Object.keys(e))for(const u of e[h].images)Array.isArray(u.href)?
u.hrefConcat=u.href.map(w=>k.makeAbsolute(w,p)):u.hrefConcat=k.makeAbsolute(u.href,p)}static _fixTextureEncodings(e){e=e.textureDefinitions;if(null!=e)for(const h in e){const u=e[h];if(Array.isArray(u.encoding))for(var p=0;p<u.encoding.length;p++){const w=u.encoding[p];"data:"===w.substring(0,5)&&(u.encoding[p]=w.substring(5))}else p=u.encoding,"data:"===p.substring(0,5)&&(u.encoding=p.substring(5))}}_loadShared(e,p){const h=`${this._layerUrl}/nodes/${e.resources.geometry}/shared`;return this._load(h,
"json",p).then(u=>{l._fixTextureEncodings(u);l._addAbsoluteHrefTexture(u,h);return u})}_loadTexture(e,p,h,u,w,x){let n=!1;return w===m.TextureEncoding.DDS_S3TC||w===m.TextureEncoding.KTX2||w===m.TextureEncoding.Basis?this._load(e,"binary",x).then(q=>({id:p,usage:h,data:q,encoding:w,downsampled:n})):this._load(e,"image",x).then(q=>{var t=q;if(u&&4096<=q.width*q.height){t=Math.ceil(q.width/2);const v=Math.ceil(q.height/2),r=document.createElement("canvas");r.width=t;r.height=v;r.getContext("2d").drawImage(q,
0,0,t,v);t=r;n=!0}return{id:p,usage:h,data:t,encoding:w,downsampled:n}})}loadTextures(e,p,h){const u=!!this._options.uncompressedTextureDownsamplingEnabled,w=this._options.textureUsageMask;return Promise.all(p.map(x=>{if(0===(x.usage&w))return null;const n=c.selectEncoding(x.encodings,this._options.textureEncodings);return null==n?(this._logger.error("#loadTextures",this._logLayer,`No known encoding for texture found on node ${e.id}`),Promise.reject()):this._loadTexture(`${this._layerUrl}/nodes/${e.resources.texture||
e.id}/textures/${n.name}`,x.id,x.usage,u,n.encoding,h)}))}_loadFeatureData(e,p){return this._load(`${this._layerUrl}/nodes/${e}/features/0`,"json",p)}_loadGeometry(e,p,h){return this._load(`${this._layerUrl}/nodes/${e}/geometries/${p}`,"binary",h)}}return l})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){function h(r){return r.sort((y,z)=>y.encoding-z.encoding)}function u(r,y,z){if(null==r||z===d.TextureUsage.None)return null;for(let D=0;D<r.length;D++){const C=r[D];if(null!=C&&0!==(C.usage&z))return r=y[D],null!=r?r.id:null}return null}function w(r){switch(r){case d.TextureEncoding.KTX2:return c.TextureEncodingMimeType.KTX2_ENCODING;case d.TextureEncoding.Basis:return c.TextureEncodingMimeType.BASIS_ENCODING;case d.TextureEncoding.DDS_S3TC:return c.TextureEncodingMimeType.DDS_ENCODING;
case d.TextureEncoding.PNG:return"image/png";case d.TextureEncoding.JPG:return"image/jpeg";case d.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const x={ktx2:d.TextureEncoding.KTX2,basis:d.TextureEncoding.Basis,dds:d.TextureEncoding.DDS_S3TC,png:d.TextureEncoding.PNG,jpg:d.TextureEncoding.JPG,"ktx-etc2":d.TextureEncoding.KTX_ETC2},n={[c.TextureEncodingMimeType.KTX2_ENCODING]:d.TextureEncoding.Basis,[c.TextureEncodingMimeType.BASIS_ENCODING]:d.TextureEncoding.Basis,[c.TextureEncodingMimeType.DDS_ENCODING]:d.TextureEncoding.DDS_S3TC,
"image/png":d.TextureEncoding.PNG,"image/jpg":d.TextureEncoding.JPG,"image/jpeg":d.TextureEncoding.JPG,"image/ktx":d.TextureEncoding.KTX_ETC2},q=()=>({alphaMode:"opaque",alphaCutoff:m.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:c.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),
t={s:p.TextureWrapMode.CLAMP_TO_EDGE,t:p.TextureWrapMode.CLAMP_TO_EDGE},v={s:p.TextureWrapMode.REPEAT,t:p.TextureWrapMode.REPEAT};a.configureMaterial=function(r,y,z,D,C,E){const A=E.rendererTextureUsage;var F=y.metallicRoughness.baseColorFactor,G=g.clamp(y.metallicRoughness.baseColorFactor[3],0,1);r.baseColor=[F[0],F[1],F[2],G];r.hasParametersFromSource=!!y.hasParametersFromSource;r.usePBR=E.usePBR;r.mrrFactors=[y.metallicRoughness.metallicFactor,y.metallicRoughness.roughnessFactor,y.hasParametersFromSource?
e.defaultSchematicMRRFactors[2]:e.defaultAdvancedMRRFactors[2]];r.emissiveFactor=y.emissiveFactor;r.isIntegratedMesh=E.isIntegratedMesh;r.textureAlphaCutoff="mask"===y.alphaMode?y.alphaCutoff:m.defaultMaskAlphaCutoff;r.alphaDiscardMode="opaque"===y.alphaMode?c.AlphaDiscardMode.Opaque:"mask"===y.alphaMode?c.AlphaDiscardMode.Mask:c.AlphaDiscardMode.MaskBlend;F=[];G=u(D,z,(d.TextureUsage.Color|d.TextureUsage.AlphaMask)&A);null!=G&&(r.baseColorTexture=new k.RenderTexture(C,G),F.push(r.baseColorTexture.loadPromise));
G=u(D,z,d.TextureUsage.MetallicRoughness&A);null!=G&&(r.metallicRoughnessTexture=new k.RenderTexture(C,G),F.push(r.metallicRoughnessTexture.loadPromise));G=u(D,z,d.TextureUsage.Emissive&A);null!=G&&(r.emissionTexture=new k.RenderTexture(C,G),F.push(r.emissionTexture.loadPromise));G=u(D,z,d.TextureUsage.Occlusion&A);null!=G&&(r.occlusionTexture=new k.RenderTexture(C,G),F.push(r.occlusionTexture.loadPromise));z=u(D,z,d.TextureUsage.Normal&A);null!=z&&(r.normalTexture=new k.RenderTexture(C,z),F.push(r.normalTexture.loadPromise));
r.commonMaterialParameters.hasSlicePlane=E.slicePlaneEnabled;r.commonMaterialParameters.doubleSided=y.doubleSided;r.commonMaterialParameters.cullFace=y.cullFace;r.ellipsoidMode=f.getEllipsoidMode(E.viewSpatialReference);return Promise.all(F)};a.createTexture=function(r,y,z,D){if(null==r?.data)return null;const C=r.data;D=D.renderingContext.parameters.maxMaxAnisotropy;const E=1<D;z=z||!y.wrapTextures?t:v;const A=w(r.encoding);return new l.Texture(C,{mipmap:E,maxAnisotropy:D,encoding:A,wrap:z,components:r.usage&
d.TextureUsage.Color?"opaque"===y.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=q;a.getMaterialAndTextures=function(r,y){const z=new Map,D=(B,K)=>{if(null==B)return-1;var L=z.get(B.id);if(L)return L.usage|=K,L.id;L=z.size;z.set(B.id,{id:L,usage:K});return L};var C=y.pbrMetallicRoughness;const E=C?.baseColorFactor,A=y.emissiveFactor,F=e.useSchematicPBR({normalTexture:y.normalTexture,emissiveTexture:y.emissiveTexture,emissiveFactor:y.emissiveFactor,occlusionTexture:y.occlusionTexture,metallicRoughnessTexture:C?.metallicRoughnessTexture,
metallicFactor:C?.metallicFactor,roughnessFactor:C?.roughnessFactor}),G=F?e.defaultSchematicMRRFactors[0]:C?.metallicFactor??e.defaultAdvancedMRRFactors[0],I=F?e.defaultSchematicMRRFactors[1]:C?.roughnessFactor??e.defaultAdvancedMRRFactors[1];C={baseColorFactor:E?[E[0],E[1],E[2],E[3]]:[1,1,1,1],baseColorTextureId:D(C?.baseColorTexture,"mask"===y.alphaMode?d.TextureUsage.Color|d.TextureUsage.AlphaMask:d.TextureUsage.Color),metallicRoughnessTextureId:D(C?.metallicRoughnessTexture,d.TextureUsage.MetallicRoughness),
metallicFactor:G,roughnessFactor:I};y={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,doubleSided:y.doubleSided,cullFace:"none"===y.cullFace?c.CullFaceOptions.None:"back"===y.cullFace?c.CullFaceOptions.Back:"front"===y.cullFace?c.CullFaceOptions.Front:c.CullFaceOptions.None,normalTextureId:D(y.normalTexture,d.TextureUsage.Normal),emissiveTextureId:D(y.emissiveTexture,d.TextureUsage.Emissive),occlusionTextureId:D(y.occlusionTexture,d.TextureUsage.Occlusion),emissiveFactor:A?[A[0],A[1],A[2]]:[0,0,
0],metallicRoughness:C,wrapTextures:!1,hasParametersFromSource:F};const H=[];z.forEach(({usage:B},K)=>{var L=null!=r&&r[K]&&r[K].formats;L=L?h(L.map(({name:J,format:M})=>({name:J,encoding:x[M]}))):[];H.push({id:K,usage:B,encodings:L})});return{material:y,textures:H}};a.getMaterialAndTexturesFromShared=function(r){var y=r?.materialDefinitions?Object.keys(r.materialDefinitions)[0]:null,z=r?.textureDefinitions?Object.keys(r.textureDefinitions)[0]:null;y=y?r.materialDefinitions?.[y]:null;z=z?r.textureDefinitions?.[z]:
null;r=q();if(null!=y){y=y.params;y.diffuse&&(r.metallicRoughness.baseColorFactor=[y.diffuse[0],y.diffuse[1],y.diffuse[2],1]);null!=y.doubleSided&&(r.doubleSided=y.doubleSided,r.cullFace=y.doubleSided?c.CullFaceOptions.None:c.CullFaceOptions.Back);if("none"===y.cullFace||"front"===y.cullFace||"back"===y.cullFace)r.cullFace="none"===y.cullFace?c.CullFaceOptions.None:"back"===y.cullFace?c.CullFaceOptions.Back:c.CullFaceOptions.Front;y.transparency&&(r.metallicRoughness.baseColorFactor[3]=g.clamp(1-
y.transparency,0,1));if(y.useVertexColorAlpha||1>r.metallicRoughness.baseColorFactor[3])r.alphaMode="blend"}y=[];if(null!=z){!z.wrap||"repeat"!==z.wrap[0]&&"repeat"!==z.wrap[1]||(r.wrapTextures=!0);let D=d.TextureUsage.Color;"rgba"===z.channels&&(r.alphaMode="blend",D|=d.TextureUsage.AlphaMask);const C=z.images[z.images.length-1];z=Array.isArray(z.encoding)?h(z.encoding.map((E,A)=>({name:C.href[A]?.split("/").pop(),encoding:n[E]||0}))):[{name:C.href?.split("/").pop(),encoding:n[z.encoding]||0}];y.push({id:0,
usage:D,encodings:z});r.metallicRoughness.baseColorTextureId=0}return{material:r,textures:y}};a.getSupportedEncodings=function(r){const y=!!r.compressedTextureS3TC;r=!!r.compressedTextureETC;const z=b("disable-feature:i3s-basis")?0:d.TextureEncoding.Basis|d.TextureEncoding.KTX2,D=z|d.TextureEncoding.DDS_S3TC;return d.TextureEncoding.JPG|d.TextureEncoding.PNG|(y?D:0)|(r?z:0)};a.selectEncoding=function(r,y){if(null!=y)return r.find(z=>0!==(z.encoding&y))};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../core/maybe","../../../../../core/promiseUtils"],function(a,b,g){class d{constructor(k,m){this._textureRep=k;this.loadPromise=null;this._disposed=!1;k=this._textureRep.acquire(m);g.isPromiseLike(k)?(k.then(f=>{this._disposed?b.releaseMaybe(f):this._textureRef=f}),this.loadPromise=k):this._textureRef=k}dispose(){this._textureRef=b.releaseMaybe(this._textureRef);this._disposed=!0}get glTexture(){return null!=
this._textureRef?this._textureRef.glTexture:null}}a.RenderTexture=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../core/promiseUtils"],function(a,b){class g{constructor(d,k){this._requester=d;this._apiKey=k;this._activeRequests=new Set}get busy(){return this._requester.busy}request(d,k,m){const f=new AbortController;m=b.onAbortOrThrow(m,()=>f.abort());d=this._requester.request(d,k,{signal:f.signal,
query:{token:this._apiKey}});const c={response:d,abortController:f,abortHandle:m};this._activeRequests.add(c);b.always(d,()=>{c.abortController=null;c.abortHandle?.remove();c.abortHandle=null;this._activeRequests.delete(c)});return d}cancelAll(){this._activeRequests.forEach(d=>{d.abortController?.abort();d.abortController=null;d.abortHandle?.remove()});this._activeRequests.clear()}}a.I3SStreamDataController=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/ellipsoidUtils ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/frustum ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedPoint ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./ElevationRange ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q){class t{constructor(v,r,y,z,D,C,E,A,F={}){this._indexSR=v;this._renderCoordsHelper=r;this._clippingArea=D;this._elevationProvider=C;this._viewingMode=E;this._options=F;this._frustum=f.create();this._useFrustumCulling=!1;this._poi=b.create();this._elevationContext=null;this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=q.create();this._tmp1=b.create();this._tmp2=b.create();this._tmp3=b.create();this._tmp0=b.create();this._screenspaceErrorBias=
F.screenspaceErrorBias||1;this._progressiveLoadFactor=F.progressiveLoadFactor||1;this.updateCamera(y,z);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(A);this._tmpPoint=e.makeDehydratedPoint(0,0,0,v);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(this.engineSR.isWebMercator||c.isPlateCarree(this.engineSR));this._indexSREllipsoidRadius=d.getReferenceEllipsoid(this._indexSR).radius}updateElevationInfo(v){null==v?this._elevationContext=null:(this._elevationContext=
h.ElevationContext.fromElevationInfo(v),this._elevationContext.updateFeatureExpressionInfoContext(u.createContextWithoutExpressionSupport(u.extractExpressionInfo(v,!1))))}updateCamera(v,r){(this._useFrustumCulling=r)&&f.fromMatrix(v.viewMatrix,v.projectionMatrix,this._frustum);this._screenSizeFactor=1/(v.perScreenPixelRatio/2);this._camPos=v.eye;this.minDistance=Infinity;this.maxDistance=0}setPointOfInterest(v){this._poi=v}updateScreenSpaceErrorBias(v){const r=this._screenspaceErrorBias;this._screenspaceErrorBias=
v;return r}updateClippingArea(v){this._clippingArea=v}expandElevationRange(v,r,y){null!=this._elevationContext&&(v=v.mbs)&&(this._elevationProvider.getSphereElevationBounds?(r=this._elevationProvider.getSphereElevationBounds(v,this._indexSR))&&w.expandElevationRange(y,r.min,r.max):((v=this._elevationProvider.getElevation(v[0],v[1],v[2],this._indexSR,"relative-to-scene"===this._elevationContext.mode?"scene":"ground"))&&w.expandElevationRange(y,v,v),(r=r?null:this._elevationProvider.getRootElevationBounds?.())&&
w.expandElevationRange(y,r.min,r.max)))}getRenderMbs(v){const r=v.renderMbs;if(n.isValidMbs(r))return r;v.mbs&&g.copy(r,v.mbs);const y=v.elevationRangeMin;if(this._elevationContext&&Number.isFinite(y)){let z=0,D=0;v=v.elevationRangeMax;switch(this._elevationContext.mode){case "relative-to-ground":z=this._elevationContext.geometryZWithOffset(r[2],this._renderCoordsHelper)+y-r[2];D=v-y;break;case "on-the-ground":z=y-r[2],D=v-y}r[2]+=z+.5*D;r[3]+=.5*D}else this._elevationContext&&1E5>r[3]&&(this._tmpPoint.x=
r[0],this._tmpPoint.y=r[1],this._tmpPoint.z=r[2],r[2]=p.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper));m.projectBoundingSphere(r,this._indexSR,r,this.engineSR);return r}_getVisibilityObb(v){if(null!=v.visibilityObb)return v.visibilityObb;const r=v.serviceObb,y=.01*this._indexSREllipsoidRadius;if(null==r||!v.mbs||!n.isValidObb(r)||this._isECEFOBBInLocalMode&&r.halfSize.some(z=>z>y))return null;v.serviceObbInRenderSR=this._computeRenderObb(r,
v.serviceObbInRenderSR,v.mbs[3],v.elevationRangeMin,v.elevationRangeMax);return v.serviceObbInRenderSR}_computeRenderObb(v,r,y,z,D){if(null==r)r=q.create();else if(n.isValidObb(r))return r;let C=0,E=0;if(this._elevationContext&&!Number.isNaN(z)&&Number.isFinite(z))switch(this._elevationContext.mode){case "relative-to-ground":C=this._elevationContext.geometryZWithOffset(v.center[2],this._renderCoordsHelper)+z-v.center[2];E=D-z;break;case "on-the-ground":C=z-v.center[2],E=D-z}else this._elevationContext&&
1E5>y&&(this._tmpPoint.x=v.center[0],this._tmpPoint.y=v.center[1],this._tmpPoint.z=v.center[2],C=p.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-v.center[2]);0<E?(n.transformObb(v,this._indexSR,this._tmpObb,this.engineSR,C),q.computeOffsetObb(this._tmpObb,0,E,this._viewingMode,r)):n.transformObb(v,this._indexSR,r,this.engineSR,C);return r}isNodeVisible(v){const r=this.getRenderMbs(v);return this._isMBSinClippingArea(r)?this._useFrustumCulling?
(v=this._getVisibilityObb(v))?q.isVisible(v,this._frustum):f.intersectsSphere(this._frustum,l.wrap(r)):!0:!1}isGeometryVisible(v){if(!this._useFrustumCulling)return!0;const r=v.geometryObb;return null!=r?q.isVisible(r,this._frustum):this.isNodeVisible(v)}_isMBSinClippingArea(v){return null==this._clippingArea?!0:n.intersectBoundingRectWithMbs(this._clippingArea,v)!==n.MbsIntersectResult.OUTSIDE}_screenSpaceDiameterMbs(v,r){var y=this.getRenderMbs(v);v=Math.sqrt(a.squaredDistance(y,this._camPos));
y=v-y[3];this._updateMinMaxDistance(v);return 0>y?.5*Number.MAX_VALUE:r/y*this._screenSizeFactor}calcCameraDistance(v){return this.calcCameraDistanceToCenter(v)-this.getRenderMbs(v)[3]}calcCameraDistanceToCenter(v){v=this.getRenderMbs(v);v=a.distance(v,this._camPos);this._updateMinMaxDistance(v);return v}calcAngleDependentLoD(v){v=this.getRenderMbs(v);const r=v[3];v=(Math.abs(v[0]*(v[0]-this._camPos[0])+v[1]*(v[1]-this._camPos[1])+v[2]*(v[2]-this._camPos[2]))/a.length(v)+r)/a.distance(v,this._camPos);
return Math.min(1,v)}hasLOD(v){return v.lodMetric!==x.LodMetric.None}_getDistancePlanarMode(v,r){var y=v[0]-r[0];const z=v[1]-r[1];v=v[2]-r[2];y=y*y+z*z;r=r[3];if(y<=r*r)return Math.abs(v);r=Math.sqrt(y)-r;return Math.sqrt(v*v+r*r)}_getDistanceGlobeMode(v,r){var y=a.length(r);const z=a.length(v)-y;a.scale(this._tmp0,v,a.dot(v,r)/a.squaredLength(v));var D=a.squaredDistance(r,this._tmp0),C=r[3];if(D<=C*C)return Math.abs(z);r=a.scale(this._tmp0,r,1/y);y=a.scale(this._tmp1,r,y-C*C/2/y);D=a.subtract(this._tmp2,
v,y);D=a.subtract(this._tmp2,D,a.scale(this._tmp3,r,a.dot(r,D)));y=a.add(this._tmp2,y,a.scale(this._tmp2,D,C/a.length(D)));C=a.distance(v,y);2E5<=z&&(v=a.subtract(this._tmp1,v,y),v=a.dot(v,r)/a.length(v),.08>v&&(v=1E-4),C/=v);return C}_getDistance(v,r){return this.engineSR===k.getSphericalPCPF(this.engineSR)?this._getDistanceGlobeMode(v,r):this._getDistancePlanarMode(v,r)}_updateMinMaxDistance(v){0<v?(this.minDistance=Math.min(this.minDistance,v),this.maxDistance=Math.max(this.maxDistance,v)):(this.minDistance=
0,this.maxDistance=Math.max(this.maxDistance,-v))}getLodLevel(v){if(v.lodMetric===x.LodMetric.None)return 0;if(0===v.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const r=this._screenspaceErrorBias;return this.evaluateLODmetric(v,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(v,r)?2:1:0}return this.evaluateLODmetric(v,this._screenspaceErrorBias)?this.maxLodLevel:0}evaluateLODmetric(v,r){switch(v.lodMetric){case x.LodMetric.ScreenSpaceRelative:const y=
this.getRenderMbs(v),z=this._getDistance(this._camPos,y),D=2*z/this._screenSizeFactor;this._updateMinMaxDistance(z+y[3]);return v.maxError*r<=D;case x.LodMetric.MaxScreenThreshold:return r=this._screenSpaceDiameterMbs(v,v.mbs[3]*r),this._options.angleDependentLoD&&(r*=this.calcAngleDependentLoD(v)),r<v.maxError;case x.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(v,v.maxError)*r;case x.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(v)>v.maxError*
r}return!1}distToPOI(v){v=this.getRenderMbs(v);return a.distance(v,this._poi)-v[3]}distCameraToPOI(){return a.distance(this._camPos,this._poi)}}return t})},"esri/layers/support/SceneModification":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h){var u;b=u=class extends g.JSONSupport{constructor(w){super(w);this.geometry=null;this.type="clip"}writeGeometry(w,x,n,q){if(q.layer?.spatialReference&&!q.layer.spatialReference.equals(this.geometry.spatialReference)){if(!p.canProjectWithoutEngine(w.spatialReference,q.layer.spatialReference)){q?.messages&&q.messages.push(new k("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:q.layer.spatialReference,
context:q}));return}const t=new h;p.projectPolygon(w,t,q.layer.spatialReference);x[n]=t.toJSON(q)}else x[n]=w.toJSON(q);delete x[n].spatialReference}clone(){return new u({geometry:d.clone(this.geometry),type:this.type})}};a.__decorate([m.property({type:h}),e.persistable()],b.prototype,"geometry",void 0);a.__decorate([l.writer(["web-scene","portal-item"],"geometry")],b.prototype,"writeGeometry",null);a.__decorate([m.property({type:["clip","mask","replace"],nonNullable:!0}),e.persistable()],b.prototype,
"type",void 0);return b=u=a.__decorate([c.subclass("esri.layers.support.SceneModification")],b)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/tslib.es6 ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/lang ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/uid ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/projection/projectBuffer ../../../geometry/support/aaBoundingBox ../../../geometry/support/DoubleArray ../../../layers/graphics/dehydratedPoint ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/UpdatePolicy ../../../symbols/PointSymbol3D".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D){class C{constructor(I,H){this.meta=I;this.index=H}}class E{constructor(I,H){this.graphic=I;this.geometry=H;this.components=[];this.overridesDirty=!1}}b=class extends g{get updating(){return this._graphicsCore?.updating??!1}constructor(I){super(I);this.loadedGraphics=new y.LimitGraphicsMap(5E4);this.slicePlaneEnabled=!1;this._renderingInfo={symbol:new D};this._featuresMap=new Map}initialize(){const I=this.view.basemapTerrain;this._graphicsCore=
new t.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:z.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:H=>this.view.deconflictor.addGraphicsOwner(H),labeler:(H,B)=>this.view.labeler.addGraphicsOwner(H,B,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),
scaleVisibility:(H,B)=>new v.Graphics3DScaleVisibility({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:B,graphicsCore:H,basemapTerrain:I,layerScaleEnabled:!1})}});this._graphicsCore.initializePromise.then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this.addHandles(c.watch(()=>this.layer.labelingInfo,(H,B)=>{u.diff(H,B)&&this._graphicsCore.updateLabelingInfo()}))}destroy(){this._graphicsCore=f.destroyMaybe(this._graphicsCore);this.loadedGraphics=f.destroyMaybe(this.loadedGraphics);
this.view=null}addNodeMeta(I,H){let B=0;const K=I.filteredIds,L=this.view.spatialReference,J=[];for(let Q=0;Q<I.featureIds.length;Q++){const O=I.featureIds[Q];var M=null==K;K&&B<K.length&&O===K[B]&&(M=!0,B++);if(!this._enabledForFeatureInNode(I,Q))continue;var T=this._featuresMap.get(O);if(T){T.components.push(new C(I,Q));this._updateLabelPosition(O);continue}const U=H(Q,I);T=q.makeDehydratedPoint(0,0,0,L);M={objectId:O,uid:l.generateUID(),attributes:U,visible:M,geometry:T};T=new E(M,T);T.components.push(new C(I,
Q));this._featuresMap.set(O,T);this._updateLabelGeometry(O);J.push(M)}this.loadedGraphics.addMany(J)}updateLabelPositions(I){const H=this.view.renderCoordsHelper;this._forEachGraphic(I,(B,K,L)=>{K=this._graphicsCore.getGraphics3DGraphicById(K.uid);null!=K&&this._updateLabelGeometry(I.featureIds[B])&&K.alignWithAbsoluteElevation(L.z??0,H,!1)})}setNodeMetaAttributes(I,H){const B=[];this._forEachGraphic(I,(K,L)=>{K=H(K,I);k.equalsShallow(L.attributes,K)||(L.attributes=K,B.push(L.uid))});this._graphicsCore.updateLabelingInfo(B)}applyFilterChange(I){this._forEachFeature(I,
(H,B,K)=>{if(this._enabledForFeatureInNode(I,H))H=B.graphic,B=H.visible,B!==K&&(H.visible=K,A.graphic=H,A.property="visible",A.oldValue=B,A.newValue=K,this._graphicsCore.graphicUpdateHandler(A));else switch(K=I.featureIds[H],this._removeFeature(B,I,H)){case F.REMOVED:this.loadedGraphics.removeManyByObjectId([K]);break;case F.MODIFIED:this._updateLabelPosition(K)}})}removeNodeMeta(I){const H=[];this._forEachGraphic(I,B=>{const K=I.featureIds[B],L=this._featuresMap.get(K);if(L)switch(this._removeFeature(L,
I,B)){case F.MODIFIED:this._updateLabelPosition(K);break;case F.REMOVED:H.push(K)}});this.loadedGraphics.removeManyByObjectId(H)}_removeFeature(I,H,B){const K=I.components.length;d.filterInPlace(I.components,L=>!(L.meta===H&&L.index===B));return 0===I.components.length?(this._featuresMap.delete(H.featureIds[B]),F.REMOVED):K!==I.components.length?F.MODIFIED:F.UNMODIFIED}getRenderingInfo(){return this._renderingInfo}notifyGraphicGeometryChanged(){}notifyGraphicVisibilityChanged(){}_updateLabelPosition(I){const H=
this._featuresMap.get(I);H&&this._updateLabelGeometry(I)&&(this.loadedGraphics.removeManyByObjectId([I]),this.loadedGraphics.addMany([H.graphic]))}_updateLabelGeometry(I){I=this._featuresMap.get(I);if(!I)return!1;const H=I.geometry,B=this.view.spatialReference,K=this.view.renderCoordsHelper,L=H.x,J=H.y,M=H.z??0,T=n.newDoubleArray(I.components.length*r.boundingBoxCornersPointsStride);let Q=0;for(const {meta:O,index:U}of I.components)r.boundingBoxCornerPoints(U,this.collection,O.objectHandle,T,Q),Q+=
r.boundingBoxCornersPointsStride;w.projectBuffer(T,K.spatialReference,0,T,B,0,T.length/3);x.set(G,x.negativeInfinity);x.expandWithBuffer(G,T);H.x=(G[0]+G[3])/2;H.y=(G[1]+G[4])/2;H.z=G[5];return!m.floatEqualUlp(H.x,L)||!m.floatEqualUlp(H.y,J)||!m.floatEqualUlp(H.z,M)}_forEachGraphic(I,H){this._forEachFeature(I,(B,{graphic:K,geometry:L},J)=>{this._enabledForFeatureInNode(I,B)&&H(B,K,L,J)})}_forEachFeature(I,H){let B=0;for(let K=0;K<I.featureIds.length;K++){const L=this._featuresMap.get(I.featureIds[K]);
let J=null==I.filteredIds;I.filteredIds&&I.filteredIds[B]===I.featureIds[K]&&(J=!0,B++);L&&H(K,L,J)}}_enabledForFeatureInNode(I,H){return 0>I.node.index||!this.overrides?.featureHasGeometryChanges(I.featureIds[H])}get updatePolicy(){return this._graphicsCore.effectiveUpdatePolicy}get usedMemory(){return this._graphicsCore.usedMemory}get unloadedMemoryEstimate(){return this._graphicsCore.unprocessedMemoryEstimate}get test(){return{graphicsCore:this._graphicsCore}}};a.__decorate([e.property()],b.prototype,
"view",void 0);a.__decorate([e.property()],b.prototype,"layer",void 0);a.__decorate([e.property()],b.prototype,"collection",void 0);a.__decorate([e.property()],b.prototype,"loadedGraphics",void 0);a.__decorate([e.property()],b.prototype,"overrides",void 0);a.__decorate([e.property()],b.prototype,"updating",null);a.__decorate([e.property()],b.prototype,"slicePlaneEnabled",void 0);a.__decorate([e.property()],b.prototype,"_graphicsCore",void 0);b=a.__decorate([h.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],
b);const A={graphic:null,property:null,oldValue:null,newValue:null};var F;(function(I){I[I.UNMODIFIED=0]="UNMODIFIED";I[I.MODIFIED=1]="MODIFIED";I[I.REMOVED=2]="REMOVED"})(F||(F={}));const G=x.create();return b})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/projectBuffer ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray".split(" "),function(a,b,g,d,k,m){function f(e,
p,h,u,w){e=p.getComponentAabb(h,e,c);p=p.getObjectTransform(h);for(h=0;8>h;++h)l[0]=h&1?e[0]:e[3],l[1]=h&2?e[1]:e[4],l[2]=h&4?e[2]:e[5],b.transformMat3(l,l,p.rotationScale),b.add(l,l,p.position),u[w++]=l[0],u[w++]=l[1],u[w++]=l[2];return u}const c=k.create(),l=g.create();a.boundingBoxCornerPoints=f;a.boundingBoxCornersPointsStride=24;a.createGetFeatureExtent=function(e,p,h){const u=m.newDoubleArray(24);return w=>{var x=w.meta.featureExtents;if(null==x){x=new Float64Array(6*w.meta.featureIds.length);
w.meta.featureExtents=x;for(let n=0;n<x.length;n+=6)x[n]=Number.POSITIVE_INFINITY}x=new Float64Array(x.buffer,6*w.index*Float64Array.BYTES_PER_ELEMENT,6);x[0]===Number.POSITIVE_INFINITY&&(f(w.index,h,w.meta.objectHandle,u,0),d.projectBuffer(u,p,0,u,e,0,8)?(k.set(x,k.negativeInfinity),k.expandWithBuffer(x,u,0,8)):k.set(x,k.zero));return x}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../core/Evented","../../../core/MapUtils",
"./GraphicsMap"],function(a,b,g,d){class k extends b{constructor(l){super();this._limit=l;this._all=new d.GraphicsMap;this._active=new c(this);this._pending=new Map;this._handle=this._all.on("change",e=>this._handleChanges(e))}destroy(){this._handle.remove()}get length(){return this._active.length}toArray(){return this._active.toArray()}find(l){return this._active.find(l)}forEach(l){this._active.forEach(l)}addMany(l){this._all.addMany(l)}removeManyByObjectId(l){this._all.removeManyByObjectId(l)}_handleChanges(l){let e=
l.removed;if(0<this._pending.size){e=[];for(var p of l.removed)this._pending.delete(p.objectId)||e.push(p)}p=this._limit-this._active.length+e.length;p<l.added.length&&(this._active.removeMany(e),e=[],f.reset(1-this._limit/(this._active.length+l.added.length)),this._active.forEach(u=>{f.sample()&&(e.push(u),this._pending.set(u.objectId,u))}),p=this._limit-this._active.length+e.length);let h=l.added;if(p<l.added.length){h=[];f.reset(p/l.added.length);for(const u of l.added)f.sample()?h.push(u):this._pending.set(u.objectId,
u)}l=p-h.length;0<l&&0<this._pending.size&&(f.reset(l/this._pending.size),this._pending.forEach(u=>{f.sample()&&(h.push(u),this._pending.delete(u.objectId))}));this._active.addAndRemove(h,e)}}class m{constructor(){this._percentage=1;this._last=-1;this._index=0}reset(l){this._percentage=l;this._last=-1}sample(){const l=Math.floor(this._index*this._percentage);++this._index;if(l===this._last)return!1;this._last=l;return!0}}const f=new m;class c{constructor(l){this._parent=l;this._map=new Map}get length(){return this._map.size}forEach(l){this._map.forEach(e=>
l(e))}find(l){let e=void 0;g.someMap(this._map,p=>l(p)?(e=p,!0):!1);return e}toArray(){return[...this._map.values()]}addAndRemove(l,e){for(const p of l)this._map.set(p.objectId,p);for(const p of e)this._map.delete(p.objectId);(0<l.length||0<e.length)&&this._parent.emit("change",{added:l,removed:e})}removeMany(l){for(const e of l)this._map.delete(e.objectId);0<l.length&&this._parent.emit("change",{added:[],removed:l})}}a.LimitGraphicsMap=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../core/Evented","../../../core/MapUtils"],function(a,b,g){class d extends b{constructor(){super(...arguments);this._map=new Map}clear(){if(0<this._map.size){const k=this.toArray();this._map.clear();this.emit("change",{added:[],removed:k})}}get length(){return this._map.size}get(k){return this._map.get(k)}addMany(k){if(0!==k.length){var m=new Set;for(let f=0;f<k.length;f++){const c=k[f],l=c.objectId,e=this._map.get(l);e?(m.add(l),
c!==e&&(k[f]=e),e.refCount||(e.refCount=0),++e.refCount):(c.refCount=1,this._map.set(l,c))}k=0<m.size?k.filter(f=>!m.has(f.objectId)):k;0<k.length&&this.emit("change",{added:k,removed:[]})}}removeMany(k){const m=[];for(const f of k){k=f.objectId;const c=this._map.get(k);null!=c&&(!c.refCount||0>=--c.refCount)&&(this._map.delete(k),m.push(f))}0<m.length&&this.emit("change",{added:[],removed:m})}removeManyByObjectId(k){const m=[];for(const f of k)k=this._map.get(f),null!=k&&(!k.refCount||0>=--k.refCount)&&
(this._map.delete(f),m.push(k));0<m.length&&this.emit("change",{added:[],removed:m})}toArray(){return[...this._map.values()]}find(k){let m;g.someMap(this._map,f=>k(f)?(m=f,!0):!1);return m}forEach(k){this._map.forEach(m=>k(m))}}a.GraphicsMap=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../core/Logger ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../geometry/projection/projectVectorToVector ../../../libs/i3s/enums".split(" "),
function(a,b,g,d,k,m,f){function c(h,u,w){e.clear();var x=Infinity;let n=Infinity,q=-Infinity,t=-Infinity,v=!1;for(const y of u){var r="clip"===y.type?f.ModificationType.Inside:"mask"===y.type?f.ModificationType.Outside:f.ModificationType.Replace;const z=y.geometry;u=D=>D;if(z.spatialReference){if(!k.canProjectWithoutEngine(z.spatialReference,w)){b.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}u=
D=>{m.projectVectorToVector(D,z.spatialReference,p,w);return p}}else z.hasZ||(p[2]=0,u=D=>{p[0]=D[0];p[1]=D[1];return p});v=v||r===f.ModificationType.Outside;e.push(r);e.push(z.rings.length);for(const D of z.rings){e.push(D.length);for(const C of D)r=u(C),e.push(r[0]),e.push(r[1]),e.push(r[2]),x=Math.min(x,r[0]),n=Math.min(n,r[1]),q=Math.max(q,r[0]),t=Math.max(t,r[1])}}null!=h&&(v?(e.push(f.ModificationType.Inside),e.push(2),e.push(4),e.push(x-1E-4),e.push(n-1E-4),e.push(0),e.push(q+1E-4),e.push(n-
1E-4),e.push(0),e.push(q+1E-4),e.push(t+1E-4),e.push(0),e.push(x-1E-4),e.push(t+1E-4),e.push(0)):(e.push(f.ModificationType.Outside),e.push(1)),e.push(4),e.push(h[0]),e.push(h[1]),e.push(0),e.push(h[2]),e.push(h[1]),e.push(0),e.push(h[2]),e.push(h[3]),e.push(0),e.push(h[0]),e.push(h[3]),e.push(0));e.push(f.ModificationType.Finished);h=new Float64Array(e.length);for(x=0;x<e.length;++x)h[x]=e.at(x);return h}class l extends d.WorkerHandle{constructor(h){super("SceneLayerWorker","process",{process:u=>
[u.geometryBuffer],project:u=>[u.positions.buffer],transformNormals:u=>[u.normals.buffer]},h,{hasInitialize:!0})}setModifications(h,u,w,x){h={context:h,modifications:c(u,w,x),isGeodetic:x.isGeographic};this.broadcast(h,"setModifications")}setLegacySchema(h,u){u=JSON.stringify(u);return this.broadcast({context:h,jsonSchema:u},"setLegacySchema")}destroyContext(h){return this.broadcast(h,"destroyContext")}project(h,u){return this.invokeMethod("project",h,u)}transformNormals(h,u){return this.invokeMethod("transformNormals",
h,u)}}const e=new g({deallocator:null}),p=[0,0,0];a.I3SMeshWorkerHandle=l;a.toWasmModification=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||
(a.ModificationType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesMode=void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.QUERYABLE=2]="QUERYABLE"})(a.ForAllFeaturesMode||(a.ForAllFeaturesMode={}));a.ForAllFeaturesReturnType=void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType=
{}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../geometry/SpatialReference ../../../geometry/support/DoubleArray ../../../geometry/support/MeshGeoreferencedRelativeVertexSpace ../../../geometry/support/MeshLocalVertexSpace ../../../chunks/vec32 ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),function(a,b,g,d,k,m,f,c,l,e){function p(r){if(t){var y=r.modifications,z=
t._malloc(8*y.length),D=new Float64Array(t.HEAPU8.buffer,z,y.length);for(let C=0;C<y.length;++C)D[C]=y[C];t.setModifications(r.context,z,y.length,r.isGeodetic);t._free(z)}}function h(r,y,z){const {context:D,localOrigin:C,globalTrafo:E,mbs:A,obb:F,elevationOffset:G,geometryBuffer:I,geometryDescriptor:H,indexToVertexProjector:B,vertexToRenderProjector:K}=y;var L=r._malloc(I.byteLength),J=r._malloc(33*Float64Array.BYTES_PER_ELEMENT),M=new Uint8Array(r.HEAPU8.buffer,L,I.byteLength);M.set(new Uint8Array(I));
var T=new Float64Array(r.HEAPU8.buffer,J,33);x(T,C);var Q=T.byteOffset+3*T.BYTES_PER_ELEMENT,O=new Float64Array(T.buffer,Q);x(O,E);Q+=16*T.BYTES_PER_ELEMENT;O=new Float64Array(T.buffer,Q);x(O,A);Q+=4*T.BYTES_PER_ELEMENT;null!=F&&(O=new Float64Array(T.buffer,Q),x(O,F.center),Q+=3*T.BYTES_PER_ELEMENT,O=new Float64Array(T.buffer,Q),x(O,F.halfSize),Q+=3*T.BYTES_PER_ELEMENT,O=new Float64Array(T.buffer,Q),x(O,F.quaternion));T={isDraco:!1,isLegacy:!1,color:y.layouts.some(P=>P.some(R=>"color"===R.name)),
normal:y.needNormals&&y.layouts.some(P=>P.some(R=>"normalCompressed"===R.name)),uv0:y.layouts.some(P=>P.some(R=>"uv0"===R.name)),uvRegion:y.layouts.some(P=>P.some(R=>"uvRegion"===R.name)),featureIndex:H.featureIndex};M=r.process(D,!!y.obb,L,M.byteLength,H,T,J,G,B,K,y.normalReferenceFrame);r._free(J);r._free(L);if(0<M.error.length)throw Error(`i3s.wasm: ${M.error}`);if(M.discarded)return null;r=0<M.componentOffsets.length?M.componentOffsets.slice():null;L=0<M.featureIds.length?M.featureIds.slice():
null;J=0<M.anchorIds.length?Array.from(M.anchorIds):null;T=0<M.anchors.length?Array.from(M.anchors):null;Q=M.interleavedVertedData.slice().buffer;O=M.indicesType===c.IndexType.Int16?(new Uint16Array(M.indices.buffer,M.indices.byteOffset,M.indices.byteLength/2)).slice():(new Uint32Array(M.indices.buffer,M.indices.byteOffset,M.indices.byteLength/4)).slice();const U=M.positions.slice(),Z=M.positionIndicesType===c.IndexType.Int16?(new Uint16Array(M.positionIndices.buffer,M.positionIndices.byteOffset,
M.positionIndices.byteLength/2)).slice():(new Uint32Array(M.positionIndices.buffer,M.positionIndices.byteOffset,M.positionIndices.byteLength/4)).slice();y={layout:y.layouts[0],interleavedVertexData:Q,indices:O,hasColors:M.hasColors,hasModifications:M.hasModifications,positionData:{data:U,indices:Z}};L&&z.push(L.buffer);r&&z.push(r.buffer);z.push(Q);z.push(O.buffer);z.push(U.buffer);z.push(Z.buffer);return{componentOffsets:r,featureIds:L,anchorIds:J,anchors:T,transformedGeometry:y,obb:M.obb}}function u(r){if(t){var {context:y,
buffer:z}=r;r=t._malloc(z.byteLength);var D=z.byteLength/Float64Array.BYTES_PER_ELEMENT,C=new Float64Array(t.HEAPU8.buffer,r,D),E=new Float64Array(z);C.set(E);t.filterOBBs(y,r,D);E.set(C);t._free(r)}}function w(r){t&&0===t.destroy(r)&&(t=null)}function x(r,y){for(let z=0;z<y.length;++z)r[z]=y[z]}function n(){if(t)return Promise.resolve(t);q||(q=l.get().then(r=>{t=r;q=null;return t}));return q}let q,t;const v={transform:(r,y)=>t&&h(t,r,y),destroy:w};b.destroyContext=function(r){w(r)};b.dracoDecompressPointCloudData=
async function(r){t=await n();const y=[r.geometryBuffer];var {geometryBuffer:z}=r,D=z.byteLength;r=t._malloc(D);D=new Uint8Array(t.HEAPU8.buffer,r,D);D.set(new Uint8Array(z));z=t.dracoDecompressPointCloudData(r,D.byteLength);t._free(r);if(0<z.error.length)throw Error(`i3s.wasm: ${z.error}`);r=0<z.featureIds?.length?z.featureIds.slice():null;z=z.positions.slice();r&&y.push(r.buffer);y.push(z.buffer);return{result:{positions:z,featureIds:r},transferList:y}};b.filterObbsForModifications=async function(r){await n();
u(r);r={buffer:r.buffer};return{result:r,transferList:[r.buffer]}};b.filterObbsForModificationsSync=u;b.initialize=async function(){t||await n()};b.interpretObbModificationResults=function(r){return 0===r?e.NodeIMModificationImpact.Unmodified:1===r?e.NodeIMModificationImpact.PotentiallyModified:2===r?e.NodeIMModificationImpact.Culled:e.NodeIMModificationImpact.Unknown};b.process=async function(r){t=await n();const y=[r.geometryBuffer];return{result:h(t,r,y),transferList:y}};b.project=async function(r){const {localMatrix:y,
origin:z,positions:D,vertexSpace:C,localMode:E}=r;var A=g.fromJSON(r.inSpatialReference);r=g.fromJSON(r.outSpatialReference);if("georeferenced"===C.type){const [{projectBuffer:B},{initializeProjection:K}]=await Promise.all([new Promise((L,J)=>a(["../../../geometry/projection/projectBuffer"],L,J)),new Promise((L,J)=>a(["../../../geometry/projection"],L,J))]);await K(A,r);var F=new Float64Array(D.length);B(D,A,0,F,r,0,F.length/3)}else{F="georeferencedRelative"===C.type?k.fromJSON(C):m.fromJSON(C);const {project:B}=
await new Promise((K,L)=>a(["../../../geometry/support/meshUtils/georeference"],K,L));F=d.toFloat64Array(B({positions:D,transform:y?{localMatrix:y}:void 0,vertexSpace:F,inSpatialReference:A,outSpatialReference:r,localMode:E}))}A=F.length;const [G,I,H]=z;for(r=0;r<A;r+=3)F[r]-=G,F[r+1]-=I,F[r+2]-=H;return{result:{projected:F,original:D},transferList:[F.buffer,D.buffer]}};b.setLegacySchema=async function(r){t=await n();t.setLegacySchema(r.context,r.jsonSchema)};b.setModifications=async function(r){await n();
p(r)};b.setModificationsSync=p;b.test=v;b.transformNormals=async function({normalMatrix:r,normals:y}){const z=new Float32Array(y.length);f.transformMat3(z,y,r);f.normalize(z,z);return{result:{transformed:z,original:y},transferList:[z.buffer,y.buffer]}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,b,g){function d(m){return g.getAssetUrl(`esri/libs/i3s/${m}`)}let k;b.get=function(){k||(k=(new Promise(m=>
(new Promise((f,c)=>a(["../../chunks/i3s"],f,c))).then(f=>f.i3s).then(({default:f})=>{const c=f({locateFile:d,onRuntimeInitialized:()=>m(c)});delete c.then}))).catch(m=>{throw m;}));return k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils","../../../../core/handleUtils","../II3SMeshView3D"],function(a,b,g){class d{constructor(){this.ids=new Set}}class k{constructor({collection:m,forAllFeatures:f,
forAllFeaturesOfNode:c}){this._highlights=[];this._collection=m;this._forAllFeatures=f;this._forAllFeaturesOfNode=c}destroy(){this._highlights.forEach(m=>this._releaseSet(m));this._highlights=null}acquireSet(){const m=new d;this._highlights.push(m);const f=b.makeHandle(()=>{this._highlights&&(this._releaseSet(m),a.removeUnordered(this._highlights,m))});return{set:m,handle:f}}setFeatureIds(m,f){f.forEach(c=>m.ids.add(c));this._initializeSet(m)}_initializeSet(m){this._forAllFeatures((f,c,l)=>{m.ids.has(f)&&
this._collection.addComponentHighlight(l.objectHandle,c);return g.ForAllFeaturesReturnType.CONTINUE})}_releaseSet(m){this._forAllFeatures((f,c,l)=>{m.ids.has(f)&&this._collection.removeComponentHighlight(l.objectHandle,c);return g.ForAllFeaturesReturnType.CONTINUE})}objectCreated(m){this._highlights.forEach(f=>{this._forAllFeaturesOfNode(m,(c,l)=>{f.ids.has(c)&&this._collection.addComponentHighlight(m.objectHandle,l);return g.ForAllFeaturesReturnType.CONTINUE})})}objectDeleted(m){this._collection.clearHighlights(m.objectHandle)}}
return k})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../graphics/ExtentSet ../../../support/Scheduler".split(" "),function(a,b,g,d,k,m,f,c,l,e){a.I3SAsyncElevationUpdater=class extends g{constructor(p,h,u){super({});
this._updateExtent=h;this._updateNode=u;this.running=!1;this._extentSet=new l.ExtentSet;this._nodeSet=new Set;this.addHandles(p.registerTask(e.TaskPriority.ELEVATION_ALIGNMENT,this))}normalizeCtorArgs(){return{}}addExtent(p){this._extentSet.add(p);this.running=!0}schedule(p){this._nodeSet.add(p);this.running=!0}remove(p){this._nodeSet.delete(p);this._updateRunning()}runTask(p){const h=this._extentSet;for(p.run(()=>h.merge(p));!h.empty&&!p.done;){var u=this._updateExtent(h.pop());null!=u&&u.forAll(w=>
this.schedule(w));p.madeProgress()}if(!p.done){u=this._nodeSet;for(const w of u)if(u.delete(w),this._updateNode(w),p.madeProgress(),p.done)break;this._updateRunning()}}_updateRunning(){this.running=0<this._nodeSet.size||0<this._extentSet.size}};b.__decorate([d.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=b.__decorate([c.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater.ts")],a.I3SAsyncElevationUpdater);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,b,g,d){class k{constructor(){this.lodCrossfadeSignedDuration=0}}class m{constructor(f){this._view=f;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}destroy(){this._preRenderFrameTaskHandle?.remove();this._view=this._preRenderFrameTaskHandle=null}get updating(){return 0<this._numFadingNodes}stopNodeFading(f){null!=
f.lodCrossfadeProgress&&(this._numFadingNodes--,f.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=b.removeMaybe(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))}_startNodeFading(f,c,l){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=g.addFrameTask({preRender:e=>this._updateAllNodeFading(e)}),this._view.notifyLODUpdate());null==f.lodCrossfadeProgress&&(this._numFadingNodes++,
this._view.notifyUpdate());f.lodCrossfadeSignedDuration=l;f.lodCrossfadeProgress=c}_updateAllNodeFading(f){const c=this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((l,e)=>{if(null!=e?.lodCrossfadeProgress){const p=e.lodCrossfadeSignedDuration,h=e.lodCrossfadeProgress+Math.abs(f.deltaTime/p),u=!c||1<=h||0===p,w=(0<p?this._view.fullOpacity:0)-(u?0:0<p?1:-1)*(1-h);u?(this.stopNodeFading(e),0>p&&this._view.markNodeToRemove(l)):e.lodCrossfadeProgress=h;this._view.setNodeOpacityByIndex(l,
w)}});this._view.removeMarkedNodes()}stopAllNodeFading(){this._view.foreachCrossfadeNode((f,c)=>{null!=c?.lodCrossfadeProgress&&(this.stopNodeFading(c),c=c.lodCrossfadeSignedDuration,0>c&&this._view.markNodeToRemove(f),this._view.setNodeOpacityByIndex(f,0<c?this._view.fullOpacity:0))});this._view.removeMarkedNodes()}fadeNode(f,c,l,e){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var p=this._view;const h=p.nodeCrossfadingEnabled,u=l===d.FadeDirection.FadeIn?p.fullOpacity:
0;e=h?e?l===d.FadeDirection.FadeIn?p.lodCrossfadeinDuration:p.lodCrossfadeoutDuration:p.lodCrossfadeUncoveredDuration:0;p=this._view.getNodeOpacityByIndex(f);h&&p!==u&&0<e?this._startNodeFading(c,1-Math.abs(u-p),(l===d.FadeDirection.FadeIn?1:-1)*e):(this.stopNodeFading(c),this._view.setNodeOpacityByIndex(f,u),l===d.FadeDirection.FadeOut&&this._view.removeNode(f))}isNodeFullyFadedIn(f){const c=this._view.getNodeCrossfadeMetaData(f);return null==c||null==c.lodCrossfadeProgress&&this._view.getNodeOpacityByIndex(f)===
this._view.fullOpacity}}a.I3SCrossfadeHelper=m;a.NodeCrossfadeMetaData=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t){const v=x.empty(),r=p.create(),y=n.fromValues(0,0,0,0),z=u.create(),D=u.create(),C=u.create();b=class extends g.EventedMixin(b){get spatialReference(){return this.view?.elevationProvider?.spatialReference}constructor(E){super(E);this._tmpEvent={spatialReference:null,extent:v,context:"scene"}}initialize(){this.view=this.layerView.view;this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersector=q.newIntersector(this.view.state.viewingMode);this._intersector.options.store=
t.StoreResults.MIN;this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}getElevation(E,A,F,G){z[0]=E;z[1]=A;z[2]=F;E=this._renderCoordsHelper;if(!E.toRenderCoords(z,G,z))return d.getLogger(this).error("could not project point to compute elevation"),null;const {layerView:I,_intersector:H,intersectionHandler:B}=this;G=I.i3slayer.fullExtent;G=null!=G&&Number.isFinite(G.xmin)&&Number.isFinite(G.xmax)&&Number.isFinite(G.ymin)&&Number.isFinite(G.ymax)&&Number.isFinite(G.zmin)&&Number.isFinite(G.zmax)?
{min:G.zmin,max:G.zmax}:I.elevationRange;if(null==G)return null;A=I.elevationOffset;F=G.min+A;E.setAltitude(D,G.max+A,z);E.setAltitude(C,F,z);H.reset(D,C,null);B.intersect(H,null,D,C);return H.results.min.getIntersectionPoint(z)?E.getAltitude(z):null}getSphereElevationBounds(E,A){w.projectBoundingSphere(E,A,y,this._renderCoordsHelper.spatialReference);return this.layerView.getElevationRange(y)}getRootElevationBounds(){const E=this.layerView.i3slayer.fullExtent;return E?.hasZ?{min:E.zmin,max:E.zmax}:
null}layerChanged(){this.spatialReference&&(this._tmpEvent.extent=this._computeLayerExtent(),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(E){this.spatialReference&&(this._tmpEvent.extent=this._computeObjectExtent(E),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(E){x.empty(v);this._expandExtent(E,v);return v}_computeLayerExtent(){x.empty(v);for(const E of this.layerView.getVisibleNodes())this._expandExtent(E,
v);return v}_expandExtent(E,A){const F=this.spatialReference;if(null!=F&&(E=this.layerView.getNodeComponentObb(E),null!=E)){e.fromQuat(r,E.quaternion);r[12]=E.center[0];r[13]=E.center[1];r[14]=E.center[2];for(let G=0;8>G;++G)z[0]=G&1?E.halfSize[0]:-E.halfSize[0],z[1]=G&2?E.halfSize[1]:-E.halfSize[1],z[2]=G&4?E.halfSize[2]:-E.halfSize[2],h.transformMat4(z,z,r),this._renderCoordsHelper.fromRenderCoords(z,z,F),x.expand(A,z,A)}}};a.__decorate([k.property({constructOnly:!0})],b.prototype,"layerView",void 0);
a.__decorate([k.property({constructOnly:!0})],b.prototype,"intersectionHandler",void 0);a.__decorate([k.property()],b.prototype,"view",void 0);a.__decorate([k.property()],b.prototype,"spatialReference",null);return b=a.__decorate([l.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],b)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../ViewingMode ./I3SUtil ./Intersector ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,g,d,k,m,f,c){function l(p,h,u,w=0){w=p[3]+w;const x=h[0]-p[0],n=h[1]-p[1];p=h[2]-p[2];h=u[0];const q=u[1];u=u[2];const t=h*x+q*n+u*p;return 0<=t*t-(h*h+q*q+u*u)*(x*x+n*n+p*p-w*w)}class e{constructor(p){this.type=f.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=p.layerUid;this.sublayerUid=p.sublayerUid;this._collection=p.collection;this._traverseNodeHierarchy=p.traverseNodeHierarchy;this.slicePlaneEnabled=p.slicePlaneEnabled;this.isGround=p.isGround}updateElevationAlignState(p,
h){this._needVerticalOffset=p&&h===b.ViewingMode.Global}intersect(p,h,u,w){const x=p.results,n=p.options.store===f.StoreResults.ALL,q=p.ray.direction,t=p.tolerance;let v=z=>z,r=z=>z;const y=c.getVerticalOffsetI3S(null!=p.verticalOffset?p.verticalOffset:this._needVerticalOffset?0:null);null!=p.verticalOffset&&null!=y&&(v=z=>y.applyToMbs(z),r=z=>y.applyToObb(z));this._traverseNodeHierarchy((z,D)=>{if(0===z.childrenLoaded)return!1;const C=null!=z.serviceObbInRenderSR&&g.isValidObb(z.serviceObbInRenderSR)?
z.serviceObbInRenderSR:null;if(null!=C&&!k.intersectLine(r(C),u,q,t))return!1;!D||null==C&&g.isValidMbs(z.renderMbs)&&!l(v(z.renderMbs),u,q,t)||null!=z.geometryObb&&!k.intersectLine(r(z.geometryObb),u,q,t)||this._collection.intersect(D,u,w,t,y,(E,A,F,G)=>{if(0<=A&&(null==h||h(u,w,A))){var I=H=>{const B=new d.I3sTarget(this.layerUid,this.sublayerUid,z.index,E,G);H.set(this.type,B,A,F)};this.isGround&&(null==x.ground.dist||A<x.ground.dist)&&I(x.ground);if(!p.options.isFiltered&&((null==x.min.dist||
A<x.min.dist)&&I(x.min),(null==x.max.dist||A>x.max.dist)&&I(x.max),n)){const H=m.newIntersectorResult(p.ray);I(H);p.results.all.push(H)}}});return!0})}}a.I3SIntersectionHandler=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SOverrides":function(){define("exports ../../../../chunks/tslib.es6 ../../../../request ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Collection ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/ReactiveSet ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../intl/number ../../../../layers/support/featureQueryAll ../../../../rest/support/meshFeatureSet ../../../../support/featureFlags ../../../../support/requestUtils ../FeatureLayerView3D".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C){a.I3SOverrides=class extends d{constructor(A){super(A);this._warnMaximumChangedObjectsExceeded=!1;this._maximumNumberOfEditOVerrides=5E4;this._original3DOFLDefinitionExpression=null;this._interactiveEditingSessions=new c;this.geometryOverrides=new c;this._clientGeometryCache=new Map;this._associatedLayerView=null;this._attributeChangedObjectIds=new u;this._geometryChangedObjectIds=new u;this._pendingFetchChangedObjectIds=null;this._pendingFetchAbortController=
new AbortController;this._featureIdLocks=new Map}initialize(){this._memCache=this.memoryController.newCache(`i3s-attribute-overrides-${this.layer.uid}`);this._pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this._pendingFetchAbortController?.signal);this._pendingFetchChangedObjectIds.finally(()=>{this._pendingFetchChangedObjectIds=this._pendingFetchAbortController=null});this.is3DOFL&&null!=this._associatedLayer&&(z.direct3DObjectFeatureLayerDisplayEnabled()?this._associatedLayer.load().then(A=>
{this.destroyed||(this._original3DOFLDefinitionExpression=A.definitionExpression,this.addHandles(w.watch(()=>this._definitionExpression,F=>A.definitionExpression=F,w.initial)),this._associatedLayerView=new C({layer:this._associatedLayer,view:this.view}))}):z.i3sPatchingEnabled())}destroy(){this.is3DOFL&&null!=this._associatedLayer&&(z.direct3DObjectFeatureLayerDisplayEnabled()?null!=this._associatedLayerView&&(this._associatedLayer.definitionExpression=this._original3DOFLDefinitionExpression):z.i3sPatchingEnabled());
this._set("layer",null);this._memCache=p.destroyMaybe(this._memCache);this._pendingFetchAbortController=p.abortMaybe(this._pendingFetchAbortController);this._pendingFetchChangedObjectIds=null;this._featureIdLocks.clear()}get is3DOFL(){return z.sceneLayerEditingEnabled()&&null!=this._associatedLayer?.infoFor3D}get sortedGeometryChangedObjectIds(){return this.is3DOFL?[...this._geometryChangedObjectIds].sort((A,F)=>A-F):[]}get _associatedLayer(){return null==this.layer?null:this.layer.associatedLayer}get hasGeometryChanges(){return 0<
this._geometryChangedObjectIds.size}get _definitionExpression(){const A=this.sortedGeometryChangedObjectIds;return 0===A.length?"1 \x3d 0":`OBJECTID IN (${A.join(",")})`}get updating(){return this.is3DOFL?this._pendingFetchChangedObjectIds?!0:z.direct3DObjectFeatureLayerDisplayEnabled()?null==this._associatedLayerView||null!=this._associatedLayerView&&this._associatedLayerView.updating:!1:!1}get isEmpty(){return null==this._pendingFetchChangedObjectIds&&0===this._attributeChangedObjectIds.size&&0===
this._geometryChangedObjectIds.size}featureHasGeometryChanges(A){return this._geometryChangedObjectIds.has(A)}featureHasAttributeChanges(A){return this._attributeChangedObjectIds.has(A)}createInteractiveEditSession(A){this._attributeChangedObjectIds.add(A);const F=this._interactiveEditingSessions,G=new E(A,()=>{F.remove(G)});F.unshift(G);return G}async applyAttributeOverrides(A,F,G,I=[]){this._pendingFetchChangedObjectIds&&await h.whenOrAbort(this._pendingFetchChangedObjectIds,G);if(null!=F){var {attributeData:H,
loadedAttributes:B}=F;if(null!=B&&null!=H&&0!==this._attributeChangedObjectIds.size){F=new Set;for(var K of B)F.add(K.index);for(const J of I)F.has(J.index)||(B.push(J),H[J.name]=Array(A.length));I=await this._lockFeatureIds(A);try{K={attributeData:H,loadedAttributes:B};const J=this._getOverridesFromCache(A,K,this._attributeChangedObjectIds),{objectIds:M,fieldNames:T}=J;if(0!==M.length&&0!==T.length){var L=await this._queryAttributeOverridesFromAssociatedLayer(M,T,G);null!=L&&this._processOverridesFromAssociatedLayer(A,
L,T,K)}}finally{I.remove()}}}}updateGeometry(A,F){this._geometryChangedObjectIds.add(A);const G=this._clientGeometryCache.get(A);null!=G&&(this.geometryOverrides.remove(G),this._clientGeometryCache.delete(A));null!=F&&(F={oid:A,mesh:F},this.geometryOverrides.add(F),this._clientGeometryCache.set(A,F))}updateAttributeValue(A,F,G){this._attributeChangedObjectIds.add(A);this._cacheAttributeValue(A,F,G)}featureAdded(A){this.is3DOFL&&z.i3sPatchingEnabled()&&this._geometryChangedObjectIds.add(A);this._attributeChangedObjectIds.add(A)}_cacheAttributeValue(A,
F,G){this._memCache.put(this._getAttributeCacheKey(A,F),G,this._memCacheAttributeValueSize(G))}_getOverridesFromCache(A,{loadedAttributes:F,attributeData:G},I){const H=new Set,B=[];for(var K of F)B[K.index]=G[K.name];G=new Set;for(K=0;K<A.length;K++){const L=A[K];if(I.has(L))for(const J of F){const M=this._attributeFromCache(L,J.index);void 0!==M?B[J.index][K]=M:(H.add(L),G.add(J.name))}}return{objectIds:Array.from(H),fieldNames:Array.from(G)}}_attributeFromCache(A,F){const G=this._fromInteractiveEditingSession(A,
F);if(void 0!==G)return G;A=this._getAttributeCacheKey(A,F);return this._memCache.get(A)}_fromInteractiveEditingSession(A,F){if(null!=this._interactiveEditingSessions)for(const G of this._interactiveEditingSessions){if(G.objectId!==A)continue;const I=G.getAttribute(F);if(void 0!==I)return I}}_getAttributeCacheKey(A,F){return`${A}-${F}`}async _queryAttributeOverridesFromAssociatedLayer(A,F,G){if(0===A.length)return null;this._logWarningIfMaximumObjectsExceeded();const {associatedLayer:I}=this.layer;
if(null==I)return null;const H=I.createQuery(),{objectIdField:B}=I;F=[B,...F];H.where="1\x3d1";H.returnGeometry=!1;H.outFields=F;H.cacheHint=!0;A=await this._executeBatchQuery(I,A,H,G);G=[];for(const K of A)if(K.ok)for(const L of K.value.features)G.push(L);return G}async _queryGeometryOverridesFromAssociatedLayer(A,F){if(0===A.length||!this.is3DOFL||!z.i3sPatchingEnabled())return null;this._logWarningIfMaximumObjectsExceeded();var G=this.layer.associatedLayer;const {objectIdField:I,globalIdField:H}=
G;var B=[I,...(null!=H?[H]:[])],K=G.createQuery();K.where="1\x3d1";K.returnGeometry=!0;K.outFields=B;K.cacheHint=!0;K.returnZ=G.hasZ;K.returnM=G.hasM;B=await this._executeBatchQuery(G,A,K,F);A=G.infoFor3D;({spatialReference:G}=G);F=[];for(const L of B){if(!L.ok)continue;const {assetMaps:J,features:M,globalIdFieldName:T}=L.value;if(null!=J){B=y.assetMapFromAssetMapsJSON(A,J);for(const Q of M){K=y.extractMesh(Q,T,G,A,B);const O=Q;null!=K?(O.geometry=K,F.push(O)):O.geometry=null}}}return F}_logWarningIfMaximumObjectsExceeded(){if(this._warnMaximumChangedObjectsExceeded){this._warnMaximumChangedObjectsExceeded=
!1;var A=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${v.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`,F=this.layer.portalItem;A=F&&F.loaded?A+` (${F.portal.url}/home/item.html?id=${F.id}#settings)`:A+` (${this.layer.parsedUrl.path})`;e.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("#queryOverrides()",this.layer.title,
`${A}.`)}}async _executeBatchQuery(A,F,G,I){if(0===F.length)return[];const H=r.getMaximumQuerySize(A);F=[...F].sort((B,K)=>B-K);F=k.splitIntoChunks(F,H).map(B=>{const K=G.clone();K.objectIds=B;return m.resultOrAbort(r.queryAllJSON(A,K,{signal:I}))});return Promise.all(F)}_processOverridesFromAssociatedLayer(A,F,G,{loadedAttributes:I,attributeData:H}){var B=this._associatedLayer;if(null!=B){B=B.objectIdField;var K=G.map(M=>{M in H||(H[M]=Array(A.length));return H[M]}),L=new Map(I.map(M=>[M.name,M.index]));
I=G.map(M=>L.get(M));var J=new Map(Array.from(A,(M,T)=>[M,T]));for(const M of F){F=M.attributes[B];for(let T=0;T<G.length;T++){const Q=I[T],O=J.get(F),U=M.attributes[G[T]];K[T][O]=U;this._cacheAttributeValue(F,Q,U)}}}}_memCacheAttributeValueSize(A){return"string"===typeof A?f.estimateStringByteSize(A):f.estimateNumberByteSize()}async _fetchChangedObjectIds(A){var F=this.layer;await F.load({signal:A});this._geometryChangedObjectIds.clear();this._attributeChangedObjectIds.clear();({associatedLayer:F}=
F);if(null!=F&&F.capabilities?.operations?.supportsChangeTracking){var G=this._getFetchChangedObjectIdsServerGen();if(null!=G){var I=F.layerId,H=this.is3DOFL;G={f:"json",returnIdsOnly:!0,layers:`[${I}]`,returnUpdates:!0,returnDeletes:H,returnInserts:H,layerServerGens:JSON.stringify([{id:I,serverGen:G}])};H&&(I=F.infoFor3D,G.fieldsToCompare=JSON.stringify({fields:[...Object.values(I.transformFieldRoles),I.sourceHashField]}));G=await m.result(g(`${F.url}/extractChanges`,{method:"post",query:G,timeout:1E4,
signal:A}));!G.ok&&D.isTimeoutError(G.error)&&(I=this.layer.title,e.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("extractChanges:timeout",I,`${I} could not obtain edited features that are not cached in the scene service. Display of features may not be up to date with the latest edits. Consider re-caching the scene service.`));if(G.ok&&1===G.value.data?.edits?.length){I=G.value.data.edits[0];G=I?.objectIds;var B=G?.adds??[];const K=G?.updates??[],L=G?.deletes??[];G=[...B,...K,...L];H=H?
[...B,...(I?.fieldUpdates??K),...L]:[];I=Math.min(this._maximumNumberOfEditOVerrides,G.length);I<G.length&&(this._warnMaximumChangedObjectsExceeded=!0);G=G.sort((J,M)=>J-M);for(B=0;B<I;++B)this._attributeChangedObjectIds.add(G[B]);for(const J of H)this._geometryChangedObjectIds.add(J);if(this.is3DOFL&&z.i3sPatchingEnabled()&&0<this._geometryChangedObjectIds.size&&(A=await this._queryGeometryOverridesFromAssociatedLayer(Array.from(this._geometryChangedObjectIds),A),null!=A))for(const J of A)null!=
J.geometry&&this.updateGeometry(J.attributes[F.objectIdField],J.geometry)}}}}_getFetchChangedObjectIdsServerGen(){var A=this.layer;if(null!=A.serviceUpdateTimeStamp?.lastUpdate)return A.serviceUpdateTimeStamp.lastUpdate;A=A.associatedLayer;return null!=A?.serverGens?.minServerGen?A.serverGens.minServerGen:null}async _lockFeatureIds(A){const F=this._featureIdLocks;for(var G=!0;G;){const H=[];for(const B of A){const K=F.get(B);K&&H.push(K)}0===H.length?G=!1:await Promise.all(H)}const I=h.createResolver();
G=I.promise;for(const H of A)F.set(H,G);return l.makeHandle(()=>{for(const H of A)F.delete(H);I.resolve()})}get test(){const A=this;return{changedObjectIds:Array.from(this._attributeChangedObjectIds),pendingFetchChangedObjectIds:this._pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return A._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(F){A._maximumNumberOfEditOVerrides=F}}}};b.__decorate([x.property({constructOnly:!0})],a.I3SOverrides.prototype,"view",void 0);b.__decorate([x.property({constructOnly:!0})],
a.I3SOverrides.prototype,"layer",void 0);b.__decorate([x.property({readOnly:!0})],a.I3SOverrides.prototype,"is3DOFL",null);b.__decorate([x.property()],a.I3SOverrides.prototype,"_interactiveEditingSessions",void 0);b.__decorate([x.property({readOnly:!0})],a.I3SOverrides.prototype,"sortedGeometryChangedObjectIds",null);b.__decorate([x.property({readOnly:!0})],a.I3SOverrides.prototype,"geometryOverrides",void 0);b.__decorate([x.property()],a.I3SOverrides.prototype,"_clientGeometryCache",void 0);b.__decorate([x.property()],
a.I3SOverrides.prototype,"_associatedLayer",null);b.__decorate([x.property()],a.I3SOverrides.prototype,"_associatedLayerView",void 0);b.__decorate([x.property({constructOnly:!0})],a.I3SOverrides.prototype,"memoryController",void 0);b.__decorate([x.property()],a.I3SOverrides.prototype,"_attributeChangedObjectIds",void 0);b.__decorate([x.property()],a.I3SOverrides.prototype,"_geometryChangedObjectIds",void 0);b.__decorate([x.property()],a.I3SOverrides.prototype,"hasGeometryChanges",null);b.__decorate([x.property()],
a.I3SOverrides.prototype,"_pendingFetchChangedObjectIds",void 0);b.__decorate([x.property()],a.I3SOverrides.prototype,"_pendingFetchAbortController",void 0);b.__decorate([x.property()],a.I3SOverrides.prototype,"_definitionExpression",null);b.__decorate([x.property()],a.I3SOverrides.prototype,"updating",null);b.__decorate([x.property()],a.I3SOverrides.prototype,"isEmpty",null);a.I3SOverrides=b.__decorate([t.subclass("esri.views.3d.layers.i3s.I3SOverrides")],a.I3SOverrides);class E{constructor(A,F){this.objectId=
A;this._remove=F;this._updates=new Map;this._isActive=!0}getAttribute(A){return this._updates.get(A)}setAttribute(A,F){this.isActive&&this._updates.set(A,F)}remove(){this.isActive&&(this._isActive=!1,this._remove())}get isActive(){return this._isActive}}Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/meshFeatureSet":function(){define("exports ../../Graphic ../../core/Logger ../../core/MapUtils ../../chunks/vec3f64 ../../geometry/Extent ../../geometry/Mesh ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/MeshGeoreferencedRelativeVertexSpace ../../geometry/support/MeshLocalVertexSpace ../../geometry/support/MeshTransform ../../geometry/support/meshUtils/External ../../layers/support/infoFor3D ./FeatureSet".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(D){return({attributes:C})=>{if(!C)return{};if(!D)return C;for(const E in C)D.has(E)||delete C[E];return C}}function q(D,C,E,A,F){F=F.get(D.attributes[C]);if(null==F)return y().error("mesh-feature-set:asset-not-found","Service returned a feature which was not found in the asset map",D),null;if(!D.geometry)return y().error("mesh-feature-set:no-geometry","Service returned a feature without geometry",D),null;const {originPoint:G,originVector:I}=t(D,E,
A);C=m.fromJSON(D.geometry);C.spatialReference=E;D=v(D.attributes,A);E=F.projectVertices?new e({origin:I}):new p({origin:I});a:{F=Array.from(F.files.values());A=[];for(H of F){if(H.status!==z.COMPLETED){var H=null;break a}F=[];for(const B of H.parts){if(!B){H=null;break a}F.push(new u.ServiceAssetPart(B.url,B.hash))}A.push(new u.ServiceAsset(H.name,H.mimeType,F))}H=A}return H?f.createWithExternalSource(G,H,{extent:C,transform:D,vertexSpace:E}):f.createIncomplete(G,{extent:C,transform:D,vertexSpace:E})}
function t({attributes:D},C,{transformFieldRoles:E}){const A=D[E.originX],F=D[E.originY];D=D[E.originZ];return{originPoint:new c({x:A,y:F,z:D,spatialReference:C}),originVector:k.fromValues(A,F,D)}}function v(D,{transformFieldRoles:C}){return new h({translation:[D[C.translationX],-D[C.translationZ],D[C.translationY]],rotationAxis:[D[C.rotationX],-D[C.rotationZ],D[C.rotationY]],rotationAngle:D[C.rotationDeg],scale:[D[C.scaleX],D[C.scaleZ],D[C.scaleY]]})}function r(D,C){const E=new Map;for(const F of C){var A=
F.parentGlobalId;if(null==A)continue;const G=F.assetName,I=F.assetType;C=F.assetHash;const H=F.assetURL,B=F.conversionStatus,K=F.seqNo,L=w.getFormatIdMimeType(I,D.supportedFormats);L?(A=d.getOrCreateMapValue(E,A,()=>({projectVertices:F.flags.includes("PROJECT_VERTICES"),files:new Map})),d.getOrCreateMapValue(A.files,G,()=>{a:switch(B){case "COMPLETED":case "SUBMITTED":var J=z.COMPLETED;break a;case "INPROGRESS":J=z.PENDING;break a;default:J=z.FAILED}return{name:G,type:I,mimeType:L,status:J,parts:[]}}).parts[K]=
{hash:C,url:H}):y().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${I}, but it does not list it as a supported type`)}return E}const y=()=>g.getLogger("esri.rest.support.meshFeatureSet");var z;(function(D){D[D.FAILED=0]="FAILED";D[D.PENDING=1]="PENDING";D[D.COMPLETED=2]="COMPLETED"})(z||(z={}));a.assetMapFromAssetMapsJSON=r;a.extractMesh=q;a.meshFeatureSetFromJSON=function(D,C,E){var A=E.features;E.features=[];delete E.geometryType;const F=x.fromJSON(E);F.geometryType=
"mesh";if(!E.assetMaps)return F;const G=r(C,E.assetMaps),I=D.sourceSpatialReference??l.WGS84;E=E.globalIdFieldName;({outFields:D}=D);D=null!=D&&0<D.length?n(D.includes("*")?null:new Set(D)):()=>({});for(const H of A)A=q(H,E,I,C,G),null!=A&&F.features.push(new b({geometry:A,attributes:D(H)}));return F};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/Mesh":function(){define("require ../chunks/tslib.es6 ../core/Error ../core/Loadable ../core/Logger ../core/Promise ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/subclass ../chunks/vec3f64 ./Extent ./Geometry ./Point ./Polygon ./support/axisAngleDegrees ./support/MeshComponent ./support/meshErrors ./support/MeshGeoreferencedRelativeVertexSpace ./support/MeshGeoreferencedVertexSpace ./support/MeshLocalVertexSpace ./support/MeshTransform ./support/MeshVertexAttributes ./support/triangulationUtils ./support/meshUtils/bounds ./support/meshUtils/centerAt ./support/meshUtils/georeference ./support/meshUtils/loadExternal ./support/meshUtils/Metadata ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale ../layers/support/infoFor3D ../support/zipUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O){var U;e={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:D,"georeferenced-relative":z,local:C}};d=U=class extends d.LoadableMixin(m.EsriPromiseMixin(n)){constructor(R){super(R);this.components=null;this.vertexSpace=new D;this.transform=null;this.metadata=new K.Metadata;this.hasZ=!0;this.hasM=!1;this.vertexAttributes=new A.MeshVertexAttributes;this.type="mesh"}initialize(){if(0===this.metadata.externalSources.length||
this.vertexAttributes.position.length)this.loadStatus="loaded";this.when(()=>{this.addHandles(c.watch(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(R=>R.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?0<this.vertexAttributes.position.length&&(!this.components||0<this.components.length):null!=this.metadata.displaySource?.extent}get _transformedExtent(){const {components:R,spatialReference:W,vertexAttributes:N,vertexSpace:V}=
this;var S=N.position;if(0===S.length||R&&0===R.length)return new x({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:W});if("local"===V.type){const {_untransformedExtent:X,transform:ca}=this;return G.getProjectedExtent(X,ca,V,W)}if("georeferenced-relative"===V.type){const {transform:X}=this;S=H.project({positions:S,transform:X,vertexSpace:V,inSpatialReference:W,outSpatialReference:W});return G.getExtentFromPositions(S,W)}return G.getExtentFromPositions(S,W)}get _untransformedExtent(){return G.getExtentFromPositions(this.vertexAttributes.position,
this.spatialReference)}get anchor(){const {vertexSpace:R}=this;if(R.isRelative)return R.getOriginPoint(this.spatialReference);const {center:W,zmin:N}=this._transformedExtent;return new q({x:W.x,y:W.y,z:N,spatialReference:this.spatialReference})}get origin(){const {vertexSpace:R}=this;return R.isRelative?R.getOriginPoint(this.spatialReference):this._transformedExtent.center}get extent(){return this.loaded||null==this.metadata?.displaySource?.extent?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(R){if(!this.loaded)return k.getLogger(this).error("addComponent()",
(new y.MeshNotLoadedError).message);this.components||(this.components=[]);this.components.push(r.from(R));this.notifyChange("components")}removeComponent(R){if(!this.loaded)return k.getLogger(this).error("removeComponent()",(new y.MeshNotLoadedError).message);if(this.components&&(R=this.components.indexOf(R),-1!==R)){this.components.splice(R,1);this.notifyChange("components");return}k.getLogger(this).error("removeComponent()",(new y.ComponentNotFoundError).message)}rotate(R,W,N,V){v.composeAxes(R,
W,N,P);M.rotate(this,P,V);return this}offset(R,W,N,V){if(!this.loaded)return k.getLogger(this).error("offset()",(new y.MeshNotLoadedError).message),this;Z[0]=R;Z[1]=W;Z[2]=N;L.offset(this,Z,V);return this}scale(R,W){if(!this.loaded)return k.getLogger(this).error("scale()",(new y.MeshNotLoadedError).message),this;T.scale(this,R,W);return this}centerAt(R,W){if(!this.loaded)return k.getLogger(this).error("centerAt()",(new y.MeshNotLoadedError).message),this;I.centerAt(this,R,W);return this}load(R){const {metadata:{displaySource:W}}=
this;W&&this.addResolvingPromise(B.loadExternal(this,W,R));return Promise.resolve(this)}addExternalSources(R){this.metadata.externalSources.addMany(R)}updateDisplaySource(R){this.metadata.displaySource=R}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(R){let W=null;if(this.components){const N=new Map,V=new Map;W=this.components.map(S=>S.cloneWithDeduplication(N,V))}R={components:W,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),
vertexSpace:R,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new U(R)}cloneShallow(){return new U({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(R){var W=new Promise((V,S)=>a(["./support/meshUtils/exporters/gltf/gltfexport"],V,S));const N=this.load();
W=await Promise.all([W,N]);({toBinaryGLTF:W}=W[0]);return W(this,R)}get memoryUsage(){let R;R=0+this.vertexAttributes.memoryUsage;if(null!=this.components)for(const W of this.components)R+=W.memoryUsage;return R}_clearSources(){this.metadata.clearSources()}static createBox(R,W){if(!(R instanceof q))return k.getLogger("esri.geometry.Mesh").error(".createBox()",(new y.InvalidLocationError).message),null;R=new U(J.convertUnitGeometry(J.createUnitSizeBox(),R,W));return W?.imageFace&&"all"!==W.imageFace?
J.extractSingleFaceOfBox(R,W.imageFace):R}static createSphere(R,W){return R instanceof q?new U(J.convertUnitGeometry(J.createUnitSizeSphere(W?.densificationFactor||0),R,W)):(k.getLogger("esri.geometry.Mesh").error(".createSphere()",(new y.InvalidLocationError).message),null)}static createCylinder(R,W){return R instanceof q?new U(J.convertUnitGeometry(J.createUnitSizeCylinder(W?.densificationFactor||0),R,W)):(k.getLogger("esri.geometry.Mesh").error(".createCylinder()",(new y.InvalidLocationError).message),
null)}static createPlane(R,W){if(!(R instanceof q))return k.getLogger("esri.geometry.Mesh").error(".createPlane()",(new y.InvalidLocationError).message),null;const N=W?.facing??"up",V=J.convertPlaneSizeParameter(N,W?.size);return new U(J.convertUnitGeometry(J.createUnitSizePlane(N),R,{...W,size:V}))}static createFromPolygon(R,W){if(!(R instanceof t))return k.getLogger("esri.geometry.Mesh").error(".createFromPolygon()",(new y.InvalidPolygonError).message),null;const N=F.triangulate(R);return new U({vertexAttributes:new A.MeshVertexAttributes({position:N.position}),
components:[new r({faces:N.faces,shading:"flat",material:W?.material??null})],spatialReference:R.spatialReference,vertexSpace:new D})}static async createFromGLTF(R,W,N){if(!(R instanceof q))throw R=new y.InvalidLocationError,k.getLogger("esri.geometry.Mesh").error(".createfromGLTF()",R.message),R;const {loadGLTFMesh:V}=await f.whenOrAbort(new Promise((S,X)=>a(["./support/meshUtils/loadGLTFMesh"],S,X)),N);return new U(await V(R,W,N))}static async createFromFiles(R,W,N){var V=ca=>k.getLogger("esri.geometry.Mesh").error(".createFromFiles()",
ca.message);if(!(R instanceof q))throw N=new y.InvalidLocationError,V(N),N;const S=N?.layer;if(!S)throw N=new y.NoLayerError,V(N),N;W=await U.extractAndFilterFiles(W,S);const X=W.reduce((ca,ba)=>Q.isFileEditFormat(S.infoFor3D,ba)?ca+1:ca,0);if(0===X)throw N=new y.NoModelError,V(N),N;if(1<X)throw N=new y.MultipleModelsError,V(N),N;V=U.createWithExternalSource(R,W);[V]=await S.uploadAssets([V],N);return V}static async extractAndFilterFiles(R,W){const N=W?.infoFor3D;return N?(await O.extractZipFiles(R)).filter(V=>
Q.isFileSupported(N,V)):R}static createWithExternalSource(R,W,N){var V=N?.extent??null;const {x:S,y:X,z:ca,spatialReference:ba}=R;R=N?.transform?.clone()??new E;N=N?.vertexSpace??new C({origin:[S,X,ca??0]});W={source:W,extent:V};V=new K.Metadata;V.externalSources.push(W);return new U({metadata:V,transform:R,vertexSpace:N,spatialReference:ba})}static createIncomplete(R,W){const {x:N,y:V,z:S,spatialReference:X}=R;R=W?.transform?.clone()??new E;W=W?.vertexSpace??new C({origin:[N,V,S??0]});W=new U({transform:R,
vertexSpace:W,spatialReference:X});W.addResolvingPromise(Promise.reject(new g("mesh-incomplete","Mesh resources are not complete")));return W}};b.__decorate([l.property({type:[r],json:{write:!0}})],d.prototype,"components",void 0);b.__decorate([l.property({nonNullable:!0,types:e,constructOnly:!0,json:{write:!0}})],d.prototype,"vertexSpace",void 0);b.__decorate([l.property({type:E,json:{write:!0}})],d.prototype,"transform",void 0);b.__decorate([l.property({constructOnly:!0})],d.prototype,"metadata",
void 0);b.__decorate([l.property()],d.prototype,"hasExtent",null);b.__decorate([l.property()],d.prototype,"_transformedExtent",null);b.__decorate([l.property()],d.prototype,"_untransformedExtent",null);b.__decorate([l.property()],d.prototype,"anchor",null);b.__decorate([l.property()],d.prototype,"origin",null);b.__decorate([l.property({readOnly:!0,json:{read:!1}})],d.prototype,"extent",null);b.__decorate([l.property({readOnly:!0,json:{read:!1,write:!0,default:!0}})],d.prototype,"hasZ",void 0);b.__decorate([l.property({readOnly:!0,
json:{read:!1,write:!0,default:!1}})],d.prototype,"hasM",void 0);b.__decorate([l.property({type:A.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],d.prototype,"vertexAttributes",void 0);d=U=b.__decorate([u.subclass("esri.geometry.Mesh")],d);const Z=w.create(),P=v.create();return d})},"esri/geometry/support/meshErrors":function(){define(["exports","../../core/Error"],function(a,b){class g extends b{constructor(){super("mesh-not-loaded","Mesh must be loaded before applying operations")}}class d extends b{constructor(){super("component-not-found",
"Provided component is not part of the list of components")}}class k extends b{constructor(){super("invalid-polygon","expected polygon to be a Polygon instance")}}class m extends b{constructor(){super("invalid-input:location","Expected location to be a Point instance")}}class f extends b{constructor(){super("invalid-input:no-layer","A layer is needed to convert the files")}}class c extends b{constructor(){super("invalid-input:no-model","No supported model found")}}class l extends b{constructor(){super("invalid-input:multiple-models",
"Multiple supported models found")}}a.ComponentNotFoundError=d;a.InvalidLocationError=m;a.InvalidPolygonError=k;a.MeshNotLoadedError=g;a.MultipleModelsError=l;a.NoLayerError=f;a.NoModelError=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/bounds":function(){define(["exports","../../Extent","./georeference"],function(a,b,g){function d(m,f){let c=Infinity,l=Infinity,e=Infinity,p=-Infinity,h=-Infinity,u=-Infinity;const w=m.length;let x=0;for(;x<w;){const n=
m[x++],q=m[x++],t=m[x++];c=Math.min(c,n);l=Math.min(l,q);e=Math.min(e,t);p=Math.max(p,n);h=Math.max(h,q);u=Math.max(u,t)}return new b({xmin:c,ymin:l,zmin:e,xmax:p,ymax:h,zmax:u,spatialReference:f})}let k=null;a.getExtentFromPositions=d;a.getProjectedExtent=function({xmin:m,xmax:f,ymin:c,ymax:l,zmin:e,zmax:p},h,u,w){e??(e=0);p??(p=0);k??(k=new Float64Array(24));const x=k;x[0]=m;x[1]=c;x[2]=e;x[3]=m;x[4]=l;x[5]=e;x[6]=f;x[7]=l;x[8]=e;x[9]=f;x[10]=c;x[11]=e;x[12]=m;x[13]=c;x[14]=p;x[15]=m;x[16]=l;x[17]=
p;x[18]=f;x[19]=l;x[20]=p;x[21]=f;x[22]=c;x[23]=p;g.project({positions:x,transform:h,vertexSpace:u,inSpatialReference:w,outSpatialReference:w,outPositions:x});return d(x,w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/centerAt":function(){define("exports ../../../core/Logger ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection/projectPointToVector ./geographicUtils ./georeference".split(" "),function(a,b,g,d,k,m,f){const c=d.create(),l=
d.create(),e=d.create();a.centerAt=function(p,h,u){if(p.vertexAttributes?.position){var {vertexSpace:w}=p,x=u?.origin??p.origin;if(w.isRelative)m.validateGeographicFlag(w,"esri.geometry.support.meshUtils.centerAt",u),{vertexSpace:u}=p,u.isRelative&&(k.projectPointToVector(h,c,p.spatialReference)?(k.projectPointToVector(x,l,p.spatialReference)||(h=p.origin,l[0]=h.x,l[1]=h.y,l[2]=h.z,b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project specified origin (wkid:${x.spatialReference.wkid}) to mesh spatial reference (wkid:${p.spatialReference.wkid}). `+
"Projection may be possible after calling projection.load().")),p=g.subtract(e,c,l),x=u.origin,u.origin=g.add(d.create(),x,p)):b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project centerAt location (wkid:${h.spatialReference.wkid}) to mesh spatial reference (wkid:${p.spatialReference.wkid}). `+"Projection may be possible after calling projection.load()."));else if(m.isGeographicMesh(p.spatialReference,u)){x=f.ungeoreference(p.vertexAttributes,x,{geographic:!0});const {position:n,
normal:q,tangent:t}=f.georeference(x,h,{geographic:!0});p.vertexAttributes.position=n;p.vertexAttributes.normal=q;p.vertexAttributes.tangent=t;p.vertexAttributesChanged()}else if(k.projectPointToVector(h,c,p.spatialReference)){k.projectPointToVector(x,l,p.spatialReference)||(h=p.origin,l[0]=h.x,l[1]=h.y,l[2]=h.z,b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project specified origin (wkid:${x.spatialReference.wkid}) to mesh spatial reference (wkid:${p.spatialReference.wkid}). `+
"Projection may be possible after calling projection.load()."));if(x=p.vertexAttributes.position)for(h=0;h<x.length;h+=3)for(u=0;3>u;u++)x[h+u]+=c[u]-l[u];p.vertexAttributesChanged()}else b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project centerAt location (wkid:${h.spatialReference.wkid}) to mesh spatial reference (wkid:${p.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/meshUtils/loadExternal":function(){define("require exports ../../../assets ../../../request ../../../core/Error ../../../core/has ../../../core/promiseUtils ../../../core/urlUtils ../../Point ../../../views/3d/webgl-engine/lib/basicInterfaces".split(" "),function(a,b,g,d,k,m,f,c,l,e){function p(D){const C=c.removeFile(D.url);return E=>{var A=c.makeRelative(E,C,C);return((A=A?A.replace(/^ *\.\//,""):null)?D.files.get(A):null)??E}}async function h(D,C){if(Array.isArray(D)){if(!D.length)throw new k("mesh-load-external:missing-assets",
"There must be at least one file to load");return D[0]instanceof File?w(D):x(D,C)}return z.fromBlob(D,q(D.name,D.type))}async function u(D,C){const {parts:E,assetMimeType:A,assetName:F}=D;if(1===E.length)return new z(E[0].partUrl);D=await D.toBlob(C);f.throwIfAborted(C);return z.fromBlob(D,q(F,A))}function w(D){D=D.map(C=>({name:C.name,mimeType:C.type,source:z.fromBlob(C,q(C.name,C.type))}));return n(D)}async function x(D,C){D=await f.allSettledValues(D.map(async E=>{const A=await u(E);f.throwIfAborted(C);
return{name:E.assetName,mimeType:E.assetMimeType,source:A}}));if(f.isAborted(C))throw D.forEach(E=>E.source.dispose()),f.createAbortError();return n(D)}function n(D){const C=new Map;let E=null,A=void 0;for(const {name:F,mimeType:G,source:I}of D){if(null===E)if(t.test(G)||r.test(F))E=I.url,A="gltf";else if(v.test(G)||y.test(F))E=I.url,A="glb";C.set(F,I.url);I.files.forEach((H,B)=>C.set(B,H))}if(null==E)throw new k("mesh-load-external:missing-files","Missing files to load external mesh source");return new z(E,
()=>D.forEach(({source:F})=>F.dispose()),C,A)}function q(D,C){return t.test(C)||r.test(D)?"gltf":v.test(C)||r.test(D)?"glb":void 0}const t=/^model\/gltf\+json$/,v=/^model\/gltf-binary$/,r=/\.gltf$/i,y=/\.glb$/i;class z{constructor(D,C=()=>{},E=new Map,A){this.url=D;this.dispose=C;this.files=E;this.type=A}static fromBlob(D,C){const E=URL.createObjectURL(D);return new z(E,()=>URL.revokeObjectURL(E),void 0,C)}}b.loadExternal=async function(D,C,E){({source:C}=C);const {loadGLTFMesh:A}=await f.whenOrAbort(new Promise((H,
B)=>a(["./loadGLTFMesh"],H,B)),E),F=await h(C,E);f.throwIfAborted(E);E=A(new l({x:0,y:0,z:0,spatialReference:D.spatialReference}),F.url,{resolveFile:p(F),requestFile:void 0,useTransform:!0,signal:E?.signal,expectedType:F.type});E.then(()=>F.dispose(),()=>F.dispose());const {vertexAttributes:G,components:I}=await E;D.vertexAttributes=G;D.components=I};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/Metadata":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ./External".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){a.Metadata=class extends g.Clonable{constructor(){super();this.externalSources=new d;this._explicitDisplaySource=null;this.addHandles(k.on(()=>this.externalSources,"after-remove",({item:h})=>{h===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(h){if(null!=h&&!p.isDisplayExternal(h))throw Error("Cannot use this source for display: it is not in a supported format.");
(this._explicitDisplaySource=h)&&this.externalSources.every(u=>!p.externalSourcesAreEqual(u,h))&&this.externalSources.add(h)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(h){return this.externalSources.items.filter(u=>p.externalIsOnService(u,h))}get _implicitDisplaySource(){return this.externalSources.find(p.isDisplayExternal)}};b.__decorate([m.property()],a.Metadata.prototype,"externalSources",void 0);b.__decorate([m.property()],a.Metadata.prototype,"displaySource",
null);b.__decorate([m.property()],a.Metadata.prototype,"_implicitDisplaySource",null);b.__decorate([m.property()],a.Metadata.prototype,"_explicitDisplaySource",void 0);a.Metadata=b.__decorate([e.subclass("esri.geometry.support.meshUtils.Metadata")],a.Metadata);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/offset":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ./geographicUtils ./projection".split(" "),
function(a,b,g,d,k,m,f,c,l,e){function p(x,n){if(x)for(let q=0;q<x.length;q+=3)for(let t=0;3>t;t++)x[q+t]+=n[t]}const h=m.create(),u=d.create(),w=g.create();a.offset=function(x,n,q){if(x.vertexAttributes?.position){var {vertexSpace:t}=x;if(t.isRelative)l.validateGeographicFlag(t,"esri.geometry.support.meshUtils.offset",q),x=t.origin,t.origin=k.add(m.create(),x,n);else{if(l.isGeographicMesh(x.spatialReference,q)){t=x.spatialReference;q=x.vertexAttributes.position;const v=x.vertexAttributes.normal,
r=x.vertexAttributes.tangent,y=new Float64Array(q.length),z=null!=v?new Float32Array(v.length):null,D=null!=r?new Float32Array(r.length):null,C=x.extent.center;c.computeTranslationToOriginAndRotation(t,[C.x,C.y,C.z],u,f.getSphericalPCPF(t));b.fromMat4(w,u);k.transformMat3(h,n,w);e.projectToPCPF(q,t,y);null!=v&&null!=z&&e.projectNormalToPCPF(v,q,y,t,z);null!=r&&null!=D&&e.projectTangentToPCPF(r,q,y,t,D);p(y,h);e.projectFromPCPF(y,q,t);null!=v&&null!=z&&e.projectNormalFromPCPF(z,q,y,t,v);null!=r&&null!=
D&&e.projectTangentFromPCPF(D,q,y,t,r)}else p(x.vertexAttributes.position,n);x.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/primitives":function(){define("exports ../../../chunks/mat3f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../MeshComponent ../MeshVertexAttributes ./georeference".split(" "),function(a,b,g,d,k,m,f){var c=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],l=[0,0,1,0,0,1,0,0,1,0,0,1],e=[0,1,1,1,1,0,0,0],p=[0,
1,2,0,2,3],h={east:[3,1,2],west:[-3,-1,2],north:[-1,3,2],south:[1,-3,2],up:[1,2,3],down:[1,-2,-3]};const u={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],
uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},w={south:0,east:1,north:2,west:3,up:4,down:5},x=d.create(),n=b.create();a.boxFaceOrder=w;a.convertPlaneSizeParameter=function(q,t){const v="number"===typeof t?t:null!=t?t.width:1;t="number"===typeof t?t:null!=t?t.height:1;switch(q){case "up":case "down":return{width:v,depth:t};case "north":case "south":return{width:v,height:t};case "east":case "west":return{depth:v,height:t}}};
a.convertUnitGeometry=function(q,t,v){if(!q.isPlane)for(var r=0;r<q.position.length;r+=3)q.position[r+2]+=.5;r=v?.size;if(null!=r){r="number"===typeof r?[r,r,r]:[null!=r.width?r.width:1,null!=r.depth?r.depth:1,null!=r.height?r.height:1];n[0]=r[0];n[4]=r[1];n[8]=r[2];for(var y=0;y<q.position.length;y+=3){for(var z=0;3>z;z++)x[z]=q.position[y+z];g.transformMat3(x,x,n);for(z=0;3>z;z++)q.position[y+z]=x[z]}if(r[0]!==r[1]||r[1]!==r[2])for(n[0]=1/r[0],n[4]=1/r[1],n[8]=1/r[2],r=0;r<q.normal.length;r+=3){for(y=
0;3>y;y++)x[y]=q.normal[r+y];g.transformMat3(x,x,n);g.normalize(x,x);for(y=0;3>y;y++)q.normal[r+y]=x[y]}}const {vertexAttributes:D,vertexSpace:C,transform:E}=f.georeferenceByTransform(q,t,v);return{vertexAttributes:new m.MeshVertexAttributes({...D,uv:q.uv}),vertexSpace:C,transform:E,components:[new k({faces:q.faces,material:v?.material||null})],spatialReference:t.spatialReference}};a.createUnitSizeBox=function(){const {faceDescriptions:q,faceVertexOffsets:t,uvScales:v}=u;var r=4*q.length;const y=
new Float64Array(3*r),z=new Float32Array(3*r);r=new Float32Array(2*r);const D=new Uint32Array(6*q.length);let C=0,E=0,A=0,F=0;for(let I=0;I<q.length;I++){const H=q[I];var G=C/3;for(const B of t)D[F++]=G+B;G=H.corners;for(let B=0;4>B;B++){const K=G[B];let L=0;r[A++]=.25*v[B][0]+H.uvOrigin[0];r[A++]=H.uvOrigin[1]-.25*v[B][1];for(let J=0;3>J;J++)0!==H.axis[J]?(y[C++]=.5*H.axis[J],z[E++]=H.axis[J]):(y[C++]=.5*K[L++],z[E++]=0)}}return{position:y,normal:z,uv:r,faces:D}};a.createUnitSizeCylinder=function(q=
0){q=Math.round(16*2**q);var t=4*(q+1)+2*q;const v=new Float64Array(3*t),r=new Float32Array(3*t);t=new Float32Array(2*t);const y=new Uint32Array(12*q);let z=0,D=0,C=0,E=0,A=0;for(let G=0;5>=G;G++){const I=0===G||5===G,H=1>=G||4<=G,B=2===G||4===G,K=I?q-1:q;for(let L=0;L<=K;L++){var F=L/K*2*Math.PI;const J=I?0:.5;x[0]=J*Math.sin(F);x[1]=J*-Math.cos(F);x[2]=2>=G?.5:-.5;for(F=0;3>F;F++)v[z++]=x[F],H?r[D++]=2===F?1>=G?1:-1:0:r[D++]=2===F?0:x[F]/J;t[C++]=(L+(I?.5:0))/q;1>=G?t[C++]=1*G/3:3>=G?t[C++]=(G-
2)/3+1/3:t[C++]=(G-4)/3+2/3;B||0===G||L===q||(5!==G&&(y[E++]=A,y[E++]=A+1,y[E++]=A-q),1!==G&&(y[E++]=A,y[E++]=A-q,y[E++]=A-q-1));A++}}return{position:v,normal:r,uv:t,faces:y}};a.createUnitSizePlane=function(q){q=h[q];const t=new Float64Array(c.length),v=new Float32Array(l.length);let r=0;for(let z=0;4>z;z++){const D=r;for(let C=0;3>C;C++){var y=q[C];const E=Math.abs(y)-1;y=0<=y?1:-1;t[r]=c[D+E]*y;v[r]=l[D+E]*y;r++}}return{position:t,normal:v,uv:new Float32Array(e),faces:new Uint32Array(p),isPlane:!0}};
a.createUnitSizeSphere=function(q=0){q=Math.round(8*2**q);const t=2*q;var v=(q-1)*(t+1)+2*t;const r=new Float64Array(3*v),y=new Float32Array(3*v);v=new Float32Array(2*v);const z=new Uint32Array((q-1)*t*6);let D=0,C=0,E=0,A=0;for(let I=0;I<=q;I++){var F=I/q*Math.PI+.5*Math.PI;const H=Math.cos(F);x[2]=Math.sin(F);const B=(F=0===I||I===q)?t-1:t;for(let K=0;K<=B;K++){var G=K/B*2*Math.PI;x[0]=-Math.sin(G)*H;x[1]=Math.cos(G)*H;for(G=0;3>G;G++)r[D]=.5*x[G],y[D]=x[G],++D;v[C++]=(K+(F?.5:0))/t;v[C++]=I/q;
0!==I&&K!==t&&(I!==q&&(z[E++]=A,z[E++]=A+1,z[E++]=A-t),1!==I&&(z[E++]=A,z[E++]=A-t,z[E++]=A-t-1));A++}}return{position:r,normal:y,uv:v,faces:z}};a.extractSingleFaceOfBox=function(q,t){const v=q.components[0];var r=v.faces,y=w[t],z=6*y;t=Array(6);const D=Array(r.length-6);var C=0;let E=0;for(let A=0;A<r.length;A++)A>=z&&A<z+6?t[C++]=r[A]:D[E++]=r[A];if(null!=q.vertexAttributes.uv){r=new Float32Array(q.vertexAttributes.uv);y*=8;z=[0,1,1,1,1,0,0,0];for(C=0;C<z.length;C++)r[y+C]=z[C];q.vertexAttributes.uv=
r}q.components=[new k({faces:t,material:v.material}),new k({faces:D})];return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/rotate":function(){define("exports ../../../core/Logger ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectPointToVector ../axisAngleDegrees ../MeshTransform ./geographicUtils ./projection".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x){function n(D,C,E,A=c.ZEROS){if(null!=D)for(k.fromRotation(r,h.angleRad(C),h.axis(C)),C=0;C<D.length;C+=E){for(var F=0;3>F;F++)q[F]=D[C+F]-A[F];f.transformMat4(q,q,r);for(F=0;3>F;F++)D[C+F]=q[F]+A[F]}}const q=c.create(),t=c.create(),v=h.create(),r=m.create(),y=d.create(),z=c.create();a.rotate=function(D,C,E){if(D.vertexAttributes?.position&&0!==C[3]){var {spatialReference:A,vertexSpace:F}=D;if(F.isRelative){w.validateGeographicFlag(F,"esri.geometry.support.meshUtils.rotate",
E);E=E?.origin??D.origin;D.transform??(D.transform=new u);D=D.transform;var G=F.origin;E=f.set(q,E.x,E.y,E.z??0);E=f.subtract(q,E,G);D.applyLocalInverse(E,t);D.rotation=h.compose(D.rotation,C,h.create());D.applyLocalInverse(E,E);f.subtract(E,E,t);D.translation=f.add(c.create(),D.translation,E)}else{G=E?.origin??D.origin;if(w.isGeographicMesh(A,E)){var I=G;E=D.spatialReference;G=l.getSphericalPCPF(E);p.projectPointToVector(I,z,G)||p.projectPointToVector(D.origin,z,G);I=D.vertexAttributes.position;
const H=D.vertexAttributes.normal,B=D.vertexAttributes.tangent,K=new Float64Array(I.length),L=null!=H?new Float32Array(H.length):null,J=null!=B?new Float32Array(B.length):null;e.computeTranslationToOriginAndRotation(G,z,r,G);g.fromMat4(y,r);f.transformMat3(h.axis(v),h.axis(C),y);v[3]=C[3];x.projectToPCPF(I,E,K);null!=H&&null!=L&&x.projectNormalToPCPF(H,I,K,E,L);null!=B&&null!=J&&x.projectTangentToPCPF(B,I,K,E,J);n(K,v,3,z);x.projectFromPCPF(K,I,E);null!=H&&null!=L&&(n(L,v,3),x.projectNormalFromPCPF(L,
I,K,E,H));null!=B&&null!=J&&(n(J,v,4),x.projectTangentFromPCPF(J,I,K,E,B))}else E=G,p.projectPointToVector(E,z,D.spatialReference)||(G=D.origin,z[0]=G.x,z[1]=G.y,z[2]=G.z,b.getLogger("esri.geometry.support.meshUtils.rotate").error(`Failed to project specified origin (wkid:${E.spatialReference.wkid}) to mesh spatial reference (wkid:${D.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")),n(D.vertexAttributes.position,C,3,z),n(D.vertexAttributes.normal,C,3),n(D.vertexAttributes.tangent,
C,4);D.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/scale":function(){define("exports ../../../core/Logger ../../../chunks/vec3 ../../../chunks/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/projectPointToVector ../MeshTransform ./geographicUtils ./projection".split(" "),function(a,b,g,d,k,m,f,c,l){function e(w,x,n=d.ZEROS){if(w)for(let t=0;t<w.length;t+=3){for(var q=0;3>q;q++)p[q]=w[t+q]-n[q];g.scale(p,
p,x);for(q=0;3>q;q++)w[t+q]=p[q]+n[q]}}const p=d.create(),h=d.create(),u=d.create();a.scale=function(w,x,n){if(w.vertexAttributes?.position){var {spatialReference:q,vertexSpace:t}=w;if(t.isRelative){c.validateGeographicFlag(t,"esri.geometry.support.meshUtils.scale",n);var v=n?.origin??w.origin;w.transform??(w.transform=new f);w=w.transform;n=t.origin;v=g.set(p,v.x,v.y,v.z);v=g.subtract(p,v,n);w.applyLocalInverse(v,h);x=g.scale(d.create(),w.scale,x);w.scale=x;w.applyLocalInverse(v,v);g.subtract(v,
v,h);w.translation=g.add(d.create(),w.translation,v)}else{v=c.isGeographicMesh(q,n);n=n?.origin??w.origin;if(v){v=w.spatialReference;var r=k.getSphericalPCPF(v);m.projectPointToVector(n,u,r)||m.projectPointToVector(w.origin,u,r);n=w.vertexAttributes.position;r=w.vertexAttributes.normal;const y=w.vertexAttributes.tangent,z=new Float64Array(n.length),D=null!=r?new Float32Array(r.length):null,C=null!=y?new Float32Array(y.length):null;l.projectToPCPF(n,v,z);null!=r&&null!=D&&l.projectNormalToPCPF(r,n,
z,v,D);null!=y&&null!=C&&l.projectTangentToPCPF(y,n,z,v,C);e(z,x,u);l.projectFromPCPF(z,n,v);null!=r&&null!=D&&l.projectNormalFromPCPF(D,n,z,v,r);null!=y&&null!=C&&l.projectTangentFromPCPF(C,n,z,v,y)}else v=n,m.projectPointToVector(v,u,w.spatialReference)||(n=w.origin,u[0]=n.x,u[1]=n.y,u[2]=n.z,b.getLogger("esri.geometry.support.meshUtils.scale").error(`Failed to project specified origin (wkid:${v.spatialReference.wkid}) to mesh spatial reference (wkid:${w.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")),
e(w.vertexAttributes.position,x,u);w.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/zipUtils":function(){define(["require","exports"],function(a,b){async function g(d){const {BlobReader:k,ZipReader:m,BlobWriter:f}=await new Promise((l,e)=>a(["./zipjs-wrapper"],l,e)),c=[];d=new k(d);(await (new m(d)).getEntries()).forEach(l=>{if(!l.directory&&!/^__MACOS/i.test(l.filename)){var e=new f;(e=l.getData?.(e).then(p=>new File([p],l.filename)))&&
c.push(e)}});return Promise.all(c)}b.extractZipFile=g;b.extractZipFiles=async function(d){const k=[];for(const m of d)m.name.toLowerCase().endsWith(".zip")?k.push(g(m)):k.push(Promise.resolve(m));return(await Promise.all(k)).flat()};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../core/ByteSizeUnit","../../../../core/Error","../../../../core/promiseUtils"],function(a,b,g,d){function k(c){return new Promise((l,
e)=>{c.oncomplete=()=>l();c.onerror=()=>e(c.error);c.onabort=()=>e(c.error)})}function m(c){return new Promise((l,e)=>{"done"===c.readyState?null!=c.error?e(c.error):l(c.result):(c.onsuccess=()=>l(c.result),c.onerror=()=>e(c.error))})}class f{constructor(c,l,e=14){this._version=e;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=b.ByteSizeUnit.GIGABYTES;this.quotaReductionFactor=.2;this._dbName=c;this._storeName=
l}init(){return Promise.resolve().then(()=>{const c=indexedDB.open(this._dbName,this._version);c.onupgradeneeded=l=>{var e=c.result;const p=c.transaction,h=e.objectStoreNames.contains(this._storeName)?p.objectStore(this._storeName):e.createObjectStore(this._storeName);e=e.objectStoreNames.contains("last_access")?p.objectStore("last_access"):e.createObjectStore("last_access");e.indexNames.contains("date")||e.createIndex("date","date",{unique:!1});e.indexNames.contains("byteSize")||e.createIndex("byteSize",
"byteSize",{unique:!1});l.oldVersion<this._version&&(h.clear(),e.clear())};return m(c)}).then(c=>{this._destroyed?c.close():this._db=c})}destroy(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0}get initialized(){return null!=this._db}getHitRate(){return this._hit/(this._hit+this._miss)}put(c,l){return null==this._db?Promise.reject(new g("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>
this._put(c,l)).catch(e=>{if(e&&"QuotaExceededError"===e.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(p=>this._removeLeastRecentlyAccessed(l.byteSize+Math.ceil(p*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(c,l));throw e;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=
this.gcFrequency,this._getCacheSize().then(e=>this._removeLeastRecentlyAccessed(e-this.maxByteSize)))})}get(c,l){const e=this._db;if(null==e)return Promise.resolve(void 0);let p=null;return Promise.resolve().then(()=>{const h=e.transaction(this._storeName,"readonly");p=d.onAbort(l,()=>{h.abort()});const u=h.objectStore(this._storeName).get(c);return m(u)}).then(h=>{null==h?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),
byteSize:h.byteSize},c));null!=p&&p.remove();return h}).catch(()=>{++this._miss;d.throwIfAborted(l);null!=p&&p.remove()})}remove(c){const l=this._db;return null==l?Promise.resolve():Promise.resolve().then(async()=>{const e=l.transaction([this._storeName,"last_access"],"readwrite");var p=e.objectStore(this._storeName),h=e.objectStore("last_access");p=p.delete(c);h=h.delete(c);await Promise.all([m(p),m(h),k(e)])})}_put(c,l){var e=this._db;if(null==e)return Promise.resolve();e=e.transaction([this._storeName,
"last_access"],"readwrite");var p=e.objectStore(this._storeName);const h=e.objectStore("last_access");p=p.put(l,c);c=h.put({date:Date.now(),byteSize:l.byteSize},c);return Promise.all([m(p),m(c),k(e)])}_removeLeastRecentlyAccessed(c){if(0>=c||!this._db)return Promise.resolve();const l=this._db.transaction([this._storeName,"last_access"],"readwrite"),e=l.objectStore(this._storeName),p=l.objectStore("last_access");let h=0;const u=p.index("date").openCursor(null,"next");u.onsuccess=()=>{const w=u.result;
null!=w&&(null!=w.value.byteSize&&(h+=w.value.byteSize),e.delete(w.primaryKey),p.delete(w.primaryKey),h<c&&w.continue())};return k(l)}_getCacheSize(){var c=this._db;if(null==c)return Promise.resolve(0);c=c.transaction("last_access");let l=0;const e=c.objectStore("last_access").index("byteSize").openKeyCursor();e.onsuccess=()=>{const p=e.result;if(p){var h=p.key;null!=h&&(l+=h);p.continue()}};return k(c).then(()=>l)}}a.IDBCache=f;a.whenRequest=m;a.whenTransaction=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports"],function(a){const b=new WeakMap;class g{constructor(d,k){this._hit=this._miss=0;this.initialized=!0;switch(k){case "layer":this._data=new Map;break;case "view":(k=b.get(d))?this._data=k:(this._data=k=new Map,b.set(d,k))}}init(){return Promise.resolve()}async get(d,k){if(this._data.has(d))return this._hit++,this._data.get(d)??void 0;this._miss++}destroy(){}put(d,k){this._data.set(d,k);return Promise.resolve()}remove(d){this._data.delete(d);
return Promise.resolve()}getHitRate(){return this._hit/(this._hit+this._miss)}}a.IDBMockCache=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/featureEditing":function(){define(["exports","../../../../core/asyncUtils","../../../../core/lang","../../../../layers/support/featureQueryAll"],function(a,b,g,d){function k(u,w,x,n,q=null,t=!0){const v=[];u={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==x,fieldsIndex:u.fieldsIndex,objectIdField:u.objectIdField,
globalIdField:u.globalIdField,featureOrIdentifierList:x};for(const D of w)if(null==D.error){w=D.objectId??-1;x=D.globalId;if(-1===w||t){var r=w;var y=x,z=u;const {gidToFeatureInfo:C,oidToFeatureInfo:E,fieldsIndex:A,objectIdField:F,globalIdField:G,featureOrIdentifierList:I}=z;if(!z.featuresResolved&&null!=I){for(const H of I){const B={feature:null,oid:-1,gid:null};if("attributes"in H){B.feature=H;const K=H.attributes;if(null!=K)for(const L in K){if(-1!==B.oid&&null!=B.gid)break;const J=A.normalizeFieldName(L);
J===F&&(B.oid=K[L]??-1);J===G&&(B.gid=K[L])}}else B.oid=H.objectId??-1,B.gid=H.globalId;null!=B.gid&&C.set(B.gid,B);-1!==B.oid&&E.set(B.oid,B)}z.featuresResolved=!0}r=(-1!==r?E.get(r):null)??(null!=y?C.get(y):null)}else r=null;r=r??{feature:null,oid:w,gid:x};w={oid:-1===w?r.oid:w,gid:x??r.gid,feature:r.feature,result:D};v.push(w);-1===w.oid&&null!=w.gid&&null!=q&&(w.oid=q.get(w.gid)??-1);-1===w.oid&&null!=w.gid&&(x=n.get(w.gid),null==x&&(x=[],n.set(w.gid,x)),x.push(w))}return v}async function m(u,
w){u=u.i3sOverrides.layer.associatedLayer;if(null!=u?.globalIdField){var x=u.createQuery(),{objectIdField:n,globalIdField:q}=u;x.where=Array.from(w.keys()).map(t=>`${q}='${t}'`).join(" OR ");x.returnGeometry=!1;x.outFields=[n,q];x.cacheHint=!1;u=await b.resultOrAbort(d.queryAllJSON(u,x));if(u.ok){u=u.value.features;for(const t of u)if(x=t.attributes[q],u=t.attributes[n],null!=x&&null!=u&&-1!==u&&(x=w.get(x),null!=x))for(const v of x)v.oid=u}}}function f(u,w){const x=new Map;w=w.adds;if(!w||0===w.length||
null==u.globalIdField)return x;for(const n of w)u=n.oid,w=n.feature,"mesh"===w?.geometry?.type&&x.set(u,w);return x}function c(u,w){const x=w.updates;if(!x||0===x.length)return new h;const n=new h;w=new Map;for(let q=0;q<u.attributeStorageInfo.length;q++)w.set(u.attributeStorageInfo[q].name,q);u.forEachNode((q,t)=>{for(const D of x){if(null==D.feature)continue;const C=D.feature,E=D.oid,A=t.indexOf(E);for(const F in C.attributes){var v=u.fieldsIndex.normalizeFieldName(F);var r=n;var y=q.index,z=r.get(y);
z?r=z:(z=new p,r.set(y,z),r=z);(y=null!=v&&r.get(v))?v=y:(y=[],r.set(v,y),v=y);v.push({featureIndex:A,featureId:E,value:C.attributes[F]})}}});return n}const l={setAttribute(){},rollback(){},commit(){}};var e;(function(u){u[u.EDITING=0]="EDITING";u[u.ROLLED_BACK=1]="ROLLED_BACK";u[u.COMMITTED=2]="COMMITTED"})(e||(e={}));const p=Map,h=Map;a.createInteractiveEditSession=function(u,w){const x=w.attributes[u.objectIdField];if(null==x)return l;var n=u.sessions.get(x);if(n)return n;const q=g.clone(w.attributes),
t=new Set,v=u.i3sOverrides.createInteractiveEditSession(x),r=new Map;let y=e.EDITING;n={setAttribute(z,D){if(y===e.EDITING){var C=u.fieldsIndex.get(z);if(C){var E=u.attributeStorageInfo.findIndex(G=>G.name===C.name);if(!(0>E)){if(!(z in q))throw Error(`Attribute "${z}" is not an attribute of the edited feature.`);v.setAttribute(E,D);var A=u.attributeStorageInfo[E],F=!1;t.add(z);u.forEachNode((G,I)=>{var H=r.get(G);null==H?(I=I.indexOf(x),r.set(G,I)):I=H;if(-1!==I&&(H=u.getAttributeData(G.index))){const B=
H[A.name];B&&(B[I]=D,u.setAttributeData(G.index,H,w),F=!0)}});F&&u.clearMemCache()}}}},rollback(){if(y===e.EDITING){for(const z of t)this.setAttribute(z,q[z]);v.remove();y=e.ROLLED_BACK;u.sessions.delete(x)}},commit(){y===e.EDITING&&(v.remove(),y=e.COMMITTED,u.sessions.delete(x))}};u.sessions.set(x,n);return n};a.normalizeEditResultsEvent=async function(u,w){const x=new Map,n=k(u,w.addedFeatures,w.edits?.addFeatures,x),q=k(u,w.updatedFeatures,w.edits?.updateFeatures,x);w=k(u,w.deletedFeatures,w.edits?.deleteFeatures,
x,w.globalIdToObjectId,!1);0<x.size&&await m(u,x);return{adds:n.filter(t=>-1!==t.oid),updates:q.filter(t=>-1!==t.oid),deletes:w.filter(t=>-1!==t.oid)}};a.processAttributeEdits=function(u,w){var x=c(u,w);w=f(u,w);if(0!==x.size||0!==w.size){var n=new Map;for(var q=0;q<u.attributeStorageInfo.length;q++)n.set(u.attributeStorageInfo[q].name,q);var t=!1;x.forEach((D,C)=>{const E=u.getAttributeData(C);let A=!1;D.forEach((F,G)=>{const I=null!=E?E[G]:null;G=n.get(G);for(const {featureIndex:H,value:B,featureId:K}of F)I&&
(I[H]=B,t=A=!0),u.i3sOverrides.updateAttributeValue(K,G,B)});A&&u.setAttributeData(C,E,null)});t&&u.clearMemCache();var {fieldsIndex:v,i3sOverrides:r,objectIdField:y,globalIdField:z}=u;x=r.layer.associatedLayer?.infoFor3D;x=new Set(x?[...Object.values(x.assetMapFieldRoles),...Object.values(x.transformFieldRoles)]:[]);for(const [D,C]of w){r.featureAdded(D);({attributes:w}=C);for(const E in w)E!==y&&E!==z&&x.has(E)||(q=v.normalizeFieldName(E),q=null!=q?n.get(q):null,null!=q&&r.updateAttributeValue(D,
q,w[E]))}}};a.processGeometryEdits=function(u,w){const x=new Map;var n=w.adds,q=w.updates;w=w.deletes;if(0<n.length)for(var t of n){n=t.oid;const v=t.feature;"mesh"===v?.geometry?.type&&x.set(n,v.geometry)}if(0<q.length)for(const v of q)q=v.oid,t=v.feature,"mesh"===t?.geometry?.type&&x.set(q,t.geometry);if(0<w.length)for(const v of w)x.set(v.oid,null);for(const [v,r]of x)u.i3sOverrides.updateGeometry(v,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybeUpdating ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ../../../../geometry/support/Ellipsoid ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B){function K(S,X,ca){if(null==X)return null;if("disjoint"===ca&&"polygon"===X.type){ca=X.rings.length;const ba=X.spatialReference,ia=Array(ca);for(let Y=0;Y<ca;++Y){const ea=D.fromValues(Infinity,Infinity,-Infinity,-Infinity);D.expandWithNestedArray(ea,X.rings[Y]);ia[Y]={type:"polygon",rings:[X.rings[Y]],spatialReference:ba,cache:{},aabr:ea}}ia.sort((Y,ea)=>Y.aabr[0]-ea.aabr[0]);const ka=new Set,na=new m.PositionHint;for(X=0;X<
ia.length;++X){const Y=ia[X],ea=Y.aabr[0];ka.forEach(fa=>{ea>=fa.aabr[2]?ka.delete(fa):Y.aabr[1]>fa.aabr[3]||Y.aabr[3]<fa.aabr[1]||!S.intersects(Y,fa)||(Y.rings=Y.rings.concat(fa.rings),D.expand(Y.aabr,fa.aabr,Y.aabr),Y.cache={},ka.delete(fa),fa=m.indexOf(ia,fa,ia.length,na),ia.splice(fa,1))});ka.add(Y)}for(const Y of ia)Y.aabr=void 0;return ia}return[X]}function L(S,X,ca,ba,ia){if(X[3]>=.5*(X[2]+t.getReferenceEllipsoid(ba).radius))return!0;const ka=T(S,X,ba);return ca.every(na=>Q(S,na,ka,ia)!==W.DISCARD)}
function J(S,X,ca,ba,ia,ka,na,Y){const ea=na[0].spatialReference||ia.spatialReference;if(r.projectBoundingSphere(ca.node.mbs,ka,N,ea)){ka=T(S,N,ea);var fa=M(Y,ia,ea,ba,ca.objectHandle);for(const aa of na){if(0===X.length)break;switch(Q(S,aa,ka,Y)){case W.DISCARD:X.length=0;return;case W.KEEP:continue}H.filterInPlace(X,ca.featureIds,da=>Z(S,aa,da,fa))}}else P.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function M(S,X,ca,ba,ia){X=X.renderSpatialReference;
const ka=new Map,na={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:ca};na.rings[0][3]=na.rings[0][0];let Y,ea;switch(S){case "intersects":Y=(fa,aa,da)=>fa.intersects(aa,da)?W.KEEP:W.TEST;ea=O;break;case "contains":Y=(fa,aa,da)=>fa.contains(aa,da)?W.TEST:W.DISCARD;ea=O;break;default:Y=(fa,aa,da)=>fa.disjoint(aa,da)?W.TEST:W.DISCARD,ea=U}return{collection:ba,object:ia,type:S,maskSR:ca,renderSR:X,aabbCache:ka,triangle:na,positions:{indices:null,data:null,stride:0,startIndex:0,
endIndex:0},triangleTest:Y,geometryTest:ea}}function T(S,X,ca){const ba={type:"point",x:X[0],y:X[1],hasZ:!1,hasM:!1,spatialReference:ca};ca=!A.isWGS84(ca)&&!A.isWebMercator(ca);X=Number.isNaN(X[3])?0:c.clamp(X[3],0,2*E.earth.radius);S=ca?S.buffer(ba,X,1):S.geodesicBuffer(ba,X,1);S.type="polygon";return S}function Q(S,X,ca,ba){switch(ba){case "intersects":case "contains":return O(S,X,ca);case "disjoint":return U(S,X,ca)}}function O(S,X,ca){return S.intersects(X,ca)?S.contains(X,ca)?W.KEEP:W.TEST:W.DISCARD}
function U(S,X,ca){return S.intersects(X,ca)?S.contains(X,ca)?W.DISCARD:W.TEST:W.KEEP}function Z(S,X,ca,ba){const {collection:ia,object:ka,renderSR:na,maskSR:Y,geometryTest:ea,aabbCache:fa}=ba;var aa=fa.get(ca);if(!aa){aa=ia.getObjectTransform(ka);ia.getComponentAabb(ka,ca,V);var da=[[V[0],V[1],0],[V[0],V[4],0],[V[3],V[4],0],[V[3],V[1],0]];for(var ma=0;4>ma;++ma)n.transformMat3(da[ma],da[ma],aa.rotationScale),n.add(da[ma],da[ma],aa.position),y.projectVectorToVector(da[ma],na,da[ma],Y);aa={type:"polygon",
rings:[da],spatialReference:Y,cache:{}};aa.rings[0][4]=aa.rings[0][0];fa.set(ca,aa)}switch(ea(S,X,aa)){case W.DISCARD:return!1;case W.KEEP:return!0}const {triangle:ua,triangleTest:sa,positions:ra}=ba;aa=ua.rings[0][0];da=ua.rings[0][1];ma=ua.rings[0][2];const Aa=ia.getObjectTransform(ka);ia.getComponentPositions(ka,ca,ra);const {indices:qa,data:la,stride:ja,startIndex:oa,endIndex:za}=ra;for(ca=oa;ca<za;ca+=3){const ta=ja*qa[ca],Ca=ja*qa[ca+1],Ga=ja*qa[ca+2];n.set(aa,la[ta],la[ta+1],la[ta+2]);n.set(da,
la[Ca],la[Ca+1],la[Ca+2]);n.set(ma,la[Ga],la[Ga+1],la[Ga+2]);n.transformMat3(aa,aa,Aa.rotationScale);n.transformMat3(da,da,Aa.rotationScale);n.transformMat3(ma,ma,Aa.rotationScale);n.add(aa,aa,Aa.position);n.add(da,da,Aa.position);n.add(ma,ma,Aa.position);y.projectVectorToVector(aa,na,aa,Y);y.projectVectorToVector(da,na,da,Y);y.projectVectorToVector(ma,na,ma,Y);switch(sa(S,X,ua)){case W.DISCARD:return!1;case W.KEEP:return!0}}switch(ba.type){case "intersects":return!1;default:return!0}}const P=f.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");
b.I3SMeshViewFilter=class extends k{constructor(S){super(S);this._projectionEngineLoaded=!1}initialize(){e.whenOnce(()=>this.viewFilter?.geometry||null!=this.layerFilter).then(()=>this.loadAsyncModule((new Promise((S,X)=>a(["../../../../geometry/geometryEngine"],S,X))).then(S=>{this.destroyed||(this._geometryEngine=S)})))}get sortedObjectIds(){if(null==this.viewFilter?.objectIds)return null;const S=C.doubleArrayFrom(this.viewFilter.objectIds);S.sort();return S}get parsedWhereClause(){const S=null!=
this.viewFilter?this.viewFilter.where:null;if(null==S||!S)return null;try{return q.WhereClause.create(S,this.layerFieldsIndex)}catch(X){P.error(`Failed to parse filter where clause: ${X}`)}return null}addFilters(S,X,ca,ba){const ia=this.sortedObjectIds;null!=ia&&S.push(ea=>H.objectIdFilter(ia,!0,ea));this.addSqlFilter(S,this.parsedWhereClause);const ka=l.unwrapUpdating(this._layerMaskGeometries),na=this._geometryEngine;if(null!=ka&&null!=this.layerFilter&&null!=na){const ea=this.layerFilter.spatialRelationship;
S.push((fa,aa)=>J(na,fa,aa,ba,X,ca,ka,ea))}const Y=l.unwrapUpdating(this._viewMaskGeometries);if(null!=Y&&null!=this.viewFilter&&null!=na){const ea=this.viewFilter.spatialRelationship;S.push((fa,aa)=>J(na,fa,aa,ba,X,ca,Y,ea))}}isMBSGeometryVisible(S,X,ca){var ba=l.unwrapUpdating(this._layerMaskGeometries);const ia=this._geometryEngine;if(null!=ba&&null!=this.layerFilter&&null!=ia){var ka=this.layerFilter.spatialRelationship;X=ba[0].spatialReference||X;return r.projectBoundingSphere(S,ca,N,X)?L(ia,
N,ba,X,ka):(P.warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}ba=l.unwrapUpdating(this._viewMaskGeometries);return null!=ba&&null!=this.viewFilter&&null!=ia?(ka=this.viewFilter.spatialRelationship,X=ba[0].spatialReference||X,r.projectBoundingSphere(S,ca,N,X)?L(ia,N,ba,X,ka):(P.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)):!0}get parsedGeometry(){const S=l.unwrapUpdating(this._viewMaskGeometries),
X=l.unwrapUpdating(this._layerMaskGeometries);return null==S||null==X?S||X:X.concat(S)}get _layerMaskGeometries(){const S=this.layerFilter;return null==S?null:null==this._geometryEngine?l.updating:"disjoint"===S.spatialRelationship?S.geometries.map(X=>({type:"polygon",rings:X.rings,spatialReference:X.spatialReference,cache:{}})):[S.geometries.reduce((X,ca)=>{X.rings=[...X.rings,...ca.rings];return X},{type:"polygon",rings:[],spatialReference:S.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if(null==
this.viewFilter)return null;var {geometry:S}=this.viewFilter;if(null==S)return null;if(null==this.viewFilter||null==this._geometryEngine)return l.updating;const {distance:X,units:ca}=this.viewFilter,ba=this.viewFilter.spatialRelationship;S="mesh"===S.type?S.extent:S;if(null==X||0===X)return K(this._geometryEngine,S,ba);const ia=ca||p.getUnitString(S.spatialReference);if(S.spatialReference.isWGS84)return S=this._geometryEngine.geodesicBuffer(S,X,ia),K(this._geometryEngine,S,ba);var ka=G.project(S,
B.WGS84);if(null!=ka)return S=G.project(this._geometryEngine.geodesicBuffer(ka,X,ia),S.spatialReference),K(this._geometryEngine,S,ba);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(v.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;ka=null;try{ka=v.project(S,B.WGS84)}catch(na){}if(ka)try{ka=v.project(this._geometryEngine.geodesicBuffer(ka,X,ia),S.spatialReference)}catch(na){ka=null}ka||P.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${S.spatialReference.wkid}) to WGS84.`);
return K(this._geometryEngine,ka,ba)}get updating(){return l.isUpdating(this._layerMaskGeometries)||l.isUpdating(this._viewMaskGeometries)}static checkSupport(S){if(null==S)return!1;if(S.timeExtent)return P.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;S=S.spatialRelationship;return null!=S&&R.includes(S)?!0:(P.warn(`Filters with spatialRelationship other than ${R.join(", ")} are not supported for mesh scene layers`),!1)}};g.__decorate([h.property()],b.I3SMeshViewFilter.prototype,
"layerFilter",void 0);g.__decorate([h.property({type:I})],b.I3SMeshViewFilter.prototype,"viewFilter",void 0);g.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);g.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);g.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);g.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"sortedObjectIds",null);g.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,
"parsedWhereClause",null);g.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedGeometry",null);g.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);g.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);g.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"updating",null);g.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);g.__decorate([h.property()],
b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);b.I3SMeshViewFilter=g.__decorate([x.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);const R=["contains","intersects","disjoint"];var W;(function(S){S[S.KEEP=0]="KEEP";S[S.DISCARD=1]="DISCARD";S[S.TEST=2]="TEST"})(W||(W={}));const N=F.fromValues(0,0,0,0),V=z.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/maybeUpdating":function(){define(["exports"],function(a){a.isUpdating=function(b){return"updating"===
b};a.unwrapUpdating=function(b){return"updating"===b?null:b};a.updating="updating";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n){const q=u.QueryEngine;a.I3SQueryEngine=class extends g{get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return(new n({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(t){super(t)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance=
k.destroyMaybe(this._dataQueryEngineInstance);this._set("layerView",null)}async executeQueryForCount(t,v){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),v)}async executeQueryForExtent(t,v){const {count:r,extent:y}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),v);t=p.fromJSON(y);return{count:r,extent:t}}async executeQueryForIds(t,v){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),v)}async executeQuery(t,v){t=this._ensureQueryJSON(t);
if(t.returnGeometry)throw new d("unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(t.returnCentroid)throw new d("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");v=await this._dataQueryEngine.executeQuery(t,v);v=x.fromJSON(v);v.features.forEach(r=>{r.geometry=null});return v}_ensureQueryJSON(t){return null==t?this.defaultQueryJSON:t.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const t=this.layer.objectIdField||h.fallbackObjectIDAttribute,v=this.layer.fieldsIndex?.toJSON()||new w([]),r=this.layerView.view.resourceController.scheduler,y=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new q({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:v,timeInfo:null,spatialReference:y,objectIdField:t,featureStore:this.spatialIndex,scheduler:r,priority:this.priority})}};b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",
void 0);b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"spatialReference",null);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"layer",null);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=b.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
a.I3SQueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define(["exports","../../../../geometry/support/aaBoundingBox","../../../../layers/graphics/centroid","../../../../layers/graphics/OptimizedGeometry","./I3SUtil"],function(a,b,g,d,k){class m{constructor(c){this._objectIdField=c.objectIdField;this._getFeatureExtent=c.getFeatureExtent}getObjectId(c){return c.id}getAttributes(c){const {meta:l,index:e}=c,p={};
this._objectIdField&&(p[this._objectIdField]=c.id);c=l.attributeInfo?.attributeData;if(null!=c)for(const h of Object.keys(c))p[h]=k.getCachedAttributeValue(c[h],e);return p}getAttribute(c,l){if(l===this._objectIdField)return c.id;const {meta:e,index:p}=c;c=e.attributeInfo?.attributeData;return null!=c?k.getCachedAttributeValue(c[l],p):null}getGeometry(c){if(c.geometry)return c.geometry;const [l,e,p,h,u]=this._getFeatureExtent(c,f);return new d([5],[l,e,p,h,e,p,h,u,p,l,u,p,l,e,p])}getCentroid(c,l){if(c.geometry)return g.getCentroidOptimizedGeometry(new d,
c.geometry,l.hasZ,l.hasM);const [e,p,h,u,w,x]=this._getFeatureExtent(c,f);return new d([0],[(e+u)/2,(p+w)/2,(h+x)/2])}cloneWithGeometry(c,l){const {id:e,index:p,meta:h}=c;return{id:e,index:p,meta:h,geometry:l}}}const f=b.create();a.I3SQueryFeatureAdapter=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../II3SMeshView3D".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){const x=p.create();a.I3SQueryFeatureStore=class extends g{constructor(v){super(v);this.events=new d}forEach(v){this.forAllFeatures(r=>{v(r);return w.ForAllFeaturesReturnType.CONTINUE})}forEachBounds(v,r){const y=this.getFeatureExtent;for(const z of v)r(y(z,x))}forEachInBounds(v,r){this.forAllFeatures(y=>{const z=this.getFeatureExtent(y,q);h.intersects(v,p.toRect(z,t))&&r(y);return w.ForAllFeaturesReturnType.CONTINUE},y=>{e.projectBoundingSphere(y.node.mbs,this.sourceSpatialReference,
n,this.viewSpatialReference);if(n[0]>=v[0]&&n[2]<=v[2]&&n[1]>=v[1]&&n[3]<=v[3])return w.ForAllFeaturesReturnType.CONTINUE;y=n[0]-Math.max(v[0],Math.min(n[0],v[2]));const z=n[1]-Math.max(v[1],Math.min(n[1],v[3]));return y*y+z*z<=n[3]*n[3]?w.ForAllFeaturesReturnType.CONTINUE:w.ForAllFeaturesReturnType.SKIP})}};b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",
void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=b.__decorate([l.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const n=u.fromValues(0,0,0,0),q=p.create(),
t=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),function(a,b,g,d,k,
m,f,c,l,e){a.DefinitionExpressionSceneLayerView=p=>{p=class extends p{constructor(){super(...arguments);this._definitionExpressionErrors=0;this._maxDefinitionExpressionErrors=20;this.logError=h=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&g.getLogger(this).error("Error while evaluating definitionExpression: "+h);this._definitionExpressionErrors++;this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&g.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;
try{const h=l.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!h.isStandardized)return g.getLogger(this).error("definitionExpression is using non standard function"),null;const u=[];e.findFieldsCaseInsensitive(h.fieldNames,this.i3slayer.fields,{missingFields:u});if(0<u.length)return g.getLogger(this).error(`definitionExpression references unknown fields: ${u.join(", ")}`),null;this._definitionExpressionErrors=0;return h}catch(h){return g.getLogger(this).error("Failed to parse definitionExpression: "+
h),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(h,u){try{return h.testFeature(u)}catch(w){return this.logError(w),!1}}_addDefinitionExpressionToQuery(h){if(!this.parsedDefinitionExpression)return h;const u=this.i3slayer.definitionExpression;h=h.clone();h.where=h.where?`(${u}) AND (${h.where})`:u;return h}};b.__decorate([d.property()],p.prototype,"i3slayer",void 0);b.__decorate([d.property({readOnly:!0})],
p.prototype,"parsedDefinitionExpression",null);b.__decorate([d.property({readOnly:!0})],p.prototype,"definitionExpressionFields",null);return p=b.__decorate([c.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],
readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:g,layer:{fieldsIndex:d},requiredFields:k}=this;return g.outFields?b.fixFields(d,[...b.unpackFieldNames(d,g.outFields),...k]):b.fixFields(d,k)}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/AsyncUpdate ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p){async function h(u){const w=new Set;try{return await u(w),Array.from(w).sort()}catch(x){return k.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields").error(x),null}}a.SceneLayerViewRequiredFields=class extends d.AsyncUpdateMixin(g){get layer(){return this.layerView.layer}get requiredFields(){const {layerView:{layer:{fieldsIndex:u},definitionExpressionFields:w},rendererFields:x,labelingFields:n,viewFilterFields:q}=this;return p.fixFields(u,[...(w??
[]),...(x??[]),...(n??[]),...(q??[])])}constructor(u){super(u)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",async()=>{const {fieldsIndex:u,renderer:w}=this.layer;return w?h(x=>w.collectRequiredFields(x,u)):null}),this.autoUpdateAsync("labelingFields",async()=>{const {layer:u}=this;return u.labelsVisible?h(w=>p.collectLabelingFields(w,u)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:u,filter:w}=this.layerView;return h(x=>p.collectFilterFields(x,u,w))})])}};
b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"layer",null);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",null);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,
"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=b.__decorate([e.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),function(a,
b,g,d,k,m,f,c){function l(h,u){const w=()=>{if(!x||n)return u();x.clear();n=!0;const q=k.runTracked(x,u);n=!1;return q};let x=new c.SimpleTrackingTarget(()=>{x&&!n&&h(w)}),n=!1;h(w);return{remove:()=>{x&&(x.destroy(),x=null)}}}const e=h=>{h=class extends h{constructor(){super(...arguments);this._numUpdating=0;this._asyncUpdateState=new Map}get updating(){return 0<this._numUpdating}autoUpdateAsync(u,w){return l(x=>this._updateAsync(u,x),w)}async _updateAsync(u,w){if(!this._startAsyncUpdate(u)){try{const x=
await w();this._set(u,x)}catch(x){d.getLogger(this).warn(`Async update of "${String(u)}" failed. Async update functions should not throw exceptions.`)}this._endAsyncUpdate(u)&&this._updateAsync(u,w)}}_startAsyncUpdate(u){const w=this._asyncUpdateState.get(u)??p.None;if(w&p.Updating)return this._asyncUpdateState.set(u,w|p.Invalidated),!0;++this._numUpdating;this._asyncUpdateState.set(u,w|p.Updating);return!1}_endAsyncUpdate(u){--this._numUpdating;const w=(this._asyncUpdateState.get(u)??p.None)&~p.Updating;
if(w&p.Invalidated)return this._asyncUpdateState.set(u,w&~p.Invalidated),!0;this._asyncUpdateState.set(u,w);return!1}};b.__decorate([m.property({readOnly:!0})],h.prototype,"updating",null);b.__decorate([m.property()],h.prototype,"_numUpdating",void 0);return h=b.__decorate([f.subclass("esri.core.AsyncUpdate")],h)};var p;(function(h){h[h.None=0]="None";h[h.Updating=1]="Updating";h[h.Invalidated=2]="Invalidated"})(p||(p={}));a.AsyncUpdate=class extends e(g){};a.AsyncUpdate=b.__decorate([f.subclass("esri.core.AsyncUpdate")],
a.AsyncUpdate);a.AsyncUpdateMixin=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/tslib.es6 ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w){const x=d.getLogger("esri.views.layers.SceneLayerView");d=class extends w{constructor(){super(...arguments);this._geometryEngine=this.filter=this.layer=null;this._projectionEngineLoaded=!1;this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(n){throw Error("Not implemented");}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return m.unwrapUpdating(this._layerFilter)}get _layerFilter(){const n=
this.layer?.filter;if(null==n||1>n.geometries.length)return null;const q=this._geometryEngine;if(null==q||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return m.updating;const t=n.geometries.at(0).spatialReference,v=n.geometries.toArray().map(D=>{try{D=q.simplify(D)}catch(C){return x.warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==D)return null;if(D.spatialReference.equals(t))return D;try{return u.project(D,t)}catch(C){return x.warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),
null}}).filter(g.isSome).sort((D,C)=>D.extent.xmin-C.extent.xmin),r=new Set,y=[],z=[];for(let D of v){const C=D.extent.xmin;y.length=0;r.forEach(E=>{C>=E.extent.xmax?(z.push(E),r.delete(E)):D.extent.ymin<=E.extent.ymax&&D.extent.ymax>=E.extent.ymin&&q.intersects(D,E)&&y.push(E)});if(0<y.length){y.push(D);try{D=q.union(y)}catch(E){x.warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}y.pop();y.forEach(E=>r.delete(E))}r.add(D)}r.forEach(D=>z.push(D));return 0<
z.length?{spatialRelationship:n.spatialRelationship,geometries:z}:null}get _filterNeedsProjectionEngine(){const n=this.layer.filter;if(null==n||1>=n.geometries.length)return!1;const q=n.geometries.at(0).spatialReference;return n.geometries.some(({spatialReference:t})=>!t.equals(q)&&!u.canProjectWithoutEngine(t,q))}get layerFilterUpdating(){return m.isUpdating(this._layerFilter)}initialize(){const {signal:n}=this._abortController;c.whenOnce(()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length,
n).then(async()=>{f.throwIfAbortError(n);this._geometryEngine=await new Promise((q,t)=>a(["../../geometry/geometryEngine"],q,t))}).catch(f.throwIfNotAbortError);this._projectionEngineLoaded=u.isLoaded();c.whenOnce(()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine,n).then(async()=>{f.throwIfAbortError(n);await u.load();this._projectionEngineLoaded=!0}).catch(f.throwIfNotAbortError)}destroy(){this._abortController=k.abortMaybe(this._abortController)}highlight(n){throw Error("Not implemented");
}queryFeatures(n,q){throw Error("Not implemented");}queryObjectIds(n,q){throw Error("Not implemented");}queryFeatureCount(n,q){throw Error("Not implemented");}createQuery(){throw Error("Not implemented");}queryExtent(n,q){throw Error("Not implemented");}};b.__decorate([l.property()],d.prototype,"layer",void 0);b.__decorate([l.property()],d.prototype,"availableFields",null);b.__decorate([l.property()],d.prototype,"maximumNumberOfFeatures",null);b.__decorate([l.property({readOnly:!0})],d.prototype,
"maximumNumberOfFeaturesExceeded",null);b.__decorate([l.property()],d.prototype,"filter",void 0);b.__decorate([l.property({readOnly:!0})],d.prototype,"layerFilter",null);b.__decorate([l.property({readOnly:!0})],d.prototype,"_layerFilter",null);b.__decorate([l.property()],d.prototype,"_geometryEngine",void 0);b.__decorate([l.property()],d.prototype,"_projectionEngineLoaded",void 0);b.__decorate([l.property()],d.prototype,"_filterNeedsProjectionEngine",null);b.__decorate([l.property()],d.prototype,
"layerFilterUpdating",null);return d=b.__decorate([h.subclass("esri.views.layers.SceneLayerView")],d)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/typedArrayUtil ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectVectorToVector ../../../geometry/support/contains ../../../geometry/support/DoubleArray ../../../geometry/support/zscale ../../../layers/LayerConstants ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/dehydratedPoint ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ../../../support/basemapUtils ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/featureEditing ./i3s/I3SGraphicsMap ./i3s/I3SOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/Attribute ../webgl-engine/lib/UpdatePolicy ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/Scheduler".split(" "),
function(a,b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S){function X(Y){return"geometryBuffer"in Y&&null!==Y.geometryBuffer}function ca(Y){const ea=Y.attributeInfo,fa=Y.node.index;if(null!=ea?.loadedAttributes&&null!=ea.attributeData)for(let aa=0;aa<Y.graphics.length;aa++){const da=Y.graphics[aa];if(da.nodeIndex===fa){da.attributes||(da.attributes={});for(const {name:ma}of ea.loadedAttributes)ea.attributeData[ma]&&(da.attributes[ma]=J.getCachedAttributeValue(ea.attributeData[ma],
aa))}}}e=T.defineFieldProperties();class ba{constructor(Y,ea,fa,aa){this.graphics=Y;this.featureIds=ea;this.attributeInfo=fa;this.node=aa}}G=class extends M.DefinitionExpressionSceneLayerView(Q.PopupSceneLayerView(G.LayerView3D(N))){constructor(){super(...arguments);this.type="scene-layer-graphics-3d";this._memCache=this._queryEngine=null;this._interactiveEditingSessions=new Map;this._pendingEditsQueue=Promise.resolve();this.loadedGraphics=new K.I3SGraphicsMap((Y,ea,fa)=>{{const aa=ea.attributeInfo;
if(null==aa?.loadedAttributes||null==aa.attributeData)Y=!1;else{ea=!1;for(const {name:da}of aa.loadedAttributes)if(aa.attributeData[da]){const ma=J.getCachedAttributeValue(aa.attributeData[da],fa);ma!==Y.attributes[da]&&(Y.attributes[da]=ma,ea=!0)}Y=ea}}return Y},Y=>this.processor.graphicsCore.recreateGraphics(Y));this.holeFilling="always";this.progressiveLoadFactor=1;this.supportsHeightUnitConversion=!0;this._coordinatesOutsideExtentErrors=0;this._maxCoordinatesOutsideExtentErrors=20}tryRecycleWith(Y,
ea){return Y.url===this.layer.url&&this._i3sOverrides.isEmpty?Y.load(ea).then(()=>{J.checkRecyclable(this.layer,Y,this._i3sOverrides);this.layer=Y;this._i3sOverrides.destroy();this._i3sOverrides=new L.I3SOverrides({view:this.view,layer:Y,memoryController:this.view.resourceController?.memoryController});m.destroyMaybe(this._queryEngine);this._setupQueryEngine();this.processor.resetObjectStates()}):null}initialize(){this.addResolvingPromise(this.layer.indexInfo);this._i3sOverrides=new L.I3SOverrides({view:this.view,
layer:this.layer,memoryController:this.view.resourceController?.memoryController});J.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this._fieldsHelper=new O.SceneLayerViewRequiredFields({layerView:this});this._updatingHandles.add(()=>this.layer.rangeInfos,Y=>this._rangeInfosChanged(Y),f.initial);this._updatingHandles.add(()=>this.layer.renderer,(Y,ea)=>this._rendererChange(Y,ea));this._updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],
()=>this._filterChange());this.addHandles(f.watch(()=>U.debugFlags.I3S_TREE_SHOW_TILES,Y=>{if(Y&&!this._treeDebugger){const ea=this._controller.crsIndex;(new Promise((fa,aa)=>a(["./support/I3STreeDebugger"],fa,aa))).then(({I3STreeDebugger:fa})=>{!this._treeDebugger&&U.debugFlags.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new fa({lv:this,view:this.view,nodeSR:ea}))})}else Y||!this._treeDebugger||U.debugFlags.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},f.initial));this._set("processor",
new I.Graphics3DFeatureProcessor({owner:this,preferredUpdatePolicy:W.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:Y=>this._updateClippingExtent(Y)}));this.processor.elevationAlignment?.events.on("invalidate-elevation",Y=>this._controller.updateElevationChanged(Y.extent,Y.spatialReference));
this.supportsHeightUnitConversion&&(this._verticalScale=t.getGeometryZScaler("point",this.layer.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.processor.initializePromise);this._memCache=this.view.resourceController.memoryController.newCache(`psl-${this.uid}`);this._controller=new D({layerView:this,scaleVisibilityEnabled:!1});J.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new F.I3SPointsWorkerHandle(Y=>this.view.resourceController.immediate.schedule(Y)));
this.addHandles(this.layer.on("apply-edits",Y=>this._updatingHandles.addPromise(Y.result)));this.addHandles(this.layer.on("edits",Y=>{const ea=this._pendingEditsQueue.then(()=>this._handleEdits(Y)).then();this._pendingEditsQueue=ea;this._updatingHandles.addPromise(ea)}));this.when(()=>{this._setupQueryEngine();this._updatingHandles.add(()=>this.maximumNumberOfFeatures,Y=>this._controller.featureTarget=Y,f.initial);this._updatingHandles.add(()=>this.suspended,Y=>{Y&&this._removeAllNodeData()})})}destroy(){this._treeDebugger=
m.destroyMaybe(this._treeDebugger);this._i3sOverrides=m.destroyMaybe(this._i3sOverrides);this._set("processor",m.destroyMaybe(this.processor));this._controller=m.destroyMaybe(this._controller);this._queryEngine=m.destroyMaybe(this._queryEngine);this._worker=m.destroyMaybe(this._worker);this._memCache=m.destroyMaybe(this._memCache);this.loadedGraphics.clear();this._fieldsHelper=m.destroyMaybe(this._fieldsHelper)}get i3slayer(){return this.layer}get updatingProgressValue(){return this._controller?.updatingProgress??
1}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get maximumNumberOfFeatures(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(Y){null!=Y?(this._override("maximumNumberOfFeatures",Y),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return this.suspended?!1:!!this._controller?.useMaximumNumberOfFeatures&&
!this._controller.leavesReached}get _excludeObjectIdsSorted(){const Y=this.layer.excludeObjectIds;return Y.length?Y.toArray().sort((ea,fa)=>ea-fa):null}get lodFactor(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}get hasM(){return!1}get hasZ(){return!0}get contentVisible(){return!this.suspended&&!!this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}async whenGraphicAttributes(Y,ea){return J.whenGraphicAttributes(this.layer,
Y,this._getObjectIdField(),ea,()=>[...this.loadedGraphics.nodes()])}getHit(Y){if(!this.loadedGraphics)return null;const ea=z.hydrateGraphic(this.loadedGraphics.find(aa=>aa.uid===Y),this.layer),fa=this._getObjectIdField();if(!ea?.attributes?.[fa])return null;ea.layer=this.layer;ea.sourceLayer=this.layer;return{type:"graphic",graphic:ea,layer:ea.layer}}whenGraphicBounds(Y,ea){return this.processor.whenGraphicBounds(Y,ea)}computeAttachmentOrigin(Y,ea){return this.processor.computeAttachmentOrigin(Y,
ea)}isUpdating(){return!!(this._controller?.updating||this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)}highlight(Y){return this.processor.highlight(Y,this.layer.objectIdField)}get updatePolicy(){return this.processor.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(Y){return B.createInteractiveEditSession(this._attributeEditingContext,Y)}async _decompressBinaryPointData(Y,ea){Y={geometryBuffer:Y.geometryBuffer};null==this._worker&&(this._worker=new F.I3SPointsWorkerHandle(fa=>
this.view.resourceController.immediate.schedule(fa)));ea=await this._worker.invoke(Y,ea);if(null==ea)throw Error("Failed to decompress Draco point data");return{positionData:ea.positions,featureIds:ea.featureIds}}async addNode(Y,ea,fa){if(!(X(ea)||"pointData"in ea))throw Error();if(this.loadedGraphics.hasNode(Y.index))k.getLogger(this).error("I3S node "+Y.id+" already added");else{if(null!=this.layer.fullExtent){var aa=this.layer.fullExtent.clone();aa.xmin-=.5;aa.ymin-=.5;aa.xmax+=.5;aa.ymax+=.5;
null!=aa.zmin&&null!=aa.zmax&&(aa.zmin-=.5,aa.zmax+=.5);null!=aa.mmin&&null!=aa.mmax&&(aa.mmin-=.5,aa.mmax+=.5)}else aa=null;var da=aa;aa=[];var {featureIds:ma,pointPositions:ua}=X(ea)?await this._extractBinaryPointPositions(Y,ea,fa):this._extractLegacyPointPositions(ea);this._validatePositions(Y,ma,ua,da,aa);var sa=this._controller.crsVertex;w.projectBuffer(ua,sa,0,ua,this.view.spatialReference,0,ma.length);da=X(ea)?Y.level:0;da=this._createGraphics(ma,ua,Y.index,da);da=new ba(da,ma,ea.attributeDataInfo,
Y);await this._i3sOverrides.applyAttributeOverrides(da.featureIds,ea.attributeDataInfo,fa);Y.numFeatures=da.graphics.length;this._updateNodeMemory(Y);ca(da);0<aa.length&&(this._computeObb(Y,aa,sa),this._controller.updateVisibility(Y.index));if(this._controller.isGeometryVisible(Y)){if(null!=this._verticalScale)for(var ra of da.graphics)this._verticalScale(ra.geometry);ea=this.view._stage.renderView.objectAndLayerIdRenderHelper;if(null!=ea)for(fa=A.isBasemapLayer(this.view.map,this.layer.uid),ra=0;ra<
da.featureIds.length;ra++)ea.setUidToObjectAndLayerId(da.featureIds[ra],da.graphics[ra].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled&&!fa&&V.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled),da.node.resources.attributes,ra);this.loadedGraphics.addNode(Y.index,da);this._controller.updateLoadStatus(Y.index,!0);this._filterNode(da);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(da)}}_computeObb(Y,ea,fa){const aa=this._controller.crsIndex,
da=aa.isGeographic?this.view.renderSpatialReference:aa;w.projectBuffer(ea,fa,0,ea,da,0,ea.length/3);Y.serviceObb=Z.compute(new R.Vertices(ea,3));aa.isGeographic&&x.projectVectorToVector(Y.serviceObb.center,da,Y.serviceObb.center,aa)}isNodeLoaded(Y){return this.loadedGraphics.hasNode(Y)}isNodeReloading(){return!1}updateNodeState(){}async _extractBinaryPointPositions(Y,ea,fa){ea=await this._decompressBinaryPointData(ea,fa);fa=ea.positionData;const aa=fa.length/3,da=q.newDoubleArray(3*aa);Y=null!=Y.serviceObb?
Y.serviceObb.center:[0,0,0];const ma=Math.abs(Y[2])*2**-20;for(let ua=0;ua<aa;ua++){const sa=3*ua;da[sa]=fa[sa]+Y[0];da[sa+1]=fa[sa+1]+Y[1];da[sa+2]=fa[sa+2]+Y[2];Math.abs(da[sa+2])<ma&&(da[sa+2]=0)}return{featureIds:ea.featureIds?q.doubleArrayFrom(ea.featureIds):[],pointPositions:da}}_extractLegacyPointPositions(Y){const ea=Y.pointData.length,fa=q.newDoubleArray(3*ea),aa=[];for(let ua=0;ua<ea;ua++){var da=Y.pointData[ua];const sa=da.featureDataPosition,ra=sa.length;var ma=da.geometries?.[0]??ia[ra];
da=da.featureIds[0];if("Embedded"!==ma.type||"points"!==ma.params.type||2>ra||3<ra)continue;ma=ma.params.vertexAttributes?.position??[0,0,0];const Aa=3*aa.length;fa[Aa]=sa[0]+ma[0];fa[Aa+1]=sa[1]+ma[1];fa[Aa+2]=3===ra?sa[2]+ma[2]:NaN;aa.push(da)}return{featureIds:aa,pointPositions:fa}}_validatePositions(Y,ea,fa,aa,da){if(null!=aa||!Y.serviceObb){ea=ea.length;for(let ua=0;ua<ea;ua++){var ma=3*ua;h.set(ka,fa[ma],fa[ma+1],fa[ma+2]);ma=!Number.isNaN(fa[2]);null==aa||(ma?n.extentContainsCoords3D(aa,ka):
n.extentContainsCoords2D(aa,ka))||(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&k.getLogger(this).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&k.getLogger(this).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);Y.serviceObb||da.push(ka[0],ka[1],ka[2])}}}_createGraphics(Y,ea,fa,aa){const da=Y.length,ma=this._getObjectIdField(),
ua=this.processor.graphicsCore,sa=[],ra=this.view.spatialReference;for(let ja=0;ja<da;ja++){var Aa=Y[ja];const oa={};null!=Aa&&(oa[ma]=Aa);Aa=null==Aa?g.generateUID():Aa;var qa=3*ja,la=isNaN(ea[qa+2])?void 0:ea[qa+2];qa=y.makeDehydratedPoint(ea[qa],ea[qa+1],la,ra);la=this.loadedGraphics.get(Aa);if(null!=la){if(null==la.level||la.level<aa)na.property="geometry",na.graphic=la,na.oldValue=la.geometry,na.newValue=qa,la.geometry=qa,la.level=aa,ua.graphicUpdateHandler(na);sa.push(la)}else la=g.generateUID(),
sa.push({objectId:Aa,uid:la,geometry:qa,attributes:oa,visible:!0,nodeIndex:fa,level:aa})}return sa}_updateNodeMemory(Y){Y.memory=4096+(null!=Y.numFeatures?Y.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(Y){const ea=Y.graphics.reduce((fa,aa)=>r.estimateSize(aa)+fa,c.estimateSize(Y.featureIds)+1024);this._memCache.put(this._getMemCacheKey(Y.node),Y,ea)}_getMemCacheKey(Y){return`${Y.index}`}_removeAllNodeData(){this.loadedGraphics.forEachNode((Y,ea)=>{Y&&(this._updateNodeMemory(Y.node),
this._cacheNodeData(Y));this._controller.updateLoadStatus(ea,!1)});this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()}removeNode(Y){if(Y=this._removeNodeStageData(Y))this._updateNodeMemory(Y.node),this._cacheNodeData(Y)}_removeNodeStageData(Y){const ea=this.loadedGraphics.getNode(Y);if(null==ea)return null;this._controller.updateLoadStatus(Y,!1);this.loadedGraphics.removeNode(Y);this._treeDebugger&&this._treeDebugger.update();return ea}async loadCachedNodeData(Y){return this._memCache?.pop(this._getMemCacheKey(Y))}async addCachedNodeData(Y,
ea,fa,aa){this.loadedGraphics.hasNode(Y.index)?k.getLogger(this).error("I3S node "+Y.id+" already added"):(await this._i3sOverrides.applyAttributeOverrides(ea.featureIds,fa,aa),this.loadedGraphics.addNode(Y.index,ea),this._controller.updateLoadStatus(Y.index,!0),this._updateNodeMemory(Y),ea.attributeInfo=fa,this._attributeValuesChanged(ea),this._filterNode(ea),this._treeDebugger&&this._treeDebugger.update())}getLoadedNodeIds(){const Y=[];this.loadedGraphics.forEachNode(ea=>Y.push(ea.node.id));return Y.sort()}getVisibleNodes(){const Y=
[];this.loadedGraphics.forEachNode(ea=>Y.push(ea.node));return Y}getLoadedNodeIndices(Y){this.loadedGraphics.forEachNode((ea,fa)=>Y.push(fa))}getLoadedAttributes(Y){Y=this.loadedGraphics.getNode(Y);if(null!=Y?.attributeInfo)return Y.attributeInfo.loadedAttributes}getAttributeData(Y){Y=this.loadedGraphics.getNode(Y);if(null!=Y?.attributeInfo)return Y.attributeInfo.attributeData}_setAttributeData(Y,ea){Y=this.loadedGraphics.getNode(Y);null!=Y?.attributeInfo&&(Y.attributeInfo.attributeData=ea,this._attributeValuesChanged(Y))}async updateAttributes(Y,
ea,fa){Y=this.loadedGraphics.getNode(Y);null!=Y&&(await this._i3sOverrides.applyAttributeOverrides(Y.featureIds,ea,fa),Y.attributeInfo=ea,this._attributeValuesChanged(Y))}_attributeValuesChanged(Y){ca(Y);this._filterNode(Y);this.processor.graphicsCore.labelsEnabled&&(Y=Y.graphics.map(ea=>ea.uid),this.processor.graphicsCore.updateLabelingInfo(Y))}_updateClippingExtent(Y){this._controller&&this._controller.updateClippingArea(Y);return!1}_getObjectIdField(){return this.layer.objectIdField||v.fallbackObjectIDAttribute}_getGlobalIdField(){return this.layer.associatedLayer?.globalIdField}async _rendererChange(Y,
ea){const {layer:{fieldsIndex:fa}}=this,aa=new Set;let da;Y?(await Y.collectRequiredFields(aa,fa),da=Array.from(aa).sort()):da=[];aa.clear();let ma;ea?(await ea.collectRequiredFields(aa,fa),ma=Array.from(aa).sort()):ma=[];da.length===ma.length&&da.every((ua,sa)=>da[sa]===ma[sa])||this._reloadAllNodes()}_rangeInfosChanged(Y){null!=Y&&0<Y.length&&k.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}_filterChange(){this.loadedGraphics.forEachNode(Y=>
this._filterNode(Y))}_reloadAllNodes(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()}_filterNode(Y){const ea=this.parsedDefinitionExpression,fa=this._excludeObjectIdsSorted,aa=this._getObjectIdField();for(const da of Y.graphics){Y=da.visible;const ma=!ea||this._evaluateClause(ea,da),ua=null==fa||0>d.binaryIndexOf(fa,da.attributes[aa]);da.visible=ma&&ua;Y!==da.visible&&(na.graphic=da,na.property="visible",na.oldValue=Y,na.newValue=da.visible,this.processor.graphicsCore.graphicUpdateHandler(na))}}createQuery(){const Y=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(Y):new E(Y)}queryFeatures(Y,ea){return this._queryEngine.executeQuery(this._ensureQuery(Y),ea?.signal)}queryObjectIds(Y,ea){return this._queryEngine.executeQueryForIds(this._ensureQuery(Y),ea?.signal)}queryFeatureCount(Y,ea){return this._queryEngine.executeQueryForCount(this._ensureQuery(Y),ea?.signal)}queryExtent(Y,ea){return this._queryEngine.executeQueryForExtent(this._ensureQuery(Y),
ea?.signal)}_ensureQuery(Y){return this._addDefinitionExpressionToQuery(null==Y?this.createQuery():E.from(Y))}_setupQueryEngine(){const Y=()=>this.processor.featureStore;this._queryEngine=new H.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return Y()},hasZ:this.hasZ,hasM:this.hasM},priority:S.TaskPriority.FEATURE_QUERY_ENGINE})}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??
0}get unloadedMemory(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}get ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}async _handleEdits(Y){const ea=this._attributeEditingContext;Y=await B.normalizeEditResultsEvent(ea,Y);B.processAttributeEdits(ea,Y)}get _attributeEditingContext(){const Y=this._getObjectIdField(),ea=this._getGlobalIdField();return{sessions:this._interactiveEditingSessions,
fieldsIndex:this.layer.fieldsIndex,objectIdField:Y,globalIdField:ea,forEachNode:fa=>this.loadedGraphics.forEachNode(aa=>fa(aa.node,aa.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this._i3sOverrides,getAttributeData:fa=>this.getAttributeData(fa),setAttributeData:(fa,aa,da)=>{this._setAttributeData(fa,aa);fa=this.loadedGraphics.getNode(fa);null!=da?(da=this.loadedGraphics.get(da.attributes[Y]),null!=da&&this.processor.graphicsCore.recreateGraphics([da])):null!=
fa&&this.processor.graphicsCore.recreateGraphics(fa.graphics)},clearMemCache:()=>{}}}get performanceInfo(){const Y={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this.loadedGraphics.nodeCount,core:this.processor.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(Y);return Y}get test(){return{controller:this._controller,numNodes:this.loadedGraphics.nodeCount,loadedGraphics:this.loadedGraphics}}};
b.__decorate([l.property()],G.prototype,"processor",void 0);b.__decorate([l.property({type:C})],G.prototype,"filter",void 0);b.__decorate([l.property()],G.prototype,"loadedGraphics",void 0);b.__decorate([l.property()],G.prototype,"i3slayer",null);b.__decorate([l.property()],G.prototype,"_controller",void 0);b.__decorate([l.property()],G.prototype,"updating",void 0);b.__decorate([l.property()],G.prototype,"suspended",void 0);b.__decorate([l.property()],G.prototype,"holeFilling",void 0);b.__decorate([l.property(P.updatingProgress)],
G.prototype,"updatingProgress",void 0);b.__decorate([l.property()],G.prototype,"updatingProgressValue",null);b.__decorate([l.property(e.requiredFields)],G.prototype,"requiredFields",null);b.__decorate([l.property(e.availableFields)],G.prototype,"availableFields",void 0);b.__decorate([l.property()],G.prototype,"_fieldsHelper",void 0);b.__decorate([l.property({type:Number})],G.prototype,"maximumNumberOfFeatures",null);b.__decorate([l.property({readOnly:!0})],G.prototype,"maximumNumberOfFeaturesExceeded",
null);b.__decorate([l.property()],G.prototype,"_excludeObjectIdsSorted",null);b.__decorate([l.property({readOnly:!0})],G.prototype,"lodFactor",null);b.__decorate([l.property({readOnly:!0})],G.prototype,"hasM",null);b.__decorate([l.property({readOnly:!0})],G.prototype,"hasZ",null);b.__decorate([l.property()],G.prototype,"contentVisible",null);b.__decorate([l.property({readOnly:!0})],G.prototype,"legendEnabled",null);b=G=b.__decorate([p.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],G);
const ia={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ka=u.create(),na={graphic:null,property:null,oldValue:null,newValue:null};return b})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../core/workers/WorkerHandle"],function(a,b){class g extends b.WorkerHandle{constructor(d){super("SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:k=>
[k.geometryBuffer]},d,{hasInitialize:!0})}}a.I3SPointsWorkerHandle=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SGraphicsMap":function(){define(["exports","../../../../core/Evented","../../../../core/MapUtils"],function(a,b,g){class d extends b{constructor(k,m){super();this._updateAndCompare=k;this._notifyUpdated=m;this._nodes=new Map;this._graphics=new Map;this._duplicates=new Map}clear(){if(0<this._graphics.size){const k=this.toArray();this._graphics.clear();
this.emit("change",{added:[],removed:k})}this._nodes.clear()}get length(){return this._graphics.size}get(k){return this._graphics.get(k)}getNode(k){return this._nodes.get(k)}hasNode(k){return this._nodes.has(k)}nodes(){return this._nodes.values()}addNode(k,m){this._nodes.set(k,m);const f=m.graphics;if(0!==f.length){var c=new Set;for(let e=0;e<f.length;e++){var l=f[e];const p=l.objectId,h=this._graphics.get(p);h?(c.add(p),l!==h&&(f[e]=h),(l=this._duplicates.get(p))?l.push(k):this._duplicates.set(p,
[h.nodeIndex,k])):(l.nodeIndex=k,this._graphics.set(p,l))}c.size&&this._updateForeignGraphics(m);k=0<c.size?f.filter(e=>!c.has(e.objectId)):f;0<k.length&&this.emit("change",{added:k,removed:[]})}}removeNode(k){var m=this._nodes.get(k);if(m){this._nodes.delete(k);var f=new Set,c=[];for(const p of m.graphics){m=p.objectId;var l=this._graphics.get(m);if(!l)continue;const h=this._duplicates.get(m);if(h){var e=h.indexOf(k);if(-1===e)console.error("error: removing graphic from node that should not reference it.");
else{h.splice(e,1);if(l.nodeIndex===k){l=this.getNode(h[0]);for(e=1;e<h.length;e++){const u=this.getNode(h[e]);if(null==l||null!=u&&u.node.level>l.node.level)l=u}null!=l&&f.add(l)}1===h.length&&this._duplicates.delete(m)}}else this._graphics.delete(m),c.push(p)}0<c.length&&this.emit("change",{added:[],removed:c});f.forEach(p=>this._updateForeignGraphics(p))}else console.error("Removing unknown node")}_updateForeignGraphics(k){const m=[],f=k.node.index,c=k.node.level;let l=0;for(;l<k.graphics.length;){var e=
k.graphics[l].nodeIndex;if(e===f){l++;continue}let p=1;for(;l+p<k.graphics.length&&k.graphics[l+p].nodeIndex===e;)p++;e=this.getNode(e);if(!(null!=e&&e.node.level>c))for(e=l;e<l+p;e++){const h=k.graphics[e];h.nodeIndex=f;this._updateAndCompare(h,k,e)&&m.push(h)}l+=p}this._notifyUpdated(m)}toArray(){return Array.from(this._graphics.values())}find(k){let m=void 0;g.someMap(this._graphics,f=>k(f)?(m=f,!0):!1);return m}forEach(k){this._graphics.forEach(m=>k(m))}forEachNode(k){this._nodes.forEach((m,f)=>
k(m,f))}get nodeCount(){return this._nodes.size}_checkInvariants(){const k=new Map;this._nodes.forEach((f,c)=>{c!==f.node.index&&console.error("Mismatched node index");f.graphics.forEach(l=>{k.set(l.objectId,1+(k.get(l.objectId)??0));const e=this._duplicates.get(l.objectId);e&&!e.includes(c)&&console.error("Node not listed in duplicate list");e||l.nodeIndex===c||console.error("Unique graphic does not reference owning node index")})});this._graphics.size!==k.size&&console.error("Mismatch between actual and expected number of graphics");
let m=0;k.forEach((f,c)=>{m+=1<f?1:0;const l=this._graphics.get(c);if(l){var e=this._nodes.get(l.nodeIndex);e?(c=this._duplicates.get(c))?(c.length!==f&&console.error("Wrong number of entries in duplicate list"),c.forEach(p=>{(p=this._nodes.get(p))?p.node.level>e.node.level&&console.error("Duplicated graphic does not reference highest level node"):console.error("Unknown node in duplicate list")})):1<f&&console.error("Missing duplicates entry"):console.error("Graphic references unkown node")}else console.error("Missing graphic entry")});
this._duplicates.size!==m&&console.error("Mismatch between expected and actual number of duplicate entries")}}a.I3SGraphicsMap=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/projection/projectBoundingRect ../geometry/projection/projectPointToVector ../geometry/projection/projectVectorToVector ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/LayerConstants ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/TextureCollection ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/basicInterfaces ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/DefaultUI ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/Extent ../geometry/SpatialReference ../geometry/Point".split(" "),function(a,
b,g,d,k,m,f,c,l,e,p,h,u,w,x,n,q,t,v,r,y,z,D,C,E,A,F,G,I,H,B,K,L,J,M,T,Q,O,U,Z,P,R,W,N,V,S,X,ca,ba,ia,ka,na,Y,ea,fa,aa,da,ma,ua,sa,ra,Aa,qa,la,ja,oa,za,ta,Ca,Ga,La,Ma,Ra,Ya,ab,Wa,cb,Na,xa,Da,Ka,ha,Sa,Va,wa,Ba,Ja,Ta,db,lb,mb,ob,pb,zb){function rb(Ha,Oa){Ha.layerUids||(Ha.layerUids=new Set);Ha.layerUids.add(Oa)}function Jb(Ha,Oa){return null!=Ha&&H.canProjectWithoutEngine(Ha.spatialReference,Oa)?H.project(Ha,Oa):null}let fb=class extends P.BreakpointsOwner(N.PopupView(R.DOMContainer(V))){constructor(Ha){super(Ha);
this._initialDefaultSpatialReference=this._clippingArea=this._userClippingArea=null;this._defaults={};this._externallySet={environment:!1};this._createGraphicsViewController=null;this._resolveWhenReady=[];this._propertiesPool=new oa.PropertiesPool({slicePlane:M.BoundedPlaneClass},this);this._resourceController=Ca.newResourceController(this);this._defaultToMapOptions={include:new Set};this._defaultHitTestOptions={exclude:new Set};this.deconflictor=new ea.GraphicsDeconflictor({view:this});this.labeler=
new fa.Labeler({view:this,deconflictor:this.deconflictor.labels});this.sharedSymbolResources=null;this.analyses=new Z.AnalysesCollection;this.canvas=this.elevationProvider=this.basemapTerrain=null;this.constraints=new ia.Constraints;this.environmentManager=new na.SceneViewEnvironmentManager;this.floors=new f;this.fullOpacity=1;this.graphicsView=null;this.analysisViewManager=new ba({view:this});this.map=this.groundView=null;this.screenSizePerspectiveEnabled=!0;this.state=new da;this.spatialReference=
null;this.preserveDrawingBufferEnabled=this.alphaCompositingEnabled=!1;this.supersampleScreenshotsEnabled=!0;this.type="3d";this.ui=new lb;this._lastUpdateTime=this._numUpdating=0;this.updatingProgress=.5;this.highlightOptions=new la;y.initialize();Ha?.environment||(this._defaults.environment=new ka,this.environment=this._defaults.environment);const Oa=(Za=null)=>{if(null==Za||Za.type!==n.ObservableChangesType.MOVE)this._updatingChanged(),this.map&&this.map.allLayers.forEach(async ib=>{try{await ib.when()}catch{}this._updatingChanged()})};
this.addHandles([t.on(()=>this.map?.allLayers,"after-changes",Za=>Oa(Za),{onListenerAdd:()=>Oa(),onListenerRemove:()=>Oa(),sync:!0}),this.allLayerViews.on("after-changes",Za=>this._updateUpdatingMonitors(Za)),t.watch(()=>this.map,Za=>{Za&&"load"in Za&&Za.load&&Za.load().catch(()=>{})})]);this.inputManager=new Y({view:this});this.stateManager=new ma.ViewStateManager({view:this})}initialize(){this.groundView=new W({view:this});this._updateUpdatingMonitors();const Ha=()=>this._updateDefaultToMapOptions();
this.addHandles(t.on(()=>this.map?.allLayers,"after-changes",Ha,{onListenerAdd:Ha,onListenerRemove:Ha}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Oa=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Oa)},t.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Oa=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Oa)},t.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate??
0,Oa=>v.setFrameDuration(0<Oa?1E3/Math.ceil(Oa):0),t.initial);this.updatingHandles.add(()=>this.map?.ground,Ha,t.syncAndInitial);this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),t.syncAndInitial);this.addHandles(t.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),t.sync))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),
this.sharedSymbolResources=x.destroyMaybe(this.sharedSymbolResources),this._set("labeler",x.destroyMaybe(this.labeler)),this._set("deconflictor",x.destroyMaybe(this.deconflictor)),this._resourceController=x.destroyMaybe(this._resourceController),this._set("stateManager",x.destroyMaybe(this.stateManager)),this._set("inputManager",x.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",x.destroyMaybe(this.environmentManager)),
this._set("environment",x.destroyMaybe(this.environment)),this.groundView=x.destroyMaybe(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(Ha){this.stateManager&&(this.stateManager.camera=Ha)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(Ha){this.stateManager&&
(this.stateManager.contentCamera=Ha)}installContentCameraReset(Ha={sticky:!1}){return this.stateManager.installContentCameraReset(Ha)}get center(){return this.stateManager?.center}set center(Ha){this.stateManager&&(this.stateManager.center=Ha)}get clippingArea(){if("global"===this.viewingMode)return null;const Ha=this.map;let Oa=this._userClippingArea||x.maybeProperty(Ha,"clippingArea");if(!this._userClippingArea&&!x.maybeProperty(Ha,"clippingEnabled")||null==Oa)return this._clippingArea=null;if(!(Oa instanceof
ob))return w.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Oa=Jb(Oa,this.spatialReference),null==Oa))return w.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Oa=Oa.clone();null==Oa.intersection(this._groundAndLayersExtent)&&(Oa.xmin=Oa.xmax,Oa.ymin=Oa.ymax);Oa.zmin=void 0;Oa.zmax=void 0;Oa.equals(this._clippingArea)||(this._clippingArea=
Oa);return this._clippingArea}set clippingArea(Ha){this.ready&&"global"===this.viewingMode&&null!=Ha?w.getLogger(this).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=Ha}get renderDataExtent(){if(this.state.viewingMode===X.ViewingMode.Global)return null;const Ha=this.renderSpatialReference,Oa=this.dataExtent;return null==Oa||null==Ha||Oa.spatialReference.equals(Ha)?Oa:Jb(Oa,Ha)}get dataExtent(){let Ha=this._groundAndLayersExtent;var Oa=Jb(this.clippingArea,
this.spatialReference||pb.WGS84);null!=Oa&&(Ha=null!=Ha?Ha.intersection(Oa):Oa);Oa=this._get("dataExtent");return null!=Ha&&Ha.equals(Oa)?Oa:Ha}get _groundAndLayersExtent(){const Ha=this.spatialReference||pb.WGS84;let Oa;const Za=jb=>{jb=Jb(jb,Ha);null!=jb&&(null!=Oa?Oa.union(jb):Oa=jb.clone())};var ib=this.basemapTerrain;if(ib?.spatialReference){const jb=ib.groundExtent;Za(new ob({xmin:jb[0],ymin:jb[1],zmin:0,xmax:jb[2],ymax:jb[3],zmax:0,spatialReference:ib.spatialReference}))}this.map&&this.map.allLayers.forEach(jb=>
{null==jb.fullExtent||"graphics"===jb.type&&jb.internal||Za(jb.fullExtent)});if(null==Oa)return null;Oa.hasZ?(Oa.zmin=Math.min(0,Oa.zmin??0),Oa.zmax=Math.max(0,Oa.zmax??0)):(Oa.zmin=0,Oa.zmax=0);ib=this._get("_groundAndLayersExtent");return Oa.equals(ib)?ib:Oa}set environment(Ha){Ha!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Ha)}castEnvironment(Ha){return Ha?Ha instanceof ka?Ha:Ha instanceof mb?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Ha):
ka.fromWebsceneEnvironment(Ha):A.ensureType(ka,Ha):new ka}get extent(){return this.stateManager?.extent}set extent(Ha){this.stateManager&&(this.stateManager.extent=Ha)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??
!1)}get stationary(){return!this.animation&&!this.resizing&&(null==this.state||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(Ha){this.stateManager&&(this.stateManager.padding=Ha)}set qualityProfile(Ha){Aa.isValidProfile(Ha)&&(Aa.apply(Ha,this.qualitySettings),this._set("qualityProfile",Ha))}get qualityProfile(){return this._get("qualityProfile")||Aa.getDefaultProfile()}set slicePlane(Ha){null!=this._stage&&this._stage.renderer.setParameters({slicePlane:Ha});
if(null==Ha)this._set("slicePlane",null);else{var Oa=this._propertiesPool.get("slicePlane");M.copy(Ha,Oa);this._set("slicePlane",Oa)}}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return null!=this.spatialReference?Q.getResolutionForScale(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(Ha){this.stateManager&&(this.stateManager.scale=Ha)}get heightModelInfo(){const Ha=this.getDefaultHeightModelInfo();return null!=Ha?I.deriveUnitFromSR(Ha,
this.spatialReference):null}get updating(){if(this.destroyed)return!1;let Ha=0,Oa=this.layerViewManager.updating,Za=Oa?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(nb=>{nb.isFulfilled()?nb.updating&&(Oa=!0,nb.suspended||ab.isSurfaceLayerView(nb)||(++Za,Ha+=nb.updatingProgress)):++Za});for(var ib of this._updatingObjects)null!=ib&&ib.updating&&(Za+=.1,Ha+=.05);for(var jb of this._updatingObjectsWithProgress)null!=jb&&jb.updating&&(++Za,Ha+=jb.updatingProgress);ib=!this.stateManager.test.updatingIgnoreRenderState&&
this.state.updating;(Oa=!!(Oa||0<Za||this.updatingHandles.updating||!this.ready||!this.stationary||ib||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(nb=>!nb.isFulfilled())||this.textures?.updating))?(this._numUpdating=Math.max(Za,this._numUpdating),Ha+=this._numUpdating-Za):this._numUpdating=0;Ha=0<this._numUpdating?Ha/this._numUpdating:Oa?0:1;this._get("updatingProgress")!==Ha&&(ib=performance.now(),1>Ha&&(jb=Math.min((ib-this._lastUpdateTime)/2E3,1),
Ha=this.updatingProgress*(1-jb)+Ha*jb),this._set("updatingProgress",Ha),this._lastUpdateTime=Oa&&1>Ha?ib:0);return Oa}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var Ha=this._predeterminedViewingMode;
return null!=Ha?X.stringFromViewingMode(Ha):(Ha=this.spatialReference)?null!=this.defaultsFromMap?.viewingMode&&Ha.equals(this.defaultsFromMap.spatialReference)?X.stringFromViewingMode(this.defaultsFromMap.viewingMode):Ja.isSpatialReferenceSupported(Ha,X.ViewingMode.Global)?"global":"local":"global"}set viewingMode(Ha){this.ready?w.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",Ha)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(Ha){this.stateManager&&
(this.stateManager.viewpoint=Ha)}get zoom(){return this.stateManager.zoom}set zoom(Ha){this.stateManager&&(this.stateManager.zoom=Ha)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Ga(this)}on(Ha,Oa,Za,ib){return(Za=this.viewEvents.on(Ha,Oa,Za,ib))?Za:super.on(Ha,Oa)}hasEventListener(Ha){return super.hasEventListener(Ha)||
this.viewEvents.hasHandler(Ha)}toMap(Ha,Oa){if(!this.ready)return w.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;Oa=Oa?this.externalToInternalIntersectOptions(Oa):this._defaultToMapOptions;var Za=null!=Oa.graphics&&(null!=Oa.graphics.include||null!=Oa.graphics.exclude);Ha=Ba.isSupportedScreenPointEvent(Ha)?Ba.createScreenPointFromSupportedEvent(this,Ha):Ha;Ha=r.screenPointObjectToArray(Ha);Oa.enableDraped=Oa.include&&!Oa.include.has(ha.terrainId)||Oa.exclude&&
Oa.exclude.has(ha.terrainId);const ib=this.sceneIntersectionHelper,jb=Na.newIntersector(this.state.viewingMode);jb.options.selectionMode=!0;jb.options.store=Za?xa.StoreResults.ALL:xa.StoreResults.MIN;ib.intersectIntersectorScreen(Ha,jb,Oa);if(Za){for(const nb of jb.results.all)if(Za=Ka.toHit(nb,this),null==Za||"graphic"!==Za.type||this._testGraphicUidFilter(Oa.graphics,Za.graphic))return this._intersectResultToMapPoint(nb);return null}return this._intersectResultToMapPoint(jb.results.min)}toScreen(Ha){if(!this.ready)return w.getLogger(this).error("#toScreen()",
"Scene view cannot be used before it is ready"),null;const Oa=(null==Ha.z?qa.getElevationAtPoint(this.elevationProvider,Ha):null)??0;K.projectPointToVector(Ha,Lb,this.renderSpatialReference,Oa);this.state.camera.projectToScreen(Lb,Hb);return r.createScreenPoint(Hb[0],Hb[1])}pixelSizeAt(Ha){if(!this.ready)return w.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Ha)return 0;K.projectPointToVector(Ha,Lb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Lb)}overlayPixelSizeInMapUnits(Ha){const Oa=
this.basemapTerrain.overlayManager;return Oa?Oa.overlayPixelSizeInMapUnits(Ha,()=>this.pixelSizeAt(Ha)):1}hitTest(Ha,Oa){if(!this.ready)return w.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;Ha=Ba.isSupportedScreenPointEvent(Ha)?Ba.createScreenPointFromSupportedEvent(this,Ha):Ha;var Za=r.createScreenPointArray(Ha.x,Ha.y),ib=Oa?this.externalToInternalIntersectOptions(Oa):this._defaultHitTestOptions;ib.requiresGroundFeedback=!0;ib.enableDraped=!0;Oa=Na.newIntersector(this.state.viewingMode);
Oa.options.selectionMode=!0;Oa.options.store=xa.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(Za,Oa,ib);Za=this._intersectResultsToHits(Oa.results.all,ib.graphics);ib=Oa.results.ground;var jb=Ka.toOwner(ib,this);jb=null!=jb&&"type"in jb&&"integrated-mesh"===jb.type?jb:null;Ha={screenPoint:Ha,results:Za,ground:{mapPoint:this._intersectResultToMapPoint(ib),distance:Da.isValidIntersectorResult(ib)?ib.distanceInRenderSpace:0,layer:jb}};ra.debugFlags.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&
(Ha.intersector=Oa);return Promise.resolve(Ha)}async popupHitTest(Ha){const {results:Oa,ground:Za}=await Sa.hitTestSelectSimilarDistance(this,Ha);let ib=null;!(0===Oa.length||1E-5>Math.abs((Oa[0].distance??0)-Za.distance))||Za.layer&&"integrated-mesh"===Za.layer.type||(ib=Za.mapPoint);return{results:Oa,screenPoint:Ha,mapPoint:ib}}goTo(Ha,Oa){return this.updatingHandles.addPromise(this.stateManager.goTo(Ha,Oa))}async whenAnalysisView(Ha){if(null==Ha.parent)throw new l("view:no-analysisview-for-analysis",
"The analysis has not been added to view.analyses",{analysis:Ha});switch(Ha.parent.type){case "line-of-sight":case "dimension":return(await this.whenLayerView(Ha.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(Ha)}}whenLayerView(Ha){return super.whenLayerView(Ha)}async takeScreenshot(Ha){Ha=this._completeSettings(Ha);await this.whenReady();const Oa=await this._stage.renderView.takeScreenshot(Ha);return wa.encode(Oa,Ha,this._pixelFormat())}async _takeScreenshot(Ha){Ha=
this._completeSettings(Ha);await this.whenReady();Ha=await this._stage.renderView.takeScreenshot(Ha);return wa.encodeData(Ha,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(Ha){Ha=this._completeSettings(Ha);await this.whenReady();Ha=await this._stage.renderView.takeScreenshotWithOID(Ha);return[wa.encodeData(Ha[0],this._pixelFormat()),wa.encodeData(Ha[1],this._pixelFormat())]}_completeSettings(Ha){Ha=wa.toRenderSettings(Ha,this);Ha.pixelRatio/=this.state.pixelRatio;return wa.screenshotSuperSampleSettings(Ha,
this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:Ha=>this._takeScreenshot(Ha),takeScreenshotWithObjectAndLayerId:Ha=>this._takeScreenshotWithObjectAndLayerId(Ha)}}async takeScreenshotWithObjectAndLayerId(Ha){if(!h("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");var Oa=this._completeSettings(Ha);await this.whenReady();
var Za=await this._stage.renderView.takeScreenshotWithOID(Oa);Oa=wa.encode(Za[0],Oa,this._pixelFormat());Ha=this._completeSettings(Ha);Ha.format="png";Za=wa.encode(Za[1],Ha,this._pixelFormat());return[Oa,Za]}getColorToObjectAndLayerIdMapping(){if(null==this._stage.renderView.objectAndLayerIdRenderHelper)throw Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(Ha){return this.updatingHandles.addPromise(Ha)}importLayerView(Ha){return ca.layerView3DImporter.importLayerView(Ha)}hasLayerViewModule(Ha){return ca.layerView3DImporter.hasLayerViewModule(Ha)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&
"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let Ha=Ta.check(this.type);const Oa=h("safari");Oa&&9>Oa&&(Ha=new l("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:Oa}));if(null!=Ha)throw w.getLogger(this).warn("#validate()",Ha.message),Ha;
}get _predeterminedViewingMode(){const Ha=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return null!=Ha?X.viewingModeFromString(Ha):null}getSpatialReferenceSupport({spatialReference:Ha,layer:Oa}){var Za=this._predeterminedViewingMode;if(null!=Za)return this._validateSpatialReferenceForViewingMode(Ha,Oa,Za)?{constraints:this._makeSpatialReferenceConstraints(Ha,Oa,Za)}:null;Za=this._validateSpatialReferenceForViewingMode(Ha,
Oa,X.ViewingMode.Local);const ib=this._validateSpatialReferenceForViewingMode(Ha,Oa,X.ViewingMode.Global);return Za||ib?Za&&ib?{constraints:this._makeSpatialReferenceConstraints(Ha,Oa,null)}:Za?{constraints:this._makeSpatialReferenceConstraints(Ha,Oa,X.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Ha,Oa,X.ViewingMode.Global)}:null}_validateSpatialReferenceForViewingMode(Ha,Oa,Za){return Ja.isSpatialReferenceSupported(Ha,Za)?null==Oa||U.isImageryTileLayer(Oa)?!0:U.isTiledLayer(Oa)&&
null==ab.getTiledLayerInfo(Oa,Ha,Za)||U.isVoxelLayer(Oa)&&Za===X.ViewingMode.Global?!1:!0:!1}_makeSpatialReferenceConstraints(Ha,Oa,Za){if(null==Oa)return[{spatialReference:Ha,viewingMode:Za}];const ib=Ha.isWebMercator,jb=Ha.isWGS84;return U.isImageryTileLayer(Oa)&&(ib||jb)?(jb&&Za!==X.ViewingMode.Local?null===ab.checkIfTileInfoSupportedForView(Oa.tileInfo,Oa.fullExtent,Ha,X.ViewingMode.Global):1)?[{spatialReference:Ha,viewingMode:Za},{spatialReference:pb.WebMercator,viewingMode:Za}]:[{spatialReference:ib?
pb.WGS84:pb.WebMercator,viewingMode:Za}]:U.isTiledLayer(Oa)||U.isVoxelLayer(Oa)||!ib&&!jb?U.isTiledLayer(Oa)&&ib&&Za!==X.ViewingMode.Global?[{spatialReference:Ha,viewingMode:Za},{spatialReference:pb.WGS84,viewingMode:X.ViewingMode.Local}]:[{spatialReference:Ha,viewingMode:Za}]:[{spatialReference:Ha,viewingMode:Za},{spatialReference:ib?pb.WGS84:pb.WebMercator,viewingMode:Za}]}_validateSpatialReference(Ha){const Oa=null!=this.getSpatialReferenceSupport({spatialReference:Ha}),Za=this._predeterminedViewingMode;
Oa||(null!=Za?w.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${X.stringFromViewingMode(Za)} viewing mode.`):Ha.isGeographic&&w.getLogger(this).warnOnce("Spatial reference is geographic but not supported."));return Oa}whenReady(){return new Promise(Ha=>{this.ready?Ha(this):this._resolveWhenReady.push(Ha)})}computeMapPointFromVec3d(Ha,Oa){let Za=this.spatialReference||pb.WGS84;L.projectVectorToVector(Ha,this.renderSpatialReference,Ha,Za)||(Za=pb.WGS84,L.projectVectorToVector(Ha,
this.renderSpatialReference,Ha,Za));Oa?(Oa.x=Ha[0],Oa.y=Ha[1],Oa.z=Ha[2],Oa.spatialReference=Za):Oa=new zb(Ha,Za);return Oa}trackGraphicState(Ha){if(!Ha.graphic)return w.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Oa=this.getViewForGraphic(Ha.graphic);let Za=null,ib=!1;const jb=nb=>{!ib&&null!=nb&&"processor"in nb&&"graphics-3d"===nb.processor?.type&&nb.processor.graphicsCore&&(Za=nb.processor.graphicsCore.trackGraphicState(Ha))};
null!=Oa?jb(Oa):this.whenViewForGraphic(Ha.graphic,{waitForLayer:!0}).then(nb=>jb(nb),()=>{}).catch(()=>{});return p.makeHandle(()=>{ib=!0;null!=Za&&(Za.remove(),Za=null)})}highlight(Ha){if(Array.isArray(Ha))return p.handlesGroup(Ha.map(Za=>this.highlight(Za)));if(f.isCollection(Ha))return p.handlesGroup(Ha.toArray().map(Za=>this.highlight(Za)));const Oa=this.getViewForGraphic(Ha);return Oa&&"highlight"in Oa?Oa.highlight(Ha):p.makeHandle()}maskOccludee(Ha){if(!Ha)return w.getLogger(this).error("maskOccludee",
"GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Oa=this.getViewForGraphic(Ha);let Za=null,ib=!1;const jb=nb=>{!ib&&null!=nb&&Va.occludeesSupported(nb)&&(Za=nb.maskOccludee(Ha))};null!=Oa?jb(Oa):this.whenViewForGraphic(Ha,{waitForLayer:!0}).then(nb=>jb(nb),()=>{}).catch(()=>{});return p.makeHandle(()=>{ib=!0;null!=Za&&(Za.remove(),Za=null)})}getViewForGraphic(Ha){return Ha.layer===this.graphics?this.graphicsView:Ha.layer?this.allLayerViews.find(Oa=>Oa.layer===Ha.layer):
null}graphicChanged(Ha){null!=this.graphicsView&&this.graphicsView.graphicChanged(Ha)}async whenViewForGraphic(Ha,Oa){if(Ha.layer===this)return await t.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Ha.layer||!this.map)throw new l("no-view-for-graphic");return Oa&&Oa.waitForLayer&&!this.map.allLayers.includes(Ha.layer)?new Promise((Za,ib)=>{const jb=this.map.allLayers.on("change",nb=>{nb.added.includes(Ha.layer)&&(jb.remove(),this.whenLayerView(Ha.layer).then(Za,ib))})}):this.whenLayerView(Ha.layer)}externalToInternalIntersectOptions(Ha){const Oa=
this._externalToInternalRenderItems(Ha.include,Cb.INCLUDE);Ha=this._externalToInternalRenderItems(Ha.exclude,Cb.EXCLUDE);return{include:Oa.layerUids,exclude:Ha.layerUids,graphics:{include:Oa.graphicUids,exclude:Ha.graphicUids}}}_intersectResultToMapPoint(Ha,Oa){return Ha.getIntersectionPoint(Lb)?(Oa=this.computeMapPointFromVec3d(Lb,Oa),Ha.intersector===xa.IntersectorType.TERRAIN&&this.basemapTerrain&&(Oa.z=qa.getElevationAtPoint(this.basemapTerrain,Oa)??0),Oa):null}_intersectResultsToHits(Ha,Oa){const Za=
[];let ib=null;for(let Kb=0;Kb<Ha.length;Kb++){var jb=Ha[Kb],nb=Ka.toOwner(jb,this);if(null!=nb&&(nb===this.map.ground||"type"in nb&&"integrated-mesh"===nb.type))break;nb=Ka.toHit(jb,this);if(null!=nb){if("graphic"===nb.type){null==ib&&Kb!==Ha.length-1&&(ib=new Set);if(null!=ib){var vb=this._getGraphicFilterUid(nb.graphic);if(ib.has(vb))continue;ib.add(vb)}if(!this._testGraphicUidFilter(Oa,nb.graphic))continue}vb=this._intersectResultToMapPoint(jb);jb=jb.distanceInRenderSpace;if("media"===nb.type){const gb=
nb.element.toSource(vb);Za.push({...nb,mapPoint:vb,distance:jb,sourcePoint:gb})}else Za.push({...nb,mapPoint:vb,distance:jb})}}return Za}_getGraphicFilterUid(Ha){var Oa=Ha.sourceLayer,Za=Ha.layer;if(Oa=Oa&&"objectIdField"in Oa?Oa:Za&&"objectIdField"in Za?Za:Oa)if(Za=Oa.objectIdField??O.fallbackObjectIDAttribute,Za=Ha.attributes?.[Za])return`o-${Oa.id}-${Za}`;return`u-${Ha.uid}`}_testGraphicUidFilter(Ha,Oa){Oa=this._getGraphicFilterUid(Oa);return null==Ha||(null==Ha.include||Ha.include.has(Oa))&&(null==
Ha.exclude||!Ha.exclude.has(Oa))}_externalToInternalRenderItems(Ha,Oa,Za={layerUids:void 0,graphicUids:void 0}){if(!Ha)return Za;if(Ha instanceof k){var ib=this._getGraphicFilterUid(Ha);Za.graphicUids||(Za.graphicUids=new Set);Za.graphicUids.add(ib);Oa===Cb.INCLUDE&&(null!=this.graphicsView&&Ha.layer===this?rb(Za,this.graphicsView.processor.layer.id):Ha.layer&&rb(Za,Ha.layer.uid))}else if(u.isIterable(Ha))for(ib of Ha)ib===this.graphics&&null!=this.graphicsView?rb(Za,this.graphicsView.processor.layer.id):
ib===this.map.ground?rb(Za,ha.terrainId):this._externalToInternalRenderItems(ib,Oa,Za);else"uid"in Ha&&rb(Za,Ha.uid);return Za}_initBasemapTerrain(){this._set("basemapTerrain",new Ya({view:this}));this._set("elevationProvider",new sa.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),
this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Ra.PointsOfInterest({view:this}));this._set("featureTiles",new aa.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,
terrain:this.basemapTerrain}));const Ha=()=>{var Oa=this.basemapTerrain?.extent;this.clippingArea||Oa?Oa&&this.basemapTerrain.spatialReference?(Oa=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?H.project(J.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,this.featureTiles.filterExtent=null!=this.clippingArea?this.clippingArea.intersection(Oa):Oa):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=
null};this.addHandles([this.updatingHandles.add(()=>ra.debugFlags.FEATURE_TILE_TREE_SHOW_TILES,Oa=>{Oa&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Za,ib)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],Za,ib))).then(({FeatureTileTree3DDebugger:Za})=>{!this._featureTreeDebugger&&ra.debugFlags.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new Za({view:this}))}):Oa||!this._featureTreeDebugger||ra.debugFlags.FEATURE_TILE_TREE_SHOW_TILES||
(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},t.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Ha,t.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Ha,t.syncAndInitial)],"feature-tiles");this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",
null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){var Ha=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Ha)||this._set("mapCoordsHelper",new ja.MapCoordsHelper(this.map,Ha));const Oa=this.state.isGlobal;Ha=T.renderSRFromViewSR(Oa,Ha);Ha!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ta.RenderCoordsHelper.create(this.state.viewingMode,Ha)),Oa||this.addHandles(t.watch(()=>
this.basemapTerrain?.extent,Za=>{const ib=this.renderCoordsHelper.spatialReference;null==Za||0===Za[0]&&0===Za[1]&&0===Za[2]&&0===Za[3]||!B.projectBoundingRect(Za,this.basemapTerrain.spatialReference,Mb,ib)||(this.renderCoordsHelper.extent=Mb)},t.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Na.defaultTolerance/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&
(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(Ha=null){if(null==Ha||Ha.type!==n.ObservableChangesType.MOVE)this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(Oa=>{Oa.destroyed||(this.addHandles(t.watch(()=>[Oa.updating,Oa.updatingProgress],()=>this._updatingChanged(),t.sync),"updatingMonitors"),Oa.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),
this._updatingChanged()}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(Ha,Oa,Za){if(!this.overlay||!this.overlay.hasVisibleItems)return Za;const ib=Ha.getContext("2d");ib.putImageData(Za,0,0);this.overlay.renderCanvas(Ha,{disableDecorations:Oa===cb.Decorations.OFF});return ib.getImageData(0,0,Za.width,Za.height)}_initStage(){const Ha={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,
preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(Za,ib,jb)=>this._renderScreenshotOverlay(Za,ib,jb)}};var Oa=new ua.SceneIntersectionHelper(this.state.viewingMode,Za=>this._stage.layers.forAll(Za),this);this._set("sceneIntersectionHelper",Oa);Oa=c.byId(this.surface);this._stage=new Wa.Stage({view:this,options:Ha,container:Oa});this._stage.renderer.setParameters({slicePlane:this.slicePlane});
this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,Za=>this._stage.renderer.setParameters({highQualityTransparency:Za}),t.initial),t.watch(()=>this.magnifier,Za=>this._stage.renderView.magnifier=Za,t.syncAndInitial),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),e.on(this._stage.renderView.canvas,"webglcontextlost",Za=>this.fatalError=new l("webgl-context-lost",Za.statusMessage))],"stage");this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Na.defaultTolerance/
this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null);this._stage=x.destroyMaybe(this._stage);this.removeHandles("stage");this._set("canvas",null)}_initSurface(Ha){this._exitSurface();this.state.init(Ha,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new La.SharedSymbolResources({view:this,viewingMode:Ha,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,
viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.removeHandles("graphics-view");this._createGraphicsViewController=new AbortController;var Ha=()=>{this._createGraphicsViewController=null;this._updatingChanged()};
this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ha,Ha);this._updatingChanged()}}async _createGraphicsViewAsync(Ha){const Oa=(await new Promise((Za,ib)=>a(["./3d/layers/GraphicsView3D"],jb=>Za(Object.freeze(Object.defineProperty({__proto__:null,default:jb},Symbol.toStringTag,{value:"Module"}))),ib))).default;q.throwIfAborted(Ha);await t.whenOnce(()=>this.basemapTerrain?.ready,Ha);this._set("graphicsView",new Oa({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&
(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.removeHandles("graphics-view");null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var Ha=X.viewingModeFromString(this.viewingMode);Ha===X.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Ha);this._set("ready",!0);this.addHandles(t.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),
"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&({map:Ha}=this,Ha=Ha&&"initialViewProperties"in Ha?Ha.initialViewProperties?.environment:void 0)&&(this.environment=Ha);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();this._set("textures",new Ma.TextureCollection(this._stage,this.resourceController.scheduler));Ha=this._resolveWhenReady;this._resolveWhenReady=[];Ha.forEach(Oa=>Oa(this))}_teardown(){this._initialDefaultSpatialReference=
null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.removeHandles("graphics-view");this._set("textures",x.destroyMaybe(this.textures));this._exitSurface();this._set("ready",!1)}_updateDefaultToMapOptions(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(ha.terrainId);for(const Ha of this.map.allLayers.items)"integrated-mesh"===Ha.type&&this._defaultToMapOptions.include.add(Ha.uid)}}_updateDefaultHitTestOptions(){this._defaultHitTestOptions.exclude.clear();
if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(ha.terrainId);for(const Ha of this.map.allLayers.items)"integrated-mesh"===Ha.type&&1>Ha.opacity&&this._defaultHitTestOptions.exclude.add(Ha.uid)}}};fb.type="3d";b.__decorate([z.property()],fb.prototype,"_userClippingArea",void 0);b.__decorate([z.property()],fb.prototype,"_resourceController",void 0);b.__decorate([z.property()],fb.prototype,"_stage",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,
"deconflictor",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"labeler",void 0);b.__decorate([z.property(G.owningCollectionProperty(Z.AnalysesCollection,"analyses"))],fb.prototype,"analyses",void 0);b.__decorate([z.property({type:S,readOnly:!0})],fb.prototype,"animation",null);b.__decorate([z.property({readOnly:!0})],fb.prototype,"basemapTerrain",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"elevationProvider",void 0);b.__decorate([z.property()],fb.prototype,"camera",
null);b.__decorate([z.property({type:g})],fb.prototype,"contentCamera",null);b.__decorate([z.property({readOnly:!0})],fb.prototype,"canvas",void 0);b.__decorate([z.property({type:zb})],fb.prototype,"center",null);b.__decorate([z.property({type:ob})],fb.prototype,"clippingArea",null);b.__decorate([z.property({type:ia.Constraints})],fb.prototype,"constraints",void 0);b.__decorate([z.property({type:ob,readOnly:!0})],fb.prototype,"renderDataExtent",null);b.__decorate([z.property({type:ob,readOnly:!0})],
fb.prototype,"dataExtent",null);b.__decorate([z.property({type:ob,readOnly:!0})],fb.prototype,"_groundAndLayersExtent",null);b.__decorate([z.property({value:null,type:ka})],fb.prototype,"environment",null);b.__decorate([D.cast("environment")],fb.prototype,"castEnvironment",null);b.__decorate([z.property({readOnly:!0})],fb.prototype,"environmentManager",void 0);b.__decorate([z.property({type:ob})],fb.prototype,"extent",null);b.__decorate([z.property()],fb.prototype,"floors",void 0);b.__decorate([z.property()],
fb.prototype,"screenCenter",null);b.__decorate([z.property()],fb.prototype,"frustum",null);b.__decorate([z.property({type:Number,readOnly:!0})],fb.prototype,"fullOpacity",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"graphicsView",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"analysisViewManager",void 0);b.__decorate([z.property()],fb.prototype,"groundView",void 0);b.__decorate([z.property({type:Boolean})],fb.prototype,"initialExtentRequired",null);b.__decorate([z.property()],
fb.prototype,"_defaultsFromMapSettings",null);b.__decorate([z.property()],fb.prototype,"interacting",null);b.__decorate([z.property()],fb.prototype,"stationary",null);b.__decorate([z.property()],fb.prototype,"navigating",null);b.__decorate([z.property()],fb.prototype,"map",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"mapCoordsHelper",void 0);b.__decorate([z.property()],fb.prototype,"padding",null);b.__decorate([z.property({type:Ra.PointsOfInterest,readOnly:!0})],fb.prototype,"pointsOfInterest",
void 0);b.__decorate([z.property({type:aa.FeatureTileTree3D,readOnly:!0})],fb.prototype,"featureTiles",void 0);b.__decorate([z.property()],fb.prototype,"_featureTreeDebugger",void 0);b.__decorate([z.property({type:Boolean})],fb.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([z.property({constructOnly:!0})],fb.prototype,"deactivatedWebGLExtensions",void 0);b.__decorate([z.property({constructOnly:!0})],fb.prototype,"debugWebGLExtensions",void 0);b.__decorate([z.property({constructOnly:!0})],
fb.prototype,"renderCanvas",void 0);b.__decorate([z.property({constructOnly:!0})],fb.prototype,"state",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"inputManager",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"stateManager",void 0);b.__decorate([z.property({type:["low","medium","high"]})],fb.prototype,"qualityProfile",null);b.__decorate([z.property({type:za,get(){let Ha=this._get("qualitySettings");Ha||(Ha=new za,Aa.apply(this.qualityProfile,Ha));return Ha}})],fb.prototype,
"qualitySettings",void 0);b.__decorate([z.property()],fb.prototype,"slicePlane",null);b.__decorate([z.property({readOnly:!0})],fb.prototype,"typeSpecificPreconditionsReady",null);b.__decorate([z.property({readOnly:!0})],fb.prototype,"renderCoordsHelper",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"sceneIntersectionHelper",void 0);b.__decorate([z.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],fb.prototype,"resolution",null);b.__decorate([z.property({type:Number})],
fb.prototype,"scale",null);b.__decorate([z.property()],fb.prototype,"heightModelInfo",null);b.__decorate([z.property()],fb.prototype,"spatialReference",void 0);b.__decorate([z.property({type:Boolean,constructOnly:!0})],fb.prototype,"alphaCompositingEnabled",void 0);b.__decorate([z.property({constructOnly:!0})],fb.prototype,"preserveDrawingBufferEnabled",void 0);b.__decorate([z.property({type:Boolean})],fb.prototype,"supersampleScreenshotsEnabled",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,
"type",void 0);b.__decorate([z.property(),D.cast(Ha=>Ha instanceof db?Ha:A.ensureClass(lb,Ha))],fb.prototype,"ui",void 0);b.__decorate([z.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.updating toolViewManager.updating analysisViewManager.updating state.updating textures.updating".split(" ")})],
fb.prototype,"updating",null);b.__decorate([z.property()],fb.prototype,"_updatingObjects",null);b.__decorate([z.property()],fb.prototype,"_updatingObjectsWithProgress",null);b.__decorate([z.property({type:Number,readOnly:!0,dependsOn:["updating"]})],fb.prototype,"updatingProgress",void 0);b.__decorate([z.property({type:["global","local"]})],fb.prototype,"viewingMode",null);b.__decorate([z.property({type:m})],fb.prototype,"viewpoint",null);b.__decorate([z.property({type:Number})],fb.prototype,"zoom",
null);b.__decorate([z.property({type:la})],fb.prototype,"highlightOptions",void 0);b.__decorate([z.property({readOnly:!0})],fb.prototype,"quality",null);b.__decorate([z.property({readOnly:!0})],fb.prototype,"resolutionScale",null);b.__decorate([z.property()],fb.prototype,"textures",void 0);fb=b.__decorate([E.subclass("esri.views.SceneView")],fb);var Cb;(function(Ha){Ha[Ha.INCLUDE=0]="INCLUDE";Ha[Ha.EXCLUDE=1]="EXCLUDE"})(Cb||(Cb={}));const Lb=F.create(),Hb=r.createScreenPointArray(),Mb=J.create();
return fb});