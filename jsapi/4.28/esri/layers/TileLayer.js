// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/tslib.es6 ../../geometry ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../support/TileInfo ../support/TileInfoTilemapCache ../support/TilemapCache ../../geometry/SpatialReference".split(" "),function(l,c,h,q,n,z,u,x,R,t,G,M,S){l.ArcGISCachedService=
y=>{y=class extends y{constructor(){super(...arguments);this.copyright=null;this.maxScale=this.minScale=0;this.tilemapCache=this.tileInfo=this.spatialReference=null}destroy(){this.tilemapCache?.destroy?.()}readMinScale(H,F){return null!=F.minLOD&&null!=F.maxLOD?H:0}readMaxScale(H,F){return null!=F.minLOD&&null!=F.maxLOD?H:0}get supportsBlankTile(){return 10.2<=this.version}readTilemapCache(H,F,O){H=F.capabilities?.includes("Tilemap");let {minLOD:B,maxLOD:P,minScale:d,maxScale:f}=F;if(null==B&&null==
P&&0!==d&&0!==f){d=d?Math.round(1E4*d)/1E4:Math.round(1E4*F.tileInfo.lods[0].scale)/1E4;f=f?Math.round(1E4*f)/1E4:Math.round(1E4*F.tileInfo.lods[F.tileInfo.lods.length-1].scale)/1E4;for(var b of F.tileInfo.lods){const g=Math.round(1E4*b.scale)/1E4;B=g>=d?b.level:B;P=g>=f?b.level:P}}return H?new M.TilemapCache({layer:this,minLOD:B,maxLOD:P}):F.tileInfo?(b=new t,b.read(F.tileInfo,O),new G(b,B,P)):null}};c.__decorate([q.property({json:{read:{source:"copyrightText"}}})],y.prototype,"copyright",void 0);
c.__decorate([q.property()],y.prototype,"minScale",void 0);c.__decorate([x.reader("service","minScale")],y.prototype,"readMinScale",null);c.__decorate([q.property()],y.prototype,"maxScale",void 0);c.__decorate([x.reader("service","maxScale")],y.prototype,"readMaxScale",null);c.__decorate([q.property({type:S})],y.prototype,"spatialReference",void 0);c.__decorate([q.property({readOnly:!0})],y.prototype,"supportsBlankTile",null);c.__decorate([q.property({type:t})],y.prototype,"tileInfo",void 0);c.__decorate([q.property()],
y.prototype,"tilemapCache",void 0);c.__decorate([x.reader("service","tilemapCache",["capabilities","tileInfo"])],y.prototype,"readTilemapCache",null);c.__decorate([q.property()],y.prototype,"version",void 0);return y=c.__decorate([R.subclass("esri.layers.mixins.ArcGISCachedService")],y)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(l,c,h,q,n,z,u,x,R,t,G,M,S,y,H,F,O,B){var P;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});h=P=class extends h.JSONSupport{static create(d={}){const {resolutionFactor:f=1,scales:b,size:g=256,spatialReference:k=S.WebMercator,numLODs:p=24}=d;if(!H.isValid(k)){d=[];if(b)for(var v=0;v<b.length;v++){var r=
b[v];d.push(new O({level:v,scale:r,resolution:r}))}else for(v=5E-4,r=p-1;0<=r;r--)d.unshift(new O({level:r,scale:v,resolution:v})),v*=2;return new P({dpi:96,lods:d,origin:new M(0,0,k),size:[g,g],spatialReference:k})}v=H.getInfo(k);d=d.origin?new M({x:d.origin.x,y:d.origin.y,spatialReference:k}):v?new M({x:v.origin[0],y:v.origin[1],spatialReference:k}):new M({x:0,y:0,spatialReference:k});v=1/(39.37*q.getMetersPerUnitForSR(k)*96);r=[];if(b)for(var J=0;J<b.length;J++){var D=b[J];r.push(new O({level:J,
scale:D,resolution:D*v}))}else{var L=H.isGeographic(k)?512/g*5.916575275917094E8:256/g*5.91657527591555E8;J=Math.ceil(p/f);r.push(new O({level:0,scale:L,resolution:L*v}));for(D=1;D<J;D++)L/=2**f,r.push(new O({level:D,scale:L,resolution:L*v}))}return new P({dpi:96,lods:r,origin:d,size:[g,g],spatialReference:k})}constructor(d){super(d);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:d,origin:f}=this;if(d&&f){const b=H.getInfo(d);return d.isWrappable&&
!!b&&Math.abs(b.origin[0]-f.x)<=b.dx}return!1}readOrigin(d,f){return M.fromJSON({spatialReference:f.spatialReference,...d})}set lods(d){const f=[],b=this._levelToLOD={};d&&d.forEach(g=>{f.push(g.scale);b[g.level]=g});this._set("scales",f);this._set("lods",d);this._initializeUpsampleLevels()}readSize(d,f){return[f.cols,f.rows]}writeSize(d,f){f.cols=d[0];f.rows=d[1]}zoomToScale(d){const f=this.scales;if(0>=d)return f[0];if(d>=f.length-1)return f[f.length-1];const b=Math.floor(d);return f[b]/(f[b]/f[b+
1])**(d-b)}scaleToZoom(d){const f=this.scales,b=f.length-1;let g=0;for(;g<b;g++){const k=f[g],p=f[g+1];if(k<=d)break;if(p===d)return g+1;if(k>d&&p<d)return g+Math.log(k/d)/Math.log(k/p)}return g}snapScale(d,f=.95){d=this.scaleToZoom(d);return d%Math.floor(d)>=f?this.zoomToScale(Math.ceil(d)):this.zoomToScale(Math.floor(d))}tileAt(d,f,b,g){var k=this.lodAt(d);if(!k)return null;let p;if("number"===typeof f)p=f,f=b;else{if(H.equals(f.spatialReference,this.spatialReference))p=f.x,f=f.y;else{g=F.project(f,
this.spatialReference);if(null==g)return null;p=g.x;f=g.y}g=b}b=k.resolution*this.size[0];k=k.resolution*this.size[1];g||(g=new B.TileKey(null,0,0,0,y.create()));g.level=d;g.row=Math.floor((this.origin.y-f)/k+.001);g.col=Math.floor((p-this.origin.x)/b+.001);this.updateTileInfo(g);return g}updateTileInfo(d,f=P.ExtrapolateOptions.NONE){var b=this.lodAt(d.level);b||f!==P.ExtrapolateOptions.POWER_OF_TWO||(f=this.lods[this.lods.length-1],f.level<d.level&&(b=f));if(b){var g=d.level-b.level;f=b.resolution*
this.size[0]/2**g;b=b.resolution*this.size[1]/2**g;d.id=`${d.level}/${d.row}/${d.col}`;d.extent||(d.extent=y.create());d.extent[0]=this.origin.x+d.col*f;d.extent[1]=this.origin.y-(d.row+1)*b;d.extent[2]=d.extent[0]+f;d.extent[3]=d.extent[1]+b}}upsampleTile(d){const f=this._upsampleLevels[d.level];if(!f||-1===f.parentLevel)return!1;d.level=f.parentLevel;d.row=Math.floor(d.row/f.factor+.001);d.col=Math.floor(d.col/f.factor+.001);this.updateTileInfo(d);return!0}getTileBounds(d,f){var b=this.lodAt(f.level);
if(null==b)return null;var {resolution:g}=b;b=g*this.size[0];g*=this.size[1];d[0]=this.origin.x+f.col*b;d[1]=this.origin.y-(f.row+1)*g;d[2]=d[0]+b;d[3]=d[1]+g;return d}lodAt(d){return this._levelToLOD?.[d]??null}clone(){return P.fromJSON(this.write({}))}getOrCreateCompatible(d,f){if(256===this.size[0]&&256===this.size[1])return 256===d?this:null;const b=[],g=this.lods.length;for(let k=0;k<g;k++){const p=this.lods[k];b.push(new O({level:p.level,scale:p.scale,resolution:p.resolution*f}))}return new P({size:[d,
d],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:b})}_initializeUpsampleLevels(){const d=this.lods;this._upsampleLevels=[];let f=null;for(let b=0;b<d.length;b++){const g=d[b];this._upsampleLevels[g.level]={parentLevel:f?f.level:-1,factor:f?f.resolution/g.resolution:0};f=g}}};l.__decorate([n.property({type:Number,json:{write:!0}})],h.prototype,"compressionQuality",void 0);l.__decorate([n.property({type:Number,
json:{write:!0}})],h.prototype,"dpi",void 0);l.__decorate([n.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,write:!1}}}})],h.prototype,"format",void 0);l.__decorate([n.property({readOnly:!0})],h.prototype,"isWrappable",null);l.__decorate([n.property({type:M,json:{write:!0}})],h.prototype,"origin",void 0);l.__decorate([R.reader("origin")],h.prototype,"readOrigin",null);l.__decorate([n.property({type:[O],value:null,json:{write:!0}})],h.prototype,"lods",null);l.__decorate([n.property({readOnly:!0})],
h.prototype,"scales",void 0);l.__decorate([n.property({cast:d=>Array.isArray(d)?d:"number"===typeof d?[d,d]:[256,256]})],h.prototype,"size",void 0);l.__decorate([R.reader("size",["rows","cols"])],h.prototype,"readSize",null);l.__decorate([G.writer("size",{cols:{type:z.Integer},rows:{type:z.Integer}})],h.prototype,"writeSize",null);l.__decorate([n.property({type:S,json:{write:!0}})],h.prototype,"spatialReference",void 0);h=P=l.__decorate([t.subclass("esri.layers.support.TileInfo")],h);(function(d){d=
d.ExtrapolateOptions||(d.ExtrapolateOptions={});d[d.NONE=0]="NONE";d[d.POWER_OF_TWO=1]="POWER_OF_TWO"})(h||(h={}));return h})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(l,c,h,q,n,z,u){var x;c=x=class extends c.JSONSupport{constructor(R){super(R);this.cols=null;this.level=
0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new x({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};l.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);l.__decorate([h.property({type:q.Integer,json:{write:!0}})],c.prototype,"level",void 0);l.__decorate([h.property({type:String,json:{write:!0}})],
c.prototype,"levelValue",void 0);l.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);l.__decorate([h.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);l.__decorate([h.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0);l.__decorate([h.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);
return c=x=l.__decorate([u.subclass("esri.layers.support.LOD")],c)})},"esri/layers/support/TileKey":function(){define(["exports"],function(l){class c{constructor(h,q,n,z,u){this.id=h;this.level=q;this.row=n;this.col=z;this.extent=u}}l.TileKey=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfoTilemapCache":function(){define(["../../core/Error","../../core/promiseUtils"],function(l,c){class h{constructor(q,n=0,z=q.lods[q.lods.length-1].level){this.tileInfo=
q;this.minLOD=n;this.maxLOD=z;q.lodAt(n)||(this.minLOD=q.lods[0].level);q.lodAt(z)||(this.maxLOD=q.lods[q.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(q,n,z){const u=this.tileInfo?.lodAt(q);return!u||q<this.minLOD||q>this.maxLOD?"unavailable":u.cols&&u.rows?z>=u.cols[0]&&z<=u.cols[1]&&n>=u.rows[0]&&n<=u.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(q,
n,z,u){await c.waitTick(u);u=this.getAvailability(q,n,z);if("unavailable"===u)throw new l("tile-map:tile-unavailable","Tile is not available",{level:q,row:n,col:z});return u}async fetchAvailabilityUpsample(q,n,z,u,x){await c.waitTick(x);u.level=q;u.row=n;u.col=z;const R=this.tileInfo;R.updateTileInfo(u);return this.fetchAvailability(q,n,z,x).catch(t=>{if(c.isAbortError(t))throw t;if(R.upsampleTile(u))return this.fetchAvailabilityUpsample(u.level,u.row,u.col,u,x);throw t;})}}return h})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/ByteSizeUnit ../../core/Error ../../core/handleUtils ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/scheduling ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/subclass ./TileKey ./Tilemap".split(" "),
function(l,c,h,q,n,z,u,x,R,t,G,M,S,y,H,F,O,B,P,d){var f;l.TilemapCache=f=class extends q{constructor(b){super(b);this._pendingTilemapRequests={};this.request=h;this.size=32;this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new x.LRUCache(2*n.ByteSizeUnit.MEGABYTES);this.addHandles([G.watch(()=>{const {layer:b}=this;return[b?.parsedUrl,b?.tileServers,b?.apiKey,b?.customParameters]},()=>this._initializeTilemapDefinition(),G.initial)])}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??
this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}fetchTilemap(b,g,k,p){if(!this.layer.tileInfo.lodAt(b)||b<this.effectiveMinLOD||b>this.effectiveMaxLOD)return Promise.reject(new z("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`));const v=this._tmpTilemapDefinition;if(b=this._tilemapFromCache(b,g,k,v))return Promise.resolve(b);const r=p?.signal;p={...p,signal:null};return new Promise((J,D)=>{t.onAbort(r,()=>D(t.createAbortError()));const L=d.tilemapDefinitionId(v);
let Q=this._pendingTilemapRequests[L];if(!Q){Q=d.Tilemap.fromDefinition(v,p).then(A=>{this._tilemapCache.put(L,A,A.byteSize);return A});const T=()=>{delete this._pendingTilemapRequests[L]};this._pendingTilemapRequests[L]=Q;Q.then(T,T)}Q.then(J,D)})}getAvailability(b,g,k){return!this.layer.tileInfo.lodAt(b)||b<this.effectiveMinLOD||b>this.effectiveMaxLOD?"unavailable":(b=this._tilemapFromCache(b,g,k,this._tmpTilemapDefinition))?b.getAvailability(g,k):"unknown"}fetchAvailability(b,g,k,p){return!this.layer.tileInfo.lodAt(b)||
b<this.effectiveMinLOD||b>this.effectiveMaxLOD?Promise.reject(new z("tile-map:tile-unavailable","Tile is not available",{level:b,row:g,col:k})):this.fetchTilemap(b,g,k,p).catch(v=>v).then(v=>{if(v instanceof d.Tilemap){v=v.getAvailability(g,k);if("unavailable"===v)throw new z("tile-map:tile-unavailable","Tile is not available",{level:b,row:g,col:k});return v}if(t.isAbortError(v))throw v;return"unknown"})}fetchAvailabilityUpsample(b,g,k,p,v){p.level=b;p.row=g;p.col=k;const r=this.layer.tileInfo;r.updateTileInfo(p);
const J=this.fetchAvailability(b,g,k,v).catch(D=>{if(t.isAbortError(D))throw D;if(r.upsampleTile(p))return this.fetchAvailabilityUpsample(p.level,p.row,p.col,p,v);throw D;});this._fetchAvailabilityUpsamplePrefetch(p.id,b,g,k,v,J);return J}async _fetchAvailabilityUpsamplePrefetch(b,g,k,p,v,r){if(this._prefetchingEnabled&&null!=b){var J=`prefetch-${b}`;if(!this.hasHandles(J)){var D=new AbortController;r.then(()=>D.abort(),()=>D.abort());var L=!1;r=u.makeHandle(()=>{L||(L=!0,D.abort())});this.addHandles(r,
J);await M.waitTicks(10,D.signal).catch(()=>{});L||(L=!0,this.removeHandles(J));if(!t.isAborted(D))for(b=new P.TileKey(b,g,k,p),v={...v,signal:D.signal},g=this.layer.tileInfo,k=0;f._prefetches.length<f._maxPrefetch&&g.upsampleTile(b);++k){const Q=this.fetchAvailability(b.level,b.row,b.col,v);f._prefetches.push(Q);p=()=>{f._prefetches.removeUnordered(Q)};Q.then(p,p)}}}}_initializeTilemapDefinition(){if(this.layer.parsedUrl){var {parsedUrl:b,apiKey:g,customParameters:k}=this.layer;this._tilemapCache.clear();
this._tmpTilemapDefinition={service:{url:b.path,query:S.objectToQuery({...b.query,...k,token:g??b.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}}_tilemapFromCache(b,g,k,p){p.level=b;p.row=g-g%this.size;p.col=k-k%this.size;b=d.tilemapDefinitionId(p);return this._tilemapCache.get(b)}get test(){const b=this;return{get prefetchingEnabled(){return b._prefetchingEnabled},set prefetchingEnabled(g){b._prefetchingEnabled=g},hasTilemap(g,
k,p){return!!b._tilemapFromCache(g,k,p,b._tmpTilemapDefinition)}}}};l.TilemapCache._maxPrefetch=4;l.TilemapCache._prefetches=new R({initialSize:f._maxPrefetch});c.__decorate([y.property({constructOnly:!0})],l.TilemapCache.prototype,"layer",void 0);c.__decorate([y.property({constructOnly:!0})],l.TilemapCache.prototype,"minLOD",void 0);c.__decorate([y.property({constructOnly:!0})],l.TilemapCache.prototype,"maxLOD",void 0);c.__decorate([y.property({constructOnly:!0})],l.TilemapCache.prototype,"request",
void 0);c.__decorate([y.property({constructOnly:!0})],l.TilemapCache.prototype,"size",void 0);l.TilemapCache=f=c.__decorate([B.subclass("esri.layers.support.TilemapCache")],l.TilemapCache);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/ByteSizeUnit":function(){define(["exports"],function(l){l.ByteSizeUnit=void 0;var c=l.ByteSizeUnit||(l.ByteSizeUnit={});c[c.KILOBYTES=1024]="KILOBYTES";c[c.MEGABYTES=1048576]="MEGABYTES";c[c.GIGABYTES=1073741824]="GIGABYTES";Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Tilemap":function(){define("exports ../../request ../../core/arrayUtils ../../core/Error ../../core/lang ../../core/typedArrayUtil ../../geometry/support/UintArray".split(" "),function(l,c,h,q,n,z,u){function x(t){if(t.service.tileServers?.length){var G=t.service.tileServers;G=`${G&&G.length?G[t.row%G.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}else G=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;
(t=t.service.query)&&(G=`${G}?${t}`);return G}class R{constructor(t){this._validateJSON(t);const {location:G,data:M}=t;this.location=Object.freeze(n.clone(G));let S=t=!0;const y=u.newUintArray(Math.ceil(this.location.width*this.location.height/32));let H=0;for(let F=0;F<M.length;F++){const O=F%32;M[F]?(S=!1,y[H]|=1<<O):t=!1;31===O&&++H}S?(this._availability="unavailable",this.byteSize=40):t?(this._availability="available",this.byteSize=40):(this._availability=y,this.byteSize=40+z.estimateSize(y))}getAvailability(t,
G){if("unavailable"===this._availability||"available"===this._availability)return this._availability;t=(t-this.location.top)*this.location.width+(G-this.location.left);G=t>>5;const M=this._availability;return 0>G||G>M.length?"unknown":M[G]&1<<t%32?"available":"unavailable"}static fromDefinition(t,G){const M=t.service.request||c,{row:S,col:y,width:H,height:F}=t,O={query:{f:"json"}};G=G?{...O,...G}:O;return M(x(t),G).then(B=>B.data).catch(B=>{if(B&&B.details&&422===B.details.httpStatus)return{location:{top:S,
left:y,width:H,height:F},valid:!0,data:h.constant(H*F,0)};throw B;}).then(B=>{if(B.location&&(B.location.top!==S||B.location.left!==y||B.location.width!==H||B.location.height!==F))throw new q("tilemap:location-mismatch","Tilemap response for different location than requested",{response:B,definition:{top:S,left:y,width:H,height:F}});return R.fromJSON(B)})}static fromJSON(t){return Object.freeze(new R(t))}_validateJSON(t){if(!t?.location)throw new q("tilemap:missing-location","Location missing from tilemap response");
if(!1===t.valid)throw new q("tilemap:invalid","Tilemap response was marked as invalid");if(!t.data)throw new q("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(t.data))throw new q("tilemap:data-mismatch","Data must be an array of numbers");if(t.data.length!==t.location.width*t.location.height)throw new q("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");}}l.Tilemap=R;l.tilemapDefinitionId=function(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`};
Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/UintArray":function(){define(["exports","../../core/typedArrayUtil"],function(l,c){l.newUintArray=function(h,q=!1){return h<=c.nativeArrayMaxSize?q?Array(h).fill(0):Array(h):new Uint32Array(h)};l.uintArrayFrom=function(h){return(c.isArray(h)?h.length:h.byteLength/8)<=c.nativeArrayMaxSize?Array.from(h):new Uint32Array(h)};l.uintSubArray=function(h,q,n){return Array.isArray(h)?h.slice(q,q+n):h.subarray(q,q+n)};Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/tslib.es6 ../../request ../../core/MapUtils ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../../geometry/Extent ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../../portal/support/portalItemUtils".split(" "),
function(l,c,h,q,n,z,u,x,R,t,G,M,S,y,H,F,O,B,P){l.ArcGISMapService=d=>{d=class extends d{constructor(){super(...arguments);this.capabilities=void 0;this.fullExtent=this.copyright=null;this.legendEnabled=!0;this.spatialReference=null;this.version=void 0;this._allLayersAndTablesMap=null}readCapabilities(f,b){var g=b.capabilities&&b.capabilities.split(",").map(A=>A.toLowerCase().trim());if(!g)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var k=this.type;f="tile"!==k&&!!b.supportsDynamicLayers;const p=g.includes("query"),v=g.includes("map"),r=!!b.exportTilesAllowed,J=g.includes("tilemap");g=g.includes("data");const D="tile"!==k&&(!b.tileInfo||f),L="tile"!==k&&(!b.tileInfo||f);k="tile"!==k;var Q=b.cimVersion&&u.Version.parse(b.cimVersion);const T=Q?.since(1,4)??!1;Q=Q?.since(2,0)??!1;return{operations:{supportsExportMap:v,supportsExportTiles:r,supportsIdentify:p,supportsQuery:g,supportsTileMap:J},exportMap:v?
{supportsArcadeExpressionForLabeling:T,supportsSublayersChanges:k,supportsDynamicLayers:f,supportsSublayerVisibility:D,supportsSublayerDefinitionExpression:L,supportsCIMSymbols:Q}:null,exportTiles:r?{maxExportTilesCount:+b.maxExportTilesCount}:null}}readVersion(f,b){(f=b.currentVersion)||(f=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return f}async fetchRelatedService(f){var b=this.portalItem;if(!b||!P.isHostedLayer(b))return null;
this._relatedFeatureServicePromise||(this._relatedFeatureServicePromise=b.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},f).then(g=>g.find(k=>"Feature Service"===k.type)??null,()=>null));b=await this._relatedFeatureServicePromise;n.throwIfAborted(f);return b?{itemId:b.id,url:b.url}:null}async fetchSublayerInfo(f,b){const {source:g}=f;if(this?.portalItem&&"tile"===this.type&&"map-layer"===g?.type&&P.isHostedLayer(this.portalItem)&&f.originIdOf("url")<y.OriginId.SERVICE){var k=
await this.fetchRelatedService(b);k&&(f.url=z.join(k.url,g.mapLayerId.toString()),f.layerItemId=k.itemId)}({url:k}=f);let p;if("data-layer"===g.type)p=(await h(k,{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey},...b})).data;else if(k&&f.originIdOf("url")>y.OriginId.SERVICE)try{const v=await this._fetchAllLayersAndTablesFromService(k),r=O.parse(k)?.sublayer??g.mapLayerId;p=v.get(r)}catch{}else{f=f.id;"map-layer"===g?.type&&(f=g.mapLayerId);try{p=(await this.fetchAllLayersAndTables(b)).get(f)}catch{}}return p}async fetchAllLayersAndTables(f){return this._fetchAllLayersAndTablesFromService(this.parsedUrl?.path,
f)}async _fetchAllLayersAndTablesFromService(f,b){await this.load(b);this._allLayersAndTablesMap||(this._allLayersAndTablesMap=new Map);const g=O.parse(f);f=await q.getOrCreateMapValue(this._allLayersAndTablesMap,g?.url.path,()=>h(z.join(g?.url.path,"/layers"),{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(k=>{const p=new Map;for(const v of k.data.layers)p.set(v.id,v);return{result:p}},k=>({error:k})));n.throwIfAborted(b);if("result"in f)return f.result;throw f.error;
}};c.__decorate([x.property({readOnly:!0})],d.prototype,"capabilities",void 0);c.__decorate([M.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],d.prototype,"readCapabilities",null);c.__decorate([x.property({json:{read:{source:"copyrightText"}}})],d.prototype,"copyright",void 0);c.__decorate([x.property({type:H})],d.prototype,"fullExtent",void 0);c.__decorate([x.property(B.id)],d.prototype,"id",void 0);c.__decorate([x.property({type:Boolean,
json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],d.prototype,"legendEnabled",void 0);c.__decorate([x.property(B.popupEnabled)],d.prototype,"popupEnabled",void 0);c.__decorate([x.property({type:F})],d.prototype,"spatialReference",void 0);c.__decorate([x.property({readOnly:!0})],d.prototype,"version",void 0);c.__decorate([M.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],d.prototype,"readVersion",null);return d=
c.__decorate([S.subclass("esri.layers.mixins.ArcGISMapService")],d)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(l,c,h,q,n,z,u,x,R,t,G,M,S,y,H,F){function O(f,b){const g=[],k={};if(!f)return g;f.forEach(p=>{const v=new H;v.read(p,b);k[v.id]=v;null!=p.parentLayerId&&-1!==p.parentLayerId?(p=k[p.parentLayerId],p.sublayers||(p.sublayers=[]),p.sublayers.unshift(v)):g.unshift(v)});return g}function B(f,b){f&&f.forEach(g=>{b(g);g.sublayers&&g.sublayers.length&&B(g.sublayers,b)})}const P=z.getLogger("esri.layers.TileLayer"),d=h.ofType(H);l.SublayersOwner=f=>{f=class extends f{constructor(...b){super(...b);
this.allSublayers=new q({getCollections:()=>[this.sublayers],getChildrenFunction(g){return g.sublayers}});this.sublayersSourceJSON={[y.OriginId.SERVICE]:{},[y.OriginId.PORTAL_ITEM]:{},[y.OriginId.WEB_SCENE]:{},[y.OriginId.WEB_MAP]:{}};this.addHandles(u.watch(()=>this.sublayers,(g,k)=>this._handleSublayersChange(g,k),u.sync))}destroy(){this.allSublayers.destroy()}readSublayers(b,g){if(g&&b){var {sublayersSourceJSON:k}=this,p=y.nameToId(g.origin);if(!(p<y.OriginId.SERVICE||(k[p]={context:g,visibleLayers:b.visibleLayers||
k[p].visibleLayers,layers:b.layers||k[p].layers},p>y.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:v,origin:r}=this.createSublayersForOrigin("web-document");b=M.getProperties(this);b.setDefaultOrigin(r);this._set("sublayers",new d(v));b.setDefaultOrigin("user")}}}findSublayerById(b){return this.allSublayers.find(g=>g.id===b)}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(b){const g=
"web-document"===b?y.nameToId("web-map"):y.nameToId(b);let k=y.OriginId.SERVICE;b=this.sublayersSourceJSON[y.OriginId.SERVICE].layers;let p=this.sublayersSourceJSON[y.OriginId.SERVICE].context,v=null;var r=[y.OriginId.PORTAL_ITEM,y.OriginId.WEB_SCENE,y.OriginId.WEB_MAP].filter(A=>A<=g);for(var J of r)r=this.sublayersSourceJSON[J],F.isSublayerOverhaul(r.layers)&&(k=J,b=r.layers,p=r.context,r.visibleLayers&&(v={visibleLayers:r.visibleLayers,context:r.context}));J=[y.OriginId.PORTAL_ITEM,y.OriginId.WEB_SCENE,
y.OriginId.WEB_MAP].filter(A=>A>k&&A<=g);let D=null;for(var L of J){const {layers:A,visibleLayers:Y,context:w}=this.sublayersSourceJSON[L];A&&(D={layers:A,context:w});Y&&(v={visibleLayers:Y,context:w})}L=O(b,p);const Q=new Map,T=new Set;if(D)for(const A of D.layers)Q.set(A.id,A);if(v?.visibleLayers)for(const A of v.visibleLayers)T.add(A);B(L,A=>{D&&A.read(Q.get(A.id),D.context);v&&A.read({defaultVisibility:T.has(A.id)},v.context)});return{origin:y.idToName(k),sublayers:new d({items:L})}}read(b,g){super.read(b,
g);this.readSublayers(b,g)}_handleSublayersChange(b,g){g&&(g.forEach(k=>{k.parent=null;k.layer=null}),this.removeHandles("sublayers-owner"));b&&(b.forEach(k=>{k.parent=this;k.layer=this}),this.addHandles([b.on("after-add",({item:k})=>{k.parent=this;k.layer=this}),b.on("after-remove",({item:k})=>{k.parent=null;k.layer=null})],"sublayers-owner"),"tile"===this.type&&this.addHandles(b.on("before-changes",k=>{P.error(new n("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",
{layer:this}));k.preventDefault()}),"sublayers-owner"))}};c.__decorate([x.property({readOnly:!0})],f.prototype,"allSublayers",void 0);c.__decorate([x.property({readOnly:!0,type:h.ofType(H)})],f.prototype,"serviceSublayers",void 0);c.__decorate([x.property({value:null,type:d,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],f.prototype,"sublayers",void 0);c.__decorate([x.property({readOnly:!0})],f.prototype,"sublayersSourceJSON",void 0);return f=c.__decorate([S.subclass("esri.layers.mixins.SublayersOwner")],
f)};l.forEachSublayer=B;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/has ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../graphics/sources/support/QueryTask ./FeatureType ./Field ./FieldsIndex ./LabelClass ./labelingInfo ./LayerFloorInfo ./serviceCapabilitiesUtils ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/AttachmentQuery ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent ../../geometry/support/typeUtils".split(" "),
function(l,c,h,q,n,z,u,x,R,t,G,M,S,y,H,F,O,B,P,d,f,b,g,k,p,v,r,J,D,L,Q,T,A,Y,w,E,K,N,U,da,X,ma,ka,ea,na,oa,pa,qa,fa){function ha(a){return null!=a&&"esriSMS"===a.type}function ia(a,e,m){a=this.originIdOf(e)>=A.nameToId(m.origin);return{ignoreOrigin:!0,allowNull:a,enabled:m?"map-image"===m.layer?.type&&(m.writeSublayerStructure||a):!1}}function ja(a,e,m){return{enabled:m?"tile"===m.layer?.type&&(m.origin&&this.originIdOf(e)>=A.nameToId(m.origin)||this._isOverridden(e)):!1}}function W(a,e,m){return{ignoreOrigin:!0,
enabled:m&&m.writeSublayerStructure||!1}}function ba(a,e,m){return{ignoreOrigin:!0,enabled:m?m.writeSublayerStructure||this.originIdOf(e)>=A.nameToId(m.origin):!1}}var ca;let ra=0;const Z=new Set;Z.add("layer");Z.add("parent");Z.add("loaded");Z.add("loadStatus");Z.add("loadError");Z.add("loadWarnings");h=ca=class extends k.MultiOriginJSONMixin(d.IdentifiableMixin(b)){constructor(a){super(a);this.capabilities=void 0;this.maxScaleRange={minScale:0,maxScale:0};this.globalIdField=this.geometryType=this.fullExtent=
this.fields=null;this.legendEnabled=!0;this.parent=this.objectIdField=null;this.popupEnabled=!0;this.typeIdField=this.title=this.sourceJSON=this.popupTemplate=null;this.type="sublayer";this._lastParsedUrl=this.types=null}async load(a){this.addResolvingPromise((async()=>{const {layer:e,url:m}=this;if(!e&&!m)throw new B("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});const C=e?await e.fetchSublayerInfo(this,a):(await H(m,{responseType:"json",query:{f:"json"},
...a})).data;C&&(this.sourceJSON=C,this.read({layerDefinition:C},{origin:"service"}))})());return this}readCapabilities(a,e){e=e.layerDefinition||e;const {operations:{supportsQuery:m,supportsQueryAttachments:C},query:{supportsFormatPBF:I},data:{supportsAttachment:V}}=ma.getFeatureLayerCapabilities(e,this.url);return{exportMap:{supportsModification:!!e.canModifyLayer},operations:{supportsQuery:m,supportsQueryAttachments:C},data:{supportsAttachment:V},query:{supportsFormatPBF:I}}}get defaultPopupTemplate(){return this.createPopupTemplate()}set definitionExpression(a){this._setAndNotifyLayer("definitionExpression",
a)}get effectiveScaleRange(){const {minScale:a,maxScale:e}=this;return{minScale:a,maxScale:e}}readMaxScaleRange(a,e){e=e.layerDefinition||e;return{minScale:e.minScale??0,maxScale:e.maxScale??0}}get fieldsIndex(){return new N(this.fields||[])}set floorInfo(a){this._setAndNotifyLayer("floorInfo",a)}readGlobalIdFieldFromService(a,e){e=e.layerDefinition||e;if(e.globalIdField)return e.globalIdField;if(e.fields)for(const m of e.fields)if("esriFieldTypeGlobalID"===m.type)return m.name}get id(){const a=this._get("id");
return null==a?ra++:a}set id(a){this._get("id")!==a&&(!1===this.layer?.capabilities?.exportMap?.supportsDynamicLayers?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}set labelingInfo(a){this._setAndNotifyLayer("labelingInfo",a)}writeLabelingInfo(a,e,m,C){a&&a.length&&(e.layerDefinition={drawingInfo:{labelingInfo:a.map(I=>I.write({},C))}})}set labelsVisible(a){this._setAndNotifyLayer("labelsVisible",a)}set layer(a){this._set("layer",
a);this.sublayers&&this.sublayers.forEach(e=>e.layer=a)}set listMode(a){this._set("listMode",a)}set minScale(a){this._setAndNotifyLayer("minScale",a)}readMinScale(a,e){return e.minScale||e.layerDefinition?.minScale||0}set maxScale(a){this._setAndNotifyLayer("maxScale",a)}readMaxScale(a,e){return e.maxScale||e.layerDefinition?.maxScale||0}readObjectIdFieldFromService(a,e){e=e.layerDefinition||e;if(e.objectIdField)return e.objectIdField;if(e.fields)for(const m of e.fields)if("esriFieldTypeOID"===m.type)return m.name}set opacity(a){this._setAndNotifyLayer("opacity",
a)}readOpacity(a,e){a=e.layerDefinition;return 1-.01*((null!=a?.transparency?a.transparency:a?.drawingInfo?.transparency)??0)}writeOpacity(a,e,m,C){e.layerDefinition={drawingInfo:{transparency:100-100*a}}}writeParent(a,e){e.parentLayerId=this.parent&&this.parent!==this.layer?T.ensureInteger(this.parent.id):-1}get queryTask(){if(!this.layer)return null;const {spatialReference:a}=this.layer,e="gdbVersion"in this.layer?this.layer.gdbVersion:void 0,{capabilities:m,fieldsIndex:C}=this,I=P("featurelayer-pbf")&&
m?.query.supportsFormatPBF;return new w({url:this.url,pbfSupported:I,fieldsIndex:C,gdbVersion:e,sourceSpatialReference:a,queryAttachmentsSupported:m?.operations?.supportsQueryAttachments??!1})}set renderer(a){if(a)for(const e of a.getSymbols())if(F.isSymbol3D(e)){g.getLogger(this).warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)}get source(){return this._get("source")||new ea.MapLayerSource({mapLayerId:this.id})}set source(a){this._setAndNotifyLayer("source",
a)}set sublayers(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}castSublayers(a){return T.ensureType(O.ofType(ca),a)}writeSublayers(a,e,m){this.sublayers?.length&&(e[m]=this.sublayers.map(C=>C.id).toArray().reverse())}readTitle(a,e){return e.layerDefinition?.name??e.name}readTypeIdField(a,e){e=e.layerDefinition||e;let m=e.typeIdField;m&&e.fields&&(m=m.toLowerCase(),a=e.fields.find(C=>C.name.toLowerCase()===m))&&(m=a.name);return m}get url(){const a=this.layer?.parsedUrl??
this._lastParsedUrl;var e=this.source;if(!a)return null;this._lastParsedUrl=a;if("map-layer"===e?.type)return`${a.path}/${e.mapLayerId}`;e={layer:JSON.stringify({source:this.source})};return`${a.path}/dynamicLayer?${v.objectToQuery(e)}`}set url(a){this._overrideIfSome("url",a)}set visible(a){this._setAndNotifyLayer("visible",a)}writeVisible(a,e,m,C){e[m]=this.getAtOrigin("defaultVisibility","service")||a}clone(){const {store:a}=Y.getProperties(this),e=new ca;Y.getProperties(e).store=a.clone(Z);this.commitProperty("url");
e._lastParsedUrl=this._lastParsedUrl;return e}createPopupTemplate(a){return pa.createPopupTemplate(this,a)}createQuery(){return new oa({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})}async createFeatureLayer(){if(this.hasOwnProperty("sublayers"))return null;var a=(await new Promise((C,I)=>l(["../FeatureLayer"],V=>C(Object.freeze(Object.defineProperty({__proto__:null,default:V},Symbol.toStringTag,{value:"Module"}))),I))).default;const {layer:e,url:m}=this;if(m&&this.originIdOf("url")>
A.OriginId.SERVICE)a=new a({url:m});else if(e?.parsedUrl){const C=e.parsedUrl;a=new a({url:C.path});C&&this.source&&("map-layer"===this.source.type?a.layerId=this.source.mapLayerId:a.dynamicDataSource=this.source)}else throw new B("createFeatureLayer:missing-information","Cannot create a FeatureLayer without a url or a parent layer");null!=e?.refreshInterval&&(a.refreshInterval=e.refreshInterval);this.definitionExpression&&(a.definitionExpression=this.definitionExpression);this.floorInfo&&(a.floorInfo=
f.clone(this.floorInfo));this.originIdOf("labelingInfo")>A.OriginId.SERVICE&&(a.labelingInfo=f.clone(this.labelingInfo));this.originIdOf("labelsVisible")>A.OriginId.DEFAULTS&&(a.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>A.OriginId.DEFAULTS&&(a.legendEnabled=this.legendEnabled);this.originIdOf("visible")>A.OriginId.DEFAULTS&&(a.visible=this.visible);this.originIdOf("minScale")>A.OriginId.DEFAULTS&&(a.minScale=this.minScale);this.originIdOf("maxScale")>A.OriginId.DEFAULTS&&
(a.maxScale=this.maxScale);this.originIdOf("opacity")>A.OriginId.DEFAULTS&&(a.opacity=this.opacity);this.originIdOf("popupTemplate")>A.OriginId.DEFAULTS&&(a.popupTemplate=f.clone(this.popupTemplate));this.originIdOf("renderer")>A.OriginId.SERVICE&&(a.renderer=f.clone(this.renderer));"data-layer"===this.source?.type&&(a.dynamicDataSource=this.source.clone());this.originIdOf("title")>A.OriginId.DEFAULTS&&(a.title=this.title);"map-image"===e?.type&&e.originIdOf("customParameters")>A.OriginId.DEFAULTS&&
(a.customParameters=e.customParameters);"tile"===e?.type&&e.originIdOf("customParameters")>A.OriginId.DEFAULTS&&(a.customParameters=e.customParameters);return a}getField(a){return this.fieldsIndex.get(a)}getFeatureType(a){const {typeIdField:e,types:m}=this;if(!e||!a)return null;const C=a.attributes?a.attributes[e]:void 0;if(null==C)return null;let I=null;m?.some(V=>{const {id:aa}=V;if(null==aa)return!1;aa.toString()===C.toString()&&(I=V);return!!I});return I}getFieldDomain(a,e){return(e=this.getFeatureType(e?.feature))&&
(e=e.domains&&e.domains[a])&&"inherited"!==e.type?e:this._getLayerDomain(a)}async queryAttachments(a,e){await this.load();a=na.from(a);const m=this.capabilities;if(!m?.data?.supportsAttachment)throw new B("queryAttachments:not-supported","this layer doesn't support attachments");const {attachmentTypes:C,objectIds:I,globalIds:V,num:aa,size:sa,start:ta,where:la}=a;if(!m?.operations?.supportsQueryAttachments&&(0<C?.length||0<V?.length||0<sa?.length||aa||ta||la))throw new B("queryAttachments:option-not-supported",
"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",a);if(!(I?.length||V?.length||la))throw new B("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",a);return this.queryTask.executeAttachmentQuery(a,e)}async queryFeatures(a=this.createQuery(),e){await this.load();if(!this.capabilities.operations.supportsQuery)throw new B("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new B("queryFeatures:not-supported",
"this layer has no url.");a=await this.queryTask.execute(a,{...e,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(a?.features)for(const m of a.features)m.sourceLayer=this;return a}toExportImageJSON(a){const e={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,type:"mapLayer"}};a=p.sqlAnd(a,this.definitionExpression);null!=a&&(e.definitionExpression=a);const m=["renderer","labelingInfo","opacity","labelsVisible"].reduce((C,I)=>{C[I]=this.originIdOf(I);return C},{});
if(Object.keys(m).some(C=>m[C]>A.OriginId.SERVICE)){a=e.drawingInfo={};m.renderer>A.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null);m.labelsVisible>A.OriginId.SERVICE&&(a.showLabels=this.labelsVisible);if(this.labelsVisible&&m.labelingInfo>A.OriginId.SERVICE)if(this.labelingInfo){!this.loaded&&this.labelingInfo?.some(I=>!I.labelPlacement)&&g.getLogger(this).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' `+"and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.",
{sublayer:this});let C=this.labelingInfo;null!=this.geometryType&&(C=da.validateLabelingInfo(this.labelingInfo,fa.featureGeometryTypeKebabDictionary.toJSON(this.geometryType)));a.showLabels=!0;a.labelingInfo=C.filter(I=>I.labelPlacement).map(I=>I.toJSON({origin:"service",layer:this.layer}))}else a.showLabels=!1;m.opacity>A.OriginId.SERVICE&&(a.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(a.renderer)}return e}_assignDefaultSymbolColors(a){this._forEachSimpleMarkerSymbols(a,e=>
{e.color||"esriSMSX"!==e.style&&"esriSMSCross"!==e.style||(e.color=e.outline?.color?e.outline.color:[0,0,0,0])})}_forEachSimpleMarkerSymbols(a,e){if(a){const m=("uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:null)??[];for(const C of m)ha(C.symbol)&&e(C.symbol);"symbol"in a&&ha(a.symbol)&&e(a.symbol);"defaultSymbol"in a&&ha(a.defaultSymbol)&&e(a.defaultSymbol)}}_setAndNotifyLayer(a,e){const m=this.layer,C=this._get(a);let I,V;switch(a){case "definitionExpression":case "floorInfo":I=
"supportsSublayerDefinitionExpression";break;case "minScale":case "maxScale":case "visible":I="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":I="supportsDynamicLayers",V="supportsModification"}const aa=Y.getProperties(this).getDefaultOrigin();if("service"!==aa){if(I&&!1===this.layer?.capabilities?.exportMap?.[I]){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${I}'`);return}if(V&&!1===this.capabilities?.exportMap[V]){this._logLockedError(a,
`capability not available 'capabilities.exportMap.${V}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,e),"service"!==aa&&C!==e&&m&&m.emit&&m.emit("sublayer-update",{propertyName:a,target:this}))}_handleSublayersChange(a,e){e&&(e.forEach(m=>{m.parent=null;m.layer=null}),this.removeAllHandles());a&&(a.forEach(m=>{m.parent=this;m.layer=this.layer}),this.addHandles([a.on("after-add",({item:m})=>{m.parent=
this;m.layer=this.layer}),a.on("after-remove",({item:m})=>{m.parent=null;m.layer=null}),a.on("before-changes",m=>{const C=this.layer?.capabilities?.exportMap?.supportsSublayersChanges;null==C||C||(g.getLogger(this).error(new B("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),m.preventDefault())})]))}_logLockedError(a,e){const {layer:m,declaredClass:C}=this;g.getLogger(C).error(new B("sublayer:locked",`Property '${String(a)}' can't be changed on Sublayer from the layer '${m?.id}'`,
{reason:e,sublayer:this,layer:m}))}_getLayerDomain(a){return(a=this.fieldsIndex.get(a))?a.domain:null}};h.test={isMapImageLayerOverridePolicy:a=>a===W||a===ia,isTileImageLayerOverridePolicy:a=>a===ja};c.__decorate([r.property({readOnly:!0})],h.prototype,"capabilities",void 0);c.__decorate([D.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],h.prototype,"readCapabilities",null);c.__decorate([r.property()],h.prototype,"defaultPopupTemplate",null);c.__decorate([r.property({type:String,
value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:ia}}})],h.prototype,"definitionExpression",null);c.__decorate([r.property({readOnly:!0})],h.prototype,"effectiveScaleRange",null);c.__decorate([D.reader("service","maxScaleRange",["minScale","maxScale"])],h.prototype,"readMaxScaleRange",null);c.__decorate([r.property({type:[K],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],h.prototype,"fields",void 0);c.__decorate([r.property({readOnly:!0})],
h.prototype,"fieldsIndex",null);c.__decorate([r.property({type:X,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:ia},origins:{"web-scene":{read:!1,write:!1}}}})],h.prototype,"floorInfo",null);c.__decorate([r.property({type:qa,json:{read:{source:"layerDefinition.extent"}}})],h.prototype,"fullExtent",void 0);c.__decorate([r.property({type:fa.featureGeometryTypeKebabDictionary.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",
read:{reader:fa.featureGeometryTypeKebabDictionary.read}}}}})],h.prototype,"geometryType",void 0);c.__decorate([r.property({type:String})],h.prototype,"globalIdField",void 0);c.__decorate([D.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],h.prototype,"readGlobalIdFieldFromService",null);c.__decorate([r.property({type:T.Integer,json:{write:{ignoreOrigin:!0}}})],h.prototype,"id",null);c.__decorate([r.property({value:null,type:[U],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},
write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:W}}})],h.prototype,"labelingInfo",null);c.__decorate([Q.writer("labelingInfo")],h.prototype,"writeLabelingInfo",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:W}}})],h.prototype,"labelsVisible",null);c.__decorate([r.property({value:null})],h.prototype,"layer",null);c.__decorate([r.property({type:String,
json:{write:{overridePolicy:ja}}})],h.prototype,"layerItemId",void 0);c.__decorate([r.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:ba}}})],h.prototype,"legendEnabled",void 0);c.__decorate([r.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],h.prototype,"listMode",null);c.__decorate([r.property({type:Number,value:0,json:{write:{overridePolicy:W}}})],
h.prototype,"minScale",null);c.__decorate([D.reader("minScale",["minScale","layerDefinition.minScale"])],h.prototype,"readMinScale",null);c.__decorate([r.property({type:Number,value:0,json:{write:{overridePolicy:W}}})],h.prototype,"maxScale",null);c.__decorate([D.reader("maxScale",["maxScale","layerDefinition.maxScale"])],h.prototype,"readMaxScale",null);c.__decorate([r.property({type:String})],h.prototype,"objectIdField",void 0);c.__decorate([D.reader("service","objectIdField",["layerDefinition.objectIdField",
"layerDefinition.fields"])],h.prototype,"readObjectIdFieldFromService",null);c.__decorate([r.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:W}}})],h.prototype,"opacity",null);c.__decorate([D.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],h.prototype,"readOpacity",null);c.__decorate([Q.writer("opacity")],h.prototype,"writeOpacity",null);c.__decorate([r.property({json:{type:T.Integer,write:{target:"parentLayerId",
writerEnsuresNonNull:!0,overridePolicy:W}}})],h.prototype,"parent",void 0);c.__decorate([Q.writer("parent")],h.prototype,"writeParent",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(a,e){return!e.disablePopup}},write:{target:"disablePopup",overridePolicy:ba,writer(a,e,m){e[m]=!a}}}})],h.prototype,"popupEnabled",void 0);c.__decorate([r.property({type:q,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:ba}}})],h.prototype,"popupTemplate",
void 0);c.__decorate([r.property({readOnly:!0})],h.prototype,"queryTask",null);c.__decorate([r.property({types:y.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:W},origins:{"web-scene":{types:y.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:W}}}}})],h.prototype,"renderer",null);c.__decorate([r.property({types:{key:"type",base:null,typeMap:{"data-layer":ka.DataLayerSource,"map-layer":ea.MapLayerSource}},cast(a){if(a){if("mapLayerId"in
a)return T.ensureClass(ea.MapLayerSource,a);if("dataSource"in a)return T.ensureClass(ka.DataLayerSource,a)}return a},json:{name:"layerDefinition.source",write:{overridePolicy:W}}})],h.prototype,"source",null);c.__decorate([r.property()],h.prototype,"sourceJSON",void 0);c.__decorate([r.property({value:null,json:{type:[T.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:W}}})],h.prototype,"sublayers",null);c.__decorate([J.cast("sublayers")],h.prototype,"castSublayers",null);c.__decorate([Q.writer("sublayers")],
h.prototype,"writeSublayers",null);c.__decorate([r.property({type:String,json:{name:"name",write:{overridePolicy:ba}}})],h.prototype,"title",void 0);c.__decorate([D.reader("service","title",["name","layerDefinition.name"])],h.prototype,"readTitle",null);c.__decorate([r.property({type:String})],h.prototype,"typeIdField",void 0);c.__decorate([r.property({json:{read:!1},readOnly:!0,value:"sublayer"})],h.prototype,"type",void 0);c.__decorate([D.reader("typeIdField",["layerDefinition.typeIdField"])],h.prototype,
"readTypeIdField",null);c.__decorate([r.property({type:[E],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],h.prototype,"types",void 0);c.__decorate([r.property({type:String,json:{name:"layerUrl",write:{overridePolicy:ja}}})],h.prototype,"url",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:W}}})],h.prototype,"visible",null);c.__decorate([Q.writer("visible")],h.prototype,"writeVisible",
null);return h=ca=c.__decorate([L.subclass("esri.layers.support.Sublayer")],h)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/accessorSupport/PropertyOrigin"],function(l,c){function h(q,n){if(!q?.length||null==n)return!0;n=n.slice().reverse().flatten(({sublayers:x})=>x&&x.toArray().reverse()).map(x=>x.id).toArray();if(q.length>n.length)return!1;let z=0;const u=n.length;for(const {id:x}of q){for(;z<u&&n[z]!==x;)z++;if(z>=u)return!1}return!0}l.isExportDynamic=function(q,
n,z){return q.some(u=>{const x=u.source;return!(!x||"map-layer"===x.type&&x.mapLayerId===u.id&&(null==x.gdbVersion||x.gdbVersion===z))||u.originIdOf("renderer")>c.OriginId.SERVICE||u.originIdOf("labelingInfo")>c.OriginId.SERVICE||u.originIdOf("opacity")>c.OriginId.SERVICE||u.originIdOf("labelsVisible")>c.OriginId.SERVICE})?!0:!h(q,n)};l.isSublayerOverhaul=function(q){return!!q&&q.some(n=>null!=n.minScale||null!=n.layerDefinition?.minScale)};l.shouldWriteSublayerStructure=function(q,n,z){return n.flatten(({sublayers:u})=>
u).length!==q.length||q.some(u=>u.originIdOf("minScale")>z||u.originIdOf("maxScale")>z||u.originIdOf("renderer")>z||u.originIdOf("labelingInfo")>z||u.originIdOf("opacity")>z||u.originIdOf("labelsVisible")>z||u.originIdOf("source")>z)?!0:!h(q,n)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/imageBitmapUtils":function(){define(["exports","../../core/Error","../../core/promiseUtils"],function(l,c,h){l.createBitmap=async function(q,n,z){let u;try{u=await createImageBitmap(q)}catch(x){throw new c("request:server",
`Unable to load ${n}`,{url:n,error:x});}h.throwIfAborted(z);return u};l.createTileBitmap=async function(q,n,z,u,x){let R;try{R=await createImageBitmap(q)}catch(t){throw new c("request:server",`Unable to load tile ${n}/${z}/${u}`,{error:t,level:n,row:z,col:u});}h.throwIfAborted(x);return R};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../chunks/tslib.es6 ../request ../core/Error ../core/loadAll ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../geometry/SpatialReference ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/commonProperties ./support/imageBitmapUtils ./support/Sublayer".split(" "),function(l,
c,h,q,n,z,u,x,R,t,G,M,S,y,H,F,O,B,P,d,f,b,g,k,p,v,r,J,D,L,Q){var T;const A="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");n=T=
class extends f.BlendLayer(v.ScaleRangeLayer(r.SublayersOwner(B.ArcGISCachedService(P.ArcGISMapService(g.OperationalLayer(k.PortalLayer(d.ArcGISService(n.MultiOriginJSONMixin(p.RefreshableLayer(O.APIKeyMixin(b.CustomParametersMixin(F)))))))))))){constructor(...w){super(...w);this.listMode="show";this.isReference=null;this.operationalLayerType="ArcGISTiledMapServiceLayer";this.resampling=!0;this.sublayers=this.path=this.spatialReference=this.sourceJSON=null;this.type="tile";this.url=null}normalizeCtorArgs(w,
E){return"string"===typeof w?{url:w,...E}:w}load(w){const E=null!=w?w.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},w).catch(z.throwIfAbortError).then(()=>this._fetchService(E)));return Promise.resolve(this)}get attributionDataUrl(){const w=this.parsedUrl?.path.toLowerCase();return w?this._getDefaultAttribution(this._getMapName(w)):null}readSpatialReference(w,E){return(w=w||E.tileInfo?.spatialReference)&&H.fromJSON(w)}writeSublayers(w,E,K,N){if(this.loaded&&
w){w=w.slice().reverse().flatten(({sublayers:X})=>X&&X.toArray().reverse()).toArray();var U=[],da={writeSublayerStructure:!1,...N};w.forEach(X=>{X=X.write({},da);U.push(X)});U.some(X=>1<Object.keys(X).length)&&(E.layers=U)}}get tileServers(){return this._getDefaultTileServers(this.parsedUrl?.path)}castTileServers(w){return Array.isArray(w)?w.map(E=>u.urlToObject(E).path):null}fetchTile(w,E,K,N={}){({signal:N}=N);w=this.getTileUrl(w,E,K);return c(w,{responseType:"image",signal:N,query:{...this.refreshParameters}}).then(U=>
U.data)}async fetchImageBitmapTile(w,E,K,N={}){const {signal:U}=N;if(this.fetchTile!==T.prototype.fetchTile)return N=await this.fetchTile(w,E,K,N),L.createTileBitmap(N,w,E,K,U);N=this.getTileUrl(w,E,K);({data:N}=await c(N,{responseType:"blob",signal:U,query:{...this.refreshParameters}}));return L.createTileBitmap(N,w,E,K,U)}getTileUrl(w,E,K){const N=u.objectToQuery({...this.parsedUrl?.query,blankTile:!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile?!1:null,...this.customParameters,
token:this.apiKey}),U=this.tileServers;return`${U&&U.length?U[E%U.length]:this.parsedUrl?.path}/tile/${w}/${E}/${K}${N?"?"+N:""}`}loadAll(){return q.loadAll(this,w=>{w(this.allSublayers)})}_fetchService(w){return(new Promise((E,K)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new h("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");E({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new h("tile-layer:undefined-url",
"layer's url is not defined");var N=J.parse(this.parsedUrl.path);if(null!=N&&"ImageServer"===N.serverType)throw new h("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:w}).then(E,K)}})).then(E=>{let K=this.url;E.ssl&&(K=this.url=K.replace(/^http:/i,"https:"));this.sourceJSON=E.data;this.read(E.data,{origin:"service",url:this.parsedUrl});
if(10.1===this.version&&!J.isHostedAgolService(K))return this._fetchServerVersion(K,w).then(N=>{this.read({currentVersion:N})}).catch(()=>{})})}_fetchServerVersion(w,E){if(!J.isArcGISUrl(w))return Promise.reject();w=w.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return c(w,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:E}).then(K=>{if(K.data&&K.data.currentVersion)return K.data.currentVersion;throw new h("tile-layer:version-not-available");})}_getMapName(w){return(w=
w.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))?w[2]:void 0}_getDefaultAttribution(w){if(null==w)return null;let E;w=w.toLowerCase();for(let K=0,N=A.length;K<N;K++)if(E=A[K],E.toLowerCase().includes(w))return u.makeAbsolute("//static.arcgis.com/attribution/"+E);return null}_getDefaultTileServers(w){if(null==w)return[];const E=-1!==w.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),
K=-1!==w.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return E||K?[w,w.replace(E?/server\.arcgisonline/i:/services\.arcgisonline/i,E?"services.arcgisonline":"server.arcgisonline")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile[Y]}};l.__decorate([x.property({readOnly:!0})],n.prototype,"attributionDataUrl",null);l.__decorate([x.property({type:["show","hide","hide-children"]})],n.prototype,"listMode",void 0);l.__decorate([x.property({json:{read:!0,write:!0}})],n.prototype,"blendMode",
void 0);l.__decorate([x.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],n.prototype,"isReference",void 0);l.__decorate([x.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],n.prototype,"operationalLayerType",void 0);l.__decorate([x.property({type:Boolean})],n.prototype,"resampling",void 0);l.__decorate([x.property()],n.prototype,"sourceJSON",void 0);l.__decorate([x.property({type:H})],n.prototype,"spatialReference",void 0);l.__decorate([M.reader("spatialReference",
["spatialReference","tileInfo"])],n.prototype,"readSpatialReference",null);l.__decorate([x.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],n.prototype,"path",void 0);l.__decorate([x.property({readOnly:!0})],n.prototype,"sublayers",void 0);l.__decorate([y.writer("sublayers",{layers:{type:[Q]}})],n.prototype,"writeSublayers",null);l.__decorate([x.property({json:{read:!1,write:!1}})],n.prototype,"popupEnabled",void 0);l.__decorate([x.property()],n.prototype,"tileServers",
null);l.__decorate([R.cast("tileServers")],n.prototype,"castTileServers",null);l.__decorate([x.property({readOnly:!0,json:{read:!1}})],n.prototype,"type",void 0);l.__decorate([x.property(D.url)],n.prototype,"url",void 0);n=T=l.__decorate([S.subclass("esri.layers.TileLayer")],n);const Y=Symbol("default-fetch-tile");n.prototype.fetchTile[Y]=!0;return n});