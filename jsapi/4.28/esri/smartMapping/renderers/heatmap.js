// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/Logger ../../core/Error ../../renderers/support/AuthoringInfo ../../renderers/support/HeatmapColorStop ../../renderers/support/heatmapUtils ./support/utils ../statistics/heatmapStatistics ../support/utils ../support/adapters/support/layerUtils ../symbology/heatmap".split(" "),
function(m,n,S,T,U,E,V,W,X,Y,Z,aa,u,v,k,F,p,G,H,e,q){async function I(a){if(!a?.layer||!a.view)throw new u("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");a={...a,layer:a.layer,view:a.view};a.radius??(a.radius=null==a.blurRadius?18:F.gaussianBlurRadiusPxToKernelDensityRadiusPt(a.blurRadius));a.minRatio??(a.minRatio=.01);a.maxRatio??(a.maxRatio=1);a.fadeRatio??(a.fadeRatio=.2);a.fadeToTransparent??(a.fadeToTransparent=!0);var b=[e.LayerType.CSVLayer,e.LayerType.FeatureLayer,
e.LayerType.OGCFeatureLayer,e.LayerType.GeoJSONLayer,e.LayerType.StreamLayer,e.LayerType.WFSLayer],c=e.createLayerAdapter(a.layer,b);if(!c)throw new u("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+e.getLayerTypeLabels(b).join(", "));a.layer=c;await c.load(null!=a.signal?{signal:a.signal}:null);b=await H.getFieldsList({field:a.field});if(c=p.verifyBasicFieldValidity(c,b,"heatmap-renderer:invalid-parameters"))throw c;return a}async function J(a){let b=a.scheme,c=null;
var d=null;d=await p.getBasemapInfo(a.basemap,a.view);c=null!=d.basemapId?d.basemapId:null;d=null!=d.basemapTheme?d.basemapTheme:null;if(b)return{scheme:q.cloneScheme(b),basemapId:c,basemapTheme:d};if(a=q.getSchemes({basemapTheme:d}))b=a.primaryScheme,c=a.basemapId,d=a.basemapTheme;return{scheme:b,basemapId:c,basemapTheme:d}}async function K(a,b){const {fieldOffset:c}=a,{field:d,basemap:l,radius:h,fadeToTransparent:f,heatmapScheme:L,view:M}=b,{scheme:w,basemapId:N,basemapTheme:O}=await J({basemap:l,
scheme:L,view:M});var g=w.colors;const x=g.length,y=!a.count,z=y?[0,.04]:[a.min,a.max];let A;const B=b.fadeRatio??0,r=b.minRatio??0,P=((b.maxRatio??0)-r)/(x-1);b=g[0];const C=f?r:.01,t=[new k({ratio:0,color:new n([b.r,b.g,b.b,0])}),new k({ratio:.01,color:new n([b.r,b.g,b.b,0])}),new k({ratio:C,color:new n([b.r,b.g,b.b,C])})];p.createColors(g,x).forEach((Q,R)=>{t.push(new k({ratio:r+P*R,color:Q}))});f&&(D(t,B),A=new v({fadeRatio:B}));g=new E({authoringInfo:A,radius:h,colorStops:t,field:d,minDensity:z[0],
maxDensity:z[1]});null!=c&&(g.fieldOffset=c);return{renderer:g,statistics:a,defaultValuesUsed:y,scheme:q.cloneScheme(w),basemapId:N,basemapTheme:O}}function D(a,b){const c=10*(1-b)+1,d=a.length-3,l=a[2].color.a;a.forEach((h,f)=>{2>=f||({color:h}=h,f=(f-3)/d,h.a=0===b?1:Math.min(Math.max(f*c+f+l,l),1))})}m.createRenderer=async function(a){a=await I(a);const b=a.statistics??await G({layer:a.layer,field:a.field,fieldOffset:a.fieldOffset,radius:a.radius,view:a.view,signal:a.signal});return K(b,a)};m.updateRenderer=
function(a){const {fadeRatio:b,renderer:c}=a;a=c.clone();const d=null==b?a?.authoringInfo?.fadeRatio||0:b;D(a.colorStops,d);a.authoringInfo?a.authoringInfo.fadeRatio=d:a.authoringInfo=new v({fadeRatio:d});return a};Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});