// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.28/esri/copyright.txt for details.
//>>built
define("exports ./clock ./Error ./events ./Logger ./maybe".split(" "),function(f,E,u,B,F,G){function l(a="Aborted"){return new u("AbortError",a)}function v(a,b="Aborted"){if(C(a))throw l(b);}function q(a){return null!=a?"aborted"in a?a:a.signal:a}function C(a){a=q(a);return null!=a&&a.aborted}function r(a,b){a=q(a);if(null!=a)if(a.aborted)b();else return B.once(a,"abort",()=>b())}function p(a){return"AbortError"===a?.name}async function w(a){if(a){if("function"!==typeof a.forEach){const b=Object.keys(a),
d=b.map(c=>a[c]),e=await w(d),g={};b.map((c,h)=>g[c]=e[h]);return g}return Promise.allSettled(a).then(b=>Array.from(a,(d,e)=>{e=b[e];return"fulfilled"===e.status?{promise:d,value:e.value}:{promise:d,error:e.reason}}))}}function x(a,b,d){const e=new AbortController;r(d,()=>e.abort());return new Promise((g,c)=>{let h=setTimeout(()=>{h=0;g(b)},a);r(e,()=>{h&&(clearTimeout(h),c(l()))})})}function D(a){return a&&"function"===typeof a.then}function y(a){return D(a)?a:Promise.resolve(a)}function z(){let a,
b;const d=new Promise((g,c)=>{a=g;b=c}),e=g=>{a(g)};e.resolve=g=>a(g);e.reject=g=>b(g);e.timeout=(g,c)=>E.clock.setTimeout(()=>e.reject(c),g);e.promise=d;return e}f.after=x;f.allSettledErrors=async function(a){return(await Promise.allSettled(a)).filter(b=>"rejected"===b.status).map(b=>b.reason)};f.allSettledValues=async function(a){return(await Promise.allSettled(a)).filter(b=>"fulfilled"===b.status).map(b=>b.value)};f.always=function(a,b){return a.then(b,b)};f.createAbortError=l;f.createResolver=
z;f.debounce=function(a,b=-1){let d,e,g,c,h=null;const n=(...k)=>{if(d){e=k;c&&c.reject(l());c=z();k=c.promise;if(h){var t=h;h=null;t.abort()}return k}g=c||z();c=null;if(0<b){const m=new AbortController,H=d=y(a(...k,m.signal));x(b).then(()=>{d===H&&(c?m.abort():h=m)})}else d=1,d=y(a(...k));k=()=>{const m=e;e=g=d=h=null;null!=m&&n(...m)};t=d;const A=g;t.then(k,k);t.then(A.resolve,A.reject);return A.promise};return n};f.eachAlways=w;f.eachAlwaysValues=async function(a){return(await w(a)).filter(b=>
!!b.value).map(b=>b.value)};f.filter=async function(a,b){const d=a.slice(),e=await Promise.all(a.map((g,c)=>b(g,c)));return d.filter((g,c)=>e[c])};f.ignoreAbortErrors=async function(a){try{return await a}catch(b){if(!p(b))throw b;}};f.isAbortError=p;f.isAborted=C;f.isPromiseLike=D;f.logOnError=async function(a,b=F.getLogger("esri")){try{return await a}catch(d){p(d)||b.error(d)}};f.onAbort=r;f.onAbortOrThrow=function(a,b){a=q(a);if(null!=a)return v(a),B.once(a,"abort",()=>b(l()))};f.settleWithPromise=
function(a,b){b.then(a.resolve,a.reject)};f.throwIfAbortError=function(a){if(p(a))throw a;};f.throwIfAborted=v;f.throwIfNotAbortError=function(a){if(!p(a))throw a;};f.timeout=function(a,b,d,e){const g=d&&"abort"in d?d:null;null!=e||g||(e=d);let c=setTimeout(()=>{c=0;g?.abort()},b);const h=()=>e||new u("promiseUtils:timeout","The wrapped promise did not resolve within "+b+" ms");return a.then(n=>{if(0===c)throw h();clearTimeout(c);return n},n=>{clearTimeout(c);throw 0===c?h():n;})};f.waitTick=async function(a){await Promise.resolve();
v(a)};f.when=y;f.whenOrAbort=function(a,b){return null==q(b)?a:new Promise((d,e)=>{let g=r(b,()=>e(l()));const c=()=>{g=G.removeMaybe(g)};a.then(c,c);a.then(d,e)})};f.whenOrTimeout=function(a,b,d){return Promise.race([a,x(b).then(()=>{throw new u("timeout",`Did not resolve within ${b} milliseconds (${d??"timeout"})`);})])};Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});