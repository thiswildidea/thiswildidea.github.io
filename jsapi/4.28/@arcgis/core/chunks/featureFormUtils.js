/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{substitute as e}from"../intl.js";import{i as t}from"./typedArrayUtil.js";import{n}from"./compilerUtils.js";import{t as r,r as a}from"./Logger.js";import{isTimeOnlyField as i,a as o,b as s,D as l,NumericRangeValidationError as u,TypeValidationError as m}from"../layers/support/fieldUtils.js";import{i as p}from"./utils2.js";const d=e=>"field"===e?.type,c=e=>"group"===e?.type,f=e=>"relationship"===e?.type,y=e=>!c(e)&&null!=e.group,b=e=>"field"===e.type,T=e=>"group"===e.type,E=e=>"relationship"===e.type,g=e=>e.reduce(((e,t)=>c(t)?[...e,...t.inputs]:[...e,t]),[]),v=e=>g(e).filter(d),x=e=>g(e).filter(f),O=e=>null!=e&&(j(e,"combo-box")||j(e,"radio-buttons")),j=(e,t)=>null!=e&&e.input?.type===t,h=e=>null!=e&&(j(e,"text-box")||j(e,"text-area")),V=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type),L=e=>"items"in e,N={typeFieldName:null,types:[]};function _(e){const{attributes:n,fieldsIndex:i,label:o,timeZone:s}=e;if(!n||"object"!=typeof n)return o;const l=Object.keys(n).filter((e=>r(o,e))),u=l.map((e=>n[e])),m=l.map((e=>i.get(e))).filter(t);return function(e,t){return a(a(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t]))))}(o,A({values:u,fields:m,timeZone:s}))}function A(e){const{fields:t,values:n}=e,r=e.timeZone??void 0,a=t.map(((e,t)=>{let a=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===a));t?.name&&(a=t.name)}return(p(e)||i(e))&&(a=o(e,a,{timeZone:r,...s(e)})),[e.name,a]}));return Object.fromEntries(a)}const U=e=>e?"subtype-sublayer"===e.type?{typeFieldName:e.parent?.subtypeField,types:e.parent?.subtypes??[]}:"types"in e&&e.types?{typeFieldName:e.typeIdField,types:e.types.map((({id:e,name:t,domains:n})=>({code:e,name:t,domains:n})))}:N:N,I=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};var D;!function(e){e.TOO_SHORT="length-validation-error::too-short"}(D||(D={}));const F={type:"number"},R={type:"number",intlOptions:{notation:"scientific"}},w={day:"2-digit",month:"2-digit",year:"numeric"},Z={hour:"numeric",minute:"numeric",second:"numeric"},C={...w,...Z};function S(e){return e>=1e7||e<=-1e7}const k=(t,n,r)=>{const{dataType:a,error:i,minLength:o,value:s,required:p}=t;if(!n||!i)return null;if(p&&null===s)return n.validationErrors.cannotBeNull;if(i===l.VALUE_OUT_OF_RANGE||i===u.OUT_OF_RANGE){const{field:i,range:o}=t,s={type:"date",intlOptions:{..."time-only"===i.type?Z:"date-only"===i.type?w:C,timeZone:r??void 0}};return e(n.validationErrors.outsideRange,o,{format:{max:"date"===a?s:null!=o.max&&S(o.max)?R:F,min:"date"===a?s:null!=o.min&&S(o.min)?R:F}})}return i===l.INVALID_CODED_VALUE?n.validationErrors.invalidCodedValue:i===m.INVALID_TYPE?n.validationErrors.invalidType:i===D.TOO_SHORT?e(n.validationErrors.tooShort,{min:o}):null},q=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return"polyline"===r||"polyline"===n?"line":r||n||"table"},G=e=>{const t=[];if(e.formTemplate){const{description:n,title:a}=e.formTemplate;e.fields?.forEach((e=>{const i=a&&r(a,e.name),o=n&&r(n,e.name);(i||o)&&t.push(e.name)}))}return t};function H(e){return!(!("formTemplate"in e)||!e.formTemplate)&&(e.formTemplate.elements?.filter(b)??[]).some((({fieldName:t})=>!e.fieldsIndex.get(t)))}function P(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function B(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return n(t.objectType),!1}}export{D as L,d as a,f as b,y as c,j as d,q as e,V as f,k as g,L as h,c as i,H as j,v as k,x as l,T as m,b as n,E as o,_ as p,U as q,P as r,h as s,O as t,A as u,B as v,I as w,G as x};
