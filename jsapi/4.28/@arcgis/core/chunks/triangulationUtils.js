/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{e as t}from"./earcut.js";import{A as n}from"./Axis.js";import e,{i as o}from"../geometry/Polygon.js";import{d as r,a as s,n as i}from"./DoubleArray.js";import{g as a,c}from"./Indices.js";import{d as l}from"./deduplicate.js";import"../geometry.js";import{d as u}from"./mathUtils.js";import{g as f,q as h}from"./unitUtils.js";import{s as p}from"./vec3.js";import{c as g,n as m,h as d}from"./plane.js";import{A as b}from"./Attribute.js";import{C as y}from"./ContentObject.js";import{G as A}from"./Geometry.js";import{V as w}from"./VertexAttribute.js";import j from"../geometry/Extent.js";function I(t,e,o){const r=function(t,n,e,o){const r=(s=n,Array.isArray(s[0])?(t,e)=>n[t][e]:(t,e)=>n[3*t+e]);var s;const i=o?f(o)/h(o):1;return d(t,((t,n)=>p(t,r(n,0)*i,r(n,1)*i,r(n,2))),e)}(C,t,e,o)?m(C):[0,0,1];return Math.abs(r[2])>Math.cos(u(80))?n.Z:Math.abs(r[1])>Math.abs(r[0])?n.Y:n.X}const C=g();function O(e,o,r){const s=I(e,(o.length>0?o[0]:e.length/3)-1,r);if(s!==n.Z){e=e.slice();for(let t=0;t<e.length;t+=3)e[t+s]=e[t+2]}return t(e,o,3)}function D(t){const n=[[w.POSITION,new b(t.attributeData.position,t.indices,3,!0)]],e=a(t.indices.length);return null!=t.attributeData.colorFeature?n.push([w.COLORFEATUREATTRIBUTE,new b([t.attributeData.colorFeature],e,1,!0)]):t.attributeData.color&&n.push([w.COLOR,new b(t.attributeData.color,e,4,!0)]),t.attributeData.uvMapSpace&&n.push([w.UVMAPSPACE,new b(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&n.push([w.BOUNDINGRECT,new b(t.attributeData.boundingRect,t.indices,9,!0)]),new A(t.material,n,t.mapPositions,y.Mesh,t.attributeData.objectAndLayerIdColor)}function E(t,n=null){const e=[[w.POSITION,new b(t.attributeData.position,t.indices,3,!0)],[w.UV0,new b(t.attributeData.uv0,t.indices,2,!0)]];return new A(t.material,e,t.mapPositions,y.Mesh,n)}function x(t){switch(t.type){case"extent":if(t instanceof j)return e.fromExtent(t);break;case"polygon":return t}return null}class L{constructor(t,n,e){this.renderData=t,this.layerUid=n,this.graphicUid=e,this.outGeometries=new Array}}function M(n){const e=S(n.rings,n.hasZ,P.CCW_IS_HOLE,n.spatialReference),o=new Array;let a=0,u=0;for(const n of e.polygons){const s=n.count,i=n.index,l=r(e.position,3*i,3*s),f=n.holeIndices.map((t=>t-i)),h=c(t(l,f,3));o.push({position:l,faces:h}),a+=l.length,u+=h.length}const f=function(t,n,e){if(1===t.length)return t[0];const o=i(n),r=new Array(e);let s=0,a=0,l=0;for(const n of t){for(let t=0;t<n.position.length;t++)o[s++]=n.position[t];for(const t of n.faces)r[a++]=t+l;l=s/3}return{position:o,faces:c(r)}}(o,a,u),h=Array.isArray(f.position)?l(f.position,3,{originalIndices:f.faces}):l(f.position.buffer,6,{originalIndices:f.faces});return f.position=s(new Float64Array(h.buffer)),f.faces=h.indices,f}function S(t,n,e,o){const r=t.length,s=new Array(r),a=new Array(r),c=new Array(r);let l=0,u=0,f=0,h=0;for(let n=0;n<r;++n)h+=t[n].length;const p=i(3*h);let g=0;for(let i=r-1;i>=0;i--){const h=t[i],m=e===P.CCW_IS_HOLE&&N(h,n,o);if(m&&1!==r)s[l++]=h;else{let t=h.length;for(let n=0;n<l;++n)t+=s[n].length;const e={index:g,pathLengths:new Array(l+1),count:t,holeIndices:new Array(l)};e.pathLengths[0]=h.length,h.length>0&&(c[f++]={index:g,count:h.length}),g=m?U(h,h.length-1,-1,p,g,h.length,n):U(h,0,1,p,g,h.length,n);for(let t=0;t<l;++t){const o=s[t];e.holeIndices[t]=g,e.pathLengths[t+1]=o.length,o.length>0&&(c[f++]={index:g,count:o.length}),g=U(o,0,1,p,g,o.length,n)}l=0,e.count>0&&(a[u++]=e)}}for(let t=0;t<l;++t){const e=s[t];e.length>0&&(c[f++]={index:g,count:e.length}),g=U(e,0,1,p,g,e.length,n)}return a.length=u,c.length=f,{position:p,polygons:a,outlines:c}}function U(t,n,e,o,r,s,i){r*=3;for(let a=0;a<s;++a){const s=t[n];o[r++]=s[0],o[r++]=s[1],o[r++]=i?s[2]:0,n+=e}return r/3}function N(t,e,r){if(e){const e=I(t,t.length-1,r);if(e===n.X)return!o(t,n.Y,n.Z);if(e===n.Y)return!o(t,n.X,n.Z)}return!o(t,n.X,n.Y)}var P;!function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(P||(P={}));export{P as C,L as P,D as a,E as b,O as c,x as g,S as p,M as t};
