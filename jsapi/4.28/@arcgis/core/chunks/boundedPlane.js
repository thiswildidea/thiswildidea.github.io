/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import"./typedArrayUtil.js";import{L as s}from"./Logger.js";import{b as i}from"./mathUtils.js";import{O as n,s as t,i as a,p as o}from"./vector.js";import{i as r,t as e,f as c}from"./mat4.js";import{a as u}from"./mat4f64.js";import{c as g,i as b,l as f,t as l,q as p,d as m,s as d,h,F as I,b as j,e as P,p as v,n as N}from"./vec3.js";import{f as w,a as M,c as y}from"./vec3f64.js";import{A}from"./Axis.js";import{c as T,p as S,d as _}from"./lineSegment.js";import{c as x,q as O,n as V,r as E,w as q,j as F,t as Y,o as B,u as L,v as U,a as C,p as R}from"./plane.js";const k=s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),z=class{constructor(){this.plane=x(),this.origin=y(),this.basis1=y(),this.basis2=y()}};function G(s=ls){return{plane:x(s.plane),origin:M(s.origin),basis1:M(s.basis1),basis2:M(s.basis2)}}function W(s,i=G()){return X(s.origin,s.basis1,s.basis2,i)}function X(s,i,n,t=G()){return g(t.origin,s),g(t.basis1,i),g(t.basis2,n),Z(t),a=t,o="fromValues()",Math.abs(b(a.basis1,a.basis2)/(f(a.basis1)*f(a.basis2)))>1e-6&&k.warn(o,"Provided basis vectors are not perpendicular"),Math.abs(b(a.basis1,cs(a)))>1e-6&&k.warn(o,"Basis vectors and plane normal are not perpendicular"),Math.abs(-b(cs(a),a.origin)-a.plane[3])>1e-6&&k.warn(o,"Plane offset is not consistent with plane origin"),t;var a,o}function Z(s){O(s.basis2,s.basis1,s.origin,s.plane)}function D(s,i,n){s!==n&&W(s,n);const a=p(t.get(),cs(s),i);return m(n.origin,n.origin,a),n.plane[3]-=i,n}function H(s,i=G()){const n=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return d(i.origin,s[0]+n,s[1]+t,0),d(i.basis1,n,0,0),d(i.basis2,0,t,0),Y(0,0,1,0,i.plane),i}function J(s,i,n){return!!B(s.plane,i,n)&&us(s,n)}function K(s,n,a){const o=ps.get();fs(s,n,o,ps.get());let r=Number.POSITIVE_INFINITY;for(const e of Is){const c=bs(s,e,ms.get()),u=t.get();if(L(o,c,u)){const s=I(t.get(),n.origin,u),o=Math.abs(i(b(n.direction,s)));o<r&&(r=o,g(a,u))}}return r===Number.POSITIVE_INFINITY?Q(s,n,a):a}function Q(s,i,n){if(J(s,i,n))return n;const o=ps.get(),r=ps.get();fs(s,i,o,r);let e=Number.POSITIVE_INFINITY;for(const c of Is){const u=bs(s,c,ms.get()),b=t.get();if(U(o,u,b)){const s=a(i,b);if(!C(r,b))continue;s<e&&(e=s,g(n,b))}}return is(s,i.origin)<e&&$(s,i.origin,n),n}function $(s,i,n){const a=R(s.plane,i,t.get()),o=S(gs(s,s.basis1),a,-1,1,t.get()),r=S(gs(s,s.basis2),a,-1,1,t.get());return j(n,m(t.get(),o,r),s.origin),n}function ss(s,i,n){const{origin:a,basis1:r,basis2:e}=s,c=j(t.get(),i,a),u=o(r,c),g=o(e,c),b=o(cs(s),c);return d(n,u,g,b)}function is(s,i){const n=ss(s,i,t.get()),{basis1:a,basis2:o}=s,r=f(a),e=f(o),c=Math.max(Math.abs(n[0])-r,0),u=Math.max(Math.abs(n[1])-e,0),g=n[2];return c*c+u*u+g*g}function ns(s,i){return Math.sqrt(is(s,i))}function ts(s,i){return C(s.plane,i)&&us(s,i)}function as(s,i){const n=-s.plane[3];return o(cs(s),i)-n}function os(s,i){return P(s.basis1,i.basis1)&&P(s.basis2,i.basis2)&&P(s.origin,i.origin)}function rs(s,i,n){return s!==n&&W(s,n),r(js,i),e(js,js),l(n.basis1,s.basis1,js),l(n.basis2,s.basis2,js),l(V(n.plane),V(s.plane),js),l(n.origin,s.origin,i),E(n.plane,n.plane,n.origin),n}function es(s,i,n,t){return s!==t&&W(s,t),c(Ps,i,n),l(t.basis1,s.basis1,Ps),l(t.basis2,s.basis2,Ps),Z(t),t}function cs(s){return V(s.plane)}function us(s,i){const n=j(t.get(),i,s.origin),a=N(s.basis1),o=N(s.basis2),r=b(s.basis1,n),e=b(s.basis2,n);return-r-a<0&&r-a<0&&-e-o<0&&e-o<0}function gs(s,i){const n=ms.get();return g(n.origin,s.origin),g(n.vector,i),n}function bs(s,i,n){const{basis1:a,basis2:o,origin:r}=s,e=p(t.get(),a,i.origin[0]),c=p(t.get(),o,i.origin[1]);m(n.origin,e,c),m(n.origin,n.origin,r);const u=p(t.get(),a,i.direction[0]),g=p(t.get(),o,i.direction[1]);return p(n.vector,m(u,u,g),2),n}function fs(s,i,n,t){const a=cs(s);O(a,i.direction,i.origin,n),O(V(n),a,i.origin,t)}const ls={plane:x(),origin:w(0,0,0),basis1:w(1,0,0),basis2:w(0,1,0)},ps=new n(x),ms=new n(T),ds=y(),hs=new n((()=>G())),Is=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],js=u(),Ps=u(),vs=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:z,altitudeAt:as,axisAt:function(s,i,n,t){return function(s,i,n){switch(i){case A.X:g(n,s.basis1),v(n,n);break;case A.Y:g(n,s.basis2),v(n,n);break;case A.Z:g(n,cs(s))}return n}(s,n,t)},closestPoint:Q,closestPointOnSilhouette:K,copy:W,copyWithoutVerify:function(s,i){g(i.origin,s.origin),g(i.basis1,s.basis1),g(i.basis2,s.basis2),F(i.plane,s.plane)},create:G,distance:ns,distance2:is,distanceToSilhouette:function(s,i){let n=Number.NEGATIVE_INFINITY;for(const t of Is){const a=bs(s,t,ms.get()),o=_(a,i);o>n&&(n=o)}return Math.sqrt(n)},elevate:D,equals:os,extrusionContainsPoint:ts,fromAABoundingRect:H,fromValues:X,intersectRay:J,intersectRayClosestSilhouette:function(s,i,n){if(J(s,i,n))return n;const a=K(s,i,t.get());return m(n,i.origin,p(t.get(),i.direction,h(i.origin,a)/f(i.direction))),n},normal:cs,projectPoint:$,projectPointLocal:ss,rotate:es,setAltitudeAt:function(s,i,n,t){const a=as(s,i),o=p(ds,cs(s),n-a);return m(t,i,o),t},setExtent:function(s,i,n){return H(i,n),D(n,as(s,s.origin),n),n},transform:rs,up:ls,updateUnboundedPlane:Z,wrap:function(s,i,n){const t=hs.get();return t.origin=s,t.basis1=i,t.basis2=n,t.plane=q(0,0,0,0),Z(t),t}},Symbol.toStringTag,{value:"Module"}));export{z as B,W as a,vs as b,G as c,os as d,ts as e,X as f,H as g,ns as h,J as i,cs as n,es as r,rs as t,Z as u};
