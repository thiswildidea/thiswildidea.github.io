/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{b as t,k as n,p as e,s,t as o,q as r,d as h,i as l,c as a}from"./vec3.js";import{f as u,c,a as f}from"./vec3f32.js";import{c as p}from"./vec3f64.js";import{n as i}from"./DoubleArray.js";import{n as w,h as g}from"./DefaultBufferWriter.js";import{g as O,a as M}from"./Indices.js";import{c as A,f as m,o as I}from"./plane.js";import{w as y}from"./vector.js";import{A as P}from"./Attribute.js";import{C as N}from"./ContentObject.js";import{G as S}from"./Geometry.js";import{a as T}from"./Util.js";import{V as b}from"./VertexAttribute.js";var R;!function(t){t.length=function(t,n){const e=t[n],s=t[n+1],o=t[n+2];return Math.sqrt(e*e+s*s+o*o)},t.normalize=function(t,n){const e=t[n],s=t[n+1],o=t[n+2],r=1/Math.sqrt(e*e+s*s+o*o);t[n]*=r,t[n+1]*=r,t[n+2]*=r},t.scale=function(t,n,e){t[n]*=e,t[n+1]*=e,t[n+2]*=e},t.add=function(t,n,e,s,o,r=n){(o=o||t)[r]=t[n]+e[s],o[r+1]=t[n+1]+e[s+1],o[r+2]=t[n+2]+e[s+2]},t.subtract=function(t,n,e,s,o,r=n){(o=o||t)[r]=t[n]-e[s],o[r+1]=t[n+1]-e[s+1],o[r+2]=t[n+2]-e[s+2]}}(R||(R={}));const d=R,L=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],j=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],U=[0,0,1,0,1,1,0,1],v=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],V=new Array(36);for(let t=0;t<6;t++)for(let n=0;n<6;n++)V[6*t+n]=t;const G=new Array(36);for(let t=0;t<6;t++)G[6*t]=0,G[6*t+1]=1,G[6*t+2]=2,G[6*t+3]=2,G[6*t+4]=3,G[6*t+5]=0;function q(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(24);for(let t=0;t<8;t++)e[3*t]=L[t][0]*n[0],e[3*t+1]=L[t][1]*n[1],e[3*t+2]=L[t][2]*n[2];return new S(t,[[b.POSITION,new P(e,v,3,!0)],[b.NORMAL,new P(j,V,3)],[b.UV0,new P(U,G,2)]])}const x=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],C=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],E=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],F=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function k(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(18);for(let t=0;t<6;t++)e[3*t]=x[t][0]*n[0],e[3*t+1]=x[t][1]*n[1],e[3*t+2]=x[t][2]*n[2];return new S(t,[[b.POSITION,new P(e,E,3,!0)],[b.NORMAL,new P(C,F,3)]])}const z=u(-.5,0,-.5),B=u(.5,0,-.5),D=u(0,0,.5),W=u(0,.5,0),X=c(),Z=c(),H=c(),J=c(),K=c();t(X,z,W),t(Z,z,B),n(H,X,Z),e(H,H),t(X,B,W),t(Z,B,D),n(J,X,Z),e(J,J),t(X,D,W),t(Z,D,z),n(K,X,Z),e(K,K);const Q=[z,B,D,W],Y=[0,-1,0,H[0],H[1],H[2],J[0],J[1],J[2],K[0],K[1],K[2]],$=[0,1,2,3,1,0,3,2,1,3,0,2],_=[0,0,0,1,1,1,2,2,2,3,3,3];function tt(t,n){Array.isArray(n)||(n=[n,n,n]);const e=new Array(12);for(let t=0;t<4;t++)e[3*t]=Q[t][0]*n[0],e[3*t+1]=Q[t][1]*n[1],e[3*t+2]=Q[t][2]*n[2];return new S(t,[[b.POSITION,new P(e,$,3,!0)],[b.NORMAL,new P(Y,_,3)]])}function nt(t,n,e,s,o={uv:!0}){const r=-Math.PI,h=2*Math.PI,l=-Math.PI/2,a=Math.PI,u=Math.max(3,Math.floor(e)),c=Math.max(2,Math.floor(s)),f=(u+1)*(c+1),p=w(3*f),i=w(3*f),g=w(2*f),M=[];let A=0;for(let t=0;t<=c;t++){const e=[],s=t/c,o=l+s*a,f=Math.cos(o);for(let t=0;t<=u;t++){const l=t/u,a=r+l*h,c=Math.cos(a)*f,w=Math.sin(o),O=-Math.sin(a)*f;p[3*A]=c*n,p[3*A+1]=w*n,p[3*A+2]=O*n,i[3*A]=c,i[3*A+1]=w,i[3*A+2]=O,g[2*A]=l,g[2*A+1]=s,e.push(A),++A}M.push(e)}const m=new Array;for(let t=0;t<c;t++)for(let n=0;n<u;n++){const e=M[t][n],s=M[t][n+1],o=M[t+1][n+1],r=M[t+1][n];0===t?(m.push(e),m.push(o),m.push(r)):t===c-1?(m.push(e),m.push(s),m.push(o)):(m.push(e),m.push(s),m.push(o),m.push(o),m.push(r),m.push(e))}const I=[[b.POSITION,new P(p,m,3,!0)],[b.NORMAL,new P(i,m,3,!0)]];return o.uv&&I.push([b.UV0,new P(g,m,2,!0)]),o.offset&&(I[0][0]=b.OFFSET,I.push([b.POSITION,new P(Float64Array.from(o.offset),O(m.length),3,!0)])),new S(t,I)}function et(t,n,e,s){const o=st(n,e,s);return new S(t,o)}function st(t,n,e){const s=t;let o,r;if(e)o=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],r=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const t=s*(1+Math.sqrt(5))/2;o=[-s,t,0,s,t,0,-s,-t,0,s,-t,0,0,-s,t,0,s,t,0,-s,-t,0,s,-t,t,0,-s,t,0,s,-t,0,-s,-t,0,s],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let n=0;n<o.length;n+=3)d.scale(o,n,t/d.length(o,n));let h={};function l(n,e){n>e&&([n,e]=[e,n]);const s=n.toString()+"."+e.toString();if(h[s])return h[s];let r=o.length;return o.length+=3,d.add(o,3*n,o,3*e,o,r),d.scale(o,r,t/d.length(o,r)),r/=3,h[s]=r,r}for(let t=0;t<n;t++){const t=r.length,n=new Array(4*t);for(let e=0;e<t;e+=3){const t=r[e],s=r[e+1],o=r[e+2],h=l(t,s),a=l(s,o),u=l(o,t),c=4*e;n[c]=t,n[c+1]=h,n[c+2]=u,n[c+3]=s,n[c+4]=a,n[c+5]=h,n[c+6]=o,n[c+7]=u,n[c+8]=a,n[c+9]=h,n[c+10]=a,n[c+11]=u}r=n,h={}}const a=g(o);for(let t=0;t<a.length;t+=3)d.normalize(a,t);return[[b.POSITION,new P(g(o),r,3,!0)],[b.NORMAL,new P(a,r,3,!0)]]}function ot(t,n,e,s,o,r,h,l,a=null){const u=e?[e[0],e[1],e[2]]:[0,0,0],c=n?[n[0],n[1],n[2]]:[0,0,1];h=h||[0,0];const f=s?[255*s[0],255*s[1],255*s[2],s.length>3?255*s[3]:255]:[255,255,255,255],p=null!=o&&2===o.length?o:[1,1],i=O(1),w=[[b.POSITION,new P(u,i,3,!0)],[b.NORMAL,new P(c,i,3,!0)],[b.UV0,new P(h,i,h.length)],[b.COLOR,new P(f,i,4,!0)],[b.SIZE,new P(p,i,2)]];if(null!=r){const t=[r[0],r[1],r[2],r[3]];w.push([b.AUXPOS1,new P(t,i,4)])}if(null!=l){const t=[l[0],l[1],l[2],l[3]];w.push([b.FEATUREATTRIBUTE,new P(t,i,4)])}return new S(t,w,null,N.Point,a)}const rt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function ht(t,n=rt){const e=new Array(12);for(let t=0;t<4;t++)for(let s=0;s<3;s++)e[3*t+s]=n[t][s];const s=[0,1,2,2,3,0],o=[0,0,0,0,0,0],r=[[b.POSITION,new P(e,s,3,!0)],[b.NORMAL,new P([0,0,1],o,3,!0)],[b.UV0,new P([0,0,1,0,1,1,0,1],s,2,!0)],[b.COLOR,new P([255,255,255,255],o,4,!0)]];return new S(t,r)}function lt(t,n,e,s,o,r=!0,h=!0){let l=0;const a=e,c=n;let f=u(0,l,0),p=u(0,l+c,0),i=u(0,-1,0),g=u(0,1,0);o&&(l=c,p=u(0,0,0),f=u(0,l,0),i=u(0,1,0),g=u(0,-1,0));const O=[p,f],M=[i,g],A=s+2,m=Math.sqrt(c*c+a*a);if(o)for(let t=s-1;t>=0;t--){const n=t*(2*Math.PI/s),e=u(Math.cos(n)*a,l,Math.sin(n)*a);O.push(e);const o=u(c*Math.cos(n)/m,-a/m,c*Math.sin(n)/m);M.push(o)}else for(let t=0;t<s;t++){const n=t*(2*Math.PI/s),e=u(Math.cos(n)*a,l,Math.sin(n)*a);O.push(e);const o=u(c*Math.cos(n)/m,a/m,c*Math.sin(n)/m);M.push(o)}const I=new Array,y=new Array;if(r){for(let t=3;t<O.length;t++)I.push(1),I.push(t-1),I.push(t),y.push(0),y.push(0),y.push(0);I.push(O.length-1),I.push(2),I.push(1),y.push(0),y.push(0),y.push(0)}if(h){for(let t=3;t<O.length;t++)I.push(t),I.push(t-1),I.push(0),y.push(t),y.push(t-1),y.push(1);I.push(0),I.push(2),I.push(O.length-1),y.push(1),y.push(2),y.push(M.length-1)}const N=w(3*A);for(let t=0;t<A;t++)N[3*t]=O[t][0],N[3*t+1]=O[t][1],N[3*t+2]=O[t][2];const T=w(3*A);for(let t=0;t<A;t++)T[3*t]=M[t][0],T[3*t+1]=M[t][1],T[3*t+2]=M[t][2];const R=[[b.POSITION,new P(N,I,3,!0)],[b.NORMAL,new P(T,y,3,!0)]];return new S(t,R)}function at(t,o,a,p,i,g,O){const M=i?f(i):u(1,0,0),A=g?f(g):u(0,0,0);O??=!0;const m=c();e(m,M);const I=c();r(I,m,Math.abs(o));const y=c();r(y,I,-.5),h(y,y,A);const N=u(0,1,0);Math.abs(1-l(m,N))<.2&&s(N,0,0,1);const T=c();n(T,m,N),e(T,T),n(N,T,m);const R=2*p+(O?2:0),d=p+(O?2:0),L=w(3*R),j=w(3*d),U=w(2*R),v=new Array(3*p*(O?4:2)),V=new Array(3*p*(O?4:2));O&&(L[3*(R-2)]=y[0],L[3*(R-2)+1]=y[1],L[3*(R-2)+2]=y[2],U[2*(R-2)]=0,U[2*(R-2)+1]=0,L[3*(R-1)]=L[3*(R-2)]+I[0],L[3*(R-1)+1]=L[3*(R-2)+1]+I[1],L[3*(R-1)+2]=L[3*(R-2)+2]+I[2],U[2*(R-1)]=1,U[2*(R-1)+1]=1,j[3*(d-2)]=-m[0],j[3*(d-2)+1]=-m[1],j[3*(d-2)+2]=-m[2],j[3*(d-1)]=m[0],j[3*(d-1)+1]=m[1],j[3*(d-1)+2]=m[2]);const G=(t,n,e)=>{v[t]=n,V[t]=e};let q=0;const x=c(),C=c();for(let t=0;t<p;t++){const n=t*(2*Math.PI/p);r(x,N,Math.sin(n)),r(C,T,Math.cos(n)),h(x,x,C),j[3*t]=x[0],j[3*t+1]=x[1],j[3*t+2]=x[2],r(x,x,a),h(x,x,y),L[3*t]=x[0],L[3*t+1]=x[1],L[3*t+2]=x[2],U[2*t]=t/p,U[2*t+1]=0,L[3*(t+p)]=L[3*t]+I[0],L[3*(t+p)+1]=L[3*t+1]+I[1],L[3*(t+p)+2]=L[3*t+2]+I[2],U[2*(t+p)]=t/p,U[2*t+1]=1;const e=(t+1)%p;G(q++,t,t),G(q++,t+p,t),G(q++,e,e),G(q++,e,e),G(q++,t+p,t),G(q++,e+p,e)}if(O){for(let t=0;t<p;t++){const n=(t+1)%p;G(q++,R-2,d-2),G(q++,t,d-2),G(q++,n,d-2)}for(let t=0;t<p;t++){const n=(t+1)%p;G(q++,t+p,d-1),G(q++,R-1,d-1),G(q++,n+p,d-1)}}const E=[[b.POSITION,new P(L,v,3,!0)],[b.NORMAL,new P(j,V,3,!0)],[b.UV0,new P(U,v,2,!0)]];return new S(t,E)}function ut(t,n,e,s,o,r){s=s||10,o=null==o||o,T(n.length>1);const h=[],l=[];for(let t=0;t<s;t++){h.push([0,-t-1,-(t+1)%s-1]);const n=t/s*2*Math.PI;l.push([Math.cos(n)*e,Math.sin(n)*e])}return ct(t,l,n,[[0,0,0]],h,o,r)}function ct(o,l,f,i,g,O,M=u(0,0,0)){const N=l.length,T=w(f.length*N*3+(6*i.length||0)),R=w(f.length*N*3+(i?6:0)),d=new Array,L=new Array;let j=0,U=0;const v=c(),V=c(),G=c(),q=c(),x=c(),C=c(),E=c(),F=p(),k=c(),z=c(),B=c(),D=c(),W=c(),X=A();s(k,0,1,0),t(V,f[1],f[0]),e(V,V),O?(h(F,f[0],M),e(G,F)):s(G,0,0,1),Ot(V,G,k,k,x,G,Mt),a(q,G),a(D,x);for(let t=0;t<i.length;t++)r(C,x,i[t][0]),r(F,G,i[t][2]),h(C,C,F),h(C,C,f[0]),T[j++]=C[0],T[j++]=C[1],T[j++]=C[2];R[U++]=-V[0],R[U++]=-V[1],R[U++]=-V[2];for(let t=0;t<g.length;t++)d.push(g[t][0]>0?g[t][0]:-g[t][0]-1+i.length),d.push(g[t][1]>0?g[t][1]:-g[t][1]-1+i.length),d.push(g[t][2]>0?g[t][2]:-g[t][2]-1+i.length),L.push(0),L.push(0),L.push(0);let Z=i.length;const H=i.length-1;for(let s=0;s<f.length;s++){let o=!1;s>0&&(a(v,V),s<f.length-1?(t(V,f[s+1],f[s]),e(V,V)):o=!0,h(z,v,V),e(z,z),h(B,f[s-1],q),m(f[s],z,X),I(X,y(B,v),F)?(t(F,F,f[s]),e(G,F),n(x,z,G),e(x,x)):Ot(z,q,D,k,x,G,Mt),a(q,G),a(D,x)),O&&(h(F,f[s],M),e(W,F));for(let t=0;t<N;t++)if(r(C,x,l[t][0]),r(F,G,l[t][1]),h(C,C,F),e(E,C),R[U++]=E[0],R[U++]=E[1],R[U++]=E[2],h(C,C,f[s]),T[j++]=C[0],T[j++]=C[1],T[j++]=C[2],!o){const n=(t+1)%N;d.push(Z+t),d.push(Z+N+t),d.push(Z+n),d.push(Z+n),d.push(Z+N+t),d.push(Z+N+n);for(let t=0;t<6;t++){const n=d.length-6;L.push(d[n+t]-H)}}Z+=N}const J=f[f.length-1];for(let t=0;t<i.length;t++)r(C,x,i[t][0]),r(F,G,i[t][1]),h(C,C,F),h(C,C,J),T[j++]=C[0],T[j++]=C[1],T[j++]=C[2];const K=U/3;R[U++]=V[0],R[U++]=V[1],R[U++]=V[2];const Q=Z-N;for(let t=0;t<g.length;t++)d.push(g[t][0]>=0?Z+g[t][0]:-g[t][0]-1+Q),d.push(g[t][2]>=0?Z+g[t][2]:-g[t][2]-1+Q),d.push(g[t][1]>=0?Z+g[t][1]:-g[t][1]-1+Q),L.push(K),L.push(K),L.push(K);const Y=[[b.POSITION,new P(T,d,3,!0)],[b.NORMAL,new P(R,L,3,!0)]];return new S(o,Y)}function ft(t,n,e,s){T(n.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),T(3===n[0].length,"createPolylineGeometry(): malformed vertex"),T(null==e||e.length===n.length,"createPolylineGeometry: need same number of points and normals"),T(null==e||3===e[0].length,"createPolylineGeometry(): malformed normal");const o=i(3*n.length),r=new Array(2*(n.length-1));let h=0,l=0;for(let t=0;t<n.length;t++){for(let e=0;e<3;e++)o[h++]=n[t][e];t>0&&(r[l++]=t-1,r[l++]=t)}const a=[[b.POSITION,new P(o,r,3,!0)]];if(e){const t=w(3*e.length);let s=0;for(let o=0;o<n.length;o++)for(let n=0;n<3;n++)t[s++]=e[o][n];a.push([b.NORMAL,new P(t,r,3,!0)])}return s&&a.push([b.COLOR,new P(s,M(s.length/4),4)]),new S(t,a,null,N.Line)}function pt(t,n,e,s,o,r=0){const h=new Array(18),l=[[-e,r,o/2],[s,r,o/2],[0,n+r,o/2],[-e,r,-o/2],[s,r,-o/2],[0,n+r,-o/2]];for(let t=0;t<6;t++)h[3*t]=l[t][0],h[3*t+1]=l[t][1],h[3*t+2]=l[t][2];return new S(t,[[b.POSITION,new P(h,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function it(t,n){const e=t.getMutableAttribute(b.POSITION).data;for(let t=0;t<e.length;t+=3){const r=e[t],h=e[t+1],l=e[t+2];s(At,r,h,l),o(At,At,n),e[t]=At[0],e[t+1]=At[1],e[t+2]=At[2]}}function wt(t,n=t){const e=t.attributes,s=e.get(b.POSITION).data,o=e.get(b.NORMAL).data;if(o){const t=n.getMutableAttribute(b.NORMAL).data;for(let n=0;n<o.length;n+=3){const e=o[n+1];t[n+1]=-o[n+2],t[n+2]=e}}if(s){const t=n.getMutableAttribute(b.POSITION).data;for(let n=0;n<s.length;n+=3){const e=s[n+1];t[n+1]=-s[n+2],t[n+2]=e}}}function gt(t,s,o,r,h){return!(Math.abs(l(s,t))>h||(n(o,t,s),e(o,o),n(r,o,t),e(r,r),0))}function Ot(t,n,e,s,o,r,h){return gt(t,n,o,r,h)||gt(t,e,o,r,h)||gt(t,s,o,r,h)}const Mt=.99619469809,At=c();export{nt as a,ot as b,ft as c,ht as d,lt as e,ct as f,st as g,wt as h,k as i,tt as j,at as k,q as l,et as m,Ot as n,pt as o,ut as p,it as t};
