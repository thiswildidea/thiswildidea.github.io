/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{l as t}from"./typedArrayUtil.js";import{n as e}from"./nextTick.js";import{c as i,b as s,k as r,p as n,i as o,d as a,q as c,l as f}from"./vec3.js";import{b as h,a as m,c as u}from"./vec3f64.js";import{B as _}from"./ByteSizeUnit.js";import{c as g}from"./mat3f64.js";import{c as l}from"./mat4f64.js";import{c as P}from"./quatf64.js";import{b as p}from"./vec2f64.js";import{c as B}from"./vec4f64.js";import{b as d}from"./mathUtils.js";class w{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&e((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*M);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,M));t++)this._items.push(this._allocator())}}const M=1024;class b{constructor(t,e,i){this._itemByteSize=t,this._itemCreate=e,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){0===this._itemsPtr&&e((()=>this._reset()));const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const t=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let e=0;e<this._itemsPerBuffer;++e)this._items.push(this._itemCreate(t,e*this._itemByteSize));this._buffers.push(t)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=j){return new b(16,p,t)}static createVec3f64(t=j){return new b(24,h,t)}static createVec4f64(t=j){return new b(32,B,t)}static createMat3f64(t=j){return new b(72,g,t)}static createMat4f64(t=j){return new b(128,l,t)}static createQuatf64(t=j){return new b(32,P,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const j=4*_.KILOBYTES,y=b.createVec2f64(),z=b.createVec3f64(),S=b.createVec4f64();b.createMat3f64();const V=b.createMat4f64(),v=b.createQuatf64();function x(t){return t?A(m(t.origin),m(t.direction)):A(u(),u())}function A(t,e){return{origin:t,direction:e}}function k(e,i){return t(e.origin,i.origin)&&t(e.direction,i.direction)}function U(t,e){const i=T.get();return i.origin=t,i.direction=e,i}function q(t,e=x()){return I(t.origin,t.direction,e)}function C(t,e,r=x()){return i(r.origin,t),s(r.direction,e,t),r}function I(t,e,s=x()){return i(s.origin,t),i(s.direction,e),s}function O(t,e){const i=r(z.get(),n(z.get(),t.direction),s(z.get(),e,t.origin));return o(i,i)}function Q(t,e,i){const r=o(t.direction,s(i,e,t.origin));return a(i,t.origin,c(i,t.direction,r)),i}const T=new w((()=>x()));function E(t,e,i){const s=o(t,e)/o(t,t);return c(i,t,s)}function K(t,e){return o(t,e)/f(t)}function L(t,e){const i=o(t,e)/(f(t)*f(e));return-d(i)}function Y(t,e,i){n(D,t),n(F,e);const s=o(D,F),a=d(s),c=r(D,D,F);return o(c,i)<0?2*Math.PI-a:a}const D=u(),F=u();export{w as O,S as a,V as b,x as c,L as d,Q as e,C as f,q as g,I as h,O as i,k as j,y as k,Y as l,v as m,E as n,K as p,z as s,U as w};
