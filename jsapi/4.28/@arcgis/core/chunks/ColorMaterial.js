/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{h as t}from"./typedArrayUtil.js";import{Z as e}from"./vec4f64.js";import{n as s}from"./InterleavedLayout.js";import{S as r}from"./ShaderOutput.js";import{C as o}from"./basicInterfaces.js";import{s as a,a as i,b as n,D as l,G as p}from"./DefaultBufferWriter.js";import{c,o as u,a as h,g as d,d as f}from"./OrderIndependentTransparency.js";import{R as m}from"./RenderSlot.js";import{V as g}from"./VertexAttribute.js";import{T as y}from"./TriangleMaterial.js";import{V as v}from"./FloatsPassUniform.js";import{S as O,P as T,R as _}from"./Program2.js";import{D as A}from"./Material.js";import{T as C}from"./TransparencyPassType.js";import{C as P}from"./ColorMaterial.glsl.js";import{m as E,c as b,d as j,a as D}from"./renderState2.js";import{_ as I}from"./tslib.es6.js";import{p as S}from"./ShaderTechniqueConfiguration.js";import{D as R}from"./Texture2.js";class L extends O{initializeProgram(t){return new T(t.rctx,L.shader.get().build(this.configuration),A)}_createPipeline(t,e){const s=this.configuration,o=t===C.NONE,l=t===C.FrontFace;return E({blending:s.output!==r.Color&&s.output!==r.Alpha||!s.transparent?null:o?c:u(t),culling:b(s.cullFace),depthTest:{func:h(t)},depthWrite:(o||l)&&s.writeDepth?j:null,colorWrite:D,stencilWrite:s.hasOccludees?a:null,stencilTest:s.hasOccludees?e?i:n:null,polygonOffset:o||l?s.polygonOffset?w:null:d(s.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}L.shader=new _(P,(()=>import("./ColorMaterial.glsl.js").then((t=>t.C))));const w={factor:1,units:1};class N extends R{constructor(){super(...arguments),this.output=r.Color,this.cullFace=o.None,this.transparencyPassType=C.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}}I([S({count:r.COUNT})],N.prototype,"output",void 0),I([S({count:o.COUNT})],N.prototype,"cullFace",void 0),I([S({count:C.COUNT})],N.prototype,"transparencyPassType",void 0),I([S()],N.prototype,"hasSlicePlane",void 0),I([S()],N.prototype,"hasVertexColors",void 0),I([S()],N.prototype,"transparent",void 0),I([S()],N.prototype,"polygonOffset",void 0),I([S()],N.prototype,"enableOffset",void 0),I([S()],N.prototype,"writeDepth",void 0),I([S()],N.prototype,"hasOccludees",void 0),I([S()],N.prototype,"multipassEnabled",void 0),I([S()],N.prototype,"cullAboveGround",void 0),I([S()],N.prototype,"objectAndLayerIdColorInstanced",void 0),I([S()],N.prototype,"vvColor",void 0),I([S({constValue:!1})],N.prototype,"occlusionPass",void 0),I([S({constValue:!0})],N.prototype,"hasVvInstancing",void 0),I([S({constValue:!1})],N.prototype,"vvSize",void 0),I([S({constValue:!1})],N.prototype,"vvOpacity",void 0);class x extends y{constructor(t){super(t,new M),this.supportsEdges=!0,this._configuration=new N}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<f,this._configuration.multipassEnabled=e.multipassEnabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(t,e){return!!(e===r.Color||e===r.Alpha||e===r.Highlight||e===r.Depth&&this.parameters.writeLinearDepth||e===r.ObjectAndLayerIdColor)&&(t===m.DRAPED_MATERIAL||(e===r.Highlight?t===m.OPAQUE_MATERIAL:t===(this._isTransparent?this.parameters.writeDepth?m.TRANSPARENT_MATERIAL:m.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:m.OPAQUE_MATERIAL)))}createGLMaterial(t){return new V(t)}createBufferWriter(){const e=s().vec3f(g.POSITION);return t("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(g.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(g.COLORFEATUREATTRIBUTE):e.vec4u8(g.COLOR),new l(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class V extends p{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==r.Color&&this._output!==r.Alpha||this._updateOccludeeState(t),this.ensureTechnique(L,t)}}class M extends v{constructor(){super(...arguments),this.color=e,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=o.None,this.hasOccludees=!1}}export{x as C};
