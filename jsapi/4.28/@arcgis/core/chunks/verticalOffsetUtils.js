/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{h as t}from"./mat3.js";import{a as s}from"./mat3f64.js";import{i as r,t as e,j as o,m as i}from"./mat4.js";import{a as n}from"./mat4f64.js";import{l as a,s as f,f as h,A as l,y as m,z as _,G as p,d as c,t as u}from"./vec3.js";import{c as v}from"./vec3f64.js";import{c as O}from"./sphere.js";import{V as g}from"./ViewingMode.js";import{c as T,d as b}from"./orientedBoundingBox.js";class y{constructor(){this._transform=n(),this._transformInverse=new d({value:this._transform},r,n),this._transformInverseTranspose=new d(this._transformInverse,e,n),this._transformTranspose=new d({value:this._transform},e,n),this._transformInverseRotation=new d({value:this._transform},t,s)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){o(this._transform,t)}multiplyTransform(t){i(this._transform,this._transform,t)}set(t){o(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,s){this.setTransformMatrix(t),this.multiplyTransform(s),this._invalidateLazyTransforms()}}class d{constructor(t,s,r){this._original=t,this._update=s,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const x=new class{constructor(t=0){this.offset=t,this.sphere=O(),this.tmpVertex=v()}applyToVertex(t,s,r){const e=this.objectTransform.transform,o=f(z,t,s,r),i=u(o,o,e),n=this.offset/a(i);h(i,i,i,n);const l=this.objectTransform.inverse;return u(this.tmpVertex,i,l),this.tmpVertex}applyToMinMax(t,s){const r=this.offset/a(t);h(t,t,t,r);const e=this.offset/a(s);h(s,s,s,e)}applyToAabb(t){const s=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*s,t[1]+=t[1]*s,t[2]+=t[2]*s;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const s=a(t),r=this.offset/s;return h(this.sphere,t,t,r),this.sphere[3]=t[3]+t[3]*this.offset/s,this.sphere}};function V(t){return null!=t?(x.offset=t,x):null}const L=new class{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=v(),this._mbs=O(),this._obb=T(),this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=a(t)}applyToVertex(t,s,r){const e=f(z,t,s,r),o=f(A,t,s,r+this.componentLocalOriginLength),i=this._totalOffset/a(o);return h(this._tmpVertex,e,o,i),this._tmpVertex}applyToAabb(t){const s=f(z,t[0],t[1],t[2]+this.componentLocalOriginLength),r=f(A,t[3],t[4],t[5]+this.componentLocalOriginLength),e=l(R,s),o=l(B,r),i=m(q,s),n=m(G,r),h=_(S,i,n);h[0]=e[0]*o[0]<0?0:h[0],h[1]=e[1]*o[1]<0?0:h[1],h[2]=e[2]*o[2]<0?0:h[2];const c=a(h);if(c<this._totalOffset)return t[0]-=s[0]<0?this._totalOffset:0,t[1]-=s[1]<0?this._totalOffset:0,t[2]-=s[2]<0?this._totalOffset:0,t[3]+=r[0]>0?this._totalOffset:0,t[4]+=r[1]>0?this._totalOffset:0,t[5]+=r[2]>0?this._totalOffset:0,t;const u=p(S,i,n),v=a(u),O=this._totalOffset/v,g=this._totalOffset/c;return t[0]+=s[0]*(s[0]>0?O:g),t[1]+=s[1]*(s[1]>0?O:g),t[2]+=s[2]*(s[2]>0?O:g),t[3]+=r[0]*(r[0]<0?O:g),t[4]+=r[1]*(r[1]<0?O:g),t[5]+=r[2]*(r[2]<0?O:g),t}applyToMbs(t){const s=a(t),r=this._totalOffset/s;return h(this._mbs,t,t,r),this._mbs[3]=t[3]+t[3]*this._totalOffset/s,this._mbs}applyToObb(t){return b(t,this._totalOffset,this._totalOffset,g.Global,this._obb),this._obb}};function j(t){return null!=t?(L.offset=t,L):null}const I=new class{constructor(t=0){this.offset=t,this.tmpVertex=v()}applyToVertex(t,s,r){const e=f(z,t,s,r),o=c(A,e,this.localOrigin),i=this.offset/a(o);return h(this.tmpVertex,e,o,i),this.tmpVertex}applyToAabb(t){const s=R,r=B,e=q;for(let o=0;o<3;++o)s[o]=t[0+o]+this.localOrigin[o],r[o]=t[3+o]+this.localOrigin[o],e[o]=s[o];const o=this.applyToVertex(s[0],s[1],s[2]);for(let s=0;s<3;++s)t[s]=o[s],t[s+3]=o[s];const i=s=>{const r=this.applyToVertex(s[0],s[1],s[2]);for(let s=0;s<3;++s)t[s]=Math.min(t[s],r[s]),t[s+3]=Math.max(t[s+3],r[s])};for(let t=1;t<8;++t){for(let o=0;o<3;++o)e[o]=0==(t&1<<o)?s[o]:r[o];i(e)}let n=0;for(let t=0;t<3;++t)s[t]*r[t]<0&&(n|=1<<t);if(0!==n&&7!==n)for(let t=0;t<8;++t)if(0==(n&t)){for(let o=0;o<3;++o)e[o]=0!=(n&1<<o)?0:0!=(t&1<<o)?s[o]:r[o];i(e)}for(let s=0;s<3;++s)t[s]-=this.localOrigin[s],t[s+3]-=this.localOrigin[s];return t}};function M(t){return null!=t?(I.offset=t,I):null}const w="terrain",z=v(),A=v(),R=v(),B=v(),q=v(),G=v(),S=v();export{y as I,M as a,j as b,V as g,w as t};
