/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as s}from"../../../chunks/tslib.es6.js";import{d as t}from"../../../core/Accessor.js";import o from"../../../core/Evented.js";import{h as r}from"../../../chunks/handleUtils.js";import{L as e}from"../../../chunks/Logger.js";import{r as i}from"../../../chunks/maybe.js";import{watch as p}from"../../../core/reactiveUtils.js";import{property as n}from"../../../core/accessorSupport/decorators/property.js";import"../../../chunks/ensureType.js";import"../../../chunks/typedArrayUtil.js";import{subclass as m}from"../../../core/accessorSupport/decorators/subclass.js";import{a as l}from"../../../chunks/layerUtils2.js";import{f as c}from"../../../chunks/layerUtils.js";import{i as a}from"../../../chunks/layerViewUtils.js";import u from"../Selector2D.js";import"../../../core/Handles.js";import"../../../chunks/metadata.js";import"../../../core/lang.js";import"../../../chunks/utils.js";import"../../../chunks/ObjectPool.js";import"../../../chunks/ObservableBase.js";import"../../../chunks/tracking.js";import"../../../core/scheduling.js";import"../../../chunks/nextTick.js";import"../../../chunks/PooledArray.js";import"../../../core/promiseUtils.js";import"../../../core/Error.js";import"../../../config.js";import"../../../chunks/time.js";import"../../../chunks/asyncUtils.js";import"../../../core/Collection.js";import"../../../chunks/shared.js";import"../../../chunks/SimpleObservable.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../core/JSONSupport.js";import"../../../request.js";import"../../../symbols.js";import"../../../symbols/CIMSymbol.js";import"../../../chunks/enumeration.js";import"../../../chunks/jsonMap.js";import"../../../chunks/reader.js";import"../../../chunks/writer.js";import"../../../layers/support/fieldUtils.js";import"../../../core/sql.js";import"../../../intl.js";import"../../../chunks/date.js";import"../../../chunks/locale.js";import"../../../chunks/timeZoneUtils.js";import"../../../chunks/datetime.js";import"../../../chunks/messages.js";import"../../../chunks/assets.js";import"../../../chunks/mathUtils.js";import"../../../chunks/vec3.js";import"../../../chunks/vec3f64.js";import"../../../chunks/common.js";import"../../../chunks/arcadeOnDemand.js";import"../../../geometry.js";import"../../../geometry/Extent.js";import"../../../geometry/Geometry.js";import"../../../geometry/SpatialReference.js";import"../../../chunks/unitUtils.js";import"../../../chunks/Ellipsoid.js";import"../../../geometry/Point.js";import"../../../core/accessorSupport/decorators/cast.js";import"../../../geometry/support/webMercatorUtils.js";import"../../../geometry/Multipoint.js";import"../../../chunks/zmUtils.js";import"../../../geometry/Polygon.js";import"../../../chunks/Axis.js";import"../../../chunks/extentUtils.js";import"../../../chunks/aaBoundingRect.js";import"../../../geometry/Polyline.js";import"../../../chunks/typeUtils.js";import"../../../geometry/support/jsonUtils.js";import"../../../symbols/Symbol.js";import"../../../Color.js";import"../../../chunks/colorUtils.js";import"../../../symbols/ExtrudeSymbol3DLayer.js";import"../../../symbols/Symbol3DLayer.js";import"../../../chunks/utils4.js";import"../../../symbols/edges/Edges3D.js";import"../../../chunks/screenUtils.js";import"../../../chunks/materialUtils.js";import"../../../chunks/opacityUtils.js";import"../../../symbols/edges/SketchEdges3D.js";import"../../../symbols/edges/SolidEdges3D.js";import"../../../chunks/Symbol3DMaterial.js";import"../../../symbols/FillSymbol.js";import"../../../symbols/SimpleLineSymbol.js";import"../../../symbols/LineSymbol.js";import"../../../symbols/LineSymbolMarker.js";import"../../../chunks/lineMarkers.js";import"../../../symbols/FillSymbol3DLayer.js";import"../../../symbols/patterns/LineStylePattern3D.js";import"../../../symbols/patterns/StylePattern3D.js";import"../../../chunks/utils5.js";import"../../../chunks/colors.js";import"../../../chunks/symbolLayerUtils3D.js";import"../../../chunks/aaBoundingBox.js";import"../../../symbols/Font.js";import"../../../symbols/IconSymbol3DLayer.js";import"../../../chunks/persistableUrlUtils.js";import"../../../chunks/Symbol3DAnchorPosition2D.js";import"../../../symbols/LabelSymbol3D.js";import"../../../symbols/Symbol3D.js";import"../../../chunks/collectionUtils.js";import"../../../portal/Portal.js";import"../../../core/Loadable.js";import"../../../core/Promise.js";import"../../../portal/PortalGroup.js";import"../../../portal/PortalQueryParams.js";import"../../../portal/PortalQueryResult.js";import"../../../portal/PortalUser.js";import"../../../portal/PortalFolder.js";import"../../../symbols/LineSymbol3DLayer.js";import"../../../symbols/LineStyleMarker3D.js";import"../../../core/Clonable.js";import"../../../symbols/ObjectSymbol3DLayer.js";import"../../../symbols/PathSymbol3DLayer.js";import"../../../symbols/TextSymbol3DLayer.js";import"../../../symbols/WaterSymbol3DLayer.js";import"../../../symbols/support/StyleOrigin.js";import"../../../chunks/Thumbnail.js";import"../../../chunks/calloutUtils.js";import"../../../symbols/callouts/Callout3D.js";import"../../../symbols/callouts/LineCallout3D.js";import"../../../symbols/support/Symbol3DVerticalOffset.js";import"../../../symbols/LineSymbol3D.js";import"../../../symbols/MarkerSymbol.js";import"../../../symbols/MeshSymbol3D.js";import"../../../symbols/PictureFillSymbol.js";import"../../../chunks/urlUtils.js";import"../../../symbols/PictureMarkerSymbol.js";import"../../../symbols/PointSymbol3D.js";import"../../../symbols/PolygonSymbol3D.js";import"../../../symbols/SimpleFillSymbol.js";import"../../../symbols/SimpleMarkerSymbol.js";import"../../../symbols/TextSymbol.js";import"../../../symbols/WebStyleSymbol.js";import"../../../layers/GraphicsLayer.js";import"../../../chunks/GraphicsCollection.js";import"../../../Graphic.js";import"../../../PopupTemplate.js";import"../../../popup/content.js";import"../../../popup/content/AttachmentsContent.js";import"../../../popup/content/Content.js";import"../../../popup/content/CustomContent.js";import"../../../popup/content/ExpressionContent.js";import"../../../popup/ElementExpressionInfo.js";import"../../../popup/content/FieldsContent.js";import"../../../popup/FieldInfo.js";import"../../../popup/support/FieldInfoFormat.js";import"../../../popup/content/MediaContent.js";import"../../../popup/content/BarChartMediaInfo.js";import"../../../popup/content/mixins/ChartMediaInfo.js";import"../../../popup/content/mixins/MediaInfo.js";import"../../../popup/content/support/ChartMediaInfoValue.js";import"../../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../../chunks/chartMediaInfoUtils.js";import"../../../popup/content/ColumnChartMediaInfo.js";import"../../../popup/content/ImageMediaInfo.js";import"../../../popup/content/support/ImageMediaInfoValue.js";import"../../../popup/content/LineChartMediaInfo.js";import"../../../popup/content/PieChartMediaInfo.js";import"../../../popup/content/RelationshipContent.js";import"../../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../../popup/content/TextContent.js";import"../../../popup/ExpressionInfo.js";import"../../../popup/LayerOptions.js";import"../../../popup/RelatedRecordsInfo.js";import"../../../support/actions/ActionBase.js";import"../../../core/Identifiable.js";import"../../../support/actions/ActionButton.js";import"../../../support/actions/ActionToggle.js";import"../../../layers/Layer.js";import"../../../layers/mixins/BlendLayer.js";import"../../../chunks/jsonUtils.js";import"../../../chunks/parser.js";import"../../../chunks/utils3.js";import"../../../chunks/mat4.js";import"../../../chunks/_commonjsHelpers.js";import"../../../layers/mixins/ScaleRangeLayer.js";import"../../../chunks/ElevationInfo.js";import"../../../chunks/unitConversionUtils.js";import"../../../chunks/lengthUtils.js";import"../../Sketch/SketchViewModel.js";import"../../../geometry/projection.js";import"../../../chunks/projectBuffer.js";import"../../../chunks/geodesicConstants.js";import"../../../geometry/support/GeographicTransformation.js";import"../../../geometry/support/GeographicTransformationStep.js";import"../../../chunks/zscale.js";import"../../../chunks/isSupportedGraphic.js";import"../../../chunks/elevationInfoUtils.js";import"../../../geometry/Circle.js";import"../../../geometry/support/geodesicUtils.js";import"../../../chunks/InputManager.js";import"../../../chunks/Queue.js";import"../../../chunks/PropertiesPool.js";import"../../../core/signal.js";import"../../../chunks/keybindings.js";import"../../../views/interactive/sketch/SketchLabelOptions.js";import"../../../views/interactive/sketch/SketchTooltipOptions.js";import"../../../chunks/SnappingManager.js";import"../../../chunks/snappingUtils.js";import"../../../chunks/timeUtils.js";import"../../../chunks/dehydratedPoint.js";import"../../../rest/support/Query.js";import"../../../TimeExtent.js";import"../../../chunks/DataLayerSource.js";import"../../../layers/support/Field.js";import"../../../chunks/domains.js";import"../../../layers/support/CodedValueDomain.js";import"../../../layers/support/Domain.js";import"../../../layers/support/InheritedDomain.js";import"../../../layers/support/RangeDomain.js";import"../../../chunks/fieldType.js";import"../../../chunks/FullTextSearch.js";import"../../../chunks/QuantizationParameters.js";import"../../../rest/support/StatisticDefinition.js";import"../../../chunks/Settings.js";import"../../../chunks/LineSnappingHint.js";import"../../../chunks/vec2.js";import"../../../chunks/UpdatingHandles.js";import"../../../chunks/constraints.js";import"../../../chunks/vec2f64.js";import"../../../chunks/plane.js";import"../../../chunks/vector.js";import"../../../chunks/ByteSizeUnit.js";import"../../../chunks/mat3f64.js";import"../../../chunks/mat4f64.js";import"../../../chunks/quatf64.js";import"../../../chunks/vec4f64.js";import"../../../chunks/mathUtils2.js";import"../../../chunks/sphere.js";import"../../../chunks/vec4.js";import"../../../chunks/geometry2dUtils.js";import"../../../layers/support/FeatureFilter.js";import"../../../chunks/floorFilterUtils.js";import"../../../chunks/DrapedEdgeSnappingCandidate.js";import"../../../chunks/EdgeSnappingCandidate.js";import"../../../chunks/IntersectionSnappingHint.js";import"../../../chunks/viewUtils.js";import"../../../views/interactive/snapping/SnappingOptions.js";import"../../../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../../../chunks/hitTestSelectUtils.js";import"../../../chunks/screenUtils2.js";import"../../../chunks/compilerUtils.js";import"../Selector2D/selectorUtils.js";import"../../../chunks/drapedUtils.js";let j=class extends o.EventedAccessor{constructor(s){super(s),this._operationHandlesGroup=null,this.activeOperation=null,this.selector=new u,this.sources=null}initialize(){this.addHandles([p((()=>this._sources),(s=>{this.selector.sources=s,this.activeOperation&&(this.activeOperation.sources=s)}))])}destroy(){this._operationHandlesGroup=i(this._operationHandlesGroup),this.selector.destroy()}get _sources(){const{sources:s,view:t}=this;return t&&s?.length?s.flatMap((s=>{if(a(s))return s;if(l(s)){const o=s.layers||[],r=o.map((s=>{const o=c(t,s)||void 0;return a(o)?o:s}));return r.length?r.toArray():o.length?o.toArray():s}const o=c(t,s)||void 0;return a(o)?o:s})):[]}set cursor(s){this.activeOperation&&(this.activeOperation.cursor=s),this.selector.cursor=s,this._set("cursor",s)}get layers(){return t(e.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(s){t(e.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=s}get state(){return this.activeOperation?"active":this.view?.ready&&this._sources.length?"ready":"disabled"}set view(s){this.selector.view=s,this._set("view",s)}async selectionFrom(s,t){const{_sources:o}=this;return this.view&&o.length?this.selector.selectionFrom({geometry:s,selectionOptions:t,sources:o}):[]}cancel(){"active"===this.state&&(this.activeOperation?.cancel(),this._set("activeOperation",null))}activate(s){const{_sources:t,state:o}=this;if("disabled"===o||!t?.length)return;"active"===o&&this.cancel();const e=this.selector.draw({sources:t,operationOptions:s});return this._operationHandlesGroup=r([e.once("complete",(s=>this._onOperationComplete(s))),e.on("selection-change",(s=>this._onOperationSelectionChange(s)))]),this._set("activeOperation",e),e}_onOperationSelectionChange(s){this.emit("selection-change",s)}_onOperationComplete(s){this._operationHandlesGroup=i(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",s)}};s([n()],j.prototype,"_sources",null),s([n({readOnly:!0})],j.prototype,"activeOperation",void 0),s([n()],j.prototype,"cursor",null),s([n()],j.prototype,"layers",null),s([n({readOnly:!0})],j.prototype,"selector",void 0),s([n()],j.prototype,"sources",void 0),s([n({readOnly:!0})],j.prototype,"state",null),s([n()],j.prototype,"view",null),j=s([m("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],j);const h=j;export{h as default};
