/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as o}from"../../chunks/tslib.es6.js";import{d as s}from"../../core/Accessor.js";import{h as t}from"../../chunks/handleUtils.js";import{L as e}from"../../chunks/Logger.js";import{r as i}from"../../chunks/maybe.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import{cast as n}from"../../core/accessorSupport/decorators/cast.js";import"../../chunks/typedArrayUtil.js";import{subclass as p}from"../../core/accessorSupport/decorators/subclass.js";import l,{l as m}from"../Widget.js";import{g as c}from"../../chunks/globalCss.js";import{l as a}from"../../chunks/legacyIcon.js";import"../../chunks/widgetUtils.js";import{m as u}from"../../chunks/messageBundle.js";import{t as j}from"../../chunks/jsxFactory.js";import h from"./SelectionToolbar/SelectionToolbarViewModel.js";import"../../core/Handles.js";import"../../chunks/metadata.js";import"../../core/lang.js";import"../../chunks/utils.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../core/Error.js";import"../../config.js";import"../../chunks/time.js";import"../../chunks/ensureType.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/timeZoneUtils.js";import"../../chunks/datetime.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../core/JSONSupport.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../core/Evented.js";import"../../core/Promise.js";import"../../core/reactiveUtils.js";import"../../chunks/asyncUtils.js";import"../../core/Collection.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/uuid.js";import"../../chunks/projector.js";import"../../chunks/dom.js";import"../../chunks/index.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/layerUtils2.js";import"../../chunks/layerUtils.js";import"../../chunks/layerViewUtils.js";import"./Selector2D.js";import"../../symbols.js";import"../../symbols/CIMSymbol.js";import"../../chunks/enumeration.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../../layers/support/fieldUtils.js";import"../../core/sql.js";import"../../chunks/mathUtils.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/common.js";import"../../chunks/arcadeOnDemand.js";import"../../geometry.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/Ellipsoid.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../symbols/Symbol.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils4.js";import"../../symbols/edges/Edges3D.js";import"../../chunks/screenUtils.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/FillSymbol.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/lineMarkers.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils5.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/Symbol3DAnchorPosition2D.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../core/Clonable.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../layers/GraphicsLayer.js";import"../../chunks/GraphicsCollection.js";import"../../Graphic.js";import"../../PopupTemplate.js";import"../../popup/content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/Content.js";import"../../popup/content/CustomContent.js";import"../../popup/content/ExpressionContent.js";import"../../popup/ElementExpressionInfo.js";import"../../popup/content/FieldsContent.js";import"../../popup/FieldInfo.js";import"../../popup/support/FieldInfoFormat.js";import"../../popup/content/MediaContent.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/mixins/ChartMediaInfo.js";import"../../popup/content/mixins/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/RelationshipContent.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/content/TextContent.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/RelatedRecordsInfo.js";import"../../support/actions/ActionBase.js";import"../../core/Identifiable.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../layers/Layer.js";import"../../layers/mixins/BlendLayer.js";import"../../chunks/jsonUtils.js";import"../../chunks/parser.js";import"../../chunks/utils3.js";import"../../chunks/mat4.js";import"../../chunks/_commonjsHelpers.js";import"../../layers/mixins/ScaleRangeLayer.js";import"../../chunks/ElevationInfo.js";import"../../chunks/unitConversionUtils.js";import"../../chunks/lengthUtils.js";import"../Sketch/SketchViewModel.js";import"../../geometry/projection.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/zscale.js";import"../../chunks/isSupportedGraphic.js";import"../../chunks/elevationInfoUtils.js";import"../../geometry/Circle.js";import"../../geometry/support/geodesicUtils.js";import"../../chunks/InputManager.js";import"../../chunks/Queue.js";import"../../chunks/PropertiesPool.js";import"../../core/signal.js";import"../../chunks/keybindings.js";import"../../views/interactive/sketch/SketchLabelOptions.js";import"../../views/interactive/sketch/SketchTooltipOptions.js";import"../../chunks/SnappingManager.js";import"../../chunks/snappingUtils.js";import"../../chunks/timeUtils.js";import"../../chunks/dehydratedPoint.js";import"../../rest/support/Query.js";import"../../TimeExtent.js";import"../../chunks/DataLayerSource.js";import"../../layers/support/Field.js";import"../../chunks/domains.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/fieldType.js";import"../../chunks/FullTextSearch.js";import"../../chunks/QuantizationParameters.js";import"../../rest/support/StatisticDefinition.js";import"../../chunks/Settings.js";import"../../chunks/LineSnappingHint.js";import"../../chunks/vec2.js";import"../../chunks/UpdatingHandles.js";import"../../chunks/constraints.js";import"../../chunks/vec2f64.js";import"../../chunks/plane.js";import"../../chunks/vector.js";import"../../chunks/ByteSizeUnit.js";import"../../chunks/mat3f64.js";import"../../chunks/mat4f64.js";import"../../chunks/quatf64.js";import"../../chunks/vec4f64.js";import"../../chunks/mathUtils2.js";import"../../chunks/sphere.js";import"../../chunks/vec4.js";import"../../chunks/geometry2dUtils.js";import"../../layers/support/FeatureFilter.js";import"../../chunks/floorFilterUtils.js";import"../../chunks/DrapedEdgeSnappingCandidate.js";import"../../chunks/EdgeSnappingCandidate.js";import"../../chunks/IntersectionSnappingHint.js";import"../../chunks/viewUtils.js";import"../../views/interactive/snapping/SnappingOptions.js";import"../../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../../chunks/hitTestSelectUtils.js";import"../../chunks/screenUtils2.js";import"../../chunks/compilerUtils.js";import"./Selector2D/selectorUtils.js";import"../../chunks/drapedUtils.js";const y={lassoTool:!0,rectangleTool:!0},k={createTool:"polygon",createOptions:{mode:"freehand"}},d={createTool:"rectangle"},b="esri-selection-toolbar",g={base:b,widgetIcon:a.vertexGps,container:`${b}__container`,toolButton:`${b}__tool-button`};let f=class extends l{constructor(o,s){super(o,s),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.messages=null,this.toolConfigs=[],this.viewModel=new h,this.visibleElements={...y},this._viewModelHandlesGroup=t([this.viewModel.on("selection-change",(o=>this.emit("selection-change",o))),this.viewModel.on("complete",(o=>{this._set("activeToolInfo",null),this.emit("complete",o)}))])}destroy(){this._viewModelHandlesGroup=i(this._viewModelHandlesGroup)}loadDependencies(){return m({action:()=>import("../../chunks/calcite-action.js"),icon:()=>import("../../chunks/calcite-icon.js")})}get label(){return this.messages?.widgetLabel??""}set label(o){this._overrideIfSome("label",o)}get layers(){return s(e.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(o){s(e.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=o}get sources(){return this.viewModel.sources}set sources(o){this.viewModel.sources=o}get view(){return this.viewModel.view}set view(o){this.viewModel.view=o}castVisibleElements(o){return{...y,...o}}get visibleToolCount(){const{view:o,toolConfigs:s,visibleElements:t}=this;return(s?.length??0)+("2d"===o?.type?(t.lassoTool?1:0)+(t.rectangleTool?1:0):0)}activate(o){switch(this.cancel(),o){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(o)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return j("div",{"aria-label":this.label,class:this.classes(g.base,c.widget)},j("div",{class:g.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){if("2d"===this.view?.type)return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){if(this.toolConfigs?.length)return this.toolConfigs.map((o=>j("calcite-action",{active:this.activeToolInfo?.toolName===o.toolName,bind:this,class:g.toolButton,label:o.toolName,onclick:()=>this._onCustomToolClick(o.toolName),scale:"s",text:o.toolName,title:o.toolName},j("calcite-icon",{icon:o.icon||"selection",scale:"s"}))))}_renderLassoTool(){const{activeToolInfo:o,messages:s,visibleElements:t}=this;if(t.lassoTool)return j("calcite-action",{active:"lasso"===o?.toolName,bind:this,label:s.selectByLasso,onclick:this._onLassoToolClick,scale:"s",text:s.selectByLasso,title:s.selectByLasso},j("calcite-icon",{icon:"lasso-select",scale:"s"}))}_renderRectangleTool(){const{activeToolInfo:o,messages:s,visibleElements:t}=this;if(t.rectangleTool)return j("calcite-action",{active:"rectangle"===o?.toolName,bind:this,label:s.selectByRectangle,onclick:this._onRectangleToolClick,scale:"s",text:s.selectByRectangle,title:s.selectByRectangle},j("calcite-icon",{icon:"cursor-marquee",scale:"s"}))}_onCustomToolClick(o){this._toggleTool(o)}_onLassoToolClick(){this._toggleTool("lasso")}_onRectangleToolClick(){this._toggleTool("rectangle")}_activateTool(o){const s=this._getToolOptions(o);if(!s)return;const t=this.viewModel.activate(s);t&&this._set("activeToolInfo",{toolName:o,operation:t})}_toggleTool(o){if(this.activeToolInfo){const s=this.activeToolInfo.toolName;if(this.cancel(),s===o)return}this._activateTool(o)}_getToolOptions(o){if("lasso"===o)return k;if("rectangle"===o)return d;const s=this.toolConfigs.find((s=>s.toolName===o));if(!s)return;const{createTool:t,createOptions:e,selectionOptions:i}=s;return{createTool:t,createOptions:e,selectionOptions:i}}};o([r({readOnly:!0})],f.prototype,"activeToolInfo",void 0),o([r()],f.prototype,"label",null),o([r()],f.prototype,"layers",null),o([r(),u("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],f.prototype,"messages",void 0),o([r()],f.prototype,"sources",null),o([r()],f.prototype,"toolConfigs",void 0),o([r()],f.prototype,"view",null),o([r()],f.prototype,"viewModel",void 0),o([r()],f.prototype,"visibleElements",void 0),o([n("visibleElements")],f.prototype,"castVisibleElements",null),o([r()],f.prototype,"visibleToolCount",null),f=o([p("esri.widgets.support.SelectionToolbar")],f);const v=f;export{v as default};
