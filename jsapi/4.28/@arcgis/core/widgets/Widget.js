/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{S as t,a as r}from"../core/Accessor.js";import{b as s}from"../chunks/domUtils.js";import o from"../core/Evented.js";import{debounce as i,throwIfNotAbortError as n,i as a,o as d}from"../core/promiseUtils.js";import"../chunks/typedArrayUtil.js";import{clone as c}from"../core/lang.js";import{L as l}from"../chunks/Logger.js";import{d as p}from"../chunks/maybe.js";import{EsriPromiseMixin as h}from"../core/Promise.js";import{watch as u,when as m,syncAndInitial as f}from"../core/reactiveUtils.js";import{g}from"../chunks/uuid.js";import{property as v}from"../core/accessorSupport/decorators/property.js";import{cast as y}from"../core/accessorSupport/decorators/cast.js";import{subclass as j}from"../core/accessorSupport/decorators/subclass.js";import{r as k}from"../chunks/tracking.js";import{d as _}from"../chunks/projector.js";import{d as w,a as b}from"../chunks/dom.js";import{g as R}from"../chunks/assets.js";import{makeAbsolute as E}from"../core/urlUtils.js";import{g as P,s as S}from"../chunks/index.js";import{w as L,i as C,p as I,a as N}from"../chunks/jsxWidgetSupport.js";import{l as F}from"../chunks/legacyIcon.js";import{g as H,s as T,d as U,c as A,a as O}from"../chunks/widgetUtils.js";import{o as $}from"../chunks/locale.js";import{f as x}from"../chunks/messages.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../config.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../request.js";import"../kernel.js";import"../core/Error.js";import"../core/JSONSupport.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../core/Handles.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/time.js";import"../chunks/ensureType.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";const M={handleInterceptedEvent:(e,t,r,s)=>(e.scheduleRender(),t.properties[`on${s.type}`].apply(t.properties.bind||r,[s]))},D={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{"-"===t.charAt(0)?e.style.setProperty(t,r):e.style[t]=r}},z=(e,t,r=!1)=>{let s=e;return t.forEach(((e,o)=>{const i=s?.children?(n=t=>t.domNode===e,s.children.find(n)):void 0;var n;r&&!i&&o!==t.length-1||(s=i)})),s};
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.9.2
 */
function B(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>e.contains(w)||e.contains(b)&&t?"dark":"light",s=e=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:e}})),o=e=>{i!==e&&s(e),i=e};let i=r();s(i),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>o(e.matches?"dark":"light"))),new MutationObserver((()=>o(r()))).observe(document.body,{attributes:!0,attributeFilter:["class"]})}let W;function q(e){const t=[];for(const r of Object.keys(e))customElements.get(`calcite-${r}`)||t.push(e[r]?.());return t.length>0?Promise.all(t):null}"undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document&&("interactive"===document.readyState?B():document.addEventListener("DOMContentLoaded",(()=>B()),{once:!0})),W="esri/widgets/support/components/assets";const G=new Set;var V;let J=0;const Z={widgetIcon:F.checkboxUnchecked};function K(e,t){for(const r in t)null!=e[r]&&("object"==typeof e[r]&&"object"==typeof t[r]?K(e[r],t?.[r]):e[r]=t[r]);return e}const Q=(e=>{let t;const r={...M,...e},s=(e=>({...D,...e}))(r),o=s.performanceLogger;let i,n=!0,a=!1;const d=[],c=[],l=(e,i,n)=>{let a;s.eventHandlerInterceptor=(e,s,i,n)=>function(e){let s;o("domEvent",e);const i=((e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r})(e.currentTarget,a.domNode),n=i.some((e=>customElements.get(e?.tagName?.toLowerCase())));if(e.eventPhase!==Event.CAPTURING_PHASE&&n){const t=e.composedPath(),r=t.slice(t.indexOf(e.currentTarget),t.indexOf(a.domNode)).reverse();s=z(a.getLastRender(),r,!0)}else i.reverse(),s=z(a.getLastRender(),i);let d;return s&&(d=r.handleInterceptedEvent(t,s,this,e)),o("domEventProcessed",e),d},r.postProcessProjectionOptions?.(s);const l=n();a=e(i,l,s),s.eventHandlerInterceptor=void 0,d.push(a),c.push(n),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(a,l)};let p=()=>{if(i=void 0,n){n=!1,o("renderStart",void 0);for(let e=0;e<d.length;e++){const t=c[e]();o("rendered",void 0),d[e].update(t),o("patched",void 0)}o("renderDone",void 0),n=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,d,c)),t={renderNow:p,scheduleRender:()=>{i||a||(i=requestAnimationFrame(p))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),a=!0},resume:()=>{a=!1,n=!0,t.scheduleRender()},append:(e,t)=>{l(_.append,e,t)},insertBefore:(e,t)=>{l(_.insertBefore,e,t)},merge:(e,t)=>{l(_.merge,e,t)},replace:(e,t)=>{l(_.replace,e,t)},detach:e=>{for(let t=0;t<c.length;t++)if(c[t]===e)return c.splice(t,1),d.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(e,s,o,i)=>{const n=t?.(e,s,o,i),a=r.test(e);if(!((e=e.replace(r,"")).toLowerCase()in o)||a){const t=e[2].toLowerCase()+e.slice(3),r=e=>n?.call(o,e);o.addEventListener(t,r,a);const s=()=>o.removeEventListener(t,r,a),d=i.afterRemoved;i.afterRemoved=e=>{d?.(e),s()}}return n}},handleInterceptedEvent(e,t,r,s){const{eventPhase:o,type:i}=s,n=o===Event.CAPTURING_PHASE;let a=`on${i}${n?"capture":""}`;const d=t.properties;(d&&a in d||(a=`on${i[0].toUpperCase()}${i.slice(1)}${n?"Capture":""}`,d&&a in d))&&(O(),e.scheduleRender(),d[a].call(d.bind||r,s))}});let X=!1,Y=class extends(h(o.EventedAccessor)){constructor(e,r){super(e,r),this._attached=!1,this._projector=Q,this._readyForTrueRender=!1,this.iconClass=Z.widgetIcon,this.icon=null,this.key=this,this._loadLocale=i((async()=>{if(this._messageBundleProps?.length){const e=await Promise.allSettled(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{if(this.destroyed)return;let r=await x(e);this.uiStrings&&Object.keys(this.uiStrings)&&(r=K(c(r),this.uiStrings)),this[t]=r})));if(this.destroyed)return;for(const t of e)"rejected"===t.status&&l.getLogger(this).error("widget-intl:locale-error",this.declaredClass,t.reason)}await this.loadLocale()})),function(){try{P(".")}catch{S(E(R("esri/widgets/support/components/assets")))}}();const s="esri-widget-uid-"+g(),o=this.render.bind(this);this._trackingTarget=new t((()=>this.scheduleRender()));const n=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const e=o();let{properties:t}=e;t||(e.properties=t={});const{key:r}=t;if(r||(t.key=s),C(e.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${s}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?t.styles||(t.styles={}):(t.class="",t.styles={display:"none"}),t.styles.display||(t.styles.display="");let i=0;return e.children?.forEach((e=>{if(C(e.vnodeSelector))return;let{properties:t}=e;t||(e.properties=t={}),t.key||(t.key=`${this.id}--${i++}`)})),I(this,e)};this.render=()=>{if(X)return n();let e=H(this)??null;if(e)return e;this._trackingTarget.clear(),X=!0;try{e=k(this._trackingTarget,n)}catch(e){throw console.error(e),e}finally{X=!1}return e&&T(this,e),e};const a=this.beforeFirstRender();var d;a?this._resourcesFetch=a.then((()=>{this._readyForTrueRender=!0,this._postInitialize()})):(this._resourcesFetch=Promise.resolve().then((()=>{this._postInitialize()})),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),d=this._resourcesFetch,G.add(d),d.finally((()=>G.delete(d)))}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then((()=>{})).catch(n):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(p(this._trackingTarget),p(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,U(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return s(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+J++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(V=N,L)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(U(this),this._projector.scheduleRender())}own(e){r(l.getLogger(this.declaredClass),"`Widget.own()` is deprecated in favor of Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return A.apply(this,e)}renderNow(){U(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(u((()=>this.viewModel),((e,t)=>{t&&this.removeHandles("delegated-events"),e&&a(e)&&this.addHandles(this._delegatedEventNames.map((t=>d(e,t,(e=>{this.emit(t,e)})))),"delegated-events")}),f)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(n),this.scheduleRender()};this.addHandles([$(e),u((()=>this.uiStrings),e),m((()=>this.container),(e=>{this.destroyed||this._attach(e)}),{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};Y[V]=!0,e([v()],Y.prototype,"_readyForTrueRender",void 0),e([v({value:null})],Y.prototype,"container",null),e([y("container")],Y.prototype,"castContainer",null),e([v()],Y.prototype,"iconClass",void 0),e([v()],Y.prototype,"icon",void 0),e([v()],Y.prototype,"id",null),e([v()],Y.prototype,"label",null),e([v()],Y.prototype,"renderable",null),e([v()],Y.prototype,"uiStrings",void 0),e([v()],Y.prototype,"viewModel",void 0),e([v({value:!0})],Y.prototype,"visible",null),e([v()],Y.prototype,"key",void 0),e([v()],Y.prototype,"children",void 0),e([v()],Y.prototype,"afterCreate",void 0),e([v()],Y.prototype,"afterUpdate",void 0),e([v()],Y.prototype,"afterRemoved",void 0),Y=e([j("esri.widgets.Widget")],Y);const ee=Y;export{ee as default,q as l};
