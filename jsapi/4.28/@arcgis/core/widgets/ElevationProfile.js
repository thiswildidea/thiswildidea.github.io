/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{c as e}from"../chunks/asyncUtils.js";import{d as s,a as i}from"../chunks/maybe.js";import{m as o}from"../chunks/memoize.js";import{throwIfAborted as r,createAbortError as n}from"../core/promiseUtils.js";import{watch as a,on as l,initial as c}from"../core/reactiveUtils.js";import{property as p}from"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import"../chunks/typedArrayUtil.js";import{subclass as h}from"../core/accessorSupport/decorators/subclass.js";import m,{l as u}from"./Widget.js";import{l as d}from"../chunks/legacyIcon.js";import j from"./ElevationProfile/ElevationProfileViewModel.js";import g from"../core/Accessor.js";import{substitute as k}from"../intl.js";import{t as y}from"../chunks/throttle.js";import{f as _,h as v}from"../chunks/unitFormatUtils.js";import{n as b,g as f,E as C,a as S}from"./ElevationProfile/ElevationProfileLine.js";import{o as w}from"../chunks/widgetUtils.js";import{m as U}from"../chunks/messageBundle.js";import{t as P,a as x}from"../chunks/jsxFactory.js";import{U as E}from"../chunks/UnitSelect.js";import{g as M}from"../chunks/globalCss.js";import"../chunks/handleUtils.js";import"../core/Error.js";import"../core/lang.js";import"../chunks/Logger.js";import"../config.js";import"../core/Collection.js";import"../core/Evented.js";import"../core/Handles.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/time.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../chunks/Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/ByteSizeUnit.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/ElevationQueryTileCache.js";import"../chunks/defaultUnit.js";import"../chunks/getDefaultUnitForView.js";import"../chunks/elevationInfoUtils.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../chunks/vec2.js";import"../geometry/projection.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../geometry/support/geodesicUtils.js";import"../chunks/QueueProcessor.js";import"../chunks/Queue.js";import"../core/signal.js";import"../chunks/Scheduler.js";import"../chunks/debugFlags.js";import"../chunks/RenderState.js";import"../chunks/traversalUtils.js";import"./ElevationProfile/ElevationProfileLineGround.js";import"../chunks/elevationQuerySourceUtils.js";import"../Ground.js";import"../chunks/compilerUtils.js";import"../chunks/loadAll.js";import"./ElevationProfile/ElevationProfileLineInput.js";import"../chunks/ElevationQuery.js";import"../layers/support/ElevationSampler.js";import"../chunks/ElevationSamplerData.js";import"../chunks/TileKey.js";import"./ElevationProfile/ElevationProfileLineQuery.js";import"./ElevationProfile/ElevationProfileLineView.js";import"../chunks/vec4f64.js";import"../chunks/vector.js";import"../chunks/mat3f64.js";import"../chunks/mat4f64.js";import"../chunks/quatf64.js";import"../chunks/vec2f64.js";import"../chunks/Intersector2.js";import"../chunks/mat4.js";import"../chunks/vec4.js";import"../chunks/ViewingMode.js";import"../chunks/boundedPlane.js";import"../chunks/lineSegment.js";import"../chunks/plane.js";import"../chunks/mathUtils2.js";import"../chunks/verticalOffsetUtils.js";import"../chunks/mat3.js";import"../chunks/sphere.js";import"../chunks/orientedBoundingBox.js";import"../chunks/quat.js";import"../chunks/Attribute.js";import"../chunks/intersectorUtilsConversions.js";import"../chunks/Intersector3.js";import"../chunks/Intersector.js";import"../chunks/Intersector4.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../layers/Layer.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/utils3.js";import"../chunks/_commonjsHelpers.js";import"../layers/mixins/ScaleRangeLayer.js";import"../chunks/ElevationInfo.js";import"./Sketch/SketchViewModel.js";import"../chunks/isSupportedGraphic.js";import"../geometry/Circle.js";import"../chunks/layerUtils.js";import"../chunks/InputManager.js";import"../chunks/PropertiesPool.js";import"../chunks/keybindings.js";import"../views/interactive/sketch/SketchLabelOptions.js";import"../views/interactive/sketch/SketchTooltipOptions.js";import"../chunks/SnappingManager.js";import"../chunks/snappingUtils.js";import"../chunks/timeUtils.js";import"../chunks/dehydratedPoint.js";import"../rest/support/Query.js";import"../TimeExtent.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/FullTextSearch.js";import"../chunks/QuantizationParameters.js";import"../rest/support/StatisticDefinition.js";import"../chunks/Settings.js";import"../chunks/LineSnappingHint.js";import"../chunks/UpdatingHandles.js";import"../chunks/constraints.js";import"../chunks/geometry2dUtils.js";import"../layers/support/FeatureFilter.js";import"../chunks/floorFilterUtils.js";import"../chunks/layerUtils2.js";import"../chunks/DrapedEdgeSnappingCandidate.js";import"../chunks/EdgeSnappingCandidate.js";import"../chunks/IntersectionSnappingHint.js";import"../chunks/viewUtils.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/hitTestSelectUtils.js";import"../chunks/screenUtils2.js";import"../chunks/Cyclical.js";import"../chunks/Material.js";import"../chunks/interfaces3.js";import"../chunks/basicInterfaces.js";import"../chunks/ContentObject.js";import"../chunks/VertexAttribute.js";import"../chunks/Util.js";const B="esri-elevation-profile",D={widgetIcon:d.elevationProfile,base:`${B}`,portrait:`${B}--portrait`,refined:`${B}--refined`,mainContainer:`${B}__main-container`,promptContainer:`${B}__prompt-container`,header:`${B}__header`,zoomOutButton:`${B}__zoom-out-button`,clearButton:`${B}__clear-button`,actionButton:`${B}__action-button`,sketchButton:`${B}__sketch-button`,sketchCancelButton:`${B}__sketch-cancel-button`,sketchDoneButton:`${B}__sketch-done-button`,selectButton:`${B}__select-button`,selectCancelButton:`${B}__select-cancel-button`,chartContainer:`${B}__chart-container`,chartSpinner:`${B}__chart-spinner`,chartSpinnerVisible:`${B}__chart-spinner--visible`,chartSpinnerSmall:`${B}__chart-spinner--small`,footer:`${B}__footer`},L="esri-elevation-profile-legend-item",I={base:L,disabled:`${L}--disabled`,expanded:`${L}--expanded`,colorIndicator:`${L}__color-indicator`,header:`${L}__header`,content:`${L}__content`,collapseToggle:`${L}__collapse-toggle`,label:`${L}__label`,checkbox:`${L}__checkbox`},T="esri-elevation-profile-statistics",O={base:T,statistic:`${T}__statistic`,statisticLabel:`${T}__statistic__label`,statisticValue:`${T}__statistic__value`,slopeValue:`${T}__slope-value`},$="esri-elevation-profile-settings",V={base:`${$}`,popoverContent:`${$}__popover-content`,uniformChartScalingLabel:`${$}__uniform-scaling-label`,uniformChartScalingCheckbox:`${$}__uniform-scaling-checkbox`};let F=class extends g{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};t([p()],F.prototype,"legend",void 0),t([p()],F.prototype,"chart",void 0),t([p()],F.prototype,"clearButton",void 0),t([p()],F.prototype,"settingsButton",void 0),t([p()],F.prototype,"sketchButton",void 0),t([p()],F.prototype,"selectButton",void 0),t([p()],F.prototype,"unitSelector",void 0),t([p()],F.prototype,"uniformChartScalingToggle",void 0),F=t([h("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],F);const A=F;let R=class extends m{constructor(t,e){super(t,e),this._updateLayout=t=>{const e=t.parentElement,s=t.style.display;e?.removeChild(t),document.body.appendChild(t),t.style.display="block";let i=80;for(const e of t.childNodes)e instanceof HTMLElement&&(i=Math.max(i,e.offsetWidth));document.body.removeChild(t),e?.appendChild(t),t.style.display=s,t.style.setProperty("--max-width",`${i}px`)},this._updateLayoutThrottled=y(this._updateLayout,100)}loadDependencies(){return u({icon:()=>import("../chunks/calcite-icon.js")})}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return P("div",{afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled,bind:this,class:O.base},this._renderStatistics())}_renderStatistics(){const t=this._messages?.statistics;return t?[this._renderDistanceStatistic("maxDistance",t.maxDistance),this._renderElevationStatistic("elevationGain",t.gain),this._renderElevationStatistic("elevationLoss",t.loss),this._renderElevationStatistic("minElevation",t.minElevation),this._renderElevationStatistic("maxElevation",t.maxElevation),this._renderElevationStatistic("avgElevation",t.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",t.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",t.avgSlope)]:[]}_renderDistanceStatistic(t,e){const s=f().formatPrecision,i=this._renderValue(t,(t=>{const e=this.effectiveUnits.distance;return _(this._messagesUnits,t,e,s)}));return this._renderStatistic(e,i)}_renderElevationStatistic(t,e){const s=f().formatPrecision,i=this._renderValue(t,(t=>{const e=this.effectiveUnits.elevation;return _(this._messagesUnits,t,e,s)}));return this._renderStatistic(e,i)}_renderSlopeStatistic(t,e,s){const i=f().formatPrecision,o=P("div",{class:O.slopeValue,key:"slope-up"},P("calcite-icon",{icon:"arrow-up",scale:"s"}),this._renderValue(t,(t=>v(t,"degrees","geographic","geographic",i))),P("calcite-icon",{icon:"arrow-down",scale:"s"}),this._renderValue(e,(t=>v(t,"degrees","geographic","geographic",i))));return this._renderStatistic(s,o)}_renderStatistic(t,e){return P("div",{class:O.statistic},P("label",{class:O.statisticLabel},t),P("div",{class:O.statisticValue},e))}_renderValue(t,e){const s=this.line,i=1===s.progress?s.statistics:null,o=i?.[t];return null!=o?e(o):b}};function z(t,{profiles:e}){const s=t.title;if(null!=s)return s;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}t([p()],R.prototype,"effectiveUnits",void 0),t([p()],R.prototype,"line",void 0),t([p(),U("esri/widgets/ElevationProfile/t9n/ElevationProfile")],R.prototype,"_messages",void 0),t([p(),U("esri/core/t9n/Units")],R.prototype,"_messagesUnits",void 0),R=t([h("esri.widgets.ElevationProfile.Statistics")],R);let N=class extends m{constructor(t,e){super(t,e),this.checkboxVisible=!0,this.expanded=!1}loadDependencies(){return u({action:()=>import("../chunks/calcite-action.js"),checkbox:()=>import("../chunks/calcite-checkbox.js"),label:()=>import("../chunks/calcite-label.js"),tooltip:()=>import("../chunks/calcite-tooltip.js")})}initialize(){this._statistics=new R(this._statisticsProps),this.addHandles(a((()=>this._statisticsProps),(t=>this._statistics.set(t))))}destroy(){this._statistics=s(this._statistics)}render(){const t=this.expanded;return P("div",{class:this.classes(I.base,{[I.disabled]:this.disabled,[I.expanded]:t}),key:this},this._renderColorIndicator(),P("div",{class:I.header,key:"header"},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),t?P("div",{class:I.content,key:"content"},this._statistics.render()):null)}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return P("div",{class:I.colorIndicator,key:"color-indicator",styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const{expanded:t,messages:e}=this,s=t?e.hideDetails:e.showDetails;return P("calcite-action",{appearance:"transparent",bind:this,class:I.collapseToggle,"data-testid":"legend-toggle",icon:t?"chevron-up":"chevron-down",key:"collapse-toggle",onclick:this._onCollapseToggleClick,scale:"s",text:s})}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:t,checkboxVisible:e,disabled:s,messages:i}=this,o=`label-${t.id}`;return P("calcite-label",{class:I.label,disabled:s,key:o,layout:"inline"},e?this._renderCheckbox(t.id):null,z(t,i))}_renderCheckbox(t){const{disabled:e,line:s,messages:i}=this,o=s.visible,r=`${t}-checkbox`,n=o?i.hideProfile:i.showProfile,a=k(n,{name:z(s,i)});return P(x,null,P("calcite-checkbox",{checked:o,class:I.checkbox,disabled:e,id:r,key:"checkbox",onCalciteCheckboxChange:()=>s.toggleVisibility()}),P("calcite-tooltip",{overlayPositioning:"fixed",placement:"top",referenceElement:r},a))}};t([p()],N.prototype,"checkboxVisible",void 0),t([p()],N.prototype,"disabled",null),t([p({nonNullable:!0})],N.prototype,"effectiveUnits",void 0),t([p()],N.prototype,"expanded",void 0),t([p({nonNullable:!0})],N.prototype,"line",void 0),t([p()],N.prototype,"messages",void 0),t([p()],N.prototype,"onExpandedToggle",void 0),t([p()],N.prototype,"_statistics",void 0),N=t([h("esri.widgets.ElevationProfile.LegendItem")],N);let G=class extends m{constructor(){super(...arguments),this._expandedLine=null}render(){const{profiles:t,messages:e,effectiveUnits:s,_expandedLine:i}=this;return P("div",{class:"esri-elevation-profile-legend"},t.map((o=>P(N,{checkboxVisible:t.length>1,effectiveUnits:s,expanded:o===i,line:o,messages:e,onExpandedToggle:()=>this._onExpandedToggle(o)}))))}_onExpandedToggle(t){this._expandedLine=t===this._expandedLine?null:t}};t([p()],G.prototype,"effectiveUnits",void 0),t([p()],G.prototype,"messages",void 0),t([p()],G.prototype,"profiles",void 0),t([p()],G.prototype,"_expandedLine",void 0),G=t([h("esri.widgets.ElevationProfile.components.Legend")],G);let H=class extends m{constructor(){super(...arguments),this.messages=null,this._popover=null,this._popoverIsOpen=!1,this._onPopoverAfterCreate=t=>{this._popover=t},this._onUniformChartScalingChange=t=>{this.onUniformChartScalingChange(t.target.checked)}}loadDependencies(){return u({action:()=>import("../chunks/calcite-action.js"),checkbox:()=>import("../chunks/calcite-checkbox.js"),label:()=>import("../chunks/calcite-label.js"),popover:()=>import("../chunks/calcite-popover.js"),tooltip:()=>import("../chunks/calcite-tooltip.js")})}initialize(){const t=()=>this._popover;this.addHandles([l(t,"calcitePopoverOpen",(()=>this._popoverIsOpen=!0)),l(t,"calcitePopoverClose",(()=>this._popoverIsOpen=!1))])}render(){const{id:t,messages:e,visibleElements:s}=this,{unitSelector:i,uniformChartScalingToggle:o}=s;if(!e||!i&&!o)return P("div",{key:`${t}-empty`});const r=`${t}__action`,n=this._popoverIsOpen?e.hideSettings:e.showSettings;return P("div",{class:V.base,key:this},P("calcite-popover",{afterCreate:this._onPopoverAfterCreate,autoClose:!0,label:n,overlayPositioning:"fixed",placement:"bottom-end",referenceElement:r},this._renderPopoverContent()),P("calcite-action",{appearance:"transparent","data-testid":"settings-button",icon:"gear",id:r,label:n,scale:"s",text:n}))}_renderPopoverContent(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;return P("div",{class:V.popoverContent},t?this._renderUnitSelector():null,e?this._renderUniformChartScalingToggle():null)}_renderUnitSelector(){const{messages:t}=this;return P(E,{key:"unit-selector-label",options:this.unitOptions,selectLabel:t?.unitSelectLabel??"",value:this.unit,onChange:this.onUnitChange})}_renderUniformChartScalingToggle(){const{messages:t}=this,e=this.uniformChartScaling,s=`${this.id}__uniform-chart-scaling-toggle`,i=t?.[e?"uniformChartScalingDisable":"uniformChartScalingEnable"]??"";return P("calcite-label",{class:V.uniformChartScalingLabel,key:"uniform-chart-scaling-label",layout:"inline"},P("calcite-checkbox",{checked:e,class:V.uniformChartScalingCheckbox,id:s,onCalciteCheckboxChange:this._onUniformChartScalingChange}),P("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:s},i),t?.uniformChartScalingLabel)}};var W;t([p()],H.prototype,"messages",void 0),t([p()],H.prototype,"onUniformChartScalingChange",void 0),t([p()],H.prototype,"onUnitChange",void 0),t([p()],H.prototype,"uniformChartScaling",void 0),t([p()],H.prototype,"unit",void 0),t([p()],H.prototype,"unitOptions",void 0),t([p()],H.prototype,"visibleElements",void 0),t([p()],H.prototype,"_popover",void 0),t([p()],H.prototype,"_popoverIsOpen",void 0),H=t([h("esri.widgets.ElevationProfile.components.SettingsButton")],H),function(t){t.Sketch="sketch",t.SketchCancel="sketch-cancel",t.SketchDone="sketch-done",t.Select="select",t.SelectCancel="select-cancel"}(W||(W={}));const Q=[{type:W.Select},{type:W.Sketch}],q={[C.None]:null,[C.NoValidInput]:"noProfile",[C.NoVisibleProfiles]:"noProfile",[C.RefinedButNoChartData]:"noProfile",[C.TooComplex]:"tooComplex",[C.UnknownError]:"unknown",[C.InvalidGeometry]:"invalidGeometry",[C.InvalidElevationInfo]:"invalidElevationInfo"},Z=Symbol("resize-observer-handle");let J=class extends m{constructor(t,e){super(t,e),this.viewModel=null,this.visibleElements=new A,this.iconClass=D.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._width=0,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=o(((t,e,s,i)=>({chart:t,data:e,stationary:s,messages:i}))),this._onZoomOutButtonClick=()=>{this._chart?.zoomOut()},this._onClearButtonClick=()=>{this.viewModel.clear()},t?.viewModel||(this._defaultViewModel=new j({view:t?.view}),this.viewModel=this._defaultViewModel)}loadDependencies(){return u({action:()=>import("../chunks/calcite-action.js"),button:()=>import("../chunks/calcite-button.js"),loader:()=>import("../chunks/calcite-loader.js")})}postInitialize(){this.addHandles([a((()=>({container:this._chartContainer,width:this._width})),(({container:t,width:e})=>{this._destroyChart(),null!=t&&e>0&&this._initializeChart(t)}),c),a((()=>this._chartUpdateParams),(()=>this._updateChart(this._chartUpdateParams)),c)])}destroy(){this._destroyChart(),null!=this._defaultViewModel&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get input(){return this.viewModel.input}set input(t){this.viewModel.input=t}get profiles(){return this.viewModel.profiles}set profiles(t){this.viewModel.profiles=t}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}get geodesicDistanceThreshold(){return this.viewModel.geodesicDistanceThreshold}set geodesicDistanceThreshold(t){this.viewModel.geodesicDistanceThreshold=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}get _portrait(){return this._width<f().portraitModePixelBreakpoint}get _chartUpdateParams(){const t=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,null==t||t.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _profilesArray(){return this.profiles.toArray()}render(){const{viewModel:t,visible:e}=this;return P("div",{"aria-label":this.messages.widgetLabel,class:this.classes({[D.base]:e,[M.widget]:e,[M.panel]:e,[M.widgetDisabled]:e&&"disabled"===t.state,[D.portrait]:this._portrait,[D.refined]:1===t.progress}),key:this},P("div",{afterCreate:this._onContentWrapperAfterCreate,afterRemoved:this._onContentWrapperRemoved,bind:this,key:"content-wrapper"},e?this._renderContentForState():null))}_renderContentForState(){switch(this.viewModel.state){case S.Ready:return this._renderContentForReadyState();case S.Selecting:return this._renderContentForSelectingState();case S.Creating:return this._renderContentForCreatingState();case S.Selected:return this._renderContentForSelectedState();case S.Created:return this._renderContentForCreatedState();case S.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){const{sketchButton:t,selectButton:e}=this.visibleElements,s=this.messages;let i;return i=t&&e?s.readyPrompt:t?s.readyPromptCreateOnly:e?s.readyPromptSelectOnly:s.errors?.noProfile,this._renderContent({prompt:i,chart:!1,actions:Q})}_renderContentForSelectingState(){const t=this.view;if(null==t)return null;const e=this.messages[`selectingPrompt-${t.type}`];return this._renderContent({prompt:e,chart:!1,actions:[{type:W.SelectCancel}]})}_renderContentForCreatingState(){const{view:t,viewModel:e}=this;if(null==t)return null;const s=e.hasVertices?[{type:W.SketchCancel},{type:W.SketchDone,disabled:!e.tool.interaction.canStopCreating}]:[{type:W.Select},{type:W.Sketch,disabled:!0}];if(e.errorState===C.NoValidInput){const e=this.messages[`creatingPrompt-${t.type}`];return this._renderContent({chart:!1,actions:s,prompt:e})}const i=this._getErrorMessage();return i?this._renderContent({chart:!1,actions:s,prompt:i}):this._renderContent({chart:!0,actions:s})}_renderContentForSelectedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:Q,prompt:t}):this._renderContent({chart:!0,actions:Q})}_renderContentForCreatedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:Q,prompt:t}):this._renderContent({chart:!0,actions:Q})}_getErrorMessage(){const t=q[this.viewModel.errorState];return t?this.messages?.errors?.[t]:null}_renderContent(t){const e=null!=t.prompt?this._renderPrompt(t.prompt):t.chart&&this._renderChart(),{viewModel:s}=this,i=null!=s.input;return P(x,null,P("header",{class:D.header,key:"header"},this._zoomOutButtonVisible?this._renderZoomOutButton():null,this.visibleElements.clearButton&&i?this._renderClearButton():null,this.visibleElements.settingsButton?P(H,{messages:this.messages,uniformChartScaling:s.uniformChartScaling,unit:s.unit,unitOptions:s.unitOptions,visibleElements:this.visibleElements,onUniformChartScalingChange:t=>s.uniformChartScaling=t,onUnitChange:t=>s.unit=t}):null),P("div",{class:D.mainContainer,key:"main-container"},e),this.visibleElements.legend?P(G,{effectiveUnits:s.effectiveUnits,messages:this.messages,profiles:this._profilesArray}):null,this._renderActions(t))}_renderZoomOutButton(){return P("calcite-action",{appearance:"transparent",class:D.zoomOutButton,"data-testid":"zoom-out-button",icon:"magnifying-glass-minus",key:"zoom-out",onclick:this._onZoomOutButtonClick,scale:"s",text:this.messages.zoomOut})}_renderClearButton(){return P("calcite-action",{appearance:"transparent",class:D.clearButton,"data-testid":"clear-button",icon:"trash",key:"clear-profile",onclick:this._onClearButtonClick,scale:"s",text:this.messages.clearProfile})}_renderPrompt(t){return[P("div",{bind:this,class:D.promptContainer,key:"prompt-container"},P("p",null,t))]}_renderChart(){if(!this.visibleElements.chart)return P("div",{class:D.chartContainer,key:"empty-chart-container"});const t=this._chartIsRefined||this._canRenderChart();if(!t)return P(x,null,this._renderSpinner({size:"large"}),P("div",{class:D.chartContainer,key:"chart-container-empty"}));const{chartData:e,progress:s}=this.viewModel;return P(x,null,null!=e&&s>0&&s<1?this._renderSpinner({size:t?"small":"large"}):null,P("div",{afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved,bind:this,class:D.chartContainer,key:"chart-container"}))}_renderSpinner(t){const e="small"===t.size;return P("calcite-loader",{afterCreate:this._onSpinnerAfterCreate,class:this.classes(D.chartSpinner,e&&D.chartSpinnerSmall),exitAnimation:this._onSpinnerExit,inline:e,key:"spinner",label:"",scale:"s"})}_onSpinnerAfterCreate(t){requestAnimationFrame((()=>t.classList.add(D.chartSpinnerVisible)))}_onSpinnerExit(t,e){t.classList.remove(D.chartSpinnerVisible),setTimeout(e,200)}_canRenderChart(){const t=this.viewModel.chartData;if(null==t)return!1;if(!this.viewModel.inputIsSketched)return t.refined;let e=0;for(const{samples:s}of t.lines)e+=null!=s?s.length:0;return t.refined||e<=f().largeChartSamples}_renderActions({actions:t}){const e=t.map((t=>{switch(t.type){case W.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:t,className:D.sketchButton,label:this.messages.sketchButtonLabel,onClick:this._onSketchButtonClick,primary:!0});case W.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:D.sketchCancelButton,label:this.messagesCommon.cancel,primary:!1});case W.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onDoneButtonClick,className:D.sketchDoneButton,label:this.messagesCommon.done,primary:!0});case W.Select:return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onSelectButtonClick,className:D.selectButton,label:this.messages.selectButtonLabel,primary:!1});case W.SelectCancel:return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:D.selectCancelButton,label:this.messagesCommon.cancel,primary:!1})}})).filter(Boolean);return e.length?P("footer",{class:D.footer,key:"footer"},e):null}_renderAction({action:t,className:e,label:s,onClick:i,primary:o}){return P("calcite-button",{appearance:o?"solid":"outline-fill",bind:this,class:this.classes(D.actionButton,e),disabled:t.disabled,key:`action-${t.type}`,onclick:i},s)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_onContentWrapperAfterCreate(t){const e=w(t,(t=>{this._width=t.contentRect.width}));this.addHandles(e,Z)}_onContentWrapperRemoved(){this.removeHandles(Z)}_updateChart(t){const{data:e,chart:s,messages:i,stationary:o}=t;null!=s&&null!=i&&o&&this._canRenderChart()&&(s.update(t),this._chartIsRefined=null!=e&&e.refined)}_onChartContainerAfterCreate(t){this._chartContainer=t}_onChartContainerRemoved(){this._chartContainer=null}_initializeChart(t){i(this._chartInitTask),this._chartInitTask=e((async e=>{const{createChart:i}=await import("../chunks/chartUtils.js");r(e);const o=await i({container:t,abortOptions:{signal:e},onRangeChange:(t,e)=>{this._zoomOutButtonVisible=1!==t||1!==e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}});if(e.aborted)throw s(o),n();this._chart=o,this._updateChart(this._chartUpdateParams)}))}_destroyChart(){this._chartInitTask=i(this._chartInitTask),this._chart=s(this._chart),this._chartIsRefined=!1}};t([p({type:j})],J.prototype,"viewModel",void 0),t([p()],J.prototype,"view",null),t([p()],J.prototype,"input",null),t([p()],J.prototype,"profiles",null),t([p()],J.prototype,"unitOptions",null),t([p()],J.prototype,"unit",null),t([p()],J.prototype,"geodesicDistanceThreshold",null),t([p({type:A,nonNullable:!0})],J.prototype,"visibleElements",void 0),t([p()],J.prototype,"iconClass",void 0),t([p()],J.prototype,"icon",void 0),t([p()],J.prototype,"label",null),t([p()],J.prototype,"visible",null),t([p(),U("esri/widgets/ElevationProfile/t9n/ElevationProfile")],J.prototype,"messages",void 0),t([p(),U("esri/t9n/common")],J.prototype,"messagesCommon",void 0),t([p(),U("esri/core/t9n/Units")],J.prototype,"messagesUnits",void 0),t([p()],J.prototype,"_chartContainer",void 0),t([p()],J.prototype,"_chart",void 0),t([p()],J.prototype,"_chartInitTask",void 0),t([p()],J.prototype,"_chartIsRefined",void 0),t([p()],J.prototype,"_width",void 0),t([p()],J.prototype,"_portrait",null),t([p()],J.prototype,"_zoomOutButtonVisible",void 0),t([p()],J.prototype,"_chartUpdateParams",null),t([p()],J.prototype,"_chartMessages",null),t([p()],J.prototype,"_profilesArray",null),J=t([h("esri.widgets.ElevationProfile")],J);const K=J;export{K as default,z as g};
