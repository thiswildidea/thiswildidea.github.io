/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{i as s}from"../chunks/typedArrayUtil.js";import{d as o}from"../core/Accessor.js";import{L as r}from"../chunks/Logger.js";import{watch as i,whenOnce as n}from"../core/reactiveUtils.js";import{property as a}from"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import{isIntegerField as p,a as m,b as u,i as d,n as c,p as h,c as j,d as y,e as b,f as v}from"../layers/support/fieldUtils.js";import f,{l as g}from"./Widget.js";import{i as C,a as k,b as _,c as F,d as R,g as I,e as w,f as O}from"../chunks/featureFormUtils.js";import x from"./FeatureForm/FeatureFormViewModel.js";import{g as D}from"../chunks/globalCss.js";import{H as S,i as M}from"../chunks/Heading.js";import"../chunks/widgetUtils.js";import{m as L}from"../chunks/messageBundle.js";import{v as U}from"../chunks/vmEvent.js";import{t as V}from"../chunks/jsxFactory.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../config.js";import"../core/lang.js";import"../chunks/locale.js";import"../chunks/handleUtils.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../chunks/messages.js";import"../core/Error.js";import"../core/promiseUtils.js";import"../chunks/maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../chunks/utils.js";import"../core/Handles.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/time.js";import"../chunks/assets.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../core/sql.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/arcadeOnDemand.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/legacyIcon.js";import"../chunks/compilerUtils.js";import"../chunks/utils2.js";import"../chunks/basemapUtils.js";import"../Basemap.js";import"../chunks/collectionUtils.js";import"../core/Loadable.js";import"../chunks/loadAll.js";import"../portal/Portal.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../support/BasemapStyle.js";import"../chunks/writeUtils.js";import"../chunks/layerUtils2.js";import"../chunks/utils3.js";import"../chunks/colorUtils.js";import"../chunks/screenUtils.js";import"../chunks/mat4.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../chunks/Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/UpdatingHandles.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../form/support/elements.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../form/elements/RelationshipElement.js";import"../chunks/editableLayers.js";import"../chunks/infoFor3D.js";import"../chunks/arcgisLayerUrl.js";import"../layers/support/Subtype.js";import"./FeatureForm/FieldInput.js";import"../chunks/featureUtils.js";import"./FeatureForm/EditableInput.js";import"./FeatureForm/InputBase.js";import"../arcade.js";import"../chunks/TimeOnly.js";import"../chunks/UnknownTimeZone.js";import"../chunks/ImmutableArray.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/visualVariableUtils.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/jsonUtils.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/Version.js";import"../layers/support/FieldsIndex.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../renderers/support/jsonUtils.js";import"../chunks/MultiOriginJSONSupport.js";import"../chunks/layerContainerType.js";import"../layers/Layer.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../chunks/editsZScale.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/_commonjsHelpers.js";import"../layers/mixins/CustomParametersMixin.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../chunks/FullTextSearch.js";import"../chunks/QuantizationParameters.js";import"../rest/support/StatisticDefinition.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"../chunks/commonProperties2.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/featureLayerUtils.js";import"../chunks/featureQueryAll.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/RelationshipQuery.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../chunks/jsonUtils2.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/MD5.js";import"../layers/mixins/OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../layers/mixins/PortalLayer.js";import"../chunks/portalItemUtils.js";import"../geometry/projection.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../chunks/labelingInfo.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../support/popupUtils.js";import"../chunks/interfaces.js";import"./FeatureForm/GroupInput.js";import"./FeatureForm/RelationshipInput.js";import"../chunks/FeatureRelationshipViewModel.js";const T="esri-feature-form",N=`${T}__group`,E=`${T}__input`,P=`${T}__related-records`,$={base:T,form:`${T}__form`,formHeader:`${T}__form-header`,label:`${T}__label`,labelTextContent:`${T}__label-text-content`,fieldInput:`${E}`,inputRadio:`${E}--radio`,inputRadioGroup:`${E}--radio-group`,inputRadioLabel:`${E}--radio-label`,inputDisabled:`${E}--disabled`,inputSwitch:`${E}--switch`,inputInvalid:`${E}--invalid`,centeredButton:`${T}__centered-button`,description:`${T}__description-text`,listObserver:`${T}__list-observer`,relatedRecordsHeader:`${P}_header`,relatedRecordsLabel:`${P}_label`,relatedRecordsList:`${P}_list`,dateInputContainer:`${T}__date-input-container`,group:N,groupSequential:`${N}--sequential`,groupActive:`${N}--active`},A="data-field-name",B="esri.widgets.FeatureForm",H=r.getLogger(B);let G=class extends f{constructor(e,t){super(e,t),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver((e=>{e.length&&e[0].isIntersecting&&this._incrementRelatedRecordPage()}),{root:window.document}),this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new x,this._onShowAllRelatedRecordsClick=e=>{const{feature:t,relatedRecordCallbacks:s}=this;t&&s?.showAllRelatedRecords&&s.showAllRelatedRecords({parentFeature:t,relationshipId:e})},this._onAddRelatedRecordsClick=(e,t)=>{const{feature:s,relatedRecordCallbacks:o}=this;s&&o?.addRelatedRecord&&o.addRelatedRecord({parentFeature:s,relatedLayer:t,relationshipId:e})},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([i((()=>this.feature),(()=>{n((()=>!this.viewModel.updating)).then((()=>{const e=this._getFocusableInput("forward");this._inputsWithChanges.clear(),this._dateComponentMap.clear(),this._syncGroupInputStates(),this._focusedFieldName=e?.name||null,this._attemptFocusOnNextRender=!0}))})),i((()=>this.groupDisplay),(()=>this._syncGroupInputStates())),this.on("submit",(e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach((e=>this._inputsWithChanges.add(e))),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}})),i((()=>[this.viewModel.activeRelationshipInput,this._listObserverNode]),(()=>this._onObserverChange()))])}loadDependencies(){return g({block:()=>import("../chunks/calcite-block.js"),button:()=>import("../chunks/calcite-button.js"),combobox:()=>import("../chunks/calcite-combobox.js"),"combobox-item":()=>import("../chunks/calcite-combobox-item.js"),"combobox-item-group":()=>import("../chunks/calcite-combobox-item-group.js"),icon:()=>import("../chunks/calcite-icon.js"),input:()=>import("../chunks/calcite-input.js"),"input-date-picker":()=>import("../chunks/calcite-input-date-picker.js"),"input-message":()=>import("../chunks/calcite-input-message.js"),"input-number":()=>import("../chunks/calcite-input-number.js"),"input-time-picker":()=>import("../chunks/calcite-input-time-picker.js"),"input-time-zone":()=>import("../chunks/calcite-input-time-zone.js"),label:()=>import("../chunks/calcite-label.js"),list:()=>import("../chunks/calcite-list.js"),"list-item":()=>import("../chunks/calcite-list-item.js"),loader:()=>import("../chunks/calcite-loader.js"),notice:()=>import("../chunks/calcite-notice.js"),"radio-button":()=>import("../chunks/calcite-radio-button.js"),"radio-button-group":()=>import("../chunks/calcite-radio-button-group.js"),switch:()=>import("../chunks/calcite-switch.js"),"text-area":()=>import("../chunks/calcite-text-area.js")})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return o(H,"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"}),this.viewModel.view}set view(e){o(H,"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"}),this.viewModel.view=e}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return V("div",{class:this.classes($.base,D.widget,D.panel)},"ready"===e?this._renderForm():null)}_renderForm(){return V("form",{class:$.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent())}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const t=null!=e.formTitle&&V(S,{key:"title",level:this.headingLevel},e.formTitle),s=null!=e.formDescription&&V("p",{class:$.description,key:"description"},e.formDescription);return V("div",{class:$.formHeader},t,s)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderActiveRelationshipInput(e.activeRelationshipInput):e.inputs.filter(s).filter((e=>e.visible)).map(((e,t)=>C(e)?this._renderGroup(e,t):k(e)?this._renderLabeledField(e):_(e)?this._renderRelationshipInput(e):void 0))}_renderActiveRelationshipInput(e){return this._renderRelationshipInput(e)}_renderDescriptionOrEmpty(e,t){return null==e?null:V("div",{class:this.classes($.description),id:t},e)}_renderGroup(e,t){const{disabled:s,formTemplate:o,headingLevel:r}=this,{description:i,inputs:n,label:a,open:l}=e,p=n.filter((e=>e.visible)),m=this.viewModel.findField(this._focusedFieldName),u=m?.group===e,d=`${this.id}_group_${t}`,c="sequential"===this.groupDisplay;return V("calcite-block",{class:this.classes($.group,c?$.groupSequential:null,u?$.groupActive:null,s?$.inputDisabled:null),collapsible:!0,"data-group":e,description:i||void 0,disabled:s,heading:`${a}`,headingLevel:o?.title?M(r):r,id:d,key:d,open:l,onCalciteBlockToggle:({target:t})=>this._onGroupToggle(t,e)},p.map((e=>k(e)?this._renderLabeledField(e):_(e)?this._renderRelationshipInput(e):void 0)))}_getFocusableInput(e,t){const s=this.viewModel.allFieldInputs,o="forward"===e?s:s.slice().reverse();let r;if(!t||_(t))r=0;else if(C(t)){const e=t.inputs.find(k);r=e?o.indexOf(e):0}else{let s;if(F(t)&&!t.group.open){const o=t.group.inputs.filter(k);s="forward"===e?o[o.length-1]:o[0]}else s=t;r=o.indexOf(s)+1}for(let e=r;e<o.length;e++){const t=o[e];if(t.visible&&k(t))return t}return null}_renderLabeledField(e){const{dataType:s,feature:o,label:r,layer:i,required:n}=e,a={"aria-label":n?t(this.messages.requiredFieldLabel,{name:r}):r,class:$.label,key:`${i.id}-${o.uid}-${e.name}`},l=[V("div",{class:$.labelTextContent,key:"labelTextContainer"},r,n?V("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==s?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return"date"===s&&"coded-value"!==e.domain?.type?V("label",{...a},l):V("calcite-label",{...a},l)}_renderFieldInput(e){const{dataType:t,domain:s,inputType:o,name:r}=e,i=this.getCommonInputProps(e);if("coded-value"===s?.type){const t=this.viewModel.getFieldValueOptionsForField(r,this.messages.empty);return"switch"!==o||e.hasInvalidSwitchValue?"radio-buttons"===o?this._renderRadioButtonComponents(e,t.flat(),i):this._renderComboBoxComponent(e,t,i):this._renderSwitchComponent(e,i)}return"datetime-picker"===o||"date"===t?this._renderDateComponents(e,i):"number"===t?this._renderNumberComponent(e,i):this._renderStringComponent(e,i)}_renderStringComponent(e,t){return"text-area"===e.inputType?t.readOnly?V("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:e=>this._saveValueFromComponent(e.target)}):V("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:e=>this._saveValueFromComponent(e.target)}):V("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:e=>this._saveValueFromComponent(e.target)})}_renderNumberComponent(e,t){return V("calcite-input-number",{...t,integer:p(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:e=>this._saveValueFromComponent(e.target)})}_renderDateComponents(e,t){const{field:s}=e;switch(s.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,m(s,t.value,{timeZone:this.timeZone,...u(s)}))}}_renderDateOnlyFieldComponent(e,t){const{range:s,valid:o,value:r}=e,{class:i,key:n,readOnly:a}=t,{rawMax:l,rawMin:p}=s;return V("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,class:i,"data-date-part":"date","data-field-name":t[A],key:`${n}-date-input`,max:d(l)?l:void 0,min:d(p)?p:void 0,numberingSystem:c,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,value:null!=r?`${r}`:void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)})}_renderTimeOnlyFieldComponent(e,t){const{valid:s,value:o}=e,{class:r,key:i,readOnly:n}=t;return V("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,class:r,"data-date-part":"time","data-field-name":t[A],key:`${i}-time-input`,numberingSystem:c,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:n,step:e.timeStep,value:null!=o?`${o}`:void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)})}_renderTimestampOffsetFieldComponents(e,t){const{name:s,range:o,valid:r,value:i}=e,{class:n,key:a,readOnly:l}=t,{rawMax:p,rawMin:m}=o,u={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!r,numberingSystem:c,overlayPositioning:"fixed",readOnly:l,[A]:s,onfocus:this._onComponentFocus},d=h(p),j=h(m),y=h(i);return V("div",{class:$.dateInputContainer,key:`${a}-date-time-container`},V("calcite-input-date-picker",{...u,class:n,"data-date-part":"date",key:`${a}-date-input`,max:d?.date??void 0,min:j?.date??void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:y.date??void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)}),V("calcite-input-time-picker",{...u,class:n,"data-date-part":"time",key:`${a}-time-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:e.timeStep,value:y.time??void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)}),e.includeTimeOffset?V("calcite-input-time-zone",{...u,class:n,"data-date-part":"timeZone",disabled:l,key:`${a}-timezone-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:y.timeZoneOffset??"0",onCalciteInputTimeZoneChange:e=>this._saveValueFromDateComponent(e.target)}):null)}_renderDateFieldComponents(e,t){const{includeTime:s,name:o,valid:r,value:i}=e,{class:n,key:a,max:l,min:p,readOnly:m}=t,{timeZone:u}=this,d={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!r,numberingSystem:c,overlayPositioning:"fixed",readOnly:m,[A]:o,onfocus:this._onComponentFocus},h=j(i,u),y=j(l,u),b=j(p,u);return V("div",{class:$.dateInputContainer,key:`${a}-date-time-container`},V("calcite-input-date-picker",{...d,class:n,"data-date-part":"date",key:`${a}-date-input`,max:y?.date??void 0,min:b?.date??void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:h.date??void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)}),s?V("calcite-input-time-picker",{...d,class:n,"data-date-part":"time",key:`${a}-time-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:1,value:h.time??void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)}):null)}_renderReadOnlyComponent(e,t){const s=this.getCommonInputProps(e);return V("calcite-input",{...s,class:this.classes($.fieldInput,$.inputDisabled),readOnly:!0,type:"text",value:null!=t?`${t}`:s.value})}_renderComboBoxComponent(e,t,s){const{value:o,name:r}=e,{messages:i,messagesTemplates:n,viewModel:a,_inputsWithChanges:l}=this,p=t.map((e=>e.map((({name:e,value:t})=>V("calcite-combobox-item",{key:`#${t}`,selected:o===t,textLabel:e,value:`${t}`}))))),[m,u]=p;this.viewModel.fieldsWithInvalidCodedValue.has(e)&&u.unshift(V("calcite-combobox-item",{key:"incompatible-option",readOnly:!0,textLabel:`${e.value}`,value:`${e.value}`}));const d=u.length>0?[V("calcite-combobox-item-group",{key:"recommended",label:i.recommended},m),V("calcite-combobox-item-group",{key:"other",label:n.other},u)]:m,c="INSERT"===a.arcadeEditType,h=l.has(r),j=null==o&&(!c||h);if(e.showNoValueOptionEnabled){const t="",s=e.showNoValueLabel||i.empty;d.unshift(V("calcite-combobox-item",{key:"empty-option",selected:j,textLabel:i.empty,value:t},s))}const y=c&&e.showNoValueOptionEnabled&&!h?()=>{}:s.onblur;return V("calcite-combobox",{...s,allowCustomValues:!1,clearDisabled:!0,disabled:s.readOnly,onblur:y,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({target:e})=>{j&&0===e.selectedItems.length?this._ignoreDeselectionOfNoValueOption(e):this._saveValueFromComponent(e)}},d)}_renderRadioButtonComponents(e,t,s){const{name:o,value:r}=e,i=t.map((({name:e,value:t})=>this._renderRadioButtonComponent({key:e,label:e,name:o,value:t,selected:t===r,props:s})));if(e.showNoValueOptionEnabled){const t="",n=e.showNoValueLabel||this.messages.empty,a=r===t||null===r;i.unshift(this._renderRadioButtonComponent({key:"empty-option",label:n,name:o,value:t,selected:a,props:s}))}return V("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:$.inputRadioGroup,"data-field-name":s[A],key:`${s.key}-radio-group`,layout:"vertical",name:s.key,required:s.required},i)}_renderSwitchComponent(e,t){const{value:s}=e,o=!!R(e.element,"switch")&&s===e.element.input.onValue;return V("calcite-switch",{...t,checked:o,class:$.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:e=>this._saveValueFromComponent(e.target)})}_renderRadioButtonComponent({key:e,name:t,value:s,selected:o,label:r,props:i}){return V("calcite-label",{class:$.inputRadioLabel,key:e,layout:"inline"},V("calcite-radio-button",{...i,afterCreate:void 0,afterUpdate:void 0,checked:o,class:$.inputRadio,disabled:i.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:s,onCalciteRadioButtonChange:({target:e})=>{e.checked&&this._saveValueFromComponent(e)}}),r)}_renderAuxiliaryText(e){const t=e.name,s=this._inputsWithChanges.has(t)&&!e.valid?I(e,this.messages,this.timeZone):null!=this.viewModel.contingencyConstraintViolations.get(t)?this.messages.validationErrors.valuesIncompatible:null!=e.valueExpressionExecutor&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=s?V("calcite-input-message",{icon:!0,status:"invalid"},s):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:s,relationshipId:o,showAllActionVisible:r}=e,{relatedRecordCallbacks:i}=this;if(!r||!i?.showAllRelatedRecords)return;const n=this.messages;return V("calcite-list-item",{description:t(n.totalCount,{count:s}),label:n.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(o)},V("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:s,relatedLayer:o}=e,{messages:r,relatedRecordCallbacks:i}=this;if(t&&i?.addRelatedRecord&&o)return V("calcite-button",{alignment:"center",appearance:"outline-fill",class:$.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${s}-add-button`,onclick:()=>this._onAddRelatedRecordsClick(s,o),round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?r.addRecord:r.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:s,description:o,title:r}=e,{feature:i,relatedRecordCallbacks:n}=this,{highlightHelper:a}=this.viewModel,l=a?()=>a.add(s):void 0,p=a?()=>a.remove(s):void 0;return V("calcite-list-item",{bind:this,description:o,key:`${t}-${s.uid}`,label:r,onclick:()=>{a?.removeAll(),n?.editRelatedRecord&&i&&n.editRelatedRecord({parentFeature:i,relationshipId:t,relatedFeature:s})},onmouseenter:l,onmouseleave:p,value:r},V("calcite-icon",{icon:w(s),scale:"m",slot:"content-start"}),V("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:t,relationshipId:s,showAllEnabled:o}=e,r=o?null:this._renderDescriptionOrEmpty(e.description),i=t>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return V("calcite-label",{class:this.classes($.label,$.relatedRecordsLabel),key:`relationship-${s}-container`},V("div",null,this._renderRelatedRecordsHeaderContainer(e),r,i),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){const t=e.updating||!e.loaded;return V("div",{class:$.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},V("span",null,e.label),t?V("calcite-loader",{inline:!0,key:"loader",label:this.messagesCommon?.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t}=e;return V("calcite-list",{class:$.relatedRecordsList},e.relatedFeatureInfos.map((e=>this._renderRelatedRecordListItem(e,t))),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){const{messages:s}=this,o=e.relatedLayerIsTable?s.noOriginKeyRecord:s.noOriginKeyFeature,r=e.relationship?.keyField,i=this.viewModel.findField(r),n=e.layer?.fieldsIndex.get(r),a=i?.label||n?.alias||r,l=t(o,{relatedLayerName:e.relatedLayer?.title,originKeyField:a});return V("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},V("div",{slot:"message"},l))}_renderNoRelatedRecordsNotice(){return V("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},V("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){if(this.viewModel.activeRelationshipInput?.showAllEnabled)return V("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:$.listObserver,key:"feature-observer"})}getCommonInputProps(e){const{disabled:t}=this,{editable:s,hint:o,label:r,maxLength:i,minLength:n,name:a,range:{max:l,min:p},required:m,valid:u,value:d}=e,c=this._inputsWithChanges.has(a),h=!s||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":u?"false":"true",class:this.classes($.fieldInput,h?$.inputDisabled:null,c&&!u?$.inputInvalid:null),key:a,label:r,max:null!=l?l:void 0,min:null!=p?p:void 0,maxLength:i>-1?i:void 0,minLength:n>-1?n:void 0,placeholder:o??void 0,readOnly:h,required:m,value:null==d?"":`${d}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[A]:a}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(A))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),s=e.dataset.datePart,o=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&null!=e.value){const t=e.value,s=new ResizeObserver((()=>{e.value=void 0,e.value=t,s.unobserve(e)}));s.observe(e)}if(null!=o)switch(s){case"date":o.date=e;break;case"time":o.time=e;break;case"timeZone":o.timeZone=e}else this._dateComponentMap.set(t.name,{[s]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);O(t)&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,s=e.querySelector("calcite-radio-button"),o=t||s;o&&this._afterComponentCreateOrUpdate(o)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,s=this._getFieldInputFromHTMLElement(e),o=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&o===s&&(this._attemptFocusOnNextRender=!1,F(s)&&(s.group.open=!0),e.setFocus())}_onComponentFocus(e){const t=e.target,s=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=s.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const t=this._getFieldInputFromHTMLElement(e),s=t.field.type,{name:o,range:r}=t,i=this._dateComponentMap.get(o);if(!i)return;let n=this.viewModel.getValue(o),a=null;"date-only"===s?a=e.value:"time-only"===s?(n=y(n),a=y(e.value)):a="timestamp-offset"===s?null!=e.value?b({dateComponent:i.date,timeComponent:i.time,timeZoneComponent:i.timeZone,oldValue:n}):null:null!=e.value?v({oldValue:n,dateComponent:i.date,timeComponent:i.time,timeZone:this.timeZone,max:r.max,min:r.min}):null,null!==a&&e.value?n!==a&&this._updateFieldValue(o,a):this._updateFieldValue(o,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e);this._updateFieldValue(t.name,this._parseValue(e))}_onComponentKeyDown({key:e,target:t}){const s=this._getFieldInputFromHTMLElement(t);"Enter"===e&&F(s)&&!s.group.open&&(s.group.open=!0)}_updateFieldValue(e,t){if(this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),this.viewModel.fieldsWithContingentValues.has(e)){const e=Object.fromEntries(Object.entries(this.getValues()).filter((([e,t])=>null!=t)));this.viewModel.validateContingencyConstraints(e)}}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),s=e.value;return R(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:null==s||""===s?null:"number"===t.dataType?"-0"===s||"-0."===s||"-0,"===s?s:parseFloat(s):"date"===t.field.type?parseFloat(s):s}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:s}=e;0===s.length&&t&&"selected"in t?t.selected=!0:H.warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){e.open?(t.open=!0,this._focusedFieldName=this._getFocusableInput("forward",t)?.name||null,this._attemptFocusOnNextRender=!0,"sequential"===this.groupDisplay&&this.viewModel.allGroupInputs.forEach((e=>{e!==t&&(e.open=!1)}))):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){"Enter"===e.key&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e?.incrementPage()}_syncGroupInputStates(){if("sequential"!==this.groupDisplay)return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter((e=>e.open));0===t.length?e[0].open=!0:t.length>1&&t.slice(1).forEach((e=>e.open=!1))}};e([a()],G.prototype,"_listObserverNode",void 0),e([a()],G.prototype,"_relatedRecordsEnabled",null),e([a()],G.prototype,"disabled",null),e([a()],G.prototype,"feature",null),e([a()],G.prototype,"formTemplate",null),e([a()],G.prototype,"groupDisplay",void 0),e([a()],G.prototype,"headingLevel",void 0),e([a()],G.prototype,"label",null),e([a()],G.prototype,"layer",null),e([a()],G.prototype,"map",null),e([a(),L("esri/widgets/FeatureForm/t9n/FeatureForm")],G.prototype,"messages",void 0),e([a(),L("esri/t9n/common")],G.prototype,"messagesCommon",void 0),e([a(),L("esri/widgets/Feature/t9n/Feature")],G.prototype,"messagesFeature",void 0),e([a(),L("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],G.prototype,"messagesTemplates",void 0),e([a()],G.prototype,"relatedRecordCallbacks",null),e([a()],G.prototype,"relationshipId",null),e([a()],G.prototype,"spatialReference",null),e([a()],G.prototype,"strict",null),e([a()],G.prototype,"timeZone",null),e([a()],G.prototype,"view",null),e([a(),U(["value-change","submit"])],G.prototype,"viewModel",void 0),G=e([l(B)],G);const q=G;export{q as default};
