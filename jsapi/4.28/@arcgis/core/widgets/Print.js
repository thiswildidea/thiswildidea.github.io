/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import e from"../core/Collection.js";import{o as s,e as o}from"../core/promiseUtils.js";import{clone as i}from"../core/lang.js";import{L as a}from"../chunks/Logger.js";import{watch as n,initial as l}from"../core/reactiveUtils.js";import{addProxy as r,hasSameOrigin as p}from"../core/urlUtils.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import{subclass as d}from"../core/accessorSupport/decorators/subclass.js";import{g as m}from"../chunks/utils6.js";import u from"./Widget.js";import h from"../core/Accessor.js";import"../chunks/typedArrayUtil.js";import y from"./Print/PrintViewModel.js";import b from"./Print/TemplateOptions.js";import{g as _}from"../chunks/globalCss.js";import{H as g}from"../chunks/Heading.js";import{l as j}from"../chunks/legacyIcon.js";import{P as f}from"../chunks/Popover.js";import{m as v,l as T}from"../chunks/widgetUtils.js";import{m as k}from"../chunks/messageBundle.js";import{t as x}from"../chunks/jsxFactory.js";import"../core/Evented.js";import"../chunks/handleUtils.js";import"../core/Handles.js";import"../config.js";import"../chunks/maybe.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../core/Error.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/time.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/asyncUtils.js";import"../core/JSONSupport.js";import"../kernel.js";import"../request.js";import"../intl.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../chunks/messages.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../core/Loadable.js";import"../portal/Portal.js";import"../chunks/reader.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/Ellipsoid.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../chunks/submitJob.js";import"../rest/geoprocessor/GPOptions.js";import"../rest/support/JobInfo.js";import"../chunks/enumeration.js";import"../geometry/support/normalizeUtils.js";import"../geometry/Polygon.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/zmUtils.js";import"../geometry/Polyline.js";import"../chunks/normalizeUtilsCommon.js";import"../geometry/support/jsonUtils.js";import"../geometry/Multipoint.js";import"../chunks/simplify.js";import"../geometry.js";import"../chunks/typeUtils.js";import"../chunks/utils7.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../layers/support/MapImage.js";import"../rest/support/DataFile.js";import"../rest/support/FeatureSet.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../chunks/Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rest/support/LinearUnit.js";import"../rest/support/ParameterValue.js";import"../rest/support/RasterData.js";import"../rest/support/GPMessage.js";import"../rest/print.js";import"../chunks/floorFilterUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../chunks/layoutTemplate.js";import"../rest/support/PrintTemplate.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../rest/support/PrintParameters.js";import"./Print/CustomTemplate.js";let w=class extends h{constructor(t){super(t),this.state="pending",this.url=""}initialize(){this.addHandles([n((()=>[this.extension,this.name]),(()=>this._setFormattedFileName()),l)])}_setFormattedFileName(){if(!this.name||!this.extension)return;let t=this.name+"."+this.extension;this.count&&(t=this.name+"("+this.count+")."+this.extension),this.formattedName=t}};t([c()],w.prototype,"count",void 0),t([c()],w.prototype,"error",void 0),t([c()],w.prototype,"extension",void 0),t([c()],w.prototype,"formattedName",void 0),t([c()],w.prototype,"name",void 0),t([c()],w.prototype,"state",void 0),t([c()],w.prototype,"url",void 0),w=t([d("esri.widgets.print.FileLink")],w);const C=w,O=e.ofType(C),S="MAP_ONLY";var I;!function(t){t.layout="layoutTab",t.mapOnly="mapOnlyTab"}(I||(I={}));const L="esri-print",M=`${L}__advanced-options-button`,F={base:L,widgetIcon:j.printer,headerTitle:`${L}__header-title`,inputText:`${L}__input-text`,layoutTabList:`${L}__layout-tab-list`,layoutTab:`${L}__layout-tab`,layoutSection:`${L}__layout-section`,mapOnlySection:`${L}__map-only-section`,scaleInput:`${L}__scale-input`,templateList:`${L}__template-list`,templateListScroller:`${L}__template-list-scroller`,templateListFooter:`${L}__template-list-footer`,loader:`${L}__loader`,advancedOptionsButton:M,advancedOptionsButtonContainer:`${M}-container`,advancedOptionsButtonTitle:`${M}-title`,advancedOptionsButtonIconOpened:`${M}-icon--opened`,advancedOptionsButtonIconClosed:`${M}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${M}-icon--closed-rtl`,refreshButton:`${L}__refresh-button`,swapButton:`${L}__swap-button`,linkButton:`${L}__link-button`,printButton:`${L}__export-button`,templateButton:`${L}__template-button`,formSectionContainer:`${L}__form-section-container`,advancedOptionsSection:`${L}__advanced-options-section`,advancedOptionsContainer:`${L}__advanced-options-container`,authorInfoContainer:`${L}__author-info-container`,copyrightInfoContainer:`${L}__copyright-info-container`,exportedFilesContainer:`${L}__export-panel-container`,exportedFilesTitle:`${L}__export-title`,exportedFile:`${L}__exported-file`,exportedFileLink:`${L}__exported-file-link`,exportedFileLinkTitle:`${L}__exported-file-link-title`,heightContainer:`${L}__height-container`,legendInfoContainer:`${L}__legend-info-container`,printWidgetContainer:`${L}__container`,panelContainer:`${L}__panel-container`,scaleInfoContainer:`${L}__scale-info-container`,scaleInputContainer:`${L}__scale-input-container`,sizeContainer:`${L}__size-container`,widthContainer:`${L}__width-container`,panelError:`${L}__panel--error`,exportedFileError:`${L}__exported-file--error`},P="User sets an invalid layout, resetting it to the default valid one...",$="User sets an invalid format, resetting it to the default valid one...";function D(t){return t?.toUpperCase()===S}let E=class extends u{constructor(t,e){super(t,e),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._focusedTemplateIndex=0,this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this._selectTemplateNode=null,this._templateListPopover=new f({owner:this,placement:"top",offset:[0,-100],anchorElement:()=>this._selectTemplateNode,renderContentFunction:this._renderTemplateList}),this.exportedLinks=new O,this.headingLevel=3,this.iconClass=F.widgetIcon,this.icon=null,this.templateOptions=new b,this.viewModel=new y,this._handleTemplateListCreation=t=>t.focus(),this._handleTemplateChildBlur=t=>{const e=t.relatedTarget?.closest(`.${F.templateList}`);e||this._handleCloseTemplateSelection()},this._handleCloseTemplateSelection=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!1,this._selectTemplateNode?.focus()},this._handleSelectTemplateClick=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!0},this._handleTemplateListClick=t=>{const e=(s=t.target,s?.["data-template"]);var s;e&&this._applyTemplate(e)},this._handleTemplateListKeyDown=t=>{if(this._focusedTemplateIndex){if(v(t.key))return this._applyTemplate(this.viewModel.defaultTemplates.at(this._focusedTemplateIndex)),void t.preventDefault();if("ArrowDown"===t.key||"ArrowUp"===t.key){const{defaultTemplates:e}=this.viewModel,s="ArrowDown"===t.key?1:-1,o=(this._focusedTemplateIndex+s)%e.length;this._focusedTemplateIndex=o<0?e.length-1:o;const i=t.currentTarget;T(i.querySelectorAll(`.${_.menuItem}`)[this._focusedTemplateIndex],i.parentElement),t.preventDefault()}"Escape"===t.key&&this._handleCloseTemplateSelection()}},this._removeLink=t=>{const e=t.currentTarget["data-item"];e&&"error"===e.state&&this.exportedLinks.remove(e)},this._handleLinkClick=t=>{const e=t.currentTarget,{href:s}=e,o=m(this.viewModel.effectivePrintServiceUrl);if(!o)return;if(!t.isTrusted)return void t.stopPropagation();t.preventDefault();const i=new URL(s);i.searchParams.set("token",o),e.href=i.href,e.click(),e.href=s},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([n((()=>this.viewModel?.templatesInfo),(t=>{const{format:e,layout:s}=this.templateOptions;if(t){const o=s===t.layout.defaultValue||D(s)||t.layout.choiceList&&s&&t.layout.choiceList.includes(s),i=e===t.format.defaultValue||t.format.choiceList&&e&&t.format.choiceList.includes(e);o||(s&&a.getLogger(this).warn(P),this.templateOptions.layout=t.layout.defaultValue),i||(e&&a.getLogger(this).warn($),this.templateOptions.format=t.format.defaultValue),D(s)&&(this._layoutTabSelected=!1)}}),l),n((()=>this.templateOptions?.format),(t=>{const{viewModel:{templatesInfo:e}}=this;if(e&&t){let s=!1;e.format.choiceList&&e.format.choiceList.forEach((e=>{e.toUpperCase()===t.toUpperCase()&&(this.templateOptions.format=e,s=!0)})),s||(this.templateOptions.format=e.format.defaultValue,a.getLogger(this).warn($)),this.scheduleRender()}}),l),n((()=>this.templateOptions?.layout),(t=>{const{viewModel:{templatesInfo:e}}=this;if(e&&t){this._layoutTabSelected=!D(t);let s=!this._layoutTabSelected;s||e.layout.choiceList&&e.layout.choiceList.forEach((e=>{e.toUpperCase()===t.toUpperCase()&&(this.templateOptions.layout=e,s=!0)})),s||(this.templateOptions.layout=e.layout.defaultValue,a.getLogger(this).warn(P));const o=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=o?i(o):null,this.scheduleRender()}}),l),n((()=>this.templateOptions?.dpi),(t=>{t<=0?this.templateOptions.dpi=1:this.scheduleRender()}),l),n((()=>this.viewModel?.view?.scale),(t=>{const{scale:e,scaleEnabled:s}=this.templateOptions;s&&e||(this.templateOptions.scale=t)}),l)]);const{height:t,width:e}=this.templateOptions;this.templateOptions.width=e||800,this.templateOptions.height=t||1100;const s=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>clearTimeout(s)))}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(t){this.viewModel.allowedFormats=t}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(t){this.viewModel.allowedLayouts=t}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(t){this.viewModel.extraParameters=t}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(t){this.viewModel.includeDefaultTemplates=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get portal(){return this.viewModel.portal}set portal(t){this.viewModel.portal=t}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(t){this.viewModel.printServiceUrl=t}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(t){this.viewModel.templateCustomTextElements=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{attributionEnabled:t,author:e,copyright:s,dpi:o,format:i,height:a,layout:n,legendEnabled:l,northArrowEnabled:r,scaleEnabled:p,scale:c,width:d}=this.templateOptions,m="ready"!==this.viewModel?.state,u=this._renderTitleOrFileNameSection(),{includeDefaultTemplates:h,messages:y,viewModel:b}=this,f=this.viewModel?.templatesInfo?.format?.choiceList||[],v=f.length>0?f.map((t=>x("option",{key:t,selected:t===i,value:t},t.toUpperCase()))):x("option",{key:"format-default-option"},y.formatDefaultOption),T=x("div",{class:F.formSectionContainer},x("label",null,y.fileFormatTitle,x("select",{bind:this,class:_.select,"data-target-property":"format",onchange:this._updateFromOption},v))),k=this.viewModel?.templatesInfo?.layout?.choiceList,w=k?.length?k.map((t=>x("option",{key:t,selected:t===n,value:t},y[t]||t))):x("option",{key:"layout-default-option"},y.layoutDefaultOption),C=x("div",{class:F.formSectionContainer},x("label",null,y.layoutTitle,x("select",{bind:this,class:_.select,"data-target-property":"layout",onchange:this._updateFromOption},w))),O=x("div",{class:F.formSectionContainer},x("label",null,y.dpi,x("input",{bind:this,class:this.classes(F.inputText,_.input),"data-input-name":"dpi",min:"1",onchange:this._handleDPIChange,tabIndex:0,type:"number",value:`${o}`}))),S=x("div",{class:this.classes(F.scaleInfoContainer,F.formSectionContainer)},x("label",null,x("input",{bind:this,checked:p,"data-option-name":"scaleEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),y.scale),x("div",{class:F.scaleInputContainer},x("input",{"aria-label":y.scaleLabel,"aria-valuenow":`${c}`,bind:this,class:this.classes(F.inputText,_.input,F.scaleInput),"data-input-name":"scale",disabled:!p,onchange:this._updateInputValue,role:"spinbutton",tabIndex:0,type:"number",value:`${c}`}),x("button",{"aria-label":y.reset,bind:this,class:this.classes(_.widgetButton,F.refreshButton,j.refresh),onclick:this._resetToCurrentScale,tabIndex:0,type:"button"}))),L=this._advancedOptionsVisibleForLayout?x("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:F.advancedOptionsContainer},S,x("div",{class:this.classes(F.authorInfoContainer,F.formSectionContainer)},x("label",null,y.author,x("input",{bind:this,class:this.classes(F.inputText,_.input),"data-input-name":"author",onchange:this._updateInputValue,tabIndex:0,type:"text",value:e??""}))),x("div",{class:this.classes(F.copyrightInfoContainer,F.formSectionContainer)},x("label",null,y.copyright,x("input",{bind:this,class:this.classes(F.inputText,_.input),"data-input-name":"copyright",onchange:this._updateInputValue,tabIndex:0,type:"text",value:s??""}))),O,x("div",{class:this.classes(F.legendInfoContainer,F.formSectionContainer)},x("label",null,x("input",{bind:this,checked:l,"data-option-name":"legendEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),y.legend)),this.viewModel.templateToNorthArrowInfo[n]?x("div",{class:this.classes(F.legendInfoContainer,F.formSectionContainer),key:"north-arrow"},x("label",null,x("input",{bind:this,checked:r,"data-option-name":"northArrowEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),y.northArrow)):null,this._renderCustomTextElementSection()):null,M=this._advancedOptionsVisibleForMapOnly?x("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:F.advancedOptionsContainer},S,O,x("div",{class:F.formSectionContainer},x("label",null,x("input",{bind:this,checked:t,"data-option-name":"attributionEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),y.attribution)),this._renderCustomTextElementSection()):null,P=this._layoutTabSelected?x("section",{"aria-labelledby":`${this.id}__layoutTab`,class:F.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},x("div",{class:F.panelContainer},u,C,this._layoutTabSelected?T:null),x("div",{class:this.classes(F.panelContainer,F.advancedOptionsSection)},x("button",{"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false","aria-label":y.advancedOptions,bind:this,class:F.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},x("div",{class:F.advancedOptionsButtonContainer},x("span",{"aria-hidden":"true",class:this.classes(j.rightTriangleArrow,F.advancedOptionsButtonIconClosed)}),x("span",{"aria-hidden":"true",class:this.classes(j.leftTriangleArrow,F.advancedOptionsButtonIconClosed_RTL)}),x("span",{"aria-hidden":"true",class:this.classes(j.downArrow,F.advancedOptionsButtonIconOpened)}),x("span",{class:F.advancedOptionsButtonTitle},y.advancedOptions))),L)):x("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:F.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},x("div",{class:F.panelContainer},u,this._layoutTabSelected?null:T,x("div",{class:this.classes(F.sizeContainer,F.formSectionContainer)},x("div",{class:F.widthContainer},x("label",null,y.width,x("input",{bind:this,class:this.classes(F.inputText,_.input),"data-input-name":"width",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${d}`}))),x("div",{class:F.heightContainer},x("label",null,y.height,x("input",{bind:this,class:this.classes(F.inputText,_.input),"data-input-name":"height",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${a}`}))),x("button",{"aria-label":y.swap,bind:this,class:this.classes(_.widgetButton,F.swapButton,j.swap),onclick:this._switchInput,tabIndex:0,type:"button"})),x("div",{class:this.classes(F.panelContainer,F.advancedOptionsSection)},x("button",{"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false","aria-label":y.advancedOptions,bind:this,class:F.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},x("div",{class:F.advancedOptionsButtonContainer},x("span",{"aria-hidden":"true",class:this.classes(j.rightTriangleArrow,F.advancedOptionsButtonIconClosed)}),x("span",{"aria-hidden":"true",class:this.classes(j.leftTriangleArrow,F.advancedOptionsButtonIconClosed_RTL)}),x("span",{"aria-hidden":"true",class:this.classes(j.downArrow,F.advancedOptionsButtonIconOpened)}),x("span",{class:F.advancedOptionsButtonTitle},y.advancedOptions))),M))),$=this.exportedLinks.toArray(),D=this._renderExportedLink($),E={[_.buttonDisabled]:m||!n&&!i},{view:U}=this,V=!U||"2d"!==U.type,A=x("div",{class:F.panelError},V?y.sceneViewError:y.serviceError),B=x("div",null,x("ul",{bind:this,class:F.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},x("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._layoutTabSelected}`,class:F.layoutTab,"data-tab-id":I.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},y.layoutTab),x("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${!this._layoutTabSelected}`,class:F.layoutTab,"data-tab-id":I.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},y.mapOnlyTab)),P,x("button",{"aria-label":y.exportDescription,bind:this,class:this.classes(F.printButton,_.button,E),disabled:m,onclick:this._handlePrintMap,tabIndex:0,type:"button"},y.export),h&&b.defaultTemplates.length>0?this._renderTemplateSectionTrigger():null,x("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:F.exportedFilesContainer},x(g,{class:F.exportedFilesTitle,level:this.headingLevel},y.exportText),$.length>0?null:x("div",null,x("div",null,y.exportHint)),D)),N=x("div",{class:F.printWidgetContainer},x("header",{class:F.headerTitle},y.export),this.error||V||!this.view?A:B),R="initializing"===this.viewModel?.state?this._renderLoader():N;return x("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes(F.base,_.widget,_.panel)},R)}_renderTemplateSectionTrigger(){const{messages:t,_templateListPopover:e}=this,s=e.open;return x("button",{afterCreate:t=>this._selectTemplateNode=t,"aria-controls":s?`${this.id}__template-selection`:"","aria-label":t.selectTemplateDescription,"aria-pressed":s.toString(),class:this.classes(_.button,_.buttonTertiary,F.templateButton),onclick:this._handleSelectTemplateClick,title:t.selectTemplateDescription,type:"button"},t.selectTemplate)}_renderCustomTextElementSection(){const{templateOptions:{customTextElements:t}}=this;return t?x("div",{class:F.formSectionContainer,key:"custom-text-elements"},t.map((t=>{const[e,s]=Object.entries(t)[0];return"date"===e?null:x("label",{key:e},e,x("input",{bind:this,class:this.classes(F.inputText,_.input),"data-input-custom":!0,"data-input-name":e,onchange:this._updateInputValue,type:"text",value:s}))}))):null}_renderTemplateList(){const{messages:t,messagesCommon:e,viewModel:s}=this,{defaultTemplates:o}=s,i=t.selectTemplateDescription,a=`${this.id}__template-selection`;return x("div",{class:this.classes(F.templateList,_.widget,_.panel),id:a},x(g,{class:_.menuHeader,level:this.headingLevel},t.selectTemplate),x("div",{class:F.templateListScroller},x("ul",{afterCreate:this._handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":i,class:_.menuList,key:"templates",onblur:this._handleTemplateChildBlur,onclick:this._handleTemplateListClick,onkeydown:this._handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:i},o.toArray().map(((e,s)=>{const o=s===this._focusedTemplateIndex,i=e.description??"",a=e.label??"";return x("li",{"aria-label":i,class:this.classes(_.menuItem,{[_.menuItemFocus]:o}),"data-template":e,id:`${this.id}__template-item--${s}`,key:a,title:i},D(a)?t.mapOnlyTab:a)})))),x("div",{class:F.templateListFooter},x("button",{class:this.classes(_.button,_.buttonSecondary),onblur:this._handleTemplateChildBlur,onclick:this._handleCloseTemplateSelection,type:"button"},e.done)))}_applyTemplate(t){const{format:e,layout:s,layoutOptions:o}=t,{templateOptions:i}=this;this._templateListPopover.open=!1,this._toggleTab("map-only"===s?I.mapOnly:I.layout,!1),e&&(i.format=e),s&&(i.layout=s),this._focusedTemplateIndex=null,i.legendEnabled=o?.legend??i.legendEnabled,this._handleCloseTemplateSelection()}_renderTitleOrFileNameSection(){const{templateOptions:t,messages:e}=this;let s,o,i,a;return this._layoutTabSelected?(s=e.title,o=e.titlePlaceHolder,i=t.title,a="title"):(s=e.fileName,o=e.fileNamePlaceHolder,i=t.fileName,a="fileName"),x("div",{class:F.formSectionContainer,key:a},x("label",null,s,x("input",{bind:this,class:this.classes(F.inputText,_.input),"data-input-name":a,onchange:this._updateInputValue,placeholder:o,tabIndex:0,type:"text",value:i??""})))}_handleRootAfterCreate(t){this._rootNode=t,this.addHandles(s(t,"scroll",(()=>{this._templateListPopover.open&&this._handleCloseTemplateSelection()})))}_focusOnTabChange(t){if(!this._activeTabFocusRequested)return;const e=t.getAttribute("data-tab-id");("layoutTab"===e&&this._layoutTabSelected||"mapOnlyTab"===e&&!this._layoutTabSelected)&&(t.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const t={[F.loader]:this._awaitingServerResponse};return x("div",{class:this.classes(t),key:"loader"})}_createFileLink(t,e){const s=e||this.messages.untitled,o=t.format.toLowerCase(),i=o.includes("png")?"png":o,a=s+i;return void 0!==this._exportedFileNameMap[a]?this._exportedFileNameMap[a]++:this._exportedFileNameMap[a]=0,new C({name:s,extension:i,count:this._exportedFileNameMap[a]})}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view?.scale}_updateCustomTextElementValue(t,e,s){t.find((t=>{const[s]=Object.entries(t)[0];return s===e}))[e]=s}_updateInputValue(t){const e=t.target,s=e.getAttribute("data-input-name"),o=!!e["data-input-custom"],{templateOptions:i}=this;if(o)return void this._updateCustomTextElementValue(i.customTextElements,s,e.value);let a;if("number"===e.type){if(!function(t){return!isNaN(t)&&t>0}(e.valueAsNumber)){const t=i[s];return void(e.value=`${t}`)}a=e.valueAsNumber}else a=e.value;i[s]=a}_handleDPIChange(t){this._updateInputValue(t);const e=t.currentTarget.valueAsNumber,{height:s,width:o}=function(t){return{width:Math.round(8.3333*t),height:Math.round(11.4583*t)}}(e),{templateOptions:i}=this;i.height=s,i.width=o}_handlePrintMap(){this._pendingExportScroll=!0;const{templateOptions:t}=this,e=this.viewModel.toPrintTemplate(t),s=this._layoutTabSelected?e.layoutOptions?.titleText:t.fileName,o=this._createFileLink(e,s);this.exportedLinks.add(o),this.emit("submit",{link:o}),this.viewModel.print(e).then((t=>{o.set({url:t&&t.url,state:"ready"})})).catch((t=>{o.set({error:t,state:"error"})})).then((()=>{this.emit("complete",{link:o}),this.scheduleRender()}))}_updateFromOption(t){const e=t.target,s=e.selectedOptions?e.selectedOptions.item(0)?.value:e.options[e.selectedIndex].value,o=e.getAttribute("data-target-property");this.templateOptions[o]=s}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const t=this._rootNode;if(!t)return;const{clientHeight:e,scrollHeight:s}=t,o=s-e;o>0&&(t.scrollTop=o)}_toggleInputValue(t){const e=t.target,s=e.getAttribute("data-option-name");this.templateOptions[s]=e.checked,"scaleEnabled"===s&&(this.templateOptions[s]||this._resetToCurrentScale())}_renderExportedLink(t){const e=this.messages;return t.map((t=>{const{error:s,url:o,state:i}=t,a=t.formattedName??"",n="error"===i,l="pending"===i,c="ready"===i,d={[_.anchorDisabled]:l||n};let m=o||null;m&&(m=r(m));const u=p(o,location.href),h={[j.loadingIndicator]:l,[_.rotating]:l,[j.download]:u&&c,[j.launchLinkExternal]:!u&&c,[j.error]:n,[F.exportedFileError]:n},y={[F.exportedFileError]:n};let b;b=l?e.pending:c?e.ready:e.errorMessage;const g=n?"print-task:cim-symbol-unsupported"===s?.name?e.exportWebMapCIMError:e.exportWebMapError:"";return x("div",{"aria-label":b,class:F.exportedFile,"data-item":t,key:a,onclick:this._removeLink,title:g},x("a",{"aria-label":`${a}. ${e.linkReady}`,class:this.classes(F.exportedFileLink,_.anchor,d),download:a,href:m??"",onclick:this._handleLinkClick,rel:"noreferrer",tabIndex:0,target:"_blank"},x("span",{class:this.classes(h)}),x("span",{class:this.classes(F.exportedFileLinkTitle,y)},a)))}))}_toggleLayoutPanel(t){const e=t.target;this._toggleTab(e.getAttribute("data-tab-id"))}_toggleTab(t,e=!0){if(this._layoutTabSelected=t===I.layout,this._layoutTabSelected){const t=this.viewModel?.templatesInfo?.layout?.choiceList;this.templateOptions.layout=t?t[0]:"letter-ansi-a-landscape"}else this.templateOptions.layout=S;e&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(t){const e=o(t),s=t.target.getAttribute("data-tab-id");if(v(e))return this._toggleTab(s),t.preventDefault(),void t.stopPropagation();"ArrowLeft"!==e&&"ArrowRight"!==e||(this._toggleTab(s===I.layout?I.mapOnly:I.layout),t.preventDefault(),t.stopPropagation())}};t([c()],E.prototype,"allowedFormats",null),t([c()],E.prototype,"allowedLayouts",null),t([c()],E.prototype,"error",null),t([c({type:O})],E.prototype,"exportedLinks",void 0),t([c()],E.prototype,"extraParameters",null),t([c()],E.prototype,"headingLevel",void 0),t([c()],E.prototype,"iconClass",void 0),t([c()],E.prototype,"icon",void 0),t([c()],E.prototype,"includeDefaultTemplates",null),t([c()],E.prototype,"label",null),t([c(),k("esri/widgets/Print/t9n/Print")],E.prototype,"messages",void 0),t([c(),k("esri/t9n/common")],E.prototype,"messagesCommon",void 0),t([c()],E.prototype,"portal",null),t([c()],E.prototype,"printServiceUrl",null),t([c()],E.prototype,"templateCustomTextElements",null),t([c({type:b})],E.prototype,"templateOptions",void 0),t([c()],E.prototype,"view",null),t([c({type:y})],E.prototype,"viewModel",void 0),E=t([d("esri.widgets.Print")],E);const U=E;export{U as default};
