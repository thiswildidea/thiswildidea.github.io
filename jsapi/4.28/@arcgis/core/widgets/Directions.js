/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{formatNumber as t}from"../intl.js";import{isAbortError as s,o,p as r}from"../core/promiseUtils.js";import{m as i}from"../chunks/handleUtils.js";import{b as n}from"../chunks/maybe.js";import{watch as a,initial as l,when as c,on as u}from"../core/reactiveUtils.js";import{property as p}from"../core/accessorSupport/decorators/property.js";import{cast as d}from"../core/accessorSupport/decorators/cast.js";import"../chunks/typedArrayUtil.js";import{subclass as h}from"../core/accessorSupport/decorators/subclass.js";import{d as m}from"../chunks/defaultUnit.js";import v from"../rest/support/Stop.js";import _ from"../symbols/SimpleMarkerSymbol.js";import g from"./Search.js";import y,{l as b}from"./Widget.js";import S from"./Directions/DirectionsViewModel.js";import"../chunks/ensureType.js";import j from"../portal/Portal.js";import"../chunks/widgetUtils.js";import{m as f}from"../chunks/messageBundle.js";import{t as k}from"../chunks/jsxFactory.js";import{c as w,t as M,f as C}from"../chunks/unitFormatUtils.js";import{l as T}from"../chunks/legacyIcon.js";import{i as D,m as I}from"./Search/LocatorSearchSource.js";import $ from"./support/DatePicker.js";import{g as L}from"../chunks/globalCss.js";import{H as P,i as R}from"../chunks/Heading.js";import B from"./support/TimePicker.js";import{a as x}from"../chunks/accessibleHandler.js";import{S as E}from"../chunks/sortable.esm.js";import{f as U,c as A}from"../chunks/date.js";import"../chunks/locale.js";import"../chunks/Logger.js";import"../config.js";import"../core/lang.js";import"../chunks/messages.js";import"../core/Error.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/metadata.js";import"../chunks/utils.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/time.js";import"../chunks/assets.js";import"../chunks/jsonMap.js";import"../chunks/timeZoneUtils.js";import"../chunks/datetime.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/getDefaultUnitForView.js";import"../chunks/unitUtils.js";import"../chunks/Ellipsoid.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/vec3.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils4.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils5.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../chunks/Symbol3DAnchorPosition2D.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/utils12.js";import"../chunks/networkEnums.js";import"./Search/SearchResultRenderer.js";import"./Search/SearchViewModel.js";import"../chunks/layerViewUtils.js";import"./Search/LayerSearchSource.js";import"./Search/SearchSource.js";import"../chunks/FullTextSearch.js";import"../chunks/geometryUtils3.js";import"../chunks/scaleUtils.js";import"../chunks/geolocationUtils.js";import"../chunks/project.js";import"../chunks/utils6.js";import"../chunks/utils7.js";import"../rest/support/ProjectParameters.js";import"./support/GoTo.js";import"../chunks/vmEvent.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/dom.js";import"../chunks/index.js";import"../chunks/jsxWidgetSupport.js";import"../rest/networkService.js";import"../rest/support/TravelMode.js";import"../rest/support/RouteParameters.js";import"../chunks/commonProperties3.js";import"../rest/support/DataLayer.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../rest/support/NetworkFeatureSet.js";import"../rest/support/NetworkUrl.js";import"../chunks/ByteSizeUnit.js";import"../chunks/Cyclical.js";import"../chunks/suggestLocations.js";import"../rest/support/AddressCandidate.js";import"./support/DatePickerViewModel.js";import"./support/DateTimeElementViewModel.js";import"../chunks/Popover.js";import"./support/TimePickerViewModel.js";const H="esri-save-layer",F={panel:`${H}`,error:`${H}__error`,errorIcon:`${H}__error-icon`,errorLabel:`${H}__error-label`,layerNameLabel:`${H}__layer-name-label`,portalFolderLabel:`${H}__portal-folder-label`,processLabel:`${H}__process-label`,processLoader:`${H}__process-loader`};let O=class extends y{constructor(e,t){super(e,t),this._folders=null,this._layer=null,this._layerNameInput=null,this._portalFolderCombobox=null,this._userName=null,this.messages=null,this.messagesCommon=null,this.messagesIdentity=null,this.opened=!1,this.state="initialized",this.close=()=>{this.opened=!1,this.state="initialized"}}loadDependencies(){return b({button:()=>import("../chunks/calcite-button.js"),combobox:()=>import("../chunks/calcite-combobox.js"),"combobox-item":()=>import("../chunks/calcite-combobox-item.js"),icon:()=>import("../chunks/calcite-icon.js"),input:()=>import("../chunks/calcite-input.js"),label:()=>import("../chunks/calcite-label.js"),loader:()=>import("../chunks/calcite-loader.js"),panel:()=>import("../chunks/calcite-panel.js")})}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}async open(e){this.state="initialized",this.opened=!0,this._layer=e,this.state="connect-to-portal";const t=j.getDefault();try{await t.signIn()}catch(e){return void(s(e)||"identity-manager:user-aborted"===e.name?this.close():this.state="connect-to-portal-error")}this.state="fetch-portal-information";const{user:o}=t;this._userName=o?.username;try{this._folders=await(o?.fetchFolders())}catch{return void(this.state="fetch-portal-information-error")}this.state="save-layer"}render(){switch(this.state){case"initialized":return this._renderInitialized();case"connect-to-portal":return this._renderProcess(this.messagesIdentity.lblSigning);case"connect-to-portal-error":return this._renderError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderProcess(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayer();case"saving":return this._renderProcess(this.messages.processing.saving);case"saving-error":return this._renderError(this.messages.errors.saving)}}_renderError(e){return k("calcite-panel",{class:F.panel,heading:this.messages.widgetLabel,key:`${H}-error-panel`},k("div",{class:F.error},k("calcite-icon",{class:F.errorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messagesCommon.errorMessage}),k("calcite-label",{class:F.errorLabel},e)),k("calcite-button",{appearance:"outline",onclick:this.close,slot:"footer-actions",width:"half"},this.messagesCommon.close))}_renderInitialized(){return k("calcite-panel",{class:F.panel,heading:this.messages.widgetLabel,key:`${H}-initialize-panel`})}_renderProcess(e){return k("calcite-panel",{class:F.panel,heading:this.messages.widgetLabel,key:`${H}-process-panel`},k("calcite-loader",{class:F.processLoader,label:e}),k("calcite-label",{alignment:"center",class:F.processLabel},e))}_renderSaveLayer(){if(null==this._layer||null==this._folders||null==this._userName)return this._renderInitialized();const{stops:e}=this._layer,t=`${e.at(0).name} - ${e.at(-1).name}`,s=this._folders.map((e=>k("calcite-combobox-item",{key:`${H}-folder-${e.id}`,textLabel:e.title??"",value:e.id})));return s.unshift(k("calcite-combobox-item",{key:`${H}-folder-home`,selected:!0,textLabel:`${this._userName} (${this.messagesCommon.home})`,value:null})),k("calcite-panel",{class:F.panel,heading:this.messages.widgetLabel,key:`${H}-save-panel`},k("calcite-label",{class:F.layerNameLabel},this.messages.laverName,k("calcite-input",{afterCreate:e=>{this._layerNameInput=e},label:this.messages.laverName,value:t})),k("calcite-label",{class:F.portalFolderLabel},this.messages.saveInFolder,k("calcite-combobox",{afterCreate:e=>{this._portalFolderCombobox=e},label:this.messages.saveInFolder,overlayPositioning:"fixed",selectionMode:"single"},s)),k("calcite-button",{onclick:()=>this._saveButtonClick(),slot:"footer-actions",width:"half"},this.messagesCommon.save),k("calcite-button",{appearance:"outline",onclick:()=>{this.close()},slot:"footer-actions",width:"half"},this.messagesCommon.cancel))}_saveButtonClick(){this.state="saving",this._saveLayer().then((()=>{this.close()})).catch((()=>{this.state="saving-error"}))}async _saveLayer(){if(null==this._layer||null==this._folders)return;const e=this._layerNameInput?.value,t=this._portalFolderCombobox?.value,s=this._folders.find((e=>e.id===t));await this._layer.saveAs({title:e},{folder:s})}};function z(e,s){return t(e,{style:"unit",unit:s,unitDisplay:"short"})}function N(e,t,s){if(0===t)return"";let o,r,i=0;const n=w(t,"meters");switch(s){case"metric":n.value<.01?({value:o,unit:r}=M(n,"millimeters")):n.value<1?({value:o,unit:r}=M(n,"centimeters")):n.value<1e3?({value:o,unit:r}=M(n,"meters")):n.value<1e5?(({value:o,unit:r}=M(n,"kilometers")),i=1):({value:o,unit:r}=M(n,"kilometers"));break;case"imperial":n.value<.254?({value:o,unit:r}=M(n,"inches")):n.value<160.9344?({value:o,unit:r}=M(n,"feet")):n.value<160934.4?(({value:o,unit:r}=M(n,"miles")),i=1):({value:o,unit:r}=M(n,"miles"));break;default:({value:o,unit:r}=M(n,s)),i=2}return C(e,o,r,i)}function V(e){if(0===e)return"";if(e<1)return z(Math.floor(60*e),"second");if(e<60)return z(Math.floor(e),"minute");const t=Math.floor(e/60);if(e<1440){const s=Math.floor(e%60);return 0===s?`${z(t,"hour")}`:`${z(t,"hour")} ${z(s,"minute")}`}return z(t,"hour")}e([p()],O.prototype,"label",null),e([p(),f("esri/widgets/support/t9n/SaveLayer")],O.prototype,"messages",void 0),e([p(),f("esri/t9n/common")],O.prototype,"messagesCommon",void 0),e([p(),f("esri/identity/t9n/identity")],O.prototype,"messagesIdentity",void 0),e([p()],O.prototype,"opened",void 0),e([p()],O.prototype,"state",void 0),O=e([h("esri.widgets.Directions.SaveLayer")],O);const W="esri-directions",q={base:W,widgetIcon:T.directions,addStopButton:`${W}__add-stop-button`,arrivalTime:`${W}__arrival-time`,arrivalTimeContainer:`${W}__arrival-time-container`,clearRouteButton:`${W}__clear-route-button`,collapsibleSection:`${W}__maneuver-section--collapsible`,contentTitle:`${W}__content-title`,costsDetails:`${W}__costs-details`,departureTime:`${W}__departure-time`,departureTimeControls:`${W}__departure-time-controls`,departureTimeSelect:`${W}__departure-time-select`,directionCosts:`${W}__costs`,directionsButton:`${W}__button`,directionsSection:`${W}__directions-section`,disclaimer:`${W}__disclaimer`,horizontalSplitter:`${W}__horizontal-splitter`,interactiveStopIcon:`${W}__stop-icon--interactive`,intermediateCost:`${W}__cost--intermediate`,lastStopIconContainer:`${W}__stop-icon-container--last`,layerDetailsLink:`${W}__layer-details-link`,loader:`${W}__loader`,maneuver:`${W}__maneuver`,maneuverActive:`${W}__maneuver--active`,maneuverCosts:`${W}__maneuver-costs`,maneuverCostsContainer:`${W}__maneuver-costs-container`,maneuverIcon:`${W}__maneuver-icon`,maneuverList:`${W}__maneuver-list`,maneuverSection:`${W}__maneuver-section`,maneuverSectionHeader:`${W}__maneuver-section-header`,maneuverSectionHeaderButton:`${W}__maneuver-section-header-toggle-button`,maneuverSectionTitle:`${W}__maneuver-section-title`,maneuverSectionToggle:`${W}__maneuver-section-toggle`,maneuvers:`${W}__maneuvers`,message:`${W}__message`,messageHeading:`${W}__message_heading`,panelContent:`${W}__panel-content`,panelContentError:`${W}__panel-content--error`,panelContentLoading:`${W}__panel-content--loading`,panelContentSignIn:`${W}__panel-content--sign-in`,primaryCosts:`${W}__costs-value`,printButton:`${W}__print-button`,removeStop:`${W}__remove-stop-icon`,removeStopButton:`${W}__remove-stop`,reverseStops:`${W}__reverse-stops`,routeActions:`${W}__route-actions`,saveAsButton:`${W}__save-as-button`,saveAsButtonPopover:`${W}__save-as-button-with-popover`,saveButton:`${W}__save-button`,saveButtons:`${W}__save-buttons`,saveSection:`${W}__save-section`,scroller:`${W}__scroller`,secondaryCosts:`${W}__other-costs-total`,section:`${W}__section`,sectionSplitter:`${W}__section-splitter`,signInButton:`${W}__sign-in-button`,signInContent:`${W}__sign-in-content`,stopHandle:`${W}__stop-handle`,stopHandleIcon:`${W}__stop-handle-icon`,stopIcon:`${W}__stop-icon`,stopIconContainer:`${W}__stop-icon-container`,stopInput:`${W}__stop-input`,stopOptions:`${W}__stop-options`,stopRow:`${W}__stop-row`,stopRowGhost:`${W}__stop-row-ghost`,stops:`${W}__stops`,summary:`${W}__summary`,toolbarButtons:`${W}__toolbar-buttons`,toolbarSection:`${W}__toolbar-section`,travelMode:`${W}__travel-modes`,travelModeSelect:`${W}__travel-modes-select`,validStopRow:`${W}__stop-row--valid`,verticalSplitter:`${W}__vertical-splitter`,warningCard:`${W}__warning-card`,warningHeader:`${W}__warning-header`,warningHeading:`${W}__warning-heading`,warningMessage:`${W}__warning-message`},K=new Map([["arrive","route-to"],["bear-left","bear-left"],["bear-right","bear-right"],["boundary-crossing","blank"],["central-fork","fork-middle"],["clockwise-roundabout","round-about-right"],["counter-clockwise-roundabout","round-about"],["depart","route-from"],["door","walk-through-door"],["down-elevator","elevator-down"],["down-escalator","escalator-down"],["down-stairs","stairs-down"],["elevator","elevator"],["escalator","escalator"],["general-event","information"],["landmark","map-pin"],["left-fork","fork-left"],["left-handed-u-turn","u-turn"],["left-ramp","ramp-left"],["left-turn","left"],["left-turn-and-immediate-left-turn","left-left"],["left-turn-and-immediate-right-turn","left-right"],["off-ferry","disembark"],["on-ferry","embark"],["pedestrian-ramp","take-pedestrian-ramp"],["restriction-violation","exclamation-mark-triangle"],["right-fork","fork-right"],["right-handed-u-turn","u-turn-right"],["right-ramp","exit-highway-right"],["right-ramp","ramp-right"],["right-turn","right"],["right-turn-and-immediate-left-turn","right-left"],["right-turn-and-immediate-right-turn","right-right"],["roundabout","round-about"],["scaled-cost-barrier-event","blank"],["sharp-left","sharp-left"],["sharp-right","sharp-right"],["stairs","stairs"],["straight","straight"],["time-zone-change","clock"],["traffic-event","exclamation-mark-triangle"],["u-turn","u-turn"],["up-elevator","elevator-up"],["up-escalator","escalator-up"],["up-stairs","stairs-up"]]);var G;!function(e){e.NOW="now",e.DEPART_AT="depart-at",e.UNSPECIFIED="unspecified"}(G||(G={}));const Q={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};function J(e){return!!e.composedPath?.().find((e=>e.classList?.contains("esri-search__suggestions-list")))}const Y="search-term",Z="date-time-picker";let X=class extends y{constructor(e,t){super(e,t),this._activeStop=null,this._activeManeuver=null,this._autoStopRemovalDelay=100,this._autoStopRemovalTimeoutId=void 0,this._departureTimeOption=G.NOW,this._datePicker=new $,this._focusedManeuver=null,this._newPlaceholderStop=null,this._pointerDownUpHandle=null,this._pointerPressedSearchSuggestionStop=null,this._renderSavePopoverFunction=null,this._saveAsButtonNode=null,this._saveLayer=new O,this._sections=null,this._sortable=null,this._stopsToSearches=new Map,this._timePicker=new B,this._viewClickHandle=null,this.headingLevel=2,this.iconClass=q.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new S,this.visibleElements={...Q},this._setUpDragAndDropStops=e=>{this._sortable=E.create(e,{draggable:`.${q.validStopRow}`,ghostClass:q.stopRowGhost,handle:`.${q.stopHandle}`,onEnd:this._handleStopInputDragEnd})},this._handleDragHandlePointerDown=()=>this.viewModel.layer?.stops.forEach((e=>this.acquireSearch(e).activeMenu="none")),this._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t||null==t||null==e)return;const{children:o}=s,r=o[t],i=o[e],n=t-e<0;s.insertBefore(r,n?i.nextElementSibling:i);const{stops:a}=this.viewModel.layer;a.reorder(a.at(e),t);for(const e of a)e.sequence=null;this._getDirections()}}initialize(){this.addHandles([a((()=>this.viewModel.layer?.routeInfo),(()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()}),l),c((()=>this.view),((e,t)=>{if(t&&(this._viewClickHandle=null,null!=t&&this.removeHandles(t)),e){const t=this._prepPointerDownUpClick(),s=this._prepViewClick();t.pause(),s.pause();const r=e.surface;this.addHandles([o(r,"mousedown",(()=>this._autoStopRemovalDelay=500)),o(r,"mouseup",(()=>this._autoStopRemovalDelay=100)),t,s],e),this._pointerDownUpHandle=t,this._viewClickHandle=s}}),l),c((()=>null==this.viewModel.serviceDescription),(()=>{try{this.viewModel.load()}catch{}}),l),a((()=>this._saveLayer.state),(()=>{this.scheduleRender()}))]),this.when((()=>{this.destroyed||this.visibleElements.saveAsButton&&(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))}))}loadDependencies(){return b({button:()=>import("../chunks/calcite-button.js"),icon:()=>import("../chunks/calcite-icon.js"),link:()=>import("../chunks/calcite-link.js"),popover:()=>import("../chunks/calcite-popover.js")})}destroy(){this._datePicker.destroy(),this._timePicker.destroy();for(const e of this._stopsToSearches.values())e.destroy();this._sortable?.destroy(),null!=this._renderSavePopoverFunction&&this._projector.detach(this._renderSavePopoverFunction)}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...Q,...e}}acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new g({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this.addHandles([u((()=>s.allSources),"change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.geometry=s.selectedResult?.feature.geometry,e.name=s.selectedResult?.name,this._getDirections()})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e))),s.on("search-clear",(()=>{e.geometry=null,e.name=null,this._activeStop=e,this.viewModel.layer?.removeResult()})),a((()=>s.searchTerm),(t=>{e.name=t}))],s),this._stopsToSearches.set(e,s),s}getDirections(){return this.viewModel.getDirections()}render(){return k("div",{class:this.classes(q.base,L.widget,L.panel,q.scroller)},this._renderPanelContent())}save(){return this.viewModel.save()}saveAs(e,t={}){return this.viewModel.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_renderPanelContent(){const{layer:e,serviceDescription:t,state:s}=this.viewModel,o="initializing"===s,r="error"===s&&!t,i="unauthenticated"===s,n={[q.panelContentLoading]:o,[q.panelContentError]:r||!e,[q.panelContentSignIn]:i},a=o?"presentation":"group",l=e?i?this._renderSignIn():r?this._renderMessage(this._getErrorMessage()):o?this._renderLoader():this._renderReadyContent():this._renderMessage(this.messages.missingLayer);return k("div",{class:this.classes(q.panelContent,n),role:a},l)}_renderReadyContent(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]}_renderSignIn(){return k("div",{class:q.signInContent,key:"sign-in"},k(P,{class:q.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),k(P,{level:R(this.headingLevel)},this.messages.signInRequired),k("button",{bind:this,class:this.classes(L.button,L.buttonSecondary,q.signInButton),onclick:this._handleSignInClick,tabIndex:0,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch((()=>{}))}_renderTravelModeOptions(){if(!this.visibleElements.traveMode)return null;const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(0===t.length)return null;const s=null!=e?e.name:this.messages.travelMode;return k("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(q.travelMode,this._saveLayer.opened&&L.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},k("select",{"aria-label":s,bind:this,class:this.classes(q.travelModeSelect,L.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},t.map(((t,s)=>k("option",{"data-mode":t,key:`esri-directions__travel-mode-${s}`,selected:e===t,value:`${s}`},t.name)))))}_handleTravelModeChange(e){const t=e.currentTarget;var s;this.viewModel.selectedTravelMode=(s=t.item(t.selectedIndex),s?.["data-mode"]),this._getDirections()}_renderStopsContainer(){return this.visibleElements.stops?k("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(q.section,this._saveLayer.opened&&L.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null}_renderDepartureTimeControls(){if(!this.visibleElements.departureTime)return null;const{messages:{departAt:e,departureTime:t,leaveNow:s,timeUnspecified:o}}=this;return k("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(q.departureTime,this._saveLayer.opened&&L.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},k("select",{"aria-label":t,bind:this,class:this.classes(q.departureTimeSelect,L.select),onchange:this._handleDepartureOptionChange,title:t},k("option",{selected:this._departureTimeOption===G.NOW,value:G.NOW},s),k("option",{selected:this._departureTimeOption===G.DEPART_AT,value:G.DEPART_AT},e),k("option",{selected:this._departureTimeOption===G.UNSPECIFIED,value:G.UNSPECIFIED},o)),this._departureTimeOption===G.DEPART_AT?this._renderTimeControls():null)}_renderStops(){const{stops:e}=this.viewModel.layer;let s=0;for(const t of this._stopsToSearches.keys())e.includes(t)||this._disposeSearch(t);for(const t of e){const e=this.acquireSearch(t);"none"!==e.activeMenu&&(s+=1),null!=t.name&&(e.searchTerm=t.name)}const o=e.toArray().map(((o,r)=>{const i=e.length,n=r>1&&null==o.geometry,a={[T.radioUnchecked]:r>=0&&r<i-1,[T.radioChecked]:r===i-1},l={[q.lastStopIconContainer]:r===i-1},c={[q.validStopRow]:!n},u=e.at(r+1),p=r===i-1,d=r===i-2,h=2===i&&0===r||i>2&&!p&&!d||i>2&&d&&null!=u?.geometry||i>2&&p&&null==o.geometry,m=i<3,v=this.acquireSearch(o),{messages:_}=this,{removeStop:g,reverseStops:y,unlocated:b}=_,S=null!=o.geometry&&null!=o.name?o.name:b,j=t(r+1),f=`${_.stopLabel} ${j} (${S})`,w=`${this.id}__stop--${r}`,M=!!v.searchTerm&&!!v.selectedResult&&null!=o.geometry&&v.selectedResult.name===o.name,C={zIndex:"none"!==v.activeMenu?""+s--:""};return k("li",{afterCreate:this._handleStopFieldCreation,"aria-label":f,bind:this,class:this.classes(q.stopRow,c),"data-stop-index":r,id:w,key:r,styles:C},k("div",{class:q.stopHandle},k("span",{"aria-hidden":"true",class:this.classes(q.stopIcon,T.handleVertical,q.stopHandleIcon,q.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),k("div",{"aria-labelledby":w,bind:this,class:this.classes(q.stopIconContainer,l),"data-stop-index":r,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},k("span",{class:this.classes(q.stopIcon,a),tabIndex:M?0:void 0}))),k("div",{class:q.stopInput},v.render()),k("div",{class:q.stopOptions,role:"group"},k("div",{"aria-label":g,bind:this,class:q.removeStopButton,"data-stop-index":r,hidden:m,onclick:this._handleRemoveStop,onkeydown:this._handleRemoveStop,role:"button",tabIndex:0,title:g},k("span",{"aria-hidden":"true",class:this.classes(q.stopIcon,q.removeStop,T.trash,q.interactiveStopIcon)}),k("span",{class:T.fontFallbackText},"removeStopTitle")),k("div",{"aria-label":y,bind:this,class:q.reverseStops,hidden:h,onclick:this._handleReverseStops,onkeydown:this._handleReverseStops,role:"button",tabIndex:0,title:y},k("span",{"aria-hidden":"true",class:this.classes(q.stopIcon,T.upDownArrows,q.interactiveStopIcon)}),k("span",{class:T.fontFallbackText},"removeStopTitle"))))})),r=this._renderAddStop();return k("div",null,k("ol",{afterCreate:this._setUpDragAndDropStops,class:q.stops,role:"group"},o),r)}_renderAddStop(){const e=this.viewModel.layer?.stops;if(!e)return null;const t=e.filter((({geometry:e})=>null!=e)),s=e.at(-1);return t.length>1&&t.length<this.maxStops&&null!=s?.geometry?k("div",{class:q.toolbarSection},k("div",{class:q.toolbarButtons},k("calcite-button",{appearance:"outline",class:q.addStopButton,iconStart:"plus",key:q.addStopButton,kind:"neutral",label:this.messages.addStop,onclick:()=>{this._addNewPlaceholder()},round:!0,scale:"s",width:"full"},this.messages.addStop))):null}_handleStopIconClick(e){const t=te(e.currentTarget),s=null!=t?this.viewModel.layer?.stops.at(t):void 0;s?.geometry&&this._centerAtStop(s)}_handleClearRouteClick(){this.viewModel.reset()}_centerAtStop(e){this.viewModel.centerAt(e)}_handleStopFieldCreation(e){const t=this._newPlaceholderStop;if(!t)return;const s=te(e),o=null!=s?this.viewModel.layer?.stops.at(s):void 0;if(t===o){const e=this.acquireSearch(o);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null}_handleStopInputBlur(e,t){if(this._saveLayer.opened)return;if(this.removeHandles(Y),e.selectedResult&&null!=t.geometry&&null!=e.selectedResult?.feature.geometry&&t.geometry===e.selectedResult?.feature.geometry)return void this._pointerDownUpHandle?.pause();const s=null==t.geometry&&null==e.selectedResult?.feature.geometry,o=null!=t.geometry&&null!=e.selectedResult?.feature.geometry&&t.geometry!==e.selectedResult?.feature.geometry;if((s||o)&&"none"===e.activeMenu&&e.searchTerm)return e.search(),void this._pointerDownUpHandle?.pause();e.searchTerm||(this._viewClickHandle?.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{this.destroyed||(this._viewClickHandle?.pause(),"searching"!==e.viewModel.state?this._pointerPressedSearchSuggestionStop||(null!=t.geometry&&(t.geometry=null,this._getDirections()),this.scheduleRender()):this._pointerDownUpHandle?.pause())}),this._autoStopRemovalDelay))}_handleStopInputFocus(e,t){this._pointerDownUpHandle?.resume();const{view:s}=this;if(this.hasHandles(Y)||!s)return;const o=s.cursor;this.addHandles([i((()=>{s.cursor=o})),a((()=>e.searchTerm),(t=>{e.destroyed||(s.cursor=t.length?o:"copy")}),l)],Y),this._activeStop=t}_prepViewClick(){const{view:e}=this.viewModel;n(e),n(e.surface);const t=r(e,"click",this._handleViewClick.bind(this)),s=r(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),s.pause()}));return{remove(){s.remove(),t.remove()},pause(){s.pause(),t.pause()},resume(){s.resume(),t.resume()}}}_prepPointerDownUpClick(){const e=r(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=J(e)?this._activeStop:null})),t=r(document,"pointerup",(e=>{this._pointerDownUpHandle?.pause();const t=J(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?s:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}}_handleViewClick(e){e.stopPropagation();const t=this._activeStop,s=t?this._stopsToSearches.get(t):null;t&&s&&!s.searchTerm&&(s.search(e.mapPoint).then((e=>{const o=e?.results[0].results;if(!o)return;const{feature:r,name:i}=o[0];t.geometry=r.geometry,t.name=i,s.searchTerm=i})),this.scheduleRender()),this._viewClickHandle?.pause(),clearTimeout(this._autoStopRemovalTimeoutId)}_addNewPlaceholder(){if(this._pointerDownUpHandle?.pause(),this._newPlaceholderStop)return;const e=new v({symbol:new _});this.viewModel.layer?.stops.add(e),this._newPlaceholderStop=e}_handleReverseStops(){this._reverseStops()}_reverseStops(){const e=this.viewModel.layer?.stops??[];e.reverse();for(const t of e)t.sequence=null;this._getDirections()}_handleRemoveStop(e){const{layer:t}=this.viewModel;if(!t)return;const s=te(e.currentTarget);if(null==s)return;const{stops:o,routeInfo:r}=t,i=o.at(s);this._removeStop(i),null==i.geometry&&null!=r||this._getDirections()}_removeStop(e){const{stops:t}=this.viewModel.layer;!e||t.length<=2||(this._disposeSearch(e),t.remove(e))}_handleDepartureOptionChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);s.value===G.NOW?(this._departureTimeOption=G.NOW,this.viewModel.departureTime=G.NOW,this.removeHandles(Z),this._getDirections()):s.value===G.DEPART_AT?(this._departureTimeOption=G.DEPART_AT,this.addHandles(a((()=>[this._datePicker.value,this._timePicker.value]),(()=>{this._updateDepartureTime(),this._getDirections()}),l),Z)):(this._departureTimeOption=G.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())}_updateDepartureTime(){const e=this._datePicker.value,t=this._timePicker.value;e&&t&&(this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes()))}_renderTimeControls(){return k("div",{class:q.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())}_renderSectionSplitter(){return k("div",{class:q.sectionSplitter})}_renderSaveContainer(){const{saveButton:e,saveAsButton:t,printButton:s,layerDetails:o}=this.visibleElements;return e||t||s||o?k("div",{class:q.saveSection,key:q.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null}_renderSaveButtons(){const{saveButton:e,saveAsButton:t,printButton:s}=this.visibleElements;return e||t||s?k("div",{class:q.saveButtons,key:q.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null}_renderSaveButton(){if(!this.visibleElements.saveButton)return null;const{portalItem:e,routeInfo:t}=this.viewModel.layer,s=e?.itemControl;return k("calcite-button",{appearance:"outline",class:q.saveButton,disabled:!(null!=t&&("admin"===s||"update"===s)),iconStart:"save",key:q.saveButton,label:this.messagesCommon.save,onclick:()=>{this._handleSaveButtonClick()},width:"full"},this.messagesCommon.save)}_renderSaveAsButton(){if(!this.visibleElements.saveAsButton)return null;const e=null==this.viewModel.layer.routeInfo;return k("div",{class:q.saveAsButtonPopover,key:q.saveAsButtonPopover},k("calcite-button",{afterCreate:e=>{this._saveAsButtonNode=e},appearance:"outline",class:q.saveAsButton,disabled:e,iconStart:"duplicate",key:q.saveAsButton,label:this.messagesCommon.saveAs,onclick:()=>this._handleSaveAsButtonClick(),width:"full"},this.messagesCommon.saveAs))}_renderSavePopover(){return k("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,overlayPositioning:"fixed",referenceElement:this._saveAsButtonNode},this._saveLayer.render())}_handleSaveAsButtonClick(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)}_renderPrintButton(){return this.visibleElements.printButton?k("calcite-button",{appearance:"outline",class:q.printButton,iconStart:"print",key:q.printButton,label:this.messagesCommon.print}):null}_renderRouteLayerDetailsLink(){if(!this.visibleElements.layerDetails)return null;const{portalItem:e}=this.viewModel.layer;if(!e)return null;const{id:t,portal:{url:s}}=e;return k("calcite-link",{class:q.layerDetailsLink,href:`${s}/home/item.html?id=${t}`,key:q.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)}_handleSaveButtonClick(){this.viewModel.layer.save()}_renderDirectionsContainer(){return k("div",{class:this.classes(q.directionsSection,q.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return k("div",{class:q.loader,key:"loader"})}_renderWarningCard(){return k("div",{class:q.warningCard,role:"alert"},k("div",{class:q.warningHeader},k("span",{"aria-hidden":"true",class:T.noticeTriangle}),k(P,{class:q.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),k("div",{class:q.warningMessage},this._getErrorMessage()))}_renderDirectionsContainerContent(){const{layer:e,state:t}=this.viewModel,s="routing"===t;return"error"===t?this._renderWarningCard():s?this._renderLoader():null!=e.directionLines?k("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(q.summary,this._saveLayer.opened&&L.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):k("div",{class:L.empty,key:"esri-directions__placeholder"},this._renderPlaceholder(),k(P,{class:q.message,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return k("svg",{class:L.emptyIllustration,viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},k("path",{d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z",fill:"currentcolor"}))}_renderMessage(e){return k(P,{class:q.messageHeading,level:this.headingLevel},e)}_renderRouteActions(){return k("div",{class:q.routeActions},k("button",{"aria-label":this.messages.clearRoute,bind:this,class:this.classes(q.clearRouteButton,L.button,L.buttonTertiary),onclick:this._handleClearRouteClick,tabIndex:0,type:"button"},this.messages.clearRoute))}_getSections(){const{layer:e}=this.viewModel;if(!e)return null;const{directionPoints:t,directionLines:s,stops:o}=e;if(null==t||null==s)return null;const r=[];let i=null;for(const e of t){const{objectId:t,stopId:n}=e;if(null!=n){const e=o.find((({objectId:e})=>e===n)),t=0===r.length;null!=i&&i.stop===e||(i={stop:e,directions:[],open:t},r.push(i));continue}if(null==i)continue;const a=s.find((({directionPointId:e})=>e===t));null!=a&&i.directions.push({directionPoint:e,directionLine:a})}return r}_renderManeuverSections(){return null==this._sections?null:k("div",{class:q.maneuvers,role:"group"},this._sections.map(((e,t)=>{const{open:s}=e;let o;e.directions.length>0&&s&&(o=k("ol",{class:q.maneuverList},e.directions.map((e=>this._renderManeuver(e)))));const r=this._sections.length>2,i=t===this._sections.length-1,n={[q.collapsibleSection]:r},a={[T.down]:!s,[T.up]:s};let l;if(r&&!i){const t=s?this.messagesCommon.close:this.messagesCommon.open;l=k("header",{class:this.classes(q.maneuverSectionHeader,q.maneuverSectionToggle),key:q.maneuverSectionHeader},k("div",{"aria-expanded":s.toString(),"aria-label":t,bind:this,class:q.maneuverSectionHeaderButton,"data-maneuver-section":e,onclick:this._handleSectionToggle,onkeydown:this._handleSectionToggle,role:"button",tabIndex:0,title:t},k(P,{class:q.maneuverSectionTitle,level:this.headingLevel},e.stop.name),k("span",{"aria-hidden":"true",class:this.classes(a)})))}else l=k("header",{class:q.maneuverSectionHeader,key:q.maneuverSectionHeader},k(P,{class:q.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return k("section",{class:this.classes(q.maneuverSection,n),key:t},l,o)})))}_handleSectionToggle(e){const t=(s=e.currentTarget,s?.["data-maneuver-section"]);var s;t&&(t.open=!t.open)}_renderCosts(){const e=this._getCostSummary(),{directionPoints:t}=this.viewModel.layer;if(null==t||null==e)return null;const{distance:s,duration:o}=e,{primaryCosts:r,secondaryCosts:i,zoomToRoute:n}=this.messages,a=this._renderEta();return k("div",{"aria-label":n,bind:this,class:q.directionCosts,onclick:this._handleSummaryInteraction,onkeydown:this._handleSummaryInteraction,role:"button",tabIndex:0,title:n},k("div",{class:q.costsDetails,role:"group"},k("div",{class:q.primaryCosts,title:r},o),k("div",{class:q.verticalSplitter}),k("div",{class:q.secondaryCosts,title:i},s)),a)}_renderEta(){const{directionPoints:e}=this.viewModel.layer,{eta:s}=this.messages;if(null==e)return null;const o=e.at(-1).arrivalTime,r=A("short-time");return o&&this._departureTimeOption!==G.UNSPECIFIED?k("div",{class:q.arrivalTimeContainer,title:s},k("span",{class:q.arrivalTime},U(o,r))," ",function(e){const s=e.getTimezoneOffset(),o=s>0?"-":"+",r=Math.abs(Math.floor(s/60)),i=Math.abs(Math.floor(s)%60),n={minimumIntegerDigits:2};return`GMT${o}${t(r,n)}${t(i,n)}`}(o)):null}_handleSummaryInteraction(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()}_getErrorMessage(){switch(this.viewModel.lastError?.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))}_applyLocatorSourceOverrides({allSources:e}){for(const t of e)"url"in t&&t.url&&(t.locationType??="street",D(t.url)&&this.apiKey&&null==t.apiKey&&(t.apiKey=this.apiKey,t.url=I))}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}_renderManeuver(e){const{directionPoint:t,directionLine:s}=e,{distance:o,duration:r}=s,{messages:i,messagesUnits:n,unit:a}=this,l=N(n,o??0,a),c=V(r??0),u=l&&c?`${l}&nbsp;&middot;&nbsp;${c}`:`${l}${c}`,p=this._getFormattedManeuverText(t),{objectId:d,directionPointType:h}=t,m=function(e){return null!=e&&K.has(e)?K.get(e):null}(h),v=`esri-directions__maneuver-${d}`,_=`esri-directions__intermediate-costs-${d}`,g={[q.maneuverActive]:this._activeManeuver===s};return k("li",{"aria-labelledby":`${v} ${_}`,bind:this,class:this.classes(q.maneuver,g),"data-maneuver":s,key:s,onblur:this._handleManeuverBlur,onclick:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onkeydown:this._handleManeuverClick,onmouseout:this._handleManeuverMouseOut,onmouseover:this._handleManeuverMouseOver,tabIndex:0},m?k("calcite-icon",{alt:"",class:q.maneuverIcon,icon:m}):null,k("div",{class:q.maneuverCostsContainer},k("span",{id:v,innerHTML:p??""}),k("div",{class:q.maneuverCosts},k("div",{class:q.horizontalSplitter}),k("div",{"aria-hidden":"true",class:q.intermediateCost,id:_,innerHTML:u,title:i.intermediateCosts}))))}_handleManeuverClick(e){const t=se(e.currentTarget);if(!t)return;if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:s}=t;this.viewModel.centerAt(s),this.viewModel.highlight(t)}_handleManeuverMouseOver(e){if(this._activeManeuver||this._focusedManeuver)return;const t=se(e.currentTarget);t&&this.viewModel.highlight(t)}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())}_handleManeuverFocus(e){if(this._activeManeuver)return;const t=se(e.currentTarget);t&&(this._focusedManeuver=t,this.viewModel.highlight(t))}_getFormattedManeuverText(e){const{displayText:t,name:s,intersectingName:o}=e;if(null==t)return"";let r=t;return null!=s&&r.includes(s)&&(r=r.replace(s,`<strong>${s}</strong>`)),null!=o&&r.includes(o)&&(r=r.replace(o,`<strong>${o}</strong>`)),r}_getCostSummary(){const{messagesUnits:e,unit:t,viewModel:s}=this,{routeInfo:o}=s.layer;if(null==o)return null;const r=o.totalDistance??0,i=o.totalDuration??0;return{distance:N(e,r,t),duration:V(i)}}async _getDirections(){const e=this.viewModel.layer?.stops.filter((({geometry:e})=>null!=e));if(e&&!(e.length<2))try{await this.viewModel.getDirections()}catch{}}};e([p()],X.prototype,"apiKey",null),e([p(m)],X.prototype,"defaultUnit",void 0),e([p()],X.prototype,"goToOverride",null),e([p()],X.prototype,"headingLevel",void 0),e([p()],X.prototype,"iconClass",void 0),e([p()],X.prototype,"icon",void 0),e([p()],X.prototype,"label",null),e([p({readOnly:!0})],X.prototype,"lastRoute",null),e([p()],X.prototype,"layer",null),e([p()],X.prototype,"maxStops",null),e([p(),f("esri/widgets/Directions/t9n/Directions")],X.prototype,"messages",void 0),e([p(),f("esri/t9n/common")],X.prototype,"messagesCommon",void 0),e([p(),f("esri/core/t9n/Units")],X.prototype,"messagesUnits",void 0),e([p()],X.prototype,"searchProperties",void 0),e([p()],X.prototype,"unit",null),e([p()],X.prototype,"view",null),e([p({type:S})],X.prototype,"viewModel",void 0),e([p()],X.prototype,"visibleElements",void 0),e([d("visibleElements")],X.prototype,"castVisibleElements",null),e([x()],X.prototype,"_handleStopIconClick",null),e([x()],X.prototype,"_handleClearRouteClick",null),e([x()],X.prototype,"_handleReverseStops",null),e([x()],X.prototype,"_handleRemoveStop",null),e([x()],X.prototype,"_handleSectionToggle",null),e([x()],X.prototype,"_handleSummaryInteraction",null),e([x()],X.prototype,"_handleManeuverClick",null),X=e([h("esri.widgets.Directions")],X);const ee=X;function te(e){return e?.["data-stop-index"]}function se(e){return e?.["data-maneuver"]}export{ee as default};
