/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import n from"./RasterFunction.js";import{g as t,a as r}from"../../chunks/colorUtils.js";import{colormapName as e}from"./rasterFunctionConstants.js";import{d as o}from"../../chunks/colorRampUtils.js";import{s as u}from"../../chunks/focalStatUtils.js";import"../../chunks/tslib.es6.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../chunks/typedArrayUtil.js";import"../../core/Handles.js";import"../../chunks/Logger.js";import"../../config.js";import"../../core/lang.js";import"../../chunks/maybe.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../core/Error.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../chunks/time.js";import"../../chunks/enumeration.js";import"../../chunks/jsonMap.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../../Color.js";import"../../chunks/mathUtils.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/common.js";import"../../chunks/colorUtils2.js";import"../../chunks/vec4.js";import"../../chunks/vec4f64.js";import"./PixelBlock.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/pixelRangeUtils.js";function i(t,r,e){return Object.keys(r).forEach((n=>{null==r[n]&&delete r[n]})),e||(e="unknown"),new n({functionName:t,functionArguments:r,outputPixelType:e})}const s={"user-defined":-1,"line-detection-horizontal":0,"line-detection-vertical":1,"line-detection-left-diagonal":2,"line-detection-right-diagonal":3,"gradient-north":4,"gradient-west":5,"gradient-east":6,"gradient-south":7,"gradient-north-east":8,"gradient-north-west":9,"smooth-arithmetic-mean":10,smoothing3x3:11,smoothing5x5:12,sharpening3x3:13,sharpening5x5:14,laplacian3x3:15,laplacian5x5:16,"sobel-horizontal":17,"sobel-vertical":18,sharpen:19,sharpen2:20,"point-spread":21,none:255};function a(n){const{raster:t,outputPixelType:r}=n;if("convolutionType"in n&&"user-defined"!==n.convolutionType)return i("Convolution",{type:s[n.convolutionType]??255,raster:t},r);const{rows:e,cols:o,kernel:u}=n;return i("Convolution",{type:-1,rows:e,cols:o,kernel:u,raster:t},r)}function c(n){const{contrastOffset:t,brightnessOffset:r,raster:e,outputPixelType:o}=n;return i("ContrastBrightness",{contrastOffset:t,brightnessOffset:r,raster:e},o)}function d(n,t){const{raster:r,dynamicRangeAdjustment:e,gamma:o,useGamma:u,outputMin:i=0,outputMax:s=255}=t;return{raster:r,stretchType:n,min:i,max:s,useGamma:!!u,gamma:o,dra:!!e}}function p(n){const t=d(5,n);return t.statistics=n.statistics?.map((n=>[n.min,n.max,n.avg??0,n.stddev??-1])),i("Stretch",t,n.outputPixelType)}function l(n){const t=d(3,n);return t.statistics=n.statistics?.map((n=>[n.min,n.max,n.avg??0,n.stddev??-1])),t.numberOfStandardDeviations=n.numberOfStandardDeviations??2,i("Stretch",t,n.outputPixelType)}function f(n){const t=d(6,n);return t.minPercent=n.minPercent??.25,t.maxPercent=n.maxPercent??.25,i("Stretch",t,n.outputPixelType)}function m(n){return i("Stretch",d(0,n),n.outputPixelType)}function k(n){return i("Stretch",d(4,n),n.outputPixelType)}function w(n,t,r,e=[]){const{raster:o,outputPixelType:u}=n;return i("BandArithmetic",{raster:o,method:t,bandIndexes:r.map((n=>n+1)).concat(e).join(" ")},u)}function I(n){const{nirBandId:t,redBandId:r,scientificOutput:e=!0,raster:o,outputPixelType:u}=n;return i("NDVI",{raster:o,visibleBandID:r,infraredBandID:t,scientificOutput:e},u)}function h(n){const{nirBandId:t,redBandId:r,factor:e=.33}=n;return w(n,2,[t,r],[e])}function B(n){const{nirBandId:t,redBandId:r,slope:e=.33,intercept:o=.5,factor:u=1.5}=n;return w(n,3,[t,r],[e,o,u])}function y(n){const{nirBandId:t,redBandId:r}=n;return w(n,4,[t,r])}function g(n){const{nirBandId:t,redBandId:r}=n;return w(n,5,[t,r])}function j(n){const{nirBandId:t,redBandId:r,slope:e=.3,gradient:o=.5}=n;return w(n,6,[t,r],[e,o])}function x(n){return w(n,7,n.bandIds)}function T(n){return w(n,8,n.bandIds)}function b(n){const{redBandId:t,greenBandId:r,blueBandId:e}=n;return w(n,9,[t,r,e])}function P(n){const{nirBandId:t,greenBandId:r}=n;return w(n,10,[t,r])}function v(n){const{nirBandId:t,redBandId:r}=n;return w(n,11,[t,r])}function S(n){const{nirBandId:t,reBandId:r}=n;return w(n,12,[t,r])}function O(n){const{nirBandId:t,reBandId:r}=n;return w(n,13,[t,r])}function R(n){const{nirBandId:t,redBandId:r,greenBandId:e}=n;return w(n,14,[t,r,e])}function N(n){const{nirBandId:t,reBandId:r,greenBandId:e}=n;return w(n,15,[t,r,e])}function A(n){const{nirBandId:t,reBandId:r}=n;return w(n,16,[t,r])}function D(n){const{nirBandId:t,greenBandId:r}=n;return w(n,17,[t,r])}function C(n){const{nirBandId:t,greenBandId:r}=n;return w(n,18,[t,r])}function M(n){const{nirBandId:t,redBandId:r,blueBandId:e}=n;return w(n,19,[t,r,e])}function U(n){const{redBandId:t,blueBandId:r}=n;return w(n,20,[t,r])}function F(n){const{swirBandId:t,nirBandId:r}=n;return w(n,21,[t,r])}function z(n){const{swir1BandId:t,swir2BandId:r}=n;return w(n,22,[t,r])}function L(n){const{greenBandId:t,nirBandId:r,swirBandId:e,alpha:o=.5}=n;return w(n,23,[t,r,e],[o])}function E(n){const{redBandId:t,nirBandId:r}=n;return w(n,24,[t,r])}function J(n){const{nirBandId:t,swirBandId:r}=n;return w(n,25,[t,r])}function V(n){const{swirBandId:t,nirBandId:r}=n;return w(n,26,[t,r])}function $(n){const{nirBandId:t,swirBandId:r}=n;return w(n,27,[t,r])}function W(n){const{greenBandId:t,swirBandId:r}=n;return w(n,28,[t,r])}function G(n){const{greenBandId:t,swirBandId:r}=n;return w(n,29,[t,r])}function H(n){const{raster:t,bandIndexes:r,outputPixelType:e}=n;return i("BandArithmetic",{raster:t,method:0,bandIndexes:r},e)}function Z(n){return"colormap"in n?function(n){const e=n.colormap.map((n=>{if("value"in n){const e="string"==typeof n.color?t(n.color)??r(n.color):n.color;(n=[n.value,...e])[4]&&n[4]<=1&&(n[4]=Math.round(255*n[4]))}return n})),{raster:o,outputPixelType:u}=n;return i("Colormap",{colormap:e,raster:o},u)}(n):"colorRamp"in n?function(n){const{raster:t,colorRamp:r,outputPixelType:e}=n;return i("Colormap",{colorRamp:"toJSON"in r?r.toJSON():r,raster:t},e)}(n):function(n){const{colorRampName:t}=n,r=Object.values(e).find((n=>n.toLowerCase()===t?.toLowerCase())),u=o.toJSON(t),{raster:s,outputPixelType:a="unknown"}=n;return i("Colormap",r?{colormapName:r,raster:s}:{colorRampName:u,raster:s},a)}(n)}function q(n){const{raster:t,histograms:r,outputPixelType:e}=n,o=n.statistics?.map((n=>({min:n.min,max:n.max,mean:n.avg,standardDeviation:n.stddev})));return i("StatisticsHistograms",{raster:t,statistics:o,histograms:r},e)}function K(n){const{raster:t,attributeTable:r,outputPixelType:e="unknown"}=n;return i("Table",{raster:t,attributeTableAsRecordSet:"toJSON"in r?r.toJSON():r},e)}function Q(n){const{raster:t,outputPixelType:r="unknown"}=n,e={raster:t,missingBandAction:"fail"===n.missingBandAction?1:0};return"bandIds"in n?e.bandIds=n.bandIds:"bandNames"in n?e.bandNames=n.bandNames:"bandWavelengths"in n&&(e.bandWavelengths=n.bandWavelengths),i("ExtractBand",e,r)}function X(n){const{rasters:t,outputPixelType:r}=n;return i("CompositeBand",{rasters:t},r)}function Y(n){const{allowUnmatched:t,raster:r,rangeMaps:e,outputPixelType:o}=n,u=e?.filter((({output:n})=>null!=n)),s=u?.flatMap((({range:n})=>n)),a=u?.map((({output:n})=>n)),c=e?.filter((n=>null==n.output))?.flatMap((({range:n})=>n));return i("Remap",{allowUnmatched:t,raster:r,inputRanges:s,outputValues:a,noDataRanges:c},o)}function _(n){const{raster:t,outputPixelType:r="unknown"}=n,e=n.includedRanges?.flatMap((n=>n)),o=n.noDataValues?.map((n=>n.join(" ")));return i("Mask",{raster:t,includedRanges:e,noDataInterpretation:"match-all"===n.noDataInterpretation?1:0,noDataValues:o},r)}function nn(n,t,r="unknown"){let e;return"object"!=typeof t||!("raster"in t)&&("rasterFunction"in t||"functionName"in t)?e=[t]:(e=[t.raster??"$$"],r=t.outputPixelType??"unknown"),i("Local",{operation:n,rasters:e},r)}function tn(n,t,r,e="unknown"){let o;return"object"==typeof t&&"raster"in t?(o=[t.raster,t.raster2],e=t.outputPixelType??"unknown"):o=[t,r],i("Local",{operation:n,rasters:o},e)}function rn(n,t,r="unknown"){return tn(1,n,t,r)}function en(n,t,r="unknown"){return tn(2,n,t,r)}function on(n,t,r="unknown"){return tn(3,n,t,r)}function un(n,t="unknown"){return nn(4,n,t)}function sn(n,t,r="unknown"){return tn(5,n,t,r)}function an(n,t="unknown"){return nn(6,n,t)}function cn(n,t="unknown"){return nn(7,n,t)}function dn(n,t="unknown"){return nn(8,n,t)}function pn(n,t="unknown"){return nn(9,n,t)}function ln(n,t="unknown"){return nn(10,n,t)}function fn(n,t,r="unknown"){return tn(11,n,t,r)}function mn(n,t,r="unknown"){return tn(12,n,t,r)}function kn(n,t="unknown"){return nn(13,n,t)}function wn(n,t,r="unknown"){return tn(14,n,t,r)}function In(n,t,r="unknown"){return tn(15,n,t,r)}function hn(n,t,r="unknown"){return tn(16,n,t,r)}function Bn(n,t,r="unknown"){return tn(17,n,t,r)}function yn(n,t="unknown"){return nn(18,n,t)}function gn(n,t,r="unknown"){return tn(19,n,t,r)}function jn(n,t,r="unknown"){return tn(20,n,t,r)}function xn(n,t="unknown"){return nn(21,n,t)}function Tn(n,t="unknown"){return nn(22,n,t)}function bn(n,t,r="unknown"){return tn(23,n,t,r)}function Pn(n,t,r="unknown"){return tn(24,n,t,r)}function vn(n,t="unknown"){return nn(25,n,t)}function Sn(n,t="unknown"){return nn(26,n,t)}function On(n,t="unknown"){return nn(27,n,t)}function Rn(n,t,r="unknown"){return tn(28,n,t,r)}function Nn(n,t,r="unknown"){return tn(29,n,t,r)}function An(n,t="unknown"){return nn(30,n,t)}function Dn(n,t="unknown"){return nn(31,n,t)}function Cn(n,t="unknown"){return nn(32,n,t)}function Mn(n,t,r="unknown"){return tn(33,n,t,r)}function Un(n,t,r="unknown"){return tn(34,n,t,r)}function Fn(n,t="unknown"){return nn(35,n,t)}function zn(n,t="unknown"){return nn(36,n,t)}function Ln(n,t="unknown"){return nn(37,n,t)}function En(n,t,r="unknown"){return tn(44,n,t,r)}function Jn(n,t="unknown"){return nn(45,n,t)}function Vn(n,t,r="unknown"){return tn(46,n,t,r)}function $n(n,t="unknown"){return nn(48,n,t)}function Wn(n,t="unknown"){return nn(49,n,t)}function Gn(n,t="unknown"){return nn(51,n,t)}function Hn(n,t="unknown"){return nn(52,n,t)}function Zn(n,t="unknown"){return nn(53,n,t)}function qn(n,t="unknown"){return nn(56,n,t)}function Kn(n,t="unknown"){return nn(57,n,t)}function Qn(n,t="unknown"){return nn(59,n,t)}function Xn(n,t="unknown"){return nn(60,n,t)}function Yn(n,t,r="unknown"){return tn(61,n,t,r)}function _n(n,t,r="unknown"){let e;return"object"==typeof n&&"raster"in n?(e=[n.raster,n.falseRaster],r=n.outputPixelType??"unknown"):e=[n,t],i("Local",{operation:50,rasters:e},r)}function nt(n,t,r,e){let o;return"object"==typeof n&&"raster"in n&&"trueRaster"in n?(o=[n.raster,n.trueRaster,n.falseRaster],e=n.outputPixelType??"unknown"):o=[n,t,r],i("Local",{operation:78,rasters:o},e)}const tt={majority:38,max:39,mean:40,median:41,min:42,minority:43,range:47,stddev:54,sum:55,variety:58};function rt(n){const{rasters:t,statType:r,processAsMultiband:e=!0,outputPixelType:o}=n;return i("Local",{operation:tt[r],processAsMultiband:e,rasters:t},o)}function et(n){const{raster:t,outputPixelType:r}=n;return i("Aspect",{raster:t},r)}function ot(n){const{raster:t,zFactor:r,removeEdgeEffect:e,outputPixelType:o="unknown"}=n,u="degree"===n.slopeType?1:"percent-rise"===n.slopeType?2:3,s={raster:t,slopeType:u,zFactor:r,removeEdgeEffect:e};return 3===u&&(s.psPower=n.pixelSizePower,s.psZFactor=n.pixelSizeZFactor),i("Slope",s,o)}function ut(n){const{raster:t,zFactor:r,outputPixelType:e="unknown"}=n;return i("Curvature",{raster:t,curvatureType:"standard"===n.curvatureType?0:"platform"===n.curvatureType?1:2,zFactor:r},e)}function it(n){const{rows:t,cols:r,fillNoDataOnly:e=!1,raster:o,outputPixelType:s}=n;return i("Statistics",{rows:t,cols:r,fillNoDataOnly:e,statisticsType:u.toJSON(n.statisticsType),raster:o},s)}const st="$$";export{ln as abs,an as acos,Qn as acosh,cn as asin,Xn as asinh,et as aspect,dn as atan,Yn as atan2,pn as atanh,E as bandArithmeticBAI,D as bandArithmeticCIg,A as bandArithmeticCIre,z as bandArithmeticClayMinerals,H as bandArithmeticCustom,M as bandArithmeticEVI,F as bandArithmeticFerrousMinerals,g as bandArithmeticGEMI,P as bandArithmeticGNDVI,x as bandArithmeticGVITM,U as bandArithmeticIronOxide,G as bandArithmeticMNDWI,y as bandArithmeticMSAVI,R as bandArithmeticMTVI2,J as bandArithmeticNBR,V as bandArithmeticNDBI,$ as bandArithmeticNDMI,W as bandArithmeticNDSI,I as bandArithmeticNDVI,S as bandArithmeticNDVIre,C as bandArithmeticNDWI,j as bandArithmeticPVI,N as bandArithmeticRTVICore,h as bandArithmeticSAVI,v as bandArithmeticSR,O as bandArithmeticSRre,T as bandArithmeticSultan,B as bandArithmeticTSAVI,b as bandArithmeticVARI,L as bandArithmeticWNDWI,fn as bitwiseAnd,mn as bitwiseLeftShift,kn as bitwiseNot,wn as bitwiseOr,In as bitwiseRightShift,hn as bitwiseXor,Bn as booleanAnd,yn as booleanNot,gn as booleanOr,jn as booleanXor,rt as cellStatistics,Z as colormap,X as compositeBands,nt as conditional,c as contrastBrightness,a as convolution,xn as cos,Tn as cosh,ut as curvature,st as defaultRaster,bn as divide,Pn as equalTo,vn as exp,Sn as exp10,On as exp2,Q as extractBand,Cn as float,Rn as greaterThan,Nn as greaterThanEqual,An as int,Dn as isNull,Mn as lessThan,Un as lessThanEqual,Fn as log,zn as log10,Ln as log2,_ as mask,en as minus,En as mod,Jn as negate,Vn as notEqual,rn as plus,sn as power,Y as remap,$n as roundDown,Wn as roundUp,_n as setNull,Gn as sin,Hn as sinh,ot as slope,un as sqrt,Zn as square,it as statistics,q as statisticsHistogram,k as stretchHistogramEqualization,p as stretchMinMax,m as stretchNone,f as stretchPercentClip,l as stretchStandardDeviation,K as table,qn as tan,Kn as tanh,on as times};
