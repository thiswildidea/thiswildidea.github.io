/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{x as o,i as s}from"../../chunks/typedArrayUtil.js";import{L as t}from"../../chunks/Logger.js";import{o as e}from"../../chunks/ensureType.js";import{c as l,f as r}from"../../chunks/date.js";import{isTimeOnlyField as i}from"../../layers/support/fieldUtils.js";import{f as n,r as a}from"../../chunks/numberUtils.js";import m from"../visualVariables/support/ColorStop.js";import{f as u,i as p}from"../../chunks/utils2.js";import{g as c}from"../../chunks/utils8.js";import y from"../../Color.js";import"../../symbols.js";import f from"../../symbols/SimpleLineSymbol.js";import j from"./HeatmapColorStop.js";import"../../config.js";import"../../core/lang.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/handleUtils.js";import"../../chunks/timeZoneUtils.js";import"../../chunks/datetime.js";import"../../core/Error.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/tracking.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../chunks/time.js";import"../../core/sql.js";import"../../intl.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../core/JSONSupport.js";import"../../chunks/tslib.es6.js";import"../../chunks/assets.js";import"../../chunks/mathUtils.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/common.js";import"../../chunks/arcadeOnDemand.js";import"../../geometry.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../chunks/reader.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/Ellipsoid.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../chunks/colorUtils.js";import"../../chunks/basemapUtils.js";import"../../Basemap.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/collectionUtils.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../chunks/loadAll.js";import"../../chunks/asyncUtils.js";import"../../portal/Portal.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../portal/PortalItem.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../support/BasemapStyle.js";import"../../chunks/writeUtils.js";import"../../chunks/layerUtils2.js";import"../../chunks/utils3.js";import"../../chunks/screenUtils.js";import"../../chunks/mat4.js";import"../../chunks/jsonUtils.js";import"../../chunks/parser.js";import"../../chunks/_commonjsHelpers.js";import"../../symbols/support/cimSymbolUtils.js";import"../../chunks/utils9.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../chunks/Symbol3DMaterial.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/CIMSymbol.js";import"../../chunks/enumeration.js";import"../../symbols/Symbol.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils4.js";import"../../symbols/edges/Edges3D.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../symbols/FillSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/lineMarkers.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils5.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/Symbol3DAnchorPosition2D.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../core/Clonable.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../core/reactiveUtils.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";const h="<",d=">";function b(o,s,t,e){let l="";return 0===s?l=`${h} `:s===t&&(l=`${d} `),l+(e?u(o,e):n(o))}const A=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function g(o){if(!("visualVariables"in o)||!o.visualVariables)return null;const s=o.visualVariables.find((o=>"color"===o.type));if(!s)return null;let t=null,e=null;if(s.stops){if(1===s.stops.length)return s.stops[0].color;t=s.stops[0].value,e=s.stops[s.stops.length-1].value}const l=null!=t&&null!=e?t+(e-t)/2:0,{getColor:r}=await import("../../chunks/visualVariableUtils.js").then((o=>o.l));return r(s,l)??null}async function k(o,s){const t=o.trailCap,e=o.trailWidth||1,l=s||await g(o)||o.color;return new f({cap:t,color:l,width:e})}function v(o){return null!=o&&"object"==typeof o&&"min"in o&&"max"in o}const S=new y([64,64,64]);function w(o,s){const t=[],e=o.length-1;return 5===o.length?t.push(0,2,4):t.push(0,e),o.map(((o,l)=>t.includes(l)?b(o,l,e,s):null))}async function U(o,s,t){let e=!1,l=[],r=[];if(o.stops){const s=o.stops;l=s.map((o=>o.value)),e=s.some((o=>!!o.label)),e&&(r=s.map((o=>o.label)))}const i=l[0],n=l[l.length-1];if(null==i&&null==n)return null;const a=e?null:w(l,t),m=await Promise.all(l.map((async(t,l)=>{const i="opacity"===o.type?await async function(o,s,t){const e=new y(t??S),l=(await import("../../chunks/visualVariableUtils.js").then((o=>o.l))).getOpacity(s,o);return null!=l&&(e.a=l),e}(t,o,s):(await import("../../chunks/visualVariableUtils.js").then((o=>o.l))).getColor(o,t);return{value:t,color:i,label:e?r[l]:a?.[l]??""}})));return m.reverse()}function V(o){let s=!1,t=[],e=[];t=o.map((o=>o.value)),s=o.some((o=>!!o.label)),s&&(e=o.map((o=>o.label??"")));const l=t[0],r=t[t.length-1];if(null==l&&null==r)return null;const i=s?null:w(t);return t.map(((t,l)=>({value:t,color:x(t,o),label:s?e[l]:i?.[l]??""}))).reverse()}function x(o,s){const{startIndex:t,endIndex:e,weight:l}=function(o,s){let t=0,e=s.length-1;return s.some(((s,l)=>o<s.value?(e=l,!0):(t=l,!1))),{startIndex:t,endIndex:e,weight:(o-s[t].value)/(s[e].value-s[t].value)}}(o,s);if(t===e)return s[t].color;const r=y.blendColors(s[t].color,s[e].color,l);return new y(r)}function E(o,s){let t=[];if(o&&"multipart"===o.type)o.colorRamps.reverse().forEach(((e,l)=>{0===l?t.push({value:s.max,color:new y(e.toColor),label:"high"}):t.push({value:null,color:new y(e.toColor),label:""}),l===o.colorRamps.length-1?t.push({value:s.min,color:new y(e.fromColor),label:"low"}):t.push({value:null,color:new y(e.fromColor),label:""})}));else{let e,l;o&&"algorithmic"===o.type?(e=o.fromColor,l=o.toColor):(e=[0,0,0,1],l=[255,255,255,1]),t=[{value:s.max,color:new y(l),label:"high"},{value:s.min,color:new y(e),label:"low"}]}return t}function I(o){if(!o.colorStops)return[];const s=[...o.colorStops].filter((o=>o.color?.a>0));let t=s.length-1;if(s&&s[0]){const o=s[t];o&&1!==o.ratio&&(s.push(new j({ratio:1,color:o.color})),t++)}return s.map(((s,e)=>{let l="";return 0===e?l=o.legendOptions?.minLabel||"low":e===t&&(l=o.legendOptions?.maxLabel||"high"),{color:s.color,label:l,ratio:s.ratio}})).reverse()}const D=t.getLogger("esri.renderers.support.utils"),C={lte:"<=",gte:">=",lt:"<",gt:">",pct:"%",ld:"â€“"},M={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},B={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"},L=l("short-date");async function P(o,s,t){e(o,s,(()=>[])).push(...t)}async function F(s){const t=new Map;if(!s)return t;if("visualVariables"in s&&s.visualVariables){const o=s.visualVariables.filter((o=>"color"===o.type));for(const s of o){const o=(await U(s)??[]).map((o=>o.color));await P(t,s.field||s.valueExpression,o)}}if("heatmap"===s.type){const o=I(s).map((o=>o.color));await P(t,s.field||s.valueExpression,o)}else if("pie-chart"===s.type){for(const o of s.attributes)await P(t,o.field||o.valueExpression,[o.color]);await P(t,"default",[s?.othersCategory?.color,c(s.backgroundFillSymbol,null)])}else if("dot-density"===s.type){for(const o of s.attributes)await P(t,o.field||o.valueExpression,[o.color]);await P(t,"default",[s.backgroundColor])}else if("unique-value"===s.type)if("predominance"===s.authoringInfo?.type)for(const o of s.uniqueValueInfos??[])await P(t,o.value.toString(),[c(o.symbol,null)]);else{const o=(s.uniqueValueInfos??[]).map((o=>c(o.symbol,null))),{field:e,field2:l,field3:r,valueExpression:i}=s;(e||i)&&await P(t,e||i,o),l&&await P(t,l,o),r&&await P(t,r,o)}else if("class-breaks"===s.type){const o=s.classBreakInfos.map((o=>c(o.symbol,null))),{field:e,valueExpression:l}=s;await P(t,e??l,o)}else"simple"===s.type&&await P(t,"default",[c(s.symbol,null)]);return"defaultSymbol"in s&&s.defaultSymbol&&await P(t,"default",[c(s.defaultSymbol,null)]),t.forEach(((s,e)=>{const l=o(s.filter(Boolean),((o,s)=>JSON.stringify(o)===JSON.stringify(s)));t.set(e,l)})),t}async function O(o,s,t){const l=e(o,s,(()=>new Map));for(const o of t)l.set(o.value,o.color)}async function z(o){const s=new Map;if(!o)return s;if("unique-value"!==o.type||o.authoringInfo?.type)if("class-breaks"===o.type){const t=o.classBreakInfos.map((o=>({value:o.minValue,color:c(o.symbol,null)}))).reverse(),{field:e,valueExpression:l}=o;await O(s,e??l,t)}else"simple"===o.type&&await O(s,"default",[{value:"default",color:c(o.symbol,null)}]);else{const t=(o.uniqueValueInfos??[]).map((o=>({value:o.value,color:c(o.symbol,null)}))),{field:e,field2:l,field3:r,valueExpression:i,fieldDelimiter:n}=o,a=[e,l,r].filter(Boolean).join(n||"");(a||i)&&await O(s,a||i,t)}if("defaultSymbol"in o&&o.defaultSymbol&&await O(s,"default",[{value:"default",color:c(o.defaultSymbol,null)}]),"visualVariables"in o&&o.visualVariables){const t=o.visualVariables.filter((o=>"color"===o.type));for(const o of t){const t=await U(o)??[];await O(s,o.field||o.valueExpression,t)}}return s}function q(o){const{values:s,colors:t,labelIndexes:e,isDate:l}=o;return s.map(((o,i)=>{let a=null;if(!e||e.includes(i)){const t=l?r(o):n(o);t&&(a=function(o,s,t){let e="";return 0===s?e=C.lt+" ":s===t&&(e=C.gt+" "),e+o}(t,i,s.length-1))}return new m({value:o,color:t[i],label:a})}))}function R(o){let s=o.minValue,t=o.maxValue;const e=o.isFirstBreak?"":C.gt+" ",l="percent-of-total"===o.normalizationType?C.pct:"";return s=null==s?"":n(s),t=null==t?"":n(t),e+s+l+" "+C.ld+" "+t+l}function Q(o){const s=o.classBreakInfos,t=o.normalizationType;let e=[];if(s?.length)if("standard-deviation"!==o.classificationMethod)if(o.round){e.push(s[0].minValue);for(const o of s)e.push(o.maxValue);e=a(e),s.forEach(((o,s)=>{o.label=R({minValue:0===s?e[0]:e[s],maxValue:e[s+1],isFirstBreak:0===s,normalizationType:t})}))}else s.forEach(((o,s)=>{o.label=R({minValue:o.minValue,maxValue:o.maxValue,isFirstBreak:0===s,normalizationType:t})}));else D.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.")}function N(o){const s=o.map((o=>new Date(o))),t=s.length;let e=1/0,l=null;for(let o=0;o<t-1;o++){const r=s[o];let i=1/0,n=null;for(let e=o+1;e<t;e++){const o=s[e],t=(r.getFullYear()!==o.getFullYear()?"year":r.getMonth()!==o.getMonth()&&"month")||r.getDate()!==o.getDate()&&"day"||r.getHours()!==o.getHours()&&"hour"||r.getMinutes()!==o.getMinutes()&&"minute"||r.getSeconds()!==o.getSeconds()&&"second"||"millisecond",l=M[t];l<i&&(i=l,n=t)}i<e&&(e=i,l=n)}return l}function T(o){const{value:s,domain:t,fieldInfo:e,dateFormatOptions:l}=o;let r=String(s);const a=t&&"codedValues"in t&&t.codedValues?t.getName(s):null;return a?r=a:null!=s&&e&&(p(e)||i(e))?r=u(s,l??{fieldType:e.type}):"number"==typeof s&&(r=n(s)),r}function H(o,s){return"normalizationField"in o&&o.normalizationField?{type:"normalized-field",field:o.field,normalizationField:o.normalizationField}:"field"in o&&o.field?W(o.field):"valueExpression"in o&&o.valueExpression?{type:"expression",expression:o.valueExpression,title:o.valueExpressionTitle,returnType:s}:null}function W(o){return{type:"field",field:o}}function G(t,e){const l=[];if("class-breaks"===t.type||"heatmap"===t.type)l.push(H(t,"number"));else if("unique-value"===t.type){const o=t.authoringInfo;if(o&&"relationship"===o.type){if(o.field1&&o.field2){const s=o.field1.field,t=o.field2.field,e=o.field1.normalizationField,r=o.field2.normalizationField;l.push(H({field:s,normalizationField:e})),l.push(H({field:t,normalizationField:r}))}}else{const o=t.uniqueValueInfos?.[0];let s=null;if(o?.value){const t=typeof o.value;"string"!==t&&"number"!==t||(s=t)}l.push(H(t,s)),[t.field2,t.field3].forEach((o=>o&&l.push(W(o))))}}else"attributes"in t&&t.attributes?.forEach((o=>l.push(H(o,"number"))));const r=e?e(t):"visualVariables"in t?t.visualVariables:null;return r&&r.forEach((o=>l.push(H(o,"number")))),o(l.filter(s),((o,s)=>"field"===o.type&&"field"===s.type?o.field===s.field:"normalized-field"===o.type&&"normalized-field"===s.type?o.field===s.field&&o.normalizationField===s.normalizationField:"expression"===o.type&&"expression"===s.type&&o.expression===s.expression))}export{d as a,x as b,b as c,N as calculateDateFormatInterval,R as createClassBreakLabel,q as createColorStops,T as createUniqueValueLabel,V as d,B as dateFormatIntervalOptions,I as e,E as f,k as g,H as getAttribute,G as getAttributes,z as getColorsForRendererValues,F as getColorsFromRenderer,g as h,v as i,U as j,A as r,h as s,Q as setLabelsForClassBreaks,L as timelineDateFormatOptions};
