/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import{c as n}from"../chunks/asyncUtils.js";import s from"./Collection.js";import{i as t,o,isAborted as r,createAbortError as e,onAbort as i,ignoreAbortErrors as c}from"./promiseUtils.js";import{h as u,d as a,m}from"../chunks/handleUtils.js";import{r as l}from"../chunks/maybe.js";import{w as p}from"./Accessor.js";export{b as autorun}from"./Accessor.js";import"../chunks/tslib.es6.js";import"./accessorSupport/decorators/property.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/typedArrayUtil.js";import"./lang.js";import"../chunks/ensureType.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"./Error.js";import"./accessorSupport/decorators/subclass.js";import"../chunks/tracking.js";import"./Evented.js";import"./Handles.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"./scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/time.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";function f(n,s,t={}){return j(n,s,t,g)}function d(n,s,t={}){return j(n,s,t,w)}function j(n,s,t={},o){let r=null;const e=t.once?(n,t)=>{o(n)&&(l(r),s(n,t))}:(n,t)=>{o(n)&&s(n,t)};if(r=p(n,e,t.sync,t.equals),t.initial){const s=n();e(s,s)}return r}function h(n,s,r,e={}){let i=null,c=null,u=null;function a(){i&&c&&(c.remove(),e.onListenerRemove?.(i),i=null,c=null)}function p(n){e.once&&e.once&&l(u),r(n)}const d=f(n,((n,r)=>{a(),t(n)&&(i=n,c=o(n,s,p),e.onListenerAdd?.(n))}),{sync:e.sync,initial:!0});return u=m((()=>{d.remove(),a()})),u}function y(n,s){return v(n,null,s)}function k(n,s){return v(n,w,s)}function v(n,s,t){if(r(t))return Promise.reject(e());const o=n();if(s?.(o))return Promise.resolve(o);let c=null;function a(){c=l(c)}return new Promise(((o,r)=>{c=u([i(t,(()=>{a(),r(e())})),j(n,(n=>{a(),o(n)}),{sync:!1,once:!0},s??g)])}))}function g(n){return!0}function w(n){return!!n}function A(n,s,t={}){let o=!1;const r=f(n,((n,t)=>{o||s(n,t)}),t);return{remove(){r.remove()},pause(){o=!0},resume(){o=!1}}}function L(n,t){const o=new s,r=h(n,"after-splice",(({added:n,start:s,deleteCount:r})=>{const e=o.splice(s,r);for(const n of e)n.remove();if(n?.length){const r=n.map(t);o.addMany(r,s)}}),{sync:!0,onListenerRemove:()=>o.drain((n=>n.remove())),onListenerAdd:n=>o.addMany(n.items.map(t))});return o.addHandles(r),o}function P(t,o){const i=new s,u=L(t,(s=>n((async n=>{const t=await o(s,n);if(r(n))throw t.remove(),e();return t})))),m=()=>null,l=async n=>{const s=await n.promise,t=u.indexOf(n);t<0||i.splice(t,1,s)};i.addMany(u.items.map(m));for(const n of u)c(l(n));const p=u.on("after-splice",(({added:n,start:s,deleteCount:t})=>{const o=i.splice(s,t);for(const n of o)n?.remove();if(n?.length){i.addMany(n.map(m),s);for(const s of n)c(l(s))}}));return i.addHandles([a(u),p]),i}const x={sync:!0},M={initial:!0},O={sync:!0,initial:!0};export{M as initial,L as mapCollection,P as mapCollectionAsync,h as on,y as once,A as pausable,x as sync,O as syncAndInitial,f as watch,d as when,k as whenOnce};
