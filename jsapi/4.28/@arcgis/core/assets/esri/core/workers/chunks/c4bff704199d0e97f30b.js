"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[1392],{74395:(e,t,r)=>{r.d(t,{B:()=>a});var n=r(48578),i=r(88994),o=r(92482);const s={minX:0,minY:0,maxX:0,maxY:0};class a{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new i.P(9,(0,n.h)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((r,n)=>{e[t++]=n})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,o.e)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),function(e,t,r){!function(e){s.minX=e[0],s.minY=e[1],s.maxX=e[2],s.maxY=e[3]}(t),e.search(s,r)}(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},47842:(e,t,r)=>{r.d(t,{E:()=>b});var n,i=r(29768),o=r(57251),s=r(12047),a=r(71252),l=r(34250),d=(r(91306),r(48578),r(97714)),p=r(17533),u=r(2906),h=r(14249),c=r(17298);let y=n=class extends s.wq{constructor(e){super(e)}async collectRequiredFields(e,t){return(0,h.io)(e,t,this.expression)}clone(){return new n({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],y.prototype,"expression",void 0),(0,i._)([(0,l.Cb)({type:String,json:{write:!0}})],y.prototype,"title",void 0),y=n=(0,i._)([(0,p.j)("esri.layers.support.FeatureExpressionInfo")],y);const f=y;var m;const g=(0,o.s)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),_=new o.J({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let w=m=class extends s.wq{constructor(e){super(e),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,n){t[r]=e.write({},n),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):null!=e||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new m({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,a.e)(this.featureExpressionInfo,e.featureExpressionInfo)}};(0,i._)([(0,l.Cb)({type:f,json:{write:!0}})],w.prototype,"featureExpressionInfo",void 0),(0,i._)([(0,d.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],w.prototype,"readFeatureExpressionInfo",null),(0,i._)([(0,u.w)("featureExpressionInfo",{featureExpressionInfo:{type:f},"featureExpression.value":{type:[0]}})],w.prototype,"writeFeatureExpressionInfo",null),(0,i._)([(0,l.Cb)({type:g.apiValues,nonNullable:!0,json:{type:g.jsonValues,read:g.read,write:{writer:g.write,isRequired:!0}}})],w.prototype,"mode",null),(0,i._)([(0,l.Cb)({type:Number,json:{write:!0}})],w.prototype,"offset",void 0),(0,i._)([(0,l.Cb)({type:c.s,json:{type:String,read:_.read,write:_.write}})],w.prototype,"unit",null),w=m=(0,i._)([(0,p.j)("esri.layers.support.ElevationInfo")],w);const b=w},56761:(e,t,r)=>{r.d(t,{F:()=>y});var n=r(48578),i=r(60991),o=r(75067),s=r(92143),a=r(53326),l=r(92482),d=r(40267),p=r(74395),u=r(92653),h=r(44722);const c=(0,a.c)();class y{constructor(e){this.geometryInfo=e,this._boundsStore=new p.B,this._featuresById=new Map,this._markedIds=new Set,this.events=new o.Z,this.featureAdapter=h.o}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,r,n,i]=this.fullBounds;return{xmin:t,ymin:r,xmax:n,ymax:i,spatialReference:(0,u.c)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map((e=>this._upsert(e)));return this._emitChanged(),t.filter(n.i)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const r of e){const e=this._boundsStore.get(r.objectId);e&&t((0,a.g)(c,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,r)=>{this._markedIds.has(r)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void s.L.getLogger("esri.layers.graphics.data.FeatureStore").error(new i.Z("featurestore:invalid-feature","feature id is missing",{feature:e}));const r=this._featuresById.get(t);let n;if(this._markedIds.add(t),r?(e.displayId=r.displayId,n=this._boundsStore.get(t),this._boundsStore.delete(t)):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);n=(0,d.g)(null!=n?n:(0,l.c)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=n&&this._boundsStore.set(t,n),this._featuresById.set(t,e)}_upsert(e){const t=e?.objectId;if(null==t)return s.L.getLogger("esri.layers.graphics.data.FeatureStore").error(new i.Z("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const r=this._featuresById.get(t);if(!r)return this._add(e),e;this._markedIds.add(t);const{geometry:n,attributes:o}=e;for(const e in o)r.attributes[e]=o[e];return n&&(r.geometry=n,this._boundsStore.set(t,(0,d.g)((0,l.c)(),n,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),r}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._markedIds.delete(t),this._boundsStore.delete(t),this._featuresById.delete(t),e}}},1392:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Kt});var n=r(29768),i=(r(74569),r(15324)),o=r(60991),s=r(92143),a=r(50406),l=r(34250),d=r(91306),p=r(48578),u=r(17533),h=r(4417),c=r(41617),y=r(40267),f=r(16204),m=r(86748),g=(r(55306),r(71206),r(51979),r(60698),r(53321),r(65684),r(86758),r(95310),r(20208)),_=(r(65514),r(1623)),w=r(53785),b=r(56761),x=r(70033),v=r(4571),C=r(21972),E=r(52991),I=r(44567),T=r(85674),k=r(32422),M=r(88762),S=r(82058);r(31450),r(76506),r(86656),r(66396),r(22723),r(379),r(62062),r(6540),r(6906),r(79456);let L=class extends C.Z{constructor(e){super(e),this.resultRows=[]}};(0,n._)([(0,l.Cb)()],L.prototype,"resultRows",void 0),L=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphQueryResult")],L);const N=L;let R=class extends C.Z{constructor(e){super(e),this.resultRowsStream=new ReadableStream}};(0,n._)([(0,l.Cb)()],R.prototype,"resultRowsStream",void 0),R=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphQueryResult")],R);const D=R;var j=r(12047),P=r(60947);let G=class extends j.wq{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],G.prototype,"name",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],G.prototype,"unique",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],G.prototype,"ascending",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],G.prototype,"description",void 0),(0,n._)([(0,l.Cb)({type:[String],json:{write:!0}})],G.prototype,"fieldNames",void 0),G=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.FieldIndex")],G);const O=G;let F=class extends j.wq{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],F.prototype,"name",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],F.prototype,"alias",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],F.prototype,"fieldType",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],F.prototype,"geometryType",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"hasM",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"hasZ",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"nullable",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"editable",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"required",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"defaultVisibility",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],F.prototype,"systemMaintained",void 0),(0,n._)([(0,l.Cb)()],F.prototype,"role",void 0),(0,n._)([(0,l.Cb)({type:Object,json:{type:String,write:{writer:(e,t)=>{t.defaultValue=null!=e?e.toString():null}}}})],F.prototype,"defaultValue",void 0),F=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphProperty")],F);const A=F;let Z=class extends j.wq{constructor(e){super(e),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],Z.prototype,"name",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],Z.prototype,"alias",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],Z.prototype,"role",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],Z.prototype,"strict",void 0),(0,n._)([(0,l.Cb)({type:[A],json:{write:!0}})],Z.prototype,"properties",void 0),(0,n._)([(0,l.Cb)({type:[O],json:{write:!0}})],Z.prototype,"fieldIndexes",void 0),Z=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphObjectType")],Z);const B=Z;let z=class extends B{constructor(e){super(e)}};z=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.EntityType")],z);const q=z;let Y=class extends B{constructor(e){super(e),this.endPoints=[]}};(0,n._)([(0,l.Cb)()],Y.prototype,"endPoints",void 0),Y=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.RelationshipType")],Y);const U=Y;r(57251),r(89623);var Q=r(73173);r(32101),r(2906);let J=class extends j.wq{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};(0,n._)([(0,l.Cb)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e?.getTime()}}}})],J.prototype,"timestamp",void 0),(0,n._)([(0,l.Cb)({type:P.Z,json:{write:!0}})],J.prototype,"spatialReference",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],J.prototype,"strict",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],J.prototype,"objectIdField",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],J.prototype,"globalIdField",void 0),(0,n._)([(0,l.Cb)()],J.prototype,"arcgisManaged",void 0),(0,n._)([(0,l.Cb)()],J.prototype,"identifierInfo",void 0),(0,n._)([(0,l.Cb)()],J.prototype,"searchIndexes",void 0),(0,n._)([(0,l.Cb)({type:[q],json:{write:!0}})],J.prototype,"entityTypes",void 0),(0,n._)([(0,l.Cb)({type:[U],json:{write:!0}})],J.prototype,"relationshipTypes",void 0),J=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.DataModel")],J);const V=J;let H=class extends j.wq{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};(0,n._)([(0,l.Cb)({type:[String],json:{write:!0}})],H.prototype,"capabilities",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],H.prototype,"supportsSearch",void 0),(0,n._)([(0,l.Cb)({type:[String],json:{write:!0}})],H.prototype,"supportedQueryFormats",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],H.prototype,"allowGeometryUpdates",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],H.prototype,"searchMaxRecordCount",void 0),(0,n._)([(0,l.Cb)({type:Object,json:{write:!0}})],H.prototype,"serviceCapabilities",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],H.prototype,"maxRecordCount",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],H.prototype,"description",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],H.prototype,"copyrightText",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],H.prototype,"units",void 0),(0,n._)([(0,l.Cb)({type:Object,json:{write:!0}})],H.prototype,"spatialReference",void 0),(0,n._)([(0,l.Cb)({type:Number,json:{write:!0}})],H.prototype,"currentVersion",void 0),(0,n._)([(0,l.Cb)({type:Object,json:{write:!0}})],H.prototype,"dateFieldsTimeReference",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],H.prototype,"serviceItemId",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],H.prototype,"supportsDocuments",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],H.prototype,"dataEditingNotSupported",void 0),(0,n._)([(0,l.Cb)({type:Boolean,json:{write:!0}})],H.prototype,"schemaEditingNotSupported",void 0),H=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.ServiceDefinition")],H);const $=H;let W=class extends j.wq{constructor(e){super(e),this.dataModel=null,this.serviceDefinition=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],W.prototype,"url",void 0),(0,n._)([(0,l.Cb)({type:V,json:{write:!0}})],W.prototype,"dataModel",void 0),(0,n._)([(0,l.Cb)({type:$,json:{write:!0}})],W.prototype,"serviceDefinition",void 0),W=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.KnowledgeGraph")],W);const X=W;var K=r(84069),ee=r(91597),te=r(92896),re=r(73796);let ne=class extends j.wq{constructor(e){super(e),this.properties=null}};(0,n._)([(0,l.Cb)({json:{write:!0}})],ne.prototype,"properties",void 0),ne=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphObject")],ne);const ie=ne;let oe=class extends ie{constructor(e){super(e),this.typeName=null,this.id=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],oe.prototype,"typeName",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],oe.prototype,"id",void 0),oe=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphNamedObject")],oe);const se=oe;var ae=r(21801),le=(r(97714),r(35132),r(86787),r(89034),r(98380),r(92482),r(82426),r(72836),r(66106),r(29794),r(22781));let de=class extends se{constructor(e){super(e),this.layoutGeometry=null}};(0,n._)([(0,l.Cb)({type:ee.Z,json:{write:!0}})],de.prototype,"layoutGeometry",void 0),de=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.Entity")],de);const pe=de;let ue=class extends se{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],ue.prototype,"originId",void 0),(0,n._)([(0,l.Cb)({type:String,json:{write:!0}})],ue.prototype,"destinationId",void 0),(0,n._)([(0,l.Cb)({type:te.Z,json:{write:!0}})],ue.prototype,"layoutGeometry",void 0),ue=(0,n._)([(0,u.j)("esri.rest.Relationship.Relationship")],ue);const he=ue;let ce=class extends C.Z{constructor(e){super(e),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};(0,n._)([(0,l.Cb)()],ce.prototype,"name",void 0),(0,n._)([(0,l.Cb)()],ce.prototype,"supportedCategory",void 0),(0,n._)([(0,l.Cb)()],ce.prototype,"analyzers",void 0),(0,n._)([(0,l.Cb)()],ce.prototype,"searchProperties",void 0),ce=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.SearchIndex")],ce);const ye=ce;let fe=class extends j.wq{constructor(e){super(e),this.path=null}};(0,n._)([(0,l.Cb)({type:[ie],json:{write:!0}})],fe.prototype,"path",void 0),fe=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.Path")],fe);const me=fe;let ge=class extends C.Z{constructor(e){super(e),this.hasError=null,this.error=null,this.editResults=[]}};(0,n._)([(0,l.Cb)()],ge.prototype,"hasError",void 0),(0,n._)([(0,l.Cb)()],ge.prototype,"error",void 0),(0,n._)([(0,l.Cb)()],ge.prototype,"editResults",void 0),ge=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphApplyEdits")],ge);const _e=ge,we="esri/rest/knowledgeGraph/wasmInterface/";let be;async function xe(){if(be)return be;const e=(0,p.h)("wasm-simd");return be=async function(e){if(e){const{default:e}=await r.e(736).then(r.bind(r,60736)).then((e=>e.a));return e({locateFile:e=>(0,Q.g)(we+e)})}const{default:t}=await r.e(9992).then(r.bind(r,49992)).then((e=>e.a));return t({locateFile:e=>(0,Q.g)(we+e)})}(e),be}function ve(e,t){const r=new t.ArrayValue;return r.deleteLater(),e.forEach((e=>{r.add_value(Ie(e,t))})),r}function Ce(e,t){const r=new t.ObjectValue;r.deleteLater();for(const[n,i]of Object.entries(e))r.set_key_value(n,Ie(i,t));return r}function Ee(e,t){if(e instanceof K.Z)return function(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],i=[];i[0]=e.points.length;let o=0;return e.points.forEach((e=>{e.forEach((e=>{n[o]=e,o++}))})),r.coords=new Float64Array(n),r.lengths=new Uint32Array(i),r}(e,t);if(e instanceof ee.Z)return function(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],i=[];i[0]=1,n[0]=e.x,n[1]=e.y;let o=2;return e.hasZ&&(n[o]=e.z,o++),e.hasM&&(n[o]=e.m,o++),r.coords=new Float64Array(n),r.lengths=new Uint32Array(i),r}(e,t);if(e instanceof te.Z||e instanceof I.Z)return function(e,t){const r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],i=[];let o=[];e instanceof te.Z?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,o=e.paths):e instanceof I.Z&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,o=e.rings);let s=0,a=0;return o.forEach((e=>{let t=0;e.forEach((e=>{t++,e.forEach((e=>{n[a]=e,a++}))})),i[s]=t,s++})),r.coords=new Float64Array(n),r.lengths=new Uint32Array(i),r}(e,t);throw new o.Z("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function Ie(e,t){if(null==e)return"";if("object"!=typeof e)return e;if(e instanceof Date)return e;if(e instanceof re.Z)return Ee(e,t);if(Array.isArray(e)){const r=new t.ArrayValue;return r.deleteLater(),e.forEach((e=>{r.add_value(Ie(e,t))})),r}return Ce(e,t)}function Te(e,t){if(!e.typeName)throw new o.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof pe){const r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,i]of Object.entries(e.properties))r.set_key_value(n,ke(i,t));return e.id&&r.set_id(e.id),r}if(e instanceof he){const r=new t.RelationshipValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,i]of Object.entries(e.properties))r.set_key_value(n,ke(i,t));return e.id&&r.set_id(e.id),e.originId&&e.destinationId&&r.set_related_entity_ids(e.originId,e.destinationId),r}throw new o.Z("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function ke(e,t){return null==e?"":"object"!=typeof e||e instanceof Date?e:e instanceof re.Z?Ee(e,t):""}var Me,Se,Le,Ne,Re,De,je;function Pe(e){return{name:e.name,alias:e.alias,role:Me[e.role.value]?Me[e.role.value]:null,strict:e.strict,properties:Ae(e.properties),fieldIndexes:Ze(e.field_indexes)}}function Ge(e){e.deleteLater();const t=Pe(e),r=[];for(let t=0;t<e.end_points.size();t++){const n=e.end_points.get(t);r.push({originEntityType:n.origin_entity_type,destinationEntityType:n.dest_entity_type})}return new U(Object.assign({endPoints:r},t))}function Oe(e){const t=[];for(let n=0;n<e.size();n++)t.push(((r=e.get(n)).deleteLater(),new q(Pe(r))));var r;return t}function Fe(e){const t=[];for(let r=0;r<e.size();r++)t.push(e.get(r));return t}function Ae(e){const t=[];for(let n=0;n<e.size();n++)t.push(((r=e.get(n)).deleteLater(),new A({alias:r.alias,name:r.name,fieldType:Se[r.field_type.value]?Se[r.field_type.value]:null,geometryType:Le[r.geometry_type.value]?Le[r.geometry_type.value]:null,hasM:r.has_m,hasZ:r.has_z,nullable:r.nullable,editable:r.editable,required:r.required,defaultVisibility:r.default_visibility,systemMaintained:r.system_maintained,role:De[r.role.value],defaultValue:r.default_value})));var r;return t}function Ze(e){const t=[];for(let n=0;n<e.size();n++)t.push(((r=e.get(n)).deleteLater(),new O({name:r.name,unique:r.unique,ascending:r.ascending,description:r.description,fieldNames:Fe(r.fields)})));var r;return t}function Be(e){const t=[];for(let r=0;r<e.size();r++)t.push(Ge(e.get(r)));return t}function ze(e){const t=[];for(let r=0;r<e.size();r++){const r=new ye,n=e.get(0);r.name=n.name,r.supportedCategory=Re[n.supported_category.value];const i=n.analyzers.size();for(let e=0;e<i;e++)r.analyzers.push({name:n.analyzers.get(e).name});for(let e=0;e<n.search_properties.keys().size();e++){const t=n.search_properties.keys().get(e),i=n.search_properties.get(t),o=[];for(let e=0;e<i.property_names.size();e++)o.push(i.property_names.get(e));r.searchProperties.set(t,{propertyNames:o})}t.push(r)}return t}!function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"}(Me||(Me={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(Se||(Se={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(Le||(Le={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(Ne||(Ne={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(Re||(Re={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(De||(De={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(je||(je={}));let qe=class extends ie{constructor(e){super(e)}};qe=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.ObjectValue")],qe);const Ye=qe;var Ue,Qe,Je;function Ve(e){const t={},r=He(e,t),n=e.lengths,i=e.coords;let s="";if(e.geometry_type.value===Ue.ESRI_GEOMETRY_POLYGON)s="rings";else{if(e.geometry_type.value!==Ue.ESRI_GEOMETRY_POLYLINE)throw new o.Z("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");s="paths"}t[s]=[];let a=0;return n.forEach((e=>{const n=[];for(let t=0;t<e;t++){const e=[];for(let t=0;t<r;t++)e[t]=i[a],a++;n.push(e)}t[s].push(n)})),t}function He(e,t){let r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}!function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"}(Ue||(Ue={})),function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"}(Qe||(Qe={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(Je||(Je={}));const $e=s.L.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),We={decodedWasmObjToQueryResponseObj:(e,t)=>{if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case Ue.ESRI_GEOMETRY_POINT:return function(e){const t={};let r=2;He(e,t);const n=e.coords;return t.x=n[0],t.y=n[1],e.has_z&&(t.z=n[r],r++),e.has_m&&(t.m=n[r]),new ee.Z(t)}(e);case Ue.ESRI_GEOMETRY_MULTIPOINT:return function(e){const t={},r=He(e,t),n=e.lengths,i=e.coords,o=n[0];t.points=[];let s=0;for(let e=0;e<o;e++){const e=[];for(let t=0;t<r;t++)e[t]=i[s],s++;t.points.push(e)}return new K.Z(t)}(e);case Ue.ESRI_GEOMETRY_POLYLINE:return new te.Z(Ve(e));case Ue.ESRI_GEOMETRY_POLYGON:return new I.Z(Ve(e));case Ue.ESRI_GEOMETRY_ENVELOPE:case Ue.ESRI_GEOMETRY_MULTI_PATCH:return $e.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case Ue.ESRI_GEOMETRY_NULL:case Ue.ESRI_GEOMETRY_ANY:default:return $e.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return $e.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case Qe.OBJECT:return function(e,t){return new Ye(et(e,t))}(e,t);case Qe.ENTITY:return Ke(e,t);case Qe.RELATIONSHIP:return tt(e,t);case Qe.PATH:return function(e,t){const r=e.entity_count(),n=e.relationship_count(),i=[];for(let o=0;o<r;o++)i.push(Ke(e.get_entity_at(o),t)),o<n&&i.push(tt(e.get_relationship_at(o),t));return new me({path:i})}(e,t);case Qe.ARRAY:return function(e,t){const r=[],n=e.count();for(let i=0;i<n;i++){const n=e.get_value_at(i);r.push(Xe(n,t))}return r}(e,t);default:return $e.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function Xe(e,t){return We.decodedWasmObjToQueryResponseObj(e,t)}function Ke(e,t){const r=e.type_name,n=et(e,t),i=e.get_id();return new pe(Object.assign({typeName:r,id:i},n))}function et(e,t){const r={},n=e.key_count();for(let i=0;i<n;i++)r[e.get_key_at(i)]=Xe(e.get_value_at(i),t);return{properties:r}}function tt(e,t){const r=e.type_name,n=et(e,t);return new he(Object.assign({typeName:r,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},n))}const rt={fetchKnowledgeGraph:async e=>{const t=new X({url:e}),r=[];return r.push(it(t)),r.push(async function(e){return rt.refreshServiceDefinition(e)}(t)),await Promise.all(r),t},refreshDataModel:async e=>{e.dataModel=await ht(e)},refreshServiceDefinition:async e=>{const t=(await(0,S.Z)(e.url,{query:{f:"json"}})).data;return t.capabilities=t?.capabilities?.split(","),t.supportedQueryFormats=t?.supportedQueryFormats?.split(","),e.serviceDefinition=new $(t),e.serviceDefinition},executeQueryStreaming:async(e,t,r)=>{const n=`${e.url}/graph/query`;await st(e);const i=await dt(n,r);i.data.body=await async function(e,t){const r=await xe(),n=new r.GraphQueryRequestEncoder;if(n.deleteLater(),n.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),n.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[t,i]of Object.entries(e.bindParameters))lt(t,i,n,r);if(e.bindGeometryQuantizationParameters)i=e.bindGeometryQuantizationParameters,n.input_quantization_parameters={xy_resolution:i.xyResolution,x_false_origin:i.xFalseOrigin,y_false_origin:i.yFalseOrigin,z_resolution:i.zResolution,z_false_origin:i.zFalseOrigin,m_resolution:i.mResolution,m_false_origin:i.mFalseOrigin};else{if(t.dataModel||await it(t),4326!==t.dataModel?.spatialReference?.wkid)throw new o.Z("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");n.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless()}var i;e.outputQuantizationParameters&&function(e,t,r){if(!e.extent)throw new o.Z("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new o.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new o.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}(e.outputQuantizationParameters,n,r);try{n.encode()}catch(e){throw new o.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:e})}const s=n.get_encoding_result();if(0!==s.error.error_code)throw new o.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:s.error.error_code,errorMessage:s.error.error_message});return s.get_byte_buffer()}(t,e);const s=await ot(i.data.url,i.data);if(e.dataModel)return new D({resultRowsStream:await ut(s,e.dataModel)});throw new o.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},executeApplyEdits:async(e,t,r)=>{if(e.serviceDefinition?.dataEditingNotSupported)throw new o.Z("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const n=`${e.url}/graph/applyEdits`;await st(e);const i=await dt(n,r);return i.data.body=await async function(e,t){if(t.dataModel||await it(t),!t.dataModel)throw new o.Z("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const r=await xe(),n=!!e.options?.cascadeDelete,i=new r.GraphApplyEditsEncoder(r.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?(s=e.options?.inputQuantizationParameters,{xy_resolution:s.xyResolution,x_false_origin:s.xFalseOrigin,y_false_origin:s.yFalseOrigin,z_resolution:s.zResolution,z_false_origin:s.zFalseOrigin,m_resolution:s.mResolution,m_false_origin:s.mFalseOrigin}):r.InputQuantizationUtil.WGS84_lossless());var s;i.deleteLater(),i.cascade_delete=n;try{let t;e.entityAdds?.forEach((e=>{t=i.add_entity(Te(e,r)),at(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),e.relationshipAdds?.forEach((e=>{if(!e.originId||!e.destinationId)throw new o.Z("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");t=i.add_relationship(Te(e,r)),at(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),e.entityUpdates?.forEach((e=>{if(!e.id)throw new o.Z("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");t=i.update_entity(Te(e,r)),at(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),e.relationshipUpdates?.forEach((e=>{if(!e.id)throw new o.Z("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");t=i.update_relationship(Te(e,r)),at(t,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),e.entityDeletes?.forEach((e=>{if(!e.typeName)throw new o.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const t=i.make_delete_helper(e.typeName,!0);t.deleteLater(),e.ids?.forEach((e=>{t.delete_by_id(e)}))})),e.relationshipDeletes?.forEach((e=>{if(!e.typeName)throw new o.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const t=i.make_delete_helper(e.typeName,!1);e.ids?.forEach((e=>{t.delete_by_id(e)}))})),i.encode()}catch(e){throw new o.Z("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:e})}const a=i.get_encoding_result();return at(a.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),a.get_byte_buffer()}(t,e),async function(e){const t=e.headers.get("content-type");if(t?.includes("application/x-protobuf")){const t=await e.arrayBuffer(),r=new((await xe()).GraphApplyEditsDecoder);return r.deleteLater(),r.decode(new Uint8Array(t)),function(e){const t=new _e;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});const r=e.get_edit_results_count();for(let n=0;n<r;n++){const r=e.get_edit_results_at(n),i=e.get_edit_results_type_name_at(n),o=[],s=[],a=[],l=r.get_add_results_count(),d=r.get_update_results_count(),p=r.get_delete_results_count();for(let e=0;e<l;e++){const t=r.get_add_result_at(e);o.push({id:t.id,error:{errorCode:t.error.error_code,errorMessage:t.error.error_message}})}for(let e=0;e<d;e++){const t=r.get_update_result_at(e);s.push({id:t.id,error:{errorCode:t.error.error_code,errorMessage:t.error.error_message}})}for(let e=0;e<p;e++){const t=r.get_delete_result_at(e);a.push({id:t.id,error:{errorCode:t.error.error_code,errorMessage:t.error.error_message}})}t.editResults.push({typeName:i,adds:o,updates:s,deletes:a})}return t}(r)}throw new o.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})}(await ot(i.data.url,i.data))},executeQuery:async(e,t,r)=>{const n=`${e.url}/graph/query`,i=await(0,S.Z)(n,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:t.openCypherQuery,...r?.query},signal:r?.signal,timeout:r?.timeout}),s=i.getHeader?.("content-type"),a=i.data;if(s?.includes("application/x-protobuf")){const t=new((await xe()).GraphQueryDecoder);if(t.deleteLater(),e.dataModel)return new N({resultRows:pt(t,a,e.dataModel)});throw new o.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new o.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:s,data:i.data})},executeSearch:async(e,t,r)=>{const n=t.typeCategoryFilter,i=`${e.url}/graph/search`,s=await(0,S.Z)(i,{responseType:"array-buffer",query:{f:"pbf",searchQuery:`"${t.searchQuery}"`,typeCategoryFilter:n,...r?.query},signal:r?.signal,timeout:r?.timeout}),a=s.getHeader?.("content-type"),l=s.data;if(a?.includes("application/x-protobuf")){const t=new((await xe()).GraphQueryDecoder);if(t.deleteLater(),e.dataModel)return new N({resultRows:pt(t,l,e.dataModel)});throw new o.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new o.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:s.data})},executeSearchStreaming:async(e,t,r)=>{const n=`${e.url}/graph/search`;await st(e);const i=await dt(n,r);i.data.body=await async function(e){const t=await xe(),r=new t.GraphSearchRequestEncoder;if(r.deleteLater(),r.search_query=e.searchQuery,r.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],!0===e.returnSearchContext&&(r.return_search_context=e.returnSearchContext),null!=e.start&&e.start>0&&(r.start_index=e.start),null!=e.num&&(r.max_num_results=e.num),null!=e.idsFilter&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{r.set_ids_filter(ve(e.idsFilter,t))}catch(e){throw new o.Z("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:e})}e.namedTypesFilter?.forEach((e=>{r.add_named_type_filter(e)}));try{r.encode()}catch(e){throw new o.Z("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:e})}const n=r.get_encoding_result();if(0!==n.error.error_code)throw new o.Z("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:n.error.error_code,errorMessage:n.error.error_message});return n.get_byte_buffer()}(t);const s=await ot(i.data.url,i.data);if(e.dataModel)return new D({resultRowsStream:await ut(s,e.dataModel)});throw new o.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},_fetchWrapper:async(e,t)=>fetch(e,t)};async function nt(e,t,r){return rt.executeQueryStreaming(e,t,r)}async function it(e){return rt.refreshDataModel(e)}async function ot(e,t){return rt._fetchWrapper(e,t)}async function st(e){const t=M.id?.findCredential(e.url);t||(e.dataModel?await ht(e):await it(e))}function at(e,t,r){if(0!==e.error_code)throw new o.Z(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function lt(e,t,r,n){null==t?r.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?r.set_param_key_value(e,t):t instanceof re.Z?r.set_param_key_value(e,Ee(t,n)):t instanceof Array?r.set_param_key_value(e,ve(t,n)):r.set_param_key_value(e,Ce(t,n))}async function dt(e,t){return(0,S.Z)(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...t?.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t?.signal,timeout:t?.timeout})}function pt(e,t,r){e.push_buffer(new Uint8Array(t));const n=[];let i=0;for(;e.next_row();){i||(i=e.get_header_keys().size());const t=new Array(i);for(let n=0;n<i;n++){const i=e.get_value(n);t[n]=Xe(i,r)}n.push(t)}if(e.has_error())throw new o.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return n}async function ut(e,t){const r=e.headers.get("content-type");if(e.headers.get("content-length")&&s.L.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),r?.includes("application/x-protobuf")){const r=e.body?.getReader(),n=new((await xe()).GraphQueryDecoder);return n.deleteLater(),new ReadableStream({async start(e){try{return function i(){return r?.read().then((({done:s,value:a})=>{if(s){let t;if(n.has_error()&&(t=new o.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:n.error.error_code,errorMessage:n.error.error_message})),r.releaseLock(),t)throw e.error(t),t;return void e.close()}const l=pt(n,a,t);return l.length>0&&e.enqueue(l),i()}))}()}catch(t){r?.releaseLock(),e.error(new o.Z("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:t})),e.close()}}})}throw new o.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})}async function ht(e){const t=`${e.url}/dataModel/queryDataModel`,r=await(0,S.Z)(t,{responseType:"array-buffer",query:{f:"pbf"}}),n=r.getHeader?.("content-type"),i=r.data;if(n?.includes("application/x-protobuf")){const e=(await xe()).decode_data_model_from_protocol_buffer(new Uint8Array(i));if(!e)throw new o.Z("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return function(e){return e.deleteLater(),new V({timestamp:e.timestamp,spatialReference:new P.Z(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:je[e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:Ne[e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:ze(e.search_indexes),entityTypes:Oe(e.entity_types),relationshipTypes:Be(e.relationship_types)})}(e)}throw new o.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:r.data})}let ct=class extends C.Z{constructor(e){super(e),this.openCypherQuery=""}};(0,n._)([(0,l.Cb)()],ct.prototype,"openCypherQuery",void 0),ct=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphQuery")],ct);const yt=ct;let ft=class extends yt{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null}};(0,n._)([(0,l.Cb)()],ft.prototype,"bindParameters",void 0),(0,n._)([(0,l.Cb)()],ft.prototype,"bindGeometryQuantizationParameters",void 0),(0,n._)([(0,l.Cb)()],ft.prototype,"outputQuantizationParameters",void 0),ft=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],ft);const mt=ft;var gt=r(31292),_t=r(47346),wt=r(80462),bt=r(39275),xt=r(68219),vt=r(6416),Ct=r(97546),Et=r(14249),It=r(87258),Tt=r(78893),kt=r(37453);r(66122),r(75067),r(89914),r(29107),r(30574),r(2157),r(25977),r(58076),r(98242),r(7471),r(54414),r(59465),r(1648),r(8925),r(3482),r(76131),r(36097),r(45154),r(16769),r(93603),r(15438),r(593),r(48027),r(54174),r(85699),r(55531),r(96055),r(47776),r(18033),r(6331),r(62048),r(56890),r(30493),r(4292),r(75626),r(72652),r(29641),r(70821),r(3296),r(34229),r(37029),r(66284),r(87239),r(60217),r(96467),r(63571),r(30776),r(63130),r(25696),r(94216),r(42775),r(95834),r(34394),r(57150),r(76726),r(20444),r(76393),r(78548),r(2497),r(49906),r(46527),r(11799),r(48649),r(81731),r(9960),r(30823),r(53326),r(5853),r(39141),r(38742),r(52461),r(48243),r(34635),r(10401),r(49900),r(81184),r(33101),r(58943),r(67477),r(78533),r(74653),r(91091),r(70737),r(36834),r(8487),r(17817),r(90814),r(15459),r(97189),r(61847),r(28212),r(16955),r(22401),r(48699),r(77894),r(55187),r(8586),r(44509),r(69814),r(11305),r(62259),r(44790),r(58085),r(41864),r(5909),r(60669),r(48208),r(51589),r(26822),r(51723),r(23243),r(51669),r(6090),r(3977),r(36741),r(11253),r(90319),r(38822),r(74057),r(23761),r(48190),r(85557),r(94070),r(67541),r(16218),r(39855),r(12158),r(74864),r(63683),r(94479),r(45702),r(51127),r(9352),r(89241),r(91700),r(10738),r(1709),r(35154),r(32037),r(90811),r(60045),r(7200),r(68681),r(93939),r(62407),r(90033),r(97807),r(238),r(71831),r(46987),r(15173),r(50626),r(92624),r(92847),r(74395),r(88994),r(98576),r(5777),r(92653),r(95533),r(94751),r(95307),r(19124),r(20438),r(24251),r(77314),r(44722),r(72274),r(48675),r(54732),r(89219),r(71435),r(81716),r(35197),r(98402),r(40705),r(60599),r(91162),r(56420),r(74742),r(28239),r(5604),r(88610),r(59877),r(65775),r(66774),r(85056),r(39084),r(55585),r(72434),r(6941),r(93314),r(69218),r(32925),r(50619),r(27207),r(9801),r(53523),r(42911),r(46826),r(45433),r(92200),r(65949),r(70846),r(67961),r(29395),r(94303),r(43022),r(1557),r(47842),r(17298),r(62670),r(72992),r(34446),r(46646),r(77807),r(50203),r(30439),r(14460),r(13322),r(13201),r(81317);class Mt{constructor(){this._featureLookup=new Map}static getInstance(){return Mt.instance||(Mt.instance=new Mt),Mt.instance}static resetInstance(){Mt.instance&&(Mt.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const r=this.readFromStoreById(e);r&&t.push(r)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,r){const n=[];return e.forEach((e=>{if(!e?.id)return;e.properties||(e.properties=[]);let i,o=null;if(r&&e.properties[r]&&(o=(0,y.c)(e.properties[r])),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const n=this._featureLookup.get(e.id),s=JSON.parse(JSON.stringify(Object.assign(n.attributes,e.properties)));r&&e.properties[r]&&(s[r]=(0,k.im)(e.properties[r])),i=new T.O(o?JSON.parse(JSON.stringify(o)):n?.geometry?JSON.parse(JSON.stringify(n.geometry)):null,s,null,e.properties[t])}else i=new T.O(o?JSON.parse(JSON.stringify(o)):null,e.properties,null,e.properties[t]);this._featureLookup.set(e.id,i),n.push(i)})),n}}function St(e){if(!e.spatialReference.isWGS84)throw new o.Z("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let t;return t=e.xmax>180&&e.xmin<180?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[-180,e.ymin]]]:e.xmax>180&&e.xmin>180?[[[e.xmin-360,e.ymin],[e.xmin-360,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[e.xmin-360,e.ymin]]]:e.xmax>-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin+360,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[-180,e.ymin]]]:e.xmax<-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[e.xmax+360,e.ymax],[e.xmax+360,e.ymin],[e.xmin+360,e.ymin]]]:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],t}const Lt="ESRI__ID",Nt="ESRI__ORIGIN_ID",Rt="ESRI__DESTINATION_ID",Dt="ESRI__LAYOUT_GEOMETRY",jt=s.L.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager");let Pt=class extends C.Z{constructor(e){super(e),this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.memberIdTypeLookup=new Map,this._processingCacheUpdatesLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((r=>{r.name&&(t.set(r.name,"entity"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(r.name),r.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((r=>{r.name&&(t.set(r.name,"relationship"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(r.name),r.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((r,n)=>{if("entity"===t.get(n))this.entityTypeNames.add(n);else{if("relationship"!==t.get(n))return jt.warn(`A named type, ${n}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(n);this.relationshipTypeNames.add(n)}const i=new Map;r.members?.forEach((e=>{this.memberIdTypeLookup.set(e.id,n);const t=this.getById(e.id);t&&i.set(e.id,t)})),this.sublayerCaches.set(n,i)}))}addToLayer(e){e.forEach((({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new o.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const r=this.inclusionModeDefinition.namedTypeDefinitions.get(e);r.members||(r.members=new Map),r.members.set(t,{id:t}),this.memberIdTypeLookup.set(t,e)}}else{const r=new Map;r.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:r}),this.memberIdTypeLookup.set(t,e)}}))}getById(e){return Mt.getInstance().readFromStoreById(e)}async getData(e,t,r){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let n;if(n=e||new gt.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,r=this._processingCacheUpdatesLookup.get(t.objectType.name??""),i=n.outFields,o=n.geometry;let s="",a="";o&&o.extent&&(s=(0,h.e)(o.extent.ymin,o.extent.xmin,12),a=(0,h.e)(o.extent.ymax,o.extent.xmax,12)),i&&1===i.length&&i[0]===Lt&&"1=1"===n.where||await Promise.all(r??[]);const l=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],d=[];return l.forEach((r=>{if(r.geometry=e.linkChartDiagramLookup.get(r.attributes[t.objectIdField]),r.attributes[Dt]=r.geometry,s&&a){const n=e.linkChartGeohashLookup.get(r.attributes[t.objectIdField]);n?n>=s&&n<=a&&d.push(r):d.push(r)}else d.push(r)})),d}return this.retrieveDataFromService(n,t,r)}async getConnectedRecordIds(e){const t=[],r=[],n=new Map;return e.forEach((e=>{if(this.memberIdTypeLookup.has(e)){const t=this.memberIdTypeLookup.get(e);if(!this.entityTypeNames.has(t))return;n.has(t)?n.get(t)?.push(e):n.set(t,[e])}})),n.forEach(((e,n)=>{const i=`MATCH (n:${n})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`,o=new Promise((r=>{(async()=>{const r=(await nt(this.knowledgeGraph,new mt({openCypherQuery:i,bindParameters:{ids:e}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:n}=await r.read();if(e)break;for(let e=0;e<n.length;e++){const r=n[e];t.push({id:r[0],typeName:r[1]}),t.push({id:r[2],typeName:r[3]})}}}catch(e){if("AbortError"!==e.name)throw e;jt.info("Request aborted as expected")}})().then((()=>{r()}))}));r.push(o)})),await Promise.all(r),t}async refreshCacheContent(e,t,r,n=!0){const i=Mt.getInstance(),s=[],a=new Map,l=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&l.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&l.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e)){const t=this.memberIdTypeLookup.get(e);a.has(t)?a.get(t)?.push(e):a.set(t,[e])}})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?a.set(t,null):e.members&&e.members.forEach((e=>{a.has(t)&&null!==a.get(t)?a.get(t)?.push(e.id):a.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&a.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&a.set(e.name,null)})));for(const[e,p]of a){const a=new Promise((s=>{(async()=>{const s=new Set,a=[];let u,h="",c=!1;if(t||l.get(e)?.properties?.forEach((e=>{e.name&&s.add(e.name)})),r&&this.geographicLookup.has(e)){const t=this.geographicLookup.get(e)?.name;t&&s.add(t)}if(this.entityTypeNames.has(e))h=`MATCH (n:${e}) ${p?"WHERE id(n) IN $ids ":""}return ID(n)`,s.forEach((e=>{h+=`, n.${e}`,a.push(e)}));else{if(!this.relationshipTypeNames.has(e))throw new o.Z("knowledge-graph:layer-data-manager",`The graph type of ${e} could not be determined. Was this type set in the KG data model and inclusion definition?`);c=!0,h=`MATCH ()-[n:${e}]->() ${p?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,s.forEach((e=>{h+=`, n.${e}`,a.push(e)}))}u=new mt(p?{openCypherQuery:h,bindParameters:{ids:p}}:{openCypherQuery:h});const y=(await nt(this.knowledgeGraph,u)).resultRowsStream.getReader();for(;;){const{done:t,value:r}=await y.read();if(t)break;const o=[];for(let e=0;e<r.length;e++){const t=r[e];let n=0,i=0;const s={properties:{}};for(s.id=t[n],n++,i++,c&&(s.originId=t[n],n++,i++,s.destinationId=t[n],n++,i++,(0,d.o)(this.nodeConnectionsLookup,s.originId,(()=>new Set)).add(s.id),(0,d.o)(this.nodeConnectionsLookup,s.destinationId,(()=>new Set)).add(s.id));n<t.length;n++)s.properties[a[n-i]]=t[n];o.push(s)}const s=i.writeToStore(o,Lt,this.geographicLookup.get(e)?.name);this.sublayerCaches.has(e)||this.sublayerCaches.set(e,new Map),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(e)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(e,{useAllData:!1,members:new Map}),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(e).members=new Map);const l=this.sublayerCaches.get(e);s.forEach((t=>{l?.set(t.attributes[Lt],t),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.has(t.attributes[Lt])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.set(t.attributes[Lt],{id:t.attributes[Lt]}),this.memberIdTypeLookup.set(t.attributes[Lt],e))}))}})().then((()=>{s(null)}))}));s.push(a),this._processingCacheUpdatesLookup.get(e)?.push(a)}await Promise.all(s)}removeFromLayer(e){const t=new Set,r=new Set(e.map((e=>e.id)));for(const r of e)t.add(r.typeName),this.memberIdTypeLookup.delete(r.id),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((e=>{e.members?.has(r.id)&&e.members.delete(r.id)}));t.forEach((e=>{this.sublayerCaches.get(e)?.forEach(((t,n)=>{r.has(n)&&this.sublayerCaches.get(e)?.delete(n)}))}))}async retrieveDataFromService(e,t,r){const n=Mt.getInstance(),i=new Set,s=[];let a,l="",d=[];const p="relationship"===t.graphType,u=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,h=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let c=!u&&h?Array.from(h).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(c=e.objectIds);else if(null!=e.objectIds&&c&&c.length>0){const t=e.objectIds;e.objectIds=c.filter((e=>t.includes(e)))}else if(null!=e.objectIds)c=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=c}if(null!=e.outFields){const r=e.outFields;r.includes("*")?t.fields.forEach((e=>{i.add(e.name)})):r.forEach((e=>{e!==Lt&&e!==t.geometryFieldName&&i.add(e)}))}if(null!=e.geometry){const r=e.geometry;let n;const d=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,u=d?.spatialReference,h=d?.serviceCapabilities?.geometryCapabilities;let c=h?.geometryMaxBoundingRectangleSizeX,y=h?.geometryMaxBoundingRectangleSizeY;if(r?.extent?.spatialReference&&!r.spatialReference?.isWGS84?(await(0,_.initializeProjection)(r.extent.spatialReference,w.W),n=(0,_.project)(r.extent,w.W)):n=r.extent,c&&y&&u){if(4326!==u.wkid){const e=new ae.Z({spatialReference:u,xmax:c,ymax:y}),t=(0,_.project)(e,w.W);c=t.xmax,y=t.ymax}if(n.xmax-n.xmin>c)throw new o.Z("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${c}° latitude, limit exceeded`);if(n.ymax-n.ymin>y)throw new o.Z("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${y}° longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const r=await(0,E.E)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{r.fieldNames.includes(e.name)&&i.add(e.name)}))}l=p?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach((e=>{l+=`, n.${e}`,s.push(e)})),a=new mt({openCypherQuery:l,bindParameters:{param_filter_geom:new I.Z({rings:St(n)})}})}else{let r="";if(null!=e.where&&"1=1"!==e.where){const n=await(0,E.E)(e.where,t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&i.add(e.name)}));const o=new Set(["column-reference","string","number","binary-expression"]),s=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let a=!1;const l=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&s.has(e.operator))return`${l(e.left)} ${e.operator} ${l(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return a=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let r=e.right.value;"%"===r.charAt(0)&&(r=r.slice(1)),"%"===r.charAt(r.length-1)&&(r=r.slice(0,-1)),t+=`'${r.toLowerCase()}')`}return t}return a=!0,""};r=l(n.parseTree),a&&(r="")}let n="";n=p?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let o=!1;c&&(o=!0,n+=" WHERE ID(n) IN $ids"),r&&(n+=o?" AND":" WHERE",n+=` ${r}`),n+=" return ID(n)",p&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach((e=>{n+=`, n.${e}`,s.push(e)})),a=new mt(c?{openCypherQuery:n,bindParameters:{ids:c}}:{openCypherQuery:n})}const y=(await nt(t.parentCompositeLayer.dataManager.knowledgeGraph,a,r)).resultRowsStream.getReader();for(;;){const{done:e,value:r}=await y.read();if(e)break;const i=[];for(let e=0;e<r.length;e++){const t=r[e];let n=0,o=0;const a={properties:{}};for(a.id=t[n],n++,o++,p&&(a.originId=t[n],n++,o++,a.destinationId=t[n],n++,o++);n<t.length;n++)a.properties[s[n-o]]=t[n];i.push(a)}d=d.concat(n.writeToStore(i,Lt,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return d}};(0,n._)([(0,l.Cb)()],Pt.prototype,"knowledgeGraph",void 0),(0,n._)([(0,l.Cb)()],Pt.prototype,"inclusionModeDefinition",void 0),(0,n._)([(0,l.Cb)()],Pt.prototype,"entityTypeNames",void 0),(0,n._)([(0,l.Cb)()],Pt.prototype,"relationshipTypeNames",void 0),(0,n._)([(0,l.Cb)()],Pt.prototype,"geographicLookup",void 0),(0,n._)([(0,l.Cb)()],Pt.prototype,"sublayerCaches",void 0),(0,n._)([(0,l.Cb)()],Pt.prototype,"nodeConnectionsLookup",void 0),(0,n._)([(0,l.Cb)()],Pt.prototype,"memberIdTypeLookup",void 0),Pt=(0,n._)([(0,u.j)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],Pt);const Gt=(0,_t.d)(),Ot=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,n._)([(0,l.Cb)(Gt.fields)],t.prototype,"fields",void 0),(0,n._)([(0,l.Cb)(Gt.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,n._)([(0,u.j)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t};let Ft=class extends((0,bt.M)(Ot((0,wt.h)((0,vt.M)((0,xt.Q)(c.Z)))))){constructor(e){if(super(e),this.capabilities=(0,v.c)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=Lt,this.objectType=null,this.parentCompositeLayer=null,this.popupTemplate=null,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new kt.default(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{const r=gt.Z.fromJSON(e);return this.queryFeaturesJSON(r,t)}}}),[e.port2]}))},this.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)"relationship"===e.graphType?this.geometryType="polyline":this.geometryType="point",this.geometryFieldName=Dt;else if(e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType&&"esriGeometryNull"!==e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType){const t=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);this.geometryFieldName=t?.name??null,this.geometryType=t?.geometryType?le.f.fromJSON(t.geometryType):null;const r=t?.name,n=r?e.objectType.properties?.[r]:null;n?(this.hasM=n.hasM??!1,this.hasZ=n.hasZ??!1):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;e.objectType.properties?.forEach((e=>{let t=e.fieldType;"esriFieldTypeOID"===t&&(t="esriFieldTypeInteger"),this.fields.push(Ct.Z.fromJSON({name:e.name,type:t,alias:e.alias,defaultValue:null,editable:e.editable,nullable:e.nullable}))})),this.fields.push(Ct.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this._set("fields",[...this.fields]),e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel?.spatialReference&&(this.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),"link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?this.renderer=(0,g.i)((0,v.a)(le.f.toJSON("polyline")).renderer):this.renderer=(0,g.i)((0,v.a)(le.f.toJSON("point")).renderer):this.renderer=(0,g.i)((0,v.a)(le.f.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,Et.YN)(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return(0,Tt.eZ)(this,e)}createQuery(){return new gt.Z({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e),i=It.Z.fromJSON(await n.executeQuery(r.toJSON(),t?.signal));return i.features.forEach((e=>{e.sourceLayer=this})),i}async queryFeaturesJSON(e,t){const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(r.toJSON(),t?.signal)}async queryFeatureCount(e,t){const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(r.toJSON(),t?.signal)}async queryExtent(e={},t){const r={...e,returnGeometry:!0},{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(r),o=await i.executeQueryForExtent(n.toJSON(),t?.signal);let s;return s=null!=o.extent?.xmin&&null!=o.extent?.xmax&&null!=o.extent?.ymin&&null!=o.extent?.ymax?new ae.Z(o.extent):new ae.Z,{count:o.count,extent:s}}async queryObjectIds(e,t){const r=gt.Z.from(e);let n;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(r,this,t);n=this.loadQueryEngine(e)}return n.executeQueryForIds(r.toJSON(),t?.signal)}loadQueryEngine(e){const t=new b.F({geometryType:le.f.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new x.Q({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:le.f.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new gt.Z({where:"1=1",outFields:[Lt]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){const r=gt.Z.from(e),n=r.geometry;let i;if(n&&!n.spatialReference?.isWGS84&&(await(0,_.initializeProjection)(n.spatialReference,w.W),r.geometry=(0,_.project)(n instanceof I.Z||n instanceof te.Z?n:n.extent,w.W)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(r,this,t);i=this.loadQueryEngine(e)}return{resolvedQuery:r,queryEngine:i}}};(0,n._)([(0,l.Cb)()],Ft.prototype,"capabilities",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Ft.prototype,"defaultPopupTemplate",null),(0,n._)([(0,l.Cb)()],Ft.prototype,"definitionExpression",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"displayField",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"elevationInfo",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"geometryType",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"geometryFieldName",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"graphType",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"hasM",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"hasZ",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"labelsVisible",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"labelingInfo",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"objectIdField",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"objectType",void 0),(0,n._)([(0,l.Cb)()],Ft.prototype,"parentCompositeLayer",void 0),(0,n._)([(0,l.Cb)({type:m.Z,json:{name:"popupInfo",write:!0}})],Ft.prototype,"popupTemplate",void 0),(0,n._)([(0,l.Cb)({types:g.r,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],Ft.prototype,"renderer",null),(0,n._)([(0,l.Cb)()],Ft.prototype,"source",void 0),(0,n._)([(0,l.Cb)({json:{read:!1}})],Ft.prototype,"type",void 0),Ft=(0,n._)([(0,u.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],Ft);const At=Ft;let Zt,Bt=null;var zt,qt,Yt,Ut,Qt,Jt,Vt,Ht,$t;function Wt(e,t,r,n,i,o){const s=r.length,a=i.length,l=Float64Array.BYTES_PER_ELEMENT,d=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,u=15+s*(p+2*l)+a*(2*d),h=Bt._malloc(u);try{const p=h+16-h%16,u=p+s*l,c=u+s*l,y=c+a*d,f=y+a*d,m=()=>[Bt.HEAPF64.subarray(p>>3,(p>>3)+s),Bt.HEAPF64.subarray(u>>3,(u>>3)+s),Bt.HEAPU32.subarray(c>>2,(c>>2)+a),Bt.HEAPU32.subarray(y>>2,(y>>2)+a),Bt.HEAPU8.subarray(f,f+s)],[g,_,w,b,x]=m();g.set(r),_.set(n),w.set(i),b.set(o),x.set(t);const v=e(s,f,p,u,a,c,y),[C,E,I,T,k]=m();return r.set(C),n.set(E),i.set(I),o.set(T),t.set(k),v}finally{Bt._free(h)}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(zt||(zt={})),function(e){e.getMinIdealEdgeLength=function(){return Bt.getMinIdealEdgeLength()},e.apply=function(e,t,r,n,i,o=2,s=1,a=-1){return Wt(((e,t,r,n,i,l,d)=>Bt.applyForceDirectedLayout(e,t,r,n,i,l,d,o,s,a)),e,t,r,n,i)}}(qt||(qt={})),function(e){e.apply=function(e,t,r,n,i,o=2,s=1,a=-1){return Wt(((e,t,r,n,i,l,d)=>Bt.applyCommunityLayout(e,t,r,n,i,l,d,o,s,a)),e,t,r,n,i)}}(Yt||(Yt={})),function(e){e.apply=function(e,t,r,n,i){return Wt(Bt.applySimpleLayout,e,t,r,n,i)}}(Ut||(Ut={})),function(e){e.apply=function(e,t,r,n,i){return Wt(Bt.applyHierarchicalLayout,e,t,r,n,i)}}(Qt||(Qt={})),function(e){e.apply=function(e,t,r,n,i){return Wt(Bt.applyRadialTreeLayout,e,t,r,n,i)}}(Jt||(Jt={})),function(e){e.apply=function(e,t,r,n,i){return Wt(Bt.applySmartTreeLayout,e,t,r,n,i)}}(Vt||(Vt={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Ht||(Ht={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}($t||($t={}));let Xt=class extends((0,wt.h)((0,vt.M)(c.Z))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},this._graphTypeLookup=new Map,this.knowledgeGraph=null,this.layers=new i.Z,this.linkChartDiagramLookup=new Map,this.linkChartExtent=new ae.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new i.Z,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new o.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){const e=this.url.split("/");this.title=e[e.length-2]}const t=new Set;let r=[],n=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new o.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.inclusionModeDefinition?.generateAllSublayers?(r=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((i,o)=>{if(!this._graphTypeLookup.get(o))return s.L.getLogger(this).warn(`A named type, ${o}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(o);this._graphTypeLookup.get(o)instanceof U||"strictOrigin"in this._graphTypeLookup.get(o)?t.has(o)||(t.add(o),n.push(this._graphTypeLookup.get(o))):this._graphTypeLookup.get(o)instanceof q||"properties"in this._graphTypeLookup.get(o)?t.has(o)||(t.add(o),r.push(this._graphTypeLookup.get(o))):(s.L.getLogger(this).warn(`A named type, ${o}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(o))})):(r=e.knowledgeGraph.dataModel.entityTypes??[],n=e.knowledgeGraph.dataModel.relationshipTypes??[]);const i=new Pt({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=r,this.memberRelationshipTypes=n,this.dataManager=i}load(e){return this.addResolvingPromise(new Promise((t=>{(async function(e){return rt.fetchKnowledgeGraph(e)})(this.url).then((r=>{if(this._initializeLayerProperties({knowledgeGraph:r,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})})),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})}))),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e=>{e.useAllData=!1,e.members?.forEach((e=>{let t;t=e.linkChartLocation instanceof f.O?e.linkChartLocation:e.linkChartLocation?(0,y.c)(e.linkChartLocation):null,this.linkChartDiagramLookup.set(e.id,t),t&&2===t.coords.length&&0===t.lengths.length?this.linkChartGeohashLookup.set(e.id,(0,h.e)(t.coords[1],t.coords[0],12)):this.linkChartGeohashLookup.set(e.id,"")})),this.addResolvingPromise(this._initializeDiagram().then((async()=>{this.layers.forEach((async e=>{await e.refreshCachedQueryEngine()})),this.tables.forEach((async e=>{await e.refreshCachedQueryEngine()}))})))}));else{const t="GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode;this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,t,!0).then((async()=>{(0,a.k_)(e);const t=[],r=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((e=>{e.useAllData=!1}))),await this._initializeDiagram(),this.layers.forEach((e=>{r.push(e.refreshCachedQueryEngine()),t.push(new Promise((t=>{e.on("layerview-create",(()=>{t(null)}))})))})),this.tables.forEach((e=>{r.push(e.refreshCachedQueryEngine())})),await Promise.all(r)})))}t(null)}))}))),Promise.resolve(this)}async addRecords(e,t){let r=[];t?.cascadeAddRelationshipEndNodes&&this.dataManager.knowledgeGraph.dataModel&&(r=await async function(e,t){const r=[],n=new Map,i=[];if(t.dataModel?.relationshipTypes)for(const e of t.dataModel.relationshipTypes)e.name&&n.set(e.name,[]);for(const t of e)n.has(t.typeName)&&n.get(t.typeName)?.push(t.id);for(const[e,o]of n){if(o.length<1)continue;const n=new mt({openCypherQuery:`MATCH (n)-[r:${e}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:o}});i.push(nt(t,n).then((async e=>{const t=e.resultRowsStream.getReader();for(;;){const{done:e,value:n}=await t.read();if(e)break;for(const e of n)r.push({id:e[0],typeName:e[1]}),r.push({id:e[2],typeName:e[3]})}})))}return await Promise.all(i),r}(e,this.dataManager.knowledgeGraph));const n=e.concat(r).filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));await this._handleNewRecords(n)}async removeRecords(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:r=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){let n=[];for(const t of e)!1===this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(t.typeName)?.useAllData&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(t.typeName)?.members?.has(t.id)&&n.push(t);if(t){const e=new Set,t=[];for(const t of n)if(this.dataManager.nodeConnectionsLookup.has(t.id))for(const r of this.dataManager.nodeConnectionsLookup.get(t.id))e.add(r);for(const r of e)this.dataManager.memberIdTypeLookup.has(r)&&t.push({id:r,typeName:this.dataManager.memberIdTypeLookup.get(r)});n=n.concat(t)}this.dataManager.removeFromLayer(n);for(const e of n)this.sublayerIdsCache.get(e.typeName)?.delete(e.id),this.linkChartDiagramLookup.delete(e.id);r&&await this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor});const i=[];return this.layers.forEach((e=>{i.push(e.refreshCachedQueryEngine())})),await Promise.all(i),this._refreshNamedTypes(),n}async expand(e){const t=await this.dataManager.getConnectedRecordIds(e),r=t.filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));return await this._handleNewRecords(t),{records:r}}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach((e=>{const t=new At({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((e=>{const t=new At({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{const r=((e,t,r)=>(e.has(t)||e.set(t,new Set),e.get(t)))(this.sublayerIdsCache,t);e.members?.forEach((e=>{if(r.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof f.O)this.linkChartDiagramLookup.set(e.id,e.linkChartLocation),2===e.linkChartLocation.coords.length&&0===e.linkChartLocation.lengths.length?this.linkChartGeohashLookup.set(e.id,(0,h.e)(e.linkChartLocation.coords[1],e.linkChartLocation.coords[0],12)):this.linkChartGeohashLookup.set(e.id,"");else{const t=(0,y.c)(e.linkChartLocation);this.linkChartDiagramLookup.set(e.id,e.linkChartLocation?t:null),"x"in e.linkChartLocation&&"y"in e.linkChartLocation?this.linkChartGeohashLookup.set(e.id,(0,h.e)(e.linkChartLocation.x,e.linkChartLocation.y,12)):this.linkChartGeohashLookup.set(e.id,"")}}))}))}async calculateLinkChartLayout(e="RADIAL_TREE",t){const n=[],i=[];this.dataManager.sublayerCaches.forEach(((e,t)=>{this.dataManager.entityTypeNames.has(t)?e.forEach((e=>{n.push({typeName:t,feature:e})})):this.dataManager.relationshipTypeNames.has(t)&&e.forEach((e=>{i.push({typeName:t,feature:e})}))})),this.linkChartDiagramLookup=new Map;const a=new Map,l=new Map,d=new Map,p=new Map,u=new Uint8Array(n.length),c=new Float64Array(n.length),f=new Float64Array(n.length),m=new Uint32Array(i.length),g=new Uint32Array(i.length),_=[],w=t?.xScaleFactor??1,b=t?.yScaleFactor??1,x=new ae.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let v,C="FORCE_DIRECTED",E=0,I=0;switch(C="GEOGRAPHIC"===e?"FORCE_DIRECTED":e,C){case"FORCE_DIRECTED":v=qt.apply;break;case"COMMUNITY":v=Yt.apply;break;case"HIERARCHICAL":v=Qt.apply;break;case"RADIAL_TREE":v=Jt.apply;break;case"SMART_TREE":v=Vt.apply;break;default:v=Ut.apply}n.forEach((({typeName:r,feature:n})=>{if(t?.lockedNodeLocations?.has(n.attributes[Lt])){"GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(r)?u[E]=zt.IsGeographic:u[E]=zt.None;const i=t.lockedNodeLocations.get(n.attributes[Lt]);c[E]=i.x,f[E]=i.y}else if("GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(r)){u[E]=zt.IsGeographic;let e=null;const t=n.attributes[this.dataManager.geographicLookup.get(r).name],i=this.dataManager.geographicLookup.get(r)?.geometryType;switch(i){case"esriGeometryPoint":c[E]=t?.x,f[E]=t?.y;break;case"esriGeometryPolygon":e=t?.centroid,null!=e?.x&&null!=e?.y?(c[E]=e.x,f[E]=e.y):u[E]=zt.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":e=t?.extent?.center,null!=e?.x&&null!=e?.y?(c[E]=e.x,f[E]=e.y):u[E]=zt.IsMovable;break;default:u[E]=zt.IsMovable}(null==c[E]||null==f[E]||Number.isNaN(c[E])||Number.isNaN(f[E]))&&(u[E]=zt.IsMovable,c[E]=0,f[E]=0)}else u[E]=zt.IsMovable,c[E]=0,f[E]=0;p.set(n.attributes[Lt],E),_[E]={feature:n,typeName:r},E++}));let T=!1;if(i.forEach((e=>{const t=p.get(e.feature.attributes[Nt]),r=p.get(e.feature.attributes[Rt]);void 0!==t&&void 0!==r?(m[I]=t,g[I]=r,I++):(T=!0,this.linkChartDiagramLookup.set(e.feature.attributes[Nt],null),this.linkChartGeohashLookup.set(e.feature.attributes[Nt],null))})),T&&s.L.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),await(Zt||(Zt=r.e(1916).then(r.bind(r,1916)).then((e=>e.l)).then((({default:e})=>e({locateFile:e=>(0,Q.g)(`esri/libs/linkchartlayout/${e}`)}))).then((e=>{Bt=e})),Zt)),!v(u,c,f,m,g))throw new o.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let e=0;e<_.length;e++){if(u[e]===zt.IsMovable&&(c[e]=c[e]*w,f[e]=f[e]*b),f[e]>84.9999&&(f[e]=84.9999),f[e]<-84.9999&&(f[e]=-84.9999),c[e]>179.9999&&(c[e]=179.9999),c[e]<-179.9999&&(c[e]=-179.9999),_[e].feature.attributes[Dt]=new ee.Z(c[e],f[e]),a.has(_[e].typeName)){const t=a.get(_[e].typeName);t?.set(_[e].feature.attributes[Lt],_[e].feature)}else{const t=new Map;t.set(_[e].feature.attributes[Lt],_[e].feature),a.set(_[e].typeName,t)}d.set(_[e].feature.attributes[Lt],_[e].feature);const t=(0,y.c)(_[e].feature.attributes[Dt]);this.linkChartDiagramLookup.set(_[e].feature.attributes[Lt],_[e].feature.attributes[Dt]?t:null),this.linkChartGeohashLookup.set(_[e].feature.attributes[Lt],(0,h.e)(_[e].feature.attributes[Dt].y,_[e].feature.attributes[Dt].x,12)),_[e].feature.attributes[Dt].x<x.xmin&&(x.xmin=_[e].feature.attributes[Dt].x),_[e].feature.attributes[Dt].x>x.xmax&&(x.xmax=_[e].feature.attributes[Dt].x),_[e].feature.attributes[Dt].y<x.ymin&&(x.ymin=_[e].feature.attributes[Dt].y),_[e].feature.attributes[Dt].y>x.ymax&&(x.ymax=_[e].feature.attributes[Dt].y)}return this.linkChartExtent.xmin=x.xmin,this.linkChartExtent.xmax=x.xmax,this.linkChartExtent.ymin=x.ymin,this.linkChartExtent.ymax=x.ymax,i.forEach((e=>{const t=_[p.get(e.feature.attributes[Nt])]?.feature.attributes[Dt],r=_[p.get(e.feature.attributes[Rt])]?.feature.attributes[Dt];if(!t||!r)return;const n=new te.Z({paths:[[t.x,t.y],[r.x,r.y]]});if(e.feature.attributes[Dt]=n,l.has(e.typeName)){const t=l.get(e.typeName);t?.set(e.feature.attributes[Lt],e.feature)}else{const t=new Map;t.set(e.feature.attributes[Lt],e.feature),l.set(e.typeName,t)}d.set(e.feature.attributes[Lt],e.feature);const i=(0,y.c)(e.feature.attributes[Dt]);this.linkChartDiagramLookup.set(e.feature.attributes[Lt],e.feature.attributes[Dt]?i:null),this.linkChartGeohashLookup.set(e.feature.attributes[Lt],"")})),this._currentLinkChartConfig={layoutMode:e,xScaleFactor:w,yScaleFactor:b},{nodes:a,links:l,idMap:d}}async applyNewLinkChartLayout(e="RADIAL_TREE",t){const r=[];await this.calculateLinkChartLayout(e,t),this.layers.forEach((e=>{r.push(e.refreshCachedQueryEngine())})),await Promise.all(r),this._refreshNamedTypes()}getCurrentNodeLocations(){const e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((t=>{t?.members?.forEach((t=>{const r=t.linkChartLocation;let n;const i=t.id;r&&(n="x"in r?{x:r.x,y:r.y}:{x:r.coords[0],y:r.coords[1]},e.set(i,new ee.Z({x:n.x,y:n.y})))}))})),e}async synchronizeInclusionListWithCache(){return new Promise((e=>{this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{if(e.useAllData=!1,e.members&&e.members.size>0){if(!this.dataManager.sublayerCaches.get(t))return;const r=new Set(Array.from(this.dataManager.sublayerCaches.get(t).keys()));Array.from(e.members.keys()).filter((e=>!r.has(e))).forEach((t=>{e.members?.delete(t)}))}})),e()}))}async refreshLinkChartCache(e){await this.dataManager.refreshCacheContent(e);const t=[];this.layers.forEach((e=>{t.push(e.refreshCachedQueryEngine())})),await Promise.all(t),this._refreshNamedTypes()}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const r of e)this.sublayerIdsCache.has(r.typeName)||(this.sublayerIdsCache.set(r.typeName,new Set),t.push(r.typeName)),this.sublayerIdsCache.get(r.typeName).add(r.id);for(const e of t)if(this._graphTypeLookup.has(e)){const t=this._graphTypeLookup.get(e),r="endPoints"in t?"relationship":"entity",n=new At({objectType:t,parentCompositeLayer:this,graphType:r,title:e});"entity"===r?this.dataManager.entityTypeNames.add(e):this.dataManager.relationshipTypeNames.add(e),n.geometryType?this.layers.push(n):this.tables.push(n),this.dataManager.sublayerCaches.set(e,new Map)}await this.dataManager.refreshCacheContent(e.map((e=>e.id))),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor})}async _initializeDiagram(){this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((e=>{e?.members?.forEach((e=>{const t=e.linkChartLocation;let r;const n=e.id;if(!t)return;r="x"in t?{x:t.x,y:t.y}:{x:t.coords[0],y:t.coords[1]};const i=(0,y.c)(r);this.linkChartDiagramLookup.set(n,i),this.linkChartGeohashLookup.set(n,(0,h.e)(r.x,r.y,12)),this.linkChartExtent.xmin>r.x&&(this.linkChartExtent.xmin=r.x),this.linkChartExtent.xmax<r.x&&(this.linkChartExtent.xmax=r.x),this.linkChartExtent.ymin>r.y&&(this.linkChartExtent.ymin=r.y),this.linkChartExtent.ymax<r.y&&(this.linkChartExtent.ymax=r.y)}))})),this.memberRelationshipTypes.forEach((e=>{e.name&&this.dataManager.sublayerCaches.get(e.name)?.forEach((e=>{const t=this.linkChartDiagramLookup.get(e.attributes[Nt]),r=this.linkChartDiagramLookup.get(e.attributes[Rt]);if(t&&r){const n=(0,y.c)(new te.Z({paths:[[t.coords[0],t.coords[1]],[r.coords[0],r.coords[1]]]}));this.linkChartDiagramLookup.set(e.attributes[Lt],n)}else this.linkChartDiagramLookup.set(e.attributes[Lt],null);this.linkChartGeohashLookup.set(e.attributes[Lt],"")}))}))):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}};(0,n._)([(0,l.Cb)()],Xt.prototype,"dataPreloadedInLocalCache",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"defaultLinkChartConfig",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"dataManager",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"knowledgeGraph",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"layers",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"linkChartDiagramLookup",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"linkChartExtent",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"linkChartGeohashLookup",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"memberEntityTypes",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"memberRelationshipTypes",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"sublayerIdsCache",void 0),(0,n._)([(0,l.Cb)()],Xt.prototype,"tables",void 0),(0,n._)([(0,l.Cb)({json:{read:!1}})],Xt.prototype,"type",void 0),Xt=(0,n._)([(0,u.j)("esri.layers.LinkChartLayer")],Xt);const Kt=Xt},88994:(e,t,r)=>{r.d(t,{P:()=>s});var n=r(48578),i=r(79456),o=r(98576);class s{constructor(e=9,t){this._compareMinX=p,this._compareMinY=u,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),_.prune(),w.prune(),b.prune(),x.prune()}all(e){this._all(this._data,e)}search(e,t){let r=this._data;const n=this._toBBox;if(m(e,r))for(_.clear();r;){for(let i=0,o=r.children.length;i<o;i++){const o=r.children[i],s=r.leaf?n(o):o;m(e,s)&&(r.leaf?t(o):f(e,s)?this._all(o,t):_.push(o))}r=_.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!m(e,t))return!1;for(_.clear();t;){for(let n=0,i=t.children.length;n<i;n++){const i=t.children[n],o=t.leaf?r(i):i;if(m(e,o)){if(t.leaf||f(e,o))return!0;_.push(i)}}t=_.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new E([]),this}remove(e){if(!e)return this;let t,r=this._data,i=null,o=0,s=!1;const a=this._toBBox(e);for(b.clear(),x.clear();r||b.length>0;){if(r||(r=b.pop(),i=b.data[b.length-1],o=x.pop()??0,s=!0),r.leaf&&(t=(0,n.m)(r.children,e,r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),b.push(r),this._condense(b),this;s||r.leaf||!f(r,a)?i?(o++,r=i.children[o],s=!1):r=null:(b.push(r),x.push(o),o=0,i=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_all(e,t){let r=e;for(w.clear();r;){if(!0===r.leaf)for(const e of r.children)t(e);else w.pushArray(r.children);r=w.pop()??null}}_build(e,t,r,n){const i=r-t+1;let o=this._maxEntries;if(i<=o){const n=new E(e.slice(t,r+1));return a(n,this._toBBox),n}n||(n=Math.ceil(Math.log(i)/Math.log(o)),o=Math.ceil(i/o**(n-1)));const s=new I([]);s.height=n;const l=Math.ceil(i/o),d=l*Math.ceil(Math.sqrt(o));g(e,t,r,d,this._compareMinX);for(let i=t;i<=r;i+=d){const t=Math.min(i+d-1,r);g(e,i,t,l,this._compareMinY);for(let r=i;r<=t;r+=l){const i=Math.min(r+l-1,t);s.children.push(this._build(e,r,i,n-1))}}return a(s,this._toBBox),s}_chooseSubtree(e,t,r,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==r;){let r,n=1/0,s=1/0;for(let a=0,l=t.children.length;a<l;a++){const l=t.children[a],d=h(l),p=(i=e,o=l,(Math.max(o.maxX,i.maxX)-Math.min(o.minX,i.minX))*(Math.max(o.maxY,i.maxY)-Math.min(o.minY,i.minY))-d);p<s?(s=p,n=d<n?d:n,r=l):p===s&&d<n&&(n=d,r=l)}t=r||t.children[0]}var i,o;return t}_insert(e,t,r){const n=this._toBBox,i=r?e:n(e);b.clear();const o=this._chooseSubtree(i,this._data,t,b);for(o.children.push(e),d(o,i);t>=0&&b.data[t].children.length>this._maxEntries;)this._split(b,t),t--;this._adjustParentBBoxes(i,b,t)}_split(e,t){const r=e.data[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);const o=this._chooseSplitIndex(r,i,n);if(!o)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const s=r.children.splice(o,r.children.length-o),l=r.leaf?new E(s):new I(s);l.height=r.height,a(r,this._toBBox),a(l,this._toBBox),t?e.data[t-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,t){this._data=new I([e,t]),this._data.height=e.height+1,a(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let n,i,o;n=i=1/0;for(let s=t;s<=r-t;s++){const t=l(e,0,s,this._toBBox),a=l(e,s,r,this._toBBox),d=y(t,a),p=h(t)+h(a);d<n?(n=d,o=s,i=p<i?p:i):d===n&&p<i&&(i=p,o=s)}return o}_chooseSplitAxis(e,t,r){const n=e.leaf?this._compareMinX:p,i=e.leaf?this._compareMinY:u;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);const i=this._toBBox,o=l(e,0,t,i),s=l(e,r-t,r,i);let a=c(o)+c(s);for(let n=t;n<r-t;n++){const t=e.children[n];d(o,e.leaf?i(t):t),a+=c(o)}for(let n=r-t-1;n>=t;n--){const t=e.children[n];d(s,e.leaf?i(t):t),a+=c(s)}return a}_adjustParentBBoxes(e,t,r){for(let n=r;n>=0;n--)d(t.data[n],e)}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const i=e.data[t-1],o=i.children;o.splice((0,n.m)(o,r,o.length,i.indexHint),1)}else this.clear();else a(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function a(e,t){l(e,0,e.children.length,t,e)}function l(e,t,r,n,i){i||(i=new E([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o,s=t;s<r;s++)o=e.children[s],d(i,e.leaf?n(o):o);return i}function d(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function p(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function c(e){return e.maxX-e.minX+(e.maxY-e.minY)}function y(e,t){const r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,o-n)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e,t,r,n,i){const s=[t,r];for(;s.length;){const t=s.pop(),r=s.pop();if(t-r<=n)continue;const a=r+Math.ceil((t-r)/n/2)*n;(0,o.q)(e,a,r,t,i),s.push(r,a,a,t)}}const _=new i.P,w=new i.P,b=new i.P,x=new i.P({deallocator:void 0});class v{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class C extends v{constructor(){super(...arguments),this.height=1,this.indexHint=new n.P}}class E extends C{constructor(e){super(),this.children=e,this.leaf=!0}}class I extends C{constructor(e){super(),this.children=e,this.leaf=!1}}},15173:(e,t,r)=>{r.d(t,{Q:()=>o});var n=r(6540),i=r(89914);class o{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._observable=new i.S,this._items=new Set}get length(){return(0,n.t)(this._observable),this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0===this.length)return;let e;for(e of this._items);return e}peek(){if(0!==this.length)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return(0,n.t)(this._observable),this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const t=this.length;return this._items.forEach((t=>{e(t)||this._items.delete(t)})),t!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){(0,n.t)(this._observable),yield*this._items}}},4571:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>p,c:()=>h,d:()=>u});var n=r(48578),i=r(76506),o=r(89219),s=r(6941);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.d:"esriGeometryPolyline"===e?s.a:s.b}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let d=1;function p(e,t){if((0,n.h)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${l.test(t)?`.${t}`:`["${t}"]`} = ${JSON.stringify(e[t])};`;const n=new Function(`\n      return class AttributesClass$${d++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new n}catch(r){return()=>({[t]:null,...e})}}function u(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,i.d9)(e)}}]}function h(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.q,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},43022:(e,t,r)=>{r.d(t,{a:()=>f,b:()=>T,c:()=>E,d:()=>w,e:()=>m,f:()=>v,g:()=>x,i:()=>C,l:()=>c,m:()=>I,o:()=>b,p:()=>h,r:()=>g,s:()=>u,u:()=>y});var n=r(93314),i=r(23102),o=r(21801),s=r(60947),a=r(38742),l=r(1557),d=r(47842),p=r(34394);const u={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:i.e}}},h={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},c={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:i.e}}},y={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:a.w}}},f={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:i.e}}},m={value:null,type:d.E,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:i.e}}};function g(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const _={write:{enabled:!0,layerContainerTypes:i.e},read:!0},w={type:Number,json:{origins:{"web-document":_,"portal-item":{write:!0}}}},b={...w,json:{...w.json,origins:{"web-document":{..._,write:{enabled:!0,layerContainerTypes:i.e,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition?.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,p.t)(t.layerDefinition.drawingInfo.transparency):void 0:(0,p.t)(t.drawingInfo.transparency)}}},x={type:n.Z,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:r}=this.layer,n=this.view?.timeExtent;let i=this.layer.timeExtent;e&&(i=(0,l.Jb)(i));let o=r?n&&i?n.intersection(i):n||i:i;if(!o||o.isEmpty||o.isAllTime)return o;t&&(o=o.offset(-t.value,t.unit)),e&&(o=(0,l.b3)(o));const s=this._get("timeExtent");return o.equals(s)?s:o}},v={type:o.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=o.Z.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(r.spatialReference=s.Z.fromJSON(t.spatialReference)),r}}}},read:!1}},C={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},E={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:i.e}}},name:"layerDefinition.minScale",write:!0}},I={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:i.e}}},name:"layerDefinition.maxScale",write:!0}},T={json:{write:{ignoreOrigin:!0,layerContainerTypes:i.e},origins:{"web-map":{read:!1,write:!1}}}}},6941:(e,t,r)=>{r.d(t,{a:()=>o,b:()=>s,c:()=>a,d:()=>i,e:()=>l,f:()=>d,g:()=>p});const n=[252,146,31,255],i={type:"esriSMS",style:"esriSMSCircle",size:6,color:n,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:n},s={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},a={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},l={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},d={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},p={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},93939:(e,t,r)=>{r.d(t,{a:()=>c,d:()=>y,h:()=>h});var n=r(21972),i=r(15324),o=r(66396);const s=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof n.Z}function l(e){return e instanceof i.Z?Object.keys(e.items):a(e)?(0,o.g)(e).keys():e?Object.keys(e):[]}function d(e,t){return e instanceof i.Z?e.items[t]:e[t]}function p(e){return e?e.declaredClass:null}function u(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const n=l(e),i=l(t);if(0===n.length&&0===i.length)return;if(!n.length||!i.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const o=i.filter((e=>!n.includes(e))),h=n.filter((e=>!i.includes(e))),c=n.filter((r=>i.includes(r)&&d(e,r)!==d(t,r))).concat(o,h).sort(),y=p(e);if(y&&s.has(y)&&c.length)return{type:"complete",oldValue:e,newValue:t};let f;const m=a(e)&&a(t);for(const n of c){const i=d(e,n),o=d(t,n);let s;if((m||"function"!=typeof i&&"function"!=typeof o)&&i!==o&&(null!=i||null!=o)){if(r&&r[n]&&"function"==typeof r[n])s=r[n]?.(i,o);else if(i instanceof Date&&o instanceof Date){if(i.getTime()===o.getTime())continue;s={type:"complete",oldValue:i,newValue:o}}else s="object"==typeof i&&"object"==typeof o&&p(i)===p(o)?u(i,o):{type:"complete",oldValue:i,newValue:o};null!=s&&(null!=f?f.diff[n]=s:f={type:"partial",diff:{[n]:s}})}}return f}function h(e,t){if(null==e)return!1;const r=t.split(".");let n=e;for(const e of r){if("complete"===n.type)return!0;if("partial"!==n.type)return!1;{const t=n.diff[e];if(!t)return!1;n=t}}return!0}function c(e,t){for(const r of t)if(h(e,r))return!0;return!1}function y(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&p(e)!==p(t)?{type:"complete",oldValue:e,newValue:t}:u(e,t)}},9801:(e,t,r)=>{r.d(t,{f:()=>l,t:()=>a}),r(48578);var n=r(53523),i=r(42911),o=r(46826),s=r(45433);const a={key:"type",base:i.Z,typeMap:{range:s.Z,"coded-value":n.Z,inherited:o.Z}};function l(e){if(!e?.type)return null;switch(e.type){case"range":return s.Z.fromJSON(e);case"codedValue":return n.Z.fromJSON(e);case"inherited":return o.Z.fromJSON(e)}return null}},4417:(e,t,r)=>{r.d(t,{a:()=>u,d:()=>p,e:()=>c,s:()=>h});const n=new Float64Array(2),i=new Float64Array(2),o="0123456789bcdefghjkmnpqrstuvwxyz";function s(e){return o[e]}function a(e){return(e[0]+e[1])/2}function l(e,t,r){return e[0]=t,e[1]=r,e}function d(e,t){const r=t>a(e);return function(e,t){const r=a(e),n=t,i=!t;e[0]=i*e[0]+n*r,e[1]=i*r+n*e[1]}(e,r),r}function p(e,t){let r=-90,n=90,i=-180,o=180;for(let s=0;s<t;s++){const t=Math.ceil((s+1)/2),a=Math.floor((s+1)/2),l=1-s%2,d=30-(3*t+2*a),p=30-(2*t+3*a),u=3*l+2*(1-l),h=2*l+3*(1-l),c=3*l+7*(1-l)<<p,y=(7*l+3*(1-l)<<d&e.geohashX)>>d,f=(c&e.geohashY)>>p;for(let e=u-1;e>=0;e--){const t=(i+o)/2,r=y&1<<e?1:0;i=(1-r)*i+r*t,o=(1-r)*t+r*o}for(let e=h-1;e>=0;e--){const t=(r+n)/2,i=f&1<<e?1:0;r=(1-i)*r+i*t,n=(1-i)*t+i*n}}return[i,r,o,n]}function u(e,t,r,n){n%2&&(n+=1);let i=0,o=0,s=-90,a=90,l=-180,d=180;for(let e=0;e<n/2;e++){for(let t=0;t<5;t++){const n=(l+d)/2,o=r>n?1:0;i|=o<<29-(t+5*e),l=(1-o)*l+o*n,d=(1-o)*n+o*d}for(let r=0;r<5;r++){const n=(s+a)/2,i=t>n?1:0;o|=i<<29-(r+5*e),s=(1-i)*s+i*n,a=(1-i)*n+i*a}}e.geohashX=i,e.geohashY=o}function h(e,t,r,n,i){i%2&&(i+=1);let o=0,s=0,a=-90,l=90,d=-180,p=180;for(let e=0;e<i/2;e++){for(let t=0;t<5;t++){const r=(d+p)/2,i=n>r?1:0;o|=i<<29-(t+5*e),d=(1-i)*d+i*r,p=(1-i)*r+i*p}for(let t=0;t<5;t++){const n=(a+l)/2,i=r>n?1:0;s|=i<<29-(t+5*e),a=(1-i)*a+i*n,l=(1-i)*n+i*l}}e[2*t]=o,e[2*t+1]=s}function c(e,t,r){let o="";const a=l(n,-90,90),p=l(i,-180,180);for(let n=0;n<r;n++){let r=0;n%2?(r|=d(a,e)<<4,r|=d(p,t)<<3,r|=d(a,e)<<2,r|=d(p,t)<<1,r|=d(a,e)<<0):(r|=d(p,t)<<4,r|=d(a,e)<<3,r|=d(p,t)<<2,r|=d(a,e)<<1,r|=d(p,t)<<0),o+=s(r)}return o}},23102:(e,t,r)=>{r.d(t,{e:()=>n});const n=["operational-layers","basemap","ground"]},85557:(e,t,r)=>{r.d(t,{m:()=>o});var n=r(53785),i=r(89623);const o={unknown:1,inches:(0,n.x)(1,"meters","inches"),feet:(0,n.x)(1,"meters","feet"),"us-feet":(0,n.x)(1,"meters","us-feet"),yards:(0,n.x)(1,"meters","yards"),miles:(0,n.x)(1,"meters","miles"),"nautical-miles":(0,n.x)(1,"meters","nautical-miles"),millimeters:(0,n.x)(1,"meters","millimeters"),centimeters:(0,n.x)(1,"meters","centimeters"),decimeters:(0,n.x)(1,"meters","decimeters"),meters:(0,n.x)(1,"meters","meters"),kilometers:(0,n.x)(1,"meters","kilometers"),"decimal-degrees":1/(0,n.B)(1,"meters",i.e.radius)}},94751:(e,t,r)=>{r.d(t,{c:()=>s,g:()=>d,o:()=>a,u:()=>l});var n=r(92896),i=r(60947),o=r(32422);const s={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new n.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.Z.WebMercator}),minus180Line:new n.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new n.Z({paths:[[[180,-180],[180,180]]],spatialReference:i.Z.WGS84}),minus180Line:new n.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:i.Z.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const r=d(e);for(const e of r)for(const r of e)r[0]+=t;return e}function d(e){return(0,o.oU)(e)?e.rings:e.paths}},34394:(e,t,r)=>{r.d(t,{o:()=>i,t:()=>o});var n=r(91306);function i(e){const t=(0,n.m)(100*(1-e));return Math.max(0,Math.min(t,100))}function o(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}},44722:(e,t,r)=>{r.d(t,{o:()=>h});var n=r(85674),i=r(16204);function o(e,t){return e?t?4:3:t?3:2}function s(e,t,r,n,i){if(!t?.lengths.length)return null;const s="upperLeft"===i?.originPosition?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const h=e.coords,c=[],y=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:f,coords:m}=t,g=o(r,n);let _=0;for(const e of f){const t=a(y,m,_,e,r,n,s);t&&c.push(t),_+=e*g}if(c.sort(((e,t)=>{let n=s*e[2]-s*t[2];return 0===n&&r&&(n=e[4]-t[4]),n})),c.length){let e=6*c[0][2];h[0]=c[0][0]/e,h[1]=c[0][1]/e,r&&(e=6*c[0][4],h[2]=0!==e?c[0][3]/e:0),(h[0]<y[0]||h[0]>y[1]||h[1]<y[2]||h[1]>y[3]||r&&(h[2]<y[4]||h[2]>y[5]))&&(h.length=0)}if(!h.length){const e=t.lengths[0]?function(e,t,r,n,i){const s=o(n,i);let a=0,h=0+s,c=0,y=0,f=0,m=0;for(let t=0,i=r-1;t<i;t++,a+=s,h+=s){const t=e[a],r=e[a+1],i=e[a+2],o=e[h],s=e[h+1],g=e[h+2],_=n?d(t,r,i,o,s,g):l(t,r,o,s);if(_)if(c+=_,n){const e=u(t,r,i,o,s,g);y+=_*e[0],f+=_*e[1],m+=_*e[2]}else{const e=p(t,r,o,s);y+=_*e[0],f+=_*e[1]}}return c>0?n?[y/c,f/c,m/c]:[y/c,f/c]:r>0?n?[e[0],e[1],e[2]]:[e[0],e[1]]:null}(m,0,f[0],r,n):null;if(!e)return null;h[0]=e[0],h[1]=e[1],r&&e.length>2&&(h[2]=e[2])}return e}function a(e,t,r,n,i,s,a=1){const l=o(i,s);let d=r,p=r+l,u=0,h=0,c=0,y=0,f=0;for(let r=0,o=n-1;r<o;r++,d+=l,p+=l){const r=t[d],n=t[d+1],o=t[d+2],s=t[p],a=t[p+1],l=t[p+2];let m=r*a-s*n;y+=m,u+=(r+s)*m,h+=(n+a)*m,i&&(m=r*l-s*o,c+=(o+l)*m,f+=m),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),n<e[2]&&(e[2]=n),n>e[3]&&(e[3]=n),i&&(o<e[4]&&(e[4]=o),o>e[5]&&(e[5]=o))}if(y*a>0&&(y*=-1),f*a>0&&(f*=-1),!y)return null;const m=[u,h,.5*y];return i&&(m[3]=c,m[4]=.5*f),m}function l(e,t,r,n){const i=r-e,o=n-t;return Math.sqrt(i*i+o*o)}function d(e,t,r,n,i,o){const s=n-e,a=i-t,l=o-r;return Math.sqrt(s*s+a*a+l*l)}function p(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function u(e,t,r,n,i,o){return[e+.5*(n-e),t+.5*(i-t),r+.5*(o-r)]}const h={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new n.O(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(null==e.centroid&&(e.centroid=s(new i.O,e.geometry,t.hasZ,t.hasM)),e.centroid)}},95307:(e,t,r)=>{r.d(t,{c:()=>d,s:()=>p}),r(74569);var n=r(82058),i=r(32422),o=r(53785),s=r(19124),a=r(32101),l=r(20438);async function d(e,t,r,a){const l=(0,s.p)(e),d=t[0].spatialReference,p={...a,responseType:"json",query:{...l.query,f:"json",sr:(0,o.U)(d),target:JSON.stringify({geometryType:(0,i.Ji)(t[0]),geometries:t}),cutter:JSON.stringify(r)}},u=await(0,n.Z)(l.path+"/cut",p),{cutIndexes:h,geometries:c=[]}=u.data;return{cutIndexes:h,geometries:c.map((e=>{const t=(0,i.im)(e);return t.spatialReference=d,t}))}}async function p(e,t,r){const s="string"==typeof e?(0,a.mN)(e):e,d=t[0].spatialReference,p=(0,i.Ji)(t[0]),u={...r,query:{...s.query,f:"json",sr:(0,o.U)(d),geometries:JSON.stringify((0,l.e)(t))}},{data:h}=await(0,n.Z)(s.path+"/simplify",u);return(0,l.d)(h.geometries,p,d)}},17298:(e,t,r)=>{r.d(t,{g:()=>i,s:()=>o});var n=r(85557);function i(e){return 1/(n.m[e]||1)}const o=function(){const e=Object.keys(n.m);return e.sort(),e}()},19124:(e,t,r)=>{r.d(t,{a:()=>o,e:()=>a,p:()=>s}),r(31450),r(88762);var n=r(76506),i=r(32101);function o(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function s(e){return"string"==typeof e?(0,i.mN)(e):(0,n.d9)(e)}function a(e,t,r){const n={};for(const i in e){if("declaredClass"===i)continue;const o=e[i];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){n[i]=[];for(let e=0;e<o.length;e++)n[i][e]=a(o[e])}else if("object"==typeof o)if(o.toJSON){const e=o.toJSON(r?.[i]);n[i]=t?e:JSON.stringify(e)}else n[i]=t?o:JSON.stringify(o);else n[i]=o}return n}r(82058)},20438:(e,t,r)=>{r.d(t,{d:()=>o,e:()=>i});var n=r(32422);function i(e){return{geometryType:(0,n.Ji)(e[0]),geometries:e.map((e=>e.toJSON()))}}function o(e,t,r){const i=(0,n.q9)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=r,t}))}},46987:(e,t,r)=>{r.d(t,{Z:()=>p,r:()=>d});var n=r(22723),i=r(92143),o=r(50406),s=r(15173),a=r(37453);r(31450),r(48578),r(76506),r(60991),r(6540),r(66396),r(89914),r(62062),r(88762),r(32101),r(12047),r(29768),r(21972),r(17533),r(86656),r(91306),r(34250),r(379),r(6906),r(79456);const l=new FinalizationRegistry((e=>{e.close()}));function d(e,t){l.register(e,t,t)}class p{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new s.Q}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((r,n)=>{let i=!0;const s=e=>{(0,o.k_)(t.signal),i&&(i=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let i=0;i<e.length;++i){const l=e[i];(0,o.y8)(l)?this._clientPromises[i]=l.then((e=>(this._clients[i]=new a.default(e,t,this._ongoingJobsQueue),s(r),this._clients[i])),(()=>(s(n),null))):(this._clients[i]=new a.default(l,t,this._ongoingJobsQueue),this._clientPromises[i]=Promise.resolve(this._clients[i]),s(r))}}))}broadcast(e,t,r){const n=new Array(this._clientPromises.length);for(let i=0;i<this._clientPromises.length;++i){const o=this._clientPromises[i];n[i]=o.then((n=>n?.invoke(e,t,r)))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject((0,o.zE)(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,l.unregister(this)}invoke(e,t,r){let n;Array.isArray(r)?(i.L.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r;const s=(0,o.hh)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:n,resolver:s});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e?.jobAdded()))}return s.promise}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,n.h)(this._clients.map((r=>r.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let r=t.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then((i=>{i&&(t[n]=i.openPort()),0==--r&&e(t)}))}))}get test(){return{numClients:this._clients.length}}}},65514:(e,t,r)=>{r.d(t,{bA:()=>Z});var n=r(60991),i=r(48578),o=r(50406),s=r(46987),a=r(37453),l=r(92143),d=r(71252),p=r(82058),u=r(32101),h=r(73173),c=r(31450),y=(r(66284),r(88762)),f=r(30773),m=r(3482);r(76506),r(22723),r(15173),r(6540),r(66396),r(89914),r(62062),r(12047),r(29768),r(21972),r(17533),r(86656),r(91306),r(34250),r(379),r(6906),r(79456),r(8925),r(57251),r(76131),r(36097),r(87239);const g={async request(e,t){const r=e.options,n=r.responseType;r.signal=t?.signal,r.responseType="native"===n||"native-request-init"===n?"native-request-init":n&&["blob","json","text"].includes(n)&&(0,u.oh)(e.url)?.after?n:"array-buffer";const i=await(0,p.Z)(e.url,r),o={data:i.data,httpStatus:i.httpStatus,ssl:i.ssl};switch(i.requestOptions?.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=(new TextEncoder).encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=(new TextEncoder).encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let _=null;_=(0,u.hF)((0,h.g)("esri/core/workers/init.js"));const w={};w.baseUrl=(0,u.hF)((0,h.g)("dojo/")),w.packages=[{name:"esri",location:"../esri"}];class b{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...r)=>e[t](...r)}))}}class x{constructor(){this._dispatcher=new b,this._workerPostMessage({type:a.M.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,f.n)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,r){this._dispatcher.addEventListener(e,t,r)}removeEventListener(e,t,r){this._dispatcher.removeEventListener(e,t,r)}_workerPostMessage(e){(0,f.n)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,a.r)(e);if(t&&t.type===a.M.OPEN){const{modulePath:e,jobId:r}=t;let n=await a.default.loadWorker(e);n||(n=await import(e));const i=a.default.connect(n);this._workerPostMessage({type:a.M.OPENED,jobId:r,data:i})}}}const v=l.L.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:C}=a.M;let E,I;const T="Failed to create Worker. Fallback to execute module in main thread";async function k(e){return new Promise((t=>{function r(i){const o=(0,a.r)(i);o&&o.type===C&&(e.removeEventListener("message",r),e.removeEventListener("error",n),t(e))}function n(t){t.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",n),v.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new x).addEventListener("message",r),e.addEventListener("error",n)}e.addEventListener("message",r),e.addEventListener("error",n)}))}let M=0;const{ABORT:S,INVOKE:L,OPEN:N,OPENED:R,RESPONSE:D}=a.M;class j{static async create(e){const t=await async function(){if(!(0,i.h)("esri-workers"))return k(new x);if(!E&&!I)try{const e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split('"{CONFIGURATION}"').join(`'${function(){let e;if(null!=c.default.default){const t={...c.default};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(c.default));e.assetsPath=(0,u.hF)(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?(0,u.hF)(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,m.g)(),e.has={"esri-csp-restrictions":(0,i.h)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,i.h)("esri-2d-update-debug"),"esri-2d-log-updating":(0,i.h)("esri-2d-log-updating"),"featurelayer-pbf":(0,i.h)("featurelayer-pbf"),"featurelayer-simplify-thresholds":(0,i.h)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,i.h)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,i.h)("featurelayer-simplify-mobile-factor"),"esri-atomics":(0,i.h)("esri-atomics"),"esri-shared-array-buffer":(0,i.h)("esri-shared-array-buffer"),"esri-tiles-debug":(0,i.h)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,i.h)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,i.h)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl?e.workers.loaderUrl=(0,u.hF)(e.workers.loaderUrl):_&&(e.workers.loaderUrl=_),e.workers.workerPath?e.workers.workerPath=(0,u.hF)(e.workers.workerPath):e.workers.workerPath="esri/core/workers/RemoteClient",e.workers.useDynamicImport=!1;const t=c.default.workers.loaderConfig,r=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=w.baseUrl),w.packages?.forEach((e=>{!function(e,t){for(const r of e)if(r.name===t.name)return;e.push(t)}(t.packages??[],e)})),t}({baseUrl:t?.baseUrl,locale:(0,m.g)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),n={buildDate:y.rh,fullVersion:y.bR,revision:y.LB};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:n})}()}'`);E=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){I=e||{}}let e;if(E)try{e=new Worker(E,{name:"esri-worker-"+M++})}catch(t){v.warn(T,I),e=new x}else v.warn(T,I),e=new x;return k(e)}();return new j(t,e)}constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),l.L.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:r}=t,n=(0,a.n)();return new Promise(((t,i)=>{const s={resolve:t,reject:i,abortHandle:(0,o.$F)(r,(()=>{this._outJobs.delete(n),this._post({type:S,jobId:n})}))};this._outJobs.set(n,s),this._post({type:N,jobId:n,modulePath:e})}))}_onMessage(e){const t=(0,a.r)(e);if(t)switch(t.type){case R:this._onOpenedMessage(t);break;case D:this._onResponseMessage(t);break;case S:this._onAbortMessage(t);break;case L:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,n=t.get(r);n&&(n.controller&&n.controller.abort(),t.delete(r))}_onInvokeMessage(e){const{methodName:t,jobId:r,data:n,abortable:i}=e,s=i?new AbortController:null,l=this._inJobs,d=g[t];let p;try{if("function"!=typeof d)throw new TypeError(`${t} is not a function`);p=d.call(null,n,{signal:s?s.signal:null})}catch(e){return void this._post({type:D,jobId:r,error:(0,a.t)(e)})}(0,o.y8)(p)?(l.set(r,{controller:s,promise:p}),p.then((e=>{l.has(r)&&(l.delete(r),this._post({type:D,jobId:r},e))}),(e=>{l.has(r)&&(l.delete(r),e||(e={message:"Error encountered at method"+t}),(0,o.D_)(e)||this._post({type:D,jobId:r,error:(0,a.t)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:D,jobId:r},p)}_onOpenedMessage(e){const{jobId:t,data:r}=e,n=this._outJobs.get(t);n&&(this._outJobs.delete(t),(0,d.r)(n.abortHandle),n.resolve(r))}_onResponseMessage(e){const{jobId:t,error:r,data:i}=e,o=this._outJobs.get(t);o&&(this._outJobs.delete(t),(0,d.r)(o.abortHandle),r?o.reject(n.Z.fromJSON(JSON.parse(r))):o.resolve(i))}_post(e,t,r){return(0,a.p)(this.worker,e,t,r)}}const P=(0,i.h)("host-browser")?Math.min(navigator.hardwareConcurrency-1,(0,i.h)("workers-pool-size")):0;let G=(0,i.h)("esri-mobile")?Math.min(P,3):P;G||(G=(0,i.h)("safari")&&(0,i.h)("mac")?7:2);let O=0;const F=[];async function A(e,t){const r=new s.Z,{registryTarget:n,...i}=t;return await r.open(e,i),n&&(0,s.r)(n,r),r}async function Z(e,t={}){if("string"!=typeof e)throw new n.Z("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if((0,i.h)("host-webworker")&&!(0,i.h)("esri-workers")&&(r="local"),"local"===r){let r=await a.default.loadWorker(e);r||(r=await import(e)),(0,o.k_)(t.signal);const n=t.client||r;return A([a.default.connect(r)],{...t,client:n})}if(await async function(){if(z)return z;B=new AbortController;const e=[];for(let t=0;t<G;t++){const r=j.create(t).then((e=>(F[t]=e,e)));e.push(r)}return z=Promise.all(e),z}(),(0,o.k_)(t.signal),"dedicated"===r){const r=O++%G;return A([await F[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,G);if(r<G){const n=new Array(r);for(let i=0;i<r;++i){const r=O++%G;n[i]=F[r].open(e,t)}return A(n,t)}}return A(F.map((r=>r.open(e,t))),t)}let B,z=null},95533:(e,t,r)=>{r.d(t,{aX:()=>f});var n=r(31450),i=r(60991),o=r(92143),s=r(44567),a=r(92896),l=r(94751),d=r(53785),p=r(35132),u=r(95307);r(48578),r(76506),r(29768),r(34250),r(91306),r(66396),r(22723),r(86656),r(17533),r(6540),r(2906),r(21801),r(73796),r(12047),r(21972),r(379),r(62062),r(6906),r(79456),r(50406),r(97714),r(60947),r(57251),r(89623),r(73173),r(82058),r(88762),r(32101),r(91597),r(86787),r(89034),r(98380),r(92482),r(82426),r(72836),r(66106),r(29794),r(32422),r(84069),r(74569),r(22781),r(19124),r(20438);const h=o.L.getLogger("esri.geometry.support.normalizeUtils");function c(e,t,r){if(t){const t=function(e,t){if(!(e instanceof a.Z||e instanceof s.Z)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw h.error(e),new i.Z(e)}const r=(0,l.g)(e),n=[];for(const e of r){const r=[];n.push(r),r.push([e[0][0],e[0][1]]);for(let n=0;n<e.length-1;n++){const i=e[n][0],o=e[n][1],s=e[n+1][0],a=e[n+1][1],l=Math.sqrt((s-i)*(s-i)+(a-o)*(a-o)),d=(a-o)/l,p=(s-i)/l,u=l/t;if(u>1){for(let e=1;e<=u-1;e++){const n=e*t,s=p*n+i,a=d*n+o;r.push([s,a])}const e=(l+Math.floor(u-1)*t)/2,n=p*e+i,s=d*e+o;r.push([n,s])}r.push([s,a])}}return function(e){return"polygon"===e.type}(e)?new s.Z({rings:n,spatialReference:e.spatialReference}):new a.Z({paths:n,spatialReference:e.spatialReference})}(e,1e6);e=(0,p.Sx)(t,!0)}return r&&(e=(0,l.u)(e,r)),e}function y(e,t,r){if(Array.isArray(e)){const n=e[0];if(n>t){const r=(0,l.o)(n,t);e[0]=n+r*(-2*t)}else if(n<r){const t=(0,l.o)(n,r);e[0]=n+t*(-2*r)}}else{const n=e.x;if(n>t){const r=(0,l.o)(n,t);e=e.clone().offset(r*(-2*t),0)}else if(n<r){const t=(0,l.o)(n,r);e=e.clone().offset(t*(-2*r),0)}}return e}async function f(e,t,r){if(!Array.isArray(e))return f([e],t);t&&"string"!=typeof t&&h.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i="string"==typeof t?t:t?.url??n.default.geometryServiceUrl;let o,m,g,_,w,b,x,v,C=0;const E=[],I=[];for(const t of e)if(null!=t)if(o||(o=t.spatialReference,m=(0,d.h)(o),g=o.isWebMercator,b=g?102100:4326,_=l.c[b].maxX,w=l.c[b].minX,x=l.c[b].plus180Line,v=l.c[b].minus180Line),m)if("mesh"===t.type)I.push(t);else if("point"===t.type)I.push(y(t.clone(),_,w));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>y(e,_,w))),I.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,m);I.push(e.rings?new s.Z(e):e)}else if(t.extent){const e=t.extent,r=(0,l.o)(e.xmin,w)*(2*_);let n=0===r?t.clone():(0,l.u)(t.clone(),r);e.offset(r,0),e.intersects(x)&&e.xmax!==_?(C=e.xmax>C?e.xmax:C,n=c(n,g),E.push(n),I.push("cut")):e.intersects(v)&&e.xmin!==w?(C=e.xmax*(2*_)>C?e.xmax*(2*_):C,n=c(n,g,360),E.push(n),I.push("cut")):I.push(n)}else I.push(t.clone());else I.push(t);else I.push(t);let T=(0,l.o)(C,_),k=-90;const M=T,S=new a.Z;for(;T>0;){const e=360*T-180;S.addPath([[e,k],[e,-1*k]]),k*=-1,T--}if(E.length>0&&M>0){const t=function(e,t){let r=-1;for(let n=0;n<t.cutIndexes.length;n++){const i=t.cutIndexes[n],o=t.geometries[n],s=(0,l.g)(o);for(let e=0;e<s.length;e++){const t=s[e];t.some((r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const n=t[e][0];r=n>r?n:r}r=Number(r.toFixed(9));const n=-360*(0,l.o)(r,180);for(let r=0;r<t.length;r++){const t=o.getPoint(e,r);o.setPoint(e,r,t.clone().offset(n,0))}return!0}}))}if(i===r){if("polygon"===e[0].type)for(const t of(0,l.g)(o))e[i]=e[i].addRing(t);else if("polyline"===e[0].type)for(const t of(0,l.g)(o))e[i]=e[i].addPath(t)}else r=i,e[i]=o}return e}(E,await(0,u.c)(i,E,S,r)),n=[],o=[];for(let r=0;r<I.length;r++){const i=I[r];if("cut"!==i)o.push(i);else{const i=t.shift(),s=e[r];null!=s&&"polygon"===s.type&&s.rings&&s.rings.length>1&&i.rings.length>=s.rings.length?(n.push(i),o.push("simplify")):o.push(g?(0,p.$)(i):i)}}if(!n.length)return o;const s=await(0,u.s)(i,n,r),a=[];for(let e=0;e<o.length;e++){const t=o[e];"simplify"!==t?a.push(t):a.push(g?(0,p.$)(s.shift()):s.shift())}return a}const L=[];for(let e=0;e<I.length;e++){const t=I[e];if("cut"!==t)L.push(t);else{const e=E.shift();L.push(!0===g?(0,p.$)(e):e)}}return L}},68219:(e,t,r)=>{r.d(t,{Q:()=>_});var n=r(29768),i=r(92143),o=r(50406),s=r(34250),a=r(86787),l=(r(48578),r(17533)),d=r(23102),p=r(15324),u=(r(41864),r(60991),r(21972));r(31450),r(76506),r(22723),r(91306),r(66396),r(86656),r(6540),r(75067),r(379),r(62062),r(6906),r(79456),r(89914);const h=new p.Z,c=new WeakMap;function y(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:y(t,e%t):0}let f=0,m=0;function g(){const e=Date.now();let t=!1;for(const r of h){const n=r.deref();n?n.refreshInterval&&e-(c.get(n)??0)+5>=6e4*n.refreshInterval&&(c.set(n,e),n.refresh(e)):t=!0}if(t)for(let e=h.length-1;e>=0;e--)h.at(e).deref()||h.removeAt(e)}(0,u.b)((()=>{const e=Date.now();let t=0;for(const r of h){const n=r.deref();n&&(t=y(Math.round(6e4*n.refreshInterval),t),n.refreshInterval?c.get(n)||c.set(n,e):c.delete(n))}if(t!==m){if(m=t,clearInterval(f),0===m)return void(f=0);f=setInterval(g,m)}}));const _=e=>{let t=class extends e{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,o.Ds)((()=>this.hasDataChanged())),this.when().then((()=>{var e;this.destroyed||null!=(e=this)&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e&&h.push(new WeakRef(this))}),(()=>{}))}destroy(){!function(e){const t=h.find((t=>t.deref()===e));t&&h.remove(t)}(this)}castRefreshInterval(e){return e>=.1?e:e<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){(0,o.R8)(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})}),(e=>{i.L.getLogger(this).error(e),this.emit("refresh",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){const e=this;return{set refreshInterval(t){e._set("refreshInterval",t)}}}};return(0,n._)([(0,s.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:d.e}}}}})],t.prototype,"refreshInterval",void 0),(0,n._)([(0,a.p)("refreshInterval")],t.prototype,"castRefreshInterval",null),(0,n._)([(0,s.Cb)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],t.prototype,"refreshParameters",null),t=(0,n._)([(0,l.j)("esri.layers.mixins.RefreshableLayer")],t),t}},53523:(e,t,r)=>{r.d(t,{Z:()=>y});var n,i=r(29768),o=r(76506),s=r(34250),a=(r(91306),r(59465)),l=r(17533),d=r(12047),p=(r(48578),r(42911));r(92143),r(31450),r(66396),r(22723),r(86656),r(60991),r(57251),r(6540),r(21972),r(379),r(62062),r(6906),r(79456),r(50406);let u=n=class extends d.wq{constructor(e){super(e),this.name=null,this.code=null}clone(){return new n({name:this.name,code:this.code})}};var h;(0,i._)([(0,s.Cb)({type:String,json:{write:!0}})],u.prototype,"name",void 0),(0,i._)([(0,s.Cb)({type:[String,Number],json:{write:!0}})],u.prototype,"code",void 0),u=n=(0,i._)([(0,l.j)("esri.layers.support.CodedValue")],u);let c=h=class extends p.Z{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some((e=>(String(e.code)===r&&(t=e.name),!!t)))}return t}clone(){return new h({codedValues:(0,o.d9)(this.codedValues),name:this.name})}};(0,i._)([(0,s.Cb)({type:[u],json:{write:!0}})],c.prototype,"codedValues",void 0),(0,i._)([(0,a.e)({codedValue:"coded-value"})],c.prototype,"type",void 0),c=h=(0,i._)([(0,l.j)("esri.layers.support.CodedValueDomain")],c);const y=c},42911:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(29768),i=r(57251),o=r(12047),s=r(34250),a=(r(91306),r(48578),r(59465)),l=r(17533);r(31450),r(76506),r(21972),r(92143),r(86656),r(66396),r(22723),r(379),r(62062),r(6540),r(6906),r(79456),r(50406),r(60991);const d=new i.J({inherited:"inherited",codedValue:"coded-value",range:"range"});let p=class extends o.wq{constructor(e){super(e),this.name=null,this.type=null}};(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],p.prototype,"name",void 0),(0,n._)([(0,a.e)(d)],p.prototype,"type",void 0),p=(0,n._)([(0,l.j)("esri.layers.support.Domain")],p);const u=p},97546:(e,t,r)=>{r.d(t,{Z:()=>m});var n,i=r(29768),o=r(57251),s=r(12047),a=r(34250),l=r(91306),d=(r(48578),r(59465)),p=r(97714),u=r(17533),h=r(9801),c=r(54732);r(31450),r(76506),r(21972),r(92143),r(86656),r(66396),r(22723),r(379),r(62062),r(6540),r(6906),r(79456),r(50406),r(60991),r(53523),r(42911),r(46826),r(45433);const y=new o.J({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let f=n=class extends s.wq{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:t}){let r=null;try{r=t?JSON.parse(t):null}catch(e){}return r?.value??null}readValueType(e,{description:t}){let r=null;try{r=t?JSON.parse(t):null}catch(e){}return r?y.fromJSON(r.fieldValueType):null}clone(){return new n({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};(0,i._)([(0,a.Cb)({type:String,json:{write:!0}})],f.prototype,"alias",void 0),(0,i._)([(0,a.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],f.prototype,"defaultValue",void 0),(0,i._)([(0,a.Cb)()],f.prototype,"description",void 0),(0,i._)([(0,p.r)("description")],f.prototype,"readDescription",null),(0,i._)([(0,a.Cb)({types:h.t,json:{read:{reader:h.f},write:!0}})],f.prototype,"domain",void 0),(0,i._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],f.prototype,"editable",void 0),(0,i._)([(0,a.Cb)({type:l.I,json:{write:{overridePolicy:e=>({enabled:Number.isFinite(e)})}}})],f.prototype,"length",void 0),(0,i._)([(0,a.Cb)({type:String,json:{write:!0}})],f.prototype,"name",void 0),(0,i._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],f.prototype,"nullable",void 0),(0,i._)([(0,d.e)(c.k)],f.prototype,"type",void 0),(0,i._)([(0,a.Cb)()],f.prototype,"valueType",void 0),(0,i._)([(0,p.r)("valueType",["description"])],f.prototype,"readValueType",null),(0,i._)([(0,a.Cb)({type:Boolean,json:{read:!1}})],f.prototype,"visible",void 0),f=n=(0,i._)([(0,u.j)("esri.layers.support.Field")],f);const m=f},46826:(e,t,r)=>{r.d(t,{Z:()=>d});var n,i=r(29768),o=(r(92143),r(91306),r(48578),r(60991),r(59465)),s=r(17533),a=r(42911);r(31450),r(76506),r(57251),r(34250),r(66396),r(22723),r(86656),r(6540),r(12047),r(21972),r(379),r(62062),r(6906),r(79456),r(50406);let l=n=class extends a.Z{constructor(e){super(e),this.type="inherited"}clone(){return new n}};(0,i._)([(0,o.e)({inherited:"inherited"})],l.prototype,"type",void 0),l=n=(0,i._)([(0,s.j)("esri.layers.support.InheritedDomain")],l);const d=l},45433:(e,t,r)=>{r.d(t,{Z:()=>p});var n,i=r(29768),o=r(34250),s=(r(91306),r(48578),r(59465)),a=r(17533),l=r(42911);r(92143),r(31450),r(76506),r(66396),r(22723),r(86656),r(60991),r(57251),r(6540),r(12047),r(21972),r(379),r(62062),r(6906),r(79456),r(50406);let d=n=class extends l.Z{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new n({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,i._)([(0,o.Cb)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]}}}})],d.prototype,"maxValue",void 0),(0,i._)([(0,o.Cb)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]}}}})],d.prototype,"minValue",void 0),(0,i._)([(0,s.e)({range:"range"})],d.prototype,"type",void 0),d=n=(0,i._)([(0,a.j)("esri.layers.support.RangeDomain")],d);const p=d},87258:(e,t,r)=>{r.d(t,{Z:()=>w});var n,i=r(29768),o=r(74569),s=r(23761),a=r(57251),l=r(12047),d=r(76506),p=r(34250),u=(r(91306),r(97714)),h=r(17533),c=r(2906),y=r(60947),f=r(32422),m=r(97546);r(21801),r(92143),r(31450),r(48578),r(73796),r(21972),r(86656),r(66396),r(22723),r(379),r(62062),r(6540),r(6906),r(79456),r(50406),r(60991),r(53785),r(89623),r(73173),r(82058),r(88762),r(32101),r(91597),r(86787),r(35132),r(84069),r(44567),r(89034),r(98380),r(92482),r(82426),r(72836),r(66106),r(29794),r(92896),r(22781),r(86748),r(66122),r(15324),r(75067),r(89914),r(14249),r(66284),r(8925),r(3482),r(76131),r(36097),r(87239),r(60217),r(29107),r(30574),r(2157),r(25977),r(58076),r(98242),r(7471),r(54414),r(59465),r(1648),r(45154),r(16769),r(93603),r(15438),r(593),r(48027),r(54174),r(85699),r(55531),r(96055),r(47776),r(18033),r(6331),r(62048),r(56890),r(30493),r(4292),r(75626),r(72652),r(29641),r(70821),r(3296),r(34229),r(37029),r(96467),r(63571),r(30776),r(63130),r(25696),r(94216),r(42775),r(95834),r(34394),r(57150),r(76726),r(20444),r(76393),r(78548),r(2497),r(49906),r(46527),r(11799),r(48649),r(81731),r(9960),r(30823),r(53326),r(5853),r(39141),r(38742),r(52461),r(48243),r(34635),r(10401),r(49900),r(81184),r(33101),r(58943),r(67477),r(78533),r(74653),r(91091),r(70737),r(36834),r(8487),r(17817),r(90814),r(15459),r(97189),r(61847),r(28212),r(16955),r(22401),r(48699),r(77894),r(55187),r(8586),r(44509),r(69814),r(11305),r(62259),r(44790),r(58085),r(41864),r(5909),r(60669),r(48208),r(51589),r(9801),r(53523),r(42911),r(46826),r(45433),r(54732);const g=new a.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let _=n=class extends l.wq{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const r=y.Z.fromJSON(t.spatialReference),n=[];for(let t=0;t<e.length;t++){const i=e[t],o=s.Z.fromJSON(i),a=i.geometry?.spatialReference;null==o.geometry||a||(o.geometry.spatialReference=r);const l=i.aggregateGeometries,d=o.aggregateGeometries;if(l&&null!=d)for(const e in d){const t=d[e],n=l[e],i=n?.spatialReference;null==t||i||(t.spatialReference=r)}n.push(o)}return n}writeGeometryType(e,t,r,n){if(e)return void g.write(e,t,r,n);const{features:i}=this;if(i)for(const e of i)if(null!=e?.geometry)return void g.write(e.geometry.type,t,r,n)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,n=(0,f.im)(e);return n&&!r&&t.spatialReference&&(n.spatialReference=y.Z.fromJSON(t.spatialReference)),n}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const e of r)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new n(this.cloneProperties())}cloneProperties(){return(0,d.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const n=t.features[r];if(n.geometry){const t=e?.[r];n.geometry=t?.toJSON()||n.geometry}}return t}quantize(e){const{scale:[t,r],translate:[n,i]}=e,o=this.features,s=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-n)/t)),(e=>Math.round((i-e)/r)));for(let e=0,t=o.length;e<t;e++)s?.(o[e].geometry)||(o.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[n,i],scale:[o,s]}=r;let a=null,l=null;if(this.hasZ&&null!=r?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=r;a=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=r;l=r=>null==r?r:r*t+e}const d=this._getHydrationFunction(e,(e=>e*o+n),(e=>i-e*s),a,l);for(const{geometry:e}of t)null!=e&&d&&d(e);return this.transform=null,this}_quantizePoints(e,t,r){let n,i;const o=[];for(let s=0,a=e.length;s<a;s++){const a=e[s];if(s>0){const e=t(a[0]),s=r(a[1]);e===n&&s===i||(o.push([e-n,s-i]),n=e,i=s)}else n=t(a[0]),i=r(a[1]),o.push([n,i])}return o.length>0?o:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const n=(0,f.oU)(e)?e.rings:e.paths,i=[];for(let e=0,o=n.length;e<o;e++){const o=n[e],s=this._quantizePoints(o,t,r);s&&i.push(s)}return i.length>0?((0,f.oU)(e)?e.rings=i:e.paths=i,e):null}:"multipoint"===e?e=>{const n=this._quantizePoints(e.points,t,r);return n&&n.length>0?(e.points=n,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,n,i){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),n&&(e.z=n(e.z))}:"polyline"===e||"polygon"===e?e=>{const o=(0,f.oU)(e)?e.rings:e.paths;let s,a;for(let e=0,n=o.length;e<n;e++){const n=o[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];e>0?(s+=i[0],a+=i[1]):(s=i[0],a=i[1]),i[0]=t(s),i[1]=r(a)}}if(n&&i)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2]),r[3]=i(r[3])}}else if(n)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2])}}else if(i)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=i(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),n&&null!=e.zmax&&null!=e.zmin&&(e.zmax=n(e.zmax),e.zmin=n(e.zmin)),i&&null!=e.mmax&&null!=e.mmin&&(e.mmax=i(e.mmax),e.mmin=i(e.mmin))}:"multipoint"===e?e=>{const o=e.points;let s,a;for(let e=0,n=o.length;e<n;e++){const n=o[e];e>0?(s+=n[0],a+=n[1]):(s=n[0],a=n[1]),n[0]=t(s),n[1]=r(a)}if(n&&i)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=n(t[2]),t[3]=i(t[3])}else if(n)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=n(t[2])}else if(i)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=i(t[2])}}:null}};(0,i._)([(0,p.Cb)({type:String,json:{write:!0}})],_.prototype,"displayFieldName",void 0),(0,i._)([(0,p.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,p.Cb)({type:[s.Z],json:{write:!0}})],_.prototype,"features",void 0),(0,i._)([(0,u.r)("features")],_.prototype,"readFeatures",null),(0,i._)([(0,p.Cb)({type:[m.Z],json:{write:!0}})],_.prototype,"fields",void 0),(0,i._)([(0,p.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:g.read}}})],_.prototype,"geometryType",void 0),(0,i._)([(0,c.w)("geometryType")],_.prototype,"writeGeometryType",null),(0,i._)([(0,p.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"hasM",void 0),(0,i._)([(0,p.Cb)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],_.prototype,"hasZ",void 0),(0,i._)([(0,p.Cb)({types:o.qM,json:{write:!0}})],_.prototype,"queryGeometry",void 0),(0,i._)([(0,u.r)("queryGeometry")],_.prototype,"readQueryGeometry",null),(0,i._)([(0,p.Cb)({type:y.Z,json:{write:!0}})],_.prototype,"spatialReference",void 0),(0,i._)([(0,c.w)("spatialReference")],_.prototype,"writeSpatialReference",null),(0,i._)([(0,p.Cb)({json:{write:!0}})],_.prototype,"transform",void 0),_=n=(0,i._)([(0,h.j)("esri.rest.support.FeatureSet")],_),_.prototype.toJSON.isDefaultToJSON=!0;const w=_},1557:(e,t,r)=>{r.d(t,{Jb:()=>s,b3:()=>o});var n=r(93314),i=(r(48578),r(35197));function o(e){if(!e)return e;const{start:t,end:r}=e;return new n.Z({start:null!=t?(0,i.o)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,i.o)(r,-r.getTimezoneOffset(),"minutes"):r})}function s(e){if(!e)return e;const{start:t,end:r}=e;return new n.Z({start:null!=t?(0,i.o)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,i.o)(r,r.getTimezoneOffset(),"minutes"):r})}r(29768),r(12047),r(21972),r(92143),r(31450),r(76506),r(17533),r(86656),r(66396),r(22723),r(6540),r(91306),r(60991),r(34250),r(379),r(62062),r(6906),r(79456),r(50406),r(97714),r(2906),r(76131),r(36097),r(8925),r(57251),r(3482)}}]);