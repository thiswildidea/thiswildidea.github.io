"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[9352],{9352:(e,t,i)=>{i.r(t),i.d(t,{DictionaryLoader:()=>p});var s=i(48027),o=i(82058),r=i(60991),n=(i(48578),i(92143)),l=i(89241),a=i(50406),c=i(10738),h=i(1709),y=i(60217),m=i(63571);i(54174),i(82426),i(72836),i(66106),i(29794),i(91306),i(31450),i(76506),i(88762),i(32101),i(12047),i(29768),i(21972),i(17533),i(86656),i(66396),i(22723),i(6540),i(34250),i(379),i(62062),i(6906),i(79456),i(91700),i(35154),i(36097),i(14249),i(66284),i(8925),i(57251),i(3482),i(76131),i(87239),i(73173),i(74569),i(21801),i(73796),i(97714),i(60947),i(53785),i(89623),i(2906),i(91597),i(86787),i(35132),i(84069),i(44567),i(89034),i(98380),i(92482),i(92896),i(22781),i(32422),i(59465),i(30776);const u="esri.renderers.support.DictionaryLoader",d={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class p{constructor(e,t,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new l.L(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=t,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,t){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{i=await this._dictionaryPromise}catch(e){if((0,a.D_)(e))return this._dictionaryPromise=null,null}const o=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),r={};if(this.fieldMap)for(const t of this._symbolFields){const i=this._getFieldName(this.fieldMap[t]);if(i){const s=e.attributes[i];r[t]=o?s:null!=s?""+e.attributes[i]:""}else r[t]=""}let l=null;try{l=i?.(r,t)}catch(e){return null}if(!l||"string"!=typeof l)return null;const c=(0,n.n)(l).toString(),h=this._symbolCache.get(c);if(h)return h.catch((()=>{this._symbolCache.pop(c)})),h;const y=l.split(";"),m=[],u=[];for(const e of y)if(e)if(e.includes("po:")){const t=e.substr(3).split("|");if(3===t.length){const e=t[0],i=t[1];let o=t[2];if("DashTemplate"===i)o=o.split(" ").map((e=>Number(e)));else if("Color"===i){const e=new s.Z(o).toRgba();o=[e[0],e[1],e[2],255*e[3]]}else o=Number(o);u.push({primitiveName:e,propertyName:i,value:o})}}else if(e.includes("|")){for(const t of e.split("|"))if(this._itemNames.has(t)){m.push(t);break}}else this._itemNames.has(e)&&m.push(e);const d=null==e.geometry||!e.geometry.hasZ&&"point"===e.geometry.type,p=this._cimPartsToCIMSymbol(m,u,d,t);return this._symbolCache.put(c,p,1),p}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void n.L.getLogger(u).error("no valid URL!");const t=(0,o.Z)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:null!=e?e.signal:null}),[{data:i}]=await Promise.all([t,(0,y.l)()]);if(!i)throw this._dictionaryPromise=null,new r.Z("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:l,expression:a,itemsNames:m}=i,d=a;let p=!1;l&&(this._dictionaryVersion=c.V.parse(l),p=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(m),this._symbolFields=s.symbol;const f={};if(this.config){const e=this.config;for(const t in e)f[t]=e[t]}if(s.configuration)for(const e of s.configuration)f.hasOwnProperty(e.name)||(f[e.name]=e.value);const b=[];if(e?.fields&&this.fieldMap)for(const t of this._symbolFields){const i=this.fieldMap[t],s=e.fields.filter((e=>e.name.toLowerCase()===i?.toLowerCase()));s.length>0&&b.push({...s[0],type:p?s[0].type:"esriFieldTypeString"})}b.length>0&&(this._fieldIndex=new h.Z(b));const g=(0,y.c)(d,null!=e?e.spatialReference:null,b,f).then((e=>{const t={scale:0};return(i,s)=>{if(null==e)return null;const o=e.repurposeFeature({geometry:null,attributes:i});return t.scale=null!=s?s.scale??void 0:void 0,e.evaluate({$feature:o,$view:t},e.services)}})).catch((e=>(n.L.getLogger(u).error("Creating dictinoary expression failed:",e),null)));return this._dictionaryPromise=g,g}async _cimPartsToCIMSymbol(e,t,i,s){const o=new Array(e.length);for(let t=0;t<e.length;t++)o[t]=this._getSymbolPart(e[t],s);const r=await Promise.all(o),n=this.fieldMap;if(n)for(const e of r)f(e,n);return new m.Z({data:this._combineSymbolParts(r,t,i)})}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),s=(0,o.Z)(i,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,s);try{return(await s).data}catch(t){throw this._ongoingRequests.delete(e),t}}_combineSymbolParts(e,t,i){if(!e||0===e.length)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const t of e){const e=t;s.symbolLayers.unshift(...e.symbolLayers)}}return i&&(s.callout=d),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:t}}_getFieldName(e){if(null!==this._fieldIndex){const t=this._fieldIndex.get(e);return t?t.name:e}return e}}function f(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let s=i.length;for(;s--;){const e=i[s];e&&!1!==e.enable&&"CIMVectorMarker"===e.type&&b(e,t)}}function b(e,t){const i=e.markerGraphics;if(i)for(const e of i){if(!e)continue;const i=e.symbol;if(i)switch(i.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":f(i,t);break;case"CIMTextSymbol":i.fieldMap=t}}}},10738:(e,t,i)=>{i.d(t,{V:()=>o});var s=i(60991);let o=class{constructor(e,t,i=""){this.major=e,this.minor=t,this._context=i}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",i=this._context&&this._context+" ";throw new s.Z(t+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new o(this.major,this.minor,this._context)}static parse(e,t=""){const[i,r]=e.split("."),n=/^\s*\d+\s*$/;if(!i?.match||!n.test(i))throw new s.Z((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!r?.match||!n.test(r))throw new s.Z((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const l=parseInt(i,10),a=parseInt(r,10);return new o(l,a,t)}}},63571:(e,t,i)=>{i.d(t,{Z:()=>p});var s,o=i(29768),r=i(76506),n=i(92143),l=i(34250),a=(i(91306),i(59465)),c=i(97714),h=i(17533),y=i(2906),m=i(14249),u=i(30776);i(48578),i(31450),i(66396),i(22723),i(86656),i(60991),i(57251),i(6540),i(21972),i(379),i(62062),i(6906),i(79456),i(50406),i(66284),i(8925),i(3482),i(76131),i(36097),i(87239),i(82058),i(88762),i(32101),i(12047),i(73173),i(82426),i(72836),i(66106),i(29794),i(60217),i(74569),i(21801),i(73796),i(60947),i(53785),i(89623),i(91597),i(86787),i(35132),i(84069),i(44567),i(89034),i(98380),i(92482),i(92896),i(22781),i(32422),i(48027),i(54174);let d=s=class extends u.Z{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){Object.assign(t,e)}async collectRequiredFields(e,t){if("CIMSymbolReference"===this.data?.type){const i=this.data.primitiveOverrides;if(i){const s=i.map((i=>{const s=i.valueExpressionInfo;return(0,m.io)(e,t,s.expression)}));await Promise.all(s)}}}clone(){return new s({data:(0,r.d9)(this.data)})}hash(){return(0,n.n)(JSON.stringify(this.data)).toString()}};(0,o._)([(0,l.Cb)({json:{write:!1}})],d.prototype,"color",void 0),(0,o._)([(0,l.Cb)({json:{write:!0}})],d.prototype,"data",void 0),(0,o._)([(0,c.r)("data",["symbol"])],d.prototype,"readData",null),(0,o._)([(0,y.w)("data",{})],d.prototype,"writeData",null),(0,o._)([(0,a.e)({CIMSymbolReference:"cim"},{readOnly:!0})],d.prototype,"type",void 0),d=s=(0,o._)([(0,h.j)("esri.symbols.CIMSymbol")],d);const p=d},30776:(e,t,i)=>{i.d(t,{Z:()=>u});var s=i(29768),o=i(48027),r=i(57251),n=i(12047),l=i(34250),a=(i(91306),i(48578),i(97714)),c=i(17533);i(54174),i(82426),i(72836),i(66106),i(29794),i(31450),i(76506),i(21972),i(92143),i(86656),i(66396),i(22723),i(379),i(62062),i(6540),i(6906),i(79456),i(50406),i(60991);const h=new r.J({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let y=0,m=class extends n.wq{constructor(e){super(e),this.id="sym"+y++,this.type=null,this.color=new o.Z([0,0,0,1])}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};(0,s._)([(0,l.Cb)({type:h.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:h.write}}})],m.prototype,"type",void 0),(0,s._)([(0,l.Cb)({type:o.Z,json:{write:{allowNull:!0}}})],m.prototype,"color",void 0),(0,s._)([(0,a.r)("color")],m.prototype,"readColor",null),m=(0,s._)([(0,c.j)("esri.symbols.Symbol")],m);const u=m}}]);